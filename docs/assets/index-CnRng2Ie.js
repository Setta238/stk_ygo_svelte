var Hn=Object.defineProperty;var $n=(i,e,t)=>e in i?Hn(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var o=(i,e,t)=>$n(i,typeof e!="symbol"?e+"":e,t);import{j as jn}from"./cardInfo.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();const ba=!1;var $a=Array.isArray,Un=Array.prototype.indexOf,ja=Array.from,Or=Object.defineProperty,Xt=Object.getOwnPropertyDescriptor,Nr=Object.getOwnPropertyDescriptors,Zn=Object.prototype,Gn=Array.prototype,Ua=Object.getPrototypeOf;function Vn(i){return typeof i=="function"}const lt=()=>{};function zn(i){return typeof(i==null?void 0:i.then)=="function"}function Yn(i){return i()}function wa(i){for(var e=0;e<i.length;e++)i[e]()}const at=2,Rr=4,Qi=8,Xi=16,Tt=32,hi=64,Ri=128,it=256,Li=512,Ke=1024,kt=2048,ri=4096,St=8192,Ji=16384,Lr=32768,Ii=65536,Hr=1<<17,Wn=1<<19,$r=1<<20,bt=Symbol("$state"),Kn=Symbol("legacy props"),Qn=Symbol("");function jr(i){return i===this.v}function Ur(i,e){return i!=i?e==e:i!==e||i!==null&&typeof i=="object"||typeof i=="function"}function Za(i){return!Ur(i,this.v)}function Xn(i){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Jn(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function In(i){throw new Error("https://svelte.dev/e/effect_orphan")}function es(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function ts(i){throw new Error("https://svelte.dev/e/props_invalid_value")}function is(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function as(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function rs(){throw new Error("https://svelte.dev/e/state_unsafe_local_read")}function ns(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let gi=!1,ss=!1;function ls(){gi=!0}const Ga=1,Va=2,Zr=4,os=8,cs=16,ds=1,us=2,vs=4,fs=8,ps=16,hs=1,gs=2,ys=4,_s=1,ms=2,je=Symbol();let Le=null;function Hi(i){Le=i}function Ze(i,e=!1,t){Le={p:Le,c:null,e:null,m:!1,s:i,x:null,l:null},gi&&!e&&(Le.l={s:null,u:null,r1:[],r2:Ye(!1)})}function Ge(i){const e=Le;if(e!==null){const s=e.e;if(s!==null){var t=be,a=Ce;e.e=null;try{for(var r=0;r<s.length;r++){var n=s[r];nt(n.effect),rt(n.reaction),li(n.fn)}}finally{nt(t),rt(a)}}Le=e.p,e.m=!0}return{}}function ni(){return!gi||Le!==null&&Le.l===null}function Ye(i,e){var t={f:0,v:i,reactions:null,equals:jr,rv:0,wv:0};return t}function Ss(i){return Gr(Ye(i))}function ei(i,e=!1){var a;const t=Ye(i);return e||(t.equals=Za),gi&&Le!==null&&Le.l!==null&&((a=Le.l).s??(a.s=[])).push(t),t}function Me(i,e=!1){return Gr(ei(i,e))}function Gr(i){return Ce!==null&&!vt&&Ce.f&at&&(ft===null?Ms([i]):ft.push(i)),i}function Ne(i,e){return ae(i,ot(()=>u(i))),e}function ae(i,e){return Ce!==null&&!vt&&ni()&&Ce.f&(at|Xi)&&(ft===null||!ft.includes(i))&&ns(),xt(i,e)}function xt(i,e){return i.equals(e)||(i.v,i.v=e,i.wv=cn(),Vr(i,kt),ni()&&be!==null&&be.f&Ke&&!(be.f&(Tt|hi))&&(yt===null?Fs([i]):yt.push(i))),e}function Vr(i,e){var t=i.reactions;if(t!==null)for(var a=ni(),r=t.length,n=0;n<r;n++){var s=t[n],l=s.f;l&kt||!a&&s===be||(pt(s,e),l&(Ke|it)&&(l&at?Vr(s,ri):ra(s)))}}let zr=!1;function Dt(i,e=null,t){if(typeof i!="object"||i===null||bt in i)return i;const a=Ua(i);if(a!==Zn&&a!==Gn)return i;var r=new Map,n=$a(i),s=Ye(0);n&&r.set("length",Ye(i.length));var l;return new Proxy(i,{defineProperty(v,d,f){(!("value"in f)||f.configurable===!1||f.enumerable===!1||f.writable===!1)&&is();var p=r.get(d);return p===void 0?(p=Ye(f.value),r.set(d,p)):ae(p,Dt(f.value,l)),!0},deleteProperty(v,d){var f=r.get(d);if(f===void 0)d in v&&r.set(d,Ye(je));else{if(n&&typeof d=="string"){var p=r.get("length"),g=Number(d);Number.isInteger(g)&&g<p.v&&ae(p,g)}ae(f,je),ar(s)}return!0},get(v,d,f){var h;if(d===bt)return i;var p=r.get(d),g=d in v;if(p===void 0&&(!g||(h=Xt(v,d))!=null&&h.writable)&&(p=Ye(Dt(g?v[d]:je,l)),r.set(d,p)),p!==void 0){var c=u(p);return c===je?void 0:c}return Reflect.get(v,d,f)},getOwnPropertyDescriptor(v,d){var f=Reflect.getOwnPropertyDescriptor(v,d);if(f&&"value"in f){var p=r.get(d);p&&(f.value=u(p))}else if(f===void 0){var g=r.get(d),c=g==null?void 0:g.v;if(g!==void 0&&c!==je)return{enumerable:!0,configurable:!0,value:c,writable:!0}}return f},has(v,d){var c;if(d===bt)return!0;var f=r.get(d),p=f!==void 0&&f.v!==je||Reflect.has(v,d);if(f!==void 0||be!==null&&(!p||(c=Xt(v,d))!=null&&c.writable)){f===void 0&&(f=Ye(p?Dt(v[d],l):je),r.set(d,f));var g=u(f);if(g===je)return!1}return p},set(v,d,f,p){var C;var g=r.get(d),c=d in v;if(n&&d==="length")for(var h=f;h<g.v;h+=1){var S=r.get(h+"");S!==void 0?ae(S,je):h in v&&(S=Ye(je),r.set(h+"",S))}g===void 0?(!c||(C=Xt(v,d))!=null&&C.writable)&&(g=Ye(void 0),ae(g,Dt(f,l)),r.set(d,g)):(c=g.v!==je,ae(g,Dt(f,l)));var y=Reflect.getOwnPropertyDescriptor(v,d);if(y!=null&&y.set&&y.set.call(p,f),!c){if(n&&typeof d=="string"){var m=r.get("length"),T=Number(d);Number.isInteger(T)&&T>=m.v&&ae(m,T+1)}ar(s)}return!0},ownKeys(v){u(s);var d=Reflect.ownKeys(v).filter(g=>{var c=r.get(g);return c===void 0||c.v!==je});for(var[f,p]of r)p.v!==je&&!(f in v)&&d.push(f);return d},setPrototypeOf(){as()}})}function ar(i,e=1){ae(i,i.v+e)}function rr(i){return i!==null&&typeof i=="object"&&bt in i?i[bt]:i}function Yr(i,e){return Object.is(rr(i),rr(e))}var nr,Wr,Kr,Qr;function bs(){if(nr===void 0){nr=window,Wr=/Firefox/.test(navigator.userAgent);var i=Element.prototype,e=Node.prototype;Kr=Xt(e,"firstChild").get,Qr=Xt(e,"nextSibling").get,i.__click=void 0,i.__className="",i.__attributes=null,i.__styles=null,i.__e=void 0,Text.prototype.__t=void 0}}function ea(i=""){return document.createTextNode(i)}function $i(i){return Kr.call(i)}function ta(i){return Qr.call(i)}function _(i,e){return $i(i)}function re(i,e){{var t=$i(i);return t instanceof Comment&&t.data===""?ta(t):t}}function b(i,e=1,t=!1){let a=i;for(;e--;)a=ta(a);return a}function ws(i){i.textContent=""}function Ht(i){var e=at|kt,t=Ce!==null&&Ce.f&at?Ce:null;return be===null||t!==null&&t.f&it?e|=it:be.f|=$r,{ctx:Le,deps:null,effects:null,equals:jr,f:e,fn:i,reactions:null,rv:0,v:null,wv:0,parent:t??be}}function me(i){const e=Ht(i);return e.equals=Za,e}function Xr(i){var e=i.effects;if(e!==null){i.effects=null;for(var t=0;t<e.length;t+=1)Pt(e[t])}}function Ts(i){for(var e=i.parent;e!==null;){if(!(e.f&at))return e;e=e.parent}return null}function ks(i){var e,t=be;nt(Ts(i));try{Xr(i),e=un(i)}finally{nt(t)}return e}function Jr(i){var e=ks(i),t=(At||i.f&it)&&i.deps!==null?ri:Ke;pt(i,t),i.equals(e)||(i.v=e,i.wv=cn())}function Ir(i){be===null&&Ce===null&&In(),Ce!==null&&Ce.f&it&&be===null&&Jn(),Wa&&Xn()}function Cs(i,e){var t=e.last;t===null?e.last=e.first=i:(t.next=i,i.prev=t,e.last=i)}function si(i,e,t,a=!0){var r=(i&hi)!==0,n=be,s={ctx:Le,deps:null,nodes_start:null,nodes_end:null,f:i|kt,first:null,fn:e,last:null,next:null,parent:r?null:n,prev:null,teardown:null,transitions:null,wv:0};if(t){var l=Jt;try{lr(!0),Ka(s),s.f|=Lr}catch(f){throw Pt(s),f}finally{lr(l)}}else e!==null&&ra(s);var v=t&&s.deps===null&&s.first===null&&s.nodes_start===null&&s.teardown===null&&(s.f&($r|Ri))===0;if(!v&&!r&&a&&(n!==null&&Cs(s,n),Ce!==null&&Ce.f&at)){var d=Ce;(d.effects??(d.effects=[])).push(s)}return s}function za(i){const e=si(Qi,null,!1);return pt(e,Ke),e.teardown=i,e}function sr(i){Ir();var e=be!==null&&(be.f&Tt)!==0&&Le!==null&&!Le.m;if(e){var t=Le;(t.e??(t.e=[])).push({fn:i,effect:be,reaction:Ce})}else{var a=li(i);return a}}function Ds(i){return Ir(),yi(i)}function Es(i){const e=si(hi,i,!0);return(t={})=>new Promise(a=>{t.outro?Nt(e,()=>{Pt(e),a(void 0)}):(Pt(e),a(void 0))})}function li(i){return si(Rr,i,!1)}function yi(i){return si(Qi,i,!0)}function M(i,e=[],t=Ht){const a=e.map(t);return ia(()=>i(...a.map(u)))}function ia(i,e=0){return si(Qi|Xi|e,i,!0)}function $t(i,e=!0){return si(Qi|Tt,i,!0,e)}function en(i){var e=i.teardown;if(e!==null){const t=Wa,a=Ce;or(!0),rt(null);try{e.call(null)}finally{or(t),rt(a)}}}function tn(i,e=!1){var t=i.first;for(i.first=i.last=null;t!==null;){var a=t.next;Pt(t,e),t=a}}function As(i){for(var e=i.first;e!==null;){var t=e.next;e.f&Tt||Pt(e),e=t}}function Pt(i,e=!0){var t=!1;if((e||i.f&Wn)&&i.nodes_start!==null){for(var a=i.nodes_start,r=i.nodes_end;a!==null;){var n=a===r?null:ta(a);a.remove(),a=n}t=!0}tn(i,e&&!t),Zi(i,0),pt(i,Ji);var s=i.transitions;if(s!==null)for(const v of s)v.stop();en(i);var l=i.parent;l!==null&&l.first!==null&&an(i),i.next=i.prev=i.teardown=i.ctx=i.deps=i.fn=i.nodes_start=i.nodes_end=null}function an(i){var e=i.parent,t=i.prev,a=i.next;t!==null&&(t.next=a),a!==null&&(a.prev=t),e!==null&&(e.first===i&&(e.first=a),e.last===i&&(e.last=t))}function Nt(i,e){var t=[];Ya(i,t,!0),rn(t,()=>{Pt(i),e&&e()})}function rn(i,e){var t=i.length;if(t>0){var a=()=>--t||e();for(var r of i)r.out(a)}else e()}function Ya(i,e,t){if(!(i.f&St)){if(i.f^=St,i.transitions!==null)for(const s of i.transitions)(s.is_global||t)&&e.push(s);for(var a=i.first;a!==null;){var r=a.next,n=(a.f&Ii)!==0||(a.f&Tt)!==0;Ya(a,e,n?t:!1),a=r}}}function ti(i){nn(i,!0)}function nn(i,e){if(i.f&St){i.f^=St,i.f&Ke||(i.f^=Ke),_i(i)&&(pt(i,kt),ra(i));for(var t=i.first;t!==null;){var a=t.next,r=(t.f&Ii)!==0||(t.f&Tt)!==0;nn(t,r?e:!1),t=a}if(i.transitions!==null)for(const n of i.transitions)(n.is_global||e)&&n.in()}}let ji=!1,Ta=[];function sn(){ji=!1;const i=Ta.slice();Ta=[],wa(i)}function jt(i){ji||(ji=!0,queueMicrotask(sn)),Ta.push(i)}function xs(){ji&&sn()}const ln=0,Ps=1;let Bi=!1,qi=ln,vi=!1,fi=null,Jt=!1,Wa=!1;function lr(i){Jt=i}function or(i){Wa=i}let Ot=[],It=0;let Ce=null,vt=!1;function rt(i){Ce=i}let be=null;function nt(i){be=i}let ft=null;function Ms(i){ft=i}let We=null,Je=0,yt=null;function Fs(i){yt=i}let on=1,Ui=0,At=!1,Et=null;function cn(){return++on}function _i(i){var p;var e=i.f;if(e&kt)return!0;if(e&ri){var t=i.deps,a=(e&it)!==0;if(t!==null){var r,n,s=(e&Li)!==0,l=a&&be!==null&&!At,v=t.length;if(s||l){var d=i,f=d.parent;for(r=0;r<v;r++)n=t[r],(s||!((p=n==null?void 0:n.reactions)!=null&&p.includes(d)))&&(n.reactions??(n.reactions=[])).push(d);s&&(d.f^=Li),l&&f!==null&&!(f.f&it)&&(d.f^=it)}for(r=0;r<v;r++)if(n=t[r],_i(n)&&Jr(n),n.wv>i.wv)return!0}(!a||be!==null&&!At)&&pt(i,Ke)}return!1}function Bs(i,e){for(var t=e;t!==null;){if(t.f&Ri)try{t.fn(i);return}catch{t.f^=Ri}t=t.parent}throw Bi=!1,i}function qs(i){return(i.f&Ji)===0&&(i.parent===null||(i.parent.f&Ri)===0)}function aa(i,e,t,a){if(Bi){if(t===null&&(Bi=!1),qs(e))throw i;return}t!==null&&(Bi=!0);{Bs(i,e);return}}function dn(i,e,t=!0){var a=i.reactions;if(a!==null)for(var r=0;r<a.length;r++){var n=a[r];n.f&at?dn(n,e,!1):e===n&&(t?pt(n,kt):n.f&Ke&&pt(n,ri),ra(n))}}function un(i){var c;var e=We,t=Je,a=yt,r=Ce,n=At,s=ft,l=Le,v=vt,d=i.f;We=null,Je=0,yt=null,Ce=d&(Tt|hi)?null:i,At=(d&it)!==0&&(!Jt||r===null||v),ft=null,Hi(i.ctx),vt=!1,Ui++;try{var f=(0,i.fn)(),p=i.deps;if(We!==null){var g;if(Zi(i,Je),p!==null&&Je>0)for(p.length=Je+We.length,g=0;g<We.length;g++)p[Je+g]=We[g];else i.deps=p=We;if(!At)for(g=Je;g<p.length;g++)((c=p[g]).reactions??(c.reactions=[])).push(i)}else p!==null&&Je<p.length&&(Zi(i,Je),p.length=Je);if(ni()&&yt!==null&&!vt&&p!==null&&!(i.f&(at|ri|kt)))for(g=0;g<yt.length;g++)dn(yt[g],i);return r!==null&&Ui++,f}finally{We=e,Je=t,yt=a,Ce=r,At=n,ft=s,Hi(l),vt=v}}function Os(i,e){let t=e.reactions;if(t!==null){var a=Un.call(t,i);if(a!==-1){var r=t.length-1;r===0?t=e.reactions=null:(t[a]=t[r],t.pop())}}t===null&&e.f&at&&(We===null||!We.includes(e))&&(pt(e,ri),e.f&(it|Li)||(e.f^=Li),Xr(e),Zi(e,0))}function Zi(i,e){var t=i.deps;if(t!==null)for(var a=e;a<t.length;a++)Os(i,t[a])}function Ka(i){var e=i.f;if(!(e&Ji)){pt(i,Ke);var t=be,a=Le;be=i;try{e&Xi?As(i):tn(i),en(i);var r=un(i);i.teardown=typeof r=="function"?r:null,i.wv=on;var n=i.deps,s;ba&&ss&&i.f&kt}catch(l){aa(l,i,t,a||i.ctx)}finally{be=t}}}function vn(){if(It>1e3){It=0;try{es()}catch(i){if(fi!==null)aa(i,fi,null);else throw i}}It++}function fn(i){var e=i.length;if(e!==0){vn();var t=Jt;Jt=!0;try{for(var a=0;a<e;a++){var r=i[a];r.f&Ke||(r.f^=Ke);var n=Ls(r);Ns(n)}}finally{Jt=t}}}function Ns(i){var e=i.length;if(e!==0)for(var t=0;t<e;t++){var a=i[t];if(!(a.f&(Ji|St)))try{_i(a)&&(Ka(a),a.deps===null&&a.first===null&&a.nodes_start===null&&(a.teardown===null?an(a):a.fn=null))}catch(r){aa(r,a,null,a.ctx)}}}function Rs(){if(vi=!1,It>1001)return;const i=Ot;Ot=[],fn(i),vi||(It=0,fi=null)}function ra(i){qi===ln&&(vi||(vi=!0,queueMicrotask(Rs))),fi=i;for(var e=i;e.parent!==null;){e=e.parent;var t=e.f;if(t&(hi|Tt)){if(!(t&Ke))return;e.f^=Ke}}Ot.push(e)}function Ls(i){var e=[],t=i.first;e:for(;t!==null;){var a=t.f,r=(a&Tt)!==0,n=r&&(a&Ke)!==0,s=t.next;if(!n&&!(a&St)){if(a&Rr)e.push(t);else if(r)t.f^=Ke;else{var l=Ce;try{Ce=t,_i(t)&&Ka(t)}catch(f){aa(f,t,null,t.ctx)}finally{Ce=l}}var v=t.first;if(v!==null){t=v;continue}}if(s===null){let f=t.parent;for(;f!==null;){if(i===f)break e;var d=f.next;if(d!==null){t=d;continue e}f=f.parent}}t=s}return e}function Qa(i){var e=qi,t=Ot;try{vn();const r=[];qi=Ps,Ot=r,vi=!1,fn(t);var a=i==null?void 0:i();return xs(),(Ot.length>0||r.length>0)&&Qa(),It=0,fi=null,a}finally{qi=e,Ot=t}}async function Hs(){await Promise.resolve(),Qa()}function u(i){var e=i.f,t=(e&at)!==0;if(Et!==null&&Et.add(i),Ce!==null&&!vt){ft!==null&&ft.includes(i)&&rs();var a=Ce.deps;i.rv<Ui&&(i.rv=Ui,We===null&&a!==null&&a[Je]===i?Je++:We===null?We=[i]:(!At||!We.includes(i))&&We.push(i))}else if(t&&i.deps===null&&i.effects===null){var r=i,n=r.parent;n!==null&&!(n.f&it)&&(r.f^=it)}return t&&(r=i,_i(r)&&Jr(r)),i.v}function $s(i){var e=Et;Et=new Set;var t=Et,a;try{if(ot(i),e!==null)for(a of Et)e.add(a)}finally{Et=e}return t}function Oi(i){var e=$s(()=>ot(i));for(var t of e)if(t.f&Hr)for(const a of t.deps||[])a.f&at||xt(a,a.v);else xt(t,t.v)}function ot(i){var e=vt;try{return vt=!0,i()}finally{vt=e}}const js=-7169;function pt(i,e){i.f=i.f&js|e}function Us(i){if(!(typeof i!="object"||!i||i instanceof EventTarget)){if(bt in i)ka(i);else if(!Array.isArray(i))for(let e in i){const t=i[e];typeof t=="object"&&t&&bt in t&&ka(t)}}}function ka(i,e=new Set){if(typeof i=="object"&&i!==null&&!(i instanceof EventTarget)&&!e.has(i)){e.add(i),i instanceof Date&&i.getTime();for(let a in i)try{ka(i[a],e)}catch{}const t=Ua(i);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const a=Nr(t);for(let r in a){const n=a[r].get;if(n)try{n.call(i)}catch{}}}}}const Zs=["touchstart","touchmove"];function Gs(i){return Zs.includes(i)}let cr=!1;function Vs(){cr||(cr=!0,document.addEventListener("reset",i=>{Promise.resolve().then(()=>{var e;if(!i.defaultPrevented)for(const t of i.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function Xa(i){var e=Ce,t=be;rt(null),nt(null);try{return i()}finally{rt(e),nt(t)}}function na(i,e,t,a=t){i.addEventListener(e,()=>Xa(t));const r=i.__on_r;r?i.__on_r=()=>{r(),a(!0)}:i.__on_r=()=>a(!0),Vs()}const pn=new Set,Ca=new Set;function zs(i,e,t,a={}){function r(n){if(a.capture||oi.call(e,n),!n.cancelBubble)return Xa(()=>t==null?void 0:t.call(this,n))}return i.startsWith("pointer")||i.startsWith("touch")||i==="wheel"?jt(()=>{e.addEventListener(i,r,a)}):e.addEventListener(i,r,a),r}function Oe(i,e,t,a,r){var n={capture:a,passive:r},s=zs(i,e,t,n);(e===document.body||e===window||e===document)&&za(()=>{e.removeEventListener(i,s,n)})}function mi(i){for(var e=0;e<i.length;e++)pn.add(i[e]);for(var t of Ca)t(i)}function oi(i){var T;var e=this,t=e.ownerDocument,a=i.type,r=((T=i.composedPath)==null?void 0:T.call(i))||[],n=r[0]||i.target,s=0,l=i.__root;if(l){var v=r.indexOf(l);if(v!==-1&&(e===document||e===window)){i.__root=e;return}var d=r.indexOf(e);if(d===-1)return;v<=d&&(s=v)}if(n=r[s]||i.target,n!==e){Or(i,"currentTarget",{configurable:!0,get(){return n||t}});var f=Ce,p=be;rt(null),nt(null);try{for(var g,c=[];n!==null;){var h=n.assignedSlot||n.parentNode||n.host||null;try{var S=n["__"+a];if(S!==void 0&&!n.disabled)if($a(S)){var[y,...m]=S;y.apply(n,[i,...m])}else S.call(n,i)}catch(C){g?c.push(C):g=C}if(i.cancelBubble||h===e||h===null)break;n=h}if(g){for(let C of c)queueMicrotask(()=>{throw C});throw g}}finally{i.__root=e,delete i.currentTarget,rt(f),nt(p)}}}function Ys(i){var e=document.createElement("template");return e.innerHTML=i,e.content}function Gi(i,e){var t=be;t.nodes_start===null&&(t.nodes_start=i,t.nodes_end=e)}function D(i,e){var t=(e&_s)!==0,a=(e&ms)!==0,r,n=!i.startsWith("<!>");return()=>{r===void 0&&(r=Ys(n?i:"<!>"+i),t||(r=$i(r)));var s=a||Wr?document.importNode(r,!0):r.cloneNode(!0);if(t){var l=$i(s),v=s.lastChild;Gi(l,v)}else Gi(s,s);return s}}function qt(i=""){{var e=ea(i+"");return Gi(e,e),e}}function Pe(){var i=document.createDocumentFragment(),e=document.createComment(""),t=ea();return i.append(e,t),Gi(e,t),i}function w(i,e){i!==null&&i.before(e)}let Da=!0;function P(i,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(i.__t??(i.__t=i.nodeValue))&&(i.__t=t,i.nodeValue=t+"")}function Ws(i,e){return Ks(i,e)}const Gt=new Map;function Ks(i,{target:e,anchor:t,props:a={},events:r,context:n,intro:s=!0}){bs();var l=new Set,v=p=>{for(var g=0;g<p.length;g++){var c=p[g];if(!l.has(c)){l.add(c);var h=Gs(c);e.addEventListener(c,oi,{passive:h});var S=Gt.get(c);S===void 0?(document.addEventListener(c,oi,{passive:h}),Gt.set(c,1)):Gt.set(c,S+1)}}};v(ja(pn)),Ca.add(v);var d=void 0,f=Es(()=>{var p=t??e.appendChild(ea());return $t(()=>{if(n){Ze({});var g=Le;g.c=n}r&&(a.$$events=r),Da=s,d=i(p,a)||{},Da=!0,n&&Ge()}),()=>{var h;for(var g of l){e.removeEventListener(g,oi);var c=Gt.get(g);--c===0?(document.removeEventListener(g,oi),Gt.delete(g)):Gt.set(g,c)}Ca.delete(v),p!==t&&((h=p.parentNode)==null||h.removeChild(p))}});return Qs.set(d,f),d}let Qs=new WeakMap;const pa=0,Ai=1,ha=2;function ci(i,e,t,a,r){var n=i,s=ni(),l=Le,v=je,d,f,p,g=(s?Ye:ei)(void 0),c=(s?Ye:ei)(void 0),h=!1;function S(m,T){h=!0,T&&(nt(y),rt(y),Hi(l));try{m===pa&&t&&(d?ti(d):d=$t(()=>t(n))),m===Ai&&a&&(f?ti(f):f=$t(()=>a(n,g))),m!==pa&&d&&Nt(d,()=>d=null),m!==Ai&&f&&Nt(f,()=>f=null),m!==ha&&p&&Nt(p,()=>p=null)}finally{T&&(Hi(null),rt(null),nt(null),Qa())}}var y=ia(()=>{if(v!==(v=e())){if(zn(v)){var m=v;h=!1,m.then(T=>{m===v&&(xt(g,T),S(Ai,!0))},T=>{if(m===v)throw xt(c,T),S(ha,!0),c.v}),jt(()=>{h||S(pa,!0)})}else xt(g,v),S(Ai,!1);return()=>v=je}})}function H(i,e,t=!1){var a=i,r=null,n=null,s=je,l=t?Ii:0,v=!1;const d=(p,g=!0)=>{v=!0,f(g,p)},f=(p,g)=>{s!==(s=p)&&(s?(r?ti(r):g&&(r=$t(()=>g(a))),n&&Nt(n,()=>{n=null})):(n?ti(n):g&&(n=$t(()=>g(a))),r&&Nt(r,()=>{r=null})))};ia(()=>{v=!1,e(d),v||f(null,null)},l)}function de(i,e){return e}function Xs(i,e,t,a){for(var r=[],n=e.length,s=0;s<n;s++)Ya(e[s].e,r,!0);var l=n>0&&r.length===0&&t!==null;if(l){var v=t.parentNode;ws(v),v.append(t),a.clear(),Ct(i,e[0].prev,e[n-1].next)}rn(r,()=>{for(var d=0;d<n;d++){var f=e[d];l||(a.delete(f.k),Ct(i,f.prev,f.next)),Pt(f.e,!l)}})}function ue(i,e,t,a,r,n=null){var s=i,l={flags:e,items:new Map,first:null},v=(e&Zr)!==0;if(v){var d=i;s=d.appendChild(ea())}var f=null,p=!1,g=me(()=>{var c=t();return $a(c)?c:c==null?[]:ja(c)});ia(()=>{var c=u(g),h=c.length;p&&h===0||(p=h===0,Js(c,l,s,r,e,a,t),n!==null&&(h===0?f?ti(f):f=$t(()=>n(s)):f!==null&&Nt(f,()=>{f=null})),u(g))})}function Js(i,e,t,a,r,n,s){var ne,N,E,R;var l=(r&os)!==0,v=(r&(Ga|Va))!==0,d=i.length,f=e.items,p=e.first,g=p,c,h=null,S,y=[],m=[],T,C,L,$;if(l)for($=0;$<d;$+=1)T=i[$],C=n(T,$),L=f.get(C),L!==void 0&&((ne=L.a)==null||ne.measure(),(S??(S=new Set)).add(L));for($=0;$<d;$+=1){if(T=i[$],C=n(T,$),L=f.get(C),L===void 0){var Y=g?g.e.nodes_start:t;h=el(Y,e,h,h===null?e.first:h.next,T,C,$,a,r,s),f.set(C,h),y=[],m=[],g=h.next;continue}if(v&&Is(L,T,$,r),L.e.f&St&&(ti(L.e),l&&((N=L.a)==null||N.unfix(),(S??(S=new Set)).delete(L))),L!==g){if(c!==void 0&&c.has(L)){if(y.length<m.length){var se=m[0],k;h=se.prev;var W=y[0],j=y[y.length-1];for(k=0;k<y.length;k+=1)dr(y[k],se,t);for(k=0;k<m.length;k+=1)c.delete(m[k]);Ct(e,W.prev,j.next),Ct(e,h,W),Ct(e,j,se),g=se,h=j,$-=1,y=[],m=[]}else c.delete(L),dr(L,g,t),Ct(e,L.prev,L.next),Ct(e,L,h===null?e.first:h.next),Ct(e,h,L),h=L;continue}for(y=[],m=[];g!==null&&g.k!==C;)g.e.f&St||(c??(c=new Set)).add(g),m.push(g),g=g.next;if(g===null)continue;L=g}y.push(L),h=L,g=L.next}if(g!==null||c!==void 0){for(var ie=c===void 0?[]:ja(c);g!==null;)g.e.f&St||ie.push(g),g=g.next;var Se=ie.length;if(Se>0){var Fe=r&Zr&&d===0?t:null;if(l){for($=0;$<Se;$+=1)(E=ie[$].a)==null||E.measure();for($=0;$<Se;$+=1)(R=ie[$].a)==null||R.fix()}Xs(e,ie,Fe,f)}}l&&jt(()=>{var J;if(S!==void 0)for(L of S)(J=L.a)==null||J.apply()}),be.first=e.first&&e.first.e,be.last=h&&h.e}function Is(i,e,t,a){a&Ga&&xt(i.v,e),a&Va?xt(i.i,t):i.i=t}function el(i,e,t,a,r,n,s,l,v,d){var f=(v&Ga)!==0,p=(v&cs)===0,g=f?p?ei(r):Ye(r):r,c=v&Va?Ye(s):s,h={i:c,v:g,k:n,a:null,e:null,prev:t,next:a};try{return h.e=$t(()=>l(i,g,c,d),zr),h.e.prev=t&&t.e,h.e.next=a&&a.e,t===null?e.first=h:(t.next=h,t.e.next=h.e),a!==null&&(a.prev=h,a.e.prev=h.e),h}finally{}}function dr(i,e,t){for(var a=i.next?i.next.e.nodes_start:t,r=e?e.e.nodes_start:t,n=i.e.nodes_start;n!==a;){var s=ta(n);r.before(n),n=s}}function Ct(i,e,t){e===null?i.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function hn(i){var e,t,a="";if(typeof i=="string"||typeof i=="number")a+=i;else if(typeof i=="object")if(Array.isArray(i)){var r=i.length;for(e=0;e<r;e++)i[e]&&(t=hn(i[e]))&&(a&&(a+=" "),a+=t)}else for(t in i)i[t]&&(a&&(a+=" "),a+=t);return a}function tl(){for(var i,e,t=0,a="",r=arguments.length;t<r;t++)(i=arguments[t])&&(e=hn(i))&&(a&&(a+=" "),a+=e);return a}function Vt(i){return typeof i=="object"?tl(i):i??""}function wt(i,e,t,a){var r=i.__attributes??(i.__attributes={});r[e]!==(r[e]=t)&&(e==="style"&&"__styles"in i&&(i.__styles={}),e==="loading"&&(i[Qn]=t),t==null?i.removeAttribute(e):typeof t!="string"&&il(i).includes(e)?i[e]=t:i.setAttribute(e,t))}var ur=new Map;function il(i){var e=ur.get(i.nodeName);if(e)return e;ur.set(i.nodeName,e=[]);for(var t,a=i,r=Element.prototype;r!==a;){t=Nr(a);for(var n in t)t[n].set&&e.push(n);a=Ua(a)}return e}function ye(i,e,t){var a=i.__className,r=al(e,t);(a!==r||zr)&&(e==null&&!t?i.removeAttribute("class"):i.className=r,i.__className=r)}function al(i,e){return(i??"")+(e?" "+e:"")}const rl=()=>performance.now(),mt={tick:i=>requestAnimationFrame(i),now:()=>rl(),tasks:new Set};function gn(){const i=mt.now();mt.tasks.forEach(e=>{e.c(i)||(mt.tasks.delete(e),e.f())}),mt.tasks.size!==0&&mt.tick(gn)}function nl(i){let e;return mt.tasks.size===0&&mt.tick(gn),{promise:new Promise(t=>{mt.tasks.add(e={c:i,f:t})}),abort(){mt.tasks.delete(e)}}}function xi(i,e){Xa(()=>{i.dispatchEvent(new CustomEvent(e))})}function sl(i){if(i==="float")return"cssFloat";if(i==="offset")return"cssOffset";if(i.startsWith("--"))return i;const e=i.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function vr(i){const e={},t=i.split(";");for(const a of t){const[r,n]=a.split(":");if(!r||n===void 0)break;const s=sl(r.trim());e[s]=n.trim()}return e}const ll=i=>i;function zt(i,e,t,a){var r=(i&hs)!==0,n=(i&gs)!==0,s=r&&n,l=(i&ys)!==0,v=s?"both":r?"in":"out",d,f=e.inert,p=e.style.overflow,g,c;function h(){var C=Ce,L=be;rt(null),nt(null);try{return d??(d=t()(e,(a==null?void 0:a())??{},{direction:v}))}finally{rt(C),nt(L)}}var S={is_global:l,in(){var C;if(e.inert=f,!r){c==null||c.abort(),(C=c==null?void 0:c.reset)==null||C.call(c);return}n||g==null||g.abort(),xi(e,"introstart"),g=Ea(e,h(),c,1,()=>{xi(e,"introend"),g==null||g.abort(),g=d=void 0,e.style.overflow=p})},out(C){if(!n){C==null||C(),d=void 0;return}e.inert=!0,xi(e,"outrostart"),c=Ea(e,h(),g,0,()=>{xi(e,"outroend"),C==null||C()})},stop:()=>{g==null||g.abort(),c==null||c.abort()}},y=be;if((y.transitions??(y.transitions=[])).push(S),r&&Da){var m=l;if(!m){for(var T=y.parent;T&&T.f&Ii;)for(;(T=T.parent)&&!(T.f&Xi););m=!T||(T.f&Lr)!==0}m&&li(()=>{ot(()=>S.in())})}}function Ea(i,e,t,a,r){var n=a===1;if(Vn(e)){var s,l=!1;return jt(()=>{if(!l){var y=e({direction:n?"in":"out"});s=Ea(i,y,t,a,r)}}),{abort:()=>{l=!0,s==null||s.abort()},deactivate:()=>s.deactivate(),reset:()=>s.reset(),t:()=>s.t()}}if(t==null||t.deactivate(),!(e!=null&&e.duration))return r(),{abort:lt,deactivate:lt,reset:lt,t:()=>a};const{delay:v=0,css:d,tick:f,easing:p=ll}=e;var g=[];if(n&&t===void 0&&(f&&f(0,1),d)){var c=vr(d(0,1));g.push(c,c)}var h=()=>1-a,S=i.animate(g,{duration:v});return S.onfinish=()=>{var y=(t==null?void 0:t.t())??1-a;t==null||t.abort();var m=a-y,T=e.duration*Math.abs(m),C=[];if(T>0){var L=!1;if(d)for(var $=Math.ceil(T/16.666666666666668),Y=0;Y<=$;Y+=1){var se=y+m*p(Y/$),k=vr(d(se,1-se));C.push(k),L||(L=k.overflow==="hidden")}L&&(i.style.overflow="hidden"),h=()=>{var W=S.currentTime;return y+m*p(W/T)},f&&nl(()=>{if(S.playState!=="running")return!1;var W=h();return f(W,1-W),!0})}S=i.animate(C,{duration:T,fill:"forwards"}),S.onfinish=()=>{h=()=>a,f==null||f(a,1-a),r()}},{abort:()=>{S&&(S.cancel(),S.effect=null,S.onfinish=lt)},deactivate:()=>{r=lt},reset:()=>{a===0&&(f==null||f(1,0))},t:()=>h()}}function Aa(i,e,t=e){var a=ni();na(i,"input",r=>{var n=r?i.defaultValue:i.value;if(n=ya(i)?_a(n):n,t(n),a&&n!==(n=e())){var s=i.selectionStart,l=i.selectionEnd;i.value=n??"",l!==null&&(i.selectionStart=s,i.selectionEnd=Math.min(l,i.value.length))}}),ot(e)==null&&i.value&&t(ya(i)?_a(i.value):i.value),yi(()=>{var r=e();ya(i)&&r===_a(i.value)||i.type==="date"&&!r&&!i.value||r!==i.value&&(i.value=r??"")})}const ga=new Set;function Yt(i,e,t,a,r=a){var n=t.getAttribute("type")==="checkbox",s=i;if(e!==null)for(var l of e)s=s[l]??(s[l]=[]);s.push(t),na(t,"change",()=>{var v=t.__value;n&&(v=cl(s,v,t.checked)),r(v)},()=>r(n?[]:null)),yi(()=>{var v=a();n?(v=v||[],t.checked=v.includes(t.__value)):t.checked=Yr(t.__value,v)}),za(()=>{var v=s.indexOf(t);v!==-1&&s.splice(v,1)}),ga.has(s)||(ga.add(s),jt(()=>{s.sort((v,d)=>v.compareDocumentPosition(d)===4?-1:1),ga.delete(s)})),jt(()=>{})}function ol(i,e,t=e){na(i,"change",a=>{var r=a?i.defaultChecked:i.checked;t(r)}),ot(e)==null&&t(i.checked),yi(()=>{var a=e();i.checked=!!a})}function cl(i,e,t){for(var a=new Set,r=0;r<i.length;r+=1)i[r].checked&&a.add(i[r].__value);return t||a.delete(e),Array.from(a)}function ya(i){var e=i.type;return e==="number"||e==="range"}function _a(i){return i===""?null:+i}function yn(i,e,t){if(i.multiple)return ul(i,e);for(var a of i.options){var r=di(a);if(Yr(r,e)){a.selected=!0;return}}(!t||e!==void 0)&&(i.selectedIndex=-1)}function dl(i,e){li(()=>{var t=new MutationObserver(()=>{var a=i.__value;yn(i,a)});return t.observe(i,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{t.disconnect()}})}function Ni(i,e,t=e){var a=!0;na(i,"change",r=>{var n=r?"[selected]":":checked",s;if(i.multiple)s=[].map.call(i.querySelectorAll(n),di);else{var l=i.querySelector(n)??i.querySelector("option:not([disabled])");s=l&&di(l)}t(s)}),li(()=>{var r=e();if(yn(i,r,a),a&&r===void 0){var n=i.querySelector(":checked");n!==null&&(r=di(n),t(r))}i.__value=r,a=!1}),dl(i)}function ul(i,e){for(var t of i.options)t.selected=~e.indexOf(di(t))}function di(i){return"__value"in i?i.__value:i.value}function fr(i,e){return i===e||(i==null?void 0:i[bt])===e}function vl(i={},e,t,a){return li(()=>{var r,n;return yi(()=>{r=n,n=[],ot(()=>{i!==t(...n)&&(e(i,...n),r&&fr(t(...r),i)&&e(null,...r))})}),()=>{jt(()=>{n&&fr(t(...n),i)&&e(null,...n)})}}),i}function Ie(i=!1){const e=Le,t=e.l.u;if(!t)return;let a=()=>Us(e.s);if(i){let r=0,n={};const s=Ht(()=>{let l=!1;const v=e.s;for(const d in v)v[d]!==n[d]&&(n[d]=v[d],l=!0);return l&&r++,r});a=()=>u(s)}t.b.length&&Ds(()=>{pr(e,a),wa(t.b)}),sr(()=>{const r=ot(()=>t.m.map(Yn));return()=>{for(const n of r)typeof n=="function"&&n()}}),t.a.length&&sr(()=>{pr(e,a),wa(t.a)})}function pr(i,e){if(i.l.s)for(const t of i.l.s)u(t);e()}function _n(i,e,t){if(i==null)return e(void 0),lt;const a=ot(()=>i.subscribe(e,t));return a.unsubscribe?()=>a.unsubscribe():a}const Wt=[];function fl(i,e=lt){let t=null;const a=new Set;function r(l){if(Ur(i,l)&&(i=l,t)){const v=!Wt.length;for(const d of a)d[1](),Wt.push(d,i);if(v){for(let d=0;d<Wt.length;d+=2)Wt[d][0](Wt[d+1]);Wt.length=0}}}function n(l){r(l(i))}function s(l,v=lt){const d=[l,v];return a.add(d),a.size===1&&(t=e(r,n)||lt),l(i),()=>{a.delete(d),a.size===0&&t&&(t(),t=null)}}return{set:r,update:n,subscribe:s}}function pl(i){let e;return _n(i,t=>e=t)(),e}let Pi=!1,xa=Symbol();function hl(i,e,t){const a=t[e]??(t[e]={store:null,source:ei(void 0),unsubscribe:lt});if(a.store!==i&&!(xa in t))if(a.unsubscribe(),a.store=i??null,i==null)a.source.v=void 0,a.unsubscribe=lt;else{var r=!0;a.unsubscribe=_n(i,n=>{r?a.source.v=n:ae(a.source,n)}),r=!1}return i&&xa in t?pl(i):u(a.source)}function gl(){const i={};function e(){za(()=>{for(var t in i)i[t].unsubscribe();Or(i,xa,{enumerable:!1,value:!0})})}return[i,e]}function yl(i){var e=Pi;try{return Pi=!1,[i(),Pi]}finally{Pi=e}}function Te(i,e,t,a){var se;var r=(t&ds)!==0,n=!gi||(t&us)!==0,s=(t&fs)!==0,l=(t&ps)!==0,v=!1,d;s?[d,v]=yl(()=>i[e]):d=i[e];var f=bt in i||Kn in i,p=s&&(((se=Xt(i,e))==null?void 0:se.set)??(f&&e in i&&(k=>i[e]=k)))||void 0,g=a,c=!0,h=!1,S=()=>(h=!0,c&&(c=!1,l?g=ot(a):g=a),g);d===void 0&&a!==void 0&&(p&&n&&ts(),d=S(),p&&p(d));var y;if(n)y=()=>{var k=i[e];return k===void 0?S():(c=!0,h=!1,k)};else{var m=(r?Ht:me)(()=>i[e]);m.f|=Hr,y=()=>{var k=u(m);return k!==void 0&&(g=void 0),k===void 0?g:k}}if(!(t&vs))return y;if(p){var T=i.$$legacy;return function(k,W){return arguments.length>0?((!n||!W||T||v)&&p(W?y():k),k):y()}}var C=!1,L=!1,$=ei(d),Y=Ht(()=>{var k=y(),W=u($);return C?(C=!1,L=!0,W):(L=!1,$.v=k)});return r||(Y.equals=Za),function(k,W){if(Et!==null&&(C=L,y(),u($)),arguments.length>0){const j=W?u(Y):n&&s?Dt(k):k;return Y.equals(j)||(C=!0,ae($,j),h&&g!==void 0&&(g=j),ot(()=>u(Y))),k}return u(Y)}}const _l="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(_l);ls();class ml{constructor(e,t,a){o(this,"_dbname");o(this,"_dbversion");o(this,"dbPromise");o(this,"getTran",async(e,t)=>(await this.dbPromise).transaction(e,t));o(this,"reset",async()=>(await indexedDB.databases().then(e=>{console.log(e)}),await new Promise((e,t)=>{const a=indexedDB.deleteDatabase(this._dbname);a.onsuccess=()=>{console.log("onsuccess"),e()},a.onerror=r=>{console.log("onerror"),t(r)}})));o(this,"getAll",async e=>{const t=await this.dbPromise;return new Promise((a,r)=>{const l=t.transaction([e],"readonly").objectStore(e).getAll();l.onsuccess=()=>{a(l.result)},l.onerror=v=>{r(v)}})});o(this,"get",async(e,t)=>{const a=await this.dbPromise;return new Promise((r,n)=>{const v=a.transaction([e],"readonly").objectStore(e).get(t);v.onsuccess=()=>{r(v.result)},v.onerror=d=>{n(d)}})});o(this,"getMany",async(e,t)=>{const n=(await this.dbPromise).transaction([e],"readonly").objectStore(e),s=t.map(l=>new Promise((v,d)=>{const f=n.get(l);f.onsuccess=()=>{v(f.result)},f.onerror=p=>{d(p)}}));return await Promise.all(s)});o(this,"putRecords",async(e,t)=>{const r=(await this.dbPromise).transaction([e],"readwrite"),n=r.objectStore(e),s=t.map(l=>({record:l,request:n.put(l)}));return new Promise((l,v)=>{r.oncomplete=()=>l(s.map(d=>Object.assign({id:d.request.result},d.record))),r.onerror=d=>v(d)})});o(this,"deleteRecords",async(e,t)=>{const r=(await this.dbPromise).transaction([e],"readwrite"),n=r.objectStore(e),s=t.map(l=>({key:l,request:n.delete(l)}));return new Promise((l,v)=>{r.oncomplete=()=>{console.log(s.map(d=>d.request.result)),l()},r.onerror=d=>v(d)})});this._dbname=e,this._dbversion=t,this.dbPromise=new Promise((r,n)=>{const s=indexedDB.open(e,t);s.onsuccess=l=>{if(console.log(l),!l.target){console.log("event.target is undefined"),n("event.target is undefined");return}const v=l.target.result;if(!v){console.log("event.target.result is undefined"),n("event.target.result is undefined");return}v.onversionchange=d=>{console.log(d),v.close()},r(v)},s.onupgradeneeded=l=>{console.log("onupgradeneeded");const v=l.target.result;a.filter(d=>!v.objectStoreNames.contains(d)).map(d=>v.createObjectStore(d,{keyPath:"id",autoIncrement:!0}))},s.onerror=l=>{console.log(l),n(l)},s.onblocked=l=>{console.log(l),n(l)}}),console.log(this.dbPromise)}get dbversion(){return this._dbversion}}class Qe{constructor(){o(this,"handlers",[])}append(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}trigger(e){this.handlers.slice(0).forEach(t=>t(e))}clear(){this.handlers.splice(0)}expose(){return this}}class hr{constructor(){o(this,"handler")}set(e){this.handler=e}async call(e){if(!this.handler)throw Error("illegal state error");return await this.handler(e)}expose(){return this}}class Ja{constructor(e,t,a,r){o(this,"_name");o(this,"_createVersion");o(this,"mountResolver",()=>{});o(this,"_indexedDb");o(this,"onInsertEvent",new Qe);o(this,"onBeforeInsertEvent",new hr);o(this,"onUpdateEvent",new Qe);o(this,"onBeforeUpdateEvent",new hr);o(this,"onDeleteEvent",new Qe);o(this,"prepareInitialRecords",()=>{const e=new Date;return this._prepareInitialRecords().map(t=>Object.assign(t,{createdAt:e,updatedAt:e,dbVersion:this._createVersion}))});o(this,"resolveMount",()=>this.mountResolver());o(this,"patchForInsert",(e,t)=>{e.newRecords.forEach(a=>{console.log(a),t[a.id]=a})});o(this,"patchForUpdate",(e,t)=>{e.recordPairs.forEach(a=>{console.log(t[a.newRecord.id],a.newRecord),t[a.newRecord.id]={...a.newRecord}})});o(this,"patchForDelete",(e,t)=>{e.oldRecords.forEach(a=>{console.log(a),delete t[a.id]})});this._indexedDb=e,this._name=t,this._createVersion=e.dbversion,this.getAll().then(n=>n.reduce((s,l)=>(s[l.id]=l,s),{})).then(n=>{console.log(this.name,n),this.onBeforeInsertEvent.set(a??(()=>Promise.resolve())),this.onBeforeUpdateEvent.set(r??(()=>Promise.resolve()))})}get name(){return this._name}get createVersion(){return this._createVersion}get oninsert(){return this.onInsertEvent.expose()}get onbeforeinsert(){return this.onBeforeInsertEvent.expose()}get onupdate(){return this.onUpdateEvent.expose()}get onbeforeupdate(){return this.onBeforeUpdateEvent.expose()}get ondelete(){return this.onDeleteEvent.expose()}getAll(){return this._indexedDb.getAll(this.name)}get(e){return this._indexedDb.get(this.name,e)}async insertMany(e){const t=new Date,a=e.map(n=>{const s={createdAt:t,updatedAt:t,dbVersion:this._createVersion};return Object.assign(n,s)});await this.onBeforeInsertEvent.call({sender:this,newRecords:a,timestamp:t});const r=await this._indexedDb.putRecords(this.name,a);return this.onInsertEvent.trigger({sender:this,newRecords:r,timestamp:t}),r}async insert(e){return(await this.insertMany([e]))[0]}async updateMany(e,t){const a=new Date,r=[];return(await this._indexedDb.getMany(this.name,e)).forEach(s=>{const l={...s},v={...l};r.push({newRecord:Object.assign(t(v),{updatedAt:a,dbVersion:this._createVersion}),oldRecord:l})}),await this.onBeforeUpdateEvent.call({sender:this,recordPairs:r,timestamp:a}),await this._indexedDb.putRecords(this.name,r.map(s=>s.newRecord)),this.onUpdateEvent.trigger({sender:this,recordPairs:r,timestamp:a}),r.map(s=>s.newRecord)}async update(e,t){return(await this.updateMany([e],t))[0]}async delete(e){const t=new Date,a=await this._indexedDb.getMany(this.name,e);await this._indexedDb.deleteRecords(this.name,e),this.onDeleteEvent.trigger({sender:this,oldRecords:a,timestamp:t})}}const tt=class tt{constructor(e){o(this,"id");o(this,"name");o(this,"description");o(this,"save",async e=>{const t=e??{id:this.id,name:this.name,description:this.description},a=await tt.tblHeader.update(this.id,r=>({...r,...t}));return new tt(a)});this.id=e.id,this.name=e.name,this.description=e.description}get npcLvl(){return Number.MAX_VALUE}};o(tt,"tblHeader"),o(tt,"getOrCreateNew",async e=>{tt.tblHeader||(tt.tblHeader=new Sl(e));const t=await tt.tblHeader.getAll();if(t.length)return new tt(t[0]);const a=await tt.tblHeader.insert({name:"あなた",description:"ここの文字列を何に使うかは未定。"});return new tt(a)});let Pa=tt;class Sl extends Ja{constructor(t){super(t,"TblDuelistProfile");o(this,"_prepareInitialRecords",()=>[])}}let ma=-1;const Mi=[{id:ma--,name:"サンドバッグくん棒立ち",description:"攻撃宣言なし、強制効果以外の効果の発動なし。",npcLvl:0},{id:ma--,name:"サンドバッグくん非暴力",description:"攻撃宣言なし。",npcLvl:100},{id:ma--,name:"サンドバッグくん白帯",description:"とくに制限なし。",npcLvl:200}],bl=["Deck","ExtraDeck"],wl={Deck:"メインデッキ",ExtraDeck:"エクストラデッキ"},Ma=["Monster","Spell","Trap"],mn={Monster:"モンスター",Spell:"魔法",Trap:"罠"},ii=["Fusion","Syncro","Xyz","Link"],Sn=[...ii,"SpecialSummon"],Tl=["Toon","Spirit","Union","Gemini","FlipEffect"],kl=["Tuner","Effect","Normal","Pendulum","Token","NormalSummonOnly"],gr=[...Sn,...Tl,...kl],sa={Syncro:"シンクロ",Fusion:"融合",Xyz:"エクシーズ",Link:"リンク",SpecialSummon:"特殊召喚",Toon:"トゥーン",Spirit:"スピリット",Union:"ユニオン",Gemini:"デュアル",FlipEffect:"リバース",Tuner:"チューナー",Effect:"効果",Normal:"通常",Pendulum:"ペンデュラム",Token:"トークン",NormalSummonOnly:"特殊召喚不可"},Si={Syncro:"🎵",Fusion:"🌀",Xyz:"📰",Link:"⛓️",SpecialSummon:"🔯",Toon:"📖",Spirit:"👻",Union:"🚗",Gemini:"👫",FlipEffect:"🔄",Tuner:"🎶",Effect:"✨",Normal:"🔘",Pendulum:"💠",Token:"🐏",NormalSummonOnly:"🔲"},yr=["Light","Dark","Earth","Water","Fire","Wind","Divine"],Ia={Light:"光",Dark:"闇",Earth:"地",Water:"水",Fire:"炎",Wind:"風",Divine:"神"},_r=["Aqua","Beast","BeastWarrior","CreatorGod","Cyberse","Dinosaur","DivineBeast","Dragon","Fairy","Fiend","Fish","Insect","Illusion","Machine","Plant","Psychic","Pyro","Reptile","Rock","SeaSerpent","Spellcaster","Thunder","Warrior","WingedBeast","Wyrm","Zombie"],mr=["Normal","Continuous","Field","QuickPlay","Equip","Ritual"],bi={Normal:"通常",Continuous:"永続",Field:"フィールド",QuickPlay:"速攻",Equip:"装備",Ritual:"儀式"},Sr=["Normal","Continuous","Counter"],wi={Normal:"通常",Continuous:"永続",Counter:"カウンター"},Fi={Attack:"攻撃表示",Defense:"守備表示",Set:"裏側守備表示"},bn=["level","rank","attack","defense","pendulumScaleR","pendulumScaleL"],Cl=({wikiName:i,wikiHref:e,wikiTextAll:t,nameKana:a,description:r,pendulumDescription:n,...s})=>s,Dl=i=>Cl(i),la={Aqua:"水",Beast:"獣",BeastWarrior:"獣戦士",CreatorGod:"創造神",Cyberse:"サイバース",Dinosaur:"恐竜",DivineBeast:"幻獣神",Dragon:"ドラゴン",Fairy:"天使",Fiend:"悪魔",Fish:"魚",Insect:"昆虫",Illusion:"幻想魔",Machine:"機械",Plant:"植物",Psychic:"サイキック",Pyro:"炎",Reptile:"爬虫類",Rock:"岩石",SeaSerpent:"海竜",Spellcaster:"魔法使い",Thunder:"雷",Warrior:"戦士",WingedBeast:"鳥獣",Wyrm:"幻竜",Zombie:"アンデット"},Ti={Aqua:"🚰",Beast:"🐅",BeastWarrior:"🦁",CreatorGod:"🔆",Cyberse:"💻️",Dinosaur:"🦖",DivineBeast:"💫",Dragon:"🐲",Fairy:"👼",Fiend:"👿",Fish:"🐟️",Insect:"🦋",Illusion:"🤡",Machine:"🤖",Plant:"🌱",Psychic:"👁️",Pyro:"🔥",Reptile:"🦎",Rock:"⛰",SeaSerpent:"🐍",Spellcaster:"🧙",Thunder:"⚡️",Warrior:"⚔️",WingedBeast:"🦅",Wyrm:"🐉",Zombie:"🦴"},El=i=>i.cardId??!1?`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=2&cid=${i.cardId}`:`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=1&sess=1&rp=10&mode=&sort=1&keyword=${i.name}&stype=1&ctype=&othercon=2&starfr=&starto=&pscalefr=&pscaleto=&linkmarkerfr=&linkmarkerto=&link_m=2&atkfr=&atkto=&deffr=&defto=&releaseDStart=1&releaseMStart=1&releaseYStart=1999&releaseDEnd=&releaseMEnd=&releaseYEnd=`,ui=(i,e)=>{const t=i.monsterCategories??[],a=e.monsterCategories??[];for(const r of ii.toReversed()){if(t.includes(r)&&!a.includes(r))return 1;if(!t.includes(r)&&a.includes(r))return-1}if(i.kind===e.kind){if(i.kind==="Monster"){if((i.link??0)!==(e.link??0))return(i.link??0)-(e.link??0);if((i.rank??0)!==(e.rank??0))return(i.rank??0)-(e.rank??0);if((i.level??0)!==(e.level??0))return(i.level??0)-(e.level??0);if((i.attack??0)!==(e.attack??0))return(i.attack??0)-(e.attack??0);if((i.defense??0)!==(e.defense??0))return(i.defense??0)-(e.defense??0)}return i.name.localeCompare(e.name,"Ja")}for(const r of Ma){if(i.kind===r)return-1;if(e.kind===r)return 1}return i.name.localeCompare(e.name,"Ja")},wn=["Deck","ExtraDeck"],Al=[...wn,"Graveyard","Banished"],Vi=["MonsterZone","ExtraMonsterZone"],Ut=["SpellAndTrapZone","FieldSpellZone"],ki=[...Vi,...Ut],Fa={0:{0:"Hand"},1:{0:"Deck",1:"SpellAndTrapZone",2:"SpellAndTrapZone",3:"SpellAndTrapZone",4:"SpellAndTrapZone",5:"SpellAndTrapZone",6:"ExtraDeck"},2:{0:"Graveyard",1:"MonsterZone",2:"MonsterZone",3:"MonsterZone",4:"MonsterZone",5:"MonsterZone",6:"FieldSpellZone"},3:{0:"Banished",1:"Disable",2:"ExtraMonsterZone",3:"Disable",4:"ExtraMonsterZone",5:"Disable",6:"Banished"},4:{0:"FieldSpellZone",1:"MonsterZone",2:"MonsterZone",3:"MonsterZone",4:"MonsterZone",5:"MonsterZone",6:"Graveyard"},5:{0:"ExtraDeck",1:"SpellAndTrapZone",2:"SpellAndTrapZone",3:"SpellAndTrapZone",4:"SpellAndTrapZone",5:"SpellAndTrapZone",6:"Deck"},6:{0:"Hand"}};class xl{constructor(e,t,a,r){o(this,"onUpdateEvent",new Qe);o(this,"field");o(this,"row");o(this,"column");o(this,"cellType");o(this,"owner");o(this,"_needsShuffle",!1);o(this,"_entities");o(this,"releaseEntities",e=>(this._entities=this._entities.filter(t=>!e.includes(t)),this.onUpdateEvent.trigger(),e));o(this,"acceptEntities",(e,t)=>{t==="Top"?this._entities.unshift(...e):this._entities.push(...e),t==="Random"&&(this._needsShuffle=!0),this._entities.forEach(a=>{a.fieldCell=this}),this.onUpdateEvent.trigger()});o(this,"shuffle",()=>{this._entities=this.entities.shuffle(),this._needsShuffle=!1,this.field.duel.log.info("デッキをシャッフル。",this.owner)});this.field=e,this.row=t,this.column=a,this.cellType=Fa[t][a],this.owner=r,this._entities=[]}get onUpdate(){return this.onUpdateEvent.expose()}get needsShuffle(){return this._needsShuffle}get entities(){return this._entities}get cardEntities(){return this._entities.filter(e=>fo.find(t=>t===e.entityType))}get targetForAttack(){return this.cellType==="Hand"?this._entities.find(e=>e.entityType==="Duelist"):this.cardEntities[0]}get isAvailable(){return this._entities.length===0}get isStackCell(){return Al.some(e=>e===this.cellType)}get isPlayFieldCell(){return ki.some(e=>e===this.cellType)}}Array.prototype.shuffle=function(){return this.map(e=>({item:e,seq:Math.random()})).toSorted((e,t)=>e.seq-t.seq).map(e=>e.item)};Array.prototype.randomPickMany=function(i){return this.shuffle().slice(0,i)};Array.prototype.randomPick=function(){return this.shuffle().slice(0,1)[0]};Array.prototype.reset=function(...i){this.splice(0),this.push(...i)};Array.prototype.union=function(i){return this.filter(e=>i.find(t=>e===t))};Array.prototype.getAllOnOffPattern=function(){const i=[];return this.forEach(e=>{if(i.length==0){i.push([e]),i.push([]);return}i.forEach(t=>i.push([...t,e]))}),i};Array.prototype.getDistinct=function(){return Array.from(new Set(this))};const Pl=["NormalSummon","SpecialSummon","ChangeBattlePosition","Battle","SpellTrapSet"],br=["NormalSummon","AdvanceSummon","SpecialSummon","SpecialSummonFromDeck","SendToGraveyardFromDeck","Draw","SearchFromDeck","BanishFromGraveyard","AddToHandFromGraveyard","ReturnToDeckFromGraveyard","SpecialSummonFromGraveyard","Destroy","DestroyMultiple","DestroyOnField","DestroyMultipleOnField","DestroyOnOpponentField","DestroyMultipleOnOpponentField","DestroyMonsterOnField","DestroyMonstersOnField","DestroySpellTrapOnField","DestroySpellTrapsOnField","IfNormarlSummonSucceed","IfSpecialSummonSucceed","DamageToOpponent","DamageToSelf","PayLifePoint","DiscordAsCost","DiscordAsEffect","RollDice","BounceToHand","NegateCardEffect","NegateCardActivation"],Ft=i=>i.playType==="CardActivation"?i.entity.nm:`${i.entity.nm}«${i.title}»`,gt=class gt{constructor(e,t,a){o(this,"seq");o(this,"entity");o(this,"cardActionBase");o(this,"getClone",()=>new gt(this.seq,this.entity,this.cardActionBase));o(this,"validate",(e,t)=>{if(this.playType==="CardActivation"&&this.entity.isOnField&&this.entity.face==="FaceUp"||this.isOnlyNTimesPerDuel>0&&this.entity.field.duel.cardActionLog.records.filter(r=>this.isSame(r.cardAction)).filter(r=>r.activator).length>=this.isOnlyNTimesPerDuel||this.isOnlyNTimesPerTurn>0&&this.entity.field.duel.cardActionLog.records.filter(r=>this.isSameGroupPerTurn(r.cardAction)).filter(r=>r.clock.turn===this.entity.field.duel.clock.turn).filter(r=>r.activator).length>=this.isOnlyNTimesPerTurn)return;const a={action:this,activator:e,isActivatedIn:this.entity.fieldCell};return this.cardActionBase.validate(a,t)});o(this,"prepare",async(e,t,a,r)=>{this.isLikeContinuousSpell&&(this.entity.info.isPending=!0);const n=this.entity.fieldCell,s={action:this,activator:e,isActivatedIn:n},l=await this.cardActionBase.prepare(s,t,a,r);if(l!==void 0)return this.entity.field.duel.cardActionLog.push(this.entity.controller,this),{...s,...l}});o(this,"execute",async(e,t)=>{if(e.action.isLikeContinuousSpell&&!e.action.entity.isOnField)return this.entity.info.isPending=!1,!1;const a=await this.cardActionBase.execute(e,t);if(e.action.isLikeContinuousSpell)for(const r of this.entity.continuousEffects)this.entity.info.isPending=!1,await r.updateState();return a});o(this,"settle",(e,t)=>this.cardActionBase.settle(e,t));o(this,"isSame",e=>this.entity.origin.name===e.entity.origin.name&&this.title===e.title);o(this,"isSameGroupPerTurn",e=>this.actionGroupNamePerTurn?this.entity.origin.name===e.entity.origin.name&&this.actionGroupNamePerTurn===e.actionGroupNamePerTurn:this.isSame(e));o(this,"calcChainBlockTagsForDestroy",e=>{if(!br.length)return[];const t=["Destroy"];br.length>1&&t.push("DestroyMultiple");const a=e.filter(l=>l.isOnField);a.length&&(t.push("DestroyOnField"),a.length>1&&t.push("DestroyMultipleOnField"));const r=a.filter(l=>l.status.kind==="Monster");r.length&&(t.push("DestroyMonsterOnField"),r.length>1&&t.push("DestroyMonstersOnField")),a.filter(l=>l.status.kind!=="Monster").length&&(t.push("DestroySpellTrapOnField"),r.length>1&&t.push("DestroySpellTrapsOnField"));const s=a.filter(l=>l.controller!==this.entity.controller);return s.length&&(t.push("DestroyOnOpponentField"),s.length>1&&t.push("DestroyMultipleOnOpponentField")),t});this.seq=e,this.entity=t,this.cardActionBase=a}get title(){return this.cardActionBase.title}get playType(){return this.cardActionBase.playType}get spellSpeed(){return this.cardActionBase.spellSpeed}get hasToTargetCards(){return this.cardActionBase.hasToTargetCards??!1}get executableCells(){return this.cardActionBase.executableCells}get executablePeriods(){return this.cardActionBase.executablePeriods}get executableDuelistTypes(){return this.cardActionBase.executableDuelistTypes}get executableDuelists(){const e=[];return this.cardActionBase.executableDuelistTypes.includes("Controller")&&e.push(this.entity.controller),this.cardActionBase.executableDuelistTypes.includes("Opponent")&&e.push(this.entity.controller.getOpponentPlayer()),e}get isOnlyNTimesPerDuel(){return this.cardActionBase.isOnlyNTimesPerDuel??0}get isOnlyNTimesPerTurn(){return this.cardActionBase.isOnlyNTimesPerTurn??0}get isLikeContinuousSpell(){return this.cardActionBase.isLikeContinuousSpell||this.entity.isLikeContinuousSpell&&this.playType==="CardActivation"}get actionGroupNamePerTurn(){return this.cardActionBase.actionGroupNamePerTurn}get negatePreviousBlock(){return this.cardActionBase.negatePreviousBlock??!1}get priorityForNPC(){return this.cardActionBase.priorityForNPC??Number.NaN}};o(gt,"nextActionSeq",0),o(gt,"createNew",(e,t)=>new gt(gt.nextActionSeq++,e,t)),o(gt,"createDammyAction",(e,t,a,r)=>({seq:gt.nextActionSeq++,title:t,entity:e,playType:"Dammy",spellSpeed:"Dammy",hasToTargetCards:!1,isOnlyNTimesPerDuel:0,isOnlyNTimesPerTurn:0,isLikeContinuousSpell:!1,getClone:function(){return this},validate:()=>a,prepare:async()=>{},execute:async()=>!1,settle:async()=>!1,pos:r,cell:a[0],dragAndDropOnly:a.length>1}));let Mt=gt;class oa{constructor(){o(this,"pooledOperators",[]);o(this,"bundles",[]);o(this,"excludesExpired",()=>{this.bundles=this.bundles.filter(e=>!e.entity.hasDisappeared),this.bundles.forEach(e=>e.excludesExpired()),this.pooledOperators=this.pooledOperators.filter(e=>e.validateAlive(e.isSpawnedBy))});o(this,"append",e=>{this.bundles.push(e)});o(this,"push",e=>{if(!e.isContinuous)throw new ke("staticへの追加は永続以外不可",e);this.excludesExpired(),this.distribute(e),this.pooledOperators.push(e)});o(this,"distributeAll",e=>(this.excludesExpired(),this.pooledOperators.flatMap(this.distribute),this.afterDistributeAll(e)));o(this,"distribute",e=>this.bundles.filter(t=>t.operators.every(a=>a.seq!==e.seq)).filter(t=>e.isApplicableTo(e.isSpawnedBy,t.entity)).map(t=>(t.push(e),t)));o(this,"removeItem",e=>{this.pooledOperators=this.pooledOperators.filter(t=>t.seq!==e)})}}class ca{constructor(e,t){o(this,"pool");o(this,"entity");o(this,"_operators");o(this,"excludesExpired",()=>{this._operators=this._operators.filter(e=>{const t=e.validateAlive(e.isSpawnedBy)&&e.isApplicableTo(e.isSpawnedBy,this.entity);return t||(console.info(`before remove ${this.entity.toString} ${e.title}`),e.beforeRemove()),t})});o(this,"push",e=>{this.entity.procFilterBundle.operators.filter(t=>t.procTypes.includes("Effect")).some(t=>!t.filter(t.effectOwner,t.isSpawnedBy,t.actionAttr,[]))||(this.beforePush(e),this._operators.push(e))});o(this,"removeItem",e=>{this._operators=this._operators.filter(t=>t.seq!==e?!0:(t.beforeRemove(),!1))});this.pool=e,this.entity=t,this._operators=[],this.pool.append(this)}get operators(){return this._operators}}const Yi=class Yi{constructor(e,t,a,r,n,s){o(this,"seq");o(this,"title");o(this,"validateAlive");o(this,"isContinuous");o(this,"isSpawnedBy");o(this,"activateType");o(this,"actionAttr");o(this,"isApplicableTo");o(this,"effectOwner");this.seq=Yi.nextSeq++,this.title=e,this.validateAlive=t,this.isContinuous=a,this.isSpawnedBy=r,this.isApplicableTo=s,this.actionAttr=n,this.activateType="NonActivate",this.actionAttr.playType&&(this.actionAttr.playType==="CardActivation"?this.activateType="CardActivation":this.activateType="EffectActivation"),this.effectOwner=this.isSpawnedBy.controller}};o(Yi,"nextSeq",0);let ai=Yi;class Ml extends oa{constructor(){super(...arguments);o(this,"afterDistributeAll",()=>this.bundles.every(t=>t.applyEffectFilter()))}}class Fl extends ca{constructor(){super(...arguments);o(this,"applyEffectFilter",()=>{const t=this.entity.allStickyEffectOperators.length,a=[];for(;;){const r=this.operators.filter(n=>n.procTypes.includes("Effect")).filter(n=>n.isContinuous).find(n=>!a.includes(n.seq));if(!r)break;a.push(r.seq),r.eraseOperators(this.entity)}return this.entity.allStickyEffectOperators.length===t});o(this,"beforePush",t=>t.eraseOperators(this.entity))}}class Bl extends ai{constructor(t,a,r,n,s,l,v,d){super(t,a,r,n,s,l);o(this,"isEffective");o(this,"beforeRemove",()=>{});o(this,"procTypes");o(this,"filter");o(this,"eraseOperators",t=>{if(!this.procTypes.includes("Effect"))return 0;console.log("ここはまだ通らない想定");const a=t.allStickyEffectOperators.filter(r=>r.isContinuous).filter(r=>!this.filter(r.effectOwner,r.isSpawnedBy,r.actionAttr,[])).map(r=>r.seq);return a.forEach(t.procFilterBundle.removeItem),a.forEach(t.statusOperatorBundle.removeItem),a.forEach(t.numericOprsBundle.removeItem),a.forEach(t.cardRelationBundle.removeItem),a.length});this.procTypes=v,this.filter=d,this.isEffective=!0}}const wr={level:1,rank:1,attack:0,defense:0,pendulumScaleR:0,pendulumScaleL:0};class ql extends oa{constructor(){super(...arguments);o(this,"afterDistributeAll",t=>{if(this.bundles.forEach(r=>r.calcStateAll()),t.field.getMonstersOnField().flatMap(r=>r.numericOprsBundle).flatMap(r=>r.operators).some(r=>r.stateOperationType==="THE_DEVILS_AVATAR"||r.stateOperationType==="THE_DEVILS_DREAD-ROOT"||r.stateOperationType==="Gradius'_Option")){const n=t.field.getMonstersOnField().filter(s=>(s.atk??0)>=0).map(s=>s.atk??0).reduce((s,l)=>s>l?s:l,0);t.field.getMonstersOnField().forEach(s=>{let l;s.info.effectTargets["Gradius'_Option"]&&(l=s.info.effectTargets["Gradius'_Option"][0]),s.numericOprsBundle.operators.forEach(v=>{var d;if(!((d=s.status.monsterCategories)!=null&&d.includes("Link")&&v.targetState==="defense")){if(v.stateOperationType==="Gradius'_Option"){s.numericStatus.calculated[v.targetState]=(l==null?void 0:l.numericStatus.calculated[v.targetState])??0;return}if(v.stateOperationType==="THE_DEVILS_AVATAR"){s.numericStatus.calculated[v.targetState]=n+100;return}if(v.stateOperationType==="THE_DEVILS_DREAD-ROOT"){s.numericStatus.calculated[v.targetState]=v.calcValue(v.isSpawnedBy,s,s.numericStatus.calculated[v.targetState]??0);return}}})})}return!0})}}class Ol extends ca{constructor(){super(...arguments);o(this,"dominantOperators",{level:void 0,rank:void 0,attack:void 0,defense:void 0,pendulumScaleR:void 0,pendulumScaleL:void 0});o(this,"beforePush",t=>{if(t.stateOperationType==="THE_DEVILS_AVATAR"||t.stateOperationType==="Gradius'_Option")return;const a=this.entity.origin[t.targetState]??0,r=this.entity.numericStatus.origin[t.targetState]??0,n=this.entity.numericStatus.current[t.targetState]??0,s=this.entity.numericStatus.calculated[t.targetState]??0,l=this.dominantOperators[t.targetState];if(t.stateOperationType==="THE_DEVILS_DREAD-ROOT"){this.entity.numericStatus.calculated[t.targetState]=t.calcValue(t.isSpawnedBy,this.entity,s);return}if(t.stateOperationType==="Addition"){if(t.targetStateGen==="origin")throw new ke("ありえない組合せ",t);t.isContinuous||(this.entity.numericStatus.current[t.targetState]=t.calcValue(t.isSpawnedBy,this.entity,n)),this.entity.numericStatus.calculated[t.targetState]=t.calcValue(t.isSpawnedBy,this.entity,n);return}if(t.targetStateGen==="origin"){const v=t.calcValue(t.isSpawnedBy,this.entity,a);l&&!l.isContinuous&&l.targetStateGen!=="current"&&(this.entity.numericStatus.current[t.targetState]=v,this.dominantOperators[t.targetState]=void 0),this.entity.numericStatus.origin[t.targetState]=v,this.dominantOperators[t.targetState]=l??t}else t.isContinuous?(this.entity.numericStatus.current[t.targetState]=t.calcValue(t.isSpawnedBy,this.entity,r),this.dominantOperators[t.targetState]=t):(this.entity.numericStatus.current[t.targetState]=t.calcValue(t.isSpawnedBy,this.entity,s),this.dominantOperators[t.targetState]=t)});o(this,"calcStateAll",()=>bn.forEach(this.calcState));o(this,"calcState",t=>{if(this.entity.status.kind!=="Monster"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories){this.entity.numericStatus.calculated[t]=void 0;return}if(this.entity.status.monsterCategories.includes("Link")&&t!=="attack"){this.entity.numericStatus.calculated[t]=void 0;return}if(this.entity.status.monsterCategories.includes("Xyz")&&t==="level"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories.includes("Xyz")&&t==="rank"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories.includes("Pendulum")&&(t==="pendulumScaleL"||t==="pendulumScaleR")){this.entity.numericStatus.calculated[t]=void 0;return}if(t!=="level"&&!this.entity.isOnField){this.entity.numericStatus.origin[t]=this.entity.origin[t],this.entity.numericStatus.current[t]=this.entity.origin[t],this.entity.numericStatus.calculated[t]=this.entity.origin[t];return}const a=this._operators.filter(d=>d.targetState===t);if(a.some(d=>d.stateOperationType==="THE_DEVILS_AVATAR"||d.stateOperationType==="Gradius'_Option")&&this.entity.isEffective){this.entity.numericStatus.calculated[t]=-Number.MAX_VALUE;return}const r=this.dominantOperators[t],n=this.entity.numericStatus.origin[t]??0;let s=this.entity.numericStatus.current[t]??0,l=-1;r&&(r.targetStateGen==="current"&&r.isContinuous?(l=a.findLastIndex(d=>d.stateOperationType==="Fixation"&&d!==r),s=r.calcValue(r.isSpawnedBy,this.entity,n)):l=a.findIndex(d=>d===r)),l++;let v=s;if(l<a.length)for(let d=l;d<a.length;d++){const f=a[d];f.isContinuous&&f.targetStateGen==="current"&&f.stateOperationType==="Addition"&&(v=f.calcValue(f.isSpawnedBy,this.entity,v))}v<wr[t]&&(v=wr[t]),this.entity.numericStatus.calculated[t]=v})}}const Qt=class Qt extends ai{constructor(t,a,r,n,s,l,v,d,f,p){super(t,a,r,n,s,l);o(this,"beforeRemove",()=>{});o(this,"targetState");o(this,"targetStateGen");o(this,"stateOperationType");o(this,"calcValue");this.targetState=v,this.targetStateGen=d,this.stateOperationType=f,this.calcValue=p}};o(Qt,"createContinuous",(t,a,r,n,s,l,v,d)=>new Qt(t,a,!0,r,{},n,s,l,v,d)),o(Qt,"createLingering",(t,a,r,n,s,l,v,d,f,p)=>new Qt(t,a,!1,r,s,l,v,d,f,()=>p));let ht=Qt;const Tn=i=>Object.keys(i),Nl={draw:"ドローフェイズ",standby:"スタンバイフェイズ",main1:"メインフェイズ１",battle1:"バトルフェイズ",battle2:"バトルフェイズ（追加）",main2:"メインフェイズ２",end:"エンドフェイズ"},Rl={start:"スタートステップ",battle:"バトルステップ",damage:"ダメージステップ",end:"エンドステップ"},Ll={start:"ダメージステップ開始時",beforeDmgCalc:"ダメージ計算前",dmgCalc:"ダメージ計算時",afterDmgCalc:"ダメージ計算後",end:"ダメージステップ終了時"},dt=["draw","stanby","main1","b1Start","b1Battle","b1End","b2Start","b2Battle","b2End","main2","end"],Kt=["b1DStart","b1DBeforeDmgCalc","b1DAfterDmgCalc","b1DEnd","b2DStart","b2DBeforeDmgCalc","b2DAfterDmgCalc","b2DEnd"],Hl=["b1DDmgCalc","b2DDmgCalc"],er=[...dt,...Kt,...Hl],Tr={draw:{phase:"draw",step:void 0,stage:void 0},stanby:{phase:"standby",step:void 0,stage:void 0},main1:{phase:"main1",step:void 0,stage:void 0},b1Start:{phase:"battle1",step:"start",stage:void 0},b1Battle:{phase:"battle1",step:"battle",stage:void 0},b1DStart:{phase:"battle1",step:"battle",stage:"start"},b1DBeforeDmgCalc:{phase:"battle1",step:"battle",stage:"beforeDmgCalc"},b1DDmgCalc:{phase:"battle1",step:"battle",stage:"dmgCalc"},b1DAfterDmgCalc:{phase:"battle1",step:"battle",stage:"afterDmgCalc"},b1DEnd:{phase:"battle1",step:"battle",stage:"end"},b1End:{phase:"battle1",step:"end",stage:void 0},b2Start:{phase:"battle2",step:"start",stage:void 0},b2Battle:{phase:"battle2",step:"battle",stage:void 0},b2DStart:{phase:"battle2",step:"battle",stage:"start"},b2DBeforeDmgCalc:{phase:"battle2",step:"battle",stage:"beforeDmgCalc"},b2DDmgCalc:{phase:"battle2",step:"battle",stage:"dmgCalc"},b2DAfterDmgCalc:{phase:"battle2",step:"battle",stage:"afterDmgCalc"},b2DEnd:{phase:"battle2",step:"battle",stage:"end"},b2End:{phase:"battle2",step:"end",stage:void 0},main2:{phase:"main2",step:void 0,stage:void 0},end:{phase:"end",step:void 0,stage:void 0}},$l=i=>i.stage?Ll[i.stage]:i.step?Rl[i.step]:Nl[i.phase],Bt=Tn(Tr).reduce((i,e)=>(i[e].key=e,i[e].name=$l(i[e]),i),Tr),Wi=class Wi{constructor(e,t){o(this,"entity");o(this,"isRegular");o(this,"_isStarted");o(this,"info");o(this,"continuousEffectBase");o(this,"updateState",async()=>{if(this.hasToStart!==this.isStarted){if(this.isStarted){if(!this.info)throw new ke("illegal state");this._isStarted=!1,await this.continuousEffectBase.finish(this.entity,this.info),this.info=void 0;return}this.info=await this.continuousEffectBase.start(this.entity),this._isStarted=!0}});this._isStarted=!1,this.entity=e,this.continuousEffectBase=t,this.isRegular=this.appliableCellTypes.every(a=>ki.find(r=>r===a))&&this.faceList.length===1&&this.faceList[0]==="FaceUp"}get isStarted(){return this._isStarted}get appliableCellTypes(){return this.continuousEffectBase.appliableCellTypes}get appliableDuelPeriodKeys(){return this.continuousEffectBase.appliableDuelPeriodKeys}get faceList(){return this.continuousEffectBase.faceList}get hasToStart(){return!this.appliableCellTypes.includes(this.entity.fieldCell.cellType)||!this.appliableDuelPeriodKeys.includes(this.entity.duel.clock.period.key)||!this.faceList.includes(this.entity.face)?!1:this.continuousEffectBase.canStart(this.entity)}};o(Wi,"createNew",(e,t)=>new Wi(e,t));let Ba=Wi;const jl=(i,e,t,a,r)=>({title:i,appliableCellTypes:e==="Monster"?["MonsterZone","ExtraMonsterZone"]:["FieldSpellZone","SpellAndTrapZone"],appliableDuelPeriodKeys:er,faceList:["FaceUp"],canStart:n=>!n.info.isPending&&!n.info.isDying&&t(n),start:async n=>{const s=a(n);return s.forEach(r(n).push),s.map(l=>l.seq)},finish:async(n,s)=>{s.forEach(l=>r(n).removeItem(l))}}),da=(i,e,t,a,r,n)=>({title:i,appliableCellTypes:e==="Monster"?["MonsterZone","ExtraMonsterZone"]:["FieldSpellZone","SpellAndTrapZone"],appliableDuelPeriodKeys:er,faceList:["FaceUp"],canStart:s=>!s.info.isPending&&!s.info.isDying&&a(s),start:async s=>{const l=r(s),v=t(s);return console.info(`start : ${s.toString()} ⇒ ${v.map(d=>d.toString()).join(" ")} (${l.map(d=>d.title).join(" ")})`),v.map(n).forEach(d=>l.forEach(d.push)),{targets:v,seqList:l.map(d=>d.seq)}},finish:async(s,l)=>{l.targets.map(n).forEach(v=>l.seqList.forEach(d=>v.removeItem(d)))}}),Ul=(i,e,t,a,r)=>da(i,e,t,a,r,n=>n.procFilterBundle),zi=(i,e,t,a)=>jl(i,e,t,a,r=>r.field.numericStateOperatorPool),ua=(i,e,t,a,r)=>da(i,e,t,a,r,n=>n.numericOprsBundle),qa=(i,e,t,a)=>da(i,e,r=>r.info.effectTargets[i],t,a,r=>r.cardRelationBundle),Zl=(i,e,t,a,r)=>da(i,e,t,a,r,n=>n.statusOperatorBundle);class Gl extends oa{constructor(){super(...arguments);o(this,"afterDistributeAll",()=>!0)}}class Vl extends ca{constructor(){super(...arguments);o(this,"beforePush",()=>{})}}const Ki=class Ki extends ai{constructor(t,a,r,n,s,l,v,d,f){super(t,a,r,n,s,l);o(this,"relationType");o(this,"target");o(this,"beforeRemove");this.relationType=v,this.target=d,this.beforeRemove=()=>f(this)}};o(Ki,"createRegularEquipRelation",(t,a,r,n,s,l=()=>!0)=>new Ki(t,a,!0,r,n,(v,d)=>d.isOnField&&d.face==="FaceUp"&&s(v,d),"Equip",r.info.effectTargets[t][0],v=>{l(v)&&(v.isSpawnedBy.isOnField&&!v.isSpawnedBy.info.isDying&&(v.isSpawnedBy.info.isDying=!0,v.isSpawnedBy.info.causeOfDeath=["RuleDestroy"],v.isSpawnedBy.duel.log.info(`装備対象${v.target.toString()}不在により${v.isSpawnedBy.toString()}は破壊された。`,v.effectOwner)),v.isSpawnedBy.info.effectTargets[t]=[])}));let pi=Ki;class zl{constructor(e){o(this,"entity");o(this,"_records");o(this,"pushForRuleAction",e=>{this._records.push({cell:this.entity.fieldCell,face:this.entity.face,orientation:this.entity.orientation,movedAt:this.entity.duel.clock.getClone(),movedAs:[...e,"Rule"]})});o(this,"push",(e,t,a,r)=>{this._records.push({cell:this.entity.fieldCell,face:this.entity.face,orientation:this.entity.orientation,movedAt:this.entity.duel.clock.getClone(),movedAs:e.getDistinct(),movedBy:t,actionOwner:a,chooser:r??a})});o(this,"pushByChainBlockInfo",(e,t)=>{this.push(t,e.action.entity,e.activator)});this.entity=e,this._records=[]}get records(){return this._records}get latestRecord(){return this._records.slice(-1)[0]}get previousPlaceRecord(){return this._records.findLast(e=>e.cell.cellType!==this.entity.fieldCell.cellType)??this._records[0]}get currentProcRecords(){return this._records.filter(e=>e.movedAt.totalProcSeq===this.entity.duel.clock.totalProcSeq)}}const Oa=["SpellCounter","KaijuCounter","NamelessCounter"],Na=["①","②","③","④"],kn=["CycleFlip"],Yl=[...Oa,...Na,...kn],Wl={SpellCounter:"🔮",KaijuCounter:"☢",NamelessCounter:"💠"};class Kl{constructor(){o(this,"dic");o(this,"add",(e,t=1)=>{this.dic[e]=(this.dic[e]??0)+t});o(this,"setQty",(e,t=1)=>{this.dic[e]=t});o(this,"remove",(e,t=1)=>{this.dic[e]=(this.dic[e]??0)-t});o(this,"getQty",e=>this.dic[e]??0);o(this,"corpseDisposal",()=>{Na.forEach(e=>delete this.dic[e]),kn.forEach(e=>delete this.dic[e])});o(this,"removeAllActualCounters",()=>{Oa.forEach(e=>delete this.dic[e])});o(this,"removeAllWhenfaceDown",()=>{Na.forEach(e=>delete this.dic[e]),Oa.forEach(e=>delete this.dic[e])});o(this,"clear",()=>{Yl.forEach(e=>delete this.dic[e])});this.dic={}}}class Ql extends oa{constructor(){super(...arguments);o(this,"afterDistributeAll",t=>t.field.getAllEntities().map(a=>a.statusOperatorBundle).every(a=>a.calcStatus()))}}class Xl extends ca{constructor(){super(...arguments);o(this,"calcStatus",()=>{const t=this.entity.isEffective,a={...this.entity.status},r=this._operators.reduce((n,s)=>s.statusCalculator(s,n),a);return this.entity.status=r,this.entity.isEffective===t});o(this,"beforePush",()=>{})}}class Jl extends ai{constructor(t,a,r,n,s,l,v){super(t,a,r,n,s,l);o(this,"beforeRemove",()=>{});o(this,"statusCalculator");this.statusCalculator=v}}const Cn=async()=>({selectedEntities:[],chainBlockTags:[],prepared:void 0}),Il=i=>{if(i.activator.info.ruleNormalSummonCount>=i.activator.info.maxRuleNormalSummonCount||!i.action.entity.lvl)return;const e=i.activator.getAvailableMonsterZones();return i.action.entity.lvl<5?e.length>0?e:void 0:i.activator.getReleasableMonsters().length<(i.action.entity.lvl<7?1:2)?void 0:[]},eo=async(i,e,t,a)=>{if(!i.action.entity.lvl)return;let r=e?[e]:i.activator.getAvailableMonsterZones();if(r.length===0)return;let n=a,s=[];if(i.action.entity.lvl>4){const d=i.activator.getReleasableMonsters(),f=i.activator.getExtraMonsterZones(),p=i.action.entity.lvl<7?1:2;f.length>=p&&d.filter(c=>c.fieldCell.cellType!=="ExtraMonsterZone");const g=await i.action.entity.field.release(i.activator,i.activator.getReleasableMonsters(),p,"Cost",["AdvanceSummonRelease","Rule"],i.action.entity,n);if(!g)return;s=g,n=!1,r=i.activator.getAvailableMonsterZones()}let l=(i.action.entity.atk??0)>0&&(i.action.entity.atk??0)>=(i.action.entity.def??0)?"Attack":"Set",v=r.randomPick();if(i.activator.duelistType!=="NPC"){const d=await i.activator.duel.view.waitSelectSummonDest(i.activator,i.action.entity,r,["Attack","Set"],n);if(!d)return;v=d.dest,l=d.pos}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:v,pos:l,materials:s}}},to=async i=>{const e=["Rule","NormalSummon"];let t="NormalSummon";return i.prepared.materials.length>0&&(i.action.entity.info.materials.reset(...i.prepared.materials),t="AdvanceSummon",e.push("AdvanceSummon")),await i.action.entity.summon(i.prepared.dest,i.prepared.pos,t,e,i.action.entity,i.activator),i.activator.info.ruleNormalSummonCount++,i.activator.info.ruleNormalSummonCountQty++,!0},kr=(i,e,t)=>{const a=i.activator.getAvailableMonsterZones();if(i.action.entity.fieldCell.cellType==="ExtraDeck"&&a.push(...i.activator.getAvailableExtraZones()),!(!a.length&&(!t.length||t.every(r=>r.fieldCell.cellType!=="MonsterZone")&&i.action.entity.fieldCell.cellType!=="ExtraDeck"))&&i.activator.canSummon(i.activator,i.action.entity,i.action,"SpecialSummon",e,t).length)return t.length===0?a:[]},Cr=async(i,e,t,a,r)=>{const n=e?[e]:i.activator.getAvailableMonsterZones();if(n.length===0)return;const s=i.activator.canSummon(i.activator,i.action.entity,i.action,"SpecialSummon",t,a);if(s.length===0)return;let l=s.randomPick(),v=n.randomPick();if(s.length&&s.includes("Attack")&&(l=(i.action.entity.atk??0)>0&&(i.action.entity.atk??0)>=(i.action.entity.def??0)?"Attack":s.filter(d=>d!=="Attack").randomPick()),i.activator.duelistType!=="NPC"){const d=await i.activator.duel.view.waitSelectSummonDest(i.activator,i.action.entity,n,s,r);if(!d)return;v=d.dest,l=d.pos}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:v,pos:l,materials:a}}},Dr=async i=>{const e=["Rule","SpecialSummon"];return await i.action.entity.summon(i.prepared.dest,i.prepared.pos,"SpecialSummon",e,i.action.entity,i.activator),i.action.entity.info.materials=i.prepared.materials,!0},ze={title:"通常召喚",playType:"NormalSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Il,prepare:eo,execute:to,settle:async()=>!0},io=i=>{if(!i.activator.isTurnPlayer)return;const e=i.action.entity.getAttackTargets();return console.log(e),e.length?e.map(t=>t.fieldCell):void 0},ao=async(i,e)=>{if(i.action.entity.info.attackCount>0||i.action.entity.battlePosition!=="Attack")return;if(e!=null&&e.targetForAttack)return{selectedEntities:[],chainBlockTags:[],prepared:{target:e.targetForAttack}};const t=i.action.entity.getAttackTargets();if(t.length===0)throw new ke("想定されない状態",i,e);if(t.length===1)return{selectedEntities:[],chainBlockTags:[],prepared:{target:t[0]}};if(i.activator.duelistType==="NPC"){let r=i.activator.selectAttackTargetForNPC(i.action.entity,i.action);return r||(i.activator.duel.log.warn("NPCの攻撃対象選択に失敗したため、ランダムに攻撃対象を選択。"),r=t.randomPick()),{selectedEntities:[],chainBlockTags:[],prepared:{target:r}}}const a=await i.action.entity.field.duel.view.waitSelectEntities(i.activator,t,1,r=>r.length===1,"攻撃対象を選択。",!0);if(a)return{selectedEntities:[],chainBlockTags:[],prepared:{target:a[0]}}},ro=async i=>(i.action.entity.field.duel.declareAnAttack(i.action.entity,i.prepared.target),!0),He={title:"攻撃宣言",playType:"Battle",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["b1Battle","b2Battle"],executableDuelistTypes:["Controller"],validate:io,prepare:ao,execute:ro,settle:async()=>!0},no=i=>{if(!(i.action.entity.info.battlePotisionChangeCount>0||i.action.entity.info.attackCount>0||!i.activator.isTurnPlayer))return[]},so=async i=>i.action.entity.info.battlePotisionChangeCount>0||!i.activator.isTurnPlayer?!1:(await i.action.entity.setBattlePosition(i.action.entity.battlePosition==="Attack"?"Defense":"Attack",["Rule"],i.action.entity,i.activator),i.action.entity.info.battlePotisionChangeCount++,!0),$e={title:"表示形式変更",playType:"ChangeBattlePosition",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:no,prepare:Cn,execute:so,settle:async()=>!0},Dn=(i,e,t,a)=>!(!i.action.entity.origin.level||e.some(r=>!r.lvl)||e.map(r=>r.lvl??0).reduce((r,n)=>r+n,0)!==i.action.entity.origin.level||!t(e.filter(r=>{var n;return(n=r.status.monsterCategories)==null?void 0:n.some(s=>s==="Tuner")}))||!a(e.filter(r=>{var n;return(n=r.status.monsterCategories)==null?void 0:n.every(s=>s!=="Tuner")}))||!e.every(r=>r.canBeMaterials("SyncroSummon",i.action,e))||!i.activator.canSummon(i.activator,i.action.entity,i.action,"SyncroSummon",["Attack","Defense"],e).length),En=(i,e=a=>a.length===1,t=a=>a.length>0)=>{let a=[...i.activator.getMonstersOnField().filter(r=>r.battlePosition!=="Set"),...i.activator.getHandCell().entities.filter(r=>r.origin.kind==="Monster")];return a.every(r=>!r.status.allowHandSyncro)&&(a=a.filter(r=>r.fieldCell.isPlayFieldCell)),a.length<2?[]:a.getAllOnOffPattern().filter(r=>Dn(i,r,e,t))},lo=(i,e=a=>a.length===1,t=a=>a.length>0)=>En(i,e,t).length>0?[]:void 0,oo=async(i,e,t,a=n=>n.length===1,r=n=>n.length>0)=>{const n=En(i,a,r);let s=n[0];if(n.length>1){const f=n.flatMap(g=>g).getDistinct(),p=await i.action.entity.duel.view.waitSelectEntities(i.activator,f,void 0,g=>Dn(i,g,a,r),"シンクロ素材とするモンスターを選択",!0);if(!p)return;s=p}i.action.entity.field.duel.log.info(`シンクロ素材として、${s.map(f=>"《"+f.nm+"》").join("")}を墓地に送り――`,i.activator),await _e.sendManyToGraveyardForTheSameReason(s,["SyncroMaterial","Rule","SpecialSummonMaterial"],i.action.entity,i.activator);const l=[...i.activator.getAvailableMonsterZones(),...i.activator.getAvailableExtraZones()];let v=(i.action.entity.atk??0)>0&&(i.action.entity.atk??0)>=(i.action.entity.def??0)?"Attack":"Defense",d=l.randomPick();if(i.activator.duelistType!=="NPC"){const f=await i.activator.duel.view.waitSelectSummonDest(i.activator,i.action.entity,l,["Attack","Defense"],!1);if(!f)return;d=f.dest,v=f.pos}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:d,pos:v,materials:s}}},co=async i=>{const e=["Rule","SpecialSummon","SyncroSummon"];return await i.action.entity.summon(i.prepared.dest,i.prepared.pos,"SyncroSummon",e,i.action.entity,i.activator),i.action.entity.info.isRebornable=!0,!0},Sa=(i=t=>t.length===1,e=t=>t.length>0)=>({title:"シンクロ召喚",playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:t=>lo(t,i,e),prepare:(t,a,r,n)=>oo(t,a,n,i,e),execute:co,settle:async()=>!0}),uo={FusionSummon:"融合召喚",SyncroSummon:"シンクロ召喚",XyzSummon:"エクシーズ召喚",PendulumSummon:"ペンデュラム召喚",LinkSummon:"リンク召喚"},vo={BattleDestroy:"戦闘破壊",EffectDestroy:"効果破壊",RuleDestroy:"ルール破壊"},An=i=>i+"Summon",fo=["Card","Token","Avatar"],xn=(i,e)=>ui(i.origin,e.origin),ce=class ce{constructor(e,t,a,r,n,s){o(this,"seq");o(this,"origin");o(this,"entityType");o(this,"procFilterBundle");o(this,"numericOprsBundle");o(this,"cardRelationBundle");o(this,"statusOperatorBundle");o(this,"moveLog");o(this,"counterHolder");o(this,"face");o(this,"orientation");o(this,"owner");o(this,"fieldCell");o(this,"_status");o(this,"_numericStatus");o(this,"_info");o(this,"actions",[]);o(this,"continuousEffects",[]);o(this,"_hasDisappeared",!1);o(this,"toString",()=>`《${this.nm}》`);o(this,"setBattlePosition",async(e,t,a,r)=>{let n=`表示形式の変更：${this.toString()}（${this.battlePositionName}⇒${Fi[e]}）`;const s=[...t];this.battlePosition==="Set"&&(s.push("Flip"),t.includes("Rule")&&(n=`${this.toString()}を反転召喚`,s.push("FlipSummon"),s.push("AttackSummon"))),this.moveAlone(this.fieldCell,e==="Set"?"FaceDown":"FaceUp",e==="Attack"?"Vertical":"Horizontal","Top",s,a,r,r),this.duel.log.info(n,r)});o(this,"setNonFieldMonsterPosition",async(e,t,a,r)=>{this.moveAlone(this.fieldCell,e==="FaceUp"?"FaceUp":"FaceDown",e==="XysMaterial"?"Horizontal":"Vertical","Top",t,a,r,r)});o(this,"setAsSpellTrap",async(e,t,a,r)=>{await this.moveAlone(e,"FaceDown","Vertical","Top",[...t,"SpellTrapSet"],a,r,r)});o(this,"activateSpellTrapFromHand",async(e,t,a,r)=>{await this.moveAlone(e,"FaceUp","Vertical","Top",[...t,"CardActivation"],a,r,r)});o(this,"activateSpellTrapOnField",async(e,t,a)=>{await this.moveAlone(this.fieldCell,"FaceUp","Vertical","Top",[...e,"CardActivation"],t,a,a)});o(this,"draw",async(e,t,a)=>await this.addToHand([...e,"Draw"],t,a));o(this,"addToHand",async(e,t,a)=>await this.moveAlone(this.owner.getHandCell(),"FaceDown","Vertical","Bottom",[...e],t,a,a));o(this,"release",async(e,t,a)=>(await this.sendToGraveyard([...e,"Release"],t,a),this.info.isVanished?void 0:this.fieldCell));o(this,"sendToGraveyard",(e,t,a)=>ce.sendManyToGraveyardForTheSameReason([this],e,t,a));o(this,"returnToDeck",(e,t,a,r)=>ce.returnManyToDeckForTheSameReason(e,[this],t,a,r));o(this,"banish",(e,t,a)=>ce.banishManyForTheSameReason([this],e,t,a));o(this,"summon",(e,t,a,r,n,s,l)=>ce.summonMany([{entity:this,to:e,chooser:l??s,pos:t}],a,r,n,s));o(this,"moveAlone",async(e,t,a,r,n,s,l,v)=>(await ce.moveMany([[this,e,t,a,r,n,s,l,v]],void 0),this.fieldCell));o(this,"_move",async(e,t,a,r,n,s,l,v)=>{if(!e)throw new Error("illegal argument: to");if(this.face=t,this.orientation=a,e!==this.fieldCell){if(this.field.duel.clock.turn>0&&await this.field.duel.view.waitAnimation({entity:this,to:e,index:r,count:0}),this.fieldCell.releaseEntities([this]),this.fieldCell.isPlayFieldCell&&!e.isPlayFieldCell&&(this.counterHolder.clear(),this.resetCauseOfDeath(),this.entityType==="Token")){this._hasDisappeared=!0,this.field.duel.log.info(`${this.nm}は消滅した。`,this.controller);return}e.acceptEntities([this],r),(e===this.isBelongTo||e.cellType==="Hand"||e.cellType==="Banished"&&this.face==="FaceDown")&&(this.counterHolder.clear(),this.resetInfoAll(),this.resetStatusAll())}return console.log(this.toString(),this),this.isOnField&&this.face==="FaceDown"&&(console.log(this.toString(),this),this.counterHolder.removeAllWhenfaceDown(),this.info.materials=[],this._status.isEffective=!0,this.info.isEffective=!0,this.info.willBeBanished=!1,this.info.willReturnToDeck=void 0,this.resetNumericStatus(),this.info.isSettingSickness=this.status.kind==="Trap"||this.status.spellCategory==="QuickPlay"),this.moveLog.push(n,s,l,v),e});o(this,"initForTurn",()=>{this.info.isSettingSickness=!1,this.info.attackCount=0,this.info.battlePotisionChangeCount=0,this.counterHolder.corpseDisposal()});o(this,"resetInfoIfLeavesTheField",()=>{this._info={...this._info,isDying:!1,isPending:!1,isEffective:!0,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,effectTargets:{},attackCount:0,battlePotisionChangeCount:0}});o(this,"resetInfoAll",()=>{var e;this._info={isDying:!1,isPending:!1,isEffective:!0,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,isVanished:!1,isRebornable:((e=this.origin.monsterCategories)==null?void 0:e.union(Sn).length)===0||(this.origin.canReborn??!1),isSettingSickness:!1,materials:[],effectTargets:{},willBeBanished:!1,willReturnToDeck:void 0,attackCount:0,battlePotisionChangeCount:0},this.counterHolder.clear()});o(this,"resetNumericStatus",()=>{const e=bn.reduce((t,a)=>(t[a]=this.origin[a],t),{});this._numericStatus={origin:{...e},current:{...e},calculated:{...e}}});o(this,"resetStatus",()=>{this._status={...this.origin,canAttack:!0,isEffective:!0,canDirectAttack:!1,isSelectableForAttack:!0,allowHandSyncro:!1,maxCounterQty:{}}});o(this,"resetStatusAll",()=>{this.resetNumericStatus(),this.resetStatus()});o(this,"resetCauseOfDeath",()=>{this.info.isDying=!1,this.info.causeOfDeath=[],this.info.isKilledBy=void 0,this.info.isKilledByWhom=void 0});this.seq=ce.nextEntitySeq++,this.counterHolder=new Kl,this.owner=e,this.fieldCell=t,this.entityType=a,this.origin=r,this._status=JSON.parse(JSON.stringify(r)),this._numericStatus=JSON.parse(JSON.stringify(r)),this.resetStatusAll(),this._info={isEffective:!0,attackCount:0,battlePotisionChangeCount:0,isDying:!1,isPending:!1,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,isVanished:!1,isRebornable:!0,isSettingSickness:!1,materials:[],effectTargets:{},willBeBanished:!1,willReturnToDeck:void 0},this.resetInfoAll(),this.face=n,this.orientation=s,this.procFilterBundle=new Fl(t.field.procFilterPool,this),this.numericOprsBundle=new Ol(t.field.numericStateOperatorPool,this),this.cardRelationBundle=new Vl(t.field.cardRelationPool,this),this.statusOperatorBundle=new Xl(t.field.statusOperatorPool,this),t.acceptEntities([this],"Top"),this.moveLog=new zl(this),this.moveLog.pushForRuleAction(["Spawn"])}get isUnderControl(){return this.face==="FaceUp"||wn.every(e=>e!==this.fieldCell.cellType)}get controller(){return this.fieldCell.owner??this.owner}get field(){return this.owner.duel.field}get duel(){return this.owner.duel.field.duel}get status(){return this._status}set status(e){this._status={...e}}get numericStatus(){return this._numericStatus}get info(){return this._info}get nm(){return this.status.name}get atk(){return this._numericStatus.calculated.attack}get def(){return this._numericStatus.calculated.defense}get lvl(){return this._numericStatus.calculated.level}get rank(){return this._numericStatus.calculated.rank}get attr(){return this.status.attributes??[]}get types(){return this.status.types??[]}get psL(){return this._numericStatus.calculated.pendulumScaleL}get psR(){return this._numericStatus.calculated.pendulumScaleR}get isEffective(){return this.status.isEffective&&this.info.isEffective}get isNagatedStrongly(){return!this.info.isEffective}get battlePosition(){if(this.isOnField&&this.status.kind==="Monster")return this.orientation==="Vertical"?"Attack":this.face==="FaceUp"?"Defense":"Set"}get battlePositionName(){const e=this.battlePosition;if(e)return Fi[e]}get wasMovedAtCurrentProc(){return this.field.duel.clock.totalProcSeq===this.moveLog.latestRecord.movedAt.totalProcSeq}get wasMovedAtPreviousProc(){return this.field.duel.clock.totalProcSeq===this.moveLog.latestRecord.movedAt.totalProcSeq+1}get wasMovedAtCurrentChain(){return this.field.duel.clock.isSameChain(this.moveLog.latestRecord.movedAt)}get wasMovedAtPreviousChain(){return this.field.duel.clock.isPreviousChain(this.moveLog.latestRecord.movedAt)}get wasMovedFrom(){return this.moveLog.previousPlaceRecord.cell}get isOnField(){return ki.some(e=>e===this.fieldCell.cellType)}get isLikeContinuousSpell(){return this.status.spellCategory==="Continuous"||this.status.spellCategory==="Field"||this.status.spellCategory==="Equip"||this.status.trapCategory==="Continuous"||(this.status.monsterCategories??[]).includes("Pendulum")}get isBelongTo(){return this.origin.monsterCategories&&this.origin.monsterCategories.union(ii).length?this.owner.getExtraDeck():this.owner.getDeckCell()}get hasDisappeared(){return this._hasDisappeared}get allStickyEffectOperators(){return[...this.procFilterBundle.operators,...this.numericOprsBundle.operators,...this.cardRelationBundle.operators]}};o(ce,"nextEntitySeq",0),o(ce,"splitBattlePos",e=>({face:e==="Set"?"FaceDown":"FaceUp",orientation:e==="Attack"?"Vertical":"Horizontal"})),o(ce,"recreateArray",(e,t)=>{if(!t.length)return[];const a=e.getAllCells().flatMap(r=>r.entities);return t.map(r=>r.seq).map(r=>a.find(n=>n.seq===r)).filter(r=>r!==void 0)}),o(ce,"createPlayerEntity",e=>{const t=e.getHandCell();return new ce(e,t,"Duelist",{name:e.profile.name,kind:"Monster",wikiEncodedName:"%A5%D7%A5%EC%A5%A4%A5%E4%A1%BC"},"FaceUp","Vertical")}),o(ce,"createCardEntity",(e,t)=>{var v;const a=t.monsterCategories&&t.monsterCategories.union(ii).length?e.getExtraDeck():e.getDeckCell(),r=new ce(e,a,"Card",Dl(t),"FaceDown","Vertical");Object.hasOwn(Ue,r.origin.name)||e.duel.log.info(`未実装カード${t.name}がデッキに投入された。`,e);const n=Ue[r.origin.name];let s=[],l=[];if(n.kind==="Monster"&&((v=n.monsterCategories)!=null&&v.includes("Normal")))s=[ze,He,$e];else{const d=Ha.get(r.origin.name);d&&(s=d.actions,l=d.continuousEffects??[])}return r.actions.push(...s.map(d=>Mt.createNew(r,d))),r.continuousEffects.push(...l.map(d=>Ba.createNew(r,d))),r}),o(ce,"waitCorpseDisposal",e=>ce.sendManyToGraveyard(e.field.getEntiteisOnField().filter(t=>t.info.isDying).map(t=>({entity:t,causedAs:t.info.causeOfDeath??[],causedBy:t.info.isKilledBy,activator:t.info.isKilledByWhom})))),o(ce,"sendManyToGraveyardForTheSameReason",(e,t,a,r)=>ce.bringManyToSameCellForTheSameReason("Graveyard","Top",e,"FaceUp","Vertical",t,a,r)),o(ce,"banishManyForTheSameReason",(e,t,a,r)=>ce.bringManyToSameCellForTheSameReason("Banished","Top",e,"FaceUp","Vertical",t,a,r)),o(ce,"returnManyToDeckForTheSameReason",(e,t,a,r,n)=>ce.bringManyToSameCellForTheSameReason("Deck",e,t,"FaceDown","Vertical",a,r,n)),o(ce,"returnManyToHandForTheSameReason",(e,t,a,r)=>ce.bringManyToSameCellForTheSameReason("Hand","Bottom",e,"FaceDown","Vertical",t,a,r)),o(ce,"sendManyToGraveyard",(e,t)=>ce.bringManyToSameCell("Graveyard","Top",e.map(a=>({...a,face:"FaceUp",orientation:"Vertical"})),t)),o(ce,"banishMany",(e,t)=>ce.bringManyToSameCell("Banished","Top",e.map(a=>({...a,face:"FaceUp",orientation:"Vertical"})),t)),o(ce,"bringManyToSameCellForTheSameReason",(e,t,a,r,n,s,l,v)=>ce.bringManyToSameCell(e,t,a.map(d=>({entity:d,face:r,orientation:n,causedAs:s,causedBy:l,activator:v})))),o(ce,"bringManyToSameCell",(e,t,a,r)=>ce.moveMany(a.map(n=>[n.entity,n.entity.field.getCells(e).filter(s=>s.owner===n.entity.owner)[0],n.face,n.orientation,t,n.causedAs,n.causedBy,n.activator,n.activator]),r)),o(ce,"moveMany",async(e,t)=>{if(!e.length)return;const a=e[0][0].duel,n=[...e.map(([l])=>l).filter(l=>!(t??[]).includes(l)),...a.field.getEntiteisOnField().filter(l=>l.info.isDying)],s=new Map;for(e.forEach(([l,v,d,f,p,...g])=>{let c=v,h=d,S=p,y=f;l.info.willBeBanished&&(c=l.owner.getBanished(),h="FaceUp",y="Vertical"),l.info.willReturnToDeck&&(c=l.isBelongTo,h="FaceDown",S=l.info.willReturnToDeck,y="Vertical"),l.isBelongTo.cellType==="ExtraDeck"&&(c.cellType==="Hand"||c.cellType==="Deck")&&(c=l.isBelongTo,h="FaceDown",y="Vertical"),s.set(c,[[l,c,h,y,S,...g],...s.get(c)??[]])});;){const l=Array.from(s.values()).map(d=>d.pop()).filter(d=>d!==void 0).map(([d,...f])=>d._move(...f));if(!l.length)break;await Promise.all(l),a.field.cardRelationPool.excludesExpired();const v=a.field.getEntiteisOnField().filter(d=>d.info.isDying).filter(d=>!n.includes(d)).map(d=>({entity:d,causedAs:d.info.causeOfDeath??[],causedBy:d.info.isKilledBy,activator:d.info.isKilledByWhom}));v.length&&await ce.sendManyToGraveyard(v,n)}ce.settleEntityMove(a)}),o(ce,"summonMany",async(e,t,a,r,n)=>{if(!e.length)return;const s={Attack:"AttackSummon",Defense:"DefenseSummon",Set:"SetSummon"};await Promise.all(e.map(async({entity:l,to:v,pos:d,chooser:f})=>{if(t==="NormalSummon"||t==="AdvanceSummon"){const c=t==="AdvanceSummon"?"アドバンス":"";d==="Attack"?l.field.duel.log.info(`${l.toString()}を${c}召喚`,f):l.duel.log.info(`${l.toString()}を${c}セット`,f),a.includes("Rule")?f.info.ruleNormalSummonCountQty++:f.info.effectNormalSummonCountQty++}else t==="SpecialSummon"?l.duel.log.info(`${l.toString()}を${Fi[d]}で特殊召喚`,f):l.duel.log.info(`${l.toString()}を${Fi[d]}で${uo[t]}！`,f),f.info.specialSummonCountQty++;l.info.battlePotisionChangeCount=1;const{face:p,orientation:g}=ce.splitBattlePos(d);await l._move(v,p,g,"Top",[t,s[d],...a],r,n,f)})),e.map(l=>l.chooser).forEach(l=>{t==="NormalSummon"||t==="AdvanceSummon"?a.includes("Rule")?l.info.ruleNormalSummonCount++:l.info.effectNormalSummonCount++:l.info.specialSummonCount++}),ce.settleEntityMove(e[0].entity.duel)}),o(ce,"settleEntityMove",e=>{e.distributeOperators(e.clock.totalProcSeq);const t=e.field.getAllEntities().filter(a=>a.wasMovedAtCurrentProc);t.filter(a=>!a.isOnField).forEach(a=>a.resetInfoIfLeavesTheField()),t.filter(a=>a.face==="FaceDown").filter(a=>a.fieldCell===a.isBelongTo).forEach(a=>{a.resetInfoAll(),a.resetStatusAll()}),t.flatMap(a=>a.continuousEffects).forEach(a=>a.updateState()),e.field.getAllCells().filter(a=>a.needsShuffle).map(a=>a.shuffle())});let _e=ce;const Er=(...i)=>i.length?i.reduce((e,t)=>e>t?e:t):-Number.MAX_VALUE,Ra=(...i)=>i.length?i.reduce((e,t)=>e<t?e:t):Number.MAX_VALUE;class Ar{constructor(e,t,a,r,n,s=[]){o(this,"duel");o(this,"seat");o(this,"_entity");o(this,"profile");o(this,"deckInfo");o(this,"info");o(this,"infoOrigin");o(this,"status");o(this,"statusOrigin");o(this,"duelistType");o(this,"lifeLog");o(this,"actionBlackListForNPC");o(this,"_lp");o(this,"initHand");o(this,"initForDrawPhase",()=>{this.info={...this.infoOrigin}});o(this,"canSummon",(e,t,a,r,n,s)=>this.entity.procFilterBundle.operators.filter(l=>l.procTypes.some(v=>v===r)).every(l=>l.filter(e,t,a,s))?n.filter(l=>this.entity.procFilterBundle.operators.filter(v=>v.procTypes.some(d=>d===An(l))).every(v=>v.filter(e,t,a,s))):[]);o(this,"battleDamage",(e,t)=>this.setLp(this._lp-e,t,"BattleDamage"));o(this,"effectDamage",(e,t)=>this.setLp(this._lp-e,t,"EffectDamage"));o(this,"lostLp",(e,t)=>this.setLp(this._lp-e,t,"Lost"));o(this,"payLp",(e,t)=>this.setLp(this._lp-e,t,"Pay"));o(this,"heal",(e,t)=>this.setLp(this._lp+e,t,"Heal"));o(this,"setLp",(e,t,a)=>{const r={clock:this.duel.clock,reason:a||"Set",beforeLp:this._lp,afterLp:e,entity:t};return this.lifeLog.push(r),this._lp=e,this.duel.log.info(`ライフポイント変動：${r.afterLp-r.beforeLp}（${r.beforeLp} ⇒ ${r.afterLp}）`,this),r});o(this,"getOpponentPlayer",()=>this.duel.firstPlayer===this?this.duel.secondPlayer:this.duel.firstPlayer);o(this,"getHandCell",()=>this.duel.field.getCells("Hand").filter(e=>e.owner===this)[0]);o(this,"getDeckCell",()=>this.duel.field.getCells("Deck").filter(e=>e.owner===this)[0]);o(this,"getExtraDeck",()=>this.duel.field.getCells("ExtraDeck").filter(e=>e.owner===this)[0]);o(this,"getGraveyard",()=>this.duel.field.getCells("Graveyard").filter(e=>e.owner===this)[0]);o(this,"getFieldZone",()=>this.duel.field.getCells("FieldSpellZone").filter(e=>e.owner===this)[0]);o(this,"getBanished",()=>this.duel.field.getCells("Banished").filter(e=>e.owner===this)[0]);o(this,"getMonsterZones",()=>this.duel.field.getCells("MonsterZone").filter(e=>e.owner===this));o(this,"getExtraMonsterZones",()=>this.duel.field.getCells("ExtraMonsterZone").filter(e=>{var t;return((t=e.cardEntities[0])==null?void 0:t.controller)===this}));o(this,"getSpellTrapZones",()=>this.duel.field.getCells("SpellAndTrapZone").filter(e=>e.owner===this));o(this,"getEmptyMonsterZones",()=>this.getMonsterZones().filter(e=>e.cardEntities.length===0));o(this,"getEmptyExtraZones",()=>this.getExtraMonsterZones().length===0?this.getMonsterZones().filter(e=>e.cardEntities.length===0):[]);o(this,"getAvailableMonsterZones",()=>this.getMonsterZones().filter(e=>e.isAvailable));o(this,"getAvailableExtraZones",()=>this.getExtraMonsterZones().length===0?this.duel.field.getCells("ExtraMonsterZone").filter(e=>e.isAvailable):[]);o(this,"getAvailableSpellTrapZones",()=>this.getSpellTrapZones().filter(e=>e.isAvailable));o(this,"getReleasableMonsters",()=>this.getMonstersOnField());o(this,"getMonstersOnField",()=>this.duel.field.getMonstersOnField().filter(e=>e.controller===this));o(this,"getEntiteisOnField",()=>this.duel.field.getEntiteisOnField().filter(e=>e.controller===this));o(this,"pushDeck",()=>{this.deckInfo.cardNames.map(e=>Ue[e]).filter(e=>e).forEach(e=>_e.createCardEntity(this,e)),this.duel.log.info(`デッキをセット。メイン${this.getDeckCell().cardEntities.length}枚。エクストラ${this.getExtraDeck().cardEntities.length}枚。`,this)});o(this,"draw",async(e,t,a)=>{var s;if(e<1)return;const r=this.getDeckCell(),n=[];for(const l of Array(e)){if(!r.cardEntities.length)throw this.duel.log.info(n.length>0?`デッキからカードを${e}枚ドローしようとしたが、${n.length}枚しかドローできなかった。${n}`:"デッキからカードをドローできなかった。",this),this.duel.isEnded=!0,this.setLp(0),new Rt(this.getOpponentPlayer());const v=r.cardEntities[0];await v.draw(t?["Effect"]:["Rule"],t,a),n.push(((s=v.origin)==null?void 0:s.name)||"!名称取得失敗!")}this.duel.log.info(`デッキからカードを${n.length}枚ドロー。${n}。`,this)});o(this,"discard",async(e,t,a,r,n,s)=>{const l=n||(()=>!0),v=this.getHandCell().cardEntities.filter(l);if(v.length<e)return[];let d=[];return(r||this).duelistType==="NPC"?d=v.randomPickMany(e):d=await this.duel.view.waitSelectEntities(r||this,v,e,f=>f.length===e,`${e}枚カードを捨てる。`,!1)||[],await _e.sendManyToGraveyardForTheSameReason(d,["Discard",...t],a,s),this.duel.log.info(`手札からカードを${d.length}枚捨てた。${d.map(f=>{var p;return(p=f.origin)==null?void 0:p.name})}。`,this),d});o(this,"summon",async(e,t,a,r,n,s,l=!1)=>{let v=t.randomPick(),d=a.randomPick();if((a.length>1||t.length>1)&&this.duelistType!=="NPC"){const f=a.length>1?"カードを召喚先へドラッグ。":"表示形式を選択。",p=t.map(S=>Mt.createDammyAction(e,S,a,S)),g=this.duel.view.modalController.selectAction(this.duel.view,{title:f,activator:this,actions:p,cancelable:!1}),c=this.duel.view.waitSubAction(this,p,f,l).then(S=>S.action),h=await Promise.any([g,c]);if(!h&&!l)throw new ke("",h);if(!h)return;d=h.cell||d,v=h.pos||v}return await e.summon(d,v,r,n,s,this),e});o(this,"selectAttackTargetForNPC",(e,t)=>{const a=e.atk??0,r=e.getAttackTargets();if(!r.length)return;const n=r.find(s=>s.entityType==="Duelist");return console.log(this,a,n),n&&(a>=Ra(1600,this.getOpponentPlayer().lp)||e.info.battlePotisionChangeCount>0)?n:r.find(s=>s.battlePosition==="Attack"?(console.log(this,a,s),a>=(s.atk??0)):a<(s.battlePosition==="Set"?1e3:s.def??0)?!1:s.validateDestory("BattleDestroy",this,e,t))});o(this,"selectActionForNPC",(e,t)=>{if(!e.length)return;const a=e.filter(y=>y.playType==="MandatoryIgnitionEffect"||y.playType==="MandatoryTriggerEffect");if(a.length)return a.randomPick();let r=e.filter(y=>!this.actionBlackListForNPC.includes(y.playType));const n=r.filter(y=>!Number.isNaN(y.priorityForNPC)).shuffle().sort((y,m)=>y.priorityForNPC-m.priorityForNPC);if(n.length)return n[0];const s=r.filter(y=>y.playType==="TriggerEffect");if(s.length)return s.randomPick();if(this.duel.phase!=="main1"&&this.duel.phase!=="main2"){const y=r.filter(m=>m.playType==="IgnitionEffect");if(y.length)return y.randomPick()}const l=r.filter(y=>y.playType==="Battle").sort((y,m)=>(y.entity.atk??0)-(m.entity.atk??0));if(l.length)return l.find(y=>this.selectAttackTargetForNPC(y.entity,y));r=r.filter(y=>y.playType!=="Battle");const v=r.length?t.slice(-1)[0]:void 0,d=r.filter(y=>y.negatePreviousBlock);if(v&&v.activator!==this&&d)return d.randomPick();if(r=r.filter(y=>!y.negatePreviousBlock),!r.length)return;const f=Er(...this.getOpponentPlayer().getMonstersOnField().filter(y=>y.battlePosition==="Attack").map(y=>y.atk??0),1600),p=Ra(...this.getOpponentPlayer().getMonstersOnField().map(y=>y.battlePosition==="Set"?1500:(y.battlePosition==="Attack"?y.atk:y.def)??0),1500),g=this.getMonstersOnField(),c=Er(...g.filter(y=>y.battlePosition==="Attack").map(y=>y.atk??0),0);let h=r.filter(y=>y.playType!=="ChangeBattlePosition").filter(y=>y.entity.battlePosition!=="Attack").filter(y=>(y.entity.atk??0)>=f||(y.entity.atk??0)>p&&(y.entity.atk??0)>2300);if(h.length)return h.randomPick();r=r.filter(y=>y.playType!=="ChangeBattlePosition").filter(y=>y.playType!=="SpellTrapSet").filter(y=>y.entity.actions.filter(m=>m.playType!=="NormalSummon"&&m.playType!=="SpecialSummon").flatMap(m=>m.executableCells).every(m=>m!=="Hand")||y.playType!=="NormalSummon"&&y.playType!=="SpecialSummon");const S=[...r.filter(y=>y.playType==="NormalSummon").filter(y=>(y.entity.lvl??12)<5),...r.filter(y=>y.playType==="SpecialSummon"),...r.filter(y=>y.playType==="NormalSummon").filter(y=>(y.entity.atk??0)>2600||(y.entity.atk??0)>2300&&(y.entity.lvl??12)<7).filter(y=>(y.entity.atk??0)>=c),...r.filter(y=>y.entity.face==="FaceUp").filter(y=>y.entity.isOnField)];if(S.length)return S.randomPick();if(r=r.filter(y=>y.playType!=="NormalSummon").filter(y=>y.playType!=="SpecialSummon"),this.duel.phase==="main2"){if(h=e.filter(y=>y.playType==="ChangeBattlePosition").filter(y=>y.entity.battlePosition==="Attack").filter(y=>(y.entity.atk??0)<f||(y.entity.atk??0)>p&&(y.entity.atk??0)>2300),h.length)return h.randomPick();if(this.getAvailableSpellTrapZones.length>1)return e.filter(y=>y.playType==="SpellTrapSet").filter(y=>y.entity.status.kind!=="Spell"||y.entity.status.spellCategory==="QuickPlay").randomPick()}if(Math.random()<r.length/4)return r.randomPick()});this.duel=e,this.seat=t,this.profile=a,this.duelistType=r,this.deckInfo=n,this.initHand=s,this.lifeLog=[],this.infoOrigin={maxRuleNormalSummonCount:1,ruleNormalSummonCount:0,ruleNormalSummonCountQty:0,effectNormalSummonCount:0,effectNormalSummonCountQty:0,specialSummonCount:0,specialSummonCountQty:0},this.info={...this.infoOrigin},this.statusOrigin={maxSpecialSummonCount:Number.MAX_VALUE,canDrawByEffect:!0,canSearchFromDeck:!0,canDiscardAsCost:!0,canDiscardAsEffect:!0},this.status={...this.statusOrigin},this._lp=8e3;const l=[];this.duelistType==="NPC"&&(this.profile.npcLvl<1&&l.push("CardActivation","IgnitionEffect","TriggerEffect","QuickEffect"),this.profile.npcLvl<101&&l.push("Battle")),this.actionBlackListForNPC=l}get entity(){const e=this.getHandCell().entities.find(t=>t.entityType==="Duelist");return e||_e.createPlayerEntity(this)}get lp(){return this._lp}get isTurnPlayer(){return this.duel.getTurnPlayer()===this}get canDraw(){return!0}get canAddToHandFromDeck(){return!0}}class po{constructor(e){o(this,"cells");o(this,"duel");o(this,"procFilterPool");o(this,"numericStateOperatorPool");o(this,"cardRelationPool");o(this,"statusOperatorPool");o(this,"getAllCells",()=>this.cells.flat());o(this,"getCells",(...e)=>this.getAllCells().filter(t=>e.includes(t.cellType)));o(this,"getAllEntities",()=>this.getAllCells().map(e=>e.entities).flat());o(this,"getAllCardEntities",()=>this.getAllCells().map(e=>e.cardEntities).flat());o(this,"getMonstersOnField",()=>this.getCells(...Vi).map(e=>e.cardEntities).filter(e=>e.length>0).map(e=>e[0]));o(this,"getEntiteisOnField",()=>this.getCells(...ki).map(e=>e.cardEntities).filter(e=>e.length>0).map(e=>e[0]));o(this,"getEntities",e=>this.getAllEntities().filter(t=>t.controller===e));o(this,"drawAtSameTime",async(e,t,a,r,n,s)=>{const l=[],v=[],d=[e.draw(t,n,s),a.draw(r,n,s)].map(f=>f.catch(p=>{p instanceof Rt?p.winner&&l.push(p.winner):v.push(p)}));if(await Promise.all(d),v.length)throw new ke("ドロー処理で想定されない例外が発生した。",e,t,a,r,n,...v);if(l.length!==0)throw l.length===1?new Rt(l[0]):new Rt});o(this,"sendToGraveyard",async(e,t,a,r,n,s,l,v)=>{if(r>0&&a.length<r)return;const d=await this.duel.view.waitSelectEntities(t,a,r,n,e,v);if(d)return await _e.sendManyToGraveyard(d.map(f=>({entity:f,causedAs:s,causedBy:l,activator:t}))),this.duel.log.info(`${d.map(f=>f.status.name).join(", ")}を墓地に送った（${s.getDistinct().join(", ")}）。`,t),d});o(this,"release",async(e,t,a,r,n,s,l,v)=>{if(a>0&&t.length<a)return;const d=await this.duel.view.waitSelectEntities(e,t,a,p=>(l||p.length>0)&&(a<0||p.length===a),"リリースするモンスターを選択",v);if(!d)return;const f=[];for(const p of d)await p.release(["Release",r,...n],s,e),f.push(p);return this.duel.log.info(`${f.map(p=>p.status.name).join(", ")}をリリース（${f.flatMap(p=>p.moveLog.latestRecord.movedAs).getDistinct().join(", ")}）。`,e),f});o(this,"activateSpellTrapFromHand",async(e,t,a,r,n,s,l=!1)=>{const v=s??(n==null?void 0:n.controller)??t.controller;let d=a.randomPick();if(a.length>1&&v.duelistType!=="NPC"){const f=[Mt.createDammyAction(t,"カードの発動",a,void 0)];this.duel.view.modalController.selectAction(this.duel.view,{title:"カードを魔法罠ゾーンへドラッグ",activator:e,actions:f,cancelable:!1});const p=await this.duel.view.waitSubAction(v,f,"カードを魔法罠ゾーンへドラッグ。",l),g=p.action;if(!g&&!l)throw new ke("",p);if(!g)return;d=g.cell||d}return await t.activateSpellTrapFromHand(d,r,n,v),t});o(this,"setSpellTrap",async(e,t,a,r,n,s=!1)=>{let l=a[0];const v=n??(r==null?void 0:r.controller)??t.controller;if(a.length>1&&v.duelistType!=="NPC"){const d=[Mt.createDammyAction(t,"セット",a)],f=this.duel.view.modalController.selectAction(this.duel.view,{title:"カードをセット先へドラッグ",activator:e,actions:d,cancelable:s}),p=this.duel.view.waitSubAction(v,d,"カードをセット先へドラッグ",s),g=await Promise.any([f,p.then(c=>c.action)]);if(!g&&!s)throw new ke("",g);if(!g)return;l=g.cell||l}return await t.setAsSpellTrap(l,["SpellTrapSet"],r,v),this.duel.log.info(`${t.status.name}をセット（SpellTrapSet）。`,n??(r==null?void 0:r.controller)??t.controller),l});this.duel=e,this.cells=[...Array(7)].map(()=>[]);for(const t of Object.keys(Fa).map(Number))for(const a of Object.keys(Fa[t]).map(Number))this.cells[t][a]=new xl(this,t,a,t<3?e.duelists.Above:t>3?e.duelists.Below:a===0?e.duelists.Above:a===6?e.duelists.Below:void 0);this.procFilterPool=new Ml,this.numericStateOperatorPool=new ql,this.cardRelationPool=new Gl,this.statusOperatorPool=new Ql}}let ho=class{constructor(e){o(this,"onUpdateEvent",new Qe);o(this,"nextSeq");o(this,"records",[]);o(this,"duel");o(this,"dispose",()=>{this.onUpdateEvent.clear()});o(this,"error",e=>{console.error(e);const t=["エラー発生"];e instanceof Error?(e instanceof ke&&(t.push("-- エラーメッセージ --"),t.push(e.message),t.push("-- 関連オブジェクト --"),e.items.forEach(a=>t.push(JSON.stringify(a)))),t.push("-- エラー名称 --"),t.push(e.name||"エラー名称取得失敗"),t.push("-- スタックトレース --"),t.push(e.stack||"スタックトレース取得失敗")):(t.push("-- エラー型特定失敗 --"),t.push(JSON.stringify(e))),this.write("error",t)});o(this,"warn",e=>{this.write("warn",["【注意】",e])});o(this,"info",(e,t)=>{this.write("info",[e],t)});o(this,"write",(e,t,a)=>{const r=Array.isArray(t)?t.join(`
`):t;this.records.push({seq:this.nextSeq++,lvl:e,turn:this.duel.clock.turn,periodKey:this.duel.clock.period.key,clock:this.duel.clock,duelist:a,text:r}),this.onUpdateEvent.trigger()});this.nextSeq=0,this.duel=e}get onUpdate(){return this.onUpdateEvent.expose()}get lastRecord(){return this.records.slice(-1)[0]}};const xr=["DuelEntitiesSelector","DuelActionSelector","DuelTextSelector"];class go{constructor(e){o(this,"onUpdateEvent",new Qe);o(this,"states");o(this,"view");o(this,"cancelAll",()=>{xr.forEach(e=>this.states[e]="Disable"),console.info(this,"cancelAll"),this.onUpdateEvent.trigger()});o(this,"duelEntitiesSelectorArg",{title:"対象を選択",entities:[],validator:()=>!0,qty:-1,cancelable:!1});o(this,"duelEntitiesSelectorValue");o(this,"duelEntitiesSelectorResolve",()=>{});o(this,"selectDuelEntities",async e=>(this.duelEntitiesSelectorArg=e,this.states.DuelEntitiesSelector="Shown",this.onUpdateEvent.trigger(),new Promise(t=>{this.duelEntitiesSelectorResolve=a=>{this.states.DuelEntitiesSelector="Disable",this.onUpdateEvent.trigger(),t(a)}})));o(this,"cardActionSelectorArg",{title:"カード操作を選択。",activator:void 0,actions:[],cancelable:!1});o(this,"cardActionSelectorResolve",()=>{});o(this,"cardActionSelectorValue");o(this,"selectAction",async(e,t)=>(this.cardActionSelectorArg=t,this.states.DuelActionSelector="Shown",e.onWaitEnd.append(this.cancelAll),this.onUpdateEvent.trigger(),new Promise(a=>{this.cardActionSelectorResolve=r=>{this.states.DuelActionSelector="Disable",e.onWaitEnd.remove(this.cancelAll),this.onUpdateEvent.trigger(),a(r)}})));o(this,"duelTextSelectorArg",{title:"カード操作を選択。",choises:[],cancelable:!1});o(this,"duelTextSelectorResolve",()=>{});o(this,"duelTextSelectorValue");o(this,"selectText",async(e,t)=>(this.duelTextSelectorArg=t,this.states.DuelTextSelector="Shown",e.onWaitEnd.append(this.cancelAll),this.onUpdateEvent.trigger(),new Promise(a=>{this.duelTextSelectorResolve=r=>{this.states.DuelTextSelector="Disable",e.onWaitEnd.remove(this.cancelAll),this.onUpdateEvent.trigger(),a(r)}})));this.view=e,this.states=xr.reduce((t,a)=>(t[a]="Disable",t),{})}get onUpdate(){return this.onUpdateEvent.expose()}}const yo=i=>new Promise(e=>setTimeout(e,i)),_o=()=>{let i=()=>{},e=()=>{};return{promise:new Promise((a,r)=>{i=a,e=r}),resolve:i,reject:e}};class mo{constructor(e){o(this,"onDuelUpdateEvent",new Qe);o(this,"requireUpdate",()=>{this.onDuelUpdateEvent.trigger()});o(this,"onWaitStartEvent",new Qe);o(this,"onWaitEndEvent",new Qe);o(this,"onDragStartEvent",new Qe);o(this,"onDragEndEvent",new Qe);o(this,"onAnimationStartEvent",new Qe);o(this,"onShowCardEntityEvent",new Qe);o(this,"duel");o(this,"modalController");o(this,"_message");o(this,"waitMode");o(this,"infoBoardState");o(this,"infoBoardCell");o(this,"removeSvelteInfo",e=>{const t={...e};return t.selectedEntities&&(t.selectedEntities=_e.recreateArray(this.duel.field,t.selectedEntities)),t});o(this,"getCell",(e,t)=>this.duel.field.cells[e][t]);o(this,"showCardInfo",(e,t)=>{this.onShowCardEntityEvent.trigger({card:e,mode:t})});o(this,"dispose",()=>{this.onDragStartEvent.clear(),this.onDragEndEvent.clear(),this.onDuelUpdateEvent.clear(),this.onWaitStartEvent.clear(),this.onWaitEndEvent.clear()});o(this,"waitFieldAction",async e=>{if(this.duel.getTurnPlayer().duelistType==="NPC"){const t=this.duel.getTurnPlayer().selectActionForNPC(e,[]);return t?{action:t}:{phaseChange:this.duel.nextPhaseList[0]}}return await this._waitDuelistAction(this.duel.getTurnPlayer(),e,"SelectFieldAction","")});o(this,"waitQuickEffect",async(e,t,a,r,n)=>{if(t.length===0)return;if(e.duelistType==="NPC")return e.selectActionForNPC(t,a);const s=[];return s.push(this.modalController.selectAction(this,{title:r,activator:e,actions:t,cancelable:n}).then(l=>l&&l)),s.push(this._waitDuelistAction(e,t,"SelectAction",this.message).then(l=>(this.infoBoardState="Log",l.action))),await Promise.any(s)});o(this,"waitSubAction",async(e,t,a,r=!1)=>{if(e.duelistType==="NPC")throw Error("Not implemented");return await this._waitDuelistAction(e,t,"SelectAction",a,void 0,void 0,void 0,r)});o(this,"waitSelectEntities",async(e,t,a,r,n,s=!1)=>{let l=[];if(a&&t.length===a)return[...t];if(e.duelistType==="NPC"){for(;!r(l);){const d=a&&a>0?a:Math.floor(Math.random()*t.length)+1;l=t.randomPickMany(d)}return l}return this.waitMode=t.every(d=>(d.fieldCell.cellType==="MonsterZone"||d.fieldCell.cellType==="ExtraMonsterZone")&&d.getIndexInCell()===0||d.fieldCell.cellType==="Hand"&&d.controller===e)?"SelectFieldEntities":"SelectEntities",(await this._waitDuelistAction(e,[],this.waitMode,n,t,a,r,s)).selectedEntities});o(this,"_waitDuelistAction",async(e,t,a,r,n,s,l,v=!1)=>{this.waitMode=a,this._message=r,this.onDuelUpdateEvent.trigger();const d=_o(),f={resolve:d.resolve,activator:e,enableActions:t,qty:s,entitiesValidator:l||(()=>!1),selectableEntities:n||[]};n&&l&&this.waitMode==="SelectEntities"&&(f.duelEntitiesSelectorArg={title:r,entities:n,validator:l,qty:s??-1,cancelable:!1}),this.onWaitStartEvent.trigger(f);const p=await d.promise;if(this.waitMode="None",this.onWaitEndEvent.trigger(),p.surrender)throw new Rt(this.duel.duelists.Above);if(!v&&p.cancel)throw new ke("キャンセル不可のアクションがキャンセルされた。",p,t,a,n);return this.infoBoardState="Log",this.removeSvelteInfo(p)});o(this,"waitSelectSummonDest",async(e,t,a,r,n)=>{const s=a.length>1?"カードを召喚先へドラッグ。":"表示形式を選択。",l=r.map(p=>Mt.createDammyAction(t,p,a,p)),v=this.modalController.selectAction(t.field.duel.view,{title:s,activator:e,actions:l,cancelable:!1}),d=this.waitSubAction(t.controller,l,s,n).then(p=>p.action),f=await Promise.any([v,d]);if(!f&&!n)throw new ke("キャンセル不可のアクションがキャンセルされた。",f);if(f){if(!f.cell)throw new ke("召喚先のセルが指定されなかった。",f);if(!f.pos)throw new ke("表示形式が指定されなかった。",f);return{dest:f.cell,pos:f.pos}}});o(this,"waitSelectText",async(e,t,a=!1)=>this.duel.view.modalController.selectText(this.duel.view,{title:t,choises:e,cancelable:a}));o(this,"waitAnimation",async e=>(this._message="",this.waitMode="Animation",this.onDuelUpdateEvent.trigger(),new Promise(t=>this.onAnimationStartEvent.trigger({...e,resolve:t}))));o(this,"setDraggingActions",e=>{this.onDragStartEvent.trigger(e),this.requireUpdate()});o(this,"removeDraggingActions",()=>{this.onDragEndEvent.trigger()});this.duel=e,this._message="",this.waitMode="None",this.infoBoardState="Log",this.infoBoardCell=e.duelists.Below.getExtraDeck(),this.modalController=new go(this)}get onDuelUpdate(){return this.onDuelUpdateEvent.expose()}get onWaitStart(){return this.onWaitStartEvent.expose()}get onWaitEnd(){return this.onWaitEndEvent.expose()}get onDragStart(){return this.onDragStartEvent.expose()}get onDragEnd(){return this.onDragEndEvent.expose()}get onAnimation(){return this.onAnimationStartEvent.expose()}get onShowCardEntity(){return this.onShowCardEntityEvent.expose()}get message(){return this._message||this.duel.log.lastRecord.text}}class So{constructor(){o(this,"onTotalProcSeqChangeEvent",new Qe);o(this,"_turn",0);o(this,"_phaseSeq",0);o(this,"_stepSeq",0);o(this,"_stageSeq",0);o(this,"_chainSeq",0);o(this,"_chainBlockSeq",0);o(this,"_procSeq",0);o(this,"_procTotalSeq",0);o(this,"_periodKey");o(this,"setPhase",(e,t)=>{const a=Object.values(Bt).filter(r=>r.phase===t).find(r=>(r.step??"start")==="start");if(!a)throw new ke("想定されない状態",this.period,t,Bt);t==="draw"?(e.log.info("ターン終了。",e.getTurnPlayer()),this._turn++,this._phaseSeq=0):(e.log.info(`フェイズ移行（${this.period.name}→${a.name}）`,e.getTurnPlayer()),this._phaseSeq++),this._stepSeq=0,this._stageSeq=0,this._chainSeq=0,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq(),this._periodKey=a.key});o(this,"setStep",(e,t)=>{const a=this.period.phase,r=Object.values(Bt).filter(n=>n.phase===a).find(n=>(n.step??"")===t);if(!r)throw new ke("想定されない状態",this.period,t,Bt);this.period.name!==r.name&&(e.log.info(`ステップ移行（${this.period.name}→${r.name}）`,e.getTurnPlayer()),this._stepSeq++,this._stageSeq=0,this._chainSeq=0,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq(),this._periodKey=r.key)});o(this,"setStage",(e,t)=>{const a=this.period,r=Object.values(Bt).filter(n=>n.phase===a.phase).filter(n=>n.step===a.step).find(n=>(n.stage??"")===t);if(!r)throw new ke("想定されない状態",this.period,t,Bt);e.log.info(`タイミング移行（${this.period.name}→${r.name}）`,e.getTurnPlayer()),this._stageSeq++,this._chainSeq=0,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq(),this._periodKey=r.key});o(this,"incrementChainSeq",()=>{this._chainSeq++,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq()});o(this,"incrementChainBlockSeq",()=>{this._chainBlockSeq++,this._procSeq=0,this.incrementTotalProcSeq()});o(this,"incrementProcSeq",()=>{this._procSeq++,this.incrementTotalProcSeq()});o(this,"incrementTotalProcSeq",()=>{this._procTotalSeq++,this.onTotalProcSeqChangeEvent.trigger(this.totalProcSeq)});o(this,"toString",()=>`${this.totalProcSeq}(t${this.turn}-phs${this.phaseSeq}-stp${this.stepSeq}-stg${this.stepSeq}-c${this.chainSeq}-cb${this.chainBlockSeq}-prc${this.procSeq})`);o(this,"getClone",()=>({turn:this.turn,phaseSeq:this.phaseSeq,stepSeq:this.stepSeq,stageSeq:this.stageSeq,chainSeq:this.chainSeq,chainBlockSeq:this.chainBlockSeq,procSeq:this.procSeq,totalProcSeq:this.totalProcSeq}));o(this,"isSameChain",e=>this.turn===e.turn&&this.phaseSeq===e.phaseSeq&&this.stepSeq===e.stepSeq&&this.stageSeq===e.stageSeq&&this.chainSeq===e.chainSeq);o(this,"isPreviousChain",e=>this.turn===e.turn&&this.phaseSeq===e.phaseSeq&&this.stepSeq===e.stepSeq&&this.stageSeq===e.stageSeq&&this.chainSeq===e.chainSeq+1);o(this,"isPreviousProc",e=>this.totalProcSeq===e.totalProcSeq+1);o(this,"isUponAttackDeclaration",()=>this.period.step==="battle"&&this.chainSeq===1);this._periodKey="end"}get onTotalProcSeqChange(){return this.onTotalProcSeqChangeEvent.expose()}get period(){return Bt[this._periodKey]}get turn(){return this._turn}get phaseSeq(){return this._phaseSeq}get stepSeq(){return this._stepSeq}get stageSeq(){return this._stageSeq}get chainSeq(){return this._chainSeq}get chainBlockSeq(){return this._chainBlockSeq}get procSeq(){return this._procSeq}get totalProcSeq(){return this._procTotalSeq}get isFirstChain(){return this.chainSeq===0}}class bo{constructor(e){o(this,"nextSeq");o(this,"records",[]);o(this,"duel");o(this,"push",(e,t)=>{this.records.push({seq:this.nextSeq++,clock:this.duel.clock.getClone(),activator:e,cardAction:t})});this.nextSeq=0,this.duel=e}}const Pr={PlayFirst:"先攻",DrawFirst:"後攻",Random:"ランダム"};class Rt extends Error{constructor(t){const a=t?`デュエルが終了した。勝者：${t.profile.name}`:"デュエルが終了した。ドロー。";super(a);o(this,"winner");this.winner=t}}class ke extends Error{constructor(t,...a){super(t);o(this,"message");o(this,"items");this.message=t,this.items=a}}class Lt extends ke{constructor(...e){super("キャンセル不可のアクションがキャンセルされた。",...e)}}class wo{constructor(e,t,a,r=[],n,s,l,v=[],d="Random"){o(this,"view");o(this,"log");o(this,"cardActionLog");o(this,"clock");o(this,"nextPhaseList");o(this,"field");o(this,"attackingMonster");o(this,"targetForAttack");o(this,"_chainBlockInfos");o(this,"duelists");o(this,"priorityHolder");o(this,"isEnded");o(this,"coin",!1);o(this,"startMode");o(this,"distributeOperators",e=>{console.info(`[totalProcSeq]:${e}`);let t=0;for(;;){if(t++,t>10)throw new ke("無限ループ発生");if(this.field.procFilterPool.distributeAll(this)&&this.field.statusOperatorPool.distributeAll(this)&&this.field.cardRelationPool.distributeAll(this)&&this.field.numericStateOperatorPool.distributeAll(this))return}});o(this,"getTurnPlayer",()=>this.clock.turn%2===0?this.secondPlayer:this.firstPlayer);o(this,"getNonTurnPlayer",()=>this.clock.turn%2===0?this.firstPlayer:this.secondPlayer);o(this,"main",async()=>{console.info("main start!"),this.coin=this.startMode==="PlayFirst"?!0:this.startMode==="DrawFirst"?!1:Math.random()>.5,this.priorityHolder=this.firstPlayer,this.log.info("【デュエル開始】"),this.log.info(`先攻：${this.firstPlayer.profile.name}`),Object.values(this.duelists).forEach(e=>e.pushDeck()),Object.values(this.duelists).forEach(e=>e.getDeckCell().shuffle()),Object.values(this.duelists).forEach(e=>{e.initHand.length&&e.initHand.forEach(t=>{const a=e.getDeckCell().cardEntities.find(r=>r.origin.name===t);if(!a){this.log.info(`初手操作により${t}を手札に加えようとしたが、デッキに存在しない。`);return}a.addToHand(["System"],void 0,void 0),this.log.info(`初手操作により${a.toString()}を手札に加えた`,e)})}),await Promise.all(Object.values(this.duelists).map(e=>e.draw(5-e.getHandCell().cardEntities.length,void 0,void 0))),this.moveNextPhase("draw"),this.view.requireUpdate();try{for(;!this.isEnded&&(this.clock.period.phase==="draw"?await this.procDrawPhase():this.phase==="standby"?await this.procStanbyPhase():this.phase==="main1"?await this.procMainPhase():this.phase==="battle1"?await this.procBattlePhase():this.phase==="battle2"?await this.procBattlePhase():this.phase==="main2"?await this.procMainPhase():this.phase==="end"&&await this.procEndPhase(),!(this.clock.turn>1e3)););}catch(e){e instanceof Rt?(console.info(e),this.isEnded=!0,this.log.info(e.winner?`デュエル終了。勝者${e.winner.profile.name}`:"引き分け")):e instanceof Error&&this.log.error(e)}finally{this.view.requireUpdate(),this.view.dispose(),this.log.dispose()}});o(this,"moveNextPhase",e=>{this.clock.setPhase(this,e),this.phase==="main2"||this.clock.turn===1?this.nextPhaseList=["end"]:this.phase==="battle1"||this.phase==="battle2"?this.nextPhaseList=["main2"]:this.phase==="main1"?this.nextPhaseList=["battle1","end"]:this.nextPhaseList=[]});o(this,"declareAnAttack",(e,t)=>{this.attackingMonster=e,this.targetForAttack=t,e.info.attackCount++,this.log.info(`攻撃宣言：${e.status.name} ⇒ ${t.status.name}`,e.controller)});o(this,"procDrawPhase",async()=>{for(Object.values(this.duelists).forEach(e=>e.initForDrawPhase()),this.log.info("ドローフェイズ開始。",this.getTurnPlayer()),this.clock.turn===1?this.log.info("先攻プレイヤーはドローできない。",this.getTurnPlayer()):await this.getTurnPlayer().draw(1,void 0,void 0);await this.procChainBlock(void 0,void 0););this.field.getEntiteisOnField().forEach(e=>e.initForTurn()),this.moveNextPhase("standby")});o(this,"procStanbyPhase",async()=>{for(;await this.procChainBlock(void 0,void 0););this.moveNextPhase("main1")});o(this,"procMainPhase",async()=>{for(;;){this.priorityHolder=this.getTurnPlayer();const e=await this.view.waitFieldAction(this.getEnableActions(this.priorityHolder,["NormalSummon","SpellTrapSet","SpecialSummon","ChangeBattlePosition","IgnitionEffect","MandatoryIgnitionEffect","QuickEffect","CardActivation"],["Normal","Quick","Counter"],[]));if(e&&e.action){if([...Pl].includes(e.action.playType)){const a=await e.action.prepare(this.priorityHolder,e.action.cell,[],!0);if(a===void 0)continue;await e.action.execute(a,this.chainBlockInfos),this.clock.incrementChainSeq()}else await this.procChainBlock({activator:this.priorityHolder,action:e.action},void 0);for(;await this.procChainBlock(void 0,void 0););continue}const t=e.phaseChange;if(t){this.priorityHolder=this.getNonTurnPlayer();const a=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(this.priorityHolder,["QuickEffect","TriggerEffect"],["Quick","Counter"],[]),[],"",!0);if(a){for(await this.procChainBlock({activator:this.priorityHolder,action:a},void 0);await this.procChainBlock(void 0,void 0););continue}this.moveNextPhase(t);return}}});o(this,"procBattlePhase",async()=>{await this.procBattlePhaseStartStep(),await this.procBattlePhaseBattleStep(),await this.procBattlePhaseEndStep()});o(this,"procBattlePhaseStartStep",async()=>{for(this.clock.setStep(this,"start"),this.priorityHolder=this.getTurnPlayer(),this.attackingMonster=void 0,this.targetForAttack=void 0;await this.procChainBlock(void 0,void 0););});o(this,"procBattlePhaseBattleStep",async()=>{for(;;){this.clock.setStep(this,"battle"),this.priorityHolder=this.getTurnPlayer();const e=await this.view.waitFieldAction(this.getEnableActions(this.priorityHolder,["Battle"],["Normal"],[]));if(e.phaseChange)break;if(e.action){console.log(e.action,e.action.cell);const t=await e.action.prepare(this.priorityHolder,e.action.cell,[],!0);if(!t)continue;await e.action.execute(t,[]),this.clock.incrementChainSeq();let a=!0;for(;;){const r=this.getNonTurnPlayer().getMonstersOnField().map(s=>[s.seq,s.moveLog.latestRecord.movedAt.totalProcSeq]);for(;await this.procChainBlock(void 0,void 0););if(!this.attackingMonster)throw new ke("想定されない状態");this.attackingMonster.isOnField?this.attackingMonster.face==="FaceDown"?(this.log.info(`${this.attackingMonster.toString()}が裏側守備表示になったため、戦闘が中断された。`),a=!1):this.attackingMonster.orientation==="Horizontal"&&(this.log.info(`${this.attackingMonster.toString()}が守備表示になったため、戦闘が中断された。`),a=!1):(this.log.info(`${this.attackingMonster.toString()}がフィールドにいなくなったため、戦闘が中断された。`),a=!1);const n=this.getNonTurnPlayer().getMonstersOnField().map(s=>[s.seq,s.moveLog.latestRecord.movedAt.totalProcSeq]);if(r.length!==n.length)throw this.log.info("モンスターの数が増減したためバトルステップの巻き戻しが発生。"),new ke("巻き戻し未実装");if(r.some(([s,l])=>n.every(([v,d])=>v!==s||d!==l)))throw this.log.info("モンスターの数が増減したためバトルステップの巻き戻しが発生。"),new ke("巻き戻し未実装");break}if(!a)continue;await this.procBattlePhaseDamageStep(t)}}});o(this,"procBattlePhaseDamageStep",async e=>{if(!this.attackingMonster||!this.targetForAttack)throw new ke("想定されない状態",this.attackingMonster,this.targetForAttack);await this.procBattlePhaseDamageStep1(),await this.procBattlePhaseDamageStep2(this.attackingMonster,this.targetForAttack),await this.procBattlePhaseDamageStep3(e,this.attackingMonster,this.targetForAttack),await this.procBattlePhaseDamageStep4(),await this.procBattlePhaseDamageStep5()});o(this,"procBattlePhaseDamageStep1",async()=>{for(this.clock.setStage(this,"start");await this.procChainBlock(void 0,void 0););});o(this,"procBattlePhaseDamageStep2",async(e,t)=>{for(this.clock.setStage(this,"beforeDmgCalc"),(t==null?void 0:t.battlePosition)==="Set"&&t.setBattlePosition("Defense",["Flip","FlipByBattle"],e,e.controller);await this.procChainBlock(void 0,void 0););});o(this,"procBattlePhaseDamageStep3",async(e,t,a)=>{if(t.atk===void 0)throw new ke("想定されない状態",this.attackingMonster,this.targetForAttack);for(this.clock.setStage(this,"dmgCalc");await this.procChainBlock(void 0,void 0););const r=t.atk,n=(a.battlePosition==="Attack"?a.atk:a.def)??0;if(a.entityType==="Duelist")t.controller.getOpponentPlayer().battleDamage(r-n,t);else{r>0&&r>n&&a.battlePosition==="Attack"?t.controller.getOpponentPlayer().battleDamage(r-n,t):r<n&&t.controller.battleDamage(n-r,a);const l=[];r>0&&(r>n||r===n&&a.battlePosition==="Attack")&&l.push(a.tryDestory("BattleDestroy",t.controller,t,e.action)),a.battlePosition==="Attack"&&r<=n&&l.push(t.tryDestory("BattleDestroy",t.controller,a,e.action)),await Promise.all(l)}const s=Object.values(this.duelists).filter(l=>l.lp<=0);if(s.length>0)throw new Rt(Object.values(this.duelists).filter(l=>!s.includes(l)).pop())});o(this,"procBattlePhaseDamageStep4",async()=>{for(this.clock.setStage(this,"afterDmgCalc");await this.procChainBlock(void 0,void 0););});o(this,"procBattlePhaseDamageStep5",async()=>{for(this.clock.setStage(this,"end"),await _e.waitCorpseDisposal(this),this.clock.incrementChainSeq();await this.procChainBlock(void 0,void 0););});o(this,"procBattlePhaseEndStep",async()=>{this.clock.setStep(this,"end"),this.priorityHolder=this.getTurnPlayer(),await this.procSpellSpeed1(),this.moveNextPhase("main2")});o(this,"procEndPhase",async()=>{for(await this.procSpellSpeed1();;){const t=this.getTurnPlayer().getHandCell().cardEntities.length;if(t<7)break;await this.getTurnPlayer().discard(t-6,["Rule"])}this.moveNextPhase("draw")});o(this,"procSpellSpeed1",async()=>{this.priorityHolder=this.getTurnPlayer();let e=0;for(;e<2;){this.priorityHolder=this.priorityHolder.getOpponentPlayer();const t=this.getEnableActions(this.priorityHolder,["IgnitionEffect","MandatoryIgnitionEffect","QuickEffect","CardActivation"],["Normal","Quick","Counter"],[]),a=t.every(n=>n.playType!=="MandatoryIgnitionEffect")||e<2;let r=t.find(n=>n.playType==="MandatoryIgnitionEffect");if((t.length!==1||t[0].playType!=="MandatoryIgnitionEffect")&&(r=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(this.priorityHolder,["IgnitionEffect","MandatoryIgnitionEffect","QuickEffect","CardActivation"],["Normal","Quick","Counter"],[]),[],a?"":"まだ発動しなければならない効果が残っている。",a)),r){await this.procChainBlock({activator:this.priorityHolder,action:r},void 0),await this.procFreeChain(),this.priorityHolder=this.getTurnPlayer(),e=0;continue}e++}});o(this,"procFreeChain",async()=>{for(;await this.procChainBlock(void 0,void 0););});o(this,"procChainBlock",async(e,t)=>{const a=this.clock.chainBlockSeq===0;let r=t??Object.values(this.duelists).flatMap(l=>this.getEnableActions(l,["MandatoryTriggerEffect","TriggerEffect"],["Normal"],[]).map(v=>(console.log(l,v),{activator:l,action:v}))),n=!1,s;if(e)s=e,this.priorityHolder=s.activator,n=!0;else if(r.length>0){const l=await this.selectTriggerEffect(r);l&&(r=r.filter(v=>v!==l),s=l,this.priorityHolder=s.activator,n=!0)}if(!n){let l=0;for(;l<2;){this.priorityHolder=this.priorityHolder.getOpponentPlayer();const v=["Counter"];this.chainBlockInfos.every(p=>p.action.spellSpeed!=="Counter")&&v.push("Quick");const d=this.chainBlockInfos.length?"":"クイックエフェクト発動タイミング。効果を発動しますか？",f=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(this.priorityHolder,["QuickEffect","CardActivation"],v,this.chainBlockInfos),this.chainBlockInfos,d,!0);if(f){s={activator:this.priorityHolder,action:f},n=!0;break}l++}}if(console.info("selected action: ",s),s){const l=s.activator,v=this.clock.chainBlockSeq+1;this.log.info(`チェーン${v}: ${Ft(s.action)}を発動`,l);const d=await s.action.prepare(l,s.action.cell,this.chainBlockInfos,!1);if(!d)throw new Lt(s);const f=d.action.entity.isNagatedStrongly&&ki.find(p=>p===d.isActivatedIn.cellType);if(d.selectedEntities.length&&this.log.info(`対象⇒${d.selectedEntities.map(p=>p.toString()).join(" ")}`),this._chainBlockInfos.push(d),this.clock.incrementProcSeq(),this.clock.incrementChainBlockSeq(),await this.procChainBlock(void 0,r.filter(p=>p.action.seq!==(s==null?void 0:s.action.seq))),this.log.info(`チェーン${v}: ${Ft(d.action)}の効果処理。`,l),d.isNegatedActivationBy)this.log.info(`チェーン${v}: ${Ft(s.action)}を${Ft(d.isNegatedActivationBy)}によって発動を無効にした。`,d.activator);else{let p=d.action.entity.isEffective,g=`チェーン${v}: カードの効果が無効となっているため${Ft(s.action)}の効果処理を行えない。`;if(p){if(d.isNegatedEffectBy)g=`チェーン${v}: ${Ft(d.action)}を${Ft(d.isNegatedEffectBy)}によって効果を無効にした。`,p=!1;else if(f){const c=d.action.entity.moveLog.records.findLast(h=>h.face==="FaceDown"&&h.orientation==="Horizontal");p=(c&&this.clock.isSameChain(c.movedAt))??!1}}p?await d.action.execute(d,this.chainBlockInfos):this.log.info(g,d.activator),await s.action.settle(d,this.chainBlockInfos)}this.clock.incrementProcSeq(),a&&(await _e.sendManyToGraveyardForTheSameReason(this._chainBlockInfos.filter(p=>p.action.playType==="CardActivation").filter(p=>!p.action.isLikeContinuousSpell).map(p=>p.action.entity).filter(p=>p.isOnField).filter(p=>p.face==="FaceUp"),["Rule"],void 0,void 0),this._chainBlockInfos.reset(),this.clock.incrementChainSeq())}return n});o(this,"selectTriggerEffect",async e=>{if(e.length>0)for(const t of["MandatoryTriggerEffect","TriggerEffect"])for(const a of[this.getTurnPlayer(),this.getNonTurnPlayer()]){const r=e.filter(s=>s.action.playType===t&&s.activator===a);if(r.length===0)continue;if(r.length===1&&t==="MandatoryTriggerEffect")return r[0];const n=await this.view.waitQuickEffect(a,r.map(s=>s.action),this.chainBlockInfos,"誘発効果を選択。",t==="TriggerEffect");if(n)return{activator:a,action:n}}});o(this,"getEnableActions",(e,t,a,r)=>this.field.getAllCardEntities().flatMap(n=>n.actions).filter(n=>n.executableCells.includes(n.entity.fieldCell.cellType)).filter(n=>n.executablePeriods.includes(this.clock.period.key)).filter(n=>t.includes(n.playType)).filter(n=>a.includes(n.spellSpeed)).filter(n=>n.executableDuelists.includes(e)).filter(n=>n.validate(e,r)));this.clock=new So,this.nextPhaseList=[],this.isEnded=!1,this.startMode=d,this.duelists={Below:new Ar(this,"Below",e,t,a,r),Above:new Ar(this,"Above",n,s,l,v)},this.priorityHolder=this.firstPlayer,this._chainBlockInfos=[],this.field=new po(this),this.clock.onTotalProcSeqChange.append(this.distributeOperators),this.view=new mo(this),this.log=new ho(this),this.cardActionLog=new bo(this)}get phase(){return this.clock.period.phase}get step(){return this.clock.period.step}get stage(){return this.clock.period.stage}get chainBlockInfos(){return this._chainBlockInfos}get firstPlayer(){return this.coin?this.duelists.Below:this.duelists.Above}get secondPlayer(){return this.coin?this.duelists.Above:this.duelists.Below}}_e.prototype.hasBeenSummonedNow=function(i,e=["Attack","Defense"]){const t=this,a=e.map(An),r=t.moveLog.latestRecord.movedAs;return console.log(t,t.moveLog.records),!(!t.wasMovedAtPreviousChain||!r.union(i).length||!r.union(a).length)};_e.prototype.getAttackTargets=function(){if(!this.hasAttackRight())return[];const i=this.duel.field.getMonstersOnField().filter(e=>e.status.isSelectableForAttack).filter(e=>e.controller!==this.controller);return(this.status.canDirectAttack||!i.length)&&i.push(this.controller.getOpponentPlayer().entity),i.filter(e=>e.canBeTargetOfBattle(this.controller,this)).filter(e=>this.procFilterBundle.operators.filter(t=>t.procTypes.includes("BattleTarget")).every(t=>t.filter(this.controller,this,{},[e])))};_e.prototype.canDirectAttack=function(){return this.getAttackTargets().some(i=>i.entityType==="Duelist")};_e.prototype.canAttackToMonster=function(){return this.getAttackTargets().some(i=>i.entityType!=="Duelist")};_e.prototype.hasAttackRight=function(){return this.battlePosition==="Attack"&&this.info.attackCount===0&&this.status.canAttack};_e.prototype.canBeEffected=function(i,e,t){return this.procFilterBundle.operators.filter(r=>r.procTypes.some(n=>n==="Effect")).every(r=>r.filter(i,e,t,[this]))};_e.prototype.canBeTargetOfEffect=function(i,e,t){return this.procFilterBundle.operators.filter(r=>r.procTypes.some(n=>n==="EffectTarget")).every(r=>r.filter(i,e,t,[this]))};_e.prototype.canBeSpecialSummoned=function(i,e,t,a){var n,s;const r=this;return(n=r.origin.monsterCategories)!=null&&n.includes("NormalSummonOnly")||(s=r.origin.monsterCategories)!=null&&s.includes("SpecialSummon")&&!r.info.isRebornable&&(r.fieldCell.cellType==="Graveyard"||this.fieldCell.cellType==="Banished")?!1:r.procFilterBundle.operators.filter(l=>l.procTypes.some(v=>v==="SpecialSummon"||v===i)).every(l=>l.filter(e,t,a,[r]))};_e.prototype.canBeTargetOfBattle=function(i,e){const t=this;return t.procFilterBundle.operators.filter(a=>a.procTypes.some(r=>r==="BattleTarget")).every(a=>a.filter(i,e,{},[t]))};_e.prototype.tryDestory=async function(i,e,t,a){const r=this;return r.info.isDying=r.validateDestory(i,e,t,a),r.info.isDying&&(r.duel.log.info(`${r.toString()}を${vo[i]}`,t.controller),r.info.causeOfDeath=[i],r.info.isKilledBy=t,r.info.isKilledByWhom=t.controller),r.info.isDying};_e.prototype.validateDestory=function(i,e,t,a){const r=this;return r.procFilterBundle.operators.filter(n=>n.procTypes.includes(i)).every(n=>n.filter(e,t,a??{},[r]))};_e.prototype.canBeMaterials=function(i,e,t){return this.procFilterBundle.operators.filter(r=>r.procTypes.some(n=>n===i)).every(r=>r.filter(e.entity.controller,e.entity,e,t))};_e.prototype.getIndexInCell=function(){const i=this;if(i.info.isVanished)return-1;const e=i.fieldCell.cardEntities.indexOf(i);if(e<0)throw new ke("エンティティとセルの状態が矛盾している。",[i,i.fieldCell]);return e};class va{constructor(){}}o(va,"tryDestroy",async(e,t)=>{const a=e.filter(n=>!n.info.isDying);await Promise.all(a.map(n=>n.tryDestory("EffectDestroy",t.activator,t.action.entity,t.action)));const r=a.filter(n=>n.info.isDying);return await _e.waitCorpseDisposal(t.activator.duel),r});const To=()=>{const i=[];["サイバー・ドラゴン","六武衆のご隠居","アンノウン・シンクロン"].forEach(f=>i.push({name:f,actions:[ze,He,$e,{title:"特殊召喚",playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:f==="アンノウン・シンクロン"?1:void 0,validate:p=>{const g=p.action.entity.field.getMonstersOnField();if(!(g.length==0||g.some(c=>c.controller===p.activator)))return kr(p,["Attack","Defense"],[])},prepare:(p,g,c,h)=>Cr(p,g,["Attack","Defense"],[],h),execute:Dr,settle:async()=>!0}]}));const e={name:"ジャンク・フォアード",actions:[ze,He,$e,{title:"特殊召喚",playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:f=>{if(!f.activator.getMonstersOnField().length)return kr(f,["Attack","Defense"],[])},prepare:(f,p,g,c)=>Cr(f,p,["Attack","Defense"],[],c),execute:Dr,settle:async()=>!0}]};i.push(e);const t={name:"Ｄ－ＨＥＲＯ ディアボリックガイ",actions:[ze,He,$e,{title:"①リクルート",playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:10,validate:f=>f.activator.getDeckCell().cardEntities.filter(g=>g.nm==="Ｄ－ＨＥＲＯ ディアボリックガイ").length===0?void 0:f.activator.getAvailableMonsterZones().length>0?[]:void 0,prepare:async f=>(await f.action.entity.banish(["Cost"],f.action.entity,f.activator),{selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async f=>{const p=f.activator.getAvailableMonsterZones();if(!p.length)return!1;const g=f.activator.getDeckCell().cardEntities.find(c=>c.nm==="Ｄ－ＨＥＲＯ ディアボリックガイ");return g?(await f.activator.summon(g,["Attack","Defense"],p,"SpecialSummon",["Effect"],f.action.entity,!1),f.activator.getDeckCell().shuffle(),!0):!1},settle:async()=>!0}]};i.push(t);const a={name:"ゾンビキャリア",actions:[ze,He,$e,{title:"①自己再生",playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:f=>f.activator.getHandCell().cardEntities.length===0?void 0:f.activator.getAvailableMonsterZones().length>0?[]:void 0,prepare:async f=>{const p=f.activator.getHandCell().cardEntities,g=await f.activator.duel.view.waitSelectEntities(f.activator,p,1,c=>c.length===1,"デッキトップに戻すカードを一枚選択。");if(!g)throw new Lt(f);return await g[0].returnToDeck("Top",["Cost"],f.action.entity,f.activator),{selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}},execute:async f=>{if(f.action.entity.wasMovedAtCurrentChain)return!1;const p=f.activator.getAvailableMonsterZones();return p.length===0?!1:(await f.activator.summon(f.action.entity,["Attack","Defense"],p,"SpecialSummon",["Effect"],f.action.entity,!1),f.action.entity.info.willBeBanished=!0,!0)},settle:async()=>!0}]};i.push(a);const r={name:"グローアップ・バルブ",actions:[ze,He,$e,{title:"①自己再生",playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:1,validate:f=>f.activator.getDeckCell().cardEntities.length===0?void 0:f.activator.getAvailableMonsterZones().length>0?[]:void 0,prepare:async f=>(await f.activator.getDeckCell().cardEntities[0].sendToGraveyard(["Cost"],f.action.entity,f.activator),{selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:async f=>{if(f.action.entity.wasMovedAtCurrentChain)return!1;const p=f.activator.getAvailableMonsterZones();return p.length===0?!1:(await f.activator.summon(f.action.entity,["Attack","Defense"],p,"SpecialSummon",["Effect"],f.action.entity),!0)},settle:async()=>!0}]};i.push(r);const n={name:"終末の騎士",actions:[ze,He,$e,{title:"①墓地送り",playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...dt,...Kt],executableDuelistTypes:["Controller"],validate:f=>{if(f.action.entity.hasBeenSummonedNow(["NormalSummon","SpecialSummon","FlipSummon"])&&f.activator.getDeckCell().cardEntities.filter(p=>p.attr.includes("Dark")).length!==0)return[]},prepare:async f=>{const p=["SendToGraveyardFromDeck"];return f.action.entity.moveLog.latestRecord.movedAs.includes("NormalSummon")?p.push("IfNormarlSummonSucceed"):p.push("IfSpecialSummonSucceed"),{selectedEntities:[],chainBlockTags:p,prepared:void 0}},execute:async f=>{const p=f.activator.getDeckCell().cardEntities.filter(g=>g.attr.includes("Dark"));return p.length===0?!1:(await f.action.entity.field.sendToGraveyard("墓地に送るモンスターを選択",f.activator,p,1,g=>g.length===1,["Effect"],f.action.entity,!1),f.activator.getDeckCell().shuffle(),!0)},settle:async()=>!0}]};i.push(n);const s={name:"マスマティシャン",actions:[ze,He,$e,{title:"①墓地送り",playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...dt,...Kt],executableDuelistTypes:["Controller"],validate:f=>{if(f.action.entity.hasBeenSummonedNow(["NormalSummon"])&&f.activator.getDeckCell().cardEntities.find(p=>(p.lvl??5)<5))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["IfNormarlSummonSucceed","SendToGraveyardFromDeck"],prepared:void 0}),execute:async f=>{const p=f.activator.getDeckCell().cardEntities.filter(g=>(g.lvl??5)<5);return p.length===0?!1:(await f.action.entity.field.sendToGraveyard("墓地に送るモンスターを選択",f.activator,p,1,g=>g.length===1,["Effect"],f.action.entity,!1),f.activator.getDeckCell().shuffle(),!0)},settle:async()=>!0},{title:"②ドロー",playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...dt,...Kt],executableDuelistTypes:["Controller"],validate:f=>{if(f.action.entity.face!=="FaceDown"&&f.action.entity.moveLog.latestRecord.movedAs.includes("BattleDestroy")&&f.action.entity.wasMovedAtPreviousChain&&f.activator.getDeckCell().cardEntities.length!==0)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async f=>(await f.activator.draw(1,f.action.entity,f.activator),!0),settle:async()=>!0}]};i.push(s);const l={name:"ライトロード・ビースト ウォルフ",actions:[He,$e,{title:"①自己再生",playType:"MandatoryTriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...dt,...Kt],executableDuelistTypes:["Controller"],validate:f=>{if(f.action.entity.wasMovedAtPreviousChain&&f.action.entity.wasMovedFrom.cellType==="Deck")return f.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:async f=>{if(f.action.entity.wasMovedAtCurrentChain)return!1;const p=f.activator.getAvailableMonsterZones();return!p.length||f.action.entity.fieldCell.cellType!=="Graveyard"&&f.action.entity.fieldCell.cellType!=="Banished"||f.action.entity.face==="FaceDown"?!1:(await f.activator.summon(f.action.entity,["Attack","Defense"],p,"SpecialSummon",["Effect"],f.action.entity),!0)},settle:async()=>!0}]};i.push(l);const v={name:"伝説の白石",actions:[He,$e,ze,{title:"①サーチ",playType:"MandatoryTriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:er,executableDuelistTypes:["Controller"],validate:f=>{if(f.action.entity.wasMovedAtPreviousChain&&f.action.entity.wasMovedFrom.cellType!=="Banished")return f.activator.getDeckCell().cardEntities.find(p=>p.nm==="青眼の白龍")?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async f=>{const p=f.activator.getDeckCell().cardEntities.find(g=>g.nm==="青眼の白龍");return p?(await p.addToHand(["Effect"],f.action.entity,f.activator),f.activator.getDeckCell().shuffle(),!0):!1},settle:async()=>!0}]};return i.push(v),[{name:"灰流うらら",chainBlockTags:["Draw","SearchFromDeck","SendToGraveyardFromDeck","SpecialSummonFromDeck"]},{name:"屋敷わらし",chainBlockTags:["BanishFromGraveyard","SpecialSummonFromGraveyard","AddToHandFromGraveyard"]}].forEach(f=>{i.push({name:f.name,actions:[He,$e,ze,{title:"①無効化",playType:"QuickEffect",spellSpeed:"Quick",executableCells:["Hand"],executablePeriods:dt,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,negatePreviousBlock:!0,validate:(p,g)=>g.length===0?void 0:g.slice(-1)[0].chainBlockTags.union(f.chainBlockTags).length>0?[]:void 0,prepare:async(p,g,c)=>(await p.action.entity.sendToGraveyard(["Discard","Cost"],p.action.entity,p.activator),{selectedEntities:[],chainBlockTags:["NegateCardEffect"],prepared:c.length}),execute:async(p,g)=>{const c=g[p.prepared-1];return c.isNegatedEffectBy=p.action,!0},settle:async()=>!0}]})}),["翻弄するエルフの剣士","ロードランナー","氷結界の修験者"].forEach(f=>{i.push({name:f,actions:[He,$e,ze],continuousEffects:[Ul("①戦闘破壊耐性","Monster",p=>[p],()=>!0,p=>[new Bl("①戦闘破壊耐性",()=>!0,!0,p,{},()=>!0,["BattleDestroy"],(g,c)=>!p.isEffective||(c.atk??0)<1900?!0:(p.duel.log.info(`${p.toString()}は攻撃力1900以上のモンスターとの先頭では破壊されない。`,p.controller),!1))])]})}),i},ko=i=>{if(i.action.entity.status.spellCategory==="Field")return[i.activator.getFieldZone()];const e=i.activator.getAvailableSpellTrapZones();return e.length>0?e:void 0},Co=async(i,e)=>{if(i.action.entity.status.spellCategory==="Field"){const r=i.activator.getFieldZone(),n=r.cardEntities[0];return await _e.sendManyToGraveyardForTheSameReason(r.cardEntities,["Rule"],i.action.entity,i.activator),i.activator.duel.log.info(`フィールド魔法の上書きにより、${n.toString()}は墓地に送られた。`,i.activator),{selectedEntities:[],chainBlockTags:[],prepared:{dest:r}}}if(e)return{selectedEntities:[],chainBlockTags:[],prepared:{dest:e}};const t=i.activator.getAvailableSpellTrapZones();if(t.length===0)return;let a=t[0];if(t.length>1&&i.activator.duelistType!=="NPC"){const r=[Mt.createDammyAction(i.action.entity,"セット",t)],n=i.activator.duel.view.modalController.selectAction(i.activator.duel.view,{title:"カードをセット先へドラッグ",activator:i.activator,actions:r,cancelable:!0}),s=i.activator.duel.view.waitSubAction(i.activator,r,"カードをセット先へドラッグ",!0),l=await Promise.any([n,s.then(v=>v.action)]);if(!l)return;a=l.cell||a}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:a}}},Do=async i=>(await i.action.entity.setAsSpellTrap(i.prepared.dest,["Rule","SpellTrapSet"],i.action.entity,i.activator),i.activator.duel.log.info(`${i.action.entity.status.name}をセット（SpellTrapSet）。`,i.activator),i.action.entity.info.isSettingSickness=i.action.entity.status.kind==="Trap"||i.action.entity.status.spellCategory==="QuickPlay",!0),De={title:"セット",playType:"SpellTrapSet",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:ko,prepare:Co,execute:Do,settle:async()=>!0},Ee=i=>{if(i.action.entity.info.isPending||i.action.entity.info.isDying||i.action.entity.info.isSettingSickness)return;if(Ut.some(t=>t===i.action.entity.fieldCell.cellType))return i.action.entity.face==="FaceDown"?[]:void 0;if(!i.activator.isTurnPlayer)return;if(i.action.entity.status.spellCategory==="Field")return[i.activator.getFieldZone()];const e=i.activator.getAvailableSpellTrapZones();return e.length>0?e:void 0},La=(i,e,t,a,r,n)=>qe(i,e,t,a,r,n,void 0),qe=async(i,e,t,a,r,n,s)=>{if(Ut.some(l=>l===i.action.entity.fieldCell.cellType)&&i.action.entity.face==="FaceDown")return await i.action.entity.setNonFieldMonsterPosition("FaceUp",["Rule"]),{chainBlockTags:r??[],selectedEntities:n??[],prepared:s};if(i.action.entity.status.spellCategory==="Field"){const l=i.activator.getFieldZone().cardEntities;if(l.length){const v=l[0];await _e.sendManyToGraveyardForTheSameReason(i.activator.getFieldZone().cardEntities,["Rule"],i.action.entity,i.activator),i.activator.duel.log.info(`フィールド魔法の上書きにより、${v.toString()}は墓地に送られた。`,i.activator)}}if(i.action.entity.fieldCell.cellType==="Hand"){const l=["CardActivation"],v=e?[e]:i.action.entity.status.spellCategory==="Field"?[i.activator.getFieldZone()]:i.activator.getAvailableSpellTrapZones();return await i.action.entity.field.activateSpellTrapFromHand(i.activator,i.action.entity,v,l,i.action.entity,i.activator,a),{chainBlockTags:r??[],selectedEntities:n??[],prepared:s}}},Eo=()=>{const i=[],e={name:"強欲な壺",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:20,validate:c=>{if(!(c.activator.getDeckCell().cardEntities.length<2)&&c.activator.canDraw&&c.activator.canAddToHandFromDeck)return Ee(c)},prepare:(c,h,S,y)=>qe(c,h,S,y,["Draw"],[],void 0),execute:async c=>(await c.activator.draw(2,c.action.entity,c.activator),!0),settle:async()=>!0},De]};i.push(e);const t={name:"貪欲な壺",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:30,validate:c=>{if(!(c.activator.getGraveyard().cardEntities.filter(h=>h.status.kind==="Monster").filter(h=>h.canBeTargetOfEffect(c.activator,c.action.entity,c.action)).length<5)&&c.activator.canDraw&&c.activator.canAddToHandFromDeck)return Ee(c)},prepare:async(c,h,S,y)=>{const m=await c.action.entity.field.duel.view.waitSelectEntities(c.activator,c.activator.getGraveyard().cardEntities.filter(T=>T.status.kind==="Monster").filter(T=>T.canBeTargetOfEffect(c.activator,c.action.entity,c.action)),5,T=>T.length===5,"デッキに戻すモンスターを選択。",!1);if(m)return qe(c,h,S,y,["Draw","ReturnToDeckFromGraveyard"],m,void 0)},execute:async c=>c.selectedEntities.some(h=>h.wasMovedAtCurrentChain)?!1:(await _e.returnManyToDeckForTheSameReason("Random",c.selectedEntities,["Effect"],c.action.entity,c.activator),await c.activator.draw(2,c.action.entity,c.activator),!0),settle:async()=>!0},De]};i.push(t);const a={name:"天使の施し",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:30,validate:c=>{if(!(c.activator.getDeckCell().cardEntities.length<3))return Ee(c)},prepare:(c,h,S)=>qe(c,h,S,!1,["Draw","DiscordAsEffect"],[],void 0),execute:async c=>(await c.activator.draw(3,c.action.entity,c.activator),await c.activator.discard(2,["Effect","Discard"],c.action.entity,c.activator),!0),settle:async()=>!0},De]};i.push(a);const r={name:"成金ゴブリン",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:20,validate:c=>{if(!(c.activator.getDeckCell().cardEntities.length<1))return Ee(c)},prepare:(c,h,S)=>qe(c,h,S,!1,["Draw"],[],void 0),execute:async c=>(await c.activator.draw(1,c.action.entity,c.activator),c.action.entity.field.duel.clock.incrementProcSeq(),c.activator.getOpponentPlayer().heal(1e3,c.action.entity),!0),settle:async()=>!0},De]};i.push(r);const n={name:"おろかな埋葬",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:c=>{if(c.activator.getDeckCell().cardEntities.filter(h=>h.status.kind==="Monster").length!==0)return Ee(c)},prepare:(c,h,S)=>qe(c,h,S,!1,["SendToGraveyardFromDeck"],[],void 0),execute:async c=>{const h=c.activator.getDeckCell().cardEntities.filter(y=>y.status.kind==="Monster");if(h.length===0)return!1;const S=await c.action.entity.field.duel.view.waitSelectEntities(c.activator,h,1,y=>y.length===1,"墓地に送るモンスターを選択",!1);if(!S)throw new Lt(c);return await _e.sendManyToGraveyardForTheSameReason(S,["Effect"],c.action.entity,c.activator),await c.activator.getDeckCell().shuffle(),!0},settle:async()=>!0},De]};i.push(n);const s={name:"おろかな副葬",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,priorityForNPC:40,validate:c=>{if(c.activator.getDeckCell().cardEntities.filter(h=>h.status.kind!=="Monster").length!==0)return Ee(c)},prepare:(c,h,S)=>qe(c,h,S,!1,["SendToGraveyardFromDeck"],[],void 0),execute:async c=>{const h=c.activator.getDeckCell().cardEntities.filter(y=>y.status.kind!=="Monster");if(h.length===0)return!1;const S=await c.action.entity.field.duel.view.waitSelectEntities(c.activator,h,1,y=>y.length===1,"墓地に送る魔法罠を選択",!1);if(!S)throw new Lt(c);return await _e.sendManyToGraveyardForTheSameReason(S,["Effect"],c.action.entity,c.activator),await c.activator.getDeckCell().shuffle(),!0},settle:async()=>!0},De]};i.push(s);const l={name:"死者蘇生",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:c=>{if(c.action.entity.field.getCells("Graveyard").flatMap(h=>h.cardEntities).filter(h=>h.status.kind==="Monster").filter(h=>h.info.isRebornable).filter(h=>h.canBeTargetOfEffect(c.activator,c.action.entity,c.action)).filter(h=>h.canBeSpecialSummoned("SpecialSummon",c.activator,c.action.entity,c.action)).length!==0&&c.activator.getAvailableMonsterZones().length!==0)return Ee(c)},prepare:async(c,h,S)=>{const y=await c.action.entity.field.duel.view.waitSelectEntities(c.activator,c.action.entity.field.getCells("Graveyard").flatMap(m=>m.cardEntities).filter(m=>m.status.kind==="Monster").filter(m=>m.info.isRebornable).filter(m=>m.canBeTargetOfEffect(c.activator,c.action.entity,c.action)).filter(m=>m.canBeSpecialSummoned("SpecialSummon",c.activator,c.action.entity,c.action)),1,m=>m.length===1,"蘇生対象とするモンスターを選択",!1);if(!y)throw new Lt(c);return await qe(c,h,S,!1,["SpecialSummonFromGraveyard"],y,void 0)},execute:async c=>{const h=c.activator.getEmptyMonsterZones(),S=c.selectedEntities[0];return await c.activator.summon(S,["Attack","Defense"],h,"SpecialSummon",["Effect"],c.action.entity,!1),!0},settle:async()=>!0},De]};i.push(l),[{name:"大嵐",cellTypes:Ut,isOnlyEnemies:!1},{name:"ハーピィの羽根帚",cellTypes:Ut,isOnlyEnemies:!0},{name:"ブラック・ホール",cellTypes:Vi,isOnlyEnemies:!1},{name:"サンダー・ボルト",cellTypes:Vi,isOnlyEnemies:!0}].forEach(c=>{i.push({name:c.name,actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:h=>{let S=h.action.entity.field.getCells(...c.cellTypes).flatMap(y=>y.cardEntities).filter(y=>y!==h.action.entity);if(c.isOnlyEnemies&&(S=S.filter(y=>y.controller!==h.activator)),!!S.length)return Ee(h)},prepare:async(h,S,y)=>{let m=h.action.entity.field.getCells(...c.cellTypes).flatMap(T=>T.cardEntities).filter(T=>T!==h.action.entity);return c.isOnlyEnemies&&(m=m.filter(T=>T.controller!==h.activator)),await qe(h,S,y,!1,h.action.calcChainBlockTagsForDestroy(m),[],void 0)},execute:async h=>{let S=h.action.entity.field.getCells(...c.cellTypes).flatMap(y=>y.cardEntities).filter(y=>y!==h.action.entity);return c.isOnlyEnemies&&(S=S.filter(y=>y.controller!==h.activator)),await va.tryDestroy(S,h),!0},settle:async()=>!0},De]})});const v={name:"ハリケーン",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:c=>{if(c.action.entity.field.getCells("SpellAndTrapZone","FieldSpellZone").flatMap(S=>S.cardEntities).filter(S=>S!==c.action.entity).length)return Ee(c)},prepare:async(c,h,S)=>await qe(c,h,S,!1,["BounceToHand"],[],void 0),execute:async(c,h)=>{const S=h.map(m=>m.action).filter(m=>m.playType==="CardActivation").map(m=>m.entity).filter(m=>m.isOnField).filter(m=>m.face==="FaceUp").filter(m=>!m.isLikeContinuousSpell),y=c.action.entity.field.getCells("SpellAndTrapZone","FieldSpellZone").flatMap(m=>m.cardEntities).filter(m=>!S.includes(m));return await _e.returnManyToHandForTheSameReason(y,["Effect"],c.action.entity,c.activator),!0},settle:async()=>!0},De]};i.push(v);const d={name:"手札抹殺",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:c=>{if(!(c.activator.getDeckCell().cardEntities.length<c.activator.getHandCell().cardEntities.filter(h=>h.seq!==c.action.entity.seq).length)&&c.action.entity.field.getAllCells().filter(h=>h.cellType==="Hand").flatMap(h=>h.cardEntities).filter(h=>h.seq!==c.action.entity.seq).length!==0)return Ee(c)},prepare:(c,h,S)=>qe(c,h,S,!1,["SearchFromDeck"],[],void 0),execute:async c=>{const h=c.activator.getHandCell().cardEntities.length,S=c.activator.getOpponentPlayer().getHandCell().cardEntities.length;return await _e.sendManyToGraveyardForTheSameReason(c.action.entity.field.getCells("Hand").flatMap(y=>y.cardEntities),["Effect","Discard"],c.action.entity,c.activator),c.activator.duel.clock.incrementProcSeq(),await c.action.entity.field.drawAtSameTime(c.activator,h,c.activator.getOpponentPlayer(),S,c.action.entity,c.activator),!0},settle:async()=>!0},De]};i.push(d);const f={name:"光の援軍",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:c=>{if(!(c.activator.getDeckCell().cardEntities.length<4)&&c.activator.getDeckCell().cardEntities.filter(h=>h.status.kind==="Monster").filter(h=>(h.lvl??13)<5).filter(h=>h.status.nameTags&&h.status.nameTags.includes("ライトロード")).length!==0)return Ee(c)},prepare:async(c,h,S)=>{const y=c.activator.getDeckCell();return await _e.sendManyToGraveyardForTheSameReason(y.cardEntities.slice(0,3),["Cost"],c.action.entity,c.activator),await qe(c,h,S,!1,["SearchFromDeck","SendToGraveyardFromDeck"],[],void 0)},execute:async c=>{const h=c.activator.getDeckCell().cardEntities.filter(y=>y.status.kind==="Monster").filter(y=>(y.lvl??13)<5).filter(y=>y.status.nameTags&&y.status.nameTags.includes("ライトロード"));if(h.length===0)return!1;const S=await c.action.entity.field.duel.view.waitSelectEntities(c.activator,h,1,y=>y.length===1,"手札に加えるモンスターを選択",!1);for(const y of S??[])await y.addToHand(["Effect"],c.action.entity,c.activator);return c.activator.getDeckCell().shuffle(),!0},settle:async()=>!0},De]};i.push(f);const p={name:"調律",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:c=>{const h=c.activator.getDeckCell().cardEntities;if(!(h.length<2)&&h.filter(S=>{var y;return(y=S.status.nameTags)==null?void 0:y.includes("シンクロン")}).filter(S=>{var y;return(y=S.status.monsterCategories)==null?void 0:y.includes("Tuner")}).length!==0)return Ee(c)},prepare:(c,h,S)=>qe(c,h,S,!1,["SearchFromDeck","SendToGraveyardFromDeck"],[],void 0),execute:async c=>{const h=c.activator.getDeckCell().cardEntities;if(h.length<2)return;const S=h.filter(m=>{var T;return(T=m.status.nameTags)==null?void 0:T.includes("シンクロン")}).filter(m=>{var T;return(T=m.status.monsterCategories)==null?void 0:T.includes("Tuner")});if(S.length===0)return!1;const y=await c.action.entity.field.duel.view.waitSelectEntities(c.activator,S,1,m=>m.length===1,"手札に加えるモンスターを選択",!1);for(const m of y??[])await m.addToHand(["Effect"],c.action.entity,c.activator);return c.activator.duel.clock.incrementProcSeq(),c.activator.getDeckCell().shuffle(),await c.activator.getDeckCell().cardEntities[0].sendToGraveyard(["Effect"],c.action.entity,c.activator),!0},settle:async()=>!0},De]};i.push(p);const g={name:"ワン・フォー・ワン",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:c=>{if(c.activator.getDeckCell().cardEntities.filter(h=>h.lvl===1).length===0){if(c.activator.getHandCell().cardEntities.filter(h=>h.lvl===1).length===0||c.activator.getHandCell().cardEntities.filter(h=>h.status.kind==="Monster").length<2)return}else if(c.activator.getHandCell().cardEntities.filter(h=>h.status.kind==="Monster").length===0)return;return Ee(c)},prepare:async(c,h,S)=>{let y=c.activator.getHandCell().cardEntities.filter(T=>T.status.kind==="Monster");if(c.activator.getDeckCell().cardEntities.filter(T=>T.lvl===1).length===0){const T=c.activator.getHandCell().cardEntities.filter(C=>C.lvl===1);T.length===1&&(y=y.filter(C=>C!==T[0]))}if(await c.action.entity.field.sendToGraveyard("墓地送るモンスターを選択",c.activator,y,1,T=>T.length===1,["Cost"],c.action.entity,!0))return await qe(c,h,S,!1,["SpecialSummonFromDeck"],[],void 0)},execute:async c=>{const h=[...c.activator.getDeckCell().cardEntities.filter(y=>y.lvl===1),...c.activator.getHandCell().cardEntities.filter(y=>y.lvl===1)];if(h.length===0)return!1;const S=await c.action.entity.field.duel.view.waitSelectEntities(c.activator,h,1,y=>y.length===1,"特殊召喚するモンスターを選択",!1);if(!S)throw new Error("illegal state");return await c.activator.summon(S[0],["Attack","Defense"],c.activator.getAvailableMonsterZones(),"SpecialSummon",["Effect"],c.action.entity,!1),c.activator.getDeckCell().shuffle(),!0},settle:async()=>!0},De]};return i.push(g),i},Ao=(i,e,t,a,r)=>({title:"①リクルート",playType:"TriggerEffect",spellSpeed:"Normal",executableCells:r,executablePeriods:a.includes("EffectDestroy")?[...dt,...Kt]:["b1DEnd","b2DEnd"],executableDuelistTypes:["Controller"],validate:n=>{if(!n.action.entity.wasMovedAtPreviousChain||!n.action.entity.moveLog.latestRecord.movedAs.includes("BattleDestroy"))return;const s=n.activator.getDeckCell().cardEntities.filter(i);if(s.length!==0&&!s.every(l=>!n.activator.canSummon(n.activator,n.action.entity,n.action,"SpecialSummon",t,[l]).length))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async n=>{const s=n.activator.getDeckCell().cardEntities.filter(i);if(s.length===0)return!1;const l=await n.action.entity.field.duel.view.waitSelectEntities(n.activator,s,e.length===1?e[0]:-1,v=>e.includes(v.length),"特殊召喚するモンスターを選択",!1);if(!l)throw new Error("illegal state");for(const v of l)await n.activator.summon(v,t,n.activator.getAvailableMonsterZones(),"SpecialSummon",["Effect"],n.action.entity,!1);return n.activator.getDeckCell().shuffle(),!0},settle:async()=>!0}),xo=()=>{const i=[];return[{name:"キラー・ポテト",filter:e=>e.attr.includes("Dark")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["EffectDestroy"],executableCells:["Graveyard"]},{name:"キラー・トマト",filter:e=>e.attr.includes("Dark")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"巨大ネズミ",filter:e=>e.attr.includes("Earth")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"グリズリーマザー",filter:e=>e.attr.includes("Water")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"シャインエンジェル",filter:e=>e.attr.includes("Light")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ドラゴンフライ",filter:e=>e.attr.includes("Wind")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ＵＦＯタートル",filter:e=>e.attr.includes("Fire")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"荒野の女戦士",filter:e=>e.attr.includes("Earth")&&e.types.includes("Warrior")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"リトル・トルーパー",filter:e=>e.types.includes("Warrior")&&(e.lvl??9999)<3,qtyList:[1],posList:["Set"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard","Banished"]},{name:"破面竜",filter:e=>e.types.includes("Warrior")&&(e.def??9999)<=1500,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"共鳴虫",filter:e=>e.types.includes("Insect")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ピラミッド・タートル",filter:e=>e.types.includes("Zombie")&&(e.def??9999)<=2e3,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ユーフォロイド",filter:e=>e.types.includes("Machine")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ヘル・セキュリティ",filter:e=>e.types.includes("Fiend")&&(e.lvl??9999)===1,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ガスタ・イグル",filter:e=>(e.status.nameTags??[]).includes("ガスタ")&&(e.status.monsterCategories??[]).includes("Tuner"),qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"幻影の魔術士",filter:e=>(e.status.nameTags??[]).includes("ＨＥＲＯ")&&(e.atk??9999)<=1e3,qtyList:[1],posList:["Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ジェネクス・サーチャー",filter:e=>(e.status.nameTags??[]).includes("ジェネクス")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"紫炎の足軽",filter:e=>(e.status.nameTags??[]).includes("六武衆")&&(e.lvl??12)<=3,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"スレイブ・エイプ",filter:e=>(e.status.nameTags??[]).includes("剣闘獣")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ゼンマイハニー",filter:e=>(e.status.nameTags??[]).includes("ゼンマイ")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ＸＸ－セイバー エマーズブレイド",filter:e=>(e.status.nameTags??[]).includes("Ｘ－セイバー")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"軍隊竜",filter:e=>e.nm==="軍隊竜",qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"アサルト・ガンドッグ",filter:e=>e.nm==="アサルト・ガンドッグ",qtyList:[1,2,3,4,5],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ハイエナ",filter:e=>e.nm==="ハイエナ",qtyList:[1,2,3,4,5],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]}].forEach(e=>{i.push({name:e.name,actions:[Ao(e.filter,e.qtyList,e.posList,e.destoryTypes,e.executableCells),He,$e,ze]})}),i},Po=i=>({title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:e=>{if(e.activator.getDeckCell().cardEntities.filter(i).length!==0&&e.activator.canDraw)return Ee(e)},prepare:(e,t,a,r)=>qe(e,t,a,r,["SearchFromDeck"],[],void 0),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(i);if(t.length===0)return!1;const a=await e.action.entity.field.duel.view.waitSelectEntities(e.activator,t,1,r=>r.length===1,"手札に加えるカードを選択",!1);for(const r of a??[])await r.addToHand(["Effect"],e.action.entity,e.activator);return e.activator.getDeckCell().shuffle(),!0},settle:async()=>!0}),Mo=(i,e)=>({title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,priorityForNPC:40,validate:t=>{if(!(t.activator.getGraveyard().cardEntities.filter(i).length<e))return Ee(t)},prepare:(t,a,r,n)=>qe(t,a,r,n,["AddToHandFromGraveyard"],[],void 0),execute:async t=>{const a=t.activator.getGraveyard().cardEntities.filter(i);if(a.length===0)return!1;const r=await t.action.entity.field.duel.view.waitSelectEntities(t.activator,a,e,n=>n.length===e,"手札に加えるカードを選択",!1);for(const n of r??[])await n.addToHand(["Effect"],t.action.entity,t.activator);return!0},settle:async()=>!0}),Fo=i=>({title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:e=>{if(e.activator.getHandCell().cardEntities.filter(i).length!==0&&!(e.activator.getDeckCell().cardEntities.length<2))return Ee(e)},prepare:async(e,t,a,r)=>{const n=await qe(e,t,a,r,["Draw"],[],void 0);return await e.activator.discard(1,["Discard","Cost"],e.action.entity,e.activator,i),n},execute:async e=>(await e.activator.draw(2,e.action.entity,e.activator),!0),settle:async()=>!0}),Bo=i=>({title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Ee,prepare:(e,t,a,r)=>{const[n,s]=i(e.action.entity),l=[];return n<0&&l.push("DamageToSelf"),s<0&&l.push("DamageToOpponent"),qe(e,t,a,r,l,[],void 0)},execute:async e=>{const[t,a]=i(e.action.entity);return a>0?e.activator.getOpponentPlayer().heal(a,e.action.entity):a<0&&e.activator.getOpponentPlayer().effectDamage(Math.abs(a),e.action.entity),t>0?e.activator.heal(t,e.action.entity):t<0&&e.activator.effectDamage(Math.abs(t),e.action.entity),!0},settle:async()=>!0}),qo=()=>{const i=[];return[{name:"増援",filter:e=>e.origin.kind==="Monster"&&e.types.includes("Warrior")&&(e.origin.level??5)<5},{name:"化石調査",filter:e=>e.origin.kind==="Monster"&&e.types.includes("Dinosaur")&&(e.origin.level??6)<6},{name:"Ｅ－エマージェンシーコール",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("Ｅ・ＨＥＲＯ")},{name:"召集の聖刻印",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("聖刻")},{name:"召喚師のスキル",filter:e=>e.origin.kind==="Monster"&&(e.origin.monsterCategories??[]).includes("Normal")&&(e.origin.level??4)>4},{name:"トゥーンのもくじ",filter:e=>(e.origin.nameTags??[]).includes("トゥーン")},{name:"融合賢者",filter:e=>e.origin.name==="融合"},{name:"虹の架け橋",filter:e=>e.origin.kind!=="Monster"&&(e.origin.nameTags??[]).includes("宝玉")},{name:"紫炎の狼煙",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("六武衆")&&(e.origin.level??4)<4},{name:"テラ・フォーミング",filter:e=>e.origin.kind==="Spell"&&e.origin.spellCategory==="Field"},{name:"コール・リゾネーター",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("リゾネーター")}].forEach(e=>{i.push({name:e.name,actions:[Po(e.filter),De]})}),[{name:"戦士の生還",filter:e=>e.status.kind==="Monster"&&e.types.includes("Warrior"),qty:1},{name:"ダーク・バースト",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Dark")&&(e.atk??9999)<=1500,qty:1},{name:"悪夢再び",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Dark")&&(e.def??9999)===0,qty:2},{name:"サルベージ",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Water")&&(e.atk??9999)<=1500,qty:2},{name:"バッテリーリサイクル",filter:e=>e.status.kind==="Monster"&&e.types.includes("Thunder")&&(e.atk??9999)<=1500,qty:2},{name:"闇の量産工場",filter:e=>e.status.kind==="Monster"&&(e.status.monsterCategories??[]).includes("Normal"),qty:2}].forEach(e=>{i.push({name:e.name,actions:[Mo(e.filter,e.qty),De]})}),[{name:"トレード・イン",filter:e=>e.status.kind==="Monster"&&(e.lvl??0)===8},{name:"調和の宝札",filter:e=>e.status.kind==="Monster"&&(e.origin.monsterCategories??[]).includes("Tuner")&&e.types.includes("Dragon")&&(e.atk??9999)<=1e3},{name:"デステニー・ドロー",filter:e=>e.status.kind==="Monster"&&(e.origin.nameTags??[]).includes("Ｄ－ＨＥＲＯ")}].forEach(e=>{i.push({name:e.name,actions:[Fo(e.filter),De]})}),[{name:"火の粉",calcHeal:()=>[0,-200]},{name:"雷鳴",calcHeal:()=>[0,-300]},{name:"ファイヤー・ボール",calcHeal:()=>[0,-500]},{name:"火あぶりの刑",calcHeal:()=>[0,-600]},{name:"昼夜の大火事",calcHeal:()=>[0,-800]},{name:"火炎地獄",calcHeal:()=>[-500,-1e3]},{name:"盗人ゴブリン",calcHeal:()=>[500,-500]},{name:"ブルー・ポーション",calcHeal:()=>[400,0]},{name:"レッド・ポーション",calcHeal:()=>[500,0]},{name:"ゴブリンの秘薬",calcHeal:()=>[600,0]},{name:"天使の生き血",calcHeal:()=>[800,0]},{name:"治療の神 ディアン・ケト",calcHeal:()=>[1e3,0]},{name:"恵みの雨",calcHeal:()=>[1e3,1e3]}].forEach(e=>{i.push({name:e.name,actions:[Bo(e.calcHeal),De]})}),i},Oo=()=>{const i=[];return["大地の騎士ガイアナイト","スクラップ・デスデーモン"].forEach(e=>i.push({name:e,actions:[He,$e,Sa()]})),i.push({name:"ナチュル・ガオドレイク",actions:[He,$e,Sa(e=>e.length===1&&e.every(t=>t.attr.some(a=>a==="Earth")),e=>e.length>0&&e.every(t=>t.attr.some(a=>a==="Earth")))]}),i.push({name:"マジカル・アンドロイド",actions:[He,$e,Sa(),{title:"回復",playType:"MandatoryIgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["end"],executableDuelistTypes:["Controller"],validate:e=>e.action.entity.counterHolder.getQty("①")===0&&e.action.entity.duel.phase==="end"&&e.activator.isTurnPlayer&&e.action.entity.face==="FaceUp"?[]:void 0,prepare:e=>(e.action.entity.counterHolder.add("①"),Cn()),execute:async e=>(e.activator.heal(e.activator.getMonstersOnField().filter(t=>t.face==="FaceUp").filter(t=>t.types.includes("Psychic")).length*600,e.action.entity),!0),settle:async()=>!0}]}),i},No=()=>{const i=[];return[{name:"草原",up:["Warrior","BeastWarrior"],down:[]},{name:"森",up:["Insect","Plant","Beast","BeastWarrior"],down:[]},{name:"山",up:["Dragon","WingedBeast","Thunder"],down:[]},{name:"荒野",up:["Dinosaur","Zombie","Rock"],down:[]},{name:"海",up:["Aqua","SeaSerpent","Fish"],down:["Machine","Pyro"]},{name:"闇",up:["Fiend","Spellcaster"],down:["Fairy"]}].forEach(e=>{i.push({name:e.name,actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Ee,prepare:La,execute:async()=>!0,settle:async()=>!0},De],continuousEffects:[zi("発動","Spell",t=>t.isOnField&&t.face==="FaceUp",t=>["attack","defense"].flatMap(a=>["up","down"].map(r=>ht.createContinuous("発動",n=>n.isOnField&&n.face==="FaceUp",t,(n,s)=>s.isOnField&&s.face==="FaceUp"&&(s.status.monsterCategories??!1)&&e[r].union(s.types).length>0,a,"current","Addition",(n,s,l)=>!n.isEffective||s.face==="FaceDown"?l:l+(r==="up"?200:-200)))))]})}),[{name:"バーニングブラッド",attr:"Fire"},{name:"ウォーターワールド",attr:"Water"},{name:"ガイアパワー",attr:"Earth"},{name:"シャインスパーク",attr:"Light"},{name:"ダークゾーン",attr:"Dark"},{name:"デザートストーム",attr:"Wind"}].forEach(e=>{i.push({name:e.name,actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","FieldSpellZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Ee,prepare:La,execute:async()=>!0,settle:async()=>!0},De],continuousEffects:[zi("発動","Spell",t=>t.isOnField&&t.face==="FaceUp",t=>["attack","defense"].flatMap(a=>ht.createContinuous("発動",r=>r.isOnField&&r.face==="FaceUp",t,(r,n)=>n.isOnField&&n.face==="FaceUp"&&n.attr.includes(e.attr),a,"current","Addition",(r,n,s)=>!r.isEffective||n.face==="FaceDown"?s:s+(a==="attack"?500:-400))))]})}),i},Ro=()=>{const i=[],e={name:"連合軍",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Ee,prepare:La,execute:async()=>!0,settle:async()=>!0},De],continuousEffects:[zi("発動","Spell",t=>t.isOnField&&t.face==="FaceUp",t=>[ht.createContinuous("発動",a=>a.isOnField&&a.face==="FaceUp",t,(a,r)=>r.controller===a.controller&&r.types.includes("Warrior")&&r.isOnField&&r.face==="FaceUp","attack","current","Addition",(a,r,n)=>{if(!a.isEffective||r.face==="FaceDown")return n;const s=a.controller.getMonstersOnField().filter(l=>l.face==="FaceUp").filter(l=>l.types.includes("Warrior")||l.types.includes("Spellcaster")).length;return n+s*200})])]};return i.push(e),i},Lo=()=>{const i=[];[{name:"団結の力",kind:["Monster"],rate:800},{name:"魔導師の力",kind:["Spell","Trap"],rate:500}].forEach(t=>{i.push({name:t.name,actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:a=>a.action.entity.field.getMonstersOnField().filter(n=>n.face==="FaceUp").filter(n=>n.canBeTargetOfEffect(a.activator,a.action.entity,a.action)).length?Ee(a):void 0,prepare:async(a,r,n,s)=>{const l=a.action.entity.field.getMonstersOnField().filter(d=>d.face==="FaceUp").filter(d=>d.canBeTargetOfEffect(a.activator,a.action.entity,a.action)),v=await a.action.entity.duel.view.waitSelectEntities(a.activator,l,1,d=>d.length===1,"装備対象モンスターを選択",s);if(v)return a.action.entity.info.effectTargets.EquipTarget=v,await qe(a,r,n,!1,[],v,void 0)},execute:async()=>!0,settle:async()=>!0},De],continuousEffects:[qa("EquipTarget","Spell",()=>!0,a=>[pi.createRegularEquipRelation("EquipTarget",()=>!0,a,{},()=>!0)]),ua(t.name,"Spell",a=>a.info.effectTargets.EquipTarget,a=>a.isOnField&&a.face==="FaceUp",a=>["attack","defense"].map(r=>ht.createContinuous("発動",n=>n.isOnField&&n.face==="FaceUp",a,(n,s)=>s.isOnField&&s.face==="FaceUp",r,"current","Addition",(n,s,l)=>{if(!n.isEffective)return l;const v=n.controller.getEntiteisOnField().filter(d=>t.kind.includes(d.status.kind)).length;return l+v*t.rate})))]})});const e={name:"早すぎた埋葬",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:t=>{if(t.activator.getGraveyard().cardEntities.filter(a=>a.status.kind==="Monster").filter(a=>a.info.isRebornable).filter(a=>a.canBeTargetOfEffect(t.activator,t.action.entity,t.action)).filter(a=>a.canBeSpecialSummoned("SpecialSummon",t.activator,t.action.entity,t.action)).length!==0&&t.activator.getAvailableMonsterZones().length!==0&&!(t.activator.lp<800))return Ee(t)},prepare:async(t,a,r)=>{const n=await t.action.entity.field.duel.view.waitSelectEntities(t.activator,t.activator.getGraveyard().cardEntities.filter(s=>s.status.kind==="Monster").filter(s=>s.info.isRebornable).filter(s=>s.canBeTargetOfEffect(t.activator,t.action.entity,t.action)).filter(s=>s.canBeSpecialSummoned("SpecialSummon",t.activator,t.action.entity,t.action)),1,s=>s.length===1,"蘇生対象とするモンスターを選択",!1);if(!n)throw new Lt(t);return t.activator.payLp(800,t.action.entity),t.action.entity.info.effectTargets.EquipTarget=n,await qe(t,a,r,!1,["SpecialSummonFromGraveyard","PayLifePoint"],n,void 0)},execute:async t=>{const a=t.activator.getEmptyMonsterZones(),r=t.selectedEntities[0];return await t.activator.summon(r,["Attack"],a,"SpecialSummon",["Effect"],t.action.entity,!1),!0},settle:async()=>!0},De],continuousEffects:[qa("EquipTarget","Spell",()=>!0,t=>[pi.createRegularEquipRelation("EquipTarget",()=>!0,t,{},()=>!0,a=>(!a.target.isOnField||a.target.face==="FaceDown"||a.isSpawnedBy.moveLog.currentProcRecords.flatMap(r=>r.movedAs).find(r=>r==="Destroy")&&a.target.tryDestory("EffectDestroy",a.effectOwner,a.isSpawnedBy,{}),!0))])]};return i.push(e),i},Ho=()=>{const i=[];return[{name:"伝説の剣",attr:void 0,monType:"Warrior",atk:200,def:200},{name:"秘術の書",attr:void 0,monType:"Spellcaster",atk:200,def:200},{name:"ポセイドンの力",attr:void 0,monType:"Aqua",atk:200,def:200},{name:"紫水晶",attr:void 0,monType:"Zombie",atk:200,def:200},{name:"猛獣の歯",attr:void 0,monType:"Beast",atk:200,def:200},{name:"機械改造工場",attr:void 0,monType:"Machine",atk:200,def:200},{name:"体温の上昇",attr:void 0,monType:"Reptile",atk:200,def:200},{name:"魔菌",attr:void 0,monType:"Plant",atk:200,def:200},{name:"闇・エネルギー",attr:void 0,monType:"Fiend",atk:200,def:200},{name:"レーザー砲機甲鎧",attr:void 0,monType:"Insect",atk:200,def:200},{name:"銀の弓矢",attr:void 0,monType:"Fairy",atk:200,def:200},{name:"電撃鞭",attr:void 0,monType:"Thunder",atk:200,def:200},{name:"ドラゴンの秘宝",attr:void 0,monType:"Dragon",atk:200,def:200},{name:"フォロー・ウィンド",attr:void 0,monType:"WingedBeast",atk:200,def:200},{name:"魔性の月",attr:void 0,monType:"BeastWarrior",atk:200,def:200},{name:"エルフの光",attr:"Light",monType:void 0,atk:400,def:-200},{name:"覚醒",attr:"Earth",monType:void 0,atk:400,def:-200},{name:"灼熱の槍",attr:"Fire",monType:void 0,atk:400,def:-200},{name:"突風の扇",attr:"Wind",monType:void 0,atk:400,def:-200},{name:"はがねの甲羅",attr:"Water",monType:void 0,atk:400,def:-200},{name:"闇の破神剣",attr:"Dark",monType:void 0,atk:400,def:-200},{name:"火器付機甲鎧",attr:void 0,monType:"Insect",atk:700,def:0},{name:"サラマンドラ",attr:"Fire",monType:void 0,atk:700,def:0},{name:"シャイン・キャッスル",attr:"Light",monType:void 0,atk:700,def:0}].forEach(e=>{i.push({name:e.name,actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:t=>t.action.entity.field.getMonstersOnField().filter(r=>r.face==="FaceUp").filter(r=>r.canBeTargetOfEffect(t.activator,t.action.entity,t.action)).filter(r=>!e.attr||r.attr.includes(e.attr)).filter(r=>!e.monType||r.types.includes(e.monType)).length?Ee(t):void 0,prepare:async(t,a,r,n)=>{const s=t.action.entity.field.getMonstersOnField().filter(v=>v.face==="FaceUp").filter(v=>v.canBeTargetOfEffect(t.activator,t.action.entity,t.action)).filter(v=>!e.attr||v.attr.includes(e.attr)).filter(v=>!e.monType||v.types.includes(e.monType)),l=await t.action.entity.duel.view.waitSelectEntities(t.activator,s,1,v=>v.length===1,"装備対象モンスターを選択",n);if(l)return t.action.entity.info.effectTargets.EquipTarget=l,await qe(t,a,r,!1,[],l,void 0)},execute:async()=>!0,settle:async()=>!0},De],continuousEffects:[qa("EquipTarget","Spell",()=>!0,t=>[pi.createRegularEquipRelation("EquipTarget",()=>!0,t,{},()=>!0)]),ua(e.name,"Spell",t=>t.info.effectTargets.EquipTarget,t=>t.isOnField&&t.face==="FaceUp",t=>{const a=[];return e.atk!==0&&a.push(["attack",e.atk]),e.def!==0&&a.push(["defense",e.def]),a.map(([r,n])=>ht.createContinuous("発動",s=>s.isOnField&&s.face==="FaceUp",t,(s,l)=>l.isOnField&&l.face==="FaceUp"&&(!e.monType||l.types.includes(e.monType))&&(!e.attr||l.attr.includes(e.attr)),r,"current","Addition",(s,l,v)=>s.isEffective?v+n:v))})]})}),i},$o=()=>{const i=[],e={name:"にせアバター",actions:[ze,He,$e],continuousEffects:[ua("THE_DEVILS_AVATAR","Monster",a=>[a],a=>a.isOnField&&a.face==="FaceUp",a=>["attack","defense"].map(r=>ht.createContinuous("THE_DEVILS_AVATAR",n=>n.isOnField&&n.face==="FaceUp",a,n=>n.isOnField&&n.face==="FaceUp",r,"current","THE_DEVILS_AVATAR",()=>Number.MIN_VALUE)))]};i.push(e);const t={name:"にせドレッド・ルート",actions:[ze,He,$e],continuousEffects:[zi("THE_DEVILS_DREAD-ROOT","Monster",a=>a.isOnField&&a.face==="FaceUp",a=>["attack","defense"].map(r=>ht.createContinuous("THE_DEVILS_DREAD-ROOT",n=>n.isOnField&&n.face==="FaceUp",a,(n,s)=>s.status.kind==="Monster"&&s.isOnField&&s.face==="FaceUp"&&s!==n,r,"current","THE_DEVILS_DREAD-ROOT",(n,s,l)=>Math.round(l/2))))]};return i.push(t),i},jo=()=>{const i=[],e={name:"ご隠居の猛毒薬",actions:[De,{title:"発動",playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:dt,executableDuelistTypes:["Controller"],validate:Ee,prepare:async(a,r,n,s)=>{const l=await a.action.entity.field.duel.view.waitSelectText([{seq:0,text:"●自分は１２００ＬＰ回復する。"},{seq:1,text:"●相手に８００ダメージを与える。"}],"使用する効果を選択",!1);if(l===void 0&&!s)throw new Lt(a);const v=[];return l===1&&v.push("DamageToOpponent"),qe(a,r,n,s,v,[],l??0)},execute:async a=>a.prepared===1?(a.activator.getOpponentPlayer().effectDamage(800,a.action.entity),!0):(a.activator.heal(1200,a.action.entity),!0),settle:async()=>!0}]};i.push(e);const t={name:"月の書",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:dt,executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:a=>{if(a.action.entity.field.getMonstersOnField().filter(n=>n.canBeEffected(a.activator,a.action.entity,a.action)).length)return Ee(a)},prepare:async(a,r,n,s)=>{const l=a.action.entity.field.getMonstersOnField().filter(d=>d.canBeEffected(a.activator,a.action.entity,a.action)),v=await a.action.entity.duel.view.waitSelectEntities(a.activator,l,1,d=>d.length===1,"対象とするモンスターを選択",s);if(v)return qe(a,r,n,s,[],[...v],void 0)},execute:async a=>{const r=a.selectedEntities[0];if(!r.isOnField||r.battlePosition==="Set")return!1;if(!r.canBeEffected(a.activator,a.action.entity,a.action)){a.activator.duel.log.info(`${r.toString()}は${a.action.entity.toString()}の効果を受けない。`);return}return await r.setBattlePosition("Set",["Effect"],a.action.entity,a.activator),!0},settle:async()=>!0},De]};return i.push(t),i},Uo=(i,e)=>{const t=`魔力充填可能(${e})`;return Zl(t,i,a=>[a],()=>!0,a=>[new Jl(t,()=>!0,!0,a,{},(r,n)=>r===n,(r,n)=>(n.maxCounterQty.SpellCounter=e,n))])},Zo=()=>{const i=[],e={name:"魔導戦士 ブレイカー",actions:[He,$e,ze,{title:"①魔力充填",playType:"MandatoryTriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:t=>{if(t.action.entity.hasBeenSummonedNow(["NormalSummon"]))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["IfNormarlSummonSucceed"],prepared:void 0}),execute:async t=>t.action.entity.face==="FaceDown"?!1:(t.action.entity.counterHolder.setQty("SpellCounter",1),!0),settle:async()=>!0},{title:"③魔法罠破壊",playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:t=>{if(!t.action.entity.counterHolder.getQty("SpellCounter"))return;const a=t.action.entity.field.getCells(...Ut).flatMap(r=>r.cardEntities).filter(r=>r.canBeTargetOfEffect(t.activator,t.action.entity,t.action));if(a.length)return a.map(r=>r.fieldCell)},prepare:async(t,a,r,n)=>{let s=a==null?void 0:a.cardEntities[0];if(!s){const l=t.action.entity.field.getCells(...Ut).flatMap(d=>d.cardEntities).filter(d=>d.canBeTargetOfEffect(t.activator,t.action.entity,t.action)),v=await t.action.entity.duel.view.waitSelectEntities(t.activator,l,1,d=>d.length===1,"破壊する対象を選択。",n);if(!v||!v.length)return;s=v[0]}return{selectedEntities:[s],chainBlockTags:t.action.calcChainBlockTagsForDestroy([s]),prepared:void 0}},execute:async t=>{if(t.action.entity.counterHolder.getQty("SpellCounter"))return t.action.entity.counterHolder.remove("SpellCounter",1),await va.tryDestroy(t.selectedEntities,t),!0},settle:async()=>!0}],continuousEffects:[Uo("Monster",1),ua("②攻撃力上昇","Monster",t=>[t],()=>!0,t=>[ht.createContinuous("②攻撃力上昇",()=>!0,t,()=>!0,"attack","current","Addition",(a,r,n)=>a.isEffective?n+a.counterHolder.getQty("SpellCounter")*300:n)])]};return i.push(e),i},Go=()=>{const i=[],e={name:"炸裂装甲",actions:[De,{title:"発動",playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:["b1Battle","b2Battle"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:t=>{if(!t.activator.duel.clock.isUponAttackDeclaration()||t.activator.isTurnPlayer)return;const a=t.activator.duel.attackingMonster;if(!a)throw new ke("想定されない状態",t,a);if(a.canBeEffected(t.activator,t.action.entity,t.action))return Ee(t)},prepare:async(t,a,r,n)=>{const s=t.activator.duel.attackingMonster;if(!s)throw new ke("想定されない状態",t,s);return qe(t,a,r,n,t.action.calcChainBlockTagsForDestroy([s]),[s],void 0)},execute:async t=>(await va.tryDestroy(t.selectedEntities,t),!0),settle:async()=>!0}]};return i.push(e),i},Vo=()=>{const i=[],e={name:"強欲な瓶",actions:[De,{title:"発動",playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:dt,executableDuelistTypes:["Controller"],validate:t=>{if(!(t.activator.getDeckCell().cardEntities.length<2)&&t.activator.canDraw&&t.activator.canAddToHandFromDeck)return Ee(t)},prepare:(t,a,r,n)=>qe(t,a,r,n,["Draw"],[],void 0),execute:async t=>(await t.activator.draw(1,t.action.entity,t.activator),!0),settle:async()=>!0}]};return i.push(e),i},zo=()=>{const i=[...To(),...xo(),...Oo(),...Eo(),...qo(),...jo(),...No(),...Ro(),...Lo(),...Ho(),...$o(),...Zo(),...Vo(),...Go()],e=i.map(a=>a.name);console.info(e);const t=Object.values(Object.groupBy(e,a=>a)).filter(a=>((a==null?void 0:a.length)??2)>1).map(a=>a==null?void 0:a[0]);if(t.length>0)throw new ke("カード定義重複",...t);return i},Pn=new Map;zo().forEach(i=>{Pn.set(i.name,i)});const Ha=Pn,Yo=jn,Ue=Object.values(Yo).reduce((i,e)=>(i[e.name]=e,i),{}),Mn=[{id:-1,name:"サンプルデッキ１",description:"",cardNames:["アンノウン・シンクロン","六武衆のご隠居","ジャンク・フォアード","ジャンク・フォアード","ジャンク・フォアード","チューン・ウォリアー","チューン・ウォリアー","ガード・オブ・フレムベル","ガード・オブ・フレムベル","守護竜ユスティア","守護竜ユスティア","エンジェル・トランペッター","エンジェル・トランペッター","ジェムナイト・サフィア","ジェムナイト・サフィア","魂虎","魂虎","暗黒界の番兵 レンジ","暗黒界の番兵 レンジ","バトルフットボーラー","バトルフットボーラー","球騎士の三人娘","球騎士の三人娘","エンジェル・トランペッター","エンジェル・トランペッター","Ｇ戦隊 シャインブラック","Ｇ戦隊 シャインブラック","しゃりの軍貫","しゃりの軍貫","ジョングルグールの幻術師","ジョングルグールの幻術師","ゾンビーノ","ゾンビーノ","メガロスマッシャーＸ","メガロスマッシャーＸ","ライドロン","ライドロン","機界騎士アヴラム","機界騎士アヴラム","幻のグリフォン","幻のグリフォン","幻殻竜","幻殻竜","アレキサンドライドラゴン","アレキサンドライドラゴン","ジェネティック・ワーウルフ","ジェネティック・ワーウルフ","サイバー・ドラゴン","フロストザウルス","フロストザウルス","フロストザウルス","青眼の白龍","マジカル・アンドロイド","マジカル・アンドロイド","マジカル・アンドロイド","大地の騎士ガイアナイト","大地の騎士ガイアナイト","大地の騎士ガイアナイト","スクラップ・デスデーモン","スクラップ・デスデーモン","スクラップ・デスデーモン","ナチュル・ガオドレイク","ナチュル・ガオドレイク","ナチュル・ガオドレイク"]},{id:-2,name:"サンプルデッキ２",description:"",cardNames:["アンノウン・シンクロン","六武衆のご隠居","ジャンク・フォアード","グローアップ・バルブ","ガード・オブ・フレムベル","伝説の白石","伝説の白石","伝説の白石","守護竜ユスティア","ギャラクシーサーペント","ジェネクス・コントローラー","Ｅ・ＨＥＲＯ フェザーマン","Ｅ・ＨＥＲＯ バーストレディ","チューン・ウォリアー","Ｅ・ＨＥＲＯ クレイマン","Ｅ・ＨＥＲＯ スパークマン","しゃりの軍貫","ジョングルグールの幻術師","ゾンビーノ","ジェネティック・ワーウルフ","ライトロード・ビースト ウォルフ","サイバー・ドラゴン","サイバー・ドラゴン","サイバー・ドラゴン","ラブラドライドラゴン","Ｄ－ＨＥＲＯ ディアボリックガイ","Ｄ－ＨＥＲＯ ディアボリックガイ","Ｄ－ＨＥＲＯ ディアボリックガイ","フロストザウルス","Ｅ・ＨＥＲＯ ネオス","青眼の白龍","青眼の白龍","青眼の白龍","Ｅ－エマージェンシーコール","おろかな埋葬","トレード・イン","トレード・イン","トレード・イン","闇の量産工場","強欲な壺","強欲な壺","強欲な壺","死者蘇生","死者蘇生","死者蘇生","召喚師のスキル","召喚師のスキル","召喚師のスキル","成金ゴブリン","成金ゴブリン","成金ゴブリン","戦士の生還","増援","調和の宝札","調和の宝札","調和の宝札","天使の施し","天使の施し","天使の施し","貪欲な壺","貪欲な壺","貪欲な壺","マジカル・アンドロイド","マジカル・アンドロイド","マジカル・アンドロイド","大地の騎士ガイアナイト","大地の騎士ガイアナイト","大地の騎士ガイアナイト","スクラップ・デスデーモン","スクラップ・デスデーモン","スクラップ・デスデーモン","ナチュル・ガオドレイク","ナチュル・ガオドレイク","ナチュル・ガオドレイク"]}],fe=class fe{constructor(e,t){o(this,"id");o(this,"name");o(this,"description");o(this,"lastUsedAt");o(this,"cardNames");o(this,"getIllegalCardNames",()=>Array.from(new Set(this.cardNames.filter(e=>!Object.keys(Ue).includes(e)))));o(this,"getDisableCardNames",()=>Array.from(new Set(this.cardNames.filter(e=>!Object.keys(Ue).includes(e)))));o(this,"createCardInfos",()=>{const e=this.getIllegalCardNames();if(e.length>0)throw new Error(`存在しないカード名からデッキを生成しようとした。${e}`);return this.cardNames.map(t=>Ue==null?void 0:Ue[t]).filter(t=>t)});o(this,"copy",async()=>fe.createNewDeck(this.name,this.description,this.cardNames));o(this,"updateTimestamp",async()=>{await fe.tblHeader.update(this.id,e=>({...e,lastUsedAt:new Date}))});o(this,"saveDeckInfo",async e=>{const t=e??this;await fe.tblHeader.update(this.id,n=>({...n,name:t.name,description:t.description,lastUsedAt:new Date}));const a=(await fe.tblDetail.getAll()).filter(n=>n.deckId===this.id);console.log(t.cardNames),await fe.tblDetail.delete(a.map(n=>n.id));const r=await fe.tblDetail.insertMany(t.cardNames.map((n,s)=>({deckId:this.id,seq:s,name:n,description:""})));return console.log(r),new fe(await fe.tblHeader.get(this.id),r)});o(this,"delete",async()=>{await fe.tblHeader.delete([this.id]);const e=(await fe.tblDetail.getAll()).filter(t=>t.deckId===this.id);await fe.tblDetail.delete(e.map(t=>t.id))});this.id=e.id,this.name=e.name,this.description=e.description,this.lastUsedAt=e.lastUsedAt,this.cardNames=t.filter(a=>a.deckId===this.id).map(a=>a.name)}};o(fe,"toJson",e=>{const t=e.map(a=>{const{id:r,name:n,description:s,lastUsedAt:l,cardNames:v}=a;return{id:r,name:n,description:s,lastUsedAt:l,cardNames:v}});return t.forEach(a=>{a.cardNames=a.cardNames.map(r=>Ue[r]).sort(ui).map(r=>r.name)}),JSON.stringify(t,null,2)}),o(fe,"convertToObjectURL",e=>{const t=fe.toJson(e),a=new Blob([t],{type:"text/plain"});return window.URL.createObjectURL(a)}),o(fe,"idb"),o(fe,"tblHeader"),o(fe,"tblDetail"),o(fe,"getAllDeckInfo",async e=>{if(e&&(fe.idb=e),!fe.idb)throw new Error("illegal argument: idb is undefined.");fe.tblHeader||(fe.tblHeader=new Wo(fe.idb)),fe.tblDetail||(fe.tblDetail=new Ko(fe.idb));const t=await fe.tblHeader.getAll(),a=await fe.tblDetail.getAll();return t.length?t.map(r=>new fe(r,a)):[await fe.prepareSampleDeck()]}),o(fe,"createNewDeck",async(e,t,a)=>{const r=await fe.tblHeader.insert({name:e,description:t,lastUsedAt:new Date}),n=await fe.tblDetail.insertMany(a.map((s,l)=>({deckId:r.id,seq:l,name:s,description:""})));return new fe(r,n)}),o(fe,"prepareSampleDeck",async()=>{const e=Mn.slice(-1)[0];return await fe.createNewDeck(e.name,e.description,e.cardNames)});let ut=fe;class Wo extends Ja{constructor(t){super(t,"TblDeckHeader");o(this,"_prepareInitialRecords",()=>[])}}class Ko extends Ja{constructor(t){super(t,"TblDeckDetail");o(this,"_prepareInitialRecords",()=>[])}}const Mr=Mn.map(i=>({...i,lastUsedAt:new Date})).filter(i=>i.id<0);function Qo(i){const e=i-1;return e*e*e+1}function Fr(i,e){for(const t in e)i[t]=e[t];return i}function Xo({fallback:i,...e}){const t=new Map,a=new Map;function r(s,l,v){const{delay:d=0,duration:f=Y=>Math.sqrt(Y)*30,easing:p=Qo}=Fr(Fr({},e),v),g=s.getBoundingClientRect(),c=l.getBoundingClientRect(),h=g.left-c.left,S=g.top-c.top,y=g.width/c.width,m=g.height/c.height,T=Math.sqrt(h*h+S*S),C=getComputedStyle(l),L=C.transform==="none"?"":C.transform,$=+C.opacity;return{delay:d,duration:typeof f=="function"?f(T):f,easing:p,css:(Y,se)=>`
			   opacity: ${Y*$};
			   transform-origin: top left;
			   transform: ${L} translate(${se*h}px,${se*S}px) scale(${Y+(1-Y)*y}, ${Y+(1-Y)*m});
		   `}}function n(s,l,v){return(d,f)=>(s.set(f.key,d),()=>{if(l.has(f.key)){const p=l.get(f.key);return l.delete(f.key),r(p,d,f)}return s.delete(f.key),i&&i(d,f,v)})}return[n(a,t,!1),n(t,a,!0)]}var Jo=D("<div></div>"),Io=D('<div class="duel_card_row svelte-1vsjnqs"><div> </div> <div> </div></div>'),ec=D('<div class="duel_card_row svelte-1vsjnqs"><div class="svelte-1vsjnqs"></div> <div class="svelte-1vsjnqs"> </div></div>'),tc=D('<div class="duel_card_row svelte-1vsjnqs"><div class="svelte-1vsjnqs"></div> <div class="svelte-1vsjnqs"> </div></div>'),ic=D('<div class="duel_card_row svelte-1vsjnqs"><div> </div> <div> </div></div>'),ac=D('<div class="duel_card_row duel_card_detail svelte-1vsjnqs"><div class="svelte-1vsjnqs"> </div></div> <div class="duel_card_row duel_card_detail svelte-1vsjnqs"><div class="svelte-1vsjnqs"></div> <div class="svelte-1vsjnqs"><span> </span> / <span> </span></div></div>',1),rc=D('<button><div class="duel_card duel_card_visible svelte-1vsjnqs"><div class="duel_card_row svelte-1vsjnqs" style="position:relative"><div class="svelte-1vsjnqs"> </div> <div class="svelte-1vsjnqs"></div> <!></div> <!> <!> <!></div></button>'),nc=D('<button><div class="svelte-1vsjnqs">裏守備</div></button>'),sc=D('<div class="duel_card duel_card_face_down svelte-1vsjnqs"><div class="svelte-1vsjnqs">セット</div></div>');function _t(i,e){Ze(e,!1);let t=Te(e,"entity",8),a=Te(e,"state",8,"Disabled"),r=Te(e,"selectedList",28,()=>[]),n=Te(e,"isVisibleForcibly",8,!1),s=Te(e,"isWideMode",8,!1),l=Te(e,"actions",24,()=>[]),v=Te(e,"cardActionResolve",8),d=Te(e,"entitySelectResolve",8,()=>{}),f,p=Me(!1),g=()=>{},c=Te(e,"qty",12,void 0);const h=j=>{f=j.activator,ae(p,!1),c(j.qty),g=j.resolve};t().field.duel.view.onWaitStart.append(h);let S=Me(!1);const y=()=>{if(a()!=="Disabled"&&a()==="Selectable"&&c()===1){if(r().some(j=>j.seq!==t().seq)){r([t()]);return}c()===1&&d()&&d()([t()])}},m=j=>{(t().face==="FaceUp"||t().owner===t().field.duel.duelists.Below&&(t().isUnderControl||n()))&&t().field.duel.view.showCardInfo(t(),j??"Normal")},T=()=>{if(m(),a()==="Disabled")return;if(a()==="Selectable"){ae(p,!u(p)),c()===1&&(r().splice(0),t().duel.view.requireUpdate()),r(u(p)?[...r(),t()]:r().filter(ie=>ie!==t()));return}if(l().length===0)return;if(l().length===1){if(l()[0].dragAndDropOnly)return;if(v()){v()(l()[0]);return}g({action:l()[0]});return}if(!f)return;const j=t().field.duel.view;j.modalController.selectAction(j,{title:"行動を選択。",activator:f,actions:l(),cancelable:!0}).then(ie=>{g({action:ie})})},C=j=>{console.info("drag start",j,l()),t().field.duel.view.setDraggingActions(l()),ae(S,!0)},L=j=>{console.info("drag end",j,l()),t().field.duel.view.removeDraggingActions(),j.dataTransfer&&ae(S,!1)},$=()=>(m("Debug"),!1);Ie();var Y=Pe(),se=re(Y);{var k=j=>{var ie=rc(),Se=_(ie),Fe=_(Se),ne=_(Fe),N=_(ne),E=b(ne,4);ue(E,1,()=>t().attr,de,(q,O)=>{var G=Jo();M(()=>ye(G,`monster_attr ${u(O)??""} svelte-1vsjnqs`)),w(q,G)});var R=b(Fe,2);{var J=q=>{var O=Io(),G=_(O),te=_(G),z=b(G,2),U=_(z);M((K,Q)=>{ye(G,Vt(t().lvl!==t().origin.level?"different_from_its_origin":""),"svelte-1vsjnqs"),P(te,K),ye(z,Vt(t().rank!==t().origin.rank?"different_from_its_origin":""),"svelte-1vsjnqs"),P(U,Q)},[()=>"★".repeat(t().lvl||0),()=>"☆".repeat(t().rank||0)],me),w(q,O)},oe=q=>{var O=Pe(),G=re(O);{var te=U=>{var K=ec(),Q=b(_(K),2),B=_(Q);M(()=>P(B,`${bi[t().status.spellCategory]??""}魔法`)),w(U,K)},z=U=>{var K=Pe(),Q=re(K);{var B=V=>{var pe=tc(),we=b(_(pe),2),Be=_(we);M(()=>P(Be,`${wi[t().status.trapCategory]??""}罠`)),w(V,pe)};H(Q,V=>{t().status.kind==="Trap"&&t().status.trapCategory&&V(B)},!0)}w(U,K)};H(G,U=>{t().status.kind==="Spell"&&t().status.spellCategory?U(te):U(z,!1)},!0)}w(q,O)};H(R,q=>{t().status.kind==="Monster"?q(J):q(oe,!1)})}var le=b(R,2);{var F=q=>{var O=ic(),G=_(O),te=_(G),z=b(G,2),U=_(z);M(()=>{ye(G,Vt(t().psL!==t().origin.pendulumScaleL?"different_from_its_origin":""),"svelte-1vsjnqs"),P(te,`◀ ${t().psL??""}`),ye(z,Vt(t().psR!==t().origin.pendulumScaleR?"different_from_its_origin":""),"svelte-1vsjnqs"),P(U,`${t().psR??""} ▶`)}),w(q,O)};H(le,q=>{var O;(O=t().status.monsterCategories)!=null&&O.includes("Pendulum")&&q(F)})}var Z=b(le,2);{var X=q=>{var O=ac(),G=re(O),te=_(G),z=_(te),U=b(G,2),K=b(_(U),2),Q=_(K),B=_(Q),V=b(Q,2),pe=_(V);M((we,Be)=>{P(z,`${we??""}
            ${Be??""}`),ye(Q,Vt(t().atk!==t().origin.attack?"different_from_its_origin":""),"svelte-1vsjnqs"),P(B,t().atk??"?"),ye(V,Vt(t().def!==t().origin.defense?"different_from_its_origin":""),"svelte-1vsjnqs"),P(pe,t().def??"?")},[()=>t().types.map(we=>Ti[we]+(s()?la[we]:"")).join(),()=>{var we;return(we=t().status.monsterCategories)==null?void 0:we.map(Be=>Si[Be]+(s()?sa[Be]:"")).join()}],me),w(q,O)};H(Z,q=>{t().status.kind==="Monster"&&q(X)})}M(q=>{ye(ie,`duel_card button_style_reset ${t().status.kind??""} ${q??""} ${(u(p)?"duel_card_selected":"")??""} ${a()??""} duel_card_${t().orientation??""} ${(u(S)?"isDragging":"")??""} ${(s()?"duel_card_wide":"")??""} duel_card_${t().face??""} ${(t().isOnField?"duel_card_is_on_field":"")??""} svelte-1vsjnqs`),wt(ie,"draggable",a()==="Draggable"),wt(ie,"title",t().nm),P(N,t().nm)},[()=>{var q;return((q=t().status.monsterCategories)==null?void 0:q.join(" "))||""}],me),Oe("dragstart",ie,C),Oe("dragend",ie,L),Oe("click",ie,T),Oe("dblclick",ie,y),Oe("mouseenter",ie,()=>m()),Oe("contextmenu",ie,$),w(j,ie)},W=j=>{var ie=Pe(),Se=re(ie);{var Fe=N=>{var E=nc();M(()=>ye(E,`duel_card duel_card_face_down duel_card_face_down_defense ${a()??""}  ${(u(p)?"duel_card_selected":"")??""} svelte-1vsjnqs`)),Oe("click",E,T),Oe("dblclick",E,y),w(N,E)},ne=N=>{var E=sc();w(N,E)};H(Se,N=>{t().battlePosition==="Set"?N(Fe):N(ne,!1)},!0)}w(j,ie)};H(se,j=>{t().face==="FaceUp"||n()||t().controller.duelistType==="Player"&&t().isUnderControl?j(k):j(W,!1)})}w(i,Y),Ge()}var lc=D('<div class="phase_display svelte-1mupj1p"><span class="svelte-1mupj1p"> </span> </div>'),oc=D('<div class="lifepoint_display svelte-1mupj1p"><div class="svelte-1mupj1p"> </div> <div class="svelte-1mupj1p"> </div></div>'),cc=(i,e,t)=>e(u(t)),dc=D('<div class="svelte-1mupj1p"><button class="phase_button svelte-1mupj1p"> </button></div>'),uc=D("<div><!></div>"),vc=D('<div class="svelte-1mupj1p"><!></div>'),fc=D("<div><!></div>"),pc=D("<!> <!> <!>",1),hc=D('<div style="position: absolute;" class="card_animation_receiver svelte-1mupj1p"><!></div>'),gc=D('<div style="position: absolute; display:flex;justify-content: center;" class="svelte-1mupj1p"><!></div>'),yc=D(" <!> 】",1),_c=D('<div style="position: absolute; bottom:0rem" class="svelte-1mupj1p"> <!></div>'),mc=D("<!> <!>",1),Sc=D('<div class="badge svelte-1mupj1p"> </div>'),bc=D('<div class="card_animation_receiver svelte-1mupj1p"><!></div>'),wc=D("<!> <!> <!> <!>",1),Tc=D('<td><div role="listitem"><!></div></td>');function kc(i,e){Ze(e,!1);let t=Te(e,"view",8),a=Te(e,"row",8),r=Te(e,"column",8),n=Te(e,"selectedList",28,()=>[]),s=Me(t().getCell(a(),r()));const l=()=>{ae(s,t().getCell(a(),r()))};u(s).onUpdate.append(l),t().onDuelUpdate.append(l),t().modalController.onUpdate.append(l);let v,d=Me([]),f=()=>{},p;const g=E=>{ae(C,void 0),n().reset(),v=E.activator,f=E.resolve,ae(d,E.enableActions),p=E.selectableEntities,E.entitiesValidator};t().onWaitStart.append(g);let c,h=Me(!1);const S=E=>{c=E,ae(h,E.some(R=>{var J;return(J=R.validate(t().duel.priorityHolder,t().duel.chainBlockInfos))==null?void 0:J.includes(u(s))})||!1),l()},y=()=>{c=void 0,ae(h,!1),l()};t().onDragStart.append(S),t().onDragEnd.append(y);const[m,T]=Td;let C=Me(void 0);const L=E=>{if(v=void 0,u(s)===E.to||u(s).entities.includes(E.entity)){ae(C,E);const R=E.resolve;ae(s,u(s)),setTimeout(()=>{ae(C,void 0),E.count++,E.count>1&&R()},600)}};t().onAnimation.append(L);const $=E=>{f({phaseChange:E})},Y=()=>u(s).isStackCell&&u(s).entities.flatMap(E=>E.actions).filter(E=>u(d).map(R=>R.seq).some(R=>R===E.seq)).length>0,se=()=>{if(Ne(s,u(s).field.duel.view.infoBoardState="Log"),u(s).isStackCell){Ne(s,u(s).field.duel.view.infoBoardState="CellInfo"),Ne(s,u(s).field.duel.view.infoBoardCell=u(s)),u(s).field.duel.view.requireUpdate();const E=u(s).entities.flatMap(R=>R.actions).filter(R=>u(d).map(J=>J.seq).some(J=>J===R.seq));if(E.length){if(!v)return;const R=u(s).field.duel.view;R.modalController.selectAction(R,{title:"カードを選択。",activator:v,actions:E,cancelable:!0}).then(J=>{f({action:J})});return}}u(s).field.duel.view.requireUpdate(),console.info(u(s))},k=E=>{E.preventDefault(),E.dataTransfer&&(E.dataTransfer.dropEffect="move")},W=E=>{E.preventDefault(),console.info("drop",E,u(h),c),E.dataTransfer&&(E.dataTransfer.dropEffect="move");try{if(u(h)&&c){if(console.info(c,u(s)),c.length===1){const R=c[0].getClone();R.cell=u(s),f({action:R})}else if(c.length>1){if(!v)throw new ke("想定されない状態");u(s).field.duel.view.modalController.cancelAll(),u(s).field.duel.view.modalController.selectAction(u(s).field.duel.view,{title:"選択",activator:v,actions:c,cancelable:!1})}}}finally{t().removeDraggingActions()}},j=(...E)=>{if(t().duel.priorityHolder.duelistType==="NPC"||t().waitMode==="Animation")return"Disabled";if(p&&p.find(oe=>E.find(le=>oe===le)))return"Selectable";if(!u(d)||u(d).length===0||t().waitMode!=="SelectFieldAction"||Object.values(t().modalController.states).some(oe=>oe==="Shown"))return"Disabled";const R=u(d).filter(oe=>E.includes(oe.entity));if(R.length===0)return"Disabled";if(R.length>1)return"Clickable";if(u(d)[0].playType==="RuleDraw")return"Draggable";if(u(s).isStackCell||R[0].entity!==E[0])return"Clickable";const J=R[0].validate(t().duel.priorityHolder,t().duel.chainBlockInfos);return J&&J.length>0?"Draggable":"Clickable"};Ie();var ie=Tc(),Se=_(ie);Se.__click=se;var Fe=_(Se);{var ne=E=>{var R=Pe(),J=re(R);{var oe=le=>{var F=Pe(),Z=re(F);{var X=O=>{var G=lc(),te=_(G),z=_(te),U=b(te,1,!0);M((K,Q)=>{P(z,K),P(U,Q)},[()=>String(u(s).field.duel.clock.turn).padStart(2,"0"),()=>u(s).field.duel.phase.toUpperCase()],me),w(O,G)},q=O=>{var G=Pe(),te=re(G);{var z=K=>{var Q=oc(),B=_(Q),V=_(B),pe=b(B,2),we=_(pe);M(()=>{P(V,u(s).field.duel.duelists.Above.lp),P(we,u(s).field.duel.duelists.Below.lp)}),w(K,Q)},U=K=>{var Q=Pe(),B=re(Q);{var V=pe=>{var we=Pe(),Be=re(we);{var he=ge=>{var ve=Pe(),x=re(ve);{var A=I=>{var ee=Pe(),Ae=re(ee);ue(Ae,1,()=>t().duel.nextPhaseList,de,(Re,xe)=>{var Xe=dc(),Ci=_(Xe);Ci.__click=[cc,$,xe];var Di=_(Ci);M(Ei=>P(Di,Ei),[()=>u(xe).toUpperCase()],me),w(Re,Xe)}),w(I,ee)};H(x,I=>{t().duel.isEnded||I(A)})}w(ge,ve)};H(Be,ge=>{t().waitMode==="SelectFieldAction"&&ge(he)})}w(pe,we)};H(B,pe=>{u(s).column===5&&pe(V)},!0)}w(K,Q)};H(te,K=>{u(s).column===3?K(z):K(U,!1)},!0)}w(O,G)};H(Z,O=>{u(s).column===1?O(X):O(q,!1)})}w(le,F)};H(J,le=>{u(s).row===3&&le(oe)})}w(E,R)},N=E=>{var R=Pe(),J=re(R);{var oe=F=>{var Z=pc(),X=re(Z);{var q=z=>{var U=uc(),K=_(U);_t(K,{get entity(){return u(C).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),M(()=>ye(U,`card_animation_receiver ${u(s).cellType??""} svelte-1mupj1p`)),zt(1,U,()=>T,()=>({key:u(C).entity.seq})),w(z,U)};H(X,z=>{u(C)&&u(C).entity&&u(C).to===u(s)&&u(C).index==="Top"&&z(q)})}var O=b(X,2);ue(O,1,()=>u(s).cardEntities,de,(z,U)=>{var K=Pe(),Q=re(K);{var B=V=>{var pe=vc(),we=_(pe);const Be=me(()=>j(u(U))),he=me(()=>u(d).filter(ge=>ge.entity===u(U)));_t(we,{get entity(){return u(U)},get state(){return u(Be)},get actions(){return u(he)},cardActionResolve:void 0,get selectedList(){return n()},set selectedList(ge){n(ge)},$$legacy:!0}),zt(2,pe,()=>m,()=>({key:u(U).seq})),w(V,pe)};H(Q,V=>{(!u(C)||u(C).entity.seq!==u(U).seq)&&V(B)})}w(z,K)});var G=b(O,2);{var te=z=>{var U=fc(),K=_(U);_t(K,{get entity(){return u(C).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),M(()=>ye(U,`card_animation_receiver ${u(s).cellType??""} svelte-1mupj1p`)),zt(1,U,()=>T,()=>({key:u(C).entity.seq})),w(z,U)};H(G,z=>{u(C)&&u(C).entity&&u(C).to===u(s)&&u(C).index!=="Top"&&z(te)})}w(F,Z)},le=F=>{var Z=wc(),X=re(Z);{var q=Q=>{var B=hc(),V=_(B);_t(V,{get entity(){return u(C).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),zt(1,B,()=>T,()=>({key:u(C).entity.seq})),w(Q,B)};H(X,Q=>{u(C)&&u(C).entity&&u(C).to===u(s)&&u(C).index!=="Top"&&Q(q)})}var O=b(X,2);{var G=Q=>{var B=mc(),V=re(B);ue(V,1,()=>u(s).cardEntities.toReversed(),de,(Be,he,ge)=>{var ve=Pe(),x=re(ve);{var A=I=>{var ee=gc(),Ae=_(ee);const Re=me(()=>ge===0&&!u(s).isStackCell?j(...u(s).cardEntities):void 0),xe=me(()=>ge===0?u(d).filter(Xe=>u(s).cardEntities.includes(Xe.entity)):void 0);_t(Ae,{get entity(){return u(he)},get state(){return u(Re)},get actions(){return u(xe)},cardActionResolve:void 0,get selectedList(){return n()},set selectedList(Xe){n(Xe)},$$legacy:!0}),zt(2,ee,()=>m,()=>({key:u(he).seq})),w(I,ee)};H(x,I=>{(!u(C)||u(C).entity.seq!==u(he).seq)&&I(A)})}w(Be,ve)});var pe=b(V,2);{var we=Be=>{var he=_c(),ge=_(he),ve=b(ge);ue(ve,1,()=>Object.keys(u(s).cardEntities[0].status.maxCounterQty),de,(x,A)=>{var I=yc(),ee=re(I),Ae=b(ee);{var Re=xe=>{var Xe=qt();M(()=>P(Xe,`/${u(s).cardEntities[0].status.maxCounterQty[u(A)]??""}`)),w(xe,Xe)};H(Ae,xe=>{(u(s).cardEntities[0].status.maxCounterQty[u(A)]??!1)&&xe(Re)})}M(xe=>P(ee,`【
              ${Wl[u(A)]??""}${xe??""} `),[()=>u(s).cardEntities[0].counterHolder.getQty(u(A))],me),w(x,I)}),M(()=>P(ge,`【${u(s).cardEntities[0].battlePositionName??""}】 `)),w(Be,he)};H(pe,Be=>{u(s).cardEntities[0].battlePosition&&Be(we)})}w(Q,B)};H(O,Q=>{u(s).cardEntities.length>0&&Q(G)})}var te=b(O,2);{var z=Q=>{var B=Sc(),V=_(B);M(()=>P(V,u(s).cardEntities.length)),w(Q,B)};H(te,Q=>{u(s).isStackCell&&Q(z)})}var U=b(te,2);{var K=Q=>{var B=bc(),V=_(B);_t(V,{get entity(){return u(C).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),zt(1,B,()=>T,()=>({key:u(C).entity.seq})),w(Q,B)};H(U,Q=>{u(C)&&u(C).entity&&u(C).to===u(s)&&u(C).index==="Top"&&Q(K)})}w(F,Z)};H(J,F=>{u(s).cellType==="Hand"?F(oe):F(le,!1)},!0)}w(E,R)};H(Fe,E=>{u(s).cellType==="Disable"?E(ne):E(N,!1)})}M(E=>{ye(ie,`${`duel_field_cell duel_field_cell_${u(s).cellType}`??""} svelte-1mupj1p`),wt(ie,"colspan",u(s).cellType==="Hand"?7:1),ye(Se,`${E??""} svelte-1mupj1p`)},[()=>`duel_card_wrapper ${u(s).cellType} ${u(h)?"can_accept_drop":""} ${Y()?"can_action":""}`],me),Oe("dragover",Se,E=>k(E)),Oe("drop",Se,E=>W(E)),w(i,ie),Ge()}mi(["click"]);var Cc=D('<tr><td style=" white-space: nowrap;text-align: center;"> </td><td class="svelte-13svkzh"> </td></tr>'),Dc=D('<div class="duel_log svelte-13svkzh"><table><tbody></tbody></table></div>');function Ec(i,e){var v,d;Ze(e,!1);let t=Me(void 0),a=Te(e,"log",12);const r=()=>{a(a()),Hs().then(()=>u(t)&&u(t).scroll(0,u(t).clientHeight*990))};(d=(v=a())==null?void 0:v.onUpdate)==null||d.append(r),Ie();var n=Dc(),s=_(n),l=_(s);ue(l,5,()=>a().records,de,(f,p)=>{var g=Cc(),c=_(g),h=_(c),S=b(c),y=_(S);M(()=>{var m,T;ye(c,`duelist ${((m=u(p).duelist)==null?void 0:m.seat)??""} svelte-13svkzh`),P(h,((T=u(p).duelist)==null?void 0:T.profile.name)||"SYSTEM"),P(y,u(p).text)}),w(f,g)}),vl(n,f=>ae(t,f),()=>u(t)),w(i,n),Ge()}var Ac=D('<div><div class="duelist_name svelte-1u7codf"> </div> <div> </div></div>');function Br(i,e){Ze(e,!1);let t=Te(e,"duelist",12),a=Me(0),r=Me();const n=async()=>{const g=t().lp-u(a);if(!u(r)||Math.abs(g)<10){ae(a,t().lp),u(r)&&(u(r)(),ae(r,void 0));return}ae(a,u(a)+Math.floor(Math.random()*g)),await yo(100),n()},s=()=>{t(t()),!u(r)&&t().lp!==u(a)&&new Promise(g=>{ae(r,g),Math.abs(t().lp-u(a)),n()})};t().duel.log.onUpdate.append(s),n(),Ie();var l=Ac(),v=_(l),d=_(v),f=b(v,2),p=_(f);M(()=>{ye(l,`duelist ${t().seat??""} svelte-1u7codf`),P(d,t().profile.name),ye(f,`duelist_lp ${(u(r)?"vibration":"")??""} svelte-1u7codf`),P(p,u(a))}),w(i,l),Ge()}const xc=()=>{};var Pc=D("<div><!></div>"),Mc=D("<div></div>"),Fc=(i,e,t)=>e.resolve(u(t)),Bc=(i,e)=>e.resolve(void 0),qc=D('<button class="svelte-1h1of0m">Cancel</button>'),Oc=D('<div class="base svelte-1h1of0m"><button class="overlay svelte-1h1of0m">☆</button> <div class="window svelte-1h1of0m"><div> </div> <!> <div><button class="svelte-1h1of0m">OK</button> <!></div></div></div>');function Nc(i,e){Ze(e,!0);let t=Ss(Dt([]));var a=Pe(),r=re(a);{var n=s=>{var l=Oc(),v=_(l);v.__click=[xc];var d=b(v,2),f=_(d),p=_(f),g=b(f,2);ue(g,17,()=>e.entities.map(m=>m.controller.seat).getDistinct(),de,(m,T)=>{var C=Mc();ue(C,21,()=>e.entities.filter(L=>L.controller.seat===u(T)).toSorted(xn),de,(L,$)=>{var Y=Pc(),se=_(Y);_t(se,{get entity(){return u($)},isVisibleForcibly:!0,state:"Selectable",entitySelectResolve:k=>e.resolve(k),get qty(){return e.qty},cardActionResolve:void 0,get selectedList(){return u(t)},set selectedList(k){ae(t,Dt(k))}}),w(L,Y)}),M(()=>ye(C,`entities_list ${u(T)??""} svelte-1h1of0m`)),w(m,C)});var c=b(g,2),h=_(c);h.__click=[Fc,e,t];var S=b(h,2);{var y=m=>{var T=qc();T.__click=[Bc,e],w(m,T)};H(S,m=>{e.cancelable&&m(y)})}M(m=>{P(p,e.title),h.disabled=m},[()=>!e.validator(u(t))]),w(s,l)};H(r,s=>{s(n)})}w(i,a),Ge()}mi(["click"]);const Rc=(i,e)=>{e.cancelable&&e.resolve(void 0)};var Lc=D('<div class="duel_card_wrapper svelte-11mc7y0"><!> <div> </div></div>'),Hc=(i,e)=>e.resolve(),$c=D('<div><button class="cancel_button svelte-11mc7y0">Cancel</button></div>'),jc=D('<div><button>★</button> <div><div> </div> <div class="flex svelte-11mc7y0"></div> <!></div></div>');function Uc(i,e){Ze(e,!0);const[t,a]=gl(),r=()=>hl(n,"$isDragging",t);let n=fl(!1);const s=()=>n.set(!0),l=()=>n.set(!1);e.view.onDragStart.append(s),e.view.onDragEnd.append(l);const v=g=>{if(e.activator.duelistType==="NPC")return"Disabled";const c=g.validate(e.activator,e.view.duel.chainBlockInfos);return c&&c.length>0?"Draggable":"Clickable"};var d=Pe(),f=re(d);{var p=g=>{var c=jc(),h=_(c);h.__click=[Rc,e];var S=b(h,2),y=_(S),m=_(y),T=b(y,2);ue(T,21,()=>e.actions,de,($,Y)=>{var se=Lc(),k=_(se);const W=Ht(()=>v(u(Y))),j=Ht(()=>e.dragAndDropOnly?[]:[u(Y)]);_t(k,{get entity(){return u(Y).entity},isVisibleForcibly:!0,get state(){return u(W)},get actions(){return u(j)},get cardActionResolve(){return e.resolve}});var ie=b(k,2),Se=_(ie);M(()=>P(Se,`«${u(Y).title??""}»`)),w($,se)});var C=b(T,2);{var L=$=>{var Y=$c(),se=_(Y);se.__click=[Hc,e],w($,Y)};H(C,$=>{e.cancelable&&$(L)})}M(()=>{ye(c,`${`base ${r()?"minimum_mode":""}`??""} svelte-11mc7y0`),ye(h,`${`overlay ${r()?"minimum_mode":""}`??""} svelte-11mc7y0`),ye(S,`${`window ${r()?"minimum_mode":""}`??""} svelte-11mc7y0`),P(m,e.title)}),w(g,c)};H(f,g=>{g(p)})}w(i,d),Ge(),a()}mi(["click"]);const Zc=(i,e,t,a)=>{e().cancelable&&(t()(void 0),ae(a,!1))};var Gc=(i,e,t)=>e()(t()),Vc=D("<li><button> </button></li>"),zc=(i,e)=>e()(void 0),Yc=D("<button>Cancel</button>"),Wc=D('<div class="base svelte-1103gpy"><button class="overlay svelte-1103gpy">★</button> <div class="window svelte-1103gpy"><div> </div> <ui class="text_list svelte-1103gpy"></ui> <!></div></div>');function Kc(i,e){Ze(e,!1);let t=Te(e,"arg",8),a=Te(e,"resolve",8),r=Me(!0);Ie();var n=Pe(),s=re(n);{var l=v=>{var d=Wc(),f=_(d);f.__click=[Zc,t,a,r];var p=b(f,2),g=_(p),c=_(g),h=b(g,2);ue(h,5,()=>t().choises,de,(m,T)=>{let C=()=>u(T).seq,L=()=>u(T).text;var $=Vc(),Y=_($);Y.__click=[Gc,a,C];var se=_(Y);M(()=>{ye($,`text_item ${C()??""} svelte-1103gpy`),P(se,L())}),w(m,$)});var S=b(h,2);{var y=m=>{var T=Yc();T.__click=[zc,a],w(m,T)};H(S,m=>{t().cancelable&&m(y)})}M(()=>P(c,t().title)),w(v,d)};H(s,v=>{u(r)&&v(l)})}w(i,n),Ge()}mi(["click"]);var Qc=D('<div class="base svelte-1y912d"><!> <!> <!></div>');function Xc(i,e){var p,g;Ze(e,!1);let t=Te(e,"modalController",12);const a=()=>{t(t())};(g=(p=t())==null?void 0:p.onUpdate)==null||g.append(a),Ie();var r=Qc(),n=_(r);{var s=c=>{Nc(c,{get title(){return t().duelEntitiesSelectorArg.title},get entities(){return t().duelEntitiesSelectorArg.entities},get validator(){return t().duelEntitiesSelectorArg.validator},get qty(){return t().duelEntitiesSelectorArg.qty},get cancelable(){return t().duelEntitiesSelectorArg.cancelable},resolve:h=>{t().duelEntitiesSelectorResolve(h)}})};H(n,c=>{t().states.DuelEntitiesSelector==="Shown"&&c(s)})}var l=b(n,2);{var v=c=>{const h=me(()=>t().cardActionSelectorArg.dragAndDropOnly??!1);Uc(c,{get view(){return t().view},get title(){return t().cardActionSelectorArg.title},get activator(){return t().cardActionSelectorArg.activator},get actions(){return t().cardActionSelectorArg.actions},get dragAndDropOnly(){return u(h)},get cancelable(){return t().cardActionSelectorArg.cancelable},resolve:S=>{console.info(S),t().cardActionSelectorResolve(S)}})};H(l,c=>{t().states.DuelActionSelector==="Shown"&&c(v)})}var d=b(l,2);{var f=c=>{Kc(c,{get arg(){return t().duelTextSelectorArg},resolve:h=>{console.info(h),t().duelTextSelectorResolve(h)}})};H(d,c=>{t().states.DuelTextSelector==="Shown"&&c(f)})}w(i,r),Ge()}const Jc=(i,e)=>(e(e()==="Normal"?"Debug":"Normal"),!0);var Ic=D('<div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"><pre class="description svelte-nn7bjy"> </pre></div></div> <div class="duel_card_info_row svelte-nn7bjy" style=" justify-content: space-between;"><div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"> </div></div>',1),ed=D('<div></div> <div class="svelte-nn7bjy"> </div>',1),td=D("<div> </div>"),id=D("<div> </div>"),ad=D('<div class="duel_card_info_row svelte-nn7bjy"><!> <!></div> <div class="duel_card_info_row svelte-nn7bjy"></div>',1),rd=D('<div class="duel_card_row svelte-nn7bjy"><div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"> </div></div>'),nd=D('<div class="duel_card_row svelte-nn7bjy"><div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"> </div></div>'),sd=D("<!> <!>",1),ld=D('<div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"><pre class="description svelte-nn7bjy"> </pre></div></div>'),od=D('<div class="svelte-nn7bjy"> </div>'),cd=D('<div class="svelte-nn7bjy"> </div>'),dd=D('<div class="svelte-nn7bjy"> </div>'),ud=D('<div class="svelte-nn7bjy"> </div>'),vd=D('<div class="svelte-nn7bjy"> </div>'),fd=D('<div class="svelte-nn7bjy"> </div>'),pd=D('<div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"><pre class="json svelte-nn7bjy"> </pre> <pre class="json svelte-nn7bjy"> </pre> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div></div></div>'),hd=D('<div class="svelte-nn7bjy">※テスト用カードです</div>'),gd=D('<div class="duel_card_info_links svelte-nn7bjy"><a target="_blank" rel="noopener noreferrer" title="遊戯王カードWiki" class="svelte-nn7bjy">⇒遊戯王カードWiki</a> <a target="_blank" rel="noopener noreferrer" title="コナミカードデータベース" class="svelte-nn7bjy"> </a></div>'),yd=D('<div role="contentinfo"><div class="duel_card_info_header svelte-nn7bjy"><div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"> </div></div> <div class="duel_card_info_row svelte-nn7bjy" style="position:sticky; top:0;"><div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"> </div></div> <!></div> <div class="duel_card_info_body svelte-nn7bjy"><!></div> <div class="duel_card_info_footer svelte-nn7bjy"><!></div></div>');function _d(i,e){Ze(e,!1);let t=Te(e,"entity",8,void 0);const a=()=>t()?Ue[t().origin.name]:void 0,r=()=>{var d;return t()&&(t().origin.cardId??!1)?`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=2&cid=${t().origin.cardId}`:`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=1&sess=1&rp=10&mode=&sort=1&keyword=${(d=a())==null?void 0:d.name}&stype=1&ctype=&othercon=2&starfr=&starto=&pscalefr=&pscaleto=&linkmarkerfr=&linkmarkerto=&link_m=2&atkfr=&atkto=&deffr=&defto=&releaseDStart=1&releaseMStart=1&releaseYStart=1999&releaseDEnd=&releaseMEnd=&releaseYEnd=`};let n=Te(e,"mode",12,"Normal");Ie();var s=Pe(),l=re(s);{var v=d=>{var f=yd();f.__contextmenu=[Jc,n];var p=_(f),g=_(p),c=_(g),h=_(c),S=b(g,2),y=_(S),m=_(y),T=b(y,2),C=_(T),L=b(S,2);{var $=ne=>{var N=sd(),E=re(N);{var R=F=>{var Z=Ic(),X=re(Z),q=_(X),O=_(q),G=_(O),te=b(X,2),z=_(te),U=_(z),K=b(z,2),Q=_(K);M(()=>{P(G,Ue[t().origin.name].pendulumDescription),P(U,`◀ ${t().psL??""}`),P(Q,`${t().psR??""} ▶`)}),w(F,Z)};H(E,F=>{var Z;(Z=t().status.monsterCategories)!=null&&Z.includes("Pendulum")&&F(R)})}var J=b(E,2);{var oe=F=>{var Z=ad(),X=re(Z),q=_(X);ue(q,1,()=>t().attr,de,(te,z)=>{var U=ed(),K=re(U),Q=b(K,2),B=_(Q);M(()=>{ye(K,`monster_attr ${u(z)??""} svelte-nn7bjy`),P(B,`${Ia[u(z)]??""}属性`)}),w(te,U)});var O=b(q,2);ue(O,1,()=>t().types,de,(te,z)=>{var U=td(),K=_(U);M(()=>{ye(U,`monster_cat ${u(z)??""} svelte-nn7bjy`),P(K,`${Ti[u(z)]??""}${la[u(z)]??""}族`)}),w(te,U)});var G=b(X,2);ue(G,5,()=>t().status.monsterCategories??[],de,(te,z)=>{var U=id(),K=_(U);M(()=>{ye(U,`monster_cat ${u(z)??""} svelte-nn7bjy`),P(K,`${Si[u(z)]??""}${sa[u(z)]??""}`)}),w(te,U)}),w(F,Z)},le=F=>{var Z=Pe(),X=re(Z);{var q=G=>{var te=rd(),z=b(_(te),2),U=_(z);M(()=>P(U,`${bi[t().status.spellCategory]??""}魔法`)),w(G,te)},O=G=>{var te=Pe(),z=re(te);{var U=K=>{var Q=nd(),B=b(_(Q),2),V=_(B);M(()=>P(V,`${wi[t().status.trapCategory]??""}罠`)),w(K,Q)};H(z,K=>{t().status.kind==="Trap"&&t().status.trapCategory&&K(U)},!0)}w(G,te)};H(X,G=>{t().status.kind==="Spell"&&t().status.spellCategory?G(q):G(O,!1)},!0)}w(F,Z)};H(J,F=>{t().status.kind==="Monster"?F(oe):F(le,!1)})}w(ne,N)};H(L,ne=>{n()==="Normal"&&ne($)})}var Y=b(p,2),se=_(Y);{var k=ne=>{var N=ld(),E=_(N),R=_(E),J=_(R);M(oe=>P(J,oe),[()=>{var oe;return(oe=a())==null?void 0:oe.description}],me),w(ne,N)},W=ne=>{var N=pd(),E=_(N),R=_(E),J=_(R),oe=b(R,2),le=_(oe),F=b(oe,2);F.textContent='"actions" :[';var Z=b(F,2);ue(Z,1,()=>t().actions,de,(ve,x)=>{var A=od(),I=_(A);M(()=>P(I,`"${u(x).playType??""} ${u(x).title??""}",`)),w(ve,A)});var X=b(Z,2);X.textContent="],";var q=b(X,2);q.textContent='"continuousEffects" :[';var O=b(q,2);ue(O,1,()=>t().continuousEffects,de,(ve,x)=>{var A=cd(),I=_(A);M(()=>P(I,`"${u(x).isStarted??""}",`)),w(ve,A)});var G=b(O,2);G.textContent="],";var te=b(G,2);te.textContent='"procFilters" :[';var z=b(te,2);ue(z,1,()=>t().procFilterBundle.operators,de,(ve,x)=>{var A=dd(),I=_(A);M(ee=>P(I,`"${ee??""} ${u(x).title??""}",`),[()=>u(x).isSpawnedBy.toString()],me),w(ve,A)});var U=b(z,2);U.textContent="],";var K=b(U,2);K.textContent='"cardRelations" :[';var Q=b(K,2);ue(Q,1,()=>t().cardRelationBundle.operators,de,(ve,x)=>{var A=ud(),I=_(A);M(ee=>P(I,`"${ee??""} ${u(x).title??""}",`),[()=>u(x).isSpawnedBy.toString()],me),w(ve,A)});var B=b(Q,2);B.textContent="],";var V=b(B,2);V.textContent='"numericStateOperators" :[';var pe=b(V,2);ue(pe,1,()=>t().numericOprsBundle.operators,de,(ve,x)=>{var A=vd(),I=_(A);M(ee=>P(I,`"${ee??""} ${u(x).title??""}",`),[()=>u(x).isSpawnedBy.toString()],me),w(ve,A)});var we=b(pe,2);we.textContent="],";var Be=b(we,2);Be.textContent='"stateOperators" :[';var he=b(Be,2);ue(he,1,()=>t().statusOperatorBundle.operators,de,(ve,x)=>{var A=fd(),I=_(A);M(ee=>P(I,`"${ee??""} ${u(x).title??""}",`),[()=>u(x).isSpawnedBy.toString()],me),w(ve,A)});var ge=b(he,2);ge.textContent="],",M((ve,x)=>{P(J,`"info" :${ve??""},`),P(le,`"status" :${x??""},`)},[()=>JSON.stringify(t().info,null,2),()=>JSON.stringify(t().status,null,2)],me),w(ne,N)};H(se,ne=>{n()==="Normal"?ne(k):ne(W,!1)})}var j=b(Y,2),ie=_(j);{var Se=ne=>{var N=hd();w(ne,N)},Fe=ne=>{var N=gd(),E=_(N),R=b(E,2),J=_(R);M(oe=>{var le;wt(E,"href",`https://yugioh-wiki.net/index.php?${t().origin.wikiEncodedName}`),wt(R,"href",oe),P(J,`⇒${((le=t())!=null&&le.origin.cardId?"公式カードページ":"公式で検索")??""}`)},[r],me),w(ne,N)};H(ie,ne=>{var N;(N=t())!=null&&N.origin.isForTest?ne(Se):ne(Fe,!1)})}M((ne,N,E)=>{ye(f,`duel_card duel_card_info ${t().origin.kind??""} ${ne??""} svelte-nn7bjy`),P(h,t().nm),P(m,N),P(C,E)},[()=>{var ne;return(ne=t().origin.monsterCategories)==null?void 0:ne.join(" ")},()=>"★".repeat(t().lvl||0),()=>"☆".repeat(t().rank||0)],me),w(d,f)};H(l,d=>{t()&&d(v)})}w(i,s),Ge()}mi(["contextmenu"]);var md=D('<div class="duel_field_cell_info_item svelte-1xj7qf1"><!></div>'),Sd=D('<div class="duel_field_cell_info_box svelte-1xj7qf1"><div class="duel_field_cell_info_label svelte-1xj7qf1"> </div> <!></div>'),bd=D('<div class="duel_field_cell_info svelte-1xj7qf1"><div class="duel_field_cell_info_header item_btn svelte-1xj7qf1"><div class="svelte-1xj7qf1"> </div> <div class="svelte-1xj7qf1"> </div></div> <div class="duel_field_cell_info_body svelte-1xj7qf1"></div></div>');function wd(i,e){Ze(e,!1);let t=Te(e,"cell",12);const a=()=>{t(t())},r=g=>t().cardEntities.filter(c=>c.face===g);t().field.duel.view.onDuelUpdate.append(a),Ie();var n=bd(),s=_(n),l=_(s),v=_(l),d=b(l,2),f=_(d),p=b(s,2);ue(p,4,()=>["FaceUp","FaceDown"],de,(g,c)=>{var h=Pe(),S=re(h);{var y=m=>{var T=Sd(),C=_(T),L=_(C),$=b(C,2);ue($,1,()=>r(c).toSorted(xn),de,(Y,se)=>{var k=md(),W=_(k);const j=me(()=>t().owner===t().field.duel.duelists.Below);_t(W,{get entity(){return u(se)},get isVisibleForcibly(){return u(j)},isWideMode:!0,cardActionResolve:void 0}),w(Y,k)}),M(()=>P(L,c==="FaceUp"?"表向き":"裏向き")),w(m,T)};H(S,m=>{r(c).length&&m(y)})}w(g,h)}),M(()=>{var g;P(v,(g=t().owner)==null?void 0:g.profile.name),P(f,t().cellType)}),w(i,n),Ge()}const Td=Xo({duration:400});var kd=D('<div class="duel_field_header_message svelte-accyye"> </div> <div class="duel_field_header_buttons svelte-accyye"><button class="svelte-accyye">サレンダー</button></div>',1),Cd=D("<tr></tr>"),Dd=D('<table class="duel_field svelte-accyye"><tbody class="svelte-accyye"></tbody></table>'),Ed=D('<button class="svelte-accyye">OK</button>'),Ad=D('<div style="position:absolute;right:0;top:0"> </div> <div class="flex duel_desk svelte-accyye"><div class="duel_desk_left v_flex svelte-accyye"><!> <!> <!></div> <div class=" duel_desk_center v_flex svelte-accyye"><div class="duel_field_header svelte-accyye"><!></div> <div class="svelte-accyye"><!></div> <div class="duel_field_footer svelte-accyye"><!></div></div> <div class=" duel_desk_right svelte-accyye" style="text-align: left;"><!></div></div> <!>',1);function xd(i,e){Ze(e,!1);let t=Te(e,"duel",12),a=()=>{},r=Me(()=>!0),n=Me();const s=F=>{a=F.resolve,ae(r,F.entitiesValidator),ae(n,F.selectableEntities),F.duelEntitiesSelectorArg&&t().view.modalController.selectDuelEntities(F.duelEntitiesSelectorArg).then(Z=>{a({selectedEntities:Z})})};t().view.onWaitStart.append(s);let l=Me(void 0),v=Me("Normal");const d=({card:F,mode:Z})=>{ae(l,F),ae(v,Z)};t().view.onShowCardEntity.append(d);let f=Te(e,"selectedList",28,()=>[]);const p=()=>{t(t())};t().view.onDuelUpdate.append(p);const g=()=>{u(r)(f())&&a({selectedEntities:f()})},c=()=>{a({surrender:!0})};t().main(),Ie();var h=Ad(),S=re(h),y=_(S),m=b(S,2),T=_(m),C=_(T);Br(C,{get duelist(){return t().duelists.Above}});var L=b(C,2);_d(L,{get entity(){return u(l)},get mode(){return u(v)}});var $=b(L,2);Br($,{get duelist(){return t().duelists.Below}});var Y=b(T,2),se=_(Y),k=_(se);{var W=F=>{var Z=kd(),X=re(Z),q=_(X),O=b(X,2),G=_(O);M(()=>P(q,`[TURN:${t().clock.turn}][PHASE:${t().phase}] ${t().view.message}`)),Oe("click",G,c),w(F,Z)};H(k,F=>{t().isEnded||F(W)})}var j=b(se,2),ie=_(j);{var Se=F=>{var Z=Dd(),X=_(Z);ue(X,5,()=>t().field.cells,de,(q,O,G)=>{var te=Cd();ye(te,`${`duel_desk_row_${G}`??""} svelte-accyye`),ue(te,5,()=>u(O),de,(z,U,K)=>{kc(z,{get view(){return t().view},row:G,column:K,get selectedList(){return f()},set selectedList(Q){f(Q)},$$legacy:!0})}),w(q,te)}),w(F,Z)};H(ie,F=>{t().clock.turn>0&&F(Se)})}var Fe=b(j,2),ne=_(Fe);{var N=F=>{var Z=Ed();M(X=>Z.disabled=X,[()=>!u(r)(f())],me),Oe("click",Z,g),w(F,Z)};H(ne,F=>{u(n)&&u(n).length>0&&F(N)})}var E=b(Y,2),R=_(E);{var J=F=>{Ec(F,{get log(){return t().log}})},oe=F=>{var Z=Pe(),X=re(Z);{var q=O=>{wd(O,{get cell(){return t().view.infoBoardCell}})};H(X,O=>{t().view.infoBoardState==="CellInfo"&&O(q)},!0)}w(F,Z)};H(R,F=>{t().view.infoBoardState==="Log"?F(J):F(oe,!1)})}var le=b(m,2);Xc(le,{get modalController(){return t().view.modalController}}),M(F=>P(y,F),[()=>t().clock.toString()],me),w(i,h),Ge()}var Pd=D("<div></div>"),Md=D('<span> </span> / <span style="display: inline-block;width:2rem;text-align: right;"> </span>',1),Fd=D('<li class="deck_editor_item svelte-vivzk2"><div role="listitem"><div class="svelte-vivzk2"><div class="svelte-vivzk2"> </div> <div style="display:flex" class="svelte-vivzk2"><div class="svelte-vivzk2"><!> <!> <!> <!> <!> <!> <!></div> <div style="flex-grow: 1; width:0.1rem" class="svelte-vivzk2"></div> <div class="svelte-vivzk2"><!></div></div></div></div> <button class="button_style_reset svelte-vivzk2" title="※shiftキー同時押しで一括投入">+</button> <button class="button_style_reset svelte-vivzk2" title="※shiftキー同時押しで一括外し">-</button></li>'),Bd=D('<div class="deck_editor_card_kind svelte-vivzk2"><span class="svelte-vivzk2"> </span> <ul class="svelte-vivzk2"></ul></div>'),qd=D('<div class="deck_editor_deck_type svelte-vivzk2"><span class="svelte-vivzk2"> </span> <!></div>'),Od=D('<div class="deck_editor_card_list svelte-vivzk2"></div>');function qr(i,e){Ze(e,!1);let t=Te(e,"allCardInfos",8),a=Te(e,"deckCardInfos",12),r=Te(e,"mode",8),n=Te(e,"onAttention",8);const s={Deck:["Monster","Spell","Trap"],ExtraDeck:["Monster"]},l=(p,g)=>(r()==="List"?t():a()).filter(c=>{var h;return Ha.has(c.name)||((h=c.monsterCategories)==null?void 0:h.includes("Normal"))}).filter(c=>!g||c.kind===g).filter(c=>{var h,S;return!p||p==="Deck"&&!((h=c==null?void 0:c.monsterCategories)!=null&&h.union(ii).length)||p==="ExtraDeck"&&((S=c==null?void 0:c.monsterCategories)==null?void 0:S.union(ii).length)}).toSorted(ui),v=(p,g)=>{const c=a().filter(S=>S.name===g.name).length;if(c>2)return;const h=p.shiftKey?3-c:1;h<1||(a().push(...Array(h).fill(g)),a().sort(ui),a(a()))},d=(p,g)=>{let c=0;a(a().filter(h=>h.name!==g.name?!0:(c++,!p.shiftKey&&c>1))),a().sort(ui)};Ie();var f=Od();ue(f,5,()=>bl,de,(p,g)=>{var c=qd(),h=_(c),S=_(h),y=b(h,2);ue(y,1,()=>s[u(g)],de,(m,T)=>{var C=Bd(),L=_(C),$=_(L),Y=b(L,2);ue(Y,5,()=>l(u(g),u(T)),de,(se,k)=>{var W=Fd(),j=_(W),ie=_(j),Se=_(ie),Fe=_(Se),ne=b(Se,2),N=_(ne),E=_(N);{var R=B=>{var V=qt();M(()=>P(V,`★${u(k).level??""}`)),w(B,V)};H(E,B=>{u(k).level&&B(R)})}var J=b(E,2);{var oe=B=>{var V=qt();M(()=>P(V,`☆${u(k).rank??""}`)),w(B,V)};H(J,B=>{u(k).rank&&B(oe)})}var le=b(J,2);ue(le,1,()=>u(k).attributes??[],de,(B,V)=>{var pe=Pd();M(()=>ye(pe,`monster_attr ${u(V)??""} svelte-vivzk2`)),w(B,pe)});var F=b(le,2);ue(F,1,()=>u(k).types??[],de,(B,V)=>{var pe=qt();M(()=>P(pe,Ti[u(V)])),w(B,pe)});var Z=b(F,2);ue(Z,1,()=>u(k).monsterCategories??[],de,(B,V)=>{var pe=qt();M(()=>P(pe,Si[u(V)])),w(B,pe)});var X=b(Z,2);{var q=B=>{var V=qt();M(()=>P(V,`${bi[u(k).spellCategory]??""}魔法`)),w(B,V)};H(X,B=>{u(k).spellCategory!==void 0&&B(q)})}var O=b(X,2);{var G=B=>{var V=qt();M(()=>P(V,`${wi[u(k).trapCategory]??""}罠`)),w(B,V)};H(O,B=>{u(k).trapCategory!==void 0&&B(G)})}var te=b(N,4),z=_(te);{var U=B=>{var V=Md(),pe=re(V),we=_(pe),Be=b(pe,2),he=_(Be);M(()=>{P(we,u(k).attack??"?"),P(he,u(k).defense??"?")}),w(B,V)};H(z,B=>{u(k).kind==="Monster"&&B(U)})}var K=b(j,2),Q=b(K,2);M(B=>{ye(j,`${B??""} svelte-vivzk2`),P(Fe,u(k).name)},[()=>{var B,V;return`deck_editor_card duel_card ${u(k).kind} ${(V=(B=u(k))==null?void 0:B.monsterCategories)==null?void 0:V.join(" ")} ${Ha.has(u(k).name)?"is_implemented":"is_not_implemented"}`}],me),Oe("mouseenter",j,()=>n()(u(k))),Oe("click",K,B=>v(B,u(k))),Oe("click",Q,B=>d(B,u(k))),w(se,W)}),M(()=>P($,mn[u(T)])),w(m,C)}),M(()=>P(S,wl[u(g)])),w(p,c)}),w(i,f),Ge()}var Nd=D('<div class="duel_card_info_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"><pre class="description svelte-1xf9hqi"> </pre></div></div> <div class="duel_card_info_row svelte-1xf9hqi" style=" justify-content: space-between;"><div class="svelte-1xf9hqi"> </div> <div class="svelte-1xf9hqi"> </div></div>',1),Rd=D('<div></div> <div class="svelte-1xf9hqi"> </div>',1),Ld=D("<div> </div>"),Hd=D("<div> </div>"),$d=D('<div class="duel_card_info_row svelte-1xf9hqi"><!> <!></div> <div class="duel_card_info_row svelte-1xf9hqi"></div>',1),jd=D('<div class="duel_card_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"></div> <div class="svelte-1xf9hqi"> </div></div>'),Ud=D('<div class="duel_card_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"></div> <div class="svelte-1xf9hqi"> </div></div>'),Zd=D('<div class="duel_card_info_row svelte-1xf9hqi"><div class="svelte-1xf9hqi">※テスト用カードです</div></div>'),Gd=D('<div class="duel_card_info_links svelte-1xf9hqi"><a target="_blank" rel="noopener noreferrer" title="遊戯王カードWiki" class="svelte-1xf9hqi">⇒遊戯王カードWiki</a> <a target="_blank" rel="noopener noreferrer" title="コナミカードデータベース" class="svelte-1xf9hqi"> </a></div>'),Vd=D('<div><div class="duel_card_info_header svelte-1xf9hqi"><div class="duel_card_info_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"> </div></div> <div class="duel_card_info_row svelte-1xf9hqi" style="position:sticky; top:0;"><div class="svelte-1xf9hqi"> </div> <div class="svelte-1xf9hqi"> </div></div></div> <div class="duel_card_info_body svelte-1xf9hqi"><!> <!> <div class="duel_card_info_row description svelte-1xf9hqi"><div class="svelte-1xf9hqi"><pre class="description svelte-1xf9hqi"> </pre></div></div> <!></div></div>');function zd(i,e){Ze(e,!1);let t=Te(e,"cardInfo",8,void 0);const a=()=>t()?Ue[t().name]:void 0;Ie();var r=Pe(),n=re(r);{var s=l=>{var v=Vd(),d=_(v),f=_(d),p=_(f),g=_(p),c=b(f,2),h=_(c),S=_(h),y=b(h,2),m=_(y),T=b(d,2),C=_(T);{var L=N=>{var E=Nd(),R=re(E),J=_(R),oe=_(J),le=_(oe),F=b(R,2),Z=_(F),X=_(Z),q=b(Z,2),O=_(q);M(()=>{P(le,Ue[t().name].pendulumDescription),P(X,`◀ ${t().pendulumScaleL??""}`),P(O,`${t().pendulumScaleR??""} ▶`)}),w(N,E)};H(C,N=>{var E;(E=t().monsterCategories)!=null&&E.includes("Pendulum")&&N(L)})}var $=b(C,2);{var Y=N=>{var E=$d(),R=re(E),J=_(R);{var oe=X=>{var q=Rd(),O=re(q),G=b(O,2),te=_(G);M(()=>{ye(O,`monster_attr ${t().attributes[0]??""} svelte-1xf9hqi`),P(te,`${Ia[t().attributes[0]]??""}属性`)}),w(X,q)};H(J,X=>{t().attributes&&X(oe)})}var le=b(J,2);{var F=X=>{var q=Ld(),O=_(q);M(()=>{ye(q,`monster_cat ${t().types[0]??""} svelte-1xf9hqi`),P(O,`${Ti[t().types[0]]??""}${la[t().types[0]]??""}族`)}),w(X,q)};H(le,X=>{t().types&&X(F)})}var Z=b(R,2);ue(Z,5,()=>t().monsterCategories??[],de,(X,q)=>{var O=Hd(),G=_(O);M(()=>{ye(O,`monster_cat ${u(q)??""} svelte-1xf9hqi`),P(G,`${Si[u(q)]??""}${sa[u(q)]??""}`)}),w(X,O)}),w(N,E)},se=N=>{var E=Pe(),R=re(E);{var J=le=>{var F=jd(),Z=b(_(F),2),X=_(Z);M(()=>P(X,`${bi[t().spellCategory]??""}魔法`)),w(le,F)},oe=le=>{var F=Pe(),Z=re(F);{var X=q=>{var O=Ud(),G=b(_(O),2),te=_(G);M(()=>P(te,`${wi[t().trapCategory]??""}罠`)),w(q,O)};H(Z,q=>{t().kind==="Trap"&&t().trapCategory&&q(X)},!0)}w(le,F)};H(R,le=>{t().kind==="Spell"&&t().spellCategory?le(J):le(oe,!1)},!0)}w(N,E)};H($,N=>{t().kind==="Monster"?N(Y):N(se,!1)})}var k=b($,2),W=_(k),j=_(W),ie=_(j),Se=b(k,2);{var Fe=N=>{var E=Zd();w(N,E)},ne=N=>{var E=Gd(),R=_(E),J=b(R,2),oe=_(J);M(le=>{wt(R,"href",`https://yugioh-wiki.net/index.php?${t().wikiEncodedName}`),wt(J,"href",le),P(oe,`⇒${(t().cardId?"公式カードページ":"公式で検索")??""}`)},[()=>El(t())],me),w(N,E)};H(Se,N=>{t().isForTest?N(Fe):N(ne,!1)})}M((N,E,R,J)=>{ye(v,`duel_card duel_card_info ${t().kind??""} ${N??""} svelte-1xf9hqi`),P(g,t().name),P(S,E),P(m,R),P(ie,J)},[()=>{var N;return(N=t().monsterCategories)==null?void 0:N.join(" ")},()=>"★".repeat(t().level||0),()=>"☆".repeat(t().rank||0),()=>{var N;return(N=a())==null?void 0:N.description}],me),w(l,v)};H(n,l=>{t()&&l(s)})}w(i,r),Ge()}const Yd={0:{aaa:"日",aaaa:"日曜日",ddd:"Sun",dddd:"Sunday"},1:{aaa:"月",aaaa:"月曜日",ddd:"Mon",dddd:"Monday"},2:{aaa:"火",aaaa:"火曜日",ddd:"Tue",dddd:"Tuesday"},3:{aaa:"水",aaaa:"水曜日",ddd:"Wed",dddd:"Wednesday"},4:{aaa:"木",aaaa:"木曜日",ddd:"Thu",dddd:"Thursday"},5:{aaa:"金",aaaa:"金曜日",ddd:"Fri",dddd:"Friday"},6:{aaa:"土",aaaa:"土曜日",ddd:"Sat",dddd:"Saturday"}};class Wd{constructor(){o(this,"DefaultSeparator1","/");o(this,"DefaultSeparator2"," ");o(this,"DefaultSeparator3",":");o(this,"createDate",e=>{if(!e)return;const t=new Date(e);if(!isNaN(t.getTime()))return t});o(this,"createDateOr",(e,t)=>this.createDate(e)||t||new Date);o(this,"truncateDate",e=>{const t=e||new Date;return new Date(t.getFullYear(),t.getMonth(),t.getDate())});o(this,"addDate",(e,t)=>{const a=this.createDateOr(e);return a.setDate(a.getDate()+t),a});o(this,"addMonth",(e,t)=>{const a=this.createDateOr(e);return a.setMonth(a.getMonth()+t),a});o(this,"addYear",(e,t)=>{const a=this.createDateOr(e);return a.setFullYear(a.getFullYear()+t),a});o(this,"getDayOfWeek",(e,t="dddd")=>{const a=this.createDate(e);return a?Yd[a.getDay()][t]:""});o(this,"formatToYYYYMMDD",(e,t=this.DefaultSeparator1)=>{const a=this.createDate(e);if(!a)return"";const r=a.getFullYear().toString(),n=("0"+(a.getMonth()+1)).slice(-2),s=("0"+a.getDate()).slice(-2);return r+t+n+t+s});o(this,"formatToYYYYMM",(e,t=this.DefaultSeparator1)=>{const a=this.createDate(e);if(!a)return"";t||(t="");const r=a.getFullYear().toString(),n=("0"+(a.getMonth()+1)).slice(-2);return r+t+n});o(this,"formatToHHMMSS",(e,t=this.DefaultSeparator3)=>{const a=this.createDate(e);if(!a)return"";t||(t="");const r=a.getHours(),n=a.getMinutes(),s=a.getSeconds();return("0"+r).slice(-2)+t+("0"+n).slice(-2)+t+("0"+s).slice(-2)});o(this,"formatToHHMM",(e,t=this.DefaultSeparator3)=>{const a=this.createDate(e);if(!a)return"";t||(t="");const r=("0"+a.getHours()).slice(-2),n=("0"+a.getMinutes()).slice(-2);return r+t+n});o(this,"formatToYYYYMMDD_HHMM",(e,t=this.DefaultSeparator1,a=this.DefaultSeparator2,r=this.DefaultSeparator3)=>{const n=this.createDate(e);return n?this.formatToYYYYMMDD(n,t)+a+this.formatToHHMM(n,r):""});o(this,"formatToYYYYMMDD_HHMMSS",(e,t=this.DefaultSeparator1,a=this.DefaultSeparator2,r=this.DefaultSeparator3)=>{const n=this.createDate(e);return n?this.formatToYYYYMMDD(n,t)+a+this.formatToHHMMSS(n,r):""})}}const st=new Wd;Date.prototype.truncateDate=function(){return st.truncateDate(this)};Date.prototype.getCloneOr=function(i){return st.createDateOr(this,i)};Date.prototype.addDate=function(i){return st.addDate(this,i)};Date.prototype.addMonth=function(i){return st.addDate(this,i)};Date.prototype.addYear=function(i){return st.addDate(this,i)};Date.prototype.getDayOfWeek=function(i="dddd"){return st.getDayOfWeek(this,i)};Date.prototype.formatToYYYYMM=function(i){return st.formatToYYYYMM(this,i)};Date.prototype.formatToYYYYMMDD=function(i){return st.formatToYYYYMMDD(this,i)};Date.prototype.formatToYYYYMMDD_HHMM=function(i,e,t){return st.formatToYYYYMMDD_HHMM(this,i,e,t)};Date.prototype.formatToYYYYMMDD_HHMMSS=function(i,e,t){return st.formatToYYYYMMDD_HHMMSS(this,i,e,t)};Date.prototype.formatToHHMM=function(i){return st.formatToHHMM(this,i)};Date.prototype.formatToHHMMSS=function(i){return st.formatToHHMMSS(this,i)};var Kd=D('<label><input type="checkbox"> </label>'),Qd=D('<label><input type="checkbox"> </label>'),Xd=D('<label><input type="checkbox"> <div style="display: inline-block;"></div> </label>'),Jd=D('<label><input type="checkbox"> </label>'),Id=D('<label><input type="checkbox"> </label>'),eu=D('<label><input type="checkbox"> </label>'),tu=D("<option> </option>"),iu=D('<div class="svelte-b5thz2"><a class="white_button svelte-b5thz2" download="SVS_DeckInfos.json">ダウンロード</a></div>'),au=D('<div class="svelte-b5thz2"></div>'),ru=D('<div class="svelte-b5thz2"><a class="white_button svelte-b5thz2" download="SVS_DeckInfos.json">ダウンロード（一括）</a></div>'),nu=D('<div class="svelte-b5thz2"></div>'),su=D('<div class="deck_editor_body_right_header svelte-b5thz2"><div class="deck_editor_body_right_header_row svelte-b5thz2"><div class="svelte-b5thz2">編集対象 <select></select></div> <div class="svelte-b5thz2"></div> <div class="svelte-b5thz2">新規名称 <input type="text"></div></div> <div class="deck_editor_body_right_header_row svelte-b5thz2"></div> <div class="deck_editor_body_right_header_row svelte-b5thz2"><div class="svelte-b5thz2">基本操作</div> <div class="svelte-b5thz2"><button class="white_button svelte-b5thz2">デッキを保存</button></div> <div class="svelte-b5thz2"></div> <div class="svelte-b5thz2"><button class="white_button svelte-b5thz2">デッキを複製</button></div> <div class="svelte-b5thz2"><button class="white_button svelte-b5thz2" title="shiftキー押下で確認メッセージスキップ">デッキを削除</button></div></div> <div class="deck_editor_body_right_header_row svelte-b5thz2"><div class="svelte-b5thz2">DL/UL</div> <!> <!></div></div> <!>',1),lu=D("<div>デッキ情報読込中</div>"),ou=D('<div class="deck_editor svelte-b5thz2"><div class="deck_editor_header"></div> <div class="deck_editor_body svelte-b5thz2"><div class="deck_editor_body_left svelte-b5thz2"><div class="deck_editor_search_box svelte-b5thz2"><div class="deck_editor_search_box_header svelte-b5thz2"><div>検索条件</div> <div><button class="white_button svelte-b5thz2">条件クリア</button></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">名称</div> <div class="svelte-b5thz2"><input type="text" style="width:70%">※ルビには対応していません</div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">種類</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">モンスター</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">属性</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">種族</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">魔法</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">罠</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">テスト用</div> <div class="svelte-b5thz2"><label><input type="checkbox"> テスト用カードを表示する</label></div></div></div> <!></div> <div class="deck_editor_body_center svelte-b5thz2"><!></div> <div class="deck_editor_body_right svelte-b5thz2"><!></div></div></div>');function cu(i,e){Ze(e,!1);const t=[],a=[],r=[],n=[],s=[],l=[],v=async()=>{Ne(m,u(m).name=""),Ne(m,u(m).cardKinds=[]),Ne(m,u(m).monsterCategories=[]),Ne(m,u(m).monsterAttributes=[]),Ne(m,u(m).monsterTypes=[]),Ne(m,u(m).spellCategories=[]),Ne(m,u(m).trapCategories=[]),Ne(m,u(m).isForTest=!1)},d=async()=>{const A=(await u(g)).find(I=>I.id===u(p));A&&ae(S,{...A,cardInfos:A.cardNames.map(I=>Ue[I])})},f=()=>ut.getAllDeckInfo().then(x=>(x.forEach(A=>console.log(A.id,A.lastUsedAt,A.lastUsedAt.getTime())),console.log(Math.max(...x.map(A=>A.lastUsedAt.getTime()))),ae(p,(x.find(A=>A.lastUsedAt.getTime()===Math.max(...x.map(I=>I.lastUsedAt.getTime())))??x[0]).id),x));let p=Me(-1),g=Me(f()),c=Me(u(g).then(x=>ut.convertToObjectURL(x)));u(g).then(d);const h=()=>{ae(g,f()),ae(c,u(g).then(x=>ut.convertToObjectURL(x))),d()};let S=Me({id:-Number.MAX_VALUE,name:"",description:"",lastUsedAt:new Date,cardInfos:[]}),y=Me(Ue.ゾンビーノ);const m=Me({name:"",cardKinds:[...Ma],monsterCategories:[...gr].filter(x=>x!=="Normal"&&x!=="Token"),monsterAttributes:[...yr],monsterTypes:[..._r],spellCategories:[...mr],trapCategories:[...Sr],isForTest:!1}),T=()=>Object.values(Ue).filter(x=>{if(!u(m).cardKinds.includes(x.kind)||u(m).name.trim().length&&!x.name.includes(u(m).name)||x.isForTest&&!u(m).isForTest)return!1;if(x.kind==="Monster")return x.attributes&&!u(m).monsterAttributes.union(x.attributes).length||x.types&&!u(m).monsterTypes.union(x.types).length||!x.monsterCategories?!1:x.monsterCategories.union(u(m).monsterCategories).length;if(x.kind==="Spell")return x.spellCategory&&u(m).spellCategories.includes(x.spellCategory);if(x.kind==="Trap")return x.trapCategory&&u(m).trapCategories.includes(x.trapCategory)}),C=x=>{ae(y,x)},L=async()=>{const A=(await u(g)).find(I=>I.id===u(p));if(!A)throw new Error("illegal state");return A},$=async()=>{const x=await L();await x.saveDeckInfo({...x,name:u(S).name,cardNames:u(S).cardInfos.map(A=>A.name),lastUsedAt:new Date}),h()},Y=async()=>{(await ut.createNewDeck(`デッキ_${new Date().formatToYYYYMMDD_HHMMSS("","","")}`,`コピー日時：${new Date().formatToYYYYMMDD_HHMMSS("-"," ",":")}`,u(S).cardInfos.map(A=>A.name))).saveDeckInfo(),h()},se=async x=>{const A=await L();!x.shiftKey&&!confirm(`デッキ【${A.name}】を削除します。
よろしいですか？`)||(await A.delete(),h())};Ie();var k=ou(),W=b(_(k),2),j=_(W),ie=_(j),Se=_(ie),Fe=b(_(Se),2),ne=_(Fe),N=b(Se,2),E=b(_(N),2),R=_(E),J=b(N,2),oe=b(_(J),2);ue(oe,5,()=>Ma,de,(x,A)=>{var I=Kd(),ee=_(I),Ae,Re=b(ee);M(()=>{Ae!==(Ae=u(A))&&(ee.value=(ee.__value=u(A))==null?"":u(A)),P(Re,` ${mn[u(A)]??""}`)}),Yt(t,[],ee,()=>(u(A),u(m).cardKinds),xe=>Ne(m,u(m).cardKinds=xe)),w(x,I)});var le=b(J,2),F=b(_(le),2);ue(F,5,()=>gr,de,(x,A)=>{var I=Qd(),ee=_(I),Ae,Re=b(ee);M(()=>{Ae!==(Ae=u(A))&&(ee.value=(ee.__value=u(A))==null?"":u(A)),P(Re,` ${Si[u(A)]??""}${sa[u(A)]??""}`)}),Yt(a,[],ee,()=>(u(A),u(m).monsterCategories),xe=>Ne(m,u(m).monsterCategories=xe)),w(x,I)});var Z=b(le,2),X=b(_(Z),2);ue(X,5,()=>yr,de,(x,A)=>{var I=Xd(),ee=_(I),Ae,Re=b(ee,2),xe=b(Re);M(()=>{Ae!==(Ae=u(A))&&(ee.value=(ee.__value=u(A))==null?"":u(A)),ye(Re,`monster_attr ${u(A)??""} svelte-b5thz2`),P(xe,` ${Ia[u(A)]??""}`)}),Yt(r,[],ee,()=>(u(A),u(m).monsterAttributes),Xe=>Ne(m,u(m).monsterAttributes=Xe)),w(x,I)});var q=b(Z,2),O=b(_(q),2);ue(O,5,()=>_r,de,(x,A)=>{var I=Jd(),ee=_(I),Ae,Re=b(ee);M(()=>{Ae!==(Ae=u(A))&&(ee.value=(ee.__value=u(A))==null?"":u(A)),P(Re,` ${Ti[u(A)]??""}
                ${la[u(A)]??""}`)}),Yt(n,[],ee,()=>(u(A),u(m).monsterTypes),xe=>Ne(m,u(m).monsterTypes=xe)),w(x,I)});var G=b(q,2),te=b(_(G),2);ue(te,5,()=>mr,de,(x,A)=>{var I=Id(),ee=_(I),Ae,Re=b(ee);M(()=>{Ae!==(Ae=u(A))&&(ee.value=(ee.__value=u(A))==null?"":u(A)),P(Re,` ${bi[u(A)]??""}`)}),Yt(s,[],ee,()=>(u(A),u(m).spellCategories),xe=>Ne(m,u(m).spellCategories=xe)),w(x,I)});var z=b(G,2),U=b(_(z),2);ue(U,5,()=>Sr,de,(x,A)=>{var I=eu(),ee=_(I),Ae,Re=b(ee);M(()=>{Ae!==(Ae=u(A))&&(ee.value=(ee.__value=u(A))==null?"":u(A)),P(Re,` ${wi[u(A)]??""}`)}),Yt(l,[],ee,()=>(u(A),u(m).trapCategories),xe=>Ne(m,u(m).trapCategories=xe)),w(x,I)});var K=b(z,2),Q=b(_(K),2),B=_(Q),V=_(B),pe=b(ie,2);zd(pe,{get cardInfo(){return u(y)}});var we=b(j,2),Be=_(we);const he=me(T);qr(Be,{mode:"List",get allCardInfos(){return u(he)},onAttention:C,get deckCardInfos(){return u(S).cardInfos},set deckCardInfos(x){Ne(S,u(S).cardInfos=x)},$$legacy:!0});var ge=b(we,2),ve=_(ge);ci(ve,()=>u(g),x=>{var A=lu();w(x,A)},(x,A)=>{var I=su(),ee=re(I),Ae=_(ee),Re=_(Ae),xe=b(_(Re));M(()=>{u(p),Oi(()=>{u(A)})}),ue(xe,5,()=>u(A),de,(Ve,et)=>{var ct=tu(),Zt={},fa=_(ct);M(()=>{Zt!==(Zt=u(et).id)&&(ct.value=(ct.__value=u(et).id)==null?"":u(et).id),P(fa,u(et).name)}),w(Ve,ct)});var Xe=b(Re,4),Ci=b(_(Xe)),Di=b(Ae,4),Ei=b(_(Di),2),Fn=_(Ei),tr=b(Ei,4),Bn=_(tr),qn=b(tr,2),On=_(qn),Nn=b(Di,2),ir=b(_(Nn),2);ci(ir,L,Ve=>{var et=au();w(Ve,et)},(Ve,et)=>{var ct=iu(),Zt=_(ct);M(fa=>wt(Zt,"href",fa),[()=>ut.convertToObjectURL([u(et)])],me),w(Ve,ct)});var Rn=b(ir,2);ci(Rn,()=>u(c),Ve=>{var et=nu();w(Ve,et)},(Ve,et)=>{var ct=ru(),Zt=_(ct);M(()=>wt(Zt,"href",u(et))),w(Ve,ct)});var Ln=b(ee,2);qr(Ln,{mode:"Deck",allCardInfos:[],onAttention:C,get deckCardInfos(){return u(S).cardInfos},set deckCardInfos(Ve){Ne(S,u(S).cardInfos=Ve)},$$legacy:!0}),Ni(xe,()=>u(p),Ve=>ae(p,Ve)),Oe("change",xe,d),Aa(Ci,()=>u(S).name,Ve=>Ne(S,u(S).name=Ve)),Oe("click",Fn,$),Oe("click",Bn,Y),Oe("click",On,se),w(x,I)}),Oe("click",ne,v),Aa(R,()=>u(m).name,x=>Ne(m,u(m).name=x)),ol(V,()=>u(m).isForTest,x=>Ne(m,u(m).isForTest=x)),w(i,k),Ge()}const du="2025-03-30 14:06:48",uu={timestamp:du},vu=["TblDeckHeader","TblDeckDetail","TblDuelistProfile"],fu=3;var pu=D("<option> </option>"),hu=D("<option> </option>"),gu=D("<option> </option>"),yu=D('<div class="svelte-1fs1w5q"><label for="deck_selector" class="deck_selector svelte-1fs1w5q">デッキ：</label> <select id="deck_selector" class="deck_selector svelte-1fs1w5q"></select></div> <div class="svelte-1fs1w5q"><label for="npc_selector" class="npc_selector svelte-1fs1w5q">対戦相手：</label> <select id="npc_selector" class="npc_selector svelte-1fs1w5q"></select> <div> </div></div> <div class="svelte-1fs1w5q"><label for="npc_selector" class="npc_selector svelte-1fs1w5q">先攻後攻：</label> <select id="npc_selector" class="npc_selector svelte-1fs1w5q"></select></div> <div class="svelte-1fs1w5q"><button class="btn svelte-1fs1w5q">duel start!</button></div>',1),_u=D('<div class="svelte-1fs1w5q">デッキ情報の読み込み、もしくは作成中...</div>'),mu=D('<div class="svelte-1fs1w5q"><label for="duelist_name" class="duelist_name svelte-1fs1w5q">名前：</label> <input id="duelist_name" class="duelist_name svelte-1fs1w5q" type="text"></div> <!> <div class="svelte-1fs1w5q"><button class="btn svelte-1fs1w5q">deck edit</button></div>',1),Su=D('<div class="svelte-1fs1w5q">デュエリスト情報の読み込み、もしくは作成中...</div>'),bu=D('<div class="app_body svelte-1fs1w5q"><!></div>'),wu=D('<main class="svelte-1fs1w5q"><div class="link svelte-1fs1w5q"><a href="https://github.com/Setta238/stk_ygo_svelte" target="_blank" rel="noopener noreferrer" title="repository" class="svelte-1fs1w5q">repository</a> <a href="https://x.com/ninja_no" target="_blank" rel="noopener noreferrer" title="repository" class="svelte-1fs1w5q">X(Twitter)</a> <a href="https://posfie.com/@ninja_no/p/Lx7FLj3" target="_blank" rel="noopener noreferrer" title="posfie" class="svelte-1fs1w5q">posfie(toggeter)</a></div> <!> <div class="debug_info svelte-1fs1w5q"><span> </span> <span class="screen_info"></span></div></main>');function Tu(i,e){Ze(e,!1);const t=new ml("stk_ygo_svelte",fu,vu);let a=Me(),r=Me("None"),n=Me(0),s=Me(Ra(...Mi.map(k=>k.id))),l=Me("Random");const v=Pa.getOrCreateNew(t);let d=Me(ut.getAllDeckInfo(t).then(k=>(Promise.all(k.filter(W=>!W.lastUsedAt).map(W=>{W.saveDeckInfo()})),ae(n,(k.find(W=>W.lastUsedAt.getTime()===Math.max(...k.map(j=>j.lastUsedAt.getTime())))??k[0]).id),k)));const f=async()=>{let k=(await u(d)).find(W=>W.id===u(n));if(k||(k=(await g()).find(W=>W.id===u(n))),!k)throw new Error("illegal state");return k},p=async()=>{(await v).save()},g=()=>(ae(d,ut.getAllDeckInfo(t).then(k=>(ae(n,(k.find(W=>W.lastUsedAt.getTime()===Math.max(...k.map(j=>j.lastUsedAt.getTime())))??k[0]).id),k))),u(d)),c=async()=>{(await u(d)).length||(await ut.prepareSampleDeck(),g())},h=async()=>{await Promise.all([p(),c()]),(await f()).updateTimestamp();const W=Mi.find(ie=>ie.id===u(s));let j=Mr.slice(-1)[0];W&&(W.id===-1&&(j=Mr.find(ie=>ie.id===-1)??j),console.log(W),ae(a,new wo(await v,"Player",await f(),[],W,"NPC",j,[],u(l))))},S=async()=>{await Promise.all([p(),c()]),ae(r,"DeckEdit")},y=async k=>{await p(),k.key==="Enter"&&!k.repeat&&(await v).save()};c(),Ie();var m=wu(),T=b(_(m),2);{var C=k=>{xd(k,{get duel(){return u(a)}})},L=k=>{var W=Pe(),j=re(W);{var ie=Fe=>{cu(Fe,{})},Se=Fe=>{var ne=bu(),N=_(ne);ci(N,()=>v,E=>{var R=Su();w(E,R)},(E,R)=>{var J=mu(),oe=re(J),le=b(_(oe),2),F=b(oe,2);ci(F,()=>u(d),q=>{var O=_u();w(q,O)},(q,O)=>{var G=yu(),te=re(G),z=b(_(te),2);M(()=>{u(n),Oi(()=>{u(O)})}),ue(z,5,()=>u(O),de,(he,ge)=>{var ve=pu(),x={},A=_(ve);M(()=>{x!==(x=u(ge).id)&&(ve.value=(ve.__value=u(ge).id)==null?"":u(ge).id),P(A,u(ge).name)}),w(he,ve)});var U=b(te,2),K=b(_(U),2);M(()=>{u(s),Oi(()=>{})}),ue(K,5,()=>Mi,de,(he,ge)=>{var ve=hu(),x={},A=_(ve);M(()=>{x!==(x=u(ge).id)&&(ve.value=(ve.__value=u(ge).id)==null?"":u(ge).id),P(A,u(ge).name)}),w(he,ve)});var Q=b(K,2),B=_(Q),V=b(U,2),pe=b(_(V),2);M(()=>{u(l),Oi(()=>{})}),ue(pe,5,()=>Tn(Pr),de,(he,ge)=>{var ve=gu(),x={},A=_(ve);M(()=>{x!==(x=u(ge))&&(ve.value=(ve.__value=u(ge))==null?"":u(ge)),P(A,Pr[u(ge)])}),w(he,ve)});var we=b(V,2),Be=_(we);M(he=>P(B,`※${he??""}`),[()=>{var he;return(he=Mi.find(ge=>ge.id===u(s)))==null?void 0:he.description}],me),Ni(z,()=>u(n),he=>ae(n,he)),Ni(K,()=>u(s),he=>ae(s,he)),Ni(pe,()=>u(l),he=>ae(l,he)),Oe("click",Be,h),w(q,G)});var Z=b(F,2),X=_(Z);Aa(le,()=>u(R).name,q=>u(R).name=q),Oe("keypress",le,y),Oe("click",X,S),w(E,J)}),w(Fe,ne)};H(j,Fe=>{u(r)==="DeckEdit"?Fe(ie):Fe(Se,!1)},!0)}w(k,W)};H(T,k=>{u(a)?k(C):k(L,!1)})}var $=b(T,2),Y=_($),se=_(Y);M(()=>P(se,`build at: ${uu.timestamp}`)),w(i,m),Ge()}Ws(Tu,{target:document.getElementById("app")});
