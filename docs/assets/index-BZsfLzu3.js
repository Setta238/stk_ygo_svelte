var ya=Object.defineProperty;var ga=(r,e,t)=>e in r?ya(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var c=(r,e,t)=>ga(r,typeof e!="symbol"?e+"":e,t);import{j as ma}from"./cardInfo.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();const di=!1;var Ai=Array.isArray,_a=Array.prototype.indexOf,xi=Array.from,_n=Object.defineProperty,Zt=Object.getOwnPropertyDescriptor,Sn=Object.getOwnPropertyDescriptors,Sa=Object.prototype,wa=Array.prototype,Mi=Object.getPrototypeOf;function ka(r){return typeof r=="function"}const Ie=()=>{};function Ta(r){return typeof(r==null?void 0:r.then)=="function"}function ba(r){return r()}function ui(r){for(var e=0;e<r.length;e++)r[e]()}const Ke=2,wn=4,Ur=8,Zr=16,vt=32,lr=64,Ar=128,ze=256,xr=512,Ze=1024,pt=2048,Qt=4096,ut=8192,jr=16384,kn=32768,Gr=65536,Tn=1<<17,Ca=1<<19,bn=1<<20,ft=Symbol("$state"),Ea=Symbol("legacy props"),Da=Symbol("");function Cn(r){return r===this.v}function En(r,e){return r!=r?e==e:r!==e||r!==null&&typeof r=="object"||typeof r=="function"}function Pi(r){return!En(r,this.v)}function Aa(r){throw new Error("https://svelte.dev/e/effect_in_teardown")}function xa(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Ma(r){throw new Error("https://svelte.dev/e/effect_orphan")}function Pa(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Fa(r){throw new Error("https://svelte.dev/e/props_invalid_value")}function Ba(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function qa(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Oa(){throw new Error("https://svelte.dev/e/state_unsafe_local_read")}function Na(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let or=!1,Ra=!1;function La(){or=!0}const Fi=1,Bi=2,Dn=4,Ha=8,$a=16,Ua=1,Za=2,ja=4,Ga=8,Va=16,Ya=1,Wa=2,za=4,Ka=1,Qa=2,Oe=Symbol();let Me=null;function Mr(r){Me=r}function Ne(r,e=!1,t){Me={p:Me,c:null,e:null,m:!1,s:r,x:null,l:null},or&&!e&&(Me.l={s:null,u:null,r1:[],r2:He(!1)})}function Re(r){const e=Me;if(e!==null){const s=e.e;if(s!==null){var t=he,i=me;e.e=null;try{for(var n=0;n<s.length;n++){var a=s[n];Je(a.effect),Qe(a.reaction),It(a.fn)}}finally{Je(t),Qe(i)}}Me=e.p,e.m=!0}return{}}function Jt(){return!or||Me!==null&&Me.l===null}function He(r,e){var t={f:0,v:r,reactions:null,equals:Cn,rv:0,wv:0};return t}function Ja(r){return An(He(r))}function Vt(r,e=!1){var i;const t=He(r);return e||(t.equals=Pi),or&&Me!==null&&Me.l!==null&&((i=Me.l).s??(i.s=[])).push(t),t}function De(r,e=!1){return An(Vt(r,e))}function An(r){return me!==null&&!rt&&me.f&Ke&&(it===null?os([r]):it.push(r)),r}function je(r,e){return ie(r,et(()=>v(r))),e}function ie(r,e){return me!==null&&!rt&&Jt()&&me.f&(Ke|Zr)&&(it===null||!it.includes(r))&&Na(),_t(r,e)}function _t(r,e){return r.equals(e)||(r.v,r.v=e,r.wv=Yn(),xn(r,pt),Jt()&&he!==null&&he.f&Ze&&!(he.f&(vt|lr))&&(ot===null?cs([r]):ot.push(r))),e}function xn(r,e){var t=r.reactions;if(t!==null)for(var i=Jt(),n=t.length,a=0;a<n;a++){var s=t[a],o=s.f;o&pt||!i&&s===he||(nt(s,e),o&(Ze|ze)&&(o&Ke?xn(s,Qt):Kr(s)))}}let Mn=!1;function yt(r,e=null,t){if(typeof r!="object"||r===null||ft in r)return r;const i=Mi(r);if(i!==Sa&&i!==wa)return r;var n=new Map,a=Ai(r),s=He(0);a&&n.set("length",He(r.length));var o;return new Proxy(r,{defineProperty(u,d,f){(!("value"in f)||f.configurable===!1||f.enumerable===!1||f.writable===!1)&&Ba();var p=n.get(d);return p===void 0?(p=He(f.value),n.set(d,p)):ie(p,yt(f.value,o)),!0},deleteProperty(u,d){var f=n.get(d);if(f===void 0)d in u&&n.set(d,He(Oe));else{if(a&&typeof d=="string"){var p=n.get("length"),y=Number(d);Number.isInteger(y)&&y<p.v&&ie(p,y)}ie(f,Oe),ji(s)}return!0},get(u,d,f){var h;if(d===ft)return r;var p=n.get(d),y=d in u;if(p===void 0&&(!y||(h=Zt(u,d))!=null&&h.writable)&&(p=He(yt(y?u[d]:Oe,o)),n.set(d,p)),p!==void 0){var l=v(p);return l===Oe?void 0:l}return Reflect.get(u,d,f)},getOwnPropertyDescriptor(u,d){var f=Reflect.getOwnPropertyDescriptor(u,d);if(f&&"value"in f){var p=n.get(d);p&&(f.value=v(p))}else if(f===void 0){var y=n.get(d),l=y==null?void 0:y.v;if(y!==void 0&&l!==Oe)return{enumerable:!0,configurable:!0,value:l,writable:!0}}return f},has(u,d){var l;if(d===ft)return!0;var f=n.get(d),p=f!==void 0&&f.v!==Oe||Reflect.has(u,d);if(f!==void 0||he!==null&&(!p||(l=Zt(u,d))!=null&&l.writable)){f===void 0&&(f=He(p?yt(u[d],o):Oe),n.set(d,f));var y=v(f);if(y===Oe)return!1}return p},set(u,d,f,p){var F;var y=n.get(d),l=d in u;if(a&&d==="length")for(var h=f;h<y.v;h+=1){var m=n.get(h+"");m!==void 0?ie(m,Oe):h in u&&(m=He(Oe),n.set(h+"",m))}y===void 0?(!l||(F=Zt(u,d))!=null&&F.writable)&&(y=He(void 0),ie(y,yt(f,o)),n.set(d,y)):(l=y.v!==Oe,ie(y,yt(f,o)));var _=Reflect.getOwnPropertyDescriptor(u,d);if(_!=null&&_.set&&_.set.call(p,f),!l){if(a&&typeof d=="string"){var T=n.get("length"),w=Number(d);Number.isInteger(w)&&w>=T.v&&ie(T,w+1)}ji(s)}return!0},ownKeys(u){v(s);var d=Reflect.ownKeys(u).filter(y=>{var l=n.get(y);return l===void 0||l.v!==Oe});for(var[f,p]of n)p.v!==Oe&&!(f in u)&&d.push(f);return d},setPrototypeOf(){qa()}})}function ji(r,e=1){ie(r,r.v+e)}function Gi(r){return r!==null&&typeof r=="object"&&ft in r?r[ft]:r}function Pn(r,e){return Object.is(Gi(r),Gi(e))}var Vi,Fn,Bn,qn;function Xa(){if(Vi===void 0){Vi=window,Fn=/Firefox/.test(navigator.userAgent);var r=Element.prototype,e=Node.prototype;Bn=Zt(e,"firstChild").get,qn=Zt(e,"nextSibling").get,r.__click=void 0,r.__className="",r.__attributes=null,r.__styles=null,r.__e=void 0,Text.prototype.__t=void 0}}function Vr(r=""){return document.createTextNode(r)}function Pr(r){return Bn.call(r)}function Yr(r){return qn.call(r)}function g(r,e){return Pr(r)}function ne(r,e){{var t=Pr(r);return t instanceof Comment&&t.data===""?Yr(t):t}}function S(r,e=1,t=!1){let i=r;for(;e--;)i=Yr(i);return i}function Ia(r){r.textContent=""}function xt(r){var e=Ke|pt,t=me!==null&&me.f&Ke?me:null;return he===null||t!==null&&t.f&ze?e|=ze:he.f|=bn,{ctx:Me,deps:null,effects:null,equals:Cn,f:e,fn:r,reactions:null,rv:0,v:null,wv:0,parent:t??he}}function Se(r){const e=xt(r);return e.equals=Pi,e}function On(r){var e=r.effects;if(e!==null){r.effects=null;for(var t=0;t<e.length;t+=1)St(e[t])}}function es(r){for(var e=r.parent;e!==null;){if(!(e.f&Ke))return e;e=e.parent}return null}function ts(r){var e,t=he;Je(es(r));try{On(r),e=zn(r)}finally{Je(t)}return e}function Nn(r){var e=ts(r),t=(mt||r.f&ze)&&r.deps!==null?Qt:Ze;nt(r,t),r.equals(e)||(r.v=e,r.wv=Yn())}function Rn(r){he===null&&me===null&&Ma(),me!==null&&me.f&ze&&he===null&&xa(),Ni&&Aa()}function rs(r,e){var t=e.last;t===null?e.last=e.first=r:(t.next=r,r.prev=t,e.last=r)}function Xt(r,e,t,i=!0){var n=(r&lr)!==0,a=he,s={ctx:Me,deps:null,nodes_start:null,nodes_end:null,f:r|pt,first:null,fn:e,last:null,next:null,parent:n?null:a,prev:null,teardown:null,transitions:null,wv:0};if(t){var o=jt;try{Wi(!0),Ri(s),s.f|=kn}catch(f){throw St(s),f}finally{Wi(o)}}else e!==null&&Kr(s);var u=t&&s.deps===null&&s.first===null&&s.nodes_start===null&&s.teardown===null&&(s.f&(bn|Ar))===0;if(!u&&!n&&i&&(a!==null&&rs(s,a),me!==null&&me.f&Ke)){var d=me;(d.effects??(d.effects=[])).push(s)}return s}function qi(r){const e=Xt(Ur,null,!1);return nt(e,Ze),e.teardown=r,e}function Yi(r){Rn();var e=he!==null&&(he.f&vt)!==0&&Me!==null&&!Me.m;if(e){var t=Me;(t.e??(t.e=[])).push({fn:r,effect:he,reaction:me})}else{var i=It(r);return i}}function is(r){return Rn(),cr(r)}function ns(r){const e=Xt(lr,r,!0);return(t={})=>new Promise(i=>{t.outro?Ct(e,()=>{St(e),i(void 0)}):(St(e),i(void 0))})}function It(r){return Xt(wn,r,!1)}function cr(r){return Xt(Ur,r,!0)}function q(r,e=[],t=xt){const i=e.map(t);return Wr(()=>r(...i.map(v)))}function Wr(r,e=0){return Xt(Ur|Zr|e,r,!0)}function Mt(r,e=!0){return Xt(Ur|vt,r,!0,e)}function Ln(r){var e=r.teardown;if(e!==null){const t=Ni,i=me;zi(!0),Qe(null);try{e.call(null)}finally{zi(t),Qe(i)}}}function Hn(r,e=!1){var t=r.first;for(r.first=r.last=null;t!==null;){var i=t.next;St(t,e),t=i}}function as(r){for(var e=r.first;e!==null;){var t=e.next;e.f&vt||St(e),e=t}}function St(r,e=!0){var t=!1;if((e||r.f&Ca)&&r.nodes_start!==null){for(var i=r.nodes_start,n=r.nodes_end;i!==null;){var a=i===n?null:Yr(i);i.remove(),i=a}t=!0}Hn(r,e&&!t),qr(r,0),nt(r,jr);var s=r.transitions;if(s!==null)for(const u of s)u.stop();Ln(r);var o=r.parent;o!==null&&o.first!==null&&$n(r),r.next=r.prev=r.teardown=r.ctx=r.deps=r.fn=r.nodes_start=r.nodes_end=null}function $n(r){var e=r.parent,t=r.prev,i=r.next;t!==null&&(t.next=i),i!==null&&(i.prev=t),e!==null&&(e.first===r&&(e.first=i),e.last===r&&(e.last=t))}function Ct(r,e){var t=[];Oi(r,t,!0),Un(t,()=>{St(r),e&&e()})}function Un(r,e){var t=r.length;if(t>0){var i=()=>--t||e();for(var n of r)n.out(i)}else e()}function Oi(r,e,t){if(!(r.f&ut)){if(r.f^=ut,r.transitions!==null)for(const s of r.transitions)(s.is_global||t)&&e.push(s);for(var i=r.first;i!==null;){var n=i.next,a=(i.f&Gr)!==0||(i.f&vt)!==0;Oi(i,e,a?t:!1),i=n}}}function Yt(r){Zn(r,!0)}function Zn(r,e){if(r.f&ut){r.f^=ut,r.f&Ze||(r.f^=Ze),dr(r)&&(nt(r,pt),Kr(r));for(var t=r.first;t!==null;){var i=t.next,n=(t.f&Gr)!==0||(t.f&vt)!==0;Zn(t,n?e:!1),t=i}if(r.transitions!==null)for(const a of r.transitions)(a.is_global||e)&&a.in()}}let Fr=!1,fi=[];function jn(){Fr=!1;const r=fi.slice();fi=[],ui(r)}function Pt(r){Fr||(Fr=!0,queueMicrotask(jn)),fi.push(r)}function ss(){Fr&&jn()}const Gn=0,ls=1;let br=!1,Cr=Gn,nr=!1,ar=null,jt=!1,Ni=!1;function Wi(r){jt=r}function zi(r){Ni=r}let bt=[],Gt=0;let me=null,rt=!1;function Qe(r){me=r}let he=null;function Je(r){he=r}let it=null;function os(r){it=r}let $e=null,Ve=0,ot=null;function cs(r){ot=r}let Vn=1,Br=0,mt=!1,gt=null;function Yn(){return++Vn}function dr(r){var p;var e=r.f;if(e&pt)return!0;if(e&Qt){var t=r.deps,i=(e&ze)!==0;if(t!==null){var n,a,s=(e&xr)!==0,o=i&&he!==null&&!mt,u=t.length;if(s||o){var d=r,f=d.parent;for(n=0;n<u;n++)a=t[n],(s||!((p=a==null?void 0:a.reactions)!=null&&p.includes(d)))&&(a.reactions??(a.reactions=[])).push(d);s&&(d.f^=xr),o&&f!==null&&!(f.f&ze)&&(d.f^=ze)}for(n=0;n<u;n++)if(a=t[n],dr(a)&&Nn(a),a.wv>r.wv)return!0}(!i||he!==null&&!mt)&&nt(r,Ze)}return!1}function ds(r,e){for(var t=e;t!==null;){if(t.f&Ar)try{t.fn(r);return}catch{t.f^=Ar}t=t.parent}throw br=!1,r}function us(r){return(r.f&jr)===0&&(r.parent===null||(r.parent.f&Ar)===0)}function zr(r,e,t,i){if(br){if(t===null&&(br=!1),us(e))throw r;return}t!==null&&(br=!0);{ds(r,e);return}}function Wn(r,e,t=!0){var i=r.reactions;if(i!==null)for(var n=0;n<i.length;n++){var a=i[n];a.f&Ke?Wn(a,e,!1):e===a&&(t?nt(a,pt):a.f&Ze&&nt(a,Qt),Kr(a))}}function zn(r){var l;var e=$e,t=Ve,i=ot,n=me,a=mt,s=it,o=Me,u=rt,d=r.f;$e=null,Ve=0,ot=null,me=d&(vt|lr)?null:r,mt=(d&ze)!==0&&(!jt||n===null||u),it=null,Mr(r.ctx),rt=!1,Br++;try{var f=(0,r.fn)(),p=r.deps;if($e!==null){var y;if(qr(r,Ve),p!==null&&Ve>0)for(p.length=Ve+$e.length,y=0;y<$e.length;y++)p[Ve+y]=$e[y];else r.deps=p=$e;if(!mt)for(y=Ve;y<p.length;y++)((l=p[y]).reactions??(l.reactions=[])).push(r)}else p!==null&&Ve<p.length&&(qr(r,Ve),p.length=Ve);if(Jt()&&ot!==null&&!rt&&p!==null&&!(r.f&(Ke|Qt|pt)))for(y=0;y<ot.length;y++)Wn(ot[y],r);return n!==null&&Br++,f}finally{$e=e,Ve=t,ot=i,me=n,mt=a,it=s,Mr(o),rt=u}}function fs(r,e){let t=e.reactions;if(t!==null){var i=_a.call(t,r);if(i!==-1){var n=t.length-1;n===0?t=e.reactions=null:(t[i]=t[n],t.pop())}}t===null&&e.f&Ke&&($e===null||!$e.includes(e))&&(nt(e,Qt),e.f&(ze|xr)||(e.f^=xr),On(e),qr(e,0))}function qr(r,e){var t=r.deps;if(t!==null)for(var i=e;i<t.length;i++)fs(r,t[i])}function Ri(r){var e=r.f;if(!(e&jr)){nt(r,Ze);var t=he,i=Me;he=r;try{e&Zr?as(r):Hn(r),Ln(r);var n=zn(r);r.teardown=typeof n=="function"?n:null,r.wv=Vn;var a=r.deps,s;di&&Ra&&r.f&pt}catch(o){zr(o,r,t,i||r.ctx)}finally{he=t}}}function Kn(){if(Gt>1e3){Gt=0;try{Pa()}catch(r){if(ar!==null)zr(r,ar,null);else throw r}}Gt++}function Qn(r){var e=r.length;if(e!==0){Kn();var t=jt;jt=!0;try{for(var i=0;i<e;i++){var n=r[i];n.f&Ze||(n.f^=Ze);var a=hs(n);vs(a)}}finally{jt=t}}}function vs(r){var e=r.length;if(e!==0)for(var t=0;t<e;t++){var i=r[t];if(!(i.f&(jr|ut)))try{dr(i)&&(Ri(i),i.deps===null&&i.first===null&&i.nodes_start===null&&(i.teardown===null?$n(i):i.fn=null))}catch(n){zr(n,i,null,i.ctx)}}}function ps(){if(nr=!1,Gt>1001)return;const r=bt;bt=[],Qn(r),nr||(Gt=0,ar=null)}function Kr(r){Cr===Gn&&(nr||(nr=!0,queueMicrotask(ps))),ar=r;for(var e=r;e.parent!==null;){e=e.parent;var t=e.f;if(t&(lr|vt)){if(!(t&Ze))return;e.f^=Ze}}bt.push(e)}function hs(r){var e=[],t=r.first;e:for(;t!==null;){var i=t.f,n=(i&vt)!==0,a=n&&(i&Ze)!==0,s=t.next;if(!a&&!(i&ut)){if(i&wn)e.push(t);else if(n)t.f^=Ze;else{var o=me;try{me=t,dr(t)&&Ri(t)}catch(f){zr(f,t,null,t.ctx)}finally{me=o}}var u=t.first;if(u!==null){t=u;continue}}if(s===null){let f=t.parent;for(;f!==null;){if(r===f)break e;var d=f.next;if(d!==null){t=d;continue e}f=f.parent}}t=s}return e}function Li(r){var e=Cr,t=bt;try{Kn();const n=[];Cr=ls,bt=n,nr=!1,Qn(t);var i=r==null?void 0:r();return ss(),(bt.length>0||n.length>0)&&Li(),Gt=0,ar=null,i}finally{Cr=e,bt=t}}async function ys(){await Promise.resolve(),Li()}function v(r){var e=r.f,t=(e&Ke)!==0;if(gt!==null&&gt.add(r),me!==null&&!rt){it!==null&&it.includes(r)&&Oa();var i=me.deps;r.rv<Br&&(r.rv=Br,$e===null&&i!==null&&i[Ve]===r?Ve++:$e===null?$e=[r]:(!mt||!$e.includes(r))&&$e.push(r))}else if(t&&r.deps===null&&r.effects===null){var n=r,a=n.parent;a!==null&&!(a.f&ze)&&(n.f^=ze)}return t&&(n=r,dr(n)&&Nn(n)),r.v}function gs(r){var e=gt;gt=new Set;var t=gt,i;try{if(et(r),e!==null)for(i of gt)e.add(i)}finally{gt=e}return t}function Jn(r){var e=gs(()=>et(r));for(var t of e)if(t.f&Tn)for(const i of t.deps||[])i.f&Ke||_t(i,i.v);else _t(t,t.v)}function et(r){var e=rt;try{return rt=!0,r()}finally{rt=e}}const ms=-7169;function nt(r,e){r.f=r.f&ms|e}function _s(r){if(!(typeof r!="object"||!r||r instanceof EventTarget)){if(ft in r)vi(r);else if(!Array.isArray(r))for(let e in r){const t=r[e];typeof t=="object"&&t&&ft in t&&vi(t)}}}function vi(r,e=new Set){if(typeof r=="object"&&r!==null&&!(r instanceof EventTarget)&&!e.has(r)){e.add(r),r instanceof Date&&r.getTime();for(let i in r)try{vi(r[i],e)}catch{}const t=Mi(r);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const i=Sn(t);for(let n in i){const a=i[n].get;if(a)try{a.call(r)}catch{}}}}}const Ss=["touchstart","touchmove"];function ws(r){return Ss.includes(r)}let Ki=!1;function ks(){Ki||(Ki=!0,document.addEventListener("reset",r=>{Promise.resolve().then(()=>{var e;if(!r.defaultPrevented)for(const t of r.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function Hi(r){var e=me,t=he;Qe(null),Je(null);try{return r()}finally{Qe(e),Je(t)}}function Qr(r,e,t,i=t){r.addEventListener(e,()=>Hi(t));const n=r.__on_r;n?r.__on_r=()=>{n(),i(!0)}:r.__on_r=()=>i(!0),ks()}const Xn=new Set,pi=new Set;function Ts(r,e,t,i={}){function n(a){if(i.capture||tr.call(e,a),!a.cancelBubble)return Hi(()=>t==null?void 0:t.call(this,a))}return r.startsWith("pointer")||r.startsWith("touch")||r==="wheel"?Pt(()=>{e.addEventListener(r,n,i)}):e.addEventListener(r,n,i),n}function Pe(r,e,t,i,n){var a={capture:i,passive:n},s=Ts(r,e,t,a);(e===document.body||e===window||e===document)&&qi(()=>{e.removeEventListener(r,s,a)})}function ur(r){for(var e=0;e<r.length;e++)Xn.add(r[e]);for(var t of pi)t(r)}function tr(r){var w;var e=this,t=e.ownerDocument,i=r.type,n=((w=r.composedPath)==null?void 0:w.call(r))||[],a=n[0]||r.target,s=0,o=r.__root;if(o){var u=n.indexOf(o);if(u!==-1&&(e===document||e===window)){r.__root=e;return}var d=n.indexOf(e);if(d===-1)return;u<=d&&(s=u)}if(a=n[s]||r.target,a!==e){_n(r,"currentTarget",{configurable:!0,get(){return a||t}});var f=me,p=he;Qe(null),Je(null);try{for(var y,l=[];a!==null;){var h=a.assignedSlot||a.parentNode||a.host||null;try{var m=a["__"+i];if(m!==void 0&&!a.disabled)if(Ai(m)){var[_,...T]=m;_.apply(a,[r,...T])}else m.call(a,r)}catch(F){y?l.push(F):y=F}if(r.cancelBubble||h===e||h===null)break;a=h}if(y){for(let F of l)queueMicrotask(()=>{throw F});throw y}}finally{r.__root=e,delete r.currentTarget,Qe(f),Je(p)}}}function bs(r){var e=document.createElement("template");return e.innerHTML=r,e.content}function Or(r,e){var t=he;t.nodes_start===null&&(t.nodes_start=r,t.nodes_end=e)}function E(r,e){var t=(e&Ka)!==0,i=(e&Qa)!==0,n,a=!r.startsWith("<!>");return()=>{n===void 0&&(n=bs(a?r:"<!>"+r),t||(n=Pr(n)));var s=i||Fn?document.importNode(n,!0):n.cloneNode(!0);if(t){var o=Pr(s),u=s.lastChild;Or(o,u)}else Or(s,s);return s}}function Ot(r=""){{var e=Vr(r+"");return Or(e,e),e}}function Te(){var r=document.createDocumentFragment(),e=document.createComment(""),t=Vr();return r.append(e,t),Or(e,t),r}function k(r,e){r!==null&&r.before(e)}let hi=!0;function x(r,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(r.__t??(r.__t=r.nodeValue))&&(r.__t=t,r.nodeValue=t+"")}function Cs(r,e){return Es(r,e)}const Nt=new Map;function Es(r,{target:e,anchor:t,props:i={},events:n,context:a,intro:s=!0}){Xa();var o=new Set,u=p=>{for(var y=0;y<p.length;y++){var l=p[y];if(!o.has(l)){o.add(l);var h=ws(l);e.addEventListener(l,tr,{passive:h});var m=Nt.get(l);m===void 0?(document.addEventListener(l,tr,{passive:h}),Nt.set(l,1)):Nt.set(l,m+1)}}};u(xi(Xn)),pi.add(u);var d=void 0,f=ns(()=>{var p=t??e.appendChild(Vr());return Mt(()=>{if(a){Ne({});var y=Me;y.c=a}n&&(i.$$events=n),hi=s,d=r(p,i)||{},hi=!0,a&&Re()}),()=>{var h;for(var y of o){e.removeEventListener(y,tr);var l=Nt.get(y);--l===0?(document.removeEventListener(y,tr),Nt.delete(y)):Nt.set(y,l)}pi.delete(u),p!==t&&((h=p.parentNode)==null||h.removeChild(p))}});return Ds.set(d,f),d}let Ds=new WeakMap;const ai=0,Sr=1,si=2;function yi(r,e,t,i,n){var a=r,s=Jt(),o=Me,u=Oe,d,f,p,y=(s?He:Vt)(void 0),l=(s?He:Vt)(void 0),h=!1;function m(T,w){h=!0,w&&(Je(_),Qe(_),Mr(o));try{T===ai&&t&&(d?Yt(d):d=Mt(()=>t(a))),T===Sr&&i&&(f?Yt(f):f=Mt(()=>i(a,y))),T!==ai&&d&&Ct(d,()=>d=null),T!==Sr&&f&&Ct(f,()=>f=null),T!==si&&p&&Ct(p,()=>p=null)}finally{w&&(Mr(null),Qe(null),Je(null),Li())}}var _=Wr(()=>{if(u!==(u=e())){if(Ta(u)){var T=u;h=!1,T.then(w=>{T===u&&(_t(y,w),m(Sr,!0))},w=>{if(T===u)throw _t(l,w),m(si,!0),l.v}),Pt(()=>{h||m(ai,!0)})}else _t(y,u),m(Sr,!1);return()=>u=Oe}})}function H(r,e,t=!1){var i=r,n=null,a=null,s=Oe,o=t?Gr:0,u=!1;const d=(p,y=!0)=>{u=!0,f(y,p)},f=(p,y)=>{s!==(s=p)&&(s?(n?Yt(n):y&&(n=Mt(()=>y(i))),a&&Ct(a,()=>{a=null})):(a?Yt(a):y&&(a=Mt(()=>y(i))),n&&Ct(n,()=>{n=null})))};Wr(()=>{u=!1,e(d),u||f(null,null)},o)}function fe(r,e){return e}function As(r,e,t,i){for(var n=[],a=e.length,s=0;s<a;s++)Oi(e[s].e,n,!0);var o=a>0&&n.length===0&&t!==null;if(o){var u=t.parentNode;Ia(u),u.append(t),i.clear(),ht(r,e[0].prev,e[a-1].next)}Un(n,()=>{for(var d=0;d<a;d++){var f=e[d];o||(i.delete(f.k),ht(r,f.prev,f.next)),St(f.e,!o)}})}function ve(r,e,t,i,n,a=null){var s=r,o={flags:e,items:new Map,first:null},u=(e&Dn)!==0;if(u){var d=r;s=d.appendChild(Vr())}var f=null,p=!1,y=Se(()=>{var l=t();return Ai(l)?l:l==null?[]:xi(l)});Wr(()=>{var l=v(y),h=l.length;p&&h===0||(p=h===0,xs(l,o,s,n,e,i,t),a!==null&&(h===0?f?Yt(f):f=Mt(()=>a(s)):f!==null&&Ct(f,()=>{f=null})),v(y))})}function xs(r,e,t,i,n,a,s){var ee,b,P,X;var o=(n&Ha)!==0,u=(n&(Fi|Bi))!==0,d=r.length,f=e.items,p=e.first,y=p,l,h=null,m,_=[],T=[],w,F,R,$;if(o)for($=0;$<d;$+=1)w=r[$],F=a(w,$),R=f.get(F),R!==void 0&&((ee=R.a)==null||ee.measure(),(m??(m=new Set)).add(R));for($=0;$<d;$+=1){if(w=r[$],F=a(w,$),R=f.get(F),R===void 0){var M=y?y.e.nodes_start:t;h=Ps(M,e,h,h===null?e.first:h.next,w,F,$,i,n,s),f.set(F,h),_=[],T=[],y=h.next;continue}if(u&&Ms(R,w,$,n),R.e.f&ut&&(Yt(R.e),o&&((b=R.a)==null||b.unfix(),(m??(m=new Set)).delete(R))),R!==y){if(l!==void 0&&l.has(R)){if(_.length<T.length){var K=T[0],A;h=K.prev;var Y=_[0],J=_[_.length-1];for(A=0;A<_.length;A+=1)Qi(_[A],K,t);for(A=0;A<T.length;A+=1)l.delete(T[A]);ht(e,Y.prev,J.next),ht(e,h,Y),ht(e,J,K),y=K,h=J,$-=1,_=[],T=[]}else l.delete(R),Qi(R,y,t),ht(e,R.prev,R.next),ht(e,R,h===null?e.first:h.next),ht(e,h,R),h=R;continue}for(_=[],T=[];y!==null&&y.k!==F;)y.e.f&ut||(l??(l=new Set)).add(y),T.push(y),y=y.next;if(y===null)continue;R=y}_.push(R),h=R,y=R.next}if(y!==null||l!==void 0){for(var ue=l===void 0?[]:xi(l);y!==null;)y.e.f&ut||ue.push(y),y=y.next;var we=ue.length;if(we>0){var xe=n&Dn&&d===0?t:null;if(o){for($=0;$<we;$+=1)(P=ue[$].a)==null||P.measure();for($=0;$<we;$+=1)(X=ue[$].a)==null||X.fix()}As(e,ue,xe,f)}}o&&Pt(()=>{var re;if(m!==void 0)for(R of m)(re=R.a)==null||re.apply()}),he.first=e.first&&e.first.e,he.last=h&&h.e}function Ms(r,e,t,i){i&Fi&&_t(r.v,e),i&Bi?_t(r.i,t):r.i=t}function Ps(r,e,t,i,n,a,s,o,u,d){var f=(u&Fi)!==0,p=(u&$a)===0,y=f?p?Vt(n):He(n):n,l=u&Bi?He(s):s,h={i:l,v:y,k:a,a:null,e:null,prev:t,next:i};try{return h.e=Mt(()=>o(r,y,l,d),Mn),h.e.prev=t&&t.e,h.e.next=i&&i.e,t===null?e.first=h:(t.next=h,t.e.next=h.e),i!==null&&(i.prev=h,i.e.prev=h.e),h}finally{}}function Qi(r,e,t){for(var i=r.next?r.next.e.nodes_start:t,n=e?e.e.nodes_start:t,a=r.e.nodes_start;a!==i;){var s=Yr(a);n.before(a),a=s}}function ht(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function In(r){var e,t,i="";if(typeof r=="string"||typeof r=="number")i+=r;else if(typeof r=="object")if(Array.isArray(r)){var n=r.length;for(e=0;e<n;e++)r[e]&&(t=In(r[e]))&&(i&&(i+=" "),i+=t)}else for(t in r)r[t]&&(i&&(i+=" "),i+=t);return i}function Fs(){for(var r,e,t=0,i="",n=arguments.length;t<n;t++)(r=arguments[t])&&(e=In(r))&&(i&&(i+=" "),i+=e);return i}function Rt(r){return typeof r=="object"?Fs(r):r??""}function Wt(r,e,t,i){var n=r.__attributes??(r.__attributes={});n[e]!==(n[e]=t)&&(e==="style"&&"__styles"in r&&(r.__styles={}),e==="loading"&&(r[Da]=t),t==null?r.removeAttribute(e):typeof t!="string"&&Bs(r).includes(e)?r[e]=t:r.setAttribute(e,t))}var Ji=new Map;function Bs(r){var e=Ji.get(r.nodeName);if(e)return e;Ji.set(r.nodeName,e=[]);for(var t,i=r,n=Element.prototype;n!==i;){t=Sn(i);for(var a in t)t[a].set&&e.push(a);i=Mi(i)}return e}function pe(r,e,t){var i=r.__className,n=qs(e,t);(i!==n||Mn)&&(e==null&&!t?r.removeAttribute("class"):r.className=n,r.__className=n)}function qs(r,e){return(r??"")+(e?" "+e:"")}const Os=()=>performance.now(),dt={tick:r=>requestAnimationFrame(r),now:()=>Os(),tasks:new Set};function ea(){const r=dt.now();dt.tasks.forEach(e=>{e.c(r)||(dt.tasks.delete(e),e.f())}),dt.tasks.size!==0&&dt.tick(ea)}function Ns(r){let e;return dt.tasks.size===0&&dt.tick(ea),{promise:new Promise(t=>{dt.tasks.add(e={c:r,f:t})}),abort(){dt.tasks.delete(e)}}}function wr(r,e){Hi(()=>{r.dispatchEvent(new CustomEvent(e))})}function Rs(r){if(r==="float")return"cssFloat";if(r==="offset")return"cssOffset";if(r.startsWith("--"))return r;const e=r.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function Xi(r){const e={},t=r.split(";");for(const i of t){const[n,a]=i.split(":");if(!n||a===void 0)break;const s=Rs(n.trim());e[s]=a.trim()}return e}const Ls=r=>r;function Lt(r,e,t,i){var n=(r&Ya)!==0,a=(r&Wa)!==0,s=n&&a,o=(r&za)!==0,u=s?"both":n?"in":"out",d,f=e.inert,p=e.style.overflow,y,l;function h(){var F=me,R=he;Qe(null),Je(null);try{return d??(d=t()(e,(i==null?void 0:i())??{},{direction:u}))}finally{Qe(F),Je(R)}}var m={is_global:o,in(){var F;if(e.inert=f,!n){l==null||l.abort(),(F=l==null?void 0:l.reset)==null||F.call(l);return}a||y==null||y.abort(),wr(e,"introstart"),y=gi(e,h(),l,1,()=>{wr(e,"introend"),y==null||y.abort(),y=d=void 0,e.style.overflow=p})},out(F){if(!a){F==null||F(),d=void 0;return}e.inert=!0,wr(e,"outrostart"),l=gi(e,h(),y,0,()=>{wr(e,"outroend"),F==null||F()})},stop:()=>{y==null||y.abort(),l==null||l.abort()}},_=he;if((_.transitions??(_.transitions=[])).push(m),n&&hi){var T=o;if(!T){for(var w=_.parent;w&&w.f&Gr;)for(;(w=w.parent)&&!(w.f&Zr););T=!w||(w.f&kn)!==0}T&&It(()=>{et(()=>m.in())})}}function gi(r,e,t,i,n){var a=i===1;if(ka(e)){var s,o=!1;return Pt(()=>{if(!o){var _=e({direction:a?"in":"out"});s=gi(r,_,t,i,n)}}),{abort:()=>{o=!0,s==null||s.abort()},deactivate:()=>s.deactivate(),reset:()=>s.reset(),t:()=>s.t()}}if(t==null||t.deactivate(),!(e!=null&&e.duration))return n(),{abort:Ie,deactivate:Ie,reset:Ie,t:()=>i};const{delay:u=0,css:d,tick:f,easing:p=Ls}=e;var y=[];if(a&&t===void 0&&(f&&f(0,1),d)){var l=Xi(d(0,1));y.push(l,l)}var h=()=>1-i,m=r.animate(y,{duration:u});return m.onfinish=()=>{var _=(t==null?void 0:t.t())??1-i;t==null||t.abort();var T=i-_,w=e.duration*Math.abs(T),F=[];if(w>0){var R=!1;if(d)for(var $=Math.ceil(w/16.666666666666668),M=0;M<=$;M+=1){var K=_+T*p(M/$),A=Xi(d(K,1-K));F.push(A),R||(R=A.overflow==="hidden")}R&&(r.style.overflow="hidden"),h=()=>{var Y=m.currentTime;return _+T*p(Y/w)},f&&Ns(()=>{if(m.playState!=="running")return!1;var Y=h();return f(Y,1-Y),!0})}m=r.animate(F,{duration:w,fill:"forwards"}),m.onfinish=()=>{h=()=>i,f==null||f(i,1-i),n()}},{abort:()=>{m&&(m.cancel(),m.effect=null,m.onfinish=Ie)},deactivate:()=>{n=Ie},reset:()=>{i===0&&(f==null||f(1,0))},t:()=>h()}}function mi(r,e,t=e){var i=Jt();Qr(r,"input",n=>{var a=n?r.defaultValue:r.value;if(a=oi(r)?ci(a):a,t(a),i&&a!==(a=e())){var s=r.selectionStart,o=r.selectionEnd;r.value=a??"",o!==null&&(r.selectionStart=s,r.selectionEnd=Math.min(o,r.value.length))}}),et(e)==null&&r.value&&t(oi(r)?ci(r.value):r.value),cr(()=>{var n=e();oi(r)&&n===ci(r.value)||r.type==="date"&&!n&&!r.value||n!==r.value&&(r.value=n??"")})}const li=new Set;function Ht(r,e,t,i,n=i){var a=t.getAttribute("type")==="checkbox",s=r;if(e!==null)for(var o of e)s=s[o]??(s[o]=[]);s.push(t),Qr(t,"change",()=>{var u=t.__value;a&&(u=$s(s,u,t.checked)),n(u)},()=>n(a?[]:null)),cr(()=>{var u=i();a?(u=u||[],t.checked=u.includes(t.__value)):t.checked=Pn(t.__value,u)}),qi(()=>{var u=s.indexOf(t);u!==-1&&s.splice(u,1)}),li.has(s)||(li.add(s),Pt(()=>{s.sort((u,d)=>u.compareDocumentPosition(d)===4?-1:1),li.delete(s)})),Pt(()=>{})}function Hs(r,e,t=e){Qr(r,"change",i=>{var n=i?r.defaultChecked:r.checked;t(n)}),et(e)==null&&t(r.checked),cr(()=>{var i=e();r.checked=!!i})}function $s(r,e,t){for(var i=new Set,n=0;n<r.length;n+=1)r[n].checked&&i.add(r[n].__value);return t||i.delete(e),Array.from(i)}function oi(r){var e=r.type;return e==="number"||e==="range"}function ci(r){return r===""?null:+r}function ta(r,e,t){if(r.multiple)return Zs(r,e);for(var i of r.options){var n=ir(i);if(Pn(n,e)){i.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function Us(r,e){It(()=>{var t=new MutationObserver(()=>{var i=r.__value;ta(r,i)});return t.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{t.disconnect()}})}function ra(r,e,t=e){var i=!0;Qr(r,"change",n=>{var a=n?"[selected]":":checked",s;if(r.multiple)s=[].map.call(r.querySelectorAll(a),ir);else{var o=r.querySelector(a)??r.querySelector("option:not([disabled])");s=o&&ir(o)}t(s)}),It(()=>{var n=e();if(ta(r,n,i),i&&n===void 0){var a=r.querySelector(":checked");a!==null&&(n=ir(a),t(n))}r.__value=n,i=!1}),Us(r)}function Zs(r,e){for(var t of r.options)t.selected=~e.indexOf(ir(t))}function ir(r){return"__value"in r?r.__value:r.value}function Ii(r,e){return r===e||(r==null?void 0:r[ft])===e}function js(r={},e,t,i){return It(()=>{var n,a;return cr(()=>{n=a,a=[],et(()=>{r!==t(...a)&&(e(r,...a),n&&Ii(t(...n),r)&&e(null,...n))})}),()=>{Pt(()=>{a&&Ii(t(...a),r)&&e(null,...a)})}}),r}function Ye(r=!1){const e=Me,t=e.l.u;if(!t)return;let i=()=>_s(e.s);if(r){let n=0,a={};const s=xt(()=>{let o=!1;const u=e.s;for(const d in u)u[d]!==a[d]&&(a[d]=u[d],o=!0);return o&&n++,n});i=()=>v(s)}t.b.length&&is(()=>{en(e,i),ui(t.b)}),Yi(()=>{const n=et(()=>t.m.map(ba));return()=>{for(const a of n)typeof a=="function"&&a()}}),t.a.length&&Yi(()=>{en(e,i),ui(t.a)})}function en(r,e){if(r.l.s)for(const t of r.l.s)v(t);e()}function ia(r,e,t){if(r==null)return e(void 0),Ie;const i=et(()=>r.subscribe(e,t));return i.unsubscribe?()=>i.unsubscribe():i}const $t=[];function Gs(r,e=Ie){let t=null;const i=new Set;function n(o){if(En(r,o)&&(r=o,t)){const u=!$t.length;for(const d of i)d[1](),$t.push(d,r);if(u){for(let d=0;d<$t.length;d+=2)$t[d][0]($t[d+1]);$t.length=0}}}function a(o){n(o(r))}function s(o,u=Ie){const d=[o,u];return i.add(d),i.size===1&&(t=e(n,a)||Ie),o(r),()=>{i.delete(d),i.size===0&&t&&(t(),t=null)}}return{set:n,update:a,subscribe:s}}function Vs(r){let e;return ia(r,t=>e=t)(),e}let kr=!1,_i=Symbol();function Ys(r,e,t){const i=t[e]??(t[e]={store:null,source:Vt(void 0),unsubscribe:Ie});if(i.store!==r&&!(_i in t))if(i.unsubscribe(),i.store=r??null,r==null)i.source.v=void 0,i.unsubscribe=Ie;else{var n=!0;i.unsubscribe=ia(r,a=>{n?i.source.v=a:ie(i.source,a)}),n=!1}return r&&_i in t?Vs(r):v(i.source)}function Ws(){const r={};function e(){qi(()=>{for(var t in r)r[t].unsubscribe();_n(r,_i,{enumerable:!1,value:!0})})}return[r,e]}function zs(r){var e=kr;try{return kr=!1,[r(),kr]}finally{kr=e}}function ye(r,e,t,i){var K;var n=(t&Ua)!==0,a=!or||(t&Za)!==0,s=(t&Ga)!==0,o=(t&Va)!==0,u=!1,d;s?[d,u]=zs(()=>r[e]):d=r[e];var f=ft in r||Ea in r,p=s&&(((K=Zt(r,e))==null?void 0:K.set)??(f&&e in r&&(A=>r[e]=A)))||void 0,y=i,l=!0,h=!1,m=()=>(h=!0,l&&(l=!1,o?y=et(i):y=i),y);d===void 0&&i!==void 0&&(p&&a&&Fa(),d=m(),p&&p(d));var _;if(a)_=()=>{var A=r[e];return A===void 0?m():(l=!0,h=!1,A)};else{var T=(n?xt:Se)(()=>r[e]);T.f|=Tn,_=()=>{var A=v(T);return A!==void 0&&(y=void 0),A===void 0?y:A}}if(!(t&ja))return _;if(p){var w=r.$$legacy;return function(A,Y){return arguments.length>0?((!a||!Y||w||u)&&p(Y?_():A),A):_()}}var F=!1,R=!1,$=Vt(d),M=xt(()=>{var A=_(),Y=v($);return F?(F=!1,R=!0,Y):(R=!1,$.v=A)});return n||(M.equals=Pi),function(A,Y){if(gt!==null&&(F=R,_(),v($)),arguments.length>0){const J=Y?v(M):a&&s?yt(A):A;return M.equals(J)||(F=!0,ie($,J),h&&y!==void 0&&(y=J),et(()=>v(M))),A}return v(M)}}const Ks="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ks);La();class Qs{constructor(e,t,i){c(this,"_dbname");c(this,"_dbversion");c(this,"dbPromise");c(this,"getTran",async(e,t)=>(await this.dbPromise).transaction(e,t));c(this,"reset",async()=>(await indexedDB.databases().then(e=>{console.log(e)}),await new Promise((e,t)=>{const i=indexedDB.deleteDatabase(this._dbname);i.onsuccess=()=>{console.log("onsuccess"),e()},i.onerror=n=>{console.log("onerror"),t(n)}})));c(this,"getAll",async e=>{const t=await this.dbPromise;return new Promise((i,n)=>{const o=t.transaction([e],"readonly").objectStore(e).getAll();o.onsuccess=()=>{i(o.result)},o.onerror=u=>{n(u)}})});c(this,"get",async(e,t)=>{const i=await this.dbPromise;return new Promise((n,a)=>{const u=i.transaction([e],"readonly").objectStore(e).get(t);u.onsuccess=()=>{n(u.result)},u.onerror=d=>{a(d)}})});c(this,"getMany",async(e,t)=>{const a=(await this.dbPromise).transaction([e],"readonly").objectStore(e),s=t.map(o=>new Promise((u,d)=>{const f=a.get(o);f.onsuccess=()=>{u(f.result)},f.onerror=p=>{d(p)}}));return await Promise.all(s)});c(this,"putRecords",async(e,t)=>{const n=(await this.dbPromise).transaction([e],"readwrite"),a=n.objectStore(e),s=t.map(o=>({record:o,request:a.put(o)}));return new Promise((o,u)=>{n.oncomplete=()=>o(s.map(d=>Object.assign({id:d.request.result},d.record))),n.onerror=d=>u(d)})});c(this,"deleteRecords",async(e,t)=>{const n=(await this.dbPromise).transaction([e],"readwrite"),a=n.objectStore(e),s=t.map(o=>({key:o,request:a.delete(o)}));return new Promise((o,u)=>{n.oncomplete=()=>{console.log(s.map(d=>d.request.result)),o()},n.onerror=d=>u(d)})});this._dbname=e,this._dbversion=t,this.dbPromise=new Promise((n,a)=>{const s=indexedDB.open(e,t);s.onsuccess=o=>{if(console.log(o),!o.target){console.log("event.target is undefined"),a("event.target is undefined");return}const u=o.target.result;if(!u){console.log("event.target.result is undefined"),a("event.target.result is undefined");return}u.onversionchange=d=>{console.log(d),u.close()},n(u)},s.onupgradeneeded=o=>{console.log("onupgradeneeded");const u=o.target.result;i.filter(d=>!u.objectStoreNames.contains(d)).map(d=>u.createObjectStore(d,{keyPath:"id",autoIncrement:!0}))},s.onerror=o=>{console.log(o),a(o)},s.onblocked=o=>{console.log(o),a(o)}}),console.log(this.dbPromise)}get dbversion(){return this._dbversion}}class Ge{constructor(){c(this,"handlers",[])}append(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}trigger(e){this.handlers.slice(0).forEach(t=>t(e))}clear(){this.handlers.splice(0)}expose(){return this}}class tn{constructor(){c(this,"handler")}set(e){this.handler=e}async call(e){if(!this.handler)throw Error("illegal state error");return await this.handler(e)}expose(){return this}}class $i{constructor(e,t,i,n){c(this,"_name");c(this,"_createVersion");c(this,"mountResolver",()=>{});c(this,"_indexedDb");c(this,"onInsertEvent",new Ge);c(this,"onBeforeInsertEvent",new tn);c(this,"onUpdateEvent",new Ge);c(this,"onBeforeUpdateEvent",new tn);c(this,"onDeleteEvent",new Ge);c(this,"prepareInitialRecords",()=>{const e=new Date;return this._prepareInitialRecords().map(t=>Object.assign(t,{createdAt:e,updatedAt:e,dbVersion:this._createVersion}))});c(this,"resolveMount",()=>this.mountResolver());c(this,"patchForInsert",(e,t)=>{e.newRecords.forEach(i=>{console.log(i),t[i.id]=i})});c(this,"patchForUpdate",(e,t)=>{e.recordPairs.forEach(i=>{console.log(t[i.newRecord.id],i.newRecord),t[i.newRecord.id]={...i.newRecord}})});c(this,"patchForDelete",(e,t)=>{e.oldRecords.forEach(i=>{console.log(i),delete t[i.id]})});this._indexedDb=e,this._name=t,this._createVersion=e.dbversion,this.getAll().then(a=>a.reduce((s,o)=>(s[o.id]=o,s),{})).then(a=>{console.log(this.name,a),this.onBeforeInsertEvent.set(i??(()=>Promise.resolve())),this.onBeforeUpdateEvent.set(n??(()=>Promise.resolve()))})}get name(){return this._name}get createVersion(){return this._createVersion}get oninsert(){return this.onInsertEvent.expose()}get onbeforeinsert(){return this.onBeforeInsertEvent.expose()}get onupdate(){return this.onUpdateEvent.expose()}get onbeforeupdate(){return this.onBeforeUpdateEvent.expose()}get ondelete(){return this.onDeleteEvent.expose()}getAll(){return this._indexedDb.getAll(this.name)}get(e){return this._indexedDb.get(this.name,e)}async insertMany(e){const t=new Date,i=e.map(a=>{const s={createdAt:t,updatedAt:t,dbVersion:this._createVersion};return Object.assign(a,s)});await this.onBeforeInsertEvent.call({sender:this,newRecords:i,timestamp:t});const n=await this._indexedDb.putRecords(this.name,i);return this.onInsertEvent.trigger({sender:this,newRecords:n,timestamp:t}),n}async insert(e){return(await this.insertMany([e]))[0]}async updateMany(e,t){const i=new Date,n=[];return(await this._indexedDb.getMany(this.name,e)).forEach(s=>{const o={...s},u={...o};n.push({newRecord:Object.assign(t(u),{updatedAt:i,dbVersion:this._createVersion}),oldRecord:o})}),await this.onBeforeUpdateEvent.call({sender:this,recordPairs:n,timestamp:i}),await this._indexedDb.putRecords(this.name,n.map(s=>s.newRecord)),this.onUpdateEvent.trigger({sender:this,recordPairs:n,timestamp:i}),n.map(s=>s.newRecord)}async update(e,t){return(await this.updateMany([e],t))[0]}async delete(e){const t=new Date,i=await this._indexedDb.getMany(this.name,e);await this._indexedDb.deleteRecords(this.name,e),this.onDeleteEvent.trigger({sender:this,oldRecords:i,timestamp:t})}}const We=class We{constructor(e){c(this,"id");c(this,"name");c(this,"description");c(this,"save",async e=>{const t=e??{id:this.id,name:this.name,description:this.description},i=await We.tblHeader.update(this.id,n=>({...n,...t}));return new We(i)});this.id=e.id,this.name=e.name,this.description=e.description}};c(We,"tblHeader"),c(We,"getOrCreateNew",async e=>{We.tblHeader||(We.tblHeader=new Js(e));const t=await We.tblHeader.getAll();if(t.length)return new We(t[0]);const i=await We.tblHeader.insert({name:"あなた",description:"ここの文字列を何に使うかは未定。"});return new We(i)});let Si=We;class Js extends $i{constructor(t){super(t,"TblDuelistProfile");c(this,"_prepareInitialRecords",()=>[])}}let Xs=-1;const Is=[{id:Xs--,name:"NPC",description:""}],el=["Deck","ExtraDeck"],tl={Deck:"メインデッキ",ExtraDeck:"エクストラデッキ"},wi=["Monster","Spell","Trap"],na={Monster:"モンスター",Spell:"魔法",Trap:"罠"},zt=["Fusion","Syncro","Xyz","Link"],aa=[...zt,"SpecialSummon"],rl=["Toon","Spirit","Union","Gemini","FlipEffect"],il=["Tuner","Effect","Normal","Pendulum","Token","NormalSummonOnly"],rn=[...aa,...rl,...il],Jr={Syncro:"シンクロ",Fusion:"融合",Xyz:"エクシーズ",Link:"リンク",SpecialSummon:"特殊召喚",Toon:"トゥーン",Spirit:"スピリット",Union:"ユニオン",Gemini:"デュアル",FlipEffect:"リバース",Tuner:"チューナー",Effect:"効果",Normal:"通常",Pendulum:"ペンデュラム",Token:"トークン",NormalSummonOnly:"特殊召喚不可"},fr={Syncro:"🎵",Fusion:"🌀",Xyz:"📰",Link:"⛓️",SpecialSummon:"🔯",Toon:"📖",Spirit:"👻",Union:"🚗",Gemini:"👫",FlipEffect:"🔄",Tuner:"🎶",Effect:"✨",Normal:"🔘",Pendulum:"💠",Token:"🐏",NormalSummonOnly:"🔲"},nn=["Light","Dark","Earth","Water","Fire","Wind","Divine"],Ui={Light:"光",Dark:"闇",Earth:"地",Water:"水",Fire:"炎",Wind:"風",Divine:"神"},an=["Aqua","Beast","BeastWarrior","CreatorGod","Cyberse","Dinosaur","DivineBeast","Dragon","Fairy","Fiend","Fish","Insect","Illusion","Machine","Plant","Psychic","Pyro","Reptile","Rock","SeaSerpent","Spellcaster","Thunder","Warrior","WingedBeast","Wyrm","Zombie"],sn=["Normal","Continuous","Field","QuickPlay","Equip","Ritual"],vr={Normal:"通常",Continuous:"永続",Field:"フィールド",QuickPlay:"速攻",Equip:"装備",Ritual:"儀式"},ln=["Normal","Continuous","Counter"],pr={Normal:"通常",Continuous:"永続",Counter:"カウンター"},Tr={Attack:"攻撃表示",Defense:"守備表示",Set:"裏側守備表示"},sa=["level","rank","attack","defense","pendulumScaleR","pendulumScaleL"],nl=({wikiName:r,wikiHref:e,wikiTextAll:t,nameKana:i,description:n,pendulumDescription:a,...s})=>s,al=r=>nl(r),Xr={Aqua:"水",Beast:"獣",BeastWarrior:"獣戦士",CreatorGod:"創造神",Cyberse:"サイバース",Dinosaur:"恐竜",DivineBeast:"幻獣神",Dragon:"ドラゴン",Fairy:"天使",Fiend:"悪魔",Fish:"魚",Insect:"昆虫",Illusion:"幻想魔",Machine:"機械",Plant:"植物",Psychic:"サイキック",Pyro:"炎",Reptile:"爬虫類",Rock:"岩石",SeaSerpent:"海竜",Spellcaster:"魔法使い",Thunder:"雷",Warrior:"戦士",WingedBeast:"鳥獣",Wyrm:"幻竜",Zombie:"アンデット"},hr={Aqua:"🚰",Beast:"🐅",BeastWarrior:"🦁",CreatorGod:"🔆",Cyberse:"💻️",Dinosaur:"🦖",DivineBeast:"💫",Dragon:"🐲",Fairy:"👼",Fiend:"👿",Fish:"🐟️",Insect:"🦋",Illusion:"🤡",Machine:"🤖",Plant:"🌱",Psychic:"👁️",Pyro:"🔥",Reptile:"🦎",Rock:"⛰",SeaSerpent:"🐍",Spellcaster:"🧙",Thunder:"⚡️",Warrior:"⚔️",WingedBeast:"🦅",Wyrm:"🐉",Zombie:"🦴"},la=["Deck","ExtraDeck"],sl=[...la,"Graveyard","Banished"],Nr=["MonsterZone","ExtraMonsterZone"],Ft=["SpellAndTrapZone","FieldSpellZone"],yr=[...Nr,...Ft],ki={0:{0:"Hand"},1:{0:"Deck",1:"SpellAndTrapZone",2:"SpellAndTrapZone",3:"SpellAndTrapZone",4:"SpellAndTrapZone",5:"SpellAndTrapZone",6:"ExtraDeck"},2:{0:"Graveyard",1:"MonsterZone",2:"MonsterZone",3:"MonsterZone",4:"MonsterZone",5:"MonsterZone",6:"FieldSpellZone"},3:{0:"Banished",1:"Disable",2:"ExtraMonsterZone",3:"Disable",4:"ExtraMonsterZone",5:"Disable",6:"Banished"},4:{0:"FieldSpellZone",1:"MonsterZone",2:"MonsterZone",3:"MonsterZone",4:"MonsterZone",5:"MonsterZone",6:"Graveyard"},5:{0:"ExtraDeck",1:"SpellAndTrapZone",2:"SpellAndTrapZone",3:"SpellAndTrapZone",4:"SpellAndTrapZone",5:"SpellAndTrapZone",6:"Deck"},6:{0:"Hand"}};class ll{constructor(e,t,i,n){c(this,"onUpdateEvent",new Ge);c(this,"field");c(this,"row");c(this,"column");c(this,"cellType");c(this,"owner");c(this,"_needsShuffle",!1);c(this,"_entities");c(this,"releaseEntities",e=>(this._entities=this._entities.filter(t=>!e.includes(t)),this.onUpdateEvent.trigger(),e));c(this,"acceptEntities",(e,t)=>{t==="Top"?this._entities.unshift(...e):this._entities.push(...e),t==="Random"&&(this._needsShuffle=!0),this._entities.forEach(i=>{i.fieldCell=this}),this.onUpdateEvent.trigger()});c(this,"shuffle",()=>{this._entities=this.entities.shuffle(),this._needsShuffle=!1});this.field=e,this.row=t,this.column=i,this.cellType=ki[t][i],this.owner=n,this._entities=[]}get onUpdate(){return this.onUpdateEvent.expose()}get needsShuffle(){return this._needsShuffle}get entities(){return this._entities}get cardEntities(){return this._entities.filter(e=>Hl.find(t=>t===e.entityType))}get targetForAttack(){return this.cellType==="Hand"?this._entities.find(e=>e.entityType==="Duelist"):this.cardEntities[0]}get isAvailable(){return this._entities.length===0}get isStackCell(){return sl.some(e=>e===this.cellType)}get isPlayFieldCell(){return yr.some(e=>e===this.cellType)}}Array.prototype.shuffle=function(){return this.map(e=>({item:e,seq:Math.random()})).toSorted((e,t)=>e.seq-t.seq).map(e=>e.item)};Array.prototype.randomPickMany=function(r){return this.shuffle().slice(0,r)};Array.prototype.randomPick=function(){return this.shuffle().slice(0,1)[0]};Array.prototype.reset=function(...r){this.splice(0),this.push(...r)};Array.prototype.union=function(r){return this.filter(e=>r.find(t=>e===t))};Array.prototype.getAllOnOffPattern=function(){const r=[];return this.forEach(e=>{if(r.length==0){r.push([e]),r.push([]);return}r.forEach(t=>r.push([...t,e]))}),r};Array.prototype.getDistinct=function(){return Array.from(new Set(this))};const ol=["NormalSummon","SpecialSummon","ChangeBattlePosition","Battle","SpellTrapSet","SpellTrapActivate"],on=["NormalSummon","AdvanceSummon","SpecialSummon","SpecialSummonFromDeck","SendToGraveyardFromDeck","Draw","SearchFromDeck","BanishFromGraveyard","AddToHandFromGraveyard","ReturnToDeckFromGraveyard","SpecialSummonFromGraveyard","Destroy","DestroyMultiple","DestroyOnField","DestroyMultipleOnField","DestroyOnOpponentField","DestroyMultipleOnOpponentField","DestroyMonsterOnField","DestroyMonstersOnField","DestroySpellTrapOnField","DestroySpellTrapsOnField","IfNormarlSummonSucceed","IfSpecialSummonSucceed","DamageToOpponent","DamageToSelf","PayLifePoint","DiscordAsCost","DiscordAsEffect","RollDice","BounceToHand","NegateCardEffect","NegateCardActivation"],Tt=r=>r.playType==="CardActivation"?r.entity.nm:`${r.entity.nm}«${r.title}»`,lt=class lt{constructor(e,t,i){c(this,"seq");c(this,"entity");c(this,"cardActionBase");c(this,"getClone",()=>new lt(this.seq,this.entity,this.cardActionBase));c(this,"validate",e=>{if(!(this.isOnlyNTimesPerDuel>0&&this.entity.field.duel.cardActionLog.records.filter(t=>this.isSame(t.cardAction)).filter(t=>t.activator).length>=this.isOnlyNTimesPerDuel)&&!(this.isOnlyNTimesPerTurn>0&&this.entity.field.duel.cardActionLog.records.filter(t=>this.isSameGroupPerTurn(t.cardAction)).filter(t=>t.clock.turn===this.entity.field.duel.clock.turn).filter(t=>t.activator).length>=this.isOnlyNTimesPerTurn))return this.cardActionBase.validate(this,e)});c(this,"prepare",async(e,t,i)=>{this.isLikeContinuousSpell&&(this.entity.info.isPending=!0);const n=this.entity.fieldCell,a=await this.cardActionBase.prepare(this,e,t,i);if(a!==void 0)return this.entity.field.duel.cardActionLog.push(this.entity.controller,this),{...a,action:this,activator:this.entity.controller,isActivatedIn:n}});c(this,"execute",async(e,t)=>{if(e.action.isLikeContinuousSpell&&!e.action.entity.isOnField)return this.entity.info.isPending=!1,!1;const i=await this.cardActionBase.execute(e,t);if(e.action.isLikeContinuousSpell)for(const n of this.entity.continuousEffects)this.entity.info.isPending=!1,await n.updateState();return i});c(this,"settle",(e,t)=>this.cardActionBase.settle(e,t));c(this,"isSame",e=>this.entity.origin.name===e.entity.origin.name&&this.title===e.title);c(this,"isSameGroupPerTurn",e=>this.actionGroupNamePerTurn?this.entity.origin.name===e.entity.origin.name&&this.actionGroupNamePerTurn===e.actionGroupNamePerTurn:this.isSame(e));c(this,"calcChainBlockTagsForDestroy",e=>{if(!on.length)return[];const t=["Destroy"];on.length>1&&t.push("DestroyMultiple");const i=e.filter(o=>o.isOnField);i.length&&(t.push("DestroyOnField"),i.length>1&&t.push("DestroyMultipleOnField"));const n=i.filter(o=>o.status.kind==="Monster");n.length&&(t.push("DestroyMonsterOnField"),n.length>1&&t.push("DestroyMonstersOnField")),i.filter(o=>o.status.kind!=="Monster").length&&(t.push("DestroySpellTrapOnField"),n.length>1&&t.push("DestroySpellTrapsOnField"));const s=i.filter(o=>o.controller!==this.entity.controller);return s.length&&(t.push("DestroyOnOpponentField"),s.length>1&&t.push("DestroyMultipleOnOpponentField")),t});this.seq=e,this.entity=t,this.cardActionBase=i}get title(){return this.cardActionBase.title}get playType(){return this.cardActionBase.playType}get spellSpeed(){return this.cardActionBase.spellSpeed}get hasToTargetCards(){return this.cardActionBase.hasToTargetCards??!1}get executableCells(){return this.cardActionBase.executableCells}get isOnlyNTimesPerDuel(){return this.cardActionBase.isOnlyNTimesPerDuel??0}get isOnlyNTimesPerTurn(){return this.cardActionBase.isOnlyNTimesPerTurn??0}get isLikeContinuousSpell(){return this.cardActionBase.isLikeContinuousSpell||this.entity.isLikeContinuousSpell&&this.playType==="CardActivation"}get actionGroupNamePerTurn(){return this.cardActionBase.actionGroupNamePerTurn}get canExecuteOnDamageStep(){return this.cardActionBase.canExecuteOnDamageStep??!1}};c(lt,"nextActionSeq",0),c(lt,"createNew",(e,t)=>new lt(lt.nextActionSeq++,e,t)),c(lt,"createDammyAction",(e,t,i,n)=>({seq:lt.nextActionSeq++,title:t,entity:e,playType:"Dammy",spellSpeed:"Dammy",executableCells:[e.fieldCell.cellType],hasToTargetCards:!1,isOnlyNTimesPerDuel:0,isOnlyNTimesPerTurn:0,isLikeContinuousSpell:!1,getClone:function(){return this},validate:()=>i,prepare:async()=>{},execute:async()=>!1,settle:async()=>!1,pos:n,cell:i[0],dragAndDropOnly:i.length>1}));let wt=lt;const cl=async()=>({selectedEntities:[],chainBlockTags:[],prepared:void 0}),dl=r=>{if(r.entity.controller.info.ruleNormalSummonCount>=r.entity.controller.info.maxRuleNormalSummonCount||!r.entity.lvl)return;const e=r.entity.controller.getAvailableMonsterZones();return r.entity.lvl<5?e.length>0?e:void 0:r.entity.controller.getReleasableMonsters().length<(r.entity.lvl<7?1:2)?void 0:[]},ul=async(r,e,t,i)=>{if(!r.entity.lvl)return;let n=e?[e]:r.entity.controller.getAvailableMonsterZones();if(n.length===0)return;let a=i,s=[];if(r.entity.lvl>4){const d=r.entity.controller.getReleasableMonsters(),f=r.entity.controller.getExtraMonsterZones(),p=r.entity.lvl<7?1:2;f.length>=p&&d.filter(l=>l.fieldCell.cellType!=="ExtraMonsterZone");const y=await r.entity.field.release(r.entity.controller,r.entity.controller.getReleasableMonsters(),p,"Cost",["AdvanceSummonRelease","Rule"],r.entity,a);if(!y)return;s=y,a=!1,n=r.entity.controller.getAvailableMonsterZones()}let o=(r.entity.atk??0)>0&&(r.entity.atk??0)>=(r.entity.def??0)?"Attack":"Set",u=n.randomPick();if(r.entity.controller.duelistType!=="NPC"){const d=await r.entity.field.duel.view.waitSelectSummonDest(r.entity,n,["Attack","Set"],a);if(!d)return;u=d.dest,o=d.pos}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:u,pos:o,materials:s}}},fl=async r=>{const e=["Rule","NormalSummon"];return r.prepared.materials.length>0&&(r.action.entity.info.materials.reset(...r.prepared.materials),e.push("AdvanceSummon")),await r.action.entity.summon(r.prepared.dest,r.prepared.pos,"NormalSummon",e,r.action.entity,r.activator),r.activator.info.ruleNormalSummonCount++,r.activator.info.ruleNormalSummonCountQty++,!0},cn=(r,e,t)=>{const i=r.entity.controller.getAvailableMonsterZones();if(r.entity.fieldCell.cellType==="ExtraDeck"&&i.push(...r.entity.controller.getAvailableExtraZones()),!(!i.length&&(!t.length||t.every(n=>n.fieldCell.cellType!=="MonsterZone")&&r.entity.fieldCell.cellType!=="ExtraDeck"))&&r.entity.controller.canSummon(r.entity.controller,r.entity,r,"SpecialSummon",e,t).length)return t.length===0?i:[]},dn=async(r,e,t,i,n)=>{const a=e?[e]:r.entity.controller.getAvailableMonsterZones();if(a.length===0)return;const s=r.entity.controller.canSummon(r.entity.controller,r.entity,r,"SpecialSummon",t,i);if(s.length===0)return;let o=s.randomPick(),u=a.randomPick();if(s.length&&s.includes("Attack")&&(o=(r.entity.atk??0)>0&&(r.entity.atk??0)>=(r.entity.def??0)?"Attack":s.filter(d=>d!=="Attack").randomPick()),r.entity.controller.duelistType!=="NPC"){const d=await r.entity.field.duel.view.waitSelectSummonDest(r.entity,a,s,n);if(!d)return;u=d.dest,o=d.pos}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:u,pos:o,materials:i}}},un=async r=>{const e=["Rule","SpecialSummon"];return await r.action.entity.summon(r.prepared.dest,r.prepared.pos,"SpecialSummon",e,r.action.entity,r.activator),r.action.entity.info.materials=r.prepared.materials,!0},Le={title:"通常召喚",playType:"NormalSummon",spellSpeed:"Normal",executableCells:["Hand"],validate:dl,prepare:ul,execute:fl,settle:async()=>!0},vl=r=>{if(r.entity.info.attackCount>0||r.entity.battlePosition!=="Attack"||!r.entity.controller.isTurnPlayer)return;const e=r.entity.controller.getAttackTargetMonsters();return e.length>0?e.map(t=>t.fieldCell):[r.entity.controller.getOpponentPlayer().getHandCell()]},pl=async(r,e)=>{if(r.entity.info.attackCount>0||r.entity.battlePosition!=="Attack")return;if(e!=null&&e.targetForAttack)return{selectedEntities:[],chainBlockTags:[],prepared:{target:e.targetForAttack}};const t=r.entity.controller.getAttackTargetMonsters(),i=r.entity.controller.getOpponentPlayer().entity;if(t.length===0)return{selectedEntities:[],chainBlockTags:[],prepared:{target:i}};if(t.length===1)return{selectedEntities:[],chainBlockTags:[],prepared:{target:t[0]}};const n=await r.entity.field.duel.view.waitSelectEntities(r.entity.controller,t,1,a=>a.length===1,"攻撃対象を選択。",!0);if(n)return{selectedEntities:[],chainBlockTags:[],prepared:{target:n[0]}}},hl=async r=>(r.action.entity.field.duel.declareAnAttack(r.action.entity,r.prepared.target),!0),Fe={title:"攻撃宣言",playType:"Battle",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],validate:vl,prepare:pl,execute:hl,settle:async()=>!0},yl=r=>{if(!(r.entity.info.battlePotisionChangeCount>0||r.entity.info.attackCount>0||!r.entity.controller.isTurnPlayer))return[]},gl=async r=>r.action.entity.info.battlePotisionChangeCount>0||!r.action.entity.controller.isTurnPlayer?!1:(await r.action.entity.setBattlePosition(r.action.entity.battlePosition==="Attack"?"Defense":"Attack",["Rule"]),r.action.entity.info.battlePotisionChangeCount++,!0),Be={title:"表示形式変更",playType:"ChangeBattlePosition",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],validate:yl,prepare:cl,execute:gl,settle:async()=>!0},oa=(r,e,t,i)=>!r.entity.origin.level||e.some(n=>!n.lvl)||e.map(n=>n.lvl??0).reduce((n,a)=>n+a,0)!==r.entity.origin.level||!t(e.filter(n=>{var a;return(a=n.status.monsterCategories)==null?void 0:a.some(s=>s==="Tuner")}))?!1:i(e.filter(n=>{var a;return(a=n.status.monsterCategories)==null?void 0:a.every(s=>s!=="Tuner")}))?e.every(n=>n.canBeMaterials("SyncroSummon",r,e))?r.entity.owner.canSummon(r.entity.owner,r.entity,r,"SyncroSummon",["Attack","Defense"],e).length?!0:(console.log("piyo"),!1):(console.log("fuga"),!1):(console.log("hoge"),!1),ca=(r,e=i=>i.length===1,t=i=>i.length>0)=>{let i=[...r.entity.controller.getMonstersOnField().filter(n=>n.battlePosition!=="Set"),...r.entity.controller.getHandCell().entities.filter(n=>n.origin.kind==="Monster")];return i.every(n=>!n.status.allowHandSyncro)&&(i=i.filter(n=>n.fieldCell.isPlayFieldCell)),i.length<2?[]:i.getAllOnOffPattern().filter(n=>oa(r,n,e,t))},ml=(r,e=i=>i.length===1,t=i=>i.length>0)=>ca(r,e,t).length>0?[]:void 0,_l=async(r,e,t,i=a=>a.length===1,n=a=>a.length>0)=>{const a=ca(r,i,n);let s=a[0];if(a.length>1){const f=a.flatMap(y=>y).getDistinct(),p=await r.entity.duel.view.waitSelectEntities(r.entity.controller,f,void 0,y=>oa(r,y,i,n),"シンクロ素材とするモンスターを選択",!0);if(!p)return;s=p}r.entity.field.duel.log.info(`シンクロ素材として、${s.map(f=>"《"+f.nm+"》").join("")}を墓地に送り――`,r.entity.controller),await ge.sendManyToGraveyardForTheSameReason(s,["SyncroMaterial","Rule","SpecialSummonMaterial"],r.entity,r.entity.controller);const o=[...r.entity.controller.getAvailableMonsterZones(),...r.entity.controller.getAvailableExtraZones()];let u=(r.entity.atk??0)>0&&(r.entity.atk??0)>=(r.entity.def??0)?"Attack":"Defense",d=o.randomPick();if(r.entity.controller.duelistType!=="NPC"){const f=await r.entity.field.duel.view.waitSelectSummonDest(r.entity,o,["Attack","Defense"],!1);if(!f)return;d=f.dest,u=f.pos}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:d,pos:u,materials:s}}},Sl=async r=>{const e=["Rule","SpecialSummon","SyncroSummon"];return await r.action.entity.summon(r.prepared.dest,r.prepared.pos,"SyncroSummon",e,r.action.entity,r.activator),r.action.entity.info.isRebornable=!0,!0},fn=(r=t=>t.length===1,e=t=>t.length>0)=>({title:"シンクロ召喚",playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],validate:t=>ml(t,r,e),prepare:(t,i,n,a)=>_l(t,i,a,r,e),execute:Sl,settle:async()=>!0});class Ir{constructor(){c(this,"pooledOperators",[]);c(this,"bundles",[]);c(this,"excludesExpired",()=>{this.bundles=this.bundles.filter(e=>!e.entity.hasDisappeared),this.bundles.forEach(e=>e.excludesExpired()),this.pooledOperators=this.pooledOperators.filter(e=>e.validateAlive(e.isSpawnedBy))});c(this,"append",e=>{this.bundles.push(e)});c(this,"push",e=>{if(!e.isContinuous)throw new qe("staticへの追加は永続以外不可",e);this.excludesExpired(),this.distribute(e),this.pooledOperators.push(e)});c(this,"distributeAll",e=>(this.excludesExpired(),this.pooledOperators.flatMap(this.distribute),this.afterDistributeAll(e)));c(this,"distribute",e=>(console.log(this,e),this.bundles.filter(t=>t.operators.every(i=>i.seq!==e.seq)).filter(t=>e.isApplicableTo(e.isSpawnedBy,t.entity)).map(t=>(t.push(e),t))));c(this,"removeItem",e=>{this.pooledOperators=this.pooledOperators.filter(t=>t.seq!==e)})}}class ei{constructor(e,t){c(this,"pool");c(this,"entity");c(this,"_operators");c(this,"excludesExpired",()=>{this._operators=this._operators.filter(e=>{const t=e.validateAlive(e.isSpawnedBy)&&e.isApplicableTo(e.isSpawnedBy,this.entity);return t||(console.info(`before remove ${this.entity.toString} ${e.title}`),e.beforeRemove()),t})});c(this,"push",e=>{console.log("push"),console.log(this.entity.procFilterBundle.operators),console.log(this.entity.procFilterBundle.operators.filter(t=>t.procTypes.includes("Effect"))),console.log(this.entity.procFilterBundle.operators.filter(t=>t.procTypes.includes("Effect")).some(t=>!t.filter(t.effectOwner,t.isSpawnedBy,t.actionAttr,[]))),!this.entity.procFilterBundle.operators.filter(t=>t.procTypes.includes("Effect")).some(t=>!t.filter(t.effectOwner,t.isSpawnedBy,t.actionAttr,[]))&&(console.log("push"),this.beforePush(e),console.log("push"),this._operators.push(e))});c(this,"removeItem",e=>{this._operators=this._operators.filter(t=>t.seq!==e?!0:(t.beforeRemove(),!1))});this.pool=e,this.entity=t,this._operators=[],this.pool.append(this)}get operators(){return this._operators}}const Lr=class Lr{constructor(e,t,i,n,a,s){c(this,"seq");c(this,"title");c(this,"validateAlive");c(this,"isContinuous");c(this,"isSpawnedBy");c(this,"activateType");c(this,"actionAttr");c(this,"isApplicableTo");c(this,"effectOwner");this.seq=Lr.nextSeq++,this.title=e,this.validateAlive=t,this.isContinuous=i,this.isSpawnedBy=n,this.isApplicableTo=s,this.actionAttr=a,this.activateType="NonActivate",this.actionAttr.playType&&(this.actionAttr.playType==="CardActivation"?this.activateType="CardActivation":this.activateType="EffectActivation"),this.effectOwner=this.isSpawnedBy.controller}};c(Lr,"nextSeq",0);let Kt=Lr;class wl extends Ir{constructor(){super(...arguments);c(this,"afterDistributeAll",()=>this.bundles.every(t=>t.applyEffectFilter()))}}class kl extends ei{constructor(){super(...arguments);c(this,"applyEffectFilter",()=>{const t=this.entity.allStickyEffectOperators.length,i=[];for(;;){const n=this.operators.filter(a=>a.procTypes.includes("Effect")).filter(a=>a.isContinuous).find(a=>!i.includes(a.seq));if(!n)break;i.push(n.seq),n.eraseOperators(this.entity)}return this.entity.allStickyEffectOperators.length===t});c(this,"beforePush",t=>t.eraseOperators(this.entity))}}class Tl extends Kt{constructor(t,i,n,a,s,o,u,d){super(t,i,n,a,s,o);c(this,"isEffective");c(this,"beforeRemove",()=>{});c(this,"procTypes");c(this,"filter");c(this,"eraseOperators",t=>{if(!this.procTypes.includes("Effect"))return 0;console.log("ここはまだ通らない想定");const i=t.allStickyEffectOperators.filter(n=>n.isContinuous).filter(n=>!this.filter(n.effectOwner,n.isSpawnedBy,n.actionAttr,[])).map(n=>n.seq);return i.forEach(t.procFilterBundle.removeItem),i.forEach(t.statusOperatorBundle.removeItem),i.forEach(t.numericOprsBundle.removeItem),i.forEach(t.cardRelationBundle.removeItem),i.length});this.procTypes=u,this.filter=d,this.isEffective=!0}}const vn={level:1,rank:1,attack:0,defense:0,pendulumScaleR:0,pendulumScaleL:0};class bl extends Ir{constructor(){super(...arguments);c(this,"afterDistributeAll",t=>{if(this.bundles.forEach(n=>n.calcStateAll()),t.field.getMonstersOnField().flatMap(n=>n.numericOprsBundle).flatMap(n=>n.operators).some(n=>n.stateOperationType==="THE_DEVILS_AVATAR"||n.stateOperationType==="THE_DEVILS_DREAD-ROOT"||n.stateOperationType==="Gradius'_Option")){const a=t.field.getMonstersOnField().filter(s=>(s.atk??0)>=0).map(s=>s.atk??0).reduce((s,o)=>s>o?s:o,0);t.field.getMonstersOnField().forEach(s=>{let o;s.info.effectTargets["Gradius'_Option"]&&(o=s.info.effectTargets["Gradius'_Option"][0]),s.numericOprsBundle.operators.forEach(u=>{var d;if(!((d=s.status.monsterCategories)!=null&&d.includes("Link")&&u.targetState==="defense")){if(u.stateOperationType==="Gradius'_Option"){s.numericStatus.calculated[u.targetState]=(o==null?void 0:o.numericStatus.calculated[u.targetState])??0;return}if(u.stateOperationType==="THE_DEVILS_AVATAR"){s.numericStatus.calculated[u.targetState]=a+100;return}if(u.stateOperationType==="THE_DEVILS_DREAD-ROOT"){s.numericStatus.calculated[u.targetState]=u.calcValue(u.isSpawnedBy,s,s.numericStatus.calculated[u.targetState]??0);return}}})})}return!0})}}class Cl extends ei{constructor(){super(...arguments);c(this,"dominantOperators",{level:void 0,rank:void 0,attack:void 0,defense:void 0,pendulumScaleR:void 0,pendulumScaleL:void 0});c(this,"beforePush",t=>{if(t.stateOperationType==="THE_DEVILS_AVATAR"||t.stateOperationType==="Gradius'_Option")return;const i=this.entity.origin[t.targetState]??0,n=this.entity.numericStatus.origin[t.targetState]??0,a=this.entity.numericStatus.current[t.targetState]??0,s=this.entity.numericStatus.calculated[t.targetState]??0,o=this.dominantOperators[t.targetState];if(t.stateOperationType==="THE_DEVILS_DREAD-ROOT"){this.entity.numericStatus.calculated[t.targetState]=t.calcValue(t.isSpawnedBy,this.entity,s);return}if(t.stateOperationType==="Addition"){if(t.targetStateGen==="origin")throw new qe("ありえない組合せ",t);t.isContinuous||(this.entity.numericStatus.current[t.targetState]=t.calcValue(t.isSpawnedBy,this.entity,a)),this.entity.numericStatus.calculated[t.targetState]=t.calcValue(t.isSpawnedBy,this.entity,a);return}if(t.targetStateGen==="origin"){const u=t.calcValue(t.isSpawnedBy,this.entity,i);o&&!o.isContinuous&&o.targetStateGen!=="current"&&(this.entity.numericStatus.current[t.targetState]=u,this.dominantOperators[t.targetState]=void 0),this.entity.numericStatus.origin[t.targetState]=u,this.dominantOperators[t.targetState]=o??t}else t.isContinuous?(this.entity.numericStatus.current[t.targetState]=t.calcValue(t.isSpawnedBy,this.entity,n),this.dominantOperators[t.targetState]=t):(this.entity.numericStatus.current[t.targetState]=t.calcValue(t.isSpawnedBy,this.entity,s),this.dominantOperators[t.targetState]=t)});c(this,"calcStateAll",()=>sa.forEach(this.calcState));c(this,"calcState",t=>{if(this.entity.status.kind!=="Monster"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories){this.entity.numericStatus.calculated[t]=void 0;return}if(this.entity.status.monsterCategories.includes("Link")&&t!=="attack"){this.entity.numericStatus.calculated[t]=void 0;return}if(this.entity.status.monsterCategories.includes("Xyz")&&t==="level"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories.includes("Xyz")&&t==="rank"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories.includes("Pendulum")&&(t==="pendulumScaleL"||t==="pendulumScaleR")){this.entity.numericStatus.calculated[t]=void 0;return}if(t!=="level"&&!this.entity.isOnField){this.entity.numericStatus.origin[t]=this.entity.origin[t],this.entity.numericStatus.current[t]=this.entity.origin[t],this.entity.numericStatus.calculated[t]=this.entity.origin[t];return}const i=this._operators.filter(d=>d.targetState===t);if(i.some(d=>d.stateOperationType==="THE_DEVILS_AVATAR"||d.stateOperationType==="Gradius'_Option")&&this.entity.isEffective){this.entity.numericStatus.calculated[t]=-Number.MAX_VALUE;return}const n=this.dominantOperators[t],a=this.entity.numericStatus.origin[t]??0;let s=this.entity.numericStatus.current[t]??0,o=-1;n&&(n.targetStateGen==="current"&&n.isContinuous?(o=i.findLastIndex(d=>d.stateOperationType==="Fixation"&&d!==n),s=n.calcValue(n.isSpawnedBy,this.entity,a)):o=i.findIndex(d=>d===n)),o++;let u=s;if(o<i.length)for(let d=o;d<i.length;d++){const f=i[d];f.isContinuous&&f.targetStateGen==="current"&&f.stateOperationType==="Addition"&&(u=f.calcValue(f.isSpawnedBy,this.entity,u))}u<vn[t]&&(u=vn[t]),this.entity.numericStatus.calculated[t]=u})}}const Ut=class Ut extends Kt{constructor(t,i,n,a,s,o,u,d,f,p){super(t,i,n,a,s,o);c(this,"beforeRemove",()=>{});c(this,"targetState");c(this,"targetStateGen");c(this,"stateOperationType");c(this,"calcValue");this.targetState=u,this.targetStateGen=d,this.stateOperationType=f,this.calcValue=p}};c(Ut,"createContinuous",(t,i,n,a,s,o,u,d)=>new Ut(t,i,!0,n,{},a,s,o,u,d)),c(Ut,"createLingering",(t,i,n,a,s,o,u,d,f,p)=>new Ut(t,i,!1,n,s,o,u,d,f,()=>p));let at=Ut;const Hr=class Hr{constructor(e,t){c(this,"entity");c(this,"isRegular");c(this,"_isStarted");c(this,"info");c(this,"continuousEffectBase");c(this,"updateState",async()=>{if(this.hasToStart!==this.isStarted){if(this.isStarted){if(!this.info)throw new qe("illegal state");this._isStarted=!1,await this.continuousEffectBase.finish(this.entity,this.info),this.info=void 0;return}this.info=await this.continuousEffectBase.start(this.entity),this._isStarted=!0}});this._isStarted=!1,this.entity=e,this.continuousEffectBase=t,this.isRegular=this.executableCellTypes.every(i=>yr.find(n=>n===i))&&this.faceList.length===1&&this.faceList[0]==="FaceUp"}get isStarted(){return this._isStarted}get executableCellTypes(){return this.continuousEffectBase.executableCellTypes}get faceList(){return this.continuousEffectBase.faceList}get hasToStart(){return this.entity.info.isPending||!this.executableCellTypes.includes(this.entity.fieldCell.cellType)||!this.faceList.includes(this.entity.face)?!1:this.continuousEffectBase.canStart(this.entity)}};c(Hr,"createNew",(e,t)=>new Hr(e,t));let Ti=Hr;const El=(r,e,t,i,n)=>({title:r,executableCellTypes:e==="Monster"?["MonsterZone","ExtraMonsterZone"]:["FieldSpellZone","SpellAndTrapZone"],faceList:["FaceUp"],canStart:t,start:async a=>{const s=i(a);return s.forEach(n(a).push),s.map(o=>o.seq)},finish:async(a,s)=>{s.forEach(o=>n(a).removeItem(o))}}),ti=(r,e,t,i,n,a)=>(console.log(r,e,t,i,n,a),{title:r,executableCellTypes:e==="Monster"?["MonsterZone","ExtraMonsterZone"]:["FieldSpellZone","SpellAndTrapZone"],faceList:["FaceUp"],canStart:i,start:async s=>{const o=n(s),u=t(s);return console.info(`start : ${s.toString()} ⇒ ${u.map(d=>d.toString()).join(" ")} (${o.map(d=>d.title).join(" ")})`),u.map(a).forEach(d=>{console.log(d),o.forEach(d.push)}),{targets:u,seqList:o.map(d=>d.seq)}},finish:async(s,o)=>{o.targets.map(a).forEach(u=>o.seqList.forEach(d=>u.removeItem(d)))}}),Dl=(r,e,t,i,n)=>ti(r,e,t,i,n,a=>a.procFilterBundle),Rr=(r,e,t,i)=>El(r,e,t,i,n=>n.field.numericStateOperatorPool),ri=(r,e,t,i,n)=>ti(r,e,t,i,n,a=>a.numericOprsBundle),bi=(r,e,t,i)=>ti(r,e,n=>(console.log(r,n,n.info,n.info.effectTargets),n.info.effectTargets[r]),t,i,n=>n.cardRelationBundle),Al=(r,e,t,i,n)=>ti(r,e,t,i,n,a=>a.statusOperatorBundle);class xl extends Ir{constructor(){super(...arguments);c(this,"afterDistributeAll",()=>!0)}}class Ml extends ei{constructor(){super(...arguments);c(this,"beforePush",()=>{})}}const $r=class $r extends Kt{constructor(t,i,n,a,s,o,u,d,f){super(t,i,n,a,s,o);c(this,"relationType");c(this,"target");c(this,"beforeRemove");this.relationType=u,this.target=d,this.beforeRemove=()=>f(this)}};c($r,"createRegularEquipRelation",(t,i,n,a,s,o=()=>!0)=>new $r(t,i,!0,n,a,(u,d)=>(console.log(d),d.isOnField&&d.face==="FaceUp"&&s(u,d)),"Equip",n.info.effectTargets[t][0],u=>{console.log("beforeRemove",u.isSpawnedBy,u.target),o(u)&&(u.isSpawnedBy.isOnField&&!u.isSpawnedBy.info.isDying&&(u.isSpawnedBy.info.isDying=!0,u.isSpawnedBy.info.causeOfDeath=["RuleDestroy"],u.isSpawnedBy.duel.log.info(`装備対象${u.target.toString()}不在により${u.isSpawnedBy.toString()}は破壊された。`,u.effectOwner)),u.isSpawnedBy.info.effectTargets[t]=[])}));let sr=$r;class Pl{constructor(e){c(this,"entity");c(this,"_records");c(this,"pushForRuleAction",e=>{this._records.push({cell:this.entity.fieldCell,face:this.entity.face,orientation:this.entity.orientation,movedAt:this.entity.duel.clock.getClone(),movedAs:[...e,"Rule"]})});c(this,"push",(e,t,i,n)=>{this._records.push({cell:this.entity.fieldCell,face:this.entity.face,orientation:this.entity.orientation,movedAt:this.entity.duel.clock.getClone(),movedAs:e.getDistinct(),movedBy:t,actionOwner:i,chooser:n??i})});c(this,"pushByChainBlockInfo",(e,t)=>{this.push(t,e.action.entity,e.activator)});this.entity=e,this._records=[]}get records(){return this._records}get latestRecord(){return this._records.slice(-1)[0]}get previousPlaceRecord(){return this._records.findLast(e=>e.cell.cellType!==this.entity.fieldCell.cellType)??this._records[0]}get currentProcRecords(){return this._records.filter(e=>e.movedAt.totalProcSeq===this.entity.duel.clock.totalProcSeq)}}const Ci=["SpellCounter","KaijuCounter","NamelessCounter"],Ei=["①","②","③","④"],da=["CycleFlip"],Fl=[...Ci,...Ei,...da];class Bl{constructor(){c(this,"dic");c(this,"put",(e,t=1)=>{this.dic[e]=(this.dic[e]??0)+t});c(this,"setQty",(e,t=1)=>{this.dic[e]=t});c(this,"remove",(e,t=1)=>{this.dic[e]=(this.dic[e]??0)-t});c(this,"getQty",e=>this.dic[e]??0);c(this,"corpseDisposal",()=>{Ei.forEach(e=>delete this.dic[e]),da.forEach(e=>delete this.dic[e])});c(this,"removeAllActualCounters",()=>{Ci.forEach(e=>delete this.dic[e])});c(this,"removeAllWhenfaceDown",()=>{Ei.forEach(e=>delete this.dic[e]),Ci.forEach(e=>delete this.dic[e])});c(this,"clear",()=>{Fl.forEach(e=>delete this.dic[e])});this.dic={}}}class ql extends Ir{constructor(){super(...arguments);c(this,"afterDistributeAll",t=>t.field.getAllEntities().map(i=>i.statusOperatorBundle).every(i=>i.calcStatus))}}class Ol extends ei{constructor(){super(...arguments);c(this,"calcStatus",()=>{const t=this.entity.isEffective,i={...this.entity.status},n=this._operators.reduce((a,s)=>s.statusCalculator(s,a),i);return this.entity.status=n,this.entity.isEffective===t});c(this,"beforePush",()=>{})}}class Nl extends Kt{constructor(t,i,n,a,s,o,u){super(t,i,n,a,s,o);c(this,"beforeRemove",()=>{});c(this,"statusCalculator");this.statusCalculator=u}}const Rl={FusionSummon:"融合召喚",SyncroSummon:"シンクロ召喚",XyzSummon:"エクシーズ召喚",PendulumSummon:"ペンデュラム召喚",LinkSummon:"リンク召喚"},Ll={BattleDestroy:"戦闘破壊",EffectDestroy:"効果破壊",RuleDestroy:"ルール破壊"},ua=r=>r+"Summon",Hl=["Card","Token","Avatar"],Er=(r,e)=>{const t=r.monsterCategories??[],i=e.monsterCategories??[];for(const n of zt.toReversed()){if(t.includes(n)&&!i.includes(n))return 1;if(!t.includes(n)&&i.includes(n))return-1}if(r.kind===e.kind){if(r.kind==="Monster"){if((r.link??0)!==(e.link??0))return(r.link??0)-(e.link??0);if((r.rank??0)!==(e.rank??0))return(r.rank??0)-(e.rank??0);if((r.level??0)!==(e.level??0))return(r.level??0)-(e.level??0);if((r.attack??0)!==(e.attack??0))return(r.attack??0)-(e.attack??0);if((r.defense??0)!==(e.defense??0))return(r.defense??0)-(e.defense??0)}return r.name.localeCompare(e.name,"Ja")}for(const n of wi){if(r.kind===n)return-1;if(e.kind===n)return 1}return r.name.localeCompare(e.name,"Ja")},fa=(r,e)=>Er(r.origin,e.origin),ae=class ae{constructor(e,t,i,n,a,s){c(this,"seq");c(this,"origin");c(this,"entityType");c(this,"procFilterBundle");c(this,"numericOprsBundle");c(this,"cardRelationBundle");c(this,"statusOperatorBundle");c(this,"moveLog");c(this,"counterHolder");c(this,"face");c(this,"orientation");c(this,"owner");c(this,"fieldCell");c(this,"_status");c(this,"_numericStatus");c(this,"_info");c(this,"actions",[]);c(this,"continuousEffects",[]);c(this,"_hasDisappeared",!1);c(this,"toString",()=>`《${this.nm}》`);c(this,"setBattlePosition",async(e,t,i,n)=>{let a=`表示形式の変更：${this.toString()}（${this.battlePositionName}⇒${Tr[e]}）`;const s=[...t];this.battlePosition==="Set"&&(s.push("Flip"),t.includes("Rule")&&(a=`${this.toString()}を反転召喚`,s.push("FlipSummon"))),this.moveAlone(this.fieldCell,e==="Set"?"FaceDown":"FaceUp",e==="Attack"?"Vertical":"Horizontal","Top",s,i,n,n),this.duel.log.info(a,n)});c(this,"setNonFieldMonsterPosition",async(e,t,i,n)=>{this.moveAlone(this.fieldCell,e==="FaceUp"?"FaceUp":"FaceDown",e==="XysMaterial"?"Horizontal":"Vertical","Top",t,i,n,n)});c(this,"setAsSpellTrap",async(e,t,i,n)=>{await this.moveAlone(e,"FaceDown","Vertical","Top",[...t,"SpellTrapSet"],i,n,n)});c(this,"activateSpellTrapFromHand",async(e,t,i,n)=>{await this.moveAlone(e,"FaceUp","Vertical","Top",[...t,"SpellTrapActivate"],i,n,n)});c(this,"activateSpellTrapOnField",async(e,t,i)=>{await this.moveAlone(this.fieldCell,"FaceUp","Vertical","Top",[...e,"SpellTrapActivate"],t,i,i)});c(this,"draw",async(e,t,i)=>await this.addToHand([...e,"Draw"],t,i));c(this,"addToHand",async(e,t,i)=>await this.moveAlone(this.owner.getHandCell(),"FaceDown","Vertical","Bottom",[...e],t,i,i));c(this,"release",async(e,t,i)=>(await this.sendToGraveyard([...e,"Release"],t,i),this.info.isVanished?void 0:this.fieldCell));c(this,"sendToGraveyard",(e,t,i)=>ae.sendManyToGraveyardForTheSameReason([this],e,t,i));c(this,"returnToDeck",(e,t,i,n)=>ae.returnManyToDeckForTheSameReason(e,[this],t,i,n));c(this,"banish",(e,t,i)=>ae.banishManyForTheSameReason([this],e,t,i));c(this,"summon",(e,t,i,n,a,s,o)=>ae.summonMany([{entity:this,to:e,chooser:o??s,pos:t}],i,n,a,s));c(this,"moveAlone",async(e,t,i,n,a,s,o,u)=>(await ae.moveMany([[this,e,t,i,n,a,s,o,u]],void 0),this.fieldCell));c(this,"_move",async(e,t,i,n,a,s,o,u)=>{if(!e)throw new Error("illegal argument: to");if(this.face=t,this.orientation=i,this.field.duel.clock.turn>0&&await this.field.duel.view.waitAnimation({entity:this,to:e,index:n,count:0}),e!==this.fieldCell){if(this.fieldCell.releaseEntities([this]),this.fieldCell.isPlayFieldCell&&!e.isPlayFieldCell&&(this.counterHolder.clear(),this.resetCauseOfDeath(),this.entityType==="Token")){this._hasDisappeared=!0,this.field.duel.log.info(`${this.nm}は消滅した。`,this.controller);return}e.acceptEntities([this],n),(e===this.isBelongTo||e.cellType==="Hand"||e.cellType==="Banished"&&this.face==="FaceDown")&&(this.resetInfo(),this.resetStatus())}return this.moveLog.push(a,s,o,u),e});c(this,"initForTurn",()=>{this.info.isSettingSickness=!1,this.info.attackCount=0,this.info.battlePotisionChangeCount=0,this.counterHolder.corpseDisposal()});c(this,"resetInfo",()=>{var e;this._info={isDying:!1,isPending:!1,isEffective:!0,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,isVanished:!1,isRebornable:((e=this.origin.monsterCategories)==null?void 0:e.union(aa).length)===0||(this.origin.canReborn??!1),isSettingSickness:!1,materials:[],effectTargets:{},willBeBanished:!1,willReturnToDeck:void 0,attackCount:0,battlePotisionChangeCount:0},this.counterHolder.clear()});c(this,"resetStatus",()=>{const e=sa.reduce((t,i)=>(t[i]=this.origin[i],t),{});this._numericStatus={origin:{...e},current:{...e},calculated:{...e}},this._status={...this.origin,canAttack:!0,isEffective:!0,canDirectAttack:!1,isSelectableForAttack:!0,allowHandSyncro:!1,maxCounterQty:{}}});c(this,"resetCauseOfDeath",()=>{this.info.isDying=!1,this.info.causeOfDeath=[],this.info.isKilledBy=void 0,this.info.isKilledByWhom=void 0});this.seq=ae.nextEntitySeq++,this.counterHolder=new Bl,this.owner=e,this.fieldCell=t,this.entityType=i,this.origin=n,this._status=JSON.parse(JSON.stringify(n)),this._numericStatus=JSON.parse(JSON.stringify(n)),this.resetStatus(),this._info={isEffective:!0,attackCount:0,battlePotisionChangeCount:0,isDying:!1,isPending:!1,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,isVanished:!1,isRebornable:!0,isSettingSickness:!1,materials:[],effectTargets:{},willBeBanished:!1,willReturnToDeck:void 0},this.resetInfo(),this.face=a,this.orientation=s,this.procFilterBundle=new kl(t.field.procFilterPool,this),this.numericOprsBundle=new Cl(t.field.numericStateOperatorPool,this),this.cardRelationBundle=new Ml(t.field.cardRelationPool,this),this.statusOperatorBundle=new Ol(t.field.statusOperatorPool,this),t.acceptEntities([this],"Top"),this.moveLog=new Pl(this),this.moveLog.pushForRuleAction(["Spawn"])}get isUnderControl(){return this.face==="FaceUp"||la.every(e=>e!==this.fieldCell.cellType)}get controller(){return this.fieldCell.owner??this.owner}get field(){return this.owner.duel.field}get duel(){return this.owner.duel.field.duel}get status(){return this._status}set status(e){console.log(e),this._status={...e}}get numericStatus(){return this._numericStatus}get info(){return this._info}get nm(){return this.status.name}get atk(){return this._numericStatus.calculated.attack}get def(){return this._numericStatus.calculated.defense}get lvl(){return this._numericStatus.calculated.level}get rank(){return this._numericStatus.calculated.rank}get attr(){return this.status.attributes??[]}get types(){return this.status.types??[]}get psL(){return this._numericStatus.calculated.pendulumScaleL}get psR(){return this._numericStatus.calculated.pendulumScaleR}get isEffective(){return this.status.isEffective&&this.info.isEffective}get isNagatedStrongly(){return!this.info.isEffective}get battlePosition(){if(this.isOnField&&this.status.kind==="Monster")return this.orientation==="Vertical"?"Attack":this.face==="FaceUp"?"Defense":"Set"}get battlePositionName(){const e=this.battlePosition;if(e)return Tr[e]}get wasMovedAtCurrentProc(){return this.field.duel.clock.totalProcSeq===this.moveLog.latestRecord.movedAt.totalProcSeq&&this.moveLog.records.slice(-2)[0].cell.cellType!==this.fieldCell.cellType}get wasMovedAtPreviousProc(){return this.field.duel.clock.totalProcSeq===this.moveLog.latestRecord.movedAt.totalProcSeq+1&&this.moveLog.records.slice(-2)[0].cell.cellType!==this.fieldCell.cellType}get wasMovedAtCurrentChain(){return this.field.duel.clock.isSameChain(this.moveLog.latestRecord.movedAt)&&this.moveLog.records.slice(-2)[0].cell.cellType!==this.fieldCell.cellType}get wasMovedAtPreviousChain(){return this.field.duel.clock.isPreviousChain(this.moveLog.latestRecord.movedAt)&&this.moveLog.records.slice(-2)[0].cell.cellType!==this.fieldCell.cellType}get wasMovedFrom(){return this.moveLog.previousPlaceRecord.cell}get isOnField(){return yr.some(e=>e===this.fieldCell.cellType)}get isLikeContinuousSpell(){return this.status.spellCategory==="Continuous"||this.status.spellCategory==="Field"||this.status.spellCategory==="Equip"||this.status.trapCategory==="Continuous"}get isBelongTo(){return this.origin.monsterCategories&&this.origin.monsterCategories.union(zt).length?this.owner.getExtraDeck():this.owner.getDeckCell()}get hasDisappeared(){return this._hasDisappeared}get allStickyEffectOperators(){return[...this.procFilterBundle.operators,...this.numericOprsBundle.operators,...this.cardRelationBundle.operators]}};c(ae,"nextEntitySeq",0),c(ae,"splitBattlePos",e=>({face:e==="Set"?"FaceDown":"FaceUp",orientation:e==="Attack"?"Vertical":"Horizontal"})),c(ae,"recreateArray",(e,t)=>{if(!t.length)return[];const i=e.getAllCells().flatMap(n=>n.entities);return t.map(n=>n.seq).map(n=>i.find(a=>a.seq===n)).filter(n=>n!==void 0)}),c(ae,"createPlayerEntity",e=>{const t=e.getHandCell();return new ae(e,t,"Duelist",{name:e.profile.name,kind:"Monster",wikiEncodedName:"%A5%D7%A5%EC%A5%A4%A5%E4%A1%BC"},"FaceUp","Vertical")}),c(ae,"createCardEntity",(e,t)=>{var u;const i=t.monsterCategories&&t.monsterCategories.union(zt).length?e.getExtraDeck():e.getDeckCell(),n=new ae(e,i,"Card",al(t),"FaceDown","Vertical");Object.hasOwn(Ue,n.origin.name)||e.duel.log.info(`未実装カード${t.name}がデッキに投入された。`,e);const a=Ue[n.origin.name];let s=[],o=[];if(a.kind==="Monster"&&((u=a.monsterCategories)!=null&&u.includes("Normal")))s=[Le,Fe,Be];else{const d=Di.get(n.origin.name);d&&(s=d.actions,o=d.continuousEffects??[])}return n.actions.push(...s.map(d=>wt.createNew(n,d))),n.continuousEffects.push(...o.map(d=>Ti.createNew(n,d))),n}),c(ae,"waitCorpseDisposal",e=>ae.sendManyToGraveyard(e.field.getEntiteisOnField().filter(t=>t.info.isDying).map(t=>({entity:t,causedAs:t.info.causeOfDeath??[],causedBy:t.info.isKilledBy,activator:t.info.isKilledByWhom})))),c(ae,"sendManyToGraveyardForTheSameReason",(e,t,i,n)=>ae.bringManyToSameCellForTheSameReason("Graveyard","Top",e,"FaceUp","Vertical",t,i,n)),c(ae,"banishManyForTheSameReason",(e,t,i,n)=>ae.bringManyToSameCellForTheSameReason("Banished","Top",e,"FaceDown","Vertical",t,i,n)),c(ae,"returnManyToDeckForTheSameReason",(e,t,i,n,a)=>ae.bringManyToSameCellForTheSameReason("Deck",e,t,"FaceDown","Vertical",i,n,a)),c(ae,"returnManyToHandForTheSameReason",(e,t,i,n)=>ae.bringManyToSameCellForTheSameReason("Hand","Bottom",e,"FaceDown","Vertical",t,i,n)),c(ae,"sendManyToGraveyard",(e,t)=>ae.bringManyToSameCell("Graveyard","Top",e.map(i=>({...i,face:"FaceUp",orientation:"Vertical"})),t)),c(ae,"banishMany",(e,t)=>ae.bringManyToSameCell("Banished","Top",e.map(i=>({...i,face:"FaceUp",orientation:"Vertical"})),t)),c(ae,"bringManyToSameCellForTheSameReason",(e,t,i,n,a,s,o,u)=>ae.bringManyToSameCell(e,t,i.map(d=>({entity:d,face:n,orientation:a,causedAs:s,causedBy:o,activator:u})))),c(ae,"bringManyToSameCell",(e,t,i,n)=>ae.moveMany(i.map(a=>[a.entity,a.entity.field.getCells(e).filter(s=>s.owner===a.entity.owner)[0],a.face,a.orientation,t,a.causedAs,a.causedBy,a.activator,a.activator]),n)),c(ae,"moveMany",async(e,t)=>{if(!e.length)return;const i=e[0][0].duel,n=e.map(([o])=>o).filter(o=>!(t??[]).includes(o)),a=[...n,...i.field.getEntiteisOnField().filter(o=>o.info.isDying)];console.log(n);const s=new Map;for(e.forEach(([o,u,d,f,p,...y])=>{let l=u,h=d,m=p,_=f;o.info.willBeBanished&&(console.log(o),l=o.owner.getBanished(),h="FaceUp",_="Vertical"),o.info.willReturnToDeck&&(l=o.isBelongTo,h="FaceDown",m=o.info.willReturnToDeck,_="Vertical"),o.isBelongTo.cellType==="ExtraDeck"&&(l.cellType==="Hand"||l.cellType==="Deck")&&(l=o.isBelongTo,h="FaceDown",_="Vertical"),s.set(l,[[o,l,h,_,m,...y],...s.get(l)??[]])});;){const o=Array.from(s.values()).map(d=>d.pop()).filter(d=>d!==void 0).map(([d,...f])=>d._move(...f));if(!o.length)break;await Promise.all(o),i.field.cardRelationPool.excludesExpired();const u=i.field.getEntiteisOnField().filter(d=>d.info.isDying).filter(d=>!a.includes(d)).map(d=>({entity:d,causedAs:d.info.causeOfDeath??[],causedBy:d.info.isKilledBy,activator:d.info.isKilledByWhom}));u.length&&await ae.sendManyToGraveyard(u,a)}ae.settleEntityMove(i)}),c(ae,"summonMany",async(e,t,i,n,a)=>{if(!e.length)return;const s={Attack:"AttackSummon",Defense:"DefenseSummon",Set:"SetSummon"};await Promise.all(e.map(async({entity:o,to:u,pos:d,chooser:f})=>{if(t==="NormalSummon"||t==="AdvanceSummon"){const l=t==="AdvanceSummon"?"アドバンス":"";d==="Attack"?o.field.duel.log.info(`${o.toString()}を${l}召喚`,f):o.duel.log.info(`${o.toString()}を${l}セット`,f),i.includes("Rule")?f.info.ruleNormalSummonCountQty++:f.info.effectNormalSummonCountQty++}else t==="SpecialSummon"?o.duel.log.info(`${o.toString()}を${Tr[d]}で特殊召喚`,f):o.duel.log.info(`${o.toString()}を${Tr[d]}で${Rl[t]}！`,f),f.info.specialSummonCountQty++;o.info.battlePotisionChangeCount=1;const{face:p,orientation:y}=ae.splitBattlePos(d);await o._move(u,p,y,"Top",[t,s[d],...i],n,a,f)})),e.map(o=>o.chooser).forEach(o=>{t==="NormalSummon"||t==="AdvanceSummon"?i.includes("Rule")?o.info.ruleNormalSummonCount++:o.info.effectNormalSummonCount++:o.info.specialSummonCount++}),ae.settleEntityMove(e[0].entity.duel)}),c(ae,"settleEntityMove",e=>{e.distributeOperators(e.clock.totalProcSeq);const t=e.field.getAllEntities().filter(i=>i.wasMovedAtCurrentProc);t.filter(i=>!i.isOnField).forEach(i=>i.resetInfo()),t.flatMap(i=>i.continuousEffects).forEach(i=>i.updateState())});let ge=ae;class pn{constructor(e,t,i,n,a){c(this,"duel");c(this,"seat");c(this,"_entity");c(this,"profile");c(this,"deckInfo");c(this,"info");c(this,"infoOrigin");c(this,"status");c(this,"statusOrigin");c(this,"duelistType");c(this,"lifeLog");c(this,"_lp");c(this,"initForDrawPhase",()=>{this.info={...this.infoOrigin}});c(this,"canSummon",(e,t,i,n,a,s)=>this.entity.procFilterBundle.operators.filter(o=>o.procTypes.some(u=>u===n)).every(o=>o.filter(e,t,i,s))?a.filter(o=>this.entity.procFilterBundle.operators.filter(u=>u.procTypes.some(d=>d===ua(o))).every(u=>u.filter(e,t,i,s))):[]);c(this,"battleDamage",(e,t)=>this.setLp(this._lp-e,t,"BattleDamage"));c(this,"effectDamage",(e,t)=>this.setLp(this._lp-e,t,"EffectDamage"));c(this,"lostLp",(e,t)=>this.setLp(this._lp-e,t,"Lost"));c(this,"payLp",(e,t)=>this.setLp(this._lp-e,t,"Pay"));c(this,"heal",(e,t)=>this.setLp(this._lp+e,t,"Heal"));c(this,"setLp",(e,t,i)=>{const n={clock:this.duel.clock,reason:i||"Set",beforeLp:this._lp,afterLp:e,entity:t};return this.lifeLog.push(n),this._lp=e,this.duel.log.info(`ライフポイント変動：${n.afterLp-n.beforeLp}（${n.beforeLp} ⇒ ${n.afterLp}）`,this),n});c(this,"getOpponentPlayer",()=>this.duel.firstPlayer===this?this.duel.secondPlayer:this.duel.firstPlayer);c(this,"getHandCell",()=>this.duel.field.getCells("Hand").filter(e=>e.owner===this)[0]);c(this,"getDeckCell",()=>this.duel.field.getCells("Deck").filter(e=>e.owner===this)[0]);c(this,"getExtraDeck",()=>this.duel.field.getCells("ExtraDeck").filter(e=>e.owner===this)[0]);c(this,"getGraveyard",()=>this.duel.field.getCells("Graveyard").filter(e=>e.owner===this)[0]);c(this,"getFieldZone",()=>this.duel.field.getCells("FieldSpellZone").filter(e=>e.owner===this)[0]);c(this,"getBanished",()=>this.duel.field.getCells("Banished").filter(e=>e.owner===this)[0]);c(this,"getMonsterZones",()=>this.duel.field.getCells("MonsterZone").filter(e=>e.owner===this));c(this,"getExtraMonsterZones",()=>this.duel.field.getCells("ExtraMonsterZone").filter(e=>{var t;return((t=e.cardEntities[0])==null?void 0:t.controller)===this}));c(this,"getSpellTrapZones",()=>this.duel.field.getCells("SpellAndTrapZone").filter(e=>e.owner===this));c(this,"getEmptyMonsterZones",()=>this.getMonsterZones().filter(e=>e.cardEntities.length===0));c(this,"getEmptyExtraZones",()=>this.getExtraMonsterZones().length===0?this.getMonsterZones().filter(e=>e.cardEntities.length===0):[]);c(this,"getAvailableMonsterZones",()=>this.getMonsterZones().filter(e=>e.isAvailable));c(this,"getAvailableExtraZones",()=>this.getExtraMonsterZones().length===0?this.duel.field.getCells("ExtraMonsterZone").filter(e=>e.isAvailable):[]);c(this,"getAvailableSpellTrapZones",()=>this.getSpellTrapZones().filter(e=>e.isAvailable));c(this,"getReleasableMonsters",()=>this.getMonstersOnField());c(this,"getMonstersOnField",()=>this.duel.field.getMonstersOnField().filter(e=>e.controller===this));c(this,"getEntiteisOnField",()=>this.duel.field.getEntiteisOnField().filter(e=>e.controller===this));c(this,"getAttackTargetMonsters",()=>this.duel.field.getMonstersOnField().filter(e=>e.status.isSelectableForAttack&&e.controller!==this));c(this,"pushDeck",()=>{this.deckInfo.cardNames.map(e=>Ue[e]).filter(e=>e).forEach(e=>ge.createCardEntity(this,e)),this.duel.log.info(`デッキをセット。メイン${this.getDeckCell().cardEntities.length}枚。エクストラ${this.getExtraDeck().cardEntities.length}枚。`,this)});c(this,"draw",async(e,t,i)=>{var s;if(e<1)return;const n=this.getDeckCell(),a=[];for(const o of Array(e)){if(!n.cardEntities.length)throw this.duel.log.info(a.length>0?`デッキからカードを${e}枚ドローしようとしたが、${a.length}枚しかドローできなかった。${a}`:"デッキからカードをドローできなかった。",this),this.duel.isEnded=!0,this.setLp(0),new Et(this.getOpponentPlayer());const u=n.cardEntities[0];await u.draw(t?["Effect"]:["Rule"],t,i),console.log(u),a.push(((s=u.origin)==null?void 0:s.name)||"!名称取得失敗!")}this.duel.log.info(`デッキからカードを${a.length}枚ドロー。${a}。`,this)});c(this,"shuffleDeck",()=>{this.getDeckCell().shuffle(),this.duel.log.info("デッキをシャッフル。",this)});c(this,"discard",async(e,t,i,n,a,s)=>{const o=a||(()=>!0),u=this.getHandCell().cardEntities.filter(o);if(u.length<e)return[];let d=[];return(n||this).duelistType==="NPC"?d=u.randomPickMany(e):d=await this.duel.view.waitSelectEntities(n||this,u,e,f=>f.length===e,`${e}枚カードを捨てる。`,!1)||[],await ge.sendManyToGraveyardForTheSameReason(d,["Discard",...t],i,s),this.duel.log.info(`手札からカードを${d.length}枚捨てた。${d.map(f=>{var p;return(p=f.origin)==null?void 0:p.name})}。`,this),d});c(this,"summon",async(e,t,i,n,a,s,o=!1)=>{let u=t.randomPick(),d=i.randomPick();if((i.length>1||t.length>1)&&this.duelistType!=="NPC"){const f=i.length>1?"カードを召喚先へドラッグ。":"表示形式を選択。",p=t.map(m=>wt.createDammyAction(e,m,i,m)),y=this.duel.view.modalController.selectAction(this.duel.view,{title:f,actions:p,cancelable:!1}),l=this.duel.view.waitSubAction(this,p,f,o).then(m=>m.action),h=await Promise.any([y,l]);if(!h&&!o)throw new qe("",h);if(!h)return;d=h.cell||d,u=h.pos||u}return console.log(d,u,n,a,s),await e.summon(d,u,n,a,s,this),e});c(this,"selectActionForNPC",e=>{let t=e.filter(i=>i.entity.status.kind==="Spell").randomPick();if(t||this.duel.phase==="main2"&&this.getAvailableSpellTrapZones.length>1&&(t=e.filter(i=>i.playType==="SpellTrapSet").filter(i=>i.entity.status.kind!=="Spell"||i.entity.status.spellCategory==="QuickPlay").randomPick(),t))return t});this.duel=e,this.seat=t,this.profile=i,this.duelistType=n,this.deckInfo=a,this.lifeLog=[],this.infoOrigin={maxRuleNormalSummonCount:1,ruleNormalSummonCount:0,ruleNormalSummonCountQty:0,effectNormalSummonCount:0,effectNormalSummonCountQty:0,specialSummonCount:0,specialSummonCountQty:0},this.info={...this.infoOrigin},this.statusOrigin={maxSpecialSummonCount:Number.MAX_VALUE,canDrawByEffect:!0,canSearchFromDeck:!0,canDiscardAsCost:!0,canDiscardAsEffect:!0},this.status={...this.statusOrigin},this._lp=8e3}get entity(){const e=this.getHandCell().entities.find(t=>t.entityType==="Duelist");return e||ge.createPlayerEntity(this)}get lp(){return this._lp}get isTurnPlayer(){return this.duel.getTurnPlayer()===this}get canDraw(){return!0}get canAddToHandFromDeck(){return!0}}class $l{constructor(e){c(this,"cells");c(this,"duel");c(this,"procFilterPool");c(this,"numericStateOperatorPool");c(this,"cardRelationPool");c(this,"statusOperatorPool");c(this,"getAllCells",()=>this.cells.flat());c(this,"getCells",(...e)=>this.getAllCells().filter(t=>e.includes(t.cellType)));c(this,"getAllEntities",()=>this.getAllCells().map(e=>e.entities).flat());c(this,"getAllCardEntities",()=>this.getAllCells().map(e=>e.cardEntities).flat());c(this,"getMonstersOnField",()=>this.getCells(...Nr).map(e=>e.cardEntities).filter(e=>e.length>0).map(e=>e[0]));c(this,"getEntiteisOnField",()=>this.getCells(...yr).map(e=>e.cardEntities).filter(e=>e.length>0).map(e=>e[0]));c(this,"getEntities",e=>this.getAllEntities().filter(t=>t.controller===e));c(this,"drawAtSameTime",async(e,t,i,n,a,s)=>{const o=[],u=[],d=[e.draw(t,a,s),i.draw(n,a,s)].map(f=>f.catch(p=>{p instanceof Et?p.winner&&o.push(p.winner):u.push(p)}));if(await Promise.all(d),u.length)throw new qe("ドロー処理で想定されない例外が発生した。",e,t,i,n,a,...u);if(o.length!==0)throw o.length===1?new Et(o[0]):new Et});c(this,"sendToGraveyard",async(e,t,i,n,a,s,o,u)=>{if(n>0&&i.length<n)return;const d=await this.duel.view.waitSelectEntities(t,i,n,a,e,u);if(d)return await ge.sendManyToGraveyard(d.map(f=>({entity:f,causedAs:s,causedBy:o,activator:t}))),this.duel.log.info(`${d.map(f=>f.status.name).join(", ")}を墓地に送った（${s.getDistinct().join(", ")}）。`,t),d});c(this,"release",async(e,t,i,n,a,s,o,u)=>{if(i>0&&t.length<i)return;const d=await this.duel.view.waitSelectEntities(e,t,i,p=>(o||p.length>0)&&(i<0||p.length===i),"リリースするモンスターを選択",u);if(!d)return;const f=[];for(const p of d)await p.release(["Release",n,...a],s,e),f.push(p);return this.duel.log.info(`${f.map(p=>p.status.name).join(", ")}をリリース（${f.flatMap(p=>p.moveLog.latestRecord.movedAs).getDistinct().join(", ")}）。`,e),f});c(this,"activateSpellTrapFromHand",async(e,t,i,n,a,s=!1)=>{const o=a??(n==null?void 0:n.controller)??e.controller;let u=t.randomPick();if(t.length>1&&o.duelistType!=="NPC"){const d=[wt.createDammyAction(e,"カードの発動",t,void 0)];this.duel.view.modalController.selectAction(this.duel.view,{title:"カードを魔法罠ゾーンへドラッグ",actions:d,cancelable:!1});const f=await this.duel.view.waitSubAction(o,d,"カードを魔法罠ゾーンへドラッグ。",s),p=f.action;if(!p&&!s)throw new qe("",f);if(!p)return;u=p.cell||u}return await e.activateSpellTrapFromHand(u,i,n,o),e});c(this,"setSpellTrap",async(e,t,i,n,a=!1)=>{let s=t[0];const o=n??(i==null?void 0:i.controller)??e.controller;if(t.length>1&&o.duelistType!=="NPC"){const u=[wt.createDammyAction(e,"セット",t)],d=this.duel.view.modalController.selectAction(this.duel.view,{title:"カードをセット先へドラッグ",actions:u,cancelable:a}),f=this.duel.view.waitSubAction(o,u,"カードをセット先へドラッグ",a),p=await Promise.any([d,f.then(y=>y.action)]);if(!p&&!a)throw new qe("",p);if(!p)return;s=p.cell||s}return await e.setAsSpellTrap(s,["SpellTrapSet"],i,o),this.duel.log.info(`${e.status.name}をセット（SpellTrapSet）。`,n??(i==null?void 0:i.controller)??e.controller),s});this.duel=e,this.cells=[...Array(7)].map(()=>[]);for(const t of Object.keys(ki).map(Number))for(const i of Object.keys(ki[t]).map(Number))this.cells[t][i]=new ll(this,t,i,t<3?e.duelists.Above:t>3?e.duelists.Below:i===0?e.duelists.Above:i===6?e.duelists.Below:void 0);this.procFilterPool=new wl,this.numericStateOperatorPool=new bl,this.cardRelationPool=new xl,this.statusOperatorPool=new ql}}let Ul=class{constructor(e){c(this,"onUpdateEvent",new Ge);c(this,"nextSeq");c(this,"records",[]);c(this,"duel");c(this,"dispose",()=>{this.onUpdateEvent.clear()});c(this,"error",e=>{console.error(e);const t=["エラー発生"];e instanceof Error?(e instanceof qe&&(t.push("-- エラーメッセージ --"),t.push(e.message),t.push("-- 関連オブジェクト --"),e.items.forEach(i=>t.push(JSON.stringify(i)))),t.push("-- エラー名称 --"),t.push(e.name||"エラー名称取得失敗"),t.push("-- スタックトレース --"),t.push(e.stack||"スタックトレース取得失敗")):(t.push("-- エラー型特定失敗 --"),t.push(JSON.stringify(e))),this.info(t)});c(this,"info",(e,t)=>{const i=Array.isArray(e)?e.join(`
`):e;this.records.push({seq:this.nextSeq++,turn:this.duel.clock.turn,phase:this.duel.phase,phaseStep:this.duel.phaseStep,clock:this.duel.clock,duelist:t,text:i}),this.onUpdateEvent.trigger()});this.nextSeq=0,this.duel=e}get onUpdate(){return this.onUpdateEvent.expose()}};const hn=["DuelEntitiesSelector","DuelActionSelector","DuelTextSelector"];class Zl{constructor(e){c(this,"onUpdateEvent",new Ge);c(this,"states");c(this,"view");c(this,"cancelAll",()=>{hn.forEach(e=>this.states[e]="Disable"),console.info(this,"cancelAll"),this.onUpdateEvent.trigger()});c(this,"duelEntitiesSelectorArg",{title:"対象を選択",entities:[],validator:()=>!0,qty:-1,cancelable:!1});c(this,"duelEntitiesSelectorValue");c(this,"duelEntitiesSelectorResolve",()=>{});c(this,"selectDuelEntities",async e=>(this.duelEntitiesSelectorArg=e,this.states.DuelEntitiesSelector="Shown",this.onUpdateEvent.trigger(),new Promise(t=>{this.duelEntitiesSelectorResolve=i=>{this.states.DuelEntitiesSelector="Disable",this.onUpdateEvent.trigger(),t(i)}})));c(this,"cardActionSelectorArg",{title:"カード操作を選択。",actions:[],cancelable:!1});c(this,"cardActionSelectorResolve",()=>{});c(this,"cardActionSelectorValue");c(this,"selectAction",async(e,t)=>(this.cardActionSelectorArg=t,this.states.DuelActionSelector="Shown",e.onWaitEnd.append(this.cancelAll),this.onUpdateEvent.trigger(),new Promise(i=>{this.cardActionSelectorResolve=n=>{console.log(n),this.states.DuelActionSelector="Disable",e.onWaitEnd.remove(this.cancelAll),this.onUpdateEvent.trigger(),i(n)}})));c(this,"duelTextSelectorArg",{title:"カード操作を選択。",choises:[],cancelable:!1});c(this,"duelTextSelectorResolve",()=>{});c(this,"duelTextSelectorValue");c(this,"selectText",async(e,t)=>(this.duelTextSelectorArg=t,this.states.DuelTextSelector="Shown",e.onWaitEnd.append(this.cancelAll),this.onUpdateEvent.trigger(),new Promise(i=>{this.duelTextSelectorResolve=n=>{console.log(n),this.states.DuelTextSelector="Disable",e.onWaitEnd.remove(this.cancelAll),this.onUpdateEvent.trigger(),i(n)}})));this.view=e,this.states=hn.reduce((t,i)=>(t[i]="Disable",t),{})}get onUpdate(){return this.onUpdateEvent.expose()}}const jl=r=>new Promise(e=>setTimeout(e,r)),Gl=()=>{let r=()=>{},e=()=>{};return{promise:new Promise((i,n)=>{r=i,e=n}),resolve:r,reject:e}};class Vl{constructor(e){c(this,"onDuelUpdateEvent",new Ge);c(this,"requireUpdate",()=>{this.onDuelUpdateEvent.trigger()});c(this,"onWaitStartEvent",new Ge);c(this,"onWaitEndEvent",new Ge);c(this,"onDragStartEvent",new Ge);c(this,"onDragEndEvent",new Ge);c(this,"onAnimationStartEvent",new Ge);c(this,"onShowCardEntityEvent",new Ge);c(this,"duel");c(this,"modalController");c(this,"message");c(this,"waitMode");c(this,"infoBoardState");c(this,"infoBoardCell");c(this,"removeSvelteInfo",e=>{const t={...e};return t.selectedEntities&&(t.selectedEntities=ge.recreateArray(this.duel.field,t.selectedEntities)),t});c(this,"getCell",(e,t)=>this.duel.field.cells[e][t]);c(this,"showCardInfo",(e,t)=>{this.onShowCardEntityEvent.trigger({card:e,mode:t})});c(this,"dispose",()=>{this.onDragStartEvent.clear(),this.onDragEndEvent.clear(),this.onDuelUpdateEvent.clear(),this.onWaitStartEvent.clear(),this.onWaitEndEvent.clear()});c(this,"waitFieldAction",async(e,t)=>{if(console.log(e),this.duel.getTurnPlayer().duelistType==="NPC"){const i=e.toSorted((n,a)=>(a.entity.atk||0)-(n.entity.atk||0)).find(n=>n.playType==="NormalSummon"||n.playType==="SpecialSummon"||n.playType==="CardActivation");return i?{action:i}:{phaseChange:this.duel.nextPhaseList[0]}}return await this._waitDuelistAction(e,"SelectFieldAction",t)});c(this,"waitQuickEffect",async(e,t,i,n)=>{if(t.length===0)return;if(e.duelistType==="NPC")return e.selectActionForNPC(t);const a=[];return a.push(this.modalController.selectAction(this,{title:i,actions:t,cancelable:n}).then(s=>s&&s)),a.push(this._waitDuelistAction(t,"SelectAction",this.message).then(s=>(this.infoBoardState="Log",s.action))),await Promise.any(a)});c(this,"waitSubAction",async(e,t,i,n=!1)=>{if(e.duelistType==="NPC")throw Error("Not implemented");return await this._waitDuelistAction(t,"SelectAction",i,void 0,void 0,void 0,n)});c(this,"waitSelectEntities",async(e,t,i,n,a,s=!1)=>{let o=[];if(i&&t.length===i)return[...t];if(e.duelistType==="NPC"){for(;!n(o);){const d=i&&i>0?i:Math.floor(Math.random()*t.length)+1;o=t.randomPickMany(d)}return o}this.waitMode=t.every(d=>(d.fieldCell.cellType==="MonsterZone"||d.fieldCell.cellType==="ExtraMonsterZone")&&d.getIndexInCell()===0||d.fieldCell.cellType==="Hand"&&d.controller===e)?"SelectFieldEntities":"SelectEntities",console.log(this.waitMode);const u=await this._waitDuelistAction([],this.waitMode,a,t,i,n,s);return console.log(u),u.selectedEntities});c(this,"_waitDuelistAction",async(e,t,i,n,a,s,o=!1)=>{this.waitMode=t,this.message=i,this.onDuelUpdateEvent.trigger();const u=Gl(),d={resolve:u.resolve,enableActions:e,qty:a,entitiesValidator:s||(()=>!1),selectableEntities:n||[]};n&&s&&this.waitMode==="SelectEntities"&&(d.duelEntitiesSelectorArg={title:i,entities:n,validator:s,qty:a??-1,cancelable:!1}),this.onWaitStartEvent.trigger(d);const f=await u.promise;if(console.log(f),this.waitMode="None",this.onWaitEndEvent.trigger(),f.surrender)throw new Et(this.duel.duelists.Above);if(!o&&f.cancel)throw new qe("キャンセル不可のアクションがキャンセルされた。",f,e,t,n);return this.infoBoardState="Log",this.removeSvelteInfo(f)});c(this,"waitSelectSummonDest",async(e,t,i,n)=>{const a=t.length>1?"カードを召喚先へドラッグ。":"表示形式を選択。",s=i.map(f=>wt.createDammyAction(e,f,t,f)),o=this.modalController.selectAction(e.field.duel.view,{title:a,actions:s,cancelable:!1}),u=this.waitSubAction(e.controller,s,a,n).then(f=>f.action),d=await Promise.any([o,u]);if(!d&&!n)throw new qe("キャンセル不可のアクションがキャンセルされた。",d);if(d){if(!d.cell)throw new qe("召喚先のセルが指定されなかった。",d);if(!d.pos)throw new qe("表示形式が指定されなかった。",d);return{dest:d.cell,pos:d.pos}}});c(this,"waitSelectText",async(e,t,i=!1)=>this.duel.view.modalController.selectText(this.duel.view,{title:t,choises:e,cancelable:i}));c(this,"waitAnimation",async e=>(this.onDuelUpdateEvent.trigger(),new Promise(t=>this.onAnimationStartEvent.trigger({...e,resolve:t}))));c(this,"setDraggingActions",e=>{this.onDragStartEvent.trigger(e),this.requireUpdate()});c(this,"removeDraggingActions",()=>{this.onDragEndEvent.trigger()});this.duel=e,this.message="",this.waitMode="None",this.infoBoardState="Log",this.infoBoardCell=e.duelists.Below.getExtraDeck(),this.modalController=new Zl(this)}get onDuelUpdate(){return this.onDuelUpdateEvent.expose()}get onWaitStart(){return this.onWaitStartEvent.expose()}get onWaitEnd(){return this.onWaitEndEvent.expose()}get onDragStart(){return this.onDragStartEvent.expose()}get onDragEnd(){return this.onDragEndEvent.expose()}get onAnimation(){return this.onAnimationStartEvent.expose()}get onShowCardEntity(){return this.onShowCardEntityEvent.expose()}}class Yl{constructor(){c(this,"onTotalProcSeqChangeEvent",new Ge);c(this,"_turn",0);c(this,"_phaseSeq",0);c(this,"_stepSeq",0);c(this,"_chainSeq",0);c(this,"_chainBlockSeq",0);c(this,"_procSeq",0);c(this,"_procTotalSeq",0);c(this,"incrementTurn",()=>{this._turn++,this._phaseSeq=0,this._stepSeq=0,this._chainSeq=0,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq()});c(this,"incrementPhaseSeq",()=>{this._phaseSeq++,this._stepSeq=0,this._chainSeq=0,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq()});c(this,"incrementStepSeq",()=>{this._stepSeq++,this._chainSeq=0,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq()});c(this,"incrementChainSeq",()=>{this._chainSeq++,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq()});c(this,"incrementChainBlockSeq",()=>{this._chainBlockSeq++,this._procSeq=0,this.incrementTotalProcSeq()});c(this,"incrementProcSeq",()=>{this._procSeq++,this.incrementTotalProcSeq()});c(this,"incrementTotalProcSeq",()=>{this._procTotalSeq++,this.onTotalProcSeqChangeEvent.trigger(this.totalProcSeq)});c(this,"toString",()=>`${this.totalProcSeq}(t${this.turn}-p${this.phaseSeq}-ps${this.stepSeq}-c${this.chainSeq}-cb${this.chainBlockSeq}-p${this.procSeq})`);c(this,"getClone",()=>({turn:this.turn,phaseSeq:this.phaseSeq,stepSeq:this.stepSeq,chainSeq:this.chainSeq,chainBlockSeq:this.chainBlockSeq,procSeq:this.procSeq,totalProcSeq:this.totalProcSeq}));c(this,"isSameChain",e=>this.turn===e.turn&&this.phaseSeq===e.phaseSeq&&this.stepSeq===e.stepSeq&&this.chainSeq===e.chainSeq);c(this,"isPreviousChain",e=>this.turn===e.turn&&this.phaseSeq===e.phaseSeq&&this.stepSeq===e.stepSeq&&this.chainSeq===e.chainSeq+1);c(this,"isPreviousProc",e=>this.totalProcSeq===e.totalProcSeq+1)}get onTotalProcSeqChange(){return this.onTotalProcSeqChangeEvent.expose()}get turn(){return this._turn}get phaseSeq(){return this._phaseSeq}get stepSeq(){return this._stepSeq}get chainSeq(){return this._chainSeq}get chainBlockSeq(){return this._chainBlockSeq}get procSeq(){return this._procSeq}get totalProcSeq(){return this._procTotalSeq}}class Wl{constructor(e){c(this,"nextSeq");c(this,"records",[]);c(this,"duel");c(this,"push",(e,t)=>{this.records.push({seq:this.nextSeq++,clock:this.duel.clock.getClone(),activator:e,cardAction:t})});this.nextSeq=0,this.duel=e}}class Et extends Error{constructor(t){const i=t?`デュエルが終了した。勝者：${t.profile.name}`:"デュエルが終了した。ドロー。";super(i);c(this,"winner");this.winner=t}}class qe extends Error{constructor(t,...i){super(t);c(this,"message");c(this,"items");this.message=t,this.items=i}}class Dt extends qe{constructor(...e){super("キャンセル不可のアクションがキャンセルされた。",...e)}}class zl{constructor(e,t,i,n,a,s){c(this,"view");c(this,"log");c(this,"cardActionLog");c(this,"clock");c(this,"phase");c(this,"phaseStep");c(this,"nextPhaseList");c(this,"field");c(this,"attackingMonster");c(this,"targetForAttack");c(this,"_chainBlockInfos");c(this,"duelists");c(this,"priorityHolder");c(this,"isEnded");c(this,"coin",!1);c(this,"distributeOperators",e=>{console.info(`[totalProcSeq]:${e}`);let t=0;for(;;){if(t++,t>10)throw new qe("無限ループ発生");if(this.field.procFilterPool.distributeAll(this)&&this.field.statusOperatorPool.distributeAll(this)&&this.field.cardRelationPool.distributeAll(this)&&this.field.numericStateOperatorPool.distributeAll(this))return}});c(this,"getTurnPlayer",()=>this.clock.turn%2===0?this.secondPlayer:this.firstPlayer);c(this,"getNonTurnPlayer",()=>this.clock.turn%2===0?this.firstPlayer:this.secondPlayer);c(this,"main",async(e=Math.random()>.5,t=[],i=[])=>{console.info("main start!"),this.coin=e,this.priorityHolder=this.firstPlayer,this.log.info("【デュエル開始】"),this.log.info(`先攻：${this.firstPlayer.profile.name}`),Object.values(this.duelists).forEach(a=>a.pushDeck()),Object.values(this.duelists).forEach(a=>a.shuffleDeck()),[{hand:t,duelist:this.duelists.Below},{hand:i,duelist:this.duelists.Above}].forEach(a=>{a.hand.length&&a.hand.forEach(s=>{const o=a.duelist.getDeckCell().cardEntities.find(u=>u.origin.name===s);if(!o){this.log.info(`初手操作により${s}を手札に加えようとしたが、デッキに存在しない。`);return}o.addToHand(["System"],void 0,void 0),this.log.info(`初手操作により${o.toString()}を手札に加えた`,a.duelist)})}),await Promise.all(Object.values(this.duelists).map(a=>a.draw(5-a.getHandCell().cardEntities.length,void 0,void 0))),this.moveNextPhase("draw"),this.view.requireUpdate();try{for(;!this.isEnded&&(this.phase==="draw"?await this.procDrawPhase():this.phase==="standby"?await this.procStanbyPhase():this.phase==="main1"?await this.procMainPhase():this.phase==="battle"?await this.procBattlePhase():this.phase==="main2"?await this.procMainPhase():this.phase==="end"&&await this.procEndPhase(),!(this.clock.turn>1e3)););}catch(a){a instanceof Et?(console.info(a),this.isEnded=!0,this.log.info(a.winner?`デュエル終了。勝者${a.winner.profile.name}`:"引き分け")):a instanceof Error&&this.log.error(a)}finally{this.view.requireUpdate(),this.view.dispose(),this.log.dispose()}});c(this,"moveNextPhase",e=>{this.clock.turn<1?this.phase="draw":e==="draw"?this.log.info("ターン終了。",this.getTurnPlayer()):this.log.info(`フェイズ移行（${this.phase}→${e}）`,this.getTurnPlayer()),e==="draw"?this.clock.incrementTurn():this.clock.incrementPhaseSeq(),this.phase=e,this.phaseStep=void 0,this.phase==="main2"||this.clock.turn===1?this.nextPhaseList=["end"]:this.phase==="battle"?this.nextPhaseList=["main2"]:this.phase==="main1"?this.nextPhaseList=["battle","end"]:this.nextPhaseList=[]});c(this,"declareAnAttack",(e,t)=>{this.attackingMonster=e,this.targetForAttack=t,e.info.attackCount++,this.log.info(`攻撃宣言：${e.status.name} ⇒ ${t.status.name}`,e.controller)});c(this,"procDrawPhase",async()=>{for(Object.values(this.duelists).forEach(e=>e.initForDrawPhase()),this.log.info("ドローフェイズ開始。",this.getTurnPlayer()),this.clock.turn===1?this.log.info("先攻プレイヤーはドローできない。",this.getTurnPlayer()):await this.getTurnPlayer().draw(1,void 0,void 0);await this.procChainBlock(void 0,void 0););this.field.getEntiteisOnField().forEach(e=>e.initForTurn()),this.moveNextPhase("standby")});c(this,"procStanbyPhase",async()=>{for(;await this.procChainBlock(void 0,void 0););this.moveNextPhase("main1")});c(this,"procMainPhase",async()=>{for(;;){this.priorityHolder=this.getTurnPlayer();const e=await this.view.waitFieldAction(this.getEnableActions(["NormalSummon","SpellTrapSet","SpecialSummon","ChangeBattlePosition","IgnitionEffect","QuickEffect","CardActivation"],["Normal","Quick","Counter"],[]),"あなたの手番です。");if(console.log(e),e&&e.action){if([...ol].includes(e.action.playType)){console.log("is not chainable",e);const i=await e.action.prepare(e.action.cell,[],!0);if(i===void 0)continue;await e.action.execute(i,this.chainBlockInfos),this.clock.incrementChainSeq()}else console.log("is chainable",e),await this.procChainBlock(e.action,void 0);for(;await this.procChainBlock(void 0,void 0););continue}const t=e.phaseChange;if(t){this.priorityHolder=this.getNonTurnPlayer();const i=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(["QuickEffect","TriggerEffect"],["Quick","Counter"],[]),"",!0);if(i){for(await this.procChainBlock(i,void 0);await this.procChainBlock(void 0,void 0););continue}this.moveNextPhase(t);return}}});c(this,"procBattlePhase",async()=>{await this.procBattlePhaseStartStep(),await this.procBattlePhaseBattleStep(),await this.procBattlePhaseEndStep()});c(this,"procBattlePhaseStartStep",async()=>{for(this.phaseStep="start",this.priorityHolder=this.getTurnPlayer(),this.attackingMonster=void 0,this.targetForAttack=void 0;await this.procChainBlock(void 0,void 0););});c(this,"procBattlePhaseBattleStep",async()=>{for(;;){this.phaseStep="battle",this.priorityHolder=this.getTurnPlayer();const e=await this.view.waitFieldAction(this.getEnableActions(["Battle"],["Normal"],[]),"攻撃モンスターと対象を選択。");if(e.phaseChange)break;if(e.action){const t=await e.action.prepare(e.action.cell,[],!0);if(!t)continue;for(await e.action.execute(t,[]),this.clock.incrementChainSeq();await this.procChainBlock(void 0,void 0););this.clock.incrementStepSeq(),await this.procBattlePhaseDamageStep(t)}}this.clock.incrementStepSeq()});c(this,"procBattlePhaseDamageStep",async e=>{this.phaseStep="damage";const t=this.attackingMonster,i=this.targetForAttack;if(!t||t.atk===void 0)throw new qe("想定されない状態",this.attackingMonster,this.targetForAttack);if(!i)throw new qe("想定されない状態",this.attackingMonster,this.targetForAttack);this.log.info("ダメージステップ開始時",this.getTurnPlayer()),this.log.info("ダメージ計算前",this.getTurnPlayer()),(i==null?void 0:i.battlePosition)==="Set"&&i.setBattlePosition("Defense",["Flip","FlipByBattle"],t,t.controller),this.log.info("ダメージ計算時",this.getTurnPlayer());const n=t.atk,a=(i.battlePosition==="Attack"?i.atk:i.def)??0;i.entityType==="Duelist"?t.controller.getOpponentPlayer().battleDamage(n-a,t):(n>0&&n>a&&i.battlePosition==="Attack"?t.controller.getOpponentPlayer().battleDamage(n-a,t):n<a&&t.controller.battleDamage(a-n,i),n>0&&(n>a||n===a&&i.battlePosition==="Attack")&&i.tryDestory("BattleDestroy",t.controller,t,e.action),i.battlePosition==="Attack"&&n<=a&&t.tryDestory("BattleDestroy",t.controller,i,e.action));const s=Object.values(this.duelists).filter(o=>o.lp<=0);if(s.length>0)throw new Et(Object.values(this.duelists).filter(o=>!s.includes(o)).pop());for(await ge.waitCorpseDisposal(this),this.clock.incrementChainSeq(),this.log.info("ダメージ計算後",this.getTurnPlayer());await this.procChainBlock(void 0,void 0););this.log.info("ダメージステップ終了時",this.getTurnPlayer()),this.clock.incrementStepSeq()});c(this,"procBattlePhaseEndStep",async()=>{for(this.phaseStep="end",this.priorityHolder=this.getTurnPlayer();await this.procChainBlock(void 0,void 0););this.moveNextPhase("main2")});c(this,"procEndPhase",async()=>{for(;await this.procChainBlock(void 0,void 0););for(;;){const t=this.getTurnPlayer().getHandCell().cardEntities.length;if(t<7)break;await this.getTurnPlayer().discard(t-6,["Rule"])}this.moveNextPhase("draw")});c(this,"procChainBlock",async(e,t)=>{const i=this.clock.chainBlockSeq===0;let n=t??Object.values(this.duelists).flatMap(o=>(this.priorityHolder=o,this.getEnableActions(["TriggerMandatoryEffect","TriggerEffect"],["Normal"],[]))),a=!1,s;if(e)s=e,a=!0;else if(n.length>0){const o=await this.selectTriggerEffect(n);o&&(n=n.filter(u=>u!==o),s=o,a=!0)}if(!a){let o=0;for(;o<2;){this.priorityHolder=this.priorityHolder.getOpponentPlayer();const u=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(["QuickEffect","CardActivation"],["Quick","Counter"],this.chainBlockInfos),"クイックエフェクト発動タイミング。効果を発動しますか？",!0);if(u){s=u,a=!0;break}o++}}if(console.info("selected action: ",s),s){const o=s.entity.controller,u=this.clock.chainBlockSeq+1;this.log.info(`チェーン${u}: ${Tt(s)}を発動`,o);const d=await s.prepare(s.cell,this.chainBlockInfos,!1);if(!d)throw new Dt(s);const f=d.action.entity.isNagatedStrongly&&yr.find(p=>p===d.isActivatedIn.cellType);if(d.selectedEntities.length&&this.log.info(`対象⇒${d.selectedEntities.map(p=>p.toString()).join(" ")}`),this._chainBlockInfos.push(d),console.log(this.chainBlockInfos),this.clock.incrementProcSeq(),this.clock.incrementChainBlockSeq(),await this.procChainBlock(void 0,n.filter(p=>p.seq!==(s==null?void 0:s.seq))),this.log.info(`チェーン${u}: ${Tt(s)}の効果処理。`,o),console.log(d),d.isNegatedActivationBy)this.log.info(`チェーン${u}: ${Tt(s)}を${Tt(d.isNegatedActivationBy)}によって発動を無効にした。`,d.activator);else{let p=d.action.entity.isEffective,y=`チェーン${u}: カードの効果が無効となっているため${Tt(s)}の効果処理を行えない。`;if(p){if(d.isNegatedEffectBy)y=`チェーン${u}: ${Tt(s)}を${Tt(d.isNegatedEffectBy)}によって効果を無効にした。`,p=!1;else if(f){const l=d.action.entity.moveLog.records.findLast(h=>h.face==="FaceDown"&&h.orientation==="Horizontal");p=(l&&this.clock.isSameChain(l.movedAt))??!1}}p?await s.execute(d,this.chainBlockInfos):this.log.info(y,d.activator),await s.settle(d,this.chainBlockInfos)}this.clock.incrementProcSeq(),i&&(await ge.sendManyToGraveyardForTheSameReason(this._chainBlockInfos.filter(p=>p.action.playType==="CardActivation").filter(p=>!p.action.isLikeContinuousSpell).map(p=>p.action.entity).filter(p=>p.isOnField).filter(p=>p.face==="FaceUp").filter(p=>!p.isLikeContinuousSpell),["Rule"],void 0,void 0),this._chainBlockInfos.reset(),this.clock.incrementChainSeq())}return a});c(this,"selectTriggerEffect",async e=>{if(e.length>0)for(const t of["TriggerMandatoryEffect","TriggerEffect"])for(const i of[this.getTurnPlayer(),this.getNonTurnPlayer()]){this.priorityHolder=i;const n=e.filter(s=>s.playType===t&&s.entity.controller===i);if(n.length===0)continue;if(n.length===1&&t==="TriggerMandatoryEffect")return console.log(n[0]),n[0];const a=await this.view.waitQuickEffect(this.priorityHolder,n,"効果を選択。",t==="TriggerEffect");if(a)return a}});c(this,"getEnableActions",(e,t,i)=>{let n=this.field.getAllCardEntities().filter(a=>a.controller===this.priorityHolder).flatMap(a=>a.actions).filter(a=>a.executableCells.includes(a.entity.fieldCell.cellType)).filter(a=>e.includes(a.playType)).filter(a=>t.includes(a.spellSpeed));return this.phaseStep==="damage"&&(n=n.filter(a=>a.canExecuteOnDamageStep)),n.filter(a=>a.validate(i))});this.phase="end",this.clock=new Yl,this.nextPhaseList=[],this.isEnded=!1,this.duelists={Below:new pn(this,"Below",e,t,i),Above:new pn(this,"Above",n,a,s)},this.priorityHolder=this.firstPlayer,this._chainBlockInfos=[],this.field=new $l(this),this.clock.onTotalProcSeqChange.append(this.distributeOperators),this.view=new Vl(this),this.log=new Ul(this),this.cardActionLog=new Wl(this)}get chainBlockInfos(){return this._chainBlockInfos}get firstPlayer(){return this.coin?this.duelists.Below:this.duelists.Above}get secondPlayer(){return this.coin?this.duelists.Above:this.duelists.Below}}ge.prototype.hasBeenSummonedNow=function(r,e=["Attack","Defense"]){const t=this,i=e.map(ua),n=t.moveLog.latestRecord.movedAs;return!(!t.wasMovedAtPreviousChain||!n.union(r).length||!n.union(i).length)};ge.prototype.canBeEffected=function(r,e,t){return this.procFilterBundle.operators.filter(n=>n.procTypes.some(a=>a==="Effect")).every(n=>n.filter(r,e,t,[this]))};ge.prototype.canBeTargetOfEffect=function(r,e,t){return this.procFilterBundle.operators.filter(n=>n.procTypes.some(a=>a==="EffectTarget")).every(n=>n.filter(r,e,t,[this]))};ge.prototype.canBeSpecialSummoned=function(r,e,t,i){var a,s;const n=this;return(a=n.origin.monsterCategories)!=null&&a.includes("NormalSummonOnly")||(s=n.origin.monsterCategories)!=null&&s.includes("SpecialSummon")&&!n.status.canReborn&&!n.info.isRebornable&&(n.fieldCell.cellType==="Graveyard"||this.fieldCell.cellType==="Banished")?!1:n.procFilterBundle.operators.filter(o=>o.procTypes.some(u=>u==="SpecialSummon"||u===r)).every(o=>o.filter(e,t,i,[n]))};ge.prototype.canBeTargetOfBattle=function(r,e){const t=this;return t.procFilterBundle.operators.filter(i=>i.procTypes.some(n=>n==="BattleTarget")).every(i=>i.filter(r,e,{},[t]))};ge.prototype.tryDestory=function(r,e,t,i){const n=this;return console.log(n),n.info.isDying=n.procFilterBundle.operators.filter(a=>a.procTypes.includes(r)).every(a=>a.filter(e,t,i??{},[n])),n.info.isDying&&(n.duel.log.info(`${n.toString()}を${Ll[r]}`,t.controller),n.info.causeOfDeath=[r],n.info.isKilledBy=t,n.info.isKilledByWhom=t.controller),n.info.isDying};ge.prototype.canBeMaterials=function(r,e,t){return this.procFilterBundle.operators.filter(n=>n.procTypes.some(a=>a===r)).every(n=>n.filter(e.entity.controller,e.entity,e,t))};ge.prototype.getIndexInCell=function(){const r=this;if(r.info.isVanished)return-1;const e=r.fieldCell.cardEntities.indexOf(r);if(e<0)throw new qe("エンティティとセルの状態が矛盾している。",[r,r.fieldCell]);return e};const Kl=()=>{const r=[];["サイバー・ドラゴン","六武衆のご隠居","アンノウン・シンクロン"].forEach(f=>r.push({name:f,actions:[Le,Fe,Be,{title:"特殊召喚",playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],isOnlyNTimesPerDuel:f==="アンノウン・シンクロン"?1:void 0,validate:p=>{const y=p.entity.field.getMonstersOnField();if(!(y.length==0||y.some(l=>l.controller===p.entity.controller)))return cn(p,["Attack","Defense"],[])},prepare:(p,y,l,h)=>dn(p,y,["Attack","Defense"],[],h),execute:un,settle:async()=>!0}]}));const e={name:"ジャンク・フォアード",actions:[Le,Fe,Be,{title:"特殊召喚",playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],validate:f=>{if(f.entity.controller.getAvailableMonsterZones().length)return cn(f,["Attack","Defense"],[])},prepare:(f,p,y,l)=>dn(f,p,["Attack","Defense"],[],l),execute:un,settle:async()=>!0}]};r.push(e);const t={name:"Ｄ－ＨＥＲＯ ディアボリックガイ",actions:[Le,Fe,Be,{title:"①リクルート",playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],validate:f=>f.entity.controller.getDeckCell().cardEntities.filter(y=>y.nm==="Ｄ－ＨＥＲＯ ディアボリックガイ").length===0?void 0:f.entity.controller.getAvailableMonsterZones().length>0?[]:void 0,prepare:async f=>(await f.entity.banish(["Cost"],f.entity,f.entity.controller),{selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async f=>{const p=f.activator.getAvailableMonsterZones();if(!p.length)return!1;const y=f.activator.getDeckCell().cardEntities.find(l=>l.nm==="Ｄ－ＨＥＲＯ ディアボリックガイ");return y?(await f.activator.summon(y,["Attack","Defense"],p,"SpecialSummon",["Effect"],f.action.entity,!1),!0):!1},settle:async()=>!0}]};r.push(t);const i={name:"ゾンビキャリア",actions:[Le,Fe,Be,{title:"①自己再生",playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],validate:f=>f.entity.controller.getHandCell().cardEntities.length===0?void 0:f.entity.controller.getAvailableMonsterZones().length>0?[]:void 0,prepare:async f=>{const p=f.entity.controller.getHandCell().cardEntities,y=await f.entity.controller.duel.view.waitSelectEntities(f.entity.controller,p,1,l=>l.length===1,"デッキトップに戻すカードを一枚選択。");if(!y)throw new Dt(f);return await y[0].returnToDeck("Top",["Cost"],f.entity,f.entity.controller),{selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}},execute:async f=>{if(f.action.entity.wasMovedAtCurrentChain)return!1;const p=f.action.entity.controller.getAvailableMonsterZones();return p.length===0?!1:(await f.activator.summon(f.action.entity,["Attack","Defense"],p,"SpecialSummon",["Effect"],f.action.entity,!1),f.action.entity.info.willBeBanished=!0,!0)},settle:async()=>!0}]};r.push(i);const n={name:"グローアップ・バルブ",actions:[Le,Fe,Be,{title:"①自己再生",playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],isOnlyNTimesPerDuel:1,validate:f=>f.entity.controller.getDeckCell().cardEntities.length===0?void 0:f.entity.controller.getAvailableMonsterZones().length>0?[]:void 0,prepare:async f=>(await f.entity.controller.getDeckCell().cardEntities[0].sendToGraveyard(["Cost"],f.entity,f.entity.controller),{selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:async f=>{if(f.action.entity.wasMovedAtCurrentChain)return!1;const p=f.action.entity.controller.getAvailableMonsterZones();return p.length===0?!1:(await f.activator.summon(f.action.entity,["Attack","Defense"],p,"SpecialSummon",["Effect"],f.action.entity),!0)},settle:async()=>!0}]};r.push(n);const a={name:"終末の騎士",actions:[Le,Fe,Be,{title:"①墓地送り",playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],canExecuteOnDamageStep:!0,validate:f=>{if(!f.entity.hasBeenSummonedNow(["NormalSummon","SpecialSummon"])){console.log("piyo");return}if(f.entity.controller.getDeckCell().cardEntities.filter(p=>p.attr.includes("Dark")).length===0){console.log("piyo");return}return[]},prepare:async f=>{const p=["SendToGraveyardFromDeck"];return f.entity.moveLog.latestRecord.movedAs.includes("NormalSummon")?p.push("IfNormarlSummonSucceed"):p.push("IfSpecialSummonSucceed"),{selectedEntities:[],chainBlockTags:p,prepared:void 0}},execute:async f=>{const p=f.action.entity.controller.getDeckCell().cardEntities.filter(y=>y.attr.includes("Dark"));return p.length===0?!1:(await f.action.entity.field.sendToGraveyard("墓地に送るモンスターを選択",f.activator,p,1,y=>y.length===1,["Effect"],f.action.entity,!1),f.activator.shuffleDeck(),!0)},settle:async()=>!0}]};r.push(a);const s={name:"マスマティシャン",actions:[Le,Fe,Be,{title:"①墓地送り",playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],validate:f=>{if(f.entity.hasBeenSummonedNow(["NormalSummon"])&&f.entity.controller.getDeckCell().cardEntities.find(p=>(p.lvl??5)<5))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["IfNormarlSummonSucceed","SendToGraveyardFromDeck"],prepared:void 0}),execute:async f=>{const p=f.activator.getDeckCell().cardEntities.filter(y=>(y.lvl??5)<5);return p.length===0?!1:(await f.action.entity.field.sendToGraveyard("墓地に送るモンスターを選択",f.activator,p,1,y=>y.length===1,["Effect"],f.action.entity,!1),f.activator.shuffleDeck(),!0)},settle:async()=>!0},{title:"②ドロー",playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],canExecuteOnDamageStep:!0,validate:f=>{if(f.entity.face!=="FaceDown"&&f.entity.moveLog.latestRecord.movedAs.includes("BattleDestroy")&&f.entity.wasMovedAtPreviousChain&&f.entity.controller.getDeckCell().cardEntities.length!==0)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async f=>(await f.activator.draw(1,f.action.entity,f.activator),!0),settle:async()=>!0}]};r.push(s);const o={name:"ライトロード・ビースト ウォルフ",actions:[Fe,Be,{title:"①自己再生",playType:"TriggerMandatoryEffect",spellSpeed:"Normal",executableCells:["Graveyard"],validate:f=>{if(f.entity.wasMovedAtPreviousChain&&f.entity.wasMovedFrom.cellType==="Deck")return f.entity.controller.getAvailableMonsterZones().length>0?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:async f=>{if(f.action.entity.wasMovedAtCurrentChain)return!1;const p=f.action.entity.controller.getAvailableMonsterZones();return!p.length||f.action.entity.fieldCell.cellType!=="Graveyard"&&f.action.entity.fieldCell.cellType!=="Banished"||f.action.entity.face==="FaceDown"?!1:(await f.activator.summon(f.action.entity,["Attack","Defense"],p,"SpecialSummon",["Effect"],f.action.entity),!0)},settle:async()=>!0}]};r.push(o);const u={name:"伝説の白石",actions:[Fe,Be,Le,{title:"①サーチ",playType:"TriggerMandatoryEffect",spellSpeed:"Normal",executableCells:["Graveyard"],validate:f=>{if(f.entity.wasMovedAtPreviousChain&&f.entity.wasMovedFrom.cellType!=="Banished")return f.entity.controller.getDeckCell().cardEntities.find(p=>p.nm==="青眼の白龍")?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async f=>{const p=f.activator.getDeckCell().cardEntities.find(y=>y.nm==="青眼の白龍");return p?(await p.addToHand(["Effect"],f.action.entity,f.activator),f.activator.shuffleDeck(),!0):!1},settle:async()=>!0}]};return r.push(u),[{name:"灰流うらら",chainBlockTags:["Draw","SearchFromDeck","SendToGraveyardFromDeck","SpecialSummonFromDeck"]},{name:"屋敷わらし",chainBlockTags:["BanishFromGraveyard","SpecialSummonFromGraveyard","AddToHandFromGraveyard"]}].forEach(f=>{r.push({name:f.name,actions:[Fe,Be,Le,{title:"①無効化",playType:"QuickEffect",spellSpeed:"Quick",executableCells:["Hand"],isOnlyNTimesPerTurn:1,validate:(p,y)=>{if(y.length===0)return;const l=y.slice(-1)[0];return console.log(l),l.chainBlockTags.union(f.chainBlockTags).length>0?[]:void 0},prepare:async(p,y,l)=>(await p.entity.sendToGraveyard(["Discard","Cost"],p.entity,p.entity.controller),{selectedEntities:[],chainBlockTags:["NegateCardEffect"],prepared:l.length}),execute:async(p,y)=>{const l=y[p.prepared-1];return l.isNegatedEffectBy=p.action,!0},settle:async()=>!0}]})}),["翻弄するエルフの剣士","ロードランナー","氷結界の修験者"].forEach(f=>{r.push({name:f,actions:[Fe,Be,Le],continuousEffects:[Dl("①戦闘破壊耐性","Monster",p=>[p],()=>!0,p=>[new Tl("①戦闘破壊耐性",()=>!0,!0,p,{},()=>!0,["BattleDestroy"],(y,l)=>(console.log("hoge"),!p.isEffective||(console.log("hoge"),(l.atk??0)<1900)?(console.log("hoge"),!0):(console.log("hoge"),p.duel.log.info(`${p.toString()}は攻撃力1900以上のモンスターとの先頭では破壊されない。`,p.controller),!1)))])]})}),r},Ql=r=>{if(r.entity.status.spellCategory==="Field")return[r.entity.controller.getFieldZone()];const e=r.entity.controller.getAvailableSpellTrapZones();return e.length>0?e:void 0},Jl=async(r,e)=>{if(r.entity.status.spellCategory==="Field"){const n=r.entity.controller.getFieldZone(),a=n.cardEntities[0];return await ge.sendManyToGraveyardForTheSameReason(n.cardEntities,["Rule"],r.entity,r.entity.controller),r.entity.field.duel.log.info(`フィールド魔法の上書きにより、${a.toString()}は墓地に送られた。`,r.entity.controller),{selectedEntities:[],chainBlockTags:[],prepared:{dest:n}}}if(e)return{selectedEntities:[],chainBlockTags:[],prepared:{dest:e}};const t=r.entity.controller.getAvailableSpellTrapZones();if(t.length===0)return;let i=t[0];if(t.length>1&&r.entity.controller.duelistType!=="NPC"){const n=[wt.createDammyAction(r.entity,"セット",t)],a=r.entity.field.duel.view.modalController.selectAction(r.entity.field.duel.view,{title:"カードをセット先へドラッグ",actions:n,cancelable:!0}),s=r.entity.field.duel.view.waitSubAction(r.entity.controller,n,"カードをセット先へドラッグ",!0),o=await Promise.any([a,s.then(u=>u.action)]);if(!o)return;i=o.cell||i}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:i}}},Xl=async r=>(await r.action.entity.setAsSpellTrap(r.prepared.dest,["Rule","SpellTrapSet"],r.action.entity,r.activator),r.activator.duel.log.info(`${r.action.entity.status.name}をセット（SpellTrapSet）。`,r.activator),r.action.entity.info.isSettingSickness=r.action.entity.status.kind==="Trap"||r.action.entity.status.spellCategory==="QuickPlay",!0),be={title:"セット",playType:"SpellTrapSet",spellSpeed:"Normal",executableCells:["Hand"],validate:Ql,prepare:Jl,execute:Xl,settle:async()=>!0},Ce=r=>{if(r.entity.info.isPending||r.entity.info.isDying||r.entity.info.isSettingSickness)return;if(Ft.some(t=>t===r.entity.fieldCell.cellType))return r.entity.face==="FaceDown"?[]:void 0;if(!r.entity.controller.isTurnPlayer)return;if(r.entity.status.spellCategory==="Field")return[r.entity.controller.getFieldZone()];const e=r.entity.controller.getAvailableSpellTrapZones();return e.length>0?e:void 0},Ee=async(r,e,t,i,n,a,s)=>{if(Ft.some(o=>o===r.entity.fieldCell.cellType)&&r.entity.face==="FaceDown")return await r.entity.setNonFieldMonsterPosition("FaceUp",["Rule"]),{chainBlockTags:n??[],selectedEntities:a??[],prepared:s};if(r.entity.status.spellCategory==="Field"){const o=r.entity.controller.getFieldZone().cardEntities;if(o.length){const u=o[0];await ge.sendManyToGraveyardForTheSameReason(r.entity.controller.getFieldZone().cardEntities,["Rule"],r.entity,r.entity.controller),r.entity.controller.duel.log.info(`フィールド魔法の上書きにより、${u.toString()}は墓地に送られた。`,r.entity.controller)}}if(r.entity.fieldCell.cellType==="Hand"){const o=["SpellTrapActivate"],u=e?[e]:r.entity.status.spellCategory==="Field"?[r.entity.controller.getFieldZone()]:r.entity.controller.getAvailableSpellTrapZones();return await r.entity.field.activateSpellTrapFromHand(r.entity,u,o,r.entity,r.entity.controller,i),{chainBlockTags:n??[],selectedEntities:a??[],prepared:s}}},Il=()=>{const r=[],e={name:"強欲な壺",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],validate:l=>{if(!(l.entity.controller.getDeckCell().cardEntities.length<2)&&l.entity.controller.canDraw&&l.entity.controller.canAddToHandFromDeck)return Ce(l)},prepare:(l,h,m,_)=>Ee(l,h,m,_,["Draw","SearchFromDeck"],[],void 0),execute:async l=>(await l.activator.draw(2,l.action.entity,l.activator),!0),settle:async()=>!0},be]};r.push(e);const t={name:"貪欲な壺",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],validate:l=>{if(!(l.entity.controller.getGraveyard().cardEntities.filter(h=>h.status.kind==="Monster").filter(h=>h.canBeTargetOfEffect(l.entity.controller,l.entity,l)).length<5)&&l.entity.controller.canDraw&&l.entity.controller.canAddToHandFromDeck)return Ce(l)},prepare:async(l,h,m,_)=>{const T=await l.entity.field.duel.view.waitSelectEntities(l.entity.controller,l.entity.controller.getGraveyard().cardEntities.filter(w=>w.status.kind==="Monster").filter(w=>w.canBeTargetOfEffect(l.entity.controller,l.entity,l)),5,w=>w.length===5,"デッキに戻すモンスターを選択。",!1);if(T)return Ee(l,h,m,_,["Draw","SearchFromDeck","ReturnToDeckFromGraveyard"],T,void 0)},execute:async l=>l.selectedEntities.some(h=>h.wasMovedAtCurrentChain)?!1:(await ge.returnManyToDeckForTheSameReason("Random",l.selectedEntities,["Effect"],l.action.entity,l.activator),l.action.entity.field.getCells("Deck").filter(h=>h.needsShuffle).forEach(h=>h.shuffle()),await l.activator.draw(2,l.action.entity,l.activator),!0),settle:async()=>!0},be]};r.push(t);const i={name:"天使の施し",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],validate:l=>{if(!(l.entity.controller.getDeckCell().cardEntities.length<3))return Ce(l)},prepare:(l,h,m)=>Ee(l,h,m,!1,["Draw","SearchFromDeck","DiscordAsEffect"],[],void 0),execute:async l=>(await l.activator.draw(3,l.action.entity,l.activator),await l.activator.discard(2,["Effect","Discard"],l.action.entity,l.activator),!0),settle:async()=>!0},be]};r.push(i);const n={name:"成金ゴブリン",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],validate:l=>{if(!(l.entity.controller.getDeckCell().cardEntities.length<1))return Ce(l)},prepare:(l,h,m)=>Ee(l,h,m,!1,["Draw","SearchFromDeck"],[],void 0),execute:async l=>(await l.activator.draw(1,l.action.entity,l.activator),l.action.entity.field.duel.clock.incrementProcSeq(),l.activator.getOpponentPlayer().heal(1e3,l.action.entity),!0),settle:async()=>!0},be]};r.push(n);const a={name:"おろかな埋葬",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],validate:l=>{if(l.entity.controller.getDeckCell().cardEntities.filter(h=>h.status.kind==="Monster").length!==0)return Ce(l)},prepare:(l,h,m)=>Ee(l,h,m,!1,["SendToGraveyardFromDeck"],[],void 0),execute:async l=>{const h=l.activator.getDeckCell().cardEntities.filter(_=>_.status.kind==="Monster");if(h.length===0)return!1;const m=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,h,1,_=>_.length===1,"墓地に送るモンスターを選択",!1);if(!m)throw new Dt(l);return await ge.sendManyToGraveyardForTheSameReason(m,["Effect"],l.action.entity,l.activator),await l.activator.shuffleDeck(),!0},settle:async()=>!0},be]};r.push(a);const s={name:"おろかな副葬",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],isOnlyNTimesPerTurn:1,validate:l=>{if(l.entity.controller.getDeckCell().cardEntities.filter(h=>h.status.kind!=="Monster").length!==0)return Ce(l)},prepare:(l,h,m)=>Ee(l,h,m,!1,["SendToGraveyardFromDeck"],[],void 0),execute:async l=>{const h=l.activator.getDeckCell().cardEntities.filter(_=>_.status.kind!=="Monster");if(h.length===0)return!1;const m=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,h,1,_=>_.length===1,"墓地に送る魔法罠を選択",!1);if(!m)throw new Dt(l);return await ge.sendManyToGraveyardForTheSameReason(m,["Effect"],l.action.entity,l.activator),await l.activator.shuffleDeck(),!0},settle:async()=>!0},be]};r.push(s);const o={name:"死者蘇生",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],hasToTargetCards:!0,validate:l=>{if(l.entity.field.getCells("Graveyard").flatMap(h=>h.cardEntities).filter(h=>h.status.kind==="Monster").filter(h=>h.info.isRebornable).filter(h=>h.canBeTargetOfEffect(l.entity.controller,l.entity,l)).filter(h=>h.canBeSpecialSummoned("SpecialSummon",l.entity.controller,l.entity,l)).length!==0&&l.entity.controller.getAvailableMonsterZones().length!==0)return Ce(l)},prepare:async(l,h,m)=>{const _=await l.entity.field.duel.view.waitSelectEntities(l.entity.controller,l.entity.field.getCells("Graveyard").flatMap(T=>T.cardEntities).filter(T=>T.status.kind==="Monster").filter(T=>T.info.isRebornable).filter(T=>T.canBeTargetOfEffect(l.entity.controller,l.entity,l)).filter(T=>T.canBeSpecialSummoned("SpecialSummon",l.entity.controller,l.entity,l)),1,T=>T.length===1,"蘇生対象とするモンスターを選択",!1);if(!_)throw new Dt(l);return await Ee(l,h,m,!1,["SpecialSummonFromGraveyard"],_,void 0)},execute:async l=>{const h=l.activator.getEmptyMonsterZones(),m=l.selectedEntities[0];return await l.activator.summon(m,["Attack","Defense"],h,"SpecialSummon",["Effect"],l.action.entity,!1),!0},settle:async()=>!0},be]};r.push(o),[{name:"大嵐",cellTypes:Ft,isOnlyEnemies:!1},{name:"ハーピィの羽根帚",cellTypes:Ft,isOnlyEnemies:!0},{name:"ブラック・ホール",cellTypes:Nr,isOnlyEnemies:!1},{name:"サンダー・ボルト",cellTypes:Nr,isOnlyEnemies:!0}].forEach(l=>{r.push({name:l.name,actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],hasToTargetCards:!0,validate:h=>{let m=h.entity.field.getCells(...l.cellTypes).flatMap(_=>_.cardEntities).filter(_=>_!==h.entity);if(l.isOnlyEnemies&&(m=m.filter(_=>_.controller!==h.entity.controller)),!!m.length)return Ce(h)},prepare:async(h,m,_)=>{let T=h.entity.field.getCells(...l.cellTypes).flatMap(w=>w.cardEntities).filter(w=>w!==h.entity);return l.isOnlyEnemies&&(T=T.filter(w=>w.controller!==h.entity.controller)),await Ee(h,m,_,!1,h.calcChainBlockTagsForDestroy(T),[],void 0)},execute:async h=>{let m=h.action.entity.field.getCells(...l.cellTypes).flatMap(_=>_.cardEntities).filter(_=>_!==h.action.entity);return l.isOnlyEnemies&&(m=m.filter(_=>_.controller!==h.action.entity.controller)),m.forEach(_=>_.tryDestory("EffectDestroy",h.activator,h.action.entity,h.action)),await ge.waitCorpseDisposal(h.activator.duel),!0},settle:async()=>!0},be]})});const u={name:"ハリケーン",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],hasToTargetCards:!0,validate:l=>{if(l.entity.field.getCells("SpellAndTrapZone","FieldSpellZone").flatMap(m=>m.cardEntities).filter(m=>m!==l.entity).length)return Ce(l)},prepare:async(l,h,m)=>await Ee(l,h,m,!1,["BounceToHand"],[],void 0),execute:async(l,h)=>{const m=h.map(T=>T.action).filter(T=>T.playType==="CardActivation").map(T=>T.entity).filter(T=>T.isOnField).filter(T=>T.face==="FaceUp").filter(T=>!T.isLikeContinuousSpell),_=l.action.entity.field.getCells("SpellAndTrapZone","FieldSpellZone").flatMap(T=>T.cardEntities).filter(T=>!m.includes(T));return await ge.returnManyToHandForTheSameReason(_,["Effect"],l.action.entity,l.activator),!0},settle:async()=>!0},be]};r.push(u);const d={name:"手札抹殺",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],validate:l=>{if(!(l.entity.controller.getDeckCell().cardEntities.length<l.entity.controller.getHandCell().cardEntities.filter(h=>h.seq!==l.entity.seq).length)&&l.entity.field.getAllCells().filter(h=>h.cellType==="Hand").flatMap(h=>h.cardEntities).filter(h=>h.seq!==l.entity.seq).length!==0)return Ce(l)},prepare:(l,h,m)=>Ee(l,h,m,!1,["SearchFromDeck"],[],void 0),execute:async l=>{const h=l.activator.getHandCell().cardEntities.length,m=l.activator.getOpponentPlayer().getHandCell().cardEntities.length;return await ge.sendManyToGraveyardForTheSameReason(l.action.entity.field.getCells("Hand").flatMap(_=>_.cardEntities),["Effect","Discard"],l.action.entity,l.activator),l.activator.duel.clock.incrementProcSeq(),await l.action.entity.field.drawAtSameTime(l.activator,h,l.activator.getOpponentPlayer(),m,l.action.entity,l.activator),!0},settle:async()=>!0},be]};r.push(d);const f={name:"光の援軍",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],validate:l=>{if(!(l.entity.controller.getDeckCell().cardEntities.length<4)&&l.entity.controller.getDeckCell().cardEntities.filter(h=>h.status.kind==="Monster").filter(h=>(h.lvl??13)<5).filter(h=>h.status.nameTags&&h.status.nameTags.includes("ライトロード")).length!==0)return Ce(l)},prepare:async(l,h,m)=>{const _=l.entity.controller.getDeckCell();return await ge.sendManyToGraveyardForTheSameReason(_.cardEntities.slice(0,3),["Cost"],l.entity,l.entity.controller),await Ee(l,h,m,!1,["SearchFromDeck","SendToGraveyardFromDeck"],[],void 0)},execute:async l=>{const h=l.activator.getDeckCell().cardEntities.filter(_=>_.status.kind==="Monster").filter(_=>(_.lvl??13)<5).filter(_=>_.status.nameTags&&_.status.nameTags.includes("ライトロード"));if(h.length===0)return!1;const m=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,h,1,_=>_.length===1,"手札に加えるモンスターを選択",!1);for(const _ of m??[])await _.addToHand(["Effect"],l.action.entity,l.activator);return!0},settle:async()=>!0},be]};r.push(f);const p={name:"調律",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],validate:l=>{const h=l.entity.controller.getDeckCell().cardEntities;if(!(h.length<2)&&h.filter(m=>{var _;return(_=m.status.nameTags)==null?void 0:_.includes("シンクロン")}).filter(m=>{var _;return(_=m.status.monsterCategories)==null?void 0:_.includes("Tuner")}).length!==0)return Ce(l)},prepare:(l,h,m)=>Ee(l,h,m,!1,["SearchFromDeck","SendToGraveyardFromDeck"],[],void 0),execute:async l=>{const h=l.activator.getDeckCell().cardEntities;if(h.length<2)return;const m=h.filter(T=>{var w;return(w=T.status.nameTags)==null?void 0:w.includes("シンクロン")}).filter(T=>{var w;return(w=T.status.monsterCategories)==null?void 0:w.includes("Tuner")});if(m.length===0)return!1;const _=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,m,1,T=>T.length===1,"手札に加えるモンスターを選択",!1);for(const T of _??[])await T.addToHand(["Effect"],l.action.entity,l.activator);return l.activator.duel.clock.incrementProcSeq(),l.activator.getDeckCell().shuffle(),await l.activator.getDeckCell().cardEntities[0].sendToGraveyard(["Effect"],l.action.entity,l.activator),!0},settle:async()=>!0},be]};r.push(p);const y={name:"ワン・フォー・ワン",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],validate:l=>{if(l.entity.controller.getDeckCell().cardEntities.filter(h=>h.lvl===1).length===0){if(l.entity.controller.getHandCell().cardEntities.filter(h=>h.lvl===1).length===0||l.entity.controller.getHandCell().cardEntities.filter(h=>h.status.kind==="Monster").length<2)return}else if(l.entity.controller.getHandCell().cardEntities.filter(h=>h.status.kind==="Monster").length===0)return;return Ce(l)},prepare:async(l,h,m)=>{let _=l.entity.controller.getHandCell().cardEntities.filter(w=>w.status.kind==="Monster");if(l.entity.controller.getDeckCell().cardEntities.filter(w=>w.lvl===1).length===0){const w=l.entity.controller.getHandCell().cardEntities.filter(F=>F.lvl===1);w.length===1&&(_=_.filter(F=>F!==w[0]))}if(await l.entity.field.sendToGraveyard("墓地送るモンスターを選択",l.entity.controller,_,1,w=>w.length===1,["Cost"],l.entity,!0))return await Ee(l,h,m,!1,["SpecialSummonFromDeck"],[],void 0)},execute:async l=>{const h=[...l.action.entity.controller.getDeckCell().cardEntities.filter(_=>_.lvl===1),...l.action.entity.controller.getHandCell().cardEntities.filter(_=>_.lvl===1)];if(h.length===0)return!1;const m=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,h,1,_=>_.length===1,"特殊召喚するモンスターを選択",!1);if(!m)throw new Error("illegal state");return await l.activator.summon(m[0],["Attack","Defense"],l.activator.getAvailableMonsterZones(),"SpecialSummon",["Effect"],l.action.entity,!1),l.activator.shuffleDeck(),!0},settle:async()=>!0},be]};return r.push(y),r},eo=(r,e,t,i,n)=>({title:"①リクルート",playType:"TriggerEffect",spellSpeed:"Normal",executableCells:n,canExecuteOnDamageStep:!0,validate:a=>{if(!a.entity.wasMovedAtPreviousChain||!a.entity.moveLog.latestRecord.movedAs.includes("BattleDestroy"))return;const s=a.entity.controller.getDeckCell().cardEntities.filter(r);if(s.length!==0&&!s.every(o=>!a.entity.controller.canSummon(a.entity.controller,a.entity,a,"SpecialSummon",t,[o]).length))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async a=>{const s=a.action.entity.controller.getDeckCell().cardEntities.filter(r);if(s.length===0)return!1;const o=await a.action.entity.field.duel.view.waitSelectEntities(a.activator,s,e.length===1?e[0]:-1,u=>e.includes(u.length),"特殊召喚するモンスターを選択",!1);if(!o)throw new Error("illegal state");for(const u of o)await a.activator.summon(u,t,a.activator.getAvailableMonsterZones(),"SpecialSummon",["Effect"],a.action.entity,!1);return a.activator.shuffleDeck(),!0},settle:async()=>!0}),to=()=>{const r=[];return[{name:"キラー・ポテト",filter:e=>e.attr.includes("Dark")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["EffectDestroy"],executableCells:["Graveyard"]},{name:"キラー・トマト",filter:e=>e.attr.includes("Dark")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"巨大ネズミ",filter:e=>e.attr.includes("Earth")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"グリズリーマザー",filter:e=>e.attr.includes("Water")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"シャインエンジェル",filter:e=>e.attr.includes("Light")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ドラゴンフライ",filter:e=>e.attr.includes("Wind")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ＵＦＯタートル",filter:e=>e.attr.includes("Fire")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"荒野の女戦士",filter:e=>e.attr.includes("Earth")&&e.types.includes("Warrior")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"リトル・トルーパー",filter:e=>e.types.includes("Warrior")&&(e.lvl??9999)<3,qtyList:[1],posList:["Set"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard","Banished"]},{name:"破面竜",filter:e=>e.types.includes("Warrior")&&(e.def??9999)<=1500,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"共鳴虫",filter:e=>e.types.includes("Insect")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ピラミッド・タートル",filter:e=>e.types.includes("Zombie")&&(e.def??9999)<=2e3,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ユーフォロイド",filter:e=>e.types.includes("Machine")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ヘル・セキュリティ",filter:e=>e.types.includes("Fiend")&&(e.lvl??9999)===1,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ガスタ・イグル",filter:e=>(e.status.nameTags??[]).includes("ガスタ")&&(e.status.monsterCategories??[]).includes("Tuner"),qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"幻影の魔術士",filter:e=>(e.status.nameTags??[]).includes("ＨＥＲＯ")&&(e.atk??9999)<=1e3,qtyList:[1],posList:["Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ジェネクス・サーチャー",filter:e=>(e.status.nameTags??[]).includes("ジェネクス")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"紫炎の足軽",filter:e=>(e.status.nameTags??[]).includes("六武衆")&&(e.lvl??12)<=3,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"スレイブ・エイプ",filter:e=>(e.status.nameTags??[]).includes("剣闘獣")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ゼンマイハニー",filter:e=>(e.status.nameTags??[]).includes("ゼンマイ")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ＸＸ－セイバー エマーズブレイド",filter:e=>(e.status.nameTags??[]).includes("Ｘ－セイバー")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"軍隊竜",filter:e=>e.nm==="軍隊竜",qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"アサルト・ガンドッグ",filter:e=>e.nm==="アサルト・ガンドッグ",qtyList:[1,2,3,4,5],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ハイエナ",filter:e=>e.nm==="ハイエナ",qtyList:[1,2,3,4,5],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]}].forEach(e=>{r.push({name:e.name,actions:[eo(e.filter,e.qtyList,e.posList,e.destoryTypes,e.executableCells),Fe,Be,Le]})}),r},ro=r=>({title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],validate:e=>{if(e.entity.controller.getDeckCell().cardEntities.filter(r).length!==0&&e.entity.controller.canDraw)return Ce(e)},prepare:(e,t,i,n)=>Ee(e,t,i,n,["SearchFromDeck"],[],void 0),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(r);if(t.length===0)return!1;const i=await e.action.entity.field.duel.view.waitSelectEntities(e.activator,t,1,n=>n.length===1,"手札に加えるカードを選択",!1);for(const n of i??[])await n.addToHand(["Effect"],e.action.entity,e.activator);return e.activator.shuffleDeck(),!0},settle:async()=>!0}),io=(r,e)=>({title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],hasToTargetCards:!0,validate:t=>{if(!(t.entity.controller.getGraveyard().cardEntities.filter(r).length<e))return Ce(t)},prepare:(t,i,n,a)=>Ee(t,i,n,a,["AddToHandFromGraveyard"],[],void 0),execute:async t=>{const i=t.activator.getGraveyard().cardEntities.filter(r);if(i.length===0)return!1;const n=await t.action.entity.field.duel.view.waitSelectEntities(t.activator,i,e,a=>a.length===e,"手札に加えるカードを選択",!1);for(const a of n??[])await a.addToHand(["Effect"],t.action.entity,t.activator);return!0},settle:async()=>!0}),no=r=>({title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],validate:e=>{if(e.entity.controller.getHandCell().cardEntities.filter(r).length!==0&&!(e.entity.controller.getDeckCell().cardEntities.length<2))return Ce(e)},prepare:async(e,t,i,n)=>(await e.entity.controller.discard(1,["Discard","Cost"],e.entity,e.entity.controller,r),Ee(e,t,i,n,["SearchFromDeck"],[],void 0)),execute:async e=>(await e.activator.draw(2,e.action.entity,e.activator),!0),settle:async()=>!0}),ao=r=>({title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],validate:Ce,prepare:(e,t,i,n)=>{const[a,s]=r(e.entity),o=[];return a<0&&o.push("DamageToSelf"),s<0&&o.push("DamageToOpponent"),Ee(e,t,i,n,o,[],void 0)},execute:async e=>{const[t,i]=r(e.action.entity);return i>0?e.activator.getOpponentPlayer().heal(i,e.action.entity):i<0&&e.activator.getOpponentPlayer().effectDamage(Math.abs(i),e.action.entity),t>0?e.activator.heal(t,e.action.entity):t<0&&e.activator.effectDamage(Math.abs(t),e.action.entity),!0},settle:async()=>!0}),so=()=>{const r=[];return[{name:"増援",filter:e=>e.origin.kind==="Monster"&&e.types.includes("Warrior")&&(e.origin.level??5)<5},{name:"化石調査",filter:e=>e.origin.kind==="Monster"&&e.types.includes("Dinosaur")&&(e.origin.level??6)<6},{name:"Ｅ－エマージェンシーコール",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("Ｅ・ＨＥＲＯ")},{name:"召集の聖刻印",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("聖刻")},{name:"召喚師のスキル",filter:e=>e.origin.kind==="Monster"&&(e.origin.monsterCategories??[]).includes("Normal")&&(e.origin.level??4)>4},{name:"トゥーンのもくじ",filter:e=>(e.origin.nameTags??[]).includes("トゥーン")},{name:"融合賢者",filter:e=>e.origin.name==="融合"},{name:"虹の架け橋",filter:e=>e.origin.kind!=="Monster"&&(e.origin.nameTags??[]).includes("宝玉")},{name:"紫炎の狼煙",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("六武衆")&&(e.origin.level??4)<4},{name:"テラ・フォーミング",filter:e=>e.origin.kind==="Spell"&&e.origin.spellCategory==="Field"},{name:"コール・リゾネーター",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("リゾネーター")}].forEach(e=>{r.push({name:e.name,actions:[ro(e.filter),be]})}),[{name:"戦士の生還",filter:e=>e.status.kind==="Monster"&&e.types.includes("Warrior"),qty:1},{name:"ダーク・バースト",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Dark")&&(e.atk??9999)<=1500,qty:1},{name:"悪夢再び",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Dark")&&(e.def??9999)===0,qty:2},{name:"サルベージ",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Water")&&(e.atk??9999)<=1500,qty:2},{name:"バッテリーリサイクル",filter:e=>e.status.kind==="Monster"&&e.types.includes("Thunder")&&(e.atk??9999)<=1500,qty:2},{name:"闇の量産工場",filter:e=>e.status.kind==="Monster"&&(e.status.monsterCategories??[]).includes("Normal"),qty:2}].forEach(e=>{r.push({name:e.name,actions:[io(e.filter,e.qty),be]})}),[{name:"トレード・イン",filter:e=>e.status.kind==="Monster"&&(e.lvl??0)===8},{name:"調和の宝札",filter:e=>e.status.kind==="Monster"&&(e.origin.monsterCategories??[]).includes("Tuner")&&e.types.includes("Dragon")&&(e.atk??9999)<=1e3},{name:"デステニー・ドロー",filter:e=>e.status.kind==="Monster"&&(e.origin.nameTags??[]).includes("Ｄ－ＨＥＲＯ")}].forEach(e=>{r.push({name:e.name,actions:[no(e.filter),be]})}),[{name:"火の粉",calcHeal:()=>[0,-200]},{name:"雷鳴",calcHeal:()=>[0,-300]},{name:"ファイヤー・ボール",calcHeal:()=>[0,-500]},{name:"火あぶりの刑",calcHeal:()=>[0,-600]},{name:"昼夜の大火事",calcHeal:()=>[0,-800]},{name:"火炎地獄",calcHeal:()=>[-500,-1e3]},{name:"盗人ゴブリン",calcHeal:()=>[500,-500]},{name:"ブルー・ポーション",calcHeal:()=>[400,0]},{name:"レッド・ポーション",calcHeal:()=>[500,0]},{name:"ゴブリンの秘薬",calcHeal:()=>[600,0]},{name:"天使の生き血",calcHeal:()=>[800,0]},{name:"治療の神 ディアン・ケト",calcHeal:()=>[1e3,0]},{name:"恵みの雨",calcHeal:()=>[1e3,1e3]}].forEach(e=>{r.push({name:e.name,actions:[ao(e.calcHeal),be]})}),r},lo=()=>{const r=[];["大地の騎士ガイアナイト","スクラップ・デスデーモン"].forEach(t=>r.push({name:t,actions:[Fe,Be,fn()]}));const e={name:"ナチュル・ガオドレイク",actions:[Fe,Be,fn(t=>t.length===1&&t.every(i=>i.attr.some(n=>n==="Earth")),t=>t.length>0&&t.every(i=>i.attr.some(n=>n==="Earth")))]};return r.push(e),r},oo=()=>{const r=[];return[{name:"草原",up:["Warrior","BeastWarrior"],down:[]},{name:"森",up:["Insect","Plant","Beast","BeastWarrior"],down:[]},{name:"山",up:["Dragon","WingedBeast","Thunder"],down:[]},{name:"荒野",up:["Dinosaur","Zombie","Rock"],down:[]},{name:"海",up:["Aqua","SeaSerpent","Fish"],down:["Machine","Pyro"]},{name:"闇",up:["Fiend","Spellcaster"],down:["Fairy"]}].forEach(e=>{r.push({name:e.name,actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",isLikeContinuousSpell:!0,executableCells:["Hand","FieldSpellZone"],validate:Ce,prepare:Ee,execute:async()=>!0,settle:async()=>!0},be],continuousEffects:[Rr("発動","Spell",t=>t.isOnField&&t.face==="FaceUp",t=>["attack","defense"].flatMap(i=>["up","down"].map(n=>at.createContinuous("発動",a=>a.isOnField&&a.face==="FaceUp",t,(a,s)=>s.isOnField&&s.face==="FaceUp"&&(s.status.monsterCategories??!1)&&e[n].union(s.types).length>0,i,"current","Addition",(a,s,o)=>!a.isEffective||s.face==="FaceDown"?o:o+(n==="up"?200:-200)))))]})}),[{name:"バーニングブラッド",attr:"Fire"},{name:"ウォーターワールド",attr:"Water"},{name:"ガイアパワー",attr:"Earth"},{name:"シャインスパーク",attr:"Light"},{name:"ダークゾーン",attr:"Dark"},{name:"デザートストーム",attr:"Wind"}].forEach(e=>{r.push({name:e.name,actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","FieldSpellZone"],isLikeContinuousSpell:!0,validate:Ce,prepare:Ee,execute:async()=>!0,settle:async()=>!0},be],continuousEffects:[Rr("発動","Spell",t=>t.isOnField&&t.face==="FaceUp",t=>["attack","defense"].flatMap(i=>at.createContinuous("発動",n=>n.isOnField&&n.face==="FaceUp",t,(n,a)=>a.isOnField&&a.face==="FaceUp"&&a.attr.includes(e.attr),i,"current","Addition",(n,a,s)=>!n.isEffective||a.face==="FaceDown"?s:s+(i==="attack"?500:-400))))]})}),r},co=()=>{const r=[],e={name:"連合軍",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],isLikeContinuousSpell:!0,validate:Ce,prepare:Ee,execute:async()=>!0,settle:async()=>!0},be],continuousEffects:[Rr("発動","Spell",t=>t.isOnField&&t.face==="FaceUp",t=>[at.createContinuous("発動",i=>i.isOnField&&i.face==="FaceUp",t,(i,n)=>n.controller===i.controller&&n.types.includes("Warrior")&&n.isOnField&&n.face==="FaceUp","attack","current","Addition",(i,n,a)=>{if(!i.isEffective||n.face==="FaceDown")return a;const s=i.controller.getMonstersOnField().filter(o=>o.face==="FaceUp").filter(o=>o.types.includes("Warrior")||o.types.includes("Spellcaster")).length;return a+s*200})])]};return r.push(e),r},uo=()=>{const r=[];[{name:"団結の力",kind:["Monster"],rate:800},{name:"魔導師の力",kind:["Spell","Trap"],rate:500}].forEach(t=>{r.push({name:t.name,actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],isLikeContinuousSpell:!0,validate:i=>i.entity.field.getMonstersOnField().filter(a=>a.face==="FaceUp").filter(a=>a.canBeTargetOfEffect(i.entity.controller,i.entity,i)).length?Ce(i):void 0,prepare:async(i,n,a,s)=>{const o=i.entity.field.getMonstersOnField().filter(d=>d.face==="FaceUp").filter(d=>d.canBeTargetOfEffect(i.entity.controller,i.entity,i)),u=await i.entity.duel.view.waitSelectEntities(i.entity.controller,o,1,d=>d.length===1,"装備対象モンスターを選択",s);if(u)return console.log(u),i.entity.info.effectTargets.EquipTarget=u,console.log(i.entity,i.entity.info.effectTargets.EquipTarget),await Ee(i,n,a,!1,[],u,void 0)},execute:async()=>!0,settle:async()=>!0},be],continuousEffects:[bi("EquipTarget","Spell",()=>!0,i=>[sr.createRegularEquipRelation("EquipTarget",()=>!0,i,{},()=>!0)]),ri(t.name,"Spell",i=>i.info.effectTargets.EquipTarget,i=>i.isOnField&&i.face==="FaceUp",i=>["attack","defense"].map(n=>at.createContinuous("発動",a=>a.isOnField&&a.face==="FaceUp",i,(a,s)=>s.isOnField&&s.face==="FaceUp",n,"current","Addition",(a,s,o)=>{if(!a.isEffective)return o;const u=a.controller.getEntiteisOnField().filter(d=>t.kind.includes(d.status.kind)).length;return o+u*t.rate})))]})});const e={name:"早すぎた埋葬",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],hasToTargetCards:!0,isLikeContinuousSpell:!0,validate:t=>{if(t.entity.controller.getGraveyard().cardEntities.filter(i=>i.status.kind==="Monster").filter(i=>i.info.isRebornable).filter(i=>i.canBeTargetOfEffect(t.entity.controller,t.entity,t)).filter(i=>i.canBeSpecialSummoned("SpecialSummon",t.entity.controller,t.entity,t)).length!==0&&t.entity.controller.getAvailableMonsterZones().length!==0&&!(t.entity.controller.lp<800))return Ce(t)},prepare:async(t,i,n)=>{const a=await t.entity.field.duel.view.waitSelectEntities(t.entity.controller,t.entity.controller.getGraveyard().cardEntities.filter(s=>s.status.kind==="Monster").filter(s=>s.info.isRebornable).filter(s=>s.canBeTargetOfEffect(t.entity.controller,t.entity,t)).filter(s=>s.canBeSpecialSummoned("SpecialSummon",t.entity.controller,t.entity,t)),1,s=>s.length===1,"蘇生対象とするモンスターを選択",!1);if(!a)throw new Dt(t);return t.entity.controller.payLp(800,t.entity),t.entity.info.effectTargets.EquipTarget=a,await Ee(t,i,n,!1,["SpecialSummonFromGraveyard","PayLifePoint"],a,void 0)},execute:async t=>{console.log("早すぎた埋葬 execute");const i=t.activator.getEmptyMonsterZones(),n=t.selectedEntities[0];return await t.activator.summon(n,["Attack"],i,"SpecialSummon",["Effect"],t.action.entity,!1),!0},settle:async()=>!0},be],continuousEffects:[bi("EquipTarget","Spell",()=>!0,t=>[sr.createRegularEquipRelation("EquipTarget",()=>!0,t,{},()=>!0,i=>(!i.target.isOnField||i.target.face==="FaceDown"||i.isSpawnedBy.moveLog.currentProcRecords.flatMap(n=>n.movedAs).find(n=>n==="Destroy")&&i.target.tryDestory("EffectDestroy",i.effectOwner,i.isSpawnedBy,{}),!0))])]};return r.push(e),r},fo=()=>{const r=[];return[{name:"伝説の剣",attr:void 0,monType:"Warrior",atk:200,def:200},{name:"秘術の書",attr:void 0,monType:"Spellcaster",atk:200,def:200},{name:"ポセイドンの力",attr:void 0,monType:"Aqua",atk:200,def:200},{name:"紫水晶",attr:void 0,monType:"Zombie",atk:200,def:200},{name:"猛獣の歯",attr:void 0,monType:"Beast",atk:200,def:200},{name:"機械改造工場",attr:void 0,monType:"Machine",atk:200,def:200},{name:"体温の上昇",attr:void 0,monType:"Reptile",atk:200,def:200},{name:"魔菌",attr:void 0,monType:"Plant",atk:200,def:200},{name:"闇・エネルギー",attr:void 0,monType:"Fiend",atk:200,def:200},{name:"レーザー砲機甲鎧",attr:void 0,monType:"Insect",atk:200,def:200},{name:"銀の弓矢",attr:void 0,monType:"Fairy",atk:200,def:200},{name:"電撃鞭",attr:void 0,monType:"Thunder",atk:200,def:200},{name:"ドラゴンの秘宝",attr:void 0,monType:"Dragon",atk:200,def:200},{name:"フォロー・ウィンド",attr:void 0,monType:"WingedBeast",atk:200,def:200},{name:"魔性の月",attr:void 0,monType:"BeastWarrior",atk:200,def:200},{name:"エルフの光",attr:"Light",monType:void 0,atk:400,def:-200},{name:"覚醒",attr:"Earth",monType:void 0,atk:400,def:-200},{name:"灼熱の槍",attr:"Fire",monType:void 0,atk:400,def:-200},{name:"突風の扇",attr:"Wind",monType:void 0,atk:400,def:-200},{name:"はがねの甲羅",attr:"Water",monType:void 0,atk:400,def:-200},{name:"闇の破神剣",attr:"Dark",monType:void 0,atk:400,def:-200},{name:"火器付機甲鎧",attr:void 0,monType:"Insect",atk:700,def:0},{name:"サラマンドラ",attr:"Fire",monType:void 0,atk:700,def:0},{name:"シャイン・キャッスル",attr:"Light",monType:void 0,atk:700,def:0}].forEach(e=>{r.push({name:e.name,actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],isLikeContinuousSpell:!0,validate:t=>t.entity.field.getMonstersOnField().filter(n=>n.face==="FaceUp").filter(n=>n.canBeTargetOfEffect(t.entity.controller,t.entity,t)).filter(n=>!e.attr||n.attr.includes(e.attr)).filter(n=>!e.monType||n.types.includes(e.monType)).length?Ce(t):void 0,prepare:async(t,i,n,a)=>{const s=t.entity.field.getMonstersOnField().filter(u=>u.face==="FaceUp").filter(u=>u.canBeTargetOfEffect(t.entity.controller,t.entity,t)).filter(u=>!e.attr||u.attr.includes(e.attr)).filter(u=>!e.monType||u.types.includes(e.monType)),o=await t.entity.duel.view.waitSelectEntities(t.entity.controller,s,1,u=>u.length===1,"装備対象モンスターを選択",a);if(o)return console.log(o),t.entity.info.effectTargets.EquipTarget=o,console.log(t.entity,t.entity.info.effectTargets.EquipTarget),await Ee(t,i,n,!1,[],o,void 0)},execute:async()=>!0,settle:async()=>!0},be],continuousEffects:[bi("EquipTarget","Spell",()=>!0,t=>[sr.createRegularEquipRelation("EquipTarget",()=>!0,t,{},()=>!0)]),ri(e.name,"Spell",t=>t.info.effectTargets.EquipTarget,t=>t.isOnField&&t.face==="FaceUp",t=>{const i=[];return e.atk!==0&&i.push(["attack",e.atk]),e.def!==0&&i.push(["defense",e.def]),i.map(([n,a])=>at.createContinuous("発動",s=>s.isOnField&&s.face==="FaceUp",t,(s,o)=>o.isOnField&&o.face==="FaceUp"&&(!e.monType||o.types.includes(e.monType))&&(!e.attr||o.attr.includes(e.attr)),n,"current","Addition",(s,o,u)=>s.isEffective?u+a:u))})]})}),r},vo=()=>{const r=[],e={name:"にせアバター",actions:[Le,Fe,Be],continuousEffects:[ri("THE_DEVILS_AVATAR","Monster",i=>[i],i=>i.isOnField&&i.face==="FaceUp",i=>["attack","defense"].map(n=>at.createContinuous("THE_DEVILS_AVATAR",a=>a.isOnField&&a.face==="FaceUp",i,a=>a.isOnField&&a.face==="FaceUp",n,"current","THE_DEVILS_AVATAR",()=>Number.MIN_VALUE)))]};r.push(e);const t={name:"にせドレッド・ルート",actions:[Le,Fe,Be],continuousEffects:[Rr("THE_DEVILS_DREAD-ROOT","Monster",i=>i.isOnField&&i.face==="FaceUp",i=>["attack","defense"].map(n=>at.createContinuous("THE_DEVILS_DREAD-ROOT",a=>a.isOnField&&a.face==="FaceUp",i,(a,s)=>s.status.kind==="Monster"&&s.isOnField&&s.face==="FaceUp"&&s!==a,n,"current","THE_DEVILS_DREAD-ROOT",(a,s,o)=>Math.round(o/2))))]};return r.push(t),r},po=()=>{const r=[],e={name:"ご隠居の猛毒薬",actions:[be,{title:"発動",playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],validate:Ce,prepare:async(t,i,n,a)=>{const s=await t.entity.field.duel.view.waitSelectText([{seq:0,text:"●自分は１２００ＬＰ回復する。"},{seq:1,text:"●相手に８００ダメージを与える。"}],"使用する効果を選択",!1);if(s===void 0&&!a)throw new Dt(t);const o=[];return s===1&&o.push("DamageToOpponent"),Ee(t,i,n,a,o,[],s??0)},execute:async t=>t.prepared===1?(t.activator.getOpponentPlayer().effectDamage(800,t.action.entity),!0):(t.activator.heal(1200,t.action.entity),!0),settle:async()=>!0}]};return r.push(e),r},ho=()=>{const r=[],e={name:"魔導戦士 ブレイカー",actions:[Fe,Be,Le,{title:"①魔力充填",playType:"TriggerMandatoryEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],validate:t=>{if(t.entity.hasBeenSummonedNow(["NormalSummon"]))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["IfNormarlSummonSucceed"],prepared:void 0}),execute:async t=>(t.action.entity.counterHolder.setQty("SpellCounter",1),!0),settle:async()=>!0},{title:"③魔法罠破壊",playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],validate:t=>{if(!t.entity.counterHolder.getQty("SpellCounter"))return;const i=t.entity.field.getCells(...Ft).flatMap(n=>n.cardEntities).filter(n=>n.canBeTargetOfEffect(t.entity.controller,t.entity,t));if(i.length)return i.map(n=>n.fieldCell)},prepare:async(t,i,n,a)=>{let s=i==null?void 0:i.cardEntities[0];if(!s){const o=t.entity.field.getCells(...Ft).flatMap(d=>d.cardEntities).filter(d=>d.canBeTargetOfEffect(t.entity.controller,t.entity,t)),u=await t.entity.duel.view.waitSelectEntities(t.entity.controller,o,1,d=>d.length===1,"破壊する対象を選択。",a);if(!u||!u.length)return;s=u[0]}return{selectedEntities:[s],chainBlockTags:t.calcChainBlockTagsForDestroy([s]),prepared:void 0}},execute:async t=>{if(t.action.entity.counterHolder.getQty("SpellCounter"))return t.action.entity.counterHolder.remove("SpellCounter",1),t.selectedEntities.forEach(i=>i.tryDestory("EffectDestroy",t.activator,t.action.entity,t.action)),await ge.waitCorpseDisposal(t.activator.duel),!0},settle:async()=>!0}],continuousEffects:[ri("②攻撃力上昇","Monster",t=>[t],()=>!0,t=>[at.createContinuous("②攻撃力上昇",()=>!0,t,()=>!0,"attack","current","Addition",(i,n,a)=>i.isEffective?a+i.counterHolder.getQty("SpellCounter")*300:a)]),Al("魔力充填可能","Monster",t=>[t],()=>!0,t=>[new Nl("魔力充填可能",()=>!0,!0,t,{},(i,n)=>i===n,(i,n)=>(n.maxCounterQty.SpellCounter=1,n))])]};return r.push(e),r},yo=()=>{const r=[...Kl(),...to(),...lo(),...Il(),...so(),...po(),...oo(),...co(),...uo(),...fo(),...vo(),...ho()],e=r.map(i=>i.name);console.info(e);const t=Object.values(Object.groupBy(e,i=>i)).filter(i=>((i==null?void 0:i.length)??2)>1).map(i=>i==null?void 0:i[0]);if(t.length>0)throw new qe("カード定義重複",...t);return r},va=new Map;yo().forEach(r=>{va.set(r.name,r)});const Di=va,go=ma,Ue=Object.values(go).reduce((r,e)=>(r[e.name]=e,r),{}),de=class de{constructor(e,t){c(this,"id");c(this,"name");c(this,"description");c(this,"lastUsedAt");c(this,"cardNames");c(this,"getIllegalCardNames",()=>Array.from(new Set(this.cardNames.filter(e=>!Object.keys(Ue).includes(e)))));c(this,"getDisableCardNames",()=>Array.from(new Set(this.cardNames.filter(e=>!Object.keys(Ue).includes(e)))));c(this,"createCardInfos",()=>{const e=this.getIllegalCardNames();if(e.length>0)throw new Error(`存在しないカード名からデッキを生成しようとした。${e}`);return this.cardNames.map(t=>Ue==null?void 0:Ue[t]).filter(t=>t)});c(this,"copy",async()=>de.createNewDeck(this.name,this.description,this.cardNames));c(this,"updateTimestamp",async()=>{await de.tblHeader.update(this.id,e=>({...e,lastUsedAt:new Date}))});c(this,"saveDeckInfo",async e=>{const t=e??this;await de.tblHeader.update(this.id,a=>({...a,name:t.name,description:t.description,lastUsedAt:new Date}));const i=(await de.tblDetail.getAll()).filter(a=>a.deckId===this.id);console.log(t.cardNames),await de.tblDetail.delete(i.map(a=>a.id));const n=await de.tblDetail.insertMany(t.cardNames.map((a,s)=>({deckId:this.id,seq:s,name:a,description:""})));return console.log(n),new de(await de.tblHeader.get(this.id),n)});c(this,"delete",async()=>{await de.tblHeader.delete([this.id]);const e=(await de.tblDetail.getAll()).filter(t=>t.deckId===this.id);await de.tblDetail.delete(e.map(t=>t.id))});this.id=e.id,this.name=e.name,this.description=e.description,this.lastUsedAt=e.lastUsedAt,this.cardNames=t.filter(i=>i.deckId===this.id).map(i=>i.name)}};c(de,"idb"),c(de,"tblHeader"),c(de,"tblDetail"),c(de,"getAllDeckInfo",async e=>{if(e&&(de.idb=e),!de.idb)throw new Error("illegal argument: idb is undefined.");de.tblHeader||(de.tblHeader=new mo(de.idb)),de.tblDetail||(de.tblDetail=new _o(de.idb));const t=await de.tblHeader.getAll(),i=await de.tblDetail.getAll();return t.length?t.map(n=>new de(n,i)):[await de.prepareSampleDeck()]}),c(de,"createNewDeck",async(e,t,i)=>{const n=await de.tblHeader.insert({name:e,description:t,lastUsedAt:new Date}),a=await de.tblDetail.insertMany(i.map((s,o)=>({deckId:n.id,seq:o,name:s,description:""})));return new de(n,a)}),c(de,"prepareSampleDeck",async()=>await de.createNewDeck(Dr[0].name,Dr[0].description,Dr[0].cardNames));let At=de;class mo extends $i{constructor(t){super(t,"TblDeckHeader");c(this,"_prepareInitialRecords",()=>[])}}class _o extends $i{constructor(t){super(t,"TblDeckDetail");c(this,"_prepareInitialRecords",()=>[])}}let So=-1,rr=["おろかな埋葬","成金ゴブリン","強欲な壺","天使の施し","増援","トレード・イン","調和の宝札","死者蘇生","召喚師のスキル","サイバー・ドラゴン","Ｄ－ＨＥＲＯ ディアボリックガイ","ライトロード・ビースト ウォルフ","ナチュル・ガオドレイク","スクラップ・デスデーモン","大地の騎士ガイアナイト","青眼の白龍"];rr=[...rr,...rr,...rr,"Ｅ－エマージェンシーコール","闇の量産工場","戦士の生還","トレード・イン","ジェネティック・ワーウルフ","ジョングルグールの幻術師","ゾンビーノ","フロストザウルス","しゃりの軍貫","チューン・ウォリアー","貪欲な壺","ガード・オブ・フレムベル","ギャラクシーサーペント","ハロハロ","ラブラドライドラゴン","守護竜ユスティア","Ｅ・ＨＥＲＯ クレイマン","Ｅ・ＨＥＲＯ スパークマン","Ｅ・ＨＥＲＯ ネオス","Ｅ・ＨＥＲＯ バーストレディ","Ｅ・ＨＥＲＯ フェザーマン"];const Dr=[{id:So--,name:"サンプルデッキ１",description:"",lastUsedAt:new Date,cardNames:rr}];function wo(r){const e=r-1;return e*e*e+1}function yn(r,e){for(const t in e)r[t]=e[t];return r}function ko({fallback:r,...e}){const t=new Map,i=new Map;function n(s,o,u){const{delay:d=0,duration:f=M=>Math.sqrt(M)*30,easing:p=wo}=yn(yn({},e),u),y=s.getBoundingClientRect(),l=o.getBoundingClientRect(),h=y.left-l.left,m=y.top-l.top,_=y.width/l.width,T=y.height/l.height,w=Math.sqrt(h*h+m*m),F=getComputedStyle(o),R=F.transform==="none"?"":F.transform,$=+F.opacity;return{delay:d,duration:typeof f=="function"?f(w):f,easing:p,css:(M,K)=>`
			   opacity: ${M*$};
			   transform-origin: top left;
			   transform: ${R} translate(${K*h}px,${K*m}px) scale(${M+(1-M)*_}, ${M+(1-M)*T});
		   `}}function a(s,o,u){return(d,f)=>(s.set(f.key,d),()=>{if(o.has(f.key)){const p=o.get(f.key);return o.delete(f.key),n(p,d,f)}return s.delete(f.key),r&&r(d,f,u)})}return[a(i,t,!1),a(t,i,!0)]}var To=E("<div></div>"),bo=E('<div class="duel_card_row svelte-1kuignv"><div> </div> <div> </div></div>'),Co=E('<div class="duel_card_row svelte-1kuignv"><div class="svelte-1kuignv"></div> <div class="svelte-1kuignv"> </div></div>'),Eo=E('<div class="duel_card_row svelte-1kuignv"><div class="svelte-1kuignv"></div> <div class="svelte-1kuignv"> </div></div>'),Do=E('<div class="duel_card_row svelte-1kuignv"><div> </div> <div> </div></div>'),Ao=E('<div class="duel_card_row duel_card_detail svelte-1kuignv"><div class="svelte-1kuignv"> </div></div> <div class="duel_card_row duel_card_detail svelte-1kuignv"><div class="svelte-1kuignv"></div> <div class="svelte-1kuignv"><span> </span> / <span> </span></div></div>',1),xo=E('<button><div class="duel_card duel_card_visible svelte-1kuignv"><div class="duel_card_row svelte-1kuignv" style="position:relative"><div class="svelte-1kuignv"> </div> <div class="svelte-1kuignv"></div> <!></div> <!> <!> <!></div></button>'),Mo=E('<div class="duel_card duel_card_face_down duel_card_face_down_defense svelte-1kuignv"><div class="svelte-1kuignv"></div></div>'),Po=E('<div class="duel_card duel_card_face_down svelte-1kuignv"><div class="svelte-1kuignv"></div></div>');function ct(r,e){Ne(e,!1);let t=ye(e,"entity",8),i=ye(e,"state",8,"Disabled"),n=ye(e,"selectedList",28,()=>[]),a=ye(e,"isVisibleForcibly",8,!1),s=ye(e,"isWideMode",8,!1),o=ye(e,"actions",24,()=>[]),u=ye(e,"cardActionResolve",8),d=ye(e,"entitySelectResolve",8,()=>{}),f=De(!1),p=()=>{},y=ye(e,"qty",12,void 0);const l=Y=>{ie(f,!1),y(Y.qty),p=Y.resolve};t().field.duel.view.onWaitStart.append(l);let h=De(!1);const m=()=>{if(i()!=="Disabled"&&(console.log(y()),i()==="Selectable"&&y()&&y()===1)){if(n().some(Y=>Y.seq!==t().seq)){n([t()]);return}y()&&y()===1&&d()&&d()([t()])}},_=Y=>{(t().face==="FaceUp"||t().owner===t().field.duel.duelists.Below&&(t().isUnderControl||a()))&&t().field.duel.view.showCardInfo(t(),Y??"Normal")},T=()=>{if(console.log(t(),i()),_(),i()==="Disabled")return;if(i()==="Selectable"){ie(f,!v(f)),n(v(f)?[...n(),t()]:n().filter(J=>J!==t()));return}if(o().length===0)return;if(o().length===1){if(o()[0].dragAndDropOnly)return;if(u()){u()(o()[0]);return}console.log(o()[0],p),p({action:o()[0]});return}const Y=t().field.duel.view;Y.modalController.selectAction(Y,{title:"行動を選択。",actions:o(),cancelable:!0}).then(J=>{p({action:J})})},w=Y=>{console.info("drag start",Y,o()),t().field.duel.view.setDraggingActions(o()),ie(h,!0)},F=Y=>{console.info("drag end",Y,o()),t().field.duel.view.removeDraggingActions(),Y.dataTransfer&&ie(h,!1)},R=()=>(_("Debug"),!1);Ye();var $=Te(),M=ne($);{var K=Y=>{var J=xo(),ue=g(J),we=g(ue),xe=g(we),ee=g(xe),b=S(xe,4);ve(b,1,()=>t().attr,fe,(B,O)=>{var L=To();q(()=>pe(L,`monster_attr ${v(O)??""} svelte-1kuignv`)),k(B,L)});var P=S(we,2);{var X=B=>{var O=bo(),L=g(O),I=g(L),W=S(L,2),U=g(W);q((z,Z)=>{pe(L,Rt(t().lvl!==t().origin.level?"different_from_its_origin":""),"svelte-1kuignv"),x(I,z),pe(W,Rt(t().rank!==t().origin.rank?"different_from_its_origin":""),"svelte-1kuignv"),x(U,Z)},[()=>"★".repeat(t().lvl||0),()=>"☆".repeat(t().rank||0)],Se),k(B,O)},re=B=>{var O=Te(),L=ne(O);{var I=U=>{var z=Co(),Z=S(g(z),2),te=g(Z);q(()=>x(te,`${vr[t().status.spellCategory]??""}魔法`)),k(U,z)},W=U=>{var z=Te(),Z=ne(z);{var te=oe=>{var _e=Eo(),j=S(g(_e),2),C=g(j);q(()=>x(C,`${pr[t().status.trapCategory]??""}罠`)),k(oe,_e)};H(Z,oe=>{t().status.kind==="Trap"&&t().status.trapCategory&&oe(te)},!0)}k(U,z)};H(L,U=>{t().status.kind==="Spell"&&t().status.spellCategory?U(I):U(W,!1)},!0)}k(B,O)};H(P,B=>{t().status.kind==="Monster"?B(X):B(re,!1)})}var se=S(P,2);{var le=B=>{var O=Do(),L=g(O),I=g(L),W=S(L,2),U=g(W);q(()=>{pe(L,Rt(t().psL!==t().origin.pendulumScaleL?"different_from_its_origin":""),"svelte-1kuignv"),x(I,`◀ ${t().psL??""}`),pe(W,Rt(t().psR!==t().origin.pendulumScaleR?"different_from_its_origin":""),"svelte-1kuignv"),x(U,`${t().psR??""} ▶`)}),k(B,O)};H(se,B=>{var O;(O=t().status.monsterCategories)!=null&&O.includes("Pendulum")&&B(le)})}var N=S(se,2);{var G=B=>{var O=Ao(),L=ne(O),I=g(L),W=g(I),U=S(L,2),z=S(g(U),2),Z=g(z),te=g(Z),oe=S(Z,2),_e=g(oe);q((j,C)=>{x(W,`${j??""}
            ${C??""}`),pe(Z,Rt(t().atk!==t().origin.attack?"different_from_its_origin":""),"svelte-1kuignv"),x(te,t().atk??"?"),pe(oe,Rt(t().def!==t().origin.defense?"different_from_its_origin":""),"svelte-1kuignv"),x(_e,t().def??"?")},[()=>t().types.map(j=>hr[j]+(s()?Xr[j]:"")).join(),()=>{var j;return(j=t().status.monsterCategories)==null?void 0:j.map(C=>fr[C]+(s()?Jr[C]:"")).join()}],Se),k(B,O)};H(N,B=>{t().status.kind==="Monster"&&B(G)})}q(B=>{pe(J,`duel_card button_style_reset ${t().status.kind??""} ${B??""} ${(v(f)?"duel_card_selected":"")??""} ${i()??""} duel_card_${t().orientation??""} ${(v(h)?"isDragging":"")??""} ${(s()?"duel_card_wide":"")??""} duel_card_${t().face??""} ${(t().isOnField?"duel_card_is_on_field":"")??""} svelte-1kuignv`),Wt(J,"draggable",i()==="Draggable"),Wt(J,"title",t().nm),x(ee,t().nm)},[()=>{var B;return((B=t().status.monsterCategories)==null?void 0:B.join(" "))||""}],Se),Pe("dragstart",J,w),Pe("dragend",J,F),Pe("click",J,T),Pe("dblclick",J,m),Pe("mouseenter",J,()=>_()),Pe("contextmenu",J,R),k(Y,J)},A=Y=>{var J=Te(),ue=ne(J);{var we=ee=>{var b=Mo();k(ee,b)},xe=ee=>{var b=Po();k(ee,b)};H(ue,ee=>{t().battlePosition==="Set"?ee(we):ee(xe,!1)},!0)}k(Y,J)};H(M,Y=>{t().face==="FaceUp"||a()||t().controller.duelistType==="Player"&&t().isUnderControl?Y(K):Y(A,!1)})}k(r,$),Re()}var Fo=E('<div class="phase_display svelte-1mupj1p"><span class="svelte-1mupj1p"> </span> </div>'),Bo=E('<div class="lifepoint_display svelte-1mupj1p"><div class="svelte-1mupj1p"> </div> <div class="svelte-1mupj1p"> </div></div>'),qo=(r,e,t)=>e(v(t)),Oo=E('<div class="svelte-1mupj1p"><button class="phase_button svelte-1mupj1p"> </button></div>'),No=E("<div><!></div>"),Ro=E('<div class="svelte-1mupj1p"><!></div>'),Lo=E("<div><!></div>"),Ho=E("<!> <!> <!>",1),$o=E('<div style="position: absolute;" class="card_animation_receiver svelte-1mupj1p"><!></div>'),Uo=E('<div style="position: absolute; display:flex;justify-content: center;" class="svelte-1mupj1p"><!></div>'),Zo=E('<div style="position: absolute; bottom:0rem" class="svelte-1mupj1p"> </div>'),jo=E("<!> <!>",1),Go=E('<div class="badge svelte-1mupj1p"> </div>'),Vo=E('<div class="card_animation_receiver svelte-1mupj1p"><!></div>'),Yo=E("<!> <!> <!> <!>",1),Wo=E('<td><div role="listitem"><!></div></td>');function zo(r,e){Ne(e,!1);let t=ye(e,"view",8),i=ye(e,"row",8),n=ye(e,"column",8),a=ye(e,"selectedList",28,()=>[]),s=De(t().getCell(i(),n()));const o=()=>{ie(s,t().getCell(i(),n()))};v(s).onUpdate.append(o),t().onDuelUpdate.append(o),t().modalController.onUpdate.append(o);let u=De([]),d=()=>{},f;const p=b=>{ie(w,void 0),a().reset(),d=b.resolve,ie(u,b.enableActions),f=b.selectableEntities,b.entitiesValidator};t().onWaitStart.append(p);let y,l=De(!1);const h=b=>{y=b,ie(l,b.some(P=>{var X;return(X=P.validate(t().duel.chainBlockInfos))==null?void 0:X.includes(v(s))})||!1),o()},m=()=>{y=void 0,ie(l,!1),o()};t().onDragStart.append(h),t().onDragEnd.append(m);const[_,T]=Yc;let w=De(void 0);const F=b=>{if(v(s)===b.to||v(s).entities.includes(b.entity)){ie(w,b);const P=b.resolve;ie(s,v(s)),setTimeout(()=>{ie(w,void 0),b.count++,b.count>1&&P()},600)}};t().onAnimation.append(F);const R=b=>{d({phaseChange:b})},$=()=>v(s).isStackCell&&v(s).entities.flatMap(b=>b.actions).filter(b=>v(u).map(P=>P.seq).some(P=>P===b.seq)).length>0,M=()=>{if(je(s,v(s).field.duel.view.infoBoardState="Log"),v(s).isStackCell){je(s,v(s).field.duel.view.infoBoardState="CellInfo"),je(s,v(s).field.duel.view.infoBoardCell=v(s)),v(s).field.duel.view.requireUpdate();const b=v(s).entities.flatMap(P=>P.actions).filter(P=>v(u).map(X=>X.seq).some(X=>X===P.seq));if(console.log(v(u)),console.log(b),b.length){const P=v(s).field.duel.view;P.modalController.selectAction(P,{title:"カードを選択。",actions:b,cancelable:!0}).then(X=>{d({action:X})});return}}v(s).field.duel.view.requireUpdate(),console.info(v(s))},K=b=>{b.preventDefault(),b.dataTransfer&&(b.dataTransfer.dropEffect="move")},A=b=>{b.preventDefault(),console.info("drop",b,v(l),y),b.dataTransfer&&(b.dataTransfer.dropEffect="move");try{if(v(l)&&y)if(console.info(y,v(s)),y.length===1){const P=y[0].getClone();P.cell=v(s),d({action:P})}else y.length>1&&(v(s).field.duel.view.modalController.cancelAll(),v(s).field.duel.view.modalController.selectAction(v(s).field.duel.view,{title:"選択",actions:y,cancelable:!1}))}finally{t().removeDraggingActions()}},Y=(...b)=>{if(f&&f.find(re=>b.find(se=>re===se)))return"Selectable";if(!v(u)||v(u).length===0||t().waitMode!=="SelectFieldAction"||Object.values(t().modalController.states).some(re=>re==="Shown"))return"Disabled";const P=v(u).filter(re=>b.includes(re.entity));if(P.length===0)return"Disabled";if(P.length>1)return"Clickable";if(v(u)[0].playType==="RuleDraw")return"Draggable";if(v(s).isStackCell||P[0].entity!==b[0])return"Clickable";const X=P[0].validate(t().duel.chainBlockInfos);return X&&X.length>0?"Draggable":"Clickable"};Ye();var J=Wo(),ue=g(J);ue.__click=M;var we=g(ue);{var xe=b=>{var P=Te(),X=ne(P);{var re=se=>{var le=Te(),N=ne(le);{var G=O=>{var L=Fo(),I=g(L),W=g(I),U=S(I,1,!0);q((z,Z)=>{x(W,z),x(U,Z)},[()=>String(v(s).field.duel.clock.turn).padStart(2,"0"),()=>v(s).field.duel.phase.toUpperCase()],Se),k(O,L)},B=O=>{var L=Te(),I=ne(L);{var W=z=>{var Z=Bo(),te=g(Z),oe=g(te),_e=S(te,2),j=g(_e);q(()=>{x(oe,v(s).field.duel.duelists.Above.lp),x(j,v(s).field.duel.duelists.Below.lp)}),k(z,Z)},U=z=>{var Z=Te(),te=ne(Z);{var oe=_e=>{var j=Te(),C=ne(j);{var D=V=>{var Q=Te(),ce=ne(Q);{var ke=Ae=>{var tt=Te(),er=ne(tt);ve(er,1,()=>t().duel.nextPhaseList,fe,(Bt,qt)=>{var st=Oo(),gr=g(st);gr.__click=[qo,R,qt];var ii=g(gr);q(ni=>x(ii,ni),[()=>v(qt).toUpperCase()],Se),k(Bt,st)}),k(Ae,tt)};H(ce,Ae=>{t().duel.isEnded||Ae(ke)})}k(V,Q)};H(C,V=>{t().waitMode==="SelectFieldAction"&&V(D)})}k(_e,j)};H(te,_e=>{v(s).column===5&&_e(oe)},!0)}k(z,Z)};H(I,z=>{v(s).column===3?z(W):z(U,!1)},!0)}k(O,L)};H(N,O=>{v(s).column===1?O(G):O(B,!1)})}k(se,le)};H(X,se=>{v(s).row===3&&se(re)})}k(b,P)},ee=b=>{var P=Te(),X=ne(P);{var re=le=>{var N=Ho(),G=ne(N);{var B=W=>{var U=No(),z=g(U);ct(z,{get entity(){return v(w).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),q(()=>pe(U,`card_animation_receiver ${v(s).cellType??""} svelte-1mupj1p`)),Lt(1,U,()=>T,()=>({key:v(w).entity.seq})),k(W,U)};H(G,W=>{v(w)&&v(w).entity&&v(w).to===v(s)&&v(w).index==="Top"&&W(B)})}var O=S(G,2);ve(O,1,()=>v(s).cardEntities,fe,(W,U)=>{var z=Te(),Z=ne(z);{var te=oe=>{var _e=Ro(),j=g(_e);const C=Se(()=>Y(v(U))),D=Se(()=>v(u).filter(V=>V.entity===v(U)));ct(j,{get entity(){return v(U)},get state(){return v(C)},get actions(){return v(D)},cardActionResolve:void 0,get selectedList(){return a()},set selectedList(V){a(V)},$$legacy:!0}),Lt(2,_e,()=>_,()=>({key:v(U).seq})),k(oe,_e)};H(Z,oe=>{(!v(w)||v(w).entity.seq!==v(U).seq)&&oe(te)})}k(W,z)});var L=S(O,2);{var I=W=>{var U=Lo(),z=g(U);ct(z,{get entity(){return v(w).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),q(()=>pe(U,`card_animation_receiver ${v(s).cellType??""} svelte-1mupj1p`)),Lt(1,U,()=>T,()=>({key:v(w).entity.seq})),k(W,U)};H(L,W=>{v(w)&&v(w).entity&&v(w).to===v(s)&&v(w).index==="Bottom"&&W(I)})}k(le,N)},se=le=>{var N=Yo(),G=ne(N);{var B=Z=>{var te=$o(),oe=g(te);ct(oe,{get entity(){return v(w).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),Lt(1,te,()=>T,()=>({key:v(w).entity.seq})),k(Z,te)};H(G,Z=>{v(w)&&v(w).entity&&v(w).to===v(s)&&v(w).index==="Bottom"&&Z(B)})}var O=S(G,2);{var L=Z=>{var te=jo(),oe=ne(te);ve(oe,1,()=>v(s).cardEntities.toReversed(),fe,(C,D,V)=>{var Q=Te(),ce=ne(Q);{var ke=Ae=>{var tt=Uo(),er=g(tt);const Bt=Se(()=>V===0&&!v(s).isStackCell?Y(...v(s).cardEntities):void 0),qt=Se(()=>V===0?v(u).filter(st=>v(s).cardEntities.includes(st.entity)):void 0);ct(er,{get entity(){return v(D)},get state(){return v(Bt)},get actions(){return v(qt)},cardActionResolve:void 0,get selectedList(){return a()},set selectedList(st){a(st)},$$legacy:!0}),Lt(2,tt,()=>_,()=>({key:v(D).seq})),k(Ae,tt)};H(ce,Ae=>{(!v(w)||v(w).entity.seq!==v(D).seq)&&Ae(ke)})}k(C,Q)});var _e=S(oe,2);{var j=C=>{var D=Zo(),V=g(D);q(()=>x(V,`【${v(s).cardEntities[0].battlePositionName??""}】`)),k(C,D)};H(_e,C=>{v(s).cardEntities[0].battlePosition&&C(j)})}k(Z,te)};H(O,Z=>{v(s).cardEntities.length>0&&Z(L)})}var I=S(O,2);{var W=Z=>{var te=Go(),oe=g(te);q(()=>x(oe,v(s).cardEntities.length)),k(Z,te)};H(I,Z=>{v(s).isStackCell&&Z(W)})}var U=S(I,2);{var z=Z=>{var te=Vo(),oe=g(te);ct(oe,{get entity(){return v(w).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),Lt(1,te,()=>T,()=>({key:v(w).entity.seq})),k(Z,te)};H(U,Z=>{v(w)&&v(w).entity&&v(w).to===v(s)&&v(w).index==="Top"&&Z(z)})}k(le,N)};H(X,le=>{v(s).cellType==="Hand"?le(re):le(se,!1)},!0)}k(b,P)};H(we,b=>{v(s).cellType==="Disable"?b(xe):b(ee,!1)})}q(b=>{pe(J,`${`duel_field_cell duel_field_cell_${v(s).cellType}`??""} svelte-1mupj1p`),Wt(J,"colspan",v(s).cellType==="Hand"?7:1),pe(ue,`${b??""} svelte-1mupj1p`)},[()=>`duel_card_wrapper ${v(s).cellType} ${v(l)?"can_accept_drop":""} ${$()?"can_action":""}`],Se),Pe("dragover",ue,b=>K(b)),Pe("drop",ue,b=>A(b)),k(r,J),Re()}ur(["click"]);var Ko=E('<tr><td style=" white-space: nowrap;text-align: center;"> </td><td class="svelte-13svkzh"> </td></tr>'),Qo=E('<div class="duel_log svelte-13svkzh"><table><tbody></tbody></table></div>');function Jo(r,e){var u,d;Ne(e,!1);let t=De(void 0),i=ye(e,"log",12);const n=()=>{i(i()),ys().then(()=>v(t)&&v(t).scroll(0,v(t).clientHeight*10))};(d=(u=i())==null?void 0:u.onUpdate)==null||d.append(n),Ye();var a=Qo(),s=g(a),o=g(s);ve(o,5,()=>i().records,fe,(f,p)=>{var y=Ko(),l=g(y),h=g(l),m=S(l),_=g(m);q(()=>{var T,w;pe(l,`duelist ${((T=v(p).duelist)==null?void 0:T.seat)??""} svelte-13svkzh`),x(h,((w=v(p).duelist)==null?void 0:w.profile.name)||"SYSTEM"),x(_,v(p).text)}),k(f,y)}),js(a,f=>ie(t,f),()=>v(t)),k(r,a),Re()}var Xo=E('<div><div class="duelist_name svelte-12u0sqq"> </div> <div> </div></div>');function gn(r,e){Ne(e,!1);let t=ye(e,"duelist",12),i=De(0),n=De();const a=async()=>{const y=t().lp-v(i);if(!v(n)||Math.abs(y)<10){ie(i,t().lp),v(n)&&(v(n)(),ie(n,void 0));return}ie(i,v(i)+Math.floor(Math.random()*y)),await jl(100),a()},s=()=>{t(t()),!v(n)&&t().lp!==v(i)&&new Promise(y=>{ie(n,y),Math.abs(t().lp-v(i)),a()})};t().duel.log.onUpdate.append(s),a(),Ye();var o=Xo(),u=g(o),d=g(u),f=S(u,2),p=g(f);q(()=>{pe(o,`duelist ${t().seat??""} svelte-12u0sqq`),x(d,t().profile.name),pe(f,`duelist_lp ${(v(n)?"vibration":"")??""} svelte-12u0sqq`),x(p,v(i))}),k(r,o),Re()}const Io=()=>{};var ec=E("<div><!></div>"),tc=E("<div></div>"),rc=(r,e,t)=>e.resolve(v(t)),ic=(r,e)=>e.resolve(void 0),nc=E('<button class="svelte-1h1of0m">Cancel</button>'),ac=E('<div class="base svelte-1h1of0m"><button class="overlay svelte-1h1of0m">☆</button> <div class="window svelte-1h1of0m"><div> </div> <!> <div><button class="svelte-1h1of0m">OK</button> <!></div></div></div>');function sc(r,e){Ne(e,!0);let t=Ja(yt([]));var i=Te(),n=ne(i);{var a=s=>{var o=ac(),u=g(o);u.__click=[Io];var d=S(u,2),f=g(d),p=g(f),y=S(f,2);ve(y,17,()=>e.entities.map(T=>T.controller.seat).getDistinct(),fe,(T,w)=>{var F=tc();ve(F,21,()=>e.entities.filter(R=>R.controller.seat===v(w)).toSorted(fa),fe,(R,$)=>{var M=ec(),K=g(M);ct(K,{get entity(){return v($)},isVisibleForcibly:!0,state:"Selectable",entitySelectResolve:A=>e.resolve(A),get qty(){return e.qty},cardActionResolve:void 0,get selectedList(){return v(t)},set selectedList(A){ie(t,yt(A))}}),k(R,M)}),q(()=>pe(F,`entities_list ${v(w)??""} svelte-1h1of0m`)),k(T,F)});var l=S(y,2),h=g(l);h.__click=[rc,e,t];var m=S(h,2);{var _=T=>{var w=nc();w.__click=[ic,e],k(T,w)};H(m,T=>{e.cancelable&&T(_)})}q(T=>{x(p,e.title),h.disabled=T},[()=>!e.validator(v(t))]),k(s,o)};H(n,s=>{s(a)})}k(r,i),Re()}ur(["click"]);const lc=(r,e)=>{e.cancelable&&e.resolve(void 0)};var oc=E('<div class="duel_card_wrapper svelte-11mc7y0"><!> <div> </div></div>'),cc=(r,e)=>e.resolve(),dc=E('<div><button class="cancel_button svelte-11mc7y0">Cancel</button></div>'),uc=E('<div><button>★</button> <div><div> </div> <div class="flex svelte-11mc7y0"></div> <!></div></div>');function fc(r,e){Ne(e,!0);const[t,i]=Ws(),n=()=>Ys(a,"$isDragging",t);let a=Gs(!1);const s=()=>a.set(!0),o=()=>a.set(!1);e.view.onDragStart.append(s),e.view.onDragEnd.append(o);const u=y=>{const l=y.validate(e.view.duel.chainBlockInfos);return l&&l.length>0?"Draggable":"Clickable"};var d=Te(),f=ne(d);{var p=y=>{var l=uc(),h=g(l);h.__click=[lc,e];var m=S(h,2),_=g(m),T=g(_),w=S(_,2);ve(w,21,()=>e.actions,fe,($,M)=>{var K=oc(),A=g(K);const Y=xt(()=>u(v(M))),J=xt(()=>e.dragAndDropOnly?[]:[v(M)]);ct(A,{get entity(){return v(M).entity},isVisibleForcibly:!0,get state(){return v(Y)},get actions(){return v(J)},get cardActionResolve(){return e.resolve}});var ue=S(A,2),we=g(ue);q(()=>x(we,`«${v(M).title??""}»`)),k($,K)});var F=S(w,2);{var R=$=>{var M=dc(),K=g(M);K.__click=[cc,e],k($,M)};H(F,$=>{e.cancelable&&$(R)})}q(()=>{pe(l,`${`base ${n()?"minimum_mode":""}`??""} svelte-11mc7y0`),pe(h,`${`overlay ${n()?"minimum_mode":""}`??""} svelte-11mc7y0`),pe(m,`${`window ${n()?"minimum_mode":""}`??""} svelte-11mc7y0`),x(T,e.title)}),k(y,l)};H(f,y=>{y(p)})}k(r,d),Re(),i()}ur(["click"]);const vc=(r,e,t,i)=>{e().cancelable&&(t()(void 0),ie(i,!1))};var pc=(r,e,t)=>e()(t()),hc=E("<li><button> </button></li>"),yc=(r,e)=>e()(void 0),gc=E("<button>Cancel</button>"),mc=E('<div class="base svelte-1103gpy"><button class="overlay svelte-1103gpy">★</button> <div class="window svelte-1103gpy"><div> </div> <ui class="text_list svelte-1103gpy"></ui> <!></div></div>');function _c(r,e){Ne(e,!1);let t=ye(e,"arg",8),i=ye(e,"resolve",8),n=De(!0);Ye();var a=Te(),s=ne(a);{var o=u=>{var d=mc(),f=g(d);f.__click=[vc,t,i,n];var p=S(f,2),y=g(p),l=g(y),h=S(y,2);ve(h,5,()=>t().choises,fe,(T,w)=>{let F=()=>v(w).seq,R=()=>v(w).text;var $=hc(),M=g($);M.__click=[pc,i,F];var K=g(M);q(()=>{pe($,`text_item ${F()??""} svelte-1103gpy`),x(K,R())}),k(T,$)});var m=S(h,2);{var _=T=>{var w=gc();w.__click=[yc,i],k(T,w)};H(m,T=>{t().cancelable&&T(_)})}q(()=>x(l,t().title)),k(u,d)};H(s,u=>{v(n)&&u(o)})}k(r,a),Re()}ur(["click"]);var Sc=E('<div class="base svelte-1y912d"><!> <!> <!></div>');function wc(r,e){var p,y;Ne(e,!1);let t=ye(e,"modalController",12);const i=()=>{t(t())};(y=(p=t())==null?void 0:p.onUpdate)==null||y.append(i),Ye();var n=Sc(),a=g(n);{var s=l=>{sc(l,{get title(){return t().duelEntitiesSelectorArg.title},get entities(){return t().duelEntitiesSelectorArg.entities},get validator(){return t().duelEntitiesSelectorArg.validator},get qty(){return t().duelEntitiesSelectorArg.qty},get cancelable(){return t().duelEntitiesSelectorArg.cancelable},resolve:h=>{t().duelEntitiesSelectorResolve(h)}})};H(a,l=>{t().states.DuelEntitiesSelector==="Shown"&&l(s)})}var o=S(a,2);{var u=l=>{const h=Se(()=>t().cardActionSelectorArg.dragAndDropOnly??!1);fc(l,{get view(){return t().view},get title(){return t().cardActionSelectorArg.title},get actions(){return t().cardActionSelectorArg.actions},get dragAndDropOnly(){return v(h)},get cancelable(){return t().cardActionSelectorArg.cancelable},resolve:m=>{console.info(m),t().cardActionSelectorResolve(m)}})};H(o,l=>{t().states.DuelActionSelector==="Shown"&&l(u)})}var d=S(o,2);{var f=l=>{_c(l,{get arg(){return t().duelTextSelectorArg},resolve:h=>{console.info(h),t().duelTextSelectorResolve(h)}})};H(d,l=>{t().states.DuelTextSelector==="Shown"&&l(f)})}k(r,n),Re()}const kc=(r,e)=>(e(e()==="Normal"?"Debug":"Normal"),!0);var Tc=E('<div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"><pre class="description svelte-nn7bjy"> </pre></div></div> <div class="duel_card_info_row svelte-nn7bjy" style=" justify-content: space-between;"><div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"> </div></div>',1),bc=E('<div></div> <div class="svelte-nn7bjy"> </div>',1),Cc=E("<div> </div>"),Ec=E("<div> </div>"),Dc=E('<div class="duel_card_info_row svelte-nn7bjy"><!> <!></div> <div class="duel_card_info_row svelte-nn7bjy"></div>',1),Ac=E('<div class="duel_card_row svelte-nn7bjy"><div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"> </div></div>'),xc=E('<div class="duel_card_row svelte-nn7bjy"><div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"> </div></div>'),Mc=E("<!> <!>",1),Pc=E('<div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"><pre class="description svelte-nn7bjy"> </pre></div></div>'),Fc=E('<div class="svelte-nn7bjy"> </div>'),Bc=E('<div class="svelte-nn7bjy"> </div>'),qc=E('<div class="svelte-nn7bjy"> </div>'),Oc=E('<div class="svelte-nn7bjy"> </div>'),Nc=E('<div class="svelte-nn7bjy"> </div>'),Rc=E('<div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"><pre class="json svelte-nn7bjy"> </pre> <pre class="json svelte-nn7bjy"> </pre> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div></div></div>'),Lc=E('<div class="svelte-nn7bjy">※テスト用カードです</div>'),Hc=E('<div class="duel_card_info_links svelte-nn7bjy"><a target="_blank" rel="noopener noreferrer" title="遊戯王カードWiki" class="svelte-nn7bjy">⇒遊戯王カードWiki</a> <a target="_blank" rel="noopener noreferrer" title="コナミカードデータベース" class="svelte-nn7bjy"> </a></div>'),$c=E('<div role="contentinfo"><div class="duel_card_info_header svelte-nn7bjy"><div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"> </div></div> <div class="duel_card_info_row svelte-nn7bjy" style="position:sticky; top:0;"><div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"> </div></div> <!></div> <div class="duel_card_info_body svelte-nn7bjy"><!></div> <div class="duel_card_info_footer svelte-nn7bjy"><!></div></div>');function Uc(r,e){Ne(e,!1);let t=ye(e,"entity",8,void 0);const i=()=>t()?Ue[t().origin.name]:void 0,n=()=>{var d;return t()&&(t().origin.cardId??!1)?`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=2&cid=${t().origin.cardId}`:`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=1&sess=1&rp=10&mode=&sort=1&keyword=${(d=i())==null?void 0:d.name}&stype=1&ctype=&othercon=2&starfr=&starto=&pscalefr=&pscaleto=&linkmarkerfr=&linkmarkerto=&link_m=2&atkfr=&atkto=&deffr=&defto=&releaseDStart=1&releaseMStart=1&releaseYStart=1999&releaseDEnd=&releaseMEnd=&releaseYEnd=`};let a=ye(e,"mode",12,"Normal");Ye();var s=Te(),o=ne(s);{var u=d=>{var f=$c();f.__contextmenu=[kc,a];var p=g(f),y=g(p),l=g(y),h=g(l),m=S(y,2),_=g(m),T=g(_),w=S(_,2),F=g(w),R=S(m,2);{var $=ee=>{var b=Mc(),P=ne(b);{var X=N=>{var G=Tc(),B=ne(G),O=g(B),L=g(O),I=g(L),W=S(B,2),U=g(W),z=g(U),Z=S(U,2),te=g(Z);q(()=>{x(I,Ue[t().origin.name].pendulumDescription),x(z,`◀ ${t().psL??""}`),x(te,`${t().psR??""} ▶`)}),k(N,G)};H(P,N=>{var G;(G=t().status.monsterCategories)!=null&&G.includes("Pendulum")&&N(X)})}var re=S(P,2);{var se=N=>{var G=Dc(),B=ne(G),O=g(B);ve(O,1,()=>t().attr,fe,(W,U)=>{var z=bc(),Z=ne(z),te=S(Z,2),oe=g(te);q(()=>{pe(Z,`monster_attr ${v(U)??""} svelte-nn7bjy`),x(oe,`${Ui[v(U)]??""}属性`)}),k(W,z)});var L=S(O,2);ve(L,1,()=>t().types,fe,(W,U)=>{var z=Cc(),Z=g(z);q(()=>{pe(z,`monster_cat ${v(U)??""} svelte-nn7bjy`),x(Z,`${hr[v(U)]??""}${Xr[v(U)]??""}族`)}),k(W,z)});var I=S(B,2);ve(I,5,()=>t().status.monsterCategories??[],fe,(W,U)=>{var z=Ec(),Z=g(z);q(()=>{pe(z,`monster_cat ${v(U)??""} svelte-nn7bjy`),x(Z,`${fr[v(U)]??""}${Jr[v(U)]??""}`)}),k(W,z)}),k(N,G)},le=N=>{var G=Te(),B=ne(G);{var O=I=>{var W=Ac(),U=S(g(W),2),z=g(U);q(()=>x(z,`${vr[t().status.spellCategory]??""}魔法`)),k(I,W)},L=I=>{var W=Te(),U=ne(W);{var z=Z=>{var te=xc(),oe=S(g(te),2),_e=g(oe);q(()=>x(_e,`${pr[t().status.trapCategory]??""}罠`)),k(Z,te)};H(U,Z=>{t().status.kind==="Trap"&&t().status.trapCategory&&Z(z)},!0)}k(I,W)};H(B,I=>{t().status.kind==="Spell"&&t().status.spellCategory?I(O):I(L,!1)},!0)}k(N,G)};H(re,N=>{t().status.kind==="Monster"?N(se):N(le,!1)})}k(ee,b)};H(R,ee=>{a()==="Normal"&&ee($)})}var M=S(p,2),K=g(M);{var A=ee=>{var b=Pc(),P=g(b),X=g(P),re=g(X);q(se=>x(re,se),[()=>{var se;return(se=i())==null?void 0:se.description}],Se),k(ee,b)},Y=ee=>{var b=Rc(),P=g(b),X=g(P),re=g(X),se=S(X,2),le=g(se),N=S(se,2);N.textContent='"actions" :[';var G=S(N,2);ve(G,1,()=>t().actions,fe,(D,V)=>{var Q=Fc(),ce=g(Q);q(()=>x(ce,`"${v(V).playType??""} ${v(V).title??""}",`)),k(D,Q)});var B=S(G,2);B.textContent="],";var O=S(B,2);O.textContent='"continuousEffects" :[';var L=S(O,2);ve(L,1,()=>t().continuousEffects,fe,(D,V)=>{var Q=Bc(),ce=g(Q);q(()=>x(ce,`"${v(V).isStarted??""}",`)),k(D,Q)});var I=S(L,2);I.textContent="],";var W=S(I,2);W.textContent='"procFilters" :[';var U=S(W,2);ve(U,1,()=>t().procFilterBundle.operators,fe,(D,V)=>{var Q=qc(),ce=g(Q);q(ke=>x(ce,`"${ke??""} ${v(V).title??""}",`),[()=>v(V).isSpawnedBy.toString()],Se),k(D,Q)});var z=S(U,2);z.textContent="],";var Z=S(z,2);Z.textContent='"numericStateOperators" :[';var te=S(Z,2);ve(te,1,()=>t().numericOprsBundle.operators,fe,(D,V)=>{var Q=Oc(),ce=g(Q);q(ke=>x(ce,`"${ke??""} ${v(V).title??""}",`),[()=>v(V).isSpawnedBy.toString()],Se),k(D,Q)});var oe=S(te,2);oe.textContent="],";var _e=S(oe,2);_e.textContent='"cardRelations" :[';var j=S(_e,2);ve(j,1,()=>t().cardRelationBundle.operators,fe,(D,V)=>{var Q=Nc(),ce=g(Q);q(ke=>x(ce,`"${ke??""} ${v(V).title??""}",`),[()=>v(V).isSpawnedBy.toString()],Se),k(D,Q)});var C=S(j,2);C.textContent="],",q((D,V)=>{x(re,`"info" :${D??""},`),x(le,`"status" :${V??""},`)},[()=>JSON.stringify(t().info,null,2),()=>JSON.stringify(t().status,null,2)],Se),k(ee,b)};H(K,ee=>{a()==="Normal"?ee(A):ee(Y,!1)})}var J=S(M,2),ue=g(J);{var we=ee=>{var b=Lc();k(ee,b)},xe=ee=>{var b=Hc(),P=g(b),X=S(P,2),re=g(X);q(se=>{var le;Wt(P,"href",`https://yugioh-wiki.net/index.php?${t().origin.wikiEncodedName}`),Wt(X,"href",se),x(re,`⇒${((le=t())!=null&&le.origin.cardId?"公式カードページ":"公式で検索")??""}`)},[n],Se),k(ee,b)};H(ue,ee=>{var b;(b=t())!=null&&b.origin.isForTest?ee(we):ee(xe,!1)})}q((ee,b,P)=>{pe(f,`duel_card duel_card_info ${t().origin.kind??""} ${ee??""} svelte-nn7bjy`),x(h,t().nm),x(T,b),x(F,P)},[()=>{var ee;return(ee=t().origin.monsterCategories)==null?void 0:ee.join(" ")},()=>"★".repeat(t().lvl||0),()=>"☆".repeat(t().rank||0)],Se),k(d,f)};H(o,d=>{t()&&d(u)})}k(r,s),Re()}ur(["contextmenu"]);var Zc=E('<div class="duel_field_cell_info_item svelte-1xj7qf1"><!></div>'),jc=E('<div class="duel_field_cell_info_box svelte-1xj7qf1"><div class="duel_field_cell_info_label svelte-1xj7qf1"> </div> <!></div>'),Gc=E('<div class="duel_field_cell_info svelte-1xj7qf1"><div class="duel_field_cell_info_header item_btn svelte-1xj7qf1"><div class="svelte-1xj7qf1"> </div> <div class="svelte-1xj7qf1"> </div></div> <div class="duel_field_cell_info_body svelte-1xj7qf1"></div></div>');function Vc(r,e){Ne(e,!1);let t=ye(e,"cell",12);const i=()=>{t(t())},n=y=>t().cardEntities.filter(l=>l.face===y);t().field.duel.view.onDuelUpdate.append(i),Ye();var a=Gc(),s=g(a),o=g(s),u=g(o),d=S(o,2),f=g(d),p=S(s,2);ve(p,4,()=>["FaceUp","FaceDown"],fe,(y,l)=>{var h=Te(),m=ne(h);{var _=T=>{var w=jc(),F=g(w),R=g(F),$=S(F,2);ve($,1,()=>n(l).toSorted(fa),fe,(M,K)=>{var A=Zc(),Y=g(A);const J=Se(()=>t().owner===t().field.duel.duelists.Below);ct(Y,{get entity(){return v(K)},get isVisibleForcibly(){return v(J)},isWideMode:!0,cardActionResolve:void 0}),k(M,A)}),q(()=>x(R,l==="FaceUp"?"表向き":"裏向き")),k(T,w)};H(m,T=>{n(l).length&&T(_)})}k(y,h)}),q(()=>{var y;x(u,(y=t().owner)==null?void 0:y.profile.name),x(f,t().cellType)}),k(r,a),Re()}const Yc=ko({duration:400});var Wc=E('<div class="duel_field_header_message svelte-accyye"> </div> <div class="duel_field_header_buttons svelte-accyye"><button class="svelte-accyye">サレンダー</button></div>',1),zc=E("<tr></tr>"),Kc=E('<table class="duel_field svelte-accyye"><tbody class="svelte-accyye"></tbody></table>'),Qc=E('<button class="svelte-accyye">OK</button>'),Jc=E('<div style="position:absolute;right:0;top:0"> </div> <div class="flex duel_desk svelte-accyye"><div class="duel_desk_left v_flex svelte-accyye"><!> <!> <!></div> <div class=" duel_desk_center v_flex svelte-accyye"><div class="duel_field_header svelte-accyye"><!></div> <div class="svelte-accyye"><!></div> <div class="duel_field_footer svelte-accyye"><!></div></div> <div class=" duel_desk_right svelte-accyye" style="text-align: left;"><!></div></div> <!>',1);function Xc(r,e){Ne(e,!1);let t=ye(e,"duel",12),i=()=>{},n=De(()=>!0),a=De();const s=N=>{i=N.resolve,ie(n,N.entitiesValidator),ie(a,N.selectableEntities),N.duelEntitiesSelectorArg&&t().view.modalController.selectDuelEntities(N.duelEntitiesSelectorArg).then(G=>{i({selectedEntities:G})})};t().view.onWaitStart.append(s);let o=De(void 0),u=De("Normal");const d=({card:N,mode:G})=>{ie(o,N),ie(u,G)};t().view.onShowCardEntity.append(d);let f=ye(e,"selectedList",28,()=>[]);const p=()=>{t(t())};t().view.onDuelUpdate.append(p);const y=()=>{console.log(f()),v(n)(f())&&(console.log(f()),i({selectedEntities:f()}))},l=()=>{i({surrender:!0})};t().main(),Ye();var h=Jc(),m=ne(h),_=g(m),T=S(m,2),w=g(T),F=g(w);gn(F,{get duelist(){return t().duelists.Above}});var R=S(F,2);Uc(R,{get entity(){return v(o)},get mode(){return v(u)}});var $=S(R,2);gn($,{get duelist(){return t().duelists.Below}});var M=S(w,2),K=g(M),A=g(K);{var Y=N=>{var G=Wc(),B=ne(G),O=g(B),L=S(B,2),I=g(L);q(()=>x(O,`[TURN:${t().clock.turn}][PHASE:${t().phase}] ${t().view.message}`)),Pe("click",I,l),k(N,G)};H(A,N=>{t().isEnded||N(Y)})}var J=S(K,2),ue=g(J);{var we=N=>{var G=Kc(),B=g(G);ve(B,5,()=>t().field.cells,fe,(O,L,I)=>{var W=zc();pe(W,`${`duel_desk_row_${I}`??""} svelte-accyye`),ve(W,5,()=>v(L),fe,(U,z,Z)=>{zo(U,{get view(){return t().view},row:I,column:Z,get selectedList(){return f()},set selectedList(te){f(te)},$$legacy:!0})}),k(O,W)}),k(N,G)};H(ue,N=>{t().clock.turn>0&&N(we)})}var xe=S(J,2),ee=g(xe);{var b=N=>{var G=Qc();q(B=>G.disabled=B,[()=>!v(n)(f())],Se),Pe("click",G,y),k(N,G)};H(ee,N=>{v(a)&&v(a).length>0&&N(b)})}var P=S(M,2),X=g(P);{var re=N=>{Jo(N,{get log(){return t().log}})},se=N=>{var G=Te(),B=ne(G);{var O=L=>{Vc(L,{get cell(){return t().view.infoBoardCell}})};H(B,L=>{t().view.infoBoardState==="CellInfo"&&L(O)},!0)}k(N,G)};H(X,N=>{t().view.infoBoardState==="Log"?N(re):N(se,!1)})}var le=S(T,2);wc(le,{get modalController(){return t().view.modalController}}),q(N=>x(_,N),[()=>t().clock.toString()],Se),k(r,h),Re()}var Ic=E("<div></div>"),ed=E('<span> </span> / <span style="display: inline-block;width:2rem;text-align: right;"> </span>',1),td=E('<li class="deck_editor_item svelte-vivzk2"><div role="listitem"><div class="svelte-vivzk2"><div class="svelte-vivzk2"> </div> <div style="display:flex" class="svelte-vivzk2"><div class="svelte-vivzk2"><!> <!> <!> <!> <!> <!> <!></div> <div style="flex-grow: 1; width:0.1rem" class="svelte-vivzk2"></div> <div class="svelte-vivzk2"><!></div></div></div></div> <button class="button_style_reset svelte-vivzk2">+</button> <button class="button_style_reset svelte-vivzk2">-</button></li>'),rd=E('<div class="deck_editor_card_kind svelte-vivzk2"><span class="svelte-vivzk2"> </span> <ul class="svelte-vivzk2"></ul></div>'),id=E('<div class="deck_editor_deck_type svelte-vivzk2"><span class="svelte-vivzk2"> </span> <!></div>'),nd=E('<div class="deck_editor_card_list svelte-vivzk2"></div>');function mn(r,e){Ne(e,!1);let t=ye(e,"allCardInfos",8),i=ye(e,"deckCardInfos",12),n=ye(e,"mode",8),a=ye(e,"onAttention",8);const s={Deck:["Monster","Spell","Trap"],ExtraDeck:["Monster"]},o=(p,y)=>(n()==="List"?t():i()).filter(l=>{var h;return Di.has(l.name)||((h=l.monsterCategories)==null?void 0:h.includes("Normal"))}).filter(l=>!y||l.kind===y).filter(l=>{var h,m;return!p||p==="Deck"&&!((h=l==null?void 0:l.monsterCategories)!=null&&h.union(zt).length)||p==="ExtraDeck"&&((m=l==null?void 0:l.monsterCategories)==null?void 0:m.union(zt).length)}).toSorted(Er),u=(p,y)=>{const l=i().filter(m=>m.name===y.name).length;if(l>2)return;const h=p.shiftKey?3-l:1;h<1||(i().push(...Array(h).fill(y)),i().sort(Er),i(i()))},d=(p,y)=>{let l=0;i(i().filter(h=>h.name!==y.name?!0:(l++,!p.shiftKey&&l>1))),i().sort(Er)};Ye();var f=nd();ve(f,5,()=>el,fe,(p,y)=>{var l=id(),h=g(l),m=g(h),_=S(h,2);ve(_,1,()=>s[v(y)],fe,(T,w)=>{var F=rd(),R=g(F),$=g(R),M=S(R,2);ve(M,5,()=>o(v(y),v(w)),fe,(K,A)=>{var Y=td(),J=g(Y),ue=g(J),we=g(ue),xe=g(we),ee=S(we,2),b=g(ee),P=g(b);{var X=j=>{var C=Ot();q(()=>x(C,`★${v(A).level??""}`)),k(j,C)};H(P,j=>{v(A).level&&j(X)})}var re=S(P,2);{var se=j=>{var C=Ot();q(()=>x(C,`☆${v(A).rank??""}`)),k(j,C)};H(re,j=>{v(A).rank&&j(se)})}var le=S(re,2);{var N=j=>{var C=Ic();q(()=>pe(C,`monster_attr ${v(A).attribute??""} svelte-vivzk2`)),k(j,C)};H(le,j=>{v(A).attribute!==void 0&&j(N)})}var G=S(le,2);{var B=j=>{var C=Ot();q(()=>x(C,hr[v(A).type])),k(j,C)};H(G,j=>{v(A).type!==void 0&&j(B)})}var O=S(G,2);ve(O,1,()=>v(A).monsterCategories??[],fe,(j,C)=>{var D=Ot();q(()=>x(D,fr[v(C)])),k(j,D)});var L=S(O,2);{var I=j=>{var C=Ot();q(()=>x(C,`${vr[v(A).spellCategory]??""}魔法`)),k(j,C)};H(L,j=>{v(A).spellCategory!==void 0&&j(I)})}var W=S(L,2);{var U=j=>{var C=Ot();q(()=>x(C,`${pr[v(A).trapCategory]??""}罠`)),k(j,C)};H(W,j=>{v(A).trapCategory!==void 0&&j(U)})}var z=S(b,4),Z=g(z);{var te=j=>{var C=ed(),D=ne(C),V=g(D),Q=S(D,2),ce=g(Q);q(()=>{x(V,v(A).attack??"?"),x(ce,v(A).defense??"?")}),k(j,C)};H(Z,j=>{v(A).kind==="Monster"&&j(te)})}var oe=S(J,2),_e=S(oe,2);q(j=>{pe(J,`${j??""} svelte-vivzk2`),x(xe,v(A).name)},[()=>{var j,C;return`deck_editor_card duel_card ${v(A).kind} ${(C=(j=v(A))==null?void 0:j.monsterCategories)==null?void 0:C.join(" ")} ${Di.has(v(A).name)?"is_implemented":"is_not_implemented"}`}],Se),Pe("mouseenter",J,()=>a()(v(A))),Pe("click",oe,j=>u(j,v(A))),Pe("click",_e,j=>d(j,v(A))),k(K,Y)}),q(()=>x($,na[v(w)])),k(T,F)}),q(()=>x(m,tl[v(y)])),k(p,l)}),k(r,f),Re()}var ad=E('<div class="duel_card_info_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"><pre class="description svelte-1xf9hqi"> </pre></div></div> <div class="duel_card_info_row svelte-1xf9hqi" style=" justify-content: space-between;"><div class="svelte-1xf9hqi"> </div> <div class="svelte-1xf9hqi"> </div></div>',1),sd=E('<div></div> <div class="svelte-1xf9hqi"> </div>',1),ld=E("<div> </div>"),od=E("<div> </div>"),cd=E('<div class="duel_card_info_row svelte-1xf9hqi"><!> <!></div> <div class="duel_card_info_row svelte-1xf9hqi"></div>',1),dd=E('<div class="duel_card_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"></div> <div class="svelte-1xf9hqi"> </div></div>'),ud=E('<div class="duel_card_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"></div> <div class="svelte-1xf9hqi"> </div></div>'),fd=E('<div class="duel_card_info_row svelte-1xf9hqi"><div class="svelte-1xf9hqi">※テスト用カードです</div></div>'),vd=E('<div class="duel_card_info_links svelte-1xf9hqi"><a target="_blank" rel="noopener noreferrer" title="遊戯王カードWiki" class="svelte-1xf9hqi">⇒遊戯王カードWiki</a></div>'),pd=E('<div><div class="duel_card_info_header svelte-1xf9hqi"><div class="duel_card_info_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"> </div></div> <div class="duel_card_info_row svelte-1xf9hqi" style="position:sticky; top:0;"><div class="svelte-1xf9hqi"> </div> <div class="svelte-1xf9hqi"> </div></div></div> <div class="duel_card_info_body svelte-1xf9hqi"><!> <!> <div class="duel_card_info_row description svelte-1xf9hqi"><div class="svelte-1xf9hqi"><pre class="description svelte-1xf9hqi"> </pre></div></div> <!></div></div>');function hd(r,e){Ne(e,!1);let t=ye(e,"cardInfo",8,void 0);const i=()=>t()?Ue[t().name]:void 0;Ye();var n=Te(),a=ne(n);{var s=o=>{var u=pd(),d=g(u),f=g(d),p=g(f),y=g(p),l=S(f,2),h=g(l),m=g(h),_=S(h,2),T=g(_),w=S(d,2),F=g(w);{var R=b=>{var P=ad(),X=ne(P),re=g(X),se=g(re),le=g(se),N=S(X,2),G=g(N),B=g(G),O=S(G,2),L=g(O);q(()=>{x(le,Ue[t().name].pendulumDescription),x(B,`◀ ${t().pendulumScaleL??""}`),x(L,`${t().pendulumScaleR??""} ▶`)}),k(b,P)};H(F,b=>{var P;(P=t().monsterCategories)!=null&&P.includes("Pendulum")&&b(R)})}var $=S(F,2);{var M=b=>{var P=cd(),X=ne(P),re=g(X);{var se=B=>{var O=sd(),L=ne(O),I=S(L,2),W=g(I);q(()=>{pe(L,`monster_attr ${t().attribute??""} svelte-1xf9hqi`),x(W,`${Ui[t().attribute]??""}属性`)}),k(B,O)};H(re,B=>{t().attribute&&B(se)})}var le=S(re,2);{var N=B=>{var O=ld(),L=g(O);q(()=>{pe(O,`monster_cat ${t().type??""} svelte-1xf9hqi`),x(L,`${hr[t().type]??""}${Xr[t().type]??""}族`)}),k(B,O)};H(le,B=>{t().type&&B(N)})}var G=S(X,2);ve(G,5,()=>t().monsterCategories??[],fe,(B,O)=>{var L=od(),I=g(L);q(()=>{pe(L,`monster_cat ${v(O)??""} svelte-1xf9hqi`),x(I,`${fr[v(O)]??""}${Jr[v(O)]??""}`)}),k(B,L)}),k(b,P)},K=b=>{var P=Te(),X=ne(P);{var re=le=>{var N=dd(),G=S(g(N),2),B=g(G);q(()=>x(B,`${vr[t().spellCategory]??""}魔法`)),k(le,N)},se=le=>{var N=Te(),G=ne(N);{var B=O=>{var L=ud(),I=S(g(L),2),W=g(I);q(()=>x(W,`${pr[t().trapCategory]??""}罠`)),k(O,L)};H(G,O=>{t().kind==="Trap"&&t().trapCategory&&O(B)},!0)}k(le,N)};H(X,le=>{t().kind==="Spell"&&t().spellCategory?le(re):le(se,!1)},!0)}k(b,P)};H($,b=>{t().kind==="Monster"?b(M):b(K,!1)})}var A=S($,2),Y=g(A),J=g(Y),ue=g(J),we=S(A,2);{var xe=b=>{var P=fd();k(b,P)},ee=b=>{var P=vd(),X=g(P);q(re=>Wt(X,"href",re),[()=>{var re;return(re=i())==null?void 0:re.wikiHref}],Se),k(b,P)};H(we,b=>{t().isForTest?b(xe):b(ee,!1)})}q((b,P,X,re)=>{pe(u,`duel_card duel_card_info ${t().kind??""} ${b??""} svelte-1xf9hqi`),x(y,t().name),x(m,P),x(T,X),x(ue,re)},[()=>{var b;return(b=t().monsterCategories)==null?void 0:b.join(" ")},()=>"★".repeat(t().level||0),()=>"☆".repeat(t().rank||0),()=>{var b;return(b=i())==null?void 0:b.description}],Se),k(o,u)};H(a,o=>{t()&&o(s)})}k(r,n),Re()}const yd={0:{aaa:"日",aaaa:"日曜日",ddd:"Sun",dddd:"Sunday"},1:{aaa:"月",aaaa:"月曜日",ddd:"Mon",dddd:"Monday"},2:{aaa:"火",aaaa:"火曜日",ddd:"Tue",dddd:"Tuesday"},3:{aaa:"水",aaaa:"水曜日",ddd:"Wed",dddd:"Wednesday"},4:{aaa:"木",aaaa:"木曜日",ddd:"Thu",dddd:"Thursday"},5:{aaa:"金",aaaa:"金曜日",ddd:"Fri",dddd:"Friday"},6:{aaa:"土",aaaa:"土曜日",ddd:"Sat",dddd:"Saturday"}};class gd{constructor(){c(this,"DefaultSeparator1","/");c(this,"DefaultSeparator2"," ");c(this,"DefaultSeparator3",":");c(this,"createDate",e=>{if(!e)return;const t=new Date(e);if(!isNaN(t.getTime()))return t});c(this,"createDateOr",(e,t)=>this.createDate(e)||t||new Date);c(this,"truncateDate",e=>{const t=e||new Date;return new Date(t.getFullYear(),t.getMonth(),t.getDate())});c(this,"addDate",(e,t)=>{const i=this.createDateOr(e);return i.setDate(i.getDate()+t),i});c(this,"addMonth",(e,t)=>{const i=this.createDateOr(e);return i.setMonth(i.getMonth()+t),i});c(this,"addYear",(e,t)=>{const i=this.createDateOr(e);return i.setFullYear(i.getFullYear()+t),i});c(this,"getDayOfWeek",(e,t="dddd")=>{const i=this.createDate(e);return i?yd[i.getDay()][t]:""});c(this,"formatToYYYYMMDD",(e,t=this.DefaultSeparator1)=>{const i=this.createDate(e);if(!i)return"";const n=i.getFullYear().toString(),a=("0"+(i.getMonth()+1)).slice(-2),s=("0"+i.getDate()).slice(-2);return n+t+a+t+s});c(this,"formatToYYYYMM",(e,t=this.DefaultSeparator1)=>{const i=this.createDate(e);if(!i)return"";t||(t="");const n=i.getFullYear().toString(),a=("0"+(i.getMonth()+1)).slice(-2);return n+t+a});c(this,"formatToHHMMSS",(e,t=this.DefaultSeparator3)=>{const i=this.createDate(e);if(!i)return"";t||(t="");const n=i.getHours(),a=i.getMinutes(),s=i.getSeconds();return("0"+n).slice(-2)+t+("0"+a).slice(-2)+t+("0"+s).slice(-2)});c(this,"formatToHHMM",(e,t=this.DefaultSeparator3)=>{const i=this.createDate(e);if(!i)return"";t||(t="");const n=("0"+i.getHours()).slice(-2),a=("0"+i.getMinutes()).slice(-2);return n+t+a});c(this,"formatToYYYYMMDD_HHMM",(e,t=this.DefaultSeparator1,i=this.DefaultSeparator2,n=this.DefaultSeparator3)=>{const a=this.createDate(e);return a?this.formatToYYYYMMDD(a,t)+i+this.formatToHHMM(a,n):""});c(this,"formatToYYYYMMDD_HHMMSS",(e,t=this.DefaultSeparator1,i=this.DefaultSeparator2,n=this.DefaultSeparator3)=>{const a=this.createDate(e);return a?this.formatToYYYYMMDD(a,t)+i+this.formatToHHMMSS(a,n):""})}}const Xe=new gd;Date.prototype.truncateDate=function(){return Xe.truncateDate(this)};Date.prototype.getCloneOr=function(r){return Xe.createDateOr(this,r)};Date.prototype.addDate=function(r){return Xe.addDate(this,r)};Date.prototype.addMonth=function(r){return Xe.addDate(this,r)};Date.prototype.addYear=function(r){return Xe.addDate(this,r)};Date.prototype.getDayOfWeek=function(r="dddd"){return Xe.getDayOfWeek(this,r)};Date.prototype.formatToYYYYMM=function(r){return Xe.formatToYYYYMM(this,r)};Date.prototype.formatToYYYYMMDD=function(r){return Xe.formatToYYYYMMDD(this,r)};Date.prototype.formatToYYYYMMDD_HHMM=function(r,e,t){return Xe.formatToYYYYMMDD_HHMM(this,r,e,t)};Date.prototype.formatToYYYYMMDD_HHMMSS=function(r,e,t){return Xe.formatToYYYYMMDD_HHMMSS(this,r,e,t)};Date.prototype.formatToHHMM=function(r){return Xe.formatToHHMM(this,r)};Date.prototype.formatToHHMMSS=function(r){return Xe.formatToHHMMSS(this,r)};var md=E('<label><input type="checkbox"> </label>'),_d=E('<label><input type="checkbox"> </label>'),Sd=E('<label><input type="checkbox"> <div style="display: inline-block;"></div> </label>'),wd=E('<label><input type="checkbox"> </label>'),kd=E('<label><input type="checkbox"> </label>'),Td=E('<label><input type="checkbox"> </label>'),bd=E("<option> </option>"),Cd=E('<div class="deck_editor_body_right_header svelte-rsq0rf"><div class="deck_editor_body_right_header_row svelte-rsq0rf"><div class="svelte-rsq0rf">編集対象</div> <select></select></div> <div class="deck_editor_body_right_header_row svelte-rsq0rf"><div class="svelte-rsq0rf">新規名称</div> <input type="text"></div> <div class="deck_editor_body_right_header_row svelte-rsq0rf"><div class="svelte-rsq0rf">操作</div> <div class="svelte-rsq0rf"><button class="svelte-rsq0rf">デッキを保存</button></div> <div class="svelte-rsq0rf"></div> <div class="svelte-rsq0rf"><button class="svelte-rsq0rf">デッキを複製</button></div> <div class="svelte-rsq0rf"><button title="shiftキー押下で確認メッセージスキップ" class="svelte-rsq0rf">デッキを削除</button></div></div></div> <!>',1),Ed=E("<div>デッキ情報読込中</div>"),Dd=E('<div class="deck_editor svelte-rsq0rf"><div class="deck_editor_header"></div> <div class="deck_editor_body svelte-rsq0rf"><div class="deck_editor_body_left svelte-rsq0rf"><div class="deck_editor_search_box svelte-rsq0rf"><div><div>検索条件</div></div> <div class="deck_editor_search_box_row svelte-rsq0rf"><div class="svelte-rsq0rf">名称</div> <div class="svelte-rsq0rf"><input type="text" style="width:70%">※ルビには対応していません</div></div> <div class="deck_editor_search_box_row svelte-rsq0rf"><div class="svelte-rsq0rf">種類</div> <div class="svelte-rsq0rf"></div></div> <div class="deck_editor_search_box_row svelte-rsq0rf"><div class="svelte-rsq0rf">モンスター</div> <div class="svelte-rsq0rf"></div></div> <div class="deck_editor_search_box_row svelte-rsq0rf"><div class="svelte-rsq0rf">属性</div> <div class="svelte-rsq0rf"></div></div> <div class="deck_editor_search_box_row svelte-rsq0rf"><div class="svelte-rsq0rf">種族</div> <div class="svelte-rsq0rf"></div></div> <div class="deck_editor_search_box_row svelte-rsq0rf"><div class="svelte-rsq0rf">魔法</div> <div class="svelte-rsq0rf"></div></div> <div class="deck_editor_search_box_row svelte-rsq0rf"><div class="svelte-rsq0rf">罠</div> <div class="svelte-rsq0rf"></div></div> <div class="deck_editor_search_box_row svelte-rsq0rf"><div class="svelte-rsq0rf">テスト用</div> <div class="svelte-rsq0rf"><label><input type="checkbox"> テスト用カードを表示する</label></div></div></div> <!></div> <div class="deck_editor_body_center svelte-rsq0rf"><!></div> <div class="deck_editor_body_right svelte-rsq0rf"><!></div></div></div>');function Ad(r,e){Ne(e,!1);const t=[],i=[],n=[],a=[],s=[],o=[],u=async()=>{const D=(await v(p)).find(V=>V.id===v(f));D&&ie(l,{...D,cardInfos:D.cardNames.map(V=>Ue[V])})},d=()=>At.getAllDeckInfo().then(C=>(C.forEach(D=>console.log(D.id,D.lastUsedAt,D.lastUsedAt.getTime())),console.log(Math.max(...C.map(D=>D.lastUsedAt.getTime()))),ie(f,(C.find(D=>D.lastUsedAt.getTime()===Math.max(...C.map(V=>V.lastUsedAt.getTime())))??C[0]).id),C));let f=De(-1),p=De(d());v(p).then(u);const y=()=>{ie(p,d()),u()};let l=De({id:-Number.MAX_VALUE,name:"",description:"",lastUsedAt:new Date,cardInfos:[]}),h=De(Ue.ゾンビーノ);const m=De({name:"",cardKinds:[...wi],monsterCategories:[...rn].filter(C=>C!=="Normal"&&C!=="Token"),monsterAttributes:[...nn],monsterTypes:[...an],spellCategories:[...sn],trapCategories:[...ln],isForTest:!1}),_=()=>Object.values(Ue).filter(C=>{if(!v(m).cardKinds.includes(C.kind)||v(m).name.trim().length&&!C.name.includes(v(m).name)||C.isForTest&&!v(m).isForTest)return!1;if(C.kind==="Monster")return C.attribute&&!v(m).monsterAttributes.includes(C.attribute)||C.type&&!v(m).monsterTypes.includes(C.type)||!C.monsterCategories?!1:C.monsterCategories.union(v(m).monsterCategories).length;if(C.kind==="Spell")return C.spellCategory&&v(m).spellCategories.includes(C.spellCategory);if(C.kind==="Trap")return C.trapCategory&&v(m).trapCategories.includes(C.trapCategory)}),T=C=>{ie(h,C)},w=async()=>{const D=(await v(p)).find(V=>V.id===v(f));if(!D)throw new Error("illegal state");return D},F=async()=>{const C=await w();await C.saveDeckInfo({...C,name:v(l).name,cardNames:v(l).cardInfos.map(D=>D.name),lastUsedAt:new Date}),y()},R=async()=>{(await At.createNewDeck(`デッキ_${new Date().formatToYYYYMMDD_HHMMSS("","","")}`,`コピー日時：${new Date().formatToYYYYMMDD_HHMMSS("-"," ",":")}`,v(l).cardInfos.map(D=>D.name))).saveDeckInfo(),y()},$=async C=>{const D=await w();!C.shiftKey&&!confirm(`デッキ【${D.name}】を削除します。
よろしいですか？`)||(await D.delete(),y())};Ye();var M=Dd(),K=S(g(M),2),A=g(K),Y=g(A),J=S(g(Y),2),ue=S(g(J),2),we=g(ue),xe=S(J,2),ee=S(g(xe),2);ve(ee,5,()=>wi,fe,(C,D)=>{var V=md(),Q=g(V),ce,ke=S(Q);q(()=>{ce!==(ce=v(D))&&(Q.value=(Q.__value=v(D))==null?"":v(D)),x(ke,` ${na[v(D)]??""}`)}),Ht(t,[],Q,()=>(v(D),v(m).cardKinds),Ae=>je(m,v(m).cardKinds=Ae)),k(C,V)});var b=S(xe,2),P=S(g(b),2);ve(P,5,()=>rn,fe,(C,D)=>{var V=_d(),Q=g(V),ce,ke=S(Q);q(()=>{ce!==(ce=v(D))&&(Q.value=(Q.__value=v(D))==null?"":v(D)),x(ke,` ${fr[v(D)]??""}${Jr[v(D)]??""}`)}),Ht(i,[],Q,()=>(v(D),v(m).monsterCategories),Ae=>je(m,v(m).monsterCategories=Ae)),k(C,V)});var X=S(b,2),re=S(g(X),2);ve(re,5,()=>nn,fe,(C,D)=>{var V=Sd(),Q=g(V),ce,ke=S(Q,2),Ae=S(ke);q(()=>{ce!==(ce=v(D))&&(Q.value=(Q.__value=v(D))==null?"":v(D)),pe(ke,`monster_attr ${v(h).attribute??""} svelte-rsq0rf`),x(Ae,` ${Ui[v(D)]??""}`)}),Ht(n,[],Q,()=>(v(D),v(m).monsterAttributes),tt=>je(m,v(m).monsterAttributes=tt)),k(C,V)});var se=S(X,2),le=S(g(se),2);ve(le,5,()=>an,fe,(C,D)=>{var V=wd(),Q=g(V),ce,ke=S(Q);q(()=>{ce!==(ce=v(D))&&(Q.value=(Q.__value=v(D))==null?"":v(D)),x(ke,` ${hr[v(D)]??""}
                ${Xr[v(D)]??""}`)}),Ht(a,[],Q,()=>(v(D),v(m).monsterTypes),Ae=>je(m,v(m).monsterTypes=Ae)),k(C,V)});var N=S(se,2),G=S(g(N),2);ve(G,5,()=>sn,fe,(C,D)=>{var V=kd(),Q=g(V),ce,ke=S(Q);q(()=>{ce!==(ce=v(D))&&(Q.value=(Q.__value=v(D))==null?"":v(D)),x(ke,` ${vr[v(D)]??""}`)}),Ht(s,[],Q,()=>(v(D),v(m).spellCategories),Ae=>je(m,v(m).spellCategories=Ae)),k(C,V)});var B=S(N,2),O=S(g(B),2);ve(O,5,()=>ln,fe,(C,D)=>{var V=Td(),Q=g(V),ce,ke=S(Q);q(()=>{ce!==(ce=v(D))&&(Q.value=(Q.__value=v(D))==null?"":v(D)),x(ke,` ${pr[v(D)]??""}`)}),Ht(o,[],Q,()=>(v(D),v(m).trapCategories),Ae=>je(m,v(m).trapCategories=Ae)),k(C,V)});var L=S(B,2),I=S(g(L),2),W=g(I),U=g(W),z=S(Y,2);hd(z,{get cardInfo(){return v(h)}});var Z=S(A,2),te=g(Z);const oe=Se(_);mn(te,{mode:"List",get allCardInfos(){return v(oe)},onAttention:T,get deckCardInfos(){return v(l).cardInfos},set deckCardInfos(C){je(l,v(l).cardInfos=C)},$$legacy:!0});var _e=S(Z,2),j=g(_e);yi(j,()=>v(p),C=>{var D=Ed();k(C,D)},(C,D)=>{var V=Cd(),Q=ne(V),ce=g(Q),ke=S(g(ce),2);q(()=>{v(f),Jn(()=>{v(D)})}),ve(ke,5,()=>v(D),fe,(kt,mr)=>{var _r=bd(),Zi={},ha=g(_r);q(()=>{Zi!==(Zi=v(mr).id)&&(_r.value=(_r.__value=v(mr).id)==null?"":v(mr).id),x(ha,v(mr).name)}),k(kt,_r)});var Ae=S(ce,2),tt=S(g(Ae),2),er=S(Ae,2),Bt=S(g(er),2),qt=g(Bt),st=S(Bt,4),gr=g(st),ii=S(st,2),ni=g(ii),pa=S(Q,2);mn(pa,{mode:"Deck",allCardInfos:[],onAttention:T,get deckCardInfos(){return v(l).cardInfos},set deckCardInfos(kt){je(l,v(l).cardInfos=kt)},$$legacy:!0}),ra(ke,()=>v(f),kt=>ie(f,kt)),Pe("change",ke,u),mi(tt,()=>v(l).name,kt=>je(l,v(l).name=kt)),Pe("click",qt,F),Pe("click",gr,R),Pe("click",ni,$),k(C,V)}),mi(we,()=>v(m).name,C=>je(m,v(m).name=C)),Hs(U,()=>v(m).isForTest,C=>je(m,v(m).isForTest=C)),k(r,M),Re()}const xd="2025-03-24 12:54:53",Md={timestamp:xd},Pd=["TblDeckHeader","TblDeckDetail","TblDuelistProfile"],Fd=3;var Bd=E("<option> </option>"),qd=E('<div class="svelte-bc2zvv"><label for="deck_selector" class="deck_selector svelte-bc2zvv">デッキ：</label> <select id="deck_selector" class="deck_selector svelte-bc2zvv"></select></div> <div class="svelte-bc2zvv"><button class="btn svelte-bc2zvv">duel start!</button></div>',1),Od=E('<div class="svelte-bc2zvv">デッキ情報の読み込み、もしくは作成中...</div>'),Nd=E('<div class="svelte-bc2zvv"><label for="duelist_name" class="duelist_name svelte-bc2zvv">名前：</label> <input id="duelist_name" class="duelist_name svelte-bc2zvv" type="text"></div> <!> <div class="svelte-bc2zvv"><button class="btn svelte-bc2zvv">deck edit</button></div>',1),Rd=E('<div class="svelte-bc2zvv">デュエリスト情報の読み込み、もしくは作成中...</div>'),Ld=E('<div class="app_body svelte-bc2zvv"><!></div>'),Hd=E('<main class="svelte-bc2zvv"><!> <div class="debug_info svelte-bc2zvv"><span> </span> <span class="screen_info"></span></div></main>');function $d(r,e){Ne(e,!1);const t=new Qs("stk_ygo_svelte",Fd,Pd);let i=De(),n=De("None"),a=De(0);const s=Si.getOrCreateNew(t);let o=De(At.getAllDeckInfo(t).then(M=>(Promise.all(M.filter(K=>!K.lastUsedAt).map(K=>{K.saveDeckInfo()})),ie(a,(M.find(K=>K.lastUsedAt.getTime()===Math.max(...M.map(A=>A.lastUsedAt.getTime())))??M[0]).id),M)));const u=async()=>{let M=(await v(o)).find(K=>K.id===v(a));if(M||(M=(await f()).find(K=>K.id===v(a))),!M)throw new Error("illegal state");return M},d=async()=>{(await s).save()},f=()=>(ie(o,At.getAllDeckInfo(t).then(M=>(ie(a,(M.find(K=>K.lastUsedAt.getTime()===Math.max(...M.map(A=>A.lastUsedAt.getTime())))??M[0]).id),M))),v(o)),p=async()=>{(await v(o)).length||(await At.prepareSampleDeck(),f())},y=async()=>{await Promise.all([d(),p()]),(await u()).updateTimestamp(),ie(i,new zl(await s,"Player",await u(),Is[0],"NPC",Dr[0]))},l=async()=>{console.log("hoge"),await Promise.all([d(),p()]),ie(n,"DeckEdit")},h=async M=>{await d(),M.key==="Enter"&&!M.repeat&&(await s).save()};p(),Ye();var m=Hd(),_=g(m);{var T=M=>{Xc(M,{get duel(){return v(i)}})},w=M=>{var K=Te(),A=ne(K);{var Y=ue=>{Ad(ue,{})},J=ue=>{var we=Ld(),xe=g(we);yi(xe,()=>s,ee=>{var b=Rd();k(ee,b)},(ee,b)=>{var P=Nd(),X=ne(P),re=S(g(X),2),se=S(X,2);yi(se,()=>v(o),G=>{var B=Od();k(G,B)},(G,B)=>{var O=qd(),L=ne(O),I=S(g(L),2);q(()=>{v(a),Jn(()=>{v(B)})}),ve(I,5,()=>v(B),fe,(z,Z)=>{var te=Bd(),oe={},_e=g(te);q(()=>{oe!==(oe=v(Z).id)&&(te.value=(te.__value=v(Z).id)==null?"":v(Z).id),x(_e,v(Z).name)}),k(z,te)});var W=S(L,2),U=g(W);ra(I,()=>v(a),z=>ie(a,z)),Pe("click",U,y),k(G,O)});var le=S(se,2),N=g(le);mi(re,()=>v(b).name,G=>v(b).name=G),Pe("keypress",re,h),Pe("click",N,l),k(ee,P)}),k(ue,we)};H(A,ue=>{v(n)==="DeckEdit"?ue(Y):ue(J,!1)},!0)}k(M,K)};H(_,M=>{v(i)?M(T):M(w,!1)})}var F=S(_,2),R=g(F),$=g(R);q(()=>x($,`build at: ${Md.timestamp}`)),k(r,m),Re()}Cs($d,{target:document.getElementById("app")});
