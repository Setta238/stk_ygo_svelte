var Pl=Object.defineProperty;var xl=(e,t,i)=>t in e?Pl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var c=(e,t,i)=>xl(e,typeof t!="symbol"?t+"":t,i);import{j as Fl}from"./json.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function i(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(a){if(a.ep)return;a.ep=!0;const n=i(a);fetch(a.href,n)}})();const aa=!1;var wa=Array.isArray,Bl=Array.prototype.indexOf,Ea=Array.from,Ol=Object.defineProperty,wi=Object.getOwnPropertyDescriptor,An=Object.getOwnPropertyDescriptors,Ll=Object.prototype,Nl=Array.prototype,Da=Object.getPrototypeOf;function ql(e){return typeof e=="function"}const Kt=()=>{};function Rl(e){return typeof(e==null?void 0:e.then)=="function"}function $l(e){return e()}function na(e){for(var t=0;t<e.length;t++)e[t]()}const Dt=2,Pn=4,Fr=8,Br=16,Wt=32,Ii=64,gr=128,Et=256,yr=512,gt=1024,Yt=2048,Bi=4096,Gt=8192,Or=16384,xn=32768,Lr=65536,Fn=1<<17,Hl=1<<19,Bn=1<<20,zt=Symbol("$state"),jl=Symbol("legacy props"),Zl=Symbol("");function On(e){return e===this.v}function Ln(e,t){return e!=e?t==t:e!==t||e!==null&&typeof e=="object"||typeof e=="function"}function Ma(e){return!Ln(e,this.v)}function Ul(e){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Gl(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function zl(e){throw new Error("https://svelte.dev/e/effect_orphan")}function Vl(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Wl(e){throw new Error("https://svelte.dev/e/props_invalid_value")}function Yl(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Ql(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Kl(){throw new Error("https://svelte.dev/e/state_unsafe_local_read")}function Xl(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let er=!1,Jl=!1;function Il(){er=!0}const Aa=1,Pa=2,Nn=4,eo=8,to=16,io=1,ro=2,ao=4,no=8,so=16,lo=1,oo=2,co=4,uo=1,fo=2,lt=Symbol();let et=null;function _r(e){et=e}function ot(e,t=!1,i){et={p:et,c:null,e:null,m:!1,s:e,x:null,l:null},er&&!t&&(et.l={s:null,u:null,r1:[],r2:vt(!1)})}function ct(e){const t=et;if(t!==null){const s=t.e;if(s!==null){var i=Ze,r=Ge;t.e=null;try{for(var a=0;a<s.length;a++){var n=s[a];At(n.effect),Mt(n.reaction),Ni(n.fn)}}finally{At(i),Mt(r)}}et=t.p,t.m=!0}return{}}function Oi(){return!er||et!==null&&et.l===null}function vt(e,t){var i={f:0,v:e,reactions:null,equals:On,rv:0,wv:0};return i}function vo(e){return qn(vt(e))}function Wi(e,t=!1){var r;const i=vt(e);return t||(i.equals=Ma),er&&et!==null&&et.l!==null&&((r=et.l).s??(r.s=[])).push(i),i}function Pe(e,t=!1){return qn(Wi(e,t))}function qn(e){return Ge!==null&&!Lt&&Ge.f&Dt&&(qt===null?To([e]):qt.push(e)),e}function Ye(e,t){return L(e,$t(()=>u(e))),t}function L(e,t){return Ge!==null&&!Lt&&Oi()&&Ge.f&(Dt|Br)&&(qt===null||!qt.includes(e))&&Xl(),ei(e,t)}function ei(e,t){return e.equals(t)||(e.v,e.v=t,e.wv=is(),Rn(e,Yt),Oi()&&Ze!==null&&Ze.f&gt&&!(Ze.f&(Wt|Ii))&&(jt===null?wo([e]):jt.push(e))),t}function Rn(e,t){var i=e.reactions;if(i!==null)for(var r=Oi(),a=i.length,n=0;n<a;n++){var s=i[n],l=s.f;l&Yt||!r&&s===Ze||(Ht(s,t),l&(gt|Et)&&(l&Dt?Rn(s,Bi):Hr(s)))}}let $n=!1;function Xt(e,t=null,i){if(typeof e!="object"||e===null||zt in e)return e;const r=Da(e);if(r!==Ll&&r!==Nl)return e;var a=new Map,n=wa(e),s=vt(0);n&&a.set("length",vt(e.length));var l;return new Proxy(e,{defineProperty(d,o,f){(!("value"in f)||f.configurable===!1||f.enumerable===!1||f.writable===!1)&&Yl();var v=a.get(o);return v===void 0?(v=vt(f.value),a.set(o,v)):L(v,Xt(f.value,l)),!0},deleteProperty(d,o){var f=a.get(o);if(f===void 0)o in d&&a.set(o,vt(lt));else{if(n&&typeof o=="string"){var v=a.get("length"),p=Number(o);Number.isInteger(p)&&p<v.v&&L(v,p)}L(f,lt),Qa(s)}return!0},get(d,o,f){var m;if(o===zt)return e;var v=a.get(o),p=o in d;if(v===void 0&&(!p||(m=wi(d,o))!=null&&m.writable)&&(v=vt(Xt(p?d[o]:lt,l)),a.set(o,v)),v!==void 0){var y=u(v);return y===lt?void 0:y}return Reflect.get(d,o,f)},getOwnPropertyDescriptor(d,o){var f=Reflect.getOwnPropertyDescriptor(d,o);if(f&&"value"in f){var v=a.get(o);v&&(f.value=u(v))}else if(f===void 0){var p=a.get(o),y=p==null?void 0:p.v;if(p!==void 0&&y!==lt)return{enumerable:!0,configurable:!0,value:y,writable:!0}}return f},has(d,o){var y;if(o===zt)return!0;var f=a.get(o),v=f!==void 0&&f.v!==lt||Reflect.has(d,o);if(f!==void 0||Ze!==null&&(!v||(y=wi(d,o))!=null&&y.writable)){f===void 0&&(f=vt(v?Xt(d[o],l):lt),a.set(o,f));var p=u(f);if(p===lt)return!1}return v},set(d,o,f,v){var E;var p=a.get(o),y=o in d;if(n&&o==="length")for(var m=f;m<p.v;m+=1){var C=a.get(m+"");C!==void 0?L(C,lt):m in d&&(C=vt(lt),a.set(m+"",C))}p===void 0?(!y||(E=wi(d,o))!=null&&E.writable)&&(p=vt(void 0),L(p,Xt(f,l)),a.set(o,p)):(y=p.v!==lt,L(p,Xt(f,l)));var g=Reflect.getOwnPropertyDescriptor(d,o);if(g!=null&&g.set&&g.set.call(v,f),!y){if(n&&typeof o=="string"){var T=a.get("length"),k=Number(o);Number.isInteger(k)&&k>=T.v&&L(T,k+1)}Qa(s)}return!0},ownKeys(d){u(s);var o=Reflect.ownKeys(d).filter(p=>{var y=a.get(p);return y===void 0||y.v!==lt});for(var[f,v]of a)v.v!==lt&&!(f in d)&&o.push(f);return o},setPrototypeOf(){Ql()}})}function Qa(e,t=1){L(e,e.v+t)}function Ka(e){return e!==null&&typeof e=="object"&&zt in e?e[zt]:e}function Hn(e,t){return Object.is(Ka(e),Ka(t))}var Xa,jn,Zn,Un;function po(){if(Xa===void 0){Xa=window,jn=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype;Zn=wi(t,"firstChild").get,Un=wi(t,"nextSibling").get,e.__click=void 0,e.__className="",e.__attributes=null,e.__styles=null,e.__e=void 0,Text.prototype.__t=void 0}}function Nr(e=""){return document.createTextNode(e)}function mr(e){return Zn.call(e)}function qr(e){return Un.call(e)}function h(e,t){return mr(e)}function I(e,t){{var i=mr(e);return i instanceof Comment&&i.data===""?qr(i):i}}function _(e,t=1,i=!1){let r=e;for(;t--;)r=qr(r);return r}function ho(e){e.textContent=""}function Yi(e){var t=Dt|Yt,i=Ge!==null&&Ge.f&Dt?Ge:null;return Ze===null||i!==null&&i.f&Et?t|=Et:Ze.f|=Bn,{ctx:et,deps:null,effects:null,equals:On,f:t,fn:e,reactions:null,rv:0,v:null,wv:0,parent:i??Ze}}function Te(e){const t=Yi(e);return t.equals=Ma,t}function Gn(e){var t=e.effects;if(t!==null){e.effects=null;for(var i=0;i<t.length;i+=1)ii(t[i])}}function go(e){for(var t=e.parent;t!==null;){if(!(t.f&Dt))return t;t=t.parent}return null}function yo(e){var t,i=Ze;At(go(e));try{Gn(e),t=as(e)}finally{At(i)}return t}function zn(e){var t=yo(e),i=(It||e.f&Et)&&e.deps!==null?Bi:gt;Ht(e,i),e.equals(t)||(e.v=t,e.wv=is())}function Vn(e){Ze===null&&Ge===null&&zl(),Ge!==null&&Ge.f&Et&&Ze===null&&Gl(),Fa&&Ul()}function _o(e,t){var i=t.last;i===null?t.last=t.first=e:(i.next=e,e.prev=i,t.last=e)}function Li(e,t,i,r=!0){var a=(e&Ii)!==0,n=Ze,s={ctx:et,deps:null,nodes_start:null,nodes_end:null,f:e|Yt,first:null,fn:t,last:null,next:null,parent:a?null:n,prev:null,teardown:null,transitions:null,wv:0};if(i){var l=Ei;try{Ia(!0),Ba(s),s.f|=xn}catch(f){throw ii(s),f}finally{Ia(l)}}else t!==null&&Hr(s);var d=i&&s.deps===null&&s.first===null&&s.nodes_start===null&&s.teardown===null&&(s.f&(Bn|gr))===0;if(!d&&!a&&r&&(n!==null&&_o(s,n),Ge!==null&&Ge.f&Dt)){var o=Ge;(o.effects??(o.effects=[])).push(s)}return s}function Wn(e){const t=Li(Fr,null,!1);return Ht(t,gt),t.teardown=e,t}function Ja(e){Vn();var t=Ze!==null&&(Ze.f&Wt)!==0&&et!==null&&!et.m;if(t){var i=et;(i.e??(i.e=[])).push({fn:e,effect:Ze,reaction:Ge})}else{var r=Ni(e);return r}}function mo(e){return Vn(),tr(e)}function So(e){const t=Li(Ii,e,!0);return(i={})=>new Promise(r=>{i.outro?oi(t,()=>{ii(t),r(void 0)}):(ii(t),r(void 0))})}function Ni(e){return Li(Pn,e,!1)}function tr(e){return Li(Fr,e,!0)}function M(e,t=[],i=Yi){const r=t.map(i);return Rr(()=>e(...r.map(u)))}function Rr(e,t=0){return Li(Fr|Br|t,e,!0)}function ui(e,t=!0){return Li(Fr|Wt,e,!0,t)}function Yn(e){var t=e.teardown;if(t!==null){const i=Fa,r=Ge;en(!0),Mt(null);try{t.call(null)}finally{en(i),Mt(r)}}}function Qn(e,t=!1){var i=e.first;for(e.first=e.last=null;i!==null;){var r=i.next;ii(i,t),i=r}}function Co(e){for(var t=e.first;t!==null;){var i=t.next;t.f&Wt||ii(t),t=i}}function ii(e,t=!0){var i=!1;if((t||e.f&Hl)&&e.nodes_start!==null){for(var r=e.nodes_start,a=e.nodes_end;r!==null;){var n=r===a?null:qr(r);r.remove(),r=n}i=!0}Qn(e,t&&!i),br(e,0),Ht(e,Or);var s=e.transitions;if(s!==null)for(const d of s)d.stop();Yn(e);var l=e.parent;l!==null&&l.first!==null&&Kn(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes_start=e.nodes_end=null}function Kn(e){var t=e.parent,i=e.prev,r=e.next;i!==null&&(i.next=r),r!==null&&(r.prev=i),t!==null&&(t.first===e&&(t.first=r),t.last===e&&(t.last=i))}function oi(e,t){var i=[];xa(e,i,!0),Xn(i,()=>{ii(e),t&&t()})}function Xn(e,t){var i=e.length;if(i>0){var r=()=>--i||t();for(var a of e)a.out(r)}else t()}function xa(e,t,i){if(!(e.f&Gt)){if(e.f^=Gt,e.transitions!==null)for(const s of e.transitions)(s.is_global||i)&&t.push(s);for(var r=e.first;r!==null;){var a=r.next,n=(r.f&Lr)!==0||(r.f&Wt)!==0;xa(r,t,n?i:!1),r=a}}}function Pi(e){Jn(e,!0)}function Jn(e,t){if(e.f&Gt){e.f^=Gt,e.f&gt||(e.f^=gt),ir(e)&&(Ht(e,Yt),Hr(e));for(var i=e.first;i!==null;){var r=i.next,a=(i.f&Lr)!==0||(i.f&Wt)!==0;Jn(i,a?t:!1),i=r}if(e.transitions!==null)for(const n of e.transitions)(n.is_global||t)&&n.in()}}let Sr=!1,sa=[];function In(){Sr=!1;const e=sa.slice();sa=[],na(e)}function fi(e){Sr||(Sr=!0,queueMicrotask(In)),sa.push(e)}function bo(){Sr&&In()}const es=0,ko=1;let vr=!1,pr=es,Qi=!1,Ki=null,Ei=!1,Fa=!1;function Ia(e){Ei=e}function en(e){Fa=e}let li=[],Di=0;let Ge=null,Lt=!1;function Mt(e){Ge=e}let Ze=null;function At(e){Ze=e}let qt=null;function To(e){qt=e}let pt=null,bt=0,jt=null;function wo(e){jt=e}let ts=1,Cr=0,It=!1,Jt=null;function is(){return++ts}function ir(e){var v;var t=e.f;if(t&Yt)return!0;if(t&Bi){var i=e.deps,r=(t&Et)!==0;if(i!==null){var a,n,s=(t&yr)!==0,l=r&&Ze!==null&&!It,d=i.length;if(s||l){var o=e,f=o.parent;for(a=0;a<d;a++)n=i[a],(s||!((v=n==null?void 0:n.reactions)!=null&&v.includes(o)))&&(n.reactions??(n.reactions=[])).push(o);s&&(o.f^=yr),l&&f!==null&&!(f.f&Et)&&(o.f^=Et)}for(a=0;a<d;a++)if(n=i[a],ir(n)&&zn(n),n.wv>e.wv)return!0}(!r||Ze!==null&&!It)&&Ht(e,gt)}return!1}function Eo(e,t){for(var i=t;i!==null;){if(i.f&gr)try{i.fn(e);return}catch{i.f^=gr}i=i.parent}throw vr=!1,e}function Do(e){return(e.f&Or)===0&&(e.parent===null||(e.parent.f&gr)===0)}function $r(e,t,i,r){if(vr){if(i===null&&(vr=!1),Do(t))throw e;return}i!==null&&(vr=!0);{Eo(e,t);return}}function rs(e,t,i=!0){var r=e.reactions;if(r!==null)for(var a=0;a<r.length;a++){var n=r[a];n.f&Dt?rs(n,t,!1):t===n&&(i?Ht(n,Yt):n.f&gt&&Ht(n,Bi),Hr(n))}}function as(e){var y;var t=pt,i=bt,r=jt,a=Ge,n=It,s=qt,l=et,d=Lt,o=e.f;pt=null,bt=0,jt=null,Ge=o&(Wt|Ii)?null:e,It=(o&Et)!==0&&(!Ei||a===null||d),qt=null,_r(e.ctx),Lt=!1,Cr++;try{var f=(0,e.fn)(),v=e.deps;if(pt!==null){var p;if(br(e,bt),v!==null&&bt>0)for(v.length=bt+pt.length,p=0;p<pt.length;p++)v[bt+p]=pt[p];else e.deps=v=pt;if(!It)for(p=bt;p<v.length;p++)((y=v[p]).reactions??(y.reactions=[])).push(e)}else v!==null&&bt<v.length&&(br(e,bt),v.length=bt);if(Oi()&&jt!==null&&!Lt&&v!==null&&!(e.f&(Dt|Bi|Yt)))for(p=0;p<jt.length;p++)rs(jt[p],e);return a!==null&&Cr++,f}finally{pt=t,bt=i,jt=r,Ge=a,It=n,qt=s,_r(l),Lt=d}}function Mo(e,t){let i=t.reactions;if(i!==null){var r=Bl.call(i,e);if(r!==-1){var a=i.length-1;a===0?i=t.reactions=null:(i[r]=i[a],i.pop())}}i===null&&t.f&Dt&&(pt===null||!pt.includes(t))&&(Ht(t,Bi),t.f&(Et|yr)||(t.f^=yr),Gn(t),br(t,0))}function br(e,t){var i=e.deps;if(i!==null)for(var r=t;r<i.length;r++)Mo(e,i[r])}function Ba(e){var t=e.f;if(!(t&Or)){Ht(e,gt);var i=Ze,r=et;Ze=e;try{t&Br?Co(e):Qn(e),Yn(e);var a=as(e);e.teardown=typeof a=="function"?a:null,e.wv=ts;var n=e.deps,s;aa&&Jl&&e.f&Yt}catch(l){$r(l,e,i,r||e.ctx)}finally{Ze=i}}}function ns(){if(Di>1e3){Di=0;try{Vl()}catch(e){if(Ki!==null)$r(e,Ki,null);else throw e}}Di++}function ss(e){var t=e.length;if(t!==0){ns();var i=Ei;Ei=!0;try{for(var r=0;r<t;r++){var a=e[r];a.f&gt||(a.f^=gt);var n=xo(a);Ao(n)}}finally{Ei=i}}}function Ao(e){var t=e.length;if(t!==0)for(var i=0;i<t;i++){var r=e[i];if(!(r.f&(Or|Gt)))try{ir(r)&&(Ba(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null?Kn(r):r.fn=null))}catch(a){$r(a,r,null,r.ctx)}}}function Po(){if(Qi=!1,Di>1001)return;const e=li;li=[],ss(e),Qi||(Di=0,Ki=null)}function Hr(e){pr===es&&(Qi||(Qi=!0,queueMicrotask(Po))),Ki=e;for(var t=e;t.parent!==null;){t=t.parent;var i=t.f;if(i&(Ii|Wt)){if(!(i&gt))return;t.f^=gt}}li.push(t)}function xo(e){var t=[],i=e.first;e:for(;i!==null;){var r=i.f,a=(r&Wt)!==0,n=a&&(r&gt)!==0,s=i.next;if(!n&&!(r&Gt)){if(r&Pn)t.push(i);else if(a)i.f^=gt;else{var l=Ge;try{Ge=i,ir(i)&&Ba(i)}catch(f){$r(f,i,null,i.ctx)}finally{Ge=l}}var d=i.first;if(d!==null){i=d;continue}}if(s===null){let f=i.parent;for(;f!==null;){if(e===f)break e;var o=f.next;if(o!==null){i=o;continue e}f=f.parent}}i=s}return t}function Oa(e){var t=pr,i=li;try{ns();const a=[];pr=ko,li=a,Qi=!1,ss(i);var r=e==null?void 0:e();return bo(),(li.length>0||a.length>0)&&Oa(),Di=0,Ki=null,r}finally{pr=t,li=i}}async function Fo(){await Promise.resolve(),Oa()}function u(e){var t=e.f,i=(t&Dt)!==0;if(Jt!==null&&Jt.add(e),Ge!==null&&!Lt){qt!==null&&qt.includes(e)&&Kl();var r=Ge.deps;e.rv<Cr&&(e.rv=Cr,pt===null&&r!==null&&r[bt]===e?bt++:pt===null?pt=[e]:(!It||!pt.includes(e))&&pt.push(e))}else if(i&&e.deps===null&&e.effects===null){var a=e,n=a.parent;n!==null&&!(n.f&Et)&&(a.f^=Et)}return i&&(a=e,ir(a)&&zn(a)),e.v}function Bo(e){var t=Jt;Jt=new Set;var i=Jt,r;try{if($t(e),t!==null)for(r of Jt)t.add(r)}finally{Jt=t}return i}function $i(e){var t=Bo(()=>$t(e));for(var i of t)if(i.f&Fn)for(const r of i.deps||[])r.f&Dt||ei(r,r.v);else ei(i,i.v)}function $t(e){var t=Lt;try{return Lt=!0,e()}finally{Lt=t}}const Oo=-7169;function Ht(e,t){e.f=e.f&Oo|t}function Lo(e){if(!(typeof e!="object"||!e||e instanceof EventTarget)){if(zt in e)la(e);else if(!Array.isArray(e))for(let t in e){const i=e[t];typeof i=="object"&&i&&zt in i&&la(i)}}}function la(e,t=new Set){if(typeof e=="object"&&e!==null&&!(e instanceof EventTarget)&&!t.has(e)){t.add(e),e instanceof Date&&e.getTime();for(let r in e)try{la(e[r],t)}catch{}const i=Da(e);if(i!==Object.prototype&&i!==Array.prototype&&i!==Map.prototype&&i!==Set.prototype&&i!==Date.prototype){const r=An(i);for(let a in r){const n=r[a].get;if(n)try{n.call(e)}catch{}}}}}const No=["touchstart","touchmove"];function qo(e){return No.includes(e)}let tn=!1;function Ro(){tn||(tn=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{var t;if(!e.defaultPrevented)for(const i of e.target.elements)(t=i.__on_r)==null||t.call(i)})},{capture:!0}))}function La(e){var t=Ge,i=Ze;Mt(null),At(null);try{return e()}finally{Mt(t),At(i)}}function jr(e,t,i,r=i){e.addEventListener(t,()=>La(i));const a=e.__on_r;a?e.__on_r=()=>{a(),r(!0)}:e.__on_r=()=>r(!0),Ro()}const ls=new Set,oa=new Set;function $o(e,t,i,r={}){function a(n){if(r.capture||Hi.call(t,n),!n.cancelBubble)return La(()=>i==null?void 0:i.call(this,n))}return e.startsWith("pointer")||e.startsWith("touch")||e==="wheel"?fi(()=>{t.addEventListener(e,a,r)}):t.addEventListener(e,a,r),a}function Me(e,t,i,r,a){var n={capture:r,passive:a},s=$o(e,t,i,n);(t===document.body||t===window||t===document)&&Wn(()=>{t.removeEventListener(e,s,n)})}function qi(e){for(var t=0;t<e.length;t++)ls.add(e[t]);for(var i of oa)i(e)}function Hi(e){var k;var t=this,i=t.ownerDocument,r=e.type,a=((k=e.composedPath)==null?void 0:k.call(e))||[],n=a[0]||e.target,s=0,l=e.__root;if(l){var d=a.indexOf(l);if(d!==-1&&(t===document||t===window)){e.__root=t;return}var o=a.indexOf(t);if(o===-1)return;d<=o&&(s=d)}if(n=a[s]||e.target,n!==t){Ol(e,"currentTarget",{configurable:!0,get(){return n||i}});var f=Ge,v=Ze;Mt(null),At(null);try{for(var p,y=[];n!==null;){var m=n.assignedSlot||n.parentNode||n.host||null;try{var C=n["__"+r];if(C!==void 0&&!n.disabled)if(wa(C)){var[g,...T]=C;g.apply(n,[e,...T])}else C.call(n,e)}catch(E){p?y.push(E):p=E}if(e.cancelBubble||m===t||m===null)break;n=m}if(p){for(let E of y)queueMicrotask(()=>{throw E});throw p}}finally{e.__root=t,delete e.currentTarget,Mt(f),At(v)}}}function Ho(e){var t=document.createElement("template");return t.innerHTML=e,t.content}function kr(e,t){var i=Ze;i.nodes_start===null&&(i.nodes_start=e,i.nodes_end=t)}function b(e,t){var i=(t&uo)!==0,r=(t&fo)!==0,a,n=!e.startsWith("<!>");return()=>{a===void 0&&(a=Ho(n?e:"<!>"+e),i||(a=mr(a)));var s=r||jn?document.importNode(a,!0):a.cloneNode(!0);if(i){var l=mr(s),d=s.lastChild;kr(l,d)}else kr(s,s);return s}}function ai(e=""){{var t=Nr(e+"");return kr(t,t),t}}function Ne(){var e=document.createDocumentFragment(),t=document.createComment(""),i=Nr();return e.append(t,i),kr(t,i),e}function S(e,t){e!==null&&e.before(t)}let ca=!0;function D(e,t){var i=t==null?"":typeof t=="object"?t+"":t;i!==(e.__t??(e.__t=e.nodeValue))&&(e.__t=i,e.nodeValue=i+"")}function jo(e,t){return Zo(e,t)}const mi=new Map;function Zo(e,{target:t,anchor:i,props:r={},events:a,context:n,intro:s=!0}){po();var l=new Set,d=v=>{for(var p=0;p<v.length;p++){var y=v[p];if(!l.has(y)){l.add(y);var m=qo(y);t.addEventListener(y,Hi,{passive:m});var C=mi.get(y);C===void 0?(document.addEventListener(y,Hi,{passive:m}),mi.set(y,1)):mi.set(y,C+1)}}};d(Ea(ls)),oa.add(d);var o=void 0,f=So(()=>{var v=i??t.appendChild(Nr());return ui(()=>{if(n){ot({});var p=et;p.c=n}a&&(r.$$events=a),ca=s,o=e(v,r)||{},ca=!0,n&&ct()}),()=>{var m;for(var p of l){t.removeEventListener(p,Hi);var y=mi.get(p);--y===0?(document.removeEventListener(p,Hi),mi.delete(p)):mi.set(p,y)}oa.delete(d),v!==i&&((m=v.parentNode)==null||m.removeChild(v))}});return Uo.set(o,f),o}let Uo=new WeakMap;const Qr=0,cr=1,Kr=2;function Zi(e,t,i,r,a){var n=e,s=Oi(),l=et,d=lt,o,f,v,p=(s?vt:Wi)(void 0),y=(s?vt:Wi)(void 0),m=!1;function C(T,k){m=!0,k&&(At(g),Mt(g),_r(l));try{T===Qr&&i&&(o?Pi(o):o=ui(()=>i(n))),T===cr&&r&&(f?Pi(f):f=ui(()=>r(n,p))),T!==Qr&&o&&oi(o,()=>o=null),T!==cr&&f&&oi(f,()=>f=null),T!==Kr&&v&&oi(v,()=>v=null)}finally{k&&(_r(null),Mt(null),At(null),Oa())}}var g=Rr(()=>{if(d!==(d=t())){if(Rl(d)){var T=d;m=!1,T.then(k=>{T===d&&(ei(p,k),C(cr,!0))},k=>{if(T===d)throw ei(y,k),C(Kr,!0),y.v}),fi(()=>{m||C(Qr,!0)})}else ei(p,d),C(cr,!1);return()=>d=lt}})}function q(e,t,i=!1){var r=e,a=null,n=null,s=lt,l=i?Lr:0,d=!1;const o=(v,p=!0)=>{d=!0,f(p,v)},f=(v,p)=>{s!==(s=v)&&(s?(a?Pi(a):p&&(a=ui(()=>p(r))),n&&oi(n,()=>{n=null})):(n?Pi(n):p&&(n=ui(()=>p(r))),a&&oi(a,()=>{a=null})))};Rr(()=>{d=!1,t(o),d||f(null,null)},l)}function le(e,t){return t}function Go(e,t,i,r){for(var a=[],n=t.length,s=0;s<n;s++)xa(t[s].e,a,!0);var l=n>0&&a.length===0&&i!==null;if(l){var d=i.parentNode;ho(d),d.append(i),r.clear(),Qt(e,t[0].prev,t[n-1].next)}Xn(a,()=>{for(var o=0;o<n;o++){var f=t[o];l||(r.delete(f.k),Qt(e,f.prev,f.next)),ii(f.e,!l)}})}function oe(e,t,i,r,a,n=null){var s=e,l={flags:t,items:new Map,first:null},d=(t&Nn)!==0;if(d){var o=e;s=o.appendChild(Nr())}var f=null,v=!1,p=Te(()=>{var y=i();return wa(y)?y:y==null?[]:Ea(y)});Rr(()=>{var y=u(p),m=y.length;v&&m===0||(v=m===0,zo(y,l,s,a,t,r,i),n!==null&&(m===0?f?Pi(f):f=ui(()=>n(s)):f!==null&&oi(f,()=>{f=null})),u(p))})}function zo(e,t,i,r,a,n,s){var R,x,U,X;var l=(a&eo)!==0,d=(a&(Aa|Pa))!==0,o=e.length,f=t.items,v=t.first,p=v,y,m=null,C,g=[],T=[],k,E,F,Z;if(l)for(Z=0;Z<o;Z+=1)k=e[Z],E=n(k,Z),F=f.get(E),F!==void 0&&((R=F.a)==null||R.measure(),(C??(C=new Set)).add(F));for(Z=0;Z<o;Z+=1){if(k=e[Z],E=n(k,Z),F=f.get(E),F===void 0){var ee=p?p.e.nodes_start:i;m=Wo(ee,t,m,m===null?t.first:m.next,k,E,Z,r,a,s),f.set(E,m),g=[],T=[],p=m.next;continue}if(d&&Vo(F,k,Z,a),F.e.f&Gt&&(Pi(F.e),l&&((x=F.a)==null||x.unfix(),(C??(C=new Set)).delete(F))),F!==p){if(y!==void 0&&y.has(F)){if(g.length<T.length){var J=T[0],N;m=J.prev;var ie=g[0],K=g[g.length-1];for(N=0;N<g.length;N+=1)rn(g[N],J,i);for(N=0;N<T.length;N+=1)y.delete(T[N]);Qt(t,ie.prev,K.next),Qt(t,m,ie),Qt(t,K,J),p=J,m=K,Z-=1,g=[],T=[]}else y.delete(F),rn(F,p,i),Qt(t,F.prev,F.next),Qt(t,F,m===null?t.first:m.next),Qt(t,m,F),m=F;continue}for(g=[],T=[];p!==null&&p.k!==E;)p.e.f&Gt||(y??(y=new Set)).add(p),T.push(p),p=p.next;if(p===null)continue;F=p}g.push(F),m=F,p=F.next}if(p!==null||y!==void 0){for(var W=y===void 0?[]:Ea(y);p!==null;)p.e.f&Gt||W.push(p),p=p.next;var Re=W.length;if(Re>0){var Y=a&Nn&&o===0?i:null;if(l){for(Z=0;Z<Re;Z+=1)(U=W[Z].a)==null||U.measure();for(Z=0;Z<Re;Z+=1)(X=W[Z].a)==null||X.fix()}Go(t,W,Y,f)}}l&&fi(()=>{var re;if(C!==void 0)for(F of C)(re=F.a)==null||re.apply()}),Ze.first=t.first&&t.first.e,Ze.last=m&&m.e}function Vo(e,t,i,r){r&Aa&&ei(e.v,t),r&Pa?ei(e.i,i):e.i=i}function Wo(e,t,i,r,a,n,s,l,d,o){var f=(d&Aa)!==0,v=(d&to)===0,p=f?v?Wi(a):vt(a):a,y=d&Pa?vt(s):s,m={i:y,v:p,k:n,a:null,e:null,prev:i,next:r};try{return m.e=ui(()=>l(e,p,y,o),$n),m.e.prev=i&&i.e,m.e.next=r&&r.e,i===null?t.first=m:(i.next=m,i.e.next=m.e),r!==null&&(r.prev=m,r.e.prev=m.e),m}finally{}}function rn(e,t,i){for(var r=e.next?e.next.e.nodes_start:i,a=t?t.e.nodes_start:i,n=e.e.nodes_start;n!==r;){var s=qr(n);a.before(n),n=s}}function Qt(e,t,i){t===null?e.first=i:(t.next=i,t.e.next=i&&i.e),i!==null&&(i.prev=t,i.e.prev=t&&t.e)}function os(e){var t,i,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var a=e.length;for(t=0;t<a;t++)e[t]&&(i=os(e[t]))&&(r&&(r+=" "),r+=i)}else for(i in e)e[i]&&(r&&(r+=" "),r+=i);return r}function Yo(){for(var e,t,i=0,r="",a=arguments.length;i<a;i++)(e=arguments[i])&&(t=os(e))&&(r&&(r+=" "),r+=t);return r}function Si(e){return typeof e=="object"?Yo(e):e??""}function Vt(e,t,i,r){var a=e.__attributes??(e.__attributes={});a[t]!==(a[t]=i)&&(t==="style"&&"__styles"in e&&(e.__styles={}),t==="loading"&&(e[Zl]=i),i==null?e.removeAttribute(t):typeof i!="string"&&Qo(e).includes(t)?e[t]=i:e.setAttribute(t,i))}var an=new Map;function Qo(e){var t=an.get(e.nodeName);if(t)return t;an.set(e.nodeName,t=[]);for(var i,r=e,a=Element.prototype;a!==r;){i=An(r);for(var n in i)i[n].set&&t.push(n);r=Da(r)}return t}function De(e,t,i){var r=e.__className,a=Ko(t,i);(r!==a||$n)&&(t==null&&!i?e.removeAttribute("class"):e.className=a,e.__className=a)}function Ko(e,t){return(e??"")+(t?" "+t:"")}const Xo=()=>performance.now(),Ut={tick:e=>requestAnimationFrame(e),now:()=>Xo(),tasks:new Set};function cs(){const e=Ut.now();Ut.tasks.forEach(t=>{t.c(e)||(Ut.tasks.delete(t),t.f())}),Ut.tasks.size!==0&&Ut.tick(cs)}function Jo(e){let t;return Ut.tasks.size===0&&Ut.tick(cs),{promise:new Promise(i=>{Ut.tasks.add(t={c:e,f:i})}),abort(){Ut.tasks.delete(t)}}}function dr(e,t){La(()=>{e.dispatchEvent(new CustomEvent(t))})}function Io(e){if(e==="float")return"cssFloat";if(e==="offset")return"cssOffset";if(e.startsWith("--"))return e;const t=e.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(i=>i[0].toUpperCase()+i.slice(1)).join("")}function nn(e){const t={},i=e.split(";");for(const r of i){const[a,n]=r.split(":");if(!a||n===void 0)break;const s=Io(a.trim());t[s]=n.trim()}return t}const ec=e=>e;function ni(e,t,i,r){var a=(e&lo)!==0,n=(e&oo)!==0,s=a&&n,l=(e&co)!==0,d=s?"both":a?"in":"out",o,f=t.inert,v=t.style.overflow,p,y;function m(){var E=Ge,F=Ze;Mt(null),At(null);try{return o??(o=i()(t,(r==null?void 0:r())??{},{direction:d}))}finally{Mt(E),At(F)}}var C={is_global:l,in(){var E;if(t.inert=f,!a){y==null||y.abort(),(E=y==null?void 0:y.reset)==null||E.call(y);return}n||p==null||p.abort(),dr(t,"introstart"),p=da(t,m(),y,1,()=>{dr(t,"introend"),p==null||p.abort(),p=o=void 0,t.style.overflow=v})},out(E){if(!n){E==null||E(),o=void 0;return}t.inert=!0,dr(t,"outrostart"),y=da(t,m(),p,0,()=>{dr(t,"outroend"),E==null||E()})},stop:()=>{p==null||p.abort(),y==null||y.abort()}},g=Ze;if((g.transitions??(g.transitions=[])).push(C),a&&ca){var T=l;if(!T){for(var k=g.parent;k&&k.f&Lr;)for(;(k=k.parent)&&!(k.f&Br););T=!k||(k.f&xn)!==0}T&&Ni(()=>{$t(()=>C.in())})}}function da(e,t,i,r,a){var n=r===1;if(ql(t)){var s,l=!1;return fi(()=>{if(!l){var g=t({direction:n?"in":"out"});s=da(e,g,i,r,a)}}),{abort:()=>{l=!0,s==null||s.abort()},deactivate:()=>s.deactivate(),reset:()=>s.reset(),t:()=>s.t()}}if(i==null||i.deactivate(),!(t!=null&&t.duration))return a(),{abort:Kt,deactivate:Kt,reset:Kt,t:()=>r};const{delay:d=0,css:o,tick:f,easing:v=ec}=t;var p=[];if(n&&i===void 0&&(f&&f(0,1),o)){var y=nn(o(0,1));p.push(y,y)}var m=()=>1-r,C=e.animate(p,{duration:d});return C.onfinish=()=>{var g=(i==null?void 0:i.t())??1-r;i==null||i.abort();var T=r-g,k=t.duration*Math.abs(T),E=[];if(k>0){var F=!1;if(o)for(var Z=Math.ceil(k/16.666666666666668),ee=0;ee<=Z;ee+=1){var J=g+T*v(ee/Z),N=nn(o(J,1-J));E.push(N),F||(F=N.overflow==="hidden")}F&&(e.style.overflow="hidden"),m=()=>{var ie=C.currentTime;return g+T*v(ie/k)},f&&Jo(()=>{if(C.playState!=="running")return!1;var ie=m();return f(ie,1-ie),!0})}C=e.animate(E,{duration:k,fill:"forwards"}),C.onfinish=()=>{m=()=>r,f==null||f(r,1-r),a()}},{abort:()=>{C&&(C.cancel(),C.effect=null,C.onfinish=Kt)},deactivate:()=>{a=Kt},reset:()=>{r===0&&(f==null||f(1,0))},t:()=>m()}}function ua(e,t,i=t){var r=Oi();jr(e,"input",a=>{var n=a?e.defaultValue:e.value;if(n=Jr(e)?Ir(n):n,i(n),r&&n!==(n=t())){var s=e.selectionStart,l=e.selectionEnd;e.value=n??"",l!==null&&(e.selectionStart=s,e.selectionEnd=Math.min(l,e.value.length))}}),$t(t)==null&&e.value&&i(Jr(e)?Ir(e.value):e.value),tr(()=>{var a=t();Jr(e)&&a===Ir(e.value)||e.type==="date"&&!a&&!e.value||a!==e.value&&(e.value=a??"")})}const Xr=new Set;function Ci(e,t,i,r,a=r){var n=i.getAttribute("type")==="checkbox",s=e;if(t!==null)for(var l of t)s=s[l]??(s[l]=[]);s.push(i),jr(i,"change",()=>{var d=i.__value;n&&(d=ic(s,d,i.checked)),a(d)},()=>a(n?[]:null)),tr(()=>{var d=r();n?(d=d||[],i.checked=d.includes(i.__value)):i.checked=Hn(i.__value,d)}),Wn(()=>{var d=s.indexOf(i);d!==-1&&s.splice(d,1)}),Xr.has(s)||(Xr.add(s),fi(()=>{s.sort((d,o)=>d.compareDocumentPosition(o)===4?-1:1),Xr.delete(s)})),fi(()=>{})}function tc(e,t,i=t){jr(e,"change",r=>{var a=r?e.defaultChecked:e.checked;i(a)}),$t(t)==null&&i(e.checked),tr(()=>{var r=t();e.checked=!!r})}function ic(e,t,i){for(var r=new Set,a=0;a<e.length;a+=1)e[a].checked&&r.add(e[a].__value);return i||r.delete(t),Array.from(r)}function Jr(e){var t=e.type;return t==="number"||t==="range"}function Ir(e){return e===""?null:+e}function ds(e,t,i){if(e.multiple)return ac(e,t);for(var r of e.options){var a=Ui(r);if(Hn(a,t)){r.selected=!0;return}}(!i||t!==void 0)&&(e.selectedIndex=-1)}function rc(e,t){Ni(()=>{var i=new MutationObserver(()=>{var r=e.__value;ds(e,r)});return i.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{i.disconnect()}})}function ji(e,t,i=t){var r=!0;jr(e,"change",a=>{var n=a?"[selected]":":checked",s;if(e.multiple)s=[].map.call(e.querySelectorAll(n),Ui);else{var l=e.querySelector(n)??e.querySelector("option:not([disabled])");s=l&&Ui(l)}i(s)}),Ni(()=>{var a=t();if(ds(e,a,r),r&&a===void 0){var n=e.querySelector(":checked");n!==null&&(a=Ui(n),i(a))}e.__value=a,r=!1}),rc(e)}function ac(e,t){for(var i of e.options)i.selected=~t.indexOf(Ui(i))}function Ui(e){return"__value"in e?e.__value:e.value}function sn(e,t){return e===t||(e==null?void 0:e[zt])===t}function nc(e={},t,i,r){return Ni(()=>{var a,n;return tr(()=>{a=n,n=[],$t(()=>{e!==i(...n)&&(t(e,...n),a&&sn(i(...a),e)&&t(null,...a))})}),()=>{fi(()=>{n&&sn(i(...n),e)&&t(null,...n)})}}),e}function St(e=!1){const t=et,i=t.l.u;if(!i)return;let r=()=>Lo(t.s);if(e){let a=0,n={};const s=Yi(()=>{let l=!1;const d=t.s;for(const o in d)d[o]!==n[o]&&(n[o]=d[o],l=!0);return l&&a++,a});r=()=>u(s)}i.b.length&&mo(()=>{ln(t,r),na(i.b)}),Ja(()=>{const a=$t(()=>i.m.map($l));return()=>{for(const n of a)typeof n=="function"&&n()}}),i.a.length&&Ja(()=>{ln(t,r),na(i.a)})}function ln(e,t){if(e.l.s)for(const i of e.l.s)u(i);t()}const bi=[];function sc(e,t=Kt){let i=null;const r=new Set;function a(l){if(Ln(e,l)&&(e=l,i)){const d=!bi.length;for(const o of r)o[1](),bi.push(o,e);if(d){for(let o=0;o<bi.length;o+=2)bi[o][0](bi[o+1]);bi.length=0}}}function n(l){a(l(e))}function s(l,d=Kt){const o=[l,d];return r.add(o),r.size===1&&(i=t(a,n)||Kt),l(e),()=>{r.delete(o),r.size===0&&i&&(i(),i=null)}}return{set:a,update:n,subscribe:s}}let ur=!1;function lc(e){var t=ur;try{return ur=!1,[e(),ur]}finally{ur=t}}function qe(e,t,i,r){var J;var a=(i&io)!==0,n=!er||(i&ro)!==0,s=(i&no)!==0,l=(i&so)!==0,d=!1,o;s?[o,d]=lc(()=>e[t]):o=e[t];var f=zt in e||jl in e,v=s&&(((J=wi(e,t))==null?void 0:J.set)??(f&&t in e&&(N=>e[t]=N)))||void 0,p=r,y=!0,m=!1,C=()=>(m=!0,y&&(y=!1,l?p=$t(r):p=r),p);o===void 0&&r!==void 0&&(v&&n&&Wl(),o=C(),v&&v(o));var g;if(n)g=()=>{var N=e[t];return N===void 0?C():(y=!0,m=!1,N)};else{var T=(a?Yi:Te)(()=>e[t]);T.f|=Fn,g=()=>{var N=u(T);return N!==void 0&&(p=void 0),N===void 0?p:N}}if(!(i&ao))return g;if(v){var k=e.$$legacy;return function(N,ie){return arguments.length>0?((!n||!ie||k||d)&&v(ie?g():N),N):g()}}var E=!1,F=!1,Z=Wi(o),ee=Yi(()=>{var N=g(),ie=u(Z);return E?(E=!1,F=!0,ie):(F=!1,Z.v=N)});return a||(ee.equals=Ma),function(N,ie){if(Jt!==null&&(E=F,g(),u(Z)),arguments.length>0){const K=ie?u(ee):n&&s?Xt(N):N;return ee.equals(K)||(E=!0,L(Z,K),m&&p!==void 0&&(p=K),$t(()=>u(ee))),N}return u(ee)}}const oc="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(oc);Il();class cc{constructor(t,i,r){c(this,"_dbname");c(this,"_dbversion");c(this,"dbPromise");c(this,"getTran",async(t,i)=>(await this.dbPromise).transaction(t,i));c(this,"reset",async()=>(await indexedDB.databases().then(t=>{console.log(t)}),await new Promise((t,i)=>{const r=indexedDB.deleteDatabase(this._dbname);r.onsuccess=()=>{console.log("onsuccess"),t()},r.onerror=a=>{console.log("onerror"),i(a)}})));c(this,"getAll",async t=>{const i=await this.dbPromise;return new Promise((r,a)=>{const l=i.transaction([t],"readonly").objectStore(t).getAll();l.onsuccess=()=>{r(l.result)},l.onerror=d=>{a(d)}})});c(this,"get",async(t,i)=>{const r=await this.dbPromise;return new Promise((a,n)=>{const d=r.transaction([t],"readonly").objectStore(t).get(i);d.onsuccess=()=>{a(d.result)},d.onerror=o=>{n(o)}})});c(this,"getMany",async(t,i)=>{const n=(await this.dbPromise).transaction([t],"readonly").objectStore(t),s=i.map(l=>new Promise((d,o)=>{const f=n.get(l);f.onsuccess=()=>{d(f.result)},f.onerror=v=>{o(v)}}));return await Promise.all(s)});c(this,"putRecords",async(t,i)=>{const a=(await this.dbPromise).transaction([t],"readwrite"),n=a.objectStore(t),s=i.map(l=>({record:l,request:n.put(l)}));return new Promise((l,d)=>{a.oncomplete=()=>l(s.map(o=>Object.assign({id:o.request.result},o.record))),a.onerror=o=>d(o)})});c(this,"deleteRecords",async(t,i)=>{const a=(await this.dbPromise).transaction([t],"readwrite"),n=a.objectStore(t),s=i.map(l=>({key:l,request:n.delete(l)}));return new Promise((l,d)=>{a.oncomplete=()=>{console.log(s.map(o=>o.request.result)),l()},a.onerror=o=>d(o)})});this._dbname=t,this._dbversion=i,this.dbPromise=new Promise((a,n)=>{const s=indexedDB.open(t,i);s.onsuccess=l=>{if(console.log(l),!l.target){console.log("event.target is undefined"),n("event.target is undefined");return}const d=l.target.result;if(!d){console.log("event.target.result is undefined"),n("event.target.result is undefined");return}d.onversionchange=o=>{console.log(o),d.close()},a(d)},s.onupgradeneeded=l=>{console.log("onupgradeneeded");const d=l.target.result;r.filter(o=>!d.objectStoreNames.contains(o)).map(o=>d.createObjectStore(o,{keyPath:"id",autoIncrement:!0}))},s.onerror=l=>{console.log(l),n(l)},s.onblocked=l=>{console.log(l),n(l)}}),console.log(this.dbPromise)}get dbversion(){return this._dbversion}}class Ie{constructor(){c(this,"handlers",[])}get length(){return this.handlers.length}append(t){this.handlers.push(t)}remove(t){this.handlers=this.handlers.filter(i=>i!==t)}trigger(t){this.handlers.slice(0).filter(i=>i(t)==="RemoveMe").forEach(i=>this.remove(i))}clear(){this.handlers.splice(0)}expose(){return this}}class on{constructor(){c(this,"handlers",[])}append(t){this.handlers.push(t)}remove(t){this.handlers=this.handlers.filter(i=>i!==t)}async trigger(t){(await Promise.all(this.handlers.slice(0).map(async r=>{const a=await r(t);return{h:r,result:a}}))).filter(r=>r.result==="RemoveMe").map(r=>r.h).forEach(r=>this.remove(r))}clear(){this.handlers.splice(0)}expose(){return this}}class cn{constructor(){c(this,"handler")}set(t){this.handler=t}async call(t){if(!this.handler)throw Error("illegal state error");return await this.handler(t)}expose(){return this}}class Na{constructor(t,i,r,a){c(this,"_name");c(this,"_createVersion");c(this,"mountResolver",()=>{});c(this,"_indexedDb");c(this,"onInsertEvent",new Ie);c(this,"onBeforeInsertEvent",new cn);c(this,"onUpdateEvent",new Ie);c(this,"onBeforeUpdateEvent",new cn);c(this,"onDeleteEvent",new Ie);c(this,"prepareInitialRecords",()=>{const t=new Date;return this._prepareInitialRecords().map(i=>Object.assign(i,{createdAt:t,updatedAt:t,dbVersion:this._createVersion}))});c(this,"resolveMount",()=>this.mountResolver());c(this,"patchForInsert",(t,i)=>{t.newRecords.forEach(r=>{i[r.id]=r})});c(this,"patchForUpdate",(t,i)=>{t.recordPairs.forEach(r=>{i[r.newRecord.id]={...r.newRecord}})});c(this,"patchForDelete",(t,i)=>{t.oldRecords.forEach(r=>{delete i[r.id]})});this._indexedDb=t,this._name=i,this._createVersion=t.dbversion,this.getAll().then(n=>n.reduce((s,l)=>(s[l.id]=l,s),{})).then(n=>{console.log(this.name,n),this.onBeforeInsertEvent.set(r??(()=>Promise.resolve())),this.onBeforeUpdateEvent.set(a??(()=>Promise.resolve()))})}get name(){return this._name}get createVersion(){return this._createVersion}get oninsert(){return this.onInsertEvent.expose()}get onbeforeinsert(){return this.onBeforeInsertEvent.expose()}get onupdate(){return this.onUpdateEvent.expose()}get onbeforeupdate(){return this.onBeforeUpdateEvent.expose()}get ondelete(){return this.onDeleteEvent.expose()}getAll(){return this._indexedDb.getAll(this.name)}get(t){return this._indexedDb.get(this.name,t)}async insertMany(t){const i=new Date,r=t.map(n=>{const s={createdAt:i,updatedAt:i,dbVersion:this._createVersion};return Object.assign(n,s)});await this.onBeforeInsertEvent.call({sender:this,newRecords:r,timestamp:i});const a=await this._indexedDb.putRecords(this.name,r);return this.onInsertEvent.trigger({sender:this,newRecords:a,timestamp:i}),a}async insert(t){return(await this.insertMany([t]))[0]}async updateMany(t,i){const r=new Date,a=[];return(await this._indexedDb.getMany(this.name,t)).forEach(s=>{const l={...s},d={...l};a.push({newRecord:Object.assign(i(d),{updatedAt:r,dbVersion:this._createVersion}),oldRecord:l})}),await this.onBeforeUpdateEvent.call({sender:this,recordPairs:a,timestamp:r}),await this._indexedDb.putRecords(this.name,a.map(s=>s.newRecord)),this.onUpdateEvent.trigger({sender:this,recordPairs:a,timestamp:r}),a.map(s=>s.newRecord)}async update(t,i){return(await this.updateMany([t],i))[0]}async delete(t){const i=new Date,r=await this._indexedDb.getMany(this.name,t);await this._indexedDb.deleteRecords(this.name,t),this.onDeleteEvent.trigger({sender:this,oldRecords:r,timestamp:i})}}const dc=["Deck","ExtraDeck"],uc={Deck:"メインデッキ",ExtraDeck:"エクストラデッキ"},fa=["Monster","Spell","Trap","XyzMaterial"],us={Monster:"モンスター",Spell:"魔法",Trap:"罠",XyzMaterial:"XYZ素材"},xi=["Fusion","Syncro","Xyz","Link"],fs=[...xi,"SpecialSummon","Ritual"],vs=[...fs,"NormalSummonOnly","RegularSpecialSummonOnly","FreeReborn"],fc=["Toon","Spirit","Union","Gemini","FlipEffect"],vc=["Tuner","Effect","Normal","Pendulum","Token"],dn=[...fc,...vc,...vs],Zr={Syncro:"シンクロ",Fusion:"融合",Xyz:"エクシーズ",Link:"リンク",Ritual:"儀式",SpecialSummon:"特殊召喚",Toon:"トゥーン",Spirit:"スピリット",Union:"ユニオン",Gemini:"デュアル",FlipEffect:"リバース",Tuner:"チューナー",Effect:"効果",Normal:"通常",Pendulum:"ペンデュラム",Token:"トークン",FreeReborn:"特殊召喚モンスター（蘇生制限なし）",NormalSummonOnly:"特殊召喚不可",RegularSpecialSummonOnly:"正規の方法以外での特殊召喚不可"},rr={Syncro:"🎵",Fusion:"🌀",Xyz:"📰",Link:"⛓️",Ritual:"📜",SpecialSummon:"🔯",Toon:"📖",Spirit:"👻",Union:"🚗",Gemini:"👫",FlipEffect:"🔄",Tuner:"🎶",Effect:"✨",Normal:"🔘",Pendulum:"💠",Token:"🐏",FreeReborn:"🆓",NormalSummonOnly:"🔲",RegularSpecialSummonOnly:"❗"},un=["Light","Dark","Earth","Water","Fire","Wind","Divine"],qa={Light:"光",Dark:"闇",Earth:"地",Water:"水",Fire:"炎",Wind:"風",Divine:"神"},fn=["Aqua","Beast","BeastWarrior","CreatorGod","Cyberse","Dinosaur","DivineBeast","Dragon","Fairy","Fiend","Fish","Insect","Illusion","Machine","Plant","Psychic","Pyro","Reptile","Rock","SeaSerpent","Spellcaster","Thunder","Warrior","WingedBeast","Wyrm","Zombie"],vn=["Normal","Continuous","Field","QuickPlay","Equip","Ritual","PendulumScale"],ar={Normal:"通常",Continuous:"永続",Field:"フィールド",QuickPlay:"速攻",Equip:"装備",Ritual:"儀式",PendulumScale:"ペンデュラム"},pn=["Normal","Continuous","Counter"],nr={Normal:"通常",Continuous:"永続",Counter:"カウンター"},Ue=["Attack","Defense"],fr={Attack:"攻撃表示",Defense:"守備表示",Set:"裏側守備表示"},ps=["level","rank","attack","defense","pendulumScaleR","pendulumScaleL"],Ur={Aqua:"水",Beast:"獣",BeastWarrior:"獣戦士",CreatorGod:"創造神",Cyberse:"サイバース",Dinosaur:"恐竜",DivineBeast:"幻獣神",Dragon:"ドラゴン",Fairy:"天使",Fiend:"悪魔",Fish:"魚",Insect:"昆虫",Illusion:"幻想魔",Machine:"機械",Plant:"植物",Psychic:"サイキック",Pyro:"炎",Reptile:"爬虫類",Rock:"岩石",SeaSerpent:"海竜",Spellcaster:"魔法使い",Thunder:"雷",Warrior:"戦士",WingedBeast:"鳥獣",Wyrm:"幻竜",Zombie:"アンデット"},sr={Aqua:"🚰",Beast:"🐅",BeastWarrior:"🦁",CreatorGod:"🔆",Cyberse:"💻️",Dinosaur:"🦖",DivineBeast:"💫",Dragon:"🐲",Fairy:"👼",Fiend:"👿",Fish:"🐟️",Insect:"🦋",Illusion:"🤡",Machine:"🤖",Plant:"🌱",Psychic:"👁️",Pyro:"🔥",Reptile:"🦎",Rock:"⛰",SeaSerpent:"🐍",Spellcaster:"🧙",Thunder:"⚡️",Warrior:"⚔️",WingedBeast:"🦅",Wyrm:"🐉",Zombie:"🦴"},pc=["TopLeft","TopCenter","TopRight","MiddleLeft","MiddleRight","BottomLeft","BottomCenter","BottomRight"],hs={TopLeft:{name:"左上",linkArrow:{offsetRow:-1,offsetColumn:-1}},TopCenter:{name:"上",linkArrow:{offsetRow:-1,offsetColumn:0}},TopRight:{name:"右上",linkArrow:{offsetRow:-1,offsetColumn:1}},MiddleLeft:{name:"左",linkArrow:{offsetRow:0,offsetColumn:-1}},MiddleRight:{name:"右",linkArrow:{offsetRow:0,offsetColumn:1}},BottomLeft:{name:"左下",linkArrow:{offsetRow:1,offsetColumn:-1}},BottomCenter:{name:"下",linkArrow:{offsetRow:1,offsetColumn:0}},BottomRight:{name:"右下",linkArrow:{offsetRow:1,offsetColumn:1}}};pc.reduce((e,t)=>(e[hs[t].name]=t,e),{});const hc=e=>e.cardId??!1?`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=2&cid=${e.cardId}`:`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=1&sess=1&rp=10&mode=&sort=1&keyword=${e.name}&stype=1&ctype=&othercon=2&starfr=&starto=&pscalefr=&pscaleto=&linkmarkerfr=&linkmarkerto=&link_m=2&atkfr=&atkto=&deffr=&defto=&releaseDStart=1&releaseMStart=1&releaseYStart=1999&releaseDEnd=&releaseMEnd=&releaseYEnd=`,Gi=(e,t)=>{const i=e.monsterCategories??[],r=t.monsterCategories??[];for(const a of xi.toReversed()){if(i.includes(a)&&!r.includes(a))return 1;if(!i.includes(a)&&r.includes(a))return-1}if(e.kind===t.kind){if(e.kind==="Monster"){if((e.link??0)!==(t.link??0))return(e.link??0)-(t.link??0);if((e.rank??0)!==(t.rank??0))return(e.rank??0)-(t.rank??0);if((e.level??0)!==(t.level??0))return(e.level??0)-(t.level??0);if((e.attack??0)!==(t.attack??0))return(e.attack??0)-(t.attack??0);if((e.defense??0)!==(t.defense??0))return(e.defense??0)-(t.defense??0)}return e.name.localeCompare(t.name,"Ja")}for(const a of fa){if(e.kind===a)return-1;if(t.kind===a)return 1}return e.name.localeCompare(t.name,"Ja")},gs=["Deck","ExtraDeck"],ys=["Graveyard","Banished"],_s=[...gs,...ys],gc=[..._s,"Hand"],yt=["MonsterZone","ExtraMonsterZone"],vi=["SpellAndTrapZone","FieldSpellZone"],ti=[...yt,...vi],ms=["XyzMaterialZone","Disable"],ci=[...gc,...ti,...ms],va={0:{0:"Hand"},1:{0:"Deck",1:"SpellAndTrapZone",2:"SpellAndTrapZone",3:"SpellAndTrapZone",4:"SpellAndTrapZone",5:"SpellAndTrapZone",6:"ExtraDeck"},2:{0:"Graveyard",1:"MonsterZone",2:"MonsterZone",3:"MonsterZone",4:"MonsterZone",5:"MonsterZone",6:"FieldSpellZone"},3:{0:"Banished",1:"XyzMaterialZone",2:"ExtraMonsterZone",3:"Disable",4:"ExtraMonsterZone",5:"XyzMaterialZone",6:"Banished"},4:{0:"FieldSpellZone",1:"MonsterZone",2:"MonsterZone",3:"MonsterZone",4:"MonsterZone",5:"MonsterZone",6:"Graveyard"},5:{0:"ExtraDeck",1:"SpellAndTrapZone",2:"SpellAndTrapZone",3:"SpellAndTrapZone",4:"SpellAndTrapZone",5:"SpellAndTrapZone",6:"Deck"},6:{0:"Hand"}};let yc=class{constructor(t,i,r,a){c(this,"onUpdateEvent",new Ie);c(this,"field");c(this,"row");c(this,"column");c(this,"cellType");c(this,"_owner");c(this,"_requiresRecalcLinkArrows");c(this,"_linkArrowSources");c(this,"_needsShuffle",!1);c(this,"recalcLinkArrows",()=>{this.isMonsterZoneLikeCell&&(this._requiresRecalcLinkArrows=!1,this._linkArrowSources=this.neighbors.filter(t=>t.isMonsterZoneLikeCell).filter(t=>t.cardEntities.length).filter(t=>t.cardEntities[0].linkArrows.some(i=>this.row===t.row+i.offsetRow&&this.column===t.column+i.offsetColumn)).map(t=>t.cardEntities[0]))});c(this,"_entities");c(this,"releaseEntities",t=>{var i;return this._entities=this._entities.filter(r=>r!==t),this.isMonsterZoneLikeCell&&((i=t.origin.monsterCategories)!=null&&i.includes("Link"))&&(this._requiresRecalcLinkArrows=!0),this.onUpdateEvent.trigger(),t});c(this,"acceptEntities",(t,i)=>{var r;i==="Top"?this._entities.unshift(t):this._entities.push(t),i==="Random"&&(this._needsShuffle=!0),this._entities.forEach(a=>{a.fieldCell=this}),this.isMonsterZoneLikeCell&&((r=t.origin.monsterCategories)!=null&&r.includes("Link"))&&(this._requiresRecalcLinkArrows=!0),this.onUpdateEvent.trigger()});c(this,"shuffle",()=>{this._entities=this.entities.shuffle(),this._needsShuffle=!1,this.field.duel.log.info("デッキをシャッフル。",this.owner)});c(this,"toString",()=>this.isMonsterZoneLikeCell||this.cellType==="SpellAndTrapZone"?`${this.cellType}(${this.row},${this.column})`:this.cellType);this.field=t,this.row=i,this.column=r,this.cellType=va[i][r],this._owner=a,this._entities=[],this._linkArrowSources=[],this._requiresRecalcLinkArrows=!1}get onUpdate(){return this.onUpdateEvent.expose()}get owner(){var t;return this._owner||((t=this.cardEntities[0])==null?void 0:t.owner)}get requiresRecalcLinkArrows(){return this._requiresRecalcLinkArrows}get linkArrowSources(){return this._linkArrowSources}get needsShuffle(){return this._needsShuffle}get entities(){return this._entities}get visibleEntities(){return this._entities.filter(t=>yn.find(i=>i===t.entityType))}get cardEntities(){return this._entities.filter(t=>yn.find(i=>i===t.entityType)).filter(t=>t.kind!=="XyzMaterial")}get xyzMaterials(){return this._entities.filter(t=>t.kind==="XyzMaterial")}get targetForAttack(){return this.cellType==="Hand"?this._entities.find(t=>t.entityType==="Duelist"):this.cardEntities[0]}get isAvailable(){return this.cardEntities.length===0&&this._entities.filter(t=>Zc.find(i=>i===t.entityType)).length===0}get isAvailableForPendulum(){return this.isAvailable&&this.isSpellTrapZoneLikeCell&&(this.column===1||this.column===5)}get isStackCell(){return _s.some(t=>t===this.cellType)}get isPlayFieldCell(){return ti.some(t=>t===this.cellType)}get isMonsterZoneLikeCell(){return yt.some(t=>t===this.cellType)}get isSpellTrapZoneLikeCell(){return vi.some(t=>t===this.cellType)}get isDisabledCell(){return ms.some(t=>t===this.cellType)}get isTrashCell(){return ys.some(t=>t===this.cellType)}get neighbors(){const t=[this.row-1,this.row,this.row+1].filter(r=>r>=0&&r<=6),i=[this.column-1,this.column,this.column+1].filter(r=>r>=0&&r<=6);return t.flatMap(r=>i.map(a=>this.field.cells[r][a])).filter(r=>r.isMonsterZoneLikeCell).filter(r=>r!==this)}};Array.prototype.shuffle=function(){return this.map(t=>({item:t,seq:Math.random()})).toSorted((t,i)=>t.seq-i.seq).map(t=>t.item)};Array.prototype.randomPickMany=function(e){return this.shuffle().slice(0,e)};Array.prototype.randomPick=function(){return this.shuffle().slice(0,1)[0]};Array.prototype.reset=function(...e){this.splice(0),this.push(...e)};Array.prototype.union=function(e){return this.filter(t=>e.find(i=>t===i))};Array.prototype.getAllOnOffPattern=function(){const e=[];return this.forEach(t=>{if(e.length==0){e.push([t]),e.push([]);return}e.forEach(i=>e.push([...i,t]))}),e};Array.prototype.getDistinct=function(){return Array.from(new Set(this))};Array.prototype.distinct=function(){this.reset(...this.getDistinct())};class Gr{constructor(){c(this,"pooledOperators",[]);c(this,"bundles",[]);c(this,"excludesExpired",()=>{this.bundles=this.bundles.filter(t=>!t.entity.hasDisappeared),this.bundles.forEach(t=>t.excludesExpired()),this.pooledOperators=this.pooledOperators.filter(t=>t.validateAlive())});c(this,"append",t=>{this.bundles.push(t)});c(this,"push",t=>{if(!t.isContinuous)throw new se("staticへの追加は永続以外不可",t);this.excludesExpired(),this.distribute(t),this.pooledOperators.push(t)});c(this,"distributeAll",t=>(this.excludesExpired(),this.pooledOperators.flatMap(this.distribute).getDistinct().forEach(i=>i.operators.sort((r,a)=>r.seq-a.seq)),this.afterDistributeAll(t)));c(this,"distribute",t=>this.bundles.filter(i=>i.operators.every(r=>r.seq!==t.seq)).filter(i=>t.isApplicableTo(i.entity)).filter(i=>i.entity.canBeEffected(t.effectOwner,t.isSpawnedBy,t.actionAttr)).map(i=>(i.push(t),i)));c(this,"removeItem",t=>{this.pooledOperators=this.pooledOperators.filter(i=>i.seq!==t)})}}class zr{constructor(t,i){c(this,"pool");c(this,"entity");c(this,"_operators");c(this,"excludesExpired",()=>{this._operators=this._operators.filter(t=>{const i=t.validateAlive()&&t.isApplicableTo(this.entity);return i||(console.info(`before remove ${this.entity.toString} ${t.title}`),t.beforeRemove(this)),i})});c(this,"push",t=>{this.entity.procFilterBundle.effectiveOperators.filter(i=>i.procTypes.includes("Effect")).some(i=>!i.filter(i.effectOwner,i.isSpawnedBy,i.actionAttr,[]))||(this.beforePush(t),this._operators.push(t))});c(this,"removeItem",t=>{this._operators=this._operators.filter(i=>i.seq!==t?!0:(i.beforeRemove(this),!1))});this.pool=t,this.entity=i,this._operators=[],this.pool.append(this)}get operators(){return this._operators}get effectiveOperators(){return this.operators.filter(t=>t.isSpawnedBy.isEffective||!t.isContinuous)}}const Mr=class Mr{constructor(t,i,r,a,n,s){c(this,"seq");c(this,"title");c(this,"validateAlive");c(this,"isContinuous");c(this,"isSpawnedBy");c(this,"isSpawnedAt");c(this,"activateType");c(this,"actionAttr");c(this,"isApplicableTo");c(this,"effectOwner");this.seq=Mr.nextSeq++,this.title=t,this.validateAlive=()=>i(this),this.isContinuous=r,this.isSpawnedBy=a,this.isSpawnedAt=a.duel.clock.getClone(),this.isApplicableTo=l=>s(this,l),this.actionAttr=n,this.activateType=this.actionAttr.playType?ad(this.actionAttr.playType):"NonActivate",this.effectOwner=this.isSpawnedBy.controller}get isEffective(){return!this.isContinuous||this.activateType==="NonActivate"?!0:this.isSpawnedBy.isEffective}};c(Mr,"nextSeq",0);let Fi=Mr;class _c extends Gr{constructor(){super(...arguments);c(this,"afterDistributeAll",()=>this.bundles.every(i=>i.applyEffectFilter()))}}class mc extends zr{constructor(){super(...arguments);c(this,"applyEffectFilter",()=>{const i=this.entity.allStickyEffectOperators.length,r=[];for(;;){const a=this.effectiveOperators.filter(n=>n.procTypes.includes("Effect")).filter(n=>n.isContinuous).find(n=>!r.includes(n.seq));if(!a)break;r.push(a.seq),a.eraseOperators(this.entity)}return this.entity.allStickyEffectOperators.length===i});c(this,"beforePush",i=>i.eraseOperators(this.entity))}}const Ti=class Ti extends Fi{constructor(i,r,a,n,s,l,d,o){super(i,r,a,n,s,l);c(this,"beforeRemove",()=>{});c(this,"procTypes");c(this,"filter");c(this,"eraseOperators",i=>{if(!this.procTypes.includes("Effect"))return 0;const r=i.allStickyEffectOperators.filter(a=>a.isContinuous).filter(a=>!this.filter(a.effectOwner,a.isSpawnedBy,a.actionAttr,[])).map(a=>a.seq);return r.forEach(i.procFilterBundle.removeItem),r.forEach(i.statusOperatorBundle.removeItem),r.forEach(i.numericOprsBundle.removeItem),r.length});this.procTypes=d,this.filter=o}};c(Ti,"createContinuous",(i,r,a,n,s,l,d)=>new Ti(i,r,!0,a,n,s,l,d)),c(Ti,"createLingering",(i,r,a,n,s,l,d)=>new Ti(i,r,!1,a,n,s,l,d));let Xi=Ti;const hn={level:1,rank:1,attack:0,defense:0,pendulumScaleR:0,pendulumScaleL:0};class Sc extends Gr{constructor(){super(...arguments);c(this,"afterDistributeAll",i=>{if(this.bundles.forEach(a=>a.calcStateAll()),i.field.getMonstersOnFieldStrictly().flatMap(a=>a.numericOprsBundle).flatMap(a=>a.effectiveOperators).some(a=>a.targetStateGen==="calculated")){const n=i.field.getMonstersOnFieldStrictly().filter(s=>(s.atk??0)>=0).map(s=>s.atk??0).reduce((s,l)=>s>l?s:l,0);i.field.getMonstersOnFieldStrictly().forEach(s=>{s.numericOprsBundle.effectiveOperators.filter(l=>l.targetStateGen==="calculated").forEach(l=>{var d;if(!((d=s.status.monsterCategories)!=null&&d.includes("Link")&&l.targetState==="defense")){if(l.stateOperationType==="THE_DEVILS_AVATAR"){s.numericStatus.calculated[l.targetState]=n+100;return}s.numericStatus.calculated[l.targetState]=l.calcValue(s,s.numericStatus.calculated[l.targetState]??0)}})})}return!0})}}class Cc extends zr{constructor(){super(...arguments);c(this,"beforePush",i=>{const r=this.effectiveOperators.filter(n=>n.targetState===i.targetState).filter(n=>n.isEffective);if(i.kind==="O-L-F"||i.kind==="O-C-F"?(r.filter(n=>n.kind==="O-L-F").forEach(n=>n.negate()),r.filter(n=>n.kind==="L-F").forEach(n=>n.negate())):i.kind==="L-F"||i.kind==="C-F"?r.filter(n=>n.kind==="L-F"||n.kind==="L-A").forEach(n=>n.negate()):i.kind==="X-C-X"&&r.filter(n=>!n.isContinuous).forEach(n=>n.negate()),r.filter(n=>n.isEffective).some(n=>n.kind==="X-C-X")&&!i.isContinuous)return;if(i.stateOperationType!=="Addition"&&i.targetStateGen==="wip"&&r.filter(n=>!n.isContinuous).forEach(n=>n.negate()),i.stateOperationType==="THE_DEVILS_AVATAR"||i.stateOperationType==="Gradius'_Option"){this.entity.numericStatus.calculated[i.targetState]=-Number.MAX_VALUE;return}const a=this.entity.numericStatus.calculated[i.targetState]??0;if(i.stateOperationType==="THE_DEVILS_DREAD-ROOT"){this.entity.numericStatus.calculated[i.targetState]=i.calcValue(this.entity,a);return}if(i.kind==="L-F"){this.entity.numericStatus.wip[i.targetState]=i.calcValue(this.entity,a);return}});c(this,"calcStateAll",()=>ps.forEach(this.calcState));c(this,"calcState",i=>{if(this.entity.kind!=="Monster"&&!this.entity.isPendulumScale){this.entity.numericStatus.calculated[i]=void 0;return}if(!this.entity.status.monsterCategories){this.entity.numericStatus.calculated[i]=void 0;return}if(this.entity.status.monsterCategories.includes("Link")&&i!=="attack"){this.entity.numericStatus.calculated[i]=void 0;return}if(this.entity.status.monsterCategories.includes("Xyz")&&i==="level"){this.entity.numericStatus.calculated[i]=void 0;return}if(!this.entity.status.monsterCategories.includes("Xyz")&&i==="rank"){this.entity.numericStatus.calculated[i]=void 0;return}if(!this.entity.status.monsterCategories.includes("Pendulum")&&(i==="pendulumScaleL"||i==="pendulumScaleR")){this.entity.numericStatus.calculated[i]=void 0;return}if(i!=="level"&&!this.entity.isOnFieldStrictly){this.entity.numericStatus.origin[i]=this.entity.origin[i],this.entity.numericStatus.wip[i]=this.entity.origin[i],this.entity.numericStatus.calculated[i]=this.entity.origin[i];return}const r=this.entity.origin[i]??0,a=this.entity.numericStatus.wip[i]??0,n=this._operators.filter(f=>f.targetState===i).filter(f=>f.isEffective);if(n.some(f=>f.stateOperationType==="THE_DEVILS_AVATAR"||f.stateOperationType==="Gradius'_Option")&&this.entity.isEffective){this.entity.numericStatus.calculated[i]=-Number.MAX_VALUE;return}const s=n.filter(f=>f.targetState===i).findLast(f=>f.targetStateGen==="origin"),l=s?s.calcValue(this.entity,r??0):r;this.entity.numericStatus.origin[i]=l;let d=l;const o=n.filter(f=>f.targetState===i).filter(f=>f.targetStateGen==="wip").findLast(f=>f.stateOperationType==="Fixation");if(!o)d=n.filter(f=>f.stateOperationType==="Addition").reduce((f,v)=>v.calcValue(this.entity,f),d),this.entity.numericStatus.wip[i]=d;else if(o.isContinuous)d=o.calcValue(this.entity,d),d=n.filter(f=>f.stateOperationType==="Addition").reduce((f,v)=>v.calcValue(this.entity,f),d),this.entity.numericStatus.wip[i]=d;else{let f=!1;d=n.filter(v=>(f=f||v===o,f&&v!==o)).filter(v=>v.stateOperationType==="Addition").reduce((v,p)=>p.calcValue(this.entity,v),a)}d<hn[i]&&(d=hn[i]),this.entity.numericStatus.calculated[i]=d})}}const Bt=class Bt extends Fi{constructor(i,r,a,n,s,l,d,o,f,v){super(i,r,a,n,s,l);c(this,"beforeRemove",()=>{});c(this,"targetState");c(this,"targetStateGen");c(this,"stateOperationType");c(this,"calcValue");c(this,"_isEffective");c(this,"negate",()=>{this._isEffective=!1});this._isEffective=!0,this.targetState=d,this.targetStateGen=o,this.stateOperationType=f,this.calcValue=(p,y)=>v(this.isSpawnedBy,p,y)}get isEffective(){return this._isEffective&&super.isEffective}get kind(){if(this.targetStateGen==="origin"){if(this.stateOperationType==="Fixation")return this.isContinuous?"O-C-F":"O-L-F";throw new se("矛盾したプロパティ",this)}if(this.targetStateGen==="wip"){if(this.stateOperationType==="Addition")return this.isContinuous?"C-A":"L-A";if(this.stateOperationType==="Fixation")return this.isContinuous?"C-F":"L-F";throw new se("矛盾したプロパティ",this)}if(this.stateOperationType==="THE_DEVILS_DREAD-ROOT")return"X-C-F";if(this.stateOperationType==="THE_DEVILS_AVATAR"||this.stateOperationType==="Gradius'_Option")return"X-C-X";throw new se("矛盾したプロパティ",this)}};c(Bt,"createContinuous",(i,r,a,n,s,l,d,o)=>new Bt(i,r,!0,a,{},n,s,l,d,o)),c(Bt,"createLingering",(i,r,a,n,s,l,d)=>new Bt(i,r,!1,a,n,(o,f)=>f.isOnFieldAsMonsterStrictly,s,"wip",l,d)),c(Bt,"createLingeringFixation",(i,r,a,n,s,l)=>Bt.createLingering(i,r,a,n,s,"Fixation",l)),c(Bt,"createLingeringAddition",(i,r,a,n,s,l)=>Bt.createLingering(i,r,a,n,s,"Addition",l));let _t=Bt;const Ss=e=>Object.keys(e),bc={draw:"ドローフェイズ",standby:"スタンバイフェイズ",main1:"メインフェイズ１",battle1:"バトルフェイズ",battle2:"バトルフェイズ（追加）",main2:"メインフェイズ２",end:"エンドフェイズ"},kc={start:"スタートステップ",battle:"バトルステップ",damage:"ダメージステップ",end:"エンドステップ"},Tc={start:"ダメージステップ開始時",beforeDmgCalc:"ダメージ計算前",dmgCalc:"ダメージ計算時",afterDmgCalc:"ダメージ計算後",end:"ダメージステップ終了時"},Ae=["draw","stanby","main1","b1Start","b1Battle","b1End","b2Start","b2Battle","b2End","main2","end"],Xe=["b1DStart","b1DBeforeDmgCalc","b1DAfterDmgCalc","b1DEnd","b2DStart","b2DBeforeDmgCalc","b2DAfterDmgCalc","b2DEnd"],wc=["b1DDmgCalc","b2DDmgCalc"],Rt=[...Ae,...Xe,...wc],gn={draw:{phase:"draw",step:void 0,stage:void 0},stanby:{phase:"standby",step:void 0,stage:void 0},main1:{phase:"main1",step:void 0,stage:void 0},b1Start:{phase:"battle1",step:"start",stage:void 0},b1Battle:{phase:"battle1",step:"battle",stage:void 0},b1DStart:{phase:"battle1",step:"battle",stage:"start"},b1DBeforeDmgCalc:{phase:"battle1",step:"battle",stage:"beforeDmgCalc"},b1DDmgCalc:{phase:"battle1",step:"battle",stage:"dmgCalc"},b1DAfterDmgCalc:{phase:"battle1",step:"battle",stage:"afterDmgCalc"},b1DEnd:{phase:"battle1",step:"battle",stage:"end"},b1End:{phase:"battle1",step:"end",stage:void 0},b2Start:{phase:"battle2",step:"start",stage:void 0},b2Battle:{phase:"battle2",step:"battle",stage:void 0},b2DStart:{phase:"battle2",step:"battle",stage:"start"},b2DBeforeDmgCalc:{phase:"battle2",step:"battle",stage:"beforeDmgCalc"},b2DDmgCalc:{phase:"battle2",step:"battle",stage:"dmgCalc"},b2DAfterDmgCalc:{phase:"battle2",step:"battle",stage:"afterDmgCalc"},b2DEnd:{phase:"battle2",step:"battle",stage:"end"},b2End:{phase:"battle2",step:"end",stage:void 0},main2:{phase:"main2",step:void 0,stage:void 0},end:{phase:"end",step:void 0,stage:void 0}},Ec=e=>e.stage?Tc[e.stage]:e.step?kc[e.step]:bc[e.phase],ri=Ss(gn).reduce((e,t)=>(e[t].key=t,e[t].name=Ec(e[t]),e),gn),Ar=class Ar{constructor(t,i){c(this,"entity");c(this,"isRegular");c(this,"_isStarted");c(this,"info");c(this,"continuousEffectBase");c(this,"updateState",async()=>{if(this.hasToStart!==this.isStarted){if(this.isStarted){if(!this.info)throw new se("illegal state");this._isStarted=!1,await this.continuousEffectBase.finish(this.entity,this.info),this.info=void 0;return}this.info=await this.continuousEffectBase.start(this.entity),this._isStarted=!0}});this._isStarted=!1,this.entity=t,this.continuousEffectBase=i,this.isRegular=this.appliableCellTypes.every(r=>ti.find(a=>a===r))&&this.faceList.length===1&&this.faceList[0]==="FaceUp"}get isStarted(){return this._isStarted}get appliableCellTypes(){return this.continuousEffectBase.appliableCellTypes}get appliableDuelPeriodKeys(){return this.continuousEffectBase.appliableDuelPeriodKeys}get faceList(){return this.continuousEffectBase.faceList}get hasToStart(){return!this.appliableCellTypes.includes(this.entity.fieldCell.cellType)||!this.appliableDuelPeriodKeys.includes(this.entity.duel.clock.period.key)||!this.faceList.includes(this.entity.face)?!1:this.continuousEffectBase.canStart(this.entity)}};c(Ar,"createNew",(t,i)=>new Ar(t,i));let pa=Ar;const Dc=(e,t,i,r,a)=>({title:e,appliableCellTypes:t==="Monster"?["MonsterZone","ExtraMonsterZone"]:["FieldSpellZone","SpellAndTrapZone"],appliableDuelPeriodKeys:Rt,faceList:["FaceUp"],canStart:n=>!n.info.isPending&&!n.info.isDying&&i(n),start:async n=>{const s=r(n);return s.forEach(a(n).push),s.map(l=>l.seq)},finish:async(n,s)=>{s.forEach(l=>a(n).removeItem(l))}}),Ra=(e,t,i,r,a,n)=>({title:e,appliableCellTypes:t==="Monster"?["MonsterZone","ExtraMonsterZone"]:["FieldSpellZone","SpellAndTrapZone"],appliableDuelPeriodKeys:Rt,faceList:["FaceUp"],canStart:s=>!s.info.isPending&&!s.info.isDying&&r(s),start:async s=>{const l=a(s),d=i(s);return console.info(`start : ${s.toString()} ⇒ ${d.map(o=>o.toString()).join(" ")} (${l.map(o=>o.title).join(" ")})`),d.map(n).forEach(o=>l.forEach(o.push)),{targets:d,seqList:l.map(o=>o.seq)}},finish:async(s,l)=>{l.targets.map(n).forEach(d=>l.seqList.forEach(o=>d.removeItem(o)))}}),Cs=(e,t,i,r,a)=>Ra(e,t,i,r,a,n=>n.procFilterBundle),Tr=(e,t,i,r)=>Dc(e,t,i,r,a=>a.field.numericStateOperatorPool),lr=(e,t,i,r,a)=>Ra(e,t,i,r,a,n=>n.numericOprsBundle),bs=(e,t,i,r,a)=>Ra(e,t,i,r,a,n=>n.statusOperatorBundle),wr=(...e)=>e.length?e.reduce((t,i)=>t>i?t:i):-Number.MAX_VALUE,ha=(...e)=>e.length?e.reduce((t,i)=>t<i?t:i):Number.MAX_VALUE,ki=(e,t)=>{if((e[0]??Number.MAX_VALUE)>t)return 0;if(e.slice(-1)[0]<t)return e.length;let i=0,r=e.length-1;for(;;){const a=Math.round((i+r)/2);if(a===r||a===i)return e[i]<t?r:i;if(e[a]<t){i=a;continue}r=a}},xt=[3,5,5,6,6,6,7,8,9,10,11,11,11,12,12,13,13,14,15,15,15,15,15,15,16,16,16,17,18,18,18,21,21,21,22,23,25,25,26,28,28,28,30,30,31,32,32,33,33,34,35,35,36,36,36,37,37,38,38,38,39,41,42,42,43,45,45,45,45,48,48,48,50,51,52,54,54,54,54,56,57,58,59,59,59,59,60,61,63,65,65,65,65,66,67,67,67,69,69,71,71,72,73,73,73,73,73,74,75,75,76,76,77,78,79,80,80,80,80,84,84,84,84,84,84,85,85,85,87,90,91,94,96,96,97,98,101,101,101,101,101];console.log(xt.length);xt.forEach((e,t)=>{((xt[ki(xt,t)-1]||-Number.MAX_VALUE)>=t||(xt[ki(xt,t)]||Number.MAX_VALUE)<t)&&console.log(t,ki(xt,t),(xt[ki(xt,t)-1]||-Number.MAX_VALUE)<t,(xt[ki(xt,t)]||Number.MAX_VALUE)>=t)});class Mc{constructor(t){c(this,"_field");c(this,"_records",[]);c(this,"getIndexOfStartPoint",t=>ki(this._records.map(i=>i.movedAt.totalProcSeq),t));c(this,"push",t=>{this._records.push(t)});c(this,"getCurrentTurnLog",()=>this.getTermLog("Current","turn"));c(this,"getPriviousChainLog",()=>this.getTermLog("Previous","chainSeq"));this._field=t}*getTermLog(t,i){const r=t==="Current"?this._field.duel.clock.currentStartPoints[i]:this._field.duel.clock.previousStartPoints[i];for(let a=this.getIndexOfStartPoint(r);a<this._records.length;a++)yield this._records[a]}}class Ac{constructor(t){c(this,"entity");c(this,"_records");c(this,"_push",t=>{this.entity.field.moveLog.push(t),this._records.push(t)});c(this,"pushForRuleAction",t=>{this._push({entity:this.entity,kind:this.entity.origin.kind,cell:this.entity.fieldCell,face:this.entity.face,orientation:this.entity.orientation,isPending:this.entity.info.isPending,movedAt:this.entity.duel.clock.getClone(),movedAs:[...t,"Rule"]})});c(this,"push",(t,i,r,a,n)=>{let s=this.entity.fieldCell;this.entity.kind==="XyzMaterial"&&(s=this.entity.controller.getXyzMaterialZone()),this._push({entity:this.entity,kind:t,cell:s,face:this.entity.face,orientation:this.entity.orientation,isPending:this.entity.info.isPending,movedAt:this.entity.duel.clock.getClone(),movedAs:i.getDistinct(),movedBy:r,actionOwner:a,chooser:n??a})});c(this,"finalize",()=>{if(!this.latestRecord.isPending)throw new se("想定されない状況");if(this.entity.info.isPending)throw new se("想定されない状況");this._push({...this.latestRecord,isPending:!1,movedAt:this.entity.duel.clock.getClone()})});c(this,"negateSummon",(t,i)=>{const r=this.records.slice(-1)[0];r.cell=this.entity.field.getCells("Disable")[0],r.movedBy=t,r.movedAs=["SummonNegated"],r.actionOwner=i});this.entity=t,this._records=[]}get records(){return this._records}get latestRecord(){return this.records.slice(-1)[0]}get previousPlaceRecord(){return this.records.findLast(t=>t.cell.cellType!==this.entity.fieldCell.cellType)??this._records[0]}get currentProcRecords(){return this.records.filter(t=>t.movedAt.totalProcSeq===this.entity.duel.clock.totalProcSeq)}}const ga=["SpellCounter","KaijuCounter","NamelessCounter","IceCounter"],ya=["CycleFlip","SonicBarrier","SonicVerse","IntoTheVoid"],Pc=["GoldSarcophagus"],xc=[...ga,...ya,...Pc],Fc={SpellCounter:"🔮",KaijuCounter:"☢",NamelessCounter:"💠",IceCounter:"❄"};class Bc{constructor(t){c(this,"dic");c(this,"temporaryCounterNames");c(this,"entity");c(this,"add",(t,i=1,r)=>{this.dic[t]=[...this.dic[t]??[],...Array(i).fill(r)];const a=this.entity.status.maxCounterQty[t]??0;return a&&(this.dic[t]=this.dic[t].slice(0,a)),this.dic[t]});c(this,"setQty",(t,i=1,r)=>(this.dic[t]=[...Array(i).fill(r)],this.dic[t]));c(this,"remove",(t,i=1,r)=>{const a=this.dic[t].length;if(a===void 0)return[];if(i>=a)return delete this.dic[t],[];if(r){const n=this.dic[t].filter(l=>l===r),s=this.dic[t].filter(l=>l!==r);this.dic[t]=[...n.slice(i),...s]}else this.dic[t]=this.dic[t].slice(i);return this.dic[t]});c(this,"removeAll",(t,i)=>{if(i){const a=this.dic[t].filter(n=>n===i).length;return this.dic[t]=this.dic[t].filter(n=>n!==i),a}const r=this.dic[t];return delete this.dic[t],r});c(this,"getQty",(t,i)=>this.dic[t]?i?this.dic[t].filter(r=>r===i).length:this.dic[t].length??0:0);c(this,"incrementActionCountPerTurn",t=>{this.temporaryCounterNames.push(t.title),this.incrementActionCount(t)});c(this,"incrementActionCount",t=>{this.dic[t.title]=[t.entity,...this.dic[t.title]??[]]});c(this,"getActionCount",t=>this.dic[t.title]?this.dic[t.title].filter(i=>i===t.entity).length:0);c(this,"corpseDisposal",()=>{this.temporaryCounterNames.forEach(t=>delete this.dic[t]),this.temporaryCounterNames.reset(),ya.forEach(t=>delete this.dic[t])});c(this,"removeAllActualCounters",()=>{ga.forEach(t=>delete this.dic[t])});c(this,"removeAllWhenfaceDown",()=>{this.temporaryCounterNames.forEach(t=>delete this.dic[t]),this.temporaryCounterNames.reset(),ga.forEach(t=>delete this.dic[t])});c(this,"clear",()=>{ya.forEach(t=>delete this.dic[t]),this.temporaryCounterNames.forEach(t=>delete this.dic[t]),this.temporaryCounterNames.reset(),xc.forEach(t=>delete this.dic[t])});this.dic={},this.temporaryCounterNames=[],this.entity=t}}class Oc extends Gr{constructor(){super(...arguments);c(this,"afterDistributeAll",i=>i.field.getAllEntities().map(r=>r.statusOperatorBundle).every(r=>r.calcStatus()))}}class Lc extends zr{constructor(){super(...arguments);c(this,"calcStatus",()=>{const i=this.entity.isEffective;return this.entity.resetStatus(),this.entity.status=this._operators.filter(r=>r.isSpawnedBy.isEffective||!r.isContinuous).reduce((r,a)=>({...r,...a.statusCalculator(a,r)}),this.entity.status),this.entity.isEffective===i});c(this,"beforePush",()=>{})}}class Ri extends Fi{constructor(i,r,a,n,s,l,d){super(i,r,a,n,s,l);c(this,"beforeRemove",()=>{});c(this,"statusCalculator");this.statusCalculator=d}}const Pr=class Pr{constructor(t,i,r){c(this,"seq");c(this,"entity");c(this,"_definition");c(this,"validateDuelist",t=>this.entity.controller===t?this.definition.executableDuelistTypes.includes("Controller"):this.definition.executableDuelistTypes.includes("Opponent"));this.seq=t==="AutoSeq"?Pr.nextSeq++:t,this.entity=i,this._definition=r}get definition(){return this._definition}get title(){return this.definition.title}get isMandatory(){return this.definition.isMandatory}get executableCells(){return this.definition.executableCells}get executablePeriods(){return this.definition.executablePeriods}get executableDuelistTypes(){return this.definition.executableDuelistTypes}get isOnlyNTimesPerDuel(){return this.definition.isOnlyNTimesPerDuel??0}get isOnlyNTimesPerTurn(){return this.definition.isOnlyNTimesPerTurn??0}get isOnlyNTimesPerTurnIfFaceup(){return this.definition.isOnlyNTimesPerTurnIfFaceup??0}get isOnlyNTimesIfFaceup(){return this.definition.isOnlyNTimesIfFaceup??0}get isOnlyNTimesPerChain(){return this.definition.isOnlyNTimesPerChain??0}get actionGroupName(){return this.definition.actionGroupName}get duel(){return this.entity.duel}};c(Pr,"nextSeq",0);let Er=Pr;const Vi=class Vi extends Er{constructor(){super(...arguments);c(this,"isApplicableTo",(i,r,a)=>{const n=this.entity.counterHolder.getActionCount(this);return this.isOnlyNTimesPerTurnIfFaceup>0&&n>=this.isOnlyNTimesPerTurnIfFaceup?this.entity.counterHolder.incrementActionCountPerTurn(this):this.isOnlyNTimesIfFaceup>0&&n>=this.isOnlyNTimesIfFaceup&&this.entity.counterHolder.incrementActionCount(this),this.definition.isApplicableTo(this,i,r,a)});c(this,"substitute",async(i,r,a)=>{const n=await this.definition.substitute(this,i,r,a);return this.isOnlyNTimesPerTurnIfFaceup>0?this.entity.counterHolder.incrementActionCountPerTurn(this):this.isOnlyNTimesIfFaceup>0&&this.entity.counterHolder.incrementActionCount(this),n});c(this,"getClone",()=>new Vi(this.seq,this.entity,this.definition))}get definition(){return super.definition}};c(Vi,"createNew",(i,r)=>new Vi("AutoSeq",i,r));let _a=Vi;class Nc extends Gr{constructor(){super(...arguments);c(this,"afterDistributeAll",()=>!0)}}class qc extends zr{constructor(){super(...arguments);c(this,"beforePush",()=>{});c(this,"filter",(i,r,a,n,s,l,d)=>this.effectiveOperators.filter(o=>o.summonKinds.includes(r)).reduce((o,f)=>({...o,...f.filter(this.entity,i,s.summoner,[r,...a],n,s.monster,l,o.posList,o.cells,d)}),s))}}class Rc extends Fi{constructor(i,r,a,n,s,l,d,o){super(i,r,a,n,s,l);c(this,"beforeRemove",()=>{});c(this,"summonKinds");c(this,"filter");this.summonKinds=d,this.filter=(...f)=>o(this,...f)}}const Le=class Le{constructor(){}};c(Le,"_tryMarkForDestory",(t,i)=>{if(t.info.isDying||t.kind==="XyzMaterial"||!t.isOnFieldStrictly&&t.fieldCell.cellType!=="Deck"&&t.fieldCell.cellType!=="Hand")return!1;const r=i.action.playType==="Battle"?"BattleDestroy":"EffectDestroy",a=r==="BattleDestroy"&&i.action.entity===t?i.selectedEntities[0]:i.action.entity;return t.info.isDying=t.validateDestory(r,i.activator,a,i.action),t.info.isDying&&(t.info.causeOfDeath=[r],t.info.isKilledBy=a,t.info.isKilledByWhom=i.activator,r==="BattleDestroy"&&(t.info.isKilledByWhom=a.controller)),t.info.isDying}),c(Le,"releaseManyForTheSameReason",(t,i,r,a)=>t.length?(i.includes("Cost")&&a.writeInfoLog(`${t.map(n=>n.toString()).join(" ")}をリリースし――、`),Le.bringManyToSameCellForTheSameReason("Graveyard","Top",t,"FaceUp","Vertical",["Release",...i],r,a)):Promise.resolve([])),c(Le,"sendManyToGraveyardForTheSameReason",(t,i,r,a)=>t.length?(a&&i.includes("Cost")&&(i.includes("FusionMaterial")?a.writeInfoLog(`${t.map(n=>n.toString()).join(" ")}を融合素材とし――、`):i.includes("SyncroMaterial")?a.writeInfoLog(`${t.map(n=>n.toString()).join(" ")}をシンクロと素材し――、`):i.includes("LinkMaterial")?a.writeInfoLog(`${t.map(n=>n.toString()).join(" ")}をリンクマーカーにセッティング――、`):a.writeInfoLog(`${t.map(n=>n.toString()).join(" ")}を墓地に送り――、`)),Le.bringManyToSameCellForTheSameReason("Graveyard","Top",t,"FaceUp","Vertical",i,r,a)):Promise.resolve([])),c(Le,"addManyToHand",(t,i,r,a)=>t.length?Le.bringManyToSameCellForTheSameReason("Hand","Bottom",t,"FaceDown","Vertical",i,r,a):Promise.resolve([])),c(Le,"discardManyForTheSameReason",(t,i,r,a)=>t.length?(a&&i.includes("Cost")&&a.writeInfoLog(`${t.map(n=>n.toString()).join(" ")}を手札から捨て――、`),Le.bringManyToSameCellForTheSameReason("Graveyard","Top",t,"FaceUp","Vertical",["Discard",...i],r,a)):Promise.resolve([])),c(Le,"banishManyForTheSameReason",(t,i,r,a)=>t.length?(a&&i.includes("Cost")&&a.writeInfoLog(`${t.map(n=>n.toString()).join(" ")}をゲームから除外し――、`),Le.bringManyToSameCellForTheSameReason("Banished","Top",t,"FaceUp","Vertical",i,r,a)):Promise.resolve([])),c(Le,"returnManyToDeckForTheSameReason",(t,i,r,a,n)=>i.length?(n&&r.includes("Cost")&&n.writeInfoLog(`${i.map(s=>s.toString()).join(" ")}をデッキに戻し――、`),Le.bringManyToSameCellForTheSameReason("Deck",t,i,"FaceDown","Vertical",r,a,n)):Promise.resolve([])),c(Le,"returnManyToHandForTheSameReason",(t,i,r,a)=>t.length?(a&&i.includes("Cost")&&a.writeInfoLog(`${t.map(n=>n.toString()).join(" ")}を手札に戻し――、`),Le.bringManyToSameCellForTheSameReason("Hand","Bottom",t,"FaceDown","Vertical",i,r,a)):Promise.resolve([])),c(Le,"convertManyToXyzMaterials",(t,i,r,a)=>t.length?(a&&i.includes("Cost")&&a.writeInfoLog(`${t.map(n=>n.toString()).join(" ")}によって、オーバーレイネットワークを構築――、`),xe.moveMany(t.map(n=>[n,n.fieldCell,"XyzMaterial","FaceUp","Vertical","Top",i,r,a,a]))):Promise.resolve()),c(Le,"moveToXyzOwner",(t,i,r,a,n)=>i.length?(r.includes("Effect")&&n.writeInfoLog(`${i.map(s=>s.toString()).join(" ")}をXYZ素材として吸収。`),xe.moveMany(i.map(s=>[s,t,"XyzMaterial","FaceUp","Vertical","Top",r,a,n,n]))):Promise.resolve()),c(Le,"banishMany",(t,i)=>xe.bringManyToSameCell("Banished","Top",t.map(r=>({...r,face:"FaceUp",orientation:"Vertical"})),i)),c(Le,"bringManyToSameCellForTheSameReason",(t,i,r,a,n,s,l,d)=>xe.bringManyToSameCell(t,i,r.map(o=>({entity:o,face:a,orientation:n,causedAs:s,causedBy:l,activator:d})))),c(Le,"tryDestroy",async(t,i)=>{const r=await Le.tryMarkForDestory(t,i);return await Le.waitCorpseDisposal(i.activator.duel),r}),c(Le,"waitCorpseDisposal",t=>xe.sendManyToGraveyard([...t.field.getCardsOnFieldStrictly(),...t.field.getPendingCardsOnField()].filter(i=>i.info.isDying).map(i=>({entity:i,causedAs:i.info.causeOfDeath??[],causedBy:i.info.isKilledBy,activator:i.info.isKilledByWhom})))),c(Le,"tryMarkForDestory",async(t,i)=>{let r=t.filter(l=>Le._tryMarkForDestory(l,i));if(!r.length)return[];const a=i.action.playType==="Battle"?"BattleDestroy":"EffectDestroy";(await Promise.all(t[0].field.getAllEntities().flatMap(l=>l.substituteEffects.filter(d=>d.isMandatory).filter(d=>d.executableCells.includes(l.fieldCell.cellType)).filter(d=>d.isApplicableTo(a,t,i).length).flatMap(d=>d.substitute(a,t,i))))).flatMap(l=>l).forEach(l=>{l.resetCauseOfDeath()}),r=r.filter(l=>l.info.isDying);let n=t[0].field.getAllEntities().flatMap(l=>l.substituteEffects.filter(d=>!d.isMandatory).filter(d=>d.executableCells.includes(l.fieldCell.cellType)).filter(d=>d.isApplicableTo(a,t,i).length).map(d=>({chooser:l.owner,effect:d,sacrifice:l})));for(const l of n.map(d=>d.sacrifice.controller).getDistinct()){const d=n.filter(f=>f.sacrifice.controller===l),o=await l.duel.view.waitSelectAction(l,d.map(f=>({entity:f.sacrifice,title:f.effect.title,origin:f.effect})),"身代わり効果を適用する？",!0);if(o){if((await o.substitute(a,r,i)).forEach(f=>{f.resetCauseOfDeath()}),r=r.filter(f=>f.info.isDying),!r.length)return[];n=n.filter(f=>f.effect.isApplicableTo(a,t,i).length)}}const s=r.filter(l=>l.info.isDying);return s.forEach(l=>l.duel.log.info(`${l.toString()}を${jc[a]}。`,l.info.isKilledByWhom)),s}),c(Le,"tryBanish",async(t,i,r)=>{const a=i.filter(n=>n.canBeBanished(t,r.activator,r.action.entity,r.action));return await Le.banishManyForTheSameReason(a,["Effect"],r.action.entity,r.activator),a.filter(n=>n.fieldCell.cellType==="Banished").filter(n=>n.moveLog.latestRecord.movedBy===r.action.entity)}),c(Le,"negateSummonMany",(t,i)=>{const r=i.duel.field.getPendingMonstersOnField();return r.forEach(a=>{a.info.summonKinds=[],a.info.materials=[],a.moveLog.negateSummon(t,i)}),i.writeInfoLog(`${r.map(a=>a.toString()).join(" ")}.の召喚は無効にされた。`),r}),c(Le,"drawAtSameTime",async(t,i,r,a)=>{const n=[],s=[],l=[t.draw(r,i,t),t.getOpponentPlayer().draw(a,i,t)].map(d=>d.catch(o=>{o instanceof kt?o.winner&&n.push(o.winner):s.push(o)}));if(await Promise.all(l),s.length)throw new se("ドロー処理で想定されない例外が発生した。",t,r,a,i,...s);if(n.length!==0)throw n.length===1?new kt(n[0],"対戦相手がデッキからドローできなかった。"):new kt(void 0,"お互いにデッキからカードをドローできなかった。")});let ae=Le;const ks=["FusionSummon","SyncroSummon","XyzSummon","PendulumSummon","LinkSummon","RitualSummon","FlipSummon"],$c={FusionSummon:"融合召喚",SyncroSummon:"シンクロ召喚",XyzSummon:"エクシーズ召喚",PendulumSummon:"ペンデュラム召喚",LinkSummon:"リンク召喚",RitualSummon:"儀式召喚",FlipSummon:"反転召喚"},Hc=[...ks,"AdvanceSummon","NormalSummon","SpecialSummon"],jc={BattleDestroy:"戦闘破壊",EffectDestroy:"効果破壊",RuleDestroy:"ルール破壊"},Ts=e=>e+"Summon",yn=["Card","Token","Avatar"],Zc=["Duelist","Squatter"],ws=(e,t)=>Gi(e.origin,t.origin),Je=class Je{constructor(t,i,r,a,n,s){c(this,"onBeforeMoveEvent",new on);c(this,"onAfterMoveEvent",new on);c(this,"seq");c(this,"origin");c(this,"entityType");c(this,"summonFilterBundle");c(this,"procFilterBundle");c(this,"numericOprsBundle");c(this,"statusOperatorBundle");c(this,"moveLog");c(this,"counterHolder");c(this,"face");c(this,"orientation");c(this,"owner");c(this,"fieldCell");c(this,"_status");c(this,"_numericStatus");c(this,"_info");c(this,"actions",[]);c(this,"continuousEffects",[]);c(this,"substituteEffects",[]);c(this,"canBeReleased",(t,i,r,a)=>!this.isInTrashCell&&this.procFilterBundle.effectiveOperators.filter(n=>n.procTypes.union(r).length).every(n=>n.filter(t,i,a,[this])));c(this,"canBeSentToGraveyard",(t,i,r,a)=>!this.info.willBeBanished&&!this.info.willReturnToDeck&&this.procFilterBundle.effectiveOperators.filter(n=>n.procTypes.includes(r)).every(n=>n.filter(t,i,a,[this])));c(this,"_hasDisappeared",!1);c(this,"definition");c(this,"toString",()=>this.entityType==="Card"?`《${this.nm}》`:this.nm);c(this,"onUsedAsMaterial",(t,i)=>{this.definition&&this.definition.onUsedAsMaterial&&this.definition.onUsedAsMaterial(t,i)});c(this,"setBattlePosition",async(t,i,r,a)=>{let n=`表示形式の変更：${this.toString()}（${this.battlePositionName}⇒${fr[t]}）`;const s=[...i];this.battlePosition==="Set"&&(s.push("Flip"),i.includes("Rule")&&(this.info.isPending=!0,n=`${this.toString()}を反転召喚`,this.info.summonKinds.push("FlipSummon"),s.push("FlipSummon"),s.push("AttackSummon"))),this.duel.log.info(n,a),await this.moveAlone(this.fieldCell,"Monster",t==="Set"?"FaceDown":"FaceUp",t==="Attack"?"Vertical":"Horizontal","Top",s,r,a,a)});c(this,"activateAsPendulumScale",(t,i,r,a)=>this.moveAlone(t,"Spell","FaceUp","Vertical","Top",["CardActivation",...i],r,a,a));c(this,"setNonFieldMonsterPosition",async(t,i,r,a,n)=>{this.moveAlone(this.fieldCell,t,i==="FaceUp"?"FaceUp":"FaceDown","Vertical","Top",r,a,n,n)});c(this,"setAsSpellTrap",async(t,i,r,a,n)=>{await this.moveAlone(t,i,"FaceDown","Vertical","Top",[...r,"SpellTrapSet"],a,n,n)});c(this,"activateSpellTrapFromHand",async(t,i,r,a,n)=>{await this.moveAlone(t,i,"FaceUp","Vertical","Top",[...r,"CardActivation"],a,n,n)});c(this,"putDirectly",async(t,i,r,a,n)=>{await this.moveAlone(t,i,"FaceUp","Vertical","Top",[...r,"PutDirectly"],a,n,n)});c(this,"activateSpellTrapOnField",async(t,i,r,a)=>{await this.moveAlone(this.fieldCell,t,"FaceUp","Vertical","Top",[...i,"CardActivation"],r,a,a)});c(this,"draw",async(t,i,r)=>await this.addToHand([...t,"Draw"],i,r));c(this,"addToHand",async(t,i,r)=>await this.moveAlone(this.owner.getHandCell(),this.origin.kind,"FaceDown","Vertical","Bottom",[...t],i,r,r));c(this,"summon",(t,i,r,a,n,s,l)=>Je.summonMany([{monster:this,dest:t,summoner:l??s,pos:i}],r,a,n,s));c(this,"moveForcibly",async(t,i,r,a,n,s,l)=>{await this.moveAlone(t,this.origin.kind,i,r,a,["Rule",...n],s,l,l)});c(this,"moveAlone",async(t,i,r,a,n,s,l,d,o)=>(await Je.moveMany([[this,t,i,r,a,n,s,l,d,o]],void 0),this.fieldCell));c(this,"determine",()=>{this.info.isPending&&(this.info.isPending=!1,this.moveLog.finalize(),this.continuousEffects.forEach(t=>t.updateState()))});c(this,"_move",async(t,i,r,a,n,s,l,d,o)=>{if(!t)throw new Error("illegal argument: to");if(await this.onBeforeMoveEvent.trigger({entity:this,args:[t,i,r,a,n,s,l,d,o]}),this.face=r,this.orientation=a,t!==this.fieldCell){if(this.field.duel.clock.turn>0&&(this.duel.log.info(`移動：${this.toString()}  ${this.fieldCell.toString()} ⇒ ${t.toString()}`,d),await this.field.duel.view.waitAnimation({entity:this,to:t,index:n,count:0})),this.fieldCell.releaseEntities(this),this.fieldCell.isPlayFieldCell&&!t.isPlayFieldCell&&(this.counterHolder.clear(),this.resetCauseOfDeath(),this.entityType==="Token")){this._hasDisappeared=!0,this.field.duel.log.info(`${this.nm}は消滅した。`,this.controller);return}this.kind!=="XyzMaterial"&&(this.fieldCell.isMonsterZoneLikeCell&&!t.isMonsterZoneLikeCell||i!=="Monster")&&(this.info.equipEntities.filter(f=>f.isOnFieldAsSpellTrapStrictly).forEach(f=>{f.info.isDying=!0,f.info.causeOfDeath=["RuleDestroy"],this.controller.writeInfoLog(`装備対象${this.toString()}不在により${f.toString()}は破壊された。`)}),this.info.equipEntities=[],this.fieldCell.xyzMaterials.forEach(f=>{f.info.isDying=!0,f.info.causeOfDeath=["LostXyzOwner"],this.controller.writeInfoLog(`エクシーズモンスター${this.toString()}不在により${f.toString()}は墓地に送られた。`)}),this.resetNumericStatus(),this.info.willBeBanished=!1,this.info.willReturnToDeck=void 0,this.info.isEffectiveIn.push(...ti)),this.fieldCell.cellType==="SpellAndTrapZone"&&t.cellType!=="SpellAndTrapZone"&&(this.info.equipedBy=void 0,this.info.equipedAs=void 0,this.info.willBeBanished=!1,this.info.willReturnToDeck=void 0,this.info.isEffectiveIn.push(...ti)),t.acceptEntities(this,n),(t===this.isBelongTo||t.cellType==="Hand"||t.cellType==="Banished"&&this.face==="FaceDown")&&(this.counterHolder.clear(),this.resetInfoAll(),this.resetStatusAll())}return(this.isOnFieldStrictly&&this.face==="FaceDown"||i==="XyzMaterial")&&(this.info.equipEntities.forEach(f=>{f.info.isDying=!0,f.info.causeOfDeath=["RuleDestroy"],this.controller.writeInfoLog(`装備対象${this.toString()}不在により${f.toString()}は破壊された。`)}),this.counterHolder.removeAllWhenfaceDown(),this.info.materials=[],this._status.isEffective=!0,this.info.isEffectiveIn=[...ci],this.info.willBeBanished=!1,this.info.willReturnToDeck=void 0,this.resetNumericStatus(),this.info.isSettingSickness=this.kind==="Trap"||this.status.spellCategory==="QuickPlay"),this._info.kind=i,this.moveLog.push(i,s,l,d,o),await this.onAfterMoveEvent.trigger(this),t});c(this,"initForTurn",()=>{this.info.isSettingSickness=!1,this.info.attackCount=0,this.info.battlePotisionChangeCount=0,this.counterHolder.corpseDisposal()});c(this,"resetInfoIfLeavesTheField",()=>{this._info={...this._info,isDying:!1,isPending:!1,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,effectTargets:{},attackCount:0,battlePotisionChangeCount:0,materials:[],equipedBy:void 0,equipedAs:void 0,equipEntities:[]},this._info.isEffectiveIn.push(...ti),this._info.isEffectiveIn.distinct()});c(this,"resetInfoAll",()=>{var t;this._info={kind:this.origin.kind,isDying:!1,isPending:!1,isEffectiveIn:[...ci],causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,isVanished:!1,isRebornable:((t=this.origin.monsterCategories)==null?void 0:t.union(fs).length)===0,isSettingSickness:!1,summonKinds:[],materials:[],effectTargets:{},willBeBanished:!1,willReturnToDeck:void 0,attackCount:0,battlePotisionChangeCount:0,equipedBy:void 0,equipedAs:void 0,validateEquipOwner:()=>!0,equipEntities:[],battleLog:[]},this.counterHolder.clear()});c(this,"resetNumericStatus",()=>{const t=ps.reduce((i,r)=>(i[r]=this.origin[r],i),{});this._numericStatus={origin:{...t},wip:{...t},calculated:{...t}}});c(this,"resetStatus",()=>{this._status={...this.origin,canAttack:!0,isEffective:!0,canDirectAttack:!1,canActivateEffect:!0,isSelectableForAttack:!0,allowHandSyncro:!1,allowHandLink:!1,maxCounterQty:{}}});c(this,"resetStatusAll",()=>{this.resetNumericStatus(),this.resetStatus()});c(this,"resetCauseOfDeath",()=>{this.info.isDying=!1,this.info.causeOfDeath=[],this.info.isKilledBy=void 0,this.info.isKilledByWhom=void 0});this.seq=Je.nextEntitySeq++,this.counterHolder=new Bc(this),this.definition=a,this.owner=t,this.fieldCell=i,this.entityType=r,this.origin=a.staticInfo,this._status=JSON.parse(JSON.stringify(a.staticInfo)),this._numericStatus=JSON.parse(JSON.stringify(a.staticInfo)),this.resetStatusAll(),this._info={kind:this.origin.kind,isEffectiveIn:[...ci],attackCount:0,battlePotisionChangeCount:0,isDying:!1,isPending:!1,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,isVanished:!1,isRebornable:!0,isSettingSickness:!1,summonKinds:[],materials:[],effectTargets:{},willBeBanished:!1,willReturnToDeck:void 0,equipedBy:void 0,equipedAs:void 0,validateEquipOwner:()=>!0,equipEntities:[],battleLog:[]},this.resetInfoAll(),this.face=n,this.orientation=s,this.summonFilterBundle=new qc(i.field.summonFilterPool,this),this.procFilterBundle=new mc(i.field.procFilterPool,this),this.numericOprsBundle=new Cc(i.field.numericStateOperatorPool,this),this.statusOperatorBundle=new Lc(i.field.statusOperatorPool,this),i.acceptEntities(this,"Top"),this.moveLog=new Ac(this),this.moveLog.pushForRuleAction(["Spawn"]);let l=[],d=[];l=a.actions,d=a.continuousEffects??[],this.substituteEffects.push(...(a.substituteEffects??[]).map(o=>_a.createNew(this,o))),this.origin.kind==="Monster"&&this.entityType==="Card"&&a.summonFilter&&this.summonFilterBundle.push(new Rc("default",()=>!0,!0,this,{},()=>!0,Hc,a.summonFilter)),a.defaultStatus&&this.statusOperatorBundle.push(new Ri("default",()=>!0,!0,this,{},()=>!0,()=>a.defaultStatus??{})),this.actions.push(...l.map(o=>Mi.createNew(this,o))),this.continuousEffects.push(...d.map(o=>pa.createNew(this,o)))}get onBeforeMove(){return this.onBeforeMoveEvent.expose()}get onAfterMove(){return this.onAfterMoveEvent.expose()}get isUnderControl(){return this.face==="FaceUp"||gs.every(t=>t!==this.fieldCell.cellType)}get controller(){return this.fieldCell.owner??this.owner}get field(){return this.owner.duel.field}get duel(){return this.owner.duel.field.duel}get actionLogRecords(){return this.duel.chainBlockLog.records.filter(t=>t.chainBlockInfo.action.entity===this)}get status(){return this._status}set status(t){this._status={...t}}get numericStatus(){return this._numericStatus}get info(){return this._info}get kind(){return this.info.kind}get nm(){return this.status.name}get atk(){return this._numericStatus.calculated.attack}get def(){return this._numericStatus.calculated.defense}get lvl(){return this._numericStatus.calculated.level}get rank(){return this._numericStatus.calculated.rank}get attr(){return this.status.attributes??[]}get types(){return this.status.types??[]}get psL(){return this._numericStatus.calculated.pendulumScaleL}get psR(){return this._numericStatus.calculated.pendulumScaleR}get linkArrows(){let t=(this.origin.linkArrowKeys??[]).map(i=>hs[i].linkArrow);return this.controller.seat==="Above"&&(t=t.map(i=>({offsetColumn:i.offsetColumn*-1,offsetRow:i.offsetRow*-1}))),t}get linkArrowDests(){var t;return(t=this.origin.monsterCategories)!=null&&t.includes("Link")?this.isOnFieldAsMonsterStrictly?this.linkArrows.map(i=>[this.fieldCell.row+i.offsetRow,this.fieldCell.column+i.offsetColumn]).map(([i,r])=>this.field.cells[i][r]).filter(i=>i.isMonsterZoneLikeCell):[]:[]}get linkedEntities(){return this.isOnFieldAsMonsterStrictly?[...this.linkArrowDests.map(t=>t.cardEntities[0]).map(t=>t),...this.fieldCell.linkArrowSources].getDistinct():[]}get coLinkedEntities(){var t;return this.isOnFieldAsMonsterStrictly?(t=this.origin.monsterCategories)!=null&&t.includes("Link")?this.linkArrowDests.map(i=>i.cardEntities[0]).filter(i=>i).union(this.fieldCell.linkArrowSources):[]:[]}get isEffective(){return this.status.isEffective&&this.info.isEffectiveIn.includes(this.fieldCell.cellType)}get isEffectiveWeakly(){return this.status.isEffective}get battlePosition(){if(this.isOnFieldStrictly&&this.kind==="Monster")return this.orientation==="Vertical"?"Attack":this.face==="FaceUp"?"Defense":"Set"}get battlePositionName(){const t=this.battlePosition;if(t)return fr[t]}get wasMovedAtCurrentProc(){return this.field.duel.clock.totalProcSeq===this.moveLog.latestRecord.movedAt.totalProcSeq}get wasMovedAtPreviousProc(){return this.field.duel.clock.totalProcSeq===this.moveLog.latestRecord.movedAt.totalProcSeq+1}get wasMovedAtCurrentTurn(){return this.field.duel.clock.isSameTurn(this.moveLog.latestRecord.movedAt)}get wasMovedAtCurrentChain(){return this.field.duel.clock.isSameChain(this.moveLog.latestRecord.movedAt)}get wasMovedAtPreviousChain(){return this.field.duel.clock.isPreviousChain(this.moveLog.latestRecord.movedAt)}get wasMovedAtPreviousTurn(){return this.field.duel.clock.isPreviousTurn(this.moveLog.latestRecord.movedAt)}get wasMovedFrom(){return this.moveLog.previousPlaceRecord.cell}get isPendulumScale(){var t;return!(!((t=this.origin.monsterCategories)!=null&&t.includes("Pendulum"))||!this.isOnField||!this.fieldCell.isSpellTrapZoneLikeCell||this.status.spellCategory)}get isOnField(){return this.fieldCell.isPlayFieldCell}get isOnFieldStrictly(){return this.isOnField&&!this.info.isPending&&this.kind!=="XyzMaterial"}get isOnFieldAsMonsterStrictly(){return this.fieldCell.isMonsterZoneLikeCell&&this.isOnFieldStrictly}get isOnFieldAsSpellTrapStrictly(){return this.fieldCell.isSpellTrapZoneLikeCell&&this.isOnFieldStrictly}get isInTrashCell(){return this.fieldCell.isTrashCell}get isLikeContinuousSpell(){return this.status.spellCategory==="Continuous"||this.status.spellCategory==="Field"||this.status.spellCategory==="Equip"||this.status.trapCategory==="Continuous"||(this.status.monsterCategories??[]).includes("Pendulum")}get isBelongTo(){return this.origin.monsterCategories&&this.origin.monsterCategories.union(xi).length?this.owner.getExtraDeck():this.owner.getDeckCell()}get hasDisappeared(){return this._hasDisappeared}get allStickyEffectOperators(){return[...this.procFilterBundle.effectiveOperators,...this.numericOprsBundle.effectiveOperators]}};c(Je,"nextEntitySeq",0),c(Je,"splitBattlePos",t=>({face:t==="Set"?"FaceDown":"FaceUp",orientation:t==="Attack"?"Vertical":"Horizontal"})),c(Je,"recreateArray",(t,i)=>{if(!i.length)return[];const r=t.getAllCells().flatMap(a=>a.entities);return i.map(a=>a.seq).map(a=>r.find(n=>n.seq===a)).filter(a=>a!==void 0)}),c(Je,"createPlayerEntity",t=>{const i=t.getHandCell();return new Je(t,i,"Duelist",Du(t),"FaceUp","Vertical")}),c(Je,"createCardEntity",(t,i)=>{const r=i.staticInfo.monsterCategories&&i.staticInfo.monsterCategories.union(xi).length?t.getExtraDeck():t.getDeckCell();return new Je(t,r,"Card",i,"FaceDown","Vertical")}),c(Je,"moveMany",async(t,i)=>{if(!t.length)return;const r=t[0][0].duel,n=[...t.filter(([l,d])=>l.fieldCell!==d).map(([l])=>l).filter(l=>!(i??[]).includes(l)),...r.field.getCardsOnFieldStrictly().filter(l=>l.info.isDying)],s=new Map;for(t.forEach(([l,d,o,f,v,p,...y])=>{var E;let m=d,C=o,g=f,T=p,k=v;l.info.willBeBanished?(m=l.owner.getBanished(),g="FaceUp",k="Vertical"):l.info.willReturnToDeck?(m=l.isBelongTo,g="FaceDown",T=l.info.willReturnToDeck,k="Vertical"):(E=l.status.monsterCategories)!=null&&E.includes("Pendulum")&&l.isOnFieldStrictly&&l.face==="FaceUp"&&d.isTrashCell&&(m=l.owner.getExtraDeck(),g="FaceUp",T="Top",k="Vertical"),m.cellType==="ExtraDeck"&&(T=g==="FaceUp"?"Top":"Bottom"),l.isBelongTo.cellType==="ExtraDeck"&&(m.cellType==="Hand"||m.cellType==="Deck")&&(m=l.isBelongTo,g="FaceDown",k="Vertical"),m.isPlayFieldCell||(C=l.origin.kind),m.isMonsterZoneLikeCell||(k="Vertical"),s.set(m,[[l,m,C,g,k,T,...y],...s.get(m)??[]])});;){const l=Array.from(s.values()).map(o=>o.pop()).filter(o=>o!==void 0).map(([o,...f])=>o._move(...f));if(!l.length)break;await Promise.all(l);const d=r.field.getCardsOnFieldStrictly().filter(o=>o.info.isDying).filter(o=>!n.includes(o)).map(o=>({entity:o,causedAs:o.info.causeOfDeath??[],causedBy:o.info.isKilledBy,activator:o.info.isKilledByWhom}));d.length&&await Je.sendManyToGraveyard(d,n)}Je.settleEntityMove(r)}),c(Je,"summonMany",async(t,i,r,a,n)=>{if(!t.length)return;const s={Attack:"AttackSummon",Defense:"DefenseSummon",Set:"SetSummon"},l=t.map(({monster:d,dest:o,pos:f,summoner:v})=>{if(d.info.summonKinds=[i],i==="NormalSummon"||i==="AdvanceSummon"){d.info.summonKinds.push("NormalSummon");const m=i==="AdvanceSummon"?"アドバンス":"";f==="Attack"?d.field.duel.log.info(`${d.toString()}を${m}召喚`,v):d.duel.log.info(`${d.toString()}を${m}セット`,v),r.includes("Rule")?v.info.ruleNormalSummonCountQty++:v.info.effectNormalSummonCountQty++}else i==="SpecialSummon"?d.duel.log.info(`${d.toString()}を${fr[f]}で特殊召喚`,v):(d.info.summonKinds.push("SpecialSummon"),d.duel.log.info(`${d.toString()}を${fr[f]}で${$c[i]}！`,v)),v.info.specialSummonCountQty++;d.info.summonKinds=d.info.summonKinds.getDistinct(),d.info.battlePotisionChangeCount=1;const{face:p,orientation:y}=Je.splitBattlePos(f);return r.includes("Rule")&&(d.info.isPending=!0),{entity:d,args:[o,"Monster",p,y,"Top",[i,s[f],...r],a,n,v]}}).map(d=>d.entity._move(...d.args));await Promise.all(l),t.map(d=>d.summoner).forEach(d=>{i==="NormalSummon"||i==="AdvanceSummon"?r.includes("Rule")?d.info.ruleNormalSummonCount++:d.info.effectNormalSummonCount++:d.info.specialSummonCount++}),Je.settleEntityMove(t[0].monster.duel)}),c(Je,"sendManyToGraveyard",(t,i)=>Je.bringManyToSameCell("Graveyard","Top",t.map(r=>({...r,face:"FaceUp",orientation:"Vertical"})),i)),c(Je,"bringManyToSameCell",async(t,i,r,a)=>(await Je.moveMany(r.map(n=>[n.entity,n.entity.field.getCells(t).filter(s=>s.owner===n.entity.owner)[0],n.entity.origin.kind,n.face,n.orientation,i,n.causedAs,n.causedBy,n.activator,n.activator]),a),r.map(n=>n.entity).filter(n=>n.fieldCell.cellType===t))),c(Je,"settleEntityMove",t=>{t.field.recalcLinkArrows(),t.distributeOperators(t.clock);const i=t.field.getAllEntities().filter(r=>r.wasMovedAtCurrentProc);i.filter(r=>!r.isOnFieldStrictly&&!r.info.isPending).forEach(r=>r.resetInfoIfLeavesTheField()),i.filter(r=>r.face==="FaceDown").filter(r=>r.fieldCell===r.isBelongTo).forEach(r=>{r.resetInfoAll(),r.resetStatusAll()}),i.flatMap(r=>r.continuousEffects).forEach(r=>r.updateState()),t.field.getAllCells().filter(r=>r.needsShuffle).map(r=>r.shuffle())});let xe=Je;xe.prototype.hasBeenSummonedNow=function(e,t=["Attack","Defense"]){const i=this,r=t.map(Ts),a=i.moveLog.latestRecord.movedAs;return!(!i.wasMovedAtPreviousChain||!a.union(e).length||!a.union(r).length)};xe.prototype.hasBeenSummonedJustNow=function(e,t=["Attack","Defense"]){const i=this,r=t.map(Ts),a=i.moveLog.latestRecord.movedAs;return!(!i.wasMovedAtPreviousProc||!a.union(e).length||!a.union(r).length)};xe.prototype.getAttackTargets=function(){if(!this.hasAttackRight())return[];const e=this.controller.getOpponentPlayer().getMonstersOnField().filter(t=>t.status.isSelectableForAttack);return console.log(this.toString(),this.status.canDirectAttack),(this.status.canDirectAttack||!e.length)&&e.push(this.controller.getOpponentPlayer().entity),e.filter(t=>t.canBeTargetOfBattle(this.controller,this)).filter(t=>this.procFilterBundle.effectiveOperators.filter(i=>i.procTypes.includes("BattleTarget")).every(i=>i.filter(this.controller,this,{},[t])))};xe.prototype.canDirectAttack=function(){return this.getAttackTargets().some(e=>e.entityType==="Duelist")};xe.prototype.canAttackToMonster=function(){return this.getAttackTargets().some(e=>e.entityType!=="Duelist")};xe.prototype.hasAttackRight=function(){return this.battlePosition==="Attack"&&this.info.attackCount===0&&this.status.canAttack};xe.prototype.canBeEffected=function(e,t,i){return this.procFilterBundle.effectiveOperators.filter(a=>a.procTypes.some(n=>n==="Effect")).every(a=>a.filter(e,t,i,[this]))};const Es=(e,t,i,r,a)=>e.canBeEffected(i,r,a)&&e.procFilterBundle.effectiveOperators.filter(n=>n.procTypes.some(s=>s===t)).every(n=>n.filter(i,r,a,[e]));xe.prototype.canBeTargetOfEffect=function(e){return Es(this,"EffectTarget",e.activator,e.action.entity,e.action)};xe.prototype.canBeBanished=function(e,t,i,r){return this.fieldCell.cellType==="Banished"?!1:Es(this,e,t,i,r)};xe.prototype.canBeTargetOfBattle=function(e,t){const i=this;return i.procFilterBundle.effectiveOperators.filter(r=>r.procTypes.some(a=>a==="BattleTarget")).every(r=>r.filter(e,t,{},[i]))};xe.prototype.validateDestory=function(e,t,i,r){const a=this;let n=a.procFilterBundle.effectiveOperators.filter(s=>s.procTypes.includes(e)).every(s=>s.filter(t,i,r??{},[a]));return n&&e==="EffectDestroy"&&(n=a.canBeEffected(t,i,r)),n};xe.prototype.getIndexInCell=function(){const e=this;if(e.info.isVanished)return-1;const t=e.fieldCell.cardEntities.indexOf(e);if(t<0)throw new se("エンティティとセルの状態が矛盾している。",[e,e.fieldCell]);return t};xe.prototype.getXyzMaterials=function(){const e=this;return(e.status.monsterCategories??[]).includes("Xyz")?e.fieldCell.xyzMaterials:[]};xe.prototype.wasMovedAfter=function(e){return this.moveLog.latestRecord.movedAt.totalProcSeq>e.totalProcSeq};xe.prototype.hadArrivedToFieldAt=function(){let e=this.moveLog.latestRecord.movedAt;return this.moveLog.records.findLast(t=>!t.cell.isPlayFieldCell||t.isPending||t.kind!==this.kind||t.face==="FaceDown"?!0:(e=t.movedAt,!1)),e};xe.prototype.release=async function(e,t,i){return await this.sendToGraveyard([...e,"Release"],t,i),this.info.isVanished?void 0:this.fieldCell};xe.prototype.ruleDestory=async function(){return await this.sendToGraveyard(["RuleDestroy"],void 0,void 0),this.info.isVanished?void 0:this.fieldCell};xe.prototype.sendToGraveyard=async function(e,t,i){await ae.sendManyToGraveyardForTheSameReason([this],e,t,i)};xe.prototype.discard=async function(e,t,i){await ae.discardManyForTheSameReason([this],e,t,i)};xe.prototype.returnToDeck=async function(e,t,i,r){await ae.returnManyToDeckForTheSameReason(e,[this],t,i,r)};xe.prototype.banish=async function(e,t,i){await ae.banishManyForTheSameReason([this],e,t,i)};class Uc{constructor(t){c(this,"cells");c(this,"duel");c(this,"summonFilterPool");c(this,"procFilterPool");c(this,"numericStateOperatorPool");c(this,"statusOperatorPool");c(this,"moveLog");c(this,"getAllCells",()=>this.cells.flat());c(this,"getCells",(...t)=>this.getAllCells().filter(i=>t.includes(i.cellType)));c(this,"getAvailableExtraMonsterZones",()=>this.getCells("ExtraMonsterZone").filter(t=>t.isAvailable));c(this,"getAllEntities",()=>this.getAllCells().map(t=>t.entities).flat());c(this,"getAllCardEntities",()=>this.getAllCells().map(t=>t.cardEntities).flat());c(this,"getCardsOnFieldStrictly",()=>this.getCells(...ti).map(t=>t.cardEntities).filter(t=>t.length>0).map(t=>t[0]).filter(t=>t.isOnFieldStrictly));c(this,"getMonstersOnFieldStrictly",()=>this.getCardsOnFieldStrictly().filter(t=>t.isOnFieldAsMonsterStrictly));c(this,"getSpellTrapsOnFieldStrictly",()=>this.getCardsOnFieldStrictly().filter(t=>t.isOnFieldAsSpellTrapStrictly));c(this,"getPendulumScalesOnFieldStrictly",()=>this.getCardsOnFieldStrictly().filter(t=>{var i;return(i=t.origin.monsterCategories)==null?void 0:i.includes("Pendulum")}).filter(t=>t.isOnFieldAsSpellTrapStrictly).filter(t=>!t.status.spellCategory));c(this,"getPendingCardsOnField",()=>this.getCells(...ti).map(t=>t.cardEntities).filter(t=>t.length>0).map(t=>t[0]).filter(t=>t.info.isPending));c(this,"getPendingMonstersOnField",()=>this.getPendingCardsOnField().filter(t=>t.kind==="Monster"));c(this,"getEntities",t=>this.getAllEntities().filter(i=>i.controller===t));c(this,"recalcLinkArrows",()=>{const t=this.getAllCells().filter(i=>i.isMonsterZoneLikeCell);t.some(i=>i.recalcLinkArrows)&&t.forEach(i=>i.recalcLinkArrows())});c(this,"canExtraLink",(t,i)=>{if(!t.linkArrows.length)return!1;const r=i.map(o=>o.material),a=this.getCells("ExtraMonsterZone").filter(o=>o.isAvailable||r.includes(o.cardEntities[0]));if(a.length!==1)return!1;const n=a[0],s=t.linkArrows.map(o=>this.cells[n.row+o.offsetRow][n.column+o.offsetColumn]);let l=n.linkArrowSources.filter(o=>!r.includes(o)).filter(o=>s.includes(o.fieldCell));if(!l.length)return!1;let d=-1;for(;d!==l.length;){const o=l.flatMap(f=>f.coLinkedEntities).filter(f=>!r.includes(f));if(o.some(f=>f.fieldCell.cellType==="ExtraMonsterZone"))return!0;l=[...l,...o].getDistinct(),d=l.length}return!1});c(this,"drawAtSameTime",async(t,i,r,a,n,s)=>{const l=[],d=[],o=[t.draw(i,n,s),r.draw(a,n,s)].map(f=>f.catch(v=>{v instanceof kt?v.winner&&l.push(v.winner):d.push(v)}));if(await Promise.all(o),d.length)throw new se("ドロー処理で想定されない例外が発生した。",t,i,r,a,n,...d);if(l.length!==0)throw l.length===1?new kt(l[0],"対戦相手がデッキからドローできなかった。"):new kt(void 0,"お互いにデッキからカードをドローできなかった。")});c(this,"sendToGraveyard",async(t,i,r,a,n,s,l,d)=>{if(a>0&&r.length<a)return;const o=await this.duel.view.waitSelectEntities(i,{selectables:r,qty:a,validator:n,cancelable:d??!1},t);if(o)return await xe.sendManyToGraveyard(o.map(f=>({entity:f,causedAs:s,causedBy:l,activator:i}))),this.duel.log.info(`${o.map(f=>f.status.name).join(", ")}を墓地に送った（${s.getDistinct().join(", ")}）。`,i),o});this.duel=t,this.cells=[...Array(7)].map(()=>[]);for(const i of Object.keys(va).map(Number))for(const r of Object.keys(va[i]).map(Number))this.cells[i][r]=new yc(this,i,r,i<3?t.duelists.Above:i>3?t.duelists.Below:r<2?t.duelists.Above:r>4?t.duelists.Below:void 0);this.summonFilterPool=new Nc,this.procFilterPool=new _c,this.numericStateOperatorPool=new Sc,this.statusOperatorPool=new Oc,this.moveLog=new Mc(this)}}let Gc=class{constructor(t){c(this,"onUpdateEvent",new Ie);c(this,"nextSeq");c(this,"records",[]);c(this,"duel");c(this,"dispose",()=>{this.onUpdateEvent.clear()});c(this,"error",t=>{console.error(t);const i=["エラー発生"];t instanceof Error?(t instanceof se&&(i.push("-- エラーメッセージ --"),i.push(t.message),i.push("-- 関連オブジェクト --"),t.items.forEach(r=>i.push(JSON.stringify(r))),console.error(t.items)),i.push("-- エラー名称 --"),i.push(t.name||"エラー名称取得失敗"),i.push("-- スタックトレース --"),i.push(t.stack||"スタックトレース取得失敗")):(i.push("-- エラー型特定失敗 --"),i.push(JSON.stringify(t))),this.write("error","System",i,void 0,void 0,void 0,void 0,void 0)});c(this,"warn",t=>{this.write("warn","System",["【注意】",t],void 0,void 0,void 0,void 0,void 0)});c(this,"info",(t,i)=>{this.write("info","Others",[t],i,void 0,void 0,void 0,void 0)});c(this,"pushMoveLog",(t,i,r,a)=>{this.write("info","EntityMove",["移動"],t,i,void 0,r,a)});c(this,"write",(t,i,r,a,n,s,l,d)=>{const o=r.join(`
`);this.records.push({seq:this.nextSeq++,lvl:t,type:i,clock:this.duel.clock.getClone(),text:o,duelist:a,mainEntity:n,subEntities:s??[],from:l,to:d}),this.onUpdateEvent.trigger(this.nextSeq-1)});this.nextSeq=0,this.duel=t}get onUpdate(){return this.onUpdateEvent.expose()}get lastRecord(){return this.records.slice(-1)[0]}};const Ds=e=>new Promise(t=>setTimeout(t,e)),Ms=()=>{let e=()=>{},t=()=>{};return{promise:new Promise((r,a)=>{e=r,t=a}),resolve:e,reject:t}};class ea{constructor(t){c(this,"onUpdateEvent",new Ie);c(this,"_state","Disable");c(this,"defaultArgs");c(this,"_args");c(this,"resolve",()=>{});c(this,"show",t=>{this._args=t,this._state="Shown",this.onUpdateEvent.trigger();const{promise:i,resolve:r}=Ms();return this.resolve=a=>{this._state="Disable",r(a),this.resolve=()=>{},this.onUpdateEvent.trigger()},i});c(this,"cancel",()=>{this._state!=="Disable"&&this.resolve(void 0),this.terminate()});c(this,"terminate",()=>{this._state="Disable",this._args=this.defaultArgs,this.resolve=()=>{}});this.defaultArgs=t,this._args=t}get onUpdate(){return this.onUpdateEvent.expose()}get state(){return this._state}get args(){return this._args}}class zc{constructor(t){c(this,"onUpdateEvent",new Ie);c(this,"actionSelector",new ea({title:"カード操作を選択。",activator:void 0,dummyActionInfos:[],cancelable:!1}));c(this,"entitySelector",new ea({title:"対象を選択",entitiesChoices:{selectables:[],validator:()=>!0,cancelable:!1},cancelable:!1,chainBlockInfos:[]}));c(this,"textSelector",new ea({title:"カード操作を選択。",choises:[],cancelable:!1}));c(this,"modals",[this.actionSelector,this.entitySelector,this.textSelector]);c(this,"view");c(this,"terminateAll",()=>{this.modals.forEach(t=>t.terminate()),this.onUpdateEvent.trigger()});this.view=t,this.modals.forEach(i=>i.onUpdate.append(()=>this.onUpdateEvent.trigger()))}get onUpdate(){return this.onUpdateEvent.expose()}}const _n=e=>{let t=[];do{const i=e.qty&&e.qty>0?e.qty:Math.floor(Math.random()*e.selectables.length+1);t=e.selectables.randomPickMany(i)}while(!e.validator(t));return t},Vc=[{seq:10,name:"Internet Explorer",key:"msie"},{seq:20,name:"Internet Explorer",key:"trident"},{seq:30,name:"Edge",key:"edge"},{seq:40,name:"Google Chrome",key:"chrome"},{seq:50,name:"Safari",key:"safari"},{seq:60,name:"Mozilla Firefox",key:"firefox"},{seq:70,name:"Opera",key:"opera"}],Wc=[{seq:10,name:"Microsoft Windows",key:"windows nt"},{seq:20,name:"Android",key:"android"},{seq:30,name:"iOS",key:"iphone"},{seq:40,name:"iOS",key:"ipad"},{seq:50,name:"macOS",key:"mac os x"}],Ji=window.navigator.userAgent.toLowerCase();var Dn;const Yc=((Dn=Vc.find(e=>Ji.indexOf(e.key)!==-1))==null?void 0:Dn.name)??"Unknown Browser";var Mn;const $a=((Mn=Wc.find(e=>Ji.indexOf(e.key)!==-1))==null?void 0:Mn.name)??"Unknown OS",As=Ji.indexOf("iphone")!==-1||$a==="Android"&&Ji.indexOf("mobile")!==-1,Qc=Ji.indexOf("ipad")!==-1||$a==="Android"&&!As,mn=As?"Smart Phone":Qc?"Tablet Device":"PC",hr={canDragElement:mn==="PC",text:`${mn} ${$a} ${Yc}`};class Kc{constructor(t){c(this,"onDuelUpdateEvent",new Ie);c(this,"requireUpdate",()=>{this.onDuelUpdateEvent.trigger()});c(this,"onWaitStartEvent",new Ie);c(this,"onWaitEndEvent",new Ie);c(this,"onDragStartEvent",new Ie);c(this,"onDragEndEvent",new Ie);c(this,"onAnimationStartEvent",new Ie);c(this,"onShowCardEntityEvent",new Ie);c(this,"duel");c(this,"modalController");c(this,"_message");c(this,"waitMode");c(this,"infoBoardState");c(this,"infoBoardCell");c(this,"getCell",(t,i)=>this.duel.field.cells[t][i]);c(this,"showCardInfo",(t,i)=>{this.onShowCardEntityEvent.trigger({card:t,mode:i})});c(this,"dispose",()=>{this.onDragStartEvent.clear(),this.onDragEndEvent.clear(),this.onDuelUpdateEvent.clear(),this.onWaitStartEvent.clear(),this.onWaitEndEvent.clear()});c(this,"waitFieldAction",async t=>{if(this.duel.getTurnPlayer().duelistType==="NPC"){const n=this.duel.getTurnPlayer().selectActionForNPC(t,[]);return n?{actionInfo:n}:{phaseChange:this.duel.nextPhaseList[0]}}const i=await this._waitDuelistAction(this.duel.getTurnPlayer(),t,"Free","",void 0,void 0,!1);if(!i.actionInfo)return{...i,actionInfo:void 0};const r={...i.actionInfo},a=t.find(n=>{var s;return((s=i.actionInfo)==null?void 0:s.originSeq)===n.originSeq});if(!a)throw new se("想定されない状態",t,i);return{...i,actionInfo:{dest:r.dest,battlePosition:r.battlePosition,action:a.action,originSeq:a.originSeq}}});c(this,"waitQuickEffect",async(t,i,r,a,n)=>{if(i.length===0)return;if(t.duelistType==="NPC")return t.selectActionForNPC(i,r);const s=[this.modalController.actionSelector.show({title:a,activator:t,dummyActionInfos:i,cancelable:n}),this._waitDuelistAction(t,i,"Modal",this.message,void 0,void 0,!1).then(o=>o.actionInfo)],l=await Promise.any(s);if(!l)return;this.infoBoardState="Log";const d=i.find(o=>l.originSeq===o.originSeq);if(!d)throw new se("想定されない状態",l);return{...d,dest:l.dest}});c(this,"waitSubAction",async(t,i,r,a=!1)=>{if(t.duelistType==="NPC")throw Error("Not implemented");const n=await this._waitDuelistAction(t,i,"Modal",r,void 0,void 0,a);if(n&&n.actionInfo)return n.actionInfo});c(this,"waitSelectEntities",async(t,i,r)=>{if(!i.selectables.length)return;if(i.qty&&i.selectables.length===i.qty)return[...i.selectables];if(t.duelistType==="NPC")return _n(i);let a;i.selectables.some(s=>s.entityType==="Duelist")&&(a={...i,selectables:i.selectables.filter(s=>s.entityType==="Duelist").map(s=>s.fieldCell),qty:1,validator:s=>s.length===1});const n=await this._waitDuelistAction(t,[],"Modal",r,i,a,i.cancelable);return[...n.selectedEntities??[],...(n.selectedCells??[]).flatMap(s=>s.entities).filter(s=>s.entityType==="Duelist")]});c(this,"waitSelectText",(t,i,r=!1)=>this.modalController.textSelector.show({title:i,choises:t,cancelable:r}));c(this,"waitAnimation",async t=>(this._message="",this.waitMode="Animation",this.onDuelUpdateEvent.trigger(),new Promise(i=>this.onAnimationStartEvent.trigger({...t,resolve:i}))));c(this,"setDraggingActions",t=>{this.onDragStartEvent.trigger(t),this.requireUpdate()});c(this,"removeDraggingActions",()=>{this.onDragEndEvent.trigger()});c(this,"waitSelectAction",async(t,i,r,a)=>{var d;const n=i.map(o=>Mi.createDummyAction(o.entity,o.title,[],void 0,o.origin)),s=await this._waitDammyAction(t,n,r,a);if(!s)return;const l=(d=i.find(o=>o.origin.seq===s.originSeq))==null?void 0:d.origin;if(!l)throw new se("想定されない状態",i,s);return l});c(this,"waitSelectSummonDestination",async(t,i,r,a,n)=>{const s=r.length>1&&hr.canDragElement?"カードを召喚先へドラッグ。":"表示形式を選択。";if(!r.length&&!a.length){if(n)return;throw new se("想定されない状態",t,i,r,a,n)}let l=[...a];for(;;){const d={dest:r.randomPick(),battlePosition:l[0]};if(l.length===1&&!hr.canDragElement){const v=await this.waitSelectCell(t,r,n,"召喚先を選択。");return v?{dest:v,battlePosition:a[0]}:void 0}const o=l.map(v=>Mi.createDummyAction(i,v,r,v)),f=await this._waitDammyAction(t,o,s,n);if(!f)return;if(f.battlePosition&&(l=[f.battlePosition]),!(r.length>1&&!f.dest))return d.dest=f.dest??d.dest,d.battlePosition=f.battlePosition??d.battlePosition,d}});c(this,"waitSelectDestination",async(t,i,r,a,n,s=!1)=>{if(!r.length)return;if(r.length===1)return r[0];if(!hr.canDragElement)return await this.waitSelectCell(t,r,s,a);let l=r.randomPick();const d=[Mi.createDummyAction(i,n,r,void 0)],o=await this._waitDammyAction(t,d,a,s);if(o)return l=o.dest??l,l});c(this,"_waitDammyAction",async(t,i,r,a=!1)=>{if(!i.length)return;const n=i.randomPick();let s={...n,dest:n.dest??n.dests.randomPick()};if(t.duelistType!=="NPC"){const l=[this.modalController.actionSelector.show({title:r,activator:t,dummyActionInfos:i,cancelable:!1}),this.duel.view.waitSubAction(t,i,r,a)],d=await Promise.any(l);if(!d&&!a)throw new rt(d,l);if(!d)return;s=d??s}return s});c(this,"waitSelectCell",async(t,i,r,a)=>i.length?t.duelistType==="NPC"?i.randomPick():(await this.waitSelectCells(t,{selectables:i,qty:1,validator:s=>s.length===1,cancelable:r},a)??[])[0]:void 0);c(this,"waitSelectCells",async(t,i,r)=>{if(!i.selectables.length)return;if(t.duelistType==="NPC")return _n(i);const a=await this._waitDuelistAction(t,[],"Modal",r,void 0,i,i.cancelable);if((!a||!a.selectedCells)&&!i.cancelable)throw new rt(t,i,r);return a.selectedCells});c(this,"_waitDuelistAction",async(t,i,r,a,n,s,l=!1)=>{for(this.waitMode=r,this._message=a;this.onDuelUpdateEvent.length<40;)await Ds(1);this.onDuelUpdateEvent.trigger();const d=Ms(),o={resolve:d.resolve,activator:t,dummyActionInfos:i,chainBlockInfos:t.duel.chainBlockInfos,entitiesChoices:n,cellsChoices:s};this.onWaitStartEvent.trigger(o);const f=await d.promise;if(console.info("response",f),this.modalController.terminateAll(),this.waitMode="None",this.onWaitEndEvent.trigger(),f.surrender)throw new kt(t.getOpponentPlayer(),`${t.profile.name}がサレンダーした。`);if(!l&&f.cancel)throw new se("キャンセル不可のアクションがキャンセルされた。",f,i,r,n,s);return this.infoBoardState="Log",f});this.duel=t,this._message="",this.waitMode="None",this.infoBoardState="Log",this.infoBoardCell=t.duelists.Below.getExtraDeck(),this.modalController=new zc(this)}get onDuelUpdate(){return this.onDuelUpdateEvent.expose()}get onWaitStart(){return this.onWaitStartEvent.expose()}get onWaitEnd(){return this.onWaitEndEvent.expose()}get onDragStart(){return this.onDragStartEvent.expose()}get onDragEnd(){return this.onDragEndEvent.expose()}get onAnimation(){return this.onAnimationStartEvent.expose()}get onShowCardEntity(){return this.onShowCardEntityEvent.expose()}get message(){var t;return(this._message||((t=this.duel.log.lastRecord)==null?void 0:t.text))??""}}const ma=["turn","phaseSeq","stepSeq","stageSeq","chainSeq","chainBlockSeq","procSeq"];[...ma];class Xc{constructor(){c(this,"onClockChangeEvents",{turn:new Ie,phaseSeq:new Ie,stepSeq:new Ie,stageSeq:new Ie,chainSeq:new Ie,chainBlockSeq:new Ie,procSeq:new Ie});c(this,"_turn",0);c(this,"_phaseSeq",0);c(this,"_stepSeq",0);c(this,"_stageSeq",0);c(this,"_chainSeq",0);c(this,"_chainBlockSeq",0);c(this,"_procSeq",0);c(this,"_totalProcSeq",0);c(this,"_periodKey");c(this,"_previousStartPoints",{turn:0,phaseSeq:0,stepSeq:0,stageSeq:0,chainSeq:0,chainBlockSeq:0,procSeq:0});c(this,"_currentStartPoints",{turn:0,phaseSeq:0,stepSeq:0,stageSeq:0,chainSeq:0,chainBlockSeq:0,procSeq:0});c(this,"setPhase",(t,i)=>{const r=Object.values(ri).filter(a=>a.phase===i).find(a=>(a.step??"start")==="start");if(!r)throw new se("想定されない状態",this.period,i,ri);i==="draw"?(this.turn>0&&t.log.info("ターン終了。",t.getTurnPlayer()),this._turn++,this._phaseSeq=0):(t.log.info(`フェイズ移行（${this.period.name}→${r.name}）`,t.getTurnPlayer()),this._phaseSeq++),this._stepSeq=0,this._stageSeq=0,this.periodKey=r.key});c(this,"setStep",(t,i)=>{const r=this.period.phase,a=Object.values(ri).filter(n=>n.phase===r).find(n=>(n.step??"")===i);if(!a)throw new se("想定されない状態",this.period,i,ri);this.period.name!==a.name&&(t.log.info(`ステップ移行（${this.period.name}→${a.name}）`,t.getTurnPlayer()),this._stepSeq++,this._stageSeq=0,this.periodKey=a.key)});c(this,"setStage",(t,i)=>{const r=this.period,a=Object.values(ri).filter(n=>n.phase===r.phase).filter(n=>n.step===r.step).find(n=>(n.stage??"")===i);if(!a)throw new se("想定されない状態",this.period,i,ri);t.log.info(`タイミング移行（${this.period.name}→${a.name}）`,t.getTurnPlayer()),this._stageSeq++,this.periodKey=a.key});c(this,"incrementChainSeq",()=>{this._chainSeq++,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq()});c(this,"incrementChainBlockSeq",()=>{this._chainBlockSeq++,this._procSeq=0,this.incrementTotalProcSeq()});c(this,"incrementProcSeq",()=>{this._procSeq++,this.incrementTotalProcSeq()});c(this,"incrementTotalProcSeq",()=>{this._totalProcSeq++;let t=!1;ma.toReversed().forEach(i=>{t&&(this._previousStartPoints[i]=this.currentStartPoints[i],this._currentStartPoints[i]=this.totalProcSeq),t=this[i]===0}),ma.toReversed().filter(i=>this._currentStartPoints[i]=this.totalProcSeq).filter(i=>i!=="procSeq").forEach(i=>this.onClockChangeEvents[i].trigger(this)),this.onClockChangeEvents.procSeq.trigger(this)});c(this,"toString",()=>`${this.totalProcSeq}(t${this.turn}-phs${this.phaseSeq}-stp${this.stepSeq}-stg${this.stepSeq}-c${this.chainSeq}-cb${this.chainBlockSeq}-prc${this.procSeq})`);c(this,"getClone",()=>({turn:this.turn,phaseSeq:this.phaseSeq,stepSeq:this.stepSeq,stageSeq:this.stageSeq,chainSeq:this.chainSeq,chainBlockSeq:this.chainBlockSeq,procSeq:this.procSeq,totalProcSeq:this.totalProcSeq,period:this.period}));c(this,"isSameTurn",t=>this.turn===t.turn);c(this,"isSameChain",t=>this.turn===t.turn&&this.phaseSeq===t.phaseSeq&&this.stepSeq===t.stepSeq&&this.stageSeq===t.stageSeq&&this.chainSeq===t.chainSeq);c(this,"isPreviousChain",t=>this.turn===t.turn&&this.phaseSeq===t.phaseSeq&&this.stepSeq===t.stepSeq&&this.stageSeq===t.stageSeq&&this.chainSeq===t.chainSeq+1);c(this,"isPreviousStage",t=>this.turn===t.turn&&this.phaseSeq===t.phaseSeq&&this.stepSeq===t.stepSeq&&this.stageSeq===t.stageSeq+1);c(this,"isPreviousTurn",t=>this.turn===t.turn+1);c(this,"isPreviousProc",t=>this.totalProcSeq===t.totalProcSeq+1);c(this,"isUponAttackDeclaration",()=>this.period.step==="battle"&&this.chainSeq===1);this._periodKey="end"}get onTurnChange(){return this.onClockChangeEvents.turn.expose()}get onStageChange(){return this.onClockChangeEvents.stageSeq.expose()}get onProcSeqChange(){return this.onClockChangeEvents.procSeq.expose()}get previousStartPoints(){return this._previousStartPoints}get currentStartPoints(){return this._currentStartPoints}set periodKey(t){this._periodKey!==t&&(this._periodKey=t,this._chainSeq=0,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq())}get periodKey(){return this._periodKey}get period(){return ri[this.periodKey]}get turn(){return this._turn}get phaseSeq(){return this._phaseSeq}get stepSeq(){return this._stepSeq}get stageSeq(){return this._stageSeq}get chainSeq(){return this._chainSeq}get chainBlockSeq(){return this._chainBlockSeq}get procSeq(){return this._procSeq}get totalProcSeq(){return this._totalProcSeq}get isFirstChain(){return this.chainSeq===0}}class Jc{constructor(t){c(this,"nextSeq");c(this,"records",[]);c(this,"duel");c(this,"push",t=>{this.records.push({seq:this.nextSeq++,clock:this.duel.clock.getClone(),chainBlockInfo:t})});this.nextSeq=0,this.duel=t}}const Ic=["PlayFirst","DrawFirst","Random"],Sn={PlayFirst:"先攻",DrawFirst:"後攻",Random:"ランダム"};class kt extends Error{constructor(i,r){super(i?`デュエルが終了した。勝者：${i.profile.name}`:"デュエルが終了した。ドロー。");c(this,"winner");c(this,"message");this.winner=i,this.message=r}}class se extends Error{constructor(i,...r){super(i);c(this,"message");c(this,"items");this.message=i,this.items=r}}class rt extends se{constructor(...t){super("キャンセル不可のアクションがキャンセルされた。",...t)}}class ed{constructor(t,i,r,a=[],n,s,l,d=[],o="Random"){c(this,"onDuelEndEvent",new Ie);c(this,"view");c(this,"log");c(this,"chainBlockLog");c(this,"clock");c(this,"nextPhaseList");c(this,"field");c(this,"attackingMonster");c(this,"targetForAttack");c(this,"_chainBlockInfos");c(this,"duelists");c(this,"priorityHolder");c(this,"isEnded");c(this,"winner");c(this,"coin",!1);c(this,"startMode");c(this,"distributeOperators",t=>{console.info(`[totalProcSeq]:${t.totalProcSeq}`);let i=0;for(;;){if(i++,i>10)throw new se("無限ループ発生");if(this.field.procFilterPool.distributeAll(this)&&this.field.statusOperatorPool.distributeAll(this)&&this.field.numericStateOperatorPool.distributeAll(this)&&this.field.summonFilterPool.distributeAll(this))return}});c(this,"getTurnPlayer",()=>this.clock.turn%2===0?this.secondPlayer:this.firstPlayer);c(this,"getNonTurnPlayer",()=>this.clock.turn%2===0?this.firstPlayer:this.secondPlayer);c(this,"main",async()=>{console.info("main start!"),this.coin=this.startMode==="PlayFirst"?!0:this.startMode==="DrawFirst"?!1:Math.random()>.5,this.priorityHolder=this.firstPlayer;const t=Eu(...Object.values(this.duelists).flatMap(i=>i.deckInfo.cardNames).getDistinct()).reduce((i,r)=>(i[r.name]=r,{...i}),{});for(const i of Object.values(this.duelists))i.pushDeck(t),i.getDeckCell().shuffle(),i.initHand.length&&i.initHand.forEach(r=>{const a=i.getDeckCell().cardEntities.find(n=>n.origin.name===r);if(!a){this.log.info(`初手操作により${r}を手札に加えようとしたが、デッキに存在しない。`);return}a.addToHand(["System"],void 0,void 0),this.log.info(`初手操作により${a.toString()}を手札に加えた`,i)}),await i.draw(5-i.getHandCell().cardEntities.length,void 0,void 0);this.log.info(`【デュエル開始】${this.firstPlayer.profile.name} V.S. ${this.secondPlayer.profile.name}`),this.log.info(`先攻：${this.firstPlayer.profile.name} 後攻：${this.secondPlayer.profile.name}`),this.moveNextPhase("draw");try{for(const i of Object.values(this.duelists))for(const r of this.getEnableActions(i,["Exodia"],["Normal"],[]))await r.action.directExecute(i,void 0,!1);for(;!this.isEnded&&(this.clock.period.phase==="draw"?await this.procDrawPhase():this.phase==="standby"?await this.procStanbyPhase():this.phase==="main1"?await this.procMainPhase():this.phase==="battle1"?await this.procBattlePhase():this.phase==="battle2"?await this.procBattlePhase():this.phase==="main2"?await this.procMainPhase():this.phase==="end"&&await this.procEndPhase(),!(this.clock.turn>1e3)););}catch(i){i instanceof kt?(this.clock.incrementChainSeq(),console.info(i),this.isEnded=!0,this.winner=i.winner,this.log.info(i.winner?`デュエル終了。勝者${i.winner.profile.name}。${i.message}`:`デュエル終了。引き分け。${i.message}`),this.onDuelEndEvent.trigger()):i instanceof Error&&this.log.error(i)}finally{this.log.dispose()}});c(this,"moveNextPhase",t=>{this.clock.setPhase(this,t),this.phase==="main2"||this.clock.turn===1?this.nextPhaseList=["end"]:this.phase==="battle1"||this.phase==="battle2"?this.nextPhaseList=["main2"]:this.phase==="main1"?this.nextPhaseList=["battle1","end"]:this.nextPhaseList=[]});c(this,"declareAnAttack",(t,i)=>{var a;this.attackingMonster=t,this.targetForAttack=i;let r=" ("+((a=i.battlePosition==="Attack"?i.atk:i.def)==null?void 0:a.toString())+")";i.face==="FaceDown"&&(r=" (????)"),i.entityType==="Duelist"&&(r=""),t.info.attackCount++,this.log.info(`攻撃宣言：${t.toString()} (${t.atk})⇒ ${i.toString()}${r}`,t.controller)});c(this,"procDrawPhase",async()=>{if(Object.values(this.duelists).forEach(t=>t.initForDrawPhase()),this.log.info("ドローフェイズ開始。",this.getTurnPlayer()),this.clock.turn===1)this.log.info("先攻プレイヤーはドローできない。",this.getTurnPlayer());else{await this.getTurnPlayer().draw(1,void 0,void 0);for(const t of this.getEnableActions(this.getTurnPlayer(),["Exodia"],["Normal"],[]))await t.action.directExecute(this.getTurnPlayer(),void 0,!1)}this.field.getCardsOnFieldStrictly().forEach(t=>t.initForTurn()),await this.procSpellSpeed1(),this.moveNextPhase("standby")});c(this,"procStanbyPhase",async()=>{await this.procSpellSpeed1(),this.moveNextPhase("main1")});c(this,"procMainPhase",async()=>{for(;;){this.priorityHolder=this.getTurnPlayer();const t=await this.view.waitFieldAction(this.getEnableActions(this.priorityHolder,["NormalSummon","SpellTrapSet","SpecialSummon","FlipSummon","ChangeBattlePosition","IgnitionEffect","QuickEffect","CardActivation"],["Normal","Quick","Counter"],[]));if(console.info("response",t),t&&t.actionInfo){if([...rd].includes(t.actionInfo.action.playType)){const r=await t.actionInfo.action.prepare(this.priorityHolder,t.actionInfo.dest,void 0,[],!0,!1);if(r===void 0)continue;await t.actionInfo.action.execute(r,this.chainBlockInfos),this.clock.incrementChainSeq()}else if(await this.procChainBlock({activator:this.priorityHolder,actionInfo:t.actionInfo},void 0)==="cancel")continue;await this.procFreeChain();continue}const i=t.phaseChange;if(i){this.priorityHolder=this.getNonTurnPlayer();let r="done";for(;;){const a=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(this.priorityHolder,["QuickEffect","TriggerEffect"],["Quick","Counter"],[]),[],"",!0);if(!a){this.moveNextPhase(i);return}if(r=await this.procChainBlock({activator:this.priorityHolder,actionInfo:a},void 0),r==="done")break}if(r==="done"){await this.procFreeChain();continue}}}});c(this,"procBattlePhase",async()=>{await this.procBattlePhaseStartStep(),await this.procBattlePhaseBattleStep(),await this.procBattlePhaseEndStep()});c(this,"procBattlePhaseStartStep",async()=>{this.clock.setStep(this,"start"),this.priorityHolder=this.getTurnPlayer(),this.attackingMonster=void 0,this.targetForAttack=void 0,await this.procSpellSpeed1()});c(this,"procBattlePhaseBattleStep",async()=>{for(;;){this.clock.setStep(this,"battle"),this.priorityHolder=this.getTurnPlayer();const t=await this.view.waitFieldAction(this.getEnableActions(this.priorityHolder,["Battle"],["Normal"],[]));if(t.phaseChange)break;if(t.actionInfo){const i=await t.actionInfo.action.prepare(this.priorityHolder,t.actionInfo.dest,void 0,[],!0,!1);if(!i)continue;await t.actionInfo.action.execute(i,[]),this.clock.incrementChainSeq();let r=!0;for(;;){const a=this.getNonTurnPlayer().getMonstersOnField().map(s=>[s.seq,s.moveLog.latestRecord.movedAt.totalProcSeq]);if(await this.procFreeChain(),!this.attackingMonster)throw new se("想定されない状態");this.attackingMonster.isOnFieldStrictly?this.attackingMonster.face==="FaceDown"?(this.log.info(`${this.attackingMonster.toString()}が裏側守備表示になったため、戦闘が中断された。`),r=!1):this.attackingMonster.orientation==="Horizontal"&&(this.log.info(`${this.attackingMonster.toString()}が守備表示になったため、戦闘が中断された。`),r=!1):(this.log.info(`${this.attackingMonster.toString()}がフィールドにいなくなったため、戦闘が中断された。`),r=!1);const n=this.getNonTurnPlayer().getMonstersOnField().map(s=>[s.seq,s.moveLog.latestRecord.movedAt.totalProcSeq]);if(a.length!==n.length)throw this.log.info("モンスターの数が増減したためバトルステップの巻き戻しが発生。"),new se("巻き戻し未実装");if(a.some(([s,l])=>n.every(([d,o])=>d!==s||o!==l)))throw this.log.info("モンスターの数が増減したためバトルステップの巻き戻しが発生。"),new se("巻き戻し未実装");break}if(!r)continue;await this.procBattlePhaseDamageStep(i)}}});c(this,"procBattlePhaseDamageStep",async t=>{if(!this.attackingMonster||!this.targetForAttack)throw new se("想定されない状態",this.attackingMonster,this.targetForAttack);if(this.targetForAttack.entityType!=="Duelist"&&!this.targetForAttack.isOnFieldAsMonsterStrictly)throw new se("想定されない状態",this.attackingMonster,this.targetForAttack);await this.procBattlePhaseDamageStep1(),await this.procBattlePhaseDamageStep2(this.attackingMonster,this.targetForAttack),await this.procBattlePhaseDamageStep3(t,this.attackingMonster,this.targetForAttack),await this.procBattlePhaseDamageStep4(),await this.procBattlePhaseDamageStep5()});c(this,"procBattlePhaseDamageStep1",async()=>{this.clock.setStage(this,"start"),await this.procFreeChain()});c(this,"procBattlePhaseDamageStep2",async(t,i)=>{this.clock.setStage(this,"beforeDmgCalc"),(i==null?void 0:i.battlePosition)==="Set"&&i.setBattlePosition("Defense",["Flip","FlipByBattle"],t,t.controller),await this.procFreeChain()});c(this,"procBattlePhaseDamageStep3",async(t,i,r)=>{if(i.atk===void 0)throw new se("想定されない状態",this.attackingMonster,this.targetForAttack);this.clock.setStage(this,"dmgCalc"),await this.procFreeChain();const a=i.atk,n=(r.battlePosition==="Attack"?r.atk:r.def)??0;r.entityType==="Duelist"?(t.activator.writeInfoLog(`ダメージ計算：${i.toString()} (${a}) ⇒ ${r.toString()}`),i.controller.getOpponentPlayer().battleDamage(a-n,i)):(t.activator.writeInfoLog(`ダメージ計算：${i.toString()} (${a}) ⇒ ${r.toString()} (${n})`),a>0&&a>n&&r.battlePosition==="Attack"?i.controller.getOpponentPlayer().battleDamage(a-n,i):a<n&&i.controller.battleDamage(n-a,r),a>0&&(a>n||a===n&&r.battlePosition==="Attack")&&await ae.tryMarkForDestory([r],t),r.battlePosition==="Attack"&&a<=n&&await ae.tryMarkForDestory([i],t)),i.info.battleLog.push({enemy:r,timestamp:this.clock.getClone()}),r.info.battleLog.push({enemy:i,timestamp:this.clock.getClone()});const s=Object.values(this.duelists).filter(l=>l.lp<=0);if(s.length)throw s.length===1?new kt(s[0].getOpponentPlayer(),"戦闘ダメージによって、相手のライフポイントをゼロにした。"):new kt(void 0,"戦闘ダメージによって、お互いのライフポイントがゼロになった。")});c(this,"procBattlePhaseDamageStep4",async()=>{this.clock.setStage(this,"afterDmgCalc"),await this.procFreeChain()});c(this,"procBattlePhaseDamageStep5",async()=>{this.clock.setStage(this,"end"),await ae.waitCorpseDisposal(this),this.clock.incrementChainSeq(),await this.procFreeChain()});c(this,"procBattlePhaseEndStep",async()=>{this.clock.setStep(this,"end"),this.priorityHolder=this.getTurnPlayer(),await this.procSpellSpeed1(),this.moveNextPhase("main2")});c(this,"procEndPhase",async()=>{for(await this.procSpellSpeed1();;){const i=this.getTurnPlayer().getHandCell().cardEntities.length;if(i<7)break;await this.getTurnPlayer().discard(i-6,["Rule"])}this.moveNextPhase("draw")});c(this,"procSpellSpeed1",async()=>{this.priorityHolder=this.getTurnPlayer();let t=0;const i={Above:Number.MAX_VALUE,Below:Number.MAX_VALUE};for(;Object.values(i).some(r=>r!==0);){const r=this.getEnableActions(this.priorityHolder,["IgnitionEffect","QuickEffect","CardActivation","LingeringEffect"],["Normal","Quick","Counter"],[]);i[this.priorityHolder.seat]=r.filter(l=>l.action.isMandatory).length;const a=r.find(l=>l.action.isMandatory);let n=a?{action:a.action,originSeq:a.action.seq}:void 0,s=!n;if(this.priorityHolder.isTurnPlayer?t===0&&(s=!0):i[this.priorityHolder.getOpponentPlayer().seat]>=0&&(s=!0),r.length&&(r.length>1||!n)&&(n=await this.view.waitQuickEffect(this.priorityHolder,r,[],s?"":"まだ発動しなければならない効果が残っている。",s)),n){if(Ha.some(l=>l===n.action.playType))await this.procChainBlock({activator:this.priorityHolder,actionInfo:n},void 0);else{console.log(n.dest);const l=await n.action.prepare(this.priorityHolder,n.dest,void 0,[],!0,!1);if(!l)continue;await n.action.execute(l,[]),await n.action.settle(l,[]),this.clock.incrementChainSeq()}await this.procFreeChain(),this.priorityHolder=this.getTurnPlayer(),t=0;continue}this.priorityHolder=this.priorityHolder.getOpponentPlayer(),t++}});c(this,"procFreeChain",async()=>{for(;await this.procChainBlock(void 0,void 0)!=="pass";);});c(this,"procChainBlock",async(t,i)=>{const r=this.chainBlockInfos.length===0;let a=t?[]:i??Object.values(this.duelists).flatMap(s=>this.getEnableActions(s,["TriggerEffect"],[this.chainBlockInfos.length?"Quick":"Normal"],this.chainBlockInfos).map(l=>({activator:s,actionInfo:l,targetChainBlock:this.chainBlockInfos.slice(-1)[0]}))),n;if(t)n={activator:t.activator,action:t.actionInfo.action,dest:t.actionInfo.dest,targetChainBlock:void 0},this.priorityHolder=n.activator;else if(a.length>0){const s=await this.selectTriggerEffect(a);s?(a=a.filter(l=>l!==s),n={...s,action:s.actionInfo.action},this.priorityHolder=n.activator):a=[]}if(!n){let s=0;for(;s<2;){this.priorityHolder=this.priorityHolder.getOpponentPlayer();const l=["Counter"];this.chainBlockInfos.every(f=>f.action.spellSpeed!=="Counter")&&l.push("Quick");const d=this.chainBlockInfos.length?"※メッセージ考え中※":"クイックエフェクト発動タイミング。効果を発動しますか？",o=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(this.priorityHolder,["QuickEffect","CardActivation"],l,this.chainBlockInfos),this.chainBlockInfos,d,!0);if(o){n={...o,activator:this.priorityHolder,targetChainBlock:this.chainBlockInfos.slice(-1)[0]};break}s++}}if(console.info("selected action: ",n),n){const s=n.activator;console.log(n.dest);const l=await n.action.prepare(s,n.dest,n.targetChainBlock,this.chainBlockInfos,r,!1);if(!l)return"cancel";this.chainBlockLog.push(l);const d=[...l.action.entity.info.isEffectiveIn];if(this._chainBlockInfos.push(l),this.clock.incrementProcSeq(),this.clock.incrementChainBlockSeq(),a=a.filter(o=>o.actionInfo.action.seq!==(n==null?void 0:n.action.seq)).filter(o=>o.actionInfo.action.validateCount(o.activator,this.chainBlockInfos)),await this.procChainBlock(void 0,a.length?a:void 0),l.chainNumber&&this.log.info(`チェーン${l.chainNumber}: ${l.action.toString()}の効果処理。`,s),l.isNegatedActivationBy)l.chainNumber&&this.log.info(`チェーン${l.chainNumber}: ${l.action.toString()}を${l.isNegatedActivationBy.toString()}によって発動を無効にした。`,l.activator);else{let o=l.action.entity.isEffective,f="";if(o){if(l.isNegatedEffectBy)f=`チェーン${l.chainNumber}: ${l.action.toString()}を${l.isNegatedEffectBy.toString()}によって効果を無効にした。`,o=!1;else if(!d.includes(l.isActivatedIn.cellType)){const v=l.action.entity.moveLog.records.findLast(p=>p.face==="FaceDown"&&p.orientation==="Horizontal");o=(v&&this.clock.isSameChain(v.movedAt))??!1}}if(o?(await l.action.execute(l,this.chainBlockInfos),l.state="done"):(l.state="failed",l.chainNumber&&(f=f||`チェーン${l.chainNumber}: カードの効果が無効となっているため${l.action.toString()}の効果処理を行えない。`),this.log.info(f,l.activator)),await n.action.settle(l,this.chainBlockInfos),l.state==="done")for(const v of[this.getTurnPlayer(),this.getNonTurnPlayer()]){for(const p of this.getEnableActions(v,["Exodia"],["Normal"],[l]))await p.action.directExecute(v,l,!1);for(const p of this.getEnableActions(v,["AfterChainBlock"],["Normal"],[l])){await p.action.directExecute(v,l,!1);for(const y of this.getEnableActions(v,["Exodia"],["Normal"],[l]))await y.action.directExecute(v,l,!1)}}}r?(await ae.sendManyToGraveyardForTheSameReason(this._chainBlockInfos.filter(o=>o.action.playType==="CardActivation").filter(o=>!o.action.isLikeContinuousSpell).map(o=>o.action.entity).filter(o=>o.isOnFieldStrictly).filter(o=>o.face==="FaceUp"),["Rule"],void 0,void 0),this._chainBlockInfos.reset(),l.nextActionInfo&&await this.procChainBlock({activator:l.activator,actionInfo:l.nextActionInfo},void 0),this.clock.incrementChainSeq()):(l.nextActionInfo&&await l.nextActionInfo.action.directExecute(l.activator,void 0,!1),this.clock.incrementChainBlockSeq())}return n?"done":"pass"});c(this,"selectTriggerEffect",async t=>{if(t.length>0)for(const i of[!0,!1])for(const r of[this.getTurnPlayer(),this.getNonTurnPlayer()]){const a=t.filter(s=>s.actionInfo.action.isMandatory===i&&s.activator===r);if(a.length===0)continue;if(a.length===1&&i)return a[0];const n=await this.view.waitQuickEffect(r,a.map(s=>s.actionInfo),this.chainBlockInfos,"トリガーエフェクトを選択。",!i);if(n)return a.find(s=>s.actionInfo.action===n.action)}});c(this,"executeSystemPeriodActions",()=>{Object.values(this.duelists).flatMap(t=>this.getEnableActions(t,["SystemPeriodAction"],["Normal"],[]).map(i=>({duelist:t,action:i})))});c(this,"getEnableActions",(t,i,r,a)=>{var s;const n=((s=a.slice(-1)[0])==null?void 0:s.nextChainBlockFilter)??(()=>!0);return[...this.field.getAllCardEntities(),t.entity].flatMap(l=>l.actions).filter(l=>l.executableCells.includes(l.entity.fieldCell.cellType)).filter(l=>l.executablePeriods.includes(this.clock.period.key)).filter(l=>r.includes(l.spellSpeed)).filter(l=>l.validateDuelist(t)).filter(l=>i.includes(l.playType)).filter(l=>n(t,l)).map(l=>l.validate(t,a,!1)).filter(l=>l!==void 0)});this.clock=new Xc,this.nextPhaseList=[],this.isEnded=!1,this.startMode=o,this.duelists={Below:new Dr(this,"Below",t,i,r,a),Above:new Dr(this,"Above",n,s,l,d)},this.priorityHolder=this.firstPlayer,this._chainBlockInfos=[],this.field=new Uc(this),this.clock.onProcSeqChange.append(this.distributeOperators),this.clock.onStageChange.append(this.executeSystemPeriodActions),this.view=new Kc(this),this.log=new Gc(this),this.chainBlockLog=new Jc(this)}get onDuelEnd(){return this.onDuelEndEvent.expose()}get phase(){return this.clock.period.phase}get step(){return this.clock.period.step}get stage(){return this.clock.period.stage}get chainBlockInfos(){return this._chainBlockInfos}get firstPlayer(){return this.coin?this.duelists.Below:this.duelists.Above}get secondPlayer(){return this.coin?this.duelists.Above:this.duelists.Below}}const wt=class wt{constructor(t){c(this,"id");c(this,"name");c(this,"description");c(this,"previousNpcId");c(this,"previousNpcDeckId");c(this,"previousStartMode");c(this,"save",async t=>{console.log(this.previousNpcDeckId,Number.MIN_SAFE_INTEGER);const i=t??{id:this.id,name:this.name,description:this.description,previousNpcId:this.previousNpcId,previousStartMode:this.previousStartMode,previousNpcDeckId:this.previousNpcDeckId>-1?this.previousNpcDeckId:Number.MIN_SAFE_INTEGER};console.log(this.previousNpcDeckId,Number.MIN_SAFE_INTEGER,i);const r=await wt.tblHeader.update(this.id,a=>({...a,...i}));return console.log(this.previousNpcDeckId,Number.MIN_SAFE_INTEGER,i,r),new wt(r)});var i;this.id=t.id,this.name=t.name,this.description=t.description,this.previousNpcId=((i=zi.find(r=>r.id===t.previousNpcId))==null?void 0:i.id)??ha(...zi.map(r=>r.id)),this.previousStartMode=Ic.includes(t.previousStartMode)?t.previousStartMode:"Random",this.previousNpcDeckId=t.previousNpcDeckId}get npcLvl(){return Number.MAX_VALUE}};c(wt,"tblHeader"),c(wt,"getOrCreateNew",async t=>{wt.tblHeader||(wt.tblHeader=new td(t));const i=await wt.tblHeader.getAll();if(i.length)return console.log(i[0].previousNpcDeckId),new wt(i[0]);const r=await wt.tblHeader.insert({name:"あなた",description:"ここの文字列を何に使うかは未定。",previousNpcId:0,previousNpcDeckId:Number.MIN_SAFE_INTEGER,previousStartMode:"Random"});return new wt(r)});let Sa=wt;class td extends Na{constructor(i){super(i,"TblDuelistProfile");c(this,"_prepareInitialRecords",()=>[])}}let ta=-1;const zi=[{id:ta--,name:"サンドバッグくん棒立ち",description:"攻撃宣言なし、強制効果以外の効果の発動なし。",npcLvl:0},{id:ta--,name:"サンドバッグくん非暴力",description:"攻撃宣言なし。",npcLvl:100},{id:ta--,name:"サンドバッグくん白帯",description:"とくに制限なし。",npcLvl:200}],xr=class xr{constructor(t,i,r,a,n,s=[]){c(this,"duel");c(this,"seat");c(this,"_entity");c(this,"profile");c(this,"deckInfo");c(this,"info");c(this,"infoOrigin");c(this,"status");c(this,"statusOrigin");c(this,"duelistType");c(this,"lifeLog");c(this,"actionBlackListForNPC");c(this,"_lp");c(this,"initHand");c(this,"writeInfoLog",t=>{this.duel.log.info(t,this)});c(this,"initForDrawPhase",()=>{this.info={...this.infoOrigin}});c(this,"canDiscard",t=>(this.status.canDiscardAsCost&&console.log(t),!0));c(this,"canSendToGraveyard",t=>(console.log(t),!0));c(this,"canRelease",t=>(console.log(t),!0));c(this,"canTryBanish",(t,i,r)=>this.entity.procFilterBundle.effectiveOperators.filter(a=>a.procTypes.includes(i)).every(a=>a.filter(this,this.entity,r,[t])));c(this,"battleDamage",(t,i)=>this.setLp(this._lp-t,i,"BattleDamage"));c(this,"effectDamage",(t,i)=>this.setLp(this._lp-t,i,"EffectDamage"));c(this,"lostLp",(t,i)=>this.setLp(this._lp-t,i,"Lost"));c(this,"payLp",(t,i)=>this.setLp(this._lp-t,i,"Pay"));c(this,"heal",(t,i)=>this.setLp(this._lp+t,i,"Heal"));c(this,"setLp",(t,i,r)=>{const a={clock:this.duel.clock.getClone(),reason:r||"Set",beforeLp:this._lp,afterLp:t,entity:i};return this.lifeLog.push(a),this._lp=t,this.writeInfoLog(`ライフポイント変動：${a.afterLp-a.beforeLp}（${a.beforeLp} ⇒ ${a.afterLp}）`),a});c(this,"getOpponentPlayer",()=>this.duel.firstPlayer===this?this.duel.secondPlayer:this.duel.firstPlayer);c(this,"getHandCell",()=>this.duel.field.getCells("Hand").filter(t=>t.owner===this)[0]);c(this,"getDeckCell",()=>this.duel.field.getCells("Deck").filter(t=>t.owner===this)[0]);c(this,"getExtraDeck",()=>this.duel.field.getCells("ExtraDeck").filter(t=>t.owner===this)[0]);c(this,"getGraveyard",()=>this.duel.field.getCells("Graveyard").filter(t=>t.owner===this)[0]);c(this,"getFieldZone",()=>this.duel.field.getCells("FieldSpellZone").filter(t=>t.owner===this)[0]);c(this,"getBanished",()=>this.duel.field.getCells("Banished").filter(t=>t.owner===this)[0]);c(this,"getMonsterZones",()=>this.duel.field.getCells("MonsterZone").filter(t=>t.owner===this));c(this,"getExtraMonsterZones",()=>this.duel.field.getCells("ExtraMonsterZone").filter(t=>{var i;return((i=t.cardEntities[0])==null?void 0:i.controller)===this}));c(this,"getSpellTrapZones",()=>this.duel.field.getCells("SpellAndTrapZone").filter(t=>t.owner===this));c(this,"getXyzMaterialZone",()=>this.duel.field.getCells("XyzMaterialZone").filter(t=>t.owner===this)[0]);c(this,"getEmptyMonsterZones",()=>this.getMonsterZones().filter(t=>t.cardEntities.length===0));c(this,"getEmptyExtraZones",()=>this.getExtraMonsterZones().length===0?this.getMonsterZones().filter(t=>t.cardEntities.length===0):[]);c(this,"getAvailableMonsterZones",()=>this.getMonsterZones().filter(t=>t.isAvailable));c(this,"getAvailableExtraZones",()=>this.getExtraMonsterZones().length===0?this.duel.field.getCells("ExtraMonsterZone").filter(t=>t.isAvailable):[]);c(this,"getAvailableSpellTrapZones",()=>this.getSpellTrapZones().filter(t=>t.isAvailable));c(this,"getMonstersOnField",()=>this.duel.field.getMonstersOnFieldStrictly().filter(t=>t.controller===this));c(this,"getSpellTrapsOnField",()=>this.duel.field.getSpellTrapsOnFieldStrictly().filter(t=>t.controller===this));c(this,"getPendingMonstersOnField",()=>this.duel.field.getPendingMonstersOnField().filter(t=>t.controller===this));c(this,"getPendulumScaleMonsters",()=>this.duel.field.getCardsOnFieldStrictly().filter(t=>t.isPendulumScale).filter(t=>t.controller===this));c(this,"getPendulumScales",()=>{const t=this.getPendulumScaleMonsters();if(t.length<2)return;const i=t.find(s=>s.fieldCell.column===(this.seat==="Below"?1:5)),r=t.find(s=>s.fieldCell.column===(this.seat==="Below"?5:1));if(!i||!r)throw new se("想定されない状態",t);const a=i.psR,n=r.psL;if(a===void 0||n===void 0)throw new se("想定されない状態",t);return a>n?{upperBound:a,lowerBound:n}:{upperBound:n,lowerBound:a}});c(this,"getEntiteisOnField",()=>this.duel.field.getCardsOnFieldStrictly().filter(t=>t.controller===this));c(this,"pushDeck",t=>{this.deckInfo.cardNames.map(i=>t[i]).filter(i=>i).forEach(i=>xe.createCardEntity(this,i)),this.duel.log.info(`デッキをセット。メイン${this.getDeckCell().cardEntities.length}枚。エクストラ${this.getExtraDeck().cardEntities.length}枚。`,this)});c(this,"draw",async(t,i,r)=>{var s;if(t<1)return;const a=this.getDeckCell(),n=[];this.writeInfoLog(`デッキからカードを${t}枚ドロー。`);for(const l of Array(t)){if(!a.cardEntities.length)throw this.writeInfoLog(n.length>0?`デッキからカードを${t}枚ドローしようとしたが、${n.length}枚しかドローできなかった。${n}`:"デッキからカードをドローできなかった。"),this.duel.isEnded=!0,this.setLp(0),new kt(this.getOpponentPlayer(),"対戦相手がデッキからカードをドローできなかった。");const d=a.cardEntities[0];await d.draw(i?["Effect"]:["Rule"],i,r),n.push(((s=d.origin)==null?void 0:s.name)||"!名称取得失敗!")}});c(this,"summon",async(t,i,r,a,n,s,l,d)=>(await this.summonMany(this,t,i,r,[{monster:a,posList:n,cells:s}],l,!1,1,f=>f.length===1,d)??[])[0]);c(this,"waitSelectEntities",(t,i,r,a,n=!1)=>this.duel.view.waitSelectEntities(this,{selectables:t,qty:i,validator:r,cancelable:n},a));c(this,"waitSelectEntity",async(t,i,r=!1)=>{const a=await this.waitSelectEntities(t,1,n=>n.length===1,i,r);return a?a[0]:void 0});c(this,"discard",async(t,i,r,a,n,s)=>{const l=n||(()=>!0),d=this.getHandCell().cardEntities.filter(l);if(d.length<t)return[];let o=[];return(a||this).duelistType==="NPC"?o=d.randomPickMany(t):o=await this.duel.view.waitSelectEntities(a||this,{selectables:d,qty:t,validator:f=>f.length===t,cancelable:!1},`${t}枚カードを捨てる。`)||[],this.writeInfoLog(`手札からカードを${o.length}枚捨てた。${o.map(f=>{var v;return(v=f.origin)==null?void 0:v.name})}。`),await ae.discardManyForTheSameReason(o,["Discard",...i],r,s),o});c(this,"getEnableSummonList",(t,i,r,a,n,s,l)=>{const d=this.duel.field.getCells("ExtraMonsterZone"),o=d.filter(v=>!s.map(p=>p.material).includes(v.cardEntities[0])).filter(v=>v.owner===this),f=[];return o.length&&f.push(...d.filter(v=>!o.includes(v)).filter(v=>v.isAvailable)),n.map(v=>({...v,summoner:this})).map(v=>{var p;return(i!=="LinkSummon"||!this.duel.field.canExtraLink(v.monster,s))&&(v.cells=v.cells.filter(y=>!f.includes(y))),(p=v.monster.status.monsterCategories)!=null&&p.includes("Link")&&(v.posList=v.posList.filter(y=>y==="Attack")),v}).map(v=>({...v,cells:v.cells.filter(p=>p.cardEntities.length===0||s.some(y=>y.material===p.cardEntities[0]))})).map(v=>{var p;return v.monster.fieldCell.cellType!=="ExtraDeck"?{...v,cells:v.cells.filter(y=>y.cellType!=="ExtraMonsterZone")}:(p=v.monster.status.monsterCategories)!=null&&p.includes("Link")||i==="PendulumSummon"?{...v,cells:v.cells.filter(y=>y.cellType==="ExtraMonsterZone"||y.linkArrowSources.filter(m=>!s.map(C=>C.material).includes(m)).length)}:v}).filter(v=>v.cells.length&&v.posList.length).map(v=>this.entity.summonFilterBundle.filter(t,i,r,a,v,s,l)).filter(v=>v.cells.length&&v.posList.length).map(v=>v.monster.summonFilterBundle.filter(t,i,r,a,v,s,l)).filter(v=>v.cells.length&&v.posList.length).map(v=>s.map(p=>p.material.summonFilterBundle).reduce((p,y)=>y.filter(t,i,r,a,p,s,l),v)).filter(v=>v.cells.length&&v.posList.length)});c(this,"prepareToSummonMany",async(t,i,r,a,n,s,l,d,o,f,v="特殊召喚するモンスターを選択。")=>{const p=this.getEnableSummonList(t,i,r,a,n,s,l);if(!p.length)return[];let y=p.map(C=>C.monster);(n.length!==1||o([]))&&(y=await this.duel.view.waitSelectEntities(this,{selectables:y,qty:d,validator:o,cancelable:f},v)??[]);const m=[];for(const C of p.filter(g=>y.includes(g.monster))){const g=C.cells.filter(E=>!m.map(F=>F.dest).includes(E));if(!g.length)continue;let T=[...C.posList].randomPick(),k=g.randomPick();if((g.length>1||C.posList.length>1)&&this.duelistType!=="NPC"){const E=await this.duel.view.waitSelectSummonDestination(C.summoner,C.monster,g,C.posList,f);if(!E)return[];k=E.dest,T=E.battlePosition}m.push({summoner:this,monster:C.monster,pos:T,dest:k})}return m});c(this,"summonAll",(t,i,r,a,n,s,l,d,o)=>this.summonMany(t,i,r,a,n,s,l,n.length,f=>f.length===n.length,d,o));c(this,"summonOne",async(t,i,r,a,n,s,l,d,o)=>{const f=await this.summonMany(t,i,r,a,n,s,l,1,v=>v.length===1,d,o);if(f)return f[0]});c(this,"summonMany",(t,i,r,a,n,s,l,d,o,f,v)=>xr.summonMany(t,i,r,a,n.map(p=>({...p,summoner:this})),s,l,d,o,f,v));c(this,"selectAttackTargetForNPC",(t,i)=>{const r=t.atk??0,a=t.getAttackTargets();if(!a.length)return;const n=a.find(s=>s.entityType==="Duelist");return n&&(r>=ha(1600,this.getOpponentPlayer().lp)||t.info.battlePotisionChangeCount>0)?n:a.find(s=>s.battlePosition==="Attack"?r>=(s.atk??0):r<(s.battlePosition==="Set"?1e3:s.def??0)?!1:s.validateDestory("BattleDestroy",this,t,i))});c(this,"selectActionForNPC",(t,i)=>{if(!t.length)return;const r=t.filter(g=>g.action.isMandatory);if(r.length)return r.randomPick();let a=t.filter(g=>!this.actionBlackListForNPC.includes(g.action.playType));const n=a.filter(g=>!Number.isNaN(g.action.priorityForNPC)).shuffle().sort((g,T)=>g.action.priorityForNPC-T.action.priorityForNPC);if(n.length)return n[0];const s=a.filter(g=>g.action.playType==="TriggerEffect");if(s.length)return s.randomPick();if(this.duel.phase!=="main1"&&this.duel.phase!=="main2"){const g=a.filter(T=>T.action.playType==="IgnitionEffect");if(g.length)return g.randomPick()}const l=a.filter(g=>g.action.playType==="Battle").sort((g,T)=>(g.action.entity.atk??0)-(T.action.entity.atk??0));if(l.length)return l.find(g=>this.selectAttackTargetForNPC(g.action.entity,g.action));a=a.filter(g=>g.action.playType!=="Battle");const d=a.length?i.slice(-1)[0]:void 0,o=a.filter(g=>g.action.negatePreviousBlock);if(d&&d.activator!==this&&o)return o.randomPick();if(a=a.filter(g=>!g.action.negatePreviousBlock),!a.length)return;const f=wr(...this.getOpponentPlayer().getMonstersOnField().filter(g=>g.battlePosition==="Attack").map(g=>g.atk??0),1600),v=ha(...this.getOpponentPlayer().getMonstersOnField().map(g=>g.battlePosition==="Set"?1500:(g.battlePosition==="Attack"?g.atk:g.def)??0),1500),p=this.getMonstersOnField(),y=wr(...p.filter(g=>g.battlePosition==="Attack").map(g=>g.atk??0),0);let m=a.filter(g=>g.action.playType!=="ChangeBattlePosition").filter(g=>g.action.entity.battlePosition!=="Attack").filter(g=>(g.action.entity.atk??0)>=f||(g.action.entity.atk??0)>v&&(g.action.entity.atk??0)>2300);if(m.length)return m.randomPick();a=a.filter(g=>g.action.playType!=="ChangeBattlePosition").filter(g=>g.action.playType!=="SpellTrapSet").filter(g=>g.action.entity.actions.filter(T=>T.playType!=="NormalSummon"&&T.playType!=="SpecialSummon").flatMap(T=>T.executableCells).every(T=>T!=="Hand")||g.action.playType!=="NormalSummon"&&g.action.playType!=="SpecialSummon");const C=[...a.filter(g=>g.action.playType==="NormalSummon").filter(g=>(g.action.entity.lvl??12)<5),...a.filter(g=>g.action.playType==="SpecialSummon"),...a.filter(g=>g.action.playType==="NormalSummon").filter(g=>(g.action.entity.atk??0)>2600||(g.action.entity.atk??0)>2300&&(g.action.entity.lvl??12)<7).filter(g=>(g.action.entity.atk??0)>=y),...a.filter(g=>g.action.entity.face==="FaceUp").filter(g=>g.action.entity.isOnFieldStrictly)];if(C.length)return C.randomPick();if(a=a.filter(g=>g.action.playType!=="NormalSummon").filter(g=>g.action.playType!=="SpecialSummon"),this.duel.phase==="main2"){if(m=t.filter(g=>g.action.playType==="ChangeBattlePosition").filter(g=>g.action.entity.battlePosition==="Attack").filter(g=>(g.action.entity.atk??0)<f||(g.action.entity.atk??0)>v&&(g.action.entity.atk??0)>2300),m.length)return m.randomPick();if(this.getAvailableSpellTrapZones.length>1)return t.filter(g=>g.action.playType==="SpellTrapSet").filter(g=>g.action.entity.kind!=="Spell"||g.action.entity.status.spellCategory==="QuickPlay").randomPick()}if(Math.random()<a.length/4)return a.randomPick()});this.duel=t,this.seat=i,this.profile=r,this.duelistType=a,this.deckInfo=n,this.initHand=s,this.lifeLog=[],this.infoOrigin={maxRuleNormalSummonCount:1,ruleNormalSummonCount:0,ruleNormalSummonCountQty:0,effectNormalSummonCount:0,effectNormalSummonCountQty:0,specialSummonCount:0,specialSummonCountQty:0},this.info={...this.infoOrigin},this.statusOrigin={maxSpecialSummonCount:Number.MAX_VALUE,canDrawByEffect:!0,canSearchFromDeck:!0,canDiscardAsCost:!0,canDiscardAsEffect:!0},this.status={...this.statusOrigin},this._lp=8e3;const l=[];this.duelistType==="NPC"&&(this.profile.npcLvl<1&&l.push("CardActivation","IgnitionEffect","TriggerEffect","QuickEffect"),this.profile.npcLvl<101&&l.push("Battle")),this.actionBlackListForNPC=l}get entity(){const t=this.getHandCell().entities.find(i=>i.entityType==="Duelist");return t||xe.createPlayerEntity(this)}get lp(){return this._lp}get isTurnPlayer(){return this.duel.getTurnPlayer()===this}get canDraw(){return!0}get canAddToHandFromDeck(){return!0}};c(xr,"summonMany",async(t,i,r,a,n,s,l,d,o,f,v="特殊召喚するモンスターを選択。")=>{const p=n.map(m=>m.summoner).getDistinct(),y=[];for(const m of p){const C=await m.prepareToSummonMany(t,i,r,a,n.filter(g=>g.summoner===m),s,l,d,o,f,v);y.push(...C)}if(y.length)return y.forEach(m=>m.monster.info.materials.reset(...s)),await ae.moveToXyzOwner(y[0].dest,s.map(m=>m.material).filter(m=>m.kind==="XyzMaterial"),["XyzMaterial","Rule"],y[0].monster,t),await xe.summonMany(y,i,r,a.entity,t),y.map(m=>m.monster)});let Dr=xr;const id=["NormalSummon","SpecialSummon","FlipSummon"],Ha=["IgnitionEffect","TriggerEffect","QuickEffect","CardActivation"],rd=["ChangeBattlePosition","Battle","SpellTrapSet","LingeringEffect"],ad=e=>e==="CardActivation"?"CardActivation":Ha.some(t=>t===e)?"EffectActivation":"NonActivate",Cn=["NormalSummon","AdvanceSummon","SpecialSummon","SpecialSummonFromDeck","SendToGraveyardFromDeck","Draw","SearchFromDeck","BanishFromDeck","BanishFromGraveyard","AddToHandFromGraveyard","ReturnToDeckFromGraveyard","SpecialSummonFromGraveyard","SpecialSummonFromBanished","ReturnToHandFromGraveyard","ReturnToHandFromField","BanishFromField","BanishFromHand","Destroy","DestroyMultiple","DestroyOnField","DestroyMultipleOnField","DestroyOnOpponentField","DestroyMultipleOnOpponentField","DestroyMonsterOnField","DestroyMonstersOnField","DestroySpellTrapOnField","DestroySpellTrapsOnField","SpecialSummonFromHand","SpecialSummonFromExtraDeck","IfNormarlSummonSucceed","IfSpecialSummonSucceed","DamageToOpponent","DamageToSelf","PayLifePoint","DiscordAsCost","DiscordAsEffect","RollDice","BounceToHand","NegateCardEffect","NegateCardActivation","NegateNormalSummon","NegateSpecialSummon"],si=class si extends Er{constructor(i,r,a,n){super(i,r,a);c(this,"toString",()=>this.isWithChainBlock&&this.playType!=="CardActivation"?`${this.entity.toString()}の«${this.title}»`:`${this.entity.toString()}の${this.title}`);c(this,"addhocMaterialLimitation");c(this,"getClone",i=>new si(this.seq,this.entity,this.definition,i));c(this,"getEnableMaterialPatterns",i=>{var r,a;return((a=(r=this.definition).getEnableMaterialPatterns)==null?void 0:a.call(r,i).filter(this.addhocMaterialLimitation))??[]});c(this,"validateCount",(i,r)=>{const a=r.filter(s=>this.isSameGroup(s.action)).length;if(this.isOnlyNTimesPerDuel>0&&this.entity.field.duel.chainBlockLog.records.filter(s=>!s.chainBlockInfo.isNegatedActivationBy).filter(s=>this.isSameGroup(s.chainBlockInfo.action)).filter(s=>s.chainBlockInfo.activator===i).length+a>=this.isOnlyNTimesPerDuel||this.isOnlyNTimesPerTurn>0&&this.entity.field.duel.chainBlockLog.records.filter(s=>!s.chainBlockInfo.isNegatedActivationBy).filter(s=>this.isSameGroup(s.chainBlockInfo.action)).filter(s=>s.clock.turn===this.entity.field.duel.clock.turn).filter(s=>s.chainBlockInfo.activator===i).length+a>=this.isOnlyNTimesPerTurn||this.isOnlyNTimesPerChain>0&&a>=this.isOnlyNTimesPerChain)return!1;const n=a+this.entity.counterHolder.getActionCount(this);return!(this.isOnlyNTimesPerTurnIfFaceup>0&&n>=this.isOnlyNTimesPerTurnIfFaceup||this.isOnlyNTimesIfFaceup>0&&n>=this.isOnlyNTimesIfFaceup)});c(this,"validate",(i,r,a)=>{if(this.playType==="CardActivation"&&this.entity.isOnFieldStrictly&&this.entity.face==="FaceUp"||this.isWithChainBlock&&!this.entity.status.canActivateEffect||a&&this.needsToPayCost||!this.validateCount(i,r))return;const n=wr(0,...r.map(d=>d.chainNumber??-1)),s={index:r.length,chainNumber:this.isWithChainBlock?n+1:void 0,action:this,activator:i,targetChainBlock:r.slice(-1)[0],isActivatedIn:this.entity.fieldCell,isActivatedAt:this.duel.clock.getClone(),costInfo:{},state:"unloaded",dest:void 0,ignoreCost:!1};if(this.definition.canPayCosts&&!a&&!this.definition.canPayCosts(s,this.playType==="AfterChainBlock"?[]:r))return;const l=this.definition.validate(s,this.playType==="AfterChainBlock"?[]:r);if(l)return{action:this,dests:l,originSeq:this.seq}});c(this,"prepare",async(i,r,a,n,s,l)=>{var m,C;let d=s;this.isLikeContinuousSpell&&(this.entity.info.isPending=!0);const o=this.isWithChainBlock?wr(0,...n.map(g=>g.chainNumber??-1))+1:void 0;let f="";if(o!==void 0&&(f+=`チェーン${o}: `),this.playType==="CardActivation"||this.playType==="SpellTrapSet")if(this.entity.fieldCell.cellType==="Hand"){let g=r?[r]:this.entity.status.spellCategory==="Field"?[i.getFieldZone()]:i.getAvailableSpellTrapZones();if(this.entity.status.spellCategory==="Field"){const k=i.getFieldZone().cardEntities;if(k.length){const E=k[0];await ae.sendManyToGraveyardForTheSameReason(i.getFieldZone().cardEntities,["Rule"],this.entity,i),i.writeInfoLog(`フィールド魔法の上書きにより、${E.toString()}は墓地に送られた。`),d=!1}}(m=this.entity.status.monsterCategories)!=null&&m.includes("Pendulum")&&(g=g.filter(k=>k.isAvailableForPendulum));let T=g[0];if(g.length>1){T=g.randomPick();const k=this.playType==="SpellTrapSet"?"セット":"カードの発動",E=await this.duel.view.waitSelectDestination(i,this.entity,g,"カードを移動先へドラッグ",k,d);if(!E)return;T=E}f+="手札から",this.playType==="SpellTrapSet"?f+="魔法・罠カードをセット。":f+=`${this.entity.toString()}を発動。`,i.writeInfoLog(f),(C=this.entity.status.monsterCategories)!=null&&C.includes("Pendulum")?await this.entity.activateAsPendulumScale(T,["CardActivation"],this.entity,i):this.playType==="CardActivation"?await this.entity.activateSpellTrapFromHand(T,this.entity.kind,["CardActivation"],this.entity,i):await this.entity.setAsSpellTrap(T,this.entity.kind,["SpellTrapSet"],this.entity,i),d=!1}else this.entity.isOnField&&this.entity.face==="FaceDown"&&(f+=`セットされていた${this.entity.toString()}を発動。`,i.writeInfoLog(f),await this.entity.setNonFieldMonsterPosition(this.entity.origin.kind,"FaceUp",["Rule"]),d=!1);else o!==void 0&&(f+=`${this.toString()}を発動。`,i.writeInfoLog(f));const v={index:n.length,chainNumber:o,action:this,activator:i,targetChainBlock:a,isActivatedIn:this.entity.fieldCell,isActivatedAt:this.duel.clock.getClone(),costInfo:{},state:"ready",dest:r,ignoreCost:!1};if(console.log(this.definition.payCosts,l),this.definition.payCosts&&!l){const g=await this.definition.payCosts(v,n,d);if(!g)return;v.costInfo=g}const p=await this.definition.prepare(v,n,d);if(p===void 0)return;const y={...p};if(id.some(g=>g===this.playType)){const g=p.nextChainBlockFilter??(()=>!0);y.nextChainBlockFilter=(T,k)=>k.negateSummon&&g(T,k)}return{...v,...y}});c(this,"execute",async(i,r)=>{if(i.action.isLikeContinuousSpell&&!i.action.entity.isOnField)return this.entity.info.isPending=!1,!1;const a=await this.definition.execute(i,r);return this.entity.determine(),a});c(this,"settle",(i,r)=>(this.isOnlyNTimesPerTurnIfFaceup>0?this.entity.counterHolder.incrementActionCountPerTurn(this):this.isOnlyNTimesIfFaceup>0&&this.entity.counterHolder.incrementActionCount(this),this.definition.settle(i,r)));c(this,"directExecute",async(i,r,a)=>{const n=await this.prepare(i,void 0,r,[],!1,a);if(!n)throw new se("想定されない状態",this,i,a);const s=await this.execute(n,[]);return await this.settle(n,[]),s});c(this,"isSame",i=>this.entity.origin.name===i.entity.origin.name&&this.title===i.title);c(this,"isSameGroup",i=>this.actionGroupName?this.entity.origin.name===i.entity.origin.name&&this.actionGroupName===i.actionGroupName:this.isSame(i));c(this,"calcChainBlockTagsForDestroy",i=>{if(!Cn.length)return[];const r=["Destroy"];Cn.length>1&&r.push("DestroyMultiple");const a=i.filter(d=>d.isOnFieldStrictly);a.length&&(r.push("DestroyOnField"),a.length>1&&r.push("DestroyMultipleOnField"));const n=a.filter(d=>d.kind==="Monster");n.length&&(r.push("DestroyMonsterOnField"),n.length>1&&r.push("DestroyMonstersOnField")),a.filter(d=>d.kind!=="Monster").length&&(r.push("DestroySpellTrapOnField"),n.length>1&&r.push("DestroySpellTrapsOnField"));const l=a.filter(d=>d.controller!==this.entity.controller);return l.length&&(r.push("DestroyOnOpponentField"),l.length>1&&r.push("DestroyMultipleOnOpponentField")),r});this.addhocMaterialLimitation=n??(()=>!0)}get definition(){return super.definition}get playType(){return this.definition.playType}get spellSpeed(){return this.definition.spellSpeed}get needsToPayCost(){return this.definition.needsToPayCost??!1}get hasToTargetCards(){return this.definition.hasToTargetCards??!1}get isWithChainBlock(){return Ha.some(i=>i===this.playType)}get isLikeContinuousSpell(){return this.definition.isLikeContinuousSpell||this.entity.isLikeContinuousSpell&&this.playType==="CardActivation"}get negatePreviousBlock(){return this.definition.negatePreviousBlock??!1}get negateSummon(){return this.definition.negateSummon??!1}get priorityForNPC(){return this.definition.priorityForNPC??Number.NaN}};c(si,"createNew",(i,r)=>new si("AutoSeq",i,r)),c(si,"createDummyAction",(i,r,a,n,s)=>({action:si.createNew(i,{title:r,isMandatory:!1,executableCells:[],executablePeriods:[],executableDuelistTypes:[],playType:"Dammy",spellSpeed:"Dammy",validate:()=>a,prepare:async()=>{},execute:async()=>!1,settle:async()=>!1}),dests:a,battlePosition:n,originSeq:(s==null?void 0:s.seq)??-1}));let Mi=si;const st=async()=>({selectedEntities:[],chainBlockTags:[],prepared:void 0}),Ps=async(e,t,i)=>(e.activator.payLp(i,e.action.entity),{lifePoint:i}),nd=e=>e.activator.canSendToGraveyard([e.action.entity])&&e.action.entity.canBeSentToGraveyard(e.activator,e.action.entity,"SendToGraveyardAsCost",e.action),sd=async e=>(await e.action.entity.sendToGraveyard(["Cost"],e.action.entity,e.activator),{sendToGraveyard:[e.action.entity]}),or=e=>e.activator.canTryBanish(e.action.entity,"BanishAsCost",e.action)&&e.action.entity.canBeBanished("BanishAsCost",e.activator,e.action.entity,e.action),Vr=async e=>(await e.action.entity.banish(["Cost"],e.action.entity,e.activator),{banish:[e.action.entity]}),ld=(e,t,i=1)=>t.filter(r=>e.activator.canTryBanish(r,"BanishAsCost",e.action)).filter(r=>r.canBeBanished("BanishAsCost",e.activator,e.action.entity,e.action)).length>=i,od=async(e,t,i,r)=>{const a=t.filter(s=>e.activator.canTryBanish(s,"BanishAsCost",e.action)).filter(s=>s.canBeBanished("BanishAsCost",e.activator,e.action.entity,e.action)),n=await e.activator.waitSelectEntities(a,r,i,"コストとして除外するカードを選択",!1)??[];return await ae.banishManyForTheSameReason(n,["Cost"],e.action.entity,e.activator),{banish:n}},pi=async(e,t,i=Ue,r=n=>n.length===1,a=1)=>{const n=e.activator.getMonsterZones(),s=e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,t.filter(o=>o.kind==="Monster").filter(o=>o.canBeTargetOfEffect(e)).map(o=>({monster:o,posList:i,cells:n})),[],!1),l=await e.activator.waitSelectEntities(s.map(o=>o.monster),a,r,"特殊召喚するモンスターを選択",!1)??[];if(!l.length)throw new rt(e);const d=l.map(o=>o.fieldCell.cellType).getDistinct().filter(o=>o==="Graveyard"||o==="Banished").map(o=>o==="Graveyard"?"SpecialSummonFromGraveyard":"SpecialSummonFromBanished");return{selectedEntities:l,chainBlockTags:d,prepared:void 0}},hi=async(e,t=["Attack","Defense"],i=!0)=>{const r=e.activator.getMonsterZones(),a=e.selectedEntities.filter(n=>!n.wasMovedAfter(e.isActivatedAt)).map(n=>({monster:n,posList:t,cells:r}));return i&&(a.length!==e.selectedEntities.length||r.length<a.length)?!1:(await e.activator.summonAll(e.activator,"SpecialSummon",["Effect"],e.action,a,[],!1,!1),!0)},cd=async(e,t,i=["Attack","Defense"])=>{const r=e.activator.getMonsterZones(),a=t.map(n=>({monster:n,posList:i,cells:r}));return await e.activator.summonAll(e.activator,"SpecialSummon",["Effect"],e.action,a,[],!1,!1),!0},dd=(e,t,i)=>({title:e,playType:"SystemPeriodAction",spellSpeed:"Normal",executableCells:ci,executablePeriods:t,executableDuelistTypes:["Controller","Opponent"],isMandatory:!0,validate:i,prepare:st,execute:async()=>!0,settle:async()=>!0}),ud=e=>{if(e.action.entity.status.spellCategory==="Field")return[e.activator.getFieldZone()];const t=e.activator.getAvailableSpellTrapZones();return t.length>0?t:void 0},ge={title:"セット",playType:"SpellTrapSet",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isMandatory:!1,validate:ud,prepare:st,execute:async()=>!0,settle:async()=>!0},we=e=>{var i;if(e.action.entity.info.isPending||e.action.entity.info.isDying||e.action.entity.info.isSettingSickness)return;if(vi.some(r=>r===e.action.entity.fieldCell.cellType))return e.action.entity.face==="FaceDown"?[]:void 0;if(e.action.spellSpeed==="Normal"&&!e.activator.isTurnPlayer||e.action.entity.fieldCell.cellType==="Hand"&&!e.activator.isTurnPlayer)return;if(e.action.entity.status.spellCategory==="Field")return[e.activator.getFieldZone()];let t=e.activator.getAvailableSpellTrapZones();return(i=e.action.entity.status.monsterCategories)!=null&&i.includes("Pendulum")&&(t=t.filter(r=>r.isAvailableForPendulum)),t.length>0?t:void 0},ja={title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:we,prepare:st,execute:async()=>!0,settle:async()=>!0},fd=(e,t,i=()=>!0)=>e.action.entity.field.getMonstersOnFieldStrictly().filter(a=>a.face==="FaceUp").filter(a=>a.canBeTargetOfEffect(e)).filter(a=>i(a,e.action.entity)).length?we(e):void 0,vd=async(e,t,i,r,a,n=()=>!0)=>{const s=e.action.entity.field.getMonstersOnFieldStrictly().filter(d=>d.face==="FaceUp").filter(d=>d.canBeTargetOfEffect(e)).filter(d=>n(d,e.action.entity)),l=await e.activator.waitSelectEntity(s,"装備対象モンスターを選択",i);if(l)return e.action.entity.info.equipedBy=l,e.action.entity.info.effectTargets[e.action.seq]=[l],{chainBlockTags:r??[],selectedEntities:[l],prepared:a}},xs=async(e,t,i=()=>!0)=>{const r=e.selectedEntities[0];return e.action.entity.info.equipedBy=r,e.action.entity.info.effectTargets[e.action.seq]=[r],i(r,e.action.entity)?(e.action.entity.info.equipedBy=r,e.action.entity.info.validateEquipOwner=i,r.info.equipEntities.push(e.action.entity),!0):(await e.action.entity.ruleDestory(),e.activator.writeInfoLog(`${r.toString()}が装備条件を満たさなくなったため、${e.action.entity.toString()}は破壊された。`),!1)},Ai=(e=()=>!0)=>({title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:(t,i)=>fd(t,i,e),prepare:(t,i,r)=>vd(t,i,r,[],void 0,e),execute:xs,settle:async()=>!0});function*pd(){yield{name:"連合軍",actions:[ja,ge],continuousEffects:[Tr("発動","Spell",e=>e.isOnFieldStrictly&&e.face==="FaceUp",e=>[_t.createContinuous("発動",t=>t.isSpawnedBy.isOnFieldStrictly&&t.isSpawnedBy.face==="FaceUp",e,(t,i)=>i.controller===t.isSpawnedBy.controller&&i.types.includes("Warrior")&&i.isOnFieldStrictly&&i.face==="FaceUp","attack","wip","Addition",(t,i,r)=>{if(!t.isEffective||i.face==="FaceDown")return r;const a=t.controller.getMonstersOnField().filter(n=>n.face==="FaceUp").filter(n=>n.types.includes("Warrior")||n.types.includes("Spellcaster")).length;return r+a*200})])]}}const Fs=Object.freeze(Object.defineProperty({__proto__:null,default:pd},Symbol.toStringTag,{value:"Module"}));function*hd(){yield*[{name:"リビングデッドの呼び声",pos:"Attack",filter:()=>!0},{name:"エンジェル・リフト",pos:"Attack",filter:e=>(e.lvl??12)<3},{name:"正統なる血統",pos:"Attack",filter:e=>{var t;return(t=e.status.monsterCategories)==null?void 0:t.includes("Normal")}},{name:"蘇りし魂",pos:"Defense",filter:e=>{var t;return(t=e.status.monsterCategories)==null?void 0:t.includes("Normal")}},{name:"リミット・リバース",pos:"Attack",filter:e=>(e.atk??9999)<=1e3,onMonsterAfterMove:async(e,t)=>{if(!t.isOnFieldAsMonsterStrictly||t.face==="FaceDown")return"RemoveMe";if(e.action.entity.isEffective&&t.battlePosition==="Defense")return e.action.entity.controller.writeInfoLog(`${t.toString()}が守備表示になったため、${e.action.entity.toString()}とともに破壊される。`),await ae.tryMarkForDestory([t,e.action.entity],e),"RemoveMe"}}].map(e=>({name:e.name,actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:Ae,executableDuelistTypes:["Controller"],validate:t=>{const i=t.activator.getMonsterZones();if(t.activator.getEnableSummonList(t.activator,"SpecialSummon",["Effect"],t.action,t.activator.getGraveyard().cardEntities.filter(a=>a.kind==="Monster").filter(e.filter).filter(a=>a.canBeTargetOfEffect(t)).map(a=>({monster:a,posList:["Attack"],cells:i})),[],!1).length)return we(t)},prepare:t=>pi(t,t.activator.getGraveyard().cardEntities.filter(i=>i.kind==="Monster").filter(e.filter).filter(i=>i.canBeTargetOfEffect(t)),["Attack"]),execute:async t=>{if(!await hi(t,["Attack"])||!t.selectedEntities.length)return!1;t.action.entity.info.effectTargets[t.action.seq]=t.selectedEntities,t.action.entity.onBeforeMove.append(async a=>{if(a.entity.face!=="FaceUp"||!a.entity.isOnFieldAsSpellTrapStrictly)return"RemoveMe";const n=Object.values(a.entity.info.effectTargets).flatMap(d=>d),[s]=a.args;if(!n.length)return"RemoveMe";const l=n[0];return l.isOnFieldStrictly&&l.face==="FaceUp"&&a.entity.isEffective&&!s.isSpellTrapZoneLikeCell&&(a.entity.controller.writeInfoLog(`${t.action.entity.toString()}がフィールドを離れたため、対象モンスター${l.toString()}を破壊。`),await ae.tryMarkForDestory([l],t)),"RemoveMe"});const r=t.selectedEntities[0];return r.onBeforeMove.append(async a=>{if(a.entity.face!=="FaceUp"||!a.entity.isOnFieldAsMonsterStrictly)return"RemoveMe";const[,,,,,n]=a.args;return t.action.entity.isOnFieldStrictly&&t.action.entity.face==="FaceUp"&&a.entity.isEffective&&n.union(["EffectDestroy","RuleDestroy"]).length&&(t.activator.writeInfoLog(`${a.entity.toString()}が破壊されたため、${t.action.entity.toString()}を破壊。`),await ae.tryMarkForDestory([r],t)),"RemoveMe"}),r.onAfterMove.append(async a=>e.onMonsterAfterMove?await e.onMonsterAfterMove(t,a):"RemoveMe"),!0},settle:async()=>!0},ge]}))}const Bs=Object.freeze(Object.defineProperty({__proto__:null,default:hd},Symbol.toStringTag,{value:"Module"}));function*gd(){yield{name:"昇天の黒角笛",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Counter",executableCells:["SpellAndTrapZone"],executablePeriods:Rt,executableDuelistTypes:["Controller"],negateSummon:!0,validate:e=>{if(e.targetChainBlock&&e.targetChainBlock.action.playType==="SpecialSummon"&&e.targetChainBlock.activator!==e.activator&&e.activator.duel.field.getPendingMonstersOnField().length===1)return we(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["NegateSpecialSummon"],prepared:void 0}),execute:async e=>{const t=ae.negateSummonMany(e.action.entity,e.activator);return await ae.tryDestroy(t,e),!0},settle:async()=>!0},ge]}}const Os=Object.freeze(Object.defineProperty({__proto__:null,default:gd},Symbol.toStringTag,{value:"Module"}));function*yd(){yield*[{name:"団結の力",kind:["Monster"],rate:800},{name:"魔導師の力",kind:["Spell","Trap"],rate:500}].map(e=>({name:e.name,actions:[Ai(),ge],continuousEffects:[lr(e.name,"Spell",t=>t.info.equipedBy?[t.info.equipedBy]:[],t=>t.isOnFieldStrictly&&t.face==="FaceUp",t=>["attack","defense"].map(i=>_t.createContinuous("発動",r=>r.isSpawnedBy.isOnFieldStrictly&&r.isSpawnedBy.face==="FaceUp",t,(r,a)=>a.isOnFieldStrictly&&a.face==="FaceUp",i,"wip","Addition",(r,a,n)=>{if(!r.isEffective)return n;const s=r.controller.getEntiteisOnField().filter(l=>e.kind.includes(l.kind)).length;return n+s*e.rate})))]})),yield{name:"早すぎた埋葬",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,canPayCosts:e=>e.activator.lp>=800,validate:e=>{const t=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getGraveyard().cardEntities.filter(r=>r.kind==="Monster").filter(r=>r.canBeTargetOfEffect(e)).map(r=>({monster:r,posList:["Attack"],cells:t})),[],!1).length)return we(e)},payCosts:(e,t)=>Ps(e,t,800),prepare:async e=>{const t=await pi(e,e.activator.getGraveyard().cardEntities,["Attack"]);return t.chainBlockTags.push("PayLifePoint"),t},execute:async(e,t)=>e.action.entity.info.equipedBy?(await e.action.entity.ruleDestory(),!1):await hi(e,["Attack"])?(e.action.entity.onBeforeMove.append(async r=>{if(r.entity.face!=="FaceUp"||!r.entity.isOnFieldAsSpellTrapStrictly)return"RemoveMe";const a=r.entity.info.equipedBy;if(!a)return"RemoveMe";const[,,,,,n]=r.args;return a.isOnFieldStrictly&&a.face==="FaceUp"&&r.entity.isEffective&&n.union(["EffectDestroy","RuleDestroy"]).length&&(r.entity.controller.writeInfoLog(`${e.action.entity.toString()}が破壊されたため、装備対象モンスター${a.toString()}を破壊。`),ae.tryMarkForDestory([a],e)),"RemoveMe"}),xs(e,t,(r,a)=>{var n;return(n=a.info.effectTargets[e.action.seq])==null?void 0:n.includes(r)})):(await e.action.entity.ruleDestory(),!1),settle:async()=>!0},ge]},yield{name:"幻惑の巻物",actions:[Ai(),ge],continuousEffects:[]}}const Ls=Object.freeze(Object.defineProperty({__proto__:null,default:yd},Symbol.toStringTag,{value:"Module"}));function*_d(){yield*[{name:"伝説の剣",attr:void 0,monType:"Warrior",atk:200,def:200},{name:"秘術の書",attr:void 0,monType:"Spellcaster",atk:200,def:200},{name:"ポセイドンの力",attr:void 0,monType:"Aqua",atk:200,def:200},{name:"紫水晶",attr:void 0,monType:"Zombie",atk:200,def:200},{name:"猛獣の歯",attr:void 0,monType:"Beast",atk:200,def:200},{name:"機械改造工場",attr:void 0,monType:"Machine",atk:200,def:200},{name:"体温の上昇",attr:void 0,monType:"Reptile",atk:200,def:200},{name:"魔菌",attr:void 0,monType:"Plant",atk:200,def:200},{name:"闇・エネルギー",attr:void 0,monType:"Fiend",atk:200,def:200},{name:"レーザー砲機甲鎧",attr:void 0,monType:"Insect",atk:200,def:200},{name:"銀の弓矢",attr:void 0,monType:"Fairy",atk:200,def:200},{name:"電撃鞭",attr:void 0,monType:"Thunder",atk:200,def:200},{name:"ドラゴンの秘宝",attr:void 0,monType:"Dragon",atk:200,def:200},{name:"フォロー・ウィンド",attr:void 0,monType:"WingedBeast",atk:200,def:200},{name:"魔性の月",attr:void 0,monType:"BeastWarrior",atk:200,def:200},{name:"エルフの光",attr:"Light",monType:void 0,atk:400,def:-200},{name:"覚醒",attr:"Earth",monType:void 0,atk:400,def:-200},{name:"灼熱の槍",attr:"Fire",monType:void 0,atk:400,def:-200},{name:"突風の扇",attr:"Wind",monType:void 0,atk:400,def:-200},{name:"はがねの甲羅",attr:"Water",monType:void 0,atk:400,def:-200},{name:"闇の破神剣",attr:"Dark",monType:void 0,atk:400,def:-200},{name:"火器付機甲鎧",attr:void 0,monType:"Insect",atk:700,def:0},{name:"サラマンドラ",attr:"Fire",monType:void 0,atk:700,def:0},{name:"シャイン・キャッスル",attr:"Light",monType:void 0,atk:700,def:0}].map(e=>({name:e.name,actions:[Ai(t=>(!e.attr||t.attr.includes(e.attr))&&(!e.monType||t.types.includes(e.monType))),ge],continuousEffects:[lr(e.name,"Spell",t=>t.info.equipedBy?[t.info.equipedBy]:[],t=>t.isOnFieldStrictly&&t.face==="FaceUp",t=>{const i=[];return e.atk!==0&&i.push(["attack",e.atk]),e.def!==0&&i.push(["defense",e.def]),i.map(([r,a])=>_t.createContinuous("発動",n=>n.isSpawnedBy.isOnFieldStrictly&&n.isSpawnedBy.face==="FaceUp",t,(n,s)=>s.isOnFieldStrictly&&s.face==="FaceUp"&&(!e.monType||s.types.includes(e.monType))&&(!e.attr||s.attr.includes(e.attr)),r,"wip","Addition",(n,s,l)=>n.isEffective?l+a:l))})]}))}const Ns=Object.freeze(Object.defineProperty({__proto__:null,default:_d},Symbol.toStringTag,{value:"Module"}));function*md(){yield*[{name:"草原",up:["Warrior","BeastWarrior"],down:[]},{name:"森",up:["Insect","Plant","Beast","BeastWarrior"],down:[]},{name:"山",up:["Dragon","WingedBeast","Thunder"],down:[]},{name:"荒野",up:["Dinosaur","Zombie","Rock"],down:[]},{name:"海",up:["Aqua","SeaSerpent","Fish"],down:["Machine","Pyro"]},{name:"闇",up:["Fiend","Spellcaster"],down:["Fairy"]}].map(e=>({name:e.name,actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:we,prepare:st,execute:async()=>!0,settle:async()=>!0},ge],continuousEffects:[Tr("発動","Spell",t=>t.isOnFieldStrictly&&t.face==="FaceUp",t=>["attack","defense"].flatMap(i=>["up","down"].map(r=>_t.createContinuous("発動",a=>a.isSpawnedBy.isOnFieldStrictly&&a.isSpawnedBy.face==="FaceUp",t,(a,n)=>n.isOnFieldStrictly&&n.face==="FaceUp"&&(n.status.monsterCategories??!1)&&e[r].union(n.types).length>0,i,"wip","Addition",(a,n,s)=>!a.isEffective||n.face==="FaceDown"?s:s+(r==="up"?200:-200)))))]})),yield*[{name:"バーニングブラッド",attr:"Fire"},{name:"ウォーターワールド",attr:"Water"},{name:"ガイアパワー",attr:"Earth"},{name:"シャインスパーク",attr:"Light"},{name:"ダークゾーン",attr:"Dark"},{name:"デザートストーム",attr:"Wind"}].map(e=>({name:e.name,actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","FieldSpellZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:we,prepare:st,execute:async()=>!0,settle:async()=>!0},ge],continuousEffects:[Tr("発動","Spell",t=>t.isOnFieldStrictly&&t.face==="FaceUp",t=>["attack","defense"].flatMap(i=>_t.createContinuous("発動",r=>r.isSpawnedBy.isOnFieldStrictly&&r.isSpawnedBy.face==="FaceUp",t,(r,a)=>a.isOnFieldStrictly&&a.face==="FaceUp"&&a.attr.includes(e.attr),i,"wip","Addition",(r,a,n)=>!r.isEffective||a.face==="FaceDown"?n:n+(i==="attack"?500:-400))))]}))}const qs=Object.freeze(Object.defineProperty({__proto__:null,default:md},Symbol.toStringTag,{value:"Module"})),Sd=e=>{if(!(e.activator.info.ruleNormalSummonCount>=e.activator.info.maxRuleNormalSummonCount)&&e.action.entity.lvl)if(e.action.entity.lvl<5){const t=e.activator.getEnableSummonList(e.activator,"NormalSummon",["Rule"],e.action,[{monster:e.action.entity,posList:["Attack","Set"],cells:e.activator.getMonsterZones()}],[],!1);return t.length?t.flatMap(i=>i.cells).getDistinct():void 0}else{const t=e.activator.getMonstersOnField().filter(a=>a.canBeReleased(e.activator,e.action.entity,["AdvanceSummonRelease"],e.action)),i=e.action.entity.lvl<7?1:2;if(t.length<i)return;if(t.getAllOnOffPattern().filter(a=>a.length===i).some(a=>e.activator.getEnableSummonList(e.activator,"AdvanceSummon",["Rule","NormalSummon"],e.action,[{monster:e.action.entity,posList:["Attack","Set"],cells:e.activator.getMonsterZones()}],a.map(n=>({material:n,cell:n.fieldCell})),!1).length))return[]}},Cd=async(e,t,i)=>{if(!e.action.entity.lvl)return;if(e.action.entity.lvl<5)return{};const r=e.activator.getAvailableMonsterZones();let a=e.activator.getMonstersOnField().filter(o=>o.canBeReleased(e.activator,e.action.entity,["AdvanceSummonRelease"],e.action));const n=e.activator.getExtraMonsterZones(),s=e.action.entity.lvl<7?1:2;n.length>=s&&(a=a.filter(o=>o.fieldCell.cellType!=="ExtraMonsterZone"));const l=await e.activator.waitSelectEntities(a,s,o=>(i||o.length>0)&&(s<0||o.length===s)&&(r.length>0||o.some(f=>f.fieldCell.cellType==="ExtraMonsterZone")),"リリースするモンスターを選択",i??!1)??[];return l.length?(await ae.releaseManyForTheSameReason(l,["Cost","AdvanceSummonRelease","Rule"],e.action.entity,e.activator),{summonMaterialInfos:l.map(o=>({material:o,cell:o.fieldCell}))}):void 0},bd=async e=>{var a;const t=["Rule","NormalSummon"];let i="NormalSummon";(a=e.costInfo.summonMaterialInfos)!=null&&a.length&&(i="AdvanceSummon",t.push("AdvanceSummon"));const r=e.dest?[e.dest]:e.activator.getAvailableMonsterZones();return gi(e,i,t,["Attack","Set"],r)},gi=async(e,t,i,r,a)=>{let n=a;return n||(n=e.activator.getMonsterZones(),e.action.entity.fieldCell.cellType==="ExtraDeck"&&n.push(...e.activator.duel.field.getCells("ExtraMonsterZone"))),await e.activator.summon(t,i,e.action,e.action.entity,r,n,e.costInfo.summonMaterialInfos??[],!1),{selectedEntities:[],chainBlockTags:[],prepared:void 0}},yi=async e=>{var t,i;return e.action.entity.info.isRebornable=!((t=e.action.entity.origin.monsterCategories)!=null&&t.includes("RegularSpecialSummonOnly")),e.action.entity.determine(),(i=e.costInfo.summonMaterialInfos)==null||i.map(r=>r.material).forEach(r=>r.onUsedAsMaterial(e,e.action.entity)),!0},je={title:"通常召喚",isMandatory:!1,playType:"NormalSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Sd,payCosts:Cd,prepare:bd,execute:yi,settle:async()=>!0},Ca=(e,t,i)=>{const r=e.activator.getMonsterZones();if(e.action.entity.fieldCell.cellType==="ExtraDeck"&&r.push(...e.activator.getAvailableExtraZones()),!!e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Rule"],e.action,[{monster:e.action.entity,posList:t,cells:r}],i,!1).length)return i.length===0?r:[]},kd=e=>{if(!e.activator.isTurnPlayer)return;const t=e.action.entity.getAttackTargets();return t.length?t.map(i=>i.fieldCell):void 0},Td=async e=>{var r;if(e.action.entity.info.attackCount>0||e.action.entity.battlePosition!=="Attack")return;if((r=e.dest)!=null&&r.targetForAttack){const a=e.dest.entities.find(n=>n.entityType==="Duelist");return{selectedEntities:a?[a]:e.dest.cardEntities,chainBlockTags:[],prepared:void 0}}const t=e.action.entity.getAttackTargets();if(t.length===0)throw new se("想定されない状態",e);if(t.length===1)return{selectedEntities:t,chainBlockTags:[],prepared:void 0};if(e.activator.duelistType==="NPC"){let a=e.activator.selectAttackTargetForNPC(e.action.entity,e.action);return a||(e.activator.duel.log.warn("NPCの攻撃対象選択に失敗したため、ランダムに攻撃対象を選択。"),a=t.randomPick()),{selectedEntities:[a],chainBlockTags:[],prepared:void 0}}const i=await e.activator.waitSelectEntity(t,"攻撃対象を選択。",!0);if(i)return{selectedEntities:[i],chainBlockTags:[],prepared:void 0}},wd=async e=>(e.action.entity.field.duel.declareAnAttack(e.action.entity,e.selectedEntities[0]),!0),ve={title:"攻撃宣言",isMandatory:!1,playType:"Battle",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["b1Battle","b2Battle"],executableDuelistTypes:["Controller"],validate:kd,prepare:Td,execute:wd,settle:async()=>!0},Rs=async e=>{if(!(e.action.entity.info.battlePotisionChangeCount>0||!e.activator.isTurnPlayer))return await e.action.entity.setBattlePosition(e.action.entity.battlePosition==="Attack"?"Defense":"Attack",["Rule"],e.action.entity,e.activator),e.action.entity.info.battlePotisionChangeCount++,{selectedEntities:[],chainBlockTags:[],prepared:void 0}},ke={title:"反転召喚",isMandatory:!1,playType:"FlipSummon",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>e.action.entity.info.battlePotisionChangeCount===0&&e.action.entity.info.attackCount===0&&e.activator.isTurnPlayer&&e.action.entity.face==="FaceDown"?[]:void 0,prepare:Rs,execute:async e=>(e.action.entity.determine(),!0),settle:async()=>!0},_e={title:"表示形式変更",isMandatory:!1,playType:"ChangeBattlePosition",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>e.action.entity.info.battlePotisionChangeCount===0&&e.action.entity.info.attackCount===0&&e.activator.isTurnPlayer&&e.action.entity.face==="FaceUp"?[]:void 0,prepare:Rs,execute:async e=>(e.action.entity.determine(),!0),settle:async()=>!0},di=async(e,t=["Attack","Defense"])=>{const i=e.activator.getMonsterZones();return e.action.entity.wasMovedAfter(e.isActivatedAt)?!1:(await e.activator.summon("SpecialSummon",["Effect"],e.action,e.action.entity,t,i,[],!1),!0)},Ed=[ve,_e,ke,je],Dd=(e,t,i,r,a,n,s,l,d,o,f)=>{const v={posList:d,cells:o},p={posList:[],cells:[]};return t!==s||s.kind!=="Monster"||!s.origin.monsterCategories?v:s.origin.monsterCategories.includes("NormalSummonOnly")?a.includes("NormalSummon")||a.includes("AdvanceSummon")?v:p:s.origin.monsterCategories.includes("SpecialSummon")?s.isInTrashCell&&!s.origin.monsterCategories.includes("RegularSpecialSummonOnly")?s.info.isRebornable||s.origin.monsterCategories.includes("FreeReborn")?v:p:a.includes("PendulumSummon")&&s.origin.monsterCategories.includes("FreeReborn")?p:a.union(ks).length?v:s.origin.monsterCategories.includes("RegularSpecialSummonOnly")?f?v:p:v:v},ia={},Md=e=>(ia[e]||(ia[e]={title:`戦闘破壊耐性(${e})`,isMandatory:!0,executableCells:["MonsterZone"],executablePeriods:["b1DDmgCalc","b2DDmgCalc"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:e,isApplicableTo:(t,i,r)=>r.includes(t.entity)?i!=="BattleDestroy"?[]:[t.entity]:[],substitute:async(t,i,r)=>r.includes(t.entity)?i!=="BattleDestroy"?[]:t.entity.isEffective?(t.entity.controller.writeInfoLog(`${t.entity.toString()}は１ターンに１度だけ戦闘では破壊されない。`),[t.entity]):[]:[]}),ia[e]),Za=e=>e.activator.canRelease([e.action.entity])&&e.action.entity.canBeReleased(e.activator,e.action.entity,["ReleaseAsCost"],e.action),Ua=async e=>(await e.action.entity.release(["Cost"],e.action.entity,e.activator),{release:[e.action.entity]}),$s=e=>({title:"シンクロ召喚",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:yt,executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerChain:1,validate:t=>t.activator.isTurnPlayer?void 0:t.activator.getExtraDeck().cardEntities.filter(r=>{var a;return(a=r.status.monsterCategories)==null?void 0:a.includes("Syncro")}).flatMap(r=>r.actions).filter(r=>r.playType==="SpecialSummon").map(r=>({index:-1,chainNumber:void 0,action:r,activator:t.activator,targetChainBlock:void 0,isActivatedIn:r.entity.fieldCell,isActivatedAt:t.isActivatedAt,costInfo:{},state:"unloaded",dest:void 0,ignoreCost:!1})).some(r=>r.action.getEnableMaterialPatterns(r).some(a=>{const n=a.map(s=>s.material);return n.every(s=>s.controller===t.activator)&&n.every(s=>s.isOnFieldAsMonsterStrictly)&&n.includes(t.action.entity)}))?[]:void 0,prepare:st,execute:async t=>{if(t.activator!==t.action.entity.controller||t.activator.getMonstersOnField().filter(s=>s.lvl!==void 0).length<2)return!1;const i=t.activator.getExtraDeck().cardEntities.filter(s=>{var l;return(l=s.status.monsterCategories)==null?void 0:l.includes("Syncro")}).flatMap(s=>s.actions).filter(s=>s.playType==="SpecialSummon").map(s=>({index:-1,chainNumber:void 0,action:s,activator:t.activator,targetChainBlock:void 0,isActivatedIn:s.entity.fieldCell,isActivatedAt:t.isActivatedAt,costInfo:{},state:"unloaded",dest:void 0,ignoreCost:!1})).filter(s=>s.action.getEnableMaterialPatterns(s).some(l=>{const d=l.map(o=>o.material);return d.every(o=>o.controller===t.activator)&&d.every(o=>o.isOnFieldAsMonsterStrictly)&&d.includes(t.action.entity)})).map(s=>s.action.entity).getDistinct();if(!i.length)return!1;const r=await t.activator.waitSelectEntities(i,1,s=>s.length===1,"シンクロ召喚するモンスターを選択。",!1)??[];if(!r.length)throw new se("想定されない状態",t);const a=r[0].actions.find(s=>s.playType==="SpecialSummon");if(!a)throw new se("想定されない状態",t);const n=a.getClone(s=>{const l=s.map(d=>d.material);return l.every(d=>d.controller===t.activator)&&l.every(d=>d.isOnFieldAsMonsterStrictly)&&l.includes(t.action.entity)});return t.nextActionInfo={action:n,originSeq:n.seq},!0},settle:async()=>!0,...e}),Ad=bs("直接攻撃","Monster",e=>[e],()=>!0,e=>[new Ri("直接攻撃",()=>!0,!0,e,{},(t,i)=>t.isSpawnedBy===i,(t,i)=>({...i,canDirectAttack:!0}))]),Pd=(e,t,i,r)=>{if(!e.action.entity.origin.link||e.action.entity.origin.link<i.length)return;let a=i.map(s=>({material:s,cell:s.fieldCell,link:1}));if(e.action.entity.origin.link>i.length){if(i.every(d=>(d.origin.link??1)<2))return;const s=[a];i.filter(d=>(d.origin.link??1)>1).forEach(d=>{[...s].forEach(o=>{s.push([...o.filter(f=>f.material!==d),{material:d,cell:d.fieldCell,link:d.origin.link??1}])})});const l=s.find(d=>d.reduce((o,f)=>o+f.link,0)===e.action.entity.origin.link);if(!l)return;a=l}if(!r(i)||!e.activator.getEnableSummonList(e.activator,"LinkSummon",["Rule","SpecialSummon"],e.action,[{monster:e.action.entity,posList:["Attack"],cells:t}],a,!1).length)return;if(e.activator.getAvailableExtraZones().length)return a;const n=e.activator.duel.field.getCells("ExtraMonsterZone").map(s=>s.cardEntities[0]).filter(s=>s);if(n.filter(s=>s.controller===e.activator).length&&n.filter(s=>s.controller===e.activator).length===i.filter(s=>s.fieldCell.cellType==="ExtraMonsterZone").length||e.activator.getMonsterZones().flatMap(s=>s.linkArrowSources).some(s=>!i.includes(s))||e.activator.duel.field.canExtraLink(e.action.entity,a))return a},xd=(e,t=()=>!0)=>{let i=[...e.activator.getMonstersOnField().filter(a=>a.battlePosition!=="Set"),...e.activator.getHandCell().entities.filter(a=>a.origin.kind==="Monster")];if(i.every(a=>!a.status.allowHandLink)&&(i=i.filter(a=>a.fieldCell.isPlayFieldCell)),i.length<1)return[];const r=[...e.activator.getMonsterZones(),...e.activator.duel.field.getAvailableExtraMonsterZones()];return i.getAllOnOffPattern().filter(a=>a.some(n=>n.status.allowHandLink)||a.every(n=>n.isOnFieldAsMonsterStrictly)).map(a=>Pd(e,r,a,t)??[]).filter(a=>a.length)},Fd=async(e,t,i)=>{var d;const r=e.action.getEnableMaterialPatterns(e),a=r.map(o=>({infos:o,materialSeqList:o.map(f=>f.material.seq).sort()}));let n=r[0].map(o=>o.material);if(r.length>1){const o=r.flatMap(v=>v.map(p=>p.material)).getDistinct(),f=await e.action.entity.duel.view.waitSelectEntities(e.activator,{selectables:o,qty:void 0,validator:v=>{const p=v.map(y=>y.seq).sort();return a.some(y=>p.length===y.materialSeqList.length&&p.every((m,C)=>m===y.materialSeqList[C]))},cancelable:i},"リンク素材とするモンスターを選択");if(!f)return;n=f}const s=n.map(o=>o.seq).sort(),l=(d=a.find(o=>s.length===o.materialSeqList.length&&s.every((f,v)=>f===o.materialSeqList[v])))==null?void 0:d.infos;if(!l)throw new se("想定されない状態",e,n);return await ae.sendManyToGraveyardForTheSameReason(n,["LinkMaterial","Cost","Rule","SpecialSummonMaterial"],e.action.entity,e.activator),{summonMaterialInfos:l}},Ga=(e=()=>!0)=>({title:"リンク召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],getEnableMaterialPatterns:t=>xd(t,e),canPayCosts:t=>t.action.getEnableMaterialPatterns(t).length>0,validate:t=>!t.ignoreCost||t.activator.getAvailableExtraZones().length+t.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:Fd,prepare:t=>gi(t,"LinkSummon",["Rule","SpecialSummon","LinkSummon"],["Attack"]),execute:yi,settle:async()=>!0});function*Bd(){yield*[{name:"ＬＡＮフォリンクス",validator:e=>e.length===2},{name:"トラフィックゴースト",validator:e=>e.length===3},{name:"天威の鬼神",validator:e=>e.length>1&&e.some(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Link")})},{name:"天威の拳僧",validator:e=>e.every(t=>{var i,r;return((i=t.status.nameTags)==null?void 0:i.includes("天威"))&&!((r=t.status.monsterCategories)!=null&&r.includes("Link"))})},{name:"電影の騎士ガイアセイバー",validator:e=>e.length>1}].map(e=>({name:e.name,actions:[ve,Ga(e.validator)]}))}const Hs=Object.freeze(Object.defineProperty({__proto__:null,default:Bd},Symbol.toStringTag,{value:"Module"}));function*Od(){yield*["サイバー・ドラゴン","六武衆のご隠居","アンノウン・シンクロン"].map(e=>({name:e,actions:[je,ve,_e,ke,{title:"特殊召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:e==="アンノウン・シンクロン"?1:void 0,validate:t=>{const i=t.action.entity.field.getMonstersOnFieldStrictly();if(!(i.length==0||i.some(r=>r.controller===t.activator)))return Ca(t,Ue,[])},prepare:t=>gi(t,"SpecialSummon",["SpecialSummon","Rule"],Ue),execute:yi,settle:async()=>!0}]})),yield{name:"ジャンク・フォアード",actions:[je,ve,_e,ke,{title:"特殊召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(!e.activator.getMonstersOnField().length)return Ca(e,Ue,[])},prepare:e=>gi(e,"SpecialSummon",["SpecialSummon","Rule"],Ue),execute:yi,settle:async()=>!0}]},yield{name:"Ｄ－ＨＥＲＯ ディアボリックガイ",actions:[je,ve,_e,ke,{title:"①リクルート",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:10,canPayCosts:or,validate:e=>e.activator.getDeckCell().cardEntities.filter(i=>i.nm==="Ｄ－ＨＥＲＯ ディアボリックガイ").length===0?void 0:e.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:Vr,prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.find(i=>i.nm==="Ｄ－ＨＥＲＯ ディアボリックガイ");return t?cd(e,[t]):!1},settle:async()=>!0}]},yield{name:"ゾンビキャリア",actions:[je,ve,_e,ke,{title:"①自己再生",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],canPayCosts:e=>e.activator.getHandCell().cardEntities.length>0,validate:e=>e.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:async(e,t,i)=>{const r=e.activator.getHandCell().cardEntities,a=await e.activator.waitSelectEntity(r,"デッキトップに戻すカードを一枚選択。",i);if(!a)throw new rt(e);return await a.returnToDeck("Top",["Cost"],e.action.entity,e.activator),{returnToDeck:[a]}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:async e=>(e.action.entity.info.willBeBanished=await di(e),e.action.entity.info.willBeBanished),settle:async()=>!0}]},yield{name:"グローアップ・バルブ",actions:[je,ve,_e,ke,{title:"①自己再生",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:1,canPayCosts:e=>e.activator.getDeckCell().cardEntities.length>0,validate:e=>e.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:async e=>{const t=e.activator.getDeckCell().cardEntities[0];return await e.activator.getDeckCell().cardEntities[0].sendToGraveyard(["Cost"],e.action.entity,e.activator),{sendToGraveyard:[t]}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:e=>di(e),settle:async()=>!0}]},yield{name:"終末の騎士",actions:[je,ve,_e,ke,{title:"①墓地送り",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...Ae,...Xe],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.hasBeenSummonedNow(["NormalSummon","SpecialSummon","FlipSummon"])&&e.activator.getDeckCell().cardEntities.filter(t=>t.attr.includes("Dark")).length!==0)return[]},prepare:async e=>{const t=["SendToGraveyardFromDeck"];return e.action.entity.moveLog.latestRecord.movedAs.includes("NormalSummon")?t.push("IfNormarlSummonSucceed"):t.push("IfSpecialSummonSucceed"),{selectedEntities:[],chainBlockTags:t,prepared:void 0}},execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(i=>i.attr.includes("Dark"));return t.length===0?!1:(await e.action.entity.field.sendToGraveyard("墓地に送るモンスターを選択",e.activator,t,1,i=>i.length===1,["Effect"],e.action.entity,!1),e.activator.getDeckCell().shuffle(),!0)},settle:async()=>!0}]},yield{name:"マスマティシャン",actions:[je,ve,_e,ke,{title:"①墓地送り",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...Ae,...Xe],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.hasBeenSummonedNow(["NormalSummon"])&&e.activator.getDeckCell().cardEntities.find(t=>(t.lvl??5)<5))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["IfNormarlSummonSucceed","SendToGraveyardFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(i=>(i.lvl??5)<5);return t.length===0?!1:(await e.action.entity.field.sendToGraveyard("墓地に送るモンスターを選択",e.activator,t,1,i=>i.length===1,["Effect"],e.action.entity,!1),e.activator.getDeckCell().shuffle(),!0)},settle:async()=>!0},{title:"②ドロー",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...Ae,...Xe],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.face!=="FaceDown"&&e.action.entity.moveLog.latestRecord.movedAs.includes("BattleDestroy")&&e.action.entity.wasMovedAtPreviousChain&&e.activator.getDeckCell().cardEntities.length!==0)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(1,e.action.entity,e.activator),!0),settle:async()=>!0}]},yield{name:"ライトロード・ビースト ウォルフ",actions:[ve,_e,ke,{title:"①自己再生",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...Ae,...Xe],executableDuelistTypes:["Controller"],validate:e=>{if(!e.action.entity.wasMovedAtPreviousChain||e.action.entity.wasMovedFrom.cellType!=="Deck")return;const t=e.activator.getMonsterZones();return e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,[{monster:e.action.entity,posList:Ue,cells:t}],[],!1).length?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:e=>di(e),settle:async()=>!0}]},yield{name:"伝説の白石",actions:[ve,_e,ke,je,{title:"①サーチ",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:Rt,executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.wasMovedAtPreviousChain&&e.action.entity.wasMovedFrom.cellType!=="Banished")return e.activator.getDeckCell().cardEntities.find(t=>t.nm==="青眼の白龍")?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.find(i=>i.nm==="青眼の白龍");return t?(await t.addToHand(["Effect"],e.action.entity,e.activator),e.activator.getDeckCell().shuffle(),!0):!1},settle:async()=>!0}]},yield*[{name:"灰流うらら",chainBlockTags:["Draw","SearchFromDeck","SendToGraveyardFromDeck","SpecialSummonFromDeck"]},{name:"屋敷わらし",chainBlockTags:["BanishFromGraveyard","SpecialSummonFromGraveyard","AddToHandFromGraveyard"]}].map(e=>({name:e.name,actions:[ve,_e,ke,je,{title:"①無効化",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:["Hand"],executablePeriods:Ae,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,negatePreviousBlock:!0,canPayCosts:t=>t.activator.canDiscard([t.action.entity]),validate:(t,i)=>i.length===0?void 0:i[t.index-1].chainBlockTags.union(e.chainBlockTags).length>0?[]:void 0,payCosts:async t=>(await t.action.entity.discard(["Cost"],t.action.entity,t.activator),{sendToGraveyard:[t.action.entity]}),prepare:async()=>({selectedEntities:[],chainBlockTags:["NegateCardEffect"],prepared:void 0}),execute:async(t,i)=>{const r=i[t.index-1];return r.isNegatedEffectBy=t.action,!0},settle:async()=>!0}]})),yield*["翻弄するエルフの剣士","ロードランナー","氷結界の修験者"].map(e=>({name:e,actions:[ve,_e,ke,je],continuousEffects:[Cs("①戦闘破壊耐性","Monster",t=>[t],()=>!0,t=>[new Xi("①戦闘破壊耐性",()=>!0,!0,t,{},()=>!0,["BattleDestroy"],(i,r)=>!t.isEffective||(r.atk??0)<1900?!0:(t.duel.log.info(`${t.toString()}は攻撃力1900以上のモンスターとの先頭では破壊されない。`,t.controller),!1))])]}))}const js=Object.freeze(Object.defineProperty({__proto__:null,default:Od},Symbol.toStringTag,{value:"Module"}));function*Ld(){yield*["ラージマウス","レインボー・フラワー","レッグル","女王の影武者","人造人間７号"].map(e=>({name:e,actions:[ve,_e,ke,je],continuousEffects:[Ad]}))}const Zs=Object.freeze(Object.defineProperty({__proto__:null,default:Ld},Symbol.toStringTag,{value:"Module"}));function*Nd(){yield*[{name:"キラー・ポテト",filter:e=>e.attr.includes("Dark")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["EffectDestroy"],executableCells:["Graveyard"]},{name:"キラー・トマト",filter:e=>e.attr.includes("Dark")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"巨大ネズミ",filter:e=>e.attr.includes("Earth")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"グリズリーマザー",filter:e=>e.attr.includes("Water")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"シャインエンジェル",filter:e=>e.attr.includes("Light")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ドラゴンフライ",filter:e=>e.attr.includes("Wind")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ＵＦＯタートル",filter:e=>e.attr.includes("Fire")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"荒野の女戦士",filter:e=>e.attr.includes("Earth")&&e.types.includes("Warrior")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"リトル・トルーパー",filter:e=>e.types.includes("Warrior")&&(e.lvl??9999)<3,qtyList:[1],posList:["Set"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard","Banished"]},{name:"破面竜",filter:e=>e.types.includes("Warrior")&&(e.def??9999)<=1500,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"共鳴虫",filter:e=>e.types.includes("Insect")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ピラミッド・タートル",filter:e=>e.types.includes("Zombie")&&(e.def??9999)<=2e3,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ユーフォロイド",filter:e=>e.types.includes("Machine")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ヘル・セキュリティ",filter:e=>e.types.includes("Fiend")&&(e.lvl??9999)===1,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ガスタ・イグル",filter:e=>(e.status.nameTags??[]).includes("ガスタ")&&(e.status.monsterCategories??[]).includes("Tuner"),qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"幻影の魔術士",filter:e=>(e.status.nameTags??[]).includes("ＨＥＲＯ")&&(e.atk??9999)<=1e3,qtyList:[1],posList:["Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ジェネクス・サーチャー",filter:e=>(e.status.nameTags??[]).includes("ジェネクス")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"紫炎の足軽",filter:e=>(e.status.nameTags??[]).includes("六武衆")&&(e.lvl??12)<=3,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"スレイブ・エイプ",filter:e=>(e.status.nameTags??[]).includes("剣闘獣")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ゼンマイハニー",filter:e=>(e.status.nameTags??[]).includes("ゼンマイ")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ＸＸ－セイバー エマーズブレイド",filter:e=>(e.status.nameTags??[]).includes("Ｘ－セイバー")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"軍隊竜",filter:e=>e.nm==="軍隊竜",qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"アサルト・ガンドッグ",filter:e=>e.nm==="アサルト・ガンドッグ",qtyList:[1,2,3,4,5],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ハイエナ",filter:e=>e.nm==="ハイエナ",qtyList:[1,2,3,4,5],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]}].map(e=>({name:e.name,actions:[{title:"①リクルート",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:e.executableCells,executablePeriods:e.destoryTypes.includes("EffectDestroy")?[...Ae,...Xe]:["b1DEnd","b2DEnd"],executableDuelistTypes:["Controller"],validate:t=>{if(!t.action.entity.wasMovedAtPreviousChain)return;const i=t.activator.getMonsterZones();if(t.activator.getEnableSummonList(t.activator,"SpecialSummon",["Effect"],t.action,t.activator.getDeckCell().cardEntities.filter(e.filter).filter(a=>a.kind==="Monster").filter(a=>a.canBeTargetOfEffect(t)).map(a=>({monster:a,posList:e.posList,cells:i})),[],!1).length)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async t=>{const i=t.activator.getDeckCell().cardEntities.filter(e.filter),r=t.activator.getMonsterZones();return!!t.activator.summonMany(t.activator,"SpecialSummon",["Effect"],t.action,i.map(n=>({monster:n,posList:e.posList,cells:r})),[],!1,e.qtyList.length>1?void 0:e.qtyList[0],n=>e.qtyList.includes(n.length),!1)},settle:async()=>!0},ve,_e,ke,je]}))}const Us=Object.freeze(Object.defineProperty({__proto__:null,default:Nd},Symbol.toStringTag,{value:"Module"}));function*qd(){yield{name:"おろかな埋葬",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:e=>{if(e.activator.getDeckCell().cardEntities.filter(t=>t.kind==="Monster").length!==0)return we(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SendToGraveyardFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(r=>r.kind==="Monster");if(t.length===0)return!1;const i=await e.activator.waitSelectEntity(t,"墓地に送るモンスターを選択",!1);if(!i)throw new rt(e);return await i.sendToGraveyard(["Effect"],e.action.entity,e.activator),await e.activator.getDeckCell().shuffle(),!0},settle:async()=>!0},ge]},yield{name:"おろかな副葬",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,priorityForNPC:40,validate:e=>{if(e.activator.getDeckCell().cardEntities.filter(t=>t.kind!=="Monster").length!==0)return we(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SendToGraveyardFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(r=>r.kind!=="Monster");if(t.length===0)return!1;const i=await e.activator.waitSelectEntity(t,"墓地に送る魔法罠を選択",!1);if(!i)throw new rt(e);return await i.sendToGraveyard(["Effect"],e.action.entity,e.activator),!0},settle:async()=>!0},ge]},yield{name:"死者蘇生",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:e=>{const t=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.duel.field.getCells("Graveyard").flatMap(r=>r.cardEntities).filter(r=>r.kind==="Monster").filter(r=>r.canBeTargetOfEffect(e)).map(r=>({monster:r,posList:Ue,cells:t})),[],!1).length)return we(e)},prepare:e=>pi(e,e.activator.duel.field.getCells("Graveyard").flatMap(t=>t.cardEntities).filter(t=>t.kind==="Monster").filter(t=>t.canBeTargetOfEffect(e))),execute:async e=>hi(e),settle:async()=>!0},ge]},yield*[{name:"大嵐",cellTypes:vi,isOnlyEnemies:!1},{name:"ハーピィの羽根帚",cellTypes:vi,isOnlyEnemies:!0},{name:"ブラック・ホール",cellTypes:yt,isOnlyEnemies:!1},{name:"サンダー・ボルト",cellTypes:yt,isOnlyEnemies:!0}].map(e=>({name:e.name,actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:t=>{let i=t.action.entity.field.getCells(...e.cellTypes).flatMap(r=>r.cardEntities).filter(r=>r!==t.action.entity);if(e.isOnlyEnemies&&(i=i.filter(r=>r.controller!==t.activator)),!!i.length)return we(t)},prepare:async t=>{let i=t.action.entity.field.getCells(...e.cellTypes).flatMap(r=>r.cardEntities).filter(r=>r!==t.action.entity);return e.isOnlyEnemies&&(i=i.filter(r=>r.controller!==t.activator)),{selectedEntities:[],chainBlockTags:t.action.calcChainBlockTagsForDestroy(i),prepared:void 0}},execute:async t=>{let i=t.action.entity.field.getCells(...e.cellTypes).flatMap(r=>r.cardEntities).filter(r=>r!==t.action.entity);return e.isOnlyEnemies&&(i=i.filter(r=>r.controller!==t.activator)),await ae.tryDestroy(i,t),!0},settle:async()=>!0},ge]})),yield{name:"ハリケーン",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.field.getCells("SpellAndTrapZone","FieldSpellZone").flatMap(i=>i.cardEntities).filter(i=>i!==e.action.entity).length)return we(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["BounceToHand"],prepared:void 0}),execute:async(e,t)=>{const i=t.map(a=>a.action).filter(a=>a.playType==="CardActivation").map(a=>a.entity).filter(a=>a.isOnFieldStrictly).filter(a=>a.face==="FaceUp").filter(a=>!a.isLikeContinuousSpell),r=e.action.entity.field.getCells("SpellAndTrapZone","FieldSpellZone").flatMap(a=>a.cardEntities).filter(a=>!i.includes(a));return await ae.returnManyToHandForTheSameReason(r,["Effect"],e.action.entity,e.activator),!0},settle:async()=>!0},ge]},yield{name:"光の援軍",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,canPayCosts:e=>e.activator.getDeckCell().cardEntities.length>3,validate:e=>{if(e.activator.getDeckCell().cardEntities.filter(t=>t.kind==="Monster").filter(t=>(t.lvl??13)<5).filter(t=>t.status.nameTags&&t.status.nameTags.includes("ライトロード")).length!==0)return we(e)},payCosts:async e=>{const t=e.activator.getDeckCell().cardEntities.slice(0,3);return await ae.sendManyToGraveyardForTheSameReason(t,["Cost"],e.action.entity,e.activator),{sendToGraveyard:t}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(r=>r.kind==="Monster").filter(r=>(r.lvl??13)<5).filter(r=>r.status.nameTags&&r.status.nameTags.includes("ライトロード"));if(t.length===0)return!1;const i=await e.activator.waitSelectEntity(t,"手札に加えるモンスターを選択",!1);if(!i)throw new rt(e);return await i.addToHand(["Effect"],e.action.entity,e.activator),!0},settle:async()=>!0},ge]},yield{name:"ワン・フォー・ワン",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,canPayCosts:e=>{if(e.activator.getDeckCell().cardEntities.every(t=>(t.lvl??12)>1)){if(e.activator.getHandCell().cardEntities.every(t=>(t.lvl??12)>1)||e.activator.getHandCell().cardEntities.filter(t=>t.kind==="Monster").length<2)return!1}else if(e.activator.getHandCell().cardEntities.filter(t=>t.kind==="Monster").length===0)return!1;return!0},validate:e=>{let t=[...e.activator.getDeckCell().cardEntities.filter(n=>(n.lvl??12)===1),...e.activator.getHandCell().cardEntities.filter(n=>(n.lvl??12)===1)];const i=e.activator.getHandCell().cardEntities;(i.length<2||!e.ignoreCost)&&(t=t.filter(n=>!i.includes(n)));const r=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,t.map(n=>({monster:n,posList:Ue,cells:r})),[],!1).length)return we(e)},payCosts:async(e,t,i)=>{const r=[...e.activator.getDeckCell().cardEntities.filter(d=>(d.lvl??12)===1),...e.activator.getHandCell().cardEntities.filter(d=>(d.lvl??12)===1)],a=e.activator.getMonsterZones(),n=e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,r.map(d=>({monster:d,posList:Ue,cells:a})),[],!1);let s=e.activator.getHandCell().cardEntities.filter(d=>d.kind==="Monster");n.length===1&&(s=s.filter(d=>!n.map(o=>o.monster).includes(d)));const l=await e.activator.waitSelectEntity(s,"墓地へ送るモンスターを選択",i);if(!l)throw new rt(e);return await l.sendToGraveyard(["Cost"],e.action.entity,e.activator),{sendToGraveyard:[l]}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async e=>{const t=[...e.activator.getDeckCell().cardEntities.filter(a=>a.lvl===1),...e.activator.getHandCell().cardEntities.filter(a=>a.lvl===1)],i=e.activator.getMonsterZones();return!!await e.activator.summonOne(e.activator,"SpecialSummon",["Effect"],e.action,t.map(a=>({monster:a,posList:Ue,cells:i})),[],!1,!1)},settle:async()=>!0},ge]},yield{name:"封印の黄金櫃",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(!e.activator.getDeckCell().cardEntities.every(t=>!e.activator.canTryBanish(t,"BanishAsEffect",e.action)))return we(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["BanishFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(a=>e.activator.canTryBanish(a,"BanishAsEffect",e.action)),i=await e.activator.waitSelectEntity(t,"除外するカードを選択。",!1);if(!i)throw new rt(e);return(await ae.tryBanish("BanishAsEffect",[i],e)).forEach(a=>a.counterHolder.removeAll("GoldSarcophagus")),!0},settle:async()=>!0},dd("回収カウント進行",["stanby"],e=>{e.activator.isTurnPlayer&&e.action.entity.field.getCells("Banished").flatMap(t=>t.cardEntities).filter(t=>t.moveLog.latestRecord.movedBy===e.action.entity).filter(t=>t.moveLog.latestRecord.actionOwner===e.activator).forEach(t=>{t.counterHolder.add("GoldSarcophagus",1,e.action.entity);const i=t.counterHolder.getQty("GoldSarcophagus",e.action.entity);i<3&&e.activator.duel.log.info(`${t.toString()}のターンカウント：${i-1}⇒${i}`)})}),{title:"回収",isMandatory:!0,playType:"LingeringEffect",spellSpeed:"Normal",executableCells:ci,executablePeriods:["stanby"],executableDuelistTypes:["Controller","Opponent"],validate:e=>{if(e.activator.isTurnPlayer)return e.action.entity.field.getCells("Banished").flatMap(t=>t.cardEntities).filter(t=>t.moveLog.latestRecord.movedBy===e.action.entity).filter(t=>t.moveLog.latestRecord.actionOwner===e.activator).some(t=>t.counterHolder.getQty("GoldSarcophagus")===2)?[]:void 0},prepare:st,execute:async e=>{const t=e.action.entity.field.getCells("Banished").flatMap(r=>r.cardEntities).filter(r=>r.moveLog.latestRecord.movedBy===e.action.entity).filter(r=>r.moveLog.latestRecord.actionOwner===e.activator).filter(r=>r.counterHolder.getQty("GoldSarcophagus")===2);if(!t.length)throw new se("想定されない状態",e);let i=t[0];if(t.length>1){const r=await e.activator.waitSelectEntity(t,"回収するカードを選択。",!1);if(!r)throw new rt(e);i=r}return await i.addToHand(["Effect"],e.action.entity,e.activator),!0},settle:async()=>!0},ge]}}const Gs=Object.freeze(Object.defineProperty({__proto__:null,default:qd},Symbol.toStringTag,{value:"Module"}));function*Rd(){yield{name:"強欲な壺",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:20,validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<2)&&e.activator.canDraw&&e.activator.canAddToHandFromDeck)return we(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(2,e.action.entity,e.activator),!0),settle:async()=>!0},ge]},yield{name:"貪欲な壺",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:30,validate:e=>{if(!(e.activator.getGraveyard().cardEntities.filter(t=>t.kind==="Monster").filter(t=>t.canBeTargetOfEffect(e)).length<5)&&e.activator.canDraw&&e.activator.canAddToHandFromDeck)return we(e)},prepare:async e=>{const t=await e.activator.waitSelectEntities(e.activator.getGraveyard().cardEntities.filter(i=>i.kind==="Monster").filter(i=>i.canBeTargetOfEffect(e)),5,i=>i.length===5,"デッキに戻すモンスターを選択。",!1);if(t)return{selectedEntities:t,chainBlockTags:["Draw","ReturnToDeckFromGraveyard"],prepared:void 0}},execute:async e=>e.selectedEntities.some(t=>t.wasMovedAtCurrentChain)?!1:(await ae.returnManyToDeckForTheSameReason("Random",e.selectedEntities,["Effect"],e.action.entity,e.activator),await e.activator.draw(2,e.action.entity,e.activator),!0),settle:async()=>!0},ge]},yield{name:"天使の施し",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:30,validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<3))return we(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw","DiscordAsEffect"],prepared:void 0}),execute:async e=>(await e.activator.draw(3,e.action.entity,e.activator),await e.activator.discard(2,["Effect","Discard"],e.action.entity,e.activator,()=>!0,e.activator),!0),settle:async()=>!0},ge]},yield{name:"成金ゴブリン",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:20,validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<1))return we(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(1,e.action.entity,e.activator),e.action.entity.field.duel.clock.incrementProcSeq(),e.activator.getOpponentPlayer().heal(1e3,e.action.entity),!0),settle:async()=>!0},ge]},yield{name:"手札抹殺",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<e.activator.getHandCell().cardEntities.filter(t=>t.seq!==e.action.entity.seq).length)&&e.action.entity.field.getAllCells().filter(t=>t.cellType==="Hand").flatMap(t=>t.cardEntities).filter(t=>t.seq!==e.action.entity.seq).length!==0)return we(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getHandCell().cardEntities.length,i=e.activator.getOpponentPlayer().getHandCell().cardEntities.length;return await ae.sendManyToGraveyardForTheSameReason(e.action.entity.field.getCells("Hand").flatMap(r=>r.cardEntities),["Effect","Discard"],e.action.entity,e.activator),e.activator.duel.clock.incrementProcSeq(),await ae.drawAtSameTime(e.activator,e.action.entity,t,i),!0},settle:async()=>!0},ge]},yield{name:"打ち出の小槌",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(e.activator.canDraw)return we(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>{const t=e.activator.getHandCell().cardEntities;if(!t.length)return!1;const i=await e.activator.waitSelectEntities(t,void 0,r=>r.length>0,"デッキに戻すカードを選択。",!1);if(!i)throw new rt(e);return await ae.returnManyToDeckForTheSameReason("Random",i,["Effect"],e.action.entity,e.activator),e.activator.duel.clock.incrementTotalProcSeq(),await e.activator.draw(i.length,e.action.entity,e.activator),!0},settle:async()=>!0},ge]}}const zs=Object.freeze(Object.defineProperty({__proto__:null,default:Rd},Symbol.toStringTag,{value:"Module"}));function*$d(){yield*[{name:"増援",filter:e=>e.origin.kind==="Monster"&&e.types.includes("Warrior")&&(e.origin.level??5)<5},{name:"化石調査",filter:e=>e.origin.kind==="Monster"&&e.types.includes("Dinosaur")&&(e.origin.level??6)<6},{name:"Ｅ－エマージェンシーコール",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("Ｅ・ＨＥＲＯ")},{name:"召集の聖刻印",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("聖刻")},{name:"召喚師のスキル",filter:e=>e.origin.kind==="Monster"&&(e.origin.monsterCategories??[]).includes("Normal")&&(e.origin.level??4)>4},{name:"トゥーンのもくじ",filter:e=>(e.origin.nameTags??[]).includes("トゥーン")},{name:"融合賢者",filter:e=>e.origin.name==="融合"},{name:"虹の架け橋",filter:e=>e.origin.kind!=="Monster"&&(e.origin.nameTags??[]).includes("宝玉")},{name:"紫炎の狼煙",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("六武衆")&&(e.origin.level??4)<4},{name:"テラ・フォーミング",filter:e=>e.origin.kind==="Spell"&&e.origin.spellCategory==="Field"},{name:"コール・リゾネーター",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("リゾネーター")}].map(e=>({name:e.name,actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:t=>{if(t.activator.getDeckCell().cardEntities.filter(e.filter).length&&t.activator.canDraw)return we(t)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async t=>{const i=t.activator.getDeckCell().cardEntities.filter(e.filter);if(!i.length)return!1;const r=await t.activator.waitSelectEntity(i,"手札に加えるカードを選択",!1);return r?(await r.addToHand(["Effect"],t.action.entity,t.activator),!0):!1},settle:async()=>!0},ge]})),yield*[{name:"戦士の生還",filter:e=>e.kind==="Monster"&&e.types.includes("Warrior"),qty:1},{name:"ダーク・バースト",filter:e=>e.kind==="Monster"&&e.attr.includes("Dark")&&(e.atk??9999)<=1500,qty:1},{name:"悪夢再び",filter:e=>e.kind==="Monster"&&e.attr.includes("Dark")&&(e.def??9999)===0,qty:2},{name:"サルベージ",filter:e=>e.kind==="Monster"&&e.attr.includes("Water")&&(e.atk??9999)<=1500,qty:2},{name:"バッテリーリサイクル",filter:e=>e.kind==="Monster"&&e.types.includes("Thunder")&&(e.atk??9999)<=1500,qty:2},{name:"闇の量産工場",filter:e=>e.kind==="Monster"&&(e.status.monsterCategories??[]).includes("Normal"),qty:2}].map(e=>({name:e.name,actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,priorityForNPC:40,validate:t=>{if(!(t.activator.getGraveyard().cardEntities.filter(e.filter).length<e.qty))return we(t)},prepare:async()=>({selectedEntities:[],chainBlockTags:["AddToHandFromGraveyard"],prepared:void 0}),execute:async t=>{const i=t.activator.getGraveyard().cardEntities.filter(e.filter);if(i.length===0)return!1;const r=await t.activator.waitSelectEntities(i,e.qty,a=>a.length===e.qty,"手札に加えるカードを選択",!1);for(const a of r??[])await a.addToHand(["Effect"],t.action.entity,t.activator);return!0},settle:async()=>!0},ge]})),yield*[{name:"トレード・イン",filter:e=>e.kind==="Monster"&&(e.lvl??0)===8},{name:"調和の宝札",filter:e=>e.kind==="Monster"&&(e.origin.monsterCategories??[]).includes("Tuner")&&e.types.includes("Dragon")&&(e.atk??9999)<=1e3},{name:"デステニー・ドロー",filter:e=>e.kind==="Monster"&&(e.origin.nameTags??[]).includes("Ｄ－ＨＥＲＯ")}].map(e=>({name:e.name,actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,canPayCosts:t=>t.activator.getHandCell().cardEntities.filter(e.filter).some(i=>t.activator.canDiscard([i])),validate:t=>{if(!(t.activator.getDeckCell().cardEntities.length<2))return we(t)},payCosts:async t=>({discard:await t.activator.discard(1,["Discard","Cost"],t.action.entity,t.activator,e.filter)}),prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async t=>(await t.activator.draw(2,t.action.entity,t.activator),!0),settle:async()=>!0},ge]})),yield*[{name:"火の粉",calcHeal:()=>[0,-200]},{name:"雷鳴",calcHeal:()=>[0,-300]},{name:"ファイヤー・ボール",calcHeal:()=>[0,-500]},{name:"火あぶりの刑",calcHeal:()=>[0,-600]},{name:"昼夜の大火事",calcHeal:()=>[0,-800]},{name:"火炎地獄",calcHeal:()=>[-500,-1e3]},{name:"盗人ゴブリン",calcHeal:()=>[500,-500]},{name:"ブルー・ポーション",calcHeal:()=>[400,0]},{name:"レッド・ポーション",calcHeal:()=>[500,0]},{name:"ゴブリンの秘薬",calcHeal:()=>[600,0]},{name:"天使の生き血",calcHeal:()=>[800,0]},{name:"治療の神 ディアン・ケト",calcHeal:()=>[1e3,0]},{name:"恵みの雨",calcHeal:()=>[1e3,1e3]}].map(e=>({name:e.name,actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:we,prepare:async()=>{const[t,i]=e.calcHeal(),r=[];return t<0&&r.push("DamageToSelf"),i<0&&r.push("DamageToOpponent"),{selectedEntities:[],chainBlockTags:r,prepared:void 0}},execute:async t=>{const[i,r]=e.calcHeal();return r>0?t.activator.getOpponentPlayer().heal(r,t.action.entity):r<0&&t.activator.getOpponentPlayer().effectDamage(Math.abs(r),t.action.entity),i>0?t.activator.heal(i,t.action.entity):i<0&&t.activator.effectDamage(Math.abs(i),t.action.entity),!0},settle:async()=>!0},ge]}))}const Vs=Object.freeze(Object.defineProperty({__proto__:null,default:$d},Symbol.toStringTag,{value:"Module"}));function*Hd(){yield{name:"強欲な瓶",actions:[ge,{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:Ae,executableDuelistTypes:["Controller"],validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<2)&&e.activator.canDraw&&e.activator.canAddToHandFromDeck)return we(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(1,e.action.entity,e.activator),!0),settle:async()=>!0}]},yield{name:"戦線復帰",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:Ae,executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:e=>{const t=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getGraveyard().cardEntities.filter(r=>r.kind==="Monster").filter(r=>r.canBeTargetOfEffect(e)).map(r=>({monster:r,posList:["Defense"],cells:t})),[],!1).length)return we(e)},prepare:e=>pi(e,e.activator.getGraveyard().cardEntities.filter(t=>t.kind==="Monster").filter(t=>t.canBeTargetOfEffect(e)),["Defense"]),execute:async e=>hi(e,["Defense"]),settle:async()=>!0},ge]}}const Ws=Object.freeze(Object.defineProperty({__proto__:null,default:Hd},Symbol.toStringTag,{value:"Module"}));function*jd(){yield*["炸裂装甲","次元幽閉"].map(e=>({name:e,actions:[ge,{title:"発動",playType:"CardActivation",spellSpeed:"Quick",isMandatory:!1,executableCells:["SpellAndTrapZone"],executablePeriods:["b1Battle","b2Battle"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:t=>{if(!t.activator.duel.clock.isUponAttackDeclaration()||t.activator.isTurnPlayer)return;const i=t.activator.duel.attackingMonster;if(!i)throw new se("想定されない状態",t,i);if(i.canBeTargetOfEffect(t)&&!(e==="次元幽閉"&&!t.activator.canTryBanish(i,"BanishAsEffect",t.action)))return we(t)},prepare:async t=>{const i=t.activator.duel.attackingMonster;if(!i)throw new se("想定されない状態",t,i);const r=e==="炸裂装甲"?t.action.calcChainBlockTagsForDestroy([i]):["BanishFromField"];return{selectedEntities:[i],chainBlockTags:r,prepared:void 0}},execute:async t=>(e==="炸裂装甲"?await ae.tryDestroy(t.selectedEntities,t):await ae.tryBanish("BanishAsEffect",t.selectedEntities,t),!0),settle:async()=>!0}]}))}const Ys=Object.freeze(Object.defineProperty({__proto__:null,default:jd},Symbol.toStringTag,{value:"Module"}));function*Zd(){yield{name:"ご隠居の猛毒薬",actions:[ge,{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:Ae,executableDuelistTypes:["Controller"],validate:we,prepare:async(e,t,i)=>{const r=await e.action.entity.field.duel.view.waitSelectText([{seq:0,text:"●自分は１２００ＬＰ回復する。"},{seq:1,text:"●相手に８００ダメージを与える。"}],"使用する効果を選択",!1);if(r===void 0&&!i)throw new rt(e);const a=[];return r===1&&a.push("DamageToOpponent"),{selectedEntities:[],chainBlockTags:a,prepared:r??0}},execute:async e=>e.prepared===1?(e.activator.getOpponentPlayer().effectDamage(800,e.action.entity),!0):(e.activator.heal(1200,e.action.entity),!0),settle:async()=>!0}]},yield{name:"月の書",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:Ae,executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:e=>{if(e.action.entity.field.getMonstersOnFieldStrictly().filter(i=>i.canBeTargetOfEffect(e)).filter(i=>i.face==="FaceUp").length)return we(e)},prepare:async(e,t,i)=>{const r=e.action.entity.field.getMonstersOnFieldStrictly().filter(n=>n.canBeTargetOfEffect(e)).filter(n=>n.face==="FaceUp"),a=await e.activator.waitSelectEntity(r,"対象とするモンスターを選択",i);if(a)return{selectedEntities:[a],chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.selectedEntities[0];if(!t.isOnFieldAsMonsterStrictly||t.battlePosition==="Set")return!1;if(!t.canBeEffected(e.activator,e.action.entity,e.action)){e.activator.duel.log.info(`${t.toString()}は${e.action.entity.toString()}の効果を受けない。`);return}return await t.setBattlePosition("Set",["Effect"],e.action.entity,e.activator),!0},settle:async()=>!0},ge]},yield{name:"突進",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:[...Ae,...Xe],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:e=>{if(e.action.entity.field.getMonstersOnFieldStrictly().filter(i=>i.canBeTargetOfEffect(e)).length)return we(e)},prepare:async(e,t,i)=>{const r=e.action.entity.field.getMonstersOnFieldStrictly().filter(n=>n.canBeTargetOfEffect(e)),a=await e.activator.waitSelectEntity(r,"対象とするモンスターを選択",i);if(a)return{selectedEntities:[a],chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.selectedEntities[0];if(!t.isOnFieldAsMonsterStrictly||t.battlePosition==="Set")return!1;if(!t.canBeEffected(e.activator,e.action.entity,e.action)){e.activator.duel.log.info(`${t.toString()}は${e.action.entity.toString()}の効果を受けない。`);return}return t.numericOprsBundle.push(_t.createLingeringAddition("攻撃力上昇",i=>i.effectOwner.duel.clock.isSameTurn(i.isSpawnedAt),e.action.entity,e.action,"attack",(i,r,a)=>a+700)),!0},settle:async()=>!0},ge]},yield{name:"手札断殺",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:[...Ae,...Xe],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:e=>{for(const t of[e.activator,e.activator.getOpponentPlayer()])if(!t.canDraw||t.getHandCell().cardEntities.filter(i=>i.canBeSentToGraveyard(e.activator,e.action.entity,"SendToGraveyardAsEffect",e.action)).filter(i=>i!==e.action.entity).length<2||t.getDeckCell().cardEntities.length<2)return;return we(e)},prepare:async()=>(console.log("手札断殺"),{selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>{if(e.activator.getHandCell().cardEntities.length<2||e.activator.getOpponentPlayer().getHandCell().cardEntities.length<2)return!1;let t=0;for(const i of[e.activator,e.activator.getOpponentPlayer()]){const r=await i.waitSelectEntities(i.getHandCell().cardEntities,2,n=>n.length===2,"墓地に送るカードを２枚選択。",!1);if(!r)throw new rt(e,i);const a=await ae.sendManyToGraveyardForTheSameReason(r,["Effect"],e.action.entity,e.activator);t+=a.length}return t?(e.activator.duel.clock.incrementTotalProcSeq(),await ae.drawAtSameTime(e.activator,e.action.entity,2,2),!0):!1},settle:async()=>!0},ge]},yield{name:"リロード",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:[...Ae,...Xe],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:e=>{if(e.activator.canDraw)return we(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>{const t=e.activator.getHandCell().cardEntities;return t.length?(await ae.returnManyToDeckForTheSameReason("Random",t,["Effect"],e.action.entity,e.activator),e.activator.duel.clock.incrementTotalProcSeq(),await e.activator.draw(t.length,e.action.entity,e.activator),!0):!1},settle:async()=>!0},ge]}}const Qs=Object.freeze(Object.defineProperty({__proto__:null,default:Zd},Symbol.toStringTag,{value:"Module"})),Ud=(e,t,i,r,a,n)=>{if(!e.action.entity.origin.level||r.some(o=>!o.lvl)||r.map(o=>o.lvl??0).reduce((o,f)=>o+f,0)!==e.action.entity.origin.level)return;const s=r.filter(o=>{var f;return(f=o.status.monsterCategories)==null?void 0:f.some(v=>v==="Tuner")}),l=r.filter(o=>{var f;return(f=o.status.monsterCategories)==null?void 0:f.every(v=>v!=="Tuner")});if(!a(s)||!n(l))return;const d=[...s.map(o=>({material:o,cell:o.fieldCell,isAsTuner:!0})),...l.map(o=>({material:o,cell:o.fieldCell,isAsTuner:!1}))];if(e.activator.getEnableSummonList(e.activator,"SyncroSummon",["Rule","SpecialSummon"],e.action,[{monster:e.action.entity,posList:t,cells:i}],d,!1).length)return d},Gd=(e,t=r=>r.length===1,i=r=>r.length>0)=>{let r=[...e.activator.getMonstersOnField().filter(s=>s.battlePosition!=="Set"),...e.activator.getHandCell().cardEntities.filter(s=>s.origin.kind==="Monster")];if(r.every(s=>!s.status.allowHandSyncro)&&(r=r.filter(s=>s.fieldCell.isPlayFieldCell)),r.length<2)return[];const a=[...e.activator.getMonsterZones(),...e.activator.duel.field.getCells("ExtraMonsterZone")],n=["Attack","Defense"];return r.getAllOnOffPattern().filter(s=>s.some(l=>l.status.allowHandSyncro)||s.every(l=>l.isOnFieldAsMonsterStrictly)).map(s=>Ud(e,n,a,s,t,i)??[]).filter(s=>s.length)},zd=async(e,t,i)=>{var d;const r=e.action.getEnableMaterialPatterns(e),a=r.map(o=>({infos:o,materialSeqList:o.map(f=>f.material.seq).sort()}));let n=r[0].map(o=>o.material);if(r.length>1){const o=r.flatMap(v=>v.map(p=>p.material)).getDistinct(),f=await e.activator.waitSelectEntities(o,void 0,v=>{const p=v.map(y=>y.seq).sort();return a.some(y=>p.length===y.materialSeqList.length&&p.every((m,C)=>m===y.materialSeqList[C]))},"シンクロ素材とするモンスターを選択",i);if(!f)return;n=f}const s=n.map(o=>o.seq).sort(),l=(d=a.find(o=>s.length===o.materialSeqList.length&&s.every((f,v)=>f===o.materialSeqList[v])))==null?void 0:d.infos;if(!l)throw new se("想定されない状態",e,n);return await ae.sendManyToGraveyardForTheSameReason(n,["SyncroMaterial","Cost","Rule","SpecialSummonMaterial"],e.action.entity,e.activator),{summonMaterialInfos:l}},Nt=(e=i=>i.length===1,t=i=>i.length>0)=>({title:"シンクロ召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],getEnableMaterialPatterns:i=>Gd(i,e,t),canPayCosts:i=>i.action.getEnableMaterialPatterns(i).length>0,validate:i=>!i.ignoreCost||i.activator.getAvailableExtraZones().length+i.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:zd,prepare:i=>gi(i,"SyncroSummon",["Rule","SpecialSummon","SyncroSummon"],["Attack","Defense"]),execute:yi,settle:async()=>!0});function*Vd(){yield*["大地の騎士ガイアナイト","スクラップ・デスデーモン"].map(e=>({name:e,actions:[ve,_e,ke,Nt()]})),yield{name:"ナチュル・ガオドレイク",actions:[ve,_e,ke,Nt(e=>e.length===1&&e.every(t=>t.attr.some(i=>i==="Earth")),e=>e.length>0&&e.every(t=>t.attr.some(i=>i==="Earth")))]},yield{name:"マジカル・アンドロイド",actions:[ve,_e,ke,Nt(),{title:"回復",isMandatory:!0,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["end"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,validate:e=>e.action.entity.duel.phase==="end"&&e.activator.isTurnPlayer&&e.action.entity.face==="FaceUp"?[]:void 0,prepare:st,execute:async e=>(e.activator.heal(e.activator.getMonstersOnField().filter(t=>t.face==="FaceUp").filter(t=>t.types.includes("Psychic")).length*600,e.action.entity),!0),settle:async()=>!0}]}}const Ks=Object.freeze(Object.defineProperty({__proto__:null,default:Vd},Symbol.toStringTag,{value:"Module"}));function*Wd(){yield{name:"にせアバター",actions:[je,ve,_e,ke],continuousEffects:[lr("THE_DEVILS_AVATAR","Monster",e=>[e],e=>e.isOnFieldStrictly&&e.face==="FaceUp",e=>["attack","defense"].map(t=>_t.createContinuous("THE_DEVILS_AVATAR",i=>i.isSpawnedBy.isOnFieldStrictly&&i.isSpawnedBy.face==="FaceUp",e,(i,r)=>r.isOnFieldStrictly&&r.face==="FaceUp",t,"calculated","THE_DEVILS_AVATAR",()=>Number.MIN_VALUE)))]},yield{name:"にせドレッド・ルート",actions:[je,ve,_e,ke],continuousEffects:[Tr("THE_DEVILS_DREAD-ROOT","Monster",e=>e.isOnFieldStrictly&&e.face==="FaceUp",e=>["attack","defense"].map(t=>_t.createContinuous("THE_DEVILS_DREAD-ROOT",i=>i.isSpawnedBy.isOnFieldStrictly&&i.isSpawnedBy.face==="FaceUp",e,(i,r)=>r.kind==="Monster"&&r.isOnFieldStrictly&&r.face==="FaceUp"&&r!==i.isSpawnedBy,t,"calculated","THE_DEVILS_DREAD-ROOT",(i,r,a)=>Math.round(a/2))))]}}const Xs=Object.freeze(Object.defineProperty({__proto__:null,default:Wd},Symbol.toStringTag,{value:"Module"})),Yd=(e,t,i,r,a=2,n=2,s)=>{if(!e.action.entity.origin.rank||r.length<a||r.length>n||r.some(d=>!d.lvl)||r.some(d=>d.lvl!==e.action.entity.rank)||!s(r))return;const l=r.map(d=>({material:d,cell:d.fieldCell,level:d.status.level}));if(e.activator.getEnableSummonList(e.activator,"XyzSummon",["Rule","XyzSummon","SpecialSummon"],e.action,[{monster:e.action.entity,posList:t,cells:i}],l,!1).length)return l},Qd=(e,t=2,i=2,r=a=>a.length>1)=>{const a=e.activator.getMonstersOnField().filter(s=>s.battlePosition!=="Set");if(a.length<t)return[];const n=[...e.activator.getMonsterZones(),...e.activator.getAvailableExtraZones()];return a.getAllOnOffPattern().filter(s=>s.length>=t).filter(s=>s.length<=i).map(s=>Yd(e,Ue,n,s,t,i,r)??[]).filter(s=>s.length)},Kd=async(e,t,i)=>{var d;const r=e.action.getEnableMaterialPatterns(e),a=r.map(o=>({infos:o,materialSeqList:o.map(f=>f.material.seq).sort()}));let n=r[0].map(o=>o.material);if(r.length>1){const o=r.flatMap(v=>v.map(p=>p.material)).getDistinct(),f=await e.activator.waitSelectEntities(o,void 0,v=>{const p=v.map(y=>y.seq).sort();return a.some(y=>p.length===y.materialSeqList.length&&p.every((m,C)=>m===y.materialSeqList[C]))},"エクシーズ素材とするモンスターを選択",i);if(!f)return;n=f}const s=n.map(o=>o.seq).sort(),l=(d=a.find(o=>s.length===o.materialSeqList.length&&s.every((f,v)=>f===o.materialSeqList[v])))==null?void 0:d.infos;if(!l)throw new se("想定されない状態",e,n);return console.log(l),await ae.convertManyToXyzMaterials(l.map(o=>o.material),["XyzMaterial","Rule","Cost"],e.action.entity,e.activator),console.log(l.map(o=>o.material.kind)),{summonMaterialInfos:l}},Xd=(e=2,t=2,i=r=>r.length>1)=>({title:"エクシーズ召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],getEnableMaterialPatterns:r=>Qd(r,e,t,i),canPayCosts:r=>r.action.getEnableMaterialPatterns(r).length>0,validate:r=>!r.ignoreCost||r.activator.getAvailableExtraZones().length+r.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:Kd,prepare:r=>gi(r,"XyzSummon",["Rule","SpecialSummon","XyzSummon"],["Attack","Defense"]),execute:yi,settle:async()=>!0});function*Jd(){yield*[{name:"ジェムナイト・パール",qty:2},{name:"覚醒の勇士 ガガギゴ",qty:3}].map(e=>({name:e.name,actions:[ve,_e,ke,Xd(e.qty,e.qty)]}))}const Js=Object.freeze(Object.defineProperty({__proto__:null,default:Jd},Symbol.toStringTag,{value:"Module"}));function*Id(){yield{name:"シューティング・ライザー・ドラゴン",actions:[ve,_e,ke,Nt(),{title:"①墓地送り",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:yt,executablePeriods:[...Ae,...Xe],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>{if(e.action.entity.hasBeenSummonedNow(["SyncroSummon"])&&e.activator.getDeckCell().cardEntities.some(t=>(t.lvl??12)<(e.action.entity.lvl??0)))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SendToGraveyardFromDeck","IfSpecialSummonSucceed"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(a=>(a.lvl??12)<(e.action.entity.lvl??0));if(t.length===0)return!1;const i=await e.activator.waitSelectEntity(t,"墓地に送るモンスターを選択",!1);if(!i)throw new se("想定されない状況",e);await i.sendToGraveyard(["Effect"],e.action.entity,e.activator);const r=i.lvl??0;return e.action.entity.numericOprsBundle.push(_t.createLingeringAddition("レベル減少",()=>!0,e.action.entity,e.action,"level",(a,n,s)=>s-r)),!0},settle:async()=>!0},$s({title:"②シンクロ召喚",isOnlyNTimesPerChain:1})]}}const Is=Object.freeze(Object.defineProperty({__proto__:null,default:Id},Symbol.toStringTag,{value:"Module"}));function*eu(){yield{name:"折れ竹光",actions:[Ai(),ge]},yield{name:"妖刀竹光",actions:[Ai(),ge,{title:"②直接攻撃付与",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>{if(!e.activator.getSpellTrapsOnField().filter(i=>{var r;return(r=i.status.nameTags)==null?void 0:r.includes("竹光")}).filter(i=>i!==e.action.entity).some(i=>i.status.spellCategory==="Equip"))return;const t=e.action.entity.info.equipedBy;if(t&&!t.status.canDirectAttack)return[]},prepare:async(e,t,i)=>{const r=await e.activator.waitSelectEntity(e.activator.getSpellTrapsOnField().filter(a=>{var n;return(n=a.status.nameTags)==null?void 0:n.includes("竹光")}).filter(a=>a!==e.action.entity).filter(a=>a.status.spellCategory==="Equip"),"手札に戻すカードを選択。",i);if(r)return{selectedEntities:[r],chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.action.entity.info.equipedBy;return t?(await ae.returnManyToHandForTheSameReason(e.selectedEntities,["Effect"],e.action.entity,e.activator),t.statusOperatorBundle.push(new Ri("直接攻撃",i=>(console.log(i.effectOwner.duel.clock.turn,i.isSpawnedAt.turn),i.effectOwner.duel.clock.isSameTurn(i.isSpawnedAt)),!1,e.action.entity,e.action,()=>!0,(i,r)=>({...r,canDirectAttack:!0}))),!0):!1},settle:async()=>!0},{title:"③サーチ",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...Ae,...Xe],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.wasMovedAtPreviousChain&&e.activator.canAddToHandFromDeck)return e.activator.getDeckCell().cardEntities.filter(t=>{var i;return(i=t.status.nameTags)==null?void 0:i.includes("竹光")}).some(t=>t.status.name!=="妖刀竹光")?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(r=>{var a;return(a=r.status.nameTags)==null?void 0:a.includes("竹光")}).filter(r=>r.status.name!=="妖刀竹光");if(!t.length)return!1;const i=await e.activator.waitSelectEntity(t,"手札に加えるカードを選択。",!1);if(!i)throw new rt(e);return(await i.addToHand(["Effect"],e.action.entity,e.activator)).cellType==="Hand"},settle:async()=>!0}]},yield{name:"真刀竹光",actions:[Ai(),ge,{title:"②相手モンスター破壊",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["SpellAndTrapZone"],executablePeriods:["b1DAfterDmgCalc","b2DAfterDmgCalc"],executableDuelistTypes:["Controller"],validate:e=>{const t=e.action.entity.info.equipedBy;if(t&&t.info.battleLog.filter(i=>e.activator.duel.clock.isPreviousStage(i.timestamp)).some(i=>i.enemy.entityType==="Duelist")&&e.activator.getOpponentPlayer().getMonstersOnField().length&&e.activator.getOpponentPlayer().lifeLog.filter(i=>e.activator.duel.clock.isPreviousStage(i.clock)).some(i=>i.entity===t))return[]},prepare:async e=>({selectedEntities:[],chainBlockTags:e.action.calcChainBlockTagsForDestroy(e.activator.getOpponentPlayer().getMonstersOnField()),prepared:void 0}),execute:async e=>(await ae.tryDestroy(e.activator.getOpponentPlayer().getMonstersOnField(),e)).length>0,settle:async()=>!0},{title:"③竹光入替",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],canPayCosts:e=>e.action.entity.info.equipedBy?nd(e):!1,validate:e=>{if(!(!e.action.entity.info.equipedBy||!e.activator.getDeckCell().cardEntities.filter(r=>{var a;return(a=r.status.nameTags)==null?void 0:a.includes("竹光")}).filter(r=>r.status.name!=="真刀竹光").filter(r=>r.status.spellCategory==="Equip").length))return e.activator.duel.field.getMonstersOnFieldStrictly().some(r=>r.canBeTargetOfEffect(e))?[]:void 0},payCosts:sd,prepare:st,execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(l=>{var d;return(d=l.status.nameTags)==null?void 0:d.includes("竹光")}).filter(l=>l.status.name!=="真刀竹光").filter(l=>l.status.spellCategory==="Equip");if(!t.length)return!1;const i=e.activator.getAvailableSpellTrapZones();if(!i.length)return!1;const r=e.activator.duel.field.getMonstersOnFieldStrictly().filter(l=>l.canBeTargetOfEffect(e));if(!r.length)return!1;const a=await e.activator.waitSelectEntity(t,"装備するカードを選択。",!1);if(!a)throw new rt("竹光選択",e);const n=await e.activator.duel.view.waitSelectDestination(e.activator,a,i,"装備カードを置く場所を選択。","装備",!1);if(!n)throw new rt("配置場所選択",e);await a.putDirectly(n,"Spell",["Effect"],e.action.entity,e.activator);const s=await e.activator.waitSelectEntity(r,"装備する対象を選択。",!1);if(!s)throw new rt("装備対象選択",e);return a.info.equipedBy=s,a.info.effectTargets[e.action.seq]=[s],s.info.equipEntities.push(a),!0},settle:async()=>!0}]}}const el=Object.freeze(Object.defineProperty({__proto__:null,default:eu},Symbol.toStringTag,{value:"Module"}));function*tu(){yield{name:"黄金色の竹光",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:20,validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<2)&&e.activator.canDraw&&e.activator.canAddToHandFromDeck&&e.activator.getSpellTrapsOnField().filter(t=>{var i;return(i=t.status.nameTags)==null?void 0:i.includes("竹光")}).filter(t=>t.face==="FaceUp").some(t=>t.status.spellCategory==="Equip"))return we(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(2,e.action.entity,e.activator),!0),settle:async()=>!0},ge]}}const tl=Object.freeze(Object.defineProperty({__proto__:null,default:tu},Symbol.toStringTag,{value:"Module"}));function*iu(){yield{name:"ＢＦ－疾風のゲイル",actions:[je,ve,_e,ke,{title:"①特殊召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(e.activator.getMonstersOnField().filter(i=>(i.status.nameTags??[]).includes("ＢＦ")).filter(i=>i.nm!==e.action.entity.origin.name).length)return Ca(e,["Attack","Defense"],[])},prepare:e=>gi(e,"SpecialSummon",["SpecialSummon","Rule"],Ue),execute:yi,settle:async()=>!0},{title:"②攻守半減",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,isOnlyNTimesPerTurnIfFaceup:1,validate:e=>{const t=e.activator.getOpponentPlayer().getMonstersOnField().filter(i=>i.face==="FaceUp").filter(i=>i.canBeTargetOfEffect(e));if(t.length)return t.length?t.map(i=>i.fieldCell):void 0},prepare:async(e,t,i)=>{var a;let r=(a=e.dest)==null?void 0:a.cardEntities[0];if(!r){const n=e.activator.getOpponentPlayer().getMonstersOnField().filter(l=>l.face==="FaceUp").filter(l=>l.canBeTargetOfEffect(e)),s=await e.activator.waitSelectEntity(n,"効果対象を選択。",i);if(!s)return;r=s}return{selectedEntities:[r],chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.selectedEntities.filter(i=>i.isOnFieldAsMonsterStrictly).filter(i=>i.face==="FaceUp").find(i=>i.canBeEffected(e.activator,e.action.entity,e.action));return t?(["attack","defense"].map(i=>_t.createLingeringFixation("②攻守半減",()=>!0,e.action.entity,e.action,i,(r,a,n)=>Math.round(n/2))).forEach(i=>t.numericOprsBundle.push(i)),!0):!1},settle:async()=>!0}]}}const il=Object.freeze(Object.defineProperty({__proto__:null,default:iu},Symbol.toStringTag,{value:"Module"}));function*ru(){yield{name:"水晶機巧－ハリファイバー",actions:[ve,Ga(e=>e.length===2&&e.some(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Tuner")})),{title:"①リクルート",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:yt,executablePeriods:[...Ae,...Xe],executableDuelistTypes:["Controller"],validate:e=>{if(!e.action.entity.hasBeenSummonedNow(["LinkSummon"]))return;const t=[e.activator.getHandCell(),e.activator.getDeckCell()].flatMap(a=>a.cardEntities).filter(a=>(a.lvl??12)<4).filter(a=>{var n;return(n=a.status.monsterCategories)==null?void 0:n.includes("Tuner")}),i=e.activator.getMonsterZones();return e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,t.map(a=>({monster:a,cells:i,posList:["Defense"]})),[],!1).length?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async e=>{const t=[e.activator.getHandCell(),e.activator.getDeckCell()].flatMap(a=>a.cardEntities).filter(a=>(a.lvl??12)<4).filter(a=>{var n;return(n=a.status.monsterCategories)==null?void 0:n.includes("Tuner")}),i=e.activator.getMonsterZones(),r=await e.activator.summonOne(e.activator,"SpecialSummon",["Effect"],e.action,t.map(a=>({monster:a,cells:i,posList:["Defense"]})),[],!1,!1);if(!r)throw new rt(e);return r.statusOperatorBundle.push(new Ri("効果発動不可",a=>a.effectOwner.duel.clock.isSameTurn(a.isSpawnedAt),!1,e.action.entity,e.action,()=>!0,()=>({canActivateEffect:!1}))),!0},settle:async()=>!0},{title:"②シンクロ召喚",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:yt,executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerChain:1,canPayCosts:or,validate:e=>{if(e.activator.isTurnPlayer)return;const t=[...e.activator.getMonsterZones(),...e.activator.duel.field.getCells("ExtraMonsterZone")],i=e.activator.getExtraDeck().cardEntities.filter(a=>{var n;return(n=a.status.monsterCategories)==null?void 0:n.includes("Syncro")}).filter(a=>{var n;return(n=a.status.monsterCategories)==null?void 0:n.includes("Tuner")});return e.activator.getEnableSummonList(e.activator,"SyncroSummon",["SpecialSummon","Effect"],e.action,i.map(a=>({monster:a,cells:t,posList:Ue})),[{material:e.action.entity,cell:e.action.entity.fieldCell}],!1).length?[]:void 0},payCosts:Vr,prepare:st,execute:async e=>{const t=[...e.activator.getMonsterZones(),...e.activator.duel.field.getCells("ExtraMonsterZone")],i=e.activator.getExtraDeck().cardEntities.filter(a=>{var n;return(n=a.status.monsterCategories)==null?void 0:n.includes("Syncro")}).filter(a=>{var n;return(n=a.status.monsterCategories)==null?void 0:n.includes("Tuner")});return!!await e.activator.summonOne(e.activator,"SyncroSummon",["SpecialSummon","Effect"],e.action,i.map(a=>({monster:a,cells:t,posList:Ue})),[],!1,!1)},settle:async()=>!0}]}}const rl=Object.freeze(Object.defineProperty({__proto__:null,default:ru},Symbol.toStringTag,{value:"Module"}));function*au(){yield{name:"封印されしエクゾディア",actions:[ve,_e,je,ke,{title:"封印開放",isMandatory:!0,playType:"Exodia",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:Rt,executableDuelistTypes:["Controller"],validate:e=>{const t=e.activator.getHandCell().cardEntities.filter(i=>{var r;return(r=i.origin.nameTags)==null?void 0:r.includes("封印されし")}).map(i=>i.origin.name).getDistinct();return console.log(e.action.entity.toString(),t),t.length===5?[]:void 0},prepare:async e=>(await ae.sendManyToGraveyardForTheSameReason(e.activator.duel.field.getCardsOnFieldStrictly(),["Rule"],e.action.entity,e.activator),{selectedEntities:[],chainBlockTags:[],prepared:void 0,nextChainBlockFilter:()=>!1}),execute:async e=>{const t=e.activator.getOpponentPlayer().getHandCell().cardEntities.filter(r=>{var a;return(a=r.origin.nameTags)==null?void 0:a.includes("封印されし")}).map(r=>r.origin.name).getDistinct().length===5,i=[{name:"封印されし者の左足",column:4},{name:"封印されし者の右足",column:2},{name:"封印されし者の左腕",column:5},{name:"封印されし者の右腕",column:1},{name:"封印されしエクゾディア",column:3}];for(const r of i){const a=[e.activator.getHandCell().cardEntities.find(n=>n.origin.name===r.name),e.activator.getOpponentPlayer().getHandCell().cardEntities.find(n=>n.origin.name===r.name)].filter(n=>n!==void 0);if(!a.length)throw new se("想定されない状態",e.activator.getHandCell().cardEntities,r.name);await xe.moveMany(a.map(n=>[n,n.controller.getMonsterZones().find(s=>s.column===(n.controller.seat==="Above"?6-r.column:r.column))??n.controller.getFieldZone(),"Monster","FaceUp","Vertical","Top",["Rule"],void 0,void 0,void 0]))}throw t?new kt(void 0,`お互いが、${e.action.entity.toString()}の特殊勝利条件を同時に満たした。`):new kt(e.activator,`${e.action.entity.toString()}の特殊勝利条件を満たした。`)},settle:async()=>!0}]}}const al=Object.freeze(Object.defineProperty({__proto__:null,default:au},Symbol.toStringTag,{value:"Module"}));function*nu(){yield{name:"ファイアウォール・ドラゴン・シンギュラリティ",actions:[ve,Ga(e=>e.length>2),{title:"①バウンス＆自己強化",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:yt,executablePeriods:[...Ae,...Xe],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>[...e.activator.getGraveyard().cardEntities,...e.activator.getMonstersOnField()].flatMap(a=>a.status.monsterCategories??[]).getDistinct().union(["Ritual","Fusion","Syncro","Xyz"]).length<1?void 0:[...e.activator.getOpponentPlayer().getGraveyard().cardEntities,...e.activator.getOpponentPlayer().getEntiteisOnField()].filter(a=>a.canBeTargetOfEffect(e)).length?[]:void 0,prepare:async e=>{const i=[...e.activator.getGraveyard().cardEntities,...e.activator.getMonstersOnField()].flatMap(n=>n.status.monsterCategories??[]).getDistinct().union(["Ritual","Fusion","Syncro","Xyz"]).length;if(i<1)return;const r=[...e.activator.getOpponentPlayer().getGraveyard().cardEntities,...e.activator.getOpponentPlayer().getEntiteisOnField()].filter(n=>n.canBeTargetOfEffect(e));if(r.length<1)return;const a=await e.action.entity.duel.view.waitSelectEntities(e.activator,{selectables:r,qty:void 0,validator:n=>n.length>0&&n.length<=i,cancelable:!1},"手札に戻すカードを選択。")??[];if(a.length)return{selectedEntities:a,chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.selectedEntities.filter(r=>r.isOnFieldStrictly||r.fieldCell.cellType==="Graveyard").filter(r=>r.canBeEffected(e.activator,e.action.entity,e.action));await ae.returnManyToHandForTheSameReason(t,["Effect"],e.action.entity,e.activator);const i=t.filter(r=>r.fieldCell.cellType==="Hand"||r.fieldCell.cellType==="ExtraDeck").length;return e.action.entity.numericOprsBundle.push(_t.createLingeringAddition(e.action.title,r=>r.isSpawnedBy.isEffective,e.action.entity,e.action,"attack",(r,a,n)=>n+500*i)),!0},settle:async()=>!0},{title:"②蘇生",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:yt,executablePeriods:Rt,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>{const t=e.action.entity.moveLog.latestRecord.movedAt,i=e.action.duel.field.moveLog.getPriviousChainLog().filter(n=>(console.log(n,n.entity.fieldCell.cellType==="Graveyard",n.movedAs.includes("BattleDestroy")),n.entity.fieldCell.cellType==="Graveyard"||n.movedAs.includes("BattleDestroy"))).filter(n=>n.movedAt.totalProcSeq>t.totalProcSeq).map(n=>n.entity.wasMovedFrom).toArray();if(!e.action.entity.linkArrowDests.union(i).length)return;const r=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getGraveyard().cardEntities.filter(n=>n.kind==="Monster").filter(n=>n.types.includes("Cyberse")).filter(n=>n.canBeTargetOfEffect(e)).map(n=>({monster:n,posList:Ue,cells:r})),[],!1).length)return we(e)},prepare:e=>pi(e,e.activator.getGraveyard().cardEntities.filter(t=>t.kind==="Monster").filter(t=>t.types.includes("Cyberse")).filter(t=>t.canBeTargetOfEffect(e)),Ue),execute:e=>hi(e,Ue),settle:async()=>!0}]}}const nl=Object.freeze(Object.defineProperty({__proto__:null,default:nu},Symbol.toStringTag,{value:"Module"}));function*su(){yield*["イグナイト・イーグル","イグナイト・マグナム","イグナイト・ドラグノフ","イグナイト・マスケット","イグナイト・デリンジャー","イグナイト・ライオット","イグナイト・ウージー","イグナイト・キャリバー"].map(e=>({name:e,actions:[ve,_e,ke,je,ja,{title:"①サーチ",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:t=>{var r;const i=t.activator.getPendulumScaleMonsters().find(a=>a!==t.action.entity);if(i&&(r=i.status.nameTags)!=null&&r.includes("イグナイト"))return t.activator.getDeckCell().cardEntities.some(a=>{var n;return(n=a.status.nameTags)==null?void 0:n.includes("イグナイト")})?[]:void 0},prepare:async t=>({selectedEntities:[],chainBlockTags:["SearchFromDeck",...t.action.calcChainBlockTagsForDestroy(t.activator.getPendulumScaleMonsters())],prepared:void 0}),execute:async t=>{if(!(await ae.tryDestroy(t.activator.getPendulumScaleMonsters(),t)).length)return!1;const r=t.activator.getDeckCell().cardEntities.filter(n=>{var s;return(s=n.status.nameTags)==null?void 0:s.includes("イグナイト")});if(!r.length)return!1;const a=await t.activator.waitSelectEntity(r,"手札に加えるカードを選択。",!1);return a?(await a.addToHand(["Effect"],t.action.entity,t.activator),!0):!1},settle:async()=>!0}]}))}const sl=Object.freeze(Object.defineProperty({__proto__:null,default:su},Symbol.toStringTag,{value:"Module"}));function*lu(){yield{name:"ジャンク・コレクター",actions:[ve,_e,ke,je,{title:"罠コピー",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:yt,executablePeriods:Ae,executableDuelistTypes:["Controller"],canPayCosts:e=>e.activator.getGraveyard().cardEntities.filter(i=>i.kind==="Trap").filter(i=>i.status.trapCategory==="Normal").filter(i=>e.activator.canTryBanish(i,"BanishAsCost",e.action)).filter(i=>i.canBeBanished("BanishAsCost",e.activator,e.action.entity,e.action)).flatMap(i=>i.actions).filter(i=>i.playType==="CardActivation").filter(i=>!i.needsToPayCost).filter(i=>i.validate(e.activator,[],!0)).length?or(e):!1,validate:()=>[],payCosts:async(e,t,i)=>{const r=e.activator.getGraveyard().cardEntities.filter(s=>s.kind==="Trap").filter(s=>s.status.trapCategory==="Normal").filter(s=>e.activator.canTryBanish(s,"BanishAsCost",e.action)).filter(s=>s.canBeBanished("BanishAsCost",e.activator,e.action.entity,e.action)).flatMap(s=>s.actions).filter(s=>s.playType==="CardActivation").filter(s=>!s.needsToPayCost).filter(s=>s.validate(e.activator,[],!0)).map(s=>s.entity),a=await e.activator.waitSelectEntity(r,"コピーする罠を選択。",i);if(!a)return;const n=[e.action.entity,a];return await ae.banishManyForTheSameReason(n,["Cost"],e.action.entity,e.activator),{banish:n}},prepare:async(e,t)=>{var a;const i=(a=e.costInfo.banish)==null?void 0:a.find(n=>n!==e.action.entity);if(!i)throw new se("想定されない状況",e,e.costInfo);const r=i.actions.find(n=>n.playType==="CardActivation");if(!r)throw new se("想定されない状況",e,e.costInfo,i);return await r.prepare(e.activator,void 0,void 0,t,!1,!0)},execute:async(e,t)=>{var a;const i=(a=e.costInfo.banish)==null?void 0:a.find(n=>n!==e.action.entity);if(!i)throw new se("想定されない状況",e,e.costInfo);const r=i.actions.find(n=>n.playType==="CardActivation");if(!r)throw new se("想定されない状況",e,e.costInfo,i);return await r.execute(e,t)},settle:async()=>!0}]}}const ll=Object.freeze(Object.defineProperty({__proto__:null,default:lu},Symbol.toStringTag,{value:"Module"}));function*ou(){yield{name:"ダーク・リゾネーター",actions:[ve,_e,ke,je],substituteEffects:[Md(1)]},yield{name:"レッド・リゾネーター",actions:[ve,_e,ke,je,{title:"①特殊召喚",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...Ae,...Xe],executableDuelistTypes:["Controller"],validate:e=>{if(!e.action.entity.hasBeenSummonedNow(["NormalSummon"]))return;const t=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getHandCell().cardEntities.filter(r=>r.kind==="Monster").filter(r=>(r.lvl??12)<5).map(r=>({monster:r,posList:Ue,cells:t})),[],!1).length)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromHand"],prepared:void 0}),execute:async e=>{const t=e.activator.getMonsterZones(),i=e.activator.getHandCell().cardEntities.filter(a=>a.kind==="Monster").filter(a=>(a.lvl??12)<5).map(a=>({monster:a,posList:Ue,cells:t}));return!!await e.activator.summonOne(e.activator,"SpecialSummon",["Effect"],e.action,i,[],!1,!1)},settle:async()=>!0},{title:"②回復",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...Ae,...Xe],executableDuelistTypes:["Controller"],hasToTargetCards:!0,isOnlyNTimesPerTurn:1,validate:e=>{if(e.action.entity.hasBeenSummonedNow(["SpecialSummon"]))return e.activator.getMonstersOnField().filter(t=>t.canBeTargetOfEffect(e)).filter(t=>(t.atk??0)>0).some(t=>t.info.summonKinds.includes("SpecialSummon"))?[]:void 0},prepare:async e=>{const t=await e.activator.waitSelectEntity(e.activator.getMonstersOnField().filter(i=>i.canBeTargetOfEffect(e)).filter(i=>(i.atk??0)>0).filter(i=>i.info.summonKinds.includes("SpecialSummon")),"対象とするモンスターを選択",!1);if(t)return{selectedEntities:[t],chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.activator.lp;return e.selectedEntities.filter(i=>i.isOnFieldAsMonsterStrictly).forEach(i=>e.activator.heal(i.atk??0,e.action.entity)),e.activator.lp!==t},settle:async()=>!0}]}}const ol=Object.freeze(Object.defineProperty({__proto__:null,default:ou},Symbol.toStringTag,{value:"Module"})),bn=(e,t)=>{const i=t?`魔力充填可能(${t})`:"魔力充填可能";return bs(i,e,r=>[r],()=>!0,r=>[new Ri(i,()=>!0,!0,r,{},(a,n)=>a.isSpawnedBy===n,(a,n)=>(n.maxCounterQty.SpellCounter=t??Number.MAX_VALUE,{...n,maxCounterQty:n.maxCounterQty}))])},ra={},cu=(e,t=1)=>(ra[t]||(ra[t]={title:`魔力回収(${t})`,isMandatory:!0,playType:"AfterChainBlock",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:Rt,executableDuelistTypes:["Controller"],validate:i=>{if(!i.targetChainBlock||i.targetChainBlock.action.playType!=="CardActivation"||i.targetChainBlock.action.entity.kind!=="Spell"||!i.action.entity.isEffective||i.action.entity.face==="FaceDown")return;const r=i.action.entity.status.maxCounterQty.SpellCounter??0;if(!(i.action.entity.counterHolder.getQty("SpellCounter")>=r)&&!(i.action.entity.hadArrivedToFieldAt().totalProcSeq>i.targetChainBlock.isActivatedAt.totalProcSeq))return[]},prepare:st,execute:async i=>i.action.entity.face==="FaceDown"||!i.action.entity.isOnFieldAsMonsterStrictly||!i.action.entity.isEffective?!1:(i.action.entity.counterHolder.add("SpellCounter",t,i.action.entity),!0),settle:async()=>!0}),{...ra[t],title:`${e}魔力回収(${t})`}),ba=(e,t,i)=>e.action.entity.counterHolder.getQty("SpellCounter")>=i,ka=(e,t,i,r)=>{const a=r[0];return e.action.entity.counterHolder.remove("SpellCounter",a),{counter:a}};function*du(){yield{name:"魔導戦士 ブレイカー",actions:[ve,_e,ke,je,{title:"①魔力充填",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.hasBeenSummonedNow(["NormalSummon"]))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["IfNormarlSummonSucceed"],prepared:void 0}),execute:async e=>e.action.entity.face==="FaceDown"?!1:(e.action.entity.counterHolder.setQty("SpellCounter",1,e.action.entity),!0),settle:async()=>!0},{title:"③マナブレイク",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,canPayCosts:(e,t)=>ba(e,t,1),validate:e=>{const t=e.action.entity.field.getCells(...vi).flatMap(i=>i.cardEntities).filter(i=>i.canBeTargetOfEffect(e));if(t.length)return t.map(i=>i.fieldCell)},payCosts:async(e,t,i)=>ka(e,t,i,[1]),prepare:async(e,t,i)=>{var a;let r=(a=e.dest)==null?void 0:a.cardEntities[0];if(!r){const n=e.action.entity.field.getCells(...vi).flatMap(l=>l.cardEntities).filter(l=>l.canBeTargetOfEffect(e)),s=await e.activator.waitSelectEntity(n,"破壊する対象を選択。",i);if(!s)return;r=s}return{selectedEntities:[r],chainBlockTags:e.action.calcChainBlockTagsForDestroy([r]),prepared:void 0}},execute:async e=>e.selectedEntities.every(t=>!t.isOnFieldAsSpellTrapStrictly)?!1:(await ae.tryDestroy(e.selectedEntities,e),!0),settle:async()=>!0}],continuousEffects:[bn("Monster",1),lr("②攻撃力上昇","Monster",e=>[e],()=>!0,e=>[_t.createContinuous("②攻撃力上昇",()=>!0,e,()=>!0,"attack","wip","Addition",(t,i,r)=>t.isEffective?r+t.counterHolder.getQty("SpellCounter")*300:r)])]},yield{name:"王立魔法図書館",actions:[ve,_e,ke,je,{...cu("①",1)},{title:"②ドロー",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],canPayCosts:(e,t)=>ba(e,t,3),validate:e=>{if(e.activator.getDeckCell().cardEntities.length)return[]},payCosts:async(e,t,i)=>ka(e,t,i,[3]),prepare:st,execute:async e=>(await e.activator.draw(1,e.action.entity,e.activator),!0),settle:async()=>!0}],continuousEffects:[bn("Monster",3)]}}const cl=Object.freeze(Object.defineProperty({__proto__:null,canPaySpellCounters:ba,default:du,paySpellCounters:ka},Symbol.toStringTag,{value:"Module"}));function*uu(){yield{name:"スターダスト・ドラゴン",actions:[ve,_e,ke,Nt(),{title:"①ヴィクテム・サンクチュアリ",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:Rt,executableDuelistTypes:["Controller"],canPayCosts:Za,validate:(e,t)=>t.length===0?void 0:t[e.index-1].chainBlockTags.includes("DestroyOnField")?[]:void 0,payCosts:Ua,prepare:async(e,t)=>{const i=t.slice(-1)[0];return{selectedEntities:[],chainBlockTags:e.action.calcChainBlockTagsForDestroy([i.action.entity]),prepared:void 0}},execute:async(e,t)=>{const i=t[e.index-1];return i.isNegatedActivationBy=e.action,await ae.tryDestroy([i.action.entity],e),!0},settle:async()=>!0},{title:"②自己再生",playType:"IgnitionEffect",isMandatory:!1,spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["end"],executableDuelistTypes:["Controller"],validate:e=>{const t=e.action.entity.moveLog.latestRecord;if(t.movedBy!==e.action.entity||!e.activator.duel.clock.isSameTurn(t.movedAt)||!t.movedAs.includes("Cost"))return;const i=e.activator.duel,r=e.action.entity.actionLogRecords.filter(n=>i.clock.isSameTurn(n.clock)).map(n=>n.chainBlockInfo).findLast(n=>n.action.title==="①ヴィクテム・サンクチュアリ");return!r||r.state!=="done"?void 0:e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:st,execute:e=>di(e),settle:async()=>!0}]},yield{name:"閃珖竜 スターダスト",actions:[ve,_e,Nt(),{title:"波動音壁",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:yt,executablePeriods:Ae,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,hasToTargetCards:!0,validate:e=>{const t=e.activator.getEntiteisOnField().filter(i=>i.face==="FaceUp").filter(i=>i.canBeTargetOfEffect(e));if(t.length)return t.map(i=>i.fieldCell)},prepare:async(e,t,i)=>{if(e.dest)return{selectedEntities:e.dest.cardEntities,chainBlockTags:[],prepared:void 0};const r=e.activator.getEntiteisOnField().filter(n=>n.face==="FaceUp").filter(n=>n.canBeTargetOfEffect(e));if(!r.length)return;const a=await e.activator.waitSelectEntity(r,"対象とするカードを選択",i);if(a)return{selectedEntities:[a],chainBlockTags:[],prepared:void 0}},execute:async e=>(e.selectedEntities.filter(t=>t.isOnFieldStrictly).filter(t=>t.face==="FaceUp").filter(t=>t.canBeEffected(e.activator,e.action.entity,e.action)).forEach(t=>{t.counterHolder.add("SonicBarrier",1,e.action.entity)}),!0),settle:async()=>!0}],substituteEffects:[{title:"波動音壁（適用）",isMandatory:!0,executableCells:ci,executablePeriods:Rt,executableDuelistTypes:["Controller"],isApplicableTo:(e,t,i)=>i.filter(r=>r.counterHolder.getQty("SonicBarrier",e.entity)>0),substitute:async(e,t,i)=>{const r=i.filter(a=>a.counterHolder.getQty("SonicBarrier",e.entity)>0);return r.forEach(a=>{a.counterHolder.removeAll("SonicBarrier",e.entity),e.entity.controller.writeInfoLog(`波動音壁により${a.toString()}は１ターンに１度だけ戦闘効果では破壊されない。`)}),r}}]},yield{name:"真閃珖竜 スターダスト・クロニクル",actions:[ve,_e,Nt(e=>e.length===1&&e.every(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")}),e=>e.length>0&&e.every(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")})),{title:"波動護魂",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:yt,executablePeriods:Ae,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,canPayCosts:e=>ld(e,e.activator.getGraveyard().cardEntities.filter(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")})),validate:()=>[],payCosts:e=>od(e,e.activator.getGraveyard().cardEntities.filter(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")}),t=>t.length===1,1),prepare:st,execute:async e=>(e.action.entity.procFilterBundle.push(Xi.createLingering(e.action.title,t=>t.effectOwner.duel.clock.isSameTurn(t.isSpawnedAt),e.action.entity,e.action,()=>!0,["Effect"],()=>!1)),!0),settle:async()=>!0},{title:"②蘇生",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Banished"],executablePeriods:[...Ae,...Xe],executableDuelistTypes:["Controller"],validate:e=>{if(!e.action.entity.wasMovedAtPreviousChain)return;const t=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getBanished().cardEntities.filter(r=>r.kind==="Monster").filter(r=>r.face==="FaceUp").filter(r=>r.types.includes("Dragon")).filter(r=>{var a;return(a=r.status.monsterCategories)==null?void 0:a.includes("Syncro")}).filter(r=>r.canBeTargetOfEffect(e)).map(r=>({monster:r,posList:Ue,cells:t})),[],!1).length)return[]},prepare:e=>pi(e,e.activator.getBanished().cardEntities.filter(t=>t.kind==="Monster").filter(t=>t.face==="FaceUp").filter(t=>t.types.includes("Dragon")).filter(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")}).filter(t=>t.canBeTargetOfEffect(e))),execute:async e=>hi(e),settle:async()=>!0}]},yield{name:"聖珖神竜 スターダスト・シフル",actions:[ve,_e,Nt(e=>e.length===1&&e.every(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")}),e=>e.length>1&&e.every(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")})),{title:"②珖波動反撃",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:["Hand"],executablePeriods:Ae,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,negatePreviousBlock:!0,validate:e=>{if(e.targetChainBlock&&e.activator!==e.targetChainBlock.activator&&e.targetChainBlock.action.entity.kind==="Monster"&&e.targetChainBlock.action.isWithChainBlock)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["NegateCardEffect","DestroyOnField"],prepared:void 0}),execute:async e=>{if(!e.targetChainBlock)return!1;const t=e.targetChainBlock;t.isNegatedEffectBy=e.action;const i=await e.activator.waitSelectEntity(e.action.duel.field.getCardsOnFieldStrictly(),"破壊するカードを選択。",!1);return(await ae.tryDestroy(i?[i]:[],e)).length>0},settle:async()=>!0},{title:"③蘇生",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:10,canPayCosts:or,validate:e=>e.activator.getBanished().cardEntities.filter(i=>{var r;return(r=i.status.nameTags)==null?void 0:r.includes("スターダスト")}).filter(i=>(i.lvl??12)<9).length===0?void 0:e.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:Vr,prepare:e=>pi(e,e.activator.getBanished().cardEntities.filter(t=>{var i;return(i=t.status.nameTags)==null?void 0:i.includes("スターダスト")}).filter(t=>(t.lvl??12)<9),Ue,t=>t.length===1),execute:e=>hi(e,Ue),settle:async()=>!0}],substituteEffects:[{title:"波動聖句",isMandatory:!0,executableCells:["MonsterZone"],executablePeriods:Rt,executableDuelistTypes:["Controller"],isApplicableTo:(e,t,i)=>i.filter(r=>r.controller===e.entity.controller).filter(r=>r.counterHolder.getQty("SonicVerse",e.entity)===0),substitute:async(e,t,i)=>{if(!e.entity.isEffective)return[];const r=i.filter(a=>a.controller===e.entity.controller).filter(a=>a.counterHolder.getQty("SonicVerse",e.entity)===0);return r.forEach(a=>{a.counterHolder.add("SonicVerse",1,e.entity),e.entity.controller.writeInfoLog(`${e.entity.toString()}の効果により${a.toString()}は１ターンに１度だけ破壊されない。`)}),r}}]}}const dl=Object.freeze(Object.defineProperty({__proto__:null,default:uu},Symbol.toStringTag,{value:"Module"}));function*fu(){yield{name:"フォーミュラ・シンクロン",actions:[ve,_e,ke,Nt(),{title:"①ドロー",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:yt,executablePeriods:[...Ae,...Xe],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.hasBeenSummonedJustNow(["SyncroSummon"])&&e.activator.getDeckCell().cardEntities.length)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(1,e.action.entity,e.activator),!0),settle:async()=>!0},$s({title:"②シンクロ召喚",isOnlyNTimesPerChain:1})]}}const ul=Object.freeze(Object.defineProperty({__proto__:null,default:fu},Symbol.toStringTag,{value:"Module"}));function*vu(){yield{name:"調律",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:e=>{const t=e.activator.getDeckCell().cardEntities;if(!(t.length<2)&&t.filter(i=>{var r;return(r=i.status.nameTags)==null?void 0:r.includes("シンクロン")}).filter(i=>{var r;return(r=i.status.monsterCategories)==null?void 0:r.includes("Tuner")}).length!==0)return we(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck","SendToGraveyardFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities;if(t.length<2)return!1;const i=t.filter(a=>{var n;return(n=a.status.nameTags)==null?void 0:n.includes("シンクロン")}).filter(a=>{var n;return(n=a.status.monsterCategories)==null?void 0:n.includes("Tuner")});if(i.length===0)return!1;const r=await e.activator.waitSelectEntity(i,"手札に加えるモンスターを選択",!1);if(!r)throw new rt(e);return await r.addToHand(["Effect"],e.action.entity,e.activator),e.activator.getDeckCell().shuffle(),e.activator.duel.clock.incrementProcSeq(),await e.activator.getDeckCell().cardEntities[0].sendToGraveyard(["Effect"],e.action.entity,e.activator),!0},settle:async()=>!0},ge]}}const fl=Object.freeze(Object.defineProperty({__proto__:null,default:vu},Symbol.toStringTag,{value:"Module"}));function*pu(){yield{name:"トゥーン・ワールド",actions:[{...ja,canPayCosts:e=>e.activator.lp>=1e3,payCosts:(e,t)=>Ps(e,t,1e3)},ge]}}const vl=Object.freeze(Object.defineProperty({__proto__:null,default:pu},Symbol.toStringTag,{value:"Module"}));function*hu(){yield{name:"無の煉獄",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(e.activator.getDeckCell().cardEntities.length&&!(e.activator.getHandCell().cardEntities.length<3)&&e.activator.status.canDiscardAsEffect)return we(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw","DiscordAsEffect"],prepared:void 0}),execute:async e=>(await e.activator.draw(1,e.action.entity,e.activator),e.activator.entity.counterHolder.add("IntoTheVoid",1,e.action.entity),!0),settle:async()=>!0},{title:"手札抹殺",isMandatory:!0,playType:"LingeringEffect",spellSpeed:"Normal",executableCells:ci,executablePeriods:["end"],executableDuelistTypes:["Controller","Opponent"],validate:e=>e.activator.entity.counterHolder.getQty("IntoTheVoid",e.action.entity)?[]:void 0,prepare:st,execute:async e=>(await ae.discardManyForTheSameReason(e.activator.getHandCell().cardEntities,["Effect"],e.action.entity,e.activator),e.activator.entity.counterHolder.remove("IntoTheVoid",1,e.action.entity),!0),settle:async()=>!0},ge]}}const pl=Object.freeze(Object.defineProperty({__proto__:null,default:hu},Symbol.toStringTag,{value:"Module"}));function*gu(){yield{name:"星杯の妖精リース",actions:[ve,_e,ke,je,{title:"①サーチ",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...Ae,...Xe],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>{if(e.action.entity.hasBeenSummonedNow(["NormalSummon","SpecialSummon"])&&e.activator.getDeckCell().cardEntities.filter(t=>t.kind==="Monster").filter(t=>{var i;return(i=t.status.nameTags)==null?void 0:i.includes("星杯")}).length!==0)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(r=>r.kind==="Monster").filter(r=>{var a;return(a=r.status.nameTags)==null?void 0:a.includes("星杯")});if(t.length===0)return!1;const i=await e.activator.waitSelectEntity(t,"手札に加えるモンスターを選択",!1);if(!i)throw new se("想定されない状態",e);return await i.addToHand(["Effect"],e.action.entity,e.activator),!0},settle:async()=>!0},{title:"②自己サルベージ",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,canPayCosts:e=>[...e.activator.getMonstersOnField(),...e.activator.getHandCell().cardEntities.filter(t=>t.kind==="Monster")].some(t=>t.canBeSentToGraveyard(e.activator,e.action.entity,"SendToGraveyardAsCost",e.action)),validate:()=>[],payCosts:async e=>{const t=[...e.activator.getMonstersOnField(),...e.activator.getHandCell().cardEntities.filter(r=>r.kind==="Monster")].filter(r=>r.canBeSentToGraveyard(e.activator,e.action.entity,"SendToGraveyardAsCost",e.action)),i=await e.activator.waitSelectEntity(t,"墓地に送るモンスターを選択。",!0);if(i)return await i.sendToGraveyard(["Cost"],e.action.entity,e.activator),{sendToGraveyard:[i]}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>e.action.entity.wasMovedAfter(e.isActivatedAt)?!1:(await e.action.entity.addToHand(["Effect"],e.action.entity,e.activator),!0),settle:async()=>!0}]},yield{name:"星遺物－『星杯』",actions:[ve,_e,ke,je,{title:"①墓地送り",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...Ae,...Xe],executableDuelistTypes:["Controller"],canPayCosts:Za,validate:e=>e.activator.duel.field.moveLog.getPriviousChainLog().filter(t=>t.movedAs.includes("SpecialSummon")).map(t=>t.entity).some(t=>t.wasMovedFrom.cellType==="ExtraDeck")?[]:void 0,payCosts:Ua,prepare:st,execute:async e=>{const t=e.activator.duel.field.moveLog.getPriviousChainLog().filter(i=>i.movedAs.includes("SpecialSummon")).map(i=>i.entity).filter(i=>i.wasMovedFrom.cellType==="ExtraDeck").filter(i=>i.isOnFieldAsMonsterStrictly).filter(i=>i.canBeEffected(e.activator,e.action.entity,e.action)).toArray();return await ae.sendManyToGraveyardForTheSameReason(t,["Effect"],e.action.entity,e.activator),!0},settle:async()=>!0},{title:"②リクルート",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Hand","Graveyard","Banished"],executablePeriods:[...Ae,...Xe],executableDuelistTypes:["Controller"],validate:e=>{if(!e.action.entity.wasMovedAtPreviousChain||!e.action.entity.info.summonKinds.includes("NormalSummon")||e.action.entity.moveLog.previousPlaceRecord.face==="FaceDown")return;const t=e.activator.getDeckCell().cardEntities.filter(a=>a.kind==="Monster").filter(a=>{var n;return(n=a.status.nameTags)==null?void 0:n.includes("星杯")}).filter(a=>a.nm!=="星遺物－『星杯』"),i=e.activator.getMonsterZones();return e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,t.map(a=>({monster:a,cells:i,posList:Ue})),[],!1).length>1?[]:void 0},prepare:st,execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(a=>a.kind==="Monster").filter(a=>{var n;return(n=a.status.nameTags)==null?void 0:n.includes("星杯")}).filter(a=>a.nm!=="星遺物－『星杯』"),i=e.activator.getMonsterZones();return(await e.activator.summonMany(e.activator,"SpecialSummon",["Effect"],e.action,t.map(a=>({monster:a,cells:i,posList:Ue})),[],!1,2,a=>a.length==2,!1)??[]).length==2},settle:async()=>!0},{title:"③サーチ",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],canPayCosts:or,validate:e=>{if(!e.action.entity.wasMovedAtCurrentTurn)return e.activator.getDeckCell().cardEntities.filter(t=>{var i;return(i=t.status.nameTags)==null?void 0:i.includes("星遺物")}).length>0?[]:void 0},payCosts:Vr,prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>{const t=await e.activator.waitSelectEntity(e.activator.getDeckCell().cardEntities.filter(i=>{var r;return(r=i.status.nameTags)==null?void 0:r.includes("星遺物")}),"手札に加えるカードを選択",!1);return t?(await t.addToHand(["Effect"],e.action.entity,e.activator),!0):!1},settle:async()=>!0}]}}const hl=Object.freeze(Object.defineProperty({__proto__:null,default:gu},Symbol.toStringTag,{value:"Module"}));function*yu(){yield{name:"ドットスケーパー",actions:[ve,_e,je,ke,{title:"①自己再生",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...Ae,...Xe],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:1,actionGroupName:"ドットスケーパー",validate:e=>{if(e.action.entity.wasMovedAtPreviousChain)return e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:e=>di(e),settle:async()=>!0},{title:"②自己帰還",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Banished"],executablePeriods:[...Ae,...Xe],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:1,actionGroupName:"ドットスケーパー",validate:e=>{if(e.action.entity.wasMovedAtPreviousChain)return e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromBanished"],prepared:void 0}),execute:e=>di(e),settle:async()=>!0}]}}const gl=Object.freeze(Object.defineProperty({__proto__:null,default:yu},Symbol.toStringTag,{value:"Module"}));function*_u(){yield{name:"ゼラの天使",actions:[ve,_e,ke,Nt(),{title:"②自己帰還",isMandatory:!0,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Banished"],executablePeriods:["stanby"],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.wasMovedAtPreviousTurn)return e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromBanished"],prepared:void 0}),execute:e=>di(e),settle:async()=>!0}],continuousEffects:[lr("②攻撃力上昇","Monster",e=>[e],()=>!0,e=>[_t.createContinuous("①攻撃力上昇",()=>!0,e,()=>!0,"attack","wip","Addition",(t,i,r)=>t.isEffective?r+t.controller.getOpponentPlayer().getBanished().cardEntities.length*100:r)])]}}const yl=Object.freeze(Object.defineProperty({__proto__:null,default:_u},Symbol.toStringTag,{value:"Module"}));function*mu(){yield{name:"死霊騎士デスカリバー・ナイト",actions:[ve,_e,je,ke,{title:"①モンスター効果無効",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Quick",executableCells:yt,executablePeriods:[...Ae,...Xe],executableDuelistTypes:["Controller"],negatePreviousBlock:!0,canPayCosts:Za,validate:e=>e.targetChainBlock&&e.targetChainBlock.action.entity.kind==="Monster"&&e.targetChainBlock.action.isWithChainBlock?[]:void 0,payCosts:Ua,prepare:async(e,t)=>{const i=e.targetChainBlock,r=t[e.index-1];return i!==r?{selectedEntities:[],chainBlockTags:[],prepared:void 0}:{selectedEntities:[],chainBlockTags:["NegateCardEffect",...e.action.calcChainBlockTagsForDestroy([i.action.entity])],prepared:void 0}},execute:async(e,t)=>{const i=t.find(a=>a.action.entity.kind!=="Monster"&&a.action.isWithChainBlock),r=t[e.index-1];return r!==i?!1:(r.isNegatedActivationBy=e.action,await ae.tryDestroy([r.action.entity],e),!0)},settle:async()=>!0}]}}const _l=Object.freeze(Object.defineProperty({__proto__:null,default:mu},Symbol.toStringTag,{value:"Module"}));function*Su(){yield{name:"召喚僧サモンプリースト",actions:[ve,_e,je,ke,{title:"①表示形式変更",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...Ae,...Xe],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.hasBeenSummonedNow(["NormalSummon","FlipSummon"]))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["IfNormarlSummonSucceed"],prepared:void 0}),execute:async e=>e.action.entity.battlePosition!=="Attack"||!e.action.entity.isOnFieldAsMonsterStrictly?!1:(await e.action.entity.setBattlePosition("Defense",["Effect"],e.action.entity,e.activator),!0),settle:async()=>!0},{title:"③リクルート",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,canPayCosts:e=>e.activator.status.canDiscardAsCost?e.activator.getHandCell().cardEntities.some(t=>t.kind==="Spell"):!1,validate:e=>{const t=e.activator.getDeckCell().cardEntities.filter(a=>a.kind==="Monster").filter(a=>a.lvl===4),i=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,t.map(a=>({monster:a,posList:Ue,cells:i})),[],!1).length)return[]},payCosts:async(e,t,i)=>{const r=e.activator.getHandCell().cardEntities.filter(n=>n.kind==="Spell"),a=await e.activator.waitSelectEntity(r,"手札コストを選択",i);if(!a&&!i)throw new rt(e);if(a)return await a.discard(["Cost"],e.action.entity,e.activator),{discard:[a]}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(a=>a.lvl===4),i=e.activator.getMonsterZones(),r=await e.activator.summonOne(e.activator,"SpecialSummon",["Effect"],e.action,t.map(a=>({monster:a,posList:Ue,cells:i})),[],!1,!1);return r?(r.statusOperatorBundle.push(new Ri("攻撃不可",a=>a.effectOwner.duel.clock.isSameTurn(a.isSpawnedAt),!1,e.action.entity,e.action,()=>!0,(a,n)=>({...n,canAttack:!1}))),!!r):!1},settle:async()=>!0}],continuousEffects:[Cs("②リリース不可","Monster",e=>[e],()=>!0,e=>[new Xi("②リリース不可",()=>!0,!0,e,{},()=>!0,["AdvanceSummonRelease","ReleaseAsEffect","ReleaseAsCost"],()=>!1)])]}}const ml=Object.freeze(Object.defineProperty({__proto__:null,default:Su},Symbol.toStringTag,{value:"Module"}));function*Cu(){yield{name:"エキセントリック・ボーイ",actions:[ve,_e,je,ke],summonFilter:(e,t,i,r,a,n,s,l,d,o)=>{const f={posList:d,cells:o},v={posList:[],cells:[]};if(!a.includes("SyncroSummon"))return f;const p=l.find(y=>y.material===e.isSpawnedBy);return p?!p.cell.isMonsterZoneLikeCell||l.length!==2?v:l.filter(y=>y!==p).every(y=>y.cell.cellType==="Hand")?f:v:f},defaultStatus:{allowHandSyncro:!0},onUsedAsMaterial:(e,t)=>{t.info.summonKinds.includes("SyncroSummon")&&(t.info.willBeBanished=!0,t.info.isEffectiveIn=t.info.isEffectiveIn.filter(i=>i!=="ExtraMonsterZone").filter(i=>i!=="MonsterZone"))}}}const Sl=Object.freeze(Object.defineProperty({__proto__:null,default:Cu},Symbol.toStringTag,{value:"Module"})),bu={title:"ペンデュラム召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>{const t=e.activator.getPendulumScales();if(!t||t.upperBound-t.lowerBound<2)return;const i=[...e.activator.getHandCell().cardEntities.filter(n=>n.kind==="Monster"),...e.activator.getExtraDeck().cardEntities.filter(n=>n.face==="FaceUp")].filter(n=>n.kind==="Monster").filter(n=>n.lvl&&n.lvl>t.lowerBound).filter(n=>n.lvl&&n.lvl<t.upperBound);if(!i.length)return;const r=[...e.activator.getMonsterZones(),...e.activator.getEmptyExtraZones()];return e.activator.getEnableSummonList(e.activator,"PendulumSummon",["Rule"],e.action,i.map(n=>({monster:n,cells:r,posList:Ue})),[],!1).length?[]:void 0},prepare:async e=>{const t=e.activator.getPendulumScales();if(!t||t.upperBound-t.lowerBound<2)return;const i=[...e.activator.getHandCell().cardEntities.filter(a=>a.kind==="Monster"),...e.activator.getExtraDeck().cardEntities.filter(a=>a.face==="FaceUp")].filter(a=>a.kind==="Monster").filter(a=>a.lvl&&a.lvl>t.lowerBound).filter(a=>a.lvl&&a.lvl<t.upperBound);if(!i.length)return;const r=[...e.activator.getMonsterZones(),...e.activator.getEmptyExtraZones()];return await e.activator.summonMany(e.activator,"PendulumSummon",["Rule"],e.action,i.map(a=>({monster:a,posList:Ue,cells:r})),[],!1,void 0,a=>a.length>0,!1),st()},execute:async e=>(e.activator.getPendingMonstersOnField().forEach(t=>t.determine()),!0),settle:async()=>!0},ku=[bu],Tu=e=>({name:e.profile.name,actions:[...ku],staticInfo:{name:e.profile.name,kind:"Monster",wikiEncodedName:"%A5%D7%A5%EC%A5%A4%A5%E4%A1%BC"}});function*wu(){const e={...Object.assign({"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_ContinuousSpell.ts":Fs,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_ContinuousTrap.ts":Bs,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_CounterTrap.ts":Os,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_EquipSpell.ts":Ls,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_EquipSpell_Preset.ts":Ns,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_FieldSpell_Preset.ts":qs,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_LinkMonster.ts":Hs,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_Monster.ts":js,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_Monster_Preset_DirectAttacker.ts":Zs,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_Monster_Preset_Recruiter.ts":Us,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_NormalSpell.ts":Gs,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_NormalSpell_General_Draw.ts":zs,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_NormalSpell_Preset.ts":Vs,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_NormalTrap.ts":Ws,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_NormalTrap_UponAttackDeclaration.ts":Ys,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_QuickPlaySpell.ts":Qs,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_SyncroMonster.ts":Ks,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_TestMonster.ts":Xs,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_XyzMonster.ts":Js}),...Object.assign({"/src/ygo_entity_proc/card_proc_definitions/character_yusei/CardProcDefinitions_Yusei_SyncroTunerMonster.ts":Is,"/src/ygo_entity_proc/card_proc_definitions/tag_b/CardProcDefinitions_BambooSword_EquipSpell.ts":el,"/src/ygo_entity_proc/card_proc_definitions/tag_b/CardProcDefinitions_BambooSword_NormalSpell.ts":tl,"/src/ygo_entity_proc/card_proc_definitions/tag_b/CardProcDefinitions_Blackwing_Monster.ts":il,"/src/ygo_entity_proc/card_proc_definitions/tag_c/CardProcDefinitions_Crystron_LinkMonster.ts":rl,"/src/ygo_entity_proc/card_proc_definitions/tag_e/CardProcDefinitions_Exodia_Monster.ts":al,"/src/ygo_entity_proc/card_proc_definitions/tag_f/CardProcDefinitions_Firewall_LinkMonster.ts":nl,"/src/ygo_entity_proc/card_proc_definitions/tag_i/CardProcDefinitions_Igknight_Monster.ts":sl,"/src/ygo_entity_proc/card_proc_definitions/tag_j/CardProcDefinitions_Junk_Monster.ts":ll,"/src/ygo_entity_proc/card_proc_definitions/tag_r/CardProcDefinitions_Resonator_Monster.ts":ol,"/src/ygo_entity_proc/card_proc_definitions/tag_s/CardProcDefinitions_SpellCounter_Monster.ts":cl,"/src/ygo_entity_proc/card_proc_definitions/tag_s/CardProcDefinitions_Stardust_Monster.ts":dl,"/src/ygo_entity_proc/card_proc_definitions/tag_s/CardProcDefinitions_Synchron_SyncroMonster.ts":ul,"/src/ygo_entity_proc/card_proc_definitions/tag_s/CardProcDefinitions_Syncron_NormalSpell.ts":fl,"/src/ygo_entity_proc/card_proc_definitions/tag_t/CardProcDefinitions_Toon_ContinuousSpell.ts":vl,"/src/ygo_entity_proc/card_proc_definitions/tag_v/CardProcDefinitions_Void_NormalSpell.ts":pl,"/src/ygo_entity_proc/card_proc_definitions/tag_w/CardProcDefinitions_WorldChalice_Monster.ts":hl,"/src/ygo_entity_proc/card_proc_definitions/type_Cyberse/CardProcDefinitions_Earth_Cyberse_lvl1_Monster.ts":gl,"/src/ygo_entity_proc/card_proc_definitions/type_Fairy/CardProcDefinitions_Light_Fairy_lvl8_SyncroMonster.ts":yl,"/src/ygo_entity_proc/card_proc_definitions/type_Fiend/CardProcDefinitions_Dark_Fiend_lvl4_Monster.ts":_l,"/src/ygo_entity_proc/card_proc_definitions/type_Spellcaster/CardProcDefinitions_Dark_Spellcaster_lvl4_Monster.ts":ml,"/src/ygo_entity_proc/card_proc_definitions/type_Spellcaster/CardProcDefinitions_Wind_Spellcaster_lvl3_Monster.ts":Sl})};for(const t of Object.keys(e))e[t].default&&(yield*e[t].default())}function*Eu(...e){const t={...Object.assign({"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_ContinuousSpell.ts":Fs,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_ContinuousTrap.ts":Bs,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_CounterTrap.ts":Os,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_EquipSpell.ts":Ls,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_EquipSpell_Preset.ts":Ns,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_FieldSpell_Preset.ts":qs,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_LinkMonster.ts":Hs,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_Monster.ts":js,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_Monster_Preset_DirectAttacker.ts":Zs,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_Monster_Preset_Recruiter.ts":Us,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_NormalSpell.ts":Gs,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_NormalSpell_General_Draw.ts":zs,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_NormalSpell_Preset.ts":Vs,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_NormalTrap.ts":Ws,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_NormalTrap_UponAttackDeclaration.ts":Ys,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_QuickPlaySpell.ts":Qs,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_SyncroMonster.ts":Ks,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_TestMonster.ts":Xs,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_XyzMonster.ts":Js}),...Object.assign({"/src/ygo_entity_proc/card_proc_definitions/character_yusei/CardProcDefinitions_Yusei_SyncroTunerMonster.ts":Is,"/src/ygo_entity_proc/card_proc_definitions/tag_b/CardProcDefinitions_BambooSword_EquipSpell.ts":el,"/src/ygo_entity_proc/card_proc_definitions/tag_b/CardProcDefinitions_BambooSword_NormalSpell.ts":tl,"/src/ygo_entity_proc/card_proc_definitions/tag_b/CardProcDefinitions_Blackwing_Monster.ts":il,"/src/ygo_entity_proc/card_proc_definitions/tag_c/CardProcDefinitions_Crystron_LinkMonster.ts":rl,"/src/ygo_entity_proc/card_proc_definitions/tag_e/CardProcDefinitions_Exodia_Monster.ts":al,"/src/ygo_entity_proc/card_proc_definitions/tag_f/CardProcDefinitions_Firewall_LinkMonster.ts":nl,"/src/ygo_entity_proc/card_proc_definitions/tag_i/CardProcDefinitions_Igknight_Monster.ts":sl,"/src/ygo_entity_proc/card_proc_definitions/tag_j/CardProcDefinitions_Junk_Monster.ts":ll,"/src/ygo_entity_proc/card_proc_definitions/tag_r/CardProcDefinitions_Resonator_Monster.ts":ol,"/src/ygo_entity_proc/card_proc_definitions/tag_s/CardProcDefinitions_SpellCounter_Monster.ts":cl,"/src/ygo_entity_proc/card_proc_definitions/tag_s/CardProcDefinitions_Stardust_Monster.ts":dl,"/src/ygo_entity_proc/card_proc_definitions/tag_s/CardProcDefinitions_Synchron_SyncroMonster.ts":ul,"/src/ygo_entity_proc/card_proc_definitions/tag_s/CardProcDefinitions_Syncron_NormalSpell.ts":fl,"/src/ygo_entity_proc/card_proc_definitions/tag_t/CardProcDefinitions_Toon_ContinuousSpell.ts":vl,"/src/ygo_entity_proc/card_proc_definitions/tag_v/CardProcDefinitions_Void_NormalSpell.ts":pl,"/src/ygo_entity_proc/card_proc_definitions/tag_w/CardProcDefinitions_WorldChalice_Monster.ts":hl,"/src/ygo_entity_proc/card_proc_definitions/type_Cyberse/CardProcDefinitions_Earth_Cyberse_lvl1_Monster.ts":gl,"/src/ygo_entity_proc/card_proc_definitions/type_Fairy/CardProcDefinitions_Light_Fairy_lvl8_SyncroMonster.ts":yl,"/src/ygo_entity_proc/card_proc_definitions/type_Fiend/CardProcDefinitions_Dark_Fiend_lvl4_Monster.ts":_l,"/src/ygo_entity_proc/card_proc_definitions/type_Spellcaster/CardProcDefinitions_Dark_Spellcaster_lvl4_Monster.ts":ml,"/src/ygo_entity_proc/card_proc_definitions/type_Spellcaster/CardProcDefinitions_Wind_Spellcaster_lvl3_Monster.ts":Sl})},i=[];for(const r of Object.values(t))if(r.default){for(const a of r.default())if(e.includes(a.name)){const n=ht[a.name];let s=a.summonFilter;n.kind==="Monster"&&n.monsterCategories&&!a.summonFilter&&n.monsterCategories.union(vs).length&&(s=Dd),yield{...a,summonFilter:s,staticInfo:n},i.push(a.name)}}if(yield*e.filter(r=>!i.includes(r)).map(r=>ht[r]).filter(r=>r).filter(r=>r.kind==="Monster").filter(r=>{var a;return(a=r.monsterCategories)==null?void 0:a.includes("Normal")}).filter(r=>{var a;return!((a=r.monsterCategories)!=null&&a.includes("Pendulum"))}).map(r=>(i.push(r.name),{name:r.name,actions:Ed,staticInfo:r})),i.length!==e.length)throw console.log(e.filter(r=>!i.includes(r))),new se("カード定義が取得できなかった",e.filter(r=>!i.includes(r)))}const Du=e=>({...Tu(e),staticInfo:{name:e.profile.name,kind:"Monster",wikiEncodedName:"%A5%D7%A5%EC%A5%A4%A5%E4%A1%BC"}}),Mu=new Set,Ta=Fl;for(const e of wu()){if(Mu.has(e.name))throw new Error(`カード定義重複${e.name}`);Ta[e.name]&&(Ta[e.name].isImplemented=!0)}const ht=Object.values(Ta).reduce((e,t)=>{var i;return(i=t.monsterCategories)!=null&&i.includes("Normal")&&!t.monsterCategories.includes("Pendulum")&&(t.isImplemented=!0),e[t.name]=t,e},{}),Cl=[{id:-1,name:"サンプルデッキ１",description:"",cardNames:["アンノウン・シンクロン","六武衆のご隠居","ジャンク・フォアード","ジャンク・フォアード","ジャンク・フォアード","チューン・ウォリアー","チューン・ウォリアー","ガード・オブ・フレムベル","ガード・オブ・フレムベル","守護竜ユスティア","守護竜ユスティア","エンジェル・トランペッター","エンジェル・トランペッター","ジェムナイト・サフィア","ジェムナイト・サフィア","魂虎","魂虎","暗黒界の番兵 レンジ","暗黒界の番兵 レンジ","バトルフットボーラー","バトルフットボーラー","球騎士の三人娘","球騎士の三人娘","エンジェル・トランペッター","エンジェル・トランペッター","Ｇ戦隊 シャインブラック","Ｇ戦隊 シャインブラック","しゃりの軍貫","しゃりの軍貫","ジョングルグールの幻術師","ジョングルグールの幻術師","ゾンビーノ","ゾンビーノ","メガロスマッシャーＸ","メガロスマッシャーＸ","ライドロン","ライドロン","機界騎士アヴラム","機界騎士アヴラム","幻のグリフォン","幻のグリフォン","幻殻竜","幻殻竜","アレキサンドライドラゴン","アレキサンドライドラゴン","ジェネティック・ワーウルフ","ジェネティック・ワーウルフ","サイバー・ドラゴン","フロストザウルス","フロストザウルス","フロストザウルス","青眼の白龍","マジカル・アンドロイド","マジカル・アンドロイド","マジカル・アンドロイド","大地の騎士ガイアナイト","大地の騎士ガイアナイト","大地の騎士ガイアナイト","スクラップ・デスデーモン","スクラップ・デスデーモン","スクラップ・デスデーモン","スターダスト・ドラゴン","スターダスト・ドラゴン","スターダスト・ドラゴン","ナチュル・ガオドレイク","ナチュル・ガオドレイク","ナチュル・ガオドレイク"]},{id:-2,name:"サンプルデッキ２",description:"",cardNames:["アンノウン・シンクロン","六武衆のご隠居","ジャンク・フォアード","グローアップ・バルブ","ガード・オブ・フレムベル","伝説の白石","伝説の白石","伝説の白石","守護竜ユスティア","ギャラクシーサーペント","ジェネクス・コントローラー","Ｅ・ＨＥＲＯ フェザーマン","Ｅ・ＨＥＲＯ バーストレディ","チューン・ウォリアー","Ｅ・ＨＥＲＯ クレイマン","Ｅ・ＨＥＲＯ スパークマン","しゃりの軍貫","ジョングルグールの幻術師","ゾンビーノ","ジェネティック・ワーウルフ","ライトロード・ビースト ウォルフ","サイバー・ドラゴン","サイバー・ドラゴン","サイバー・ドラゴン","ラブラドライドラゴン","Ｄ－ＨＥＲＯ ディアボリックガイ","Ｄ－ＨＥＲＯ ディアボリックガイ","Ｄ－ＨＥＲＯ ディアボリックガイ","フロストザウルス","Ｅ・ＨＥＲＯ ネオス","青眼の白龍","青眼の白龍","青眼の白龍","Ｅ－エマージェンシーコール","おろかな埋葬","トレード・イン","トレード・イン","トレード・イン","闇の量産工場","強欲な壺","強欲な壺","強欲な壺","死者蘇生","死者蘇生","死者蘇生","召喚師のスキル","召喚師のスキル","召喚師のスキル","成金ゴブリン","成金ゴブリン","成金ゴブリン","戦士の生還","増援","調和の宝札","調和の宝札","調和の宝札","天使の施し","天使の施し","天使の施し","貪欲な壺","貪欲な壺","貪欲な壺","マジカル・アンドロイド","マジカル・アンドロイド","マジカル・アンドロイド","大地の騎士ガイアナイト","大地の騎士ガイアナイト","大地の騎士ガイアナイト","スクラップ・デスデーモン","スクラップ・デスデーモン","スクラップ・デスデーモン","スターダスト・ドラゴン","スターダスト・ドラゴン","スターダスト・ドラゴン","ナチュル・ガオドレイク","ナチュル・ガオドレイク","ナチュル・ガオドレイク"]}],be=class be{constructor(t,i){c(this,"id");c(this,"name");c(this,"description");c(this,"lastUsedAt");c(this,"cardNames");c(this,"getIllegalCardNames",()=>Array.from(new Set(this.cardNames.filter(t=>!Object.keys(ht).includes(t)))));c(this,"getDisableCardNames",()=>Array.from(new Set(this.cardNames.filter(t=>!Object.keys(ht).includes(t)))));c(this,"createCardInfos",()=>{const t=this.getIllegalCardNames();if(t.length>0)throw new Error(`存在しないカード名からデッキを生成しようとした。${t}`);return this.cardNames.map(i=>ht==null?void 0:ht[i]).filter(i=>i)});c(this,"copy",async()=>be.createNewDeck(this.name,this.description,this.cardNames));c(this,"updateTimestamp",async()=>{await be.tblHeader.update(this.id,t=>({...t,lastUsedAt:new Date}))});c(this,"saveDeckInfo",async t=>{const i=t??this;await be.tblHeader.update(this.id,n=>({...n,name:i.name,description:i.description,lastUsedAt:new Date}));const r=(await be.tblDetail.getAll()).filter(n=>n.deckId===this.id);await be.tblDetail.delete(r.map(n=>n.id));const a=await be.tblDetail.insertMany(i.cardNames.map((n,s)=>({deckId:this.id,seq:s,name:n,description:""})));return new be(await be.tblHeader.get(this.id),a)});c(this,"delete",async()=>{await be.tblHeader.delete([this.id]);const t=(await be.tblDetail.getAll()).filter(i=>i.deckId===this.id);await be.tblDetail.delete(t.map(i=>i.id))});this.id=t.id,this.name=t.name,this.description=t.description,this.lastUsedAt=t.lastUsedAt,this.cardNames=i.filter(r=>r.deckId===this.id).map(r=>r.name)}};c(be,"toJson",t=>{const i=t.map(r=>{const{id:a,name:n,description:s,lastUsedAt:l,cardNames:d}=r;return{id:a,name:n,description:s,lastUsedAt:l,cardNames:d}});return i.forEach(r=>{r.cardNames=r.cardNames.map(a=>ht[a]).sort(Gi).map(a=>a.name)}),JSON.stringify(i,null,2)}),c(be,"convertToObjectURL",t=>{const i=be.toJson(t),r=new Blob([i],{type:"text/plain"});return window.URL.createObjectURL(r)}),c(be,"idb"),c(be,"tblHeader"),c(be,"tblDetail"),c(be,"getAllDeckInfo",async t=>{if(t&&(be.idb=t),!be.idb)throw new Error("illegal argument: idb is undefined.");be.tblHeader||(be.tblHeader=new Au(be.idb)),be.tblDetail||(be.tblDetail=new Pu(be.idb));const i=await be.tblHeader.getAll(),r=await be.tblDetail.getAll();return i.length?i.map(a=>new be(a,r)):[await be.prepareSampleDeck()]}),c(be,"createNewDeck",async(t,i,r)=>{const a=await be.tblHeader.insert({name:t,description:i,lastUsedAt:new Date}),n=await be.tblDetail.insertMany(r.map((s,l)=>({deckId:a.id,seq:l,name:s,description:""})));return new be(a,n)}),c(be,"prepareSampleDeck",async()=>{const t=Cl.slice(-1)[0];return await be.createNewDeck(t.name,t.description,t.cardNames)});let Ot=be;class Au extends Na{constructor(i){super(i,"TblDeckHeader");c(this,"_prepareInitialRecords",()=>[])}}class Pu extends Na{constructor(i){super(i,"TblDeckDetail");c(this,"_prepareInitialRecords",()=>[])}}const kn=Cl.map(e=>({...e,lastUsedAt:new Date})).filter(e=>e.id<0),xu=e=>e;function Fu(e){const t=e-1;return t*t*t+1}function Bu(e,{delay:t=0,duration:i=400,easing:r=xu}={}){const a=+getComputedStyle(e).opacity;return{delay:t,duration:i,easing:r,css:n=>`opacity: ${n*a}`}}function Tn(e,t){for(const i in t)e[i]=t[i];return e}function Ou({fallback:e,...t}){const i=new Map,r=new Map;function a(s,l,d){const{delay:o=0,duration:f=ee=>Math.sqrt(ee)*30,easing:v=Fu}=Tn(Tn({},t),d),p=s.getBoundingClientRect(),y=l.getBoundingClientRect(),m=p.left-y.left,C=p.top-y.top,g=p.width/y.width,T=p.height/y.height,k=Math.sqrt(m*m+C*C),E=getComputedStyle(l),F=E.transform==="none"?"":E.transform,Z=+E.opacity;return{delay:o,duration:typeof f=="function"?f(k):f,easing:v,css:(ee,J)=>`
			   opacity: ${ee*Z};
			   transform-origin: top left;
			   transform: ${F} translate(${J*m}px,${J*C}px) scale(${ee+(1-ee)*g}, ${ee+(1-ee)*T});
		   `}}function n(s,l,d){return(o,f)=>(s.set(f.key,o),()=>{if(l.has(f.key)){const v=l.get(f.key);return l.delete(f.key),a(v,o,f)}return s.delete(f.key),e&&e(o,f,d)})}return[n(r,i,!1),n(i,r,!0)]}var Lu=b("<div></div>"),Nu=b('<div class="duel_card_row svelte-14cfp8z"><div> </div> <div> </div></div>'),qu=b('<div class="duel_card_row svelte-14cfp8z"><div class="svelte-14cfp8z"></div> <div class="svelte-14cfp8z"> </div></div>'),Ru=b('<div class="duel_card_row svelte-14cfp8z"><div class="svelte-14cfp8z"></div> <div class="svelte-14cfp8z"> </div></div>'),$u=b('<div class="duel_card_row svelte-14cfp8z"><div> </div> <div> </div></div>'),Hu=b('<div class="duel_card_row svelte-14cfp8z"><div class="svelte-14cfp8z"></div> <div class="svelte-14cfp8z">ペンデュラム</div></div>'),ju=b('<div class="duel_card_row duel_card_detail svelte-14cfp8z"><div class="svelte-14cfp8z"> </div></div> <div class="duel_card_row duel_card_detail svelte-14cfp8z"><div class="svelte-14cfp8z"></div> <div class="svelte-14cfp8z"><span> </span> / <span> </span></div></div>',1),Zu=b('<button><div class="duel_card_body svelte-14cfp8z"><div class="duel_card_row svelte-14cfp8z" style="position:relative"><div class="svelte-14cfp8z"> </div> <div class="svelte-14cfp8z"></div> <!></div> <!> <!> <!> <!></div></button>'),Uu=b('<button><div class="svelte-14cfp8z">裏守備</div></button>'),Gu=b('<div class="duel_card duel_card_face_down svelte-14cfp8z"><div class="svelte-14cfp8z">セット</div></div>');function Zt(e,t){ot(t,!1);let i=qe(t,"entity",8),r=qe(t,"state",8,"Disabled"),a=qe(t,"selectedList",28,()=>[]),n=qe(t,"isVisibleForcibly",8,!1),s=qe(t,"isWideMode",8,!1),l=qe(t,"dummyActionInfos",24,()=>[]),d=qe(t,"cardActionResolve",8),o=qe(t,"entitySelectResolve",8,()=>{}),f,v=Pe(!1),p=()=>{},y=qe(t,"qty",12,void 0);const m=K=>{var W;f=K.activator,L(v,!1),y((W=K.entitiesChoices)==null?void 0:W.qty),p=K.resolve};i().field.duel.view.onWaitStart.append(m);let C=Pe(!1);const g=()=>{if(r()!=="Disabled"&&r()==="Selectable"&&y()===1){if(a().some(K=>K.seq!==i().seq)){a([i()]);return}y()===1&&o()&&o()([i()])}},T=K=>{(i().face==="FaceUp"||i().owner===i().field.duel.duelists.Below&&(i().isUnderControl||n()))&&i().field.duel.view.showCardInfo(i(),K??"Normal")},k=()=>{if(T(),console.log(i().toString(),r(),l().length,d()),r()==="Disabled")return;if(r()==="Selectable"){L(v,!u(v)),y()===1&&(a().splice(0),i().duel.view.requireUpdate()),a(u(v)?[...a(),i()]:a().filter(W=>W!==i()));return}if(l().length===0)return;if(l().length===1){const W=l()[0];if(d()){d()(W);return}console.log(i().toString(),r(),l().length,p),p({actionInfo:W});return}if(!f)return;i().field.duel.view.modalController.actionSelector.show({title:"行動を選択。",activator:f,dummyActionInfos:l(),cancelable:!0}).then(W=>{W&&p({actionInfo:W})})},E=K=>{var W;window.getSelection&&((W=window.getSelection())==null||W.removeAllRanges()),console.info("drag start",K,l()),i().field.duel.view.setDraggingActions(l()),L(C,!0)},F=K=>{console.info("drag end",K,l()),i().field.duel.view.removeDraggingActions(),K.dataTransfer&&L(C,!1)},Z=()=>(T("Debug"),!1);St();var ee=Ne(),J=I(ee);{var N=K=>{var W=Zu(),Re=h(W),Y=h(Re),R=h(Y),x=h(R),U=_(R,4);oe(U,1,()=>i().attr,le,(z,V)=>{var P=Lu();M(()=>De(P,`monster_attr ${u(V)??""} svelte-14cfp8z`)),S(z,P)});var X=_(Y,2);{var re=z=>{var V=Nu(),P=h(V),A=h(P),Q=_(P,2),ne=h(Q);M((O,G)=>{De(P,Si(i().lvl!==i().origin.level?"different_from_its_origin":""),"svelte-14cfp8z"),D(A,O),De(Q,Si(i().rank!==i().origin.rank?"different_from_its_origin":""),"svelte-14cfp8z"),D(ne,G)},[()=>"★".repeat(i().lvl||0),()=>"☆".repeat(i().rank||0)],Te),S(z,V)},me=z=>{var V=Ne(),P=I(V);{var A=ne=>{var O=qu(),G=_(h(O),2),ue=h(G);M(()=>D(ue,`${ar[i().status.spellCategory]??""}魔法`)),S(ne,O)},Q=ne=>{var O=Ne(),G=I(O);{var ue=Ce=>{var fe=Ru(),pe=_(h(fe),2),ce=h(pe);M(()=>D(ce,`${nr[i().status.trapCategory]??""}罠`)),S(Ce,fe)};q(G,Ce=>{i().kind==="Trap"&&i().status.trapCategory&&Ce(ue)},!0)}S(ne,O)};q(P,ne=>{i().kind==="Spell"&&i().status.spellCategory?ne(A):ne(Q,!1)},!0)}S(z,V)};q(X,z=>{i().kind==="Monster"?z(re):z(me,!1)})}var Se=_(X,2);{var ye=z=>{var V=$u(),P=h(V),A=h(P),Q=_(P,2),ne=h(Q);M(()=>{De(P,Si(i().psL!==i().origin.pendulumScaleL?"different_from_its_origin":""),"svelte-14cfp8z"),D(A,`◀ ${i().psL??""}`),De(Q,Si(i().psR!==i().origin.pendulumScaleR?"different_from_its_origin":""),"svelte-14cfp8z"),D(ne,`${i().psR??""} ▶`)}),S(z,V)};q(Se,z=>{var V;(V=i().status.monsterCategories)!=null&&V.includes("Pendulum")&&z(ye)})}var w=_(Se,2);{var $=z=>{var V=Hu();S(z,V)};q(w,z=>{i().kind==="Spell"&&i().isPendulumScale&&z($)})}var j=_(w,2);{var te=z=>{var V=ju(),P=I(V),A=h(P),Q=h(A),ne=_(P,2),O=_(h(ne),2),G=h(O),ue=h(G),Ce=_(G,2),fe=h(Ce);M((pe,ce)=>{D(Q,`${pe??""}
            ${ce??""}`),De(G,Si(i().atk!==i().origin.attack?"different_from_its_origin":""),"svelte-14cfp8z"),D(ue,i().atk??"?"),De(Ce,Si(i().def!==i().origin.defense?"different_from_its_origin":""),"svelte-14cfp8z"),D(fe,i().def??"?")},[()=>i().types.map(pe=>sr[pe]+(s()?Ur[pe]:"")).join(),()=>{var pe;return(pe=i().status.monsterCategories)==null?void 0:pe.map(ce=>rr[ce]+(s()?Zr[ce]:"")).join()}],Te),S(z,V)};q(j,z=>{i().kind==="Monster"&&z(te)})}M(z=>{De(W,`duel_card button_style_reset ${i().origin.kind??""} ${z??""} ${(u(v)?"duel_card_selected":"")??""} ${r()??""} duel_card_${i().orientation??""} ${(u(C)?"isDragging":"")??""} ${(s()?"duel_card_wide":"")??""} duel_card_${i().face??""} ${(i().isOnField?"duel_card_is_on_field":"")??""} svelte-14cfp8z`),Vt(W,"draggable",r()==="Draggable"),Vt(W,"title",i().nm),D(x,i().nm)},[()=>{var z;return((z=i().status.monsterCategories)==null?void 0:z.join(" "))||""}],Te),Me("dragstart",W,E),Me("dragend",W,F),Me("click",W,k),Me("dblclick",W,g),Me("mouseenter",W,()=>T()),Me("contextmenu",W,Z),S(K,W)},ie=K=>{var W=Ne(),Re=I(W);{var Y=x=>{var U=Uu();M(()=>De(U,`duel_card duel_card_face_down duel_card_face_down_defense ${r()??""}  ${(u(v)?"duel_card_selected":"")??""} svelte-14cfp8z`)),Me("click",U,k),Me("dblclick",U,g),S(x,U)},R=x=>{var U=Gu();S(x,U)};q(Re,x=>{i().battlePosition==="Set"?x(Y):x(R,!1)},!0)}S(K,W)};q(J,K=>{i().face==="FaceUp"||n()||i().controller.duelistType==="Player"&&i().isUnderControl?K(N):K(ie,!1)})}S(e,ee),ct()}var zu=b('<div class="phase_display svelte-1mv96a1"><span class="svelte-1mv96a1"> </span> </div>'),Vu=b('<div class="lifepoint_display svelte-1mv96a1"><div class="svelte-1mv96a1"> </div> <div class="svelte-1mv96a1"> </div></div>'),Wu=(e,t,i)=>t(u(i)),Yu=b('<div class="svelte-1mv96a1"><button class="phase_button svelte-1mv96a1"> </button></div>'),Qu=b("<div><!></div>"),Ku=b('<div class="svelte-1mv96a1"><!></div>'),Xu=b("<div><!></div>"),Ju=b("<!> <!> <!>",1),Iu=b('<div style="position: absolute;" class="card_animation_receiver svelte-1mv96a1"><!></div>'),ef=b('<div style="position: absolute; top:0rem" class="svelte-1mv96a1">｛効果対象｝</div>'),tf=b('<!> <div style="position: absolute; display:flex;justify-content: center;" class="svelte-1mv96a1"><!></div>',1),rf=b(" <!> 】",1),af=b('<div style="position: absolute; bottom:0rem" class="svelte-1mv96a1"> <!></div>'),nf=b("<!> <!>",1),sf=b('<div class="badge svelte-1mv96a1"> </div>'),lf=b('<div class="card_animation_receiver svelte-1mv96a1"><!></div>'),of=b("<!> <!> <!> <!>",1),cf=b('<td><div role="listitem"><!></div></td>');function df(e,t){ot(t,!1);let i=qe(t,"view",8),r=qe(t,"row",8),a=qe(t,"column",8),n=qe(t,"selectedEntities",28,()=>[]),s=qe(t,"selectedCells",28,()=>[]),l=Pe(i().getCell(r(),a()));const d=()=>{L(l,i().getCell(r(),a()))};u(l).onUpdate.append(d),i().onDuelUpdate.append(d),i().modalController.onUpdate.append(d);let o,f=Pe([]),v=()=>console.log("hoge"),p,y=Pe([]),m=Pe(!1),C=Pe(!1),g=!1;const T=w=>{var $,j;L(ie,[]),n().reset(),o=w.activator,v=w.resolve,L(f,w.dummyActionInfos),L(y,w.chainBlockInfos.flatMap(te=>te.selectedEntities).getDistinct()),p=w.entitiesChoices,L(m,!1),L(C,(($=w.cellsChoices)==null?void 0:$.selectables.includes(u(l)))??!1),g=u(C)&&((j=w.cellsChoices)==null?void 0:j.qty)===1};i().onWaitStart.append(T);const k=()=>{o=void 0,L(f,[]),v=()=>{console.log("hoge")},p=void 0,L(y,[]),L(m,!1),L(C,!1),g=!1};i().onWaitEnd.append(k);let E=Pe(!1),F=[];const Z=w=>{F=w.filter($=>$.dests.includes(u(l))),L(E,F.length>0),d()},ee=()=>{F=[],L(E,!1),d()};i().onDragStart.append(Z),i().onDragEnd.append(ee);const[J,N]=hv;let ie=Pe([]);const K=w=>{if(o=void 0,u(l)===w.to||u(l).entities.includes(w.entity)){L(ie,[...u(ie),w]);const $=w.resolve;L(l,u(l)),setTimeout(()=>{L(ie,u(ie).filter(j=>j!==w)),w.count++,w.count>1&&$()},600)}};i().onAnimation.append(K);const W=w=>{v({phaseChange:w})},Re=()=>u(l).isStackCell&&u(l).entities.flatMap(w=>w.actions).filter(w=>u(f).map($=>$.action.seq).some($=>$===w.seq)).length>0,Y=()=>{if(Ye(l,u(l).field.duel.view.infoBoardState="Log"),g)v({selectedCells:[u(l)]});else if(u(C))L(m,!u(m)),s(u(m)?[...s(),u(l)]:s().filter(w=>w!==u(l)));else if(u(l).isStackCell){Ye(l,u(l).field.duel.view.infoBoardState="CellInfo"),Ye(l,u(l).field.duel.view.infoBoardCell=u(l)),u(l).field.duel.view.requireUpdate();const w=u(l).entities.flatMap(j=>j.actions).map(j=>j.seq),$=u(f).filter(j=>w.includes(j.action.seq));if($.length){if(!o)return;u(l).field.duel.view.modalController.actionSelector.show({title:"カードを選択。",activator:o,dummyActionInfos:$,cancelable:!0}).then(te=>{te&&v({actionInfo:te})});return}}u(l).field.duel.view.requireUpdate(),console.info(u(l))},R=w=>{w.preventDefault(),w.dataTransfer&&(w.dataTransfer.dropEffect="move")},x=w=>{w.preventDefault(),console.info("drop",w,u(E),F),w.dataTransfer&&(w.dataTransfer.dropEffect="move");try{if(u(E)&&F){if(F.length===1){const $=F[0];console.log(v,{actionInfo:{...$,dest:u(l)}}),v({actionInfo:{...$,dest:u(l)}})}else if(F.length>1){if(!o)throw new se("想定されない状態");u(l).field.duel.view.modalController.terminateAll(),u(l).field.duel.view.modalController.actionSelector.show({title:"選択",activator:o,dummyActionInfos:F.map($=>({...$,dest:u(l)})),cancelable:!1}).then($=>{v({actionInfo:$})})}}}finally{i().removeDraggingActions()}},U=(...w)=>{if(i().waitMode==="Animation")return"Disabled";if(p&&p.selectables.find(j=>w.find(te=>j===te)))return"Selectable";if(!u(f)||u(f).length===0||i().waitMode!=="Free"||Object.values(i().modalController.modals).some(j=>j.state==="Shown"))return"Disabled";const $=u(f).filter(j=>w.includes(j.action.entity));return $.length===0?"Disabled":u(l).isStackCell||$[0].action.entity!==w[0]?"Clickable":$.some(j=>j.dests.length)?"Draggable":"Clickable"};St();var X=cf(),re=h(X);re.__click=Y;var me=h(re);{var Se=w=>{var $=Ne(),j=I($);{var te=z=>{var V=Ne(),P=I(V);{var A=ne=>{var O=zu(),G=h(O),ue=h(G),Ce=_(G,1,!0);M((fe,pe)=>{D(ue,fe),D(Ce,pe)},[()=>String(u(l).field.duel.clock.turn).padStart(2,"0"),()=>u(l).field.duel.phase.toUpperCase()],Te),S(ne,O)},Q=ne=>{var O=Ne(),G=I(O);{var ue=fe=>{var pe=Vu(),ce=h(pe),ze=h(ce),Ve=_(ce,2),tt=h(Ve);M(()=>{D(ze,u(l).field.duel.duelists.Above.lp),D(tt,u(l).field.duel.duelists.Below.lp)}),S(fe,pe)},Ce=fe=>{var pe=Ne(),ce=I(pe);{var ze=Ve=>{var tt=Ne(),mt=I(tt);{var at=Qe=>{var nt=Ne(),Be=I(nt);{var Oe=Ee=>{var de=Ne(),he=I(de);oe(he,1,()=>i().duel.nextPhaseList,le,(He,We)=>{var Ke=Yu(),Ct=h(Ke);Ct.__click=[Wu,W,We];var B=h(Ct);M(H=>D(B,H),[()=>u(We).toUpperCase()],Te),S(He,Ke)}),S(Ee,de)};q(Be,Ee=>{i().duel.isEnded||Ee(Oe)})}S(Qe,nt)};q(mt,Qe=>{i().waitMode==="Free"&&Qe(at)})}S(Ve,tt)};q(ce,Ve=>{u(l).column===5&&Ve(ze)},!0)}S(fe,pe)};q(G,fe=>{u(l).column===3?fe(ue):fe(Ce,!1)},!0)}S(ne,O)};q(P,ne=>{u(l).column===1?ne(A):ne(Q,!1)})}S(z,V)};q(j,z=>{u(l).row===3&&z(te)})}S(w,$)},ye=w=>{var $=Ne(),j=I($);{var te=V=>{var P=Ju();const A=Te(()=>u(ie).find(Ce=>Ce.to===u(l)));var Q=I(P);{var ne=Ce=>{var fe=Qu(),pe=h(fe);Zt(pe,{get entity(){return u(A).entity},state:"Disabled",dummyActionInfos:[],cardActionResolve:void 0}),M(()=>De(fe,`card_animation_receiver ${u(l).cellType??""} svelte-1mv96a1`)),ni(1,fe,()=>N,()=>({key:u(A).entity.seq})),S(Ce,fe)};q(Q,Ce=>{u(A)&&u(A).index==="Top"&&Ce(ne)})}var O=_(Q,2);oe(O,1,()=>u(l).visibleEntities,le,(Ce,fe)=>{var pe=Ne(),ce=I(pe);{var ze=Ve=>{var tt=Ku(),mt=h(tt);const at=Te(()=>U(u(fe))),Qe=Te(()=>u(f).filter(nt=>nt.action.entity===u(fe)));Zt(mt,{get entity(){return u(fe)},get state(){return u(at)},get dummyActionInfos(){return u(Qe)},cardActionResolve:void 0,get selectedList(){return n()},set selectedList(nt){n(nt)},$$legacy:!0}),ni(2,tt,()=>J,()=>({key:u(fe).seq})),S(Ve,tt)};q(ce,Ve=>{u(ie).every(tt=>tt.entity.seq!==u(fe).seq)&&Ve(ze)})}S(Ce,pe)});var G=_(O,2);{var ue=Ce=>{var fe=Xu(),pe=h(fe);Zt(pe,{get entity(){return u(A).entity},state:"Disabled",dummyActionInfos:[],cardActionResolve:void 0}),M(()=>De(fe,`card_animation_receiver ${u(l).cellType??""} svelte-1mv96a1`)),ni(1,fe,()=>N,()=>({key:u(A).entity.seq})),S(Ce,fe)};q(G,Ce=>{u(A)&&u(A).index!=="Top"&&Ce(ue)})}S(V,P)},z=V=>{var P=of();const A=Te(()=>u(ie).find(ce=>ce.to===u(l)));var Q=I(P);{var ne=ce=>{var ze=Iu(),Ve=h(ze);Zt(Ve,{get entity(){return u(A).entity},state:"Disabled",dummyActionInfos:[],cardActionResolve:void 0}),ni(1,ze,()=>N,()=>({key:u(A).entity.seq})),S(ce,ze)};q(Q,ce=>{u(A)&&u(A).index!=="Top"&&ce(ne)})}var O=_(Q,2);{var G=ce=>{var ze=nf(),Ve=I(ze);oe(Ve,1,()=>u(l).visibleEntities.map((at,Qe)=>({index:Qe,entity:at})).toReversed(),le,(at,Qe)=>{var nt=Ne(),Be=I(nt);{var Oe=Ee=>{var de=tf(),he=I(de);{var He=H=>{var $e=ef();S(H,$e)};q(he,H=>{u(y).includes(u(Qe).entity)&&H(He)})}var We=_(he,2),Ke=h(We);const Ct=Te(()=>!u(l).isStackCell&&u(Qe).index===0?U(...u(l).visibleEntities):void 0),B=Te(()=>u(Qe).index===0?u(f).filter(H=>u(l).visibleEntities.includes(H.action.entity)):void 0);Zt(Ke,{get entity(){return u(Qe).entity},get state(){return u(Ct)},get dummyActionInfos(){return u(B)},cardActionResolve:void 0,get selectedList(){return n()},set selectedList(H){n(H)},$$legacy:!0}),ni(2,We,()=>J,()=>({key:u(Qe).entity.seq})),S(Ee,de)};q(Be,Ee=>{u(ie).every(de=>de.entity.seq!==u(Qe).entity.seq)&&Ee(Oe)})}S(at,nt)});var tt=_(Ve,2);{var mt=at=>{var Qe=af(),nt=h(Qe),Be=_(nt);oe(Be,1,()=>Object.keys(u(l).visibleEntities[0].status.maxCounterQty),le,(Oe,Ee)=>{var de=rf(),he=I(de),He=_(he);{var We=Ke=>{var Ct=ai();M(()=>D(Ct,`/${u(l).visibleEntities[0].status.maxCounterQty[u(Ee)]??""}`)),S(Ke,Ct)};q(He,Ke=>{(u(l).visibleEntities[0].status.maxCounterQty[u(Ee)]??!1)&&Ke(We)})}M(Ke=>D(he,`【
              ${Fc[u(Ee)]??""}${Ke??""} `),[()=>u(l).visibleEntities[0].counterHolder.getQty(u(Ee))],Te),S(Oe,de)}),M(()=>D(nt,`【${u(l).visibleEntities[0].battlePositionName??""}】 `)),S(at,Qe)};q(tt,at=>{u(l).visibleEntities[0].battlePosition&&at(mt)})}S(ce,ze)};q(O,ce=>{u(l).visibleEntities.length>0&&ce(G)})}var ue=_(O,2);{var Ce=ce=>{var ze=sf(),Ve=h(ze);M(()=>D(Ve,u(l).visibleEntities.length)),S(ce,ze)};q(ue,ce=>{u(l).isStackCell&&ce(Ce)})}var fe=_(ue,2);{var pe=ce=>{var ze=lf(),Ve=h(ze);Zt(Ve,{get entity(){return u(A).entity},state:"Disabled",dummyActionInfos:[],cardActionResolve:void 0}),ni(1,ze,()=>N,()=>({key:u(A).entity.seq})),S(ce,ze)};q(fe,ce=>{u(A)&&u(A).index==="Top"&&ce(pe)})}S(V,P)};q(j,V=>{u(l).cellType==="Hand"?V(te):V(z,!1)},!0)}S(w,$)};q(me,w=>{u(l).isDisabledCell?w(Se):w(ye,!1)})}M(w=>{De(X,`${`duel_field_cell duel_field_cell_${u(l).cellType} ${u(l).linkArrowSources.length===0?"":"duel_field_cell_linked"}`??""} svelte-1mv96a1`),Vt(X,"colspan",u(l).cellType==="Hand"?7:1),De(re,`${w??""} svelte-1mv96a1`)},[()=>`duel_card_wrapper ${u(l).cellType} ${u(E)?"can_accept_drop":""} ${Re()?"can_action":""} ${u(m)?"is_selected":u(C)?"is_selectable":""} `],Te),Me("dragover",re,R),Me("drop",re,x),S(e,X),ct()}qi(["click"]);var uf=b('<div class="title svelte-1sjjr5s"> </div>'),ff=b('<div class="title svelte-1sjjr5s"> </div>'),vf=b('<div class="duel_log_record svelte-1sjjr5s"> </div>'),pf=b('<div><div style=" white-space: nowrap;text-align: center;"> </div> <!></div>'),hf=b("<div><!> <!></div>"),gf=b("<div><!> <!></div>"),yf=b('<div class="duel_log svelte-1sjjr5s"><div class="duel_log_header svelte-1sjjr5s"></div> <div class="duel_log_body svelte-1sjjr5s"></div> <div class="duel_log_footer svelte-1sjjr5s"></div></div>');function _f(e,t){ot(t,!1);let i=Pe(void 0),r=qe(t,"log",8),a,n=Pe([]);const s=()=>{const f=((a==null?void 0:a.seq)??-1)+1;r().records.slice(f).forEach(v=>{if(!a){L(n,[[[[v]]]]),a=v;return}if(!u(n)[v.clock.turn]){Ye(n,u(n)[v.clock.turn]=[[[v]]]),a=v;return}if(!u(n)[v.clock.turn][v.clock.phaseSeq]){Ye(n,u(n)[v.clock.turn][v.clock.phaseSeq]=[[v]]),a=v;return}if(a.clock.chainSeq===v.clock.chainSeq&&a.clock.chainBlockSeq===v.clock.chainBlockSeq&&a.duelist===v.duelist){u(n)[v.clock.turn][v.clock.phaseSeq].slice(-1)[0].push(v),a=v;return}u(n)[v.clock.turn][v.clock.phaseSeq].push([v]),a=v}),L(n,u(n)),Fo().then(()=>u(i)&&u(i).scroll(0,u(i).clientHeight*990))};r().onUpdate.append(s),r().duel.view.onDuelUpdate.append(s),St();var l=Ne(),d=I(l);{var o=f=>{var v=yf(),p=_(h(v),2);oe(p,5,()=>u(n),le,(y,m)=>{var C=gf(),g=h(C);{var T=E=>{var F=uf(),Z=h(F);M(()=>D(Z,`ターン：${u(m)[0][0][0].clock.turn??""}`)),S(E,F)};q(g,E=>{u(m)[0][0][0].clock.turn>0&&E(T)})}var k=_(g,2);oe(k,1,()=>u(m),le,(E,F)=>{var Z=hf(),ee=h(Z);{var J=ie=>{var K=ff(),W=h(K);M(()=>D(W,u(F)[0][0].clock.period.name)),S(ie,K)};q(ee,ie=>{u(F)[0][0].clock.turn>0&&ie(J)})}var N=_(ee,2);oe(N,1,()=>u(F),le,(ie,K)=>{var W=pf(),Re=h(W),Y=h(Re),R=_(Re,2);oe(R,1,()=>u(K),le,(x,U)=>{var X=vf(),re=h(X);M(()=>D(re,u(U).text)),S(x,X)}),M(()=>{var x,U,X;De(W,`duel_log_block_duelist duel_log_block_duelist_${((x=u(K)[0].duelist)==null?void 0:x.seat)??"system"} svelte-1sjjr5s`),De(Re,`duelist ${((U=u(K)[0].duelist)==null?void 0:U.seat)??""} svelte-1sjjr5s`),D(Y,((X=u(K)[0].duelist)==null?void 0:X.profile.name)||"SYSTEM")}),S(ie,W)}),M(()=>De(Z,`duel_log_block_phase duel_log_block_phase_${u(F)[0][0].clock.period.key??""} svelte-1sjjr5s`)),S(E,Z)}),M(()=>De(C,`duel_log_block_turn duel_log_block_turn_${u(m)[0][0][0].clock.turn??""} svelte-1sjjr5s`)),S(y,C)}),nc(p,y=>L(i,y),()=>u(i)),S(f,v)};q(d,f=>{r().duel.view.infoBoardState==="Log"&&f(o)})}S(e,l),ct()}var mf=b('<div><div class="duelist_name svelte-1u7codf"> </div> <div> </div></div>');function wn(e,t){ot(t,!1);let i=qe(t,"duelist",12),r=Pe(0),a=Pe();const n=async()=>{const p=i().lp-u(r);if(!u(a)||Math.abs(p)<10){L(r,i().lp),u(a)&&(u(a)(),L(a,void 0));return}L(r,u(r)+Math.floor(Math.random()*p)),await Ds(100),n()},s=()=>{i(i()),!u(a)&&i().lp!==u(r)&&new Promise(p=>{L(a,p),Math.abs(i().lp-u(r)),n()})};i().duel.log.onUpdate.append(s),n(),St();var l=mf(),d=h(l),o=h(d),f=_(d,2),v=h(f);M(()=>{De(l,`duelist ${i().seat??""} svelte-1u7codf`),D(o,i().profile.name),De(f,`duelist_lp ${(u(a)?"vibration":"")??""} svelte-1u7codf`),D(v,u(r))}),S(e,l),ct()}const Sf=(e,t,i)=>{t.resolve(u(i))};var Cf=b("<div><!></div>"),bf=b("<div></div>"),kf=(e,t)=>t.resolve(void 0),Tf=b('<button class="svelte-ynkuoo">Cancel</button>'),wf=b('<div class="modal_window svelte-ynkuoo"><div> </div> <!> <div><button class="svelte-ynkuoo">OK</button> <!></div></div>');function Ef(e,t){ot(t,!0);let i=vo(Xt([])),r=t.args.chainBlockInfos.flatMap(l=>l.selectedEntities).getDistinct();var a=Ne(),n=I(a);{var s=l=>{var d=wf(),o=h(d),f=h(o),v=_(o,2);oe(v,17,()=>t.args.entitiesChoices.selectables.map(g=>g.controller.seat).getDistinct(),le,(g,T)=>{var k=bf();oe(k,21,()=>t.args.entitiesChoices.selectables.filter(E=>E.controller.seat===u(T)).toSorted(ws),le,(E,F)=>{var Z=Cf(),ee=h(Z);Zt(ee,{get entity(){return u(F)},isVisibleForcibly:!0,state:"Selectable",entitySelectResolve:J=>t.resolve(J),get qty(){return t.args.entitiesChoices.qty},cardActionResolve:void 0,get selectedList(){return u(i)},set selectedList(J){L(i,Xt(J))}}),M(J=>De(Z,`entities_list_item ${J??""} svelte-ynkuoo`),[()=>r.includes(u(F))?"effect_target":""]),S(E,Z)}),M(()=>De(k,`entities_list ${u(T)??""} svelte-ynkuoo`)),S(g,k)});var p=_(v,2),y=h(p);y.__click=[Sf,t,i];var m=_(y,2);{var C=g=>{var T=Tf();T.__click=[kf,t],S(g,T)};q(m,g=>{t.args.entitiesChoices.cancelable&&g(C)})}M(g=>{D(f,t.args.title),y.disabled=g},[()=>!t.args.entitiesChoices.validator(u(i))]),S(l,d)};q(n,l=>{l(s)})}S(e,a),ct()}qi(["click"]);var Df=b('<div class="duel_card_wrapper svelte-1k3dhp1"><!> <div> </div></div>'),Mf=(e,t)=>t()(),Af=b('<div><button class="cancel_button svelte-1k3dhp1">Cancel</button></div>'),Pf=b('<div class="modal_window svelte-1k3dhp1"><div> </div> <div class="flex svelte-1k3dhp1" style="display: flex;"></div> <!></div>');function xf(e,t){ot(t,!1);let i=qe(t,"view",8),r=qe(t,"args",8),a=qe(t,"resolve",8),n=sc(!1);const s=()=>n.set(!0),l=()=>n.set(!1);i().onDragStart.append(s),i().onDragEnd.append(l),St();var d=Ne(),o=I(d);{var f=v=>{var p=Pf(),y=h(p),m=h(y),C=_(y,2);oe(C,5,()=>r().dummyActionInfos,le,(k,E)=>{var F=Df(),Z=h(F);const ee=Te(()=>u(E).dests.length?"Draggable":"Clickable"),J=Te(()=>r().dragAndDropOnly?[]:[u(E)]);Zt(Z,{get entity(){return u(E).action.entity},isVisibleForcibly:!0,get state(){return u(ee)},get dummyActionInfos(){return u(J)},get cardActionResolve(){return a()}});var N=_(Z,2),ie=h(N);M(()=>D(ie,`«${u(E).action.title??""}»`)),S(k,F)});var g=_(C,2);{var T=k=>{var E=Af(),F=h(E);F.__click=[Mf,a],S(k,E)};q(g,k=>{r().cancelable&&k(T)})}M(()=>D(m,r().title)),S(v,p)};q(o,v=>{v(f)})}S(e,d),ct()}qi(["click"]);var Ff=(e,t,i)=>t()(i()),Bf=b('<li><button class="svelte-1w70c2f"> </button></li>'),Of=(e,t)=>t()(void 0),Lf=b('<button class="svelte-1w70c2f">Cancel</button>'),Nf=b('<div class="modal_window svelte-1w70c2f"><div class="svelte-1w70c2f"> </div> <ui class="text_list svelte-1w70c2f"></ui> <!></div>');function qf(e,t){ot(t,!1);let i=qe(t,"arg",8),r=qe(t,"resolve",8);St();var a=Ne(),n=I(a);{var s=l=>{var d=Nf(),o=h(d),f=h(o),v=_(o,2);oe(v,5,()=>i().choises,le,(m,C)=>{let g=()=>u(C).seq,T=()=>u(C).text;var k=Bf(),E=h(k);E.__click=[Ff,r,g];var F=h(E);M(()=>{De(k,`text_item ${g()??""} svelte-1w70c2f`),D(F,T())}),S(m,k)});var p=_(v,2);{var y=m=>{var C=Lf();C.__click=[Of,r],S(m,C)};q(p,m=>{i().cancelable&&m(y)})}M(()=>D(f,i().title)),S(l,d)};q(n,l=>{l(s)})}S(e,a),ct()}qi(["click"]);const Rf=(e,t)=>{t().modals.forEach(i=>i.cancel())};var $f=b('<button class="overlay svelte-5wiqd8">☆</button> <!> <!> <!>',1),Hf=b('<div class="base svelte-5wiqd8"><!></div>');function jf(e,t){var l,d;ot(t,!1);let i=qe(t,"modalController",12);const r=()=>{i(i())};(d=(l=i())==null?void 0:l.onUpdate)==null||d.append(r),St();var a=Hf(),n=h(a);{var s=o=>{var f=$f(),v=I(f);v.__click=[Rf,i];var p=_(v,2);{var y=k=>{Ef(k,{get args(){return i().entitySelector.args},get resolve(){return i().entitySelector.resolve}})};q(p,k=>{i().entitySelector.state==="Shown"&&k(y)})}var m=_(p,2);{var C=k=>{xf(k,{get view(){return i().view},get args(){return i().actionSelector.args},get resolve(){return i().actionSelector.resolve}})};q(m,k=>{i().actionSelector.state==="Shown"&&k(C)})}var g=_(m,2);{var T=k=>{qf(k,{get arg(){return i().textSelector.args},get resolve(){return i().textSelector.resolve}})};q(g,k=>{i().textSelector.state==="Shown"&&k(T)})}S(o,f)};q(n,o=>{i().modals.some(f=>f.state==="Shown")&&o(s)})}S(e,a),ct()}qi(["click"]);const Zf=(e,t)=>(t(t()==="Normal"?"Debug":"Normal"),!0);var Uf=b('<div class="duel_card_info_row svelte-1qknre5"><div class="svelte-1qknre5"><pre class="description svelte-1qknre5"> </pre></div></div> <div class="duel_card_info_row svelte-1qknre5" style=" justify-content: space-between;"><div class="svelte-1qknre5"> </div> <div class="svelte-1qknre5"> </div></div>',1),Gf=b('<div></div> <div class="svelte-1qknre5"> </div>',1),zf=b("<div> </div>"),Vf=b("<div> </div>"),Wf=b('<div class="duel_card_info_row svelte-1qknre5"><!> <!></div> <div class="duel_card_info_row svelte-1qknre5"></div>',1),Yf=b('<div class="duel_card_row svelte-1qknre5"><div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"> </div></div>'),Qf=b('<div class="duel_card_row svelte-1qknre5"><div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"> </div></div>'),Kf=b("<!> <!>",1),Xf=b('<div class="duel_card_info_row svelte-1qknre5"><div class="svelte-1qknre5"><pre class="description svelte-1qknre5"> </pre></div></div>'),Jf=b('<div class="svelte-1qknre5"> </div>'),If=b('<div class="svelte-1qknre5"> </div>'),ev=b('<div class="svelte-1qknre5"> </div>'),tv=b('<div class="svelte-1qknre5"> </div>'),iv=b('<div class="svelte-1qknre5"> </div>'),rv=b('<div class="svelte-1qknre5"> </div>'),av=b('<div class="svelte-1qknre5"> </div>'),nv=b('<div class="svelte-1qknre5"> </div>'),sv=b('<div class="duel_card_info_row svelte-1qknre5"><div class="svelte-1qknre5"><div class="svelte-1qknre5"></div> <!> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"></div> <!> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"></div> <!> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"></div> <!> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"></div> <!> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"></div> <!> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"></div> <!> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"></div> <!> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"> </div> <div class="svelte-1qknre5"> </div> <div class="svelte-1qknre5"> </div> <div class="svelte-1qknre5"></div></div></div>'),lv=b('<div class="svelte-1qknre5">※テスト用カードです</div>'),ov=b('<div class="duel_card_info_links svelte-1qknre5"><a target="_blank" rel="noopener noreferrer" title="遊戯王カードWiki" class="svelte-1qknre5">⇒遊戯王カードWiki</a> <a target="_blank" rel="noopener noreferrer" title="コナミカードデータベース" class="svelte-1qknre5"> </a></div>'),cv=b('<div role="contentinfo"><div class="duel_card_info_header svelte-1qknre5"><div class="duel_card_info_row svelte-1qknre5"><div class="svelte-1qknre5"> </div></div> <div class="duel_card_info_row svelte-1qknre5" style="position:sticky; top:0;"><div class="svelte-1qknre5"> </div> <div class="svelte-1qknre5"> </div></div> <!></div> <div class="duel_card_info_body svelte-1qknre5"><!></div> <div class="duel_card_info_footer svelte-1qknre5"><!></div></div>');function dv(e,t){ot(t,!1);let i=qe(t,"entity",8,void 0);const r=()=>i()?ht[i().origin.name]:void 0,a=()=>{var o;return i()&&(i().origin.cardId??!1)?`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=2&cid=${i().origin.cardId}`:`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=1&sess=1&rp=10&mode=&sort=1&keyword=${(o=r())==null?void 0:o.name}&stype=1&ctype=&othercon=2&starfr=&starto=&pscalefr=&pscaleto=&linkmarkerfr=&linkmarkerto=&link_m=2&atkfr=&atkto=&deffr=&defto=&releaseDStart=1&releaseMStart=1&releaseYStart=1999&releaseDEnd=&releaseMEnd=&releaseYEnd=`};let n=qe(t,"mode",12,"Normal");St();var s=Ne(),l=I(s);{var d=o=>{var f=cv();f.__contextmenu=[Zf,n];var v=h(f),p=h(v),y=h(p),m=h(y),C=_(p,2),g=h(C),T=h(g),k=_(g,2),E=h(k),F=_(C,2);{var Z=R=>{var x=Kf(),U=I(x);{var X=ye=>{var w=Uf(),$=I(w),j=h($),te=h(j),z=h(te),V=_($,2),P=h(V),A=h(P),Q=_(P,2),ne=h(Q);M(()=>{D(z,ht[i().origin.name].pendulumDescription),D(A,`◀ ${i().psL??""}`),D(ne,`${i().psR??""} ▶`)}),S(ye,w)};q(U,ye=>{var w;(w=i().status.monsterCategories)!=null&&w.includes("Pendulum")&&ye(X)})}var re=_(U,2);{var me=ye=>{var w=Wf(),$=I(w),j=h($);oe(j,1,()=>i().attr,le,(V,P)=>{var A=Gf(),Q=I(A),ne=_(Q,2),O=h(ne);M(()=>{De(Q,`monster_attr ${u(P)??""} svelte-1qknre5`),D(O,`${qa[u(P)]??""}属性`)}),S(V,A)});var te=_(j,2);oe(te,1,()=>i().types,le,(V,P)=>{var A=zf(),Q=h(A);M(()=>{De(A,`monster_cat ${u(P)??""} svelte-1qknre5`),D(Q,`${sr[u(P)]??""}${Ur[u(P)]??""}族`)}),S(V,A)});var z=_($,2);oe(z,5,()=>i().status.monsterCategories??[],le,(V,P)=>{var A=Vf(),Q=h(A);M(()=>{De(A,`monster_cat ${u(P)??""} svelte-1qknre5`),D(Q,`${rr[u(P)]??""}${Zr[u(P)]??""}`)}),S(V,A)}),S(ye,w)},Se=ye=>{var w=Ne(),$=I(w);{var j=z=>{var V=Yf(),P=_(h(V),2),A=h(P);M(()=>D(A,`${ar[i().status.spellCategory]??""}魔法`)),S(z,V)},te=z=>{var V=Ne(),P=I(V);{var A=Q=>{var ne=Qf(),O=_(h(ne),2),G=h(O);M(()=>D(G,`${nr[i().status.trapCategory]??""}罠`)),S(Q,ne)};q(P,Q=>{i().kind==="Trap"&&i().status.trapCategory&&Q(A)},!0)}S(z,V)};q($,z=>{i().kind==="Spell"&&i().status.spellCategory?z(j):z(te,!1)},!0)}S(ye,w)};q(re,ye=>{i().kind==="Monster"?ye(me):ye(Se,!1)})}S(R,x)};q(F,R=>{n()==="Normal"&&R(Z)})}var ee=_(v,2),J=h(ee);{var N=R=>{var x=Xf(),U=h(x),X=h(U),re=h(X);M(me=>D(re,me),[()=>{var me;return(me=r())==null?void 0:me.description}],Te),S(R,x)},ie=R=>{var x=sv(),U=h(x),X=h(U);X.textContent='"info" :{';var re=_(X,2);oe(re,1,()=>Object.entries(i().info),le,(de,he)=>{let He=()=>u(he)[0],We=()=>u(he)[1];var Ke=Jf(),Ct=h(Ke);M(B=>D(Ct,`"${He()??""}" :${B??""},`),[()=>{var B;return(B=We())==null?void 0:B.toString()}],Te),S(de,Ke)});var me=_(re,2);me.textContent="},";var Se=_(me,2);Se.textContent='"status" :{';var ye=_(Se,2);oe(ye,1,()=>Object.entries(i().status),le,(de,he)=>{let He=()=>u(he)[0],We=()=>u(he)[1];var Ke=If(),Ct=h(Ke);M(B=>D(Ct,`"${He()??""}" :${B??""},`),[()=>{var B;return(B=We())==null?void 0:B.toString()}],Te),S(de,Ke)});var w=_(ye,2);w.textContent="},";var $=_(w,2);$.textContent='"actions" :[';var j=_($,2);oe(j,1,()=>i().actions,le,(de,he)=>{var He=ev(),We=h(He);M(()=>D(We,`"${u(he).playType??""} ${u(he).title??""}",`)),S(de,He)});var te=_(j,2);te.textContent="],";var z=_(te,2);z.textContent='"substituteEffects" :[';var V=_(z,2);oe(V,1,()=>i().substituteEffects,le,(de,he)=>{var He=tv(),We=h(He);M(()=>D(We,`"${u(he).title??""}",`)),S(de,He)});var P=_(V,2);P.textContent="],";var A=_(P,2);A.textContent='"continuousEffects" :[';var Q=_(A,2);oe(Q,1,()=>i().continuousEffects,le,(de,he)=>{var He=iv(),We=h(He);M(()=>D(We,`"${u(he).isStarted??""}",`)),S(de,He)});var ne=_(Q,2);ne.textContent="],";var O=_(ne,2);O.textContent='"procFilters" :[';var G=_(O,2);oe(G,1,()=>i().procFilterBundle.operators,le,(de,he)=>{var He=rv(),We=h(He);M(Ke=>D(We,`"${Ke??""} ${u(he).title??""}",`),[()=>u(he).isSpawnedBy.toString()],Te),S(de,He)});var ue=_(G,2);ue.textContent="],";var Ce=_(ue,2);Ce.textContent='"numericStateOperators" :[';var fe=_(Ce,2);oe(fe,1,()=>i().numericOprsBundle.operators,le,(de,he)=>{var He=av(),We=h(He);M(Ke=>D(We,`"${Ke??""} ${u(he).title??""}",`),[()=>u(he).isSpawnedBy.toString()],Te),S(de,He)});var pe=_(fe,2);pe.textContent="],";var ce=_(pe,2);ce.textContent='"stateOperators" :[';var ze=_(ce,2);oe(ze,1,()=>i().statusOperatorBundle.operators,le,(de,he)=>{var He=nv(),We=h(He);M(Ke=>D(We,`"${Ke??""} ${u(he).title??""}",`),[()=>u(he).isSpawnedBy.toString()],Te),S(de,He)});var Ve=_(ze,2);Ve.textContent="],";var tt=_(Ve,2);tt.textContent='"lastMoveLogRecord" :{';var mt=_(tt,2),at=h(mt),Qe=_(mt,2),nt=h(Qe),Be=_(Qe,2),Oe=h(Be),Ee=_(Be,2);Ee.textContent="},",M((de,he)=>{D(at,`"movedBy":"${de??""}",`),D(nt,`"movedAs":"${he??""}",`),D(Oe,`"movedAt":"${i().moveLog.latestRecord.movedAt.totalProcSeq??""}",`)},[()=>{var de;return(de=i().moveLog.latestRecord.movedBy)==null?void 0:de.toString()},()=>i().moveLog.latestRecord.movedAs.join(" ")],Te),S(R,x)};q(J,R=>{n()==="Normal"?R(N):R(ie,!1)})}var K=_(ee,2),W=h(K);{var Re=R=>{var x=lv();S(R,x)},Y=R=>{var x=ov(),U=h(x),X=_(U,2),re=h(X);M(me=>{var Se;Vt(U,"href",`https://yugioh-wiki.net/index.php?${i().origin.wikiEncodedName}`),Vt(X,"href",me),D(re,`⇒${((Se=i())!=null&&Se.origin.cardId?"公式カードページ":"公式で検索")??""}`)},[a],Te),S(R,x)};q(W,R=>{var x;(x=i())!=null&&x.origin.isForTest?R(Re):R(Y,!1)})}M((R,x,U)=>{De(f,`duel_card duel_card_info ${i().origin.kind??""} ${R??""} svelte-1qknre5`),D(m,i().nm),D(T,x),D(E,U)},[()=>{var R;return(R=i().origin.monsterCategories)==null?void 0:R.join(" ")},()=>"★".repeat(i().lvl||0),()=>"☆".repeat(i().rank||0)],Te),S(o,f)};q(l,o=>{i()&&o(d)})}S(e,s),ct()}qi(["contextmenu"]);var uv=b('<div class="duel_field_cell_info_item svelte-1xj7qf1"><!></div>'),fv=b('<div class="duel_field_cell_info_box svelte-1xj7qf1"><div class="duel_field_cell_info_label svelte-1xj7qf1"> </div> <!></div>'),vv=b('<div class="duel_field_cell_info svelte-1xj7qf1"><div class="duel_field_cell_info_header item_btn svelte-1xj7qf1"><div class="svelte-1xj7qf1"> </div> <div class="svelte-1xj7qf1"> </div></div> <div class="duel_field_cell_info_body svelte-1xj7qf1"></div></div>');function pv(e,t){ot(t,!1);let i=qe(t,"cell",12);const r=()=>{i(i())},a=d=>i().cardEntities.filter(o=>o.face===d);i().field.duel.view.onDuelUpdate.append(r),St();var n=Ne(),s=I(n);{var l=d=>{var o=vv(),f=h(o),v=h(f),p=h(v),y=_(v,2),m=h(y),C=_(f,2);oe(C,4,()=>["FaceUp","FaceDown"],le,(g,T)=>{var k=Ne(),E=I(k);{var F=Z=>{var ee=fv(),J=h(ee),N=h(J),ie=_(J,2);oe(ie,1,()=>a(T).toSorted(ws),le,(K,W)=>{var Re=uv(),Y=h(Re);const R=Te(()=>i().owner===i().field.duel.duelists.Below);Zt(Y,{get entity(){return u(W)},get isVisibleForcibly(){return u(R)},isWideMode:!0,cardActionResolve:void 0}),S(K,Re)}),M(()=>D(N,T==="FaceUp"?"表向き":"裏向き")),S(Z,ee)};q(E,Z=>{a(T).length&&Z(F)})}S(g,k)}),M(()=>{var g;D(p,(g=i().owner)==null?void 0:g.profile.name),D(m,i().cellType)}),S(d,o)};q(s,d=>{i().field.duel.view.infoBoardState==="CellInfo"&&d(l)})}S(e,n),ct()}const hv=Ou({duration:400});var gv=b('<div class="duel_field_header_message svelte-accyye"> </div> <div class="duel_field_header_buttons svelte-accyye"><button class="svelte-accyye">サレンダー</button></div>',1),yv=b("<tr></tr>"),_v=b('<table class="duel_field svelte-accyye"><tbody class="svelte-accyye"></tbody></table>'),mv=b('<button class="svelte-accyye">cancel</button>'),Sv=b('<button class="svelte-accyye">OK</button> <!>',1),Cv=b('<button class="svelte-accyye"> </button>'),bv=b('<div class="flex duel_desk svelte-accyye"><div class="duel_desk_left v_flex svelte-accyye"><!> <!> <!></div> <div class=" duel_desk_center v_flex svelte-accyye"><div class="duel_field_header svelte-accyye"><!></div> <div class="svelte-accyye"><!></div> <div class="duel_field_footer svelte-accyye"><!></div></div> <div class=" duel_desk_right svelte-accyye" style="text-align: left;"><!> <!></div></div> <div style="position:absolute;left:0;bottom:0"> </div> <!>',1);function kv(e,t){ot(t,!1);let i=qe(t,"duel",12),r=Pe([]),a=Pe([]),n=()=>{},s=Pe([]),l=Pe(),d=Pe(),o=Pe(()=>!1),f=Pe(!1);const v=P=>{n=P.resolve,L(s,P.dummyActionInfos.filter(A=>A.action.entity.entityType==="Duelist").filter(A=>A.action.entity.controller.seat==="Below")),L(l,void 0),L(d,void 0),L(a,[]),L(r,[]),L(f,!1),P.entitiesChoices&&(L(l,P.entitiesChoices),L(o,()=>{var A;return((A=P.entitiesChoices)==null?void 0:A.validator(u(r)))??!1}),L(f,P.entitiesChoices.cancelable),u(l).selectables.every(A=>A.fieldCell.isPlayFieldCell&&A.getIndexInCell()===0||A.fieldCell.cellType==="Hand"&&A.controller.duelistType==="Player"||A.entityType==="Duelist")||i().view.modalController.entitySelector.show({title:i().view.message,entitiesChoices:P.entitiesChoices,chainBlockInfos:P.chainBlockInfos,cancelable:P.entitiesChoices.cancelable}).then(A=>{n({selectedEntities:A})})),P.cellsChoices&&(L(d,P.cellsChoices),L(o,()=>{var A;return((A=P.cellsChoices)==null?void 0:A.validator(u(a)))??!1}),L(f,P.cellsChoices.cancelable))};i().view.onWaitStart.append(v);const p=()=>{n=()=>{},L(d,void 0),L(l,void 0),L(a,[]),L(r,[]),L(o,()=>!1),L(f,!1)};i().view.onWaitEnd.append(p);let y=Pe(void 0),m=Pe("Normal");const C=({card:P,mode:A})=>{L(y,P),L(m,A)};i().view.onShowCardEntity.append(C);const g=()=>{i(i())};i().view.onDuelUpdate.append(g),i().log.onUpdate.append(g);const T=()=>{u(l)&&u(l).validator(u(r))&&n({selectedEntities:u(r)}),u(d)&&u(d).validator(u(a))&&n({selectedCells:u(a)})},k=()=>{n({})},E=P=>{n({actionInfo:P})},F=()=>{n({surrender:!0})};i().main(),St();var Z=bv(),ee=I(Z),J=h(ee),N=h(J);wn(N,{get duelist(){return i().duelists.Above}});var ie=_(N,2);dv(ie,{get entity(){return u(y)},get mode(){return u(m)}});var K=_(ie,2);wn(K,{get duelist(){return i().duelists.Below}});var W=_(J,2),Re=h(W),Y=h(Re);{var R=P=>{var A=gv(),Q=I(A),ne=h(Q),O=_(Q,2),G=h(O);M(()=>D(ne,`[TURN:${i().clock.turn}][PHASE:${i().phase}] ${i().view.message}`)),Me("click",G,F),S(P,A)};q(Y,P=>{i().isEnded||P(R)})}var x=_(Re,2),U=h(x);{var X=P=>{var A=_v(),Q=h(A);oe(Q,5,()=>i().field.cells,le,(ne,O,G)=>{var ue=yv();De(ue,`${`duel_desk_row_${G}`??""} svelte-accyye`),oe(ue,5,()=>u(O),le,(Ce,fe,pe)=>{df(Ce,{get view(){return i().view},row:G,column:pe,get selectedEntities(){return u(r)},set selectedEntities(ce){L(r,ce)},get selectedCells(){return u(a)},set selectedCells(ce){L(a,ce)},$$legacy:!0})}),S(ne,ue)}),S(P,A)};q(U,P=>{i().clock.turn>0&&P(X)})}var re=_(x,2),me=h(re);{var Se=P=>{var A=Sv(),Q=I(A),ne=_(Q,2);{var O=G=>{var ue=mv();Me("click",ue,k),S(G,ue)};q(ne,G=>{u(f)&&G(O)})}M(G=>Q.disabled=G,[()=>!u(o)()],Te),Me("click",Q,T),S(P,A)},ye=P=>{var A=Ne(),Q=I(A);{var ne=O=>{var G=Ne(),ue=I(G);oe(ue,1,()=>u(s),le,(Ce,fe)=>{var pe=Cv(),ce=h(pe);M(()=>D(ce,u(fe).action.title)),Me("click",pe,()=>E(u(fe))),S(Ce,pe)}),S(O,G)};q(Q,O=>{u(s)&&u(s).length&&O(ne)},!0)}S(P,A)};q(me,P=>{u(l)&&u(l).selectables.length||u(d)&&u(d).selectables?P(Se):P(ye,!1)})}var w=_(W,2),$=h(w);_f($,{get log(){return i().log}});var j=_($,2);pv(j,{get cell(){return i().view.infoBoardCell}});var te=_(ee,2),z=h(te),V=_(te,2);jf(V,{get modalController(){return i().view.modalController}}),M(P=>D(z,P),[()=>i().clock.toString()],Te),S(e,Z),ct()}var Tv=b("<div></div>"),wv=b('<span> </span> / <span style="display: inline-block;width:2rem;text-align: right;"> </span>',1),Ev=b('<li class="deck_editor_item svelte-vivzk2"><div role="listitem"><div class="svelte-vivzk2"><div class="svelte-vivzk2"> </div> <div style="display:flex" class="svelte-vivzk2"><div class="svelte-vivzk2"><!> <!> <!> <!> <!> <!> <!></div> <div style="flex-grow: 1; width:0.1rem" class="svelte-vivzk2"></div> <div class="svelte-vivzk2"><!></div></div></div></div> <button class="button_style_reset svelte-vivzk2" title="※shiftキー同時押しで一括投入">+</button> <button class="button_style_reset svelte-vivzk2" title="※shiftキー同時押しで一括外し">-</button></li>'),Dv=b('<div class="deck_editor_card_kind svelte-vivzk2"><span class="svelte-vivzk2"> </span> <ul class="svelte-vivzk2"></ul></div>'),Mv=b('<div class="deck_editor_deck_type svelte-vivzk2"><span class="svelte-vivzk2"> </span> <!></div>'),Av=b('<div class="deck_editor_card_list svelte-vivzk2"></div>');function En(e,t){ot(t,!1);let i=qe(t,"allCardInfos",8),r=qe(t,"deckCardInfos",12),a=qe(t,"mode",8),n=qe(t,"onAttention",8);const s={Deck:["Monster","Spell","Trap"],ExtraDeck:["Monster"]},l=(v,p)=>(a()==="List"?i():r()).filter(y=>y.isImplemented).filter(y=>!p||y.kind===p).filter(y=>{var m,C;return!v||v==="Deck"&&!((m=y==null?void 0:y.monsterCategories)!=null&&m.union(xi).length)||v==="ExtraDeck"&&((C=y==null?void 0:y.monsterCategories)==null?void 0:C.union(xi).length)}),d=(v,p)=>{try{if(v.ctrlKey){r().push(p);return}const y=r().filter(C=>C.name===p.name).length;if(y>2)return;const m=v.shiftKey?3-y:1;if(m<1)return;r().push(...Array(m).fill(p))}finally{r().sort(Gi),r(r())}},o=(v,p)=>{let y=0;r(r().filter(m=>m.name!==p.name?!0:(y++,!v.shiftKey&&y>1))),r().sort(Gi)};St();var f=Av();oe(f,5,()=>dc,le,(v,p)=>{var y=Mv(),m=h(y),C=h(m),g=_(m,2);oe(g,1,()=>s[u(p)],le,(T,k)=>{var E=Dv(),F=h(E),Z=h(F),ee=_(F,2);oe(ee,5,()=>l(u(p),u(k)).toSorted(Gi),le,(J,N)=>{var ie=Ev(),K=h(ie),W=h(K),Re=h(W),Y=h(Re),R=_(Re,2),x=h(R),U=h(x);{var X=O=>{var G=ai();M(()=>D(G,`★${u(N).level??""}`)),S(O,G)};q(U,O=>{u(N).level&&O(X)})}var re=_(U,2);{var me=O=>{var G=ai();M(()=>D(G,`☆${u(N).rank??""}`)),S(O,G)};q(re,O=>{u(N).rank&&O(me)})}var Se=_(re,2);oe(Se,1,()=>u(N).attributes??[],le,(O,G)=>{var ue=Tv();M(()=>De(ue,`monster_attr ${u(G)??""} svelte-vivzk2`)),S(O,ue)});var ye=_(Se,2);oe(ye,1,()=>u(N).types??[],le,(O,G)=>{var ue=ai();M(()=>D(ue,sr[u(G)])),S(O,ue)});var w=_(ye,2);oe(w,1,()=>u(N).monsterCategories??[],le,(O,G)=>{var ue=ai();M(()=>D(ue,rr[u(G)])),S(O,ue)});var $=_(w,2);{var j=O=>{var G=ai();M(()=>D(G,`${ar[u(N).spellCategory]??""}魔法`)),S(O,G)};q($,O=>{u(N).spellCategory!==void 0&&O(j)})}var te=_($,2);{var z=O=>{var G=ai();M(()=>D(G,`${nr[u(N).trapCategory]??""}罠`)),S(O,G)};q(te,O=>{u(N).trapCategory!==void 0&&O(z)})}var V=_(x,4),P=h(V);{var A=O=>{var G=wv(),ue=I(G),Ce=h(ue),fe=_(ue,2),pe=h(fe);M(()=>{D(Ce,u(N).attack??"?"),D(pe,u(N).defense??"?")}),S(O,G)};q(P,O=>{u(N).kind==="Monster"&&O(A)})}var Q=_(K,2),ne=_(Q,2);M(O=>{De(K,`${O??""} svelte-vivzk2`),D(Y,u(N).name)},[()=>{var O,G;return`deck_editor_card duel_card ${u(N).kind} ${(G=(O=u(N))==null?void 0:O.monsterCategories)==null?void 0:G.join(" ")} ${u(N).isImplemented?"is_implemented":"is_not_implemented"}`}],Te),Me("mouseenter",K,()=>n()(u(N))),Me("click",Q,O=>d(O,u(N))),Me("click",ne,O=>o(O,u(N))),S(J,ie)}),M(J=>D(Z,`${us[u(k)]??""}（${J??""}枚）`),[()=>l(u(p),u(k)).length],Te),S(T,E)}),M(T=>D(C,`${uc[u(p)]??""}（${T??""}枚）`),[()=>l(u(p)).length],Te),S(v,y)}),S(e,f),ct()}var Pv=b('<div class="duel_card_info_row svelte-rccxcp"><div class="svelte-rccxcp"><pre class="description svelte-rccxcp"> </pre></div></div> <div class="duel_card_info_row svelte-rccxcp" style=" justify-content: space-between;"><div class="svelte-rccxcp"> </div> <div class="svelte-rccxcp"> </div></div>',1),xv=b('<div></div> <div class="svelte-rccxcp"> </div>',1),Fv=b("<div> </div>"),Bv=b("<div> </div>"),Ov=b('<div class="duel_card_info_row svelte-rccxcp"><!> <!></div> <div class="duel_card_info_row svelte-rccxcp"></div>',1),Lv=b('<div class="duel_card_row svelte-rccxcp"><div class="svelte-rccxcp"></div> <div class="svelte-rccxcp"> </div></div>'),Nv=b('<div class="duel_card_row svelte-rccxcp"><div class="svelte-rccxcp"></div> <div class="svelte-rccxcp"> </div></div>'),qv=b('<div class="duel_card_info_row svelte-rccxcp"><div class="svelte-rccxcp">※テスト用カードです</div></div>'),Rv=b('<div class="duel_card_info_links svelte-rccxcp"><a target="_blank" rel="noopener noreferrer" title="遊戯王カードWiki" class="svelte-rccxcp">⇒遊戯王カードWiki</a> <a target="_blank" rel="noopener noreferrer" title="コナミカードデータベース" class="svelte-rccxcp"> </a></div>'),$v=b('<div><div class="duel_card_info_header svelte-rccxcp"><div class="duel_card_info_row svelte-rccxcp"><div class="svelte-rccxcp"> </div></div> <div class="duel_card_info_row svelte-rccxcp" style="position:sticky; top:0;"><div class="svelte-rccxcp"> </div> <div class="svelte-rccxcp"> </div></div></div> <div class="duel_card_info_body svelte-rccxcp"><!> <!> <div class="duel_card_info_row description svelte-rccxcp"><div class="svelte-rccxcp"><pre class="description svelte-rccxcp"> </pre></div></div> <!></div></div>');function Hv(e,t){ot(t,!1);let i=qe(t,"cardInfo",8,void 0);const r=()=>i()?ht[i().name]:void 0;St();var a=Ne(),n=I(a);{var s=l=>{var d=$v(),o=h(d),f=h(o),v=h(f),p=h(v),y=_(f,2),m=h(y),C=h(m),g=_(m,2),T=h(g),k=_(o,2),E=h(k);{var F=x=>{var U=Pv(),X=I(U),re=h(X),me=h(re),Se=h(me),ye=_(X,2),w=h(ye),$=h(w),j=_(w,2),te=h(j);M(()=>{D(Se,ht[i().name].pendulumDescription),D($,`◀ ${i().pendulumScaleL??""}`),D(te,`${i().pendulumScaleR??""} ▶`)}),S(x,U)};q(E,x=>{var U;(U=i().monsterCategories)!=null&&U.includes("Pendulum")&&x(F)})}var Z=_(E,2);{var ee=x=>{var U=Ov(),X=I(U),re=h(X);{var me=$=>{var j=xv(),te=I(j),z=_(te,2),V=h(z);M(()=>{De(te,`monster_attr ${i().attributes[0]??""} svelte-rccxcp`),D(V,`${qa[i().attributes[0]]??""}属性`)}),S($,j)};q(re,$=>{i().attributes&&$(me)})}var Se=_(re,2);{var ye=$=>{var j=Fv(),te=h(j);M(()=>{De(j,`monster_cat ${i().types[0]??""} svelte-rccxcp`),D(te,`${sr[i().types[0]]??""}${Ur[i().types[0]]??""}族`)}),S($,j)};q(Se,$=>{i().types&&$(ye)})}var w=_(X,2);oe(w,5,()=>i().monsterCategories??[],le,($,j)=>{var te=Bv(),z=h(te);M(()=>{De(te,`monster_cat ${u(j)??""} svelte-rccxcp`),D(z,`${rr[u(j)]??""}${Zr[u(j)]??""}`)}),S($,te)}),S(x,U)},J=x=>{var U=Ne(),X=I(U);{var re=Se=>{var ye=Lv(),w=_(h(ye),2),$=h(w);M(()=>D($,`${ar[i().spellCategory]??""}魔法`)),S(Se,ye)},me=Se=>{var ye=Ne(),w=I(ye);{var $=j=>{var te=Nv(),z=_(h(te),2),V=h(z);M(()=>D(V,`${nr[i().trapCategory]??""}罠`)),S(j,te)};q(w,j=>{i().kind==="Trap"&&i().trapCategory&&j($)},!0)}S(Se,ye)};q(X,Se=>{i().kind==="Spell"&&i().spellCategory?Se(re):Se(me,!1)},!0)}S(x,U)};q(Z,x=>{i().kind==="Monster"?x(ee):x(J,!1)})}var N=_(Z,2),ie=h(N),K=h(ie),W=h(K),Re=_(N,2);{var Y=x=>{var U=qv();S(x,U)},R=x=>{var U=Rv(),X=h(U),re=_(X,2),me=h(re);M(Se=>{Vt(X,"href",`https://yugioh-wiki.net/index.php?${i().wikiEncodedName}`),Vt(re,"href",Se),D(me,`⇒${(i().cardId?"公式カードページ":"公式で検索")??""}`)},[()=>hc(i())],Te),S(x,U)};q(Re,x=>{i().isForTest?x(Y):x(R,!1)})}M((x,U,X,re)=>{De(d,`duel_card duel_card_info ${i().kind??""} ${x??""} svelte-rccxcp`),D(p,i().name),D(C,U),D(T,X),D(W,re)},[()=>{var x;return(x=i().monsterCategories)==null?void 0:x.join(" ")},()=>"★".repeat(i().level||0),()=>"☆".repeat(i().rank||0),()=>{var x;return(x=r())==null?void 0:x.description}],Te),S(l,d)};q(n,l=>{i()&&l(s)})}S(e,a),ct()}const jv={0:{aaa:"日",aaaa:"日曜日",ddd:"Sun",dddd:"Sunday"},1:{aaa:"月",aaaa:"月曜日",ddd:"Mon",dddd:"Monday"},2:{aaa:"火",aaaa:"火曜日",ddd:"Tue",dddd:"Tuesday"},3:{aaa:"水",aaaa:"水曜日",ddd:"Wed",dddd:"Wednesday"},4:{aaa:"木",aaaa:"木曜日",ddd:"Thu",dddd:"Thursday"},5:{aaa:"金",aaaa:"金曜日",ddd:"Fri",dddd:"Friday"},6:{aaa:"土",aaaa:"土曜日",ddd:"Sat",dddd:"Saturday"}};class Zv{constructor(){c(this,"DefaultSeparator1","/");c(this,"DefaultSeparator2"," ");c(this,"DefaultSeparator3",":");c(this,"createDate",t=>{if(!t)return;const i=new Date(t);if(!isNaN(i.getTime()))return i});c(this,"createDateOr",(t,i)=>this.createDate(t)||i||new Date);c(this,"truncateDate",t=>{const i=t||new Date;return new Date(i.getFullYear(),i.getMonth(),i.getDate())});c(this,"addDate",(t,i)=>{const r=this.createDateOr(t);return r.setDate(r.getDate()+i),r});c(this,"addMonth",(t,i)=>{const r=this.createDateOr(t);return r.setMonth(r.getMonth()+i),r});c(this,"addYear",(t,i)=>{const r=this.createDateOr(t);return r.setFullYear(r.getFullYear()+i),r});c(this,"getDayOfWeek",(t,i="dddd")=>{const r=this.createDate(t);return r?jv[r.getDay()][i]:""});c(this,"formatToYYYYMMDD",(t,i=this.DefaultSeparator1)=>{const r=this.createDate(t);if(!r)return"";const a=r.getFullYear().toString(),n=("0"+(r.getMonth()+1)).slice(-2),s=("0"+r.getDate()).slice(-2);return a+i+n+i+s});c(this,"formatToYYYYMM",(t,i=this.DefaultSeparator1)=>{const r=this.createDate(t);if(!r)return"";i||(i="");const a=r.getFullYear().toString(),n=("0"+(r.getMonth()+1)).slice(-2);return a+i+n});c(this,"formatToHHMMSS",(t,i=this.DefaultSeparator3)=>{const r=this.createDate(t);if(!r)return"";i||(i="");const a=r.getHours(),n=r.getMinutes(),s=r.getSeconds();return("0"+a).slice(-2)+i+("0"+n).slice(-2)+i+("0"+s).slice(-2)});c(this,"formatToHHMM",(t,i=this.DefaultSeparator3)=>{const r=this.createDate(t);if(!r)return"";i||(i="");const a=("0"+r.getHours()).slice(-2),n=("0"+r.getMinutes()).slice(-2);return a+i+n});c(this,"formatToYYYYMMDD_HHMM",(t,i=this.DefaultSeparator1,r=this.DefaultSeparator2,a=this.DefaultSeparator3)=>{const n=this.createDate(t);return n?this.formatToYYYYMMDD(n,i)+r+this.formatToHHMM(n,a):""});c(this,"formatToYYYYMMDD_HHMMSS",(t,i=this.DefaultSeparator1,r=this.DefaultSeparator2,a=this.DefaultSeparator3)=>{const n=this.createDate(t);return n?this.formatToYYYYMMDD(n,i)+r+this.formatToHHMMSS(n,a):""})}}const Pt=new Zv;Date.prototype.truncateDate=function(){return Pt.truncateDate(this)};Date.prototype.getCloneOr=function(e){return Pt.createDateOr(this,e)};Date.prototype.addDate=function(e){return Pt.addDate(this,e)};Date.prototype.addMonth=function(e){return Pt.addDate(this,e)};Date.prototype.addYear=function(e){return Pt.addDate(this,e)};Date.prototype.getDayOfWeek=function(e="dddd"){return Pt.getDayOfWeek(this,e)};Date.prototype.formatToYYYYMM=function(e){return Pt.formatToYYYYMM(this,e)};Date.prototype.formatToYYYYMMDD=function(e){return Pt.formatToYYYYMMDD(this,e)};Date.prototype.formatToYYYYMMDD_HHMM=function(e,t,i){return Pt.formatToYYYYMMDD_HHMM(this,e,t,i)};Date.prototype.formatToYYYYMMDD_HHMMSS=function(e,t,i){return Pt.formatToYYYYMMDD_HHMMSS(this,e,t,i)};Date.prototype.formatToHHMM=function(e){return Pt.formatToHHMM(this,e)};Date.prototype.formatToHHMMSS=function(e){return Pt.formatToHHMMSS(this,e)};String.prototype.format=(e,...t)=>{for(const[i,r]of t.entries()){const a=new RegExp(`\\{${i}\\}`,"g");e=e.replace(a,r)}return e};var Uv=b('<label><input type="checkbox"> </label>'),Gv=b('<label><input type="checkbox"> </label>'),zv=b('<label><input type="checkbox"> <div style="display: inline-block;"></div> </label>'),Vv=b('<label><input type="checkbox"> </label>'),Wv=b('<label><input type="checkbox"> </label>'),Yv=b('<label><input type="checkbox"> </label>'),Qv=b("<option> </option>"),Kv=b('<div class="svelte-138s9ji"><a class="white_button svelte-138s9ji" download="SVS_DeckInfos.json">ダウンロード</a></div>'),Xv=b('<div class="svelte-138s9ji"></div>'),Jv=b('<div class="svelte-138s9ji"><a class="white_button svelte-138s9ji" download="SVS_DeckInfos.json">ダウンロード（一括）</a></div>'),Iv=b('<div class="svelte-138s9ji"></div>'),ep=b('<div class="deck_editor_body_right_header svelte-138s9ji"><div class="deck_editor_body_right_header_row svelte-138s9ji"><div class="svelte-138s9ji">編集対象 <select></select></div> <div class="svelte-138s9ji"></div> <div class="svelte-138s9ji">新規名称 <input type="text"></div></div> <div class="deck_editor_body_right_header_row svelte-138s9ji"></div> <div class="deck_editor_body_right_header_row svelte-138s9ji"><div class="svelte-138s9ji">基本操作</div> <div class="svelte-138s9ji"><button class="white_button svelte-138s9ji">デッキを保存</button></div> <div class="svelte-138s9ji"></div> <div class="svelte-138s9ji"><button class="white_button svelte-138s9ji">デッキを複製</button></div> <div class="svelte-138s9ji"><button class="white_button svelte-138s9ji" title="shiftキー押下で確認メッセージスキップ">デッキを削除</button></div></div> <div class="deck_editor_body_right_header_row svelte-138s9ji"><div class="svelte-138s9ji">DL/UL</div> <!> <!></div></div> <!>',1),tp=b("<div>デッキ情報読込中</div>"),ip=b('<div class="deck_editor svelte-138s9ji"><div class="deck_editor_header"></div> <div class="deck_editor_body svelte-138s9ji"><div class="deck_editor_body_left svelte-138s9ji"><div role="contentinfo"><div class="deck_editor_search_box_header svelte-138s9ji"><div>検索条件</div> <div><button class="white_button svelte-138s9ji">条件クリア</button></div></div> <div class="deck_editor_search_box_row svelte-138s9ji"><div class="svelte-138s9ji">名称</div> <div class="svelte-138s9ji"><input type="text" style="width:70%">※ルビには対応していません</div></div> <div class="deck_editor_search_box_row svelte-138s9ji"><div class="svelte-138s9ji"><button class="search_condition_title black_button svelte-138s9ji">種類</button></div> <div class="svelte-138s9ji"></div></div> <div class="deck_editor_search_box_row svelte-138s9ji"><div class="svelte-138s9ji"><button class="search_condition_title black_button svelte-138s9ji">モンスター</button></div> <div class="svelte-138s9ji"></div></div> <div class="deck_editor_search_box_row svelte-138s9ji"><div class="svelte-138s9ji"><button class="search_condition_title black_button svelte-138s9ji">属性</button></div> <div class="svelte-138s9ji"></div></div> <div class="deck_editor_search_box_row svelte-138s9ji"><div class="svelte-138s9ji"><button class="search_condition_title black_button svelte-138s9ji">種族</button></div> <div class="svelte-138s9ji"></div></div> <div class="deck_editor_search_box_row svelte-138s9ji"><div class="svelte-138s9ji"><button class="search_condition_title black_button svelte-138s9ji">魔法</button></div> <div class="svelte-138s9ji"></div></div> <div class="deck_editor_search_box_row svelte-138s9ji"><div class="svelte-138s9ji"><button class="search_condition_title black_button svelte-138s9ji">罠</button></div> <div class="svelte-138s9ji"></div></div> <div class="deck_editor_search_box_row svelte-138s9ji"><div class="svelte-138s9ji">テスト用</div> <div class="svelte-138s9ji"><label><input type="checkbox"> テスト用カードを表示する</label></div></div></div> <!></div> <div class="deck_editor_body_center svelte-138s9ji"><!></div> <div class="deck_editor_body_right svelte-138s9ji"><!></div></div></div>');function rp(e,t){ot(t,!1);const i=[],r=[],a=[],n=[],s=[],l=[],d={name:"",cardKinds:fa.filter(B=>B!=="XyzMaterial"),monsterCategories:[...dn],monsterAttributes:[...un],monsterTypes:[...fn],spellCategories:[...vn],trapCategories:[...pn],isForTest:!1},o=Pe(structuredClone(d));let f=Pe("SearchCondition");const v=async()=>{Ye(o,u(o).name=""),Ye(o,u(o).cardKinds=[]),Ye(o,u(o).monsterCategories=[]),Ye(o,u(o).monsterAttributes=[]),Ye(o,u(o).monsterTypes=[]),Ye(o,u(o).spellCategories=[]),Ye(o,u(o).trapCategories=[]),Ye(o,u(o).isForTest=!1)},p=async()=>{const H=(await u(C)).find($e=>$e.id===u(m));H&&L(k,{...H,cardInfos:H.cardNames.map($e=>ht[$e])})},y=()=>Ot.getAllDeckInfo().then(B=>(L(m,(B.find(H=>H.lastUsedAt.getTime()===Math.max(...B.map($e=>$e.lastUsedAt.getTime())))??B[0]).id),B));let m=Pe(-1),C=Pe(y()),g=Pe(u(C).then(B=>Ot.convertToObjectURL(B)));u(C).then(p);const T=()=>{L(C,y()),L(g,u(C).then(B=>Ot.convertToObjectURL(B))),p()};let k=Pe({id:-Number.MAX_VALUE,name:"",description:"",lastUsedAt:new Date,cardInfos:[]}),E=Pe(ht.ゾンビーノ);const F=()=>Object.values(ht).filter(B=>{if(!u(o).cardKinds.includes(B.kind)||u(o).name.trim().length&&!B.name.includes(u(o).name)||B.isForTest&&!u(o).isForTest)return!1;if(B.kind==="Monster")return B.attributes&&!u(o).monsterAttributes.union(B.attributes).length||B.types&&!u(o).monsterTypes.union(B.types).length||!B.monsterCategories?!1:B.monsterCategories.union(u(o).monsterCategories).length;if(B.kind==="Spell")return B.spellCategory&&u(o).spellCategories.includes(B.spellCategory);if(B.kind==="Trap")return B.trapCategory&&u(o).trapCategories.includes(B.trapCategory)}),Z=B=>{L(f,"CardDetail"),L(E,B)},ee=async()=>{const H=(await u(C)).find($e=>$e.id===u(m));if(!H)throw new Error("illegal state");return H},J=async B=>{Array.isArray(u(o)[B])&&Array.isArray(d[B])&&Ye(o,u(o)[B]=u(o)[B].length?[]:[...d[B]])},N=async()=>{const B=await ee();await B.saveDeckInfo({...B,name:u(k).name,cardNames:u(k).cardInfos.map(H=>H.name),lastUsedAt:new Date}),T()},ie=async()=>{(await Ot.createNewDeck(`デッキ_${new Date().formatToYYYYMMDD_HHMMSS("","","")}`,`コピー日時：${new Date().formatToYYYYMMDD_HHMMSS("-"," ",":")}`,u(k).cardInfos.map(H=>H.name))).saveDeckInfo(),T()},K=async B=>{const H=await ee();!B.shiftKey&&!confirm(`デッキ【${H.name}】を削除します。
よろしいですか？`)||(await H.delete(),T())};St();var W=ip(),Re=_(h(W),2),Y=h(Re),R=h(Y),x=h(R),U=_(h(x),2),X=h(U),re=_(x,2),me=_(h(re),2),Se=h(me),ye=_(re,2),w=h(ye),$=h(w),j=_(w,2);oe(j,5,()=>fa.filter(B=>B!=="XyzMaterial"),le,(B,H)=>{var $e=Uv(),Fe=h($e),it,dt=_(Fe);M(()=>{it!==(it=u(H))&&(Fe.value=(Fe.__value=u(H))==null?"":u(H)),D(dt,` ${us[u(H)]??""}`)}),Ci(i,[],Fe,()=>(u(H),u(o).cardKinds),ut=>Ye(o,u(o).cardKinds=ut)),S(B,$e)});var te=_(ye,2),z=h(te),V=h(z),P=_(z,2);oe(P,5,()=>dn,le,(B,H)=>{var $e=Gv(),Fe=h($e),it,dt=_(Fe);M(()=>{it!==(it=u(H))&&(Fe.value=(Fe.__value=u(H))==null?"":u(H)),D(dt,` ${rr[u(H)]??""}${Zr[u(H)]??""}`)}),Ci(r,[],Fe,()=>(u(H),u(o).monsterCategories),ut=>Ye(o,u(o).monsterCategories=ut)),S(B,$e)});var A=_(te,2),Q=h(A),ne=h(Q),O=_(Q,2);oe(O,5,()=>un,le,(B,H)=>{var $e=zv(),Fe=h($e),it,dt=_(Fe,2),ut=_(dt);M(()=>{it!==(it=u(H))&&(Fe.value=(Fe.__value=u(H))==null?"":u(H)),De(dt,`monster_attr ${u(H)??""} svelte-138s9ji`),D(ut,` ${qa[u(H)]??""}`)}),Ci(a,[],Fe,()=>(u(H),u(o).monsterAttributes),Wr=>Ye(o,u(o).monsterAttributes=Wr)),S(B,$e)});var G=_(A,2),ue=h(G),Ce=h(ue),fe=_(ue,2);oe(fe,5,()=>fn,le,(B,H)=>{var $e=Vv(),Fe=h($e),it,dt=_(Fe);M(()=>{it!==(it=u(H))&&(Fe.value=(Fe.__value=u(H))==null?"":u(H)),D(dt,` ${sr[u(H)]??""}
                ${Ur[u(H)]??""}`)}),Ci(n,[],Fe,()=>(u(H),u(o).monsterTypes),ut=>Ye(o,u(o).monsterTypes=ut)),S(B,$e)});var pe=_(G,2),ce=h(pe),ze=h(ce),Ve=_(ce,2);oe(Ve,5,()=>vn,le,(B,H)=>{var $e=Wv(),Fe=h($e),it,dt=_(Fe);M(()=>{it!==(it=u(H))&&(Fe.value=(Fe.__value=u(H))==null?"":u(H)),D(dt,` ${ar[u(H)]??""}`)}),Ci(s,[],Fe,()=>(u(H),u(o).spellCategories),ut=>Ye(o,u(o).spellCategories=ut)),S(B,$e)});var tt=_(pe,2),mt=h(tt),at=h(mt),Qe=_(mt,2);oe(Qe,5,()=>pn,le,(B,H)=>{var $e=Yv(),Fe=h($e),it,dt=_(Fe);M(()=>{it!==(it=u(H))&&(Fe.value=(Fe.__value=u(H))==null?"":u(H)),D(dt,` ${nr[u(H)]??""}`)}),Ci(l,[],Fe,()=>(u(H),u(o).trapCategories),ut=>Ye(o,u(o).trapCategories=ut)),S(B,$e)});var nt=_(tt,2),Be=_(h(nt),2),Oe=h(Be),Ee=h(Oe),de=_(R,2);Hv(de,{get cardInfo(){return u(E)}});var he=_(Y,2),He=h(he);const We=Te(F);En(He,{mode:"List",get allCardInfos(){return u(We)},onAttention:Z,get deckCardInfos(){return u(k).cardInfos},set deckCardInfos(B){Ye(k,u(k).cardInfos=B)},$$legacy:!0});var Ke=_(he,2),Ct=h(Ke);Zi(Ct,()=>u(C),B=>{var H=tp();S(B,H)},(B,H)=>{var $e=ep(),Fe=I($e),it=h(Fe),dt=h(it),ut=_(h(dt));M(()=>{u(m),$i(()=>{u(H)})}),oe(ut,5,()=>u(H),le,(ft,Tt)=>{var Ft=Qv(),_i={},Yr=h(Ft);M(()=>{_i!==(_i=u(Tt).id)&&(Ft.value=(Ft.__value=u(Tt).id)==null?"":u(Tt).id),D(Yr,u(Tt).name)}),S(ft,Ft)});var Wr=_(dt,4),bl=_(h(Wr)),za=_(it,4),Va=_(h(za),2),kl=h(Va),Wa=_(Va,4),Tl=h(Wa),wl=_(Wa,2),El=h(wl),Dl=_(za,2),Ya=_(h(Dl),2);Zi(Ya,ee,ft=>{var Tt=Xv();S(ft,Tt)},(ft,Tt)=>{var Ft=Kv(),_i=h(Ft);M(Yr=>Vt(_i,"href",Yr),[()=>Ot.convertToObjectURL([u(Tt)])],Te),S(ft,Ft)});var Ml=_(Ya,2);Zi(Ml,()=>u(g),ft=>{var Tt=Iv();S(ft,Tt)},(ft,Tt)=>{var Ft=Jv(),_i=h(Ft);M(()=>Vt(_i,"href",u(Tt))),S(ft,Ft)});var Al=_(Fe,2);En(Al,{mode:"Deck",allCardInfos:[],onAttention:Z,get deckCardInfos(){return u(k).cardInfos},set deckCardInfos(ft){Ye(k,u(k).cardInfos=ft)},$$legacy:!0}),ji(ut,()=>u(m),ft=>L(m,ft)),Me("change",ut,p),ua(bl,()=>u(k).name,ft=>Ye(k,u(k).name=ft)),Me("click",kl,N),Me("click",Tl,ie),Me("click",El,K),S(B,$e)}),M(()=>De(R,`deck_editor_search_box ${(u(f)==="SearchCondition"?"":"minimum")??""} svelte-138s9ji`)),Me("click",X,v),ua(Se,()=>u(o).name,B=>Ye(o,u(o).name=B)),Me("click",$,()=>J("cardKinds")),Me("click",V,()=>J("monsterCategories")),Me("click",ne,()=>J("monsterAttributes")),Me("click",Ce,()=>J("monsterTypes")),Me("click",ze,()=>J("spellCategories")),Me("click",at,()=>J("trapCategories")),tc(Ee,()=>u(o).isForTest,B=>Ye(o,u(o).isForTest=B)),Me("mouseenter",R,()=>L(f,"SearchCondition")),S(e,W),ct()}const ap="2025-05-04 21:13:56",np={timestamp:ap},sp=["TblDeckHeader","TblDeckDetail","TblDuelistProfile"],lp=3;var op=b("<option> </option>"),cp=b("<option> </option>"),dp=b("<option> </option>"),up=b("<option> </option>"),fp=b('<div class="svelte-1tmphfm"><label for="deck_selector" class="deck_selector svelte-1tmphfm">デッキ：</label> <select id="deck_selector" class="deck_selector svelte-1tmphfm"></select></div> <div class="svelte-1tmphfm"><label for="npc_selector" class="npc_selector svelte-1tmphfm">対戦相手：</label> <select id="npc_selector" class="npc_selector svelte-1tmphfm"></select> <div> </div></div> <div class="svelte-1tmphfm"><label for="npc_deck_selector" class="deck_selector svelte-1tmphfm">対戦相手のデッキ：</label> <select id="npc_deck_selector" class="deck_selector svelte-1tmphfm"><option>デフォルト</option><!></select></div> <div class="svelte-1tmphfm"><label for="npc_selector" class="npc_selector svelte-1tmphfm">先攻後攻：</label> <select id="npc_selector" class="npc_selector svelte-1tmphfm"></select></div> <div class="svelte-1tmphfm"><button class="btn svelte-1tmphfm">duel start!</button></div>',1),vp=b('<div class="svelte-1tmphfm">デッキ情報の読み込み、もしくは作成中...</div>'),pp=b('<div class="svelte-1tmphfm"><label for="duelist_name" class="duelist_name svelte-1tmphfm">名前：</label> <input id="duelist_name" class="duelist_name svelte-1tmphfm" type="text"></div> <!> <div class="svelte-1tmphfm"><button class="btn svelte-1tmphfm">deck edit</button></div>',1),hp=b('<div class="svelte-1tmphfm">デュエリスト情報の読み込み、もしくは作成中...</div>'),gp=b('<div class="app_body svelte-1tmphfm"><!></div>'),yp=b('<div class="result_title result_win svelte-1tmphfm">YOU WIN</div>'),_p=b('<div class="result_title result_lose svelte-1tmphfm">YOU LOSE</div>'),mp=b('<div class="result_title result_draw svelte-1tmphfm">DRAW</div>'),Sp=b('<div class="result svelte-1tmphfm"><!> <button class="white_button svelte-1tmphfm">TOPへ戻る</button></div>'),Cp=b('<main class="svelte-1tmphfm"><div class="link link_left svelte-1tmphfm"><a href="https://github.com/Setta238/stk_ygo_svelte" target="_blank" rel="noopener noreferrer" title="repository" class="svelte-1tmphfm">repository</a> <a href="https://x.com/ninja_no" target="_blank" rel="noopener noreferrer" title="repository" class="svelte-1tmphfm">X(Twitter)</a> <a href="https://posfie.com/@ninja_no/p/Lx7FLj3" target="_blank" rel="noopener noreferrer" title="posfie" class="svelte-1tmphfm">posfie(toggeter)</a></div> <div class="link link_right svelte-1tmphfm"><a class="a_button svelte-1tmphfm" role="button" tabindex="0">TOPへ戻る</a> <a href="/stk_ygo_svelte/note.html" target="_blank" rel="noopener noreferrer" title="repository" class="svelte-1tmphfm">現時点とこの先のこと</a></div> <!> <div class="debug_info svelte-1tmphfm"><span> </span> <span class="user_agent_info"> </span> <span class="screen_info"></span></div> <!></main>');function bp(e,t){ot(t,!1);const i=new cc("stk_ygo_svelte",lp,sp);let r=Pe(),a=Pe("None"),n=Pe(0);const s=Sa.getOrCreateNew(i);let l=Pe(Ot.getAllDeckInfo(i).then(Y=>(Promise.all(Y.filter(R=>!R.lastUsedAt).map(R=>{R.saveDeckInfo()})),L(n,(Y.find(R=>R.lastUsedAt.getTime()===Math.max(...Y.map(x=>x.lastUsedAt.getTime())))??Y[0]).id),Y)));const d=async()=>{let Y=(await u(l)).find(R=>R.id===u(n));if(Y||(Y=(await f()).find(R=>R.id===u(n))),!Y)throw new Error("illegal state");return Y},o=async()=>{(await s).save()},f=()=>(L(l,Ot.getAllDeckInfo(i).then(Y=>(L(n,(Y.find(R=>R.lastUsedAt.getTime()===Math.max(...Y.map(x=>x.lastUsedAt.getTime())))??Y[0]).id),Y))),u(l)),v=async()=>{(await u(l)).length||(await Ot.prepareSampleDeck(),f())},p=async()=>{await Promise.all([o(),v()]);const Y=await d(),R=await s;await Y.updateTimestamp();const x=zi.find(X=>X.id===R.previousNpcId);let U=kn.slice(-1)[0];x&&(R.previousNpcDeckId>-1?U=(await u(l)).find(X=>X.id===R.previousNpcDeckId)??U:x.id===-1&&(U=kn.find(X=>X.id===-1)??U),L(r,new ed(R,"Player",Y,[],x,"NPC",U,[],R.previousStartMode)),u(r).onDuelEnd.append(()=>(L(r,u(r)),"RemoveMe")))},y=async()=>{await Promise.all([o(),v()]),L(a,"DeckEdit")},m=async Y=>{await o(),Y.key==="Enter"&&!Y.repeat&&(await s).save()},C=()=>{L(l,f()),L(r,void 0),L(a,"None")};v(),St();var g=Cp(),T=_(h(g),2),k=h(T),E=_(T,2);{var F=Y=>{kv(Y,{get duel(){return u(r)}})},Z=Y=>{var R=Ne(),x=I(R);{var U=re=>{rp(re,{})},X=re=>{var me=gp(),Se=h(me);Zi(Se,()=>s,ye=>{var w=hp();S(ye,w)},(ye,w)=>{var $=pp(),j=I($),te=_(h(j),2),z=_(j,2);Zi(z,()=>u(l),A=>{var Q=vp();S(A,Q)},(A,Q)=>{var ne=fp(),O=I(ne),G=_(h(O),2);M(()=>{u(n),$i(()=>{u(Q)})}),oe(G,5,()=>u(Q),le,(Be,Oe)=>{var Ee=op(),de={},he=h(Ee);M(()=>{de!==(de=u(Oe).id)&&(Ee.value=(Ee.__value=u(Oe).id)==null?"":u(Oe).id),D(he,u(Oe).name)}),S(Be,Ee)});var ue=_(O,2),Ce=_(h(ue),2);M(()=>{u(w),$i(()=>{})}),oe(Ce,5,()=>zi,le,(Be,Oe)=>{var Ee=cp(),de={},he=h(Ee);M(()=>{de!==(de=u(Oe).id)&&(Ee.value=(Ee.__value=u(Oe).id)==null?"":u(Oe).id),D(he,u(Oe).name)}),S(Be,Ee)});var fe=_(Ce,2),pe=h(fe),ce=_(ue,2),ze=_(h(ce),2);M(()=>{u(w),$i(()=>{u(Q)})});var Ve=h(ze);Ve.value=(Ve.__value=Number.MIN_SAFE_INTEGER)==null?"":Number.MIN_SAFE_INTEGER;var tt=_(Ve);oe(tt,1,()=>u(Q),le,(Be,Oe)=>{var Ee=dp(),de={},he=h(Ee);M(()=>{de!==(de=u(Oe).id)&&(Ee.value=(Ee.__value=u(Oe).id)==null?"":u(Oe).id),D(he,u(Oe).name)}),S(Be,Ee)});var mt=_(ce,2),at=_(h(mt),2);M(()=>{u(w),$i(()=>{})}),oe(at,5,()=>Ss(Sn),le,(Be,Oe)=>{var Ee=up(),de={},he=h(Ee);M(()=>{de!==(de=u(Oe))&&(Ee.value=(Ee.__value=u(Oe))==null?"":u(Oe)),D(he,Sn[u(Oe)])}),S(Be,Ee)});var Qe=_(mt,2),nt=h(Qe);M(Be=>D(pe,`※${Be??""}`),[()=>{var Be;return(Be=zi.find(Oe=>Oe.id===u(w).previousNpcId))==null?void 0:Be.description}],Te),ji(G,()=>u(n),Be=>L(n,Be)),ji(Ce,()=>u(w).previousNpcId,Be=>u(w).previousNpcId=Be),ji(ze,()=>u(w).previousNpcDeckId,Be=>u(w).previousNpcDeckId=Be),ji(at,()=>u(w).previousStartMode,Be=>u(w).previousStartMode=Be),Me("click",nt,p),S(A,ne)});var V=_(z,2),P=h(V);ua(te,()=>u(w).name,A=>u(w).name=A),Me("keypress",te,m),Me("click",P,y),S(ye,$)}),S(re,me)};q(x,re=>{u(a)==="DeckEdit"?re(U):re(X,!1)},!0)}S(Y,R)};q(E,Y=>{u(r)?Y(F):Y(Z,!1)})}var ee=_(E,2),J=h(ee),N=h(J),ie=_(J,2),K=h(ie),W=_(ee,2);{var Re=Y=>{var R=Sp(),x=h(R);{var U=me=>{var Se=Ne(),ye=I(Se);{var w=j=>{var te=yp();S(j,te)},$=j=>{var te=Ne(),z=I(te);{var V=P=>{var A=_p();S(P,A)};q(z,P=>{u(r).winner.seat==="Above"&&P(V)},!0)}S(j,te)};q(ye,j=>{u(r).winner.seat==="Below"?j(w):j($,!1)})}S(me,Se)},X=me=>{var Se=mp();S(me,Se)};q(x,me=>{u(r).winner?me(U):me(X,!1)})}var re=_(x,2);Me("click",re,C),ni(3,R,()=>Bu,()=>({delay:200,duration:2e3})),S(Y,R)};q(W,Y=>{u(r)&&u(r).isEnded&&Y(Re)})}M(()=>{D(N,`build at: ${np.timestamp}`),D(K,hr.text)}),Me("click",k,C),S(e,g),ct()}jo(bp,{target:document.getElementById("app")});
