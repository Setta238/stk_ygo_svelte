var Rs=Object.defineProperty;var Hs=(r,e,t)=>e in r?Rs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var u=(r,e,t)=>Hs(r,typeof e!="symbol"?e+"":e,t);import{j as $s}from"./cardInfo.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function t(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(a){if(a.ep)return;a.ep=!0;const n=t(a);fetch(a.href,n)}})();const ia=!1;var ka=Array.isArray,Zs=Array.prototype.indexOf,wa=Array.from,Us=Object.defineProperty,ki=Object.getOwnPropertyDescriptor,En=Object.getOwnPropertyDescriptors,Gs=Object.prototype,js=Array.prototype,Ta=Object.getPrototypeOf;function Vs(r){return typeof r=="function"}const Kt=()=>{};function zs(r){return typeof(r==null?void 0:r.then)=="function"}function Ws(r){return r()}function ra(r){for(var e=0;e<r.length;e++)r[e]()}const bt=2,Dn=4,Mr=8,Pr=16,zt=32,Ji=64,pr=128,Tt=256,hr=512,ht=1024,Wt=2048,Pi=4096,Gt=8192,Br=16384,An=32768,Fr=65536,xn=1<<17,Ys=1<<19,Mn=1<<20,jt=Symbol("$state"),Ks=Symbol("legacy props"),Qs=Symbol("");function Pn(r){return r===this.v}function Bn(r,e){return r!=r?e==e:r!==e||r!==null&&typeof r=="object"||typeof r=="function"}function ba(r){return!Bn(r,this.v)}function Xs(r){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Js(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Is(r){throw new Error("https://svelte.dev/e/effect_orphan")}function el(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function tl(r){throw new Error("https://svelte.dev/e/props_invalid_value")}function il(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function rl(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function al(){throw new Error("https://svelte.dev/e/state_unsafe_local_read")}function nl(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let Ii=!1,sl=!1;function ll(){Ii=!0}const Ea=1,Da=2,Fn=4,ol=8,cl=16,ul=1,dl=2,fl=4,vl=8,pl=16,hl=1,gl=2,yl=4,ml=1,_l=2,rt=Symbol();let Qe=null;function gr(r){Qe=r}function st(r,e=!1,t){Qe={p:Qe,c:null,e:null,m:!1,s:r,x:null,l:null},Ii&&!e&&(Qe.l={s:null,u:null,r1:[],r2:ft(!1)})}function lt(r){const e=Qe;if(e!==null){const s=e.e;if(s!==null){var t=qe,i=He;e.e=null;try{for(var a=0;a<s.length;a++){var n=s[a];Dt(n.effect),Et(n.reaction),Oi(n.fn)}}finally{Dt(t),Et(i)}}Qe=e.p,e.m=!0}return{}}function Bi(){return!Ii||Qe!==null&&Qe.l===null}function ft(r,e){var t={f:0,v:r,reactions:null,equals:Pn,rv:0,wv:0};return t}function Sl(r){return On(ft(r))}function Wi(r,e=!1){var i;const t=ft(r);return e||(t.equals=ba),Ii&&Qe!==null&&Qe.l!==null&&((i=Qe.l).s??(i.s=[])).push(t),t}function je(r,e=!1){return On(Wi(r,e))}function On(r){return He!==null&&!Ft&&He.f&bt&&(Lt===null?Pl([r]):Lt.push(r)),r}function Ve(r,e){return K(r,Rt(()=>v(r))),e}function K(r,e){return He!==null&&!Ft&&Bi()&&He.f&(bt|Pr)&&(Lt===null||!Lt.includes(r))&&nl(),It(r,e)}function It(r,e){return r.equals(e)||(r.v,r.v=e,r.wv=In(),Ln(r,Wt),Bi()&&qe!==null&&qe.f&ht&&!(qe.f&(zt|Ji))&&($t===null?Bl([r]):$t.push(r))),e}function Ln(r,e){var t=r.reactions;if(t!==null)for(var i=Bi(),a=t.length,n=0;n<a;n++){var s=t[n],o=s.f;o&Wt||!i&&s===qe||(Ht(s,e),o&(ht|Tt)&&(o&bt?Ln(s,Pi):Rr(s)))}}let Nn=!1;function Qt(r,e=null,t){if(typeof r!="object"||r===null||jt in r)return r;const i=Ta(r);if(i!==Gs&&i!==js)return r;var a=new Map,n=ka(r),s=ft(0);n&&a.set("length",ft(r.length));var o;return new Proxy(r,{defineProperty(d,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&il();var f=a.get(l);return f===void 0?(f=ft(c.value),a.set(l,f)):K(f,Qt(c.value,o)),!0},deleteProperty(d,l){var c=a.get(l);if(c===void 0)l in d&&a.set(l,ft(rt));else{if(n&&typeof l=="string"){var f=a.get("length"),p=Number(l);Number.isInteger(p)&&p<f.v&&K(f,p)}K(c,rt),za(s)}return!0},get(d,l,c){var m;if(l===jt)return r;var f=a.get(l),p=l in d;if(f===void 0&&(!p||(m=ki(d,l))!=null&&m.writable)&&(f=ft(Qt(p?d[l]:rt,o)),a.set(l,f)),f!==void 0){var h=v(f);return h===rt?void 0:h}return Reflect.get(d,l,c)},getOwnPropertyDescriptor(d,l){var c=Reflect.getOwnPropertyDescriptor(d,l);if(c&&"value"in c){var f=a.get(l);f&&(c.value=v(f))}else if(c===void 0){var p=a.get(l),h=p==null?void 0:p.v;if(p!==void 0&&h!==rt)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return c},has(d,l){var h;if(l===jt)return!0;var c=a.get(l),f=c!==void 0&&c.v!==rt||Reflect.has(d,l);if(c!==void 0||qe!==null&&(!f||(h=ki(d,l))!=null&&h.writable)){c===void 0&&(c=ft(f?Qt(d[l],o):rt),a.set(l,c));var p=v(c);if(p===rt)return!1}return f},set(d,l,c,f){var b;var p=a.get(l),h=l in d;if(n&&l==="length")for(var m=c;m<p.v;m+=1){var C=a.get(m+"");C!==void 0?K(C,rt):m in d&&(C=ft(rt),a.set(m+"",C))}p===void 0?(!h||(b=ki(d,l))!=null&&b.writable)&&(p=ft(void 0),K(p,Qt(c,o)),a.set(l,p)):(h=p.v!==rt,K(p,Qt(c,o)));var y=Reflect.getOwnPropertyDescriptor(d,l);if(y!=null&&y.set&&y.set.call(f,c),!h){if(n&&typeof l=="string"){var w=a.get("length"),k=Number(l);Number.isInteger(k)&&k>=w.v&&K(w,k+1)}za(s)}return!0},ownKeys(d){v(s);var l=Reflect.ownKeys(d).filter(p=>{var h=a.get(p);return h===void 0||h.v!==rt});for(var[c,f]of a)f.v!==rt&&!(c in d)&&l.push(c);return l},setPrototypeOf(){rl()}})}function za(r,e=1){K(r,r.v+e)}function Wa(r){return r!==null&&typeof r=="object"&&jt in r?r[jt]:r}function qn(r,e){return Object.is(Wa(r),Wa(e))}var Ya,Rn,Hn,$n;function Cl(){if(Ya===void 0){Ya=window,Rn=/Firefox/.test(navigator.userAgent);var r=Element.prototype,e=Node.prototype;Hn=ki(e,"firstChild").get,$n=ki(e,"nextSibling").get,r.__click=void 0,r.__className="",r.__attributes=null,r.__styles=null,r.__e=void 0,Text.prototype.__t=void 0}}function Or(r=""){return document.createTextNode(r)}function yr(r){return Hn.call(r)}function Lr(r){return $n.call(r)}function g(r,e){return yr(r)}function le(r,e){{var t=yr(r);return t instanceof Comment&&t.data===""?Lr(t):t}}function _(r,e=1,t=!1){let i=r;for(;e--;)i=Lr(i);return i}function kl(r){r.textContent=""}function Yi(r){var e=bt|Wt,t=He!==null&&He.f&bt?He:null;return qe===null||t!==null&&t.f&Tt?e|=Tt:qe.f|=Mn,{ctx:Qe,deps:null,effects:null,equals:Pn,f:e,fn:r,reactions:null,rv:0,v:null,wv:0,parent:t??qe}}function _e(r){const e=Yi(r);return e.equals=ba,e}function Zn(r){var e=r.effects;if(e!==null){r.effects=null;for(var t=0;t<e.length;t+=1)ti(e[t])}}function wl(r){for(var e=r.parent;e!==null;){if(!(e.f&bt))return e;e=e.parent}return null}function Tl(r){var e,t=qe;Dt(wl(r));try{Zn(r),e=ts(r)}finally{Dt(t)}return e}function Un(r){var e=Tl(r),t=(Jt||r.f&Tt)&&r.deps!==null?Pi:ht;Ht(r,t),r.equals(e)||(r.v=e,r.wv=In())}function Gn(r){qe===null&&He===null&&Is(),He!==null&&He.f&Tt&&qe===null&&Js(),xa&&Xs()}function bl(r,e){var t=e.last;t===null?e.last=e.first=r:(t.next=r,r.prev=t,e.last=r)}function Fi(r,e,t,i=!0){var a=(r&Ji)!==0,n=qe,s={ctx:Qe,deps:null,nodes_start:null,nodes_end:null,f:r|Wt,first:null,fn:e,last:null,next:null,parent:a?null:n,prev:null,teardown:null,transitions:null,wv:0};if(t){var o=wi;try{Qa(!0),Ma(s),s.f|=An}catch(c){throw ti(s),c}finally{Qa(o)}}else e!==null&&Rr(s);var d=t&&s.deps===null&&s.first===null&&s.nodes_start===null&&s.teardown===null&&(s.f&(Mn|pr))===0;if(!d&&!a&&i&&(n!==null&&bl(s,n),He!==null&&He.f&bt)){var l=He;(l.effects??(l.effects=[])).push(s)}return s}function jn(r){const e=Fi(Mr,null,!1);return Ht(e,ht),e.teardown=r,e}function Ka(r){Gn();var e=qe!==null&&(qe.f&zt)!==0&&Qe!==null&&!Qe.m;if(e){var t=Qe;(t.e??(t.e=[])).push({fn:r,effect:qe,reaction:He})}else{var i=Oi(r);return i}}function El(r){return Gn(),er(r)}function Dl(r){const e=Fi(Ji,r,!0);return(t={})=>new Promise(i=>{t.outro?li(e,()=>{ti(e),i(void 0)}):(ti(e),i(void 0))})}function Oi(r){return Fi(Dn,r,!1)}function er(r){return Fi(Mr,r,!0)}function A(r,e=[],t=Yi){const i=e.map(t);return Nr(()=>r(...i.map(v)))}function Nr(r,e=0){return Fi(Mr|Pr|e,r,!0)}function ci(r,e=!0){return Fi(Mr|zt,r,!0,e)}function Vn(r){var e=r.teardown;if(e!==null){const t=xa,i=He;Xa(!0),Et(null);try{e.call(null)}finally{Xa(t),Et(i)}}}function zn(r,e=!1){var t=r.first;for(r.first=r.last=null;t!==null;){var i=t.next;ti(t,e),t=i}}function Al(r){for(var e=r.first;e!==null;){var t=e.next;e.f&zt||ti(e),e=t}}function ti(r,e=!0){var t=!1;if((e||r.f&Ys)&&r.nodes_start!==null){for(var i=r.nodes_start,a=r.nodes_end;i!==null;){var n=i===a?null:Lr(i);i.remove(),i=n}t=!0}zn(r,e&&!t),Sr(r,0),Ht(r,Br);var s=r.transitions;if(s!==null)for(const d of s)d.stop();Vn(r);var o=r.parent;o!==null&&o.first!==null&&Wn(r),r.next=r.prev=r.teardown=r.ctx=r.deps=r.fn=r.nodes_start=r.nodes_end=null}function Wn(r){var e=r.parent,t=r.prev,i=r.next;t!==null&&(t.next=i),i!==null&&(i.prev=t),e!==null&&(e.first===r&&(e.first=i),e.last===r&&(e.last=t))}function li(r,e){var t=[];Aa(r,t,!0),Yn(t,()=>{ti(r),e&&e()})}function Yn(r,e){var t=r.length;if(t>0){var i=()=>--t||e();for(var a of r)a.out(i)}else e()}function Aa(r,e,t){if(!(r.f&Gt)){if(r.f^=Gt,r.transitions!==null)for(const s of r.transitions)(s.is_global||t)&&e.push(s);for(var i=r.first;i!==null;){var a=i.next,n=(i.f&Fr)!==0||(i.f&zt)!==0;Aa(i,e,n?t:!1),i=a}}}function Di(r){Kn(r,!0)}function Kn(r,e){if(r.f&Gt){r.f^=Gt,r.f&ht||(r.f^=ht),tr(r)&&(Ht(r,Wt),Rr(r));for(var t=r.first;t!==null;){var i=t.next,a=(t.f&Fr)!==0||(t.f&zt)!==0;Kn(t,a?e:!1),t=i}if(r.transitions!==null)for(const n of r.transitions)(n.is_global||e)&&n.in()}}let mr=!1,aa=[];function Qn(){mr=!1;const r=aa.slice();aa=[],ra(r)}function ui(r){mr||(mr=!0,queueMicrotask(Qn)),aa.push(r)}function xl(){mr&&Qn()}const Xn=0,Ml=1;let fr=!1,vr=Xn,Ki=!1,Qi=null,wi=!1,xa=!1;function Qa(r){wi=r}function Xa(r){xa=r}let si=[],Ti=0;let He=null,Ft=!1;function Et(r){He=r}let qe=null;function Dt(r){qe=r}let Lt=null;function Pl(r){Lt=r}let vt=null,St=0,$t=null;function Bl(r){$t=r}let Jn=1,_r=0,Jt=!1,Xt=null;function In(){return++Jn}function tr(r){var f;var e=r.f;if(e&Wt)return!0;if(e&Pi){var t=r.deps,i=(e&Tt)!==0;if(t!==null){var a,n,s=(e&hr)!==0,o=i&&qe!==null&&!Jt,d=t.length;if(s||o){var l=r,c=l.parent;for(a=0;a<d;a++)n=t[a],(s||!((f=n==null?void 0:n.reactions)!=null&&f.includes(l)))&&(n.reactions??(n.reactions=[])).push(l);s&&(l.f^=hr),o&&c!==null&&!(c.f&Tt)&&(l.f^=Tt)}for(a=0;a<d;a++)if(n=t[a],tr(n)&&Un(n),n.wv>r.wv)return!0}(!i||qe!==null&&!Jt)&&Ht(r,ht)}return!1}function Fl(r,e){for(var t=e;t!==null;){if(t.f&pr)try{t.fn(r);return}catch{t.f^=pr}t=t.parent}throw fr=!1,r}function Ol(r){return(r.f&Br)===0&&(r.parent===null||(r.parent.f&pr)===0)}function qr(r,e,t,i){if(fr){if(t===null&&(fr=!1),Ol(e))throw r;return}t!==null&&(fr=!0);{Fl(r,e);return}}function es(r,e,t=!0){var i=r.reactions;if(i!==null)for(var a=0;a<i.length;a++){var n=i[a];n.f&bt?es(n,e,!1):e===n&&(t?Ht(n,Wt):n.f&ht&&Ht(n,Pi),Rr(n))}}function ts(r){var h;var e=vt,t=St,i=$t,a=He,n=Jt,s=Lt,o=Qe,d=Ft,l=r.f;vt=null,St=0,$t=null,He=l&(zt|Ji)?null:r,Jt=(l&Tt)!==0&&(!wi||a===null||d),Lt=null,gr(r.ctx),Ft=!1,_r++;try{var c=(0,r.fn)(),f=r.deps;if(vt!==null){var p;if(Sr(r,St),f!==null&&St>0)for(f.length=St+vt.length,p=0;p<vt.length;p++)f[St+p]=vt[p];else r.deps=f=vt;if(!Jt)for(p=St;p<f.length;p++)((h=f[p]).reactions??(h.reactions=[])).push(r)}else f!==null&&St<f.length&&(Sr(r,St),f.length=St);if(Bi()&&$t!==null&&!Ft&&f!==null&&!(r.f&(bt|Pi|Wt)))for(p=0;p<$t.length;p++)es($t[p],r);return a!==null&&_r++,c}finally{vt=e,St=t,$t=i,He=a,Jt=n,Lt=s,gr(o),Ft=d}}function Ll(r,e){let t=e.reactions;if(t!==null){var i=Zs.call(t,r);if(i!==-1){var a=t.length-1;a===0?t=e.reactions=null:(t[i]=t[a],t.pop())}}t===null&&e.f&bt&&(vt===null||!vt.includes(e))&&(Ht(e,Pi),e.f&(Tt|hr)||(e.f^=hr),Zn(e),Sr(e,0))}function Sr(r,e){var t=r.deps;if(t!==null)for(var i=e;i<t.length;i++)Ll(r,t[i])}function Ma(r){var e=r.f;if(!(e&Br)){Ht(r,ht);var t=qe,i=Qe;qe=r;try{e&Pr?Al(r):zn(r),Vn(r);var a=ts(r);r.teardown=typeof a=="function"?a:null,r.wv=Jn;var n=r.deps,s;ia&&sl&&r.f&Wt}catch(o){qr(o,r,t,i||r.ctx)}finally{qe=t}}}function is(){if(Ti>1e3){Ti=0;try{el()}catch(r){if(Qi!==null)qr(r,Qi,null);else throw r}}Ti++}function rs(r){var e=r.length;if(e!==0){is();var t=wi;wi=!0;try{for(var i=0;i<e;i++){var a=r[i];a.f&ht||(a.f^=ht);var n=Rl(a);Nl(n)}}finally{wi=t}}}function Nl(r){var e=r.length;if(e!==0)for(var t=0;t<e;t++){var i=r[t];if(!(i.f&(Br|Gt)))try{tr(i)&&(Ma(i),i.deps===null&&i.first===null&&i.nodes_start===null&&(i.teardown===null?Wn(i):i.fn=null))}catch(a){qr(a,i,null,i.ctx)}}}function ql(){if(Ki=!1,Ti>1001)return;const r=si;si=[],rs(r),Ki||(Ti=0,Qi=null)}function Rr(r){vr===Xn&&(Ki||(Ki=!0,queueMicrotask(ql))),Qi=r;for(var e=r;e.parent!==null;){e=e.parent;var t=e.f;if(t&(Ji|zt)){if(!(t&ht))return;e.f^=ht}}si.push(e)}function Rl(r){var e=[],t=r.first;e:for(;t!==null;){var i=t.f,a=(i&zt)!==0,n=a&&(i&ht)!==0,s=t.next;if(!n&&!(i&Gt)){if(i&Dn)e.push(t);else if(a)t.f^=ht;else{var o=He;try{He=t,tr(t)&&Ma(t)}catch(c){qr(c,t,null,t.ctx)}finally{He=o}}var d=t.first;if(d!==null){t=d;continue}}if(s===null){let c=t.parent;for(;c!==null;){if(r===c)break e;var l=c.next;if(l!==null){t=l;continue e}c=c.parent}}t=s}return e}function Pa(r){var e=vr,t=si;try{is();const a=[];vr=Ml,si=a,Ki=!1,rs(t);var i=r==null?void 0:r();return xl(),(si.length>0||a.length>0)&&Pa(),Ti=0,Qi=null,i}finally{vr=e,si=t}}async function Hl(){await Promise.resolve(),Pa()}function v(r){var e=r.f,t=(e&bt)!==0;if(Xt!==null&&Xt.add(r),He!==null&&!Ft){Lt!==null&&Lt.includes(r)&&al();var i=He.deps;r.rv<_r&&(r.rv=_r,vt===null&&i!==null&&i[St]===r?St++:vt===null?vt=[r]:(!Jt||!vt.includes(r))&&vt.push(r))}else if(t&&r.deps===null&&r.effects===null){var a=r,n=a.parent;n!==null&&!(n.f&Tt)&&(a.f^=Tt)}return t&&(a=r,tr(a)&&Un(a)),r.v}function $l(r){var e=Xt;Xt=new Set;var t=Xt,i;try{if(Rt(r),e!==null)for(i of Xt)e.add(i)}finally{Xt=e}return t}function Hi(r){var e=$l(()=>Rt(r));for(var t of e)if(t.f&xn)for(const i of t.deps||[])i.f&bt||It(i,i.v);else It(t,t.v)}function Rt(r){var e=Ft;try{return Ft=!0,r()}finally{Ft=e}}const Zl=-7169;function Ht(r,e){r.f=r.f&Zl|e}function Ul(r){if(!(typeof r!="object"||!r||r instanceof EventTarget)){if(jt in r)na(r);else if(!Array.isArray(r))for(let e in r){const t=r[e];typeof t=="object"&&t&&jt in t&&na(t)}}}function na(r,e=new Set){if(typeof r=="object"&&r!==null&&!(r instanceof EventTarget)&&!e.has(r)){e.add(r),r instanceof Date&&r.getTime();for(let i in r)try{na(r[i],e)}catch{}const t=Ta(r);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const i=En(t);for(let a in i){const n=i[a].get;if(n)try{n.call(r)}catch{}}}}}const Gl=["touchstart","touchmove"];function jl(r){return Gl.includes(r)}let Ja=!1;function Vl(){Ja||(Ja=!0,document.addEventListener("reset",r=>{Promise.resolve().then(()=>{var e;if(!r.defaultPrevented)for(const t of r.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function Ba(r){var e=He,t=qe;Et(null),Dt(null);try{return r()}finally{Et(e),Dt(t)}}function Hr(r,e,t,i=t){r.addEventListener(e,()=>Ba(t));const a=r.__on_r;a?r.__on_r=()=>{a(),i(!0)}:r.__on_r=()=>i(!0),Vl()}const as=new Set,sa=new Set;function zl(r,e,t,i={}){function a(n){if(i.capture||$i.call(e,n),!n.cancelBubble)return Ba(()=>t==null?void 0:t.call(this,n))}return r.startsWith("pointer")||r.startsWith("touch")||r==="wheel"?ui(()=>{e.addEventListener(r,a,i)}):e.addEventListener(r,a,i),a}function De(r,e,t,i,a){var n={capture:i,passive:a},s=zl(r,e,t,n);(e===document.body||e===window||e===document)&&jn(()=>{e.removeEventListener(r,s,n)})}function Li(r){for(var e=0;e<r.length;e++)as.add(r[e]);for(var t of sa)t(r)}function $i(r){var k;var e=this,t=e.ownerDocument,i=r.type,a=((k=r.composedPath)==null?void 0:k.call(r))||[],n=a[0]||r.target,s=0,o=r.__root;if(o){var d=a.indexOf(o);if(d!==-1&&(e===document||e===window)){r.__root=e;return}var l=a.indexOf(e);if(l===-1)return;d<=l&&(s=d)}if(n=a[s]||r.target,n!==e){Us(r,"currentTarget",{configurable:!0,get(){return n||t}});var c=He,f=qe;Et(null),Dt(null);try{for(var p,h=[];n!==null;){var m=n.assignedSlot||n.parentNode||n.host||null;try{var C=n["__"+i];if(C!==void 0&&!n.disabled)if(ka(C)){var[y,...w]=C;y.apply(n,[r,...w])}else C.call(n,r)}catch(b){p?h.push(b):p=b}if(r.cancelBubble||m===e||m===null)break;n=m}if(p){for(let b of h)queueMicrotask(()=>{throw b});throw p}}finally{r.__root=e,delete r.currentTarget,Et(c),Dt(f)}}}function Wl(r){var e=document.createElement("template");return e.innerHTML=r,e.content}function Cr(r,e){var t=qe;t.nodes_start===null&&(t.nodes_start=r,t.nodes_end=e)}function T(r,e){var t=(e&ml)!==0,i=(e&_l)!==0,a,n=!r.startsWith("<!>");return()=>{a===void 0&&(a=Wl(n?r:"<!>"+r),t||(a=yr(a)));var s=i||Rn?document.importNode(a,!0):a.cloneNode(!0);if(t){var o=yr(s),d=s.lastChild;Cr(o,d)}else Cr(s,s);return s}}function ri(r=""){{var e=Or(r+"");return Cr(e,e),e}}function Ne(){var r=document.createDocumentFragment(),e=document.createComment(""),t=Or();return r.append(e,t),Cr(e,t),r}function S(r,e){r!==null&&r.before(e)}let la=!0;function E(r,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(r.__t??(r.__t=r.nodeValue))&&(r.__t=t,r.nodeValue=t+"")}function Yl(r,e){return Kl(r,e)}const gi=new Map;function Kl(r,{target:e,anchor:t,props:i={},events:a,context:n,intro:s=!0}){Cl();var o=new Set,d=f=>{for(var p=0;p<f.length;p++){var h=f[p];if(!o.has(h)){o.add(h);var m=jl(h);e.addEventListener(h,$i,{passive:m});var C=gi.get(h);C===void 0?(document.addEventListener(h,$i,{passive:m}),gi.set(h,1)):gi.set(h,C+1)}}};d(wa(as)),sa.add(d);var l=void 0,c=Dl(()=>{var f=t??e.appendChild(Or());return ci(()=>{if(n){st({});var p=Qe;p.c=n}a&&(i.$$events=a),la=s,l=r(f,i)||{},la=!0,n&&lt()}),()=>{var m;for(var p of o){e.removeEventListener(p,$i);var h=gi.get(p);--h===0?(document.removeEventListener(p,$i),gi.delete(p)):gi.set(p,h)}sa.delete(d),f!==t&&((m=f.parentNode)==null||m.removeChild(f))}});return Ql.set(l,c),l}let Ql=new WeakMap;const Wr=0,or=1,Yr=2;function Ui(r,e,t,i,a){var n=r,s=Bi(),o=Qe,d=rt,l,c,f,p=(s?ft:Wi)(void 0),h=(s?ft:Wi)(void 0),m=!1;function C(w,k){m=!0,k&&(Dt(y),Et(y),gr(o));try{w===Wr&&t&&(l?Di(l):l=ci(()=>t(n))),w===or&&i&&(c?Di(c):c=ci(()=>i(n,p))),w!==Wr&&l&&li(l,()=>l=null),w!==or&&c&&li(c,()=>c=null),w!==Yr&&f&&li(f,()=>f=null)}finally{k&&(gr(null),Et(null),Dt(null),Pa())}}var y=Nr(()=>{if(d!==(d=e())){if(zs(d)){var w=d;m=!1,w.then(k=>{w===d&&(It(p,k),C(or,!0))},k=>{if(w===d)throw It(h,k),C(Yr,!0),h.v}),ui(()=>{m||C(Wr,!0)})}else It(p,d),C(or,!1);return()=>d=rt}})}function N(r,e,t=!1){var i=r,a=null,n=null,s=rt,o=t?Fr:0,d=!1;const l=(f,p=!0)=>{d=!0,c(p,f)},c=(f,p)=>{s!==(s=f)&&(s?(a?Di(a):p&&(a=ci(()=>p(i))),n&&li(n,()=>{n=null})):(n?Di(n):p&&(n=ci(()=>p(i))),a&&li(a,()=>{a=null})))};Nr(()=>{d=!1,e(l),d||c(null,null)},o)}function ce(r,e){return e}function Xl(r,e,t,i){for(var a=[],n=e.length,s=0;s<n;s++)Aa(e[s].e,a,!0);var o=n>0&&a.length===0&&t!==null;if(o){var d=t.parentNode;kl(d),d.append(t),i.clear(),Yt(r,e[0].prev,e[n-1].next)}Yn(a,()=>{for(var l=0;l<n;l++){var c=e[l];o||(i.delete(c.k),Yt(r,c.prev,c.next)),ti(c.e,!o)}})}function ue(r,e,t,i,a,n=null){var s=r,o={flags:e,items:new Map,first:null},d=(e&Fn)!==0;if(d){var l=r;s=l.appendChild(Or())}var c=null,f=!1,p=_e(()=>{var h=t();return ka(h)?h:h==null?[]:wa(h)});Nr(()=>{var h=v(p),m=h.length;f&&m===0||(f=m===0,Jl(h,o,s,a,e,i,t),n!==null&&(m===0?c?Di(c):c=ci(()=>n(s)):c!==null&&li(c,()=>{c=null})),v(p))})}function Jl(r,e,t,i,a,n,s){var B,x,$,ee;var o=(a&ol)!==0,d=(a&(Ea|Da))!==0,l=r.length,c=e.items,f=e.first,p=f,h,m=null,C,y=[],w=[],k,b,P,O;if(o)for(O=0;O<l;O+=1)k=r[O],b=n(k,O),P=c.get(b),P!==void 0&&((B=P.a)==null||B.measure(),(C??(C=new Set)).add(P));for(O=0;O<l;O+=1){if(k=r[O],b=n(k,O),P=c.get(b),P===void 0){var te=p?p.e.nodes_start:t;m=eo(te,e,m,m===null?e.first:m.next,k,b,O,i,a,s),c.set(b,m),y=[],w=[],p=m.next;continue}if(d&&Il(P,k,O,a),P.e.f&Gt&&(Di(P.e),o&&((x=P.a)==null||x.unfix(),(C??(C=new Set)).delete(P))),P!==p){if(h!==void 0&&h.has(P)){if(y.length<w.length){var re=w[0],L;m=re.prev;var ve=y[0],Q=y[y.length-1];for(L=0;L<y.length;L+=1)Ia(y[L],re,t);for(L=0;L<w.length;L+=1)h.delete(w[L]);Yt(e,ve.prev,Q.next),Yt(e,m,ve),Yt(e,Q,re),p=re,m=Q,O-=1,y=[],w=[]}else h.delete(P),Ia(P,p,t),Yt(e,P.prev,P.next),Yt(e,P,m===null?e.first:m.next),Yt(e,m,P),m=P;continue}for(y=[],w=[];p!==null&&p.k!==b;)p.e.f&Gt||(h??(h=new Set)).add(p),w.push(p),p=p.next;if(p===null)continue;P=p}y.push(P),m=P,p=P.next}if(p!==null||h!==void 0){for(var J=h===void 0?[]:wa(h);p!==null;)p.e.f&Gt||J.push(p),p=p.next;var Fe=J.length;if(Fe>0){var G=a&Fn&&l===0?t:null;if(o){for(O=0;O<Fe;O+=1)($=J[O].a)==null||$.measure();for(O=0;O<Fe;O+=1)(ee=J[O].a)==null||ee.fix()}Xl(e,J,G,c)}}o&&ui(()=>{var D;if(C!==void 0)for(P of C)(D=P.a)==null||D.apply()}),qe.first=e.first&&e.first.e,qe.last=m&&m.e}function Il(r,e,t,i){i&Ea&&It(r.v,e),i&Da?It(r.i,t):r.i=t}function eo(r,e,t,i,a,n,s,o,d,l){var c=(d&Ea)!==0,f=(d&cl)===0,p=c?f?Wi(a):ft(a):a,h=d&Da?ft(s):s,m={i:h,v:p,k:n,a:null,e:null,prev:t,next:i};try{return m.e=ci(()=>o(r,p,h,l),Nn),m.e.prev=t&&t.e,m.e.next=i&&i.e,t===null?e.first=m:(t.next=m,t.e.next=m.e),i!==null&&(i.prev=m,i.e.prev=m.e),m}finally{}}function Ia(r,e,t){for(var i=r.next?r.next.e.nodes_start:t,a=e?e.e.nodes_start:t,n=r.e.nodes_start;n!==i;){var s=Lr(n);a.before(n),n=s}}function Yt(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function ns(r){var e,t,i="";if(typeof r=="string"||typeof r=="number")i+=r;else if(typeof r=="object")if(Array.isArray(r)){var a=r.length;for(e=0;e<a;e++)r[e]&&(t=ns(r[e]))&&(i&&(i+=" "),i+=t)}else for(t in r)r[t]&&(i&&(i+=" "),i+=t);return i}function to(){for(var r,e,t=0,i="",a=arguments.length;t<a;t++)(r=arguments[t])&&(e=ns(r))&&(i&&(i+=" "),i+=e);return i}function yi(r){return typeof r=="object"?to(r):r??""}function Vt(r,e,t,i){var a=r.__attributes??(r.__attributes={});a[e]!==(a[e]=t)&&(e==="style"&&"__styles"in r&&(r.__styles={}),e==="loading"&&(r[Qs]=t),t==null?r.removeAttribute(e):typeof t!="string"&&io(r).includes(e)?r[e]=t:r.setAttribute(e,t))}var en=new Map;function io(r){var e=en.get(r.nodeName);if(e)return e;en.set(r.nodeName,e=[]);for(var t,i=r,a=Element.prototype;a!==i;){t=En(i);for(var n in t)t[n].set&&e.push(n);i=Ta(i)}return e}function Ce(r,e,t){var i=r.__className,a=ro(e,t);(i!==a||Nn)&&(e==null&&!t?r.removeAttribute("class"):r.className=a,r.__className=a)}function ro(r,e){return(r??"")+(e?" "+e:"")}const ao=()=>performance.now(),Ut={tick:r=>requestAnimationFrame(r),now:()=>ao(),tasks:new Set};function ss(){const r=Ut.now();Ut.tasks.forEach(e=>{e.c(r)||(Ut.tasks.delete(e),e.f())}),Ut.tasks.size!==0&&Ut.tick(ss)}function no(r){let e;return Ut.tasks.size===0&&Ut.tick(ss),{promise:new Promise(t=>{Ut.tasks.add(e={c:r,f:t})}),abort(){Ut.tasks.delete(e)}}}function cr(r,e){Ba(()=>{r.dispatchEvent(new CustomEvent(e))})}function so(r){if(r==="float")return"cssFloat";if(r==="offset")return"cssOffset";if(r.startsWith("--"))return r;const e=r.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function tn(r){const e={},t=r.split(";");for(const i of t){const[a,n]=i.split(":");if(!a||n===void 0)break;const s=so(a.trim());e[s]=n.trim()}return e}const lo=r=>r;function ai(r,e,t,i){var a=(r&hl)!==0,n=(r&gl)!==0,s=a&&n,o=(r&yl)!==0,d=s?"both":a?"in":"out",l,c=e.inert,f=e.style.overflow,p,h;function m(){var b=He,P=qe;Et(null),Dt(null);try{return l??(l=t()(e,(i==null?void 0:i())??{},{direction:d}))}finally{Et(b),Dt(P)}}var C={is_global:o,in(){var b;if(e.inert=c,!a){h==null||h.abort(),(b=h==null?void 0:h.reset)==null||b.call(h);return}n||p==null||p.abort(),cr(e,"introstart"),p=oa(e,m(),h,1,()=>{cr(e,"introend"),p==null||p.abort(),p=l=void 0,e.style.overflow=f})},out(b){if(!n){b==null||b(),l=void 0;return}e.inert=!0,cr(e,"outrostart"),h=oa(e,m(),p,0,()=>{cr(e,"outroend"),b==null||b()})},stop:()=>{p==null||p.abort(),h==null||h.abort()}},y=qe;if((y.transitions??(y.transitions=[])).push(C),a&&la){var w=o;if(!w){for(var k=y.parent;k&&k.f&Fr;)for(;(k=k.parent)&&!(k.f&Pr););w=!k||(k.f&An)!==0}w&&Oi(()=>{Rt(()=>C.in())})}}function oa(r,e,t,i,a){var n=i===1;if(Vs(e)){var s,o=!1;return ui(()=>{if(!o){var y=e({direction:n?"in":"out"});s=oa(r,y,t,i,a)}}),{abort:()=>{o=!0,s==null||s.abort()},deactivate:()=>s.deactivate(),reset:()=>s.reset(),t:()=>s.t()}}if(t==null||t.deactivate(),!(e!=null&&e.duration))return a(),{abort:Kt,deactivate:Kt,reset:Kt,t:()=>i};const{delay:d=0,css:l,tick:c,easing:f=lo}=e;var p=[];if(n&&t===void 0&&(c&&c(0,1),l)){var h=tn(l(0,1));p.push(h,h)}var m=()=>1-i,C=r.animate(p,{duration:d});return C.onfinish=()=>{var y=(t==null?void 0:t.t())??1-i;t==null||t.abort();var w=i-y,k=e.duration*Math.abs(w),b=[];if(k>0){var P=!1;if(l)for(var O=Math.ceil(k/16.666666666666668),te=0;te<=O;te+=1){var re=y+w*f(te/O),L=tn(l(re,1-re));b.push(L),P||(P=L.overflow==="hidden")}P&&(r.style.overflow="hidden"),m=()=>{var ve=C.currentTime;return y+w*f(ve/k)},c&&no(()=>{if(C.playState!=="running")return!1;var ve=m();return c(ve,1-ve),!0})}C=r.animate(b,{duration:k,fill:"forwards"}),C.onfinish=()=>{m=()=>i,c==null||c(i,1-i),a()}},{abort:()=>{C&&(C.cancel(),C.effect=null,C.onfinish=Kt)},deactivate:()=>{a=Kt},reset:()=>{i===0&&(c==null||c(1,0))},t:()=>m()}}function ca(r,e,t=e){var i=Bi();Hr(r,"input",a=>{var n=a?r.defaultValue:r.value;if(n=Qr(r)?Xr(n):n,t(n),i&&n!==(n=e())){var s=r.selectionStart,o=r.selectionEnd;r.value=n??"",o!==null&&(r.selectionStart=s,r.selectionEnd=Math.min(o,r.value.length))}}),Rt(e)==null&&r.value&&t(Qr(r)?Xr(r.value):r.value),er(()=>{var a=e();Qr(r)&&a===Xr(r.value)||r.type==="date"&&!a&&!r.value||a!==r.value&&(r.value=a??"")})}const Kr=new Set;function mi(r,e,t,i,a=i){var n=t.getAttribute("type")==="checkbox",s=r;if(e!==null)for(var o of e)s=s[o]??(s[o]=[]);s.push(t),Hr(t,"change",()=>{var d=t.__value;n&&(d=co(s,d,t.checked)),a(d)},()=>a(n?[]:null)),er(()=>{var d=i();n?(d=d||[],t.checked=d.includes(t.__value)):t.checked=qn(t.__value,d)}),jn(()=>{var d=s.indexOf(t);d!==-1&&s.splice(d,1)}),Kr.has(s)||(Kr.add(s),ui(()=>{s.sort((d,l)=>d.compareDocumentPosition(l)===4?-1:1),Kr.delete(s)})),ui(()=>{})}function oo(r,e,t=e){Hr(r,"change",i=>{var a=i?r.defaultChecked:r.checked;t(a)}),Rt(e)==null&&t(r.checked),er(()=>{var i=e();r.checked=!!i})}function co(r,e,t){for(var i=new Set,a=0;a<r.length;a+=1)r[a].checked&&i.add(r[a].__value);return t||i.delete(e),Array.from(i)}function Qr(r){var e=r.type;return e==="number"||e==="range"}function Xr(r){return r===""?null:+r}function ls(r,e,t){if(r.multiple)return fo(r,e);for(var i of r.options){var a=Gi(i);if(qn(a,e)){i.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function uo(r,e){Oi(()=>{var t=new MutationObserver(()=>{var i=r.__value;ls(r,i)});return t.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{t.disconnect()}})}function Zi(r,e,t=e){var i=!0;Hr(r,"change",a=>{var n=a?"[selected]":":checked",s;if(r.multiple)s=[].map.call(r.querySelectorAll(n),Gi);else{var o=r.querySelector(n)??r.querySelector("option:not([disabled])");s=o&&Gi(o)}t(s)}),Oi(()=>{var a=e();if(ls(r,a,i),i&&a===void 0){var n=r.querySelector(":checked");n!==null&&(a=Gi(n),t(a))}r.__value=a,i=!1}),uo(r)}function fo(r,e){for(var t of r.options)t.selected=~e.indexOf(Gi(t))}function Gi(r){return"__value"in r?r.__value:r.value}function rn(r,e){return r===e||(r==null?void 0:r[jt])===e}function vo(r={},e,t,i){return Oi(()=>{var a,n;return er(()=>{a=n,n=[],Rt(()=>{r!==t(...n)&&(e(r,...n),a&&rn(t(...a),r)&&e(null,...a))})}),()=>{ui(()=>{n&&rn(t(...n),r)&&e(null,...n)})}}),r}function _t(r=!1){const e=Qe,t=e.l.u;if(!t)return;let i=()=>Ul(e.s);if(r){let a=0,n={};const s=Yi(()=>{let o=!1;const d=e.s;for(const l in d)d[l]!==n[l]&&(n[l]=d[l],o=!0);return o&&a++,a});i=()=>v(s)}t.b.length&&El(()=>{an(e,i),ra(t.b)}),Ka(()=>{const a=Rt(()=>t.m.map(Ws));return()=>{for(const n of a)typeof n=="function"&&n()}}),t.a.length&&Ka(()=>{an(e,i),ra(t.a)})}function an(r,e){if(r.l.s)for(const t of r.l.s)v(t);e()}const _i=[];function po(r,e=Kt){let t=null;const i=new Set;function a(o){if(Bn(r,o)&&(r=o,t)){const d=!_i.length;for(const l of i)l[1](),_i.push(l,r);if(d){for(let l=0;l<_i.length;l+=2)_i[l][0](_i[l+1]);_i.length=0}}}function n(o){a(o(r))}function s(o,d=Kt){const l=[o,d];return i.add(l),i.size===1&&(t=e(a,n)||Kt),o(r),()=>{i.delete(l),i.size===0&&t&&(t(),t=null)}}return{set:a,update:n,subscribe:s}}let ur=!1;function ho(r){var e=ur;try{return ur=!1,[r(),ur]}finally{ur=e}}function Be(r,e,t,i){var re;var a=(t&ul)!==0,n=!Ii||(t&dl)!==0,s=(t&vl)!==0,o=(t&pl)!==0,d=!1,l;s?[l,d]=ho(()=>r[e]):l=r[e];var c=jt in r||Ks in r,f=s&&(((re=ki(r,e))==null?void 0:re.set)??(c&&e in r&&(L=>r[e]=L)))||void 0,p=i,h=!0,m=!1,C=()=>(m=!0,h&&(h=!1,o?p=Rt(i):p=i),p);l===void 0&&i!==void 0&&(f&&n&&tl(),l=C(),f&&f(l));var y;if(n)y=()=>{var L=r[e];return L===void 0?C():(h=!0,m=!1,L)};else{var w=(a?Yi:_e)(()=>r[e]);w.f|=xn,y=()=>{var L=v(w);return L!==void 0&&(p=void 0),L===void 0?p:L}}if(!(t&fl))return y;if(f){var k=r.$$legacy;return function(L,ve){return arguments.length>0?((!n||!ve||k||d)&&f(ve?y():L),L):y()}}var b=!1,P=!1,O=Wi(l),te=Yi(()=>{var L=y(),ve=v(O);return b?(b=!1,P=!0,ve):(P=!1,O.v=L)});return a||(te.equals=ba),function(L,ve){if(Xt!==null&&(b=P,y(),v(O)),arguments.length>0){const Q=ve?v(te):n&&s?Qt(L):L;return te.equals(Q)||(b=!0,K(O,Q),m&&p!==void 0&&(p=Q),Rt(()=>v(te))),L}return v(te)}}const go="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(go);ll();class yo{constructor(e,t,i){u(this,"_dbname");u(this,"_dbversion");u(this,"dbPromise");u(this,"getTran",async(e,t)=>(await this.dbPromise).transaction(e,t));u(this,"reset",async()=>(await indexedDB.databases().then(e=>{console.log(e)}),await new Promise((e,t)=>{const i=indexedDB.deleteDatabase(this._dbname);i.onsuccess=()=>{console.log("onsuccess"),e()},i.onerror=a=>{console.log("onerror"),t(a)}})));u(this,"getAll",async e=>{const t=await this.dbPromise;return new Promise((i,a)=>{const o=t.transaction([e],"readonly").objectStore(e).getAll();o.onsuccess=()=>{i(o.result)},o.onerror=d=>{a(d)}})});u(this,"get",async(e,t)=>{const i=await this.dbPromise;return new Promise((a,n)=>{const d=i.transaction([e],"readonly").objectStore(e).get(t);d.onsuccess=()=>{a(d.result)},d.onerror=l=>{n(l)}})});u(this,"getMany",async(e,t)=>{const n=(await this.dbPromise).transaction([e],"readonly").objectStore(e),s=t.map(o=>new Promise((d,l)=>{const c=n.get(o);c.onsuccess=()=>{d(c.result)},c.onerror=f=>{l(f)}}));return await Promise.all(s)});u(this,"putRecords",async(e,t)=>{const a=(await this.dbPromise).transaction([e],"readwrite"),n=a.objectStore(e),s=t.map(o=>({record:o,request:n.put(o)}));return new Promise((o,d)=>{a.oncomplete=()=>o(s.map(l=>Object.assign({id:l.request.result},l.record))),a.onerror=l=>d(l)})});u(this,"deleteRecords",async(e,t)=>{const a=(await this.dbPromise).transaction([e],"readwrite"),n=a.objectStore(e),s=t.map(o=>({key:o,request:n.delete(o)}));return new Promise((o,d)=>{a.oncomplete=()=>{console.log(s.map(l=>l.request.result)),o()},a.onerror=l=>d(l)})});this._dbname=e,this._dbversion=t,this.dbPromise=new Promise((a,n)=>{const s=indexedDB.open(e,t);s.onsuccess=o=>{if(console.log(o),!o.target){console.log("event.target is undefined"),n("event.target is undefined");return}const d=o.target.result;if(!d){console.log("event.target.result is undefined"),n("event.target.result is undefined");return}d.onversionchange=l=>{console.log(l),d.close()},a(d)},s.onupgradeneeded=o=>{console.log("onupgradeneeded");const d=o.target.result;i.filter(l=>!d.objectStoreNames.contains(l)).map(l=>d.createObjectStore(l,{keyPath:"id",autoIncrement:!0}))},s.onerror=o=>{console.log(o),n(o)},s.onblocked=o=>{console.log(o),n(o)}}),console.log(this.dbPromise)}get dbversion(){return this._dbversion}}class We{constructor(){u(this,"handlers",[])}append(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}trigger(e){this.handlers.slice(0).filter(t=>t(e)==="RemoveMe").forEach(t=>this.remove(t))}clear(){this.handlers.splice(0)}expose(){return this}}class nn{constructor(){u(this,"handlers",[])}append(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}async trigger(e){const t=await Promise.all(this.handlers.slice(0).map(async i=>{const a=await i(e);return{h:i,result:a}}));console.log(t),t.filter(i=>i.result==="RemoveMe").map(i=>i.h).forEach(i=>this.remove(i))}clear(){this.handlers.splice(0)}expose(){return this}}class sn{constructor(){u(this,"handler")}set(e){this.handler=e}async call(e){if(!this.handler)throw Error("illegal state error");return await this.handler(e)}expose(){return this}}class Fa{constructor(e,t,i,a){u(this,"_name");u(this,"_createVersion");u(this,"mountResolver",()=>{});u(this,"_indexedDb");u(this,"onInsertEvent",new We);u(this,"onBeforeInsertEvent",new sn);u(this,"onUpdateEvent",new We);u(this,"onBeforeUpdateEvent",new sn);u(this,"onDeleteEvent",new We);u(this,"prepareInitialRecords",()=>{const e=new Date;return this._prepareInitialRecords().map(t=>Object.assign(t,{createdAt:e,updatedAt:e,dbVersion:this._createVersion}))});u(this,"resolveMount",()=>this.mountResolver());u(this,"patchForInsert",(e,t)=>{e.newRecords.forEach(i=>{t[i.id]=i})});u(this,"patchForUpdate",(e,t)=>{e.recordPairs.forEach(i=>{t[i.newRecord.id]={...i.newRecord}})});u(this,"patchForDelete",(e,t)=>{e.oldRecords.forEach(i=>{delete t[i.id]})});this._indexedDb=e,this._name=t,this._createVersion=e.dbversion,this.getAll().then(n=>n.reduce((s,o)=>(s[o.id]=o,s),{})).then(n=>{console.log(this.name,n),this.onBeforeInsertEvent.set(i??(()=>Promise.resolve())),this.onBeforeUpdateEvent.set(a??(()=>Promise.resolve()))})}get name(){return this._name}get createVersion(){return this._createVersion}get oninsert(){return this.onInsertEvent.expose()}get onbeforeinsert(){return this.onBeforeInsertEvent.expose()}get onupdate(){return this.onUpdateEvent.expose()}get onbeforeupdate(){return this.onBeforeUpdateEvent.expose()}get ondelete(){return this.onDeleteEvent.expose()}getAll(){return this._indexedDb.getAll(this.name)}get(e){return this._indexedDb.get(this.name,e)}async insertMany(e){const t=new Date,i=e.map(n=>{const s={createdAt:t,updatedAt:t,dbVersion:this._createVersion};return Object.assign(n,s)});await this.onBeforeInsertEvent.call({sender:this,newRecords:i,timestamp:t});const a=await this._indexedDb.putRecords(this.name,i);return this.onInsertEvent.trigger({sender:this,newRecords:a,timestamp:t}),a}async insert(e){return(await this.insertMany([e]))[0]}async updateMany(e,t){const i=new Date,a=[];return(await this._indexedDb.getMany(this.name,e)).forEach(s=>{const o={...s},d={...o};a.push({newRecord:Object.assign(t(d),{updatedAt:i,dbVersion:this._createVersion}),oldRecord:o})}),await this.onBeforeUpdateEvent.call({sender:this,recordPairs:a,timestamp:i}),await this._indexedDb.putRecords(this.name,a.map(s=>s.newRecord)),this.onUpdateEvent.trigger({sender:this,recordPairs:a,timestamp:i}),a.map(s=>s.newRecord)}async update(e,t){return(await this.updateMany([e],t))[0]}async delete(e){const t=new Date,i=await this._indexedDb.getMany(this.name,e);await this._indexedDb.deleteRecords(this.name,e),this.onDeleteEvent.trigger({sender:this,oldRecords:i,timestamp:t})}}const mo=["Deck","ExtraDeck"],_o={Deck:"メインデッキ",ExtraDeck:"エクストラデッキ"},ua=["Monster","Spell","Trap","XyzMaterial"],os={Monster:"モンスター",Spell:"魔法",Trap:"罠",XyzMaterial:"XYZ素材"},Ai=["Fusion","Syncro","Xyz","Link"],cs=[...Ai,"SpecialSummon","Ritual"],So=["Toon","Spirit","Union","Gemini","FlipEffect"],Co=["Tuner","Effect","Normal","Pendulum","Token","FreeReborn","NormalSummonOnly","RegularSpecialSummonOnly"],ln=[...cs,...So,...Co],$r={Syncro:"シンクロ",Fusion:"融合",Xyz:"エクシーズ",Link:"リンク",Ritual:"儀式",SpecialSummon:"特殊召喚",Toon:"トゥーン",Spirit:"スピリット",Union:"ユニオン",Gemini:"デュアル",FlipEffect:"リバース",Tuner:"チューナー",Effect:"効果",Normal:"通常",Pendulum:"ペンデュラム",Token:"トークン",FreeReborn:"特殊召喚モンスター（蘇生制限なし）",NormalSummonOnly:"特殊召喚不可",RegularSpecialSummonOnly:"正規の方法以外での特殊召喚不可"},ir={Syncro:"🎵",Fusion:"🌀",Xyz:"📰",Link:"⛓️",Ritual:"📜",SpecialSummon:"🔯",Toon:"📖",Spirit:"👻",Union:"🚗",Gemini:"👫",FlipEffect:"🔄",Tuner:"🎶",Effect:"✨",Normal:"🔘",Pendulum:"💠",Token:"🐏",FreeReborn:"🆓",NormalSummonOnly:"🔲",RegularSpecialSummonOnly:"❗"},on=["Light","Dark","Earth","Water","Fire","Wind","Divine"],Oa={Light:"光",Dark:"闇",Earth:"地",Water:"水",Fire:"炎",Wind:"風",Divine:"神"},cn=["Aqua","Beast","BeastWarrior","CreatorGod","Cyberse","Dinosaur","DivineBeast","Dragon","Fairy","Fiend","Fish","Insect","Illusion","Machine","Plant","Psychic","Pyro","Reptile","Rock","SeaSerpent","Spellcaster","Thunder","Warrior","WingedBeast","Wyrm","Zombie"],un=["Normal","Continuous","Field","QuickPlay","Equip","Ritual","PendulumScale"],rr={Normal:"通常",Continuous:"永続",Field:"フィールド",QuickPlay:"速攻",Equip:"装備",Ritual:"儀式",PendulumScale:"ペンデュラム"},dn=["Normal","Continuous","Counter"],ar={Normal:"通常",Continuous:"永続",Counter:"カウンター"},Ye=["Attack","Defense"],dr={Attack:"攻撃表示",Defense:"守備表示",Set:"裏側守備表示"},us=["level","rank","attack","defense","pendulumScaleR","pendulumScaleL"],ko=({wikiName:r,wikiHref:e,wikiTextAll:t,nameKana:i,description:a,pendulumDescription:n,...s})=>s,wo=r=>ko(r),Zr={Aqua:"水",Beast:"獣",BeastWarrior:"獣戦士",CreatorGod:"創造神",Cyberse:"サイバース",Dinosaur:"恐竜",DivineBeast:"幻獣神",Dragon:"ドラゴン",Fairy:"天使",Fiend:"悪魔",Fish:"魚",Insect:"昆虫",Illusion:"幻想魔",Machine:"機械",Plant:"植物",Psychic:"サイキック",Pyro:"炎",Reptile:"爬虫類",Rock:"岩石",SeaSerpent:"海竜",Spellcaster:"魔法使い",Thunder:"雷",Warrior:"戦士",WingedBeast:"鳥獣",Wyrm:"幻竜",Zombie:"アンデット"},nr={Aqua:"🚰",Beast:"🐅",BeastWarrior:"🦁",CreatorGod:"🔆",Cyberse:"💻️",Dinosaur:"🦖",DivineBeast:"💫",Dragon:"🐲",Fairy:"👼",Fiend:"👿",Fish:"🐟️",Insect:"🦋",Illusion:"🤡",Machine:"🤖",Plant:"🌱",Psychic:"👁️",Pyro:"🔥",Reptile:"🦎",Rock:"⛰",SeaSerpent:"🐍",Spellcaster:"🧙",Thunder:"⚡️",Warrior:"⚔️",WingedBeast:"🦅",Wyrm:"🐉",Zombie:"🦴"},To=["TopLeft","TopCenter","TopRight","MiddleLeft","MiddleRight","BottomLeft","BottomCenter","BottomRight"],ds={TopLeft:{name:"左上",linkArrow:{offsetRow:-1,offsetColumn:-1}},TopCenter:{name:"上",linkArrow:{offsetRow:-1,offsetColumn:0}},TopRight:{name:"右上",linkArrow:{offsetRow:-1,offsetColumn:1}},MiddleLeft:{name:"左",linkArrow:{offsetRow:0,offsetColumn:-1}},MiddleRight:{name:"右",linkArrow:{offsetRow:0,offsetColumn:1}},BottomLeft:{name:"左下",linkArrow:{offsetRow:1,offsetColumn:-1}},BottomCenter:{name:"下",linkArrow:{offsetRow:1,offsetColumn:0}},BottomRight:{name:"右下",linkArrow:{offsetRow:1,offsetColumn:1}}};To.reduce((r,e)=>(r[ds[e].name]=e,r),{});const bo=r=>r.cardId??!1?`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=2&cid=${r.cardId}`:`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=1&sess=1&rp=10&mode=&sort=1&keyword=${r.name}&stype=1&ctype=&othercon=2&starfr=&starto=&pscalefr=&pscaleto=&linkmarkerfr=&linkmarkerto=&link_m=2&atkfr=&atkto=&deffr=&defto=&releaseDStart=1&releaseMStart=1&releaseYStart=1999&releaseDEnd=&releaseMEnd=&releaseYEnd=`,ji=(r,e)=>{const t=r.monsterCategories??[],i=e.monsterCategories??[];for(const a of Ai.toReversed()){if(t.includes(a)&&!i.includes(a))return 1;if(!t.includes(a)&&i.includes(a))return-1}if(r.kind===e.kind){if(r.kind==="Monster"){if((r.link??0)!==(e.link??0))return(r.link??0)-(e.link??0);if((r.rank??0)!==(e.rank??0))return(r.rank??0)-(e.rank??0);if((r.level??0)!==(e.level??0))return(r.level??0)-(e.level??0);if((r.attack??0)!==(e.attack??0))return(r.attack??0)-(e.attack??0);if((r.defense??0)!==(e.defense??0))return(r.defense??0)-(e.defense??0)}return r.name.localeCompare(e.name,"Ja")}for(const a of ua){if(r.kind===a)return-1;if(e.kind===a)return 1}return r.name.localeCompare(e.name,"Ja")},kr=(...r)=>r.length?r.reduce((e,t)=>e>t?e:t):-Number.MAX_VALUE,da=(...r)=>r.length?r.reduce((e,t)=>e<t?e:t):Number.MAX_VALUE,Si=(r,e)=>{if((r[0]??Number.MAX_VALUE)>e)return 0;if(r.slice(-1)[0]<e)return r.length;let t=0,i=r.length-1;for(;;){const a=Math.round((t+i)/2);if(a===i||a===t)return r[t]<e?i:t;if(r[a]<e){t=a;continue}i=a}},xt=[3,5,5,6,6,6,7,8,9,10,11,11,11,12,12,13,13,14,15,15,15,15,15,15,16,16,16,17,18,18,18,21,21,21,22,23,25,25,26,28,28,28,30,30,31,32,32,33,33,34,35,35,36,36,36,37,37,38,38,38,39,41,42,42,43,45,45,45,45,48,48,48,50,51,52,54,54,54,54,56,57,58,59,59,59,59,60,61,63,65,65,65,65,66,67,67,67,69,69,71,71,72,73,73,73,73,73,74,75,75,76,76,77,78,79,80,80,80,80,84,84,84,84,84,84,85,85,85,87,90,91,94,96,96,97,98,101,101,101,101,101];console.log(xt.length);xt.forEach((r,e)=>{((xt[Si(xt,e)-1]||-Number.MAX_VALUE)>=e||(xt[Si(xt,e)]||Number.MAX_VALUE)<e)&&console.log(e,Si(xt,e),(xt[Si(xt,e)-1]||-Number.MAX_VALUE)<e,(xt[Si(xt,e)]||Number.MAX_VALUE)>=e)});const wt=class wt{constructor(e){u(this,"id");u(this,"name");u(this,"description");u(this,"previousNpcId");u(this,"previousNpcDeckId");u(this,"previousStartMode");u(this,"save",async e=>{console.log(this.previousNpcDeckId,Number.MIN_SAFE_INTEGER);const t=e??{id:this.id,name:this.name,description:this.description,previousNpcId:this.previousNpcId,previousStartMode:this.previousStartMode,previousNpcDeckId:this.previousNpcDeckId>-1?this.previousNpcDeckId:Number.MIN_SAFE_INTEGER};console.log(this.previousNpcDeckId,Number.MIN_SAFE_INTEGER,t);const i=await wt.tblHeader.update(this.id,a=>({...a,...t}));return console.log(this.previousNpcDeckId,Number.MIN_SAFE_INTEGER,t,i),new wt(i)});var t;this.id=e.id,this.name=e.name,this.description=e.description,this.previousNpcId=((t=Vi.find(i=>i.id===e.previousNpcId))==null?void 0:t.id)??da(...Vi.map(i=>i.id)),this.previousStartMode=bc.includes(e.previousStartMode)?e.previousStartMode:"Random",this.previousNpcDeckId=e.previousNpcDeckId}get npcLvl(){return Number.MAX_VALUE}};u(wt,"tblHeader"),u(wt,"getOrCreateNew",async e=>{wt.tblHeader||(wt.tblHeader=new Eo(e));const t=await wt.tblHeader.getAll();if(t.length)return console.log(t[0].previousNpcDeckId),new wt(t[0]);const i=await wt.tblHeader.insert({name:"あなた",description:"ここの文字列を何に使うかは未定。",previousNpcId:0,previousNpcDeckId:Number.MIN_SAFE_INTEGER,previousStartMode:"Random"});return new wt(i)});let fa=wt;class Eo extends Fa{constructor(t){super(t,"TblDuelistProfile");u(this,"_prepareInitialRecords",()=>[])}}let Jr=-1;const Vi=[{id:Jr--,name:"サンドバッグくん棒立ち",description:"攻撃宣言なし、強制効果以外の効果の発動なし。",npcLvl:0},{id:Jr--,name:"サンドバッグくん非暴力",description:"攻撃宣言なし。",npcLvl:100},{id:Jr--,name:"サンドバッグくん白帯",description:"とくに制限なし。",npcLvl:200}];Array.prototype.shuffle=function(){return this.map(e=>({item:e,seq:Math.random()})).toSorted((e,t)=>e.seq-t.seq).map(e=>e.item)};Array.prototype.randomPickMany=function(r){return this.shuffle().slice(0,r)};Array.prototype.randomPick=function(){return this.shuffle().slice(0,1)[0]};Array.prototype.reset=function(...r){this.splice(0),this.push(...r)};Array.prototype.union=function(r){return this.filter(e=>r.find(t=>e===t))};Array.prototype.getAllOnOffPattern=function(){const r=[];return this.forEach(e=>{if(r.length==0){r.push([e]),r.push([]);return}r.forEach(t=>r.push([...t,e]))}),r};Array.prototype.getDistinct=function(){return Array.from(new Set(this))};Array.prototype.distinct=function(){this.reset(...this.getDistinct())};const Er=class Er{constructor(e,t,i){u(this,"seq");u(this,"entity");u(this,"_definition");u(this,"validateDuelist",e=>this.entity.controller===e?this.definition.executableDuelistTypes.includes("Controller"):this.definition.executableDuelistTypes.includes("Opponent"));this.seq=e==="AutoSeq"?Er.nextSeq++:e,this.entity=t,this._definition=i}get definition(){return this._definition}get title(){return this.definition.title}get isMandatory(){return this.definition.isMandatory}get executableCells(){return this.definition.executableCells}get executablePeriods(){return this.definition.executablePeriods}get executableDuelistTypes(){return this.definition.executableDuelistTypes}get isOnlyNTimesPerDuel(){return this.definition.isOnlyNTimesPerDuel??0}get isOnlyNTimesPerTurn(){return this.definition.isOnlyNTimesPerTurn??0}get isOnlyNTimesPerTurnIfFaceup(){return this.definition.isOnlyNTimesPerTurnIfFaceup??0}get isOnlyNTimesIfFaceup(){return this.definition.isOnlyNTimesIfFaceup??0}get isOnlyNTimesPerChain(){return this.definition.isOnlyNTimesPerChain??0}get actionGroupName(){return this.definition.actionGroupName}get duel(){return this.entity.duel}};u(Er,"nextSeq",0);let wr=Er;const Oe=class Oe{constructor(){}};u(Oe,"_tryMarkForDestory",(e,t)=>{if(e.info.isDying||e.status.kind==="XyzMaterial"||!e.isOnFieldStrictly&&e.fieldCell.cellType!=="Deck"&&e.fieldCell.cellType!=="Hand")return!1;const i=t.action.playType==="Battle"?"BattleDestroy":"EffectDestroy",a=i==="BattleDestroy"&&t.action.entity===e?t.selectedEntities[0]:t.action.entity;return e.info.isDying=e.validateDestory(i,t.activator,a,t.action),e.info.isDying&&(e.info.causeOfDeath=[i],e.info.isKilledBy=a,e.info.isKilledByWhom=t.activator,i==="BattleDestroy"&&(e.info.isKilledByWhom=a.controller)),e.info.isDying}),u(Oe,"releaseManyForTheSameReason",(e,t,i,a)=>e.length?(t.includes("Cost")&&a.writeInfoLog(`${e.map(n=>n.toString()).join(" ")}をリリースし――、`),Oe.bringManyToSameCellForTheSameReason("Graveyard","Top",e,"FaceUp","Vertical",["Release",...t],i,a)):Promise.resolve()),u(Oe,"sendManyToGraveyardForTheSameReason",(e,t,i,a)=>e.length?(a&&t.includes("Cost")&&(t.includes("FusionMaterial")?a.writeInfoLog(`${e.map(n=>n.toString()).join(" ")}を融合素材とし――、`):t.includes("SyncroMaterial")?a.writeInfoLog(`${e.map(n=>n.toString()).join(" ")}をシンクロと素材し――、`):t.includes("LinkMaterial")?a.writeInfoLog(`${e.map(n=>n.toString()).join(" ")}をリンクマーカーにセッティング――、`):a.writeInfoLog(`${e.map(n=>n.toString()).join(" ")}を墓地に送り――、`)),Oe.bringManyToSameCellForTheSameReason("Graveyard","Top",e,"FaceUp","Vertical",t,i,a)):Promise.resolve()),u(Oe,"addManyToHand",(e,t,i,a)=>e.length?Oe.bringManyToSameCellForTheSameReason("Hand","Bottom",e,"FaceDown","Vertical",t,i,a):Promise.resolve()),u(Oe,"discardManyForTheSameReason",(e,t,i,a)=>e.length?(a&&t.includes("Cost")&&a.writeInfoLog(`${e.map(n=>n.toString()).join(" ")}を手札から捨て――、`),Oe.bringManyToSameCellForTheSameReason("Graveyard","Top",e,"FaceUp","Vertical",["Discard",...t],i,a)):Promise.resolve()),u(Oe,"banishManyForTheSameReason",(e,t,i,a)=>e.length?(a&&t.includes("Cost")&&a.writeInfoLog(`${e.map(n=>n.toString()).join(" ")}をゲームから除外し――、`),Oe.bringManyToSameCellForTheSameReason("Banished","Top",e,"FaceUp","Vertical",t,i,a)):Promise.resolve()),u(Oe,"returnManyToDeckForTheSameReason",(e,t,i,a,n)=>t.length?(n&&i.includes("Cost")&&n.writeInfoLog(`${t.map(s=>s.toString()).join(" ")}をデッキに戻し――、`),Oe.bringManyToSameCellForTheSameReason("Deck",e,t,"FaceDown","Vertical",i,a,n)):Promise.resolve()),u(Oe,"returnManyToHandForTheSameReason",(e,t,i,a)=>e.length?(a&&t.includes("Cost")&&a.writeInfoLog(`${e.map(n=>n.toString()).join(" ")}を手札に戻し――、`),Oe.bringManyToSameCellForTheSameReason("Hand","Bottom",e,"FaceDown","Vertical",t,i,a)):Promise.resolve()),u(Oe,"convertManyToXyzMaterials",(e,t,i,a)=>e.length?(a&&t.includes("Cost")&&a.writeInfoLog(`${e.map(n=>n.toString()).join(" ")}によって、オーバーレイネットワークを構築――、`),xe.moveMany(e.map(n=>[n,n.fieldCell,"XyzMaterial","FaceUp","Vertical","Top",t,i,a,a]))):Promise.resolve()),u(Oe,"moveToXyzOwner",(e,t,i,a,n)=>t.length?(i.includes("Effect")&&n.writeInfoLog(`${t.map(s=>s.toString()).join(" ")}をXYZ素材として吸収。`),xe.moveMany(t.map(s=>[s,e,"XyzMaterial","FaceUp","Vertical","Top",i,a,n,n]))):Promise.resolve()),u(Oe,"banishMany",(e,t)=>xe.bringManyToSameCell("Banished","Top",e.map(i=>({...i,face:"FaceUp",orientation:"Vertical"})),t)),u(Oe,"bringManyToSameCellForTheSameReason",(e,t,i,a,n,s,o,d)=>xe.bringManyToSameCell(e,t,i.map(l=>({entity:l,face:a,orientation:n,causedAs:s,causedBy:o,activator:d})))),u(Oe,"tryDestroy",async(e,t)=>{const i=await Oe.tryMarkForDestory(e,t);return await Oe.waitCorpseDisposal(t.activator.duel),i}),u(Oe,"waitCorpseDisposal",e=>xe.sendManyToGraveyard([...e.field.getCardsOnFieldStrictly(),...e.field.getPendingCardsOnField()].filter(t=>t.info.isDying).map(t=>({entity:t,causedAs:t.info.causeOfDeath??[],causedBy:t.info.isKilledBy,activator:t.info.isKilledByWhom})))),u(Oe,"tryMarkForDestory",async(e,t)=>{let i=e.filter(o=>Oe._tryMarkForDestory(o,t));if(!i.length)return[];const a=t.action.playType==="Battle"?"BattleDestroy":"EffectDestroy";(await Promise.all(e[0].field.getAllEntities().flatMap(o=>o.substituteEffects.filter(d=>d.isMandatory).filter(d=>d.executableCells.includes(o.fieldCell.cellType)).filter(d=>d.isApplicableTo(a,e,t).length).flatMap(d=>d.substitute(a,e,t))))).flatMap(o=>o).forEach(o=>{o.resetCauseOfDeath()}),i=i.filter(o=>o.info.isDying);let n=e[0].field.getAllEntities().flatMap(o=>o.substituteEffects.filter(d=>!d.isMandatory).filter(d=>d.executableCells.includes(o.fieldCell.cellType)).filter(d=>d.isApplicableTo(a,e,t).length).map(d=>({chooser:o.owner,effect:d,sacrifice:o})));for(const o of n.map(d=>d.sacrifice.controller).getDistinct()){const d=n.filter(c=>c.sacrifice.controller===o),l=await o.duel.view.waitSelectAction(o,d.map(c=>({entity:c.sacrifice,title:c.effect.title,origin:c.effect})),"身代わり効果を適用する？",!0);if(l){if((await l.substitute(a,i,t)).forEach(c=>{c.resetCauseOfDeath()}),i=i.filter(c=>c.info.isDying),!i.length)return[];n=n.filter(c=>c.effect.isApplicableTo(a,e,t).length)}}const s=i.filter(o=>o.info.isDying);return s.forEach(o=>o.duel.log.info(`${o.toString()}を${yc[a]}。`,o.info.isKilledByWhom)),s}),u(Oe,"tryBanish",async(e,t,i)=>{const a=t.filter(n=>n.canBeBanished(e,i.activator,i.action.entity,i.action));return await Oe.banishManyForTheSameReason(a,["Effect"],i.action.entity,i.activator),a.filter(n=>n.fieldCell.cellType==="Banished").filter(n=>n.moveLog.latestRecord.movedBy===i.action.entity)}),u(Oe,"negateSummonMany",(e,t)=>{const i=t.duel.field.getPendingMonstersOnField();return i.forEach(a=>{a.info.summonKinds=[],a.info.materials=[],a.moveLog.negateSummon(e,t)}),t.writeInfoLog(`${i.map(a=>a.toString()).join(" ")}.の召喚は無効にされた。`),i});let fe=Oe;const Do=["NormalSummon","SpecialSummon","FlipSummon"],La=["IgnitionEffect","TriggerEffect","QuickEffect","CardActivation"],Ao=["ChangeBattlePosition","Battle","SpellTrapSet","LingeringEffect"],xo=r=>r==="CardActivation"?"CardActivation":La.some(e=>e===r)?"EffectActivation":"NonActivate",fn=["NormalSummon","AdvanceSummon","SpecialSummon","SpecialSummonFromDeck","SendToGraveyardFromDeck","Draw","SearchFromDeck","BanishFromDeck","BanishFromGraveyard","AddToHandFromGraveyard","ReturnToDeckFromGraveyard","SpecialSummonFromGraveyard","SpecialSummonFromBanished","ReturnToHandFromGraveyard","ReturnToHandFromField","BanishFromField","BanishFromHand","Destroy","DestroyMultiple","DestroyOnField","DestroyMultipleOnField","DestroyOnOpponentField","DestroyMultipleOnOpponentField","DestroyMonsterOnField","DestroyMonstersOnField","DestroySpellTrapOnField","DestroySpellTrapsOnField","SpecialSummonFromHand","SpecialSummonFromExtraDeck","IfNormarlSummonSucceed","IfSpecialSummonSucceed","DamageToOpponent","DamageToSelf","PayLifePoint","DiscordAsCost","DiscordAsEffect","RollDice","BounceToHand","NegateCardEffect","NegateCardActivation","NegateNormalSummon","NegateSpecialSummon"],ni=class ni extends wr{constructor(t,i,a,n){super(t,i,a);u(this,"toString",()=>this.isWithChainBlock&&this.playType!=="CardActivation"?`${this.entity.toString()}の«${this.title}»`:`${this.entity.toString()}の${this.title}`);u(this,"addhocMaterialLimitation");u(this,"getClone",t=>new ni(this.seq,this.entity,this.definition,t));u(this,"getEnableMaterialPatterns",t=>{var i,a;return((a=(i=this.definition).getEnableMaterialPatterns)==null?void 0:a.call(i,t).filter(this.addhocMaterialLimitation))??[]});u(this,"validateCount",(t,i)=>{const a=i.filter(s=>this.isSameGroup(s.action)).length;if(this.isOnlyNTimesPerDuel>0&&this.entity.field.duel.chainBlockLog.records.filter(s=>!s.chainBlockInfo.isNegatedActivationBy).filter(s=>this.isSameGroup(s.chainBlockInfo.action)).filter(s=>s.chainBlockInfo.activator===t).length+a>=this.isOnlyNTimesPerDuel||this.isOnlyNTimesPerTurn>0&&this.entity.field.duel.chainBlockLog.records.filter(s=>!s.chainBlockInfo.isNegatedActivationBy).filter(s=>this.isSameGroup(s.chainBlockInfo.action)).filter(s=>s.clock.turn===this.entity.field.duel.clock.turn).filter(s=>s.chainBlockInfo.activator===t).length+a>=this.isOnlyNTimesPerTurn||this.isOnlyNTimesPerChain>0&&a>=this.isOnlyNTimesPerChain)return!1;const n=a+this.entity.counterHolder.getActionCount(this);return!(this.isOnlyNTimesPerTurnIfFaceup>0&&n>=this.isOnlyNTimesPerTurnIfFaceup||this.isOnlyNTimesIfFaceup>0&&n>=this.isOnlyNTimesIfFaceup)});u(this,"validate",(t,i,a)=>{if(this.playType==="CardActivation"&&this.entity.isOnFieldStrictly&&this.entity.face==="FaceUp"||this.isWithChainBlock&&!this.entity.status.canActivateEffect||a&&this.needsToPayCost||!this.validateCount(t,i))return;const n=kr(0,...i.map(d=>d.chainNumber??-1)),s={index:i.length,chainNumber:this.isWithChainBlock?n+1:void 0,action:this,activator:t,targetChainBlock:i.slice(-1)[0],isActivatedIn:this.entity.fieldCell,isActivatedAt:this.duel.clock.getClone(),costInfo:{},state:"unloaded",dest:void 0,ignoreCost:!1};if(this.definition.canPayCosts&&!a&&!this.definition.canPayCosts(s,this.playType==="AfterChainBlock"?[]:i))return;const o=this.definition.validate(s,this.playType==="AfterChainBlock"?[]:i);if(o)return{action:this,dests:o,originSeq:this.seq}});u(this,"prepare",async(t,i,a,n,s,o)=>{var m,C;let d=s;this.isLikeContinuousSpell&&(this.entity.info.isPending=!0);const l=this.isWithChainBlock?kr(0,...n.map(y=>y.chainNumber??-1))+1:void 0;let c="";if(l!==void 0&&(c+=`チェーン${l}: `),this.playType==="CardActivation"||this.playType==="SpellTrapSet")if(this.entity.fieldCell.cellType==="Hand"){let y=i?[i]:this.entity.status.spellCategory==="Field"?[t.getFieldZone()]:t.getAvailableSpellTrapZones();if(this.entity.status.spellCategory==="Field"){const k=t.getFieldZone().cardEntities;if(k.length){const b=k[0];await fe.sendManyToGraveyardForTheSameReason(t.getFieldZone().cardEntities,["Rule"],this.entity,t),t.writeInfoLog(`フィールド魔法の上書きにより、${b.toString()}は墓地に送られた。`),d=!1}}(m=this.entity.status.monsterCategories)!=null&&m.includes("Pendulum")&&(y=y.filter(k=>k.isAvailableForPendulum));let w=y[0];if(y.length>1){w=y.randomPick();const k=this.playType==="SpellTrapSet"?"セット":"カードの発動",b=await this.duel.view.waitSelectDestination(t,this.entity,y,"カードを移動先へドラッグ",k,d);if(!b)return;w=b}c+="手札から",this.playType==="SpellTrapSet"?c+="魔法・罠カードをセット。":c+=`${this.entity.toString()}を発動。`,t.writeInfoLog(c),(C=this.entity.status.monsterCategories)!=null&&C.includes("Pendulum")?await this.entity.activateAsPendulumScale(w,["CardActivation"],this.entity,t):this.playType==="CardActivation"?await this.entity.activateSpellTrapFromHand(w,this.entity.status.kind,["CardActivation"],this.entity,t):await this.entity.setAsSpellTrap(w,this.entity.status.kind,["SpellTrapSet"],this.entity,t),d=!1}else this.entity.isOnFieldAsSpellTrapStrictly&&this.entity.face==="FaceDown"&&(c+=`セットされていた${this.entity.toString()}を発動。`,t.writeInfoLog(c),await this.entity.setNonFieldMonsterPosition(this.entity.origin.kind,"FaceUp",["Rule"]),d=!1);else l!==void 0&&(c+=`${this.toString()}を発動。`,t.writeInfoLog(c));const f={index:n.length,chainNumber:l,action:this,activator:t,targetChainBlock:a,isActivatedIn:this.entity.fieldCell,isActivatedAt:this.duel.clock.getClone(),costInfo:{},state:"ready",dest:i,ignoreCost:!1};if(console.log(this.definition.payCosts,o),this.definition.payCosts&&!o){const y=await this.definition.payCosts(f,n,d);if(!y)return;f.costInfo=y}const p=await this.definition.prepare(f,n,d);if(p===void 0)return;const h={...p};if(Do.some(y=>y===this.playType)){const y=p.nextChainBlockFilter??(()=>!0);h.nextChainBlockFilter=(w,k)=>k.negateSummon&&y(w,k)}return{...f,...h}});u(this,"execute",async(t,i)=>{if(t.action.isLikeContinuousSpell&&!t.action.entity.isOnField)return this.entity.info.isPending=!1,!1;const a=await this.definition.execute(t,i);return this.entity.determine(),a});u(this,"settle",(t,i)=>(this.isOnlyNTimesPerTurnIfFaceup>0?this.entity.counterHolder.incrementActionCountPerTurn(this):this.isOnlyNTimesIfFaceup>0&&this.entity.counterHolder.incrementActionCount(this),this.definition.settle(t,i)));u(this,"directExecute",async(t,i,a)=>{const n=await this.prepare(t,void 0,i,[],!1,a);if(!n)throw new oe("想定されない状態",this,t,a);console.log(this.entity.toString());const s=await this.execute(n,[]);return console.log(this.entity.toString()),await this.settle(n,[]),s});u(this,"isSame",t=>this.entity.origin.name===t.entity.origin.name&&this.title===t.title);u(this,"isSameGroup",t=>this.actionGroupName?this.entity.origin.name===t.entity.origin.name&&this.actionGroupName===t.actionGroupName:this.isSame(t));u(this,"calcChainBlockTagsForDestroy",t=>{if(!fn.length)return[];const i=["Destroy"];fn.length>1&&i.push("DestroyMultiple");const a=t.filter(d=>d.isOnFieldStrictly);a.length&&(i.push("DestroyOnField"),a.length>1&&i.push("DestroyMultipleOnField"));const n=a.filter(d=>d.status.kind==="Monster");n.length&&(i.push("DestroyMonsterOnField"),n.length>1&&i.push("DestroyMonstersOnField")),a.filter(d=>d.status.kind!=="Monster").length&&(i.push("DestroySpellTrapOnField"),n.length>1&&i.push("DestroySpellTrapsOnField"));const o=a.filter(d=>d.controller!==this.entity.controller);return o.length&&(i.push("DestroyOnOpponentField"),o.length>1&&i.push("DestroyMultipleOnOpponentField")),i});this.addhocMaterialLimitation=n??(()=>!0)}get definition(){return super.definition}get playType(){return this.definition.playType}get spellSpeed(){return this.definition.spellSpeed}get needsToPayCost(){return this.definition.needsToPayCost??!1}get hasToTargetCards(){return this.definition.hasToTargetCards??!1}get isWithChainBlock(){return La.some(t=>t===this.playType)}get isLikeContinuousSpell(){return this.definition.isLikeContinuousSpell||this.entity.isLikeContinuousSpell&&this.playType==="CardActivation"}get negatePreviousBlock(){return this.definition.negatePreviousBlock??!1}get negateSummon(){return this.definition.negateSummon??!1}get priorityForNPC(){return this.definition.priorityForNPC??Number.NaN}};u(ni,"createNew",(t,i)=>new ni("AutoSeq",t,i)),u(ni,"createDummyAction",(t,i,a,n,s)=>({action:ni.createNew(t,{title:i,isMandatory:!1,executableCells:[],executablePeriods:[],executableDuelistTypes:[],playType:"Dammy",spellSpeed:"Dammy",validate:()=>a,prepare:async()=>{},execute:async()=>!1,settle:async()=>!1}),dests:a,battlePosition:n,originSeq:(s==null?void 0:s.seq)??-1}));let bi=ni;const Dr=class Dr{constructor(e,t,i,a,n,s=[]){u(this,"duel");u(this,"seat");u(this,"_entity");u(this,"profile");u(this,"deckInfo");u(this,"info");u(this,"infoOrigin");u(this,"status");u(this,"statusOrigin");u(this,"duelistType");u(this,"lifeLog");u(this,"actionBlackListForNPC");u(this,"_lp");u(this,"initHand");u(this,"writeInfoLog",e=>{this.duel.log.info(e,this)});u(this,"initForDrawPhase",()=>{this.info={...this.infoOrigin}});u(this,"canDiscard",e=>(console.log(e),!0));u(this,"canSendToGraveyard",e=>(console.log(e),!0));u(this,"canRelease",e=>(console.log(e),!0));u(this,"canTryBanish",(e,t,i)=>this.entity.procFilterBundle.operators.filter(a=>a.procTypes.includes(t)).every(a=>a.filter(this,this.entity,i,[e])));u(this,"battleDamage",(e,t)=>this.setLp(this._lp-e,t,"BattleDamage"));u(this,"effectDamage",(e,t)=>this.setLp(this._lp-e,t,"EffectDamage"));u(this,"lostLp",(e,t)=>this.setLp(this._lp-e,t,"Lost"));u(this,"payLp",(e,t)=>this.setLp(this._lp-e,t,"Pay"));u(this,"heal",(e,t)=>this.setLp(this._lp+e,t,"Heal"));u(this,"setLp",(e,t,i)=>{const a={clock:this.duel.clock,reason:i||"Set",beforeLp:this._lp,afterLp:e,entity:t};return this.lifeLog.push(a),this._lp=e,this.writeInfoLog(`ライフポイント変動：${a.afterLp-a.beforeLp}（${a.beforeLp} ⇒ ${a.afterLp}）`),a});u(this,"getOpponentPlayer",()=>this.duel.firstPlayer===this?this.duel.secondPlayer:this.duel.firstPlayer);u(this,"getHandCell",()=>this.duel.field.getCells("Hand").filter(e=>e.owner===this)[0]);u(this,"getDeckCell",()=>this.duel.field.getCells("Deck").filter(e=>e.owner===this)[0]);u(this,"getExtraDeck",()=>this.duel.field.getCells("ExtraDeck").filter(e=>e.owner===this)[0]);u(this,"getGraveyard",()=>this.duel.field.getCells("Graveyard").filter(e=>e.owner===this)[0]);u(this,"getFieldZone",()=>this.duel.field.getCells("FieldSpellZone").filter(e=>e.owner===this)[0]);u(this,"getBanished",()=>this.duel.field.getCells("Banished").filter(e=>e.owner===this)[0]);u(this,"getMonsterZones",()=>this.duel.field.getCells("MonsterZone").filter(e=>e.owner===this));u(this,"getExtraMonsterZones",()=>this.duel.field.getCells("ExtraMonsterZone").filter(e=>{var t;return((t=e.cardEntities[0])==null?void 0:t.controller)===this}));u(this,"getSpellTrapZones",()=>this.duel.field.getCells("SpellAndTrapZone").filter(e=>e.owner===this));u(this,"getXyzMaterialZone",()=>this.duel.field.getCells("XyzMaterialZone").filter(e=>e.owner===this)[0]);u(this,"getEmptyMonsterZones",()=>this.getMonsterZones().filter(e=>e.cardEntities.length===0));u(this,"getEmptyExtraZones",()=>this.getExtraMonsterZones().length===0?this.getMonsterZones().filter(e=>e.cardEntities.length===0):[]);u(this,"getAvailableMonsterZones",()=>this.getMonsterZones().filter(e=>e.isAvailable));u(this,"getAvailableExtraZones",()=>this.getExtraMonsterZones().length===0?this.duel.field.getCells("ExtraMonsterZone").filter(e=>e.isAvailable):[]);u(this,"getAvailableSpellTrapZones",()=>this.getSpellTrapZones().filter(e=>e.isAvailable));u(this,"getReleasableMonsters",()=>this.getMonstersOnField());u(this,"getMonstersOnField",()=>this.duel.field.getMonstersOnFieldStrictly().filter(e=>e.controller===this));u(this,"getPendingMonstersOnField",()=>this.duel.field.getPendingMonstersOnField().filter(e=>e.controller===this));u(this,"getPendulumScaleMonsters",()=>this.duel.field.getCardsOnFieldStrictly().filter(e=>e.isPendulumScale).filter(e=>e.controller===this));u(this,"getPendulumScales",()=>{const e=this.getPendulumScaleMonsters();if(e.length<2)return;const t=e.find(s=>s.fieldCell.column===(this.seat==="Below"?1:5)),i=e.find(s=>s.fieldCell.column===(this.seat==="Below"?5:1));if(!t||!i)throw new oe("想定されない状態",e);const a=t.psR,n=t.psL;if(a===void 0||n===void 0)throw new oe("想定されない状態",e);return a>n?{upperBound:a,lowerBound:n}:{upperBound:n,lowerBound:a}});u(this,"getEntiteisOnField",()=>this.duel.field.getCardsOnFieldStrictly().filter(e=>e.controller===this));u(this,"pushDeck",()=>{this.deckInfo.cardNames.map(e=>pt[e]).filter(e=>e).forEach(e=>xe.createCardEntity(this,e)),this.duel.log.info(`デッキをセット。メイン${this.getDeckCell().cardEntities.length}枚。エクストラ${this.getExtraDeck().cardEntities.length}枚。`,this)});u(this,"draw",async(e,t,i)=>{var s;if(e<1)return;const a=this.getDeckCell(),n=[];this.writeInfoLog(`デッキからカードを${e}枚ドロー。`);for(const o of Array(e)){if(!a.cardEntities.length)throw this.writeInfoLog(n.length>0?`デッキからカードを${e}枚ドローしようとしたが、${n.length}枚しかドローできなかった。${n}`:"デッキからカードをドローできなかった。"),this.duel.isEnded=!0,this.setLp(0),new qt(this.getOpponentPlayer(),"対戦相手がデッキからカードをドローできなかった。");const d=a.cardEntities[0];await d.draw(t?["Effect"]:["Rule"],t,i),n.push(((s=d.origin)==null?void 0:s.name)||"!名称取得失敗!")}});u(this,"discard",async(e,t,i,a,n,s)=>{const o=n||(()=>!0),d=this.getHandCell().cardEntities.filter(o);if(d.length<e)return[];let l=[];return(a||this).duelistType==="NPC"?l=d.randomPickMany(e):l=await this.duel.view.waitSelectEntities(a||this,d,e,c=>c.length===e,`${e}枚カードを捨てる。`,!1)||[],this.writeInfoLog(`手札からカードを${l.length}枚捨てた。${l.map(c=>{var f;return(f=c.origin)==null?void 0:f.name})}。`),await fe.discardManyForTheSameReason(l,["Discard",...t],i,s),l});u(this,"getEnableSummonList",(e,t,i,a,n,s,o)=>{const d=this.duel.field.getCells("ExtraMonsterZone"),l=d.filter(f=>!s.map(p=>p.material).includes(f.cardEntities[0])).filter(f=>f.owner===this),c=[];return l.length&&c.push(...d.filter(f=>!l.includes(f)).filter(f=>f.isAvailable)),n.map(f=>({...f,summoner:this})).map(f=>{var p;return(t!=="LinkSummon"||!this.duel.field.canExtraLink(f.monster,s))&&(f.cells=f.cells.filter(h=>!c.includes(h))),(p=f.monster.status.monsterCategories)!=null&&p.includes("Link")&&(f.posList=f.posList.filter(h=>h==="Attack")),f}).map(f=>({...f,cells:f.cells.filter(p=>p.cardEntities.length===0||s.some(h=>h.material===p.cardEntities[0]))})).map(f=>{var p;return f.monster.fieldCell.cellType!=="ExtraDeck"?{...f,cells:f.cells.filter(h=>h.cellType!=="ExtraMonsterZone")}:(p=f.monster.status.monsterCategories)!=null&&p.includes("Link")||t==="PendulumSummon"?{...f,cells:f.cells.filter(h=>h.cellType==="ExtraMonsterZone"||h.linkArrowSources.filter(m=>!s.map(C=>C.material).includes(m)).length)}:f}).filter(f=>f.cells.length&&f.posList.length).map(f=>this.entity.summonFilterBundle.filter(e,t,i,a,f,s,o)).filter(f=>f.cells.length&&f.posList.length).map(f=>f.monster.summonFilterBundle.filter(e,t,i,a,f,s,o)).filter(f=>f.cells.length&&f.posList.length).map(f=>s.map(p=>p.material.summonFilterBundle).reduce((p,h)=>h.filter(e,t,i,a,p,s,o),f)).filter(f=>f.cells.length&&f.posList.length)});u(this,"prepareToSummonMany",async(e,t,i,a,n,s,o,d,l,c,f="特殊召喚するモンスターを選択。")=>{const p=this.getEnableSummonList(e,t,i,a,n,s,o);if(!p.length)return[];let h=p.map(C=>C.monster);(n.length!==1||l([]))&&(h=await this.duel.view.waitSelectEntities(this,h,d,l,f,c)??[]);const m=[];for(const C of p.filter(y=>h.includes(y.monster))){const y=C.cells.filter(b=>!m.map(P=>P.dest).includes(b));if(!y.length)continue;let w=[...C.posList].randomPick(),k=y.randomPick();if((y.length>1||C.posList.length>1)&&this.duelistType!=="NPC"){const b=await this.duel.view.waitSelectSummonDestination(C.summoner,C.monster,y,C.posList,c);if(!b)return[];k=b.dest,w=b.battlePosition}m.push({summoner:this,monster:C.monster,pos:w,dest:k})}return m});u(this,"summonAll",(e,t,i,a,n,s,o,d,l)=>this.summonMany(e,t,i,a,n,s,o,n.length,c=>c.length===n.length,d,l));u(this,"summonOne",(e,t,i,a,n,s,o,d,l)=>this.summonMany(e,t,i,a,n,s,o,1,c=>c.length===1,d,l));u(this,"summonMany",(e,t,i,a,n,s,o,d,l,c,f)=>Dr.summonMany(e,t,i,a,n.map(p=>({...p,summoner:this})),s,o,d,l,c,f));u(this,"selectAttackTargetForNPC",(e,t)=>{const i=e.atk??0,a=e.getAttackTargets();if(!a.length)return;const n=a.find(s=>s.entityType==="Duelist");return n&&(i>=da(1600,this.getOpponentPlayer().lp)||e.info.battlePotisionChangeCount>0)?n:a.find(s=>s.battlePosition==="Attack"?i>=(s.atk??0):i<(s.battlePosition==="Set"?1e3:s.def??0)?!1:s.validateDestory("BattleDestroy",this,e,t))});u(this,"selectActionForNPC",(e,t)=>{if(!e.length)return;const i=e.filter(y=>y.action.isMandatory);if(i.length)return i.randomPick();let a=e.filter(y=>!this.actionBlackListForNPC.includes(y.action.playType));const n=a.filter(y=>!Number.isNaN(y.action.priorityForNPC)).shuffle().sort((y,w)=>y.action.priorityForNPC-w.action.priorityForNPC);if(n.length)return n[0];const s=a.filter(y=>y.action.playType==="TriggerEffect");if(s.length)return s.randomPick();if(this.duel.phase!=="main1"&&this.duel.phase!=="main2"){const y=a.filter(w=>w.action.playType==="IgnitionEffect");if(y.length)return y.randomPick()}const o=a.filter(y=>y.action.playType==="Battle").sort((y,w)=>(y.action.entity.atk??0)-(w.action.entity.atk??0));if(o.length)return o.find(y=>this.selectAttackTargetForNPC(y.action.entity,y.action));a=a.filter(y=>y.action.playType!=="Battle");const d=a.length?t.slice(-1)[0]:void 0,l=a.filter(y=>y.action.negatePreviousBlock);if(d&&d.activator!==this&&l)return l.randomPick();if(a=a.filter(y=>!y.action.negatePreviousBlock),!a.length)return;const c=kr(...this.getOpponentPlayer().getMonstersOnField().filter(y=>y.battlePosition==="Attack").map(y=>y.atk??0),1600),f=da(...this.getOpponentPlayer().getMonstersOnField().map(y=>y.battlePosition==="Set"?1500:(y.battlePosition==="Attack"?y.atk:y.def)??0),1500),p=this.getMonstersOnField(),h=kr(...p.filter(y=>y.battlePosition==="Attack").map(y=>y.atk??0),0);let m=a.filter(y=>y.action.playType!=="ChangeBattlePosition").filter(y=>y.action.entity.battlePosition!=="Attack").filter(y=>(y.action.entity.atk??0)>=c||(y.action.entity.atk??0)>f&&(y.action.entity.atk??0)>2300);if(m.length)return m.randomPick();a=a.filter(y=>y.action.playType!=="ChangeBattlePosition").filter(y=>y.action.playType!=="SpellTrapSet").filter(y=>y.action.entity.actions.filter(w=>w.playType!=="NormalSummon"&&w.playType!=="SpecialSummon").flatMap(w=>w.executableCells).every(w=>w!=="Hand")||y.action.playType!=="NormalSummon"&&y.action.playType!=="SpecialSummon");const C=[...a.filter(y=>y.action.playType==="NormalSummon").filter(y=>(y.action.entity.lvl??12)<5),...a.filter(y=>y.action.playType==="SpecialSummon"),...a.filter(y=>y.action.playType==="NormalSummon").filter(y=>(y.action.entity.atk??0)>2600||(y.action.entity.atk??0)>2300&&(y.action.entity.lvl??12)<7).filter(y=>(y.action.entity.atk??0)>=h),...a.filter(y=>y.action.entity.face==="FaceUp").filter(y=>y.action.entity.isOnFieldStrictly)];if(C.length)return C.randomPick();if(a=a.filter(y=>y.action.playType!=="NormalSummon").filter(y=>y.action.playType!=="SpecialSummon"),this.duel.phase==="main2"){if(m=e.filter(y=>y.action.playType==="ChangeBattlePosition").filter(y=>y.action.entity.battlePosition==="Attack").filter(y=>(y.action.entity.atk??0)<c||(y.action.entity.atk??0)>f&&(y.action.entity.atk??0)>2300),m.length)return m.randomPick();if(this.getAvailableSpellTrapZones.length>1)return e.filter(y=>y.action.playType==="SpellTrapSet").filter(y=>y.action.entity.status.kind!=="Spell"||y.action.entity.status.spellCategory==="QuickPlay").randomPick()}if(Math.random()<a.length/4)return a.randomPick()});this.duel=e,this.seat=t,this.profile=i,this.duelistType=a,this.deckInfo=n,this.initHand=s,this.lifeLog=[],this.infoOrigin={maxRuleNormalSummonCount:1,ruleNormalSummonCount:0,ruleNormalSummonCountQty:0,effectNormalSummonCount:0,effectNormalSummonCountQty:0,specialSummonCount:0,specialSummonCountQty:0},this.info={...this.infoOrigin},this.statusOrigin={maxSpecialSummonCount:Number.MAX_VALUE,canDrawByEffect:!0,canSearchFromDeck:!0,canDiscardAsCost:!0,canDiscardAsEffect:!0},this.status={...this.statusOrigin},this._lp=8e3;const o=[];this.duelistType==="NPC"&&(this.profile.npcLvl<1&&o.push("CardActivation","IgnitionEffect","TriggerEffect","QuickEffect"),this.profile.npcLvl<101&&o.push("Battle")),this.actionBlackListForNPC=o}get entity(){const e=this.getHandCell().entities.find(t=>t.entityType==="Duelist");return e||xe.createPlayerEntity(this)}get lp(){return this._lp}get isTurnPlayer(){return this.duel.getTurnPlayer()===this}get canDraw(){return!0}get canAddToHandFromDeck(){return!0}};u(Dr,"summonMany",async(e,t,i,a,n,s,o,d,l,c,f="特殊召喚するモンスターを選択。")=>{const p=n.map(m=>m.summoner).getDistinct(),h=[];for(const m of p){const C=await m.prepareToSummonMany(e,t,i,a,n.filter(y=>y.summoner===m),s,o,d,l,c,f);h.push(...C)}if(h.length)return h.forEach(m=>m.monster.info.materials.reset(...s)),await fe.moveToXyzOwner(h[0].dest,s.map(m=>m.material).filter(m=>m.status.kind==="XyzMaterial"),["XyzMaterial","Rule"],h[0].monster,e),await xe.summonMany(h,t,i,a.entity,e),h.map(m=>m.monster)});let di=Dr;const fs=["Deck","ExtraDeck"],vs=["Graveyard","Banished"],ps=[...fs,...vs],Mo=[...ps,"Hand"],gt=["MonsterZone","ExtraMonsterZone"],fi=["SpellAndTrapZone","FieldSpellZone"],ei=[...gt,...fi],hs=["XyzMaterialZone","Disable"],Ei=[...Mo,...ei,...hs],va={0:{0:"Hand"},1:{0:"Deck",1:"SpellAndTrapZone",2:"SpellAndTrapZone",3:"SpellAndTrapZone",4:"SpellAndTrapZone",5:"SpellAndTrapZone",6:"ExtraDeck"},2:{0:"Graveyard",1:"MonsterZone",2:"MonsterZone",3:"MonsterZone",4:"MonsterZone",5:"MonsterZone",6:"FieldSpellZone"},3:{0:"Banished",1:"XyzMaterialZone",2:"ExtraMonsterZone",3:"Disable",4:"ExtraMonsterZone",5:"XyzMaterialZone",6:"Banished"},4:{0:"FieldSpellZone",1:"MonsterZone",2:"MonsterZone",3:"MonsterZone",4:"MonsterZone",5:"MonsterZone",6:"Graveyard"},5:{0:"ExtraDeck",1:"SpellAndTrapZone",2:"SpellAndTrapZone",3:"SpellAndTrapZone",4:"SpellAndTrapZone",5:"SpellAndTrapZone",6:"Deck"},6:{0:"Hand"}};let Po=class{constructor(e,t,i,a){u(this,"onUpdateEvent",new We);u(this,"field");u(this,"row");u(this,"column");u(this,"cellType");u(this,"_owner");u(this,"_requiresRecalcLinkArrows");u(this,"_linkArrowSources");u(this,"_needsShuffle",!1);u(this,"recalcLinkArrows",()=>{this.isMonsterZoneLikeCell&&(this._requiresRecalcLinkArrows=!1,this._linkArrowSources=this.neighbors.filter(e=>e.isMonsterZoneLikeCell).filter(e=>e.cardEntities.length).filter(e=>e.cardEntities[0].linkArrows.some(t=>this.row===e.row+t.offsetRow&&this.column===e.column+t.offsetColumn)).map(e=>e.cardEntities[0]))});u(this,"_entities");u(this,"releaseEntities",e=>{var t;return this._entities=this._entities.filter(i=>i!==e),this.isMonsterZoneLikeCell&&((t=e.origin.monsterCategories)!=null&&t.includes("Link"))&&(this._requiresRecalcLinkArrows=!0),this.onUpdateEvent.trigger(),e});u(this,"acceptEntities",(e,t)=>{var i;t==="Top"?this._entities.unshift(e):this._entities.push(e),t==="Random"&&(this._needsShuffle=!0),this._entities.forEach(a=>{a.fieldCell=this}),this.isMonsterZoneLikeCell&&((i=e.origin.monsterCategories)!=null&&i.includes("Link"))&&(this._requiresRecalcLinkArrows=!0),this.onUpdateEvent.trigger()});u(this,"shuffle",()=>{this._entities=this.entities.shuffle(),this._needsShuffle=!1,this.field.duel.log.info("デッキをシャッフル。",this.owner)});u(this,"toString",()=>this.isMonsterZoneLikeCell||this.cellType==="SpellAndTrapZone"?`${this.cellType}(${this.row},${this.column})`:this.cellType);this.field=e,this.row=t,this.column=i,this.cellType=va[t][i],this._owner=a,this._entities=[],this._linkArrowSources=[],this._requiresRecalcLinkArrows=!1}get onUpdate(){return this.onUpdateEvent.expose()}get owner(){var e;return this._owner||((e=this.cardEntities[0])==null?void 0:e.owner)}get requiresRecalcLinkArrows(){return this._requiresRecalcLinkArrows}get linkArrowSources(){return this._linkArrowSources}get needsShuffle(){return this._needsShuffle}get entities(){return this._entities}get visibleEntities(){return this._entities.filter(e=>hn.find(t=>t===e.entityType))}get cardEntities(){return this._entities.filter(e=>hn.find(t=>t===e.entityType)).filter(e=>e.status.kind!=="XyzMaterial")}get xyzMaterials(){return this._entities.filter(e=>e.status.kind==="XyzMaterial")}get targetForAttack(){return this.cellType==="Hand"?this._entities.find(e=>e.entityType==="Duelist"):this.cardEntities[0]}get isAvailable(){return this.cardEntities.length===0&&this._entities.filter(e=>mc.find(t=>t===e.entityType)).length===0}get isAvailableForPendulum(){return this.isAvailable&&this.isSpellTrapZoneLikeCell&&(this.column===1||this.column===5)}get isStackCell(){return ps.some(e=>e===this.cellType)}get isPlayFieldCell(){return ei.some(e=>e===this.cellType)}get isMonsterZoneLikeCell(){return gt.some(e=>e===this.cellType)}get isSpellTrapZoneLikeCell(){return fi.some(e=>e===this.cellType)}get isDisabledCell(){return hs.some(e=>e===this.cellType)}get isTrashCell(){return vs.some(e=>e===this.cellType)}get neighbors(){const e=[this.row-1,this.row,this.row+1].filter(i=>i>=0&&i<=6),t=[this.column-1,this.column,this.column+1].filter(i=>i>=0&&i<=6);return e.flatMap(i=>t.map(a=>this.field.cells[i][a])).filter(i=>i.isMonsterZoneLikeCell).filter(i=>i!==this)}};class Ur{constructor(){u(this,"pooledOperators",[]);u(this,"bundles",[]);u(this,"excludesExpired",()=>{this.bundles=this.bundles.filter(e=>!e.entity.hasDisappeared),this.bundles.forEach(e=>e.excludesExpired()),this.pooledOperators=this.pooledOperators.filter(e=>e.validateAlive())});u(this,"append",e=>{this.bundles.push(e)});u(this,"push",e=>{if(!e.isContinuous)throw new oe("staticへの追加は永続以外不可",e);this.excludesExpired(),this.distribute(e),this.pooledOperators.push(e)});u(this,"distributeAll",e=>(this.excludesExpired(),this.pooledOperators.flatMap(this.distribute).getDistinct().forEach(t=>t.operators.sort((i,a)=>i.seq-a.seq)),this.afterDistributeAll(e)));u(this,"distribute",e=>this.bundles.filter(t=>t.operators.every(i=>i.seq!==e.seq)).filter(t=>e.isApplicableTo(t.entity)).filter(t=>t.entity.canBeEffected(e.effectOwner,e.isSpawnedBy,e.actionAttr)).map(t=>(t.push(e),t)));u(this,"removeItem",e=>{this.pooledOperators=this.pooledOperators.filter(t=>t.seq!==e)})}}class Gr{constructor(e,t){u(this,"pool");u(this,"entity");u(this,"_operators");u(this,"excludesExpired",()=>{this._operators=this._operators.filter(e=>{const t=e.validateAlive()&&e.isApplicableTo(this.entity);return t||(console.info(`before remove ${this.entity.toString} ${e.title}`),e.beforeRemove(this)),t})});u(this,"push",e=>{this.entity.procFilterBundle.operators.filter(t=>t.procTypes.includes("Effect")).some(t=>!t.filter(t.effectOwner,t.isSpawnedBy,t.actionAttr,[]))||(this.beforePush(e),this._operators.push(e))});u(this,"removeItem",e=>{this._operators=this._operators.filter(t=>t.seq!==e?!0:(t.beforeRemove(this),!1))});this.pool=e,this.entity=t,this._operators=[],this.pool.append(this)}get operators(){return this._operators}}const Ar=class Ar{constructor(e,t,i,a,n,s){u(this,"seq");u(this,"title");u(this,"validateAlive");u(this,"isContinuous");u(this,"isSpawnedBy");u(this,"isSpawnedAt");u(this,"activateType");u(this,"actionAttr");u(this,"isApplicableTo");u(this,"effectOwner");this.seq=Ar.nextSeq++,this.title=e,this.validateAlive=()=>t(this),this.isContinuous=i,this.isSpawnedBy=a,this.isSpawnedAt=a.duel.clock.getClone(),this.isApplicableTo=o=>s(this,o),this.actionAttr=n,this.activateType=this.actionAttr.playType?xo(this.actionAttr.playType):"NonActivate",this.effectOwner=this.isSpawnedBy.controller}get isEffective(){return!this.isContinuous||this.activateType==="NonActivate"?!0:this.isSpawnedBy.isEffective}};u(Ar,"nextSeq",0);let xi=Ar;class Bo extends Ur{constructor(){super(...arguments);u(this,"afterDistributeAll",()=>this.bundles.every(t=>t.applyEffectFilter()))}}class Fo extends Gr{constructor(){super(...arguments);u(this,"applyEffectFilter",()=>{const t=this.entity.allStickyEffectOperators.length,i=[];for(;;){const a=this.operators.filter(n=>n.procTypes.includes("Effect")).filter(n=>n.isContinuous).find(n=>!i.includes(n.seq));if(!a)break;i.push(a.seq),a.eraseOperators(this.entity)}return this.entity.allStickyEffectOperators.length===t});u(this,"beforePush",t=>t.eraseOperators(this.entity))}}const Ci=class Ci extends xi{constructor(t,i,a,n,s,o,d,l){super(t,i,a,n,s,o);u(this,"beforeRemove",()=>{});u(this,"procTypes");u(this,"filter");u(this,"eraseOperators",t=>{if(!this.procTypes.includes("Effect"))return 0;const i=t.allStickyEffectOperators.filter(a=>a.isContinuous).filter(a=>!this.filter(a.effectOwner,a.isSpawnedBy,a.actionAttr,[])).map(a=>a.seq);return i.forEach(t.procFilterBundle.removeItem),i.forEach(t.statusOperatorBundle.removeItem),i.forEach(t.numericOprsBundle.removeItem),i.length});this.procTypes=d,this.filter=l}};u(Ci,"createContinuous",(t,i,a,n,s,o,d)=>new Ci(t,i,!0,a,n,s,o,d)),u(Ci,"createLingering",(t,i,a,n,s,o,d)=>new Ci(t,i,!1,a,n,s,o,d));let Tr=Ci;const vn={level:1,rank:1,attack:0,defense:0,pendulumScaleR:0,pendulumScaleL:0};class Oo extends Ur{constructor(){super(...arguments);u(this,"afterDistributeAll",t=>{if(this.bundles.forEach(a=>a.calcStateAll()),t.field.getMonstersOnFieldStrictly().flatMap(a=>a.numericOprsBundle).flatMap(a=>a.operators).some(a=>a.targetStateGen==="calculated")){const n=t.field.getMonstersOnFieldStrictly().filter(s=>(s.atk??0)>=0).map(s=>s.atk??0).reduce((s,o)=>s>o?s:o,0);t.field.getMonstersOnFieldStrictly().forEach(s=>{s.numericOprsBundle.operators.filter(o=>o.targetStateGen==="calculated").forEach(o=>{var d;if(!((d=s.status.monsterCategories)!=null&&d.includes("Link")&&o.targetState==="defense")){if(o.stateOperationType==="THE_DEVILS_AVATAR"){s.numericStatus.calculated[o.targetState]=n+100;return}s.numericStatus.calculated[o.targetState]=o.calcValue(s,s.numericStatus.calculated[o.targetState]??0)}})})}return!0})}}class Lo extends Gr{constructor(){super(...arguments);u(this,"beforePush",t=>{const i=this.operators.filter(n=>n.targetState===t.targetState).filter(n=>n.isEffective);if(t.kind==="O-L-F"||t.kind==="O-C-F"?(i.filter(n=>n.kind==="O-L-F").forEach(n=>n.negate()),i.filter(n=>n.kind==="L-F").forEach(n=>n.negate())):t.kind==="L-F"||t.kind==="C-F"?i.filter(n=>n.kind==="L-F"||n.kind==="L-A").forEach(n=>n.negate()):t.kind==="X-C-X"&&i.filter(n=>!n.isContinuous).forEach(n=>n.negate()),i.filter(n=>n.isEffective).some(n=>n.kind==="X-C-X")&&!t.isContinuous)return;if(t.stateOperationType!=="Addition"&&t.targetStateGen==="wip"&&i.filter(n=>!n.isContinuous).forEach(n=>n.negate()),t.stateOperationType==="THE_DEVILS_AVATAR"||t.stateOperationType==="Gradius'_Option"){this.entity.numericStatus.calculated[t.targetState]=-Number.MAX_VALUE;return}const a=this.entity.numericStatus.calculated[t.targetState]??0;if(t.stateOperationType==="THE_DEVILS_DREAD-ROOT"){this.entity.numericStatus.calculated[t.targetState]=t.calcValue(this.entity,a);return}if(t.kind==="L-F"){this.entity.numericStatus.wip[t.targetState]=t.calcValue(this.entity,a);return}});u(this,"calcStateAll",()=>us.forEach(this.calcState));u(this,"calcState",t=>{if(this.entity.status.kind!=="Monster"&&!this.entity.isPendulumScale){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories){this.entity.numericStatus.calculated[t]=void 0;return}if(this.entity.status.monsterCategories.includes("Link")&&t!=="attack"){this.entity.numericStatus.calculated[t]=void 0;return}if(this.entity.status.monsterCategories.includes("Xyz")&&t==="level"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories.includes("Xyz")&&t==="rank"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories.includes("Pendulum")&&(t==="pendulumScaleL"||t==="pendulumScaleR")){this.entity.numericStatus.calculated[t]=void 0;return}if(t!=="level"&&!this.entity.isOnFieldStrictly){this.entity.numericStatus.origin[t]=this.entity.origin[t],this.entity.numericStatus.wip[t]=this.entity.origin[t],this.entity.numericStatus.calculated[t]=this.entity.origin[t];return}const i=this.entity.origin[t]??0,a=this.entity.numericStatus.wip[t]??0,n=this._operators.filter(c=>c.targetState===t).filter(c=>c.isEffective);if(n.some(c=>c.stateOperationType==="THE_DEVILS_AVATAR"||c.stateOperationType==="Gradius'_Option")&&this.entity.isEffective){this.entity.numericStatus.calculated[t]=-Number.MAX_VALUE;return}const s=n.filter(c=>c.targetState===t).findLast(c=>c.targetStateGen==="origin"),o=s?s.calcValue(this.entity,i??0):i;this.entity.numericStatus.origin[t]=o;let d=o;const l=n.filter(c=>c.targetState===t).filter(c=>c.targetStateGen==="wip").findLast(c=>c.stateOperationType==="Fixation");if(!l)d=n.filter(c=>c.stateOperationType==="Addition").reduce((c,f)=>f.calcValue(this.entity,c),d),this.entity.numericStatus.wip[t]=d;else if(l.isContinuous)d=l.calcValue(this.entity,d),d=n.filter(c=>c.stateOperationType==="Addition").reduce((c,f)=>f.calcValue(this.entity,c),d),this.entity.numericStatus.wip[t]=d;else{let c=!1;d=n.filter(f=>(c=c||f===l,c&&f!==l)).filter(f=>f.stateOperationType==="Addition").reduce((f,p)=>p.calcValue(this.entity,f),a)}d<vn[t]&&(d=vn[t]),this.entity.numericStatus.calculated[t]=d})}}const Pt=class Pt extends xi{constructor(t,i,a,n,s,o,d,l,c,f){super(t,i,a,n,s,o);u(this,"beforeRemove",()=>{});u(this,"targetState");u(this,"targetStateGen");u(this,"stateOperationType");u(this,"calcValue");u(this,"_isEffective");u(this,"negate",()=>{this._isEffective=!1});this._isEffective=!0,this.targetState=d,this.targetStateGen=l,this.stateOperationType=c,this.calcValue=(p,h)=>f(this.isSpawnedBy,p,h)}get isEffective(){return this._isEffective&&super.isEffective}get kind(){if(this.targetStateGen==="origin"){if(this.stateOperationType==="Fixation")return this.isContinuous?"O-C-F":"O-L-F";throw new oe("矛盾したプロパティ",this)}if(this.targetStateGen==="wip"){if(this.stateOperationType==="Addition")return this.isContinuous?"C-A":"L-A";if(this.stateOperationType==="Fixation")return this.isContinuous?"C-F":"L-F";throw new oe("矛盾したプロパティ",this)}if(this.stateOperationType==="THE_DEVILS_DREAD-ROOT")return"X-C-F";if(this.stateOperationType==="THE_DEVILS_AVATAR"||this.stateOperationType==="Gradius'_Option")return"X-C-X";throw new oe("矛盾したプロパティ",this)}};u(Pt,"createContinuous",(t,i,a,n,s,o,d,l)=>new Pt(t,i,!0,a,{},n,s,o,d,l)),u(Pt,"createLingering",(t,i,a,n,s,o,d)=>new Pt(t,i,!1,a,n,(l,c)=>c.isOnFieldAsMonsterStrictly,s,"wip",o,d)),u(Pt,"createLingeringFixation",(t,i,a,n,s,o)=>Pt.createLingering(t,i,a,n,s,"Fixation",o)),u(Pt,"createLingeringAddition",(t,i,a,n,s,o)=>Pt.createLingering(t,i,a,n,s,"Addition",o));let yt=Pt;const gs=r=>Object.keys(r),No={draw:"ドローフェイズ",standby:"スタンバイフェイズ",main1:"メインフェイズ１",battle1:"バトルフェイズ",battle2:"バトルフェイズ（追加）",main2:"メインフェイズ２",end:"エンドフェイズ"},qo={start:"スタートステップ",battle:"バトルステップ",damage:"ダメージステップ",end:"エンドステップ"},Ro={start:"ダメージステップ開始時",beforeDmgCalc:"ダメージ計算前",dmgCalc:"ダメージ計算時",afterDmgCalc:"ダメージ計算後",end:"ダメージステップ終了時"},Le=["draw","stanby","main1","b1Start","b1Battle","b1End","b2Start","b2Battle","b2End","main2","end"],Ie=["b1DStart","b1DBeforeDmgCalc","b1DAfterDmgCalc","b1DEnd","b2DStart","b2DBeforeDmgCalc","b2DAfterDmgCalc","b2DEnd"],Ho=["b1DDmgCalc","b2DDmgCalc"],Nt=[...Le,...Ie,...Ho],pn={draw:{phase:"draw",step:void 0,stage:void 0},stanby:{phase:"standby",step:void 0,stage:void 0},main1:{phase:"main1",step:void 0,stage:void 0},b1Start:{phase:"battle1",step:"start",stage:void 0},b1Battle:{phase:"battle1",step:"battle",stage:void 0},b1DStart:{phase:"battle1",step:"battle",stage:"start"},b1DBeforeDmgCalc:{phase:"battle1",step:"battle",stage:"beforeDmgCalc"},b1DDmgCalc:{phase:"battle1",step:"battle",stage:"dmgCalc"},b1DAfterDmgCalc:{phase:"battle1",step:"battle",stage:"afterDmgCalc"},b1DEnd:{phase:"battle1",step:"battle",stage:"end"},b1End:{phase:"battle1",step:"end",stage:void 0},b2Start:{phase:"battle2",step:"start",stage:void 0},b2Battle:{phase:"battle2",step:"battle",stage:void 0},b2DStart:{phase:"battle2",step:"battle",stage:"start"},b2DBeforeDmgCalc:{phase:"battle2",step:"battle",stage:"beforeDmgCalc"},b2DDmgCalc:{phase:"battle2",step:"battle",stage:"dmgCalc"},b2DAfterDmgCalc:{phase:"battle2",step:"battle",stage:"afterDmgCalc"},b2DEnd:{phase:"battle2",step:"battle",stage:"end"},b2End:{phase:"battle2",step:"end",stage:void 0},main2:{phase:"main2",step:void 0,stage:void 0},end:{phase:"end",step:void 0,stage:void 0}},$o=r=>r.stage?Ro[r.stage]:r.step?qo[r.step]:No[r.phase],ii=gs(pn).reduce((r,e)=>(r[e].key=e,r[e].name=$o(r[e]),r),pn),xr=class xr{constructor(e,t){u(this,"entity");u(this,"isRegular");u(this,"_isStarted");u(this,"info");u(this,"continuousEffectBase");u(this,"updateState",async()=>{if(this.hasToStart!==this.isStarted){if(this.isStarted){if(!this.info)throw new oe("illegal state");this._isStarted=!1,await this.continuousEffectBase.finish(this.entity,this.info),this.info=void 0;return}this.info=await this.continuousEffectBase.start(this.entity),this._isStarted=!0}});this._isStarted=!1,this.entity=e,this.continuousEffectBase=t,this.isRegular=this.appliableCellTypes.every(i=>ei.find(a=>a===i))&&this.faceList.length===1&&this.faceList[0]==="FaceUp"}get isStarted(){return this._isStarted}get appliableCellTypes(){return this.continuousEffectBase.appliableCellTypes}get appliableDuelPeriodKeys(){return this.continuousEffectBase.appliableDuelPeriodKeys}get faceList(){return this.continuousEffectBase.faceList}get hasToStart(){return!this.appliableCellTypes.includes(this.entity.fieldCell.cellType)||!this.appliableDuelPeriodKeys.includes(this.entity.duel.clock.period.key)||!this.faceList.includes(this.entity.face)?!1:this.continuousEffectBase.canStart(this.entity)}};u(xr,"createNew",(e,t)=>new xr(e,t));let pa=xr;const Zo=(r,e,t,i,a)=>({title:r,appliableCellTypes:e==="Monster"?["MonsterZone","ExtraMonsterZone"]:["FieldSpellZone","SpellAndTrapZone"],appliableDuelPeriodKeys:Nt,faceList:["FaceUp"],canStart:n=>!n.info.isPending&&!n.info.isDying&&t(n),start:async n=>{const s=i(n);return s.forEach(a(n).push),s.map(o=>o.seq)},finish:async(n,s)=>{s.forEach(o=>a(n).removeItem(o))}}),Na=(r,e,t,i,a,n)=>({title:r,appliableCellTypes:e==="Monster"?["MonsterZone","ExtraMonsterZone"]:["FieldSpellZone","SpellAndTrapZone"],appliableDuelPeriodKeys:Nt,faceList:["FaceUp"],canStart:s=>!s.info.isPending&&!s.info.isDying&&i(s),start:async s=>{const o=a(s),d=t(s);return console.info(`start : ${s.toString()} ⇒ ${d.map(l=>l.toString()).join(" ")} (${o.map(l=>l.title).join(" ")})`),d.map(n).forEach(l=>o.forEach(l.push)),{targets:d,seqList:o.map(l=>l.seq)}},finish:async(s,o)=>{o.targets.map(n).forEach(d=>o.seqList.forEach(l=>d.removeItem(l)))}}),Uo=(r,e,t,i,a)=>Na(r,e,t,i,a,n=>n.procFilterBundle),br=(r,e,t,i)=>Zo(r,e,t,i,a=>a.field.numericStateOperatorPool),sr=(r,e,t,i,a)=>Na(r,e,t,i,a,n=>n.numericOprsBundle),Go=(r,e,t,i,a)=>Na(r,e,t,i,a,n=>n.statusOperatorBundle);class jo extends Ur{constructor(){super(...arguments);u(this,"afterDistributeAll",t=>t.field.getAllEntities().map(i=>i.statusOperatorBundle).every(i=>i.calcStatus()))}}class Vo extends Gr{constructor(){super(...arguments);u(this,"calcStatus",()=>{const t=this.entity.isEffective;return this.entity.status=this._operators.reduce((i,a)=>({...i,...a.statusCalculator(a,i)}),this.entity.status),this.entity.isEffective===t});u(this,"beforePush",()=>{})}}class qa extends xi{constructor(t,i,a,n,s,o,d){super(t,i,a,n,s,o);u(this,"beforeRemove",()=>{});u(this,"statusCalculator");this.statusCalculator=d}}class zo extends Ur{constructor(){super(...arguments);u(this,"afterDistributeAll",()=>!0)}}class Wo extends Gr{constructor(){super(...arguments);u(this,"beforePush",()=>{});u(this,"filter",(t,i,a,n,s,o,d)=>this.operators.filter(l=>l.summonKinds.includes(i)).reduce((l,c)=>({...l,...c.filter(this.entity,t,s.summoner,[i,...a],n,s.monster,o,l.posList,l.cells,d)}),s))}}class Yo extends xi{constructor(t,i,a,n,s,o,d,l){super(t,i,a,n,s,o);u(this,"beforeRemove",()=>{});u(this,"summonKinds");u(this,"filter");this.summonKinds=d,this.filter=(...c)=>l(this,...c)}}class Ko{constructor(e){u(this,"cells");u(this,"duel");u(this,"summonFilterPool");u(this,"procFilterPool");u(this,"numericStateOperatorPool");u(this,"statusOperatorPool");u(this,"moveLog");u(this,"getAllCells",()=>this.cells.flat());u(this,"getCells",(...e)=>this.getAllCells().filter(t=>e.includes(t.cellType)));u(this,"getAvailableExtraMonsterZones",()=>this.getCells("ExtraMonsterZone").filter(e=>e.isAvailable));u(this,"getAllEntities",()=>this.getAllCells().map(e=>e.entities).flat());u(this,"getAllCardEntities",()=>this.getAllCells().map(e=>e.cardEntities).flat());u(this,"getCardsOnFieldStrictly",()=>this.getCells(...ei).map(e=>e.cardEntities).filter(e=>e.length>0).map(e=>e[0]).filter(e=>e.isOnFieldStrictly));u(this,"getMonstersOnFieldStrictly",()=>this.getCardsOnFieldStrictly().filter(e=>e.isOnFieldAsMonsterStrictly));u(this,"getPendulumScalesOnFieldStrictly",()=>this.getCardsOnFieldStrictly().filter(e=>{var t;return(t=e.origin.monsterCategories)==null?void 0:t.includes("Pendulum")}).filter(e=>e.isOnFieldAsSpellTrapStrictly).filter(e=>!e.status.spellCategory));u(this,"getPendingCardsOnField",()=>this.getCells(...ei).map(e=>e.cardEntities).filter(e=>e.length>0).map(e=>e[0]).filter(e=>e.info.isPending));u(this,"getPendingMonstersOnField",()=>this.getPendingCardsOnField().filter(e=>e.status.kind==="Monster"));u(this,"getEntities",e=>this.getAllEntities().filter(t=>t.controller===e));u(this,"recalcLinkArrows",()=>{const e=this.getAllCells().filter(t=>t.isMonsterZoneLikeCell);e.some(t=>t.recalcLinkArrows)&&e.forEach(t=>t.recalcLinkArrows())});u(this,"canExtraLink",(e,t)=>{if(!e.linkArrows.length)return!1;const i=t.map(l=>l.material),a=this.getCells("ExtraMonsterZone").filter(l=>l.isAvailable||i.includes(l.cardEntities[0]));if(a.length!==1)return!1;const n=a[0],s=e.linkArrows.map(l=>this.cells[n.row+l.offsetRow][n.column+l.offsetColumn]);let o=n.linkArrowSources.filter(l=>!i.includes(l)).filter(l=>s.includes(l.fieldCell));if(!o.length)return!1;let d=-1;for(;d!==o.length;){const l=o.flatMap(c=>c.coLinkedEntities).filter(c=>!i.includes(c));if(l.some(c=>c.fieldCell.cellType==="ExtraMonsterZone"))return!0;o=[...o,...l].getDistinct(),d=o.length}return!1});u(this,"drawAtSameTime",async(e,t,i,a,n,s)=>{const o=[],d=[],l=[e.draw(t,n,s),i.draw(a,n,s)].map(c=>c.catch(f=>{f instanceof qt?f.winner&&o.push(f.winner):d.push(f)}));if(await Promise.all(l),d.length)throw new oe("ドロー処理で想定されない例外が発生した。",e,t,i,a,n,...d);if(o.length!==0)throw o.length===1?new qt(o[0],"対戦相手がデッキからドローできなかった。"):new qt(void 0,"お互いにデッキからカードをドローできなかった。")});u(this,"sendToGraveyard",async(e,t,i,a,n,s,o,d)=>{if(a>0&&i.length<a)return;const l=await this.duel.view.waitSelectEntities(t,i,a,n,e,d);if(l)return await xe.sendManyToGraveyard(l.map(c=>({entity:c,causedAs:s,causedBy:o,activator:t}))),this.duel.log.info(`${l.map(c=>c.status.name).join(", ")}を墓地に送った（${s.getDistinct().join(", ")}）。`,t),l});this.duel=e,this.cells=[...Array(7)].map(()=>[]);for(const t of Object.keys(va).map(Number))for(const i of Object.keys(va[t]).map(Number))this.cells[t][i]=new Po(this,t,i,t<3?e.duelists.Above:t>3?e.duelists.Below:i<2?e.duelists.Above:i>4?e.duelists.Below:void 0);this.summonFilterPool=new zo,this.procFilterPool=new Bo,this.numericStateOperatorPool=new Oo,this.statusOperatorPool=new jo,this.moveLog=new Qo(this)}}class Qo{constructor(e){u(this,"_field");u(this,"_records",[]);u(this,"getIndexOfStartPoint",e=>Si(this._records.map(t=>t.movedAt.totalProcSeq),e));u(this,"push",e=>{this._records.push(e)});u(this,"getCurrentTurnLog",()=>this.getTermLog("Current","turn"));u(this,"getPriviousChainLog",()=>this.getTermLog("Previous","chainSeq"));this._field=e}*getTermLog(e,t){const i=e==="Current"?this._field.duel.clock.currentStartPoints[t]:this._field.duel.clock.previousStartPoints[t];for(let a=this.getIndexOfStartPoint(i);a<this._records.length;a++)yield this._records[a]}}class Xo{constructor(e){u(this,"entity");u(this,"_records");u(this,"_push",e=>{this.entity.field.moveLog.push(e),this._records.push(e)});u(this,"pushForRuleAction",e=>{this._push({entity:this.entity,kind:this.entity.origin.kind,cell:this.entity.fieldCell,face:this.entity.face,orientation:this.entity.orientation,isPending:this.entity.info.isPending,movedAt:this.entity.duel.clock.getClone(),movedAs:[...e,"Rule"]})});u(this,"push",(e,t,i,a,n)=>{let s=this.entity.fieldCell;this.entity.status.kind==="XyzMaterial"&&(s=this.entity.controller.getXyzMaterialZone()),this._push({entity:this.entity,kind:e,cell:s,face:this.entity.face,orientation:this.entity.orientation,isPending:this.entity.info.isPending,movedAt:this.entity.duel.clock.getClone(),movedAs:t.getDistinct(),movedBy:i,actionOwner:a,chooser:n??a})});u(this,"finalize",()=>{if(!this.latestRecord.isPending)throw new oe("想定されない状況");if(this.entity.info.isPending)throw new oe("想定されない状況");this._push({...this.latestRecord,isPending:!1,movedAt:this.entity.duel.clock.getClone()})});u(this,"negateSummon",(e,t)=>{const i=this.records.slice(-1)[0];i.cell=this.entity.field.getCells("Disable")[0],i.movedBy=e,i.movedAs=["SummonNegated"],i.actionOwner=t});this.entity=e,this._records=[]}get records(){return this._records}get latestRecord(){return this.records.slice(-1)[0]}get previousPlaceRecord(){return this.records.findLast(e=>e.cell.cellType!==this.entity.fieldCell.cellType)??this._records[0]}get currentProcRecords(){return this.records.filter(e=>e.movedAt.totalProcSeq===this.entity.duel.clock.totalProcSeq)}}const ha=["SpellCounter","KaijuCounter","NamelessCounter","IceCounter"],ga=["CycleFlip","SonicBarrier","SonicVerse"],Jo=["GoldSarcophagus"],Io=[...ha,...ga,...Jo],ec={SpellCounter:"🔮",KaijuCounter:"☢",NamelessCounter:"💠",IceCounter:"❄"};class tc{constructor(){u(this,"dic");u(this,"temporaryCounterNames");u(this,"add",(e,t=1,i)=>(this.dic[e]=[...this.dic[e]??[],...Array(t).fill(i)],this.dic[e]));u(this,"setQty",(e,t=1,i)=>(this.dic[e]=[...Array(t).fill(i)],this.dic[e]));u(this,"remove",(e,t=1,i)=>{const a=this.dic[e].length;if(a===void 0)return[];if(t>=a)return delete this.dic[e],[];if(i){const n=this.dic[e].filter(o=>o===i),s=this.dic[e].filter(o=>o!==i);this.dic[e]=[...n.slice(t),...s]}else this.dic[e]=this.dic[e].slice(t);return this.dic[e]});u(this,"removeAll",(e,t)=>{if(t){const a=this.dic[e].filter(n=>n===t).length;return this.dic[e]=this.dic[e].filter(n=>n!==t),a}const i=this.dic[e];return delete this.dic[e],i});u(this,"getQty",(e,t)=>this.dic[e]?t?this.dic[e].filter(i=>i===t).length:this.dic[e].length??0:0);u(this,"incrementActionCountPerTurn",e=>{this.temporaryCounterNames.push(e.title),this.incrementActionCount(e)});u(this,"incrementActionCount",e=>{this.dic[e.title]=[e.entity,...this.dic[e.title]??[]]});u(this,"getActionCount",e=>this.dic[e.title]?this.dic[e.title].filter(t=>t===e.entity).length:0);u(this,"corpseDisposal",()=>{this.temporaryCounterNames.forEach(e=>delete this.dic[e]),this.temporaryCounterNames.reset(),ga.forEach(e=>delete this.dic[e])});u(this,"removeAllActualCounters",()=>{ha.forEach(e=>delete this.dic[e])});u(this,"removeAllWhenfaceDown",()=>{this.temporaryCounterNames.forEach(e=>delete this.dic[e]),this.temporaryCounterNames.reset(),ha.forEach(e=>delete this.dic[e])});u(this,"clear",()=>{ga.forEach(e=>delete this.dic[e]),this.temporaryCounterNames.forEach(e=>delete this.dic[e]),this.temporaryCounterNames.reset(),Io.forEach(e=>delete this.dic[e])});this.dic={},this.temporaryCounterNames=[]}}const nt=async()=>({selectedEntities:[],chainBlockTags:[],prepared:void 0}),ic=async(r,e,t)=>(r.activator.payLp(t,r.action.entity),{lifePoint:t}),lr=r=>r.activator.canTryBanish(r.action.entity,"BanishAsCost",r.action)&&r.action.entity.canBeBanished("BanishAsCost",r.activator,r.action.entity,r.action),jr=async r=>(await r.action.entity.banish(["Cost"],r.action.entity,r.activator),{banish:[r.action.entity]}),rc=(r,e,t=1)=>e.filter(i=>r.activator.canTryBanish(i,"BanishAsCost",r.action)).filter(i=>i.canBeBanished("BanishAsCost",r.activator,r.action.entity,r.action)).length>=t,ac=async(r,e,t,i)=>{const a=e.filter(s=>r.activator.canTryBanish(s,"BanishAsCost",r.action)).filter(s=>s.canBeBanished("BanishAsCost",r.activator,r.action.entity,r.action)),n=await r.activator.duel.view.waitSelectEntities(r.activator,a,i,t,"コストとして除外するカードを選択",!1)??[];return await fe.banishManyForTheSameReason(n,["Cost"],r.action.entity,r.activator),{banish:n}},Ni=async(r,e,t=Ye,i=a=>a.length===1)=>{const a=r.activator.getMonsterZones(),n=r.activator.getEnableSummonList(r.activator,"SpecialSummon",["Effect"],r.action,e.filter(d=>d.status.kind==="Monster").filter(d=>d.canBeTargetOfEffect(r)).map(d=>({monster:d,posList:t,cells:a})),[],!1),s=await r.action.entity.field.duel.view.waitSelectEntities(r.activator,n.map(d=>d.monster),1,i,"特殊召喚するモンスターを選択",!1)??[];if(!s.length)throw new Mi(r);const o=s.map(d=>d.fieldCell.cellType).getDistinct().filter(d=>d==="Graveyard"||d==="Banished").map(d=>d==="Graveyard"?"SpecialSummonFromGraveyard":"SpecialSummonFromBanished");return{selectedEntities:s,chainBlockTags:o,prepared:void 0}},qi=async(r,e=["Attack","Defense"],t=!0)=>{const i=r.activator.getMonsterZones(),a=r.selectedEntities.filter(n=>!n.wasMovedAfter(r.isActivatedAt)).map(n=>({monster:n,posList:e,cells:i}));return t&&(a.length!==r.selectedEntities.length||i.length<a.length)?!1:(await r.activator.summonAll(r.activator,"SpecialSummon",["Effect"],r.action,a,[],!1,!1),!0)},ys=async(r,e,t=["Attack","Defense"])=>{const i=r.activator.getMonsterZones(),a=e.map(n=>({monster:n,posList:t,cells:i}));return await r.activator.summonAll(r.activator,"SpecialSummon",["Effect"],r.action,a,[],!1,!1),!0},nc=(r,e,t)=>({title:r,playType:"SystemPeriodAction",spellSpeed:"Normal",executableCells:Ei,executablePeriods:e,executableDuelistTypes:["Controller","Opponent"],isMandatory:!0,validate:t,prepare:nt,execute:async()=>!0,settle:async()=>!0}),sc=r=>{if(!(r.activator.info.ruleNormalSummonCount>=r.activator.info.maxRuleNormalSummonCount)&&r.action.entity.lvl)if(r.action.entity.lvl<5){const e=r.activator.getEnableSummonList(r.activator,"NormalSummon",["Rule"],r.action,[{monster:r.action.entity,posList:["Attack","Set"],cells:r.activator.getMonsterZones()}],[],!1);return e.length?e.flatMap(t=>t.cells).getDistinct():void 0}else{const e=r.activator.getReleasableMonsters(),t=r.action.entity.lvl<7?1:2;if(e.length<t)return;if(e.getAllOnOffPattern().filter(a=>a.length===t).some(a=>r.activator.getEnableSummonList(r.activator,"AdvanceSummon",["Rule","NormalSummon"],r.action,[{monster:r.action.entity,posList:["Attack","Set"],cells:r.activator.getMonsterZones()}],a.map(n=>({material:n,cell:n.fieldCell})),!1).length))return[]}},lc=async(r,e,t)=>{if(!r.action.entity.lvl)return;if(r.action.entity.lvl<5)return{};const i=r.activator.getAvailableMonsterZones(),a=r.activator.getReleasableMonsters(),n=r.activator.getExtraMonsterZones(),s=r.action.entity.lvl<7?1:2;n.length>=s&&a.filter(l=>l.fieldCell.cellType!=="ExtraMonsterZone");const o=await r.activator.duel.view.waitSelectEntities(r.activator,r.activator.getReleasableMonsters(),s,l=>(t||l.length>0)&&(s<0||l.length===s)&&(i.length>0||l.some(c=>c.fieldCell.cellType==="ExtraMonsterZone")),"リリースするモンスターを選択",t)??[];return o.length?(await fe.releaseManyForTheSameReason(o,["Cost","AdvanceSummonRelease","Rule"],r.action.entity,r.activator),{summonMaterialInfos:o.map(l=>({material:l,cell:l.fieldCell}))}):void 0},oc=async r=>{var a;const e=["Rule","NormalSummon"];let t="NormalSummon";(a=r.costInfo.summonMaterialInfos)!=null&&a.length&&(t="AdvanceSummon",e.push("AdvanceSummon"));const i=r.dest?[r.dest]:r.activator.getAvailableMonsterZones();return vi(r,t,e,["Attack","Set"],i)},vi=async(r,e,t,i,a)=>{let n=a;return n||(n=r.activator.getMonsterZones(),r.action.entity.fieldCell.cellType==="ExtraDeck"&&n.push(...r.activator.duel.field.getCells("ExtraMonsterZone"))),await r.activator.summon(e,t,r.action,r.action.entity,i,n,r.costInfo.summonMaterialInfos??[],!1),{selectedEntities:[],chainBlockTags:[],prepared:void 0}},pi=async r=>{var e,t;return r.action.entity.info.isRebornable=!((e=r.action.entity.origin.monsterCategories)!=null&&e.includes("RegularSpecialSummonOnly")),r.action.entity.determine(),(t=r.costInfo.summonMaterialInfos)==null||t.map(i=>i.material).forEach(i=>i.onUsedAsMaterial(r,r.action.entity)),!0},Ue={title:"通常召喚",isMandatory:!1,playType:"NormalSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:sc,payCosts:lc,prepare:oc,execute:pi,settle:async()=>!0},ya=(r,e,t)=>{const i=r.activator.getMonsterZones();if(r.action.entity.fieldCell.cellType==="ExtraDeck"&&i.push(...r.activator.getAvailableExtraZones()),!!r.activator.getEnableSummonList(r.activator,"SpecialSummon",["Rule"],r.action,[{monster:r.action.entity,posList:e,cells:i}],t,!1).length)return t.length===0?i:[]},cc=r=>{if(!r.activator.isTurnPlayer)return;const e=r.action.entity.getAttackTargets();return e.length?e.map(t=>t.fieldCell):void 0},uc=async r=>{var i;if(r.action.entity.info.attackCount>0||r.action.entity.battlePosition!=="Attack")return;if((i=r.dest)!=null&&i.targetForAttack){const a=r.dest.entities.find(n=>n.entityType==="Duelist");return{selectedEntities:a?[a]:r.dest.cardEntities,chainBlockTags:[],prepared:void 0}}const e=r.action.entity.getAttackTargets();if(e.length===0)throw new oe("想定されない状態",r);if(e.length===1)return{selectedEntities:e,chainBlockTags:[],prepared:void 0};if(r.activator.duelistType==="NPC"){let a=r.activator.selectAttackTargetForNPC(r.action.entity,r.action);return a||(r.activator.duel.log.warn("NPCの攻撃対象選択に失敗したため、ランダムに攻撃対象を選択。"),a=e.randomPick()),{selectedEntities:[a],chainBlockTags:[],prepared:void 0}}const t=await r.action.entity.field.duel.view.waitSelectEntities(r.activator,e,1,a=>a.length===1,"攻撃対象を選択。",!0);if(t)return{selectedEntities:t,chainBlockTags:[],prepared:void 0}},dc=async r=>(r.action.entity.field.duel.declareAnAttack(r.action.entity,r.selectedEntities[0]),!0),he={title:"攻撃宣言",isMandatory:!1,playType:"Battle",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["b1Battle","b2Battle"],executableDuelistTypes:["Controller"],validate:cc,prepare:uc,execute:dc,settle:async()=>!0},ms=async r=>{if(!(r.action.entity.info.battlePotisionChangeCount>0||!r.activator.isTurnPlayer))return await r.action.entity.setBattlePosition(r.action.entity.battlePosition==="Attack"?"Defense":"Attack",["Rule"],r.action.entity,r.activator),r.action.entity.info.battlePotisionChangeCount++,{selectedEntities:[],chainBlockTags:[],prepared:void 0}},Se={title:"反転召喚",isMandatory:!1,playType:"FlipSummon",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:r=>r.action.entity.info.battlePotisionChangeCount===0&&r.action.entity.info.attackCount===0&&r.activator.isTurnPlayer&&r.action.entity.face==="FaceDown"?[]:void 0,prepare:ms,execute:async r=>(r.action.entity.determine(),!0),settle:async()=>!0},ge={title:"表示形式変更",isMandatory:!1,playType:"ChangeBattlePosition",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:r=>r.action.entity.info.battlePotisionChangeCount===0&&r.action.entity.info.attackCount===0&&r.activator.isTurnPlayer&&r.action.entity.face==="FaceUp"?[]:void 0,prepare:ms,execute:async r=>(r.action.entity.determine(),!0),settle:async()=>!0},oi=async(r,e=["Attack","Defense"])=>{const t=r.activator.getMonsterZones();return r.action.entity.wasMovedAfter(r.isActivatedAt)?!1:(await r.activator.summon("SpecialSummon",["Effect"],r.action,r.action.entity,e,t,[],!1),!0)},at=(r,e,t,i,a,n,s,o,d,l,c)=>{const f={posList:d,cells:l},p={posList:[],cells:[]};return e!==s||s.status.kind!=="Monster"||!s.origin.monsterCategories?f:s.origin.monsterCategories.includes("NormalSummonOnly")?a.includes("NormalSummon")||a.includes("AdvanceSummon")?f:p:s.origin.monsterCategories.includes("SpecialSummon")?s.isInTrashCell&&!s.origin.monsterCategories.includes("RegularSpecialSummonOnly")?s.info.isRebornable||s.origin.monsterCategories.includes("FreeReborn")?f:p:a.includes("PendulumSummon")&&s.origin.monsterCategories.includes("FreeReborn")?p:a.union(Ss).length?f:s.origin.monsterCategories.includes("RegularSpecialSummonOnly")?c?f:p:f:f},Ir={},fc=r=>(Ir[r]||(Ir[r]={title:`戦闘破壊耐性(${r})`,isMandatory:!0,executableCells:["MonsterZone"],executablePeriods:["b1DDmgCalc","b2DDmgCalc"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:r,isApplicableTo:(e,t,i)=>i.includes(e.entity)?t!=="BattleDestroy"?[]:[e.entity]:[],substitute:async(e,t,i)=>i.includes(e.entity)?t!=="BattleDestroy"?[]:e.entity.isEffective?(e.entity.controller.writeInfoLog(`${e.entity.toString()}は１ターンに１度だけ戦闘では破壊されない。`),[e.entity]):[]:[]}),Ir[r]),Ra=r=>r.activator.canRelease([r.action.entity])&&r.action.entity.canBeReleased(r.activator,r.action.entity,["ReleaseAsCost"],r.action),Ha=async r=>(await r.action.entity.release(["Cost"],r.action.entity,r.activator),{release:[r.action.entity]}),_s=r=>({title:"シンクロ召喚",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:gt,executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerChain:1,validate:e=>e.activator.isTurnPlayer?void 0:e.activator.getExtraDeck().cardEntities.filter(i=>{var a;return(a=i.status.monsterCategories)==null?void 0:a.includes("Syncro")}).flatMap(i=>i.actions).filter(i=>i.playType==="SpecialSummon").map(i=>({index:-1,chainNumber:void 0,action:i,activator:e.activator,targetChainBlock:void 0,isActivatedIn:i.entity.fieldCell,isActivatedAt:e.isActivatedAt,costInfo:{},state:"unloaded",dest:void 0,ignoreCost:!1})).some(i=>i.action.getEnableMaterialPatterns(i).some(a=>{const n=a.map(s=>s.material);return n.every(s=>s.controller===e.activator)&&n.every(s=>s.isOnFieldAsMonsterStrictly)&&n.includes(e.action.entity)}))?[]:void 0,prepare:nt,execute:async e=>{if(e.activator!==e.action.entity.controller||e.activator.getMonstersOnField().filter(s=>s.lvl!==void 0).length<2)return!1;const t=e.activator.getExtraDeck().cardEntities.filter(s=>{var o;return(o=s.status.monsterCategories)==null?void 0:o.includes("Syncro")}).flatMap(s=>s.actions).filter(s=>s.playType==="SpecialSummon").map(s=>({index:-1,chainNumber:void 0,action:s,activator:e.activator,targetChainBlock:void 0,isActivatedIn:s.entity.fieldCell,isActivatedAt:e.isActivatedAt,costInfo:{},state:"unloaded",dest:void 0,ignoreCost:!1})).filter(s=>s.action.getEnableMaterialPatterns(s).some(o=>{const d=o.map(l=>l.material);return d.every(l=>l.controller===e.activator)&&d.every(l=>l.isOnFieldAsMonsterStrictly)&&d.includes(e.action.entity)})).map(s=>s.action.entity).getDistinct();if(!t.length)return!1;const i=await e.activator.duel.view.waitSelectEntities(e.activator,t,1,s=>s.length===1,"シンクロ召喚するモンスターを選択。",!1)??[];if(!i.length)throw new oe("想定されない状態",e);const a=i[0].actions.find(s=>s.playType==="SpecialSummon");if(!a)throw new oe("想定されない状態",e);const n=a.getClone(s=>{const o=s.map(d=>d.material);return o.every(d=>d.controller===e.activator)&&o.every(d=>d.isOnFieldAsMonsterStrictly)&&o.includes(e.action.entity)});return e.nextActionInfo={action:n,originSeq:n.seq},!0},settle:async()=>!0,...r}),zi=class zi extends wr{constructor(){super(...arguments);u(this,"isApplicableTo",(t,i,a)=>{const n=this.entity.counterHolder.getActionCount(this);return this.isOnlyNTimesPerTurnIfFaceup>0&&n>=this.isOnlyNTimesPerTurnIfFaceup?this.entity.counterHolder.incrementActionCountPerTurn(this):this.isOnlyNTimesIfFaceup>0&&n>=this.isOnlyNTimesIfFaceup&&this.entity.counterHolder.incrementActionCount(this),this.definition.isApplicableTo(this,t,i,a)});u(this,"substitute",async(t,i,a)=>{const n=await this.definition.substitute(this,t,i,a);return this.isOnlyNTimesPerTurnIfFaceup>0?this.entity.counterHolder.incrementActionCountPerTurn(this):this.isOnlyNTimesIfFaceup>0&&this.entity.counterHolder.incrementActionCount(this),n});u(this,"getClone",()=>new zi(this.seq,this.entity,this.definition))}get definition(){return super.definition}};u(zi,"createNew",(t,i)=>new zi("AutoSeq",t,i));let ma=zi;const vc={title:"ペンデュラム召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:r=>{const e=r.activator.getPendulumScales();if(!e||e.upperBound-e.lowerBound<2)return;const t=[...r.activator.getExtraDeck().cardEntities,...r.activator.getExtraDeck().cardEntities.filter(n=>n.face==="FaceUp")].filter(n=>n.status.kind==="Monster").filter(n=>n.lvl&&n.lvl>e.lowerBound).filter(n=>n.lvl&&n.lvl<e.upperBound);if(!t.length)return;const i=[...r.activator.getMonsterZones(),...r.activator.getEmptyExtraZones()];return r.activator.getEnableSummonList(r.activator,"PendulumSummon",["Rule"],r.action,t.map(n=>({monster:n,cells:i,posList:Ye})),[],!1).length>1?[]:void 0},prepare:async r=>{const e=r.activator.getPendulumScales();if(!e||e.upperBound-e.lowerBound<2)return;const t=[...r.activator.getExtraDeck().cardEntities,...r.activator.getExtraDeck().cardEntities.filter(a=>a.face==="FaceUp")].filter(a=>a.status.kind==="Monster").filter(a=>a.lvl&&a.lvl>e.lowerBound).filter(a=>a.lvl&&a.lvl<e.upperBound);if(!t.length)return;const i=[...r.activator.getMonsterZones(),...r.activator.getEmptyExtraZones()];return await r.activator.summonMany(r.activator,"PendulumSummon",["Rule"],r.action,t.map(a=>({monster:a,posList:Ye,cells:i})),[],!1,void 0,a=>a.length>0,!1),nt()},execute:async r=>(r.activator.getPendingMonstersOnField().forEach(e=>e.determine()),!0),settle:async()=>!0},pc=[vc],Ss=["FusionSummon","SyncroSummon","XyzSummon","PendulumSummon","LinkSummon","RitualSummon","FlipSummon"],hc={FusionSummon:"融合召喚",SyncroSummon:"シンクロ召喚",XyzSummon:"エクシーズ召喚",PendulumSummon:"ペンデュラム召喚",LinkSummon:"リンク召喚",RitualSummon:"儀式召喚",FlipSummon:"反転召喚"},gc=[...Ss,"AdvanceSummon","NormalSummon","SpecialSummon"],yc={BattleDestroy:"戦闘破壊",EffectDestroy:"効果破壊",RuleDestroy:"ルール破壊"},Cs=r=>r+"Summon",hn=["Card","Token","Avatar"],mc=["Duelist","Squatter"],ks=(r,e)=>ji(r.origin,e.origin),ze=class ze{constructor(e,t,i,a,n,s,o){u(this,"onBeforeMoveEvent",new nn);u(this,"onAfterMoveEvent",new nn);u(this,"seq");u(this,"origin");u(this,"entityType");u(this,"summonFilterBundle");u(this,"procFilterBundle");u(this,"numericOprsBundle");u(this,"statusOperatorBundle");u(this,"moveLog");u(this,"counterHolder");u(this,"face");u(this,"orientation");u(this,"owner");u(this,"fieldCell");u(this,"_status");u(this,"_numericStatus");u(this,"_info");u(this,"actions",[]);u(this,"continuousEffects",[]);u(this,"substituteEffects",[]);u(this,"canBeReleased",(e,t,i,a)=>!this.isInTrashCell&&this.procFilterBundle.operators.filter(n=>n.procTypes.union(i).length).every(n=>n.filter(e,t,a,[this])));u(this,"canBeSentToGraveyard",(e,t,i,a)=>!this.info.willBeBanished&&!this.info.willReturnToDeck&&this.procFilterBundle.operators.filter(n=>n.procTypes.union(i).length).every(n=>n.filter(e,t,a,[this])));u(this,"_hasDisappeared",!1);u(this,"cardDefinition");u(this,"toString",()=>this.entityType==="Card"?`《${this.nm}》`:this.nm);u(this,"onUsedAsMaterial",(e,t)=>{this.cardDefinition&&this.cardDefinition.onUsedAsMaterial&&this.cardDefinition.onUsedAsMaterial(e,t)});u(this,"setBattlePosition",async(e,t,i,a)=>{let n=`表示形式の変更：${this.toString()}（${this.battlePositionName}⇒${dr[e]}）`;const s=[...t];this.battlePosition==="Set"&&(s.push("Flip"),t.includes("Rule")&&(this.info.isPending=!0,n=`${this.toString()}を反転召喚`,this.info.summonKinds.push("FlipSummon"),s.push("FlipSummon"),s.push("AttackSummon"))),this.duel.log.info(n,a),await this.moveAlone(this.fieldCell,"Monster",e==="Set"?"FaceDown":"FaceUp",e==="Attack"?"Vertical":"Horizontal","Top",s,i,a,a)});u(this,"activateAsPendulumScale",(e,t,i,a)=>this.moveAlone(e,"Spell","FaceUp","Vertical","Top",["CardActivation",...t],i,a,a));u(this,"setNonFieldMonsterPosition",async(e,t,i,a,n)=>{this.moveAlone(this.fieldCell,e,t==="FaceUp"?"FaceUp":"FaceDown","Vertical","Top",i,a,n,n)});u(this,"setAsSpellTrap",async(e,t,i,a,n)=>{await this.moveAlone(e,t,"FaceDown","Vertical","Top",[...i,"SpellTrapSet"],a,n,n)});u(this,"activateSpellTrapFromHand",async(e,t,i,a,n)=>{await this.moveAlone(e,t,"FaceUp","Vertical","Top",[...i,"CardActivation"],a,n,n)});u(this,"activateSpellTrapOnField",async(e,t,i,a)=>{await this.moveAlone(this.fieldCell,e,"FaceUp","Vertical","Top",[...t,"CardActivation"],i,a,a)});u(this,"draw",async(e,t,i)=>await this.addToHand([...e,"Draw"],t,i));u(this,"addToHand",async(e,t,i)=>await this.moveAlone(this.owner.getHandCell(),this.origin.kind,"FaceDown","Vertical","Bottom",[...e],t,i,i));u(this,"summon",(e,t,i,a,n,s,o)=>ze.summonMany([{monster:this,dest:e,summoner:o??s,pos:t}],i,a,n,s));u(this,"moveForcibly",async(e,t,i,a,n,s,o)=>{await this.moveAlone(e,this.origin.kind,t,i,a,["Rule",...n],s,o,o)});u(this,"moveAlone",async(e,t,i,a,n,s,o,d,l)=>(await ze.moveMany([[this,e,t,i,a,n,s,o,d,l]],void 0),this.fieldCell));u(this,"determine",()=>{this.info.isPending&&(this.info.isPending=!1,this.moveLog.finalize(),this.continuousEffects.forEach(e=>e.updateState()))});u(this,"_move",async(e,t,i,a,n,s,o,d,l)=>{if(!e)throw new Error("illegal argument: to");if(await this.onBeforeMoveEvent.trigger({entity:this,args:[e,t,i,a,n,s,o,d,l]}),this.face=i,this.orientation=a,e!==this.fieldCell){if(this.field.duel.clock.turn>0&&(this.duel.log.info(`移動：${this.toString()}  ${this.fieldCell.toString()} ⇒ ${e.toString()}`,d),await this.field.duel.view.waitAnimation({entity:this,to:e,index:n,count:0})),this.fieldCell.releaseEntities(this),this.fieldCell.isPlayFieldCell&&!e.isPlayFieldCell&&(this.counterHolder.clear(),this.resetCauseOfDeath(),this.entityType==="Token")){this._hasDisappeared=!0,this.field.duel.log.info(`${this.nm}は消滅した。`,this.controller);return}this.status.kind!=="XyzMaterial"&&(this.fieldCell.isMonsterZoneLikeCell&&!e.isMonsterZoneLikeCell||t!=="Monster")&&(this.info.equipEntities.filter(c=>c.isOnFieldAsSpellTrapStrictly).forEach(c=>{c.info.isDying=!0,c.info.causeOfDeath=["RuleDestroy"],this.controller.writeInfoLog(`装備対象${this.toString()}不在により${c.toString()}は破壊された。`)}),this.info.equipEntities=[],this.fieldCell.xyzMaterials.forEach(c=>{c.info.isDying=!0,c.info.causeOfDeath=["LostXyzOwner"],this.controller.writeInfoLog(`エクシーズモンスター${this.toString()}不在により${c.toString()}は墓地に送られた。`)}),this.resetNumericStatus(),this.info.willBeBanished=!1,this.info.willReturnToDeck=void 0,this.info.isEffectiveIn.push(...ei)),this.fieldCell.cellType==="SpellAndTrapZone"&&e.cellType!=="SpellAndTrapZone"&&(this.info.equipedBy=void 0,this.info.equipedAs=void 0,this.info.willBeBanished=!1,this.info.willReturnToDeck=void 0,this.info.isEffectiveIn.push(...ei)),e.acceptEntities(this,n),(e===this.isBelongTo||e.cellType==="Hand"||e.cellType==="Banished"&&this.face==="FaceDown")&&(this.counterHolder.clear(),this.resetInfoAll(),this.resetStatusAll())}return(this.isOnFieldStrictly&&this.face==="FaceDown"||t==="XyzMaterial")&&(this.info.equipEntities.forEach(c=>{c.info.isDying=!0,c.info.causeOfDeath=["RuleDestroy"],this.controller.writeInfoLog(`装備対象${this.toString()}不在により${c.toString()}は破壊された。`)}),this.counterHolder.removeAllWhenfaceDown(),this.info.materials=[],this._status.isEffective=!0,this.info.isEffectiveIn=[...Ei],this.info.willBeBanished=!1,this.info.willReturnToDeck=void 0,this.resetNumericStatus(),this.info.isSettingSickness=this.status.kind==="Trap"||this.status.spellCategory==="QuickPlay"),this._status.kind=t,this.moveLog.push(t,s,o,d,l),await this.onAfterMoveEvent.trigger(this),e});u(this,"initForTurn",()=>{this.info.isSettingSickness=!1,this.info.attackCount=0,this.info.battlePotisionChangeCount=0,this.counterHolder.corpseDisposal()});u(this,"resetInfoIfLeavesTheField",()=>{this._info={...this._info,isDying:!1,isPending:!1,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,effectTargets:{},attackCount:0,battlePotisionChangeCount:0,materials:[],equipedBy:void 0,equipedAs:void 0,equipEntities:[]},this._info.isEffectiveIn.push(...ei),this._info.isEffectiveIn.distinct()});u(this,"resetInfoAll",()=>{var e;this._info={isDying:!1,isPending:!1,isEffectiveIn:[...Ei],causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,isVanished:!1,isRebornable:((e=this.origin.monsterCategories)==null?void 0:e.union(cs).length)===0,isSettingSickness:!1,summonKinds:[],materials:[],effectTargets:{},willBeBanished:!1,willReturnToDeck:void 0,attackCount:0,battlePotisionChangeCount:0,equipedBy:void 0,equipedAs:void 0,validateEquipOwner:()=>!0,equipEntities:[]},this.counterHolder.clear()});u(this,"resetNumericStatus",()=>{const e=us.reduce((t,i)=>(t[i]=this.origin[i],t),{});this._numericStatus={origin:{...e},wip:{...e},calculated:{...e}}});u(this,"resetStatus",()=>{this._status={...this.origin,canAttack:!0,isEffective:!0,canDirectAttack:!1,canActivateEffect:!0,isSelectableForAttack:!0,allowHandSyncro:!1,allowHandLink:!1,maxCounterQty:{}}});u(this,"resetStatusAll",()=>{this.resetNumericStatus(),this.resetStatus()});u(this,"resetCauseOfDeath",()=>{this.info.isDying=!1,this.info.causeOfDeath=[],this.info.isKilledBy=void 0,this.info.isKilledByWhom=void 0});var c,f;this.seq=ze.nextEntitySeq++,this.counterHolder=new tc,this.cardDefinition=o,this.owner=e,this.fieldCell=t,this.entityType=i,this.origin=a,this._status=JSON.parse(JSON.stringify(a)),this._numericStatus=JSON.parse(JSON.stringify(a)),this.resetStatusAll(),this._info={isEffectiveIn:[...Ei],attackCount:0,battlePotisionChangeCount:0,isDying:!1,isPending:!1,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,isVanished:!1,isRebornable:!0,isSettingSickness:!1,summonKinds:[],materials:[],effectTargets:{},willBeBanished:!1,willReturnToDeck:void 0,equipedBy:void 0,equipedAs:void 0,validateEquipOwner:()=>!0,equipEntities:[]},this.resetInfoAll(),this.face=n,this.orientation=s,this.summonFilterBundle=new Wo(t.field.summonFilterPool,this),this.procFilterBundle=new Fo(t.field.procFilterPool,this),this.numericOprsBundle=new Lo(t.field.numericStateOperatorPool,this),this.statusOperatorBundle=new Vo(t.field.statusOperatorPool,this),t.acceptEntities(this,"Top"),this.moveLog=new Xo(this),this.moveLog.pushForRuleAction(["Spawn"]);let d=[],l=[];this.origin.kind==="Monster"&&((c=this.origin.monsterCategories)!=null&&c.includes("Normal"))&&!((f=this.origin.monsterCategories)!=null&&f.includes("Pendulum"))?d=[Ue,he,ge,Se]:o&&(d=o.actions,l=o.continuousEffects??[],this.substituteEffects.push(...(o.substituteEffects??[]).map(p=>ma.createNew(this,p))),this.origin.kind==="Monster"&&this.entityType==="Card"&&this.summonFilterBundle.push(new Yo("default",()=>!0,!0,this,{},()=>!0,gc,o.defaultSummonFilter??at)),o.defaultStatus&&this.statusOperatorBundle.push(new qa("default",()=>!0,!0,this,{},()=>!0,()=>o.defaultStatus??{}))),this.actions.push(...d.map(p=>bi.createNew(this,p))),this.continuousEffects.push(...l.map(p=>pa.createNew(this,p)))}get onBeforeMove(){return this.onBeforeMoveEvent.expose()}get onAfterMove(){return this.onAfterMoveEvent.expose()}get isUnderControl(){return this.face==="FaceUp"||fs.every(e=>e!==this.fieldCell.cellType)}get controller(){return this.fieldCell.owner??this.owner}get field(){return this.owner.duel.field}get duel(){return this.owner.duel.field.duel}get actionLogRecords(){return this.duel.chainBlockLog.records.filter(e=>e.chainBlockInfo.action.entity===this)}get status(){return this._status}set status(e){this._status={...e}}get numericStatus(){return this._numericStatus}get info(){return this._info}get nm(){return this.status.name}get atk(){return this._numericStatus.calculated.attack}get def(){return this._numericStatus.calculated.defense}get lvl(){return this._numericStatus.calculated.level}get rank(){return this._numericStatus.calculated.rank}get attr(){return this.status.attributes??[]}get types(){return this.status.types??[]}get psL(){return this._numericStatus.calculated.pendulumScaleL}get psR(){return this._numericStatus.calculated.pendulumScaleR}get linkArrows(){let e=(this.origin.linkArrowKeys??[]).map(t=>ds[t].linkArrow);return this.controller.seat==="Above"&&(e=e.map(t=>({offsetColumn:t.offsetColumn*-1,offsetRow:t.offsetRow*-1}))),e}get linkArrowDests(){var e;return(e=this.origin.monsterCategories)!=null&&e.includes("Link")?this.isOnFieldAsMonsterStrictly?this.linkArrows.map(t=>[this.fieldCell.row+t.offsetRow,this.fieldCell.column+t.offsetColumn]).map(([t,i])=>this.field.cells[t][i]).filter(t=>t.isMonsterZoneLikeCell):[]:[]}get linkedEntities(){return this.isOnFieldAsMonsterStrictly?[...this.linkArrowDests.map(e=>e.cardEntities[0]).map(e=>e),...this.fieldCell.linkArrowSources].getDistinct():[]}get coLinkedEntities(){var e;return this.isOnFieldAsMonsterStrictly?(e=this.origin.monsterCategories)!=null&&e.includes("Link")?this.linkArrowDests.map(t=>t.cardEntities[0]).filter(t=>t).union(this.fieldCell.linkArrowSources):[]:[]}get isEffective(){return this.status.isEffective&&this.info.isEffectiveIn.includes(this.fieldCell.cellType)}get isEffectiveWeakly(){return this.status.isEffective}get battlePosition(){if(this.isOnFieldStrictly&&this.status.kind==="Monster")return this.orientation==="Vertical"?"Attack":this.face==="FaceUp"?"Defense":"Set"}get battlePositionName(){const e=this.battlePosition;if(e)return dr[e]}get wasMovedAtCurrentProc(){return this.field.duel.clock.totalProcSeq===this.moveLog.latestRecord.movedAt.totalProcSeq}get wasMovedAtPreviousProc(){return this.field.duel.clock.totalProcSeq===this.moveLog.latestRecord.movedAt.totalProcSeq+1}get wasMovedAtCurrentTurn(){return this.field.duel.clock.isSameTurn(this.moveLog.latestRecord.movedAt)}get wasMovedAtCurrentChain(){return this.field.duel.clock.isSameChain(this.moveLog.latestRecord.movedAt)}get wasMovedAtPreviousChain(){return this.field.duel.clock.isPreviousChain(this.moveLog.latestRecord.movedAt)}get wasMovedAtPreviousTurn(){return this.field.duel.clock.isPreviousTurn(this.moveLog.latestRecord.movedAt)}get wasMovedFrom(){return this.moveLog.previousPlaceRecord.cell}get isPendulumScale(){var e;return!(!((e=this.origin.monsterCategories)!=null&&e.includes("Pendulum"))||!this.isOnField||!this.fieldCell.isSpellTrapZoneLikeCell||this.status.spellCategory)}get isOnField(){return this.fieldCell.isPlayFieldCell}get isOnFieldStrictly(){return this.isOnField&&!this.info.isPending&&this.status.kind!=="XyzMaterial"}get isOnFieldAsMonsterStrictly(){return this.fieldCell.isMonsterZoneLikeCell&&this.isOnFieldStrictly}get isOnFieldAsSpellTrapStrictly(){return this.fieldCell.isSpellTrapZoneLikeCell&&this.isOnFieldStrictly}get isInTrashCell(){return this.fieldCell.isTrashCell}get isLikeContinuousSpell(){return this.status.spellCategory==="Continuous"||this.status.spellCategory==="Field"||this.status.spellCategory==="Equip"||this.status.trapCategory==="Continuous"||(this.status.monsterCategories??[]).includes("Pendulum")}get isBelongTo(){return this.origin.monsterCategories&&this.origin.monsterCategories.union(Ai).length?this.owner.getExtraDeck():this.owner.getDeckCell()}get hasDisappeared(){return this._hasDisappeared}get allStickyEffectOperators(){return[...this.procFilterBundle.operators,...this.numericOprsBundle.operators]}};u(ze,"nextEntitySeq",0),u(ze,"splitBattlePos",e=>({face:e==="Set"?"FaceDown":"FaceUp",orientation:e==="Attack"?"Vertical":"Horizontal"})),u(ze,"recreateArray",(e,t)=>{if(!t.length)return[];const i=e.getAllCells().flatMap(a=>a.entities);return t.map(a=>a.seq).map(a=>i.find(n=>n.seq===a)).filter(a=>a!==void 0)}),u(ze,"createPlayerEntity",e=>{const t=e.getHandCell();return new ze(e,t,"Duelist",{name:e.profile.name,kind:"Monster",wikiEncodedName:"%A5%D7%A5%EC%A5%A4%A5%E4%A1%BC"},"FaceUp","Vertical",{name:e.profile.name,actions:[...pc]})}),u(ze,"createCardEntity",(e,t)=>{const i=t.monsterCategories&&t.monsterCategories.union(Ai).length?e.getExtraDeck():e.getDeckCell(),a=new ze(e,i,"Card",wo(t),"FaceDown","Vertical",Ca.get(t.name));return Object.hasOwn(pt,a.origin.name)||e.duel.log.info(`未実装カード${t.name}がデッキに投入された。`,e),a}),u(ze,"moveMany",async(e,t)=>{if(!e.length)return;const i=e[0][0].duel,n=[...e.filter(([o,d])=>o.fieldCell!==d).map(([o])=>o).filter(o=>!(t??[]).includes(o)),...i.field.getCardsOnFieldStrictly().filter(o=>o.info.isDying)],s=new Map;for(e.forEach(([o,d,l,c,f,p,...h])=>{var b;let m=d,C=l,y=c,w=p,k=f;o.info.willBeBanished?(m=o.owner.getBanished(),y="FaceUp",k="Vertical"):o.info.willReturnToDeck?(m=o.isBelongTo,y="FaceDown",w=o.info.willReturnToDeck,k="Vertical"):(b=o.status.monsterCategories)!=null&&b.includes("Pendulum")&&o.isOnFieldStrictly&&o.face==="FaceUp"&&d.isTrashCell&&(m=o.owner.getExtraDeck(),y="FaceUp",w="Top",k="Vertical"),m.cellType==="ExtraDeck"&&(w=y==="FaceUp"?"Top":"Bottom"),o.isBelongTo.cellType==="ExtraDeck"&&(m.cellType==="Hand"||m.cellType==="Deck")&&(m=o.isBelongTo,y="FaceDown",k="Vertical"),m.isPlayFieldCell||(C=o.origin.kind),m.isMonsterZoneLikeCell||(k="Vertical"),s.set(m,[[o,m,C,y,k,w,...h],...s.get(m)??[]])});;){const o=Array.from(s.values()).map(l=>l.pop()).filter(l=>l!==void 0).map(([l,...c])=>l._move(...c));if(!o.length)break;await Promise.all(o);const d=i.field.getCardsOnFieldStrictly().filter(l=>l.info.isDying).filter(l=>!n.includes(l)).map(l=>({entity:l,causedAs:l.info.causeOfDeath??[],causedBy:l.info.isKilledBy,activator:l.info.isKilledByWhom}));d.length&&await ze.sendManyToGraveyard(d,n)}ze.settleEntityMove(i)}),u(ze,"summonMany",async(e,t,i,a,n)=>{if(!e.length)return;const s={Attack:"AttackSummon",Defense:"DefenseSummon",Set:"SetSummon"},o=e.map(({monster:d,dest:l,pos:c,summoner:f})=>{if(d.info.summonKinds=[t],t==="NormalSummon"||t==="AdvanceSummon"){d.info.summonKinds.push("NormalSummon");const m=t==="AdvanceSummon"?"アドバンス":"";c==="Attack"?d.field.duel.log.info(`${d.toString()}を${m}召喚`,f):d.duel.log.info(`${d.toString()}を${m}セット`,f),i.includes("Rule")?f.info.ruleNormalSummonCountQty++:f.info.effectNormalSummonCountQty++}else t==="SpecialSummon"?d.duel.log.info(`${d.toString()}を${dr[c]}で特殊召喚`,f):(d.info.summonKinds.push("SpecialSummon"),d.duel.log.info(`${d.toString()}を${dr[c]}で${hc[t]}！`,f)),f.info.specialSummonCountQty++;d.info.summonKinds=d.info.summonKinds.getDistinct(),d.info.battlePotisionChangeCount=1;const{face:p,orientation:h}=ze.splitBattlePos(c);return i.includes("Rule")&&(d.info.isPending=!0),{entity:d,args:[l,"Monster",p,h,"Top",[t,s[c],...i],a,n,f]}}).map(d=>d.entity._move(...d.args));await Promise.all(o),e.map(d=>d.summoner).forEach(d=>{t==="NormalSummon"||t==="AdvanceSummon"?i.includes("Rule")?d.info.ruleNormalSummonCount++:d.info.effectNormalSummonCount++:d.info.specialSummonCount++}),ze.settleEntityMove(e[0].monster.duel)}),u(ze,"sendManyToGraveyard",(e,t)=>ze.bringManyToSameCell("Graveyard","Top",e.map(i=>({...i,face:"FaceUp",orientation:"Vertical"})),t)),u(ze,"bringManyToSameCell",(e,t,i,a)=>ze.moveMany(i.map(n=>[n.entity,n.entity.field.getCells(e).filter(s=>s.owner===n.entity.owner)[0],n.entity.origin.kind,n.face,n.orientation,t,n.causedAs,n.causedBy,n.activator,n.activator]),a)),u(ze,"settleEntityMove",e=>{e.field.recalcLinkArrows(),e.distributeOperators(e.clock);const t=e.field.getAllEntities().filter(i=>i.wasMovedAtCurrentProc);t.filter(i=>!i.isOnFieldStrictly&&!i.info.isPending).forEach(i=>i.resetInfoIfLeavesTheField()),t.filter(i=>i.face==="FaceDown").filter(i=>i.fieldCell===i.isBelongTo).forEach(i=>{i.resetInfoAll(),i.resetStatusAll()}),t.flatMap(i=>i.continuousEffects).forEach(i=>i.updateState()),e.field.getAllCells().filter(i=>i.needsShuffle).map(i=>i.shuffle())});let xe=ze;xe.prototype.hasBeenSummonedNow=function(r,e=["Attack","Defense"]){const t=this,i=e.map(Cs),a=t.moveLog.latestRecord.movedAs;return!(!t.wasMovedAtPreviousChain||!a.union(r).length||!a.union(i).length)};xe.prototype.hasBeenSummonedJustNow=function(r,e=["Attack","Defense"]){const t=this,i=e.map(Cs),a=t.moveLog.latestRecord.movedAs;return!(!t.wasMovedAtPreviousProc||!a.union(r).length||!a.union(i).length)};xe.prototype.getAttackTargets=function(){if(!this.hasAttackRight())return[];const r=this.controller.getOpponentPlayer().getMonstersOnField().filter(e=>e.status.isSelectableForAttack);return(this.status.canDirectAttack||!r.length)&&r.push(this.controller.getOpponentPlayer().entity),r.filter(e=>e.canBeTargetOfBattle(this.controller,this)).filter(e=>this.procFilterBundle.operators.filter(t=>t.procTypes.includes("BattleTarget")).every(t=>t.filter(this.controller,this,{},[e])))};xe.prototype.canDirectAttack=function(){return this.getAttackTargets().some(r=>r.entityType==="Duelist")};xe.prototype.canAttackToMonster=function(){return this.getAttackTargets().some(r=>r.entityType!=="Duelist")};xe.prototype.hasAttackRight=function(){return this.battlePosition==="Attack"&&this.info.attackCount===0&&this.status.canAttack};xe.prototype.canBeEffected=function(r,e,t){return this.procFilterBundle.operators.filter(a=>a.procTypes.some(n=>n==="Effect")).every(a=>a.filter(r,e,t,[this]))};const ws=(r,e,t,i,a)=>r.canBeEffected(t,i,a)&&r.procFilterBundle.operators.filter(n=>n.procTypes.some(s=>s===e)).every(n=>n.filter(t,i,a,[r]));xe.prototype.canBeTargetOfEffect=function(r){return ws(this,"EffectTarget",r.activator,r.action.entity,r.action)};xe.prototype.canBeBanished=function(r,e,t,i){return this.fieldCell.cellType==="Banished"?!1:ws(this,r,e,t,i)};xe.prototype.canBeTargetOfBattle=function(r,e){const t=this;return t.procFilterBundle.operators.filter(i=>i.procTypes.some(a=>a==="BattleTarget")).every(i=>i.filter(r,e,{},[t]))};xe.prototype.validateDestory=function(r,e,t,i){const a=this;let n=a.procFilterBundle.operators.filter(s=>s.procTypes.includes(r)).every(s=>s.filter(e,t,i??{},[a]));return n&&r==="EffectDestroy"&&(n=a.canBeEffected(e,t,i)),n};xe.prototype.getIndexInCell=function(){const r=this;if(r.info.isVanished)return-1;const e=r.fieldCell.cardEntities.indexOf(r);if(e<0)throw new oe("エンティティとセルの状態が矛盾している。",[r,r.fieldCell]);return e};xe.prototype.getXyzMaterials=function(){const r=this;return(r.status.monsterCategories??[]).includes("Xyz")?r.fieldCell.xyzMaterials:[]};xe.prototype.wasMovedAfter=function(r){return this.moveLog.latestRecord.movedAt.totalProcSeq>r.totalProcSeq};xe.prototype.release=async function(r,e,t){return await this.sendToGraveyard([...r,"Release"],e,t),this.info.isVanished?void 0:this.fieldCell};xe.prototype.ruleDestory=async function(){return await this.sendToGraveyard(["RuleDestroy"],void 0,void 0),this.info.isVanished?void 0:this.fieldCell};xe.prototype.sendToGraveyard=function(r,e,t){return fe.sendManyToGraveyardForTheSameReason([this],r,e,t)};xe.prototype.discard=function(r,e,t){return fe.discardManyForTheSameReason([this],r,e,t)};xe.prototype.returnToDeck=function(r,e,t,i){return fe.returnManyToDeckForTheSameReason(r,[this],e,t,i)};xe.prototype.banish=function(r,e,t){return fe.banishManyForTheSameReason([this],r,e,t)};di.prototype.summon=async function(r,e,t,i,a,n,s,o){return(await this.summonMany(this,r,e,t,[{monster:i,posList:a,cells:n}],s,!1,1,l=>l.length===1,o)??[])[0]};di.prototype.waitSelectEntities=function(r,e,t,i,a=!1){return this.duel.view.waitSelectEntities(this,r,e,t,i,a)};di.prototype.waitSelectEntity=async function(r,e,t=!1){const i=await this.waitSelectEntities(r,1,a=>a.length===1,e,t);return i?i[0]:void 0};let _c=class{constructor(e){u(this,"onUpdateEvent",new We);u(this,"nextSeq");u(this,"records",[]);u(this,"duel");u(this,"dispose",()=>{this.onUpdateEvent.clear()});u(this,"error",e=>{console.error(e);const t=["エラー発生"];e instanceof Error?(e instanceof oe&&(t.push("-- エラーメッセージ --"),t.push(e.message),t.push("-- 関連オブジェクト --"),e.items.forEach(i=>t.push(JSON.stringify(i))),console.error(e.items)),t.push("-- エラー名称 --"),t.push(e.name||"エラー名称取得失敗"),t.push("-- スタックトレース --"),t.push(e.stack||"スタックトレース取得失敗")):(t.push("-- エラー型特定失敗 --"),t.push(JSON.stringify(e))),this.write("error","System",t,void 0,void 0,void 0,void 0,void 0)});u(this,"warn",e=>{this.write("warn","System",["【注意】",e],void 0,void 0,void 0,void 0,void 0)});u(this,"info",(e,t)=>{this.write("info","Others",[e],t,void 0,void 0,void 0,void 0)});u(this,"pushMoveLog",(e,t,i,a)=>{this.write("info","EntityMove",["移動"],e,t,void 0,i,a)});u(this,"write",(e,t,i,a,n,s,o,d)=>{const l=i.join(`
`);this.records.push({seq:this.nextSeq++,lvl:e,type:t,clock:this.duel.clock.getClone(),text:l,duelist:a,mainEntity:n,subEntities:s??[],from:o,to:d}),this.onUpdateEvent.trigger(this.nextSeq-1)});this.nextSeq=0,this.duel=e}get onUpdate(){return this.onUpdateEvent.expose()}get lastRecord(){return this.records.slice(-1)[0]}};const Sc=r=>new Promise(e=>setTimeout(e,r)),Ts=()=>{let r=()=>{},e=()=>{};return{promise:new Promise((i,a)=>{r=i,e=a}),resolve:r,reject:e}};class ea{constructor(e){u(this,"onUpdateEvent",new We);u(this,"_state","Disable");u(this,"defaultArgs");u(this,"_args");u(this,"resolve",()=>{});u(this,"show",e=>{this._args=e,this._state="Shown",this.onUpdateEvent.trigger();const{promise:t,resolve:i}=Ts();return this.resolve=a=>{this._state="Disable",i(a),this.resolve=()=>{},this.onUpdateEvent.trigger()},t});u(this,"cancel",()=>{this._state!=="Disable"&&this.resolve(void 0),this.terminate()});u(this,"terminate",()=>{this._state="Disable",this._args=this.defaultArgs,this.resolve=()=>{}});this.defaultArgs=e,this._args=e}get onUpdate(){return this.onUpdateEvent.expose()}get state(){return this._state}get args(){return this._args}}class Cc{constructor(e){u(this,"onUpdateEvent",new We);u(this,"actionSelector",new ea({title:"カード操作を選択。",activator:void 0,dummyActionInfos:[],cancelable:!1}));u(this,"entitySelector",new ea({title:"対象を選択",entities:[],validator:()=>!0,qty:-1,cancelable:!1,chainBlockInfos:[]}));u(this,"textSelector",new ea({title:"カード操作を選択。",choises:[],cancelable:!1}));u(this,"modals",[this.actionSelector,this.entitySelector,this.textSelector]);u(this,"view");u(this,"terminateAll",()=>{this.modals.forEach(e=>e.terminate()),this.onUpdateEvent.trigger()});this.view=e,this.modals.forEach(t=>t.onUpdate.append(()=>this.onUpdateEvent.trigger()))}get onUpdate(){return this.onUpdateEvent.expose()}}class kc{constructor(e){u(this,"onDuelUpdateEvent",new We);u(this,"requireUpdate",()=>{this.onDuelUpdateEvent.trigger()});u(this,"onWaitStartEvent",new We);u(this,"onWaitEndEvent",new We);u(this,"onDragStartEvent",new We);u(this,"onDragEndEvent",new We);u(this,"onAnimationStartEvent",new We);u(this,"onShowCardEntityEvent",new We);u(this,"duel");u(this,"modalController");u(this,"_message");u(this,"waitMode");u(this,"infoBoardState");u(this,"infoBoardCell");u(this,"getCell",(e,t)=>this.duel.field.cells[e][t]);u(this,"showCardInfo",(e,t)=>{this.onShowCardEntityEvent.trigger({card:e,mode:t})});u(this,"dispose",()=>{this.onDragStartEvent.clear(),this.onDragEndEvent.clear(),this.onDuelUpdateEvent.clear(),this.onWaitStartEvent.clear(),this.onWaitEndEvent.clear()});u(this,"waitFieldAction",async e=>{if(this.duel.getTurnPlayer().duelistType==="NPC"){const n=this.duel.getTurnPlayer().selectActionForNPC(e,[]);return n?{actionInfo:n}:{phaseChange:this.duel.nextPhaseList[0]}}const t=await this._waitDuelistAction(this.duel.getTurnPlayer(),e,"SelectFieldAction","");if(!t.actionInfo)return{...t,actionInfo:void 0};const i={...t.actionInfo},a=e.find(n=>{var s;return((s=t.actionInfo)==null?void 0:s.originSeq)===n.originSeq});if(!a)throw new oe("想定されない状態",e,t);return{...t,actionInfo:{dest:i.dest,battlePosition:i.battlePosition,action:a.action,originSeq:a.originSeq}}});u(this,"waitQuickEffect",async(e,t,i,a,n)=>{if(t.length===0)return;if(e.duelistType==="NPC")return e.selectActionForNPC(t,i);const s=[];return s.push(this.modalController.actionSelector.show({title:a,activator:e,dummyActionInfos:t,cancelable:n}).then(o=>{if(o)return t.find(d=>d.originSeq===o.originSeq)})),s.push(this._waitDuelistAction(e,t,"SelectAction",this.message).then(o=>(this.infoBoardState="Log",t.find(d=>{var l;return((l=o.actionInfo)==null?void 0:l.originSeq)===d.originSeq})))),await Promise.any(s)});u(this,"waitSubAction",async(e,t,i,a=!1)=>{if(e.duelistType==="NPC")throw Error("Not implemented");const n=await this._waitDuelistAction(e,t,"SelectAction",i,void 0,void 0,void 0,a);if(n&&n.actionInfo)return n.actionInfo});u(this,"waitSelectEntities",async(e,t,i,a,n,s=!1)=>{if(!t.length)return;let o=[];if(i&&t.length===i)return[...t];if(e.duelistType==="NPC"){for(;!a(o);){const l=i&&i>0?i:Math.floor(Math.random()*t.length)+1;o=t.randomPickMany(l)}return o}return this.waitMode=t.every(l=>l.fieldCell.isPlayFieldCell&&l.getIndexInCell()===0||l.fieldCell.cellType==="Hand"&&l.controller===e)?"SelectFieldEntities":"SelectEntities",[...(await this._waitDuelistAction(e,[],this.waitMode,n,t,i,a,s)).selectedEntities??[]]});u(this,"_waitDuelistAction",async(e,t,i,a,n,s,o,d=!1)=>{this.waitMode=i,this._message=a,this.onDuelUpdateEvent.trigger();const l=Ts(),c={resolve:l.resolve,activator:e,dummyActionInfos:t,qty:s,chainBlockInfos:e.duel.chainBlockInfos,entitiesValidator:o||(()=>!1),selectableEntities:n||[]};n&&o&&this.waitMode==="SelectEntities"&&(c.duelEntitiesSelectorArg={title:a,entities:n,validator:o,qty:s??-1,cancelable:!1,chainBlockInfos:e.duel.chainBlockInfos}),this.onWaitStartEvent.trigger(c);const f=await l.promise;if(this.modalController.terminateAll(),this.waitMode="None",this.onWaitEndEvent.trigger(),f.surrender)throw new qt(e.getOpponentPlayer(),`${e.profile.name}がサレンダーした。`);if(!d&&f.cancel)throw new oe("キャンセル不可のアクションがキャンセルされた。",f,t,i,n);return this.infoBoardState="Log",f});u(this,"waitSelectText",async(e,t,i=!1)=>this.modalController.textSelector.show({title:t,choises:e,cancelable:i}));u(this,"waitAnimation",async e=>(this._message="",this.waitMode="Animation",this.onDuelUpdateEvent.trigger(),new Promise(t=>this.onAnimationStartEvent.trigger({...e,resolve:t}))));u(this,"setDraggingActions",e=>{this.onDragStartEvent.trigger(e),this.requireUpdate()});u(this,"removeDraggingActions",()=>{this.onDragEndEvent.trigger()});u(this,"waitSelectAction",async(e,t,i,a)=>{var d;const n=t.map(l=>bi.createDummyAction(l.entity,l.title,[],void 0,l.origin)),s=await this._waitDammyAction(e,n,i,a);if(!s)return;const o=(d=t.find(l=>l.origin.seq===s.originSeq))==null?void 0:d.origin;if(!o)throw new oe("想定されない状態",t,s);return o});u(this,"waitSelectSummonDestination",async(e,t,i,a,n)=>{const s=i.length>1?"カードを召喚先へドラッグ。":"表示形式を選択。";if(!i.length&&!a.length){if(n)return;throw new oe("想定されない状態",e,t,i,a,n)}const o={dest:i.randomPick(),battlePosition:a[0]},d=a.map(c=>bi.createDummyAction(t,c,i,c)),l=await this._waitDammyAction(e,d,s,n);if(l)return o.dest=l.dest??o.dest,o.battlePosition=l.battlePosition??o.battlePosition,o});u(this,"waitSelectDestination",async(e,t,i,a,n,s=!1)=>{if(!i.length)return;let o=i.randomPick();const d=[bi.createDummyAction(t,n,i,void 0)],l=await this._waitDammyAction(e,d,a,s);if(l)return o=l.dest??o,o});u(this,"_waitDammyAction",async(e,t,i,a=!1)=>{if(!t.length)return;const n=t.randomPick();let s={...n,dest:n.dest??n.dests.randomPick()};if(e.duelistType!=="NPC"){const o=[this.modalController.actionSelector.show({title:i,activator:e,dummyActionInfos:t,cancelable:!1}),this.duel.view.waitSubAction(e,t,i,a)],d=await Promise.any(o);if(!d&&!a)throw new Mi(d,o);if(!d)return;s=d??s}return s});this.duel=e,this._message="",this.waitMode="None",this.infoBoardState="Log",this.infoBoardCell=e.duelists.Below.getExtraDeck(),this.modalController=new Cc(this)}get onDuelUpdate(){return this.onDuelUpdateEvent.expose()}get onWaitStart(){return this.onWaitStartEvent.expose()}get onWaitEnd(){return this.onWaitEndEvent.expose()}get onDragStart(){return this.onDragStartEvent.expose()}get onDragEnd(){return this.onDragEndEvent.expose()}get onAnimation(){return this.onAnimationStartEvent.expose()}get onShowCardEntity(){return this.onShowCardEntityEvent.expose()}get message(){return this._message||this.duel.log.lastRecord.text}}const _a=["turn","phaseSeq","stepSeq","stageSeq","chainSeq","chainBlockSeq","procSeq"];[..._a];class wc{constructor(){u(this,"onClockChangeEvents",{turn:new We,phaseSeq:new We,stepSeq:new We,stageSeq:new We,chainSeq:new We,chainBlockSeq:new We,procSeq:new We});u(this,"_turn",0);u(this,"_phaseSeq",0);u(this,"_stepSeq",0);u(this,"_stageSeq",0);u(this,"_chainSeq",0);u(this,"_chainBlockSeq",0);u(this,"_procSeq",0);u(this,"_totalProcSeq",0);u(this,"_periodKey");u(this,"_previousStartPoints",{turn:0,phaseSeq:0,stepSeq:0,stageSeq:0,chainSeq:0,chainBlockSeq:0,procSeq:0});u(this,"_currentStartPoints",{turn:0,phaseSeq:0,stepSeq:0,stageSeq:0,chainSeq:0,chainBlockSeq:0,procSeq:0});u(this,"setPhase",(e,t)=>{const i=Object.values(ii).filter(a=>a.phase===t).find(a=>(a.step??"start")==="start");if(!i)throw new oe("想定されない状態",this.period,t,ii);t==="draw"?(this.turn>0&&e.log.info("ターン終了。",e.getTurnPlayer()),this._turn++,this._phaseSeq=0):(e.log.info(`フェイズ移行（${this.period.name}→${i.name}）`,e.getTurnPlayer()),this._phaseSeq++),this._stepSeq=0,this._stageSeq=0,this.periodKey=i.key});u(this,"setStep",(e,t)=>{const i=this.period.phase,a=Object.values(ii).filter(n=>n.phase===i).find(n=>(n.step??"")===t);if(!a)throw new oe("想定されない状態",this.period,t,ii);this.period.name!==a.name&&(e.log.info(`ステップ移行（${this.period.name}→${a.name}）`,e.getTurnPlayer()),this._stepSeq++,this._stageSeq=0,this.periodKey=a.key)});u(this,"setStage",(e,t)=>{const i=this.period,a=Object.values(ii).filter(n=>n.phase===i.phase).filter(n=>n.step===i.step).find(n=>(n.stage??"")===t);if(!a)throw new oe("想定されない状態",this.period,t,ii);e.log.info(`タイミング移行（${this.period.name}→${a.name}）`,e.getTurnPlayer()),this._stageSeq++,this.periodKey=a.key});u(this,"incrementChainSeq",()=>{this._chainSeq++,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq()});u(this,"incrementChainBlockSeq",()=>{this._chainBlockSeq++,this._procSeq=0,this.incrementTotalProcSeq()});u(this,"incrementProcSeq",()=>{this._procSeq++,this.incrementTotalProcSeq()});u(this,"incrementTotalProcSeq",()=>{this._totalProcSeq++;let e=!1;_a.toReversed().forEach(t=>{e&&(this._previousStartPoints[t]=this.currentStartPoints[t],this._currentStartPoints[t]=this.totalProcSeq),e=this[t]===0}),this.onClockChangeEvents.procSeq.trigger(this),_a.toReversed().filter(t=>this._currentStartPoints[t]=this.totalProcSeq).forEach(t=>this.onClockChangeEvents[t].trigger(this))});u(this,"toString",()=>`${this.totalProcSeq}(t${this.turn}-phs${this.phaseSeq}-stp${this.stepSeq}-stg${this.stepSeq}-c${this.chainSeq}-cb${this.chainBlockSeq}-prc${this.procSeq})`);u(this,"getClone",()=>({turn:this.turn,phaseSeq:this.phaseSeq,stepSeq:this.stepSeq,stageSeq:this.stageSeq,chainSeq:this.chainSeq,chainBlockSeq:this.chainBlockSeq,procSeq:this.procSeq,totalProcSeq:this.totalProcSeq,period:this.period}));u(this,"isSameTurn",e=>this.turn===e.turn);u(this,"isSameChain",e=>this.turn===e.turn&&this.phaseSeq===e.phaseSeq&&this.stepSeq===e.stepSeq&&this.stageSeq===e.stageSeq&&this.chainSeq===e.chainSeq);u(this,"isPreviousChain",e=>this.turn===e.turn&&this.phaseSeq===e.phaseSeq&&this.stepSeq===e.stepSeq&&this.stageSeq===e.stageSeq&&this.chainSeq===e.chainSeq+1);u(this,"isPreviousTurn",e=>this.turn===e.turn+1);u(this,"isPreviousProc",e=>this.totalProcSeq===e.totalProcSeq+1);u(this,"isUponAttackDeclaration",()=>this.period.step==="battle"&&this.chainSeq===1);this._periodKey="end"}get onTurnChange(){return this.onClockChangeEvents.turn.expose()}get onStageChange(){return this.onClockChangeEvents.stageSeq.expose()}get onProcSeqChange(){return this.onClockChangeEvents.procSeq.expose()}get previousStartPoints(){return this._previousStartPoints}get currentStartPoints(){return this._currentStartPoints}set periodKey(e){this._periodKey!==e&&(this._periodKey=e,this._chainSeq=0,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq())}get periodKey(){return this._periodKey}get period(){return ii[this.periodKey]}get turn(){return this._turn}get phaseSeq(){return this._phaseSeq}get stepSeq(){return this._stepSeq}get stageSeq(){return this._stageSeq}get chainSeq(){return this._chainSeq}get chainBlockSeq(){return this._chainBlockSeq}get procSeq(){return this._procSeq}get totalProcSeq(){return this._totalProcSeq}get isFirstChain(){return this.chainSeq===0}}class Tc{constructor(e){u(this,"nextSeq");u(this,"records",[]);u(this,"duel");u(this,"push",e=>{this.records.push({seq:this.nextSeq++,clock:this.duel.clock.getClone(),chainBlockInfo:e})});this.nextSeq=0,this.duel=e}}const bc=["PlayFirst","DrawFirst","Random"],gn={PlayFirst:"先攻",DrawFirst:"後攻",Random:"ランダム"};class qt extends Error{constructor(t,i){super(t?`デュエルが終了した。勝者：${t.profile.name}`:"デュエルが終了した。ドロー。");u(this,"winner");u(this,"message");this.winner=t,this.message=i}}class oe extends Error{constructor(t,...i){super(t);u(this,"message");u(this,"items");this.message=t,this.items=i}}class Mi extends oe{constructor(...e){super("キャンセル不可のアクションがキャンセルされた。",...e)}}class Ec{constructor(e,t,i,a=[],n,s,o,d=[],l="Random"){u(this,"onDuelEndEvent",new We);u(this,"view");u(this,"log");u(this,"chainBlockLog");u(this,"clock");u(this,"nextPhaseList");u(this,"field");u(this,"attackingMonster");u(this,"targetForAttack");u(this,"_chainBlockInfos");u(this,"duelists");u(this,"priorityHolder");u(this,"isEnded");u(this,"winner");u(this,"coin",!1);u(this,"startMode");u(this,"distributeOperators",e=>{console.info(`[totalProcSeq]:${e.totalProcSeq}`);let t=0;for(;;){if(t++,t>10)throw new oe("無限ループ発生");if(this.field.procFilterPool.distributeAll(this)&&this.field.statusOperatorPool.distributeAll(this)&&this.field.numericStateOperatorPool.distributeAll(this)&&this.field.summonFilterPool.distributeAll(this))return}});u(this,"getTurnPlayer",()=>this.clock.turn%2===0?this.secondPlayer:this.firstPlayer);u(this,"getNonTurnPlayer",()=>this.clock.turn%2===0?this.firstPlayer:this.secondPlayer);u(this,"main",async()=>{console.info("main start!"),this.coin=this.startMode==="PlayFirst"?!0:this.startMode==="DrawFirst"?!1:Math.random()>.5,this.priorityHolder=this.firstPlayer;for(const e of Object.values(this.duelists))e.pushDeck(),e.getDeckCell().shuffle(),e.initHand.length&&e.initHand.forEach(t=>{const i=e.getDeckCell().cardEntities.find(a=>a.origin.name===t);if(!i){this.log.info(`初手操作により${t}を手札に加えようとしたが、デッキに存在しない。`);return}i.addToHand(["System"],void 0,void 0),this.log.info(`初手操作により${i.toString()}を手札に加えた`,e)}),await e.draw(5-e.getHandCell().cardEntities.length,void 0,void 0);this.log.info(`【デュエル開始】${this.firstPlayer.profile.name} V.S. ${this.secondPlayer.profile.name}`),this.log.info(`先攻：${this.firstPlayer.profile.name} 後攻：${this.secondPlayer.profile.name}`),this.moveNextPhase("draw");try{for(const e of Object.values(this.duelists))for(const t of this.getEnableActions(e,["Exodia"],["Normal"],[]))await t.action.directExecute(e,void 0,!1);for(;!this.isEnded&&(this.clock.period.phase==="draw"?await this.procDrawPhase():this.phase==="standby"?await this.procStanbyPhase():this.phase==="main1"?await this.procMainPhase():this.phase==="battle1"?await this.procBattlePhase():this.phase==="battle2"?await this.procBattlePhase():this.phase==="main2"?await this.procMainPhase():this.phase==="end"&&await this.procEndPhase(),!(this.clock.turn>1e3)););}catch(e){e instanceof qt?(this.clock.incrementChainSeq(),console.info(e),this.isEnded=!0,this.winner=e.winner,this.log.info(e.winner?`デュエル終了。勝者${e.winner.profile.name}。${e.message}`:`デュエル終了。引き分け。${e.message}`),this.onDuelEndEvent.trigger()):e instanceof Error&&this.log.error(e)}finally{this.log.dispose()}});u(this,"moveNextPhase",e=>{this.clock.setPhase(this,e),this.phase==="main2"||this.clock.turn===1?this.nextPhaseList=["end"]:this.phase==="battle1"||this.phase==="battle2"?this.nextPhaseList=["main2"]:this.phase==="main1"?this.nextPhaseList=["battle1","end"]:this.nextPhaseList=[]});u(this,"declareAnAttack",(e,t)=>{var a;this.attackingMonster=e,this.targetForAttack=t;let i=" ("+((a=t.battlePosition==="Attack"?t.atk:t.def)==null?void 0:a.toString())+")";t.face==="FaceDown"&&(i=" (????)"),t.entityType==="Duelist"&&(i=""),e.info.attackCount++,this.log.info(`攻撃宣言：${e.toString()} (${e.atk})⇒ ${t.toString()}${i}`,e.controller)});u(this,"procDrawPhase",async()=>{if(Object.values(this.duelists).forEach(e=>e.initForDrawPhase()),this.log.info("ドローフェイズ開始。",this.getTurnPlayer()),this.clock.turn===1)this.log.info("先攻プレイヤーはドローできない。",this.getTurnPlayer());else{await this.getTurnPlayer().draw(1,void 0,void 0);for(const e of this.getEnableActions(this.getTurnPlayer(),["Exodia"],["Normal"],[]))await e.action.directExecute(this.getTurnPlayer(),void 0,!1)}this.field.getCardsOnFieldStrictly().forEach(e=>e.initForTurn()),await this.procSpellSpeed1(),this.moveNextPhase("standby")});u(this,"procStanbyPhase",async()=>{await this.procSpellSpeed1(),this.moveNextPhase("main1")});u(this,"procMainPhase",async()=>{for(;;){this.priorityHolder=this.getTurnPlayer();const e=await this.view.waitFieldAction(this.getEnableActions(this.priorityHolder,["NormalSummon","SpellTrapSet","SpecialSummon","FlipSummon","ChangeBattlePosition","IgnitionEffect","QuickEffect","CardActivation"],["Normal","Quick","Counter"],[]));if(console.info("response",e),e&&e.actionInfo){if([...Ao].includes(e.actionInfo.action.playType)){const i=await e.actionInfo.action.prepare(this.priorityHolder,e.actionInfo.dest,void 0,[],!0,!1);if(i===void 0)continue;await e.actionInfo.action.execute(i,this.chainBlockInfos),this.clock.incrementChainSeq()}else if(await this.procChainBlock({activator:this.priorityHolder,actionInfo:e.actionInfo},void 0)==="cancel")continue;await this.procFreeChain();continue}const t=e.phaseChange;if(t){this.priorityHolder=this.getNonTurnPlayer();let i="done";for(;;){const a=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(this.priorityHolder,["QuickEffect","TriggerEffect"],["Quick","Counter"],[]),[],"",!0);if(!a){this.moveNextPhase(t);return}if(i=await this.procChainBlock({activator:this.priorityHolder,actionInfo:a},void 0),i==="done")break}if(i==="done"){await this.procFreeChain();continue}}}});u(this,"procBattlePhase",async()=>{await this.procBattlePhaseStartStep(),await this.procBattlePhaseBattleStep(),await this.procBattlePhaseEndStep()});u(this,"procBattlePhaseStartStep",async()=>{this.clock.setStep(this,"start"),this.priorityHolder=this.getTurnPlayer(),this.attackingMonster=void 0,this.targetForAttack=void 0,await this.procSpellSpeed1()});u(this,"procBattlePhaseBattleStep",async()=>{for(;;){this.clock.setStep(this,"battle"),this.priorityHolder=this.getTurnPlayer();const e=await this.view.waitFieldAction(this.getEnableActions(this.priorityHolder,["Battle"],["Normal"],[]));if(e.phaseChange)break;if(e.actionInfo){const t=await e.actionInfo.action.prepare(this.priorityHolder,e.actionInfo.dest,void 0,[],!0,!1);if(!t)continue;await e.actionInfo.action.execute(t,[]),this.clock.incrementChainSeq();let i=!0;for(;;){const a=this.getNonTurnPlayer().getMonstersOnField().map(s=>[s.seq,s.moveLog.latestRecord.movedAt.totalProcSeq]);if(await this.procFreeChain(),!this.attackingMonster)throw new oe("想定されない状態");this.attackingMonster.isOnFieldStrictly?this.attackingMonster.face==="FaceDown"?(this.log.info(`${this.attackingMonster.toString()}が裏側守備表示になったため、戦闘が中断された。`),i=!1):this.attackingMonster.orientation==="Horizontal"&&(this.log.info(`${this.attackingMonster.toString()}が守備表示になったため、戦闘が中断された。`),i=!1):(this.log.info(`${this.attackingMonster.toString()}がフィールドにいなくなったため、戦闘が中断された。`),i=!1);const n=this.getNonTurnPlayer().getMonstersOnField().map(s=>[s.seq,s.moveLog.latestRecord.movedAt.totalProcSeq]);if(a.length!==n.length)throw this.log.info("モンスターの数が増減したためバトルステップの巻き戻しが発生。"),new oe("巻き戻し未実装");if(a.some(([s,o])=>n.every(([d,l])=>d!==s||l!==o)))throw this.log.info("モンスターの数が増減したためバトルステップの巻き戻しが発生。"),new oe("巻き戻し未実装");break}if(!i)continue;await this.procBattlePhaseDamageStep(t)}}});u(this,"procBattlePhaseDamageStep",async e=>{if(!this.attackingMonster||!this.targetForAttack)throw new oe("想定されない状態",this.attackingMonster,this.targetForAttack);if(this.targetForAttack.entityType!=="Duelist"&&!this.targetForAttack.isOnFieldAsMonsterStrictly)throw new oe("想定されない状態",this.attackingMonster,this.targetForAttack);await this.procBattlePhaseDamageStep1(),await this.procBattlePhaseDamageStep2(this.attackingMonster,this.targetForAttack),await this.procBattlePhaseDamageStep3(e,this.attackingMonster,this.targetForAttack),await this.procBattlePhaseDamageStep4(),await this.procBattlePhaseDamageStep5()});u(this,"procBattlePhaseDamageStep1",async()=>{this.clock.setStage(this,"start"),await this.procFreeChain()});u(this,"procBattlePhaseDamageStep2",async(e,t)=>{this.clock.setStage(this,"beforeDmgCalc"),(t==null?void 0:t.battlePosition)==="Set"&&t.setBattlePosition("Defense",["Flip","FlipByBattle"],e,e.controller),await this.procFreeChain()});u(this,"procBattlePhaseDamageStep3",async(e,t,i)=>{if(t.atk===void 0)throw new oe("想定されない状態",this.attackingMonster,this.targetForAttack);this.clock.setStage(this,"dmgCalc"),await this.procFreeChain();const a=t.atk,n=(i.battlePosition==="Attack"?i.atk:i.def)??0;i.entityType==="Duelist"?(e.activator.writeInfoLog(`ダメージ計算：${t.toString()} (${a}) ⇒ ${i.toString()}`),t.controller.getOpponentPlayer().battleDamage(a-n,t)):(e.activator.writeInfoLog(`ダメージ計算：${t.toString()} (${a}) ⇒ ${i.toString()} (${n})`),a>0&&a>n&&i.battlePosition==="Attack"?t.controller.getOpponentPlayer().battleDamage(a-n,t):a<n&&t.controller.battleDamage(n-a,i),a>0&&(a>n||a===n&&i.battlePosition==="Attack")&&await fe.tryMarkForDestory([i],e),i.battlePosition==="Attack"&&a<=n&&await fe.tryMarkForDestory([t],e));const s=Object.values(this.duelists).filter(o=>o.lp<=0);if(s.length)throw s.length===1?new qt(s[0].getOpponentPlayer(),"戦闘ダメージによって、相手のライフポイントをゼロにした。"):new qt(void 0,"戦闘ダメージによって、お互いのライフポイントがゼロになった。")});u(this,"procBattlePhaseDamageStep4",async()=>{this.clock.setStage(this,"afterDmgCalc"),await this.procFreeChain()});u(this,"procBattlePhaseDamageStep5",async()=>{this.clock.setStage(this,"end"),await fe.waitCorpseDisposal(this),this.clock.incrementChainSeq(),await this.procFreeChain()});u(this,"procBattlePhaseEndStep",async()=>{this.clock.setStep(this,"end"),this.priorityHolder=this.getTurnPlayer(),await this.procSpellSpeed1(),this.moveNextPhase("main2")});u(this,"procEndPhase",async()=>{for(await this.procSpellSpeed1();;){const t=this.getTurnPlayer().getHandCell().cardEntities.length;if(t<7)break;await this.getTurnPlayer().discard(t-6,["Rule"])}this.moveNextPhase("draw")});u(this,"procSpellSpeed1",async()=>{this.priorityHolder=this.getTurnPlayer();let e=0;const t={Above:Number.MAX_VALUE,Below:Number.MAX_VALUE};for(;Object.values(t).some(i=>i!==0);){const i=this.getEnableActions(this.priorityHolder,["IgnitionEffect","QuickEffect","CardActivation","LingeringEffect"],["Normal","Quick","Counter"],[]);t[this.priorityHolder.seat]=i.filter(o=>o.action.isMandatory).length;const a=i.find(o=>o.action.isMandatory);let n=a?{action:a.action,originSeq:a.action.seq}:void 0,s=!n;if(this.priorityHolder.isTurnPlayer?e===0&&(s=!0):t[this.priorityHolder.getOpponentPlayer().seat]>=0&&(s=!0),i.length&&(i.length>1||!n)&&(n=await this.view.waitQuickEffect(this.priorityHolder,i,[],s?"":"まだ発動しなければならない効果が残っている。",s)),n){if(La.some(o=>o===n.action.playType))await this.procChainBlock({activator:this.priorityHolder,actionInfo:n},void 0);else{const o=await n.action.prepare(this.priorityHolder,void 0,void 0,[],!0,!1);if(!o)continue;await n.action.execute(o,[]),await n.action.settle(o,[]),this.clock.incrementChainSeq()}await this.procFreeChain(),this.priorityHolder=this.getTurnPlayer(),e=0;continue}this.priorityHolder=this.priorityHolder.getOpponentPlayer(),e++}});u(this,"procFreeChain",async()=>{for(;await this.procChainBlock(void 0,void 0)!=="pass";);});u(this,"procChainBlock",async(e,t)=>{const i=this.chainBlockInfos.length===0;let a=e?[]:t??Object.values(this.duelists).flatMap(s=>this.getEnableActions(s,["TriggerEffect"],[this.chainBlockInfos.length?"Quick":"Normal"],this.chainBlockInfos).map(o=>({activator:s,actionInfo:o,targetChainBlock:this.chainBlockInfos.slice(-1)[0]}))),n;if(e)n={activator:e.activator,action:e.actionInfo.action,dest:e.actionInfo.dest,targetChainBlock:void 0},this.priorityHolder=n.activator;else if(a.length>0){const s=await this.selectTriggerEffect(a);s?(a=a.filter(o=>o!==s),n={...s,action:s.actionInfo.action},this.priorityHolder=n.activator):a=[]}if(!n){let s=0;for(;s<2;){this.priorityHolder=this.priorityHolder.getOpponentPlayer();const o=["Counter"];this.chainBlockInfos.every(c=>c.action.spellSpeed!=="Counter")&&o.push("Quick");const d=this.chainBlockInfos.length?"※メッセージ考え中※":"クイックエフェクト発動タイミング。効果を発動しますか？",l=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(this.priorityHolder,["QuickEffect","CardActivation"],o,this.chainBlockInfos),this.chainBlockInfos,d,!0);if(l){n={...l,activator:this.priorityHolder,targetChainBlock:this.chainBlockInfos.slice(-1)[0]};break}s++}}if(console.info("selected action: ",n),n){const s=n.activator,o=await n.action.prepare(s,n.dest,n.targetChainBlock,this.chainBlockInfos,i,!1);if(!o)return"cancel";this.chainBlockLog.push(o);const d=[...o.action.entity.info.isEffectiveIn];if(this._chainBlockInfos.push(o),this.clock.incrementProcSeq(),this.clock.incrementChainBlockSeq(),a=a.filter(l=>l.actionInfo.action.seq!==(n==null?void 0:n.action.seq)).filter(l=>l.actionInfo.action.validateCount(l.activator,this.chainBlockInfos)),await this.procChainBlock(void 0,a.length?a:void 0),o.chainNumber&&this.log.info(`チェーン${o.chainNumber}: ${o.action.toString()}の効果処理。`,s),o.isNegatedActivationBy)o.chainNumber&&this.log.info(`チェーン${o.chainNumber}: ${o.action.toString()}を${o.isNegatedActivationBy.toString()}によって発動を無効にした。`,o.activator);else{let l=o.action.entity.isEffective,c="";if(l){if(o.isNegatedEffectBy)c=`チェーン${o.chainNumber}: ${o.action.toString()}を${o.isNegatedEffectBy.toString()}によって効果を無効にした。`,l=!1;else if(!d.includes(o.isActivatedIn.cellType)){const f=o.action.entity.moveLog.records.findLast(p=>p.face==="FaceDown"&&p.orientation==="Horizontal");l=(f&&this.clock.isSameChain(f.movedAt))??!1}}if(l?(await o.action.execute(o,this.chainBlockInfos),o.state="done"):(o.state="failed",o.chainNumber&&(c=c||`チェーン${o.chainNumber}: カードの効果が無効となっているため${o.action.toString()}の効果処理を行えない。`),this.log.info(c,o.activator)),await n.action.settle(o,this.chainBlockInfos),o.state==="done")for(const f of[this.getTurnPlayer(),this.getNonTurnPlayer()]){for(const p of this.getEnableActions(f,["Exodia"],["Normal"],[o]))await p.action.directExecute(f,o,!1);for(const p of this.getEnableActions(f,["AfterChainBlock"],["Normal"],[o])){await p.action.directExecute(f,o,!1);for(const h of this.getEnableActions(f,["Exodia"],["Normal"],[o]))await h.action.directExecute(f,o,!1)}}}i?(await fe.sendManyToGraveyardForTheSameReason(this._chainBlockInfos.filter(l=>l.action.playType==="CardActivation").filter(l=>!l.action.isLikeContinuousSpell).map(l=>l.action.entity).filter(l=>l.isOnFieldStrictly).filter(l=>l.face==="FaceUp"),["Rule"],void 0,void 0),this._chainBlockInfos.reset(),o.nextActionInfo&&await this.procChainBlock({activator:o.activator,actionInfo:o.nextActionInfo},void 0),this.clock.incrementChainSeq()):(o.nextActionInfo&&await o.nextActionInfo.action.directExecute(o.activator,void 0,!1),this.clock.incrementChainBlockSeq())}return n?"done":"pass"});u(this,"selectTriggerEffect",async e=>{if(e.length>0)for(const t of[!0,!1])for(const i of[this.getTurnPlayer(),this.getNonTurnPlayer()]){const a=e.filter(s=>s.actionInfo.action.isMandatory===t&&s.activator===i);if(a.length===0)continue;if(a.length===1&&t)return a[0];const n=await this.view.waitQuickEffect(i,a.map(s=>s.actionInfo),this.chainBlockInfos,"トリガーエフェクトを選択。",!t);if(n)return a.find(s=>s.actionInfo.action===n.action)}});u(this,"executeSystemPeriodActions",()=>{Object.values(this.duelists).flatMap(e=>this.getEnableActions(e,["SystemPeriodAction"],["Normal"],[]).map(t=>({duelist:e,action:t})))});u(this,"getEnableActions",(e,t,i,a)=>{var s;const n=((s=a.slice(-1)[0])==null?void 0:s.nextChainBlockFilter)??(()=>!0);return this.field.getAllCardEntities().flatMap(o=>o.actions).filter(o=>o.executableCells.includes(o.entity.fieldCell.cellType)).filter(o=>o.executablePeriods.includes(this.clock.period.key)).filter(o=>i.includes(o.spellSpeed)).filter(o=>o.validateDuelist(e)).filter(o=>t.includes(o.playType)).filter(o=>n(e,o)).map(o=>o.validate(e,a,!1)).filter(o=>o!==void 0)});this.clock=new wc,this.nextPhaseList=[],this.isEnded=!1,this.startMode=l,this.duelists={Below:new di(this,"Below",e,t,i,a),Above:new di(this,"Above",n,s,o,d)},this.priorityHolder=this.firstPlayer,this._chainBlockInfos=[],this.field=new Ko(this),this.clock.onProcSeqChange.append(this.distributeOperators),this.clock.onStageChange.append(this.executeSystemPeriodActions),this.view=new kc(this),this.log=new _c(this),this.chainBlockLog=new Tc(this)}get onDuelEnd(){return this.onDuelEndEvent.expose()}get phase(){return this.clock.period.phase}get step(){return this.clock.period.step}get stage(){return this.clock.period.stage}get chainBlockInfos(){return this._chainBlockInfos}get firstPlayer(){return this.coin?this.duelists.Below:this.duelists.Above}get secondPlayer(){return this.coin?this.duelists.Above:this.duelists.Below}}const Dc=()=>{const r=[];["サイバー・ドラゴン","六武衆のご隠居","アンノウン・シンクロン"].forEach(c=>r.push({name:c,actions:[Ue,he,ge,Se,{title:"特殊召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:c==="アンノウン・シンクロン"?1:void 0,validate:f=>{const p=f.action.entity.field.getMonstersOnFieldStrictly();if(!(p.length==0||p.some(h=>h.controller===f.activator)))return ya(f,["Attack","Defense"],[])},prepare:f=>vi(f,"SpecialSummon",["SpecialSummon","Rule"],Ye),execute:pi,settle:async()=>!0}]}));const e={name:"ジャンク・フォアード",actions:[Ue,he,ge,Se,{title:"特殊召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:c=>{if(!c.activator.getMonstersOnField().length)return ya(c,Ye,[])},prepare:c=>vi(c,"SpecialSummon",["SpecialSummon","Rule"],Ye),execute:pi,settle:async()=>!0}]};r.push(e);const t={name:"Ｄ－ＨＥＲＯ ディアボリックガイ",actions:[Ue,he,ge,Se,{title:"①リクルート",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:10,canPayCosts:lr,validate:c=>c.activator.getDeckCell().cardEntities.filter(p=>p.nm==="Ｄ－ＨＥＲＯ ディアボリックガイ").length===0?void 0:c.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:jr,prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async c=>{const f=c.activator.getDeckCell().cardEntities.find(p=>p.nm==="Ｄ－ＨＥＲＯ ディアボリックガイ");return f?ys(c,[f]):!1},settle:async()=>!0}]};r.push(t);const i={name:"ゾンビキャリア",actions:[Ue,he,ge,Se,{title:"①自己再生",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],canPayCosts:c=>c.activator.getHandCell().cardEntities.length>0,validate:c=>c.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:async c=>{const f=c.activator.getHandCell().cardEntities,p=await c.activator.duel.view.waitSelectEntities(c.activator,f,1,h=>h.length===1,"デッキトップに戻すカードを一枚選択。");if(!p)throw new Mi(c);return await p[0].returnToDeck("Top",["Cost"],c.action.entity,c.activator),{returnToDeck:p}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:async c=>(c.action.entity.info.willBeBanished=await oi(c),c.action.entity.info.willBeBanished),settle:async()=>!0}]};r.push(i);const a={name:"グローアップ・バルブ",actions:[Ue,he,ge,Se,{title:"①自己再生",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:1,canPayCosts:c=>c.activator.getDeckCell().cardEntities.length>0,validate:c=>c.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:async c=>{const f=c.activator.getDeckCell().cardEntities[0];return await c.activator.getDeckCell().cardEntities[0].sendToGraveyard(["Cost"],c.action.entity,c.activator),{sendToGraveyard:[f]}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:c=>oi(c),settle:async()=>!0}]};r.push(a);const n={name:"終末の騎士",actions:[Ue,he,ge,Se,{title:"①墓地送り",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...Le,...Ie],executableDuelistTypes:["Controller"],validate:c=>{if(c.action.entity.hasBeenSummonedNow(["NormalSummon","SpecialSummon","FlipSummon"])&&c.activator.getDeckCell().cardEntities.filter(f=>f.attr.includes("Dark")).length!==0)return[]},prepare:async c=>{const f=["SendToGraveyardFromDeck"];return c.action.entity.moveLog.latestRecord.movedAs.includes("NormalSummon")?f.push("IfNormarlSummonSucceed"):f.push("IfSpecialSummonSucceed"),{selectedEntities:[],chainBlockTags:f,prepared:void 0}},execute:async c=>{const f=c.activator.getDeckCell().cardEntities.filter(p=>p.attr.includes("Dark"));return f.length===0?!1:(await c.action.entity.field.sendToGraveyard("墓地に送るモンスターを選択",c.activator,f,1,p=>p.length===1,["Effect"],c.action.entity,!1),c.activator.getDeckCell().shuffle(),!0)},settle:async()=>!0}]};r.push(n);const s={name:"マスマティシャン",actions:[Ue,he,ge,Se,{title:"①墓地送り",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...Le,...Ie],executableDuelistTypes:["Controller"],validate:c=>{if(c.action.entity.hasBeenSummonedNow(["NormalSummon"])&&c.activator.getDeckCell().cardEntities.find(f=>(f.lvl??5)<5))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["IfNormarlSummonSucceed","SendToGraveyardFromDeck"],prepared:void 0}),execute:async c=>{const f=c.activator.getDeckCell().cardEntities.filter(p=>(p.lvl??5)<5);return f.length===0?!1:(await c.action.entity.field.sendToGraveyard("墓地に送るモンスターを選択",c.activator,f,1,p=>p.length===1,["Effect"],c.action.entity,!1),c.activator.getDeckCell().shuffle(),!0)},settle:async()=>!0},{title:"②ドロー",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...Le,...Ie],executableDuelistTypes:["Controller"],validate:c=>{if(c.action.entity.face!=="FaceDown"&&c.action.entity.moveLog.latestRecord.movedAs.includes("BattleDestroy")&&c.action.entity.wasMovedAtPreviousChain&&c.activator.getDeckCell().cardEntities.length!==0)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async c=>(await c.activator.draw(1,c.action.entity,c.activator),!0),settle:async()=>!0}]};r.push(s);const o={name:"ライトロード・ビースト ウォルフ",actions:[he,ge,Se,{title:"①自己再生",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...Le,...Ie],executableDuelistTypes:["Controller"],validate:c=>{if(c.action.entity.wasMovedAtPreviousChain&&c.action.entity.wasMovedFrom.cellType==="Deck")return c.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:c=>oi(c),settle:async()=>!0}]};r.push(o);const d={name:"伝説の白石",actions:[he,ge,Se,Ue,{title:"①サーチ",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:Nt,executableDuelistTypes:["Controller"],validate:c=>{if(c.action.entity.wasMovedAtPreviousChain&&c.action.entity.wasMovedFrom.cellType!=="Banished")return c.activator.getDeckCell().cardEntities.find(f=>f.nm==="青眼の白龍")?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async c=>{const f=c.activator.getDeckCell().cardEntities.find(p=>p.nm==="青眼の白龍");return f?(await f.addToHand(["Effect"],c.action.entity,c.activator),c.activator.getDeckCell().shuffle(),!0):!1},settle:async()=>!0}]};return r.push(d),[{name:"灰流うらら",chainBlockTags:["Draw","SearchFromDeck","SendToGraveyardFromDeck","SpecialSummonFromDeck"]},{name:"屋敷わらし",chainBlockTags:["BanishFromGraveyard","SpecialSummonFromGraveyard","AddToHandFromGraveyard"]}].forEach(c=>{r.push({name:c.name,actions:[he,ge,Se,Ue,{title:"①無効化",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:["Hand"],executablePeriods:Le,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,negatePreviousBlock:!0,canPayCosts:f=>f.activator.canDiscard([f.action.entity]),validate:(f,p)=>p.length===0?void 0:p[f.index-1].chainBlockTags.union(c.chainBlockTags).length>0?[]:void 0,payCosts:async f=>(await f.action.entity.discard(["Cost"],f.action.entity,f.activator),{sendToGraveyard:[f.action.entity]}),prepare:async()=>({selectedEntities:[],chainBlockTags:["NegateCardEffect"],prepared:void 0}),execute:async(f,p)=>{const h=p[f.index-1];return h.isNegatedEffectBy=f.action,!0},settle:async()=>!0}]})}),["翻弄するエルフの剣士","ロードランナー","氷結界の修験者"].forEach(c=>{r.push({name:c,actions:[he,ge,Se,Ue],continuousEffects:[Uo("①戦闘破壊耐性","Monster",f=>[f],()=>!0,f=>[new Tr("①戦闘破壊耐性",()=>!0,!0,f,{},()=>!0,["BattleDestroy"],(p,h)=>!f.isEffective||(h.atk??0)<1900?!0:(f.duel.log.info(`${f.toString()}は攻撃力1900以上のモンスターとの先頭では破壊されない。`,f.controller),!1))])]})}),r},Ac=r=>{if(r.action.entity.status.spellCategory==="Field")return[r.activator.getFieldZone()];const e=r.activator.getAvailableSpellTrapZones();return e.length>0?e:void 0},we={title:"セット",playType:"SpellTrapSet",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isMandatory:!1,validate:Ac,prepare:nt,execute:async()=>!0,settle:async()=>!0},Ae=r=>{var t;if(r.action.entity.info.isPending||r.action.entity.info.isDying||r.action.entity.info.isSettingSickness)return;if(fi.some(i=>i===r.action.entity.fieldCell.cellType))return r.action.entity.face==="FaceDown"?[]:void 0;if(r.action.spellSpeed==="Normal"&&!r.activator.isTurnPlayer)return;if(r.action.entity.status.spellCategory==="Field")return[r.activator.getFieldZone()];let e=r.activator.getAvailableSpellTrapZones();return(t=r.action.entity.status.monsterCategories)!=null&&t.includes("Pendulum")&&(e=e.filter(i=>i.isAvailableForPendulum)),e.length>0?e:void 0},bs={title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Ae,prepare:nt,execute:async()=>!0,settle:async()=>!0},xc=(r,e,t=()=>!0)=>r.action.entity.field.getMonstersOnFieldStrictly().filter(a=>a.face==="FaceUp").filter(a=>a.canBeTargetOfEffect(r)).filter(a=>t(a,r.action.entity)).length?Ae(r):void 0,Mc=async(r,e,t,i,a,n=()=>!0)=>{const s=r.action.entity.field.getMonstersOnFieldStrictly().filter(d=>d.face==="FaceUp").filter(d=>d.canBeTargetOfEffect(r)).filter(d=>n(d,r.action.entity)),o=await r.action.entity.duel.view.waitSelectEntities(r.activator,s,1,d=>d.length===1,"装備対象モンスターを選択",t);if(o)return r.action.entity.info.equipedBy=o[0],r.action.entity.info.effectTargets[r.action.seq]=o,{chainBlockTags:i??[],selectedEntities:o,prepared:a}},Es=async(r,e,t=()=>!0)=>{const i=r.selectedEntities[0];return r.action.entity.info.equipedBy=i,r.action.entity.info.effectTargets[r.action.seq]=[i],t(i,r.action.entity)?(r.action.entity.info.equipedBy=i,r.action.entity.info.validateEquipOwner=t,i.info.equipEntities.push(r.action.entity),!0):(await r.action.entity.ruleDestory(),r.activator.writeInfoLog(`${i.toString()}が装備条件を満たさなくなったため、${r.action.entity.toString()}は破壊された。`),!1)},Sa=(r=()=>!0)=>({title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:(e,t)=>xc(e,t,r),prepare:(e,t,i)=>Mc(e,t,i,[],void 0,r),execute:Es,settle:async()=>!0}),Pc=()=>{const r=[],e={name:"おろかな埋葬",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:l=>{if(l.activator.getDeckCell().cardEntities.filter(c=>c.status.kind==="Monster").length!==0)return Ae(l)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SendToGraveyardFromDeck"],prepared:void 0}),execute:async l=>{const c=l.activator.getDeckCell().cardEntities.filter(p=>p.status.kind==="Monster");if(c.length===0)return!1;const f=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,c,1,p=>p.length===1,"墓地に送るモンスターを選択",!1);if(!f)throw new Mi(l);return await fe.sendManyToGraveyardForTheSameReason(f,["Effect"],l.action.entity,l.activator),await l.activator.getDeckCell().shuffle(),!0},settle:async()=>!0},we]};r.push(e);const t={name:"おろかな副葬",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,priorityForNPC:40,validate:l=>{if(l.activator.getDeckCell().cardEntities.filter(c=>c.status.kind!=="Monster").length!==0)return Ae(l)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SendToGraveyardFromDeck"],prepared:void 0}),execute:async l=>{const c=l.activator.getDeckCell().cardEntities.filter(p=>p.status.kind!=="Monster");if(c.length===0)return!1;const f=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,c,1,p=>p.length===1,"墓地に送る魔法罠を選択",!1);if(!f)throw new Mi(l);return await fe.sendManyToGraveyardForTheSameReason(f,["Effect"],l.action.entity,l.activator),await l.activator.getDeckCell().shuffle(),!0},settle:async()=>!0},we]};r.push(t);const i={name:"死者蘇生",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:l=>{const c=l.activator.getMonsterZones();if(l.activator.getEnableSummonList(l.activator,"SpecialSummon",["Effect"],l.action,l.activator.duel.field.getCells("Graveyard").flatMap(p=>p.cardEntities).filter(p=>p.status.kind==="Monster").filter(p=>p.canBeTargetOfEffect(l)).map(p=>({monster:p,posList:Ye,cells:c})),[],!1).length)return Ae(l)},prepare:l=>Ni(l,l.activator.duel.field.getCells("Graveyard").flatMap(c=>c.cardEntities).filter(c=>c.status.kind==="Monster").filter(c=>c.canBeTargetOfEffect(l))),execute:async l=>qi(l),settle:async()=>!0},we]};r.push(i),[{name:"大嵐",cellTypes:fi,isOnlyEnemies:!1},{name:"ハーピィの羽根帚",cellTypes:fi,isOnlyEnemies:!0},{name:"ブラック・ホール",cellTypes:gt,isOnlyEnemies:!1},{name:"サンダー・ボルト",cellTypes:gt,isOnlyEnemies:!0}].forEach(l=>{r.push({name:l.name,actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:c=>{let f=c.action.entity.field.getCells(...l.cellTypes).flatMap(p=>p.cardEntities).filter(p=>p!==c.action.entity);if(l.isOnlyEnemies&&(f=f.filter(p=>p.controller!==c.activator)),!!f.length)return Ae(c)},prepare:async c=>{let f=c.action.entity.field.getCells(...l.cellTypes).flatMap(p=>p.cardEntities).filter(p=>p!==c.action.entity);return l.isOnlyEnemies&&(f=f.filter(p=>p.controller!==c.activator)),{selectedEntities:[],chainBlockTags:c.action.calcChainBlockTagsForDestroy(f),prepared:void 0}},execute:async c=>{let f=c.action.entity.field.getCells(...l.cellTypes).flatMap(p=>p.cardEntities).filter(p=>p!==c.action.entity);return l.isOnlyEnemies&&(f=f.filter(p=>p.controller!==c.activator)),await fe.tryDestroy(f,c),!0},settle:async()=>!0},we]})});const a={name:"ハリケーン",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:l=>{if(l.action.entity.field.getCells("SpellAndTrapZone","FieldSpellZone").flatMap(f=>f.cardEntities).filter(f=>f!==l.action.entity).length)return Ae(l)},prepare:async()=>({selectedEntities:[],chainBlockTags:["BounceToHand"],prepared:void 0}),execute:async(l,c)=>{const f=c.map(h=>h.action).filter(h=>h.playType==="CardActivation").map(h=>h.entity).filter(h=>h.isOnFieldStrictly).filter(h=>h.face==="FaceUp").filter(h=>!h.isLikeContinuousSpell),p=l.action.entity.field.getCells("SpellAndTrapZone","FieldSpellZone").flatMap(h=>h.cardEntities).filter(h=>!f.includes(h));return await fe.returnManyToHandForTheSameReason(p,["Effect"],l.action.entity,l.activator),!0},settle:async()=>!0},we]};r.push(a);const n={name:"光の援軍",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,canPayCosts:l=>l.activator.getDeckCell().cardEntities.length>3,validate:l=>{if(l.activator.getDeckCell().cardEntities.filter(c=>c.status.kind==="Monster").filter(c=>(c.lvl??13)<5).filter(c=>c.status.nameTags&&c.status.nameTags.includes("ライトロード")).length!==0)return Ae(l)},payCosts:async l=>{const c=l.activator.getDeckCell().cardEntities.slice(0,3);return await fe.sendManyToGraveyardForTheSameReason(c,["Cost"],l.action.entity,l.activator),{sendToGraveyard:c}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async l=>{const c=l.activator.getDeckCell().cardEntities.filter(p=>p.status.kind==="Monster").filter(p=>(p.lvl??13)<5).filter(p=>p.status.nameTags&&p.status.nameTags.includes("ライトロード"));if(c.length===0)return!1;const f=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,c,1,p=>p.length===1,"手札に加えるモンスターを選択",!1);for(const p of f??[])await p.addToHand(["Effect"],l.action.entity,l.activator);return l.activator.getDeckCell().shuffle(),!0},settle:async()=>!0},we]};r.push(n);const s={name:"調律",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:l=>{const c=l.activator.getDeckCell().cardEntities;if(!(c.length<2)&&c.filter(f=>{var p;return(p=f.status.nameTags)==null?void 0:p.includes("シンクロン")}).filter(f=>{var p;return(p=f.status.monsterCategories)==null?void 0:p.includes("Tuner")}).length!==0)return Ae(l)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck","SendToGraveyardFromDeck"],prepared:void 0}),execute:async l=>{const c=l.activator.getDeckCell().cardEntities;if(c.length<2)return;const f=c.filter(h=>{var m;return(m=h.status.nameTags)==null?void 0:m.includes("シンクロン")}).filter(h=>{var m;return(m=h.status.monsterCategories)==null?void 0:m.includes("Tuner")});if(f.length===0)return!1;const p=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,f,1,h=>h.length===1,"手札に加えるモンスターを選択",!1);for(const h of p??[])await h.addToHand(["Effect"],l.action.entity,l.activator);return l.activator.duel.clock.incrementProcSeq(),l.activator.getDeckCell().shuffle(),await l.activator.getDeckCell().cardEntities[0].sendToGraveyard(["Effect"],l.action.entity,l.activator),!0},settle:async()=>!0},we]};r.push(s);const o={name:"ワン・フォー・ワン",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,canPayCosts:l=>{if(l.activator.getDeckCell().cardEntities.every(c=>(c.lvl??12)>1)){if(l.activator.getHandCell().cardEntities.every(c=>(c.lvl??12)>1)||l.activator.getHandCell().cardEntities.filter(c=>c.status.kind==="Monster").length<2)return!1}else if(l.activator.getHandCell().cardEntities.filter(c=>c.status.kind==="Monster").length===0)return!1;return!0},validate:l=>{let c=[...l.activator.getDeckCell().cardEntities.filter(m=>(m.lvl??12)===1),...l.activator.getHandCell().cardEntities.filter(m=>(m.lvl??12)===1)];const f=l.activator.getHandCell().cardEntities;(f.length<2||!l.ignoreCost)&&(c=c.filter(m=>!f.includes(m)));const p=l.activator.getMonsterZones();if(l.activator.getEnableSummonList(l.activator,"SpecialSummon",["Effect"],l.action,c.map(m=>({monster:m,posList:Ye,cells:p})),[],!1).length)return Ae(l)},payCosts:async(l,c,f)=>{const p=[...l.activator.getDeckCell().cardEntities.filter(w=>(w.lvl??12)===1),...l.activator.getHandCell().cardEntities.filter(w=>(w.lvl??12)===1)],h=l.activator.getMonsterZones(),m=l.activator.getEnableSummonList(l.activator,"SpecialSummon",["Effect"],l.action,p.map(w=>({monster:w,posList:Ye,cells:h})),[],!1);let C=l.activator.getHandCell().cardEntities.filter(w=>w.status.kind==="Monster");m.length===1&&(C=C.filter(w=>!m.map(k=>k.monster).includes(w)));const y=await l.activator.duel.view.waitSelectEntities(l.activator,C,1,w=>w.length===1,"墓地へ送るモンスターを選択",f)??[];if(y.length)return await fe.sendManyToGraveyardForTheSameReason(y,["Cost"],l.action.entity,l.activator),{sendToGraveyard:y}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async l=>{const c=[...l.activator.getDeckCell().cardEntities.filter(h=>h.lvl===1),...l.activator.getHandCell().cardEntities.filter(h=>h.lvl===1)],f=l.activator.getMonsterZones();return!!await l.activator.summonOne(l.activator,"SpecialSummon",["Effect"],l.action,c.map(h=>({monster:h,posList:Ye,cells:f})),[],!1,!1)},settle:async()=>!0},we]};r.push(o);const d={name:"封印の黄金櫃",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:l=>{if(!l.activator.getDeckCell().cardEntities.every(c=>!l.activator.canTryBanish(c,"BanishAsEffect",l.action)))return Ae(l)},prepare:async()=>({selectedEntities:[],chainBlockTags:["BanishFromDeck"],prepared:void 0}),execute:async l=>{const c=l.activator.getDeckCell().cardEntities.filter(h=>l.activator.canTryBanish(h,"BanishAsEffect",l.action)),f=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,c,1,h=>h.length===1,"除外するカードを選択。",!1);if(!f)throw new Error("illegal state");return(await fe.tryBanish("BanishAsEffect",f,l)).forEach(h=>h.counterHolder.removeAll("GoldSarcophagus")),!0},settle:async()=>!0},nc("回収カウント進行",["stanby"],l=>{l.activator.isTurnPlayer&&l.action.entity.field.getCells("Banished").flatMap(c=>c.cardEntities).filter(c=>c.moveLog.latestRecord.movedBy===l.action.entity).filter(c=>c.moveLog.latestRecord.actionOwner===l.activator).forEach(c=>{c.counterHolder.add("GoldSarcophagus",1,l.action.entity);const f=c.counterHolder.getQty("GoldSarcophagus",l.action.entity);f<3&&l.activator.duel.log.info(`${c.toString()}のターンカウント：${f-1}⇒${f}`)})}),{title:"回収",isMandatory:!0,playType:"LingeringEffect",spellSpeed:"Normal",executableCells:Ei,executablePeriods:["stanby"],executableDuelistTypes:["Controller","Opponent"],validate:l=>{if(l.activator.isTurnPlayer)return l.action.entity.field.getCells("Banished").flatMap(c=>c.cardEntities).filter(c=>c.moveLog.latestRecord.movedBy===l.action.entity).filter(c=>c.moveLog.latestRecord.actionOwner===l.activator).some(c=>c.counterHolder.getQty("GoldSarcophagus")===2)?[]:void 0},prepare:nt,execute:async l=>{const c=l.action.entity.field.getCells("Banished").flatMap(p=>p.cardEntities).filter(p=>p.moveLog.latestRecord.movedBy===l.action.entity).filter(p=>p.moveLog.latestRecord.actionOwner===l.activator).filter(p=>p.counterHolder.getQty("GoldSarcophagus")===2);if(!c.length)throw new oe("想定されない状態",l);let f=c[0];if(c.length>1){const p=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,c,1,h=>h.length===1,"回収するカードを選択。",!1);if(!p||!p.length)throw new oe("想定されない状態",l,p);f=p[0]}return await f.addToHand(["Effect"],l.action.entity,l.activator),!0},settle:async()=>!0},we]};return r.push(d),r},Bc=(r,e,t,i,a)=>({title:"①リクルート",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:a,executablePeriods:i.includes("EffectDestroy")?[...Le,...Ie]:["b1DEnd","b2DEnd"],executableDuelistTypes:["Controller"],validate:n=>{if(!n.action.entity.wasMovedAtPreviousChain)return;const s=n.activator.getMonsterZones();if(n.activator.getEnableSummonList(n.activator,"SpecialSummon",["Effect"],n.action,n.activator.getDeckCell().cardEntities.filter(r).filter(d=>d.status.kind==="Monster").filter(d=>d.canBeTargetOfEffect(n)).map(d=>({monster:d,posList:t,cells:s})),[],!1).length)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async n=>{const s=n.activator.getDeckCell().cardEntities.filter(r),o=n.activator.getMonsterZones();return!!n.activator.summonMany(n.activator,"SpecialSummon",["Effect"],n.action,s.map(l=>({monster:l,posList:t,cells:o})),[],!1,e.length>1?void 0:e[0],l=>e.includes(l.length),!1)},settle:async()=>!0}),Fc=()=>{const r=[];return[{name:"キラー・ポテト",filter:e=>e.attr.includes("Dark")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["EffectDestroy"],executableCells:["Graveyard"]},{name:"キラー・トマト",filter:e=>e.attr.includes("Dark")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"巨大ネズミ",filter:e=>e.attr.includes("Earth")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"グリズリーマザー",filter:e=>e.attr.includes("Water")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"シャインエンジェル",filter:e=>e.attr.includes("Light")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ドラゴンフライ",filter:e=>e.attr.includes("Wind")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ＵＦＯタートル",filter:e=>e.attr.includes("Fire")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"荒野の女戦士",filter:e=>e.attr.includes("Earth")&&e.types.includes("Warrior")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"リトル・トルーパー",filter:e=>e.types.includes("Warrior")&&(e.lvl??9999)<3,qtyList:[1],posList:["Set"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard","Banished"]},{name:"破面竜",filter:e=>e.types.includes("Warrior")&&(e.def??9999)<=1500,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"共鳴虫",filter:e=>e.types.includes("Insect")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ピラミッド・タートル",filter:e=>e.types.includes("Zombie")&&(e.def??9999)<=2e3,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ユーフォロイド",filter:e=>e.types.includes("Machine")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ヘル・セキュリティ",filter:e=>e.types.includes("Fiend")&&(e.lvl??9999)===1,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ガスタ・イグル",filter:e=>(e.status.nameTags??[]).includes("ガスタ")&&(e.status.monsterCategories??[]).includes("Tuner"),qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"幻影の魔術士",filter:e=>(e.status.nameTags??[]).includes("ＨＥＲＯ")&&(e.atk??9999)<=1e3,qtyList:[1],posList:["Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ジェネクス・サーチャー",filter:e=>(e.status.nameTags??[]).includes("ジェネクス")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"紫炎の足軽",filter:e=>(e.status.nameTags??[]).includes("六武衆")&&(e.lvl??12)<=3,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"スレイブ・エイプ",filter:e=>(e.status.nameTags??[]).includes("剣闘獣")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ゼンマイハニー",filter:e=>(e.status.nameTags??[]).includes("ゼンマイ")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ＸＸ－セイバー エマーズブレイド",filter:e=>(e.status.nameTags??[]).includes("Ｘ－セイバー")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"軍隊竜",filter:e=>e.nm==="軍隊竜",qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"アサルト・ガンドッグ",filter:e=>e.nm==="アサルト・ガンドッグ",qtyList:[1,2,3,4,5],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ハイエナ",filter:e=>e.nm==="ハイエナ",qtyList:[1,2,3,4,5],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]}].forEach(e=>{r.push({name:e.name,actions:[Bc(e.filter,e.qtyList,e.posList,e.destoryTypes,e.executableCells),he,ge,Se,Ue]})}),r},Oc=r=>({title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:e=>{if(e.activator.getDeckCell().cardEntities.filter(r).length!==0&&e.activator.canDraw)return Ae(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(r);if(t.length===0)return!1;const i=await e.action.entity.field.duel.view.waitSelectEntities(e.activator,t,1,a=>a.length===1,"手札に加えるカードを選択",!1);for(const a of i??[])await a.addToHand(["Effect"],e.action.entity,e.activator);return e.activator.getDeckCell().shuffle(),!0},settle:async()=>!0}),Lc=(r,e)=>({title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,priorityForNPC:40,validate:t=>{if(!(t.activator.getGraveyard().cardEntities.filter(r).length<e))return Ae(t)},prepare:async()=>({selectedEntities:[],chainBlockTags:["AddToHandFromGraveyard"],prepared:void 0}),execute:async t=>{const i=t.activator.getGraveyard().cardEntities.filter(r);if(i.length===0)return!1;const a=await t.action.entity.field.duel.view.waitSelectEntities(t.activator,i,e,n=>n.length===e,"手札に加えるカードを選択",!1);for(const n of a??[])await n.addToHand(["Effect"],t.action.entity,t.activator);return!0},settle:async()=>!0}),Nc=r=>({title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,canPayCosts:e=>e.activator.getHandCell().cardEntities.filter(r).some(t=>e.activator.canDiscard([t])),validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<2))return Ae(e)},payCosts:async e=>({discard:await e.activator.discard(1,["Discard","Cost"],e.action.entity,e.activator,r)}),prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(2,e.action.entity,e.activator),!0),settle:async()=>!0}),qc=r=>({title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Ae,prepare:async e=>{const[t,i]=r(e.action.entity),a=[];return t<0&&a.push("DamageToSelf"),i<0&&a.push("DamageToOpponent"),{selectedEntities:[],chainBlockTags:a,prepared:void 0}},execute:async e=>{const[t,i]=r(e.action.entity);return i>0?e.activator.getOpponentPlayer().heal(i,e.action.entity):i<0&&e.activator.getOpponentPlayer().effectDamage(Math.abs(i),e.action.entity),t>0?e.activator.heal(t,e.action.entity):t<0&&e.activator.effectDamage(Math.abs(t),e.action.entity),!0},settle:async()=>!0}),Rc=()=>{const r=[];return[{name:"増援",filter:e=>e.origin.kind==="Monster"&&e.types.includes("Warrior")&&(e.origin.level??5)<5},{name:"化石調査",filter:e=>e.origin.kind==="Monster"&&e.types.includes("Dinosaur")&&(e.origin.level??6)<6},{name:"Ｅ－エマージェンシーコール",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("Ｅ・ＨＥＲＯ")},{name:"召集の聖刻印",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("聖刻")},{name:"召喚師のスキル",filter:e=>e.origin.kind==="Monster"&&(e.origin.monsterCategories??[]).includes("Normal")&&(e.origin.level??4)>4},{name:"トゥーンのもくじ",filter:e=>(e.origin.nameTags??[]).includes("トゥーン")},{name:"融合賢者",filter:e=>e.origin.name==="融合"},{name:"虹の架け橋",filter:e=>e.origin.kind!=="Monster"&&(e.origin.nameTags??[]).includes("宝玉")},{name:"紫炎の狼煙",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("六武衆")&&(e.origin.level??4)<4},{name:"テラ・フォーミング",filter:e=>e.origin.kind==="Spell"&&e.origin.spellCategory==="Field"},{name:"コール・リゾネーター",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("リゾネーター")}].forEach(e=>{r.push({name:e.name,actions:[Oc(e.filter),we]})}),[{name:"戦士の生還",filter:e=>e.status.kind==="Monster"&&e.types.includes("Warrior"),qty:1},{name:"ダーク・バースト",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Dark")&&(e.atk??9999)<=1500,qty:1},{name:"悪夢再び",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Dark")&&(e.def??9999)===0,qty:2},{name:"サルベージ",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Water")&&(e.atk??9999)<=1500,qty:2},{name:"バッテリーリサイクル",filter:e=>e.status.kind==="Monster"&&e.types.includes("Thunder")&&(e.atk??9999)<=1500,qty:2},{name:"闇の量産工場",filter:e=>e.status.kind==="Monster"&&(e.status.monsterCategories??[]).includes("Normal"),qty:2}].forEach(e=>{r.push({name:e.name,actions:[Lc(e.filter,e.qty),we]})}),[{name:"トレード・イン",filter:e=>e.status.kind==="Monster"&&(e.lvl??0)===8},{name:"調和の宝札",filter:e=>e.status.kind==="Monster"&&(e.origin.monsterCategories??[]).includes("Tuner")&&e.types.includes("Dragon")&&(e.atk??9999)<=1e3},{name:"デステニー・ドロー",filter:e=>e.status.kind==="Monster"&&(e.origin.nameTags??[]).includes("Ｄ－ＨＥＲＯ")}].forEach(e=>{r.push({name:e.name,actions:[Nc(e.filter),we]})}),[{name:"火の粉",calcHeal:()=>[0,-200]},{name:"雷鳴",calcHeal:()=>[0,-300]},{name:"ファイヤー・ボール",calcHeal:()=>[0,-500]},{name:"火あぶりの刑",calcHeal:()=>[0,-600]},{name:"昼夜の大火事",calcHeal:()=>[0,-800]},{name:"火炎地獄",calcHeal:()=>[-500,-1e3]},{name:"盗人ゴブリン",calcHeal:()=>[500,-500]},{name:"ブルー・ポーション",calcHeal:()=>[400,0]},{name:"レッド・ポーション",calcHeal:()=>[500,0]},{name:"ゴブリンの秘薬",calcHeal:()=>[600,0]},{name:"天使の生き血",calcHeal:()=>[800,0]},{name:"治療の神 ディアン・ケト",calcHeal:()=>[1e3,0]},{name:"恵みの雨",calcHeal:()=>[1e3,1e3]}].forEach(e=>{r.push({name:e.name,actions:[qc(e.calcHeal),we]})}),r},Hc=(r,e,t,i,a,n)=>{if(!r.action.entity.origin.level||i.some(l=>!l.lvl)||i.map(l=>l.lvl??0).reduce((l,c)=>l+c,0)!==r.action.entity.origin.level)return;const s=i.filter(l=>{var c;return(c=l.status.monsterCategories)==null?void 0:c.some(f=>f==="Tuner")}),o=i.filter(l=>{var c;return(c=l.status.monsterCategories)==null?void 0:c.every(f=>f!=="Tuner")});if(!a(s)||!n(o))return;const d=[...s.map(l=>({material:l,cell:l.fieldCell,isAsTuner:!0})),...o.map(l=>({material:l,cell:l.fieldCell,isAsTuner:!1}))];if(r.activator.getEnableSummonList(r.activator,"SyncroSummon",["Rule","SpecialSummon"],r.action,[{monster:r.action.entity,posList:e,cells:t}],d,!1).length)return d},$c=(r,e=i=>i.length===1,t=i=>i.length>0)=>{let i=[...r.activator.getMonstersOnField().filter(s=>s.battlePosition!=="Set"),...r.activator.getHandCell().cardEntities.filter(s=>s.origin.kind==="Monster")];if(i.every(s=>!s.status.allowHandSyncro)&&(i=i.filter(s=>s.fieldCell.isPlayFieldCell)),i.length<2)return[];const a=[...r.activator.getMonsterZones(),...r.activator.duel.field.getCells("ExtraMonsterZone")],n=["Attack","Defense"];return i.getAllOnOffPattern().filter(s=>s.some(o=>o.status.allowHandSyncro)||s.every(o=>o.isOnFieldAsMonsterStrictly)).map(s=>Hc(r,n,a,s,e,t)??[]).filter(s=>s.length)},Zc=async(r,e,t)=>{var d;const i=r.action.getEnableMaterialPatterns(r),a=i.map(l=>({infos:l,materialSeqList:l.map(c=>c.material.seq).sort()}));let n=i[0].map(l=>l.material);if(i.length>1){const l=i.flatMap(f=>f.map(p=>p.material)).getDistinct(),c=await r.action.entity.duel.view.waitSelectEntities(r.activator,l,void 0,f=>{const p=f.map(h=>h.seq).sort();return a.some(h=>p.length===h.materialSeqList.length&&p.every((m,C)=>m===h.materialSeqList[C]))},"シンクロ素材とするモンスターを選択",t);if(!c)return;n=c}const s=n.map(l=>l.seq).sort(),o=(d=a.find(l=>s.length===l.materialSeqList.length&&s.every((c,f)=>c===l.materialSeqList[f])))==null?void 0:d.infos;if(!o)throw new oe("想定されない状態",r,n);return await fe.sendManyToGraveyardForTheSameReason(n,["SyncroMaterial","Cost","Rule","SpecialSummonMaterial"],r.action.entity,r.activator),{summonMaterialInfos:o}},Ot=(r=t=>t.length===1,e=t=>t.length>0)=>({title:"シンクロ召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],getEnableMaterialPatterns:t=>$c(t,r,e),canPayCosts:t=>t.action.getEnableMaterialPatterns(t).length>0,validate:t=>!t.ignoreCost||t.activator.getAvailableExtraZones().length+t.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:Zc,prepare:t=>vi(t,"SyncroSummon",["Rule","SpecialSummon","SyncroSummon"],["Attack","Defense"]),execute:pi,settle:async()=>!0}),Uc=()=>{const r=[];return["大地の騎士ガイアナイト","スクラップ・デスデーモン"].forEach(e=>r.push({name:e,actions:[he,ge,Se,Ot()],defaultSummonFilter:at})),r.push({name:"ナチュル・ガオドレイク",actions:[he,ge,Se,Ot(e=>e.length===1&&e.every(t=>t.attr.some(i=>i==="Earth")),e=>e.length>0&&e.every(t=>t.attr.some(i=>i==="Earth")))],defaultSummonFilter:at}),r.push({name:"マジカル・アンドロイド",actions:[he,ge,Se,Ot(),{title:"回復",isMandatory:!0,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["end"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,validate:e=>e.action.entity.duel.phase==="end"&&e.activator.isTurnPlayer&&e.action.entity.face==="FaceUp"?[]:void 0,prepare:nt,execute:async e=>(e.activator.heal(e.activator.getMonstersOnField().filter(t=>t.face==="FaceUp").filter(t=>t.types.includes("Psychic")).length*600,e.action.entity),!0),settle:async()=>!0}],defaultSummonFilter:at}),r},Gc=()=>{const r=[];return[{name:"草原",up:["Warrior","BeastWarrior"],down:[]},{name:"森",up:["Insect","Plant","Beast","BeastWarrior"],down:[]},{name:"山",up:["Dragon","WingedBeast","Thunder"],down:[]},{name:"荒野",up:["Dinosaur","Zombie","Rock"],down:[]},{name:"海",up:["Aqua","SeaSerpent","Fish"],down:["Machine","Pyro"]},{name:"闇",up:["Fiend","Spellcaster"],down:["Fairy"]}].forEach(e=>{r.push({name:e.name,actions:[{title:"発動",isMandatory:!1,canIgnoreCosts:!0,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Ae,prepare:nt,execute:async()=>!0,settle:async()=>!0},we],continuousEffects:[br("発動","Spell",t=>t.isOnFieldStrictly&&t.face==="FaceUp",t=>["attack","defense"].flatMap(i=>["up","down"].map(a=>yt.createContinuous("発動",n=>n.isSpawnedBy.isOnFieldStrictly&&n.isSpawnedBy.face==="FaceUp",t,(n,s)=>s.isOnFieldStrictly&&s.face==="FaceUp"&&(s.status.monsterCategories??!1)&&e[a].union(s.types).length>0,i,"wip","Addition",(n,s,o)=>!n.isEffective||s.face==="FaceDown"?o:o+(a==="up"?200:-200)))))]})}),[{name:"バーニングブラッド",attr:"Fire"},{name:"ウォーターワールド",attr:"Water"},{name:"ガイアパワー",attr:"Earth"},{name:"シャインスパーク",attr:"Light"},{name:"ダークゾーン",attr:"Dark"},{name:"デザートストーム",attr:"Wind"}].forEach(e=>{r.push({name:e.name,actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","FieldSpellZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Ae,prepare:nt,execute:async()=>!0,settle:async()=>!0},we],continuousEffects:[br("発動","Spell",t=>t.isOnFieldStrictly&&t.face==="FaceUp",t=>["attack","defense"].flatMap(i=>yt.createContinuous("発動",a=>a.isSpawnedBy.isOnFieldStrictly&&a.isSpawnedBy.face==="FaceUp",t,(a,n)=>n.isOnFieldStrictly&&n.face==="FaceUp"&&n.attr.includes(e.attr),i,"wip","Addition",(a,n,s)=>!a.isEffective||n.face==="FaceDown"?s:s+(i==="attack"?500:-400))))]})}),r},jc=()=>{const r=[],e={name:"連合軍",actions:[bs,we],continuousEffects:[br("発動","Spell",t=>t.isOnFieldStrictly&&t.face==="FaceUp",t=>[yt.createContinuous("発動",i=>i.isSpawnedBy.isOnFieldStrictly&&i.isSpawnedBy.face==="FaceUp",t,(i,a)=>a.controller===i.isSpawnedBy.controller&&a.types.includes("Warrior")&&a.isOnFieldStrictly&&a.face==="FaceUp","attack","wip","Addition",(i,a,n)=>{if(!i.isEffective||a.face==="FaceDown")return n;const s=i.controller.getMonstersOnField().filter(o=>o.face==="FaceUp").filter(o=>o.types.includes("Warrior")||o.types.includes("Spellcaster")).length;return n+s*200})])]};return r.push(e),r},Vc=()=>{const r=[];[{name:"団結の力",kind:["Monster"],rate:800},{name:"魔導師の力",kind:["Spell","Trap"],rate:500}].forEach(t=>{r.push({name:t.name,actions:[Sa(),we],continuousEffects:[sr(t.name,"Spell",i=>i.info.equipedBy?[i.info.equipedBy]:[],i=>i.isOnFieldStrictly&&i.face==="FaceUp",i=>["attack","defense"].map(a=>yt.createContinuous("発動",n=>n.isSpawnedBy.isOnFieldStrictly&&n.isSpawnedBy.face==="FaceUp",i,(n,s)=>s.isOnFieldStrictly&&s.face==="FaceUp",a,"wip","Addition",(n,s,o)=>{if(!n.isEffective)return o;const d=n.controller.getEntiteisOnField().filter(l=>t.kind.includes(l.status.kind)).length;return o+d*t.rate})))]})});const e={name:"早すぎた埋葬",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,canPayCosts:t=>t.activator.lp>=800,validate:t=>{const i=t.activator.getMonsterZones();if(t.activator.getEnableSummonList(t.activator,"SpecialSummon",["Effect"],t.action,t.activator.getGraveyard().cardEntities.filter(n=>n.status.kind==="Monster").filter(n=>n.canBeTargetOfEffect(t)).map(n=>({monster:n,posList:["Attack"],cells:i})),[],!1).length)return Ae(t)},payCosts:(t,i)=>ic(t,i,800),prepare:async t=>{const i=await Ni(t,t.activator.getGraveyard().cardEntities,["Attack"]);return i.chainBlockTags.push("PayLifePoint"),i},execute:async(t,i)=>t.action.entity.info.equipedBy?(await t.action.entity.ruleDestory(),!1):await qi(t,["Attack"])?(t.action.entity.onBeforeMove.append(async n=>{if(n.entity.face!=="FaceUp"||!n.entity.isOnFieldAsSpellTrapStrictly)return"RemoveMe";const s=n.entity.info.equipedBy;if(!s)return"RemoveMe";const[,,,,,o]=n.args;return s.isOnFieldStrictly&&s.face==="FaceUp"&&n.entity.isEffective&&o.union(["EffectDestroy","RuleDestroy"]).length&&(n.entity.controller.writeInfoLog(`${t.action.entity.toString()}が破壊されたため、装備対象モンスター${s.toString()}を破壊。`),fe.tryMarkForDestory([s],t)),"RemoveMe"}),Es(t,i,(n,s)=>{var o;return(o=s.info.effectTargets[t.action.seq])==null?void 0:o.includes(n)})):(await t.action.entity.ruleDestory(),!1),settle:async()=>!0},we]};return r.push(e),r.push({name:"幻惑の巻物",actions:[Sa(),we],continuousEffects:[]}),r},zc=()=>{const r=[];return[{name:"伝説の剣",attr:void 0,monType:"Warrior",atk:200,def:200},{name:"秘術の書",attr:void 0,monType:"Spellcaster",atk:200,def:200},{name:"ポセイドンの力",attr:void 0,monType:"Aqua",atk:200,def:200},{name:"紫水晶",attr:void 0,monType:"Zombie",atk:200,def:200},{name:"猛獣の歯",attr:void 0,monType:"Beast",atk:200,def:200},{name:"機械改造工場",attr:void 0,monType:"Machine",atk:200,def:200},{name:"体温の上昇",attr:void 0,monType:"Reptile",atk:200,def:200},{name:"魔菌",attr:void 0,monType:"Plant",atk:200,def:200},{name:"闇・エネルギー",attr:void 0,monType:"Fiend",atk:200,def:200},{name:"レーザー砲機甲鎧",attr:void 0,monType:"Insect",atk:200,def:200},{name:"銀の弓矢",attr:void 0,monType:"Fairy",atk:200,def:200},{name:"電撃鞭",attr:void 0,monType:"Thunder",atk:200,def:200},{name:"ドラゴンの秘宝",attr:void 0,monType:"Dragon",atk:200,def:200},{name:"フォロー・ウィンド",attr:void 0,monType:"WingedBeast",atk:200,def:200},{name:"魔性の月",attr:void 0,monType:"BeastWarrior",atk:200,def:200},{name:"エルフの光",attr:"Light",monType:void 0,atk:400,def:-200},{name:"覚醒",attr:"Earth",monType:void 0,atk:400,def:-200},{name:"灼熱の槍",attr:"Fire",monType:void 0,atk:400,def:-200},{name:"突風の扇",attr:"Wind",monType:void 0,atk:400,def:-200},{name:"はがねの甲羅",attr:"Water",monType:void 0,atk:400,def:-200},{name:"闇の破神剣",attr:"Dark",monType:void 0,atk:400,def:-200},{name:"火器付機甲鎧",attr:void 0,monType:"Insect",atk:700,def:0},{name:"サラマンドラ",attr:"Fire",monType:void 0,atk:700,def:0},{name:"シャイン・キャッスル",attr:"Light",monType:void 0,atk:700,def:0}].forEach(e=>{r.push({name:e.name,actions:[Sa(t=>(!e.attr||t.attr.includes(e.attr))&&(!e.monType||t.types.includes(e.monType))),we],continuousEffects:[sr(e.name,"Spell",t=>t.info.equipedBy?[t.info.equipedBy]:[],t=>t.isOnFieldStrictly&&t.face==="FaceUp",t=>{const i=[];return e.atk!==0&&i.push(["attack",e.atk]),e.def!==0&&i.push(["defense",e.def]),i.map(([a,n])=>yt.createContinuous("発動",s=>s.isSpawnedBy.isOnFieldStrictly&&s.isSpawnedBy.face==="FaceUp",t,(s,o)=>o.isOnFieldStrictly&&o.face==="FaceUp"&&(!e.monType||o.types.includes(e.monType))&&(!e.attr||o.attr.includes(e.attr)),a,"wip","Addition",(s,o,d)=>s.isEffective?d+n:d))})]})}),r},Wc=()=>{const r=[],e={name:"にせアバター",actions:[Ue,he,ge,Se],continuousEffects:[sr("THE_DEVILS_AVATAR","Monster",i=>[i],i=>i.isOnFieldStrictly&&i.face==="FaceUp",i=>["attack","defense"].map(a=>yt.createContinuous("THE_DEVILS_AVATAR",n=>n.isSpawnedBy.isOnFieldStrictly&&n.isSpawnedBy.face==="FaceUp",i,(n,s)=>s.isOnFieldStrictly&&s.face==="FaceUp",a,"calculated","THE_DEVILS_AVATAR",()=>Number.MIN_VALUE)))]};r.push(e);const t={name:"にせドレッド・ルート",actions:[Ue,he,ge,Se],continuousEffects:[br("THE_DEVILS_DREAD-ROOT","Monster",i=>i.isOnFieldStrictly&&i.face==="FaceUp",i=>["attack","defense"].map(a=>yt.createContinuous("THE_DEVILS_DREAD-ROOT",n=>n.isSpawnedBy.isOnFieldStrictly&&n.isSpawnedBy.face==="FaceUp",i,(n,s)=>s.status.kind==="Monster"&&s.isOnFieldStrictly&&s.face==="FaceUp"&&s!==n.isSpawnedBy,a,"calculated","THE_DEVILS_DREAD-ROOT",(n,s,o)=>Math.round(o/2))))]};return r.push(t),r},Yc=()=>{const r=[],e={name:"ご隠居の猛毒薬",actions:[we,{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:Le,executableDuelistTypes:["Controller"],validate:Ae,prepare:async(i,a,n)=>{const s=await i.action.entity.field.duel.view.waitSelectText([{seq:0,text:"●自分は１２００ＬＰ回復する。"},{seq:1,text:"●相手に８００ダメージを与える。"}],"使用する効果を選択",!1);if(s===void 0&&!n)throw new Mi(i);const o=[];return s===1&&o.push("DamageToOpponent"),{selectedEntities:[],chainBlockTags:o,prepared:s??0}},execute:async i=>i.prepared===1?(i.activator.getOpponentPlayer().effectDamage(800,i.action.entity),!0):(i.activator.heal(1200,i.action.entity),!0),settle:async()=>!0}]};r.push(e);const t={name:"月の書",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:Le,executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:i=>{if(i.action.entity.field.getMonstersOnFieldStrictly().filter(n=>n.canBeTargetOfEffect(i)).length)return Ae(i)},prepare:async(i,a,n)=>{const s=i.action.entity.field.getMonstersOnFieldStrictly().filter(d=>d.canBeTargetOfEffect(i)),o=await i.action.entity.duel.view.waitSelectEntities(i.activator,s,1,d=>d.length===1,"対象とするモンスターを選択",n);if(o)return{selectedEntities:o,chainBlockTags:[],prepared:void 0}},execute:async i=>{const a=i.selectedEntities[0];if(!a.isOnFieldAsMonsterStrictly||a.battlePosition==="Set")return!1;if(!a.canBeEffected(i.activator,i.action.entity,i.action)){i.activator.duel.log.info(`${a.toString()}は${i.action.entity.toString()}の効果を受けない。`);return}return await a.setBattlePosition("Set",["Effect"],i.action.entity,i.activator),!0},settle:async()=>!0},we]};return r.push(t),r.push({name:"突進",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:[...Le,...Ie],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:i=>{if(i.action.entity.field.getMonstersOnFieldStrictly().filter(n=>n.canBeTargetOfEffect(i)).length)return Ae(i)},prepare:async(i,a,n)=>{const s=i.action.entity.field.getMonstersOnFieldStrictly().filter(d=>d.canBeTargetOfEffect(i)),o=await i.action.entity.duel.view.waitSelectEntities(i.activator,s,1,d=>d.length===1,"対象とするモンスターを選択",n);if(o)return{selectedEntities:o,chainBlockTags:[],prepared:void 0}},execute:async i=>{const a=i.selectedEntities[0];if(!a.isOnFieldAsMonsterStrictly||a.battlePosition==="Set")return!1;if(!a.canBeEffected(i.activator,i.action.entity,i.action)){i.activator.duel.log.info(`${a.toString()}は${i.action.entity.toString()}の効果を受けない。`);return}return a.numericOprsBundle.push(yt.createLingeringAddition("攻撃力上昇",n=>n.effectOwner.duel.clock.isSameTurn(n.isSpawnedAt),i.action.entity,i.action,"attack",(n,s,o)=>o+700)),!0},settle:async()=>!0},we]}),r},yn=(r,e)=>{const t=e?`魔力充填可能(${e})`:"魔力充填可能";return Go(t,r,i=>[i],()=>!0,i=>[new qa(t,()=>!0,!0,i,{},(a,n)=>a.isSpawnedBy===n,(a,n)=>(n.maxCounterQty.SpellCounter=e??Number.MAX_VALUE,{maxCounterQty:n.maxCounterQty}))])},ta={},Kc=(r,e=1)=>(ta[e]||(ta[e]={title:`魔力回収(${e})`,isMandatory:!0,playType:"AfterChainBlock",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:Nt,executableDuelistTypes:["Controller"],validate:t=>{if(t.targetChainBlock&&t.targetChainBlock.action.playType==="CardActivation"&&t.targetChainBlock.action.entity.status.kind==="Spell")return[]},prepare:nt,execute:async t=>t.action.entity.face==="FaceDown"||!t.action.entity.isOnFieldAsMonsterStrictly||!t.action.entity.isEffective?!1:(t.action.entity.counterHolder.add("SpellCounter",e,t.action.entity),!0),settle:async()=>!0}),{...ta[e],title:`${r}魔力回収(${e})`}),mn=(r,e,t)=>r.action.entity.counterHolder.getQty("SpellCounter")>=t,_n=(r,e,t,i)=>{const a=i[0];return r.action.entity.counterHolder.remove("SpellCounter",a),{counter:a}},Qc=()=>{const r=[];return r.push({name:"魔導戦士 ブレイカー",actions:[he,ge,Se,Ue,{title:"①魔力充填",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.hasBeenSummonedNow(["NormalSummon"]))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["IfNormarlSummonSucceed"],prepared:void 0}),execute:async e=>e.action.entity.face==="FaceDown"?!1:(e.action.entity.counterHolder.setQty("SpellCounter",1,e.action.entity),!0),settle:async()=>!0},{title:"③マナブレイク",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,canPayCosts:(e,t)=>mn(e,t,1),validate:e=>{const t=e.action.entity.field.getCells(...fi).flatMap(i=>i.cardEntities).filter(i=>i.canBeTargetOfEffect(e));if(t.length)return t.map(i=>i.fieldCell)},payCosts:async(e,t,i)=>_n(e,t,i,[1]),prepare:async(e,t,i)=>{var n;let a=(n=e.dest)==null?void 0:n.cardEntities[0];if(!a){const s=e.action.entity.field.getCells(...fi).flatMap(d=>d.cardEntities).filter(d=>d.canBeTargetOfEffect(e)),o=await e.action.entity.duel.view.waitSelectEntities(e.activator,s,1,d=>d.length===1,"破壊する対象を選択。",i);if(!o||!o.length)return;a=o[0]}return{selectedEntities:[a],chainBlockTags:e.action.calcChainBlockTagsForDestroy([a]),prepared:void 0}},execute:async e=>e.selectedEntities.every(t=>!t.isOnFieldAsSpellTrapStrictly)?!1:(await fe.tryDestroy(e.selectedEntities,e),!0),settle:async()=>!0}],continuousEffects:[yn("Monster",1),sr("②攻撃力上昇","Monster",e=>[e],()=>!0,e=>[yt.createContinuous("②攻撃力上昇",()=>!0,e,()=>!0,"attack","wip","Addition",(t,i,a)=>t.isEffective?a+t.counterHolder.getQty("SpellCounter")*300:a)])]}),r.push({name:"王立魔法図書館",actions:[he,ge,Se,Ue,{...Kc("①",1)},{title:"②ドロー",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],canPayCosts:(e,t)=>mn(e,t,3),validate:e=>{if(e.activator.getDeckCell().cardEntities.length)return[]},payCosts:async(e,t,i)=>_n(e,t,i,[3]),prepare:nt,execute:async e=>(await e.activator.draw(1,e.action.entity,e.activator),!0),settle:async()=>!0}],continuousEffects:[yn("Monster",3)]}),r},Xc=()=>{const r=[];return["炸裂装甲","次元幽閉"].forEach(e=>{r.push({name:e,actions:[we,{title:"発動",playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:["b1Battle","b2Battle"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:t=>{if(!t.activator.duel.clock.isUponAttackDeclaration()||t.activator.isTurnPlayer)return;const i=t.activator.duel.attackingMonster;if(!i)throw new oe("想定されない状態",t,i);if(i.canBeTargetOfEffect(t))return e==="次元幽閉"&&!t.activator.canTryBanish(i,"BanishAsEffect",t.action)?!1:Ae(t)},prepare:async t=>{const i=t.activator.duel.attackingMonster;if(!i)throw new oe("想定されない状態",t,i);const a=e==="炸裂装甲"?t.action.calcChainBlockTagsForDestroy([i]):["BanishFromField"];return{selectedEntities:[i],chainBlockTags:a,prepared:void 0}},execute:async t=>(e==="炸裂装甲"?await fe.tryDestroy(t.selectedEntities,t):await fe.tryBanish("BanishAsEffect",t.selectedEntities,t),!0),settle:async()=>!0}]})}),r},Jc=()=>{const r=[];return r.push({name:"強欲な瓶",actions:[we,{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:Le,executableDuelistTypes:["Controller"],validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<2)&&e.activator.canDraw&&e.activator.canAddToHandFromDeck)return Ae(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(1,e.action.entity,e.activator),!0),settle:async()=>!0}]}),r.push({name:"戦線復帰",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:Le,executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:e=>{const t=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getGraveyard().cardEntities.filter(a=>a.status.kind==="Monster").filter(a=>a.canBeTargetOfEffect(e)).map(a=>({monster:a,posList:["Defense"],cells:t})),[],!1).length)return Ae(e)},prepare:e=>Ni(e,e.activator.getGraveyard().cardEntities.filter(t=>t.status.kind==="Monster").filter(t=>t.canBeTargetOfEffect(e)),["Defense"]),execute:async e=>qi(e,["Defense"]),settle:async()=>!0},we]}),r},Ic=()=>{const r=[],e={name:"強欲な壺",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:20,validate:s=>{if(!(s.activator.getDeckCell().cardEntities.length<2)&&s.activator.canDraw&&s.activator.canAddToHandFromDeck)return Ae(s)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async s=>(await s.activator.draw(2,s.action.entity,s.activator),!0),settle:async()=>!0},we]};r.push(e);const t={name:"貪欲な壺",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:30,validate:s=>{if(!(s.activator.getGraveyard().cardEntities.filter(o=>o.status.kind==="Monster").filter(o=>o.canBeTargetOfEffect(s)).length<5)&&s.activator.canDraw&&s.activator.canAddToHandFromDeck)return Ae(s)},prepare:async s=>{const o=await s.action.entity.field.duel.view.waitSelectEntities(s.activator,s.activator.getGraveyard().cardEntities.filter(d=>d.status.kind==="Monster").filter(d=>d.canBeTargetOfEffect(s)),5,d=>d.length===5,"デッキに戻すモンスターを選択。",!1);if(o)return{selectedEntities:o,chainBlockTags:["Draw","ReturnToDeckFromGraveyard"],prepared:void 0}},execute:async s=>s.selectedEntities.some(o=>o.wasMovedAtCurrentChain)?!1:(await fe.returnManyToDeckForTheSameReason("Random",s.selectedEntities,["Effect"],s.action.entity,s.activator),await s.activator.draw(2,s.action.entity,s.activator),!0),settle:async()=>!0},we]};r.push(t);const i={name:"天使の施し",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:30,validate:s=>{if(!(s.activator.getDeckCell().cardEntities.length<3))return Ae(s)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw","DiscordAsEffect"],prepared:void 0}),execute:async s=>(await s.activator.draw(3,s.action.entity,s.activator),await s.activator.discard(2,["Effect","Discard"],s.action.entity,s.activator,()=>!0,s.activator),!0),settle:async()=>!0},we]};r.push(i);const a={name:"成金ゴブリン",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:20,validate:s=>{if(!(s.activator.getDeckCell().cardEntities.length<1))return Ae(s)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async s=>(await s.activator.draw(1,s.action.entity,s.activator),s.action.entity.field.duel.clock.incrementProcSeq(),s.activator.getOpponentPlayer().heal(1e3,s.action.entity),!0),settle:async()=>!0},we]};r.push(a);const n={name:"手札抹殺",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:s=>{if(!(s.activator.getDeckCell().cardEntities.length<s.activator.getHandCell().cardEntities.filter(o=>o.seq!==s.action.entity.seq).length)&&s.action.entity.field.getAllCells().filter(o=>o.cellType==="Hand").flatMap(o=>o.cardEntities).filter(o=>o.seq!==s.action.entity.seq).length!==0)return Ae(s)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async s=>{const o=s.activator.getHandCell().cardEntities.length,d=s.activator.getOpponentPlayer().getHandCell().cardEntities.length;return await fe.sendManyToGraveyardForTheSameReason(s.action.entity.field.getCells("Hand").flatMap(l=>l.cardEntities),["Effect","Discard"],s.action.entity,s.activator),s.activator.duel.clock.incrementProcSeq(),await s.action.entity.field.drawAtSameTime(s.activator,o,s.activator.getOpponentPlayer(),d,s.action.entity,s.activator),!0},settle:async()=>!0},we]};return r.push(n),r},eu=(r,e,t,i,a=2,n=2,s)=>{if(!r.action.entity.origin.rank||i.length<a||i.length>n||i.some(d=>!d.lvl)||i.some(d=>d.lvl!==r.action.entity.rank)||!s(i))return;const o=i.map(d=>({material:d,cell:d.fieldCell,level:d.status.level}));if(r.activator.getEnableSummonList(r.activator,"XyzSummon",["Rule","XyzSummon","SpecialSummon"],r.action,[{monster:r.action.entity,posList:e,cells:t}],o,!1).length)return o},tu=(r,e=2,t=2,i=a=>a.length>1)=>{const a=r.activator.getMonstersOnField().filter(s=>s.battlePosition!=="Set");if(a.length<e)return[];const n=[...r.activator.getMonsterZones(),...r.activator.getAvailableExtraZones()];return a.getAllOnOffPattern().filter(s=>s.length>=e).filter(s=>s.length<=t).map(s=>eu(r,Ye,n,s,e,t,i)??[]).filter(s=>s.length)},iu=async(r,e,t)=>{var d;const i=r.action.getEnableMaterialPatterns(r),a=i.map(l=>({infos:l,materialSeqList:l.map(c=>c.material.seq).sort()}));let n=i[0].map(l=>l.material);if(i.length>1){const l=i.flatMap(f=>f.map(p=>p.material)).getDistinct(),c=await r.action.entity.duel.view.waitSelectEntities(r.activator,l,void 0,f=>{const p=f.map(h=>h.seq).sort();return a.some(h=>p.length===h.materialSeqList.length&&p.every((m,C)=>m===h.materialSeqList[C]))},"エクシーズ素材とするモンスターを選択",t);if(!c)return;n=c}const s=n.map(l=>l.seq).sort(),o=(d=a.find(l=>s.length===l.materialSeqList.length&&s.every((c,f)=>c===l.materialSeqList[f])))==null?void 0:d.infos;if(!o)throw new oe("想定されない状態",r,n);return await fe.convertManyToXyzMaterials(o.map(l=>l.material),["XyzMaterial","Rule","Cost"],r.action.entity,r.activator),{summonMaterialInfos:o}},ru=(r=2,e=2,t=i=>i.length>1)=>({title:"エクシーズ召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],getEnableMaterialPatterns:i=>tu(i,r,e,t),canPayCosts:i=>i.action.getEnableMaterialPatterns(i).length>0,validate:i=>!i.ignoreCost||i.activator.getAvailableExtraZones().length+i.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:iu,prepare:i=>vi(i,"XyzSummon",["Rule","SpecialSummon","XyzSummon"],["Attack","Defense"]),execute:pi,settle:async()=>!0}),au=()=>{const r=[];return[{name:"ジェムナイト・パール",qty:2},{name:"覚醒の勇士 ガガギゴ",qty:3}].forEach(e=>r.push({name:e.name,actions:[he,ge,Se,ru(e.qty,e.qty)],defaultSummonFilter:at})),r},nu=()=>{const r=[];return r.push({name:"ＢＦ－疾風のゲイル",actions:[Ue,he,ge,Se,{title:"①特殊召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(e.activator.getMonstersOnField().filter(i=>(i.status.nameTags??[]).includes("ＢＦ")).filter(i=>i.nm!==e.action.entity.origin.name).length)return ya(e,["Attack","Defense"],[])},prepare:e=>vi(e,"SpecialSummon",["SpecialSummon","Rule"],Ye),execute:pi,settle:async()=>!0},{title:"②攻守半減",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,isOnlyNTimesPerTurnIfFaceup:1,validate:e=>{const t=e.activator.getOpponentPlayer().getMonstersOnField().filter(i=>i.face==="FaceUp").filter(i=>i.canBeTargetOfEffect(e));if(t.length)return t.length?t:void 0},prepare:async(e,t,i)=>{var n;let a=(n=e.dest)==null?void 0:n.cardEntities[0];if(!a){const s=e.activator.getOpponentPlayer().getMonstersOnField().filter(d=>d.face==="FaceUp").filter(d=>d.canBeTargetOfEffect(e)),o=await e.action.entity.duel.view.waitSelectEntities(e.activator,s,1,d=>d.length===1,"効果対象を選択。",i);if(!o||!o.length)return;a=o[0]}return{selectedEntities:[a],chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.selectedEntities.filter(i=>i.isOnFieldAsMonsterStrictly).filter(i=>i.face==="FaceUp").find(i=>i.canBeEffected(e.activator,e.action.entity,e.action));if(t)return["attack","defense"].map(i=>yt.createLingeringFixation("②攻守半減",()=>!0,e.action.entity,e.action,i,(a,n,s)=>Math.round(s/2))).forEach(i=>t.numericOprsBundle.push(i)),!0},settle:async()=>!0}]}),r},su=()=>{const r=[];return r.push({name:"ダーク・リゾネーター",actions:[he,ge,Se,Ue],substituteEffects:[fc(1)]}),r.push({name:"レッド・リゾネーター",actions:[he,ge,Se,Ue,{title:"①特殊召喚",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...Le,...Ie],executableDuelistTypes:["Controller"],validate:e=>{if(!e.action.entity.hasBeenSummonedNow(["NormalSummon"]))return;const t=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getHandCell().cardEntities.filter(a=>a.status.kind==="Monster").filter(a=>(a.lvl??12)<5).map(a=>({monster:a,posList:Ye,cells:t})),[],!1).length)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromHand"],prepared:void 0}),execute:async e=>{const t=e.activator.getMonsterZones(),i=e.activator.getHandCell().cardEntities.filter(n=>n.status.kind==="Monster").filter(n=>(n.lvl??12)<5).map(n=>({monster:n,posList:Ye,cells:t}));return!!await e.activator.summonOne(e.activator,"SpecialSummon",["Effect"],e.action,i,[],!1,!1)},settle:async()=>!0},{title:"②回復",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...Le,...Ie],executableDuelistTypes:["Controller"],hasToTargetCards:!0,isOnlyNTimesPerTurn:1,validate:e=>{if(e.action.entity.hasBeenSummonedNow(["SpecialSummon"]))return e.activator.getMonstersOnField().filter(t=>t.canBeTargetOfEffect(e)).filter(t=>(t.atk??0)>0).some(t=>t.info.summonKinds.includes("SpecialSummon"))?[]:void 0},prepare:async e=>{const t=await e.activator.waitSelectEntity(e.activator.getMonstersOnField().filter(i=>i.canBeTargetOfEffect(e)).filter(i=>(i.atk??0)>0).filter(i=>i.info.summonKinds.includes("SpecialSummon")),"対象とするモンスターを選択",!1);if(t)return{selectedEntities:[t],chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.activator.lp;return e.selectedEntities.filter(i=>i.isOnFieldAsMonsterStrictly).forEach(i=>e.activator.heal(i.atk??0,e.action.entity)),e.activator.lp!==t},settle:async()=>!0}]}),r},lu=()=>{const r=[];return r.push({name:"スターダスト・ドラゴン",actions:[he,ge,Se,Ot(),{title:"①ヴィクテム・サンクチュアリ",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:Nt,executableDuelistTypes:["Controller"],canPayCosts:Ra,validate:(e,t)=>t.length===0?void 0:t[e.index-1].chainBlockTags.includes("DestroyOnField")?[]:void 0,payCosts:Ha,prepare:async(e,t)=>{const i=t.slice(-1)[0];return{selectedEntities:[],chainBlockTags:e.action.calcChainBlockTagsForDestroy([i.action.entity]),prepared:void 0}},execute:async(e,t)=>{const i=t[e.index-1];return i.isNegatedActivationBy=e.action,await fe.tryDestroy([i.action.entity],e),!0},settle:async()=>!0},{title:"②自己再生",playType:"IgnitionEffect",isMandatory:!1,spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["end"],executableDuelistTypes:["Controller"],validate:e=>{const t=e.action.entity.moveLog.latestRecord;if(t.movedBy!==e.action.entity||!e.activator.duel.clock.isSameTurn(t.movedAt)||!t.movedAs.includes("Cost"))return;const i=e.activator.duel,a=e.action.entity.actionLogRecords.filter(s=>i.clock.isSameTurn(s.clock)).map(s=>s.chainBlockInfo).findLast(s=>s.action.title==="①ヴィクテム・サンクチュアリ");return!a||a.state!=="done"?void 0:e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:nt,execute:e=>oi(e),settle:async()=>!0}],defaultSummonFilter:at}),r.push({name:"閃珖竜 スターダスト",defaultSummonFilter:at,actions:[he,ge,Ot(),{title:"波動音壁",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:gt,executablePeriods:Le,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,hasToTargetCards:!0,validate:e=>{const t=e.activator.getEntiteisOnField().filter(i=>i.face==="FaceUp").filter(i=>i.canBeTargetOfEffect(e));if(t.length)return t.map(i=>i.fieldCell)},prepare:async(e,t,i)=>{if(e.dest)return{selectedEntities:e.dest.cardEntities,chainBlockTags:[],prepared:void 0};const a=e.activator.getEntiteisOnField().filter(s=>s.face==="FaceUp").filter(s=>s.canBeTargetOfEffect(e));if(!a.length)return;const n=await e.action.entity.duel.view.waitSelectEntities(e.activator,a,1,s=>s.length===1,"対象とするカードを選択",i);if(n)return{selectedEntities:n,chainBlockTags:[],prepared:void 0}},execute:async e=>(e.selectedEntities.filter(t=>t.isOnFieldStrictly).filter(t=>t.face==="FaceUp").filter(t=>t.canBeEffected(e.activator,e.action.entity,e.action)).forEach(t=>{t.counterHolder.add("SonicBarrier",1,e.action.entity)}),!0),settle:async()=>!0}],substituteEffects:[{title:"波動音壁（適用）",isMandatory:!0,executableCells:Ei,executablePeriods:Nt,executableDuelistTypes:["Controller"],isApplicableTo:(e,t,i)=>i.filter(a=>a.counterHolder.getQty("SonicBarrier",e.entity)>0),substitute:async(e,t,i)=>{const a=i.filter(n=>n.counterHolder.getQty("SonicBarrier",e.entity)>0);return a.forEach(n=>{n.counterHolder.removeAll("SonicBarrier",e.entity),e.entity.controller.writeInfoLog(`波動音壁により${n.toString()}は１ターンに１度だけ戦闘効果では破壊されない。`)}),a}}]}),r.push({name:"真閃珖竜 スターダスト・クロニクル",defaultSummonFilter:at,actions:[he,ge,Ot(e=>e.length===1&&e.every(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")}),e=>e.length>0&&e.every(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")})),{title:"波動護魂",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:gt,executablePeriods:Le,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,canPayCosts:e=>rc(e,e.activator.getGraveyard().cardEntities.filter(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")})),validate:()=>[],payCosts:e=>ac(e,e.activator.getGraveyard().cardEntities.filter(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")}),t=>t.length===1,1),prepare:nt,execute:async e=>(e.action.entity.procFilterBundle.push(Tr.createLingering(e.action.title,t=>t.effectOwner.duel.clock.isSameTurn(t.isSpawnedAt),e.action.entity,e.action,()=>!0,["Effect"],()=>!1)),!0),settle:async()=>!0},{title:"②蘇生",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Banished"],executablePeriods:[...Le,...Ie],executableDuelistTypes:["Controller"],validate:e=>{if(!e.action.entity.wasMovedAtPreviousChain)return;const t=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getBanished().cardEntities.filter(a=>a.status.kind==="Monster").filter(a=>a.face==="FaceUp").filter(a=>a.types.includes("Dragon")).filter(a=>{var n;return(n=a.status.monsterCategories)==null?void 0:n.includes("Syncro")}).filter(a=>a.canBeTargetOfEffect(e)).map(a=>({monster:a,posList:Ye,cells:t})),[],!1).length)return[]},prepare:e=>Ni(e,e.activator.getBanished().cardEntities.filter(t=>t.status.kind==="Monster").filter(t=>t.face==="FaceUp").filter(t=>t.types.includes("Dragon")).filter(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")}).filter(t=>t.canBeTargetOfEffect(e))),execute:async e=>qi(e),settle:async()=>!0}]}),r.push({name:"聖珖神竜 スターダスト・シフル",defaultSummonFilter:at,actions:[he,ge,Ot(e=>e.length===1&&e.every(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")}),e=>e.length>1&&e.every(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")})),{title:"②珖波動反撃",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:["Hand"],executablePeriods:Le,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,negatePreviousBlock:!0,validate:e=>{if(e.targetChainBlock&&e.activator!==e.targetChainBlock.activator&&e.targetChainBlock.action.entity.status.kind==="Monster"&&e.targetChainBlock.action.isWithChainBlock)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["NegateCardEffect","DestroyOnField"],prepared:void 0}),execute:async e=>{if(!e.targetChainBlock)return!1;const t=e.targetChainBlock;t.isNegatedEffectBy=e.action;const i=await e.activator.duel.view.waitSelectEntities(e.activator,e.action.duel.field.getCardsOnFieldStrictly(),1,n=>n.length===1,"破壊するカードを選択。",!1)??[];return(await fe.tryDestroy(i,e)).length>0},settle:async()=>!0},{title:"③蘇生",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:10,canPayCosts:lr,validate:e=>e.activator.getBanished().cardEntities.filter(i=>{var a;return(a=i.status.nameTags)==null?void 0:a.includes("スターダスト")}).filter(i=>(i.lvl??12)<9).length===0?void 0:e.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:jr,prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:async e=>{const t=await e.activator.duel.view.waitSelectEntities(e.activator,e.activator.getBanished().cardEntities.filter(i=>{var a;return(a=i.status.nameTags)==null?void 0:a.includes("スターダスト")}).filter(i=>(i.lvl??12)<9),1,i=>i.length===1,"蘇生するモンスターを選択。",!1)??[];return ys(e,t)},settle:async()=>!0}],substituteEffects:[{title:"波動聖句",isMandatory:!0,executableCells:["MonsterZone"],executablePeriods:Nt,executableDuelistTypes:["Controller"],isApplicableTo:(e,t,i)=>i.filter(a=>a.controller===e.entity.controller).filter(a=>a.counterHolder.getQty("SonicVerse",e.entity)===0),substitute:async(e,t,i)=>{if(!e.entity.isEffective)return[];const a=i.filter(n=>n.controller===e.entity.controller).filter(n=>n.counterHolder.getQty("SonicVerse",e.entity)===0);return a.forEach(n=>{n.counterHolder.add("SonicVerse",1,e.entity),e.entity.controller.writeInfoLog(`${e.entity.toString()}の効果により${n.toString()}は１ターンに１度だけ破壊されない。`)}),a}}]}),r},ou=()=>{const r=[];return[{name:"リビングデッドの呼び声",pos:"Attack",filter:()=>!0},{name:"エンジェル・リフト",pos:"Attack",filter:e=>(e.lvl??12)<3},{name:"正統なる血統",pos:"Attack",filter:e=>{var t;return(t=e.status.monsterCategories)==null?void 0:t.includes("Normal")}},{name:"蘇りし魂",pos:"Defense",filter:e=>{var t;return(t=e.status.monsterCategories)==null?void 0:t.includes("Normal")}},{name:"リミット・リバース",pos:"Attack",filter:e=>(e.atk??9999)<=1e3,onMonsterAfterMove:async(e,t)=>{if(!t.isOnFieldAsMonsterStrictly||t.face==="FaceDown")return"RemoveMe";if(e.action.entity.isEffective&&t.battlePosition==="Defense")return e.action.entity.controller.writeInfoLog(`${t.toString()}が守備表示になったため、${e.action.entity.toString()}とともに破壊される。`),await fe.tryMarkForDestory([t,e.action.entity],e),"RemoveMe"}}].forEach(e=>r.push({name:e.name,actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:Le,executableDuelistTypes:["Controller"],validate:t=>{const i=t.activator.getMonsterZones();if(t.activator.getEnableSummonList(t.activator,"SpecialSummon",["Effect"],t.action,t.activator.getGraveyard().cardEntities.filter(n=>n.status.kind==="Monster").filter(e.filter).filter(n=>n.canBeTargetOfEffect(t)).map(n=>({monster:n,posList:["Attack"],cells:i})),[],!1).length)return Ae(t)},prepare:t=>Ni(t,t.activator.getGraveyard().cardEntities.filter(i=>i.status.kind==="Monster").filter(e.filter).filter(i=>i.canBeTargetOfEffect(t)),["Attack"]),execute:async t=>{if(!await qi(t,["Attack"])||!t.selectedEntities.length)return!1;t.action.entity.info.effectTargets[t.action.seq]=t.selectedEntities,t.action.entity.onBeforeMove.append(async n=>{if(n.entity.face!=="FaceUp"||!n.entity.isOnFieldAsSpellTrapStrictly)return"RemoveMe";const s=Object.values(n.entity.info.effectTargets).flatMap(l=>l),[o]=n.args;if(!s.length)return"RemoveMe";const d=s[0];return d.isOnFieldStrictly&&d.face==="FaceUp"&&n.entity.isEffective&&!o.isSpellTrapZoneLikeCell&&(n.entity.controller.writeInfoLog(`${t.action.entity.toString()}がフィールドを離れたため、対象モンスター${d.toString()}を破壊。`),await fe.tryMarkForDestory([d],t)),"RemoveMe"});const a=t.selectedEntities[0];return a.onBeforeMove.append(async n=>{if(n.entity.face!=="FaceUp"||!n.entity.isOnFieldAsMonsterStrictly)return"RemoveMe";const[,,,,,s]=n.args;return t.action.entity.isOnFieldStrictly&&t.action.entity.face==="FaceUp"&&n.entity.isEffective&&s.union(["EffectDestroy","RuleDestroy"]).length&&(t.activator.writeInfoLog(`${n.entity.toString()}が破壊されたため、${t.action.entity.toString()}を破壊。`),await fe.tryMarkForDestory([a],t)),"RemoveMe"}),a.onAfterMove.append(async n=>e.onMonsterAfterMove?await e.onMonsterAfterMove(t,n):"RemoveMe"),!0},settle:async()=>!0},we]})),r},cu=(r,e,t,i)=>{if(!r.action.entity.origin.link||r.action.entity.origin.link<t.length)return;let a=t.map(s=>({material:s,cell:s.fieldCell,link:1}));if(r.action.entity.origin.link>t.length){if(t.every(d=>(d.origin.link??1)<2))return;const s=[a];t.filter(d=>(d.origin.link??1)>1).forEach(d=>{[...s].forEach(l=>{s.push([...l.filter(c=>c.material!==d),{material:d,cell:d.fieldCell,link:d.origin.link??1}])})});const o=s.find(d=>d.reduce((l,c)=>l+c.link,0)===r.action.entity.origin.link);if(!o)return;a=o}if(!i(t)||!r.activator.getEnableSummonList(r.activator,"LinkSummon",["Rule","SpecialSummon"],r.action,[{monster:r.action.entity,posList:["Attack"],cells:e}],a,!1).length)return;if(r.activator.getAvailableExtraZones().length)return a;const n=r.activator.duel.field.getCells("ExtraMonsterZone").map(s=>s.cardEntities[0]).filter(s=>s);if(n.filter(s=>s.controller===r.activator).length&&n.filter(s=>s.controller===r.activator).length===t.filter(s=>s.fieldCell.cellType==="ExtraMonsterZone").length||r.activator.getMonsterZones().flatMap(s=>s.linkArrowSources).some(s=>!t.includes(s))||r.activator.duel.field.canExtraLink(r.action.entity,a))return a},uu=(r,e=()=>!0)=>{let t=[...r.activator.getMonstersOnField().filter(a=>a.battlePosition!=="Set"),...r.activator.getHandCell().entities.filter(a=>a.origin.kind==="Monster")];if(t.every(a=>!a.status.allowHandLink)&&(t=t.filter(a=>a.fieldCell.isPlayFieldCell)),t.length<1)return[];const i=[...r.activator.getMonsterZones(),...r.activator.duel.field.getAvailableExtraMonsterZones()];return t.getAllOnOffPattern().filter(a=>a.some(n=>n.status.allowHandLink)||a.every(n=>n.isOnFieldAsMonsterStrictly)).map(a=>cu(r,i,a,e)??[]).filter(a=>a.length)},du=async(r,e,t)=>{var d;const i=r.action.getEnableMaterialPatterns(r),a=i.map(l=>({infos:l,materialSeqList:l.map(c=>c.material.seq).sort()}));let n=i[0].map(l=>l.material);if(i.length>1){const l=i.flatMap(f=>f.map(p=>p.material)).getDistinct(),c=await r.action.entity.duel.view.waitSelectEntities(r.activator,l,void 0,f=>{const p=f.map(h=>h.seq).sort();return a.some(h=>p.length===h.materialSeqList.length&&p.every((m,C)=>m===h.materialSeqList[C]))},"リンク素材とするモンスターを選択",t);if(!c)return;n=c}const s=n.map(l=>l.seq).sort(),o=(d=a.find(l=>s.length===l.materialSeqList.length&&s.every((c,f)=>c===l.materialSeqList[f])))==null?void 0:d.infos;if(!o)throw new oe("想定されない状態",r,n);return await fe.sendManyToGraveyardForTheSameReason(n,["LinkMaterial","Cost","Rule","SpecialSummonMaterial"],r.action.entity,r.activator),{summonMaterialInfos:o}},$a=(r=()=>!0)=>({title:"リンク召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],getEnableMaterialPatterns:e=>uu(e,r),canPayCosts:e=>e.action.getEnableMaterialPatterns(e).length>0,validate:e=>!e.ignoreCost||e.activator.getAvailableExtraZones().length+e.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:du,prepare:e=>vi(e,"LinkSummon",["Rule","SpecialSummon","LinkSummon"],["Attack"]),execute:pi,settle:async()=>!0}),fu=()=>{const r=[];return[{name:"ＬＡＮフォリンクス",validator:e=>e.length===2},{name:"トラフィックゴースト",validator:e=>e.length===3},{name:"天威の鬼神",validator:e=>e.length>1&&e.some(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Link")})},{name:"天威の拳僧",validator:e=>e.every(t=>{var i,a;return((i=t.status.nameTags)==null?void 0:i.includes("天威"))&&!((a=t.status.monsterCategories)!=null&&a.includes("Link"))})},{name:"電影の騎士ガイアセイバー",validator:e=>e.length>1}].forEach(e=>r.push({name:e.name,actions:[he,$a(e.validator)],defaultSummonFilter:at})),r},vu=()=>{const r=[];return r.push({name:"ファイアウォール・ドラゴン・シンギュラリティ",actions:[he,$a(e=>e.length>2),{title:"①バウンス＆自己強化",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:gt,executablePeriods:[...Le,...Ie],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>[...e.activator.getGraveyard().cardEntities,...e.activator.getMonstersOnField()].flatMap(n=>n.status.monsterCategories??[]).getDistinct().union(["Ritual","Fusion","Syncro","Xyz"]).length<1?void 0:[...e.activator.getOpponentPlayer().getGraveyard().cardEntities,...e.activator.getOpponentPlayer().getEntiteisOnField()].filter(n=>n.canBeTargetOfEffect(e)).length?[]:void 0,prepare:async e=>{const i=[...e.activator.getGraveyard().cardEntities,...e.activator.getMonstersOnField()].flatMap(s=>s.status.monsterCategories??[]).getDistinct().union(["Ritual","Fusion","Syncro","Xyz"]).length;if(i<1)return;const a=[...e.activator.getOpponentPlayer().getGraveyard().cardEntities,...e.activator.getOpponentPlayer().getEntiteisOnField()].filter(s=>s.canBeTargetOfEffect(e));if(a.length<1)return;const n=await e.action.entity.duel.view.waitSelectEntities(e.activator,a,void 0,s=>s.length>0&&s.length<=i,"手札に戻すカードを選択。",!1)??[];if(n.length)return{selectedEntities:n,chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.selectedEntities.filter(a=>a.isOnFieldStrictly||a.fieldCell.cellType==="Graveyard").filter(a=>a.canBeEffected(e.activator,e.action.entity,e.action));await fe.returnManyToHandForTheSameReason(t,["Effect"],e.action.entity,e.activator);const i=t.filter(a=>a.fieldCell.cellType==="Hand"||a.fieldCell.cellType==="ExtraDeck").length;return e.action.entity.numericOprsBundle.push(yt.createLingeringAddition(e.action.title,a=>a.isSpawnedBy.isEffective,e.action.entity,e.action,"attack",(a,n,s)=>s+500*i)),!0},settle:async()=>!0},{title:"②蘇生",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:gt,executablePeriods:Nt,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>{const t=e.action.entity.moveLog.latestRecord.movedAt,i=e.action.duel.field.moveLog.getPriviousChainLog().filter(s=>(console.log(s,s.entity.fieldCell.cellType==="Graveyard",s.movedAs.includes("BattleDestroy")),s.entity.fieldCell.cellType==="Graveyard"||s.movedAs.includes("BattleDestroy"))).filter(s=>s.movedAt.totalProcSeq>t.totalProcSeq).map(s=>s.entity.wasMovedFrom).toArray();if(!e.action.entity.linkArrowDests.union(i).length)return;const a=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getGraveyard().cardEntities.filter(s=>s.status.kind==="Monster").filter(s=>s.types.includes("Cyberse")).filter(s=>s.canBeTargetOfEffect(e)).map(s=>({monster:s,posList:Ye,cells:a})),[],!1).length)return Ae(e)},prepare:e=>Ni(e,e.activator.getGraveyard().cardEntities.filter(t=>t.status.kind==="Monster").filter(t=>t.types.includes("Cyberse")).filter(t=>t.canBeTargetOfEffect(e)),Ye),execute:e=>qi(e,Ye),settle:async()=>!0}],defaultSummonFilter:at}),r},pu=()=>{const r=[];return r.push({name:"ドットスケーパー",actions:[he,ge,Ue,Se,{title:"①自己再生",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...Le,...Ie],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:1,actionGroupName:"ドットスケーパー",validate:e=>{if(e.action.entity.wasMovedAtPreviousChain)return e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:e=>oi(e),settle:async()=>!0},{title:"②自己帰還",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Banished"],executablePeriods:[...Le,...Ie],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:1,actionGroupName:"ドットスケーパー",validate:e=>{if(e.action.entity.wasMovedAtPreviousChain)return e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromBanished"],prepared:void 0}),execute:e=>oi(e),settle:async()=>!0}]}),r},hu=()=>{const r=[];return r.push({name:"昇天の黒角笛",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Counter",executableCells:["SpellAndTrapZone"],executablePeriods:Nt,executableDuelistTypes:["Controller"],negateSummon:!0,validate:e=>{if(e.targetChainBlock&&e.targetChainBlock.action.playType==="SpecialSummon"&&e.targetChainBlock.activator!==e.activator&&e.activator.duel.field.getPendingMonstersOnField().length===1)return Ae(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["NegateSpecialSummon"],prepared:void 0}),execute:async e=>{const t=fe.negateSummonMany(e.action.entity,e.activator);return await fe.tryDestroy(t,e),!0},settle:async()=>!0},we]}),r},gu=()=>{const r=[];return r.push({name:"フォーミュラ・シンクロン",actions:[he,ge,Se,Ot(),{title:"①ドロー",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:gt,executablePeriods:[...Le,...Ie],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.hasBeenSummonedJustNow(["SyncroSummon"])&&e.activator.getDeckCell().cardEntities.length)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(1,e.action.entity,e.activator),!0),settle:async()=>!0},_s({title:"②シンクロ召喚",isOnlyNTimesPerChain:1})],defaultSummonFilter:at}),r},yu=()=>{const r=[];return r.push({name:"死霊騎士デスカリバー・ナイト",actions:[he,ge,Ue,Se,{title:"①モンスター効果無効",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Quick",executableCells:gt,executablePeriods:[...Le,...Ie],executableDuelistTypes:["Controller"],negatePreviousBlock:!0,canPayCosts:Ra,validate:e=>e.targetChainBlock&&e.targetChainBlock.action.entity.status.kind==="Monster"&&e.targetChainBlock.action.isWithChainBlock?[]:void 0,payCosts:Ha,prepare:async(e,t)=>{const i=e.targetChainBlock,a=t[e.index-1];return i!==a?{selectedEntities:[],chainBlockTags:[],prepared:void 0}:{selectedEntities:[],chainBlockTags:["NegateCardEffect",...e.action.calcChainBlockTagsForDestroy([i.action.entity])],prepared:void 0}},execute:async(e,t)=>{const i=t.find(n=>n.action.entity.status.kind!=="Monster"&&n.action.isWithChainBlock),a=t[e.index-1];return a!==i?!1:(a.isNegatedActivationBy=e.action,await fe.tryDestroy([a.action.entity],e),!0)},settle:async()=>!0}],defaultSummonFilter:at}),r},mu=()=>{const r=[];return r.push({name:"ゼラの天使",actions:[he,ge,Se,Ot(),{title:"②自己帰還",isMandatory:!0,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Banished"],executablePeriods:["stanby"],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.wasMovedAtPreviousTurn)return e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromBanished"],prepared:void 0}),execute:e=>oi(e),settle:async()=>!0}],continuousEffects:[sr("②攻撃力上昇","Monster",e=>[e],()=>!0,e=>[yt.createContinuous("①攻撃力上昇",()=>!0,e,()=>!0,"attack","wip","Addition",(t,i,a)=>t.isEffective?a+t.controller.getOpponentPlayer().getBanished().cardEntities.length*100:a)])],defaultSummonFilter:at}),r},_u=()=>{const r=[];return r.push({name:"星杯の妖精リース",actions:[he,ge,Se,Ue,{title:"①サーチ",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...Le,...Ie],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>{if(e.action.entity.hasBeenSummonedNow(["NormalSummon","SpecialSummon"])&&e.activator.getDeckCell().cardEntities.filter(t=>t.status.kind==="Monster").filter(t=>{var i;return(i=t.status.nameTags)==null?void 0:i.includes("星杯")}).length!==0)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(a=>a.status.kind==="Monster").filter(a=>{var n;return(n=a.status.nameTags)==null?void 0:n.includes("星杯")});if(t.length===0)return!1;const i=await e.activator.waitSelectEntity(t,"手札に加えるモンスターを選択",!1);if(!i)throw new oe("想定されない状態",e);return await i.addToHand(["Effect"],e.action.entity,e.activator),!0},settle:async()=>!0},{title:"②自己サルベージ",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,canPayCosts:e=>[...e.activator.getMonstersOnField(),...e.activator.getHandCell().cardEntities.filter(t=>t.status.kind==="Monster")].some(t=>t.canBeSentToGraveyard(e.activator,e.action.entity,["SendToGraveyardAsCost"],e.action)),validate:()=>[],payCosts:async e=>{const t=[...e.activator.getMonstersOnField(),...e.activator.getHandCell().cardEntities.filter(a=>a.status.kind==="Monster")].filter(a=>a.canBeSentToGraveyard(e.activator,e.action.entity,["SendToGraveyardAsCost"],e.action)),i=await e.activator.waitSelectEntity(t,"墓地に送るモンスターを選択。",!0);if(i)return await i.sendToGraveyard(["Cost"],e.action.entity,e.activator),{sendToGraveyard:[i]}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>e.action.entity.wasMovedAfter(e.isActivatedAt)?!1:(await e.action.entity.addToHand(["Effect"],e.action.entity,e.activator),!0),settle:async()=>!0}]}),r.push({name:"星遺物－『星杯』",actions:[he,ge,Se,Ue,{title:"①墓地送り",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...Le,...Ie],executableDuelistTypes:["Controller"],canPayCosts:Ra,validate:e=>e.activator.duel.field.moveLog.getPriviousChainLog().filter(t=>t.movedAs.includes("SpecialSummon")).map(t=>t.entity).some(t=>t.wasMovedFrom.cellType==="ExtraDeck")?[]:void 0,payCosts:Ha,prepare:nt,execute:async e=>{const t=e.activator.duel.field.moveLog.getPriviousChainLog().filter(i=>i.movedAs.includes("SpecialSummon")).map(i=>i.entity).filter(i=>i.wasMovedFrom.cellType==="ExtraDeck").filter(i=>i.isOnFieldAsMonsterStrictly).filter(i=>i.canBeEffected(e.activator,e.action.entity,e.action)).toArray();return await fe.sendManyToGraveyardForTheSameReason(t,["Effect"],e.action.entity,e.activator),!0},settle:async()=>!0},{title:"②リクルート",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Hand","Graveyard","Banished"],executablePeriods:[...Le,...Ie],executableDuelistTypes:["Controller"],validate:e=>{if(!e.action.entity.wasMovedAtPreviousChain||!e.action.entity.info.summonKinds.includes("NormalSummon")||e.action.entity.moveLog.previousPlaceRecord.face==="FaceDown")return;const t=e.activator.getDeckCell().cardEntities.filter(n=>n.status.kind==="Monster").filter(n=>{var s;return(s=n.status.nameTags)==null?void 0:s.includes("星杯")}).filter(n=>n.nm!=="星遺物－『星杯』"),i=e.activator.getMonsterZones();return e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,t.map(n=>({monster:n,cells:i,posList:Ye})),[],!1).length>1?[]:void 0},prepare:nt,execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(n=>n.status.kind==="Monster").filter(n=>{var s;return(s=n.status.nameTags)==null?void 0:s.includes("星杯")}).filter(n=>n.nm!=="星遺物－『星杯』"),i=e.activator.getMonsterZones();return(await e.activator.summonMany(e.activator,"SpecialSummon",["Effect"],e.action,t.map(n=>({monster:n,cells:i,posList:Ye})),[],!1,2,n=>n.length==2,!1)??[]).length==2},settle:async()=>!0},{title:"③サーチ",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],canPayCosts:lr,validate:e=>{if(!e.action.entity.wasMovedAtCurrentTurn)return e.activator.getDeckCell().cardEntities.filter(t=>{var i;return(i=t.status.nameTags)==null?void 0:i.includes("星遺物")}).length>0?[]:void 0},payCosts:jr,prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>{const t=await e.activator.waitSelectEntity(e.activator.getDeckCell().cardEntities.filter(i=>{var a;return(a=i.status.nameTags)==null?void 0:a.includes("星遺物")}),"手札に加えるカードを選択",!1);return t?(await t.addToHand(["Effect"],e.action.entity,e.activator),!0):!1},settle:async()=>!0}]}),r},Su=()=>{const r=[];return r.push({name:"水晶機巧－ハリファイバー",actions:[he,$a(e=>e.length===2&&e.some(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Tuner")})),{title:"①リクルート",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:gt,executablePeriods:[...Le,...Ie],executableDuelistTypes:["Controller"],validate:e=>{if(!e.action.entity.hasBeenSummonedNow(["LinkSummon"]))return;const t=[e.activator.getHandCell(),e.activator.getDeckCell()].flatMap(n=>n.cardEntities).filter(n=>(n.lvl??12)<4).filter(n=>{var s;return(s=n.status.monsterCategories)==null?void 0:s.includes("Tuner")}),i=e.activator.getMonsterZones();return e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,t.map(n=>({monster:n,cells:i,posList:["Defense"]})),[],!1).length?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async e=>{const t=[e.activator.getHandCell(),e.activator.getDeckCell()].flatMap(n=>n.cardEntities).filter(n=>(n.lvl??12)<4).filter(n=>{var s;return(s=n.status.monsterCategories)==null?void 0:s.includes("Tuner")}),i=e.activator.getMonsterZones(),a=await e.activator.summonOne(e.activator,"SpecialSummon",["Effect"],e.action,t.map(n=>({monster:n,cells:i,posList:["Defense"]})),[],!1,!1)??[];return a.forEach(n=>n.statusOperatorBundle.push(new qa("効果発動不可",s=>s.effectOwner.duel.clock.isSameTurn(s.isSpawnedAt),!1,e.action.entity,e.action,()=>!0,()=>({canActivateEffect:!1})))),a.length==1},settle:async()=>!0},{title:"②シンクロ召喚",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:gt,executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerChain:1,canPayCosts:lr,validate:e=>{if(e.activator.isTurnPlayer)return;const t=[...e.activator.getMonsterZones(),...e.activator.duel.field.getCells("ExtraMonsterZone")],i=e.activator.getExtraDeck().cardEntities.filter(n=>{var s;return(s=n.status.monsterCategories)==null?void 0:s.includes("Syncro")}).filter(n=>{var s;return(s=n.status.monsterCategories)==null?void 0:s.includes("Tuner")});return e.activator.getEnableSummonList(e.activator,"SyncroSummon",["SpecialSummon","Effect"],e.action,i.map(n=>({monster:n,cells:t,posList:Ye})),[{material:e.action.entity,cell:e.action.entity.fieldCell}],!1).length?[]:void 0},payCosts:jr,prepare:nt,execute:async e=>{const t=[...e.activator.getMonsterZones(),...e.activator.duel.field.getCells("ExtraMonsterZone")],i=e.activator.getExtraDeck().cardEntities.filter(a=>{var n;return(n=a.status.monsterCategories)==null?void 0:n.includes("Syncro")}).filter(a=>{var n;return(n=a.status.monsterCategories)==null?void 0:n.includes("Tuner")});return await e.activator.summonOne(e.activator,"SyncroSummon",["SpecialSummon","Effect"],e.action,i.map(a=>({monster:a,cells:t,posList:Ye})),[],!1,!1),!0},settle:async()=>!0}],defaultSummonFilter:at}),r},Cu=()=>{const r=[];return r.push({name:"エキセントリック・ボーイ",actions:[he,ge,Ue,Se],defaultSummonFilter:(e,t,i,a,n,s,o,d,l,c)=>{const f={posList:l,cells:c},p={posList:[],cells:[]};if(!n.includes("SyncroSummon"))return f;const h=d.find(m=>m.material===e.isSpawnedBy);return h?!h.cell.isMonsterZoneLikeCell||d.length!==2?p:d.filter(m=>m!==h).every(m=>m.cell.cellType==="Hand")?f:p:f},defaultStatus:{allowHandSyncro:!0},onUsedAsMaterial:(e,t)=>{t.info.summonKinds.includes("SyncroSummon")&&(t.info.willBeBanished=!0,t.info.isEffectiveIn=t.info.isEffectiveIn.filter(i=>i!=="ExtraMonsterZone").filter(i=>i!=="MonsterZone"))}}),r},ku=()=>{const r=[];return r.push({name:"シューティング・ライザー・ドラゴン",actions:[he,ge,Se,Ot(),{title:"①墓地送り",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:gt,executablePeriods:[...Le,...Ie],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>{if(e.action.entity.hasBeenSummonedNow(["SyncroSummon"])&&e.activator.getDeckCell().cardEntities.some(t=>(t.lvl??12)<(e.action.entity.lvl??0)))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SendToGraveyardFromDeck","IfSpecialSummonSucceed"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(n=>(n.lvl??12)<(e.action.entity.lvl??0));if(t.length===0)return!1;const i=await e.activator.waitSelectEntity(t,"墓地に送るモンスターを選択",!1);if(!i)throw new oe("想定されない状況",e);await i.sendToGraveyard(["Effect"],e.action.entity,e.activator);const a=i.lvl??0;return e.action.entity.numericOprsBundle.push(yt.createLingeringAddition("レベル減少",()=>!0,e.action.entity,e.action,"level",(n,s,o)=>o-a)),!0},settle:async()=>!0},_s({title:"②シンクロ召喚",isOnlyNTimesPerChain:1})],defaultSummonFilter:at}),r},wu=()=>{const r=[];return r.push({name:"ジャンク・コレクター",actions:[he,ge,Se,Ue,{title:"罠コピー",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:gt,executablePeriods:Le,executableDuelistTypes:["Controller"],canPayCosts:e=>e.activator.getGraveyard().cardEntities.filter(i=>i.status.kind==="Trap").filter(i=>i.status.trapCategory==="Normal").filter(i=>e.activator.canTryBanish(i,"BanishAsCost",e.action)).filter(i=>i.canBeBanished("BanishAsCost",e.activator,e.action.entity,e.action)).flatMap(i=>i.actions).filter(i=>i.playType==="CardActivation").filter(i=>!i.needsToPayCost).filter(i=>i.validate(e.activator,[],!0)).length?lr(e):!1,validate:()=>[],payCosts:async(e,t,i)=>{const a=e.activator.getGraveyard().cardEntities.filter(o=>o.status.kind==="Trap").filter(o=>o.status.trapCategory==="Normal").filter(o=>e.activator.canTryBanish(o,"BanishAsCost",e.action)).filter(o=>o.canBeBanished("BanishAsCost",e.activator,e.action.entity,e.action)).flatMap(o=>o.actions).filter(o=>o.playType==="CardActivation").filter(o=>!o.needsToPayCost).filter(o=>o.validate(e.activator,[],!0)).map(o=>o.entity),n=await e.activator.waitSelectEntity(a,"コピーする罠を選択。",i);if(!n)return;const s=[e.action.entity,n];return await fe.banishManyForTheSameReason(s,["Cost"],e.action.entity,e.activator),{banish:s}},prepare:async(e,t)=>{var n;const i=(n=e.costInfo.banish)==null?void 0:n.find(s=>s!==e.action.entity);if(!i)throw new oe("想定されない状況",e,e.costInfo);const a=i.actions.find(s=>s.playType==="CardActivation");if(!a)throw new oe("想定されない状況",e,e.costInfo,i);return await a.prepare(e.activator,void 0,void 0,t,!1,!0)},execute:async(e,t)=>{var n;const i=(n=e.costInfo.banish)==null?void 0:n.find(s=>s!==e.action.entity);if(!i)throw new oe("想定されない状況",e,e.costInfo);const a=i.actions.find(s=>s.playType==="CardActivation");if(!a)throw new oe("想定されない状況",e,e.costInfo,i);return await a.execute(e,t)},settle:async()=>!0}]}),r},Tu=()=>{const r=[];return["イグナイト・イーグル","イグナイト・マグナム","イグナイト・ドラグノフ","イグナイト・マスケット","イグナイト・デリンジャー","イグナイト・ライオット","イグナイト・ウージー","イグナイト・キャリバー"].forEach(e=>{r.push({name:e,actions:[he,ge,Se,Ue,bs,{title:"①サーチ",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:t=>{var a;const i=t.activator.getPendulumScaleMonsters().find(n=>n!==t.action.entity);if(i&&(a=i.status.nameTags)!=null&&a.includes("イグナイト"))return t.activator.getDeckCell().cardEntities.some(n=>{var s;return(s=n.status.nameTags)==null?void 0:s.includes("イグナイト")})?[]:void 0},prepare:async t=>({selectedEntities:[],chainBlockTags:["SearchFromDeck",...t.action.calcChainBlockTagsForDestroy(t.activator.getPendulumScaleMonsters())],prepared:void 0}),execute:async t=>{if(!(await fe.tryDestroy(t.activator.getPendulumScaleMonsters(),t)).length)return!1;const a=t.activator.getDeckCell().cardEntities.filter(s=>{var o;return(o=s.status.nameTags)==null?void 0:o.includes("イグナイト")});if(!a.length)return!1;const n=await t.activator.waitSelectEntity(a,"手札に加えるカードを選択。",!1);return n?(await n.addToHand(["Effect"],t.action.entity,t.activator),!0):!1},settle:async()=>!0}]})}),r},bu=()=>{const r=[];return r.push({name:"封印されしエクゾディア",actions:[he,ge,Ue,Se,{title:"封印開放",isMandatory:!0,playType:"Exodia",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:Nt,executableDuelistTypes:["Controller"],validate:e=>{const t=e.activator.getHandCell().cardEntities.filter(i=>{var a;return(a=i.origin.nameTags)==null?void 0:a.includes("封印されし")}).map(i=>i.origin.name).getDistinct();return console.log(e.action.entity.toString(),t),t.length===5?[]:void 0},prepare:async e=>(await fe.sendManyToGraveyardForTheSameReason(e.activator.duel.field.getCardsOnFieldStrictly(),["Rule"],e.action.entity,e.activator),{selectedEntities:[],chainBlockTags:[""],prepared:void 0,nextChainBlockFilter:()=>!1}),execute:async e=>{const t=e.activator.getOpponentPlayer().getHandCell().cardEntities.filter(a=>{var n;return(n=a.origin.nameTags)==null?void 0:n.includes("封印されし")}).map(a=>a.origin.name).getDistinct().length===5,i=[{name:"封印されし者の左足",column:4},{name:"封印されし者の右足",column:2},{name:"封印されし者の左腕",column:5},{name:"封印されし者の右腕",column:1},{name:"封印されしエクゾディア",column:3}];for(const a of i){const n=[e.activator.getHandCell().cardEntities.find(s=>s.origin.name===a.name),e.activator.getOpponentPlayer().getHandCell().cardEntities.find(s=>s.origin.name===a.name)].filter(s=>s!==void 0);if(!n.length)throw new oe("想定されない状態",e.activator.getHandCell().cardEntities,a.name);await xe.moveMany(n.map(s=>[s,s.controller.getMonsterZones().find(o=>o.column===(s.controller.seat==="Above"?6-a.column:a.column))??s.controller.getFieldZone(),"Monster","FaceUp","Vertical","Top",["Rule"],void 0,void 0,void 0]))}throw t?new qt(void 0,`お互いが、${e.action.entity.toString()}の特殊勝利条件を同時に満たした。`):new qt(e.activator,`${e.action.entity.toString()}の特殊勝利条件を満たした。`)},settle:async()=>!0}]}),r},Eu=()=>{const r=[...Dc(),...Fc(),...Uc(),...Pc(),...Rc(),...Yc(),...Gc(),...jc(),...Vc(),...zc(),...Wc(),...Qc(),...nu(),...Jc(),...Xc(),...ou(),...Ic(),...au(),...su(),...lu(),...fu(),...vu(),...pu(),...hu(),...gu(),...yu(),...mu(),..._u(),...Su(),...Cu(),...ku(),...wu(),...Tu(),...bu()],e=r.map(i=>i.name);console.info(e);const t=Object.values(Object.groupBy(e,i=>i)).filter(i=>((i==null?void 0:i.length)??2)>1).map(i=>i==null?void 0:i[0]);if(t.length>0)throw new oe("カード定義重複",...t);return r},Ds=new Map;Eu().forEach(r=>{Ds.set(r.name,r)});const Ca=Ds,Du=$s,pt=Object.values(Du).reduce((r,e)=>(r[e.name]=e,r),{}),As=[{id:-1,name:"サンプルデッキ１",description:"",cardNames:["アンノウン・シンクロン","六武衆のご隠居","ジャンク・フォアード","ジャンク・フォアード","ジャンク・フォアード","チューン・ウォリアー","チューン・ウォリアー","ガード・オブ・フレムベル","ガード・オブ・フレムベル","守護竜ユスティア","守護竜ユスティア","エンジェル・トランペッター","エンジェル・トランペッター","ジェムナイト・サフィア","ジェムナイト・サフィア","魂虎","魂虎","暗黒界の番兵 レンジ","暗黒界の番兵 レンジ","バトルフットボーラー","バトルフットボーラー","球騎士の三人娘","球騎士の三人娘","エンジェル・トランペッター","エンジェル・トランペッター","Ｇ戦隊 シャインブラック","Ｇ戦隊 シャインブラック","しゃりの軍貫","しゃりの軍貫","ジョングルグールの幻術師","ジョングルグールの幻術師","ゾンビーノ","ゾンビーノ","メガロスマッシャーＸ","メガロスマッシャーＸ","ライドロン","ライドロン","機界騎士アヴラム","機界騎士アヴラム","幻のグリフォン","幻のグリフォン","幻殻竜","幻殻竜","アレキサンドライドラゴン","アレキサンドライドラゴン","ジェネティック・ワーウルフ","ジェネティック・ワーウルフ","サイバー・ドラゴン","フロストザウルス","フロストザウルス","フロストザウルス","青眼の白龍","マジカル・アンドロイド","マジカル・アンドロイド","マジカル・アンドロイド","大地の騎士ガイアナイト","大地の騎士ガイアナイト","大地の騎士ガイアナイト","スクラップ・デスデーモン","スクラップ・デスデーモン","スクラップ・デスデーモン","スターダスト・ドラゴン","スターダスト・ドラゴン","スターダスト・ドラゴン","ナチュル・ガオドレイク","ナチュル・ガオドレイク","ナチュル・ガオドレイク"]},{id:-2,name:"サンプルデッキ２",description:"",cardNames:["アンノウン・シンクロン","六武衆のご隠居","ジャンク・フォアード","グローアップ・バルブ","ガード・オブ・フレムベル","伝説の白石","伝説の白石","伝説の白石","守護竜ユスティア","ギャラクシーサーペント","ジェネクス・コントローラー","Ｅ・ＨＥＲＯ フェザーマン","Ｅ・ＨＥＲＯ バーストレディ","チューン・ウォリアー","Ｅ・ＨＥＲＯ クレイマン","Ｅ・ＨＥＲＯ スパークマン","しゃりの軍貫","ジョングルグールの幻術師","ゾンビーノ","ジェネティック・ワーウルフ","ライトロード・ビースト ウォルフ","サイバー・ドラゴン","サイバー・ドラゴン","サイバー・ドラゴン","ラブラドライドラゴン","Ｄ－ＨＥＲＯ ディアボリックガイ","Ｄ－ＨＥＲＯ ディアボリックガイ","Ｄ－ＨＥＲＯ ディアボリックガイ","フロストザウルス","Ｅ・ＨＥＲＯ ネオス","青眼の白龍","青眼の白龍","青眼の白龍","Ｅ－エマージェンシーコール","おろかな埋葬","トレード・イン","トレード・イン","トレード・イン","闇の量産工場","強欲な壺","強欲な壺","強欲な壺","死者蘇生","死者蘇生","死者蘇生","召喚師のスキル","召喚師のスキル","召喚師のスキル","成金ゴブリン","成金ゴブリン","成金ゴブリン","戦士の生還","増援","調和の宝札","調和の宝札","調和の宝札","天使の施し","天使の施し","天使の施し","貪欲な壺","貪欲な壺","貪欲な壺","マジカル・アンドロイド","マジカル・アンドロイド","マジカル・アンドロイド","大地の騎士ガイアナイト","大地の騎士ガイアナイト","大地の騎士ガイアナイト","スクラップ・デスデーモン","スクラップ・デスデーモン","スクラップ・デスデーモン","スターダスト・ドラゴン","スターダスト・ドラゴン","スターダスト・ドラゴン","ナチュル・ガオドレイク","ナチュル・ガオドレイク","ナチュル・ガオドレイク"]}],ye=class ye{constructor(e,t){u(this,"id");u(this,"name");u(this,"description");u(this,"lastUsedAt");u(this,"cardNames");u(this,"getIllegalCardNames",()=>Array.from(new Set(this.cardNames.filter(e=>!Object.keys(pt).includes(e)))));u(this,"getDisableCardNames",()=>Array.from(new Set(this.cardNames.filter(e=>!Object.keys(pt).includes(e)))));u(this,"createCardInfos",()=>{const e=this.getIllegalCardNames();if(e.length>0)throw new Error(`存在しないカード名からデッキを生成しようとした。${e}`);return this.cardNames.map(t=>pt==null?void 0:pt[t]).filter(t=>t)});u(this,"copy",async()=>ye.createNewDeck(this.name,this.description,this.cardNames));u(this,"updateTimestamp",async()=>{await ye.tblHeader.update(this.id,e=>({...e,lastUsedAt:new Date}))});u(this,"saveDeckInfo",async e=>{const t=e??this;await ye.tblHeader.update(this.id,n=>({...n,name:t.name,description:t.description,lastUsedAt:new Date}));const i=(await ye.tblDetail.getAll()).filter(n=>n.deckId===this.id);await ye.tblDetail.delete(i.map(n=>n.id));const a=await ye.tblDetail.insertMany(t.cardNames.map((n,s)=>({deckId:this.id,seq:s,name:n,description:""})));return new ye(await ye.tblHeader.get(this.id),a)});u(this,"delete",async()=>{await ye.tblHeader.delete([this.id]);const e=(await ye.tblDetail.getAll()).filter(t=>t.deckId===this.id);await ye.tblDetail.delete(e.map(t=>t.id))});this.id=e.id,this.name=e.name,this.description=e.description,this.lastUsedAt=e.lastUsedAt,this.cardNames=t.filter(i=>i.deckId===this.id).map(i=>i.name)}};u(ye,"toJson",e=>{const t=e.map(i=>{const{id:a,name:n,description:s,lastUsedAt:o,cardNames:d}=i;return{id:a,name:n,description:s,lastUsedAt:o,cardNames:d}});return t.forEach(i=>{i.cardNames=i.cardNames.map(a=>pt[a]).sort(ji).map(a=>a.name)}),JSON.stringify(t,null,2)}),u(ye,"convertToObjectURL",e=>{const t=ye.toJson(e),i=new Blob([t],{type:"text/plain"});return window.URL.createObjectURL(i)}),u(ye,"idb"),u(ye,"tblHeader"),u(ye,"tblDetail"),u(ye,"getAllDeckInfo",async e=>{if(e&&(ye.idb=e),!ye.idb)throw new Error("illegal argument: idb is undefined.");ye.tblHeader||(ye.tblHeader=new Au(ye.idb)),ye.tblDetail||(ye.tblDetail=new xu(ye.idb));const t=await ye.tblHeader.getAll(),i=await ye.tblDetail.getAll();return t.length?t.map(a=>new ye(a,i)):[await ye.prepareSampleDeck()]}),u(ye,"createNewDeck",async(e,t,i)=>{const a=await ye.tblHeader.insert({name:e,description:t,lastUsedAt:new Date}),n=await ye.tblDetail.insertMany(i.map((s,o)=>({deckId:a.id,seq:o,name:s,description:""})));return new ye(a,n)}),u(ye,"prepareSampleDeck",async()=>{const e=As.slice(-1)[0];return await ye.createNewDeck(e.name,e.description,e.cardNames)});let Bt=ye;class Au extends Fa{constructor(t){super(t,"TblDeckHeader");u(this,"_prepareInitialRecords",()=>[])}}class xu extends Fa{constructor(t){super(t,"TblDeckDetail");u(this,"_prepareInitialRecords",()=>[])}}const Sn=As.map(r=>({...r,lastUsedAt:new Date})).filter(r=>r.id<0),Mu=r=>r;function Pu(r){const e=r-1;return e*e*e+1}function Bu(r,{delay:e=0,duration:t=400,easing:i=Mu}={}){const a=+getComputedStyle(r).opacity;return{delay:e,duration:t,easing:i,css:n=>`opacity: ${n*a}`}}function Cn(r,e){for(const t in e)r[t]=e[t];return r}function Fu({fallback:r,...e}){const t=new Map,i=new Map;function a(s,o,d){const{delay:l=0,duration:c=te=>Math.sqrt(te)*30,easing:f=Pu}=Cn(Cn({},e),d),p=s.getBoundingClientRect(),h=o.getBoundingClientRect(),m=p.left-h.left,C=p.top-h.top,y=p.width/h.width,w=p.height/h.height,k=Math.sqrt(m*m+C*C),b=getComputedStyle(o),P=b.transform==="none"?"":b.transform,O=+b.opacity;return{delay:l,duration:typeof c=="function"?c(k):c,easing:f,css:(te,re)=>`
			   opacity: ${te*O};
			   transform-origin: top left;
			   transform: ${P} translate(${re*m}px,${re*C}px) scale(${te+(1-te)*y}, ${te+(1-te)*w});
		   `}}function n(s,o,d){return(l,c)=>(s.set(c.key,l),()=>{if(o.has(c.key)){const f=o.get(c.key);return o.delete(c.key),a(f,l,c)}return s.delete(c.key),r&&r(l,c,d)})}return[n(i,t,!1),n(t,i,!0)]}var Ou=T("<div></div>"),Lu=T('<div class="duel_card_row svelte-14cfp8z"><div> </div> <div> </div></div>'),Nu=T('<div class="duel_card_row svelte-14cfp8z"><div class="svelte-14cfp8z"></div> <div class="svelte-14cfp8z"> </div></div>'),qu=T('<div class="duel_card_row svelte-14cfp8z"><div class="svelte-14cfp8z"></div> <div class="svelte-14cfp8z"> </div></div>'),Ru=T('<div class="duel_card_row svelte-14cfp8z"><div> </div> <div> </div></div>'),Hu=T('<div class="duel_card_row svelte-14cfp8z"><div class="svelte-14cfp8z"></div> <div class="svelte-14cfp8z">ペンデュラム</div></div>'),$u=T('<div class="duel_card_row duel_card_detail svelte-14cfp8z"><div class="svelte-14cfp8z"> </div></div> <div class="duel_card_row duel_card_detail svelte-14cfp8z"><div class="svelte-14cfp8z"></div> <div class="svelte-14cfp8z"><span> </span> / <span> </span></div></div>',1),Zu=T('<button><div class="duel_card_body svelte-14cfp8z"><div class="duel_card_row svelte-14cfp8z" style="position:relative"><div class="svelte-14cfp8z"> </div> <div class="svelte-14cfp8z"></div> <!></div> <!> <!> <!> <!></div></button>'),Uu=T('<button><div class="svelte-14cfp8z">裏守備</div></button>'),Gu=T('<div class="duel_card duel_card_face_down svelte-14cfp8z"><div class="svelte-14cfp8z">セット</div></div>');function Zt(r,e){st(e,!1);let t=Be(e,"entity",8),i=Be(e,"state",8,"Disabled"),a=Be(e,"selectedList",28,()=>[]),n=Be(e,"isVisibleForcibly",8,!1),s=Be(e,"isWideMode",8,!1),o=Be(e,"dummyActionInfos",24,()=>[]),d=Be(e,"cardActionResolve",8),l=Be(e,"entitySelectResolve",8,()=>{}),c,f=je(!1),p=()=>{},h=Be(e,"qty",12,void 0);const m=Q=>{c=Q.activator,K(f,!1),h(Q.qty),p=Q.resolve};t().field.duel.view.onWaitStart.append(m);let C=je(!1);const y=()=>{if(i()!=="Disabled"&&i()==="Selectable"&&h()===1){if(a().some(Q=>Q.seq!==t().seq)){a([t()]);return}h()===1&&l()&&l()([t()])}},w=Q=>{(t().face==="FaceUp"||t().owner===t().field.duel.duelists.Below&&(t().isUnderControl||n()))&&t().field.duel.view.showCardInfo(t(),Q??"Normal")},k=()=>{if(w(),i()==="Disabled")return;if(i()==="Selectable"){K(f,!v(f)),h()===1&&(a().splice(0),t().duel.view.requireUpdate()),a(v(f)?[...a(),t()]:a().filter(J=>J!==t()));return}if(o().length===0)return;if(o().length===1){const J=o()[0];if(d()){d()(J);return}p({actionInfo:J});return}if(!c)return;t().field.duel.view.modalController.actionSelector.show({title:"行動を選択。",activator:c,dummyActionInfos:o(),cancelable:!0}).then(J=>{J&&p({actionInfo:J})})},b=Q=>{var J;window.getSelection&&((J=window.getSelection())==null||J.removeAllRanges()),console.info("drag start",Q,o()),t().field.duel.view.setDraggingActions(o()),K(C,!0)},P=Q=>{console.info("drag end",Q,o()),t().field.duel.view.removeDraggingActions(),Q.dataTransfer&&K(C,!1)},O=()=>(w("Debug"),!1);_t();var te=Ne(),re=le(te);{var L=Q=>{var J=Zu(),Fe=g(J),G=g(Fe),B=g(G),x=g(B),$=_(B,4);ue($,1,()=>t().attr,ce,(H,U)=>{var z=Ou();A(()=>Ce(z,`monster_attr ${v(U)??""} svelte-14cfp8z`)),S(H,z)});var ee=_(G,2);{var D=H=>{var U=Lu(),z=g(U),ae=g(z),ne=_(z,2),se=g(ne);A((M,V)=>{Ce(z,yi(t().lvl!==t().origin.level?"different_from_its_origin":""),"svelte-14cfp8z"),E(ae,M),Ce(ne,yi(t().rank!==t().origin.rank?"different_from_its_origin":""),"svelte-14cfp8z"),E(se,V)},[()=>"★".repeat(t().lvl||0),()=>"☆".repeat(t().rank||0)],_e),S(H,U)},Z=H=>{var U=Ne(),z=le(U);{var ae=se=>{var M=Nu(),V=_(g(M),2),ie=g(V);A(()=>E(ie,`${rr[t().status.spellCategory]??""}魔法`)),S(se,M)},ne=se=>{var M=Ne(),V=le(M);{var ie=me=>{var Te=qu(),be=_(g(Te),2),Ke=g(be);A(()=>E(Ke,`${ar[t().status.trapCategory]??""}罠`)),S(me,Te)};N(V,me=>{t().status.kind==="Trap"&&t().status.trapCategory&&me(ie)},!0)}S(se,M)};N(z,se=>{t().status.kind==="Spell"&&t().status.spellCategory?se(ae):se(ne,!1)},!0)}S(H,U)};N(ee,H=>{t().status.kind==="Monster"?H(D):H(Z,!1)})}var Y=_(ee,2);{var R=H=>{var U=Ru(),z=g(U),ae=g(z),ne=_(z,2),se=g(ne);A(()=>{Ce(z,yi(t().psL!==t().origin.pendulumScaleL?"different_from_its_origin":""),"svelte-14cfp8z"),E(ae,`◀ ${t().psL??""}`),Ce(ne,yi(t().psR!==t().origin.pendulumScaleR?"different_from_its_origin":""),"svelte-14cfp8z"),E(se,`${t().psR??""} ▶`)}),S(H,U)};N(Y,H=>{var U;(U=t().status.monsterCategories)!=null&&U.includes("Pendulum")&&H(R)})}var q=_(Y,2);{var X=H=>{var U=Hu();S(H,U)};N(q,H=>{t().status.kind==="Spell"&&t().isPendulumScale&&H(X)})}var I=_(q,2);{var j=H=>{var U=$u(),z=le(U),ae=g(z),ne=g(ae),se=_(z,2),M=_(g(se),2),V=g(M),ie=g(V),me=_(V,2),Te=g(me);A((be,Ke)=>{E(ne,`${be??""}
            ${Ke??""}`),Ce(V,yi(t().atk!==t().origin.attack?"different_from_its_origin":""),"svelte-14cfp8z"),E(ie,t().atk??"?"),Ce(me,yi(t().def!==t().origin.defense?"different_from_its_origin":""),"svelte-14cfp8z"),E(Te,t().def??"?")},[()=>t().types.map(be=>nr[be]+(s()?Zr[be]:"")).join(),()=>{var be;return(be=t().status.monsterCategories)==null?void 0:be.map(Ke=>ir[Ke]+(s()?$r[Ke]:"")).join()}],_e),S(H,U)};N(I,H=>{t().status.kind==="Monster"&&H(j)})}A(H=>{Ce(J,`duel_card button_style_reset ${t().origin.kind??""} ${H??""} ${(v(f)?"duel_card_selected":"")??""} ${i()??""} duel_card_${t().orientation??""} ${(v(C)?"isDragging":"")??""} ${(s()?"duel_card_wide":"")??""} duel_card_${t().face??""} ${(t().isOnField?"duel_card_is_on_field":"")??""} svelte-14cfp8z`),Vt(J,"draggable",i()==="Draggable"),Vt(J,"title",t().nm),E(x,t().nm)},[()=>{var H;return((H=t().status.monsterCategories)==null?void 0:H.join(" "))||""}],_e),De("dragstart",J,b),De("dragend",J,P),De("click",J,k),De("dblclick",J,y),De("mouseenter",J,()=>w()),De("contextmenu",J,O),S(Q,J)},ve=Q=>{var J=Ne(),Fe=le(J);{var G=x=>{var $=Uu();A(()=>Ce($,`duel_card duel_card_face_down duel_card_face_down_defense ${i()??""}  ${(v(f)?"duel_card_selected":"")??""} svelte-14cfp8z`)),De("click",$,k),De("dblclick",$,y),S(x,$)},B=x=>{var $=Gu();S(x,$)};N(Fe,x=>{t().battlePosition==="Set"?x(G):x(B,!1)},!0)}S(Q,J)};N(re,Q=>{t().face==="FaceUp"||n()||t().controller.duelistType==="Player"&&t().isUnderControl?Q(L):Q(ve,!1)})}S(r,te),lt()}var ju=T('<div class="phase_display svelte-19te8vp"><span class="svelte-19te8vp"> </span> </div>'),Vu=T('<div class="lifepoint_display svelte-19te8vp"><div class="svelte-19te8vp"> </div> <div class="svelte-19te8vp"> </div></div>'),zu=(r,e,t)=>e(v(t)),Wu=T('<div class="svelte-19te8vp"><button class="phase_button svelte-19te8vp"> </button></div>'),Yu=T("<div><!></div>"),Ku=T('<div class="svelte-19te8vp"><!></div>'),Qu=T("<div><!></div>"),Xu=T("<!> <!> <!>",1),Ju=T('<div style="position: absolute;" class="card_animation_receiver svelte-19te8vp"><!></div>'),Iu=T('<div style="position: absolute; top:0rem" class="svelte-19te8vp">｛効果対象｝</div>'),ed=T('<!> <div style="position: absolute; display:flex;justify-content: center;" class="svelte-19te8vp"><!></div>',1),td=T(" <!> 】",1),id=T('<div style="position: absolute; bottom:0rem" class="svelte-19te8vp"> <!></div>'),rd=T("<!> <!>",1),ad=T('<div class="badge svelte-19te8vp"> </div>'),nd=T('<div class="card_animation_receiver svelte-19te8vp"><!></div>'),sd=T("<!> <!> <!> <!>",1),ld=T('<td><div role="listitem"><!></div></td>');function od(r,e){st(e,!1);let t=Be(e,"view",8),i=Be(e,"row",8),a=Be(e,"column",8),n=Be(e,"selectedList",28,()=>[]),s=je(t().getCell(i(),a()));const o=()=>{K(s,t().getCell(i(),a()))};v(s).onUpdate.append(o),t().onDuelUpdate.append(o),t().modalController.onUpdate.append(o);let d,l=je([]),c=()=>{},f,p=je([]);const h=D=>{K(O,[]),n().reset(),d=D.activator,c=D.resolve,K(l,D.dummyActionInfos),K(p,D.chainBlockInfos.flatMap(Z=>Z.selectedEntities).getDistinct()),f=D.selectableEntities,D.entitiesValidator};t().onWaitStart.append(h);const m=()=>{d=void 0,K(l,[]),c=()=>{},f=[],K(p,[])};t().onWaitEnd.append(m);let C=je(!1),y=[];const w=D=>{y=D.filter(Z=>Z.dests.includes(v(s))),K(C,y.length>0),o()},k=()=>{y=[],K(C,!1),o()};t().onDragStart.append(w),t().onDragEnd.append(k);const[b,P]=pf;let O=je([]);const te=D=>{if(d=void 0,v(s)===D.to||v(s).entities.includes(D.entity)){K(O,[...v(O),D]);const Z=D.resolve;K(s,v(s)),setTimeout(()=>{K(O,v(O).filter(Y=>Y!==D)),D.count++,D.count>1&&Z()},600)}};t().onAnimation.append(te);const re=D=>{c({phaseChange:D})},L=()=>v(s).isStackCell&&v(s).entities.flatMap(D=>D.actions).filter(D=>v(l).map(Z=>Z.action.seq).some(Z=>Z===D.seq)).length>0,ve=()=>{if(Ve(s,v(s).field.duel.view.infoBoardState="Log"),v(s).isStackCell){Ve(s,v(s).field.duel.view.infoBoardState="CellInfo"),Ve(s,v(s).field.duel.view.infoBoardCell=v(s)),v(s).field.duel.view.requireUpdate();const D=v(s).entities.flatMap(Y=>Y.actions).map(Y=>Y.seq),Z=v(l).filter(Y=>D.includes(Y.action.seq));if(Z.length){if(!d)return;v(s).field.duel.view.modalController.actionSelector.show({title:"カードを選択。",activator:d,dummyActionInfos:Z,cancelable:!0}).then(R=>{R&&c({actionInfo:R})});return}}v(s).field.duel.view.requireUpdate(),console.info(v(s))},Q=D=>{D.preventDefault(),D.dataTransfer&&(D.dataTransfer.dropEffect="move")},J=D=>{D.preventDefault(),console.info("drop",D,v(C),y),D.dataTransfer&&(D.dataTransfer.dropEffect="move");try{if(v(C)&&y){if(y.length===1){const Z=y[0];c({actionInfo:{...Z,dest:v(s)}})}else if(y.length>1){if(!d)throw new oe("想定されない状態");v(s).field.duel.view.modalController.terminateAll(),v(s).field.duel.view.modalController.actionSelector.show({title:"選択",activator:d,dummyActionInfos:y.map(Z=>({...Z,dest:v(s)})),cancelable:!1}).then(Z=>{c({actionInfo:Z})})}}}finally{t().removeDraggingActions()}},Fe=(...D)=>{if(t().waitMode==="Animation")return"Disabled";if(f&&f.find(Y=>D.find(R=>Y===R)))return"Selectable";if(!v(l)||v(l).length===0||t().waitMode!=="SelectFieldAction"||Object.values(t().modalController.modals).some(Y=>Y.state==="Shown"))return"Disabled";const Z=v(l).filter(Y=>D.includes(Y.action.entity));return Z.length===0?"Disabled":v(s).isStackCell||Z[0].action.entity!==D[0]?"Clickable":Z.some(Y=>Y.dests.length)?"Draggable":"Clickable"};_t();var G=ld(),B=g(G);B.__click=ve;var x=g(B);{var $=D=>{var Z=Ne(),Y=le(Z);{var R=q=>{var X=Ne(),I=le(X);{var j=U=>{var z=ju(),ae=g(z),ne=g(ae),se=_(ae,1,!0);A((M,V)=>{E(ne,M),E(se,V)},[()=>String(v(s).field.duel.clock.turn).padStart(2,"0"),()=>v(s).field.duel.phase.toUpperCase()],_e),S(U,z)},H=U=>{var z=Ne(),ae=le(z);{var ne=M=>{var V=Vu(),ie=g(V),me=g(ie),Te=_(ie,2),be=g(Te);A(()=>{E(me,v(s).field.duel.duelists.Above.lp),E(be,v(s).field.duel.duelists.Below.lp)}),S(M,V)},se=M=>{var V=Ne(),ie=le(V);{var me=Te=>{var be=Ne(),Ke=le(be);{var et=Ge=>{var Xe=Ne(),mt=le(Xe);{var Ct=tt=>{var it=Ne(),ke=le(it);ue(ke,1,()=>t().duel.nextPhaseList,ce,(Me,Pe)=>{var de=Wu(),pe=g(de);pe.__click=[zu,re,Pe];var $e=g(pe);A(Ze=>E($e,Ze),[()=>v(Pe).toUpperCase()],_e),S(Me,de)}),S(tt,it)};N(mt,tt=>{t().duel.isEnded||tt(Ct)})}S(Ge,Xe)};N(Ke,Ge=>{t().waitMode==="SelectFieldAction"&&Ge(et)})}S(Te,be)};N(ie,Te=>{v(s).column===5&&Te(me)},!0)}S(M,V)};N(ae,M=>{v(s).column===3?M(ne):M(se,!1)},!0)}S(U,z)};N(I,U=>{v(s).column===1?U(j):U(H,!1)})}S(q,X)};N(Y,q=>{v(s).row===3&&q(R)})}S(D,Z)},ee=D=>{var Z=Ne(),Y=le(Z);{var R=X=>{var I=Xu();const j=_e(()=>v(O).find(se=>se.to===v(s)));var H=le(I);{var U=se=>{var M=Yu(),V=g(M);Zt(V,{get entity(){return v(j).entity},state:"Disabled",dummyActionInfos:[],cardActionResolve:void 0}),A(()=>Ce(M,`card_animation_receiver ${v(s).cellType??""} svelte-19te8vp`)),ai(1,M,()=>P,()=>({key:v(j).entity.seq})),S(se,M)};N(H,se=>{v(j)&&v(j).index==="Top"&&se(U)})}var z=_(H,2);ue(z,1,()=>v(s).visibleEntities,ce,(se,M)=>{var V=Ne(),ie=le(V);{var me=Te=>{var be=Ku(),Ke=g(be);const et=_e(()=>Fe(v(M))),Ge=_e(()=>v(l).filter(Xe=>Xe.action.entity===v(M)));Zt(Ke,{get entity(){return v(M)},get state(){return v(et)},get dummyActionInfos(){return v(Ge)},cardActionResolve:void 0,get selectedList(){return n()},set selectedList(Xe){n(Xe)},$$legacy:!0}),ai(2,be,()=>b,()=>({key:v(M).seq})),S(Te,be)};N(ie,Te=>{v(O).every(be=>be.entity.seq!==v(M).seq)&&Te(me)})}S(se,V)});var ae=_(z,2);{var ne=se=>{var M=Qu(),V=g(M);Zt(V,{get entity(){return v(j).entity},state:"Disabled",dummyActionInfos:[],cardActionResolve:void 0}),A(()=>Ce(M,`card_animation_receiver ${v(s).cellType??""} svelte-19te8vp`)),ai(1,M,()=>P,()=>({key:v(j).entity.seq})),S(se,M)};N(ae,se=>{v(j)&&v(j).index!=="Top"&&se(ne)})}S(X,I)},q=X=>{var I=sd();const j=_e(()=>v(O).find(ie=>ie.to===v(s)));var H=le(I);{var U=ie=>{var me=Ju(),Te=g(me);Zt(Te,{get entity(){return v(j).entity},state:"Disabled",dummyActionInfos:[],cardActionResolve:void 0}),ai(1,me,()=>P,()=>({key:v(j).entity.seq})),S(ie,me)};N(H,ie=>{v(j)&&v(j).index!=="Top"&&ie(U)})}var z=_(H,2);{var ae=ie=>{var me=rd(),Te=le(me);ue(Te,1,()=>v(s).visibleEntities.map((et,Ge)=>({index:Ge,entity:et})).toReversed(),ce,(et,Ge)=>{var Xe=Ne(),mt=le(Xe);{var Ct=tt=>{var it=ed(),ke=le(it);{var Me=Ze=>{var ot=Iu();S(Ze,ot)};N(ke,Ze=>{v(p).includes(v(Ge).entity)&&Ze(Me)})}var Pe=_(ke,2),de=g(Pe);const pe=_e(()=>!v(s).isStackCell&&v(Ge).index===0?Fe(...v(s).visibleEntities):void 0),$e=_e(()=>v(Ge).index===0?v(l).filter(Ze=>v(s).visibleEntities.includes(Ze.action.entity)):void 0);Zt(de,{get entity(){return v(Ge).entity},get state(){return v(pe)},get dummyActionInfos(){return v($e)},cardActionResolve:void 0,get selectedList(){return n()},set selectedList(Ze){n(Ze)},$$legacy:!0}),ai(2,Pe,()=>b,()=>({key:v(Ge).entity.seq})),S(tt,it)};N(mt,tt=>{v(O).every(it=>it.entity.seq!==v(Ge).entity.seq)&&tt(Ct)})}S(et,Xe)});var be=_(Te,2);{var Ke=et=>{var Ge=id(),Xe=g(Ge),mt=_(Xe);ue(mt,1,()=>Object.keys(v(s).visibleEntities[0].status.maxCounterQty),ce,(Ct,tt)=>{var it=td(),ke=le(it),Me=_(ke);{var Pe=de=>{var pe=ri();A(()=>E(pe,`/${v(s).visibleEntities[0].status.maxCounterQty[v(tt)]??""}`)),S(de,pe)};N(Me,de=>{(v(s).visibleEntities[0].status.maxCounterQty[v(tt)]??!1)&&de(Pe)})}A(de=>E(ke,`【
              ${ec[v(tt)]??""}${de??""} `),[()=>v(s).visibleEntities[0].counterHolder.getQty(v(tt))],_e),S(Ct,it)}),A(()=>E(Xe,`【${v(s).visibleEntities[0].battlePositionName??""}】 `)),S(et,Ge)};N(be,et=>{v(s).visibleEntities[0].battlePosition&&et(Ke)})}S(ie,me)};N(z,ie=>{v(s).visibleEntities.length>0&&ie(ae)})}var ne=_(z,2);{var se=ie=>{var me=ad(),Te=g(me);A(()=>E(Te,v(s).visibleEntities.length)),S(ie,me)};N(ne,ie=>{v(s).isStackCell&&ie(se)})}var M=_(ne,2);{var V=ie=>{var me=nd(),Te=g(me);Zt(Te,{get entity(){return v(j).entity},state:"Disabled",dummyActionInfos:[],cardActionResolve:void 0}),ai(1,me,()=>P,()=>({key:v(j).entity.seq})),S(ie,me)};N(M,ie=>{v(j)&&v(j).index==="Top"&&ie(V)})}S(X,I)};N(Y,X=>{v(s).cellType==="Hand"?X(R):X(q,!1)},!0)}S(D,Z)};N(x,D=>{v(s).isDisabledCell?D($):D(ee,!1)})}A(D=>{Ce(G,`${`duel_field_cell duel_field_cell_${v(s).cellType} ${v(s).linkArrowSources.length===0?"":"duel_field_cell_linked"}`??""} svelte-19te8vp`),Vt(G,"colspan",v(s).cellType==="Hand"?7:1),Ce(B,`${D??""} svelte-19te8vp`)},[()=>`duel_card_wrapper ${v(s).cellType} ${v(C)?"can_accept_drop":""} ${L()?"can_action":""} `],_e),De("dragover",B,D=>Q(D)),De("drop",B,D=>J(D)),S(r,G),lt()}Li(["click"]);var cd=T('<div class="title svelte-1sjjr5s"> </div>'),ud=T('<div class="title svelte-1sjjr5s"> </div>'),dd=T('<div class="duel_log_record svelte-1sjjr5s"> </div>'),fd=T('<div><div style=" white-space: nowrap;text-align: center;"> </div> <!></div>'),vd=T("<div><!> <!></div>"),pd=T("<div><!> <!></div>"),hd=T('<div class="duel_log svelte-1sjjr5s"><div class="duel_log_header svelte-1sjjr5s"></div> <div class="duel_log_body svelte-1sjjr5s"></div> <div class="duel_log_footer svelte-1sjjr5s"></div></div>');function gd(r,e){st(e,!1);let t=je(void 0),i=Be(e,"log",8),a,n=je([]);const s=()=>{const c=((a==null?void 0:a.seq)??-1)+1;i().records.slice(c).forEach(f=>{if(!a){K(n,[[[[f]]]]),a=f;return}if(!v(n)[f.clock.turn]){Ve(n,v(n)[f.clock.turn]=[[[f]]]),a=f;return}if(!v(n)[f.clock.turn][f.clock.phaseSeq]){Ve(n,v(n)[f.clock.turn][f.clock.phaseSeq]=[[f]]),a=f;return}if(a.clock.chainSeq===f.clock.chainSeq&&a.clock.chainBlockSeq===f.clock.chainBlockSeq&&a.duelist===f.duelist){v(n)[f.clock.turn][f.clock.phaseSeq].slice(-1)[0].push(f),a=f;return}v(n)[f.clock.turn][f.clock.phaseSeq].push([f]),a=f}),K(n,v(n)),Hl().then(()=>v(t)&&v(t).scroll(0,v(t).clientHeight*990))};i().onUpdate.append(s),i().duel.view.onDuelUpdate.append(s),_t();var o=Ne(),d=le(o);{var l=c=>{var f=hd(),p=_(g(f),2);ue(p,5,()=>v(n),ce,(h,m)=>{var C=pd(),y=g(C);{var w=b=>{var P=cd(),O=g(P);A(()=>E(O,`ターン：${v(m)[0][0][0].clock.turn??""}`)),S(b,P)};N(y,b=>{v(m)[0][0][0].clock.turn>0&&b(w)})}var k=_(y,2);ue(k,1,()=>v(m),ce,(b,P)=>{var O=vd(),te=g(O);{var re=ve=>{var Q=ud(),J=g(Q);A(()=>E(J,v(P)[0][0].clock.period.name)),S(ve,Q)};N(te,ve=>{v(P)[0][0].clock.turn>0&&ve(re)})}var L=_(te,2);ue(L,1,()=>v(P),ce,(ve,Q)=>{var J=fd(),Fe=g(J),G=g(Fe),B=_(Fe,2);ue(B,1,()=>v(Q),ce,(x,$)=>{var ee=dd(),D=g(ee);A(()=>E(D,v($).text)),S(x,ee)}),A(()=>{var x,$,ee;Ce(J,`duel_log_block_duelist duel_log_block_duelist_${((x=v(Q)[0].duelist)==null?void 0:x.seat)??"system"} svelte-1sjjr5s`),Ce(Fe,`duelist ${(($=v(Q)[0].duelist)==null?void 0:$.seat)??""} svelte-1sjjr5s`),E(G,((ee=v(Q)[0].duelist)==null?void 0:ee.profile.name)||"SYSTEM")}),S(ve,J)}),A(()=>Ce(O,`duel_log_block_phase duel_log_block_phase_${v(P)[0][0].clock.period.key??""} svelte-1sjjr5s`)),S(b,O)}),A(()=>Ce(C,`duel_log_block_turn duel_log_block_turn_${v(m)[0][0][0].clock.turn??""} svelte-1sjjr5s`)),S(h,C)}),vo(p,h=>K(t,h),()=>v(t)),S(c,f)};N(d,c=>{i().duel.view.infoBoardState==="Log"&&c(l)})}S(r,o),lt()}var yd=T('<div><div class="duelist_name svelte-1u7codf"> </div> <div> </div></div>');function kn(r,e){st(e,!1);let t=Be(e,"duelist",12),i=je(0),a=je();const n=async()=>{const p=t().lp-v(i);if(!v(a)||Math.abs(p)<10){K(i,t().lp),v(a)&&(v(a)(),K(a,void 0));return}K(i,v(i)+Math.floor(Math.random()*p)),await Sc(100),n()},s=()=>{t(t()),!v(a)&&t().lp!==v(i)&&new Promise(p=>{K(a,p),Math.abs(t().lp-v(i)),n()})};t().duel.log.onUpdate.append(s),n(),_t();var o=yd(),d=g(o),l=g(d),c=_(d,2),f=g(c);A(()=>{Ce(o,`duelist ${t().seat??""} svelte-1u7codf`),E(l,t().profile.name),Ce(c,`duelist_lp ${(v(a)?"vibration":"")??""} svelte-1u7codf`),E(f,v(i))}),S(r,o),lt()}const md=(r,e,t)=>{e.resolve(v(t))};var _d=T("<div><!></div>"),Sd=T("<div></div>"),Cd=(r,e)=>e.resolve(void 0),kd=T('<button class="svelte-ynkuoo">Cancel</button>'),wd=T('<div class="modal_window svelte-ynkuoo"><div> </div> <!> <div><button class="svelte-ynkuoo">OK</button> <!></div></div>');function Td(r,e){st(e,!0);let t=Sl(Qt([])),i=e.args.chainBlockInfos.flatMap(o=>o.selectedEntities).getDistinct();var a=Ne(),n=le(a);{var s=o=>{var d=wd(),l=g(d),c=g(l),f=_(l,2);ue(f,17,()=>e.args.entities.map(y=>y.controller.seat).getDistinct(),ce,(y,w)=>{var k=Sd();ue(k,21,()=>e.args.entities.filter(b=>b.controller.seat===v(w)).toSorted(ks),ce,(b,P)=>{var O=_d(),te=g(O);Zt(te,{get entity(){return v(P)},isVisibleForcibly:!0,state:"Selectable",entitySelectResolve:re=>e.resolve(re),get qty(){return e.args.qty},cardActionResolve:void 0,get selectedList(){return v(t)},set selectedList(re){K(t,Qt(re))}}),A(re=>Ce(O,`entities_list_item ${re??""} svelte-ynkuoo`),[()=>i.includes(v(P))?"effect_target":""]),S(b,O)}),A(()=>Ce(k,`entities_list ${v(w)??""} svelte-ynkuoo`)),S(y,k)});var p=_(f,2),h=g(p);h.__click=[md,e,t];var m=_(h,2);{var C=y=>{var w=kd();w.__click=[Cd,e],S(y,w)};N(m,y=>{e.args.cancelable&&y(C)})}A(y=>{E(c,e.args.title),h.disabled=y},[()=>!e.args.validator(v(t))]),S(o,d)};N(n,o=>{o(s)})}S(r,a),lt()}Li(["click"]);var bd=T('<div class="duel_card_wrapper svelte-1k3dhp1"><!> <div> </div></div>'),Ed=(r,e)=>e()(),Dd=T('<div><button class="cancel_button svelte-1k3dhp1">Cancel</button></div>'),Ad=T('<div class="modal_window svelte-1k3dhp1"><div> </div> <div class="flex svelte-1k3dhp1" style="display: flex;"></div> <!></div>');function xd(r,e){st(e,!1);let t=Be(e,"view",8),i=Be(e,"args",8),a=Be(e,"resolve",8),n=po(!1);const s=()=>n.set(!0),o=()=>n.set(!1);t().onDragStart.append(s),t().onDragEnd.append(o),_t();var d=Ne(),l=le(d);{var c=f=>{var p=Ad(),h=g(p),m=g(h),C=_(h,2);ue(C,5,()=>i().dummyActionInfos,ce,(k,b)=>{var P=bd(),O=g(P);const te=_e(()=>v(b).dests.length?"Draggable":"Clickable"),re=_e(()=>i().dragAndDropOnly?[]:[v(b)]);Zt(O,{get entity(){return v(b).action.entity},isVisibleForcibly:!0,get state(){return v(te)},get dummyActionInfos(){return v(re)},get cardActionResolve(){return a()}});var L=_(O,2),ve=g(L);A(()=>E(ve,`«${v(b).action.title??""}»`)),S(k,P)});var y=_(C,2);{var w=k=>{var b=Dd(),P=g(b);P.__click=[Ed,a],S(k,b)};N(y,k=>{i().cancelable&&k(w)})}A(()=>E(m,i().title)),S(f,p)};N(l,f=>{f(c)})}S(r,d),lt()}Li(["click"]);var Md=(r,e,t)=>e()(t()),Pd=T('<li><button class="svelte-1w70c2f"> </button></li>'),Bd=(r,e)=>e()(void 0),Fd=T('<button class="svelte-1w70c2f">Cancel</button>'),Od=T('<div class="modal_window svelte-1w70c2f"><div class="svelte-1w70c2f"> </div> <ui class="text_list svelte-1w70c2f"></ui> <!></div>');function Ld(r,e){st(e,!1);let t=Be(e,"arg",8),i=Be(e,"resolve",8);_t();var a=Ne(),n=le(a);{var s=o=>{var d=Od(),l=g(d),c=g(l),f=_(l,2);ue(f,5,()=>t().choises,ce,(m,C)=>{let y=()=>v(C).seq,w=()=>v(C).text;var k=Pd(),b=g(k);b.__click=[Md,i,y];var P=g(b);A(()=>{Ce(k,`text_item ${y()??""} svelte-1w70c2f`),E(P,w())}),S(m,k)});var p=_(f,2);{var h=m=>{var C=Fd();C.__click=[Bd,i],S(m,C)};N(p,m=>{t().cancelable&&m(h)})}A(()=>E(c,t().title)),S(o,d)};N(n,o=>{o(s)})}S(r,a),lt()}Li(["click"]);const Nd=(r,e)=>{e().modals.forEach(t=>t.cancel())};var qd=T('<button class="overlay svelte-5wiqd8">☆</button> <!> <!> <!>',1),Rd=T('<div class="base svelte-5wiqd8"><!></div>');function Hd(r,e){var o,d;st(e,!1);let t=Be(e,"modalController",12);const i=()=>{t(t())};(d=(o=t())==null?void 0:o.onUpdate)==null||d.append(i),_t();var a=Rd(),n=g(a);{var s=l=>{var c=qd(),f=le(c);f.__click=[Nd,t];var p=_(f,2);{var h=k=>{Td(k,{get args(){return t().entitySelector.args},get resolve(){return t().entitySelector.resolve}})};N(p,k=>{t().entitySelector.state==="Shown"&&k(h)})}var m=_(p,2);{var C=k=>{xd(k,{get view(){return t().view},get args(){return t().actionSelector.args},get resolve(){return t().actionSelector.resolve}})};N(m,k=>{t().actionSelector.state==="Shown"&&k(C)})}var y=_(m,2);{var w=k=>{Ld(k,{get arg(){return t().textSelector.args},get resolve(){return t().textSelector.resolve}})};N(y,k=>{t().textSelector.state==="Shown"&&k(w)})}S(l,c)};N(n,l=>{t().modals.some(c=>c.state==="Shown")&&l(s)})}S(r,a),lt()}Li(["click"]);const $d=(r,e)=>(e(e()==="Normal"?"Debug":"Normal"),!0);var Zd=T('<div class="duel_card_info_row svelte-1qknre5"><div class="svelte-1qknre5"><pre class="description svelte-1qknre5"> </pre></div></div> <div class="duel_card_info_row svelte-1qknre5" style=" justify-content: space-between;"><div class="svelte-1qknre5"> </div> <div class="svelte-1qknre5"> </div></div>',1),Ud=T('<div></div> <div class="svelte-1qknre5"> </div>',1),Gd=T("<div> </div>"),jd=T("<div> </div>"),Vd=T('<div class="duel_card_info_row svelte-1qknre5"><!> <!></div> <div class="duel_card_info_row svelte-1qknre5"></div>',1),zd=T('<div class="duel_card_row svelte-1qknre5"><div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"> </div></div>'),Wd=T('<div class="duel_card_row svelte-1qknre5"><div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"> </div></div>'),Yd=T("<!> <!>",1),Kd=T('<div class="duel_card_info_row svelte-1qknre5"><div class="svelte-1qknre5"><pre class="description svelte-1qknre5"> </pre></div></div>'),Qd=T('<div class="svelte-1qknre5"> </div>'),Xd=T('<div class="svelte-1qknre5"> </div>'),Jd=T('<div class="svelte-1qknre5"> </div>'),Id=T('<div class="svelte-1qknre5"> </div>'),ef=T('<div class="svelte-1qknre5"> </div>'),tf=T('<div class="svelte-1qknre5"> </div>'),rf=T('<div class="svelte-1qknre5"> </div>'),af=T('<div class="svelte-1qknre5"> </div>'),nf=T('<div class="duel_card_info_row svelte-1qknre5"><div class="svelte-1qknre5"><div class="svelte-1qknre5"></div> <!> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"></div> <!> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"></div> <!> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"></div> <!> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"></div> <!> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"></div> <!> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"></div> <!> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"></div> <!> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"> </div> <div class="svelte-1qknre5"> </div> <div class="svelte-1qknre5"> </div> <div class="svelte-1qknre5"></div></div></div>'),sf=T('<div class="svelte-1qknre5">※テスト用カードです</div>'),lf=T('<div class="duel_card_info_links svelte-1qknre5"><a target="_blank" rel="noopener noreferrer" title="遊戯王カードWiki" class="svelte-1qknre5">⇒遊戯王カードWiki</a> <a target="_blank" rel="noopener noreferrer" title="コナミカードデータベース" class="svelte-1qknre5"> </a></div>'),of=T('<div role="contentinfo"><div class="duel_card_info_header svelte-1qknre5"><div class="duel_card_info_row svelte-1qknre5"><div class="svelte-1qknre5"> </div></div> <div class="duel_card_info_row svelte-1qknre5" style="position:sticky; top:0;"><div class="svelte-1qknre5"> </div> <div class="svelte-1qknre5"> </div></div> <!></div> <div class="duel_card_info_body svelte-1qknre5"><!></div> <div class="duel_card_info_footer svelte-1qknre5"><!></div></div>');function cf(r,e){st(e,!1);let t=Be(e,"entity",8,void 0);const i=()=>t()?pt[t().origin.name]:void 0,a=()=>{var l;return t()&&(t().origin.cardId??!1)?`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=2&cid=${t().origin.cardId}`:`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=1&sess=1&rp=10&mode=&sort=1&keyword=${(l=i())==null?void 0:l.name}&stype=1&ctype=&othercon=2&starfr=&starto=&pscalefr=&pscaleto=&linkmarkerfr=&linkmarkerto=&link_m=2&atkfr=&atkto=&deffr=&defto=&releaseDStart=1&releaseMStart=1&releaseYStart=1999&releaseDEnd=&releaseMEnd=&releaseYEnd=`};let n=Be(e,"mode",12,"Normal");_t();var s=Ne(),o=le(s);{var d=l=>{var c=of();c.__contextmenu=[$d,n];var f=g(c),p=g(f),h=g(p),m=g(h),C=_(p,2),y=g(C),w=g(y),k=_(y,2),b=g(k),P=_(C,2);{var O=B=>{var x=Yd(),$=le(x);{var ee=R=>{var q=Zd(),X=le(q),I=g(X),j=g(I),H=g(j),U=_(X,2),z=g(U),ae=g(z),ne=_(z,2),se=g(ne);A(()=>{E(H,pt[t().origin.name].pendulumDescription),E(ae,`◀ ${t().psL??""}`),E(se,`${t().psR??""} ▶`)}),S(R,q)};N($,R=>{var q;(q=t().status.monsterCategories)!=null&&q.includes("Pendulum")&&R(ee)})}var D=_($,2);{var Z=R=>{var q=Vd(),X=le(q),I=g(X);ue(I,1,()=>t().attr,ce,(U,z)=>{var ae=Ud(),ne=le(ae),se=_(ne,2),M=g(se);A(()=>{Ce(ne,`monster_attr ${v(z)??""} svelte-1qknre5`),E(M,`${Oa[v(z)]??""}属性`)}),S(U,ae)});var j=_(I,2);ue(j,1,()=>t().types,ce,(U,z)=>{var ae=Gd(),ne=g(ae);A(()=>{Ce(ae,`monster_cat ${v(z)??""} svelte-1qknre5`),E(ne,`${nr[v(z)]??""}${Zr[v(z)]??""}族`)}),S(U,ae)});var H=_(X,2);ue(H,5,()=>t().status.monsterCategories??[],ce,(U,z)=>{var ae=jd(),ne=g(ae);A(()=>{Ce(ae,`monster_cat ${v(z)??""} svelte-1qknre5`),E(ne,`${ir[v(z)]??""}${$r[v(z)]??""}`)}),S(U,ae)}),S(R,q)},Y=R=>{var q=Ne(),X=le(q);{var I=H=>{var U=zd(),z=_(g(U),2),ae=g(z);A(()=>E(ae,`${rr[t().status.spellCategory]??""}魔法`)),S(H,U)},j=H=>{var U=Ne(),z=le(U);{var ae=ne=>{var se=Wd(),M=_(g(se),2),V=g(M);A(()=>E(V,`${ar[t().status.trapCategory]??""}罠`)),S(ne,se)};N(z,ne=>{t().status.kind==="Trap"&&t().status.trapCategory&&ne(ae)},!0)}S(H,U)};N(X,H=>{t().status.kind==="Spell"&&t().status.spellCategory?H(I):H(j,!1)},!0)}S(R,q)};N(D,R=>{t().status.kind==="Monster"?R(Z):R(Y,!1)})}S(B,x)};N(P,B=>{n()==="Normal"&&B(O)})}var te=_(f,2),re=g(te);{var L=B=>{var x=Kd(),$=g(x),ee=g($),D=g(ee);A(Z=>E(D,Z),[()=>{var Z;return(Z=i())==null?void 0:Z.description}],_e),S(B,x)},ve=B=>{var x=nf(),$=g(x),ee=g($);ee.textContent='"info" :{';var D=_(ee,2);ue(D,1,()=>Object.entries(t().info),ce,(de,pe)=>{let $e=()=>v(pe)[0],Ze=()=>v(pe)[1];var ot=Qd(),Ri=g(ot);A(F=>E(Ri,`"${$e()??""}" :${F??""},`),[()=>{var F;return(F=Ze())==null?void 0:F.toString()}],_e),S(de,ot)});var Z=_(D,2);Z.textContent="},";var Y=_(Z,2);Y.textContent='"status" :{';var R=_(Y,2);ue(R,1,()=>Object.entries(t().status),ce,(de,pe)=>{let $e=()=>v(pe)[0],Ze=()=>v(pe)[1];var ot=Xd(),Ri=g(ot);A(F=>E(Ri,`"${$e()??""}" :${F??""},`),[()=>{var F;return(F=Ze())==null?void 0:F.toString()}],_e),S(de,ot)});var q=_(R,2);q.textContent="},";var X=_(q,2);X.textContent='"actions" :[';var I=_(X,2);ue(I,1,()=>t().actions,ce,(de,pe)=>{var $e=Jd(),Ze=g($e);A(()=>E(Ze,`"${v(pe).playType??""} ${v(pe).title??""}",`)),S(de,$e)});var j=_(I,2);j.textContent="],";var H=_(j,2);H.textContent='"substituteEffects" :[';var U=_(H,2);ue(U,1,()=>t().substituteEffects,ce,(de,pe)=>{var $e=Id(),Ze=g($e);A(()=>E(Ze,`"${v(pe).title??""}",`)),S(de,$e)});var z=_(U,2);z.textContent="],";var ae=_(z,2);ae.textContent='"continuousEffects" :[';var ne=_(ae,2);ue(ne,1,()=>t().continuousEffects,ce,(de,pe)=>{var $e=ef(),Ze=g($e);A(()=>E(Ze,`"${v(pe).isStarted??""}",`)),S(de,$e)});var se=_(ne,2);se.textContent="],";var M=_(se,2);M.textContent='"procFilters" :[';var V=_(M,2);ue(V,1,()=>t().procFilterBundle.operators,ce,(de,pe)=>{var $e=tf(),Ze=g($e);A(ot=>E(Ze,`"${ot??""} ${v(pe).title??""}",`),[()=>v(pe).isSpawnedBy.toString()],_e),S(de,$e)});var ie=_(V,2);ie.textContent="],";var me=_(ie,2);me.textContent='"numericStateOperators" :[';var Te=_(me,2);ue(Te,1,()=>t().numericOprsBundle.operators,ce,(de,pe)=>{var $e=rf(),Ze=g($e);A(ot=>E(Ze,`"${ot??""} ${v(pe).title??""}",`),[()=>v(pe).isSpawnedBy.toString()],_e),S(de,$e)});var be=_(Te,2);be.textContent="],";var Ke=_(be,2);Ke.textContent='"stateOperators" :[';var et=_(Ke,2);ue(et,1,()=>t().statusOperatorBundle.operators,ce,(de,pe)=>{var $e=af(),Ze=g($e);A(ot=>E(Ze,`"${ot??""} ${v(pe).title??""}",`),[()=>v(pe).isSpawnedBy.toString()],_e),S(de,$e)});var Ge=_(et,2);Ge.textContent="],";var Xe=_(Ge,2);Xe.textContent='"lastMoveLogRecord" :{';var mt=_(Xe,2),Ct=g(mt),tt=_(mt,2),it=g(tt),ke=_(tt,2),Me=g(ke),Pe=_(ke,2);Pe.textContent="},",A((de,pe)=>{E(Ct,`"movedBy":"${de??""}",`),E(it,`"movedAs":"${pe??""}",`),E(Me,`"movedAt":"${t().moveLog.latestRecord.movedAt.totalProcSeq??""}",`)},[()=>{var de;return(de=t().moveLog.latestRecord.movedBy)==null?void 0:de.toString()},()=>t().moveLog.latestRecord.movedAs.join(" ")],_e),S(B,x)};N(re,B=>{n()==="Normal"?B(L):B(ve,!1)})}var Q=_(te,2),J=g(Q);{var Fe=B=>{var x=sf();S(B,x)},G=B=>{var x=lf(),$=g(x),ee=_($,2),D=g(ee);A(Z=>{var Y;Vt($,"href",`https://yugioh-wiki.net/index.php?${t().origin.wikiEncodedName}`),Vt(ee,"href",Z),E(D,`⇒${((Y=t())!=null&&Y.origin.cardId?"公式カードページ":"公式で検索")??""}`)},[a],_e),S(B,x)};N(J,B=>{var x;(x=t())!=null&&x.origin.isForTest?B(Fe):B(G,!1)})}A((B,x,$)=>{Ce(c,`duel_card duel_card_info ${t().origin.kind??""} ${B??""} svelte-1qknre5`),E(m,t().nm),E(w,x),E(b,$)},[()=>{var B;return(B=t().origin.monsterCategories)==null?void 0:B.join(" ")},()=>"★".repeat(t().lvl||0),()=>"☆".repeat(t().rank||0)],_e),S(l,c)};N(o,l=>{t()&&l(d)})}S(r,s),lt()}Li(["contextmenu"]);var uf=T('<div class="duel_field_cell_info_item svelte-1xj7qf1"><!></div>'),df=T('<div class="duel_field_cell_info_box svelte-1xj7qf1"><div class="duel_field_cell_info_label svelte-1xj7qf1"> </div> <!></div>'),ff=T('<div class="duel_field_cell_info svelte-1xj7qf1"><div class="duel_field_cell_info_header item_btn svelte-1xj7qf1"><div class="svelte-1xj7qf1"> </div> <div class="svelte-1xj7qf1"> </div></div> <div class="duel_field_cell_info_body svelte-1xj7qf1"></div></div>');function vf(r,e){st(e,!1);let t=Be(e,"cell",12);const i=()=>{t(t())},a=d=>t().cardEntities.filter(l=>l.face===d);t().field.duel.view.onDuelUpdate.append(i),_t();var n=Ne(),s=le(n);{var o=d=>{var l=ff(),c=g(l),f=g(c),p=g(f),h=_(f,2),m=g(h),C=_(c,2);ue(C,4,()=>["FaceUp","FaceDown"],ce,(y,w)=>{var k=Ne(),b=le(k);{var P=O=>{var te=df(),re=g(te),L=g(re),ve=_(re,2);ue(ve,1,()=>a(w).toSorted(ks),ce,(Q,J)=>{var Fe=uf(),G=g(Fe);const B=_e(()=>t().owner===t().field.duel.duelists.Below);Zt(G,{get entity(){return v(J)},get isVisibleForcibly(){return v(B)},isWideMode:!0,cardActionResolve:void 0}),S(Q,Fe)}),A(()=>E(L,w==="FaceUp"?"表向き":"裏向き")),S(O,te)};N(b,O=>{a(w).length&&O(P)})}S(y,k)}),A(()=>{var y;E(p,(y=t().owner)==null?void 0:y.profile.name),E(m,t().cellType)}),S(d,l)};N(s,d=>{t().field.duel.view.infoBoardState==="CellInfo"&&d(o)})}S(r,n),lt()}const pf=Fu({duration:400});var hf=T('<div class="duel_field_header_message svelte-accyye"> </div> <div class="duel_field_header_buttons svelte-accyye"><button class="svelte-accyye">サレンダー</button></div>',1),gf=T("<tr></tr>"),yf=T('<table class="duel_field svelte-accyye"><tbody class="svelte-accyye"></tbody></table>'),mf=T('<button class="svelte-accyye">OK</button>'),_f=T('<div class="flex duel_desk svelte-accyye"><div class="duel_desk_left v_flex svelte-accyye"><!> <!> <!></div> <div class=" duel_desk_center v_flex svelte-accyye"><div class="duel_field_header svelte-accyye"><!></div> <div class="svelte-accyye"><!></div> <div class="duel_field_footer svelte-accyye"><!></div></div> <div class=" duel_desk_right svelte-accyye" style="text-align: left;"><!> <!></div></div> <div style="position:absolute;left:0;bottom:0"> </div> <!>',1);function Sf(r,e){st(e,!1);let t=Be(e,"duel",12),i=()=>{},a=je(()=>!0),n=je([]);const s=R=>{i=R.resolve,K(a,R.entitiesValidator),K(n,R.selectableEntities),R.duelEntitiesSelectorArg&&t().view.modalController.entitySelector.show(R.duelEntitiesSelectorArg).then(q=>{i({selectedEntities:q})})};t().view.onWaitStart.append(s);const o=()=>{i=()=>{},K(a,()=>!0),K(n,[])};t().view.onWaitEnd.append(o);let d=je(void 0),l=je("Normal");const c=({card:R,mode:q})=>{K(d,R),K(l,q)};t().view.onShowCardEntity.append(c);let f=Be(e,"selectedList",28,()=>[]);const p=()=>{t(t())};t().view.onDuelUpdate.append(p),t().log.onUpdate.append(p);const h=()=>{v(a)(f())&&i({selectedEntities:f()})},m=()=>{i({surrender:!0})};t().main(),_t();var C=_f(),y=le(C),w=g(y),k=g(w);kn(k,{get duelist(){return t().duelists.Above}});var b=_(k,2);cf(b,{get entity(){return v(d)},get mode(){return v(l)}});var P=_(b,2);kn(P,{get duelist(){return t().duelists.Below}});var O=_(w,2),te=g(O),re=g(te);{var L=R=>{var q=hf(),X=le(q),I=g(X),j=_(X,2),H=g(j);A(()=>E(I,`[TURN:${t().clock.turn}][PHASE:${t().phase}] ${t().view.message}`)),De("click",H,m),S(R,q)};N(re,R=>{t().isEnded||R(L)})}var ve=_(te,2),Q=g(ve);{var J=R=>{var q=yf(),X=g(q);ue(X,5,()=>t().field.cells,ce,(I,j,H)=>{var U=gf();Ce(U,`${`duel_desk_row_${H}`??""} svelte-accyye`),ue(U,5,()=>v(j),ce,(z,ae,ne)=>{od(z,{get view(){return t().view},row:H,column:ne,get selectedList(){return f()},set selectedList(se){f(se)},$$legacy:!0})}),S(I,U)}),S(R,q)};N(Q,R=>{t().clock.turn>0&&R(J)})}var Fe=_(ve,2),G=g(Fe);{var B=R=>{var q=mf();A(X=>q.disabled=X,[()=>!v(a)(f())],_e),De("click",q,h),S(R,q)};N(G,R=>{v(n)&&v(n).length>0&&R(B)})}var x=_(O,2),$=g(x);gd($,{get log(){return t().log}});var ee=_($,2);vf(ee,{get cell(){return t().view.infoBoardCell}});var D=_(y,2),Z=g(D),Y=_(D,2);Hd(Y,{get modalController(){return t().view.modalController}}),A(R=>E(Z,R),[()=>t().clock.toString()],_e),S(r,C),lt()}var Cf=T("<div></div>"),kf=T('<span> </span> / <span style="display: inline-block;width:2rem;text-align: right;"> </span>',1),wf=T('<li class="deck_editor_item svelte-vivzk2"><div role="listitem"><div class="svelte-vivzk2"><div class="svelte-vivzk2"> </div> <div style="display:flex" class="svelte-vivzk2"><div class="svelte-vivzk2"><!> <!> <!> <!> <!> <!> <!></div> <div style="flex-grow: 1; width:0.1rem" class="svelte-vivzk2"></div> <div class="svelte-vivzk2"><!></div></div></div></div> <button class="button_style_reset svelte-vivzk2" title="※shiftキー同時押しで一括投入">+</button> <button class="button_style_reset svelte-vivzk2" title="※shiftキー同時押しで一括外し">-</button></li>'),Tf=T('<div class="deck_editor_card_kind svelte-vivzk2"><span class="svelte-vivzk2"> </span> <ul class="svelte-vivzk2"></ul></div>'),bf=T('<div class="deck_editor_deck_type svelte-vivzk2"><span class="svelte-vivzk2"> </span> <!></div>'),Ef=T('<div class="deck_editor_card_list svelte-vivzk2"></div>');function wn(r,e){st(e,!1);let t=Be(e,"allCardInfos",8),i=Be(e,"deckCardInfos",12),a=Be(e,"mode",8),n=Be(e,"onAttention",8);const s={Deck:["Monster","Spell","Trap"],ExtraDeck:["Monster"]},o=(f,p)=>(a()==="List"?t():i()).filter(h=>{var m,C;return Ca.has(h.name)||((m=h.monsterCategories)==null?void 0:m.includes("Normal"))&&!((C=h.monsterCategories)!=null&&C.includes("Pendulum"))}).filter(h=>!p||h.kind===p).filter(h=>{var m,C;return!f||f==="Deck"&&!((m=h==null?void 0:h.monsterCategories)!=null&&m.union(Ai).length)||f==="ExtraDeck"&&((C=h==null?void 0:h.monsterCategories)==null?void 0:C.union(Ai).length)}),d=(f,p)=>{try{if(f.ctrlKey){i().push(p);return}const h=i().filter(C=>C.name===p.name).length;if(h>2)return;const m=f.shiftKey?3-h:1;if(m<1)return;i().push(...Array(m).fill(p))}finally{i().sort(ji),i(i())}},l=(f,p)=>{let h=0;i(i().filter(m=>m.name!==p.name?!0:(h++,!f.shiftKey&&h>1))),i().sort(ji)};_t();var c=Ef();ue(c,5,()=>mo,ce,(f,p)=>{var h=bf(),m=g(h),C=g(m),y=_(m,2);ue(y,1,()=>s[v(p)],ce,(w,k)=>{var b=Tf(),P=g(b),O=g(P),te=_(P,2);ue(te,5,()=>o(v(p),v(k)).toSorted(ji),ce,(re,L)=>{var ve=wf(),Q=g(ve),J=g(Q),Fe=g(J),G=g(Fe),B=_(Fe,2),x=g(B),$=g(x);{var ee=M=>{var V=ri();A(()=>E(V,`★${v(L).level??""}`)),S(M,V)};N($,M=>{v(L).level&&M(ee)})}var D=_($,2);{var Z=M=>{var V=ri();A(()=>E(V,`☆${v(L).rank??""}`)),S(M,V)};N(D,M=>{v(L).rank&&M(Z)})}var Y=_(D,2);ue(Y,1,()=>v(L).attributes??[],ce,(M,V)=>{var ie=Cf();A(()=>Ce(ie,`monster_attr ${v(V)??""} svelte-vivzk2`)),S(M,ie)});var R=_(Y,2);ue(R,1,()=>v(L).types??[],ce,(M,V)=>{var ie=ri();A(()=>E(ie,nr[v(V)])),S(M,ie)});var q=_(R,2);ue(q,1,()=>v(L).monsterCategories??[],ce,(M,V)=>{var ie=ri();A(()=>E(ie,ir[v(V)])),S(M,ie)});var X=_(q,2);{var I=M=>{var V=ri();A(()=>E(V,`${rr[v(L).spellCategory]??""}魔法`)),S(M,V)};N(X,M=>{v(L).spellCategory!==void 0&&M(I)})}var j=_(X,2);{var H=M=>{var V=ri();A(()=>E(V,`${ar[v(L).trapCategory]??""}罠`)),S(M,V)};N(j,M=>{v(L).trapCategory!==void 0&&M(H)})}var U=_(x,4),z=g(U);{var ae=M=>{var V=kf(),ie=le(V),me=g(ie),Te=_(ie,2),be=g(Te);A(()=>{E(me,v(L).attack??"?"),E(be,v(L).defense??"?")}),S(M,V)};N(z,M=>{v(L).kind==="Monster"&&M(ae)})}var ne=_(Q,2),se=_(ne,2);A(M=>{Ce(Q,`${M??""} svelte-vivzk2`),E(G,v(L).name)},[()=>{var M,V;return`deck_editor_card duel_card ${v(L).kind} ${(V=(M=v(L))==null?void 0:M.monsterCategories)==null?void 0:V.join(" ")} ${Ca.has(v(L).name)?"is_implemented":"is_not_implemented"}`}],_e),De("mouseenter",Q,()=>n()(v(L))),De("click",ne,M=>d(M,v(L))),De("click",se,M=>l(M,v(L))),S(re,ve)}),A(re=>E(O,`${os[v(k)]??""}（${re??""}枚）`),[()=>o(v(p),v(k)).length],_e),S(w,b)}),A(w=>E(C,`${_o[v(p)]??""}（${w??""}枚）`),[()=>o(v(p)).length],_e),S(f,h)}),S(r,c),lt()}var Df=T('<div class="duel_card_info_row svelte-rccxcp"><div class="svelte-rccxcp"><pre class="description svelte-rccxcp"> </pre></div></div> <div class="duel_card_info_row svelte-rccxcp" style=" justify-content: space-between;"><div class="svelte-rccxcp"> </div> <div class="svelte-rccxcp"> </div></div>',1),Af=T('<div></div> <div class="svelte-rccxcp"> </div>',1),xf=T("<div> </div>"),Mf=T("<div> </div>"),Pf=T('<div class="duel_card_info_row svelte-rccxcp"><!> <!></div> <div class="duel_card_info_row svelte-rccxcp"></div>',1),Bf=T('<div class="duel_card_row svelte-rccxcp"><div class="svelte-rccxcp"></div> <div class="svelte-rccxcp"> </div></div>'),Ff=T('<div class="duel_card_row svelte-rccxcp"><div class="svelte-rccxcp"></div> <div class="svelte-rccxcp"> </div></div>'),Of=T('<div class="duel_card_info_row svelte-rccxcp"><div class="svelte-rccxcp">※テスト用カードです</div></div>'),Lf=T('<div class="duel_card_info_links svelte-rccxcp"><a target="_blank" rel="noopener noreferrer" title="遊戯王カードWiki" class="svelte-rccxcp">⇒遊戯王カードWiki</a> <a target="_blank" rel="noopener noreferrer" title="コナミカードデータベース" class="svelte-rccxcp"> </a></div>'),Nf=T('<div><div class="duel_card_info_header svelte-rccxcp"><div class="duel_card_info_row svelte-rccxcp"><div class="svelte-rccxcp"> </div></div> <div class="duel_card_info_row svelte-rccxcp" style="position:sticky; top:0;"><div class="svelte-rccxcp"> </div> <div class="svelte-rccxcp"> </div></div></div> <div class="duel_card_info_body svelte-rccxcp"><!> <!> <div class="duel_card_info_row description svelte-rccxcp"><div class="svelte-rccxcp"><pre class="description svelte-rccxcp"> </pre></div></div> <!></div></div>');function qf(r,e){st(e,!1);let t=Be(e,"cardInfo",8,void 0);const i=()=>t()?pt[t().name]:void 0;_t();var a=Ne(),n=le(a);{var s=o=>{var d=Nf(),l=g(d),c=g(l),f=g(c),p=g(f),h=_(c,2),m=g(h),C=g(m),y=_(m,2),w=g(y),k=_(l,2),b=g(k);{var P=x=>{var $=Df(),ee=le($),D=g(ee),Z=g(D),Y=g(Z),R=_(ee,2),q=g(R),X=g(q),I=_(q,2),j=g(I);A(()=>{E(Y,pt[t().name].pendulumDescription),E(X,`◀ ${t().pendulumScaleL??""}`),E(j,`${t().pendulumScaleR??""} ▶`)}),S(x,$)};N(b,x=>{var $;($=t().monsterCategories)!=null&&$.includes("Pendulum")&&x(P)})}var O=_(b,2);{var te=x=>{var $=Pf(),ee=le($),D=g(ee);{var Z=X=>{var I=Af(),j=le(I),H=_(j,2),U=g(H);A(()=>{Ce(j,`monster_attr ${t().attributes[0]??""} svelte-rccxcp`),E(U,`${Oa[t().attributes[0]]??""}属性`)}),S(X,I)};N(D,X=>{t().attributes&&X(Z)})}var Y=_(D,2);{var R=X=>{var I=xf(),j=g(I);A(()=>{Ce(I,`monster_cat ${t().types[0]??""} svelte-rccxcp`),E(j,`${nr[t().types[0]]??""}${Zr[t().types[0]]??""}族`)}),S(X,I)};N(Y,X=>{t().types&&X(R)})}var q=_(ee,2);ue(q,5,()=>t().monsterCategories??[],ce,(X,I)=>{var j=Mf(),H=g(j);A(()=>{Ce(j,`monster_cat ${v(I)??""} svelte-rccxcp`),E(H,`${ir[v(I)]??""}${$r[v(I)]??""}`)}),S(X,j)}),S(x,$)},re=x=>{var $=Ne(),ee=le($);{var D=Y=>{var R=Bf(),q=_(g(R),2),X=g(q);A(()=>E(X,`${rr[t().spellCategory]??""}魔法`)),S(Y,R)},Z=Y=>{var R=Ne(),q=le(R);{var X=I=>{var j=Ff(),H=_(g(j),2),U=g(H);A(()=>E(U,`${ar[t().trapCategory]??""}罠`)),S(I,j)};N(q,I=>{t().kind==="Trap"&&t().trapCategory&&I(X)},!0)}S(Y,R)};N(ee,Y=>{t().kind==="Spell"&&t().spellCategory?Y(D):Y(Z,!1)},!0)}S(x,$)};N(O,x=>{t().kind==="Monster"?x(te):x(re,!1)})}var L=_(O,2),ve=g(L),Q=g(ve),J=g(Q),Fe=_(L,2);{var G=x=>{var $=Of();S(x,$)},B=x=>{var $=Lf(),ee=g($),D=_(ee,2),Z=g(D);A(Y=>{Vt(ee,"href",`https://yugioh-wiki.net/index.php?${t().wikiEncodedName}`),Vt(D,"href",Y),E(Z,`⇒${(t().cardId?"公式カードページ":"公式で検索")??""}`)},[()=>bo(t())],_e),S(x,$)};N(Fe,x=>{t().isForTest?x(G):x(B,!1)})}A((x,$,ee,D)=>{Ce(d,`duel_card duel_card_info ${t().kind??""} ${x??""} svelte-rccxcp`),E(p,t().name),E(C,$),E(w,ee),E(J,D)},[()=>{var x;return(x=t().monsterCategories)==null?void 0:x.join(" ")},()=>"★".repeat(t().level||0),()=>"☆".repeat(t().rank||0),()=>{var x;return(x=i())==null?void 0:x.description}],_e),S(o,d)};N(n,o=>{t()&&o(s)})}S(r,a),lt()}const Rf={0:{aaa:"日",aaaa:"日曜日",ddd:"Sun",dddd:"Sunday"},1:{aaa:"月",aaaa:"月曜日",ddd:"Mon",dddd:"Monday"},2:{aaa:"火",aaaa:"火曜日",ddd:"Tue",dddd:"Tuesday"},3:{aaa:"水",aaaa:"水曜日",ddd:"Wed",dddd:"Wednesday"},4:{aaa:"木",aaaa:"木曜日",ddd:"Thu",dddd:"Thursday"},5:{aaa:"金",aaaa:"金曜日",ddd:"Fri",dddd:"Friday"},6:{aaa:"土",aaaa:"土曜日",ddd:"Sat",dddd:"Saturday"}};class Hf{constructor(){u(this,"DefaultSeparator1","/");u(this,"DefaultSeparator2"," ");u(this,"DefaultSeparator3",":");u(this,"createDate",e=>{if(!e)return;const t=new Date(e);if(!isNaN(t.getTime()))return t});u(this,"createDateOr",(e,t)=>this.createDate(e)||t||new Date);u(this,"truncateDate",e=>{const t=e||new Date;return new Date(t.getFullYear(),t.getMonth(),t.getDate())});u(this,"addDate",(e,t)=>{const i=this.createDateOr(e);return i.setDate(i.getDate()+t),i});u(this,"addMonth",(e,t)=>{const i=this.createDateOr(e);return i.setMonth(i.getMonth()+t),i});u(this,"addYear",(e,t)=>{const i=this.createDateOr(e);return i.setFullYear(i.getFullYear()+t),i});u(this,"getDayOfWeek",(e,t="dddd")=>{const i=this.createDate(e);return i?Rf[i.getDay()][t]:""});u(this,"formatToYYYYMMDD",(e,t=this.DefaultSeparator1)=>{const i=this.createDate(e);if(!i)return"";const a=i.getFullYear().toString(),n=("0"+(i.getMonth()+1)).slice(-2),s=("0"+i.getDate()).slice(-2);return a+t+n+t+s});u(this,"formatToYYYYMM",(e,t=this.DefaultSeparator1)=>{const i=this.createDate(e);if(!i)return"";t||(t="");const a=i.getFullYear().toString(),n=("0"+(i.getMonth()+1)).slice(-2);return a+t+n});u(this,"formatToHHMMSS",(e,t=this.DefaultSeparator3)=>{const i=this.createDate(e);if(!i)return"";t||(t="");const a=i.getHours(),n=i.getMinutes(),s=i.getSeconds();return("0"+a).slice(-2)+t+("0"+n).slice(-2)+t+("0"+s).slice(-2)});u(this,"formatToHHMM",(e,t=this.DefaultSeparator3)=>{const i=this.createDate(e);if(!i)return"";t||(t="");const a=("0"+i.getHours()).slice(-2),n=("0"+i.getMinutes()).slice(-2);return a+t+n});u(this,"formatToYYYYMMDD_HHMM",(e,t=this.DefaultSeparator1,i=this.DefaultSeparator2,a=this.DefaultSeparator3)=>{const n=this.createDate(e);return n?this.formatToYYYYMMDD(n,t)+i+this.formatToHHMM(n,a):""});u(this,"formatToYYYYMMDD_HHMMSS",(e,t=this.DefaultSeparator1,i=this.DefaultSeparator2,a=this.DefaultSeparator3)=>{const n=this.createDate(e);return n?this.formatToYYYYMMDD(n,t)+i+this.formatToHHMMSS(n,a):""})}}const At=new Hf;Date.prototype.truncateDate=function(){return At.truncateDate(this)};Date.prototype.getCloneOr=function(r){return At.createDateOr(this,r)};Date.prototype.addDate=function(r){return At.addDate(this,r)};Date.prototype.addMonth=function(r){return At.addDate(this,r)};Date.prototype.addYear=function(r){return At.addDate(this,r)};Date.prototype.getDayOfWeek=function(r="dddd"){return At.getDayOfWeek(this,r)};Date.prototype.formatToYYYYMM=function(r){return At.formatToYYYYMM(this,r)};Date.prototype.formatToYYYYMMDD=function(r){return At.formatToYYYYMMDD(this,r)};Date.prototype.formatToYYYYMMDD_HHMM=function(r,e,t){return At.formatToYYYYMMDD_HHMM(this,r,e,t)};Date.prototype.formatToYYYYMMDD_HHMMSS=function(r,e,t){return At.formatToYYYYMMDD_HHMMSS(this,r,e,t)};Date.prototype.formatToHHMM=function(r){return At.formatToHHMM(this,r)};Date.prototype.formatToHHMMSS=function(r){return At.formatToHHMMSS(this,r)};String.prototype.format=(r,...e)=>{for(const[t,i]of e.entries()){const a=new RegExp(`\\{${t}\\}`,"g");r=r.replace(a,i)}return r};var $f=T('<label><input type="checkbox"> </label>'),Zf=T('<label><input type="checkbox"> </label>'),Uf=T('<label><input type="checkbox"> <div style="display: inline-block;"></div> </label>'),Gf=T('<label><input type="checkbox"> </label>'),jf=T('<label><input type="checkbox"> </label>'),Vf=T('<label><input type="checkbox"> </label>'),zf=T("<option> </option>"),Wf=T('<div class="svelte-138s9ji"><a class="white_button svelte-138s9ji" download="SVS_DeckInfos.json">ダウンロード</a></div>'),Yf=T('<div class="svelte-138s9ji"></div>'),Kf=T('<div class="svelte-138s9ji"><a class="white_button svelte-138s9ji" download="SVS_DeckInfos.json">ダウンロード（一括）</a></div>'),Qf=T('<div class="svelte-138s9ji"></div>'),Xf=T('<div class="deck_editor_body_right_header svelte-138s9ji"><div class="deck_editor_body_right_header_row svelte-138s9ji"><div class="svelte-138s9ji">編集対象 <select></select></div> <div class="svelte-138s9ji"></div> <div class="svelte-138s9ji">新規名称 <input type="text"></div></div> <div class="deck_editor_body_right_header_row svelte-138s9ji"></div> <div class="deck_editor_body_right_header_row svelte-138s9ji"><div class="svelte-138s9ji">基本操作</div> <div class="svelte-138s9ji"><button class="white_button svelte-138s9ji">デッキを保存</button></div> <div class="svelte-138s9ji"></div> <div class="svelte-138s9ji"><button class="white_button svelte-138s9ji">デッキを複製</button></div> <div class="svelte-138s9ji"><button class="white_button svelte-138s9ji" title="shiftキー押下で確認メッセージスキップ">デッキを削除</button></div></div> <div class="deck_editor_body_right_header_row svelte-138s9ji"><div class="svelte-138s9ji">DL/UL</div> <!> <!></div></div> <!>',1),Jf=T("<div>デッキ情報読込中</div>"),If=T('<div class="deck_editor svelte-138s9ji"><div class="deck_editor_header"></div> <div class="deck_editor_body svelte-138s9ji"><div class="deck_editor_body_left svelte-138s9ji"><div role="contentinfo"><div class="deck_editor_search_box_header svelte-138s9ji"><div>検索条件</div> <div><button class="white_button svelte-138s9ji">条件クリア</button></div></div> <div class="deck_editor_search_box_row svelte-138s9ji"><div class="svelte-138s9ji">名称</div> <div class="svelte-138s9ji"><input type="text" style="width:70%">※ルビには対応していません</div></div> <div class="deck_editor_search_box_row svelte-138s9ji"><div class="svelte-138s9ji"><button class="search_condition_title black_button svelte-138s9ji">種類</button></div> <div class="svelte-138s9ji"></div></div> <div class="deck_editor_search_box_row svelte-138s9ji"><div class="svelte-138s9ji"><button class="search_condition_title black_button svelte-138s9ji">モンスター</button></div> <div class="svelte-138s9ji"></div></div> <div class="deck_editor_search_box_row svelte-138s9ji"><div class="svelte-138s9ji"><button class="search_condition_title black_button svelte-138s9ji">属性</button></div> <div class="svelte-138s9ji"></div></div> <div class="deck_editor_search_box_row svelte-138s9ji"><div class="svelte-138s9ji"><button class="search_condition_title black_button svelte-138s9ji">種族</button></div> <div class="svelte-138s9ji"></div></div> <div class="deck_editor_search_box_row svelte-138s9ji"><div class="svelte-138s9ji"><button class="search_condition_title black_button svelte-138s9ji">魔法</button></div> <div class="svelte-138s9ji"></div></div> <div class="deck_editor_search_box_row svelte-138s9ji"><div class="svelte-138s9ji"><button class="search_condition_title black_button svelte-138s9ji">罠</button></div> <div class="svelte-138s9ji"></div></div> <div class="deck_editor_search_box_row svelte-138s9ji"><div class="svelte-138s9ji">テスト用</div> <div class="svelte-138s9ji"><label><input type="checkbox"> テスト用カードを表示する</label></div></div></div> <!></div> <div class="deck_editor_body_center svelte-138s9ji"><!></div> <div class="deck_editor_body_right svelte-138s9ji"><!></div></div></div>');function ev(r,e){st(e,!1);const t=[],i=[],a=[],n=[],s=[],o=[],d={name:"",cardKinds:ua.filter(F=>F!=="XyzMaterial"),monsterCategories:[...ln],monsterAttributes:[...on],monsterTypes:[...cn],spellCategories:[...un],trapCategories:[...dn],isForTest:!1},l=je(structuredClone(d));let c=je("SearchCondition");const f=async()=>{Ve(l,v(l).name=""),Ve(l,v(l).cardKinds=[]),Ve(l,v(l).monsterCategories=[]),Ve(l,v(l).monsterAttributes=[]),Ve(l,v(l).monsterTypes=[]),Ve(l,v(l).spellCategories=[]),Ve(l,v(l).trapCategories=[]),Ve(l,v(l).isForTest=!1)},p=async()=>{const W=(await v(C)).find(Re=>Re.id===v(m));W&&K(k,{...W,cardInfos:W.cardNames.map(Re=>pt[Re])})},h=()=>Bt.getAllDeckInfo().then(F=>(K(m,(F.find(W=>W.lastUsedAt.getTime()===Math.max(...F.map(Re=>Re.lastUsedAt.getTime())))??F[0]).id),F));let m=je(-1),C=je(h()),y=je(v(C).then(F=>Bt.convertToObjectURL(F)));v(C).then(p);const w=()=>{K(C,h()),K(y,v(C).then(F=>Bt.convertToObjectURL(F))),p()};let k=je({id:-Number.MAX_VALUE,name:"",description:"",lastUsedAt:new Date,cardInfos:[]}),b=je(pt.ゾンビーノ);const P=()=>Object.values(pt).filter(F=>{if(!v(l).cardKinds.includes(F.kind)||v(l).name.trim().length&&!F.name.includes(v(l).name)||F.isForTest&&!v(l).isForTest)return!1;if(F.kind==="Monster")return F.attributes&&!v(l).monsterAttributes.union(F.attributes).length||F.types&&!v(l).monsterTypes.union(F.types).length||!F.monsterCategories?!1:F.monsterCategories.union(v(l).monsterCategories).length;if(F.kind==="Spell")return F.spellCategory&&v(l).spellCategories.includes(F.spellCategory);if(F.kind==="Trap")return F.trapCategory&&v(l).trapCategories.includes(F.trapCategory)}),O=F=>{K(c,"CardDetail"),K(b,F)},te=async()=>{const W=(await v(C)).find(Re=>Re.id===v(m));if(!W)throw new Error("illegal state");return W},re=async F=>{Array.isArray(v(l)[F])&&Array.isArray(d[F])&&Ve(l,v(l)[F]=v(l)[F].length?[]:[...d[F]])},L=async()=>{const F=await te();await F.saveDeckInfo({...F,name:v(k).name,cardNames:v(k).cardInfos.map(W=>W.name),lastUsedAt:new Date}),w()},ve=async()=>{(await Bt.createNewDeck(`デッキ_${new Date().formatToYYYYMMDD_HHMMSS("","","")}`,`コピー日時：${new Date().formatToYYYYMMDD_HHMMSS("-"," ",":")}`,v(k).cardInfos.map(W=>W.name))).saveDeckInfo(),w()},Q=async F=>{const W=await te();!F.shiftKey&&!confirm(`デッキ【${W.name}】を削除します。
よろしいですか？`)||(await W.delete(),w())};_t();var J=If(),Fe=_(g(J),2),G=g(Fe),B=g(G),x=g(B),$=_(g(x),2),ee=g($),D=_(x,2),Z=_(g(D),2),Y=g(Z),R=_(D,2),q=g(R),X=g(q),I=_(q,2);ue(I,5,()=>ua.filter(F=>F!=="XyzMaterial"),ce,(F,W)=>{var Re=$f(),Ee=g(Re),Je,ct=_(Ee);A(()=>{Je!==(Je=v(W))&&(Ee.value=(Ee.__value=v(W))==null?"":v(W)),E(ct,` ${os[v(W)]??""}`)}),mi(t,[],Ee,()=>(v(W),v(l).cardKinds),ut=>Ve(l,v(l).cardKinds=ut)),S(F,Re)});var j=_(R,2),H=g(j),U=g(H),z=_(H,2);ue(z,5,()=>ln,ce,(F,W)=>{var Re=Zf(),Ee=g(Re),Je,ct=_(Ee);A(()=>{Je!==(Je=v(W))&&(Ee.value=(Ee.__value=v(W))==null?"":v(W)),E(ct,` ${ir[v(W)]??""}${$r[v(W)]??""}`)}),mi(i,[],Ee,()=>(v(W),v(l).monsterCategories),ut=>Ve(l,v(l).monsterCategories=ut)),S(F,Re)});var ae=_(j,2),ne=g(ae),se=g(ne),M=_(ne,2);ue(M,5,()=>on,ce,(F,W)=>{var Re=Uf(),Ee=g(Re),Je,ct=_(Ee,2),ut=_(ct);A(()=>{Je!==(Je=v(W))&&(Ee.value=(Ee.__value=v(W))==null?"":v(W)),Ce(ct,`monster_attr ${v(W)??""} svelte-138s9ji`),E(ut,` ${Oa[v(W)]??""}`)}),mi(a,[],Ee,()=>(v(W),v(l).monsterAttributes),Vr=>Ve(l,v(l).monsterAttributes=Vr)),S(F,Re)});var V=_(ae,2),ie=g(V),me=g(ie),Te=_(ie,2);ue(Te,5,()=>cn,ce,(F,W)=>{var Re=Gf(),Ee=g(Re),Je,ct=_(Ee);A(()=>{Je!==(Je=v(W))&&(Ee.value=(Ee.__value=v(W))==null?"":v(W)),E(ct,` ${nr[v(W)]??""}
                ${Zr[v(W)]??""}`)}),mi(n,[],Ee,()=>(v(W),v(l).monsterTypes),ut=>Ve(l,v(l).monsterTypes=ut)),S(F,Re)});var be=_(V,2),Ke=g(be),et=g(Ke),Ge=_(Ke,2);ue(Ge,5,()=>un,ce,(F,W)=>{var Re=jf(),Ee=g(Re),Je,ct=_(Ee);A(()=>{Je!==(Je=v(W))&&(Ee.value=(Ee.__value=v(W))==null?"":v(W)),E(ct,` ${rr[v(W)]??""}`)}),mi(s,[],Ee,()=>(v(W),v(l).spellCategories),ut=>Ve(l,v(l).spellCategories=ut)),S(F,Re)});var Xe=_(be,2),mt=g(Xe),Ct=g(mt),tt=_(mt,2);ue(tt,5,()=>dn,ce,(F,W)=>{var Re=Vf(),Ee=g(Re),Je,ct=_(Ee);A(()=>{Je!==(Je=v(W))&&(Ee.value=(Ee.__value=v(W))==null?"":v(W)),E(ct,` ${ar[v(W)]??""}`)}),mi(o,[],Ee,()=>(v(W),v(l).trapCategories),ut=>Ve(l,v(l).trapCategories=ut)),S(F,Re)});var it=_(Xe,2),ke=_(g(it),2),Me=g(ke),Pe=g(Me),de=_(B,2);qf(de,{get cardInfo(){return v(b)}});var pe=_(G,2),$e=g(pe);const Ze=_e(P);wn($e,{mode:"List",get allCardInfos(){return v(Ze)},onAttention:O,get deckCardInfos(){return v(k).cardInfos},set deckCardInfos(F){Ve(k,v(k).cardInfos=F)},$$legacy:!0});var ot=_(pe,2),Ri=g(ot);Ui(Ri,()=>v(C),F=>{var W=Jf();S(F,W)},(F,W)=>{var Re=Xf(),Ee=le(Re),Je=g(Ee),ct=g(Je),ut=_(g(ct));A(()=>{v(m),Hi(()=>{v(W)})}),ue(ut,5,()=>v(W),ce,(dt,kt)=>{var Mt=zf(),hi={},zr=g(Mt);A(()=>{hi!==(hi=v(kt).id)&&(Mt.value=(Mt.__value=v(kt).id)==null?"":v(kt).id),E(zr,v(kt).name)}),S(dt,Mt)});var Vr=_(ct,4),Ms=_(g(Vr)),Ua=_(Je,4),Ga=_(g(Ua),2),Ps=g(Ga),ja=_(Ga,4),Bs=g(ja),Fs=_(ja,2),Os=g(Fs),Ls=_(Ua,2),Va=_(g(Ls),2);Ui(Va,te,dt=>{var kt=Yf();S(dt,kt)},(dt,kt)=>{var Mt=Wf(),hi=g(Mt);A(zr=>Vt(hi,"href",zr),[()=>Bt.convertToObjectURL([v(kt)])],_e),S(dt,Mt)});var Ns=_(Va,2);Ui(Ns,()=>v(y),dt=>{var kt=Qf();S(dt,kt)},(dt,kt)=>{var Mt=Kf(),hi=g(Mt);A(()=>Vt(hi,"href",v(kt))),S(dt,Mt)});var qs=_(Ee,2);wn(qs,{mode:"Deck",allCardInfos:[],onAttention:O,get deckCardInfos(){return v(k).cardInfos},set deckCardInfos(dt){Ve(k,v(k).cardInfos=dt)},$$legacy:!0}),Zi(ut,()=>v(m),dt=>K(m,dt)),De("change",ut,p),ca(Ms,()=>v(k).name,dt=>Ve(k,v(k).name=dt)),De("click",Ps,L),De("click",Bs,ve),De("click",Os,Q),S(F,Re)}),A(()=>Ce(B,`deck_editor_search_box ${(v(c)==="SearchCondition"?"":"minimum")??""} svelte-138s9ji`)),De("click",ee,f),ca(Y,()=>v(l).name,F=>Ve(l,v(l).name=F)),De("click",X,()=>re("cardKinds")),De("click",U,()=>re("monsterCategories")),De("click",se,()=>re("monsterAttributes")),De("click",me,()=>re("monsterTypes")),De("click",et,()=>re("spellCategories")),De("click",Ct,()=>re("trapCategories")),oo(Pe,()=>v(l).isForTest,F=>Ve(l,v(l).isForTest=F)),De("mouseenter",B,()=>K(c,"SearchCondition")),S(r,J),lt()}const tv="2025-04-29 20:22:55",iv={timestamp:tv},rv=[{seq:10,name:"Internet Explorer",key:"msie"},{seq:20,name:"Internet Explorer",key:"trident"},{seq:30,name:"Edge",key:"edge"},{seq:40,name:"Google Chrome",key:"chrome"},{seq:50,name:"Safari",key:"safari"},{seq:60,name:"Mozilla Firefox",key:"firefox"},{seq:70,name:"Opera",key:"opera"}],av=[{seq:10,name:"Microsoft Windows",key:"windows nt"},{seq:20,name:"Android",key:"android"},{seq:30,name:"iOS",key:"iphone"},{seq:40,name:"iOS",key:"ipad"},{seq:50,name:"macOS",key:"mac os x"}],Xi=window.navigator.userAgent.toLowerCase();var Tn;const nv=((Tn=rv.find(r=>Xi.indexOf(r.key)!==-1))==null?void 0:Tn.name)??"Unknown Browser";var bn;const Za=((bn=av.find(r=>Xi.indexOf(r.key)!==-1))==null?void 0:bn.name)??"Unknown OS",xs=Xi.indexOf("iphone")!==-1||Za==="Android"&&Xi.indexOf("mobile")!==-1,sv=Xi.indexOf("ipad")!==-1||Za==="Android"&&!xs,lv=xs?"Smart Phone":sv?"Tablet Device":"PC",ov={text:`${lv} ${Za} ${nv}`},cv=["TblDeckHeader","TblDeckDetail","TblDuelistProfile"],uv=3;var dv=T("<option> </option>"),fv=T("<option> </option>"),vv=T("<option> </option>"),pv=T("<option> </option>"),hv=T('<div class="svelte-1tmphfm"><label for="deck_selector" class="deck_selector svelte-1tmphfm">デッキ：</label> <select id="deck_selector" class="deck_selector svelte-1tmphfm"></select></div> <div class="svelte-1tmphfm"><label for="npc_selector" class="npc_selector svelte-1tmphfm">対戦相手：</label> <select id="npc_selector" class="npc_selector svelte-1tmphfm"></select> <div> </div></div> <div class="svelte-1tmphfm"><label for="npc_deck_selector" class="deck_selector svelte-1tmphfm">対戦相手のデッキ：</label> <select id="npc_deck_selector" class="deck_selector svelte-1tmphfm"><option>デフォルト</option><!></select></div> <div class="svelte-1tmphfm"><label for="npc_selector" class="npc_selector svelte-1tmphfm">先攻後攻：</label> <select id="npc_selector" class="npc_selector svelte-1tmphfm"></select></div> <div class="svelte-1tmphfm"><button class="btn svelte-1tmphfm">duel start!</button></div>',1),gv=T('<div class="svelte-1tmphfm">デッキ情報の読み込み、もしくは作成中...</div>'),yv=T('<div class="svelte-1tmphfm"><label for="duelist_name" class="duelist_name svelte-1tmphfm">名前：</label> <input id="duelist_name" class="duelist_name svelte-1tmphfm" type="text"></div> <!> <div class="svelte-1tmphfm"><button class="btn svelte-1tmphfm">deck edit</button></div>',1),mv=T('<div class="svelte-1tmphfm">デュエリスト情報の読み込み、もしくは作成中...</div>'),_v=T('<div class="app_body svelte-1tmphfm"><!></div>'),Sv=T('<div class="result_title result_win svelte-1tmphfm">YOU WIN</div>'),Cv=T('<div class="result_title result_lose svelte-1tmphfm">YOU LOSE</div>'),kv=T('<div class="result_title result_draw svelte-1tmphfm">DRAW</div>'),wv=T('<div class="result svelte-1tmphfm"><!> <button class="white_button svelte-1tmphfm">TOPへ戻る</button></div>'),Tv=T('<main class="svelte-1tmphfm"><div class="link link_left svelte-1tmphfm"><a href="https://github.com/Setta238/stk_ygo_svelte" target="_blank" rel="noopener noreferrer" title="repository" class="svelte-1tmphfm">repository</a> <a href="https://x.com/ninja_no" target="_blank" rel="noopener noreferrer" title="repository" class="svelte-1tmphfm">X(Twitter)</a> <a href="https://posfie.com/@ninja_no/p/Lx7FLj3" target="_blank" rel="noopener noreferrer" title="posfie" class="svelte-1tmphfm">posfie(toggeter)</a></div> <div class="link link_right svelte-1tmphfm"><a class="a_button svelte-1tmphfm" role="button" tabindex="0">TOPへ戻る</a> <a href="/stk_ygo_svelte/note.html" target="_blank" rel="noopener noreferrer" title="repository" class="svelte-1tmphfm">現時点とこの先のこと</a></div> <!> <div class="debug_info svelte-1tmphfm"><span> </span> <span class="user_agent_info"> </span> <span class="screen_info"></span></div> <!></main>');function bv(r,e){st(e,!1);const t=new yo("stk_ygo_svelte",uv,cv);let i=je(),a=je("None"),n=je(0);const s=fa.getOrCreateNew(t);let o=je(Bt.getAllDeckInfo(t).then(G=>(Promise.all(G.filter(B=>!B.lastUsedAt).map(B=>{B.saveDeckInfo()})),K(n,(G.find(B=>B.lastUsedAt.getTime()===Math.max(...G.map(x=>x.lastUsedAt.getTime())))??G[0]).id),G)));const d=async()=>{let G=(await v(o)).find(B=>B.id===v(n));if(G||(G=(await c()).find(B=>B.id===v(n))),!G)throw new Error("illegal state");return G},l=async()=>{(await s).save()},c=()=>(K(o,Bt.getAllDeckInfo(t).then(G=>(K(n,(G.find(B=>B.lastUsedAt.getTime()===Math.max(...G.map(x=>x.lastUsedAt.getTime())))??G[0]).id),G))),v(o)),f=async()=>{(await v(o)).length||(await Bt.prepareSampleDeck(),c())},p=async()=>{await Promise.all([l(),f()]);const G=await d(),B=await s;await G.updateTimestamp();const x=Vi.find(ee=>ee.id===B.previousNpcId);let $=Sn.slice(-1)[0];x&&(B.previousNpcDeckId>-1?$=(await v(o)).find(ee=>ee.id===B.previousNpcDeckId)??$:x.id===-1&&($=Sn.find(ee=>ee.id===-1)??$),K(i,new Ec(B,"Player",G,[],x,"NPC",$,[],B.previousStartMode)),v(i).onDuelEnd.append(()=>(K(i,v(i)),"RemoveMe")))},h=async()=>{await Promise.all([l(),f()]),K(a,"DeckEdit")},m=async G=>{await l(),G.key==="Enter"&&!G.repeat&&(await s).save()},C=()=>{K(o,c()),K(i,void 0),K(a,"None")};f(),_t();var y=Tv(),w=_(g(y),2),k=g(w),b=_(w,2);{var P=G=>{Sf(G,{get duel(){return v(i)}})},O=G=>{var B=Ne(),x=le(B);{var $=D=>{ev(D,{})},ee=D=>{var Z=_v(),Y=g(Z);Ui(Y,()=>s,R=>{var q=mv();S(R,q)},(R,q)=>{var X=yv(),I=le(X),j=_(g(I),2),H=_(I,2);Ui(H,()=>v(o),ae=>{var ne=gv();S(ae,ne)},(ae,ne)=>{var se=hv(),M=le(se),V=_(g(M),2);A(()=>{v(n),Hi(()=>{v(ne)})}),ue(V,5,()=>v(ne),ce,(ke,Me)=>{var Pe=dv(),de={},pe=g(Pe);A(()=>{de!==(de=v(Me).id)&&(Pe.value=(Pe.__value=v(Me).id)==null?"":v(Me).id),E(pe,v(Me).name)}),S(ke,Pe)});var ie=_(M,2),me=_(g(ie),2);A(()=>{v(q),Hi(()=>{})}),ue(me,5,()=>Vi,ce,(ke,Me)=>{var Pe=fv(),de={},pe=g(Pe);A(()=>{de!==(de=v(Me).id)&&(Pe.value=(Pe.__value=v(Me).id)==null?"":v(Me).id),E(pe,v(Me).name)}),S(ke,Pe)});var Te=_(me,2),be=g(Te),Ke=_(ie,2),et=_(g(Ke),2);A(()=>{v(q),Hi(()=>{v(ne)})});var Ge=g(et);Ge.value=(Ge.__value=Number.MIN_SAFE_INTEGER)==null?"":Number.MIN_SAFE_INTEGER;var Xe=_(Ge);ue(Xe,1,()=>v(ne),ce,(ke,Me)=>{var Pe=vv(),de={},pe=g(Pe);A(()=>{de!==(de=v(Me).id)&&(Pe.value=(Pe.__value=v(Me).id)==null?"":v(Me).id),E(pe,v(Me).name)}),S(ke,Pe)});var mt=_(Ke,2),Ct=_(g(mt),2);A(()=>{v(q),Hi(()=>{})}),ue(Ct,5,()=>gs(gn),ce,(ke,Me)=>{var Pe=pv(),de={},pe=g(Pe);A(()=>{de!==(de=v(Me))&&(Pe.value=(Pe.__value=v(Me))==null?"":v(Me)),E(pe,gn[v(Me)])}),S(ke,Pe)});var tt=_(mt,2),it=g(tt);A(ke=>E(be,`※${ke??""}`),[()=>{var ke;return(ke=Vi.find(Me=>Me.id===v(q).previousNpcId))==null?void 0:ke.description}],_e),Zi(V,()=>v(n),ke=>K(n,ke)),Zi(me,()=>v(q).previousNpcId,ke=>v(q).previousNpcId=ke),Zi(et,()=>v(q).previousNpcDeckId,ke=>v(q).previousNpcDeckId=ke),Zi(Ct,()=>v(q).previousStartMode,ke=>v(q).previousStartMode=ke),De("click",it,p),S(ae,se)});var U=_(H,2),z=g(U);ca(j,()=>v(q).name,ae=>v(q).name=ae),De("keypress",j,m),De("click",z,h),S(R,X)}),S(D,Z)};N(x,D=>{v(a)==="DeckEdit"?D($):D(ee,!1)},!0)}S(G,B)};N(b,G=>{v(i)?G(P):G(O,!1)})}var te=_(b,2),re=g(te),L=g(re),ve=_(re,2),Q=g(ve),J=_(te,2);{var Fe=G=>{var B=wv(),x=g(B);{var $=Z=>{var Y=Ne(),R=le(Y);{var q=I=>{var j=Sv();S(I,j)},X=I=>{var j=Ne(),H=le(j);{var U=z=>{var ae=Cv();S(z,ae)};N(H,z=>{v(i).winner.seat==="Above"&&z(U)},!0)}S(I,j)};N(R,I=>{v(i).winner.seat==="Below"?I(q):I(X,!1)})}S(Z,Y)},ee=Z=>{var Y=kv();S(Z,Y)};N(x,Z=>{v(i).winner?Z($):Z(ee,!1)})}var D=_(x,2);De("click",D,C),ai(3,B,()=>Bu,()=>({delay:200,duration:2e3})),S(G,B)};N(J,G=>{v(i)&&v(i).isEnded&&G(Fe)})}A(()=>{E(L,`build at: ${iv.timestamp}`),E(Q,ov.text)}),De("click",k,C),S(r,y),lt()}Yl(bv,{target:document.getElementById("app")});
