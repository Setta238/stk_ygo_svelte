var Jn=Object.defineProperty;var In=(i,e,t)=>e in i?Jn(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var d=(i,e,t)=>In(i,typeof e!="symbol"?e+"":e,t);import{j as es}from"./cardInfo.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();const Na=!1;var nr=Array.isArray,ts=Array.prototype.indexOf,sr=Array.from,Qr=Object.defineProperty,ui=Object.getOwnPropertyDescriptor,Jr=Object.getOwnPropertyDescriptors,is=Object.prototype,as=Array.prototype,lr=Object.getPrototypeOf;function rs(i){return typeof i=="function"}const mt=()=>{};function ns(i){return typeof(i==null?void 0:i.then)=="function"}function ss(i){return i()}function qa(i){for(var e=0;e<i.length;e++)i[e]()}const vt=2,Ir=4,va=8,fa=16,qt=32,qi=64,Ii=128,ut=256,ea=512,et=1024,Lt=2048,wi=4096,Pt=8192,pa=16384,en=32768,ha=65536,tn=1<<17,ls=1<<19,an=1<<20,Ft=Symbol("$state"),os=Symbol("legacy props"),cs=Symbol("");function rn(i){return i===this.v}function nn(i,e){return i!=i?e==e:i!==e||i!==null&&typeof i=="object"||typeof i=="function"}function or(i){return!nn(i,this.v)}function ds(i){throw new Error("https://svelte.dev/e/effect_in_teardown")}function us(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function vs(i){throw new Error("https://svelte.dev/e/effect_orphan")}function fs(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function ps(i){throw new Error("https://svelte.dev/e/props_invalid_value")}function hs(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function gs(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function ys(){throw new Error("https://svelte.dev/e/state_unsafe_local_read")}function ms(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let Li=!1,_s=!1;function Ss(){Li=!0}const cr=1,dr=2,sn=4,bs=8,ws=16,Cs=1,Ts=2,ks=4,Es=8,Ds=16,As=1,xs=2,Ms=4,Ps=1,Fs=2,ze=Symbol();let Ue=null;function ta(i){Ue=i}function Ve(i,e=!1,t){Ue={p:Ue,c:null,e:null,m:!1,s:i,x:null,l:null},Li&&!e&&(Ue.l={s:null,u:null,r1:[],r2:Ke(!1)})}function We(i){const e=Ue;if(e!==null){const s=e.e;if(s!==null){var t=ke,a=Ae;e.e=null;try{for(var r=0;r<s.length;r++){var n=s[r];pt(n.effect),ft(n.reaction),ki(n.fn)}}finally{pt(t),ft(a)}}Ue=e.p,e.m=!0}return{}}function Ci(){return!Li||Ue!==null&&Ue.l===null}function Ke(i,e){var t={f:0,v:i,reactions:null,equals:rn,rv:0,wv:0};return t}function Bs(i){return ln(Ke(i))}function yi(i,e=!1){var a;const t=Ke(i);return e||(t.equals=or),Li&&Ue!==null&&Ue.l!==null&&((a=Ue.l).s??(a.s=[])).push(t),t}function Ne(i,e=!1){return ln(yi(i,e))}function ln(i){return Ae!==null&&!wt&&Ae.f&vt&&(Ct===null?Gs([i]):Ct.push(i)),i}function je(i,e){return Q(i,_t(()=>p(i))),e}function Q(i,e){return Ae!==null&&!wt&&Ci()&&Ae.f&(vt|fa)&&(Ct===null||!Ct.includes(i))&&ms(),Zt(i,e)}function Zt(i,e){return i.equals(e)||(i.v,i.v=e,i.wv=kn(),on(i,Lt),Ci()&&ke!==null&&ke.f&et&&!(ke.f&(qt|qi))&&(Dt===null?zs([i]):Dt.push(i))),e}function on(i,e){var t=i.reactions;if(t!==null)for(var a=Ci(),r=t.length,n=0;n<r;n++){var s=t[n],o=s.f;o&Lt||!a&&s===ke||(kt(s,e),o&(et|ut)&&(o&vt?on(s,wi):Sa(s)))}}let cn=!1;function $t(i,e=null,t){if(typeof i!="object"||i===null||Ft in i)return i;const a=lr(i);if(a!==is&&a!==as)return i;var r=new Map,n=nr(i),s=Ke(0);n&&r.set("length",Ke(i.length));var o;return new Proxy(i,{defineProperty(u,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&hs();var v=r.get(l);return v===void 0?(v=Ke(c.value),r.set(l,v)):Q(v,$t(c.value,o)),!0},deleteProperty(u,l){var c=r.get(l);if(c===void 0)l in u&&r.set(l,Ke(ze));else{if(n&&typeof l=="string"){var v=r.get("length"),f=Number(l);Number.isInteger(f)&&f<v.v&&Q(v,f)}Q(c,ze),Sr(s)}return!0},get(u,l,c){var y;if(l===Ft)return i;var v=r.get(l),f=l in u;if(v===void 0&&(!f||(y=ui(u,l))!=null&&y.writable)&&(v=Ke($t(f?u[l]:ze,o)),r.set(l,v)),v!==void 0){var h=p(v);return h===ze?void 0:h}return Reflect.get(u,l,c)},getOwnPropertyDescriptor(u,l){var c=Reflect.getOwnPropertyDescriptor(u,l);if(c&&"value"in c){var v=r.get(l);v&&(c.value=p(v))}else if(c===void 0){var f=r.get(l),h=f==null?void 0:f.v;if(f!==void 0&&h!==ze)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return c},has(u,l){var h;if(l===Ft)return!0;var c=r.get(l),v=c!==void 0&&c.v!==ze||Reflect.has(u,l);if(c!==void 0||ke!==null&&(!v||(h=ui(u,l))!=null&&h.writable)){c===void 0&&(c=Ke(v?$t(u[l],o):ze),r.set(l,c));var f=p(c);if(f===ze)return!1}return v},set(u,l,c,v){var F;var f=r.get(l),h=l in u;if(n&&l==="length")for(var y=c;y<f.v;y+=1){var b=r.get(y+"");b!==void 0?Q(b,ze):y in u&&(b=Ke(ze),r.set(y+"",b))}f===void 0?(!h||(F=ui(u,l))!=null&&F.writable)&&(f=Ke(void 0),Q(f,$t(c,o)),r.set(l,f)):(h=f.v!==ze,Q(f,$t(c,o)));var m=Reflect.getOwnPropertyDescriptor(u,l);if(m!=null&&m.set&&m.set.call(v,c),!h){if(n&&typeof l=="string"){var S=r.get("length"),E=Number(l);Number.isInteger(E)&&E>=S.v&&Q(S,E+1)}Sr(s)}return!0},ownKeys(u){p(s);var l=Reflect.ownKeys(u).filter(f=>{var h=r.get(f);return h===void 0||h.v!==ze});for(var[c,v]of r)v.v!==ze&&!(c in u)&&l.push(c);return l},setPrototypeOf(){gs()}})}function Sr(i,e=1){Q(i,i.v+e)}function br(i){return i!==null&&typeof i=="object"&&Ft in i?i[Ft]:i}function dn(i,e){return Object.is(br(i),br(e))}var wr,un,vn,fn;function Os(){if(wr===void 0){wr=window,un=/Firefox/.test(navigator.userAgent);var i=Element.prototype,e=Node.prototype;vn=ui(e,"firstChild").get,fn=ui(e,"nextSibling").get,i.__click=void 0,i.__className="",i.__attributes=null,i.__styles=null,i.__e=void 0,Text.prototype.__t=void 0}}function ga(i=""){return document.createTextNode(i)}function ia(i){return vn.call(i)}function ya(i){return fn.call(i)}function g(i,e){return ia(i)}function le(i,e){{var t=ia(i);return t instanceof Comment&&t.data===""?ya(t):t}}function _(i,e=1,t=!1){let a=i;for(;e--;)a=ya(a);return a}function Ns(i){i.textContent=""}function ei(i){var e=vt|Lt,t=Ae!==null&&Ae.f&vt?Ae:null;return ke===null||t!==null&&t.f&ut?e|=ut:ke.f|=an,{ctx:Ue,deps:null,effects:null,equals:rn,f:e,fn:i,reactions:null,rv:0,v:null,wv:0,parent:t??ke}}function ge(i){const e=ei(i);return e.equals=or,e}function pn(i){var e=i.effects;if(e!==null){i.effects=null;for(var t=0;t<e.length;t+=1)Gt(e[t])}}function qs(i){for(var e=i.parent;e!==null;){if(!(e.f&vt))return e;e=e.parent}return null}function Ls(i){var e,t=ke;pt(qs(i));try{pn(i),e=Dn(i)}finally{pt(t)}return e}function hn(i){var e=Ls(i),t=(Ut||i.f&ut)&&i.deps!==null?wi:et;kt(i,t),i.equals(e)||(i.v=e,i.wv=kn())}function gn(i){ke===null&&Ae===null&&vs(),Ae!==null&&Ae.f&ut&&ke===null&&us(),fr&&ds()}function Rs(i,e){var t=e.last;t===null?e.last=e.first=i:(t.next=i,i.prev=t,e.last=i)}function Ti(i,e,t,a=!0){var r=(i&qi)!==0,n=ke,s={ctx:Ue,deps:null,nodes_start:null,nodes_end:null,f:i|Lt,first:null,fn:e,last:null,next:null,parent:r?null:n,prev:null,teardown:null,transitions:null,wv:0};if(t){var o=vi;try{Tr(!0),pr(s),s.f|=en}catch(c){throw Gt(s),c}finally{Tr(o)}}else e!==null&&Sa(s);var u=t&&s.deps===null&&s.first===null&&s.nodes_start===null&&s.teardown===null&&(s.f&(an|Ii))===0;if(!u&&!r&&a&&(n!==null&&Rs(s,n),Ae!==null&&Ae.f&vt)){var l=Ae;(l.effects??(l.effects=[])).push(s)}return s}function ur(i){const e=Ti(va,null,!1);return kt(e,et),e.teardown=i,e}function Cr(i){gn();var e=ke!==null&&(ke.f&qt)!==0&&Ue!==null&&!Ue.m;if(e){var t=Ue;(t.e??(t.e=[])).push({fn:i,effect:ke,reaction:Ae})}else{var a=ki(i);return a}}function Hs(i){return gn(),Ri(i)}function $s(i){const e=Ti(qi,i,!0);return(t={})=>new Promise(a=>{t.outro?Jt(e,()=>{Gt(e),a(void 0)}):(Gt(e),a(void 0))})}function ki(i){return Ti(Ir,i,!1)}function Ri(i){return Ti(va,i,!0)}function A(i,e=[],t=ei){const a=e.map(t);return ma(()=>i(...a.map(p)))}function ma(i,e=0){return Ti(va|fa|e,i,!0)}function ti(i,e=!0){return Ti(va|qt,i,!0,e)}function yn(i){var e=i.teardown;if(e!==null){const t=fr,a=Ae;kr(!0),ft(null);try{e.call(null)}finally{kr(t),ft(a)}}}function mn(i,e=!1){var t=i.first;for(i.first=i.last=null;t!==null;){var a=t.next;Gt(t,e),t=a}}function js(i){for(var e=i.first;e!==null;){var t=e.next;e.f&qt||Gt(e),e=t}}function Gt(i,e=!0){var t=!1;if((e||i.f&ls)&&i.nodes_start!==null){for(var a=i.nodes_start,r=i.nodes_end;a!==null;){var n=a===r?null:ya(a);a.remove(),a=n}t=!0}mn(i,e&&!t),na(i,0),kt(i,pa);var s=i.transitions;if(s!==null)for(const u of s)u.stop();yn(i);var o=i.parent;o!==null&&o.first!==null&&_n(i),i.next=i.prev=i.teardown=i.ctx=i.deps=i.fn=i.nodes_start=i.nodes_end=null}function _n(i){var e=i.parent,t=i.prev,a=i.next;t!==null&&(t.next=a),a!==null&&(a.prev=t),e!==null&&(e.first===i&&(e.first=a),e.last===i&&(e.last=t))}function Jt(i,e){var t=[];vr(i,t,!0),Sn(t,()=>{Gt(i),e&&e()})}function Sn(i,e){var t=i.length;if(t>0){var a=()=>--t||e();for(var r of i)r.out(a)}else e()}function vr(i,e,t){if(!(i.f&Pt)){if(i.f^=Pt,i.transitions!==null)for(const s of i.transitions)(s.is_global||t)&&e.push(s);for(var a=i.first;a!==null;){var r=a.next,n=(a.f&ha)!==0||(a.f&qt)!==0;vr(a,e,n?t:!1),a=r}}}function mi(i){bn(i,!0)}function bn(i,e){if(i.f&Pt){i.f^=Pt,i.f&et||(i.f^=et),Hi(i)&&(kt(i,Lt),Sa(i));for(var t=i.first;t!==null;){var a=t.next,r=(t.f&ha)!==0||(t.f&qt)!==0;bn(t,r?e:!1),t=a}if(i.transitions!==null)for(const n of i.transitions)(n.is_global||e)&&n.in()}}let aa=!1,La=[];function wn(){aa=!1;const i=La.slice();La=[],qa(i)}function ii(i){aa||(aa=!0,queueMicrotask(wn)),La.push(i)}function Us(){aa&&wn()}const Cn=0,Zs=1;let Xi=!1,Ki=Cn,Bi=!1,Oi=null,vi=!1,fr=!1;function Tr(i){vi=i}function kr(i){fr=i}let Kt=[],fi=0;let Ae=null,wt=!1;function ft(i){Ae=i}let ke=null;function pt(i){ke=i}let Ct=null;function Gs(i){Ct=i}let Qe=null,st=0,Dt=null;function zs(i){Dt=i}let Tn=1,ra=0,Ut=!1,jt=null;function kn(){return++Tn}function Hi(i){var v;var e=i.f;if(e&Lt)return!0;if(e&wi){var t=i.deps,a=(e&ut)!==0;if(t!==null){var r,n,s=(e&ea)!==0,o=a&&ke!==null&&!Ut,u=t.length;if(s||o){var l=i,c=l.parent;for(r=0;r<u;r++)n=t[r],(s||!((v=n==null?void 0:n.reactions)!=null&&v.includes(l)))&&(n.reactions??(n.reactions=[])).push(l);s&&(l.f^=ea),o&&c!==null&&!(c.f&ut)&&(l.f^=ut)}for(r=0;r<u;r++)if(n=t[r],Hi(n)&&hn(n),n.wv>i.wv)return!0}(!a||ke!==null&&!Ut)&&kt(i,et)}return!1}function Vs(i,e){for(var t=e;t!==null;){if(t.f&Ii)try{t.fn(i);return}catch{t.f^=Ii}t=t.parent}throw Xi=!1,i}function Ws(i){return(i.f&pa)===0&&(i.parent===null||(i.parent.f&Ii)===0)}function _a(i,e,t,a){if(Xi){if(t===null&&(Xi=!1),Ws(e))throw i;return}t!==null&&(Xi=!0);{Vs(i,e);return}}function En(i,e,t=!0){var a=i.reactions;if(a!==null)for(var r=0;r<a.length;r++){var n=a[r];n.f&vt?En(n,e,!1):e===n&&(t?kt(n,Lt):n.f&et&&kt(n,wi),Sa(n))}}function Dn(i){var h;var e=Qe,t=st,a=Dt,r=Ae,n=Ut,s=Ct,o=Ue,u=wt,l=i.f;Qe=null,st=0,Dt=null,Ae=l&(qt|qi)?null:i,Ut=(l&ut)!==0&&(!vi||r===null||u),Ct=null,ta(i.ctx),wt=!1,ra++;try{var c=(0,i.fn)(),v=i.deps;if(Qe!==null){var f;if(na(i,st),v!==null&&st>0)for(v.length=st+Qe.length,f=0;f<Qe.length;f++)v[st+f]=Qe[f];else i.deps=v=Qe;if(!Ut)for(f=st;f<v.length;f++)((h=v[f]).reactions??(h.reactions=[])).push(i)}else v!==null&&st<v.length&&(na(i,st),v.length=st);if(Ci()&&Dt!==null&&!wt&&v!==null&&!(i.f&(vt|wi|Lt)))for(f=0;f<Dt.length;f++)En(Dt[f],i);return r!==null&&ra++,c}finally{Qe=e,st=t,Dt=a,Ae=r,Ut=n,Ct=s,ta(o),wt=u}}function Ys(i,e){let t=e.reactions;if(t!==null){var a=ts.call(t,i);if(a!==-1){var r=t.length-1;r===0?t=e.reactions=null:(t[a]=t[r],t.pop())}}t===null&&e.f&vt&&(Qe===null||!Qe.includes(e))&&(kt(e,wi),e.f&(ut|ea)||(e.f^=ea),pn(e),na(e,0))}function na(i,e){var t=i.deps;if(t!==null)for(var a=e;a<t.length;a++)Ys(i,t[a])}function pr(i){var e=i.f;if(!(e&pa)){kt(i,et);var t=ke,a=Ue;ke=i;try{e&fa?js(i):mn(i),yn(i);var r=Dn(i);i.teardown=typeof r=="function"?r:null,i.wv=Tn;var n=i.deps,s;Na&&_s&&i.f&Lt}catch(o){_a(o,i,t,a||i.ctx)}finally{ke=t}}}function An(){if(fi>1e3){fi=0;try{fs()}catch(i){if(Oi!==null)_a(i,Oi,null);else throw i}}fi++}function xn(i){var e=i.length;if(e!==0){An();var t=vi;vi=!0;try{for(var a=0;a<e;a++){var r=i[a];r.f&et||(r.f^=et);var n=Qs(r);Xs(n)}}finally{vi=t}}}function Xs(i){var e=i.length;if(e!==0)for(var t=0;t<e;t++){var a=i[t];if(!(a.f&(pa|Pt)))try{Hi(a)&&(pr(a),a.deps===null&&a.first===null&&a.nodes_start===null&&(a.teardown===null?_n(a):a.fn=null))}catch(r){_a(r,a,null,a.ctx)}}}function Ks(){if(Bi=!1,fi>1001)return;const i=Kt;Kt=[],xn(i),Bi||(fi=0,Oi=null)}function Sa(i){Ki===Cn&&(Bi||(Bi=!0,queueMicrotask(Ks))),Oi=i;for(var e=i;e.parent!==null;){e=e.parent;var t=e.f;if(t&(qi|qt)){if(!(t&et))return;e.f^=et}}Kt.push(e)}function Qs(i){var e=[],t=i.first;e:for(;t!==null;){var a=t.f,r=(a&qt)!==0,n=r&&(a&et)!==0,s=t.next;if(!n&&!(a&Pt)){if(a&Ir)e.push(t);else if(r)t.f^=et;else{var o=Ae;try{Ae=t,Hi(t)&&pr(t)}catch(c){_a(c,t,null,t.ctx)}finally{Ae=o}}var u=t.first;if(u!==null){t=u;continue}}if(s===null){let c=t.parent;for(;c!==null;){if(i===c)break e;var l=c.next;if(l!==null){t=l;continue e}c=c.parent}}t=s}return e}function hr(i){var e=Ki,t=Kt;try{An();const r=[];Ki=Zs,Kt=r,Bi=!1,xn(t);var a=i==null?void 0:i();return Us(),(Kt.length>0||r.length>0)&&hr(),fi=0,Oi=null,a}finally{Ki=e,Kt=t}}async function Js(){await Promise.resolve(),hr()}function p(i){var e=i.f,t=(e&vt)!==0;if(jt!==null&&jt.add(i),Ae!==null&&!wt){Ct!==null&&Ct.includes(i)&&ys();var a=Ae.deps;i.rv<ra&&(i.rv=ra,Qe===null&&a!==null&&a[st]===i?st++:Qe===null?Qe=[i]:(!Ut||!Qe.includes(i))&&Qe.push(i))}else if(t&&i.deps===null&&i.effects===null){var r=i,n=r.parent;n!==null&&!(n.f&ut)&&(r.f^=ut)}return t&&(r=i,Hi(r)&&hn(r)),i.v}function Is(i){var e=jt;jt=new Set;var t=jt,a;try{if(_t(i),e!==null)for(a of jt)e.add(a)}finally{jt=e}return t}function Qi(i){var e=Is(()=>_t(i));for(var t of e)if(t.f&tn)for(const a of t.deps||[])a.f&vt||Zt(a,a.v);else Zt(t,t.v)}function _t(i){var e=wt;try{return wt=!0,i()}finally{wt=e}}const el=-7169;function kt(i,e){i.f=i.f&el|e}function tl(i){if(!(typeof i!="object"||!i||i instanceof EventTarget)){if(Ft in i)Ra(i);else if(!Array.isArray(i))for(let e in i){const t=i[e];typeof t=="object"&&t&&Ft in t&&Ra(t)}}}function Ra(i,e=new Set){if(typeof i=="object"&&i!==null&&!(i instanceof EventTarget)&&!e.has(i)){e.add(i),i instanceof Date&&i.getTime();for(let a in i)try{Ra(i[a],e)}catch{}const t=lr(i);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const a=Jr(t);for(let r in a){const n=a[r].get;if(n)try{n.call(i)}catch{}}}}}const il=["touchstart","touchmove"];function al(i){return il.includes(i)}let Er=!1;function rl(){Er||(Er=!0,document.addEventListener("reset",i=>{Promise.resolve().then(()=>{var e;if(!i.defaultPrevented)for(const t of i.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function gr(i){var e=Ae,t=ke;ft(null),pt(null);try{return i()}finally{ft(e),pt(t)}}function ba(i,e,t,a=t){i.addEventListener(e,()=>gr(t));const r=i.__on_r;r?i.__on_r=()=>{r(),a(!0)}:i.__on_r=()=>a(!0),rl()}const Mn=new Set,Ha=new Set;function nl(i,e,t,a={}){function r(n){if(a.capture||Ei.call(e,n),!n.cancelBubble)return gr(()=>t==null?void 0:t.call(this,n))}return i.startsWith("pointer")||i.startsWith("touch")||i==="wheel"?ii(()=>{e.addEventListener(i,r,a)}):e.addEventListener(i,r,a),r}function $e(i,e,t,a,r){var n={capture:a,passive:r},s=nl(i,e,t,n);(e===document.body||e===window||e===document)&&ur(()=>{e.removeEventListener(i,s,n)})}function $i(i){for(var e=0;e<i.length;e++)Mn.add(i[e]);for(var t of Ha)t(i)}function Ei(i){var E;var e=this,t=e.ownerDocument,a=i.type,r=((E=i.composedPath)==null?void 0:E.call(i))||[],n=r[0]||i.target,s=0,o=i.__root;if(o){var u=r.indexOf(o);if(u!==-1&&(e===document||e===window)){i.__root=e;return}var l=r.indexOf(e);if(l===-1)return;u<=l&&(s=u)}if(n=r[s]||i.target,n!==e){Qr(i,"currentTarget",{configurable:!0,get(){return n||t}});var c=Ae,v=ke;ft(null),pt(null);try{for(var f,h=[];n!==null;){var y=n.assignedSlot||n.parentNode||n.host||null;try{var b=n["__"+a];if(b!==void 0&&!n.disabled)if(nr(b)){var[m,...S]=b;m.apply(n,[i,...S])}else b.call(n,i)}catch(F){f?h.push(F):f=F}if(i.cancelBubble||y===e||y===null)break;n=y}if(f){for(let F of h)queueMicrotask(()=>{throw F});throw f}}finally{i.__root=e,delete i.currentTarget,ft(c),pt(v)}}}function sl(i){var e=document.createElement("template");return e.innerHTML=i,e.content}function sa(i,e){var t=ke;t.nodes_start===null&&(t.nodes_start=i,t.nodes_end=e)}function C(i,e){var t=(e&Ps)!==0,a=(e&Fs)!==0,r,n=!i.startsWith("<!>");return()=>{r===void 0&&(r=sl(n?i:"<!>"+i),t||(r=ia(r)));var s=a||un?document.importNode(r,!0):r.cloneNode(!0);if(t){var o=ia(s),u=s.lastChild;sa(o,u)}else sa(s,s);return s}}function Yt(i=""){{var e=ga(i+"");return sa(e,e),e}}function Be(){var i=document.createDocumentFragment(),e=document.createComment(""),t=ga();return i.append(e,t),sa(e,t),i}function w(i,e){i!==null&&i.before(e)}let $a=!0;function k(i,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(i.__t??(i.__t=i.nodeValue))&&(i.__t=t,i.nodeValue=t+"")}function ll(i,e){return ol(i,e)}const ni=new Map;function ol(i,{target:e,anchor:t,props:a={},events:r,context:n,intro:s=!0}){Os();var o=new Set,u=v=>{for(var f=0;f<v.length;f++){var h=v[f];if(!o.has(h)){o.add(h);var y=al(h);e.addEventListener(h,Ei,{passive:y});var b=ni.get(h);b===void 0?(document.addEventListener(h,Ei,{passive:y}),ni.set(h,1)):ni.set(h,b+1)}}};u(sr(Mn)),Ha.add(u);var l=void 0,c=$s(()=>{var v=t??e.appendChild(ga());return ti(()=>{if(n){Ve({});var f=Ue;f.c=n}r&&(a.$$events=r),$a=s,l=i(v,a)||{},$a=!0,n&&We()}),()=>{var y;for(var f of o){e.removeEventListener(f,Ei);var h=ni.get(f);--h===0?(document.removeEventListener(f,Ei),ni.delete(f)):ni.set(f,h)}Ha.delete(u),v!==t&&((y=v.parentNode)==null||y.removeChild(v))}});return cl.set(l,c),l}let cl=new WeakMap;const Aa=0,zi=1,xa=2;function Di(i,e,t,a,r){var n=i,s=Ci(),o=Ue,u=ze,l,c,v,f=(s?Ke:yi)(void 0),h=(s?Ke:yi)(void 0),y=!1;function b(S,E){y=!0,E&&(pt(m),ft(m),ta(o));try{S===Aa&&t&&(l?mi(l):l=ti(()=>t(n))),S===zi&&a&&(c?mi(c):c=ti(()=>a(n,f))),S!==Aa&&l&&Jt(l,()=>l=null),S!==zi&&c&&Jt(c,()=>c=null),S!==xa&&v&&Jt(v,()=>v=null)}finally{E&&(ta(null),ft(null),pt(null),hr())}}var m=ma(()=>{if(u!==(u=e())){if(ns(u)){var S=u;y=!1,S.then(E=>{S===u&&(Zt(f,E),b(zi,!0))},E=>{if(S===u)throw Zt(h,E),b(xa,!0),h.v}),ii(()=>{y||b(Aa,!0)})}else Zt(f,u),b(zi,!1);return()=>u=ze}})}function j(i,e,t=!1){var a=i,r=null,n=null,s=ze,o=t?ha:0,u=!1;const l=(v,f=!0)=>{u=!0,c(f,v)},c=(v,f)=>{s!==(s=v)&&(s?(r?mi(r):f&&(r=ti(()=>f(a))),n&&Jt(n,()=>{n=null})):(n?mi(n):f&&(n=ti(()=>f(a))),r&&Jt(r,()=>{r=null})))};ma(()=>{u=!1,e(l),u||c(null,null)},o)}function de(i,e){return e}function dl(i,e,t,a){for(var r=[],n=e.length,s=0;s<n;s++)vr(e[s].e,r,!0);var o=n>0&&r.length===0&&t!==null;if(o){var u=t.parentNode;Ns(u),u.append(t),a.clear(),Rt(i,e[0].prev,e[n-1].next)}Sn(r,()=>{for(var l=0;l<n;l++){var c=e[l];o||(a.delete(c.k),Rt(i,c.prev,c.next)),Gt(c.e,!o)}})}function ue(i,e,t,a,r,n=null){var s=i,o={flags:e,items:new Map,first:null},u=(e&sn)!==0;if(u){var l=i;s=l.appendChild(ga())}var c=null,v=!1,f=ge(()=>{var h=t();return nr(h)?h:h==null?[]:sr(h)});ma(()=>{var h=p(f),y=h.length;v&&y===0||(v=y===0,ul(h,o,s,r,e,a,t),n!==null&&(y===0?c?mi(c):c=ti(()=>n(s)):c!==null&&Jt(c,()=>{c=null})),p(f))})}function ul(i,e,t,a,r,n,s){var ie,B,W,fe;var o=(r&bs)!==0,u=(r&(cr|dr))!==0,l=i.length,c=e.items,v=e.first,f=v,h,y=null,b,m=[],S=[],E,F,q,T;if(o)for(T=0;T<l;T+=1)E=i[T],F=n(E,T),q=c.get(F),q!==void 0&&((ie=q.a)==null||ie.measure(),(b??(b=new Set)).add(q));for(T=0;T<l;T+=1){if(E=i[T],F=n(E,T),q=c.get(F),q===void 0){var x=f?f.e.nodes_start:t;y=fl(x,e,y,y===null?e.first:y.next,E,F,T,a,r,s),c.set(F,y),m=[],S=[],f=y.next;continue}if(u&&vl(q,E,T,r),q.e.f&Pt&&(mi(q.e),o&&((B=q.a)==null||B.unfix(),(b??(b=new Set)).delete(q))),q!==f){if(h!==void 0&&h.has(q)){if(m.length<S.length){var Z=S[0],M;y=Z.prev;var re=m[0],V=m[m.length-1];for(M=0;M<m.length;M+=1)Dr(m[M],Z,t);for(M=0;M<S.length;M+=1)h.delete(S[M]);Rt(e,re.prev,V.next),Rt(e,y,re),Rt(e,V,Z),f=Z,y=V,T-=1,m=[],S=[]}else h.delete(q),Dr(q,f,t),Rt(e,q.prev,q.next),Rt(e,q,y===null?e.first:y.next),Rt(e,y,q),y=q;continue}for(m=[],S=[];f!==null&&f.k!==F;)f.e.f&Pt||(h??(h=new Set)).add(f),S.push(f),f=f.next;if(f===null)continue;q=f}m.push(q),y=q,f=q.next}if(f!==null||h!==void 0){for(var ne=h===void 0?[]:sr(h);f!==null;)f.e.f&Pt||ne.push(f),f=f.next;var xe=ne.length;if(xe>0){var Re=r&sn&&l===0?t:null;if(o){for(T=0;T<xe;T+=1)(W=ne[T].a)==null||W.measure();for(T=0;T<xe;T+=1)(fe=ne[T].a)==null||fe.fix()}dl(e,ne,Re,c)}}o&&ii(()=>{var D;if(b!==void 0)for(q of b)(D=q.a)==null||D.apply()}),ke.first=e.first&&e.first.e,ke.last=y&&y.e}function vl(i,e,t,a){a&cr&&Zt(i.v,e),a&dr?Zt(i.i,t):i.i=t}function fl(i,e,t,a,r,n,s,o,u,l){var c=(u&cr)!==0,v=(u&ws)===0,f=c?v?yi(r):Ke(r):r,h=u&dr?Ke(s):s,y={i:h,v:f,k:n,a:null,e:null,prev:t,next:a};try{return y.e=ti(()=>o(i,f,h,l),cn),y.e.prev=t&&t.e,y.e.next=a&&a.e,t===null?e.first=y:(t.next=y,t.e.next=y.e),a!==null&&(a.prev=y,a.e.prev=y.e),y}finally{}}function Dr(i,e,t){for(var a=i.next?i.next.e.nodes_start:t,r=e?e.e.nodes_start:t,n=i.e.nodes_start;n!==a;){var s=ya(n);r.before(n),n=s}}function Rt(i,e,t){e===null?i.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Pn(i){var e,t,a="";if(typeof i=="string"||typeof i=="number")a+=i;else if(typeof i=="object")if(Array.isArray(i)){var r=i.length;for(e=0;e<r;e++)i[e]&&(t=Pn(i[e]))&&(a&&(a+=" "),a+=t)}else for(t in i)i[t]&&(a&&(a+=" "),a+=t);return a}function pl(){for(var i,e,t=0,a="",r=arguments.length;t<r;t++)(i=arguments[t])&&(e=Pn(i))&&(a&&(a+=" "),a+=e);return a}function si(i){return typeof i=="object"?pl(i):i??""}function Bt(i,e,t,a){var r=i.__attributes??(i.__attributes={});r[e]!==(r[e]=t)&&(e==="style"&&"__styles"in i&&(i.__styles={}),e==="loading"&&(i[cs]=t),t==null?i.removeAttribute(e):typeof t!="string"&&hl(i).includes(e)?i[e]=t:i.setAttribute(e,t))}var Ar=new Map;function hl(i){var e=Ar.get(i.nodeName);if(e)return e;Ar.set(i.nodeName,e=[]);for(var t,a=i,r=Element.prototype;r!==a;){t=Jr(a);for(var n in t)t[n].set&&e.push(n);a=lr(a)}return e}function ye(i,e,t){var a=i.__className,r=gl(e,t);(a!==r||cn)&&(e==null&&!t?i.removeAttribute("class"):i.className=r,i.__className=r)}function gl(i,e){return(i??"")+(e?" "+e:"")}const yl=()=>performance.now(),xt={tick:i=>requestAnimationFrame(i),now:()=>yl(),tasks:new Set};function Fn(){const i=xt.now();xt.tasks.forEach(e=>{e.c(i)||(xt.tasks.delete(e),e.f())}),xt.tasks.size!==0&&xt.tick(Fn)}function ml(i){let e;return xt.tasks.size===0&&xt.tick(Fn),{promise:new Promise(t=>{xt.tasks.add(e={c:i,f:t})}),abort(){xt.tasks.delete(e)}}}function Vi(i,e){gr(()=>{i.dispatchEvent(new CustomEvent(e))})}function _l(i){if(i==="float")return"cssFloat";if(i==="offset")return"cssOffset";if(i.startsWith("--"))return i;const e=i.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function xr(i){const e={},t=i.split(";");for(const a of t){const[r,n]=a.split(":");if(!r||n===void 0)break;const s=_l(r.trim());e[s]=n.trim()}return e}const Sl=i=>i;function li(i,e,t,a){var r=(i&As)!==0,n=(i&xs)!==0,s=r&&n,o=(i&Ms)!==0,u=s?"both":r?"in":"out",l,c=e.inert,v=e.style.overflow,f,h;function y(){var F=Ae,q=ke;ft(null),pt(null);try{return l??(l=t()(e,(a==null?void 0:a())??{},{direction:u}))}finally{ft(F),pt(q)}}var b={is_global:o,in(){var F;if(e.inert=c,!r){h==null||h.abort(),(F=h==null?void 0:h.reset)==null||F.call(h);return}n||f==null||f.abort(),Vi(e,"introstart"),f=ja(e,y(),h,1,()=>{Vi(e,"introend"),f==null||f.abort(),f=l=void 0,e.style.overflow=v})},out(F){if(!n){F==null||F(),l=void 0;return}e.inert=!0,Vi(e,"outrostart"),h=ja(e,y(),f,0,()=>{Vi(e,"outroend"),F==null||F()})},stop:()=>{f==null||f.abort(),h==null||h.abort()}},m=ke;if((m.transitions??(m.transitions=[])).push(b),r&&$a){var S=o;if(!S){for(var E=m.parent;E&&E.f&ha;)for(;(E=E.parent)&&!(E.f&fa););S=!E||(E.f&en)!==0}S&&ki(()=>{_t(()=>b.in())})}}function ja(i,e,t,a,r){var n=a===1;if(rs(e)){var s,o=!1;return ii(()=>{if(!o){var m=e({direction:n?"in":"out"});s=ja(i,m,t,a,r)}}),{abort:()=>{o=!0,s==null||s.abort()},deactivate:()=>s.deactivate(),reset:()=>s.reset(),t:()=>s.t()}}if(t==null||t.deactivate(),!(e!=null&&e.duration))return r(),{abort:mt,deactivate:mt,reset:mt,t:()=>a};const{delay:u=0,css:l,tick:c,easing:v=Sl}=e;var f=[];if(n&&t===void 0&&(c&&c(0,1),l)){var h=xr(l(0,1));f.push(h,h)}var y=()=>1-a,b=i.animate(f,{duration:u});return b.onfinish=()=>{var m=(t==null?void 0:t.t())??1-a;t==null||t.abort();var S=a-m,E=e.duration*Math.abs(S),F=[];if(E>0){var q=!1;if(l)for(var T=Math.ceil(E/16.666666666666668),x=0;x<=T;x+=1){var Z=m+S*v(x/T),M=xr(l(Z,1-Z));F.push(M),q||(q=M.overflow==="hidden")}q&&(i.style.overflow="hidden"),y=()=>{var re=b.currentTime;return m+S*v(re/E)},c&&ml(()=>{if(b.playState!=="running")return!1;var re=y();return c(re,1-re),!0})}b=i.animate(F,{duration:E,fill:"forwards"}),b.onfinish=()=>{y=()=>a,c==null||c(a,1-a),r()}},{abort:()=>{b&&(b.cancel(),b.effect=null,b.onfinish=mt)},deactivate:()=>{r=mt},reset:()=>{a===0&&(c==null||c(1,0))},t:()=>y()}}function Ua(i,e,t=e){var a=Ci();ba(i,"input",r=>{var n=r?i.defaultValue:i.value;if(n=Pa(i)?Fa(n):n,t(n),a&&n!==(n=e())){var s=i.selectionStart,o=i.selectionEnd;i.value=n??"",o!==null&&(i.selectionStart=s,i.selectionEnd=Math.min(o,i.value.length))}}),_t(e)==null&&i.value&&t(Pa(i)?Fa(i.value):i.value),Ri(()=>{var r=e();Pa(i)&&r===Fa(i.value)||i.type==="date"&&!r&&!i.value||r!==i.value&&(i.value=r??"")})}const Ma=new Set;function oi(i,e,t,a,r=a){var n=t.getAttribute("type")==="checkbox",s=i;if(e!==null)for(var o of e)s=s[o]??(s[o]=[]);s.push(t),ba(t,"change",()=>{var u=t.__value;n&&(u=wl(s,u,t.checked)),r(u)},()=>r(n?[]:null)),Ri(()=>{var u=a();n?(u=u||[],t.checked=u.includes(t.__value)):t.checked=dn(t.__value,u)}),ur(()=>{var u=s.indexOf(t);u!==-1&&s.splice(u,1)}),Ma.has(s)||(Ma.add(s),ii(()=>{s.sort((u,l)=>u.compareDocumentPosition(l)===4?-1:1),Ma.delete(s)})),ii(()=>{})}function bl(i,e,t=e){ba(i,"change",a=>{var r=a?i.defaultChecked:i.checked;t(r)}),_t(e)==null&&t(i.checked),Ri(()=>{var a=e();i.checked=!!a})}function wl(i,e,t){for(var a=new Set,r=0;r<i.length;r+=1)i[r].checked&&a.add(i[r].__value);return t||a.delete(e),Array.from(a)}function Pa(i){var e=i.type;return e==="number"||e==="range"}function Fa(i){return i===""?null:+i}function Bn(i,e,t){if(i.multiple)return Tl(i,e);for(var a of i.options){var r=Ai(a);if(dn(r,e)){a.selected=!0;return}}(!t||e!==void 0)&&(i.selectedIndex=-1)}function Cl(i,e){ki(()=>{var t=new MutationObserver(()=>{var a=i.__value;Bn(i,a)});return t.observe(i,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{t.disconnect()}})}function Ji(i,e,t=e){var a=!0;ba(i,"change",r=>{var n=r?"[selected]":":checked",s;if(i.multiple)s=[].map.call(i.querySelectorAll(n),Ai);else{var o=i.querySelector(n)??i.querySelector("option:not([disabled])");s=o&&Ai(o)}t(s)}),ki(()=>{var r=e();if(Bn(i,r,a),a&&r===void 0){var n=i.querySelector(":checked");n!==null&&(r=Ai(n),t(r))}i.__value=r,a=!1}),Cl(i)}function Tl(i,e){for(var t of i.options)t.selected=~e.indexOf(Ai(t))}function Ai(i){return"__value"in i?i.__value:i.value}function Mr(i,e){return i===e||(i==null?void 0:i[Ft])===e}function kl(i={},e,t,a){return ki(()=>{var r,n;return Ri(()=>{r=n,n=[],_t(()=>{i!==t(...n)&&(e(i,...n),r&&Mr(t(...r),i)&&e(null,...r))})}),()=>{ii(()=>{n&&Mr(t(...n),i)&&e(null,...n)})}}),i}function ot(i=!1){const e=Ue,t=e.l.u;if(!t)return;let a=()=>tl(e.s);if(i){let r=0,n={};const s=ei(()=>{let o=!1;const u=e.s;for(const l in u)u[l]!==n[l]&&(n[l]=u[l],o=!0);return o&&r++,r});a=()=>p(s)}t.b.length&&Hs(()=>{Pr(e,a),qa(t.b)}),Cr(()=>{const r=_t(()=>t.m.map(ss));return()=>{for(const n of r)typeof n=="function"&&n()}}),t.a.length&&Cr(()=>{Pr(e,a),qa(t.a)})}function Pr(i,e){if(i.l.s)for(const t of i.l.s)p(t);e()}function On(i,e,t){if(i==null)return e(void 0),mt;const a=_t(()=>i.subscribe(e,t));return a.unsubscribe?()=>a.unsubscribe():a}const ci=[];function El(i,e=mt){let t=null;const a=new Set;function r(o){if(nn(i,o)&&(i=o,t)){const u=!ci.length;for(const l of a)l[1](),ci.push(l,i);if(u){for(let l=0;l<ci.length;l+=2)ci[l][0](ci[l+1]);ci.length=0}}}function n(o){r(o(i))}function s(o,u=mt){const l=[o,u];return a.add(l),a.size===1&&(t=e(r,n)||mt),o(i),()=>{a.delete(l),a.size===0&&t&&(t(),t=null)}}return{set:r,update:n,subscribe:s}}function Dl(i){let e;return On(i,t=>e=t)(),e}let Wi=!1,Za=Symbol();function Al(i,e,t){const a=t[e]??(t[e]={store:null,source:yi(void 0),unsubscribe:mt});if(a.store!==i&&!(Za in t))if(a.unsubscribe(),a.store=i??null,i==null)a.source.v=void 0,a.unsubscribe=mt;else{var r=!0;a.unsubscribe=On(i,n=>{r?a.source.v=n:Q(a.source,n)}),r=!1}return i&&Za in t?Dl(i):p(a.source)}function xl(){const i={};function e(){ur(()=>{for(var t in i)i[t].unsubscribe();Qr(i,Za,{enumerable:!1,value:!0})})}return[i,e]}function Ml(i){var e=Wi;try{return Wi=!1,[i(),Wi]}finally{Wi=e}}function De(i,e,t,a){var Z;var r=(t&Cs)!==0,n=!Li||(t&Ts)!==0,s=(t&Es)!==0,o=(t&Ds)!==0,u=!1,l;s?[l,u]=Ml(()=>i[e]):l=i[e];var c=Ft in i||os in i,v=s&&(((Z=ui(i,e))==null?void 0:Z.set)??(c&&e in i&&(M=>i[e]=M)))||void 0,f=a,h=!0,y=!1,b=()=>(y=!0,h&&(h=!1,o?f=_t(a):f=a),f);l===void 0&&a!==void 0&&(v&&n&&ps(),l=b(),v&&v(l));var m;if(n)m=()=>{var M=i[e];return M===void 0?b():(h=!0,y=!1,M)};else{var S=(r?ei:ge)(()=>i[e]);S.f|=tn,m=()=>{var M=p(S);return M!==void 0&&(f=void 0),M===void 0?f:M}}if(!(t&ks))return m;if(v){var E=i.$$legacy;return function(M,re){return arguments.length>0?((!n||!re||E||u)&&v(re?m():M),M):m()}}var F=!1,q=!1,T=yi(l),x=ei(()=>{var M=m(),re=p(T);return F?(F=!1,q=!0,re):(q=!1,T.v=M)});return r||(x.equals=or),function(M,re){if(jt!==null&&(F=q,m(),p(T)),arguments.length>0){const V=re?p(x):n&&s?$t(M):M;return x.equals(V)||(F=!0,Q(T,V),y&&f!==void 0&&(f=V),_t(()=>p(x))),M}return p(x)}}const Pl="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Pl);Ss();class Fl{constructor(e,t,a){d(this,"_dbname");d(this,"_dbversion");d(this,"dbPromise");d(this,"getTran",async(e,t)=>(await this.dbPromise).transaction(e,t));d(this,"reset",async()=>(await indexedDB.databases().then(e=>{console.log(e)}),await new Promise((e,t)=>{const a=indexedDB.deleteDatabase(this._dbname);a.onsuccess=()=>{console.log("onsuccess"),e()},a.onerror=r=>{console.log("onerror"),t(r)}})));d(this,"getAll",async e=>{const t=await this.dbPromise;return new Promise((a,r)=>{const o=t.transaction([e],"readonly").objectStore(e).getAll();o.onsuccess=()=>{a(o.result)},o.onerror=u=>{r(u)}})});d(this,"get",async(e,t)=>{const a=await this.dbPromise;return new Promise((r,n)=>{const u=a.transaction([e],"readonly").objectStore(e).get(t);u.onsuccess=()=>{r(u.result)},u.onerror=l=>{n(l)}})});d(this,"getMany",async(e,t)=>{const n=(await this.dbPromise).transaction([e],"readonly").objectStore(e),s=t.map(o=>new Promise((u,l)=>{const c=n.get(o);c.onsuccess=()=>{u(c.result)},c.onerror=v=>{l(v)}}));return await Promise.all(s)});d(this,"putRecords",async(e,t)=>{const r=(await this.dbPromise).transaction([e],"readwrite"),n=r.objectStore(e),s=t.map(o=>({record:o,request:n.put(o)}));return new Promise((o,u)=>{r.oncomplete=()=>o(s.map(l=>Object.assign({id:l.request.result},l.record))),r.onerror=l=>u(l)})});d(this,"deleteRecords",async(e,t)=>{const r=(await this.dbPromise).transaction([e],"readwrite"),n=r.objectStore(e),s=t.map(o=>({key:o,request:n.delete(o)}));return new Promise((o,u)=>{r.oncomplete=()=>{console.log(s.map(l=>l.request.result)),o()},r.onerror=l=>u(l)})});this._dbname=e,this._dbversion=t,this.dbPromise=new Promise((r,n)=>{const s=indexedDB.open(e,t);s.onsuccess=o=>{if(console.log(o),!o.target){console.log("event.target is undefined"),n("event.target is undefined");return}const u=o.target.result;if(!u){console.log("event.target.result is undefined"),n("event.target.result is undefined");return}u.onversionchange=l=>{console.log(l),u.close()},r(u)},s.onupgradeneeded=o=>{console.log("onupgradeneeded");const u=o.target.result;a.filter(l=>!u.objectStoreNames.contains(l)).map(l=>u.createObjectStore(l,{keyPath:"id",autoIncrement:!0}))},s.onerror=o=>{console.log(o),n(o)},s.onblocked=o=>{console.log(o),n(o)}}),console.log(this.dbPromise)}get dbversion(){return this._dbversion}}class Je{constructor(){d(this,"handlers",[])}append(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}trigger(e){this.handlers.slice(0).filter(t=>t(e)==="RemoveMe").forEach(t=>this.remove(t))}clear(){this.handlers.splice(0)}expose(){return this}}class Fr{constructor(){d(this,"handlers",[])}append(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}async trigger(e){const t=await Promise.all(this.handlers.slice(0).map(async a=>{const r=await a(e);return{h:a,result:r}}));console.log(t),t.filter(a=>a.result==="RemoveMe").map(a=>a.h).forEach(a=>this.remove(a))}clear(){this.handlers.splice(0)}expose(){return this}}class Br{constructor(){d(this,"handler")}set(e){this.handler=e}async call(e){if(!this.handler)throw Error("illegal state error");return await this.handler(e)}expose(){return this}}class yr{constructor(e,t,a,r){d(this,"_name");d(this,"_createVersion");d(this,"mountResolver",()=>{});d(this,"_indexedDb");d(this,"onInsertEvent",new Je);d(this,"onBeforeInsertEvent",new Br);d(this,"onUpdateEvent",new Je);d(this,"onBeforeUpdateEvent",new Br);d(this,"onDeleteEvent",new Je);d(this,"prepareInitialRecords",()=>{const e=new Date;return this._prepareInitialRecords().map(t=>Object.assign(t,{createdAt:e,updatedAt:e,dbVersion:this._createVersion}))});d(this,"resolveMount",()=>this.mountResolver());d(this,"patchForInsert",(e,t)=>{e.newRecords.forEach(a=>{t[a.id]=a})});d(this,"patchForUpdate",(e,t)=>{e.recordPairs.forEach(a=>{t[a.newRecord.id]={...a.newRecord}})});d(this,"patchForDelete",(e,t)=>{e.oldRecords.forEach(a=>{delete t[a.id]})});this._indexedDb=e,this._name=t,this._createVersion=e.dbversion,this.getAll().then(n=>n.reduce((s,o)=>(s[o.id]=o,s),{})).then(n=>{console.log(this.name,n),this.onBeforeInsertEvent.set(a??(()=>Promise.resolve())),this.onBeforeUpdateEvent.set(r??(()=>Promise.resolve()))})}get name(){return this._name}get createVersion(){return this._createVersion}get oninsert(){return this.onInsertEvent.expose()}get onbeforeinsert(){return this.onBeforeInsertEvent.expose()}get onupdate(){return this.onUpdateEvent.expose()}get onbeforeupdate(){return this.onBeforeUpdateEvent.expose()}get ondelete(){return this.onDeleteEvent.expose()}getAll(){return this._indexedDb.getAll(this.name)}get(e){return this._indexedDb.get(this.name,e)}async insertMany(e){const t=new Date,a=e.map(n=>{const s={createdAt:t,updatedAt:t,dbVersion:this._createVersion};return Object.assign(n,s)});await this.onBeforeInsertEvent.call({sender:this,newRecords:a,timestamp:t});const r=await this._indexedDb.putRecords(this.name,a);return this.onInsertEvent.trigger({sender:this,newRecords:r,timestamp:t}),r}async insert(e){return(await this.insertMany([e]))[0]}async updateMany(e,t){const a=new Date,r=[];return(await this._indexedDb.getMany(this.name,e)).forEach(s=>{const o={...s},u={...o};r.push({newRecord:Object.assign(t(u),{updatedAt:a,dbVersion:this._createVersion}),oldRecord:o})}),await this.onBeforeUpdateEvent.call({sender:this,recordPairs:r,timestamp:a}),await this._indexedDb.putRecords(this.name,r.map(s=>s.newRecord)),this.onUpdateEvent.trigger({sender:this,recordPairs:r,timestamp:a}),r.map(s=>s.newRecord)}async update(e,t){return(await this.updateMany([e],t))[0]}async delete(e){const t=new Date,a=await this._indexedDb.getMany(this.name,e);await this._indexedDb.deleteRecords(this.name,e),this.onDeleteEvent.trigger({sender:this,oldRecords:a,timestamp:t})}}const Or=(...i)=>i.length?i.reduce((e,t)=>e>t?e:t):-Number.MAX_VALUE,Ga=(...i)=>i.length?i.reduce((e,t)=>e<t?e:t):Number.MAX_VALUE,dt=class dt{constructor(e){d(this,"id");d(this,"name");d(this,"description");d(this,"previousNpcId");d(this,"previousStartMode");d(this,"save",async e=>{const t=e??{id:this.id,name:this.name,description:this.description,previousNpcId:this.previousNpcId,previousStartMode:this.previousStartMode},a=await dt.tblHeader.update(this.id,r=>({...r,...t}));return new dt(a)});var t;console.log(e),this.id=e.id,this.name=e.name,this.description=e.description,this.previousNpcId=((t=xi.find(a=>a.id===e.previousNpcId))==null?void 0:t.id)??Ga(...xi.map(a=>a.id)),this.previousStartMode=Vo.includes(e.previousStartMode)?e.previousStartMode:"Random"}get npcLvl(){return Number.MAX_VALUE}};d(dt,"tblHeader"),d(dt,"getOrCreateNew",async e=>{dt.tblHeader||(dt.tblHeader=new Bl(e));const t=await dt.tblHeader.getAll();if(t.length)return new dt(t[0]);const a=await dt.tblHeader.insert({name:"あなた",description:"ここの文字列を何に使うかは未定。",previousNpcId:0,previousStartMode:"Random"});return new dt(a)});let za=dt;class Bl extends yr{constructor(t){super(t,"TblDuelistProfile");d(this,"_prepareInitialRecords",()=>[])}}let Ba=-1;const xi=[{id:Ba--,name:"サンドバッグくん棒立ち",description:"攻撃宣言なし、強制効果以外の効果の発動なし。",npcLvl:0},{id:Ba--,name:"サンドバッグくん非暴力",description:"攻撃宣言なし。",npcLvl:100},{id:Ba--,name:"サンドバッグくん白帯",description:"とくに制限なし。",npcLvl:200}],Ol=["Deck","ExtraDeck"],Nl={Deck:"メインデッキ",ExtraDeck:"エクストラデッキ"},Va=["Monster","Spell","Trap","XyzMaterial"],Nn={Monster:"モンスター",Spell:"魔法",Trap:"罠",XyzMaterial:"XYZ素材"},_i=["Fusion","Syncro","Xyz","Link"],qn=[..._i,"SpecialSummon"],ql=["Toon","Spirit","Union","Gemini","FlipEffect"],Ll=["Tuner","Effect","Normal","Pendulum","Token","NormalSummonOnly"],Nr=[...qn,...ql,...Ll],wa={Syncro:"シンクロ",Fusion:"融合",Xyz:"エクシーズ",Link:"リンク",SpecialSummon:"特殊召喚",Toon:"トゥーン",Spirit:"スピリット",Union:"ユニオン",Gemini:"デュアル",FlipEffect:"リバース",Tuner:"チューナー",Effect:"効果",Normal:"通常",Pendulum:"ペンデュラム",Token:"トークン",NormalSummonOnly:"特殊召喚不可"},ji={Syncro:"🎵",Fusion:"🌀",Xyz:"📰",Link:"⛓️",SpecialSummon:"🔯",Toon:"📖",Spirit:"👻",Union:"🚗",Gemini:"👫",FlipEffect:"🔄",Tuner:"🎶",Effect:"✨",Normal:"🔘",Pendulum:"💠",Token:"🐏",NormalSummonOnly:"🔲"},qr=["Light","Dark","Earth","Water","Fire","Wind","Divine"],mr={Light:"光",Dark:"闇",Earth:"地",Water:"水",Fire:"炎",Wind:"風",Divine:"神"},Lr=["Aqua","Beast","BeastWarrior","CreatorGod","Cyberse","Dinosaur","DivineBeast","Dragon","Fairy","Fiend","Fish","Insect","Illusion","Machine","Plant","Psychic","Pyro","Reptile","Rock","SeaSerpent","Spellcaster","Thunder","Warrior","WingedBeast","Wyrm","Zombie"],Rr=["Normal","Continuous","Field","QuickPlay","Equip","Ritual","PendulumScale"],Ui={Normal:"通常",Continuous:"永続",Field:"フィールド",QuickPlay:"速攻",Equip:"装備",Ritual:"儀式",PendulumScale:"ペンデュラム"},Hr=["Normal","Continuous","Counter"],Zi={Normal:"通常",Continuous:"永続",Counter:"カウンター"},Mt=["Attack","Defense"],Yi={Attack:"攻撃表示",Defense:"守備表示",Set:"裏側守備表示"},Ln=["level","rank","attack","defense","pendulumScaleR","pendulumScaleL"],Rl=({wikiName:i,wikiHref:e,wikiTextAll:t,nameKana:a,description:r,pendulumDescription:n,...s})=>s,Hl=i=>Rl(i),Ca={Aqua:"水",Beast:"獣",BeastWarrior:"獣戦士",CreatorGod:"創造神",Cyberse:"サイバース",Dinosaur:"恐竜",DivineBeast:"幻獣神",Dragon:"ドラゴン",Fairy:"天使",Fiend:"悪魔",Fish:"魚",Insect:"昆虫",Illusion:"幻想魔",Machine:"機械",Plant:"植物",Psychic:"サイキック",Pyro:"炎",Reptile:"爬虫類",Rock:"岩石",SeaSerpent:"海竜",Spellcaster:"魔法使い",Thunder:"雷",Warrior:"戦士",WingedBeast:"鳥獣",Wyrm:"幻竜",Zombie:"アンデット"},Gi={Aqua:"🚰",Beast:"🐅",BeastWarrior:"🦁",CreatorGod:"🔆",Cyberse:"💻️",Dinosaur:"🦖",DivineBeast:"💫",Dragon:"🐲",Fairy:"👼",Fiend:"👿",Fish:"🐟️",Insect:"🦋",Illusion:"🤡",Machine:"🤖",Plant:"🌱",Psychic:"👁️",Pyro:"🔥",Reptile:"🦎",Rock:"⛰",SeaSerpent:"🐍",Spellcaster:"🧙",Thunder:"⚡️",Warrior:"⚔️",WingedBeast:"🦅",Wyrm:"🐉",Zombie:"🦴"},$l=i=>i.cardId??!1?`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=2&cid=${i.cardId}`:`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=1&sess=1&rp=10&mode=&sort=1&keyword=${i.name}&stype=1&ctype=&othercon=2&starfr=&starto=&pscalefr=&pscaleto=&linkmarkerfr=&linkmarkerto=&link_m=2&atkfr=&atkto=&deffr=&defto=&releaseDStart=1&releaseMStart=1&releaseYStart=1999&releaseDEnd=&releaseMEnd=&releaseYEnd=`,Mi=(i,e)=>{const t=i.monsterCategories??[],a=e.monsterCategories??[];for(const r of _i.toReversed()){if(t.includes(r)&&!a.includes(r))return 1;if(!t.includes(r)&&a.includes(r))return-1}if(i.kind===e.kind){if(i.kind==="Monster"){if((i.link??0)!==(e.link??0))return(i.link??0)-(e.link??0);if((i.rank??0)!==(e.rank??0))return(i.rank??0)-(e.rank??0);if((i.level??0)!==(e.level??0))return(i.level??0)-(e.level??0);if((i.attack??0)!==(e.attack??0))return(i.attack??0)-(e.attack??0);if((i.defense??0)!==(e.defense??0))return(i.defense??0)-(e.defense??0)}return i.name.localeCompare(e.name,"Ja")}for(const r of Va){if(i.kind===r)return-1;if(e.kind===r)return 1}return i.name.localeCompare(e.name,"Ja")},Rn=["Deck","ExtraDeck"],Hn=[...Rn,"Graveyard","Banished"],jl=[...Hn,"Hand"],Si=["MonsterZone","ExtraMonsterZone"],zt=["SpellAndTrapZone","FieldSpellZone"],bi=[...Si,...zt],$n=["XyzMaterialZone","Disable"],pi=[...jl,...bi,...$n],Wa={0:{0:"Hand"},1:{0:"Deck",1:"SpellAndTrapZone",2:"SpellAndTrapZone",3:"SpellAndTrapZone",4:"SpellAndTrapZone",5:"SpellAndTrapZone",6:"ExtraDeck"},2:{0:"Graveyard",1:"MonsterZone",2:"MonsterZone",3:"MonsterZone",4:"MonsterZone",5:"MonsterZone",6:"FieldSpellZone"},3:{0:"Banished",1:"XyzMaterialZone",2:"ExtraMonsterZone",3:"Disable",4:"ExtraMonsterZone",5:"XyzMaterialZone",6:"Banished"},4:{0:"FieldSpellZone",1:"MonsterZone",2:"MonsterZone",3:"MonsterZone",4:"MonsterZone",5:"MonsterZone",6:"Graveyard"},5:{0:"ExtraDeck",1:"SpellAndTrapZone",2:"SpellAndTrapZone",3:"SpellAndTrapZone",4:"SpellAndTrapZone",5:"SpellAndTrapZone",6:"Deck"},6:{0:"Hand"}};let Ul=class{constructor(e,t,a,r){d(this,"onUpdateEvent",new Je);d(this,"field");d(this,"row");d(this,"column");d(this,"cellType");d(this,"owner");d(this,"_needsShuffle",!1);d(this,"_entities");d(this,"releaseEntities",e=>(this._entities=this._entities.filter(t=>!e.includes(t)),this.onUpdateEvent.trigger(),e));d(this,"acceptEntities",(e,t)=>{t==="Top"?this._entities.unshift(...e):this._entities.push(...e),t==="Random"&&(this._needsShuffle=!0),this._entities.forEach(a=>{a.fieldCell=this}),this.onUpdateEvent.trigger()});d(this,"shuffle",()=>{this._entities=this.entities.shuffle(),this._needsShuffle=!1,this.field.duel.log.info("デッキをシャッフル。",this.owner)});this.field=e,this.row=t,this.column=a,this.cellType=Wa[t][a],this.owner=r,this._entities=[]}get onUpdate(){return this.onUpdateEvent.expose()}get needsShuffle(){return this._needsShuffle}get entities(){return this._entities}get visibleEntities(){return this._entities.filter(e=>Zr.find(t=>t===e.entityType))}get cardEntities(){return this._entities.filter(e=>Zr.find(t=>t===e.entityType)).filter(e=>e.status.kind!=="XyzMaterial")}get xyzMaterials(){return this._entities.filter(e=>e.status.kind==="XyzMaterial")}get targetForAttack(){return this.cellType==="Hand"?this._entities.find(e=>e.entityType==="Duelist"):this.cardEntities[0]}get isAvailable(){return this.cardEntities.length===0&&this._entities.filter(e=>qo.find(t=>t===e.entityType)).length===0}get isAvailableForPendulum(){return this.isAvailable&&this.isSpellTrapZoneLikeCell&&(this.column===1||this.column===5)}get isStackCell(){return Hn.some(e=>e===this.cellType)}get isPlayFieldCell(){return bi.some(e=>e===this.cellType)}get isMonsterZoneLikeCell(){return Si.some(e=>e===this.cellType)}get isSpellTrapZoneLikeCell(){return zt.some(e=>e===this.cellType)}get isDisabledCell(){return $n.some(e=>e===this.cellType)}};Array.prototype.shuffle=function(){return this.map(e=>({item:e,seq:Math.random()})).toSorted((e,t)=>e.seq-t.seq).map(e=>e.item)};Array.prototype.randomPickMany=function(i){return this.shuffle().slice(0,i)};Array.prototype.randomPick=function(){return this.shuffle().slice(0,1)[0]};Array.prototype.reset=function(...i){this.splice(0),this.push(...i)};Array.prototype.union=function(i){return this.filter(e=>i.find(t=>e===t))};Array.prototype.getAllOnOffPattern=function(){const i=[];return this.forEach(e=>{if(i.length==0){i.push([e]),i.push([]);return}i.forEach(t=>i.push([...t,e]))}),i};Array.prototype.getDistinct=function(){return Array.from(new Set(this))};Array.prototype.distinct=function(){this.reset(...this.getDistinct())};const ca=class ca{constructor(e,t,a){d(this,"seq");d(this,"entity");d(this,"_definition");d(this,"validateDuelist",e=>this.entity.controller===e?this.definition.executableDuelistTypes.includes("Controller"):this.definition.executableDuelistTypes.includes("Opponent"));this.seq=e==="AutoSeq"?ca.nextSeq++:e,this.entity=t,this._definition=a}get definition(){return this._definition}get title(){return this.definition.title}get isMandatory(){return this.definition.isMandatory}get executableCells(){return this.definition.executableCells}get executablePeriods(){return this.definition.executablePeriods}get executableDuelistTypes(){return this.definition.executableDuelistTypes}get isOnlyNTimesPerDuel(){return this.definition.isOnlyNTimesPerDuel??0}get isOnlyNTimesPerTurn(){return this.definition.isOnlyNTimesPerTurn??0}get isOnlyNTimesPerTurnIfFaceup(){return this.definition.isOnlyNTimesPerTurnIfFaceup??0}get isOnlyNTimesIfFaceup(){return this.definition.isOnlyNTimesIfFaceup??0}get duel(){return this.entity.duel}};d(ca,"nextSeq",0);let la=ca;const jn=["IgnitionEffect","TriggerEffect","QuickEffect","CardActivation"],Zl=["NormalSummon","SpecialSummon","ChangeBattlePosition","Battle","SpellTrapSet","LingeringEffect"],Gl=i=>i==="CardActivation"?"CardActivation":jn.some(e=>e===i)?"EffectActivation":"NonActivate",$r=["NormalSummon","AdvanceSummon","SpecialSummon","SpecialSummonFromDeck","SendToGraveyardFromDeck","Draw","SearchFromDeck","BanishFromDeck","BanishFromGraveyard","AddToHandFromGraveyard","ReturnToDeckFromGraveyard","SpecialSummonFromGraveyard","BanishFromField","BanishFromHand","Destroy","DestroyMultiple","DestroyOnField","DestroyMultipleOnField","DestroyOnOpponentField","DestroyMultipleOnOpponentField","DestroyMonsterOnField","DestroyMonstersOnField","DestroySpellTrapOnField","DestroySpellTrapsOnField","SpecialSummonFromHand","SpecialSummonFromExtraDeck","IfNormarlSummonSucceed","IfSpecialSummonSucceed","DamageToOpponent","DamageToSelf","PayLifePoint","DiscordAsCost","DiscordAsEffect","RollDice","BounceToHand","NegateCardEffect","NegateCardActivation"],Vt=i=>i.playType==="CardActivation"?i.entity.nm:`${i.entity.nm}«${i.title}»`,Xt=class Xt extends la{constructor(){super(...arguments);d(this,"getClone",()=>new Xt(this.seq,this.entity,this.definition));d(this,"validate",(t,a,r)=>{if(this.playType==="CardActivation"&&this.entity.isOnField&&this.entity.face==="FaceUp"||this.isOnlyNTimesPerDuel>0&&this.entity.field.duel.chainBlockLog.records.filter(o=>!o.chainBlockInfo.isNegatedActivationBy).filter(o=>this.isSame(o.chainBlockInfo.action)).filter(o=>o.chainBlockInfo.activator===t).length>=this.isOnlyNTimesPerDuel||this.isOnlyNTimesPerTurn>0&&this.entity.field.duel.chainBlockLog.records.filter(o=>!o.chainBlockInfo.isNegatedActivationBy).filter(o=>this.isSameGroupPerTurn(o.chainBlockInfo.action)).filter(o=>o.clock.turn===this.entity.field.duel.clock.turn).filter(o=>o.chainBlockInfo.activator===t).length>=this.isOnlyNTimesPerTurn)return;const n=a.filter(o=>o.action.seq===this.seq).length;if(this.isOnlyNTimesPerTurnIfFaceup>0&&this.entity.counterHolder.getActionCount(this)+n>=this.isOnlyNTimesPerTurnIfFaceup||this.isOnlyNTimesIfFaceup>0&&this.entity.counterHolder.getActionCount(this)+n>=this.isOnlyNTimesIfFaceup)return;const s={index:a.length,action:this,activator:t,isActivatedIn:this.entity.fieldCell,isActivatedAt:this.duel.clock.getClone(),costInfo:{},state:"unloaded"};if(!(this.definition.canPayCosts&&!r&&!this.definition.canPayCosts(s,a)))return this.definition.validate(s,a)});d(this,"prepare",async(t,a,r,n,s)=>{var c,v;let o=n;if(this.isLikeContinuousSpell&&(this.entity.info.isPending=!0),this.playType==="CardActivation"||this.playType==="SpellTrapSet")if(this.entity.fieldCell.cellType==="Hand"){let f=a?[a]:this.entity.status.spellCategory==="Field"?[t.getFieldZone()]:t.getAvailableSpellTrapZones();if(this.entity.status.spellCategory==="Field"){const y=t.getFieldZone().cardEntities;if(y.length){const b=y[0];await me.sendManyToGraveyardForTheSameReason(t.getFieldZone().cardEntities,["Rule"],this.entity,t),t.writeInfoLog(`フィールド魔法の上書きにより、${b.toString()}は墓地に送られた。`),o=!1}}(c=this.entity.status.monsterCategories)!=null&&c.includes("Pendulum")&&(f=f.filter(y=>y.isAvailableForPendulum));let h=f[0];if(f.length>1){h=f.randomPick();const y=this.playType==="SpellTrapSet"?"セット":"カードの発動",b=await this.duel.view.waitDammyActions(t,this.entity,f,"カードを移動先へドラッグ",y,o);if(!b)return;h=b}(v=this.entity.status.monsterCategories)!=null&&v.includes("Pendulum")?await this.entity.activateAsPendulumScale(h,["CardActivation"],this.entity,t):this.playType==="CardActivation"?await this.entity.activateSpellTrapFromHand(h,this.entity.status.kind,["CardActivation"],this.entity,t):await this.entity.setAsSpellTrap(h,this.entity.status.kind,["SpellTrapSet"],this.entity,t),o=!1}else this.entity.isOnFieldAsSpellTrap&&this.entity.face==="FaceDown"&&(await this.entity.setNonFieldMonsterPosition(this.entity.origin.kind,"FaceUp",["Rule"]),o=!1);const u={index:r.length,action:this,activator:t,isActivatedIn:this.entity.fieldCell,isActivatedAt:this.duel.clock.getClone(),costInfo:{},state:"ready"};if(this.definition.payCosts&&!s){const f=await this.definition.payCosts(u,r,o);if(!f)return;u.costInfo=f}const l=await this.definition.prepare(u,a,r,o);if(l!==void 0)return{...u,...l}});d(this,"execute",async(t,a)=>{if(t.action.isLikeContinuousSpell&&!t.action.entity.isOnField)return this.entity.info.isPending=!1,!1;const r=await this.definition.execute(t,a);if(t.action.isLikeContinuousSpell)for(const n of this.entity.continuousEffects)this.entity.info.isPending=!1,await n.updateState();return r});d(this,"settle",(t,a)=>(this.isOnlyNTimesPerTurnIfFaceup>0?this.entity.counterHolder.incrementActionCountPerTurn(this):this.isOnlyNTimesIfFaceup>0&&this.entity.counterHolder.incrementActionCount(this),this.definition.settle(t,a)));d(this,"isSame",t=>this.entity.origin.name===t.entity.origin.name&&this.title===t.title);d(this,"isSameGroupPerTurn",t=>this.actionGroupNamePerTurn?this.entity.origin.name===t.entity.origin.name&&this.actionGroupNamePerTurn===t.actionGroupNamePerTurn:this.isSame(t));d(this,"calcChainBlockTagsForDestroy",t=>{if(!$r.length)return[];const a=["Destroy"];$r.length>1&&a.push("DestroyMultiple");const r=t.filter(u=>u.isOnField);r.length&&(a.push("DestroyOnField"),r.length>1&&a.push("DestroyMultipleOnField"));const n=r.filter(u=>u.status.kind==="Monster");n.length&&(a.push("DestroyMonsterOnField"),n.length>1&&a.push("DestroyMonstersOnField")),r.filter(u=>u.status.kind!=="Monster").length&&(a.push("DestroySpellTrapOnField"),n.length>1&&a.push("DestroySpellTrapsOnField"));const o=r.filter(u=>u.controller!==this.entity.controller);return o.length&&(a.push("DestroyOnOpponentField"),o.length>1&&a.push("DestroyMultipleOnOpponentField")),a})}get definition(){return super.definition}get playType(){return this.definition.playType}get spellSpeed(){return this.definition.spellSpeed}get needsToPayCost(){return this.definition.needsToPayCost??!1}get hasToTargetCards(){return this.definition.hasToTargetCards??!1}get isLikeContinuousSpell(){return this.definition.isLikeContinuousSpell||this.entity.isLikeContinuousSpell&&this.playType==="CardActivation"}get actionGroupNamePerTurn(){return this.definition.actionGroupNamePerTurn}get negatePreviousBlock(){return this.definition.negatePreviousBlock??!1}get priorityForNPC(){return this.definition.priorityForNPC??Number.NaN}};d(Xt,"createNew",(t,a)=>new Xt("AutoSeq",t,a)),d(Xt,"createDammyAction",(t,a,r,n)=>{const s=Xt.createNew(t,{title:a,isMandatory:!1,executableCells:[],executablePeriods:[],executableDuelistTypes:[],playType:"Dammy",spellSpeed:"Dammy",validate:()=>r,prepare:async()=>{},execute:async()=>!1,settle:async()=>!1});return s.pos=n,s.cell=r[0],s.dragAndDropOnly=r.length>1,s});let Ot=Xt;class Ta{constructor(){d(this,"pooledOperators",[]);d(this,"bundles",[]);d(this,"excludesExpired",()=>{this.bundles=this.bundles.filter(e=>!e.entity.hasDisappeared),this.bundles.forEach(e=>e.excludesExpired()),this.pooledOperators=this.pooledOperators.filter(e=>e.validateAlive())});d(this,"append",e=>{this.bundles.push(e)});d(this,"push",e=>{if(!e.isContinuous)throw new Se("staticへの追加は永続以外不可",e);this.excludesExpired(),this.distribute(e),this.pooledOperators.push(e)});d(this,"distributeAll",e=>(this.excludesExpired(),this.pooledOperators.flatMap(this.distribute).getDistinct().forEach(t=>t.operators.sort((a,r)=>a.seq-r.seq)),this.afterDistributeAll(e)));d(this,"distribute",e=>this.bundles.filter(t=>t.operators.every(a=>a.seq!==e.seq)).filter(t=>e.isApplicableTo(t.entity)).map(t=>(t.push(e),t)));d(this,"removeItem",e=>{this.pooledOperators=this.pooledOperators.filter(t=>t.seq!==e)})}}class ka{constructor(e,t){d(this,"pool");d(this,"entity");d(this,"_operators");d(this,"excludesExpired",()=>{this._operators=this._operators.filter(e=>{const t=e.validateAlive()&&e.isApplicableTo(this.entity);return t||(console.info(`before remove ${this.entity.toString} ${e.title}`),e.beforeRemove(this)),t})});d(this,"push",e=>{this.entity.procFilterBundle.operators.filter(t=>t.procTypes.includes("Effect")).some(t=>!t.filter(t.effectOwner,t.isSpawnedBy,t.actionAttr,[]))||(this.beforePush(e),this._operators.push(e))});d(this,"removeItem",e=>{this._operators=this._operators.filter(t=>t.seq!==e?!0:(t.beforeRemove(this),!1))});this.pool=e,this.entity=t,this._operators=[],this.pool.append(this)}get operators(){return this._operators}}const da=class da{constructor(e,t,a,r,n,s){d(this,"seq");d(this,"title");d(this,"validateAlive");d(this,"isContinuous");d(this,"isSpawnedBy");d(this,"isSpawnedAt");d(this,"activateType");d(this,"actionAttr");d(this,"isApplicableTo");d(this,"effectOwner");this.seq=da.nextSeq++,this.title=e,this.validateAlive=()=>t(this),this.isContinuous=a,this.isSpawnedBy=r,this.isSpawnedAt=r.duel.clock.getClone(),this.isApplicableTo=o=>s(this,o),this.actionAttr=n,this.activateType=this.actionAttr.playType?Gl(this.actionAttr.playType):"NonActivate",this.effectOwner=this.isSpawnedBy.controller}get isEffective(){return!this.isContinuous||this.activateType==="NonActivate"?!0:this.isSpawnedBy.isEffective}};d(da,"nextSeq",0);let Ni=da;class zl extends Ta{constructor(){super(...arguments);d(this,"afterDistributeAll",()=>this.bundles.every(t=>t.applyEffectFilter()))}}class Vl extends ka{constructor(){super(...arguments);d(this,"applyEffectFilter",()=>{const t=this.entity.allStickyEffectOperators.length,a=[];for(;;){const r=this.operators.filter(n=>n.procTypes.includes("Effect")).filter(n=>n.isContinuous).find(n=>!a.includes(n.seq));if(!r)break;a.push(r.seq),r.eraseOperators(this.entity)}return this.entity.allStickyEffectOperators.length===t});d(this,"beforePush",t=>t.eraseOperators(this.entity))}}class Wl extends Ni{constructor(t,a,r,n,s,o,u,l){super(t,a,r,n,s,o);d(this,"beforeRemove",()=>{});d(this,"procTypes");d(this,"filter");d(this,"eraseOperators",t=>{if(!this.procTypes.includes("Effect"))return 0;console.log("ここはまだ通らない想定");const a=t.allStickyEffectOperators.filter(r=>r.isContinuous).filter(r=>!this.filter(r.effectOwner,r.isSpawnedBy,r.actionAttr,[])).map(r=>r.seq);return a.forEach(t.procFilterBundle.removeItem),a.forEach(t.statusOperatorBundle.removeItem),a.forEach(t.numericOprsBundle.removeItem),a.forEach(t.cardRelationBundle.removeItem),a.length});this.procTypes=u,this.filter=l}}const jr={level:1,rank:1,attack:0,defense:0,pendulumScaleR:0,pendulumScaleL:0};class Yl extends Ta{constructor(){super(...arguments);d(this,"afterDistributeAll",t=>{if(this.bundles.forEach(r=>r.calcStateAll()),t.field.getMonstersOnField().flatMap(r=>r.numericOprsBundle).flatMap(r=>r.operators).some(r=>r.targetStateGen==="calculated")){const n=t.field.getMonstersOnField().filter(s=>(s.atk??0)>=0).map(s=>s.atk??0).reduce((s,o)=>s>o?s:o,0);t.field.getMonstersOnField().forEach(s=>{s.numericOprsBundle.operators.filter(o=>o.targetStateGen==="calculated").forEach(o=>{var u;if(!((u=s.status.monsterCategories)!=null&&u.includes("Link")&&o.targetState==="defense")){if(o.stateOperationType==="THE_DEVILS_AVATAR"){s.numericStatus.calculated[o.targetState]=n+100;return}console.log(s.toString(),s.numericStatus.calculated[o.targetState]),s.numericStatus.calculated[o.targetState]=o.calcValue(s,s.numericStatus.calculated[o.targetState]??0)}})})}return!0})}}class Xl extends ka{constructor(){super(...arguments);d(this,"beforePush",t=>{const a=this.operators.filter(n=>n.targetState===t.targetState).filter(n=>n.isEffective);if(t.kind==="O-L-F"||t.kind==="O-C-F"?(a.filter(n=>n.kind==="O-L-F").forEach(n=>n.negate()),a.filter(n=>n.kind==="L-F").forEach(n=>n.negate())):t.kind==="L-F"||t.kind==="C-F"?a.filter(n=>n.kind==="L-F"||n.kind==="L-A").forEach(n=>n.negate()):t.kind==="X-C-X"&&a.filter(n=>!n.isContinuous).forEach(n=>n.negate()),a.filter(n=>n.isEffective).some(n=>n.kind==="X-C-X")&&!t.isContinuous)return;if(t.stateOperationType!=="Addition"&&t.targetStateGen==="wip"&&a.filter(n=>!n.isContinuous).forEach(n=>n.negate()),t.stateOperationType==="THE_DEVILS_AVATAR"||t.stateOperationType==="Gradius'_Option"){this.entity.numericStatus.calculated[t.targetState]=-Number.MAX_VALUE;return}const r=this.entity.numericStatus.calculated[t.targetState]??0;if(t.stateOperationType==="THE_DEVILS_DREAD-ROOT"){this.entity.numericStatus.calculated[t.targetState]=t.calcValue(this.entity,r);return}if(t.kind==="L-F"){console.log(this.entity.toString(),r),this.entity.numericStatus.wip[t.targetState]=t.calcValue(this.entity,r);return}});d(this,"calcStateAll",()=>Ln.forEach(this.calcState));d(this,"calcState",t=>{if(this.entity.status.kind!=="Monster"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories){this.entity.numericStatus.calculated[t]=void 0;return}if(this.entity.status.monsterCategories.includes("Link")&&t!=="attack"){this.entity.numericStatus.calculated[t]=void 0;return}if(this.entity.status.monsterCategories.includes("Xyz")&&t==="level"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories.includes("Xyz")&&t==="rank"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories.includes("Pendulum")&&(t==="pendulumScaleL"||t==="pendulumScaleR")){this.entity.numericStatus.calculated[t]=void 0;return}if(t!=="level"&&!this.entity.isOnField){this.entity.numericStatus.origin[t]=this.entity.origin[t],this.entity.numericStatus.wip[t]=this.entity.origin[t],this.entity.numericStatus.calculated[t]=this.entity.origin[t];return}const a=this.entity.origin[t]??0,r=this.entity.numericStatus.wip[t]??0,n=this._operators.filter(c=>c.targetState===t).filter(c=>c.isEffective);if(n.some(c=>c.stateOperationType==="THE_DEVILS_AVATAR"||c.stateOperationType==="Gradius'_Option")&&this.entity.isEffective){this.entity.numericStatus.calculated[t]=-Number.MAX_VALUE;return}const s=n.filter(c=>c.targetState===t).findLast(c=>c.targetStateGen==="origin"),o=s?s.calcValue(this.entity,a??0):a;this.entity.numericStatus.origin[t]=o;let u=o;const l=n.filter(c=>c.targetState===t).filter(c=>c.targetStateGen==="wip").findLast(c=>c.stateOperationType==="Fixation");if(!l)u=n.filter(c=>c.stateOperationType==="Addition").reduce((c,v)=>v.calcValue(this.entity,c),u),this.entity.numericStatus.wip[t]=u;else if(l.isContinuous)u=l.calcValue(this.entity,u),u=n.filter(c=>c.stateOperationType==="Addition").reduce((c,v)=>v.calcValue(this.entity,c),u),this.entity.numericStatus.wip[t]=u;else{console.log("hoge");let c=!1;u=n.filter(v=>(c=c||v===l,c&&v!==l)).filter(v=>v.stateOperationType==="Addition").reduce((v,f)=>f.calcValue(this.entity,v),r)}u<jr[t]&&(u=jr[t]),this.entity.numericStatus.calculated[t]=u})}}const Ht=class Ht extends Ni{constructor(t,a,r,n,s,o,u,l,c,v){super(t,a,r,n,s,o);d(this,"beforeRemove",()=>{});d(this,"targetState");d(this,"targetStateGen");d(this,"stateOperationType");d(this,"calcValue");d(this,"_isEffective");d(this,"negate",()=>{this._isEffective=!1});this._isEffective=!0,this.targetState=u,this.targetStateGen=l,this.stateOperationType=c,this.calcValue=(f,h)=>v(this.isSpawnedBy,f,h)}get isEffective(){return this._isEffective&&super.isEffective}get kind(){if(this.targetStateGen==="origin"){if(this.stateOperationType==="Fixation")return this.isContinuous?"O-C-F":"O-L-F";throw new Se("矛盾したプロパティ",this)}if(this.targetStateGen==="wip"){if(this.stateOperationType==="Addition")return this.isContinuous?"C-A":"L-A";if(this.stateOperationType==="Fixation")return this.isContinuous?"C-F":"L-F";throw new Se("矛盾したプロパティ",this)}if(this.stateOperationType==="THE_DEVILS_DREAD-ROOT")return"X-C-F";if(this.stateOperationType==="THE_DEVILS_AVATAR"||this.stateOperationType==="Gradius'_Option")return"X-C-X";throw new Se("矛盾したプロパティ",this)}};d(Ht,"createContinuous",(t,a,r,n,s,o,u,l)=>new Ht(t,a,!0,r,{},n,s,o,u,l)),d(Ht,"createLingeringFixation",(t,a,r,n,s,o)=>new Ht(t,a,!1,r,n,()=>!0,s,"wip","Fixation",o)),d(Ht,"createLingeringAddition",(t,a,r,n,s,o)=>new Ht(t,a,!1,r,n,()=>!0,s,"wip","Addition",o));let ht=Ht;const Un=i=>Object.keys(i),Kl={draw:"ドローフェイズ",standby:"スタンバイフェイズ",main1:"メインフェイズ１",battle1:"バトルフェイズ",battle2:"バトルフェイズ（追加）",main2:"メインフェイズ２",end:"エンドフェイズ"},Ql={start:"スタートステップ",battle:"バトルステップ",damage:"ダメージステップ",end:"エンドステップ"},Jl={start:"ダメージステップ開始時",beforeDmgCalc:"ダメージ計算前",dmgCalc:"ダメージ計算時",afterDmgCalc:"ダメージ計算後",end:"ダメージステップ終了時"},lt=["draw","stanby","main1","b1Start","b1Battle","b1End","b2Start","b2Battle","b2End","main2","end"],Qt=["b1DStart","b1DBeforeDmgCalc","b1DAfterDmgCalc","b1DEnd","b2DStart","b2DBeforeDmgCalc","b2DAfterDmgCalc","b2DEnd"],Il=["b1DDmgCalc","b2DDmgCalc"],hi=[...lt,...Qt,...Il],Ur={draw:{phase:"draw",step:void 0,stage:void 0},stanby:{phase:"standby",step:void 0,stage:void 0},main1:{phase:"main1",step:void 0,stage:void 0},b1Start:{phase:"battle1",step:"start",stage:void 0},b1Battle:{phase:"battle1",step:"battle",stage:void 0},b1DStart:{phase:"battle1",step:"battle",stage:"start"},b1DBeforeDmgCalc:{phase:"battle1",step:"battle",stage:"beforeDmgCalc"},b1DDmgCalc:{phase:"battle1",step:"battle",stage:"dmgCalc"},b1DAfterDmgCalc:{phase:"battle1",step:"battle",stage:"afterDmgCalc"},b1DEnd:{phase:"battle1",step:"battle",stage:"end"},b1End:{phase:"battle1",step:"end",stage:void 0},b2Start:{phase:"battle2",step:"start",stage:void 0},b2Battle:{phase:"battle2",step:"battle",stage:void 0},b2DStart:{phase:"battle2",step:"battle",stage:"start"},b2DBeforeDmgCalc:{phase:"battle2",step:"battle",stage:"beforeDmgCalc"},b2DDmgCalc:{phase:"battle2",step:"battle",stage:"dmgCalc"},b2DAfterDmgCalc:{phase:"battle2",step:"battle",stage:"afterDmgCalc"},b2DEnd:{phase:"battle2",step:"battle",stage:"end"},b2End:{phase:"battle2",step:"end",stage:void 0},main2:{phase:"main2",step:void 0,stage:void 0},end:{phase:"end",step:void 0,stage:void 0}},eo=i=>i.stage?Jl[i.stage]:i.step?Ql[i.step]:Kl[i.phase],Wt=Un(Ur).reduce((i,e)=>(i[e].key=e,i[e].name=eo(i[e]),i),Ur),ua=class ua{constructor(e,t){d(this,"entity");d(this,"isRegular");d(this,"_isStarted");d(this,"info");d(this,"continuousEffectBase");d(this,"updateState",async()=>{if(this.hasToStart!==this.isStarted){if(this.isStarted){if(!this.info)throw new Se("illegal state");this._isStarted=!1,await this.continuousEffectBase.finish(this.entity,this.info),this.info=void 0;return}this.info=await this.continuousEffectBase.start(this.entity),this._isStarted=!0}});this._isStarted=!1,this.entity=e,this.continuousEffectBase=t,this.isRegular=this.appliableCellTypes.every(a=>bi.find(r=>r===a))&&this.faceList.length===1&&this.faceList[0]==="FaceUp"}get isStarted(){return this._isStarted}get appliableCellTypes(){return this.continuousEffectBase.appliableCellTypes}get appliableDuelPeriodKeys(){return this.continuousEffectBase.appliableDuelPeriodKeys}get faceList(){return this.continuousEffectBase.faceList}get hasToStart(){return!this.appliableCellTypes.includes(this.entity.fieldCell.cellType)||!this.appliableDuelPeriodKeys.includes(this.entity.duel.clock.period.key)||!this.faceList.includes(this.entity.face)?!1:this.continuousEffectBase.canStart(this.entity)}};d(ua,"createNew",(e,t)=>new ua(e,t));let Ya=ua;const to=(i,e,t,a,r)=>({title:i,appliableCellTypes:e==="Monster"?["MonsterZone","ExtraMonsterZone"]:["FieldSpellZone","SpellAndTrapZone"],appliableDuelPeriodKeys:hi,faceList:["FaceUp"],canStart:n=>!n.info.isPending&&!n.info.isDying&&t(n),start:async n=>{const s=a(n);return s.forEach(r(n).push),s.map(o=>o.seq)},finish:async(n,s)=>{s.forEach(o=>r(n).removeItem(o))}}),_r=(i,e,t,a,r,n)=>({title:i,appliableCellTypes:e==="Monster"?["MonsterZone","ExtraMonsterZone"]:["FieldSpellZone","SpellAndTrapZone"],appliableDuelPeriodKeys:hi,faceList:["FaceUp"],canStart:s=>!s.info.isPending&&!s.info.isDying&&a(s),start:async s=>{const o=r(s),u=t(s);return console.info(`start : ${s.toString()} ⇒ ${u.map(l=>l.toString()).join(" ")} (${o.map(l=>l.title).join(" ")})`),u.map(n).forEach(l=>o.forEach(l.push)),{targets:u,seqList:o.map(l=>l.seq)}},finish:async(s,o)=>{o.targets.map(n).forEach(u=>o.seqList.forEach(l=>u.removeItem(l)))}}),io=(i,e,t,a,r)=>_r(i,e,t,a,r,n=>n.procFilterBundle),oa=(i,e,t,a)=>to(i,e,t,a,r=>r.field.numericStateOperatorPool),Ea=(i,e,t,a,r)=>_r(i,e,t,a,r,n=>n.numericOprsBundle),ao=(i,e,t,a,r)=>_r(i,e,t,a,r,n=>n.statusOperatorBundle);class ro extends Ta{constructor(){super(...arguments);d(this,"afterDistributeAll",()=>!0)}}class no extends ka{constructor(){super(...arguments);d(this,"beforePush",()=>{})}}class so{constructor(e){d(this,"entity");d(this,"_records");d(this,"pushForRuleAction",e=>{this._records.push({cell:this.entity.fieldCell,face:this.entity.face,orientation:this.entity.orientation,movedAt:this.entity.duel.clock.getClone(),movedAs:[...e,"Rule"]})});d(this,"push",(e,t,a,r)=>{let n=this.entity.fieldCell;this.entity.status.kind==="XyzMaterial"&&(n=this.entity.controller.getXyzMaterialZone()),this._records.push({cell:n,face:this.entity.face,orientation:this.entity.orientation,movedAt:this.entity.duel.clock.getClone(),movedAs:e.getDistinct(),movedBy:t,actionOwner:a,chooser:r??a})});this.entity=e,this._records=[]}get records(){return this._records}get latestRecord(){return this._records.slice(-1)[0]}get previousPlaceRecord(){return this._records.findLast(e=>e.cell.cellType!==this.entity.fieldCell.cellType)??this._records[0]}get currentProcRecords(){return this._records.filter(e=>e.movedAt.totalProcSeq===this.entity.duel.clock.totalProcSeq)}}const Xa=["SpellCounter","KaijuCounter","NamelessCounter"],Ka=["CycleFlip","SonicBarrier"],lo=["GoldSarcophagus"],oo=[...Xa,...Ka,...lo],co={SpellCounter:"🔮",KaijuCounter:"☢",NamelessCounter:"💠"};class uo{constructor(){d(this,"dic");d(this,"temporaryCounterNames");d(this,"add",(e,t=1,a)=>(this.dic[e]=[...this.dic[e]??[],...Array(t).fill(a)],this.dic[e]));d(this,"setQty",(e,t=1,a)=>(this.dic[e]=[...Array(t).fill(a)],this.dic[e]));d(this,"remove",(e,t=1,a)=>{const r=this.dic[e].length;if(r===void 0)return[];if(t>=r)return delete this.dic[e],[];if(a){const n=this.dic[e].filter(o=>o===a),s=this.dic[e].filter(o=>o!==a);this.dic[e]=[...n.slice(t),...s]}else this.dic[e]=this.dic[e].slice(t);return this.dic[e]});d(this,"removeAll",(e,t)=>{if(t){const r=this.dic[e].filter(n=>n===t).length;return this.dic[e]=this.dic[e].filter(n=>n!==t),r}const a=this.dic[e];return delete this.dic[e],a});d(this,"getQty",(e,t)=>this.dic[e]?t?this.dic[e].filter(a=>a===t).length:this.dic[e].length??0:0);d(this,"incrementActionCountPerTurn",e=>{this.temporaryCounterNames.push(e.title),this.incrementActionCount(e)});d(this,"incrementActionCount",e=>{this.dic[e.title]=[e.entity,...this.dic[e.title]??[]]});d(this,"getActionCount",e=>this.dic[e.title]?this.dic[e.title].filter(t=>t===e.entity).length:0);d(this,"corpseDisposal",()=>{this.temporaryCounterNames.forEach(e=>delete this.dic[e]),this.temporaryCounterNames.reset(),Ka.forEach(e=>delete this.dic[e])});d(this,"removeAllActualCounters",()=>{Xa.forEach(e=>delete this.dic[e])});d(this,"removeAllWhenfaceDown",()=>{this.temporaryCounterNames.forEach(e=>delete this.dic[e]),this.temporaryCounterNames.reset(),Xa.forEach(e=>delete this.dic[e])});d(this,"clear",()=>{Ka.forEach(e=>delete this.dic[e]),this.temporaryCounterNames.forEach(e=>delete this.dic[e]),this.temporaryCounterNames.reset(),oo.forEach(e=>delete this.dic[e])});this.dic={},this.temporaryCounterNames=[]}}class vo extends Ta{constructor(){super(...arguments);d(this,"afterDistributeAll",t=>t.field.getAllEntities().map(a=>a.statusOperatorBundle).every(a=>a.calcStatus()))}}class fo extends ka{constructor(){super(...arguments);d(this,"calcStatus",()=>{const t=this.entity.isEffective,a={...this.entity.status},r=this._operators.reduce((n,s)=>s.statusCalculator(s,n),a);return this.entity.status=r,this.entity.isEffective===t});d(this,"beforePush",()=>{})}}class po extends Ni{constructor(t,a,r,n,s,o,u){super(t,a,r,n,s,o);d(this,"beforeRemove",()=>{});d(this,"statusCalculator");this.statusCalculator=u}}const Nt=async()=>({selectedEntities:[],chainBlockTags:[],prepared:void 0}),ho=async(i,e,t)=>(i.activator.payLp(t,i.action.entity),{LifePoint:t}),go=(i,e,t)=>({title:i,playType:"SystemPeriodAction",spellSpeed:"Normal",executableCells:pi,executablePeriods:e,executableDuelistTypes:["Controller","Opponent"],isMandatory:!0,validate:t,prepare:Nt,execute:async()=>!0,settle:async()=>!0}),yo=i=>{if(i.activator.info.ruleNormalSummonCount>=i.activator.info.maxRuleNormalSummonCount||!i.action.entity.lvl)return;const e=i.activator.getAvailableMonsterZones();return i.action.entity.lvl<5?e.length>0?e:void 0:i.activator.getReleasableMonsters().length<(i.action.entity.lvl<7?1:2)?void 0:[]},mo=async(i,e,t,a)=>{if(!i.action.entity.lvl)return;let r=e?[e]:i.activator.getAvailableMonsterZones();if(r.length===0)return;let n=a,s=[];if(i.action.entity.lvl>4){const l=i.activator.getReleasableMonsters(),c=i.activator.getExtraMonsterZones(),v=i.action.entity.lvl<7?1:2;c.length>=v&&l.filter(h=>h.fieldCell.cellType!=="ExtraMonsterZone");const f=await i.action.entity.field.release(i.activator,i.activator.getReleasableMonsters(),v,"Cost",["AdvanceSummonRelease","Rule"],i.action.entity,n);if(!f)return;s=f.map(h=>({material:h})),n=!1,r=i.activator.getAvailableMonsterZones()}let o=(i.action.entity.atk??0)>0&&(i.action.entity.atk??0)>=(i.action.entity.def??0)?"Attack":"Set",u=r.randomPick();if(i.activator.duelistType!=="NPC"){const l=await i.activator.duel.view.waitSelectSummonDest(i.activator,i.action.entity,r,["Attack","Set"],n);if(!l)return;u=l.dest,o=l.pos}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:u,pos:o,materialInfos:s}}},_o=async i=>{const e=["Rule","NormalSummon"];let t="NormalSummon";return i.prepared.materialInfos.length>0&&(i.action.entity.info.materials.reset(...i.prepared.materialInfos),t="AdvanceSummon",e.push("AdvanceSummon")),await i.action.entity.summon(i.prepared.dest,i.prepared.pos,t,e,i.action.entity,i.activator),i.activator.info.ruleNormalSummonCount++,i.activator.info.ruleNormalSummonCountQty++,!0},Qa=(i,e,t)=>{const a=i.activator.getAvailableMonsterZones();if(i.action.entity.fieldCell.cellType==="ExtraDeck"&&a.push(...i.activator.getAvailableExtraZones()),!(!a.length&&(!t.length||t.every(r=>r.material.fieldCell.cellType!=="MonsterZone")&&i.action.entity.fieldCell.cellType!=="ExtraDeck"))&&!e.every(r=>!i.activator.canSummon(i.activator,i.action.entity,i.action,"SpecialSummon",r,t)))return t.length===0?a:[]},Ja=async(i,e,t,a,r)=>{const n=e?[e]:i.activator.getAvailableMonsterZones();if(n.length===0)return;const s=t.filter(l=>i.activator.canSummon(i.activator,i.action.entity,i.action,"SpecialSummon",l,a));if(s.length===0)return;let o=s.randomPick(),u=n.randomPick();if(s.length&&s.includes("Attack")&&(o=(i.action.entity.atk??0)>0&&(i.action.entity.atk??0)>=(i.action.entity.def??0)?"Attack":s.filter(l=>l!=="Attack").randomPick()),i.activator.duelistType!=="NPC"){const l=await i.activator.duel.view.waitSelectSummonDest(i.activator,i.action.entity,n,s,r);if(!l)return;u=l.dest,o=l.pos}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:u,pos:o,materialInfos:a}}},Ia=async i=>{const e=["Rule","SpecialSummon"];return await i.action.entity.summon(i.prepared.dest,i.prepared.pos,"SpecialSummon",e,i.action.entity,i.activator),i.action.entity.info.materials=i.prepared.materialInfos,!0},Ge={title:"通常召喚",isMandatory:!1,playType:"NormalSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:yo,prepare:mo,execute:_o,settle:async()=>!0},So=i=>{if(!i.activator.isTurnPlayer)return;const e=i.action.entity.getAttackTargets();return e.length?e.map(t=>t.fieldCell):void 0},bo=async(i,e)=>{if(i.action.entity.info.attackCount>0||i.action.entity.battlePosition!=="Attack")return;if(e!=null&&e.targetForAttack)return{selectedEntities:e.cardEntities,chainBlockTags:[],prepared:void 0};const t=i.action.entity.getAttackTargets();if(t.length===0)throw new Se("想定されない状態",i,e);if(t.length===1)return{selectedEntities:t,chainBlockTags:[],prepared:void 0};if(i.activator.duelistType==="NPC"){let r=i.activator.selectAttackTargetForNPC(i.action.entity,i.action);return r||(i.activator.duel.log.warn("NPCの攻撃対象選択に失敗したため、ランダムに攻撃対象を選択。"),r=t.randomPick()),{selectedEntities:[r],chainBlockTags:[],prepared:void 0}}const a=await i.action.entity.field.duel.view.waitSelectEntities(i.activator,t,1,r=>r.length===1,"攻撃対象を選択。",!0);if(a)return{selectedEntities:a,chainBlockTags:[],prepared:void 0}},wo=async i=>(i.action.entity.field.duel.declareAnAttack(i.action.entity,i.selectedEntities[0]),!0),qe={title:"攻撃宣言",isMandatory:!1,playType:"Battle",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["b1Battle","b2Battle"],executableDuelistTypes:["Controller"],validate:So,prepare:bo,execute:wo,settle:async()=>!0},Co=i=>{if(!(i.action.entity.info.battlePotisionChangeCount>0||i.action.entity.info.attackCount>0||!i.activator.isTurnPlayer))return[]},To=async i=>i.action.entity.info.battlePotisionChangeCount>0||!i.activator.isTurnPlayer?!1:(await i.action.entity.setBattlePosition(i.action.entity.battlePosition==="Attack"?"Defense":"Attack",["Rule"],i.action.entity,i.activator),console.log(i.action.entity.toString()),i.action.entity.info.battlePotisionChangeCount++,!0),Le={title:"表示形式変更",isMandatory:!1,playType:"ChangeBattlePosition",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Co,prepare:Nt,execute:To,settle:async()=>!0},ko=async(i,e=i.action.entity,t=["Attack","Defense"])=>{if(e.wasMovedAtCurrentChain)return!1;const a=i.activator.getAvailableMonsterZones();return a.length===0||t.every(r=>!e.canBeSummoned(i.activator,i.action,"SpecialSummon",r,[],!1))?!1:(await i.activator.summon(e,t,a,"SpecialSummon",["Effect"],i.action.entity,!1),!0)},gi=(i,e,t,a)=>e.status.kind!=="Monster"||!e.origin.monsterCategories?!1:e.origin.monsterCategories.includes("NormalSummonOnly")?a==="NormalSummon"||a==="AdvanceSummon":e.origin.monsterCategories.includes("SpecialSummon")&&(e.fieldCell.cellType==="Graveyard"||e.fieldCell.cellType==="Banished")?e.info.isRebornable:!0,er=(i,e,t,a,r)=>{if(!i.action.entity.origin.level||t.some(u=>!u.lvl)||t.map(u=>u.lvl??0).reduce((u,l)=>u+l,0)!==i.action.entity.origin.level)return;const n=t.filter(u=>{var l;return(l=u.status.monsterCategories)==null?void 0:l.some(c=>c==="Tuner")}),s=t.filter(u=>{var l;return(l=u.status.monsterCategories)==null?void 0:l.some(c=>c!=="Tuner")});if(!a(n)||!r(s))return;const o=[...n.map(u=>({material:u,isAsTuner:!0})),...s.map(u=>({material:u,isAsTuner:!1}))];if(t.every(u=>u.canBeMaterial(i.activator,i.action.entity,i.action,"SyncroMaterial",e,o,!1))&&i.activator.canSummon(i.activator,i.action.entity,i.action,"SyncroSummon",e,o))return o},Zn=(i,e=a=>a.length===1,t=a=>a.length>0)=>{let a=[...i.activator.getMonstersOnField().filter(n=>n.battlePosition!=="Set"),...i.activator.getHandCell().entities.filter(n=>n.origin.kind==="Monster")];if(a.every(n=>!n.status.allowHandSyncro)&&(a=a.filter(n=>n.fieldCell.isPlayFieldCell)),a.length<2)return[];const r=["Attack","Defense"];return a.getAllOnOffPattern().filter(n=>r.some(s=>er(i,s,n,e,t)))},Eo=(i,e=a=>a.length===1,t=a=>a.length>0)=>Zn(i,e,t).length>0?[]:void 0,Do=async(i,e,t,a=n=>n.length===1,r=n=>n.length>0)=>{var h;const n=Zn(i,a,r);let s=n[0];if(n.length>1){const y=n.flatMap(m=>m).getDistinct(),b=await i.action.entity.duel.view.waitSelectEntities(i.activator,y,void 0,m=>Mt.some(S=>er(i,S,m,a,r)),"シンクロ素材とするモンスターを選択",t);if(!b)return;s=b}i.action.entity.field.duel.log.info(`シンクロ素材として、${s.map(y=>"《"+y.nm+"》").join("")}を墓地に送り――`,i.activator),await me.sendManyToGraveyardForTheSameReason(s,["SyncroMaterial","Rule","SpecialSummonMaterial"],i.action.entity,i.activator);const o=[...i.activator.getAvailableMonsterZones(),...i.activator.getAvailableExtraZones()],u=Mt.map(y=>{const b=er(i,y,s,a,r);return{pos:y,materialInfos:b}}).filter(y=>y.materialInfos),l=u.map(y=>y.pos);let c=u[0].pos,v=u[0].materialInfos,f=o.randomPick();if(i.activator.duelistType!=="NPC"){const y=await i.activator.duel.view.waitSelectSummonDest(i.activator,i.action.entity,o,l,!1);if(!y)return;f=y.dest,c=y.pos,v=((h=u.find(b=>b.pos===c))==null?void 0:h.materialInfos)??v}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:f,pos:c,materialInfos:v}}},Ao=async i=>{const e=["Rule","SpecialSummon","SyncroSummon"];return await i.action.entity.summon(i.prepared.dest,i.prepared.pos,"SyncroSummon",e,i.action.entity,i.activator),i.action.entity.info.isRebornable=!0,!0},Pi=(i=t=>t.length===1,e=t=>t.length>0)=>({title:"シンクロ召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:t=>Eo(t,i,e),prepare:(t,a,r,n)=>Do(t,a,n,i,e),execute:Ao,settle:async()=>!0}),tr=(i,e,t,a=2,r=2,n)=>{if(!i.action.entity.origin.rank||t.length<a||t.length>r||t.some(o=>!o.lvl)||t.some(o=>o.lvl!==i.action.entity.rank)||!n(t))return;const s=t.map(o=>({material:o,level:o.status.level}));if(t.every(o=>o.canBeMaterial(i.activator,i.action.entity,i.action,"XyzMaterial",e,s,!1)))return i.activator.canSummon(i.activator,i.action.entity,i.action,"XyzSummon",e,s)?s:void 0},Gn=(i,e=2,t=2,a=r=>r.length>1)=>{const r=i.activator.getMonstersOnField().filter(n=>n.battlePosition!=="Set");return r.length<e?[]:r.getAllOnOffPattern().filter(n=>n.length>=e).filter(n=>n.length<=t).filter(n=>Mt.some(s=>tr(i,s,n,e,t,a)))},xo=(i,e=2,t=2,a=r=>r.length>1)=>Gn(i,e,t,a).length>0?[]:void 0,Mo=async(i,e,t,a=2,r=2,n=s=>s.length>1)=>{var y;const s=Gn(i,a,r,n);let o=s[0];if(s.length>1){const b=s.flatMap(S=>S).getDistinct(),m=await i.action.entity.duel.view.waitSelectEntities(i.activator,b,void 0,S=>Mt.some(E=>tr(i,E,S,a,r,n)),"XYZ素材とするモンスターを選択",!0);if(!m)return;o=m}const u=Mt.map(b=>{const m=tr(i,b,o,a,r,n);return{pos:b,materialInfos:m}}).filter(b=>b.materialInfos);i.action.entity.field.duel.log.info(`${o.map(b=>"《"+b.nm+"》").join(" ")}によって、オーバレイネットワークを構築――`,i.activator),await me.convertManyToXyzMaterials(o,["XyzMaterial","Rule","SpecialSummonMaterial"],i.action.entity,i.activator);const l=[...i.activator.getAvailableMonsterZones(),...i.activator.getAvailableExtraZones()],c=u.map(b=>b.pos);let v=u[0].pos,f=u[0].materialInfos,h=l.randomPick();if(i.activator.duelistType!=="NPC"){const b=await i.activator.duel.view.waitSelectSummonDest(i.activator,i.action.entity,l,c,!1);if(!b)return;h=b.dest,v=b.pos,f=((y=u.find(m=>m.pos===v))==null?void 0:y.materialInfos)??f}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:h,pos:v,materialInfos:f}}},Po=async i=>{const e=["Rule","SpecialSummon","XyzSummon"];return await me.moveToXyzOwner(i.prepared.dest,i.prepared.materialInfos.map(t=>t.material),["XyzMaterial"],i.action.entity,i.activator),await i.action.entity.summon(i.prepared.dest,i.prepared.pos,"XyzSummon",e,i.action.entity,i.activator),i.action.entity.info.isRebornable=!0,!0},Fo=(i=2,e=2,t=a=>a.length>1)=>({title:"エクシーズ召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:a=>xo(a,i,e,t),prepare:(a,r,n,s)=>Mo(a,r,s,i,e,t),execute:Po,settle:async()=>!0}),Oa={},Bo=i=>(Oa[i]||(Oa[i]={title:`戦闘破壊耐性(${i})`,isMandatory:!0,executableCells:["MonsterZone"],executablePeriods:["b1DDmgCalc","b2DDmgCalc"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:i,isApplicableTo:(e,t,a)=>(console.log(e.entity.toString(),e,t,a),a.includes(e.entity)?t!=="BattleDestroy"?[]:[e.entity]:[]),substitute:async(e,t,a)=>a.includes(e.entity)?t!=="BattleDestroy"?[]:e.entity.isEffective?(e.entity.controller.writeInfoLog(`${e.entity.toString()}は１ターンに１度だけ戦闘では破壊されない。`),[e.entity]):[]:[]}),Oa[i]),Fi=class Fi extends la{constructor(){super(...arguments);d(this,"isApplicableTo",(t,a,r)=>{console.log(this.entity.toString(),this,t,a);const n=this.entity.counterHolder.getActionCount(this);return this.isOnlyNTimesPerTurnIfFaceup>0&&n>=this.isOnlyNTimesPerTurnIfFaceup?this.entity.counterHolder.incrementActionCountPerTurn(this):this.isOnlyNTimesIfFaceup>0&&n>=this.isOnlyNTimesIfFaceup&&this.entity.counterHolder.incrementActionCount(this),this.definition.isApplicableTo(this,t,a,r)});d(this,"substitute",async(t,a,r)=>{const n=await this.definition.substitute(this,t,a,r);return this.isOnlyNTimesPerTurnIfFaceup>0?this.entity.counterHolder.incrementActionCountPerTurn(this):this.isOnlyNTimesIfFaceup>0&&this.entity.counterHolder.incrementActionCount(this),n});d(this,"getClone",()=>new Fi(this.seq,this.entity,this.definition))}get definition(){return super.definition}};d(Fi,"createNew",(t,a)=>new Fi("AutoSeq",t,a));let ir=Fi;const Oo={FusionSummon:"融合召喚",SyncroSummon:"シンクロ召喚",XyzSummon:"エクシーズ召喚",PendulumSummon:"ペンデュラム召喚",LinkSummon:"リンク召喚"},No={BattleDestroy:"戦闘破壊",EffectDestroy:"効果破壊",RuleDestroy:"ルール破壊"},zn=i=>i+"Summon",Zr=["Card","Token","Avatar"],qo=["Duelist","Squatter"],Vn=(i,e)=>Mi(i.origin,e.origin),ae=class ae{constructor(e,t,a,r,n,s,o){d(this,"onBeforeMoveEvent",new Fr);d(this,"onAfterMoveEvent",new Fr);d(this,"seq");d(this,"origin");d(this,"entityType");d(this,"procFilterBundle");d(this,"numericOprsBundle");d(this,"cardRelationBundle");d(this,"statusOperatorBundle");d(this,"moveLog");d(this,"counterHolder");d(this,"face");d(this,"orientation");d(this,"owner");d(this,"fieldCell");d(this,"_status");d(this,"_numericStatus");d(this,"_info");d(this,"actions",[]);d(this,"continuousEffects",[]);d(this,"substituteEffects",[]);d(this,"canBeSummoned");d(this,"canBeMaterial");d(this,"canBeReleased",(e,t,a,r)=>this.procFilterBundle.operators.filter(n=>n.procTypes.union(a).length).every(n=>n.filter(e,t,r,[this])));d(this,"_hasDisappeared",!1);d(this,"toString",()=>this.entityType==="Card"?`《${this.nm}》`:this.nm);d(this,"setBattlePosition",async(e,t,a,r)=>{let n=`表示形式の変更：${this.toString()}（${this.battlePositionName}⇒${Yi[e]}）`;const s=[...t];this.battlePosition==="Set"&&(s.push("Flip"),t.includes("Rule")&&(n=`${this.toString()}を反転召喚`,s.push("FlipSummon"),s.push("AttackSummon"))),this.duel.log.info(n,r),await this.moveAlone(this.fieldCell,"Monster",e==="Set"?"FaceDown":"FaceUp",e==="Attack"?"Vertical":"Horizontal","Top",s,a,r,r)});d(this,"activateAsPendulumScale",(e,t,a,r)=>this.moveAlone(e,"Spell","FaceUp","Vertical","Top",["CardActivation",...t],a,r,r));d(this,"setNonFieldMonsterPosition",async(e,t,a,r,n)=>{this.moveAlone(this.fieldCell,e,t==="FaceUp"?"FaceUp":"FaceDown","Vertical","Top",a,r,n,n)});d(this,"setAsSpellTrap",async(e,t,a,r,n)=>{await this.moveAlone(e,t,"FaceDown","Vertical","Top",[...a,"SpellTrapSet"],r,n,n)});d(this,"activateSpellTrapFromHand",async(e,t,a,r,n)=>{await this.moveAlone(e,t,"FaceUp","Vertical","Top",[...a,"CardActivation"],r,n,n)});d(this,"activateSpellTrapOnField",async(e,t,a,r)=>{await this.moveAlone(this.fieldCell,e,"FaceUp","Vertical","Top",[...t,"CardActivation"],a,r,r)});d(this,"draw",async(e,t,a)=>await this.addToHand([...e,"Draw"],t,a));d(this,"addToHand",async(e,t,a)=>await this.moveAlone(this.owner.getHandCell(),this.origin.kind,"FaceDown","Vertical","Bottom",[...e],t,a,a));d(this,"release",async(e,t,a)=>(await this.sendToGraveyard([...e,"Release"],t,a),this.info.isVanished?void 0:this.fieldCell));d(this,"ruleDestory",async()=>(await this.sendToGraveyard(["RuleDestroy"],void 0,void 0),this.info.isVanished?void 0:this.fieldCell));d(this,"sendToGraveyard",(e,t,a)=>ae.sendManyToGraveyardForTheSameReason([this],e,t,a));d(this,"discard",(e,t,a)=>ae.discardManyForTheSameReason([this],e,t,a));d(this,"returnToDeck",(e,t,a,r)=>ae.returnManyToDeckForTheSameReason(e,[this],t,a,r));d(this,"banish",(e,t,a)=>ae.banishManyForTheSameReason([this],e,t,a));d(this,"summon",(e,t,a,r,n,s,o)=>ae.summonMany([{entity:this,to:e,chooser:o??s,pos:t}],a,r,n,s));d(this,"moveAlone",async(e,t,a,r,n,s,o,u,l)=>(await ae.moveMany([[this,e,t,a,r,n,s,o,u,l]],void 0),this.fieldCell));d(this,"_move",async(e,t,a,r,n,s,o,u,l)=>{if(!e)throw new Error("illegal argument: to");if(await this.onBeforeMoveEvent.trigger({entity:this,args:[e,t,a,r,n,s,o,u,l]}),this._status.kind=t,this.face=a,this.orientation=r,e!==this.fieldCell){if(this.field.duel.clock.turn>0&&await this.field.duel.view.waitAnimation({entity:this,to:e,index:n,count:0}),this.fieldCell.releaseEntities([this]),this.fieldCell.isPlayFieldCell&&!e.isPlayFieldCell&&(this.counterHolder.clear(),this.resetCauseOfDeath(),this.entityType==="Token")){this._hasDisappeared=!0,this.field.duel.log.info(`${this.nm}は消滅した。`,this.controller);return}this.status.kind!=="XyzMaterial"&&(this.fieldCell.isMonsterZoneLikeCell&&!e.isMonsterZoneLikeCell||t!=="Monster")&&(this.info.equipEntities.filter(c=>c.isOnFieldAsSpellTrap).forEach(c=>{c.info.isDying=!0,c.info.causeOfDeath=["RuleDestroy"],this.controller.writeInfoLog(`装備対象${this.toString()}不在により${c.toString()}は破壊された。`)}),this.info.equipEntities=[],this.fieldCell.xyzMaterials.forEach(c=>{c.info.isDying=!0,c.info.causeOfDeath=["LostXyzOwner"],this.controller.writeInfoLog(`エクシーズモンスター${this.toString()}不在により${c.toString()}は墓地に送られた。`)})),this.fieldCell.cellType==="SpellAndTrapZone"&&e.cellType!=="SpellAndTrapZone"&&(this.info.equipedBy=void 0,this.info.equipedAs=void 0),e.acceptEntities([this],n),(e===this.isBelongTo||e.cellType==="Hand"||e.cellType==="Banished"&&this.face==="FaceDown")&&(this.counterHolder.clear(),this.resetInfoAll(),this.resetStatusAll())}return(this.isOnField&&this.face==="FaceDown"||t==="XyzMaterial")&&(this.info.equipEntities.forEach(c=>{c.info.isDying=!0,c.info.causeOfDeath=["RuleDestroy"],this.controller.writeInfoLog(`装備対象${this.toString()}不在により${c.toString()}は破壊された。`)}),this.counterHolder.removeAllWhenfaceDown(),this.info.materials=[],this._status.isEffective=!0,this.info.isEffectiveIn=[...pi],this.info.willBeBanished=!1,this.info.willReturnToDeck=void 0,this.resetNumericStatus(),this.info.isSettingSickness=this.status.kind==="Trap"||this.status.spellCategory==="QuickPlay"),this.moveLog.push(s,o,u,l),console.log(this.toString()),await this.onAfterMoveEvent.trigger(this),e});d(this,"initForTurn",()=>{this.info.isSettingSickness=!1,this.info.attackCount=0,this.info.battlePotisionChangeCount=0,this.counterHolder.corpseDisposal()});d(this,"resetInfoIfLeavesTheField",()=>{this._info={...this._info,isDying:!1,isPending:!1,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,effectTargets:{},attackCount:0,battlePotisionChangeCount:0,equipedBy:void 0,equipedAs:void 0,equipEntities:[]},this._info.isEffectiveIn.push(...bi),this._info.isEffectiveIn.distinct()});d(this,"resetInfoAll",()=>{var e;this._info={isDying:!1,isPending:!1,isEffectiveIn:[...pi],causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,isVanished:!1,isRebornable:((e=this.origin.monsterCategories)==null?void 0:e.union(qn).length)===0,isSettingSickness:!1,materials:[],effectTargets:{},willBeBanished:!1,willReturnToDeck:void 0,attackCount:0,battlePotisionChangeCount:0,equipedBy:void 0,equipedAs:void 0,validateEquipOwner:()=>!0,equipEntities:[]},this.counterHolder.clear()});d(this,"resetNumericStatus",()=>{const e=Ln.reduce((t,a)=>(t[a]=this.origin[a],t),{});this._numericStatus={origin:{...e},wip:{...e},calculated:{...e}}});d(this,"resetStatus",()=>{this._status={...this.origin,canAttack:!0,isEffective:!0,canDirectAttack:!1,isSelectableForAttack:!0,allowHandSyncro:!1,maxCounterQty:{}}});d(this,"resetStatusAll",()=>{this.resetNumericStatus(),this.resetStatus()});d(this,"resetCauseOfDeath",()=>{this.info.isDying=!1,this.info.causeOfDeath=[],this.info.isKilledBy=void 0,this.info.isKilledByWhom=void 0});var v;this.seq=ae.nextEntitySeq++,this.counterHolder=new uo,this.owner=e,this.fieldCell=t,this.entityType=a,this.origin=r,this._status=JSON.parse(JSON.stringify(r)),this._numericStatus=JSON.parse(JSON.stringify(r)),this.resetStatusAll(),this._info={isEffectiveIn:[...pi],attackCount:0,battlePotisionChangeCount:0,isDying:!1,isPending:!1,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,isVanished:!1,isRebornable:!0,isSettingSickness:!1,materials:[],effectTargets:{},willBeBanished:!1,willReturnToDeck:void 0,equipedBy:void 0,equipedAs:void 0,validateEquipOwner:()=>!0,equipEntities:[]},this.resetInfoAll(),this.face=n,this.orientation=s,this.procFilterBundle=new Vl(t.field.procFilterPool,this),this.numericOprsBundle=new Xl(t.field.numericStateOperatorPool,this),this.cardRelationBundle=new no(t.field.cardRelationPool,this),this.statusOperatorBundle=new fo(t.field.statusOperatorPool,this),t.acceptEntities([this],"Top"),this.moveLog=new so(this),this.moveLog.pushForRuleAction(["Spawn"]);let u=[],l=[];this.origin.kind==="Monster"&&((v=this.origin.monsterCategories)!=null&&v.includes("Normal"))?u=[Ge,qe,Le]:o&&(u=o.actions,l=o.continuousEffects??[],this.substituteEffects.push(...(o.substituteEffects??[]).map(f=>ir.createNew(this,f)))),this.actions.push(...u.map(f=>Ot.createNew(this,f))),this.continuousEffects.push(...l.map(f=>Ya.createNew(this,f)));const c=(o==null?void 0:o.canBeSummoned)??(()=>!0);this.canBeSummoned=(f,h,y,b,m,S)=>c(f,this,h,y,b,m,S),this.canBeMaterial=(f,h,y,b,m,S,E)=>o!=null&&o.canBeMaterial&&!(o!=null&&o.canBeMaterial(f,h,y,b,m,S,E))?!1:this.procFilterBundle.operators.filter(F=>F.procTypes.some(q=>q===b)).every(F=>F.filter(y.entity.controller,y.entity,y,S.map(q=>q.material)))}get onBeforeMove(){return this.onBeforeMoveEvent.expose()}get onAfterMove(){return this.onAfterMoveEvent.expose()}get isUnderControl(){return this.face==="FaceUp"||Rn.every(e=>e!==this.fieldCell.cellType)}get controller(){return this.fieldCell.owner??this.owner}get field(){return this.owner.duel.field}get duel(){return this.owner.duel.field.duel}get actionLogRecords(){return this.duel.chainBlockLog.records.filter(e=>e.chainBlockInfo.action.entity===this)}get status(){return this._status}set status(e){this._status={...e}}get numericStatus(){return this._numericStatus}get info(){return this._info}get nm(){return this.status.name}get atk(){return this._numericStatus.calculated.attack}get def(){return this._numericStatus.calculated.defense}get lvl(){return this._numericStatus.calculated.level}get rank(){return this._numericStatus.calculated.rank}get attr(){return this.status.attributes??[]}get types(){return this.status.types??[]}get psL(){return this._numericStatus.calculated.pendulumScaleL}get psR(){return this._numericStatus.calculated.pendulumScaleR}get isEffective(){return this.status.isEffective&&this.info.isEffectiveIn.includes(this.fieldCell.cellType)}get isEffectiveWeakly(){return this.status.isEffective}get battlePosition(){if(this.isOnField&&this.status.kind==="Monster")return this.orientation==="Vertical"?"Attack":this.face==="FaceUp"?"Defense":"Set"}get battlePositionName(){const e=this.battlePosition;if(e)return Yi[e]}get wasMovedAtCurrentProc(){return this.field.duel.clock.totalProcSeq===this.moveLog.latestRecord.movedAt.totalProcSeq}get wasMovedAtPreviousProc(){return this.field.duel.clock.totalProcSeq===this.moveLog.latestRecord.movedAt.totalProcSeq+1}get wasMovedAtCurrentChain(){return this.field.duel.clock.isSameChain(this.moveLog.latestRecord.movedAt)}get wasMovedAtPreviousChain(){return this.field.duel.clock.isPreviousChain(this.moveLog.latestRecord.movedAt)}get wasMovedFrom(){return this.moveLog.previousPlaceRecord.cell}get isOnField(){return bi.some(e=>e===this.fieldCell.cellType)}get isOnFieldAsMonster(){return Si.some(e=>e===this.fieldCell.cellType)}get isOnFieldAsSpellTrap(){return zt.some(e=>e===this.fieldCell.cellType)}get isLikeContinuousSpell(){return this.status.spellCategory==="Continuous"||this.status.spellCategory==="Field"||this.status.spellCategory==="Equip"||this.status.trapCategory==="Continuous"||(this.status.monsterCategories??[]).includes("Pendulum")}get isBelongTo(){return this.origin.monsterCategories&&this.origin.monsterCategories.union(_i).length?this.owner.getExtraDeck():this.owner.getDeckCell()}get hasDisappeared(){return this._hasDisappeared}get allStickyEffectOperators(){return[...this.procFilterBundle.operators,...this.numericOprsBundle.operators,...this.cardRelationBundle.operators]}};d(ae,"nextEntitySeq",0),d(ae,"splitBattlePos",e=>({face:e==="Set"?"FaceDown":"FaceUp",orientation:e==="Attack"?"Vertical":"Horizontal"})),d(ae,"recreateArray",(e,t)=>{if(!t.length)return[];const a=e.getAllCells().flatMap(r=>r.entities);return t.map(r=>r.seq).map(r=>a.find(n=>n.seq===r)).filter(r=>r!==void 0)}),d(ae,"createPlayerEntity",e=>{const t=e.getHandCell();return new ae(e,t,"Duelist",{name:e.profile.name,kind:"Monster",wikiEncodedName:"%A5%D7%A5%EC%A5%A4%A5%E4%A1%BC"},"FaceUp","Vertical",void 0)}),d(ae,"createCardEntity",(e,t)=>{const a=t.monsterCategories&&t.monsterCategories.union(_i).length?e.getExtraDeck():e.getDeckCell(),r=new ae(e,a,"Card",Hl(t),"FaceDown","Vertical",rr.get(t.name));return Object.hasOwn(Ie,r.origin.name)||e.duel.log.info(`未実装カード${t.name}がデッキに投入された。`,e),r}),d(ae,"waitCorpseDisposal",e=>ae.sendManyToGraveyard(e.field.getEntiteisOnField().filter(t=>t.info.isDying).map(t=>({entity:t,causedAs:t.info.causeOfDeath??[],causedBy:t.info.isKilledBy,activator:t.info.isKilledByWhom})))),d(ae,"sendManyToGraveyardForTheSameReason",(e,t,a,r)=>ae.bringManyToSameCellForTheSameReason("Graveyard","Top",e,"FaceUp","Vertical",t,a,r)),d(ae,"discardManyForTheSameReason",(e,t,a,r)=>ae.bringManyToSameCellForTheSameReason("Graveyard","Top",e,"FaceUp","Vertical",["Discard",...t],a,r)),d(ae,"banishManyForTheSameReason",(e,t,a,r)=>ae.bringManyToSameCellForTheSameReason("Banished","Top",e,"FaceUp","Vertical",t,a,r)),d(ae,"returnManyToDeckForTheSameReason",(e,t,a,r,n)=>ae.bringManyToSameCellForTheSameReason("Deck",e,t,"FaceDown","Vertical",a,r,n)),d(ae,"returnManyToHandForTheSameReason",(e,t,a,r)=>ae.bringManyToSameCellForTheSameReason("Hand","Bottom",e,"FaceDown","Vertical",t,a,r)),d(ae,"convertManyToXyzMaterials",(e,t,a,r)=>ae.moveMany(e.map(n=>[n,n.fieldCell,"XyzMaterial","FaceUp","Vertical","Top",t,a,r,r]))),d(ae,"moveToXyzOwner",(e,t,a,r,n)=>ae.moveMany(t.map(s=>[s,e,"XyzMaterial","FaceUp","Vertical","Top",a,r,n,n]))),d(ae,"sendManyToGraveyard",(e,t)=>ae.bringManyToSameCell("Graveyard","Top",e.map(a=>({...a,face:"FaceUp",orientation:"Vertical"})),t)),d(ae,"banishMany",(e,t)=>ae.bringManyToSameCell("Banished","Top",e.map(a=>({...a,face:"FaceUp",orientation:"Vertical"})),t)),d(ae,"bringManyToSameCellForTheSameReason",(e,t,a,r,n,s,o,u)=>ae.bringManyToSameCell(e,t,a.map(l=>({entity:l,face:r,orientation:n,causedAs:s,causedBy:o,activator:u})))),d(ae,"bringManyToSameCell",(e,t,a,r)=>ae.moveMany(a.map(n=>[n.entity,n.entity.field.getCells(e).filter(s=>s.owner===n.entity.owner)[0],n.entity.origin.kind,n.face,n.orientation,t,n.causedAs,n.causedBy,n.activator,n.activator]),r)),d(ae,"moveMany",async(e,t)=>{if(!e.length)return;const a=e[0][0].duel,n=[...e.filter(([o,u])=>o.fieldCell!==u).map(([o])=>o).filter(o=>!(t??[]).includes(o)),...a.field.getEntiteisOnField().filter(o=>o.info.isDying)],s=new Map;for(e.forEach(([o,u,l,c,v,f,...h])=>{let y=u,b=l,m=c,S=f,E=v;o.info.willBeBanished&&(y=o.owner.getBanished(),m="FaceUp",E="Vertical"),o.info.willReturnToDeck&&(y=o.isBelongTo,m="FaceDown",S=o.info.willReturnToDeck,E="Vertical"),o.isBelongTo.cellType==="ExtraDeck"&&(y.cellType==="Hand"||y.cellType==="Deck")&&(y=o.isBelongTo,m="FaceDown",E="Vertical"),y.isPlayFieldCell||(b=o.origin.kind),y.isMonsterZoneLikeCell||(E="Vertical"),s.set(y,[[o,y,b,m,E,S,...h],...s.get(y)??[]])});;){const o=Array.from(s.values()).map(l=>l.pop()).filter(l=>l!==void 0).map(([l,...c])=>l._move(...c));if(!o.length)break;await Promise.all(o),a.field.cardRelationPool.excludesExpired();const u=a.field.getEntiteisOnField().filter(l=>l.info.isDying).filter(l=>!n.includes(l)).map(l=>({entity:l,causedAs:l.info.causeOfDeath??[],causedBy:l.info.isKilledBy,activator:l.info.isKilledByWhom}));u.length&&await ae.sendManyToGraveyard(u,n)}console.log(e.map(([o])=>o.toString())),ae.settleEntityMove(a),console.log(e.map(([o])=>o.toString()))}),d(ae,"summonMany",async(e,t,a,r,n)=>{if(!e.length)return;const s={Attack:"AttackSummon",Defense:"DefenseSummon",Set:"SetSummon"};await Promise.all(e.map(async({entity:o,to:u,pos:l,chooser:c})=>{if(t==="NormalSummon"||t==="AdvanceSummon"){const h=t==="AdvanceSummon"?"アドバンス":"";l==="Attack"?o.field.duel.log.info(`${o.toString()}を${h}召喚`,c):o.duel.log.info(`${o.toString()}を${h}セット`,c),a.includes("Rule")?c.info.ruleNormalSummonCountQty++:c.info.effectNormalSummonCountQty++}else t==="SpecialSummon"?o.duel.log.info(`${o.toString()}を${Yi[l]}で特殊召喚`,c):o.duel.log.info(`${o.toString()}を${Yi[l]}で${Oo[t]}！`,c),c.info.specialSummonCountQty++;o.info.battlePotisionChangeCount=1;const{face:v,orientation:f}=ae.splitBattlePos(l);await o._move(u,"Monster",v,f,"Top",[t,s[l],...a],r,n,c)})),e.map(o=>o.chooser).forEach(o=>{t==="NormalSummon"||t==="AdvanceSummon"?a.includes("Rule")?o.info.ruleNormalSummonCount++:o.info.effectNormalSummonCount++:o.info.specialSummonCount++}),ae.settleEntityMove(e[0].entity.duel)}),d(ae,"settleEntityMove",e=>{e.distributeOperators(e.clock.totalProcSeq);const t=e.field.getAllEntities().filter(a=>a.wasMovedAtCurrentProc);t.filter(a=>!a.isOnField).forEach(a=>a.resetInfoIfLeavesTheField()),t.filter(a=>a.face==="FaceDown").filter(a=>a.fieldCell===a.isBelongTo).forEach(a=>{a.resetInfoAll(),a.resetStatusAll()}),t.flatMap(a=>a.continuousEffects).forEach(a=>a.updateState()),e.field.getAllCells().filter(a=>a.needsShuffle).map(a=>a.shuffle())});let me=ae;class Gr{constructor(e,t,a,r,n,s=[]){d(this,"duel");d(this,"seat");d(this,"_entity");d(this,"profile");d(this,"deckInfo");d(this,"info");d(this,"infoOrigin");d(this,"status");d(this,"statusOrigin");d(this,"duelistType");d(this,"lifeLog");d(this,"actionBlackListForNPC");d(this,"_lp");d(this,"initHand");d(this,"writeInfoLog",e=>{this.duel.log.info(e,this)});d(this,"initForDrawPhase",()=>{this.info={...this.infoOrigin}});d(this,"canDiscard",e=>(console.log(e),!0));d(this,"canSendToGraveyard",e=>(console.log(e),!0));d(this,"canRelease",e=>(console.log(e),!0));d(this,"canSummon",(e,t,a,r,n,s)=>this.entity.procFilterBundle.operators.filter(o=>o.procTypes.some(u=>u===r)).every(o=>o.filter(e,t,a,s.map(u=>u.material)))?this.entity.procFilterBundle.operators.filter(o=>o.procTypes.some(u=>u===zn(n))).every(o=>o.filter(e,t,a,s.map(u=>u.material))):!1);d(this,"canTryBanish",(e,t,a)=>this.entity.procFilterBundle.operators.filter(r=>r.procTypes.includes(t)).every(r=>r.filter(this,this.entity,a,[e])));d(this,"battleDamage",(e,t)=>this.setLp(this._lp-e,t,"BattleDamage"));d(this,"effectDamage",(e,t)=>this.setLp(this._lp-e,t,"EffectDamage"));d(this,"lostLp",(e,t)=>this.setLp(this._lp-e,t,"Lost"));d(this,"payLp",(e,t)=>this.setLp(this._lp-e,t,"Pay"));d(this,"heal",(e,t)=>this.setLp(this._lp+e,t,"Heal"));d(this,"setLp",(e,t,a)=>{const r={clock:this.duel.clock,reason:a||"Set",beforeLp:this._lp,afterLp:e,entity:t};return this.lifeLog.push(r),this._lp=e,this.writeInfoLog(`ライフポイント変動：${r.afterLp-r.beforeLp}（${r.beforeLp} ⇒ ${r.afterLp}）`),r});d(this,"getOpponentPlayer",()=>this.duel.firstPlayer===this?this.duel.secondPlayer:this.duel.firstPlayer);d(this,"getHandCell",()=>this.duel.field.getCells("Hand").filter(e=>e.owner===this)[0]);d(this,"getDeckCell",()=>this.duel.field.getCells("Deck").filter(e=>e.owner===this)[0]);d(this,"getExtraDeck",()=>this.duel.field.getCells("ExtraDeck").filter(e=>e.owner===this)[0]);d(this,"getGraveyard",()=>this.duel.field.getCells("Graveyard").filter(e=>e.owner===this)[0]);d(this,"getFieldZone",()=>this.duel.field.getCells("FieldSpellZone").filter(e=>e.owner===this)[0]);d(this,"getBanished",()=>this.duel.field.getCells("Banished").filter(e=>e.owner===this)[0]);d(this,"getMonsterZones",()=>this.duel.field.getCells("MonsterZone").filter(e=>e.owner===this));d(this,"getExtraMonsterZones",()=>this.duel.field.getCells("ExtraMonsterZone").filter(e=>{var t;return((t=e.cardEntities[0])==null?void 0:t.controller)===this}));d(this,"getSpellTrapZones",()=>this.duel.field.getCells("SpellAndTrapZone").filter(e=>e.owner===this));d(this,"getXyzMaterialZone",()=>this.duel.field.getCells("XyzMaterialZone").filter(e=>e.owner===this)[0]);d(this,"getEmptyMonsterZones",()=>this.getMonsterZones().filter(e=>e.cardEntities.length===0));d(this,"getEmptyExtraZones",()=>this.getExtraMonsterZones().length===0?this.getMonsterZones().filter(e=>e.cardEntities.length===0):[]);d(this,"getAvailableMonsterZones",()=>this.getMonsterZones().filter(e=>e.isAvailable));d(this,"getAvailableExtraZones",()=>this.getExtraMonsterZones().length===0?this.duel.field.getCells("ExtraMonsterZone").filter(e=>e.isAvailable):[]);d(this,"getAvailableSpellTrapZones",()=>this.getSpellTrapZones().filter(e=>e.isAvailable));d(this,"getReleasableMonsters",()=>this.getMonstersOnField());d(this,"getMonstersOnField",()=>this.duel.field.getMonstersOnField().filter(e=>e.controller===this));d(this,"getEntiteisOnField",()=>this.duel.field.getEntiteisOnField().filter(e=>e.controller===this));d(this,"pushDeck",()=>{this.deckInfo.cardNames.map(e=>Ie[e]).filter(e=>e).forEach(e=>me.createCardEntity(this,e)),this.duel.log.info(`デッキをセット。メイン${this.getDeckCell().cardEntities.length}枚。エクストラ${this.getExtraDeck().cardEntities.length}枚。`,this)});d(this,"draw",async(e,t,a)=>{var s;if(e<1)return;const r=this.getDeckCell(),n=[];for(const o of Array(e)){if(!r.cardEntities.length)throw this.writeInfoLog(n.length>0?`デッキからカードを${e}枚ドローしようとしたが、${n.length}枚しかドローできなかった。${n}`:"デッキからカードをドローできなかった。"),this.duel.isEnded=!0,this.setLp(0),new It(this.getOpponentPlayer());const u=r.cardEntities[0];await u.draw(t?["Effect"]:["Rule"],t,a),n.push(((s=u.origin)==null?void 0:s.name)||"!名称取得失敗!")}this.writeInfoLog(`デッキからカードを${n.length}枚ドロー。${n}。`)});d(this,"discard",async(e,t,a,r,n,s)=>{const o=n||(()=>!0),u=this.getHandCell().cardEntities.filter(o);if(u.length<e)return[];let l=[];return(r||this).duelistType==="NPC"?l=u.randomPickMany(e):l=await this.duel.view.waitSelectEntities(r||this,u,e,c=>c.length===e,`${e}枚カードを捨てる。`,!1)||[],await me.discardManyForTheSameReason(l,["Discard",...t],a,s),this.writeInfoLog(`手札からカードを${l.length}枚捨てた。${l.map(c=>{var v;return(v=c.origin)==null?void 0:v.name})}。`),l});d(this,"summon",async(e,t,a,r,n,s,o=!1)=>{let u=t.randomPick(),l=a.randomPick();if((a.length>1||t.length>1)&&this.duelistType!=="NPC"){const c=a.length>1?"カードを召喚先へドラッグ。":"表示形式を選択。",v=t.map(b=>Ot.createDammyAction(e,b,a,b)),f=this.duel.view.modalController.selectAction(this.duel.view,{title:c,activator:this,actions:v,cancelable:!1}),h=this.duel.view.waitSubAction(this,v,c,o).then(b=>b.action),y=await Promise.any([f,h]);if(!y&&!o)throw new Se("",y);if(!y)return;l=y.cell||l,u=y.pos||u}return await e.summon(l,u,r,n,s,this),e});d(this,"selectAttackTargetForNPC",(e,t)=>{const a=e.atk??0,r=e.getAttackTargets();if(!r.length)return;const n=r.find(s=>s.entityType==="Duelist");return n&&(a>=Ga(1600,this.getOpponentPlayer().lp)||e.info.battlePotisionChangeCount>0)?n:r.find(s=>s.battlePosition==="Attack"?a>=(s.atk??0):a<(s.battlePosition==="Set"?1e3:s.def??0)?!1:s.validateDestory("BattleDestroy",this,e,t))});d(this,"selectActionForNPC",(e,t)=>{if(!e.length)return;const a=e.filter(m=>m.isMandatory);if(a.length)return a.randomPick();let r=e.filter(m=>!this.actionBlackListForNPC.includes(m.playType));const n=r.filter(m=>!Number.isNaN(m.priorityForNPC)).shuffle().sort((m,S)=>m.priorityForNPC-S.priorityForNPC);if(n.length)return n[0];const s=r.filter(m=>m.playType==="TriggerEffect");if(s.length)return s.randomPick();if(this.duel.phase!=="main1"&&this.duel.phase!=="main2"){const m=r.filter(S=>S.playType==="IgnitionEffect");if(m.length)return m.randomPick()}const o=r.filter(m=>m.playType==="Battle").sort((m,S)=>(m.entity.atk??0)-(S.entity.atk??0));if(o.length)return o.find(m=>this.selectAttackTargetForNPC(m.entity,m));r=r.filter(m=>m.playType!=="Battle");const u=r.length?t.slice(-1)[0]:void 0,l=r.filter(m=>m.negatePreviousBlock);if(u&&u.activator!==this&&l)return l.randomPick();if(r=r.filter(m=>!m.negatePreviousBlock),!r.length)return;const c=Or(...this.getOpponentPlayer().getMonstersOnField().filter(m=>m.battlePosition==="Attack").map(m=>m.atk??0),1600),v=Ga(...this.getOpponentPlayer().getMonstersOnField().map(m=>m.battlePosition==="Set"?1500:(m.battlePosition==="Attack"?m.atk:m.def)??0),1500),f=this.getMonstersOnField(),h=Or(...f.filter(m=>m.battlePosition==="Attack").map(m=>m.atk??0),0);let y=r.filter(m=>m.playType!=="ChangeBattlePosition").filter(m=>m.entity.battlePosition!=="Attack").filter(m=>(m.entity.atk??0)>=c||(m.entity.atk??0)>v&&(m.entity.atk??0)>2300);if(y.length)return y.randomPick();r=r.filter(m=>m.playType!=="ChangeBattlePosition").filter(m=>m.playType!=="SpellTrapSet").filter(m=>m.entity.actions.filter(S=>S.playType!=="NormalSummon"&&S.playType!=="SpecialSummon").flatMap(S=>S.executableCells).every(S=>S!=="Hand")||m.playType!=="NormalSummon"&&m.playType!=="SpecialSummon");const b=[...r.filter(m=>m.playType==="NormalSummon").filter(m=>(m.entity.lvl??12)<5),...r.filter(m=>m.playType==="SpecialSummon"),...r.filter(m=>m.playType==="NormalSummon").filter(m=>(m.entity.atk??0)>2600||(m.entity.atk??0)>2300&&(m.entity.lvl??12)<7).filter(m=>(m.entity.atk??0)>=h),...r.filter(m=>m.entity.face==="FaceUp").filter(m=>m.entity.isOnField)];if(b.length)return b.randomPick();if(r=r.filter(m=>m.playType!=="NormalSummon").filter(m=>m.playType!=="SpecialSummon"),this.duel.phase==="main2"){if(y=e.filter(m=>m.playType==="ChangeBattlePosition").filter(m=>m.entity.battlePosition==="Attack").filter(m=>(m.entity.atk??0)<c||(m.entity.atk??0)>v&&(m.entity.atk??0)>2300),y.length)return y.randomPick();if(this.getAvailableSpellTrapZones.length>1)return e.filter(m=>m.playType==="SpellTrapSet").filter(m=>m.entity.status.kind!=="Spell"||m.entity.status.spellCategory==="QuickPlay").randomPick()}if(Math.random()<r.length/4)return r.randomPick()});this.duel=e,this.seat=t,this.profile=a,this.duelistType=r,this.deckInfo=n,this.initHand=s,this.lifeLog=[],this.infoOrigin={maxRuleNormalSummonCount:1,ruleNormalSummonCount:0,ruleNormalSummonCountQty:0,effectNormalSummonCount:0,effectNormalSummonCountQty:0,specialSummonCount:0,specialSummonCountQty:0},this.info={...this.infoOrigin},this.statusOrigin={maxSpecialSummonCount:Number.MAX_VALUE,canDrawByEffect:!0,canSearchFromDeck:!0,canDiscardAsCost:!0,canDiscardAsEffect:!0},this.status={...this.statusOrigin},this._lp=8e3;const o=[];this.duelistType==="NPC"&&(this.profile.npcLvl<1&&o.push("CardActivation","IgnitionEffect","TriggerEffect","QuickEffect"),this.profile.npcLvl<101&&o.push("Battle")),this.actionBlackListForNPC=o}get entity(){const e=this.getHandCell().entities.find(t=>t.entityType==="Duelist");return e||me.createPlayerEntity(this)}get lp(){return this._lp}get isTurnPlayer(){return this.duel.getTurnPlayer()===this}get canDraw(){return!0}get canAddToHandFromDeck(){return!0}}class Lo{constructor(e){d(this,"cells");d(this,"duel");d(this,"procFilterPool");d(this,"numericStateOperatorPool");d(this,"cardRelationPool");d(this,"statusOperatorPool");d(this,"getAllCells",()=>this.cells.flat());d(this,"getCells",(...e)=>this.getAllCells().filter(t=>e.includes(t.cellType)));d(this,"getAllEntities",()=>this.getAllCells().map(e=>e.entities).flat());d(this,"getAllCardEntities",()=>this.getAllCells().map(e=>e.cardEntities).flat());d(this,"getMonstersOnField",()=>this.getCells(...Si).map(e=>e.cardEntities).filter(e=>e.length>0).map(e=>e[0]));d(this,"getEntiteisOnField",()=>this.getCells(...bi).map(e=>e.entities).filter(e=>e.length>0).map(e=>e[0]));d(this,"getEntities",e=>this.getAllEntities().filter(t=>t.controller===e));d(this,"drawAtSameTime",async(e,t,a,r,n,s)=>{const o=[],u=[],l=[e.draw(t,n,s),a.draw(r,n,s)].map(c=>c.catch(v=>{v instanceof It?v.winner&&o.push(v.winner):u.push(v)}));if(await Promise.all(l),u.length)throw new Se("ドロー処理で想定されない例外が発生した。",e,t,a,r,n,...u);if(o.length!==0)throw o.length===1?new It(o[0]):new It});d(this,"sendToGraveyard",async(e,t,a,r,n,s,o,u)=>{if(r>0&&a.length<r)return;const l=await this.duel.view.waitSelectEntities(t,a,r,n,e,u);if(l)return await me.sendManyToGraveyard(l.map(c=>({entity:c,causedAs:s,causedBy:o,activator:t}))),this.duel.log.info(`${l.map(c=>c.status.name).join(", ")}を墓地に送った（${s.getDistinct().join(", ")}）。`,t),l});d(this,"release",async(e,t,a,r,n,s,o,u)=>{if(a>0&&t.length<a)return;const l=await this.duel.view.waitSelectEntities(e,t,a,v=>(o||v.length>0)&&(a<0||v.length===a),"リリースするモンスターを選択",u);if(!l)return;const c=[];for(const v of l)await v.release(["Release",r,...n],s,e),c.push(v);return this.duel.log.info(`${c.map(v=>v.status.name).join(", ")}をリリース（${c.flatMap(v=>v.moveLog.latestRecord.movedAs).getDistinct().join(", ")}）。`,e),c});d(this,"activateSpellTrapFromHand",async(e,t,a,r,n,s,o=!1)=>{const u=s??(n==null?void 0:n.controller)??t.controller;let l=a.randomPick();if(a.length>1&&u.duelistType!=="NPC"){const c=[Ot.createDammyAction(t,"カードの発動",a,void 0)];this.duel.view.modalController.selectAction(this.duel.view,{title:"カードを魔法罠ゾーンへドラッグ",activator:e,actions:c,cancelable:!1});const v=await this.duel.view.waitSubAction(u,c,"カードを魔法罠ゾーンへドラッグ。",o),f=v.action;if(!f&&!o)throw new Se("",v);if(!f)return;l=f.cell||l}return await t.activateSpellTrapFromHand(l,t.origin.kind,r,n,u),t});d(this,"setSpellTrap",async(e,t,a,r,n,s=!1)=>{let o=a[0];const u=n??(r==null?void 0:r.controller)??t.controller;if(a.length>1&&u.duelistType!=="NPC"){const l=[Ot.createDammyAction(t,"セット",a)],c=this.duel.view.modalController.selectAction(this.duel.view,{title:"カードをセット先へドラッグ",activator:e,actions:l,cancelable:s}),v=this.duel.view.waitSubAction(u,l,"カードをセット先へドラッグ",s),f=await Promise.any([c,v.then(h=>h.action)]);if(!f&&!s)throw new Se("",f);if(!f)return;o=f.cell||o}return await t.setAsSpellTrap(o,t.origin.kind,["SpellTrapSet"],r,u),this.duel.log.info(`${t.status.name}をセット（SpellTrapSet）。`,n??(r==null?void 0:r.controller)??t.controller),o});this.duel=e,this.cells=[...Array(7)].map(()=>[]);for(const t of Object.keys(Wa).map(Number))for(const a of Object.keys(Wa[t]).map(Number))this.cells[t][a]=new Ul(this,t,a,t<3?e.duelists.Above:t>3?e.duelists.Below:a<2?e.duelists.Above:a>4?e.duelists.Below:void 0);this.procFilterPool=new zl,this.numericStateOperatorPool=new Yl,this.cardRelationPool=new ro,this.statusOperatorPool=new vo}}let Ro=class{constructor(e){d(this,"onUpdateEvent",new Je);d(this,"nextSeq");d(this,"records",[]);d(this,"duel");d(this,"dispose",()=>{this.onUpdateEvent.clear()});d(this,"error",e=>{console.error(e);const t=["エラー発生"];e instanceof Error?(e instanceof Se&&(t.push("-- エラーメッセージ --"),t.push(e.message),t.push("-- 関連オブジェクト --"),e.items.forEach(a=>t.push(JSON.stringify(a)))),t.push("-- エラー名称 --"),t.push(e.name||"エラー名称取得失敗"),t.push("-- スタックトレース --"),t.push(e.stack||"スタックトレース取得失敗")):(t.push("-- エラー型特定失敗 --"),t.push(JSON.stringify(e))),this.write("error",t)});d(this,"warn",e=>{this.write("warn",["【注意】",e])});d(this,"info",(e,t)=>{this.write("info",[e],t)});d(this,"write",(e,t,a)=>{const r=Array.isArray(t)?t.join(`
`):t;this.records.push({seq:this.nextSeq++,lvl:e,turn:this.duel.clock.turn,periodKey:this.duel.clock.period.key,clock:this.duel.clock,duelist:a,text:r}),this.onUpdateEvent.trigger()});this.nextSeq=0,this.duel=e}get onUpdate(){return this.onUpdateEvent.expose()}get lastRecord(){return this.records.slice(-1)[0]}};const zr=["DuelEntitiesSelector","DuelActionSelector","DuelTextSelector"];class Ho{constructor(e){d(this,"onUpdateEvent",new Je);d(this,"states");d(this,"view");d(this,"cancelAll",()=>{zr.forEach(e=>this.states[e]="Disable"),console.info(this,"cancelAll"),this.onUpdateEvent.trigger()});d(this,"duelEntitiesSelectorArg",{title:"対象を選択",entities:[],validator:()=>!0,qty:-1,cancelable:!1,chainBlockInfos:[]});d(this,"duelEntitiesSelectorValue");d(this,"duelEntitiesSelectorResolve",()=>{});d(this,"selectDuelEntities",async e=>(this.duelEntitiesSelectorArg=e,this.states.DuelEntitiesSelector="Shown",this.onUpdateEvent.trigger(),new Promise(t=>{this.duelEntitiesSelectorResolve=a=>{this.states.DuelEntitiesSelector="Disable",this.onUpdateEvent.trigger(),t(a)}})));d(this,"cardActionSelectorArg",{title:"カード操作を選択。",activator:void 0,actions:[],cancelable:!1});d(this,"cardActionSelectorResolve",()=>{});d(this,"cardActionSelectorValue");d(this,"selectAction",async(e,t)=>(this.cardActionSelectorArg=t,this.states.DuelActionSelector="Shown",e.onWaitEnd.append(this.cancelAll),this.onUpdateEvent.trigger(),new Promise(a=>{this.cardActionSelectorResolve=r=>{this.states.DuelActionSelector="Disable",e.onWaitEnd.remove(this.cancelAll),this.onUpdateEvent.trigger(),a(r)}})));d(this,"duelTextSelectorArg",{title:"カード操作を選択。",choises:[],cancelable:!1});d(this,"duelTextSelectorResolve",()=>{});d(this,"duelTextSelectorValue");d(this,"selectText",async(e,t)=>(this.duelTextSelectorArg=t,this.states.DuelTextSelector="Shown",e.onWaitEnd.append(this.cancelAll),this.onUpdateEvent.trigger(),new Promise(a=>{this.duelTextSelectorResolve=r=>{this.states.DuelTextSelector="Disable",e.onWaitEnd.remove(this.cancelAll),this.onUpdateEvent.trigger(),a(r)}})));this.view=e,this.states=zr.reduce((t,a)=>(t[a]="Disable",t),{})}get onUpdate(){return this.onUpdateEvent.expose()}}const $o=i=>new Promise(e=>setTimeout(e,i)),jo=()=>{let i=()=>{},e=()=>{};return{promise:new Promise((a,r)=>{i=a,e=r}),resolve:i,reject:e}};class Uo{constructor(e){d(this,"onDuelUpdateEvent",new Je);d(this,"requireUpdate",()=>{this.onDuelUpdateEvent.trigger()});d(this,"onWaitStartEvent",new Je);d(this,"onWaitEndEvent",new Je);d(this,"onDragStartEvent",new Je);d(this,"onDragEndEvent",new Je);d(this,"onAnimationStartEvent",new Je);d(this,"onShowCardEntityEvent",new Je);d(this,"duel");d(this,"modalController");d(this,"_message");d(this,"waitMode");d(this,"infoBoardState");d(this,"infoBoardCell");d(this,"removeSvelteInfo",e=>{const t={...e};return t.selectedEntities&&(t.selectedEntities=me.recreateArray(this.duel.field,t.selectedEntities)),t});d(this,"getCell",(e,t)=>this.duel.field.cells[e][t]);d(this,"showCardInfo",(e,t)=>{this.onShowCardEntityEvent.trigger({card:e,mode:t})});d(this,"dispose",()=>{this.onDragStartEvent.clear(),this.onDragEndEvent.clear(),this.onDuelUpdateEvent.clear(),this.onWaitStartEvent.clear(),this.onWaitEndEvent.clear()});d(this,"waitFieldAction",async e=>{if(this.duel.getTurnPlayer().duelistType==="NPC"){const t=this.duel.getTurnPlayer().selectActionForNPC(e,[]);return t?{action:t}:{phaseChange:this.duel.nextPhaseList[0]}}return await this._waitDuelistAction(this.duel.getTurnPlayer(),e,"SelectFieldAction","")});d(this,"waitQuickEffect",async(e,t,a,r,n)=>{if(t.length===0)return;if(e.duelistType==="NPC")return e.selectActionForNPC(t,a);const s=[];return s.push(this.modalController.selectAction(this,{title:r,activator:e,actions:t,cancelable:n}).then(o=>o&&o)),s.push(this._waitDuelistAction(e,t,"SelectAction",this.message).then(o=>(this.infoBoardState="Log",o.action))),await Promise.any(s)});d(this,"waitSubAction",async(e,t,a,r=!1)=>{if(e.duelistType==="NPC")throw Error("Not implemented");return await this._waitDuelistAction(e,t,"SelectAction",a,void 0,void 0,void 0,r)});d(this,"waitSelectEntities",async(e,t,a,r,n,s=!1)=>{let o=[];if(a&&t.length===a)return[...t];if(e.duelistType==="NPC"){for(;!r(o);){const l=a&&a>0?a:Math.floor(Math.random()*t.length)+1;o=t.randomPickMany(l)}return o}return this.waitMode=t.every(l=>l.fieldCell.isPlayFieldCell&&l.getIndexInCell()===0||l.fieldCell.cellType==="Hand"&&l.controller===e)?"SelectFieldEntities":"SelectEntities",[...(await this._waitDuelistAction(e,[],this.waitMode,n,t,a,r,s)).selectedEntities??[]]});d(this,"_waitDuelistAction",async(e,t,a,r,n,s,o,u=!1)=>{this.waitMode=a,this._message=r,this.onDuelUpdateEvent.trigger();const l=jo(),c={resolve:l.resolve,activator:e,enableActions:t,qty:s,chainBlockInfos:e.duel.chainBlockInfos,entitiesValidator:o||(()=>!1),selectableEntities:n||[]};n&&o&&this.waitMode==="SelectEntities"&&(c.duelEntitiesSelectorArg={title:r,entities:n,validator:o,qty:s??-1,cancelable:!1,chainBlockInfos:e.duel.chainBlockInfos}),this.onWaitStartEvent.trigger(c);const v=await l.promise;if(this.waitMode="None",this.onWaitEndEvent.trigger(),v.surrender)throw new It(this.duel.duelists.Above);if(!u&&v.cancel)throw new Se("キャンセル不可のアクションがキャンセルされた。",v,t,a,n);return this.infoBoardState="Log",this.removeSvelteInfo(v)});d(this,"waitSelectSummonDest",async(e,t,a,r,n)=>{const s=a.length>1?"カードを召喚先へドラッグ。":"表示形式を選択。",o=r.map(v=>Ot.createDammyAction(t,v,a,v)),u=this.modalController.selectAction(t.field.duel.view,{title:s,activator:e,actions:o,cancelable:!1}),l=this.waitSubAction(t.controller,o,s,n).then(v=>v.action),c=await Promise.any([u,l]);if(!c&&!n)throw new Se("キャンセル不可のアクションがキャンセルされた。",c);if(c){if(!c.cell)throw new Se("召喚先のセルが指定されなかった。",c);if(!c.pos)throw new Se("表示形式が指定されなかった。",c);return{dest:c.cell,pos:c.pos}}});d(this,"waitSelectText",async(e,t,a=!1)=>this.duel.view.modalController.selectText(this.duel.view,{title:t,choises:e,cancelable:a}));d(this,"waitAnimation",async e=>(this._message="",this.waitMode="Animation",this.onDuelUpdateEvent.trigger(),new Promise(t=>this.onAnimationStartEvent.trigger({...e,resolve:t}))));d(this,"setDraggingActions",e=>{this.onDragStartEvent.trigger(e),this.requireUpdate()});d(this,"removeDraggingActions",()=>{this.onDragEndEvent.trigger()});d(this,"waitDammyActions",async(e,t,a,r,n,s=!1)=>{let o=a.randomPick();if(a.length>1&&e.duelistType!=="NPC"){const u=[Ot.createDammyAction(t,n,a,void 0)];this.duel.view.modalController.selectAction(this.duel.view,{title:r,activator:e,actions:u,cancelable:!1});const l=await this.duel.view.waitSubAction(e,u,r,s),c=l.action;if(!c&&!s)throw new Tt("",l);if(!c)return;o=c.cell||o}return o});this.duel=e,this._message="",this.waitMode="None",this.infoBoardState="Log",this.infoBoardCell=e.duelists.Below.getExtraDeck(),this.modalController=new Ho(this)}get onDuelUpdate(){return this.onDuelUpdateEvent.expose()}get onWaitStart(){return this.onWaitStartEvent.expose()}get onWaitEnd(){return this.onWaitEndEvent.expose()}get onDragStart(){return this.onDragStartEvent.expose()}get onDragEnd(){return this.onDragEndEvent.expose()}get onAnimation(){return this.onAnimationStartEvent.expose()}get onShowCardEntity(){return this.onShowCardEntityEvent.expose()}get message(){return this._message||this.duel.log.lastRecord.text}}class Zo{constructor(){d(this,"onTotalProcSeqChangeEvent",new Je);d(this,"onStageChangeEvent",new Je);d(this,"_turn",0);d(this,"_phaseSeq",0);d(this,"_stepSeq",0);d(this,"_stageSeq",0);d(this,"_chainSeq",0);d(this,"_chainBlockSeq",0);d(this,"_procSeq",0);d(this,"_procTotalSeq",0);d(this,"_periodKey");d(this,"setPhase",(e,t)=>{const a=Object.values(Wt).filter(r=>r.phase===t).find(r=>(r.step??"start")==="start");if(!a)throw new Se("想定されない状態",this.period,t,Wt);t==="draw"?(e.log.info("ターン終了。",e.getTurnPlayer()),this._turn++,this._phaseSeq=0):(e.log.info(`フェイズ移行（${this.period.name}→${a.name}）`,e.getTurnPlayer()),this._phaseSeq++),this._stepSeq=0,this._stageSeq=0,this.periodKey=a.key});d(this,"setStep",(e,t)=>{const a=this.period.phase,r=Object.values(Wt).filter(n=>n.phase===a).find(n=>(n.step??"")===t);if(!r)throw new Se("想定されない状態",this.period,t,Wt);this.period.name!==r.name&&(e.log.info(`ステップ移行（${this.period.name}→${r.name}）`,e.getTurnPlayer()),this._stepSeq++,this._stageSeq=0,this.periodKey=r.key)});d(this,"setStage",(e,t)=>{const a=this.period,r=Object.values(Wt).filter(n=>n.phase===a.phase).filter(n=>n.step===a.step).find(n=>(n.stage??"")===t);if(!r)throw new Se("想定されない状態",this.period,t,Wt);e.log.info(`タイミング移行（${this.period.name}→${r.name}）`,e.getTurnPlayer()),this._stageSeq++,this.periodKey=r.key});d(this,"incrementChainSeq",()=>{this._chainSeq++,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq()});d(this,"incrementChainBlockSeq",()=>{this._chainBlockSeq++,this._procSeq=0,this.incrementTotalProcSeq()});d(this,"incrementProcSeq",()=>{this._procSeq++,this.incrementTotalProcSeq()});d(this,"incrementTotalProcSeq",()=>{this._procTotalSeq++,this.onTotalProcSeqChangeEvent.trigger(this.totalProcSeq)});d(this,"toString",()=>`${this.totalProcSeq}(t${this.turn}-phs${this.phaseSeq}-stp${this.stepSeq}-stg${this.stepSeq}-c${this.chainSeq}-cb${this.chainBlockSeq}-prc${this.procSeq})`);d(this,"getClone",()=>({turn:this.turn,phaseSeq:this.phaseSeq,stepSeq:this.stepSeq,stageSeq:this.stageSeq,chainSeq:this.chainSeq,chainBlockSeq:this.chainBlockSeq,procSeq:this.procSeq,totalProcSeq:this.totalProcSeq}));d(this,"isSameTurn",e=>this.turn===e.turn);d(this,"isSameChain",e=>this.turn===e.turn&&this.phaseSeq===e.phaseSeq&&this.stepSeq===e.stepSeq&&this.stageSeq===e.stageSeq&&this.chainSeq===e.chainSeq);d(this,"isPreviousChain",e=>this.turn===e.turn&&this.phaseSeq===e.phaseSeq&&this.stepSeq===e.stepSeq&&this.stageSeq===e.stageSeq&&this.chainSeq===e.chainSeq+1);d(this,"isPreviousProc",e=>this.totalProcSeq===e.totalProcSeq+1);d(this,"isUponAttackDeclaration",()=>this.period.step==="battle"&&this.chainSeq===1);this._periodKey="end"}get onTotalProcSeqChange(){return this.onTotalProcSeqChangeEvent.expose()}get onStageChange(){return this.onStageChangeEvent.expose()}set periodKey(e){this._periodKey!==e&&(this._periodKey=e,this._chainSeq=0,this._chainBlockSeq=0,this._procSeq=0,this.onStageChangeEvent.trigger(this.period),this.incrementTotalProcSeq())}get periodKey(){return this._periodKey}get period(){return Wt[this.periodKey]}get turn(){return this._turn}get phaseSeq(){return this._phaseSeq}get stepSeq(){return this._stepSeq}get stageSeq(){return this._stageSeq}get chainSeq(){return this._chainSeq}get chainBlockSeq(){return this._chainBlockSeq}get procSeq(){return this._procSeq}get totalProcSeq(){return this._procTotalSeq}get isFirstChain(){return this.chainSeq===0}}class Go{constructor(e){d(this,"nextSeq");d(this,"records",[]);d(this,"duel");d(this,"push",e=>{this.records.push({seq:this.nextSeq++,clock:this.duel.clock.getClone(),chainBlockInfo:e})});this.nextSeq=0,this.duel=e}}me.prototype.hasBeenSummonedNow=function(i,e=["Attack","Defense"]){const t=this,a=e.map(zn),r=t.moveLog.latestRecord.movedAs;return!(!t.wasMovedAtPreviousChain||!r.union(i).length||!r.union(a).length)};me.prototype.getAttackTargets=function(){if(!this.hasAttackRight())return[];const i=this.duel.field.getMonstersOnField().filter(e=>e.status.isSelectableForAttack).filter(e=>e.controller!==this.controller);return(this.status.canDirectAttack||!i.length)&&i.push(this.controller.getOpponentPlayer().entity),i.filter(e=>e.canBeTargetOfBattle(this.controller,this)).filter(e=>this.procFilterBundle.operators.filter(t=>t.procTypes.includes("BattleTarget")).every(t=>t.filter(this.controller,this,{},[e])))};me.prototype.canDirectAttack=function(){return this.getAttackTargets().some(i=>i.entityType==="Duelist")};me.prototype.canAttackToMonster=function(){return this.getAttackTargets().some(i=>i.entityType!=="Duelist")};me.prototype.hasAttackRight=function(){return this.battlePosition==="Attack"&&this.info.attackCount===0&&this.status.canAttack};me.prototype.canBeEffected=function(i,e,t){return this.procFilterBundle.operators.filter(r=>r.procTypes.some(n=>n==="Effect")).every(r=>r.filter(i,e,t,[this]))};const Wn=(i,e,t,a,r)=>i.canBeEffected(t,a,r)&&i.procFilterBundle.operators.filter(n=>n.procTypes.some(s=>s===e)).every(n=>n.filter(t,a,r,[i]));me.prototype.canBeTargetOfEffect=function(i){return Wn(this,"EffectTarget",i.activator,i.action.entity,i.action)};me.prototype.canBeBanished=function(i,e,t){return this.fieldCell.cellType==="Banished"?!1:Wn(this,"BanishAsEffect",i,e,t)};me.prototype.canBeTargetOfBattle=function(i,e){const t=this;return t.procFilterBundle.operators.filter(a=>a.procTypes.some(r=>r==="BattleTarget")).every(a=>a.filter(i,e,{},[t]))};me.prototype.validateDestory=function(i,e,t,a){const r=this;let n=r.procFilterBundle.operators.filter(s=>s.procTypes.includes(i)).every(s=>s.filter(e,t,a??{},[r]));return n&&i==="EffectDestroy"&&(n=r.canBeEffected(e,t,a)),n};me.prototype.getIndexInCell=function(){const i=this;if(i.info.isVanished)return-1;const e=i.fieldCell.cardEntities.indexOf(i);if(e<0)throw new Se("エンティティとセルの状態が矛盾している。",[i,i.fieldCell]);return e};me.prototype.getXyzMaterials=function(){const i=this;return(i.status.monsterCategories??[]).includes("Xyz")?i.fieldCell.xyzMaterials:[]};me.prototype.wasMovedAfter=function(i){return console.log(this.toString(),this.moveLog.latestRecord.movedAt.totalProcSeq,i.totalProcSeq),this.moveLog.latestRecord.movedAt.totalProcSeq>i.totalProcSeq};const zo=(i,e)=>{if(i.info.isDying||i.status.kind==="XyzMaterial"||!i.isOnField&&i.fieldCell.cellType!=="Deck"&&i.fieldCell.cellType!=="Hand")return!1;const t=e.action.playType==="Battle"?"BattleDestroy":"EffectDestroy",a=t==="BattleDestroy"&&e.action.entity===i?e.selectedEntities[0]:e.action.entity;return i.info.isDying=i.validateDestory(t,e.activator,a,e.action),i.info.isDying&&(i.info.causeOfDeath=[t],i.info.isKilledBy=a,i.info.isKilledByWhom=e.activator,t==="BattleDestroy"&&(i.info.isKilledByWhom=a.controller)),i.info.isDying},di=class di{constructor(){}};d(di,"tryDestroy",async(e,t)=>{const a=await di.tryMarkForDestory(e,t);return await me.waitCorpseDisposal(t.activator.duel),a}),d(di,"tryMarkForDestory",async(e,t)=>{let a=e.filter(o=>zo(o,t));if(!a.length)return[];const r=t.action.playType==="Battle"?"BattleDestroy":"EffectDestroy";(await Promise.all(e[0].field.getAllEntities().flatMap(o=>o.substituteEffects.filter(u=>u.isMandatory).filter(u=>u.executableCells.includes(o.fieldCell.cellType)).filter(u=>u.isApplicableTo(r,e,t).length).flatMap(u=>u.substitute(r,e,t))))).flatMap(o=>o).forEach(o=>{o.resetCauseOfDeath()}),a=a.filter(o=>o.info.isDying);let n=e[0].field.getAllEntities().flatMap(o=>o.substituteEffects.filter(u=>!u.isMandatory).filter(u=>u.executableCells.includes(o.fieldCell.cellType)).filter(u=>u.isApplicableTo(r,e,t).length).map(u=>({chooser:o.owner,effect:u,sacrifice:o})));for(const o of n.map(u=>u.sacrifice.controller).getDistinct()){const u=n.filter(f=>f.sacrifice.controller===o),l=u.map(f=>Ot.createDammyAction(f.sacrifice,f.effect.title,[])),c=await e[0].duel.view.waitSubAction(o,l,"身代わり効果を適用する？",!0);if(!c||!c.action)continue;const v=u.filter(f=>{var h;return f.effect.title===((h=c.action)==null?void 0:h.title)}).find(f=>{var h;return f.sacrifice===((h=c.action)==null?void 0:h.entity)});if(!v)throw new Se("想定されない状態",c,l,a);if((await v.effect.substitute(r,a,t)).forEach(f=>{f.resetCauseOfDeath()}),a=a.filter(f=>f.info.isDying),!a.length)return[];n=n.filter(f=>f.effect.isApplicableTo(r,e,t).length)}const s=a.filter(o=>o.info.isDying);return s.forEach(o=>o.duel.log.info(`${o.toString()}を${No[r]}。`,o.info.isKilledByWhom)),s}),d(di,"tryBanish",async(e,t)=>{const a=e.filter(r=>r.canBeBanished(t.activator,t.action.entity,t.action));return await me.banishManyForTheSameReason(a,["Effect"],t.action.entity,t.activator),a.filter(r=>r.fieldCell.cellType==="Banished").filter(r=>r.moveLog.latestRecord.movedBy===t.action.entity)});let it=di;const Vo=["PlayFirst","DrawFirst","Random"],Vr={PlayFirst:"先攻",DrawFirst:"後攻",Random:"ランダム"};class It extends Error{constructor(t){const a=t?`デュエルが終了した。勝者：${t.profile.name}`:"デュエルが終了した。ドロー。";super(a);d(this,"winner");this.winner=t}}class Se extends Error{constructor(t,...a){super(t);d(this,"message");d(this,"items");this.message=t,this.items=a}}class Tt extends Se{constructor(...e){super("キャンセル不可のアクションがキャンセルされた。",...e)}}class Wo{constructor(e,t,a,r=[],n,s,o,u=[],l="Random"){d(this,"view");d(this,"log");d(this,"chainBlockLog");d(this,"clock");d(this,"nextPhaseList");d(this,"field");d(this,"attackingMonster");d(this,"targetForAttack");d(this,"_chainBlockInfos");d(this,"duelists");d(this,"priorityHolder");d(this,"isEnded");d(this,"coin",!1);d(this,"startMode");d(this,"distributeOperators",e=>{console.info(`[totalProcSeq]:${e}`);let t=0;for(;;){if(t++,t>10)throw new Se("無限ループ発生");if(this.field.procFilterPool.distributeAll(this)&&this.field.statusOperatorPool.distributeAll(this)&&this.field.cardRelationPool.distributeAll(this)&&this.field.numericStateOperatorPool.distributeAll(this))return}});d(this,"getTurnPlayer",()=>this.clock.turn%2===0?this.secondPlayer:this.firstPlayer);d(this,"getNonTurnPlayer",()=>this.clock.turn%2===0?this.firstPlayer:this.secondPlayer);d(this,"main",async()=>{console.info("main start!"),this.coin=this.startMode==="PlayFirst"?!0:this.startMode==="DrawFirst"?!1:Math.random()>.5,this.priorityHolder=this.firstPlayer,this.log.info("【デュエル開始】"),this.log.info(`先攻：${this.firstPlayer.profile.name}`),Object.values(this.duelists).forEach(e=>e.pushDeck()),Object.values(this.duelists).forEach(e=>e.getDeckCell().shuffle()),Object.values(this.duelists).forEach(e=>{e.initHand.length&&e.initHand.forEach(t=>{const a=e.getDeckCell().cardEntities.find(r=>r.origin.name===t);if(!a){this.log.info(`初手操作により${t}を手札に加えようとしたが、デッキに存在しない。`);return}a.addToHand(["System"],void 0,void 0),this.log.info(`初手操作により${a.toString()}を手札に加えた`,e)})}),await Promise.all(Object.values(this.duelists).map(e=>e.draw(5-e.getHandCell().cardEntities.length,void 0,void 0))),this.moveNextPhase("draw"),this.view.requireUpdate();try{for(;!this.isEnded&&(this.clock.period.phase==="draw"?await this.procDrawPhase():this.phase==="standby"?await this.procStanbyPhase():this.phase==="main1"?await this.procMainPhase():this.phase==="battle1"?await this.procBattlePhase():this.phase==="battle2"?await this.procBattlePhase():this.phase==="main2"?await this.procMainPhase():this.phase==="end"&&await this.procEndPhase(),!(this.clock.turn>1e3)););}catch(e){e instanceof It?(console.info(e),this.isEnded=!0,this.log.info(e.winner?`デュエル終了。勝者${e.winner.profile.name}`:"引き分け")):e instanceof Error&&this.log.error(e)}finally{this.view.requireUpdate(),this.view.dispose(),this.log.dispose()}});d(this,"moveNextPhase",e=>{this.clock.setPhase(this,e),this.phase==="main2"||this.clock.turn===1?this.nextPhaseList=["end"]:this.phase==="battle1"||this.phase==="battle2"?this.nextPhaseList=["main2"]:this.phase==="main1"?this.nextPhaseList=["battle1","end"]:this.nextPhaseList=[]});d(this,"declareAnAttack",(e,t)=>{var r;this.attackingMonster=e,this.targetForAttack=t;let a=" ("+((r=t.battlePosition==="Attack"?t.atk:t.def)==null?void 0:r.toString())+")";t.face==="FaceDown"&&(a=" (????)"),t.entityType==="Duelist"&&(a=""),e.info.attackCount++,this.log.info(`攻撃宣言：${e.toString()} (${e.atk})⇒ ${t.toString()}${a}`,e.controller)});d(this,"procDrawPhase",async()=>{Object.values(this.duelists).forEach(e=>e.initForDrawPhase()),this.log.info("ドローフェイズ開始。",this.getTurnPlayer()),this.clock.turn===1?this.log.info("先攻プレイヤーはドローできない。",this.getTurnPlayer()):await this.getTurnPlayer().draw(1,void 0,void 0),this.field.getEntiteisOnField().forEach(e=>e.initForTurn()),await this.procSpellSpeed1(),this.moveNextPhase("standby")});d(this,"procStanbyPhase",async()=>{await this.procSpellSpeed1(),this.moveNextPhase("main1")});d(this,"procMainPhase",async()=>{for(;;){this.priorityHolder=this.getTurnPlayer();const e=await this.view.waitFieldAction(this.getEnableActions(this.priorityHolder,["NormalSummon","SpellTrapSet","SpecialSummon","ChangeBattlePosition","IgnitionEffect","QuickEffect","CardActivation"],["Normal","Quick","Counter"],[]));if(e&&e.action){if([...Zl].includes(e.action.playType)){const a=await e.action.prepare(this.priorityHolder,e.action.cell,[],!0,!1);if(a===void 0)continue;await e.action.execute(a,this.chainBlockInfos),this.clock.incrementChainSeq()}else await this.procChainBlock({activator:this.priorityHolder,action:e.action},void 0);for(;await this.procChainBlock(void 0,void 0););continue}const t=e.phaseChange;if(t){this.priorityHolder=this.getNonTurnPlayer();const a=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(this.priorityHolder,["QuickEffect","TriggerEffect"],["Quick","Counter"],[]),[],"",!0);if(a){for(await this.procChainBlock({activator:this.priorityHolder,action:a},void 0);await this.procChainBlock(void 0,void 0););continue}this.moveNextPhase(t);return}}});d(this,"procBattlePhase",async()=>{await this.procBattlePhaseStartStep(),await this.procBattlePhaseBattleStep(),await this.procBattlePhaseEndStep()});d(this,"procBattlePhaseStartStep",async()=>{this.clock.setStep(this,"start"),this.priorityHolder=this.getTurnPlayer(),this.attackingMonster=void 0,this.targetForAttack=void 0,await this.procSpellSpeed1()});d(this,"procBattlePhaseBattleStep",async()=>{for(;;){this.clock.setStep(this,"battle"),this.priorityHolder=this.getTurnPlayer();const e=await this.view.waitFieldAction(this.getEnableActions(this.priorityHolder,["Battle"],["Normal"],[]));if(e.phaseChange)break;if(e.action){const t=await e.action.prepare(this.priorityHolder,e.action.cell,[],!0,!1);if(!t)continue;await e.action.execute(t,[]),this.clock.incrementChainSeq();let a=!0;for(;;){const r=this.getNonTurnPlayer().getMonstersOnField().map(s=>[s.seq,s.moveLog.latestRecord.movedAt.totalProcSeq]);for(;await this.procChainBlock(void 0,void 0););if(!this.attackingMonster)throw new Se("想定されない状態");this.attackingMonster.isOnField?this.attackingMonster.face==="FaceDown"?(this.log.info(`${this.attackingMonster.toString()}が裏側守備表示になったため、戦闘が中断された。`),a=!1):this.attackingMonster.orientation==="Horizontal"&&(this.log.info(`${this.attackingMonster.toString()}が守備表示になったため、戦闘が中断された。`),a=!1):(this.log.info(`${this.attackingMonster.toString()}がフィールドにいなくなったため、戦闘が中断された。`),a=!1);const n=this.getNonTurnPlayer().getMonstersOnField().map(s=>[s.seq,s.moveLog.latestRecord.movedAt.totalProcSeq]);if(r.length!==n.length)throw this.log.info("モンスターの数が増減したためバトルステップの巻き戻しが発生。"),new Se("巻き戻し未実装");if(r.some(([s,o])=>n.every(([u,l])=>u!==s||l!==o)))throw this.log.info("モンスターの数が増減したためバトルステップの巻き戻しが発生。"),new Se("巻き戻し未実装");break}if(!a)continue;await this.procBattlePhaseDamageStep(t)}}});d(this,"procBattlePhaseDamageStep",async e=>{if(!this.attackingMonster||!this.targetForAttack)throw new Se("想定されない状態",this.attackingMonster,this.targetForAttack);await this.procBattlePhaseDamageStep1(),await this.procBattlePhaseDamageStep2(this.attackingMonster,this.targetForAttack),await this.procBattlePhaseDamageStep3(e,this.attackingMonster,this.targetForAttack),await this.procBattlePhaseDamageStep4(),await this.procBattlePhaseDamageStep5()});d(this,"procBattlePhaseDamageStep1",async()=>{for(this.clock.setStage(this,"start");await this.procChainBlock(void 0,void 0););});d(this,"procBattlePhaseDamageStep2",async(e,t)=>{for(this.clock.setStage(this,"beforeDmgCalc"),(t==null?void 0:t.battlePosition)==="Set"&&t.setBattlePosition("Defense",["Flip","FlipByBattle"],e,e.controller);await this.procChainBlock(void 0,void 0););});d(this,"procBattlePhaseDamageStep3",async(e,t,a)=>{if(t.atk===void 0)throw new Se("想定されない状態",this.attackingMonster,this.targetForAttack);for(this.clock.setStage(this,"dmgCalc");await this.procChainBlock(void 0,void 0););const r=t.atk,n=(a.battlePosition==="Attack"?a.atk:a.def)??0;a.entityType==="Duelist"?(e.activator.writeInfoLog(`ダメージ計算：${t.toString()} (${r}) ⇒ ${a.toString()}`),t.controller.getOpponentPlayer().battleDamage(r-n,t)):(e.activator.writeInfoLog(`ダメージ計算：${t.toString()} (${r}) ⇒ ${a.toString()} (${n})`),r>0&&r>n&&a.battlePosition==="Attack"?t.controller.getOpponentPlayer().battleDamage(r-n,t):r<n&&t.controller.battleDamage(n-r,a),r>0&&(r>n||r===n&&a.battlePosition==="Attack")&&await it.tryMarkForDestory([a],e),a.battlePosition==="Attack"&&r<=n&&await it.tryMarkForDestory([t],e));const s=Object.values(this.duelists).filter(o=>o.lp<=0);if(s.length>0)throw new It(Object.values(this.duelists).filter(o=>!s.includes(o)).pop())});d(this,"procBattlePhaseDamageStep4",async()=>{for(this.clock.setStage(this,"afterDmgCalc");await this.procChainBlock(void 0,void 0););});d(this,"procBattlePhaseDamageStep5",async()=>{for(this.clock.setStage(this,"end"),console.log(this.clock.period.key,this.clock.toString()),await me.waitCorpseDisposal(this),console.log(this.clock.period.key,this.clock.toString()),this.clock.incrementChainSeq(),console.log(this.clock.period.key,this.clock.toString());await this.procChainBlock(void 0,void 0););});d(this,"procBattlePhaseEndStep",async()=>{this.clock.setStep(this,"end"),this.priorityHolder=this.getTurnPlayer(),await this.procSpellSpeed1(),this.moveNextPhase("main2")});d(this,"procEndPhase",async()=>{for(await this.procSpellSpeed1();;){const t=this.getTurnPlayer().getHandCell().cardEntities.length;if(t<7)break;await this.getTurnPlayer().discard(t-6,["Rule"])}this.moveNextPhase("draw")});d(this,"procSpellSpeed1",async()=>{this.priorityHolder=this.getTurnPlayer();let e=0;const t={Above:Number.MAX_VALUE,Below:Number.MAX_VALUE};for(;Object.values(t).some(a=>a!==0);){const a=this.getEnableActions(this.priorityHolder,["IgnitionEffect","QuickEffect","CardActivation","LingeringEffect"],["Normal","Quick","Counter"],[]);t[this.priorityHolder.seat]=a.filter(s=>s.isMandatory).length;let r=a.find(s=>s.isMandatory),n=!r;if(this.priorityHolder.isTurnPlayer?e===0&&(n=!0):t[this.priorityHolder.getOpponentPlayer().seat]>=0&&(n=!0),a.length&&(a.length>1||!r)&&(r=await this.view.waitQuickEffect(this.priorityHolder,a,[],n?"":"まだ発動しなければならない効果が残っている。",n)),r){if(jn.some(s=>s===r.playType))await this.procChainBlock({activator:this.priorityHolder,action:r},void 0);else{const s=await r.prepare(this.priorityHolder,void 0,[],!0,!1);if(!s)continue;await r.execute(s,[]),await r.settle(s,[]),this.clock.incrementChainSeq()}await this.procFreeChain(),this.priorityHolder=this.getTurnPlayer(),e=0;continue}this.priorityHolder=this.priorityHolder.getOpponentPlayer(),e++}});d(this,"procFreeChain",async()=>{for(;await this.procChainBlock(void 0,void 0););});d(this,"procChainBlock",async(e,t)=>{const a=this.clock.chainBlockSeq===0;let r=e?[]:t??Object.values(this.duelists).flatMap(o=>this.getEnableActions(o,["TriggerEffect"],["Normal"],[]).map(u=>({activator:o,action:u}))),n=!1,s;if(e)s=e,this.priorityHolder=s.activator,n=!0;else if(r.length>0){const o=await this.selectTriggerEffect(r);o&&(r=r.filter(u=>u!==o),s=o,this.priorityHolder=s.activator,n=!0)}if(!n){let o=0;for(;o<2;){this.priorityHolder=this.priorityHolder.getOpponentPlayer();const u=["Counter"];this.chainBlockInfos.every(v=>v.action.spellSpeed!=="Counter")&&u.push("Quick");const l=this.chainBlockInfos.length?"":"クイックエフェクト発動タイミング。効果を発動しますか？",c=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(this.priorityHolder,["QuickEffect","CardActivation"],u,this.chainBlockInfos),this.chainBlockInfos,l,!0);if(c){s={activator:this.priorityHolder,action:c},n=!0;break}o++}}if(console.info("selected action: ",s),s){const o=s.activator,u=this.clock.chainBlockSeq+1;this.log.info(`チェーン${u}: ${Vt(s.action)}を発動`,o);const l=await s.action.prepare(o,s.action.cell,this.chainBlockInfos,!1,!1);if(!l)throw new Tt(s);this.chainBlockLog.push(l);const c=[...l.action.entity.info.isEffectiveIn];if(l.selectedEntities.length&&this.log.info(`対象⇒${l.selectedEntities.map(v=>v.toString()).join(" ")}`,l.activator),this._chainBlockInfos.push(l),this.clock.incrementProcSeq(),this.clock.incrementChainBlockSeq(),await this.procChainBlock(void 0,r.filter(v=>v.action.seq!==(s==null?void 0:s.action.seq))),this.log.info(`チェーン${u}: ${Vt(l.action)}の効果処理。`,o),l.isNegatedActivationBy)this.log.info(`チェーン${u}: ${Vt(s.action)}を${Vt(l.isNegatedActivationBy)}によって発動を無効にした。`,l.activator);else{let v=l.action.entity.isEffective,f=`チェーン${u}: カードの効果が無効となっているため${Vt(s.action)}の効果処理を行えない。`;if(v){if(l.isNegatedEffectBy)f=`チェーン${u}: ${Vt(l.action)}を${Vt(l.isNegatedEffectBy)}によって効果を無効にした。`,v=!1;else if(!c.includes(l.isActivatedIn.cellType)){const h=l.action.entity.moveLog.records.findLast(y=>y.face==="FaceDown"&&y.orientation==="Horizontal");v=(h&&this.clock.isSameChain(h.movedAt))??!1}}v?(await l.action.execute(l,this.chainBlockInfos),l.state="done"):(l.state="failed",this.log.info(f,l.activator)),await s.action.settle(l,this.chainBlockInfos)}console.log(this.clock.totalProcSeq),this.clock.incrementChainBlockSeq(),console.log(this.clock.totalProcSeq),a&&(await me.sendManyToGraveyardForTheSameReason(this._chainBlockInfos.filter(v=>v.action.playType==="CardActivation").filter(v=>!v.action.isLikeContinuousSpell).map(v=>v.action.entity).filter(v=>v.isOnField).filter(v=>v.face==="FaceUp"),["Rule"],void 0,void 0),this._chainBlockInfos.reset(),this.clock.incrementChainSeq())}return n});d(this,"selectTriggerEffect",async e=>{if(e.length>0)for(const t of[!0,!1])for(const a of[this.getTurnPlayer(),this.getNonTurnPlayer()]){const r=e.filter(s=>s.action.isMandatory===t&&s.activator===a);if(r.length===0)continue;if(r.length===1&&t)return r[0];const n=await this.view.waitQuickEffect(a,r.map(s=>s.action),this.chainBlockInfos,"誘発効果を選択。",!t);if(n)return{activator:a,action:n}}});d(this,"executeSystemPeriodActions",()=>{Object.values(this.duelists).flatMap(e=>this.getEnableActions(e,["SystemPeriodAction"],["Normal"],[]).map(t=>({duelist:e,action:t})))});d(this,"getEnableActions",(e,t,a,r)=>this.field.getAllCardEntities().flatMap(n=>n.actions).filter(n=>n.executableCells.includes(n.entity.fieldCell.cellType)).filter(n=>n.executablePeriods.includes(this.clock.period.key)).filter(n=>t.includes(n.playType)).filter(n=>a.includes(n.spellSpeed)).filter(n=>n.validateDuelist(e)).filter(n=>n.validate(e,r,!1)));this.clock=new Zo,this.nextPhaseList=[],this.isEnded=!1,this.startMode=l,this.duelists={Below:new Gr(this,"Below",e,t,a,r),Above:new Gr(this,"Above",n,s,o,u)},this.priorityHolder=this.firstPlayer,this._chainBlockInfos=[],this.field=new Lo(this),this.clock.onTotalProcSeqChange.append(this.distributeOperators),this.clock.onStageChange.append(this.executeSystemPeriodActions),this.view=new Uo(this),this.log=new Ro(this),this.chainBlockLog=new Go(this)}get phase(){return this.clock.period.phase}get step(){return this.clock.period.step}get stage(){return this.clock.period.stage}get chainBlockInfos(){return this._chainBlockInfos}get firstPlayer(){return this.coin?this.duelists.Below:this.duelists.Above}get secondPlayer(){return this.coin?this.duelists.Above:this.duelists.Below}}const Yo=()=>{const i=[];["サイバー・ドラゴン","六武衆のご隠居","アンノウン・シンクロン"].forEach(c=>i.push({name:c,actions:[Ge,qe,Le,{title:"特殊召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:c==="アンノウン・シンクロン"?1:void 0,validate:v=>{const f=v.action.entity.field.getMonstersOnField();if(!(f.length==0||f.some(h=>h.controller===v.activator)))return Qa(v,["Attack","Defense"],[])},prepare:(v,f,h,y)=>Ja(v,f,["Attack","Defense"],[],y),execute:Ia,settle:async()=>!0}]}));const e={name:"ジャンク・フォアード",actions:[Ge,qe,Le,{title:"特殊召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:c=>{if(!c.activator.getMonstersOnField().length)return Qa(c,["Attack","Defense"],[])},prepare:(c,v,f,h)=>Ja(c,v,["Attack","Defense"],[],h),execute:Ia,settle:async()=>!0}]};i.push(e);const t={name:"Ｄ－ＨＥＲＯ ディアボリックガイ",actions:[Ge,qe,Le,{title:"①リクルート",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:10,canPayCosts:()=>!0,validate:c=>c.activator.getDeckCell().cardEntities.filter(f=>f.nm==="Ｄ－ＨＥＲＯ ディアボリックガイ").length===0?void 0:c.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:async c=>(await c.action.entity.banish(["Cost"],c.action.entity,c.activator),{Banish:[c.action.entity]}),prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async c=>{const v=c.activator.getAvailableMonsterZones();if(!v.length)return!1;const f=c.activator.getDeckCell().cardEntities.find(h=>h.nm==="Ｄ－ＨＥＲＯ ディアボリックガイ");return f?(await c.activator.summon(f,["Attack","Defense"],v,"SpecialSummon",["Effect"],c.action.entity,!1),c.activator.getDeckCell().shuffle(),!0):!1},settle:async()=>!0}]};i.push(t);const a={name:"ゾンビキャリア",actions:[Ge,qe,Le,{title:"①自己再生",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],canPayCosts:c=>c.activator.getHandCell().cardEntities.length>0,validate:c=>c.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:async c=>{const v=c.activator.getHandCell().cardEntities,f=await c.activator.duel.view.waitSelectEntities(c.activator,v,1,h=>h.length===1,"デッキトップに戻すカードを一枚選択。");if(!f)throw new Tt(c);return await f[0].returnToDeck("Top",["Cost"],c.action.entity,c.activator),{ReturnToDeck:f}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:async c=>{if(c.action.entity.wasMovedAtCurrentChain)return!1;const v=c.activator.getAvailableMonsterZones();return v.length===0?!1:(await c.activator.summon(c.action.entity,["Attack","Defense"],v,"SpecialSummon",["Effect"],c.action.entity,!1),c.action.entity.info.willBeBanished=!0,!0)},settle:async()=>!0}]};i.push(a);const r={name:"グローアップ・バルブ",actions:[Ge,qe,Le,{title:"①自己再生",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:1,canPayCosts:c=>c.activator.getDeckCell().cardEntities.length>0,validate:c=>c.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:async c=>{const v=c.activator.getDeckCell().cardEntities[0];return await c.activator.getDeckCell().cardEntities[0].sendToGraveyard(["Cost"],c.action.entity,c.activator),{SendToGraveyard:[v]}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:async c=>{if(c.action.entity.wasMovedAfter(c.isActivatedAt))return await c.action.entity.ruleDestory(),!1;const v=c.activator.getAvailableMonsterZones();return v.length===0?!1:(await c.activator.summon(c.action.entity,["Attack","Defense"],v,"SpecialSummon",["Effect"],c.action.entity),!0)},settle:async()=>!0}]};i.push(r);const n={name:"終末の騎士",actions:[Ge,qe,Le,{title:"①墓地送り",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...lt,...Qt],executableDuelistTypes:["Controller"],validate:c=>{if(c.action.entity.hasBeenSummonedNow(["NormalSummon","SpecialSummon","FlipSummon"])&&c.activator.getDeckCell().cardEntities.filter(v=>v.attr.includes("Dark")).length!==0)return[]},prepare:async c=>{const v=["SendToGraveyardFromDeck"];return c.action.entity.moveLog.latestRecord.movedAs.includes("NormalSummon")?v.push("IfNormarlSummonSucceed"):v.push("IfSpecialSummonSucceed"),{selectedEntities:[],chainBlockTags:v,prepared:void 0}},execute:async c=>{const v=c.activator.getDeckCell().cardEntities.filter(f=>f.attr.includes("Dark"));return v.length===0?!1:(await c.action.entity.field.sendToGraveyard("墓地に送るモンスターを選択",c.activator,v,1,f=>f.length===1,["Effect"],c.action.entity,!1),c.activator.getDeckCell().shuffle(),!0)},settle:async()=>!0}]};i.push(n);const s={name:"マスマティシャン",actions:[Ge,qe,Le,{title:"①墓地送り",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...lt,...Qt],executableDuelistTypes:["Controller"],validate:c=>{if(c.action.entity.hasBeenSummonedNow(["NormalSummon"])&&c.activator.getDeckCell().cardEntities.find(v=>(v.lvl??5)<5))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["IfNormarlSummonSucceed","SendToGraveyardFromDeck"],prepared:void 0}),execute:async c=>{const v=c.activator.getDeckCell().cardEntities.filter(f=>(f.lvl??5)<5);return v.length===0?!1:(await c.action.entity.field.sendToGraveyard("墓地に送るモンスターを選択",c.activator,v,1,f=>f.length===1,["Effect"],c.action.entity,!1),c.activator.getDeckCell().shuffle(),!0)},settle:async()=>!0},{title:"②ドロー",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...lt,...Qt],executableDuelistTypes:["Controller"],validate:c=>{if(c.action.entity.face!=="FaceDown"&&c.action.entity.moveLog.latestRecord.movedAs.includes("BattleDestroy")&&c.action.entity.wasMovedAtPreviousChain&&c.activator.getDeckCell().cardEntities.length!==0)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async c=>(await c.activator.draw(1,c.action.entity,c.activator),!0),settle:async()=>!0}]};i.push(s);const o={name:"ライトロード・ビースト ウォルフ",actions:[qe,Le,{title:"①自己再生",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...lt,...Qt],executableDuelistTypes:["Controller"],validate:c=>{if(c.action.entity.wasMovedAtPreviousChain&&c.action.entity.wasMovedFrom.cellType==="Deck")return c.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:async c=>{if(c.action.entity.wasMovedAfter(c.isActivatedAt))return!1;const v=c.activator.getAvailableMonsterZones();return!v.length||c.action.entity.fieldCell.cellType!=="Graveyard"&&c.action.entity.fieldCell.cellType!=="Banished"||c.action.entity.face==="FaceDown"?!1:(await c.activator.summon(c.action.entity,["Attack","Defense"],v,"SpecialSummon",["Effect"],c.action.entity),!0)},settle:async()=>!0}],canBeSummoned:()=>!0};i.push(o);const u={name:"伝説の白石",actions:[qe,Le,Ge,{title:"①サーチ",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:hi,executableDuelistTypes:["Controller"],validate:c=>{if(c.action.entity.wasMovedAtPreviousChain&&c.action.entity.wasMovedFrom.cellType!=="Banished")return c.activator.getDeckCell().cardEntities.find(v=>v.nm==="青眼の白龍")?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async c=>{const v=c.activator.getDeckCell().cardEntities.find(f=>f.nm==="青眼の白龍");return v?(await v.addToHand(["Effect"],c.action.entity,c.activator),c.activator.getDeckCell().shuffle(),!0):!1},settle:async()=>!0}]};return i.push(u),[{name:"灰流うらら",chainBlockTags:["Draw","SearchFromDeck","SendToGraveyardFromDeck","SpecialSummonFromDeck"]},{name:"屋敷わらし",chainBlockTags:["BanishFromGraveyard","SpecialSummonFromGraveyard","AddToHandFromGraveyard"]}].forEach(c=>{i.push({name:c.name,actions:[qe,Le,Ge,{title:"①無効化",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:["Hand"],executablePeriods:lt,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,negatePreviousBlock:!0,canPayCosts:v=>v.activator.canDiscard([v.action.entity]),validate:(v,f)=>f.length===0?void 0:f[v.index-1].chainBlockTags.union(c.chainBlockTags).length>0?[]:void 0,payCosts:async v=>(await v.action.entity.discard(["Cost"],v.action.entity,v.activator),{selectedEntities:[v.action.entity]}),prepare:async()=>({selectedEntities:[],chainBlockTags:["NegateCardEffect"],prepared:void 0}),execute:async(v,f)=>{const h=f[v.index-1];return h.isNegatedEffectBy=v.action,!0},settle:async()=>!0}]})}),["翻弄するエルフの剣士","ロードランナー","氷結界の修験者"].forEach(c=>{i.push({name:c,actions:[qe,Le,Ge],continuousEffects:[io("①戦闘破壊耐性","Monster",v=>[v],()=>!0,v=>[new Wl("①戦闘破壊耐性",()=>!0,!0,v,{},()=>!0,["BattleDestroy"],(f,h)=>(console.log(f,h),!v.isEffective||(h.atk??0)<1900?!0:(v.duel.log.info(`${v.toString()}は攻撃力1900以上のモンスターとの先頭では破壊されない。`,v.controller),!1)))])]})}),i},Xo=i=>{if(i.action.entity.status.spellCategory==="Field")return[i.activator.getFieldZone()];const e=i.activator.getAvailableSpellTrapZones();return e.length>0?e:void 0},be={title:"セット",playType:"SpellTrapSet",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isMandatory:!1,validate:Xo,prepare:Nt,execute:async()=>!0,settle:async()=>!0},Ce=i=>{if(i.action.entity.info.isPending||i.action.entity.info.isDying||i.action.entity.info.isSettingSickness)return;if(zt.some(t=>t===i.action.entity.fieldCell.cellType))return i.action.entity.face==="FaceDown"?[]:void 0;if(!i.activator.isTurnPlayer)return;if(i.action.entity.status.spellCategory==="Field")return[i.activator.getFieldZone()];const e=i.activator.getAvailableSpellTrapZones();return e.length>0?e:void 0},Ko=(i,e,t=()=>!0)=>i.action.entity.field.getMonstersOnField().filter(r=>r.face==="FaceUp").filter(r=>r.canBeTargetOfEffect(i)).filter(r=>t(r,i.action.entity)).length?Ce(i):void 0,Qo=async(i,e,t,a,r,n,s=()=>!0)=>{const o=i.action.entity.field.getMonstersOnField().filter(l=>l.face==="FaceUp").filter(l=>l.canBeTargetOfEffect(i)).filter(l=>s(l,i.action.entity)),u=await i.action.entity.duel.view.waitSelectEntities(i.activator,o,1,l=>l.length===1,"装備対象モンスターを選択",a);if(u)return i.action.entity.info.equipedBy=u[0],i.action.entity.info.effectTargets[i.action.seq]=u,{chainBlockTags:r??[],selectedEntities:u,prepared:n}},Yn=async(i,e,t=()=>!0)=>{const a=i.selectedEntities[0];return t(a,i.action.entity)?(i.action.entity.info.equipedBy=a,i.action.entity.info.validateEquipOwner=t,a.info.equipEntities.push(i.action.entity),!0):(await i.action.entity.ruleDestory(),i.activator.writeInfoLog(`${a.toString()}が装備条件を満たさなくなったため、${i.action.entity.toString()}は破壊された。`),!1)},ar=(i=()=>!0)=>({title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:(e,t)=>Ko(e,t,i),prepare:(e,t,a,r)=>Qo(e,t,a,r,[],void 0,i),execute:Yn,settle:async()=>!0}),Jo=()=>{const i=[],e={name:"おろかな埋葬",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:l=>{if(l.activator.getDeckCell().cardEntities.filter(c=>c.status.kind==="Monster").length!==0)return Ce(l)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SendToGraveyardFromDeck"],prepared:void 0}),execute:async l=>{const c=l.activator.getDeckCell().cardEntities.filter(f=>f.status.kind==="Monster");if(c.length===0)return!1;const v=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,c,1,f=>f.length===1,"墓地に送るモンスターを選択",!1);if(!v)throw new Tt(l);return await me.sendManyToGraveyardForTheSameReason(v,["Effect"],l.action.entity,l.activator),await l.activator.getDeckCell().shuffle(),!0},settle:async()=>!0},be]};i.push(e);const t={name:"おろかな副葬",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,priorityForNPC:40,validate:l=>{if(l.activator.getDeckCell().cardEntities.filter(c=>c.status.kind!=="Monster").length!==0)return Ce(l)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SendToGraveyardFromDeck"],prepared:void 0}),execute:async l=>{const c=l.activator.getDeckCell().cardEntities.filter(f=>f.status.kind!=="Monster");if(c.length===0)return!1;const v=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,c,1,f=>f.length===1,"墓地に送る魔法罠を選択",!1);if(!v)throw new Tt(l);return await me.sendManyToGraveyardForTheSameReason(v,["Effect"],l.action.entity,l.activator),await l.activator.getDeckCell().shuffle(),!0},settle:async()=>!0},be]};i.push(t);const a={name:"死者蘇生",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:l=>{if(l.activator.getAvailableMonsterZones().length!==0&&l.action.entity.field.getCells("Graveyard").flatMap(c=>c.cardEntities).filter(c=>c.status.kind==="Monster").filter(c=>c.info.isRebornable).filter(c=>c.canBeTargetOfEffect(l)).filter(c=>Mt.some(v=>c.canBeSummoned(l.activator,l.action,"SpecialSummon",v,[],!1))).some(c=>Mt.some(v=>l.activator.canSummon(l.activator,c,l.action,"SpecialSummon",v,[]))))return Ce(l)},prepare:async l=>{if(!await l.action.entity.field.duel.view.waitSelectEntities(l.activator,l.action.entity.field.getCells("Graveyard").flatMap(v=>v.cardEntities).filter(v=>v.status.kind==="Monster").filter(v=>v.info.isRebornable).filter(v=>v.canBeTargetOfEffect(l)).filter(v=>Mt.some(f=>v.canBeSummoned(l.activator,l.action,"SpecialSummon",f,[],!1))).filter(v=>Mt.some(f=>l.activator.canSummon(l.activator,v,l.action,"SpecialSummon",f,[]))),1,v=>v.length===1,"蘇生対象とするモンスターを選択",!1))throw new Tt(l);return{selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}},execute:async l=>{const c=l.activator.getEmptyMonsterZones(),v=l.selectedEntities[0];return v.wasMovedAfter(l.isActivatedAt)?!1:(await l.activator.summon(v,["Attack","Defense"],c,"SpecialSummon",["Effect"],l.action.entity,!1),!0)},settle:async()=>!0},be]};i.push(a),[{name:"大嵐",cellTypes:zt,isOnlyEnemies:!1},{name:"ハーピィの羽根帚",cellTypes:zt,isOnlyEnemies:!0},{name:"ブラック・ホール",cellTypes:Si,isOnlyEnemies:!1},{name:"サンダー・ボルト",cellTypes:Si,isOnlyEnemies:!0}].forEach(l=>{i.push({name:l.name,actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:c=>{let v=c.action.entity.field.getCells(...l.cellTypes).flatMap(f=>f.cardEntities).filter(f=>f!==c.action.entity);if(l.isOnlyEnemies&&(v=v.filter(f=>f.controller!==c.activator)),!!v.length)return Ce(c)},prepare:async c=>{let v=c.action.entity.field.getCells(...l.cellTypes).flatMap(f=>f.cardEntities).filter(f=>f!==c.action.entity);return l.isOnlyEnemies&&(v=v.filter(f=>f.controller!==c.activator)),{selectedEntities:[],chainBlockTags:c.action.calcChainBlockTagsForDestroy(v),prepared:void 0}},execute:async c=>{let v=c.action.entity.field.getCells(...l.cellTypes).flatMap(f=>f.cardEntities).filter(f=>f!==c.action.entity);return l.isOnlyEnemies&&(v=v.filter(f=>f.controller!==c.activator)),await it.tryDestroy(v,c),!0},settle:async()=>!0},be]})});const r={name:"ハリケーン",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:l=>{if(l.action.entity.field.getCells("SpellAndTrapZone","FieldSpellZone").flatMap(v=>v.cardEntities).filter(v=>v!==l.action.entity).length)return Ce(l)},prepare:async()=>({selectedEntities:[],chainBlockTags:["BounceToHand"],prepared:void 0}),execute:async(l,c)=>{const v=c.map(h=>h.action).filter(h=>h.playType==="CardActivation").map(h=>h.entity).filter(h=>h.isOnField).filter(h=>h.face==="FaceUp").filter(h=>!h.isLikeContinuousSpell),f=l.action.entity.field.getCells("SpellAndTrapZone","FieldSpellZone").flatMap(h=>h.cardEntities).filter(h=>!v.includes(h));return await me.returnManyToHandForTheSameReason(f,["Effect"],l.action.entity,l.activator),!0},settle:async()=>!0},be]};i.push(r);const n={name:"光の援軍",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,canPayCosts:l=>l.activator.getDeckCell().cardEntities.length>3,validate:l=>{if(l.activator.getDeckCell().cardEntities.filter(c=>c.status.kind==="Monster").filter(c=>(c.lvl??13)<5).filter(c=>c.status.nameTags&&c.status.nameTags.includes("ライトロード")).length!==0)return Ce(l)},payCosts:async l=>{const c=l.activator.getDeckCell().cardEntities.slice(0,3);return await me.sendManyToGraveyardForTheSameReason(c,["Cost"],l.action.entity,l.activator),{SendToGraveyard:c}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async l=>{const c=l.activator.getDeckCell().cardEntities.filter(f=>f.status.kind==="Monster").filter(f=>(f.lvl??13)<5).filter(f=>f.status.nameTags&&f.status.nameTags.includes("ライトロード"));if(c.length===0)return!1;const v=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,c,1,f=>f.length===1,"手札に加えるモンスターを選択",!1);for(const f of v??[])await f.addToHand(["Effect"],l.action.entity,l.activator);return l.activator.getDeckCell().shuffle(),!0},settle:async()=>!0},be]};i.push(n);const s={name:"調律",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:l=>{const c=l.activator.getDeckCell().cardEntities;if(!(c.length<2)&&c.filter(v=>{var f;return(f=v.status.nameTags)==null?void 0:f.includes("シンクロン")}).filter(v=>{var f;return(f=v.status.monsterCategories)==null?void 0:f.includes("Tuner")}).length!==0)return Ce(l)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck","SendToGraveyardFromDeck"],prepared:void 0}),execute:async l=>{const c=l.activator.getDeckCell().cardEntities;if(c.length<2)return;const v=c.filter(h=>{var y;return(y=h.status.nameTags)==null?void 0:y.includes("シンクロン")}).filter(h=>{var y;return(y=h.status.monsterCategories)==null?void 0:y.includes("Tuner")});if(v.length===0)return!1;const f=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,v,1,h=>h.length===1,"手札に加えるモンスターを選択",!1);for(const h of f??[])await h.addToHand(["Effect"],l.action.entity,l.activator);return l.activator.duel.clock.incrementProcSeq(),l.activator.getDeckCell().shuffle(),await l.activator.getDeckCell().cardEntities[0].sendToGraveyard(["Effect"],l.action.entity,l.activator),!0},settle:async()=>!0},be]};i.push(s);const o={name:"ワン・フォー・ワン",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,canPayCosts:l=>{if(l.activator.getDeckCell().cardEntities.every(c=>(c.lvl??12)>1)){if(l.activator.getHandCell().cardEntities.every(c=>(c.lvl??12)>1)||l.activator.getHandCell().cardEntities.filter(c=>c.status.kind==="Monster").length<2)return!1}else if(l.activator.getHandCell().cardEntities.filter(c=>c.status.kind==="Monster").length===0)return!1;return!0},validate:l=>{if(!(l.activator.getDeckCell().cardEntities.every(c=>(c.lvl??12)>1)||l.activator.getHandCell().cardEntities.every(c=>(c.lvl??12)>1)))return Ce(l)},payCosts:async l=>{let c=l.activator.getHandCell().cardEntities.filter(f=>f.status.kind==="Monster");if(l.activator.getDeckCell().cardEntities.filter(f=>f.lvl===1).length===0){const f=l.activator.getHandCell().cardEntities.filter(h=>h.lvl===1);f.length===1&&(c=c.filter(h=>h!==f[0]))}const v=await l.action.entity.field.sendToGraveyard("墓地へ送るモンスターを選択",l.activator,c,1,f=>f.length===1,["Cost"],l.action.entity,!0);if(v)return{SendToGraveyard:v}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async l=>{const c=[...l.activator.getDeckCell().cardEntities.filter(f=>f.lvl===1),...l.activator.getHandCell().cardEntities.filter(f=>f.lvl===1)];if(c.length===0)return!1;const v=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,c,1,f=>f.length===1,"特殊召喚するモンスターを選択",!1);if(!v)throw new Error("illegal state");return await l.activator.summon(v[0],["Attack","Defense"],l.activator.getAvailableMonsterZones(),"SpecialSummon",["Effect"],l.action.entity,!1),l.activator.getDeckCell().shuffle(),!0},settle:async()=>!0},be]};i.push(o);const u={name:"封印の黄金櫃",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:l=>{if(!l.activator.getDeckCell().cardEntities.every(c=>!l.activator.canTryBanish(c,"BanishAsEffect",l.action)))return Ce(l)},prepare:async()=>({selectedEntities:[],chainBlockTags:["BanishFromDeck"],prepared:void 0}),execute:async l=>{const c=l.activator.getDeckCell().cardEntities.filter(h=>l.activator.canTryBanish(h,"BanishAsEffect",l.action)),v=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,c,1,h=>h.length===1,"除外するカードを選択。",!1);if(!v)throw new Error("illegal state");return(await it.tryBanish(v,l)).forEach(h=>h.counterHolder.removeAll("GoldSarcophagus")),!0},settle:async()=>!0},go("回収カウント進行",["stanby"],l=>{l.activator.isTurnPlayer&&l.action.entity.field.getCells("Banished").flatMap(c=>c.cardEntities).filter(c=>c.moveLog.latestRecord.movedBy===l.action.entity).filter(c=>c.moveLog.latestRecord.actionOwner===l.activator).forEach(c=>{c.counterHolder.add("GoldSarcophagus",1,l.action.entity);const v=c.counterHolder.getQty("GoldSarcophagus",l.action.entity);v<3&&l.activator.duel.log.info(`${c.toString()}のターンカウント：${v-1}⇒${v}`)})}),{title:"回収",isMandatory:!0,playType:"LingeringEffect",spellSpeed:"Normal",executableCells:pi,executablePeriods:["stanby"],executableDuelistTypes:["Controller","Opponent"],validate:l=>{if(l.activator.isTurnPlayer)return l.action.entity.field.getCells("Banished").flatMap(c=>c.cardEntities).filter(c=>c.moveLog.latestRecord.movedBy===l.action.entity).filter(c=>c.moveLog.latestRecord.actionOwner===l.activator).some(c=>c.counterHolder.getQty("GoldSarcophagus")===2)?[]:void 0},prepare:Nt,execute:async l=>{const c=l.action.entity.field.getCells("Banished").flatMap(f=>f.cardEntities).filter(f=>f.moveLog.latestRecord.movedBy===l.action.entity).filter(f=>f.moveLog.latestRecord.actionOwner===l.activator).filter(f=>f.counterHolder.getQty("GoldSarcophagus")===2);if(!c.length)throw new Se("想定されない状態",l);let v=c[0];if(c.length>1){const f=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,c,1,h=>h.length===1,"回収するカードを選択。",!1);if(!f||!f.length)throw new Se("想定されない状態",l,f);v=f[0]}return await v.addToHand(["Effect"],l.action.entity,l.activator),!0},settle:async()=>!0},be]};return i.push(u),i},Io=(i,e,t,a,r)=>({title:"①リクルート",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:r,executablePeriods:a.includes("EffectDestroy")?[...lt,...Qt]:["b1DEnd","b2DEnd"],executableDuelistTypes:["Controller"],validate:n=>{if(!n.action.entity.wasMovedAtPreviousChain){console.log(n.action.entity.toString(),n);return}if(!n.action.entity.moveLog.latestRecord.movedAs.union(a).length){console.log(n.action.entity.toString(),n);return}const s=n.activator.getDeckCell().cardEntities.filter(i);if(s.length===0){console.log(n.action.entity.toString(),n);return}if(!s.some(o=>t.some(u=>n.activator.canSummon(n.activator,o,n.action,"SpecialSummon",u,[])&&o.canBeSummoned(n.activator,n.action,"SpecialSummon",u,[],!1)))){console.log(n.action.entity.toString(),n);return}return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async n=>{const s=n.activator.getDeckCell().cardEntities.filter(i);if(s.length===0)return!1;const o=await n.action.entity.field.duel.view.waitSelectEntities(n.activator,s,e.length===1?e[0]:-1,u=>e.includes(u.length),"特殊召喚するモンスターを選択",!1);if(!o)throw new Error("illegal state");for(const u of o)await n.activator.summon(u,t,n.activator.getAvailableMonsterZones(),"SpecialSummon",["Effect"],n.action.entity,!1);return n.activator.getDeckCell().shuffle(),!0},settle:async()=>!0}),ec=()=>{const i=[];return[{name:"キラー・ポテト",filter:e=>e.attr.includes("Dark")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["EffectDestroy"],executableCells:["Graveyard"]},{name:"キラー・トマト",filter:e=>e.attr.includes("Dark")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"巨大ネズミ",filter:e=>e.attr.includes("Earth")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"グリズリーマザー",filter:e=>e.attr.includes("Water")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"シャインエンジェル",filter:e=>e.attr.includes("Light")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ドラゴンフライ",filter:e=>e.attr.includes("Wind")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ＵＦＯタートル",filter:e=>e.attr.includes("Fire")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"荒野の女戦士",filter:e=>e.attr.includes("Earth")&&e.types.includes("Warrior")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"リトル・トルーパー",filter:e=>e.types.includes("Warrior")&&(e.lvl??9999)<3,qtyList:[1],posList:["Set"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard","Banished"]},{name:"破面竜",filter:e=>e.types.includes("Warrior")&&(e.def??9999)<=1500,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"共鳴虫",filter:e=>e.types.includes("Insect")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ピラミッド・タートル",filter:e=>e.types.includes("Zombie")&&(e.def??9999)<=2e3,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ユーフォロイド",filter:e=>e.types.includes("Machine")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ヘル・セキュリティ",filter:e=>e.types.includes("Fiend")&&(e.lvl??9999)===1,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ガスタ・イグル",filter:e=>(e.status.nameTags??[]).includes("ガスタ")&&(e.status.monsterCategories??[]).includes("Tuner"),qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"幻影の魔術士",filter:e=>(e.status.nameTags??[]).includes("ＨＥＲＯ")&&(e.atk??9999)<=1e3,qtyList:[1],posList:["Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ジェネクス・サーチャー",filter:e=>(e.status.nameTags??[]).includes("ジェネクス")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"紫炎の足軽",filter:e=>(e.status.nameTags??[]).includes("六武衆")&&(e.lvl??12)<=3,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"スレイブ・エイプ",filter:e=>(e.status.nameTags??[]).includes("剣闘獣")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ゼンマイハニー",filter:e=>(e.status.nameTags??[]).includes("ゼンマイ")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ＸＸ－セイバー エマーズブレイド",filter:e=>(e.status.nameTags??[]).includes("Ｘ－セイバー")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"軍隊竜",filter:e=>e.nm==="軍隊竜",qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"アサルト・ガンドッグ",filter:e=>e.nm==="アサルト・ガンドッグ",qtyList:[1,2,3,4,5],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ハイエナ",filter:e=>e.nm==="ハイエナ",qtyList:[1,2,3,4,5],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]}].forEach(e=>{i.push({name:e.name,actions:[Io(e.filter,e.qtyList,e.posList,e.destoryTypes,e.executableCells),qe,Le,Ge]})}),i},tc=i=>({title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:e=>{if(e.activator.getDeckCell().cardEntities.filter(i).length!==0&&e.activator.canDraw)return Ce(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(i);if(t.length===0)return!1;const a=await e.action.entity.field.duel.view.waitSelectEntities(e.activator,t,1,r=>r.length===1,"手札に加えるカードを選択",!1);for(const r of a??[])await r.addToHand(["Effect"],e.action.entity,e.activator);return e.activator.getDeckCell().shuffle(),!0},settle:async()=>!0}),ic=(i,e)=>({title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,priorityForNPC:40,validate:t=>{if(!(t.activator.getGraveyard().cardEntities.filter(i).length<e))return Ce(t)},prepare:async()=>({selectedEntities:[],chainBlockTags:["AddToHandFromGraveyard"],prepared:void 0}),execute:async t=>{const a=t.activator.getGraveyard().cardEntities.filter(i);if(a.length===0)return!1;const r=await t.action.entity.field.duel.view.waitSelectEntities(t.activator,a,e,n=>n.length===e,"手札に加えるカードを選択",!1);for(const n of r??[])await n.addToHand(["Effect"],t.action.entity,t.activator);return!0},settle:async()=>!0}),ac=i=>({title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,canPayCosts:e=>e.activator.getHandCell().cardEntities.filter(i).some(t=>e.activator.canDiscard([t])),validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<2))return Ce(e)},payCosts:async e=>({Discard:await e.activator.discard(1,["Discard","Cost"],e.action.entity,e.activator,i)}),prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(2,e.action.entity,e.activator),!0),settle:async()=>!0}),rc=i=>({title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Ce,prepare:async e=>{const[t,a]=i(e.action.entity),r=[];return t<0&&r.push("DamageToSelf"),a<0&&r.push("DamageToOpponent"),{selectedEntities:[],chainBlockTags:r,prepared:void 0}},execute:async e=>{const[t,a]=i(e.action.entity);return a>0?e.activator.getOpponentPlayer().heal(a,e.action.entity):a<0&&e.activator.getOpponentPlayer().effectDamage(Math.abs(a),e.action.entity),t>0?e.activator.heal(t,e.action.entity):t<0&&e.activator.effectDamage(Math.abs(t),e.action.entity),!0},settle:async()=>!0}),nc=()=>{const i=[];return[{name:"増援",filter:e=>e.origin.kind==="Monster"&&e.types.includes("Warrior")&&(e.origin.level??5)<5},{name:"化石調査",filter:e=>e.origin.kind==="Monster"&&e.types.includes("Dinosaur")&&(e.origin.level??6)<6},{name:"Ｅ－エマージェンシーコール",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("Ｅ・ＨＥＲＯ")},{name:"召集の聖刻印",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("聖刻")},{name:"召喚師のスキル",filter:e=>e.origin.kind==="Monster"&&(e.origin.monsterCategories??[]).includes("Normal")&&(e.origin.level??4)>4},{name:"トゥーンのもくじ",filter:e=>(e.origin.nameTags??[]).includes("トゥーン")},{name:"融合賢者",filter:e=>e.origin.name==="融合"},{name:"虹の架け橋",filter:e=>e.origin.kind!=="Monster"&&(e.origin.nameTags??[]).includes("宝玉")},{name:"紫炎の狼煙",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("六武衆")&&(e.origin.level??4)<4},{name:"テラ・フォーミング",filter:e=>e.origin.kind==="Spell"&&e.origin.spellCategory==="Field"},{name:"コール・リゾネーター",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("リゾネーター")}].forEach(e=>{i.push({name:e.name,actions:[tc(e.filter),be]})}),[{name:"戦士の生還",filter:e=>e.status.kind==="Monster"&&e.types.includes("Warrior"),qty:1},{name:"ダーク・バースト",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Dark")&&(e.atk??9999)<=1500,qty:1},{name:"悪夢再び",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Dark")&&(e.def??9999)===0,qty:2},{name:"サルベージ",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Water")&&(e.atk??9999)<=1500,qty:2},{name:"バッテリーリサイクル",filter:e=>e.status.kind==="Monster"&&e.types.includes("Thunder")&&(e.atk??9999)<=1500,qty:2},{name:"闇の量産工場",filter:e=>e.status.kind==="Monster"&&(e.status.monsterCategories??[]).includes("Normal"),qty:2}].forEach(e=>{i.push({name:e.name,actions:[ic(e.filter,e.qty),be]})}),[{name:"トレード・イン",filter:e=>e.status.kind==="Monster"&&(e.lvl??0)===8},{name:"調和の宝札",filter:e=>e.status.kind==="Monster"&&(e.origin.monsterCategories??[]).includes("Tuner")&&e.types.includes("Dragon")&&(e.atk??9999)<=1e3},{name:"デステニー・ドロー",filter:e=>e.status.kind==="Monster"&&(e.origin.nameTags??[]).includes("Ｄ－ＨＥＲＯ")}].forEach(e=>{i.push({name:e.name,actions:[ac(e.filter),be]})}),[{name:"火の粉",calcHeal:()=>[0,-200]},{name:"雷鳴",calcHeal:()=>[0,-300]},{name:"ファイヤー・ボール",calcHeal:()=>[0,-500]},{name:"火あぶりの刑",calcHeal:()=>[0,-600]},{name:"昼夜の大火事",calcHeal:()=>[0,-800]},{name:"火炎地獄",calcHeal:()=>[-500,-1e3]},{name:"盗人ゴブリン",calcHeal:()=>[500,-500]},{name:"ブルー・ポーション",calcHeal:()=>[400,0]},{name:"レッド・ポーション",calcHeal:()=>[500,0]},{name:"ゴブリンの秘薬",calcHeal:()=>[600,0]},{name:"天使の生き血",calcHeal:()=>[800,0]},{name:"治療の神 ディアン・ケト",calcHeal:()=>[1e3,0]},{name:"恵みの雨",calcHeal:()=>[1e3,1e3]}].forEach(e=>{i.push({name:e.name,actions:[rc(e.calcHeal),be]})}),i},sc=()=>{const i=[];return["大地の騎士ガイアナイト","スクラップ・デスデーモン"].forEach(e=>i.push({name:e,actions:[qe,Le,Pi()],canBeSummoned:gi})),i.push({name:"ナチュル・ガオドレイク",actions:[qe,Le,Pi(e=>e.length===1&&e.every(t=>t.attr.some(a=>a==="Earth")),e=>e.length>0&&e.every(t=>t.attr.some(a=>a==="Earth")))],canBeSummoned:gi}),i.push({name:"マジカル・アンドロイド",actions:[qe,Le,Pi(),{title:"回復",isMandatory:!0,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["end"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,validate:e=>e.action.entity.duel.phase==="end"&&e.activator.isTurnPlayer&&e.action.entity.face==="FaceUp"?[]:void 0,prepare:Nt,execute:async e=>(e.activator.heal(e.activator.getMonstersOnField().filter(t=>t.face==="FaceUp").filter(t=>t.types.includes("Psychic")).length*600,e.action.entity),!0),settle:async()=>!0}],canBeSummoned:gi}),i},lc=()=>{const i=[];return[{name:"草原",up:["Warrior","BeastWarrior"],down:[]},{name:"森",up:["Insect","Plant","Beast","BeastWarrior"],down:[]},{name:"山",up:["Dragon","WingedBeast","Thunder"],down:[]},{name:"荒野",up:["Dinosaur","Zombie","Rock"],down:[]},{name:"海",up:["Aqua","SeaSerpent","Fish"],down:["Machine","Pyro"]},{name:"闇",up:["Fiend","Spellcaster"],down:["Fairy"]}].forEach(e=>{i.push({name:e.name,actions:[{title:"発動",isMandatory:!1,canIgnoreCosts:!0,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Ce,prepare:Nt,execute:async()=>!0,settle:async()=>!0},be],continuousEffects:[oa("発動","Spell",t=>t.isOnField&&t.face==="FaceUp",t=>["attack","defense"].flatMap(a=>["up","down"].map(r=>ht.createContinuous("発動",n=>n.isSpawnedBy.isOnField&&n.isSpawnedBy.face==="FaceUp",t,(n,s)=>s.isOnField&&s.face==="FaceUp"&&(s.status.monsterCategories??!1)&&e[r].union(s.types).length>0,a,"wip","Addition",(n,s,o)=>!n.isEffective||s.face==="FaceDown"?o:o+(r==="up"?200:-200)))))]})}),[{name:"バーニングブラッド",attr:"Fire"},{name:"ウォーターワールド",attr:"Water"},{name:"ガイアパワー",attr:"Earth"},{name:"シャインスパーク",attr:"Light"},{name:"ダークゾーン",attr:"Dark"},{name:"デザートストーム",attr:"Wind"}].forEach(e=>{i.push({name:e.name,actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","FieldSpellZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Ce,prepare:Nt,execute:async()=>!0,settle:async()=>!0},be],continuousEffects:[oa("発動","Spell",t=>t.isOnField&&t.face==="FaceUp",t=>["attack","defense"].flatMap(a=>ht.createContinuous("発動",r=>r.isSpawnedBy.isOnField&&r.isSpawnedBy.face==="FaceUp",t,(r,n)=>n.isOnField&&n.face==="FaceUp"&&n.attr.includes(e.attr),a,"wip","Addition",(r,n,s)=>!r.isEffective||n.face==="FaceDown"?s:s+(a==="attack"?500:-400))))]})}),i},oc=()=>{const i=[],e={name:"連合軍",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Ce,prepare:Nt,execute:async()=>!0,settle:async()=>!0},be],continuousEffects:[oa("発動","Spell",t=>t.isOnField&&t.face==="FaceUp",t=>[ht.createContinuous("発動",a=>a.isSpawnedBy.isOnField&&a.isSpawnedBy.face==="FaceUp",t,(a,r)=>r.controller===a.isSpawnedBy.controller&&r.types.includes("Warrior")&&r.isOnField&&r.face==="FaceUp","attack","wip","Addition",(a,r,n)=>{if(!a.isEffective||r.face==="FaceDown")return n;const s=a.controller.getMonstersOnField().filter(o=>o.face==="FaceUp").filter(o=>o.types.includes("Warrior")||o.types.includes("Spellcaster")).length;return n+s*200})])]};return i.push(e),i},cc=()=>{const i=[];[{name:"団結の力",kind:["Monster"],rate:800},{name:"魔導師の力",kind:["Spell","Trap"],rate:500}].forEach(t=>{i.push({name:t.name,actions:[ar(),be],continuousEffects:[Ea(t.name,"Spell",a=>a.info.equipedBy?[a.info.equipedBy]:[],a=>a.isOnField&&a.face==="FaceUp",a=>["attack","defense"].map(r=>ht.createContinuous("発動",n=>n.isSpawnedBy.isOnField&&n.isSpawnedBy.face==="FaceUp",a,(n,s)=>s.isOnField&&s.face==="FaceUp",r,"wip","Addition",(n,s,o)=>{if(!n.isEffective)return o;const u=n.controller.getEntiteisOnField().filter(l=>t.kind.includes(l.status.kind)).length;return o+u*t.rate})))]})});const e={name:"早すぎた埋葬",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,canPayCosts:t=>t.activator.lp>=800,validate:t=>{if(t.action.entity.field.getCells("Graveyard").flatMap(a=>a.cardEntities).filter(a=>a.status.kind==="Monster").filter(a=>a.info.isRebornable).filter(a=>a.canBeTargetOfEffect(t)).filter(a=>a.canBeSummoned(t.activator,t.action,"SpecialSummon","Attack",[],!1)).some(a=>t.activator.canSummon(t.activator,a,t.action,"SpecialSummon","Attack",[]))&&t.activator.getAvailableMonsterZones().length!==0)return Ce(t)},payCosts:(t,a)=>ho(t,a,800),prepare:async t=>{const a=await t.action.entity.field.duel.view.waitSelectEntities(t.activator,t.activator.getGraveyard().cardEntities.filter(r=>r.status.kind==="Monster").filter(r=>r.info.isRebornable).filter(r=>r.canBeTargetOfEffect(t)).filter(r=>r.canBeSummoned(t.activator,t.action,"SpecialSummon","Attack",[],!1)).filter(r=>t.activator.canSummon(t.activator,r,t.action,"SpecialSummon","Attack",[])),1,r=>r.length===1,"蘇生対象とするモンスターを選択",!1);if(!a)throw new Tt(t);return t.action.entity.info.effectTargets[t.action.seq]=a,{selectedEntities:a,chainBlockTags:["SpecialSummonFromGraveyard","PayLifePoint"],prepared:void 0}},execute:async(t,a)=>{if(t.action.entity.info.equipedBy)return await t.action.entity.ruleDestory(),!1;const r=t.activator.getEmptyMonsterZones(),n=t.selectedEntities[0];return n.wasMovedAfter(t.isActivatedAt)?(await t.action.entity.ruleDestory(),!1):(await t.activator.summon(n,["Attack"],r,"SpecialSummon",["Effect"],t.action.entity,!1),t.action.entity.onBeforeMove.append(async s=>{if(s.entity.face!=="FaceUp"||!s.entity.isOnFieldAsSpellTrap)return"RemoveMe";console.log(s.entity.toString(),s.entity);const[,,,,,o]=s.args;return n.isOnField&&n.face==="FaceUp"&&s.entity.isEffective&&o.union(["EffectDestroy","RuleDestroy"]).length&&(console.log(t.action.entity.toString()),s.entity.controller.writeInfoLog(`${t.action.entity.toString()}が破壊されたため、装備対象モンスター${n.toString()}を破壊。`),it.tryMarkForDestory([n],t)),"RemoveMe"}),Yn(t,a,(s,o)=>{var u;return(u=o.info.effectTargets[t.action.seq])==null?void 0:u.includes(s)}))},settle:async()=>!0},be]};return i.push(e),i.push({name:"幻惑の巻物",actions:[ar(),be],continuousEffects:[]}),i},dc=()=>{const i=[];return[{name:"伝説の剣",attr:void 0,monType:"Warrior",atk:200,def:200},{name:"秘術の書",attr:void 0,monType:"Spellcaster",atk:200,def:200},{name:"ポセイドンの力",attr:void 0,monType:"Aqua",atk:200,def:200},{name:"紫水晶",attr:void 0,monType:"Zombie",atk:200,def:200},{name:"猛獣の歯",attr:void 0,monType:"Beast",atk:200,def:200},{name:"機械改造工場",attr:void 0,monType:"Machine",atk:200,def:200},{name:"体温の上昇",attr:void 0,monType:"Reptile",atk:200,def:200},{name:"魔菌",attr:void 0,monType:"Plant",atk:200,def:200},{name:"闇・エネルギー",attr:void 0,monType:"Fiend",atk:200,def:200},{name:"レーザー砲機甲鎧",attr:void 0,monType:"Insect",atk:200,def:200},{name:"銀の弓矢",attr:void 0,monType:"Fairy",atk:200,def:200},{name:"電撃鞭",attr:void 0,monType:"Thunder",atk:200,def:200},{name:"ドラゴンの秘宝",attr:void 0,monType:"Dragon",atk:200,def:200},{name:"フォロー・ウィンド",attr:void 0,monType:"WingedBeast",atk:200,def:200},{name:"魔性の月",attr:void 0,monType:"BeastWarrior",atk:200,def:200},{name:"エルフの光",attr:"Light",monType:void 0,atk:400,def:-200},{name:"覚醒",attr:"Earth",monType:void 0,atk:400,def:-200},{name:"灼熱の槍",attr:"Fire",monType:void 0,atk:400,def:-200},{name:"突風の扇",attr:"Wind",monType:void 0,atk:400,def:-200},{name:"はがねの甲羅",attr:"Water",monType:void 0,atk:400,def:-200},{name:"闇の破神剣",attr:"Dark",monType:void 0,atk:400,def:-200},{name:"火器付機甲鎧",attr:void 0,monType:"Insect",atk:700,def:0},{name:"サラマンドラ",attr:"Fire",monType:void 0,atk:700,def:0},{name:"シャイン・キャッスル",attr:"Light",monType:void 0,atk:700,def:0}].forEach(e=>{i.push({name:e.name,actions:[ar(t=>(!e.attr||t.attr.includes(e.attr))&&(!e.monType||t.types.includes(e.monType))),be],continuousEffects:[Ea(e.name,"Spell",t=>t.info.equipedBy?[t.info.equipedBy]:[],t=>t.isOnField&&t.face==="FaceUp",t=>{const a=[];return e.atk!==0&&a.push(["attack",e.atk]),e.def!==0&&a.push(["defense",e.def]),a.map(([r,n])=>ht.createContinuous("発動",s=>s.isSpawnedBy.isOnField&&s.isSpawnedBy.face==="FaceUp",t,(s,o)=>o.isOnField&&o.face==="FaceUp"&&(!e.monType||o.types.includes(e.monType))&&(!e.attr||o.attr.includes(e.attr)),r,"wip","Addition",(s,o,u)=>s.isEffective?u+n:u))})]})}),i},uc=()=>{const i=[],e={name:"にせアバター",actions:[Ge,qe,Le],continuousEffects:[Ea("THE_DEVILS_AVATAR","Monster",a=>[a],a=>a.isOnField&&a.face==="FaceUp",a=>["attack","defense"].map(r=>ht.createContinuous("THE_DEVILS_AVATAR",n=>n.isSpawnedBy.isOnField&&n.isSpawnedBy.face==="FaceUp",a,(n,s)=>s.isOnField&&s.face==="FaceUp",r,"calculated","THE_DEVILS_AVATAR",()=>Number.MIN_VALUE)))]};i.push(e);const t={name:"にせドレッド・ルート",actions:[Ge,qe,Le],continuousEffects:[oa("THE_DEVILS_DREAD-ROOT","Monster",a=>a.isOnField&&a.face==="FaceUp",a=>["attack","defense"].map(r=>ht.createContinuous("THE_DEVILS_DREAD-ROOT",n=>n.isSpawnedBy.isOnField&&n.isSpawnedBy.face==="FaceUp",a,(n,s)=>s.status.kind==="Monster"&&s.isOnField&&s.face==="FaceUp"&&s!==n.isSpawnedBy,r,"calculated","THE_DEVILS_DREAD-ROOT",(n,s,o)=>Math.round(o/2))))]};return i.push(t),i},vc=()=>{const i=[],e={name:"ご隠居の猛毒薬",actions:[be,{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:lt,executableDuelistTypes:["Controller"],validate:Ce,prepare:async(a,r,n,s)=>{const o=await a.action.entity.field.duel.view.waitSelectText([{seq:0,text:"●自分は１２００ＬＰ回復する。"},{seq:1,text:"●相手に８００ダメージを与える。"}],"使用する効果を選択",!1);if(o===void 0&&!s)throw new Tt(a);const u=[];return o===1&&u.push("DamageToOpponent"),{selectedEntities:[],chainBlockTags:u,prepared:o??0}},execute:async a=>a.prepared===1?(a.activator.getOpponentPlayer().effectDamage(800,a.action.entity),!0):(a.activator.heal(1200,a.action.entity),!0),settle:async()=>!0}]};i.push(e);const t={name:"月の書",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:lt,executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:a=>{if(a.action.entity.field.getMonstersOnField().filter(n=>n.canBeTargetOfEffect(a)).length)return Ce(a)},prepare:async(a,r,n,s)=>{const o=a.action.entity.field.getMonstersOnField().filter(l=>l.canBeTargetOfEffect(a)),u=await a.action.entity.duel.view.waitSelectEntities(a.activator,o,1,l=>l.length===1,"対象とするモンスターを選択",s);if(u)return{selectedEntities:u,chainBlockTags:[],prepared:void 0}},execute:async a=>{const r=a.selectedEntities[0];if(!r.isOnFieldAsMonster||r.battlePosition==="Set")return!1;if(!r.canBeEffected(a.activator,a.action.entity,a.action)){a.activator.duel.log.info(`${r.toString()}は${a.action.entity.toString()}の効果を受けない。`);return}return console.log(r.toString(),r.info.equipEntities),await r.setBattlePosition("Set",["Effect"],a.action.entity,a.activator),!0},settle:async()=>!0},be]};return i.push(t),i.push({name:"突進",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:[...lt,...Qt],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:a=>{if(a.action.entity.field.getMonstersOnField().filter(n=>n.canBeTargetOfEffect(a)).length)return Ce(a)},prepare:async(a,r,n,s)=>{const o=a.action.entity.field.getMonstersOnField().filter(l=>l.canBeTargetOfEffect(a)),u=await a.action.entity.duel.view.waitSelectEntities(a.activator,o,1,l=>l.length===1,"対象とするモンスターを選択",s);if(u)return console.log(u[0].toString(),u[0].info.equipEntities),{selectedEntities:u,chainBlockTags:[],prepared:void 0}},execute:async a=>{const r=a.selectedEntities[0];if(!r.isOnFieldAsMonster||r.battlePosition==="Set")return!1;if(!r.canBeEffected(a.activator,a.action.entity,a.action)){a.activator.duel.log.info(`${r.toString()}は${a.action.entity.toString()}の効果を受けない。`);return}return r.numericOprsBundle.push(ht.createLingeringAddition("攻撃力上昇",n=>n.effectOwner.duel.clock.isSameTurn(n.isSpawnedAt),a.action.entity,a.action,"attack",(n,s,o)=>o+700)),!0},settle:async()=>!0},be]}),i},fc=(i,e)=>{const t=`魔力充填可能(${e})`;return ao(t,i,a=>[a],()=>!0,a=>[new po(t,()=>!0,!0,a,{},(r,n)=>r.isSpawnedBy===n,(r,n)=>(n.maxCounterQty.SpellCounter=e,n))])},pc=(i,e,t)=>i.action.entity.counterHolder.getQty("SpellCounter")>=t,hc=(i,e,t,a)=>{const r=a[0];return i.action.entity.counterHolder.remove("SpellCounter",r),{Counter:r}},gc=()=>{const i=[],e={name:"魔導戦士 ブレイカー",actions:[qe,Le,Ge,{title:"①魔力充填",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:t=>{if(t.action.entity.hasBeenSummonedNow(["NormalSummon"]))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["IfNormarlSummonSucceed"],prepared:void 0}),execute:async t=>t.action.entity.face==="FaceDown"?!1:(t.action.entity.counterHolder.setQty("SpellCounter",1,t.action.entity),!0),settle:async()=>!0},{title:"③マナブレイク",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],canPayCosts:(t,a)=>pc(t,a,1),validate:t=>{const a=t.action.entity.field.getCells(...zt).flatMap(r=>r.cardEntities).filter(r=>r.canBeTargetOfEffect(t));if(a.length)return a.map(r=>r.fieldCell)},payCosts:async(t,a,r)=>hc(t,a,r,[1]),prepare:async(t,a,r,n)=>{let s=a==null?void 0:a.cardEntities[0];if(!s){const o=t.action.entity.field.getCells(...zt).flatMap(l=>l.cardEntities).filter(l=>l.canBeTargetOfEffect(t)),u=await t.action.entity.duel.view.waitSelectEntities(t.activator,o,1,l=>l.length===1,"破壊する対象を選択。",n);if(!u||!u.length)return;s=u[0]}return{selectedEntities:[s],chainBlockTags:t.action.calcChainBlockTagsForDestroy([s]),prepared:void 0}},execute:async t=>{if(!t.selectedEntities.every(a=>!a.isOnFieldAsSpellTrap))return await it.tryDestroy(t.selectedEntities,t),!0},settle:async()=>!0}],continuousEffects:[fc("Monster",1),Ea("②攻撃力上昇","Monster",t=>[t],()=>!0,t=>[ht.createContinuous("②攻撃力上昇",()=>!0,t,()=>!0,"attack","wip","Addition",(a,r,n)=>a.isEffective?n+a.counterHolder.getQty("SpellCounter")*300:n)])]};return i.push(e),i},yc=()=>{const i=[];return["炸裂装甲","次元幽閉"].forEach(e=>{i.push({name:e,actions:[be,{title:"発動",playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:["b1Battle","b2Battle"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:t=>{if(!t.activator.duel.clock.isUponAttackDeclaration()||t.activator.isTurnPlayer)return;const a=t.activator.duel.attackingMonster;if(!a)throw new Se("想定されない状態",t,a);if(a.canBeTargetOfEffect(t))return e==="次元幽閉"&&!t.activator.canTryBanish(a,"BanishAsEffect",t.action)?!1:Ce(t)},prepare:async t=>{const a=t.activator.duel.attackingMonster;if(!a)throw new Se("想定されない状態",t,a);const r=e==="炸裂装甲"?t.action.calcChainBlockTagsForDestroy([a]):["BanishFromField"];return{selectedEntities:[a],chainBlockTags:r,prepared:void 0}},execute:async t=>(e==="炸裂装甲"?await it.tryDestroy(t.selectedEntities,t):await it.tryBanish(t.selectedEntities,t),!0),settle:async()=>!0}]})}),i},mc=()=>{const i=[];return i.push({name:"強欲な瓶",actions:[be,{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:lt,executableDuelistTypes:["Controller"],validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<2)&&e.activator.canDraw&&e.activator.canAddToHandFromDeck)return Ce(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(1,e.action.entity,e.activator),!0),settle:async()=>!0}]}),i.push({name:"戦線復帰",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:lt,executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:e=>{if(e.activator.getAvailableMonsterZones().length!==0&&e.action.entity.field.getCells("Graveyard").flatMap(t=>t.cardEntities).filter(t=>t.status.kind==="Monster").filter(t=>t.info.isRebornable).filter(t=>t.canBeTargetOfEffect(e)).filter(t=>t.canBeSummoned(e.activator,e.action,"SpecialSummon","Defense",[],!1)).some(t=>e.activator.canSummon(e.activator,t,e.action,"SpecialSummon","Defense",[])))return Ce(e)},prepare:async e=>{const t=await e.action.entity.field.duel.view.waitSelectEntities(e.activator,e.action.entity.field.getCells("Graveyard").flatMap(a=>a.cardEntities).filter(a=>a.status.kind==="Monster").filter(a=>a.info.isRebornable).filter(a=>a.canBeTargetOfEffect(e)).filter(a=>a.canBeSummoned(e.activator,e.action,"SpecialSummon","Defense",[],!1)).filter(a=>e.activator.canSummon(e.activator,a,e.action,"SpecialSummon","Defense",[])),1,a=>a.length===1,"蘇生対象とするモンスターを選択",!1);if(!t)throw new Tt(e);return{selectedEntities:t,chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}},execute:async e=>{const t=e.activator.getEmptyMonsterZones(),a=e.selectedEntities[0];return a.wasMovedAfter(e.isActivatedAt)?!1:(await e.activator.summon(a,["Defense"],t,"SpecialSummon",["Effect"],e.action.entity,!1),!0)},settle:async()=>!0},be]}),i},_c=()=>{const i=[],e={name:"強欲な壺",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:20,validate:s=>{if(!(s.activator.getDeckCell().cardEntities.length<2)&&s.activator.canDraw&&s.activator.canAddToHandFromDeck)return Ce(s)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async s=>(await s.activator.draw(2,s.action.entity,s.activator),!0),settle:async()=>!0},be]};i.push(e);const t={name:"貪欲な壺",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:30,validate:s=>{if(!(s.activator.getGraveyard().cardEntities.filter(o=>o.status.kind==="Monster").filter(o=>o.canBeTargetOfEffect(s)).length<5)&&s.activator.canDraw&&s.activator.canAddToHandFromDeck)return Ce(s)},prepare:async s=>{const o=await s.action.entity.field.duel.view.waitSelectEntities(s.activator,s.activator.getGraveyard().cardEntities.filter(u=>u.status.kind==="Monster").filter(u=>u.canBeTargetOfEffect(s)),5,u=>u.length===5,"デッキに戻すモンスターを選択。",!1);if(o)return{selectedEntities:o,chainBlockTags:["Draw","ReturnToDeckFromGraveyard"],prepared:void 0}},execute:async s=>s.selectedEntities.some(o=>o.wasMovedAtCurrentChain)?!1:(await me.returnManyToDeckForTheSameReason("Random",s.selectedEntities,["Effect"],s.action.entity,s.activator),await s.activator.draw(2,s.action.entity,s.activator),!0),settle:async()=>!0},be]};i.push(t);const a={name:"天使の施し",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:30,validate:s=>{if(!(s.activator.getDeckCell().cardEntities.length<3))return Ce(s)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw","DiscordAsEffect"],prepared:void 0}),execute:async s=>(await s.activator.draw(3,s.action.entity,s.activator),await s.activator.discard(2,["Effect","Discard"],s.action.entity,s.activator),!0),settle:async()=>!0},be]};i.push(a);const r={name:"成金ゴブリン",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:20,validate:s=>{if(!(s.activator.getDeckCell().cardEntities.length<1))return Ce(s)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async s=>(await s.activator.draw(1,s.action.entity,s.activator),s.action.entity.field.duel.clock.incrementProcSeq(),s.activator.getOpponentPlayer().heal(1e3,s.action.entity),!0),settle:async()=>!0},be]};i.push(r);const n={name:"手札抹殺",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:s=>{if(!(s.activator.getDeckCell().cardEntities.length<s.activator.getHandCell().cardEntities.filter(o=>o.seq!==s.action.entity.seq).length)&&s.action.entity.field.getAllCells().filter(o=>o.cellType==="Hand").flatMap(o=>o.cardEntities).filter(o=>o.seq!==s.action.entity.seq).length!==0)return Ce(s)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async s=>{const o=s.activator.getHandCell().cardEntities.length,u=s.activator.getOpponentPlayer().getHandCell().cardEntities.length;return await me.sendManyToGraveyardForTheSameReason(s.action.entity.field.getCells("Hand").flatMap(l=>l.cardEntities),["Effect","Discard"],s.action.entity,s.activator),s.activator.duel.clock.incrementProcSeq(),await s.action.entity.field.drawAtSameTime(s.activator,o,s.activator.getOpponentPlayer(),u,s.action.entity,s.activator),!0},settle:async()=>!0},be]};return i.push(n),i},Sc=()=>{const i=[];return[{name:"ジェムナイト・パール",qty:2},{name:"覚醒の勇士 ガガギゴ",qty:3}].forEach(e=>i.push({name:e.name,actions:[qe,Le,Fo(e.qty,e.qty)],canBeSummoned:gi})),i},bc=()=>{const i=[];return i.push({name:"ＢＦ－疾風のゲイル",actions:[Ge,qe,Le,{title:"①特殊召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(e.activator.getMonstersOnField().filter(a=>(a.status.nameTags??[]).includes("ＢＦ")).filter(a=>a.nm!==e.action.entity.origin.name).length)return Qa(e,["Attack","Defense"],[])},prepare:(e,t,a,r)=>Ja(e,t,["Attack","Defense"],[],r),execute:Ia,settle:async()=>!0},{title:"②攻守半減",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,isOnlyNTimesPerTurnIfFaceup:1,validate:e=>{const t=e.activator.getOpponentPlayer().getMonstersOnField().filter(a=>a.face==="FaceUp").filter(a=>a.canBeTargetOfEffect(e));if(t.length)return t.length?t:void 0},prepare:async(e,t,a,r)=>{let n=t==null?void 0:t.cardEntities[0];if(!n){const s=e.activator.getOpponentPlayer().getMonstersOnField().filter(u=>u.face==="FaceUp").filter(u=>u.canBeTargetOfEffect(e)),o=await e.action.entity.duel.view.waitSelectEntities(e.activator,s,1,u=>u.length===1,"効果対象を選択。",r);if(!o||!o.length)return;n=o[0]}return{selectedEntities:[n],chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.selectedEntities.filter(a=>a.isOnFieldAsMonster).filter(a=>a.face==="FaceUp").find(a=>a.canBeEffected(e.activator,e.action.entity,e.action));if(t)return["attack","defense"].map(a=>ht.createLingeringFixation("②攻守半減",()=>!0,e.action.entity,e.action,a,(r,n,s)=>Math.round(s/2))).forEach(a=>t.numericOprsBundle.push(a)),!0},settle:async()=>!0}]}),i},wc=()=>{const i=[];return i.push({name:"ダーク・リゾネーター",actions:[qe,Le,Ge],substituteEffects:[Bo(1)]}),i},Cc=()=>{const i=[];return i.push({name:"スターダスト・ドラゴン",actions:[qe,Le,Pi(),{title:"①ヴィクテム・サンクチュアリ",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:hi,executableDuelistTypes:["Controller"],canPayCosts:e=>e.activator.canRelease([e.action.entity])&&e.action.entity.canBeReleased(e.activator,e.action.entity,["ReleaseAsCost"],e.action),validate:(e,t)=>t.length===0?void 0:t[e.index-1].chainBlockTags.includes("DestroyOnField")?[]:void 0,prepare:async(e,t,a)=>{if(a.length===0)return;const r=a.slice(-1)[0];return await e.action.entity.release(["Cost"],e.action.entity,e.activator),{selectedEntities:[],chainBlockTags:e.action.calcChainBlockTagsForDestroy([r.action.entity]),prepared:void 0}},execute:async(e,t)=>{const a=t[e.index-1];return a.isNegatedActivationBy=e.action,it.tryDestroy([a.action.entity],e),!0},settle:async()=>!0},{title:"②自己再生",playType:"IgnitionEffect",isMandatory:!1,spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["end"],executableDuelistTypes:["Controller"],validate:e=>{const t=e.action.entity.moveLog.latestRecord;if(t.movedBy!==e.action.entity||!e.activator.duel.clock.isSameTurn(t.movedAt)||!t.movedAs.includes("Cost"))return;const a=e.activator.duel,r=e.action.entity.actionLogRecords.filter(s=>a.clock.isSameTurn(s.clock)).map(s=>s.chainBlockInfo).findLast(s=>s.action.title==="①ヴィクテム・サンクチュアリ");return!r||r.state!=="done"?void 0:e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:Nt,execute:e=>ko(e),settle:async()=>!0}],canBeSummoned:gi}),i.push({name:"閃珖竜 スターダスト",canBeSummoned:gi,actions:[qe,Le,Pi(),{title:"波動音壁",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:hi,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,hasToTargetCards:!0,validate:e=>{const t=e.activator.getEntiteisOnField().filter(a=>a.face==="FaceUp").filter(a=>a.canBeTargetOfEffect(e));if(t.length)return t.map(a=>a.fieldCell)},prepare:async(e,t,a,r)=>{if(t)return{selectedEntities:t.cardEntities,chainBlockTags:[],prepared:void 0};const n=e.activator.getEntiteisOnField().filter(o=>o.face==="FaceUp").filter(o=>o.canBeTargetOfEffect(e));if(!n.length)return;const s=await e.action.entity.duel.view.waitSelectEntities(e.activator,n,1,o=>o.length===1,"対象とするカードを選択",r);if(s)return{selectedEntities:s,chainBlockTags:[],prepared:void 0}},execute:async e=>(e.selectedEntities.filter(t=>t.isOnField).filter(t=>t.face==="FaceUp").filter(t=>t.canBeEffected(e.activator,e.action.entity,e.action)).forEach(t=>{t.counterHolder.add("SonicBarrier",1,e.action.entity)}),!0),settle:async()=>!0}],substituteEffects:[{title:"波動音壁（適用）",isMandatory:!0,executableCells:pi,executablePeriods:hi,executableDuelistTypes:["Controller"],isApplicableTo:(e,t,a)=>a.filter(r=>r.counterHolder.getQty("SonicBarrier",e.entity)>0),substitute:async(e,t,a)=>{const r=a.filter(n=>n.counterHolder.getQty("SonicBarrier",e.entity)>0);return r.forEach(n=>{n.counterHolder.removeAll("SonicBarrier",e.entity),e.entity.controller.writeInfoLog(`波動音壁により${n.toString()}は１ターンに１度だけ戦闘効果では破壊されない。`)}),r}}]}),i},Tc=()=>{const i=[];return[{name:"リビングデッドの呼び声",pos:"Attack",filter:()=>!0},{name:"エンジェル・リフト",pos:"Attack",filter:e=>(e.lvl??12)<3},{name:"正統なる血統",pos:"Attack",filter:e=>{var t;return(t=e.status.monsterCategories)==null?void 0:t.includes("Normal")}},{name:"蘇りし魂",pos:"Defense",filter:e=>{var t;return(t=e.status.monsterCategories)==null?void 0:t.includes("Normal")}},{name:"リミット・リバース",pos:"Attack",filter:e=>(e.atk??9999)<=1e3,onMonsterAfterMove:async(e,t)=>{if(!t.isOnFieldAsMonster||t.face==="FaceDown")return"RemoveMe";if(e.action.entity.isEffective&&t.battlePosition==="Defense")return e.action.entity.controller.writeInfoLog(`${t.toString()}が守備表示になったため、${e.action.entity.toString()}とともに破壊される。`),await it.tryMarkForDestory([t,e.action.entity],e),"RemoveMe"}}].forEach(e=>i.push({name:e.name,actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:lt,executableDuelistTypes:["Controller"],validate:t=>{if(t.action.entity.field.getCells("Graveyard").flatMap(a=>a.cardEntities).filter(a=>a.status.kind==="Monster").filter(e.filter).filter(a=>a.info.isRebornable).filter(a=>a.canBeTargetOfEffect(t)).filter(a=>a.canBeSummoned(t.activator,t.action,"SpecialSummon",e.pos,[],!1)).some(a=>t.activator.canSummon(t.activator,a,t.action,"SpecialSummon",e.pos,[]))&&t.activator.getAvailableMonsterZones().length!==0)return Ce(t)},prepare:async t=>{const a=await t.action.entity.field.duel.view.waitSelectEntities(t.activator,t.activator.getGraveyard().cardEntities.filter(r=>r.status.kind==="Monster").filter(e.filter).filter(r=>r.info.isRebornable).filter(r=>r.canBeTargetOfEffect(t)).filter(r=>r.canBeSummoned(t.activator,t.action,"SpecialSummon",e.pos,[],!1)).filter(r=>t.activator.canSummon(t.activator,r,t.action,"SpecialSummon",e.pos,[])),1,r=>r.length===1,"蘇生対象とするモンスターを選択",!1);if(!a)throw new Tt(t);return t.action.entity.info.effectTargets[t.action.seq]=a,{selectedEntities:a,chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}},execute:async t=>{const a=t.activator.getEmptyMonsterZones(),r=t.selectedEntities[0];return r.wasMovedAfter(t.isActivatedAt)?(t.action.entity.info.effectTargets=[],!1):(await t.activator.summon(r,[e.pos],a,"SpecialSummon",["Effect"],t.action.entity,!1),t.action.entity.onBeforeMove.append(async n=>{if(n.entity.face!=="FaceUp"||!n.entity.isOnFieldAsSpellTrap)return"RemoveMe";console.log(n.entity.toString(),n.entity);const[s]=n.args;return r.isOnField&&r.face==="FaceUp"&&n.entity.isEffective&&!s.isSpellTrapZoneLikeCell&&(console.log(t.action.entity.toString()),n.entity.controller.writeInfoLog(`${t.action.entity.toString()}がフィールドを離れたため、対象モンスター${r.toString()}を破壊。`),await it.tryMarkForDestory([r],t)),"RemoveMe"}),r.onBeforeMove.append(async n=>{if(n.entity.face!=="FaceUp"||!n.entity.isOnFieldAsMonster)return"RemoveMe";console.log(n.entity.toString(),n.entity);const[,,,,,s]=n.args;return t.action.entity.isOnField&&t.action.entity.face==="FaceUp"&&n.entity.isEffective&&s.union(["EffectDestroy","RuleDestroy"]).length&&(console.log(t.action.entity.toString()),t.activator.writeInfoLog(`${n.entity.toString()}が破壊されたため、${t.action.entity.toString()}を破壊。`),await it.tryMarkForDestory([r],t)),"RemoveMe"}),r.onAfterMove.append(async n=>e.onMonsterAfterMove?await e.onMonsterAfterMove(t,n):"RemoveMe"),!0)},settle:async()=>!0},be]})),i},kc=()=>{const i=[...Yo(),...ec(),...sc(),...Jo(),...nc(),...vc(),...lc(),...oc(),...cc(),...dc(),...uc(),...gc(),...bc(),...mc(),...yc(),...Tc(),..._c(),...Sc(),...wc(),...Cc()],e=i.map(a=>a.name);console.info(e);const t=Object.values(Object.groupBy(e,a=>a)).filter(a=>((a==null?void 0:a.length)??2)>1).map(a=>a==null?void 0:a[0]);if(t.length>0)throw new Se("カード定義重複",...t);return i},Xn=new Map;kc().forEach(i=>{Xn.set(i.name,i)});const rr=Xn,Ec=es,Ie=Object.values(Ec).reduce((i,e)=>(i[e.name]=e,i),{}),Kn=[{id:-1,name:"サンプルデッキ１",description:"",cardNames:["アンノウン・シンクロン","六武衆のご隠居","ジャンク・フォアード","ジャンク・フォアード","ジャンク・フォアード","チューン・ウォリアー","チューン・ウォリアー","ガード・オブ・フレムベル","ガード・オブ・フレムベル","守護竜ユスティア","守護竜ユスティア","エンジェル・トランペッター","エンジェル・トランペッター","ジェムナイト・サフィア","ジェムナイト・サフィア","魂虎","魂虎","暗黒界の番兵 レンジ","暗黒界の番兵 レンジ","バトルフットボーラー","バトルフットボーラー","球騎士の三人娘","球騎士の三人娘","エンジェル・トランペッター","エンジェル・トランペッター","Ｇ戦隊 シャインブラック","Ｇ戦隊 シャインブラック","しゃりの軍貫","しゃりの軍貫","ジョングルグールの幻術師","ジョングルグールの幻術師","ゾンビーノ","ゾンビーノ","メガロスマッシャーＸ","メガロスマッシャーＸ","ライドロン","ライドロン","機界騎士アヴラム","機界騎士アヴラム","幻のグリフォン","幻のグリフォン","幻殻竜","幻殻竜","アレキサンドライドラゴン","アレキサンドライドラゴン","ジェネティック・ワーウルフ","ジェネティック・ワーウルフ","サイバー・ドラゴン","フロストザウルス","フロストザウルス","フロストザウルス","青眼の白龍","マジカル・アンドロイド","マジカル・アンドロイド","マジカル・アンドロイド","大地の騎士ガイアナイト","大地の騎士ガイアナイト","大地の騎士ガイアナイト","スクラップ・デスデーモン","スクラップ・デスデーモン","スクラップ・デスデーモン","スターダスト・ドラゴン","スターダスト・ドラゴン","スターダスト・ドラゴン","ナチュル・ガオドレイク","ナチュル・ガオドレイク","ナチュル・ガオドレイク"]},{id:-2,name:"サンプルデッキ２",description:"",cardNames:["アンノウン・シンクロン","六武衆のご隠居","ジャンク・フォアード","グローアップ・バルブ","ガード・オブ・フレムベル","伝説の白石","伝説の白石","伝説の白石","守護竜ユスティア","ギャラクシーサーペント","ジェネクス・コントローラー","Ｅ・ＨＥＲＯ フェザーマン","Ｅ・ＨＥＲＯ バーストレディ","チューン・ウォリアー","Ｅ・ＨＥＲＯ クレイマン","Ｅ・ＨＥＲＯ スパークマン","しゃりの軍貫","ジョングルグールの幻術師","ゾンビーノ","ジェネティック・ワーウルフ","ライトロード・ビースト ウォルフ","サイバー・ドラゴン","サイバー・ドラゴン","サイバー・ドラゴン","ラブラドライドラゴン","Ｄ－ＨＥＲＯ ディアボリックガイ","Ｄ－ＨＥＲＯ ディアボリックガイ","Ｄ－ＨＥＲＯ ディアボリックガイ","フロストザウルス","Ｅ・ＨＥＲＯ ネオス","青眼の白龍","青眼の白龍","青眼の白龍","Ｅ－エマージェンシーコール","おろかな埋葬","トレード・イン","トレード・イン","トレード・イン","闇の量産工場","強欲な壺","強欲な壺","強欲な壺","死者蘇生","死者蘇生","死者蘇生","召喚師のスキル","召喚師のスキル","召喚師のスキル","成金ゴブリン","成金ゴブリン","成金ゴブリン","戦士の生還","増援","調和の宝札","調和の宝札","調和の宝札","天使の施し","天使の施し","天使の施し","貪欲な壺","貪欲な壺","貪欲な壺","マジカル・アンドロイド","マジカル・アンドロイド","マジカル・アンドロイド","大地の騎士ガイアナイト","大地の騎士ガイアナイト","大地の騎士ガイアナイト","スクラップ・デスデーモン","スクラップ・デスデーモン","スクラップ・デスデーモン","スターダスト・ドラゴン","スターダスト・ドラゴン","スターダスト・ドラゴン","ナチュル・ガオドレイク","ナチュル・ガオドレイク","ナチュル・ガオドレイク"]}],pe=class pe{constructor(e,t){d(this,"id");d(this,"name");d(this,"description");d(this,"lastUsedAt");d(this,"cardNames");d(this,"getIllegalCardNames",()=>Array.from(new Set(this.cardNames.filter(e=>!Object.keys(Ie).includes(e)))));d(this,"getDisableCardNames",()=>Array.from(new Set(this.cardNames.filter(e=>!Object.keys(Ie).includes(e)))));d(this,"createCardInfos",()=>{const e=this.getIllegalCardNames();if(e.length>0)throw new Error(`存在しないカード名からデッキを生成しようとした。${e}`);return this.cardNames.map(t=>Ie==null?void 0:Ie[t]).filter(t=>t)});d(this,"copy",async()=>pe.createNewDeck(this.name,this.description,this.cardNames));d(this,"updateTimestamp",async()=>{await pe.tblHeader.update(this.id,e=>({...e,lastUsedAt:new Date}))});d(this,"saveDeckInfo",async e=>{const t=e??this;await pe.tblHeader.update(this.id,n=>({...n,name:t.name,description:t.description,lastUsedAt:new Date}));const a=(await pe.tblDetail.getAll()).filter(n=>n.deckId===this.id);await pe.tblDetail.delete(a.map(n=>n.id));const r=await pe.tblDetail.insertMany(t.cardNames.map((n,s)=>({deckId:this.id,seq:s,name:n,description:""})));return new pe(await pe.tblHeader.get(this.id),r)});d(this,"delete",async()=>{await pe.tblHeader.delete([this.id]);const e=(await pe.tblDetail.getAll()).filter(t=>t.deckId===this.id);await pe.tblDetail.delete(e.map(t=>t.id))});this.id=e.id,this.name=e.name,this.description=e.description,this.lastUsedAt=e.lastUsedAt,this.cardNames=t.filter(a=>a.deckId===this.id).map(a=>a.name)}};d(pe,"toJson",e=>{const t=e.map(a=>{const{id:r,name:n,description:s,lastUsedAt:o,cardNames:u}=a;return{id:r,name:n,description:s,lastUsedAt:o,cardNames:u}});return t.forEach(a=>{a.cardNames=a.cardNames.map(r=>Ie[r]).sort(Mi).map(r=>r.name)}),JSON.stringify(t,null,2)}),d(pe,"convertToObjectURL",e=>{const t=pe.toJson(e),a=new Blob([t],{type:"text/plain"});return window.URL.createObjectURL(a)}),d(pe,"idb"),d(pe,"tblHeader"),d(pe,"tblDetail"),d(pe,"getAllDeckInfo",async e=>{if(e&&(pe.idb=e),!pe.idb)throw new Error("illegal argument: idb is undefined.");pe.tblHeader||(pe.tblHeader=new Dc(pe.idb)),pe.tblDetail||(pe.tblDetail=new Ac(pe.idb));const t=await pe.tblHeader.getAll(),a=await pe.tblDetail.getAll();return t.length?t.map(r=>new pe(r,a)):[await pe.prepareSampleDeck()]}),d(pe,"createNewDeck",async(e,t,a)=>{const r=await pe.tblHeader.insert({name:e,description:t,lastUsedAt:new Date}),n=await pe.tblDetail.insertMany(a.map((s,o)=>({deckId:r.id,seq:o,name:s,description:""})));return new pe(r,n)}),d(pe,"prepareSampleDeck",async()=>{const e=Kn.slice(-1)[0];return await pe.createNewDeck(e.name,e.description,e.cardNames)});let bt=pe;class Dc extends yr{constructor(t){super(t,"TblDeckHeader");d(this,"_prepareInitialRecords",()=>[])}}class Ac extends yr{constructor(t){super(t,"TblDeckDetail");d(this,"_prepareInitialRecords",()=>[])}}const Wr=Kn.map(i=>({...i,lastUsedAt:new Date})).filter(i=>i.id<0);function xc(i){const e=i-1;return e*e*e+1}function Yr(i,e){for(const t in e)i[t]=e[t];return i}function Mc({fallback:i,...e}){const t=new Map,a=new Map;function r(s,o,u){const{delay:l=0,duration:c=x=>Math.sqrt(x)*30,easing:v=xc}=Yr(Yr({},e),u),f=s.getBoundingClientRect(),h=o.getBoundingClientRect(),y=f.left-h.left,b=f.top-h.top,m=f.width/h.width,S=f.height/h.height,E=Math.sqrt(y*y+b*b),F=getComputedStyle(o),q=F.transform==="none"?"":F.transform,T=+F.opacity;return{delay:l,duration:typeof c=="function"?c(E):c,easing:v,css:(x,Z)=>`
			   opacity: ${x*T};
			   transform-origin: top left;
			   transform: ${q} translate(${Z*y}px,${Z*b}px) scale(${x+(1-x)*m}, ${x+(1-x)*S});
		   `}}function n(s,o,u){return(l,c)=>(s.set(c.key,l),()=>{if(o.has(c.key)){const v=o.get(c.key);return o.delete(c.key),r(v,l,c)}return s.delete(c.key),i&&i(l,c,u)})}return[n(a,t,!1),n(t,a,!0)]}var Pc=C("<div></div>"),Fc=C('<div class="duel_card_row svelte-1vsjnqs"><div> </div> <div> </div></div>'),Bc=C('<div class="duel_card_row svelte-1vsjnqs"><div class="svelte-1vsjnqs"></div> <div class="svelte-1vsjnqs"> </div></div>'),Oc=C('<div class="duel_card_row svelte-1vsjnqs"><div class="svelte-1vsjnqs"></div> <div class="svelte-1vsjnqs"> </div></div>'),Nc=C('<div class="duel_card_row svelte-1vsjnqs"><div> </div> <div> </div></div>'),qc=C('<div class="duel_card_row duel_card_detail svelte-1vsjnqs"><div class="svelte-1vsjnqs"> </div></div> <div class="duel_card_row duel_card_detail svelte-1vsjnqs"><div class="svelte-1vsjnqs"></div> <div class="svelte-1vsjnqs"><span> </span> / <span> </span></div></div>',1),Lc=C('<button><div class="duel_card duel_card_visible svelte-1vsjnqs"><div class="duel_card_row svelte-1vsjnqs" style="position:relative"><div class="svelte-1vsjnqs"> </div> <div class="svelte-1vsjnqs"></div> <!></div> <!> <!> <!></div></button>'),Rc=C('<button><div class="svelte-1vsjnqs">裏守備</div></button>'),Hc=C('<div class="duel_card duel_card_face_down svelte-1vsjnqs"><div class="svelte-1vsjnqs">セット</div></div>');function At(i,e){Ve(e,!1);let t=De(e,"entity",8),a=De(e,"state",8,"Disabled"),r=De(e,"selectedList",28,()=>[]),n=De(e,"isVisibleForcibly",8,!1),s=De(e,"isWideMode",8,!1),o=De(e,"actions",24,()=>[]),u=De(e,"cardActionResolve",8),l=De(e,"entitySelectResolve",8,()=>{}),c,v=Ne(!1),f=()=>{},h=De(e,"qty",12,void 0);const y=V=>{c=V.activator,Q(v,!1),h(V.qty),f=V.resolve};t().field.duel.view.onWaitStart.append(y);let b=Ne(!1);const m=()=>{if(a()!=="Disabled"&&a()==="Selectable"&&h()===1){if(r().some(V=>V.seq!==t().seq)){r([t()]);return}h()===1&&l()&&l()([t()])}},S=V=>{(t().face==="FaceUp"||t().owner===t().field.duel.duelists.Below&&(t().isUnderControl||n()))&&t().field.duel.view.showCardInfo(t(),V??"Normal")},E=()=>{if(S(),a()==="Disabled")return;if(a()==="Selectable"){Q(v,!p(v)),h()===1&&(r().splice(0),t().duel.view.requireUpdate()),r(p(v)?[...r(),t()]:r().filter(ne=>ne!==t()));return}if(o().length===0)return;if(o().length===1){if(o()[0].dragAndDropOnly)return;if(u()){u()(o()[0]);return}f({action:o()[0]});return}if(!c)return;const V=t().field.duel.view;V.modalController.selectAction(V,{title:"行動を選択。",activator:c,actions:o(),cancelable:!0}).then(ne=>{f({action:ne})})},F=V=>{console.info("drag start",V,o()),t().field.duel.view.setDraggingActions(o()),Q(b,!0)},q=V=>{console.info("drag end",V,o()),t().field.duel.view.removeDraggingActions(),V.dataTransfer&&Q(b,!1)},T=()=>(S("Debug"),!1);ot();var x=Be(),Z=le(x);{var M=V=>{var ne=Lc(),xe=g(ne),Re=g(xe),ie=g(Re),B=g(ie),W=_(ie,4);ue(W,1,()=>t().attr,de,(L,G)=>{var z=Pc();A(()=>ye(z,`monster_attr ${p(G)??""} svelte-1vsjnqs`)),w(L,z)});var fe=_(Re,2);{var D=L=>{var G=Fc(),z=g(G),Y=g(z),X=_(z,2),J=g(X);A((te,I)=>{ye(z,si(t().lvl!==t().origin.level?"different_from_its_origin":""),"svelte-1vsjnqs"),k(Y,te),ye(X,si(t().rank!==t().origin.rank?"different_from_its_origin":""),"svelte-1vsjnqs"),k(J,I)},[()=>"★".repeat(t().lvl||0),()=>"☆".repeat(t().rank||0)],ge),w(L,G)},U=L=>{var G=Be(),z=le(G);{var Y=J=>{var te=Bc(),I=_(g(te),2),R=g(I);A(()=>k(R,`${Ui[t().status.spellCategory]??""}魔法`)),w(J,te)},X=J=>{var te=Be(),I=le(te);{var R=$=>{var ce=Oc(),K=_(g(ce),2),ve=g(K);A(()=>k(ve,`${Zi[t().status.trapCategory]??""}罠`)),w($,ce)};j(I,$=>{t().status.kind==="Trap"&&t().status.trapCategory&&$(R)},!0)}w(J,te)};j(z,J=>{t().status.kind==="Spell"&&t().status.spellCategory?J(Y):J(X,!1)},!0)}w(L,G)};j(fe,L=>{t().status.kind==="Monster"?L(D):L(U,!1)})}var ee=_(fe,2);{var oe=L=>{var G=Nc(),z=g(G),Y=g(z),X=_(z,2),J=g(X);A(()=>{ye(z,si(t().psL!==t().origin.pendulumScaleL?"different_from_its_origin":""),"svelte-1vsjnqs"),k(Y,`◀ ${t().psL??""}`),ye(X,si(t().psR!==t().origin.pendulumScaleR?"different_from_its_origin":""),"svelte-1vsjnqs"),k(J,`${t().psR??""} ▶`)}),w(L,G)};j(ee,L=>{var G;(G=t().status.monsterCategories)!=null&&G.includes("Pendulum")&&L(oe)})}var N=_(ee,2);{var H=L=>{var G=qc(),z=le(G),Y=g(z),X=g(Y),J=_(z,2),te=_(g(J),2),I=g(te),R=g(I),$=_(I,2),ce=g($);A((K,ve)=>{k(X,`${K??""}
            ${ve??""}`),ye(I,si(t().atk!==t().origin.attack?"different_from_its_origin":""),"svelte-1vsjnqs"),k(R,t().atk??"?"),ye($,si(t().def!==t().origin.defense?"different_from_its_origin":""),"svelte-1vsjnqs"),k(ce,t().def??"?")},[()=>t().types.map(K=>Gi[K]+(s()?Ca[K]:"")).join(),()=>{var K;return(K=t().status.monsterCategories)==null?void 0:K.map(ve=>ji[ve]+(s()?wa[ve]:"")).join()}],ge),w(L,G)};j(N,L=>{t().status.kind==="Monster"&&L(H)})}A(L=>{ye(ne,`duel_card button_style_reset ${t().status.kind??""} ${L??""} ${(p(v)?"duel_card_selected":"")??""} ${a()??""} duel_card_${t().orientation??""} ${(p(b)?"isDragging":"")??""} ${(s()?"duel_card_wide":"")??""} duel_card_${t().face??""} ${(t().isOnField?"duel_card_is_on_field":"")??""} svelte-1vsjnqs`),Bt(ne,"draggable",a()==="Draggable"),Bt(ne,"title",t().nm),k(B,t().nm)},[()=>{var L;return((L=t().status.monsterCategories)==null?void 0:L.join(" "))||""}],ge),$e("dragstart",ne,F),$e("dragend",ne,q),$e("click",ne,E),$e("dblclick",ne,m),$e("mouseenter",ne,()=>S()),$e("contextmenu",ne,T),w(V,ne)},re=V=>{var ne=Be(),xe=le(ne);{var Re=B=>{var W=Rc();A(()=>ye(W,`duel_card duel_card_face_down duel_card_face_down_defense ${a()??""}  ${(p(v)?"duel_card_selected":"")??""} svelte-1vsjnqs`)),$e("click",W,E),$e("dblclick",W,m),w(B,W)},ie=B=>{var W=Hc();w(B,W)};j(xe,B=>{t().battlePosition==="Set"?B(Re):B(ie,!1)},!0)}w(V,ne)};j(Z,V=>{t().face==="FaceUp"||n()||t().controller.duelistType==="Player"&&t().isUnderControl?V(M):V(re,!1)})}w(i,x),We()}var $c=C('<div class="phase_display svelte-1mupj1p"><span class="svelte-1mupj1p"> </span> </div>'),jc=C('<div class="lifepoint_display svelte-1mupj1p"><div class="svelte-1mupj1p"> </div> <div class="svelte-1mupj1p"> </div></div>'),Uc=(i,e,t)=>e(p(t)),Zc=C('<div class="svelte-1mupj1p"><button class="phase_button svelte-1mupj1p"> </button></div>'),Gc=C("<div><!></div>"),zc=C('<div class="svelte-1mupj1p"><!></div>'),Vc=C("<div><!></div>"),Wc=C("<!> <!> <!>",1),Yc=C('<div style="position: absolute;" class="card_animation_receiver svelte-1mupj1p"><!></div>'),Xc=C('<div style="position: absolute; top:0rem" class="svelte-1mupj1p">｛効果対象｝</div>'),Kc=C('<!> <div style="position: absolute; display:flex;justify-content: center;" class="svelte-1mupj1p"><!></div>',1),Qc=C(" <!> 】",1),Jc=C('<div style="position: absolute; bottom:0rem" class="svelte-1mupj1p"> <!></div>'),Ic=C("<!> <!>",1),ed=C('<div class="badge svelte-1mupj1p"> </div>'),td=C('<div class="card_animation_receiver svelte-1mupj1p"><!></div>'),id=C("<!> <!> <!> <!>",1),ad=C('<td><div role="listitem"><!></div></td>');function rd(i,e){Ve(e,!1);let t=De(e,"view",8),a=De(e,"row",8),r=De(e,"column",8),n=De(e,"selectedList",28,()=>[]),s=Ne(t().getCell(a(),r()));const o=()=>{Q(s,t().getCell(a(),r()))};p(s).onUpdate.append(o),t().onDuelUpdate.append(o),t().modalController.onUpdate.append(o);let u,l=Ne([]),c=()=>{},v,f=Ne([]);const h=D=>{Q(T,void 0),n().reset(),u=D.activator,c=D.resolve,Q(l,D.enableActions),Q(f,D.chainBlockInfos.flatMap(U=>U.selectedEntities).getDistinct()),v=D.selectableEntities,D.entitiesValidator};t().onWaitStart.append(h);const y=()=>{u=void 0,Q(l,[]),c=()=>{},v=[],Q(f,[])};t().onWaitEnd.append(y);let b,m=Ne(!1);const S=D=>{b=D,Q(m,D.some(U=>{var ee;return(ee=U.validate(t().duel.priorityHolder,t().duel.chainBlockInfos))==null?void 0:ee.includes(p(s))})||!1),o()},E=()=>{b=void 0,Q(m,!1),o()};t().onDragStart.append(S),t().onDragEnd.append(E);const[F,q]=su;let T=Ne(void 0);const x=D=>{if(u=void 0,p(s)===D.to||p(s).entities.includes(D.entity)){Q(T,D);const U=D.resolve;Q(s,p(s)),setTimeout(()=>{Q(T,void 0),D.count++,D.count>1&&U()},600)}};t().onAnimation.append(x);const Z=D=>{c({phaseChange:D})},M=()=>p(s).isStackCell&&p(s).entities.flatMap(D=>D.actions).filter(D=>p(l).map(U=>U.seq).some(U=>U===D.seq)).length>0,re=()=>{if(je(s,p(s).field.duel.view.infoBoardState="Log"),p(s).isStackCell){je(s,p(s).field.duel.view.infoBoardState="CellInfo"),je(s,p(s).field.duel.view.infoBoardCell=p(s)),p(s).field.duel.view.requireUpdate();const D=p(s).entities.flatMap(U=>U.actions).filter(U=>p(l).map(ee=>ee.seq).some(ee=>ee===U.seq));if(D.length){if(!u)return;const U=p(s).field.duel.view;U.modalController.selectAction(U,{title:"カードを選択。",activator:u,actions:D,cancelable:!0}).then(ee=>{c({action:ee})});return}}p(s).field.duel.view.requireUpdate(),console.info(p(s))},V=D=>{D.preventDefault(),D.dataTransfer&&(D.dataTransfer.dropEffect="move")},ne=D=>{D.preventDefault(),console.info("drop",D,p(m),b),D.dataTransfer&&(D.dataTransfer.dropEffect="move");try{if(p(m)&&b){if(console.info(b,p(s)),b.length===1){const U=b[0].getClone();U.cell=p(s),U.pos=b[0].pos,c({action:U})}else if(b.length>1){if(!u)throw new Se("想定されない状態");p(s).field.duel.view.modalController.cancelAll(),p(s).field.duel.view.modalController.selectAction(p(s).field.duel.view,{title:"選択",activator:u,actions:b,cancelable:!1})}}}finally{t().removeDraggingActions()}},xe=(...D)=>{if(t().waitMode==="Animation")return"Disabled";if(v&&v.find(oe=>D.find(N=>oe===N)))return"Selectable";if(!p(l)||p(l).length===0||t().waitMode!=="SelectFieldAction"||Object.values(t().modalController.states).some(oe=>oe==="Shown"))return"Disabled";const U=p(l).filter(oe=>D.includes(oe.entity));if(U.length===0)return"Disabled";if(U.length>1||p(s).isStackCell||U[0].entity!==D[0])return"Clickable";const ee=U[0].validate(t().duel.priorityHolder,t().duel.chainBlockInfos);return ee&&ee.length>0?"Draggable":"Clickable"};ot();var Re=ad(),ie=g(Re);ie.__click=re;var B=g(ie);{var W=D=>{var U=Be(),ee=le(U);{var oe=N=>{var H=Be(),L=le(H);{var G=Y=>{var X=$c(),J=g(X),te=g(J),I=_(J,1,!0);A((R,$)=>{k(te,R),k(I,$)},[()=>String(p(s).field.duel.clock.turn).padStart(2,"0"),()=>p(s).field.duel.phase.toUpperCase()],ge),w(Y,X)},z=Y=>{var X=Be(),J=le(X);{var te=R=>{var $=jc(),ce=g($),K=g(ce),ve=_(ce,2),we=g(ve);A(()=>{k(K,p(s).field.duel.duelists.Above.lp),k(we,p(s).field.duel.duelists.Below.lp)}),w(R,$)},I=R=>{var $=Be(),ce=le($);{var K=ve=>{var we=Be(),Oe=le(we);{var Pe=P=>{var O=Be(),he=le(O);{var se=_e=>{var Me=Be(),He=le(Me);ue(He,1,()=>t().duel.nextPhaseList,de,(at,tt)=>{var rt=Zc(),Et=g(rt);Et.__click=[Uc,Z,tt];var nt=g(Et);A(Te=>k(nt,Te),[()=>p(tt).toUpperCase()],ge),w(at,rt)}),w(_e,Me)};j(he,_e=>{t().duel.isEnded||_e(se)})}w(P,O)};j(Oe,P=>{t().waitMode==="SelectFieldAction"&&P(Pe)})}w(ve,we)};j(ce,ve=>{p(s).column===5&&ve(K)},!0)}w(R,$)};j(J,R=>{p(s).column===3?R(te):R(I,!1)},!0)}w(Y,X)};j(L,Y=>{p(s).column===1?Y(G):Y(z,!1)})}w(N,H)};j(ee,N=>{p(s).row===3&&N(oe)})}w(D,U)},fe=D=>{var U=Be(),ee=le(U);{var oe=H=>{var L=Wc(),G=le(L);{var z=te=>{var I=Gc(),R=g(I);At(R,{get entity(){return p(T).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),A(()=>ye(I,`card_animation_receiver ${p(s).cellType??""} svelte-1mupj1p`)),li(1,I,()=>q,()=>({key:p(T).entity.seq})),w(te,I)};j(G,te=>{p(T)&&p(T).entity&&p(T).to===p(s)&&p(T).index==="Top"&&te(z)})}var Y=_(G,2);ue(Y,1,()=>p(s).visibleEntities,de,(te,I)=>{var R=Be(),$=le(R);{var ce=K=>{var ve=zc(),we=g(ve);const Oe=ge(()=>xe(p(I))),Pe=ge(()=>p(l).filter(P=>P.entity===p(I)));At(we,{get entity(){return p(I)},get state(){return p(Oe)},get actions(){return p(Pe)},cardActionResolve:void 0,get selectedList(){return n()},set selectedList(P){n(P)},$$legacy:!0}),li(2,ve,()=>F,()=>({key:p(I).seq})),w(K,ve)};j($,K=>{(!p(T)||p(T).entity.seq!==p(I).seq)&&K(ce)})}w(te,R)});var X=_(Y,2);{var J=te=>{var I=Vc(),R=g(I);At(R,{get entity(){return p(T).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),A(()=>ye(I,`card_animation_receiver ${p(s).cellType??""} svelte-1mupj1p`)),li(1,I,()=>q,()=>({key:p(T).entity.seq})),w(te,I)};j(X,te=>{p(T)&&p(T).entity&&p(T).to===p(s)&&p(T).index!=="Top"&&te(J)})}w(H,L)},N=H=>{var L=id(),G=le(L);{var z=$=>{var ce=Yc(),K=g(ce);At(K,{get entity(){return p(T).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),li(1,ce,()=>q,()=>({key:p(T).entity.seq})),w($,ce)};j(G,$=>{p(T)&&p(T).entity&&p(T).to===p(s)&&p(T).index!=="Top"&&$(z)})}var Y=_(G,2);{var X=$=>{var ce=Ic(),K=le(ce);ue(K,1,()=>p(s).visibleEntities.map((Oe,Pe)=>({index:Pe,entity:Oe})).toReversed(),de,(Oe,Pe)=>{var P=Be(),O=le(P);{var he=se=>{var _e=Kc(),Me=le(_e);{var He=nt=>{var Te=Xc();w(nt,Te)};j(Me,nt=>{p(f).includes(p(Pe).entity)&&nt(He)})}var at=_(Me,2),tt=g(at);const rt=ge(()=>!p(s).isStackCell&&p(Pe).index===0?xe(...p(s).visibleEntities):void 0),Et=ge(()=>p(Pe).index===0?p(l).filter(nt=>p(s).visibleEntities.includes(nt.entity)):void 0);At(tt,{get entity(){return p(Pe).entity},get state(){return p(rt)},get actions(){return p(Et)},cardActionResolve:void 0,get selectedList(){return n()},set selectedList(nt){n(nt)},$$legacy:!0}),li(2,at,()=>F,()=>({key:p(Pe).entity.seq})),w(se,_e)};j(O,se=>{(!p(T)||p(T).entity.seq!==p(Pe).entity.seq)&&se(he)})}w(Oe,P)});var ve=_(K,2);{var we=Oe=>{var Pe=Jc(),P=g(Pe),O=_(P);ue(O,1,()=>Object.keys(p(s).visibleEntities[0].status.maxCounterQty),de,(he,se)=>{var _e=Qc(),Me=le(_e),He=_(Me);{var at=tt=>{var rt=Yt();A(()=>k(rt,`/${p(s).visibleEntities[0].status.maxCounterQty[p(se)]??""}`)),w(tt,rt)};j(He,tt=>{(p(s).visibleEntities[0].status.maxCounterQty[p(se)]??!1)&&tt(at)})}A(tt=>k(Me,`【
              ${co[p(se)]??""}${tt??""} `),[()=>p(s).visibleEntities[0].counterHolder.getQty(p(se))],ge),w(he,_e)}),A(()=>k(P,`【${p(s).visibleEntities[0].battlePositionName??""}】 `)),w(Oe,Pe)};j(ve,Oe=>{p(s).visibleEntities[0].battlePosition&&Oe(we)})}w($,ce)};j(Y,$=>{p(s).visibleEntities.length>0&&$(X)})}var J=_(Y,2);{var te=$=>{var ce=ed(),K=g(ce);A(()=>k(K,p(s).visibleEntities.length)),w($,ce)};j(J,$=>{p(s).isStackCell&&$(te)})}var I=_(J,2);{var R=$=>{var ce=td(),K=g(ce);At(K,{get entity(){return p(T).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),li(1,ce,()=>q,()=>({key:p(T).entity.seq})),w($,ce)};j(I,$=>{p(T)&&p(T).entity&&p(T).to===p(s)&&p(T).index==="Top"&&$(R)})}w(H,L)};j(ee,H=>{p(s).cellType==="Hand"?H(oe):H(N,!1)},!0)}w(D,U)};j(B,D=>{p(s).isDisabledCell?D(W):D(fe,!1)})}A(D=>{ye(Re,`${`duel_field_cell duel_field_cell_${p(s).cellType}`??""} svelte-1mupj1p`),Bt(Re,"colspan",p(s).cellType==="Hand"?7:1),ye(ie,`${D??""} svelte-1mupj1p`)},[()=>`duel_card_wrapper ${p(s).cellType} ${p(m)?"can_accept_drop":""} ${M()?"can_action":""}`],ge),$e("dragover",ie,D=>V(D)),$e("drop",ie,D=>ne(D)),w(i,Re),We()}$i(["click"]);var nd=C('<tr><td style=" white-space: nowrap;text-align: center;"> </td><td class="svelte-13svkzh"> </td></tr>'),sd=C('<div class="duel_log svelte-13svkzh"><table><tbody></tbody></table></div>');function ld(i,e){var u,l;Ve(e,!1);let t=Ne(void 0),a=De(e,"log",12);const r=()=>{a(a()),Js().then(()=>p(t)&&p(t).scroll(0,p(t).clientHeight*990))};(l=(u=a())==null?void 0:u.onUpdate)==null||l.append(r),ot();var n=sd(),s=g(n),o=g(s);ue(o,5,()=>a().records,de,(c,v)=>{var f=nd(),h=g(f),y=g(h),b=_(h),m=g(b);A(()=>{var S,E;ye(h,`duelist ${((S=p(v).duelist)==null?void 0:S.seat)??""} svelte-13svkzh`),k(y,((E=p(v).duelist)==null?void 0:E.profile.name)||"SYSTEM"),k(m,p(v).text)}),w(c,f)}),kl(n,c=>Q(t,c),()=>p(t)),w(i,n),We()}var od=C('<div><div class="duelist_name svelte-1u7codf"> </div> <div> </div></div>');function Xr(i,e){Ve(e,!1);let t=De(e,"duelist",12),a=Ne(0),r=Ne();const n=async()=>{const f=t().lp-p(a);if(!p(r)||Math.abs(f)<10){Q(a,t().lp),p(r)&&(p(r)(),Q(r,void 0));return}Q(a,p(a)+Math.floor(Math.random()*f)),await $o(100),n()},s=()=>{t(t()),!p(r)&&t().lp!==p(a)&&new Promise(f=>{Q(r,f),Math.abs(t().lp-p(a)),n()})};t().duel.log.onUpdate.append(s),n(),ot();var o=od(),u=g(o),l=g(u),c=_(u,2),v=g(c);A(()=>{ye(o,`duelist ${t().seat??""} svelte-1u7codf`),k(l,t().profile.name),ye(c,`duelist_lp ${(p(r)?"vibration":"")??""} svelte-1u7codf`),k(v,p(a))}),w(i,o),We()}const cd=()=>{};var dd=C("<div><!></div>"),ud=C("<div></div>"),vd=(i,e,t)=>e.resolve(p(t)),fd=(i,e)=>e.resolve(void 0),pd=C('<button class="svelte-25k6xl">Cancel</button>'),hd=C('<div class="base svelte-25k6xl"><button class="overlay svelte-25k6xl">☆</button> <div class="window svelte-25k6xl"><div> </div> <!> <div><button class="svelte-25k6xl">OK</button> <!></div></div></div>');function gd(i,e){Ve(e,!0);let t=Bs($t([])),a=e.chainBlockInfos.flatMap(o=>o.selectedEntities).getDistinct();var r=Be(),n=le(r);{var s=o=>{var u=hd(),l=g(u);l.__click=[cd];var c=_(l,2),v=g(c),f=g(v),h=_(v,2);ue(h,17,()=>e.entities.map(E=>E.controller.seat).getDistinct(),de,(E,F)=>{var q=ud();ue(q,21,()=>e.entities.filter(T=>T.controller.seat===p(F)).toSorted(Vn),de,(T,x)=>{var Z=dd(),M=g(Z);At(M,{get entity(){return p(x)},isVisibleForcibly:!0,state:"Selectable",entitySelectResolve:re=>e.resolve(re),get qty(){return e.qty},cardActionResolve:void 0,get selectedList(){return p(t)},set selectedList(re){Q(t,$t(re))}}),A(re=>ye(Z,`entities_list_item ${re??""} svelte-25k6xl`),[()=>a.includes(p(x))?"effect_target":""]),w(T,Z)}),A(()=>ye(q,`entities_list ${p(F)??""} svelte-25k6xl`)),w(E,q)});var y=_(h,2),b=g(y);b.__click=[vd,e,t];var m=_(b,2);{var S=E=>{var F=pd();F.__click=[fd,e],w(E,F)};j(m,E=>{e.cancelable&&E(S)})}A(E=>{k(f,e.title),b.disabled=E},[()=>!e.validator(p(t))]),w(o,u)};j(n,o=>{o(s)})}w(i,r),We()}$i(["click"]);const yd=(i,e)=>{e.cancelable&&e.resolve(void 0)};var md=C('<div class="duel_card_wrapper svelte-11mc7y0"><!> <div> </div></div>'),_d=(i,e)=>e.resolve(),Sd=C('<div><button class="cancel_button svelte-11mc7y0">Cancel</button></div>'),bd=C('<div><button>★</button> <div><div> </div> <div class="flex svelte-11mc7y0"></div> <!></div></div>');function wd(i,e){Ve(e,!0);const[t,a]=xl(),r=()=>Al(n,"$isDragging",t);let n=El(!1);const s=()=>n.set(!0),o=()=>n.set(!1);e.view.onDragStart.append(s),e.view.onDragEnd.append(o);const u=f=>{if(e.activator.duelistType==="NPC")return"Disabled";const h=f.validate(e.activator,e.view.duel.chainBlockInfos);return h&&h.length>0?"Draggable":"Clickable"};var l=Be(),c=le(l);{var v=f=>{var h=bd(),y=g(h);y.__click=[yd,e];var b=_(y,2),m=g(b),S=g(m),E=_(m,2);ue(E,21,()=>e.actions,de,(T,x)=>{var Z=md(),M=g(Z);const re=ei(()=>u(p(x))),V=ei(()=>e.dragAndDropOnly?[]:[p(x)]);At(M,{get entity(){return p(x).entity},isVisibleForcibly:!0,get state(){return p(re)},get actions(){return p(V)},get cardActionResolve(){return e.resolve}});var ne=_(M,2),xe=g(ne);A(()=>k(xe,`«${p(x).title??""}»`)),w(T,Z)});var F=_(E,2);{var q=T=>{var x=Sd(),Z=g(x);Z.__click=[_d,e],w(T,x)};j(F,T=>{e.cancelable&&T(q)})}A(()=>{ye(h,`${`base ${r()?"minimum_mode":""}`??""} svelte-11mc7y0`),ye(y,`${`overlay ${r()?"minimum_mode":""}`??""} svelte-11mc7y0`),ye(b,`${`window ${r()?"minimum_mode":""}`??""} svelte-11mc7y0`),k(S,e.title)}),w(f,h)};j(c,f=>{f(v)})}w(i,l),We(),a()}$i(["click"]);const Cd=(i,e,t,a)=>{e().cancelable&&(t()(void 0),Q(a,!1))};var Td=(i,e,t)=>e()(t()),kd=C("<li><button> </button></li>"),Ed=(i,e)=>e()(void 0),Dd=C("<button>Cancel</button>"),Ad=C('<div class="base svelte-1103gpy"><button class="overlay svelte-1103gpy">★</button> <div class="window svelte-1103gpy"><div> </div> <ui class="text_list svelte-1103gpy"></ui> <!></div></div>');function xd(i,e){Ve(e,!1);let t=De(e,"arg",8),a=De(e,"resolve",8),r=Ne(!0);ot();var n=Be(),s=le(n);{var o=u=>{var l=Ad(),c=g(l);c.__click=[Cd,t,a,r];var v=_(c,2),f=g(v),h=g(f),y=_(f,2);ue(y,5,()=>t().choises,de,(S,E)=>{let F=()=>p(E).seq,q=()=>p(E).text;var T=kd(),x=g(T);x.__click=[Td,a,F];var Z=g(x);A(()=>{ye(T,`text_item ${F()??""} svelte-1103gpy`),k(Z,q())}),w(S,T)});var b=_(y,2);{var m=S=>{var E=Dd();E.__click=[Ed,a],w(S,E)};j(b,S=>{t().cancelable&&S(m)})}A(()=>k(h,t().title)),w(u,l)};j(s,u=>{p(r)&&u(o)})}w(i,n),We()}$i(["click"]);var Md=C('<div class="base svelte-1y912d"><!> <!> <!></div>');function Pd(i,e){var v,f;Ve(e,!1);let t=De(e,"modalController",12);const a=()=>{t(t())};(f=(v=t())==null?void 0:v.onUpdate)==null||f.append(a),ot();var r=Md(),n=g(r);{var s=h=>{gd(h,{get title(){return t().duelEntitiesSelectorArg.title},get entities(){return t().duelEntitiesSelectorArg.entities},get validator(){return t().duelEntitiesSelectorArg.validator},get qty(){return t().duelEntitiesSelectorArg.qty},get cancelable(){return t().duelEntitiesSelectorArg.cancelable},get chainBlockInfos(){return t().duelEntitiesSelectorArg.chainBlockInfos},resolve:y=>{t().duelEntitiesSelectorResolve(y)}})};j(n,h=>{t().states.DuelEntitiesSelector==="Shown"&&h(s)})}var o=_(n,2);{var u=h=>{const y=ge(()=>t().cardActionSelectorArg.dragAndDropOnly??!1);wd(h,{get view(){return t().view},get title(){return t().cardActionSelectorArg.title},get activator(){return t().cardActionSelectorArg.activator},get actions(){return t().cardActionSelectorArg.actions},get dragAndDropOnly(){return p(y)},get cancelable(){return t().cardActionSelectorArg.cancelable},resolve:b=>{console.info(b),t().cardActionSelectorResolve(b)}})};j(o,h=>{t().states.DuelActionSelector==="Shown"&&h(u)})}var l=_(o,2);{var c=h=>{xd(h,{get arg(){return t().duelTextSelectorArg},resolve:y=>{console.info(y),t().duelTextSelectorResolve(y)}})};j(l,h=>{t().states.DuelTextSelector==="Shown"&&h(c)})}w(i,r),We()}const Fd=(i,e)=>(e(e()==="Normal"?"Debug":"Normal"),!0);var Bd=C('<div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"><pre class="description svelte-nn7bjy"> </pre></div></div> <div class="duel_card_info_row svelte-nn7bjy" style=" justify-content: space-between;"><div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"> </div></div>',1),Od=C('<div></div> <div class="svelte-nn7bjy"> </div>',1),Nd=C("<div> </div>"),qd=C("<div> </div>"),Ld=C('<div class="duel_card_info_row svelte-nn7bjy"><!> <!></div> <div class="duel_card_info_row svelte-nn7bjy"></div>',1),Rd=C('<div class="duel_card_row svelte-nn7bjy"><div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"> </div></div>'),Hd=C('<div class="duel_card_row svelte-nn7bjy"><div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"> </div></div>'),$d=C("<!> <!>",1),jd=C('<div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"><pre class="description svelte-nn7bjy"> </pre></div></div>'),Ud=C('<div class="svelte-nn7bjy"> </div>'),Zd=C('<div class="svelte-nn7bjy"> </div>'),Gd=C('<div class="svelte-nn7bjy"> </div>'),zd=C('<div class="svelte-nn7bjy"> </div>'),Vd=C('<div class="svelte-nn7bjy"> </div>'),Wd=C('<div class="svelte-nn7bjy"> </div>'),Yd=C('<div class="svelte-nn7bjy"> </div>'),Xd=C('<div class="svelte-nn7bjy"> </div>'),Kd=C('<div class="svelte-nn7bjy"> </div>'),Qd=C('<div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"><div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"></div></div></div>'),Jd=C('<div class="svelte-nn7bjy">※テスト用カードです</div>'),Id=C('<div class="duel_card_info_links svelte-nn7bjy"><a target="_blank" rel="noopener noreferrer" title="遊戯王カードWiki" class="svelte-nn7bjy">⇒遊戯王カードWiki</a> <a target="_blank" rel="noopener noreferrer" title="コナミカードデータベース" class="svelte-nn7bjy"> </a></div>'),eu=C('<div role="contentinfo"><div class="duel_card_info_header svelte-nn7bjy"><div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"> </div></div> <div class="duel_card_info_row svelte-nn7bjy" style="position:sticky; top:0;"><div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"> </div></div> <!></div> <div class="duel_card_info_body svelte-nn7bjy"><!></div> <div class="duel_card_info_footer svelte-nn7bjy"><!></div></div>');function tu(i,e){Ve(e,!1);let t=De(e,"entity",8,void 0);const a=()=>t()?Ie[t().origin.name]:void 0,r=()=>{var l;return t()&&(t().origin.cardId??!1)?`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=2&cid=${t().origin.cardId}`:`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=1&sess=1&rp=10&mode=&sort=1&keyword=${(l=a())==null?void 0:l.name}&stype=1&ctype=&othercon=2&starfr=&starto=&pscalefr=&pscaleto=&linkmarkerfr=&linkmarkerto=&link_m=2&atkfr=&atkto=&deffr=&defto=&releaseDStart=1&releaseMStart=1&releaseYStart=1999&releaseDEnd=&releaseMEnd=&releaseYEnd=`};let n=De(e,"mode",12,"Normal");ot();var s=Be(),o=le(s);{var u=l=>{var c=eu();c.__contextmenu=[Fd,n];var v=g(c),f=g(v),h=g(f),y=g(h),b=_(f,2),m=g(b),S=g(m),E=_(m,2),F=g(E),q=_(b,2);{var T=ie=>{var B=$d(),W=le(B);{var fe=oe=>{var N=Bd(),H=le(N),L=g(H),G=g(L),z=g(G),Y=_(H,2),X=g(Y),J=g(X),te=_(X,2),I=g(te);A(()=>{k(z,Ie[t().origin.name].pendulumDescription),k(J,`◀ ${t().psL??""}`),k(I,`${t().psR??""} ▶`)}),w(oe,N)};j(W,oe=>{var N;(N=t().status.monsterCategories)!=null&&N.includes("Pendulum")&&oe(fe)})}var D=_(W,2);{var U=oe=>{var N=Ld(),H=le(N),L=g(H);ue(L,1,()=>t().attr,de,(Y,X)=>{var J=Od(),te=le(J),I=_(te,2),R=g(I);A(()=>{ye(te,`monster_attr ${p(X)??""} svelte-nn7bjy`),k(R,`${mr[p(X)]??""}属性`)}),w(Y,J)});var G=_(L,2);ue(G,1,()=>t().types,de,(Y,X)=>{var J=Nd(),te=g(J);A(()=>{ye(J,`monster_cat ${p(X)??""} svelte-nn7bjy`),k(te,`${Gi[p(X)]??""}${Ca[p(X)]??""}族`)}),w(Y,J)});var z=_(H,2);ue(z,5,()=>t().status.monsterCategories??[],de,(Y,X)=>{var J=qd(),te=g(J);A(()=>{ye(J,`monster_cat ${p(X)??""} svelte-nn7bjy`),k(te,`${ji[p(X)]??""}${wa[p(X)]??""}`)}),w(Y,J)}),w(oe,N)},ee=oe=>{var N=Be(),H=le(N);{var L=z=>{var Y=Rd(),X=_(g(Y),2),J=g(X);A(()=>k(J,`${Ui[t().status.spellCategory]??""}魔法`)),w(z,Y)},G=z=>{var Y=Be(),X=le(Y);{var J=te=>{var I=Hd(),R=_(g(I),2),$=g(R);A(()=>k($,`${Zi[t().status.trapCategory]??""}罠`)),w(te,I)};j(X,te=>{t().status.kind==="Trap"&&t().status.trapCategory&&te(J)},!0)}w(z,Y)};j(H,z=>{t().status.kind==="Spell"&&t().status.spellCategory?z(L):z(G,!1)},!0)}w(oe,N)};j(D,oe=>{t().status.kind==="Monster"?oe(U):oe(ee,!1)})}w(ie,B)};j(q,ie=>{n()==="Normal"&&ie(T)})}var x=_(v,2),Z=g(x);{var M=ie=>{var B=jd(),W=g(B),fe=g(W),D=g(fe);A(U=>k(D,U),[()=>{var U;return(U=a())==null?void 0:U.description}],ge),w(ie,B)},re=ie=>{var B=Qd(),W=g(B),fe=g(W);fe.textContent='"info" :{';var D=_(fe,2);ue(D,1,()=>Object.entries(t().info),de,(Te,Ee)=>{let Fe=()=>p(Ee)[0],Ze=()=>p(Ee)[1];var Ye=Ud(),ai=g(Ye);A(yt=>k(ai,`"${Fe()??""}" :${yt??""},`),[()=>{var yt;return(yt=Ze())==null?void 0:yt.toString()}],ge),w(Te,Ye)});var U=_(D,2);U.textContent="},";var ee=_(U,2);ee.textContent='"status" :{';var oe=_(ee,2);ue(oe,1,()=>Object.entries(t().status),de,(Te,Ee)=>{let Fe=()=>p(Ee)[0],Ze=()=>p(Ee)[1];var Ye=Zd(),ai=g(Ye);A(yt=>k(ai,`"${Fe()??""}" :${yt??""},`),[()=>{var yt;return(yt=Ze())==null?void 0:yt.toString()}],ge),w(Te,Ye)});var N=_(oe,2);N.textContent="},";var H=_(N,2);H.textContent='"actions" :[';var L=_(H,2);ue(L,1,()=>t().actions,de,(Te,Ee)=>{var Fe=Gd(),Ze=g(Fe);A(()=>k(Ze,`"${p(Ee).playType??""} ${p(Ee).title??""}",`)),w(Te,Fe)});var G=_(L,2);G.textContent="],";var z=_(G,2);z.textContent='"substituteEffects" :[';var Y=_(z,2);ue(Y,1,()=>t().substituteEffects,de,(Te,Ee)=>{var Fe=zd(),Ze=g(Fe);A(()=>k(Ze,`"${p(Ee).title??""}",`)),w(Te,Fe)});var X=_(Y,2);X.textContent="],";var J=_(X,2);J.textContent='"continuousEffects" :[';var te=_(J,2);ue(te,1,()=>t().continuousEffects,de,(Te,Ee)=>{var Fe=Vd(),Ze=g(Fe);A(()=>k(Ze,`"${p(Ee).isStarted??""}",`)),w(Te,Fe)});var I=_(te,2);I.textContent="],";var R=_(I,2);R.textContent='"procFilters" :[';var $=_(R,2);ue($,1,()=>t().procFilterBundle.operators,de,(Te,Ee)=>{var Fe=Wd(),Ze=g(Fe);A(Ye=>k(Ze,`"${Ye??""} ${p(Ee).title??""}",`),[()=>p(Ee).isSpawnedBy.toString()],ge),w(Te,Fe)});var ce=_($,2);ce.textContent="],";var K=_(ce,2);K.textContent='"cardRelations" :[';var ve=_(K,2);ue(ve,1,()=>t().cardRelationBundle.operators,de,(Te,Ee)=>{var Fe=Yd(),Ze=g(Fe);A(Ye=>k(Ze,`"${Ye??""} ${p(Ee).title??""}",`),[()=>p(Ee).isSpawnedBy.toString()],ge),w(Te,Fe)});var we=_(ve,2);we.textContent="],";var Oe=_(we,2);Oe.textContent='"numericStateOperators" :[';var Pe=_(Oe,2);ue(Pe,1,()=>t().numericOprsBundle.operators,de,(Te,Ee)=>{var Fe=Xd(),Ze=g(Fe);A(Ye=>k(Ze,`"${Ye??""} ${p(Ee).title??""}",`),[()=>p(Ee).isSpawnedBy.toString()],ge),w(Te,Fe)});var P=_(Pe,2);P.textContent="],";var O=_(P,2);O.textContent='"stateOperators" :[';var he=_(O,2);ue(he,1,()=>t().statusOperatorBundle.operators,de,(Te,Ee)=>{var Fe=Kd(),Ze=g(Fe);A(Ye=>k(Ze,`"${Ye??""} ${p(Ee).title??""}",`),[()=>p(Ee).isSpawnedBy.toString()],ge),w(Te,Fe)});var se=_(he,2);se.textContent="],";var _e=_(se,2);_e.textContent='"lastMoveLogRecord" :{';var Me=_(_e,2),He=g(Me),at=_(Me,2),tt=g(at),rt=_(at,2),Et=g(rt),nt=_(rt,2);nt.textContent="},",A((Te,Ee)=>{k(He,`"movedBy":"${Te??""}",`),k(tt,`"movedAs":"${Ee??""}",`),k(Et,`"movedAt":"${t().moveLog.latestRecord.movedAt??""}",`)},[()=>{var Te;return(Te=t().moveLog.latestRecord.movedBy)==null?void 0:Te.toString()},()=>t().moveLog.latestRecord.movedAs.join(" ")],ge),w(ie,B)};j(Z,ie=>{n()==="Normal"?ie(M):ie(re,!1)})}var V=_(x,2),ne=g(V);{var xe=ie=>{var B=Jd();w(ie,B)},Re=ie=>{var B=Id(),W=g(B),fe=_(W,2),D=g(fe);A(U=>{var ee;Bt(W,"href",`https://yugioh-wiki.net/index.php?${t().origin.wikiEncodedName}`),Bt(fe,"href",U),k(D,`⇒${((ee=t())!=null&&ee.origin.cardId?"公式カードページ":"公式で検索")??""}`)},[r],ge),w(ie,B)};j(ne,ie=>{var B;(B=t())!=null&&B.origin.isForTest?ie(xe):ie(Re,!1)})}A((ie,B,W)=>{ye(c,`duel_card duel_card_info ${t().origin.kind??""} ${ie??""} svelte-nn7bjy`),k(y,t().nm),k(S,B),k(F,W)},[()=>{var ie;return(ie=t().origin.monsterCategories)==null?void 0:ie.join(" ")},()=>"★".repeat(t().lvl||0),()=>"☆".repeat(t().rank||0)],ge),w(l,c)};j(o,l=>{t()&&l(u)})}w(i,s),We()}$i(["contextmenu"]);var iu=C('<div class="duel_field_cell_info_item svelte-1xj7qf1"><!></div>'),au=C('<div class="duel_field_cell_info_box svelte-1xj7qf1"><div class="duel_field_cell_info_label svelte-1xj7qf1"> </div> <!></div>'),ru=C('<div class="duel_field_cell_info svelte-1xj7qf1"><div class="duel_field_cell_info_header item_btn svelte-1xj7qf1"><div class="svelte-1xj7qf1"> </div> <div class="svelte-1xj7qf1"> </div></div> <div class="duel_field_cell_info_body svelte-1xj7qf1"></div></div>');function nu(i,e){Ve(e,!1);let t=De(e,"cell",12);const a=()=>{t(t())},r=f=>t().cardEntities.filter(h=>h.face===f);t().field.duel.view.onDuelUpdate.append(a),ot();var n=ru(),s=g(n),o=g(s),u=g(o),l=_(o,2),c=g(l),v=_(s,2);ue(v,4,()=>["FaceUp","FaceDown"],de,(f,h)=>{var y=Be(),b=le(y);{var m=S=>{var E=au(),F=g(E),q=g(F),T=_(F,2);ue(T,1,()=>r(h).toSorted(Vn),de,(x,Z)=>{var M=iu(),re=g(M);const V=ge(()=>t().owner===t().field.duel.duelists.Below);At(re,{get entity(){return p(Z)},get isVisibleForcibly(){return p(V)},isWideMode:!0,cardActionResolve:void 0}),w(x,M)}),A(()=>k(q,h==="FaceUp"?"表向き":"裏向き")),w(S,E)};j(b,S=>{r(h).length&&S(m)})}w(f,y)}),A(()=>{var f;k(u,(f=t().owner)==null?void 0:f.profile.name),k(c,t().cellType)}),w(i,n),We()}const su=Mc({duration:400});var lu=C('<div class="duel_field_header_message svelte-accyye"> </div> <div class="duel_field_header_buttons svelte-accyye"><button class="svelte-accyye">サレンダー</button></div>',1),ou=C("<tr></tr>"),cu=C('<table class="duel_field svelte-accyye"><tbody class="svelte-accyye"></tbody></table>'),du=C('<button class="svelte-accyye">OK</button>'),uu=C('<div class="flex duel_desk svelte-accyye"><div class="duel_desk_left v_flex svelte-accyye"><!> <!> <!></div> <div class=" duel_desk_center v_flex svelte-accyye"><div class="duel_field_header svelte-accyye"><!></div> <div class="svelte-accyye"><!></div> <div class="duel_field_footer svelte-accyye"><!></div></div> <div class=" duel_desk_right svelte-accyye" style="text-align: left;"><!></div></div> <div style="position:absolute;left:0;bottom:0"> </div> <!>',1);function vu(i,e){Ve(e,!1);let t=De(e,"duel",12),a=()=>{},r=Ne(()=>!0),n=Ne([]);const s=N=>{a=N.resolve,Q(r,N.entitiesValidator),Q(n,N.selectableEntities),N.duelEntitiesSelectorArg&&t().view.modalController.selectDuelEntities(N.duelEntitiesSelectorArg).then(H=>{a({selectedEntities:H})})};t().view.onWaitStart.append(s);const o=()=>{a=()=>{},Q(r,()=>!0),Q(n,[])};t().view.onWaitEnd.append(o);let u=Ne(void 0),l=Ne("Normal");const c=({card:N,mode:H})=>{Q(u,N),Q(l,H)};t().view.onShowCardEntity.append(c);let v=De(e,"selectedList",28,()=>[]);const f=()=>{t(t())};t().view.onDuelUpdate.append(f),t().log.onUpdate.append(f);const h=()=>{p(r)(v())&&a({selectedEntities:v()})},y=()=>{a({surrender:!0})};t().main(),ot();var b=uu(),m=le(b),S=g(m),E=g(S);Xr(E,{get duelist(){return t().duelists.Above}});var F=_(E,2);tu(F,{get entity(){return p(u)},get mode(){return p(l)}});var q=_(F,2);Xr(q,{get duelist(){return t().duelists.Below}});var T=_(S,2),x=g(T),Z=g(x);{var M=N=>{var H=lu(),L=le(H),G=g(L),z=_(L,2),Y=g(z);A(()=>k(G,`[TURN:${t().clock.turn}][PHASE:${t().phase}] ${t().view.message}`)),$e("click",Y,y),w(N,H)};j(Z,N=>{t().isEnded||N(M)})}var re=_(x,2),V=g(re);{var ne=N=>{var H=cu(),L=g(H);ue(L,5,()=>t().field.cells,de,(G,z,Y)=>{var X=ou();ye(X,`${`duel_desk_row_${Y}`??""} svelte-accyye`),ue(X,5,()=>p(z),de,(J,te,I)=>{rd(J,{get view(){return t().view},row:Y,column:I,get selectedList(){return v()},set selectedList(R){v(R)},$$legacy:!0})}),w(G,X)}),w(N,H)};j(V,N=>{t().clock.turn>0&&N(ne)})}var xe=_(re,2),Re=g(xe);{var ie=N=>{var H=du();A(L=>H.disabled=L,[()=>!p(r)(v())],ge),$e("click",H,h),w(N,H)};j(Re,N=>{p(n)&&p(n).length>0&&N(ie)})}var B=_(T,2),W=g(B);{var fe=N=>{ld(N,{get log(){return t().log}})},D=N=>{var H=Be(),L=le(H);{var G=z=>{nu(z,{get cell(){return t().view.infoBoardCell}})};j(L,z=>{t().view.infoBoardState==="CellInfo"&&z(G)},!0)}w(N,H)};j(W,N=>{t().view.infoBoardState==="Log"?N(fe):N(D,!1)})}var U=_(m,2),ee=g(U),oe=_(U,2);Pd(oe,{get modalController(){return t().view.modalController}}),A(N=>k(ee,N),[()=>t().clock.toString()],ge),w(i,b),We()}var fu=C("<div></div>"),pu=C('<span> </span> / <span style="display: inline-block;width:2rem;text-align: right;"> </span>',1),hu=C('<li class="deck_editor_item svelte-vivzk2"><div role="listitem"><div class="svelte-vivzk2"><div class="svelte-vivzk2"> </div> <div style="display:flex" class="svelte-vivzk2"><div class="svelte-vivzk2"><!> <!> <!> <!> <!> <!> <!></div> <div style="flex-grow: 1; width:0.1rem" class="svelte-vivzk2"></div> <div class="svelte-vivzk2"><!></div></div></div></div> <button class="button_style_reset svelte-vivzk2" title="※shiftキー同時押しで一括投入">+</button> <button class="button_style_reset svelte-vivzk2" title="※shiftキー同時押しで一括外し">-</button></li>'),gu=C('<div class="deck_editor_card_kind svelte-vivzk2"><span class="svelte-vivzk2"> </span> <ul class="svelte-vivzk2"></ul></div>'),yu=C('<div class="deck_editor_deck_type svelte-vivzk2"><span class="svelte-vivzk2"> </span> <!></div>'),mu=C('<div class="deck_editor_card_list svelte-vivzk2"></div>');function Kr(i,e){Ve(e,!1);let t=De(e,"allCardInfos",8),a=De(e,"deckCardInfos",12),r=De(e,"mode",8),n=De(e,"onAttention",8);const s={Deck:["Monster","Spell","Trap"],ExtraDeck:["Monster"]},o=(v,f)=>(r()==="List"?t():a()).filter(h=>{var y;return rr.has(h.name)||((y=h.monsterCategories)==null?void 0:y.includes("Normal"))}).filter(h=>!f||h.kind===f).filter(h=>{var y,b;return!v||v==="Deck"&&!((y=h==null?void 0:h.monsterCategories)!=null&&y.union(_i).length)||v==="ExtraDeck"&&((b=h==null?void 0:h.monsterCategories)==null?void 0:b.union(_i).length)}),u=(v,f)=>{const h=a().filter(b=>b.name===f.name).length;if(h>2)return;const y=v.shiftKey?3-h:1;y<1||(a().push(...Array(y).fill(f)),a().sort(Mi),a(a()))},l=(v,f)=>{let h=0;a(a().filter(y=>y.name!==f.name?!0:(h++,!v.shiftKey&&h>1))),a().sort(Mi)};ot();var c=mu();ue(c,5,()=>Ol,de,(v,f)=>{var h=yu(),y=g(h),b=g(y),m=_(y,2);ue(m,1,()=>s[p(f)],de,(S,E)=>{var F=gu(),q=g(F),T=g(q),x=_(q,2);ue(x,5,()=>o(p(f),p(E)).toSorted(Mi),de,(Z,M)=>{var re=hu(),V=g(re),ne=g(V),xe=g(ne),Re=g(xe),ie=_(xe,2),B=g(ie),W=g(B);{var fe=R=>{var $=Yt();A(()=>k($,`★${p(M).level??""}`)),w(R,$)};j(W,R=>{p(M).level&&R(fe)})}var D=_(W,2);{var U=R=>{var $=Yt();A(()=>k($,`☆${p(M).rank??""}`)),w(R,$)};j(D,R=>{p(M).rank&&R(U)})}var ee=_(D,2);ue(ee,1,()=>p(M).attributes??[],de,(R,$)=>{var ce=fu();A(()=>ye(ce,`monster_attr ${p($)??""} svelte-vivzk2`)),w(R,ce)});var oe=_(ee,2);ue(oe,1,()=>p(M).types??[],de,(R,$)=>{var ce=Yt();A(()=>k(ce,Gi[p($)])),w(R,ce)});var N=_(oe,2);ue(N,1,()=>p(M).monsterCategories??[],de,(R,$)=>{var ce=Yt();A(()=>k(ce,ji[p($)])),w(R,ce)});var H=_(N,2);{var L=R=>{var $=Yt();A(()=>k($,`${Ui[p(M).spellCategory]??""}魔法`)),w(R,$)};j(H,R=>{p(M).spellCategory!==void 0&&R(L)})}var G=_(H,2);{var z=R=>{var $=Yt();A(()=>k($,`${Zi[p(M).trapCategory]??""}罠`)),w(R,$)};j(G,R=>{p(M).trapCategory!==void 0&&R(z)})}var Y=_(B,4),X=g(Y);{var J=R=>{var $=pu(),ce=le($),K=g(ce),ve=_(ce,2),we=g(ve);A(()=>{k(K,p(M).attack??"?"),k(we,p(M).defense??"?")}),w(R,$)};j(X,R=>{p(M).kind==="Monster"&&R(J)})}var te=_(V,2),I=_(te,2);A(R=>{ye(V,`${R??""} svelte-vivzk2`),k(Re,p(M).name)},[()=>{var R,$;return`deck_editor_card duel_card ${p(M).kind} ${($=(R=p(M))==null?void 0:R.monsterCategories)==null?void 0:$.join(" ")} ${rr.has(p(M).name)?"is_implemented":"is_not_implemented"}`}],ge),$e("mouseenter",V,()=>n()(p(M))),$e("click",te,R=>u(R,p(M))),$e("click",I,R=>l(R,p(M))),w(Z,re)}),A(Z=>k(T,`${Nn[p(E)]??""}（${Z??""}枚）`),[()=>o(p(f),p(E)).length],ge),w(S,F)}),A(S=>k(b,`${Nl[p(f)]??""}（${S??""}枚）`),[()=>o(p(f)).length],ge),w(v,h)}),w(i,c),We()}var _u=C('<div class="duel_card_info_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"><pre class="description svelte-1xf9hqi"> </pre></div></div> <div class="duel_card_info_row svelte-1xf9hqi" style=" justify-content: space-between;"><div class="svelte-1xf9hqi"> </div> <div class="svelte-1xf9hqi"> </div></div>',1),Su=C('<div></div> <div class="svelte-1xf9hqi"> </div>',1),bu=C("<div> </div>"),wu=C("<div> </div>"),Cu=C('<div class="duel_card_info_row svelte-1xf9hqi"><!> <!></div> <div class="duel_card_info_row svelte-1xf9hqi"></div>',1),Tu=C('<div class="duel_card_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"></div> <div class="svelte-1xf9hqi"> </div></div>'),ku=C('<div class="duel_card_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"></div> <div class="svelte-1xf9hqi"> </div></div>'),Eu=C('<div class="duel_card_info_row svelte-1xf9hqi"><div class="svelte-1xf9hqi">※テスト用カードです</div></div>'),Du=C('<div class="duel_card_info_links svelte-1xf9hqi"><a target="_blank" rel="noopener noreferrer" title="遊戯王カードWiki" class="svelte-1xf9hqi">⇒遊戯王カードWiki</a> <a target="_blank" rel="noopener noreferrer" title="コナミカードデータベース" class="svelte-1xf9hqi"> </a></div>'),Au=C('<div><div class="duel_card_info_header svelte-1xf9hqi"><div class="duel_card_info_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"> </div></div> <div class="duel_card_info_row svelte-1xf9hqi" style="position:sticky; top:0;"><div class="svelte-1xf9hqi"> </div> <div class="svelte-1xf9hqi"> </div></div></div> <div class="duel_card_info_body svelte-1xf9hqi"><!> <!> <div class="duel_card_info_row description svelte-1xf9hqi"><div class="svelte-1xf9hqi"><pre class="description svelte-1xf9hqi"> </pre></div></div> <!></div></div>');function xu(i,e){Ve(e,!1);let t=De(e,"cardInfo",8,void 0);const a=()=>t()?Ie[t().name]:void 0;ot();var r=Be(),n=le(r);{var s=o=>{var u=Au(),l=g(u),c=g(l),v=g(c),f=g(v),h=_(c,2),y=g(h),b=g(y),m=_(y,2),S=g(m),E=_(l,2),F=g(E);{var q=B=>{var W=_u(),fe=le(W),D=g(fe),U=g(D),ee=g(U),oe=_(fe,2),N=g(oe),H=g(N),L=_(N,2),G=g(L);A(()=>{k(ee,Ie[t().name].pendulumDescription),k(H,`◀ ${t().pendulumScaleL??""}`),k(G,`${t().pendulumScaleR??""} ▶`)}),w(B,W)};j(F,B=>{var W;(W=t().monsterCategories)!=null&&W.includes("Pendulum")&&B(q)})}var T=_(F,2);{var x=B=>{var W=Cu(),fe=le(W),D=g(fe);{var U=H=>{var L=Su(),G=le(L),z=_(G,2),Y=g(z);A(()=>{ye(G,`monster_attr ${t().attributes[0]??""} svelte-1xf9hqi`),k(Y,`${mr[t().attributes[0]]??""}属性`)}),w(H,L)};j(D,H=>{t().attributes&&H(U)})}var ee=_(D,2);{var oe=H=>{var L=bu(),G=g(L);A(()=>{ye(L,`monster_cat ${t().types[0]??""} svelte-1xf9hqi`),k(G,`${Gi[t().types[0]]??""}${Ca[t().types[0]]??""}族`)}),w(H,L)};j(ee,H=>{t().types&&H(oe)})}var N=_(fe,2);ue(N,5,()=>t().monsterCategories??[],de,(H,L)=>{var G=wu(),z=g(G);A(()=>{ye(G,`monster_cat ${p(L)??""} svelte-1xf9hqi`),k(z,`${ji[p(L)]??""}${wa[p(L)]??""}`)}),w(H,G)}),w(B,W)},Z=B=>{var W=Be(),fe=le(W);{var D=ee=>{var oe=Tu(),N=_(g(oe),2),H=g(N);A(()=>k(H,`${Ui[t().spellCategory]??""}魔法`)),w(ee,oe)},U=ee=>{var oe=Be(),N=le(oe);{var H=L=>{var G=ku(),z=_(g(G),2),Y=g(z);A(()=>k(Y,`${Zi[t().trapCategory]??""}罠`)),w(L,G)};j(N,L=>{t().kind==="Trap"&&t().trapCategory&&L(H)},!0)}w(ee,oe)};j(fe,ee=>{t().kind==="Spell"&&t().spellCategory?ee(D):ee(U,!1)},!0)}w(B,W)};j(T,B=>{t().kind==="Monster"?B(x):B(Z,!1)})}var M=_(T,2),re=g(M),V=g(re),ne=g(V),xe=_(M,2);{var Re=B=>{var W=Eu();w(B,W)},ie=B=>{var W=Du(),fe=g(W),D=_(fe,2),U=g(D);A(ee=>{Bt(fe,"href",`https://yugioh-wiki.net/index.php?${t().wikiEncodedName}`),Bt(D,"href",ee),k(U,`⇒${(t().cardId?"公式カードページ":"公式で検索")??""}`)},[()=>$l(t())],ge),w(B,W)};j(xe,B=>{t().isForTest?B(Re):B(ie,!1)})}A((B,W,fe,D)=>{ye(u,`duel_card duel_card_info ${t().kind??""} ${B??""} svelte-1xf9hqi`),k(f,t().name),k(b,W),k(S,fe),k(ne,D)},[()=>{var B;return(B=t().monsterCategories)==null?void 0:B.join(" ")},()=>"★".repeat(t().level||0),()=>"☆".repeat(t().rank||0),()=>{var B;return(B=a())==null?void 0:B.description}],ge),w(o,u)};j(n,o=>{t()&&o(s)})}w(i,r),We()}const Mu={0:{aaa:"日",aaaa:"日曜日",ddd:"Sun",dddd:"Sunday"},1:{aaa:"月",aaaa:"月曜日",ddd:"Mon",dddd:"Monday"},2:{aaa:"火",aaaa:"火曜日",ddd:"Tue",dddd:"Tuesday"},3:{aaa:"水",aaaa:"水曜日",ddd:"Wed",dddd:"Wednesday"},4:{aaa:"木",aaaa:"木曜日",ddd:"Thu",dddd:"Thursday"},5:{aaa:"金",aaaa:"金曜日",ddd:"Fri",dddd:"Friday"},6:{aaa:"土",aaaa:"土曜日",ddd:"Sat",dddd:"Saturday"}};class Pu{constructor(){d(this,"DefaultSeparator1","/");d(this,"DefaultSeparator2"," ");d(this,"DefaultSeparator3",":");d(this,"createDate",e=>{if(!e)return;const t=new Date(e);if(!isNaN(t.getTime()))return t});d(this,"createDateOr",(e,t)=>this.createDate(e)||t||new Date);d(this,"truncateDate",e=>{const t=e||new Date;return new Date(t.getFullYear(),t.getMonth(),t.getDate())});d(this,"addDate",(e,t)=>{const a=this.createDateOr(e);return a.setDate(a.getDate()+t),a});d(this,"addMonth",(e,t)=>{const a=this.createDateOr(e);return a.setMonth(a.getMonth()+t),a});d(this,"addYear",(e,t)=>{const a=this.createDateOr(e);return a.setFullYear(a.getFullYear()+t),a});d(this,"getDayOfWeek",(e,t="dddd")=>{const a=this.createDate(e);return a?Mu[a.getDay()][t]:""});d(this,"formatToYYYYMMDD",(e,t=this.DefaultSeparator1)=>{const a=this.createDate(e);if(!a)return"";const r=a.getFullYear().toString(),n=("0"+(a.getMonth()+1)).slice(-2),s=("0"+a.getDate()).slice(-2);return r+t+n+t+s});d(this,"formatToYYYYMM",(e,t=this.DefaultSeparator1)=>{const a=this.createDate(e);if(!a)return"";t||(t="");const r=a.getFullYear().toString(),n=("0"+(a.getMonth()+1)).slice(-2);return r+t+n});d(this,"formatToHHMMSS",(e,t=this.DefaultSeparator3)=>{const a=this.createDate(e);if(!a)return"";t||(t="");const r=a.getHours(),n=a.getMinutes(),s=a.getSeconds();return("0"+r).slice(-2)+t+("0"+n).slice(-2)+t+("0"+s).slice(-2)});d(this,"formatToHHMM",(e,t=this.DefaultSeparator3)=>{const a=this.createDate(e);if(!a)return"";t||(t="");const r=("0"+a.getHours()).slice(-2),n=("0"+a.getMinutes()).slice(-2);return r+t+n});d(this,"formatToYYYYMMDD_HHMM",(e,t=this.DefaultSeparator1,a=this.DefaultSeparator2,r=this.DefaultSeparator3)=>{const n=this.createDate(e);return n?this.formatToYYYYMMDD(n,t)+a+this.formatToHHMM(n,r):""});d(this,"formatToYYYYMMDD_HHMMSS",(e,t=this.DefaultSeparator1,a=this.DefaultSeparator2,r=this.DefaultSeparator3)=>{const n=this.createDate(e);return n?this.formatToYYYYMMDD(n,t)+a+this.formatToHHMMSS(n,r):""})}}const gt=new Pu;Date.prototype.truncateDate=function(){return gt.truncateDate(this)};Date.prototype.getCloneOr=function(i){return gt.createDateOr(this,i)};Date.prototype.addDate=function(i){return gt.addDate(this,i)};Date.prototype.addMonth=function(i){return gt.addDate(this,i)};Date.prototype.addYear=function(i){return gt.addDate(this,i)};Date.prototype.getDayOfWeek=function(i="dddd"){return gt.getDayOfWeek(this,i)};Date.prototype.formatToYYYYMM=function(i){return gt.formatToYYYYMM(this,i)};Date.prototype.formatToYYYYMMDD=function(i){return gt.formatToYYYYMMDD(this,i)};Date.prototype.formatToYYYYMMDD_HHMM=function(i,e,t){return gt.formatToYYYYMMDD_HHMM(this,i,e,t)};Date.prototype.formatToYYYYMMDD_HHMMSS=function(i,e,t){return gt.formatToYYYYMMDD_HHMMSS(this,i,e,t)};Date.prototype.formatToHHMM=function(i){return gt.formatToHHMM(this,i)};Date.prototype.formatToHHMMSS=function(i){return gt.formatToHHMMSS(this,i)};var Fu=C('<label><input type="checkbox"> </label>'),Bu=C('<label><input type="checkbox"> </label>'),Ou=C('<label><input type="checkbox"> <div style="display: inline-block;"></div> </label>'),Nu=C('<label><input type="checkbox"> </label>'),qu=C('<label><input type="checkbox"> </label>'),Lu=C('<label><input type="checkbox"> </label>'),Ru=C("<option> </option>"),Hu=C('<div class="svelte-b5thz2"><a class="white_button svelte-b5thz2" download="SVS_DeckInfos.json">ダウンロード</a></div>'),$u=C('<div class="svelte-b5thz2"></div>'),ju=C('<div class="svelte-b5thz2"><a class="white_button svelte-b5thz2" download="SVS_DeckInfos.json">ダウンロード（一括）</a></div>'),Uu=C('<div class="svelte-b5thz2"></div>'),Zu=C('<div class="deck_editor_body_right_header svelte-b5thz2"><div class="deck_editor_body_right_header_row svelte-b5thz2"><div class="svelte-b5thz2">編集対象 <select></select></div> <div class="svelte-b5thz2"></div> <div class="svelte-b5thz2">新規名称 <input type="text"></div></div> <div class="deck_editor_body_right_header_row svelte-b5thz2"></div> <div class="deck_editor_body_right_header_row svelte-b5thz2"><div class="svelte-b5thz2">基本操作</div> <div class="svelte-b5thz2"><button class="white_button svelte-b5thz2">デッキを保存</button></div> <div class="svelte-b5thz2"></div> <div class="svelte-b5thz2"><button class="white_button svelte-b5thz2">デッキを複製</button></div> <div class="svelte-b5thz2"><button class="white_button svelte-b5thz2" title="shiftキー押下で確認メッセージスキップ">デッキを削除</button></div></div> <div class="deck_editor_body_right_header_row svelte-b5thz2"><div class="svelte-b5thz2">DL/UL</div> <!> <!></div></div> <!>',1),Gu=C("<div>デッキ情報読込中</div>"),zu=C('<div class="deck_editor svelte-b5thz2"><div class="deck_editor_header"></div> <div class="deck_editor_body svelte-b5thz2"><div class="deck_editor_body_left svelte-b5thz2"><div class="deck_editor_search_box svelte-b5thz2"><div class="deck_editor_search_box_header svelte-b5thz2"><div>検索条件</div> <div><button class="white_button svelte-b5thz2">条件クリア</button></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">名称</div> <div class="svelte-b5thz2"><input type="text" style="width:70%">※ルビには対応していません</div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">種類</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">モンスター</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">属性</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">種族</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">魔法</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">罠</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">テスト用</div> <div class="svelte-b5thz2"><label><input type="checkbox"> テスト用カードを表示する</label></div></div></div> <!></div> <div class="deck_editor_body_center svelte-b5thz2"><!></div> <div class="deck_editor_body_right svelte-b5thz2"><!></div></div></div>');function Vu(i,e){Ve(e,!1);const t=[],a=[],r=[],n=[],s=[],o=[],u=async()=>{je(S,p(S).name=""),je(S,p(S).cardKinds=[]),je(S,p(S).monsterCategories=[]),je(S,p(S).monsterAttributes=[]),je(S,p(S).monsterTypes=[]),je(S,p(S).spellCategories=[]),je(S,p(S).trapCategories=[]),je(S,p(S).isForTest=!1)},l=async()=>{const O=(await p(f)).find(he=>he.id===p(v));O&&Q(b,{...O,cardInfos:O.cardNames.map(he=>Ie[he])})},c=()=>bt.getAllDeckInfo().then(P=>(P.forEach(O=>console.log(O.id,O.lastUsedAt,O.lastUsedAt.getTime())),console.log(Math.max(...P.map(O=>O.lastUsedAt.getTime()))),Q(v,(P.find(O=>O.lastUsedAt.getTime()===Math.max(...P.map(he=>he.lastUsedAt.getTime())))??P[0]).id),P));let v=Ne(-1),f=Ne(c()),h=Ne(p(f).then(P=>bt.convertToObjectURL(P)));p(f).then(l);const y=()=>{Q(f,c()),Q(h,p(f).then(P=>bt.convertToObjectURL(P))),l()};let b=Ne({id:-Number.MAX_VALUE,name:"",description:"",lastUsedAt:new Date,cardInfos:[]}),m=Ne(Ie.ゾンビーノ);const S=Ne({name:"",cardKinds:[...Va],monsterCategories:[...Nr].filter(P=>P!=="Normal"&&P!=="Token"),monsterAttributes:[...qr],monsterTypes:[...Lr],spellCategories:[...Rr],trapCategories:[...Hr],isForTest:!1}),E=()=>Object.values(Ie).filter(P=>{if(!p(S).cardKinds.includes(P.kind)||p(S).name.trim().length&&!P.name.includes(p(S).name)||P.isForTest&&!p(S).isForTest)return!1;if(P.kind==="Monster")return P.attributes&&!p(S).monsterAttributes.union(P.attributes).length||P.types&&!p(S).monsterTypes.union(P.types).length||!P.monsterCategories?!1:P.monsterCategories.union(p(S).monsterCategories).length;if(P.kind==="Spell")return P.spellCategory&&p(S).spellCategories.includes(P.spellCategory);if(P.kind==="Trap")return P.trapCategory&&p(S).trapCategories.includes(P.trapCategory)}),F=P=>{Q(m,P)},q=async()=>{const O=(await p(f)).find(he=>he.id===p(v));if(!O)throw new Error("illegal state");return O},T=async()=>{const P=await q();await P.saveDeckInfo({...P,name:p(b).name,cardNames:p(b).cardInfos.map(O=>O.name),lastUsedAt:new Date}),y()},x=async()=>{(await bt.createNewDeck(`デッキ_${new Date().formatToYYYYMMDD_HHMMSS("","","")}`,`コピー日時：${new Date().formatToYYYYMMDD_HHMMSS("-"," ",":")}`,p(b).cardInfos.map(O=>O.name))).saveDeckInfo(),y()},Z=async P=>{const O=await q();!P.shiftKey&&!confirm(`デッキ【${O.name}】を削除します。
よろしいですか？`)||(await O.delete(),y())};ot();var M=zu(),re=_(g(M),2),V=g(re),ne=g(V),xe=g(ne),Re=_(g(xe),2),ie=g(Re),B=_(xe,2),W=_(g(B),2),fe=g(W),D=_(B,2),U=_(g(D),2);ue(U,5,()=>Va.filter(P=>P!=="XyzMaterial"),de,(P,O)=>{var he=Fu(),se=g(he),_e,Me=_(se);A(()=>{_e!==(_e=p(O))&&(se.value=(se.__value=p(O))==null?"":p(O)),k(Me,` ${Nn[p(O)]??""}`)}),oi(t,[],se,()=>(p(O),p(S).cardKinds),He=>je(S,p(S).cardKinds=He)),w(P,he)});var ee=_(D,2),oe=_(g(ee),2);ue(oe,5,()=>Nr,de,(P,O)=>{var he=Bu(),se=g(he),_e,Me=_(se);A(()=>{_e!==(_e=p(O))&&(se.value=(se.__value=p(O))==null?"":p(O)),k(Me,` ${ji[p(O)]??""}${wa[p(O)]??""}`)}),oi(a,[],se,()=>(p(O),p(S).monsterCategories),He=>je(S,p(S).monsterCategories=He)),w(P,he)});var N=_(ee,2),H=_(g(N),2);ue(H,5,()=>qr,de,(P,O)=>{var he=Ou(),se=g(he),_e,Me=_(se,2),He=_(Me);A(()=>{_e!==(_e=p(O))&&(se.value=(se.__value=p(O))==null?"":p(O)),ye(Me,`monster_attr ${p(O)??""} svelte-b5thz2`),k(He,` ${mr[p(O)]??""}`)}),oi(r,[],se,()=>(p(O),p(S).monsterAttributes),at=>je(S,p(S).monsterAttributes=at)),w(P,he)});var L=_(N,2),G=_(g(L),2);ue(G,5,()=>Lr,de,(P,O)=>{var he=Nu(),se=g(he),_e,Me=_(se);A(()=>{_e!==(_e=p(O))&&(se.value=(se.__value=p(O))==null?"":p(O)),k(Me,` ${Gi[p(O)]??""}
                ${Ca[p(O)]??""}`)}),oi(n,[],se,()=>(p(O),p(S).monsterTypes),He=>je(S,p(S).monsterTypes=He)),w(P,he)});var z=_(L,2),Y=_(g(z),2);ue(Y,5,()=>Rr,de,(P,O)=>{var he=qu(),se=g(he),_e,Me=_(se);A(()=>{_e!==(_e=p(O))&&(se.value=(se.__value=p(O))==null?"":p(O)),k(Me,` ${Ui[p(O)]??""}`)}),oi(s,[],se,()=>(p(O),p(S).spellCategories),He=>je(S,p(S).spellCategories=He)),w(P,he)});var X=_(z,2),J=_(g(X),2);ue(J,5,()=>Hr,de,(P,O)=>{var he=Lu(),se=g(he),_e,Me=_(se);A(()=>{_e!==(_e=p(O))&&(se.value=(se.__value=p(O))==null?"":p(O)),k(Me,` ${Zi[p(O)]??""}`)}),oi(o,[],se,()=>(p(O),p(S).trapCategories),He=>je(S,p(S).trapCategories=He)),w(P,he)});var te=_(X,2),I=_(g(te),2),R=g(I),$=g(R),ce=_(ne,2);xu(ce,{get cardInfo(){return p(m)}});var K=_(V,2),ve=g(K);const we=ge(E);Kr(ve,{mode:"List",get allCardInfos(){return p(we)},onAttention:F,get deckCardInfos(){return p(b).cardInfos},set deckCardInfos(P){je(b,p(b).cardInfos=P)},$$legacy:!0});var Oe=_(K,2),Pe=g(Oe);Di(Pe,()=>p(f),P=>{var O=Gu();w(P,O)},(P,O)=>{var he=Zu(),se=le(he),_e=g(se),Me=g(_e),He=_(g(Me));A(()=>{p(v),Qi(()=>{p(O)})}),ue(He,5,()=>p(O),de,(Xe,ct)=>{var St=Ru(),ri={},Da=g(St);A(()=>{ri!==(ri=p(ct).id)&&(St.value=(St.__value=p(ct).id)==null?"":p(ct).id),k(Da,p(ct).name)}),w(Xe,St)});var at=_(Me,4),tt=_(g(at)),rt=_(_e,4),Et=_(g(rt),2),nt=g(Et),Te=_(Et,4),Ee=g(Te),Fe=_(Te,2),Ze=g(Fe),Ye=_(rt,2),ai=_(g(Ye),2);Di(ai,q,Xe=>{var ct=$u();w(Xe,ct)},(Xe,ct)=>{var St=Hu(),ri=g(St);A(Da=>Bt(ri,"href",Da),[()=>bt.convertToObjectURL([p(ct)])],ge),w(Xe,St)});var yt=_(ai,2);Di(yt,()=>p(h),Xe=>{var ct=Uu();w(Xe,ct)},(Xe,ct)=>{var St=ju(),ri=g(St);A(()=>Bt(ri,"href",p(ct))),w(Xe,St)});var Qn=_(se,2);Kr(Qn,{mode:"Deck",allCardInfos:[],onAttention:F,get deckCardInfos(){return p(b).cardInfos},set deckCardInfos(Xe){je(b,p(b).cardInfos=Xe)},$$legacy:!0}),Ji(He,()=>p(v),Xe=>Q(v,Xe)),$e("change",He,l),Ua(tt,()=>p(b).name,Xe=>je(b,p(b).name=Xe)),$e("click",nt,T),$e("click",Ee,x),$e("click",Ze,Z),w(P,he)}),$e("click",ie,u),Ua(fe,()=>p(S).name,P=>je(S,p(S).name=P)),bl($,()=>p(S).isForTest,P=>je(S,p(S).isForTest=P)),w(i,M),We()}const Wu="2025-04-08 22:32:01",Yu={timestamp:Wu},Xu=["TblDeckHeader","TblDeckDetail","TblDuelistProfile"],Ku=3;var Qu=C("<option> </option>"),Ju=C("<option> </option>"),Iu=C("<option> </option>"),ev=C('<div class="svelte-1vi4vvn"><label for="deck_selector" class="deck_selector svelte-1vi4vvn">デッキ：</label> <select id="deck_selector" class="deck_selector svelte-1vi4vvn"></select></div> <div class="svelte-1vi4vvn"><label for="npc_selector" class="npc_selector svelte-1vi4vvn">対戦相手：</label> <select id="npc_selector" class="npc_selector svelte-1vi4vvn"></select> <div> </div></div> <div class="svelte-1vi4vvn"><label for="npc_selector" class="npc_selector svelte-1vi4vvn">先攻後攻：</label> <select id="npc_selector" class="npc_selector svelte-1vi4vvn"></select></div> <div class="svelte-1vi4vvn"><button class="btn svelte-1vi4vvn">duel start!</button></div>',1),tv=C('<div class="svelte-1vi4vvn">デッキ情報の読み込み、もしくは作成中...</div>'),iv=C('<div class="svelte-1vi4vvn"><label for="duelist_name" class="duelist_name svelte-1vi4vvn">名前：</label> <input id="duelist_name" class="duelist_name svelte-1vi4vvn" type="text"></div> <!> <div class="svelte-1vi4vvn"><button class="btn svelte-1vi4vvn">deck edit</button></div>',1),av=C('<div class="svelte-1vi4vvn">デュエリスト情報の読み込み、もしくは作成中...</div>'),rv=C('<div class="app_body svelte-1vi4vvn"><!></div>'),nv=C('<main class="svelte-1vi4vvn"><div class="link link_left svelte-1vi4vvn"><a href="https://github.com/Setta238/stk_ygo_svelte" target="_blank" rel="noopener noreferrer" title="repository" class="svelte-1vi4vvn">repository</a> <a href="https://x.com/ninja_no" target="_blank" rel="noopener noreferrer" title="repository" class="svelte-1vi4vvn">X(Twitter)</a> <a href="https://posfie.com/@ninja_no/p/Lx7FLj3" target="_blank" rel="noopener noreferrer" title="posfie" class="svelte-1vi4vvn">posfie(toggeter)</a></div> <div class="link link_right svelte-1vi4vvn"><a href="/stk_ygo_svelte/note.html" target="_blank" rel="noopener noreferrer" title="repository" class="svelte-1vi4vvn">現時点とこの先のこと</a></div> <!> <div class="debug_info svelte-1vi4vvn"><span> </span> <span class="screen_info"></span></div></main>');function sv(i,e){Ve(e,!1);const t=new Fl("stk_ygo_svelte",Ku,Xu);let a=Ne(),r=Ne("None"),n=Ne(0);const s=za.getOrCreateNew(t);let o=Ne(bt.getAllDeckInfo(t).then(x=>(Promise.all(x.filter(Z=>!Z.lastUsedAt).map(Z=>{Z.saveDeckInfo()})),Q(n,(x.find(Z=>Z.lastUsedAt.getTime()===Math.max(...x.map(M=>M.lastUsedAt.getTime())))??x[0]).id),x)));const u=async()=>{let x=(await p(o)).find(Z=>Z.id===p(n));if(x||(x=(await c()).find(Z=>Z.id===p(n))),!x)throw new Error("illegal state");return x},l=async()=>{const x=await s;console.log(x),x.save()},c=()=>(Q(o,bt.getAllDeckInfo(t).then(x=>(Q(n,(x.find(Z=>Z.lastUsedAt.getTime()===Math.max(...x.map(M=>M.lastUsedAt.getTime())))??x[0]).id),x))),p(o)),v=async()=>{(await p(o)).length||(await bt.prepareSampleDeck(),c())},f=async()=>{await Promise.all([l(),v()]);const x=await u(),Z=await s;x.updateTimestamp();const M=xi.find(V=>V.id===Z.previousNpcId);let re=Wr.slice(-1)[0];M&&(M.id===-1&&(re=Wr.find(V=>V.id===-1)??re),console.log(M),Q(a,new Wo(Z,"Player",await u(),[],M,"NPC",re,[],Z.previousStartMode)))},h=async()=>{await Promise.all([l(),v()]),Q(r,"DeckEdit")},y=async x=>{await l(),x.key==="Enter"&&!x.repeat&&(await s).save()};v(),ot();var b=nv(),m=_(g(b),4);{var S=x=>{vu(x,{get duel(){return p(a)}})},E=x=>{var Z=Be(),M=le(Z);{var re=ne=>{Vu(ne,{})},V=ne=>{var xe=rv(),Re=g(xe);Di(Re,()=>s,ie=>{var B=av();w(ie,B)},(ie,B)=>{var W=iv(),fe=le(W),D=_(g(fe),2),U=_(fe,2);Di(U,()=>p(o),N=>{var H=tv();w(N,H)},(N,H)=>{var L=ev(),G=le(L),z=_(g(G),2);A(()=>{p(n),Qi(()=>{p(H)})}),ue(z,5,()=>p(H),de,(K,ve)=>{var we=Qu(),Oe={},Pe=g(we);A(()=>{Oe!==(Oe=p(ve).id)&&(we.value=(we.__value=p(ve).id)==null?"":p(ve).id),k(Pe,p(ve).name)}),w(K,we)});var Y=_(G,2),X=_(g(Y),2);A(()=>{p(B),Qi(()=>{})}),ue(X,5,()=>xi,de,(K,ve)=>{var we=Ju(),Oe={},Pe=g(we);A(()=>{Oe!==(Oe=p(ve).id)&&(we.value=(we.__value=p(ve).id)==null?"":p(ve).id),k(Pe,p(ve).name)}),w(K,we)});var J=_(X,2),te=g(J),I=_(Y,2),R=_(g(I),2);A(()=>{p(B),Qi(()=>{})}),ue(R,5,()=>Un(Vr),de,(K,ve)=>{var we=Iu(),Oe={},Pe=g(we);A(()=>{Oe!==(Oe=p(ve))&&(we.value=(we.__value=p(ve))==null?"":p(ve)),k(Pe,Vr[p(ve)])}),w(K,we)});var $=_(I,2),ce=g($);A(K=>k(te,`※${K??""}`),[()=>{var K;return(K=xi.find(ve=>ve.id===p(B).previousNpcId))==null?void 0:K.description}],ge),Ji(z,()=>p(n),K=>Q(n,K)),Ji(X,()=>p(B).previousNpcId,K=>p(B).previousNpcId=K),Ji(R,()=>p(B).previousStartMode,K=>p(B).previousStartMode=K),$e("click",ce,f),w(N,L)});var ee=_(U,2),oe=g(ee);Ua(D,()=>p(B).name,N=>p(B).name=N),$e("keypress",D,y),$e("click",oe,h),w(ie,W)}),w(ne,xe)};j(M,ne=>{p(r)==="DeckEdit"?ne(re):ne(V,!1)},!0)}w(x,Z)};j(m,x=>{p(a)?x(S):x(E,!1)})}var F=_(m,2),q=g(F),T=g(q);A(()=>k(T,`build at: ${Yu.timestamp}`)),w(i,b),We()}ll(sv,{target:document.getElementById("app")});
