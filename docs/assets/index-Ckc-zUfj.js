var ps=Object.defineProperty;var hs=(i,e,t)=>e in i?ps(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var u=(i,e,t)=>hs(i,typeof e!="symbol"?e+"":e,t);import{j as gs}from"./cardInfo.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();const Wa=!1;var pr=Array.isArray,ys=Array.prototype.indexOf,hr=Array.from,un=Object.defineProperty,_i=Object.getOwnPropertyDescriptor,dn=Object.getOwnPropertyDescriptors,ms=Object.prototype,_s=Array.prototype,gr=Object.getPrototypeOf;function Ss(i){return typeof i=="function"}const kt=()=>{};function Cs(i){return typeof(i==null?void 0:i.then)=="function"}function bs(i){return i()}function Ya(i){for(var e=0;e<i.length;e++)i[e]()}const _t=2,vn=4,Ta=8,ka=16,Rt=32,ji=64,la=128,mt=256,oa=512,nt=1024,Ht=2048,Di=4096,Lt=8192,Ea=16384,fn=32768,Da=65536,pn=1<<17,ws=1<<19,hn=1<<20,qt=Symbol("$state"),Ts=Symbol("legacy props"),ks=Symbol("");function gn(i){return i===this.v}function yn(i,e){return i!=i?e==e:i!==e||i!==null&&typeof i=="object"||typeof i=="function"}function yr(i){return!yn(i,this.v)}function Es(i){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Ds(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function xs(i){throw new Error("https://svelte.dev/e/effect_orphan")}function As(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Ms(i){throw new Error("https://svelte.dev/e/props_invalid_value")}function Ps(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Bs(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Fs(){throw new Error("https://svelte.dev/e/state_unsafe_local_read")}function Os(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let Ui=!1,Ls=!1;function qs(){Ui=!0}const mr=1,_r=2,mn=4,Ns=8,Rs=16,Hs=1,$s=2,Zs=4,js=8,Us=16,Gs=1,zs=2,Vs=4,Ws=1,Ys=2,Je=Symbol();let Qe=null;function ca(i){Qe=i}function Ie(i,e=!1,t){Qe={p:Qe,c:null,e:null,m:!1,s:i,x:null,l:null},Ui&&!e&&(Qe.l={s:null,u:null,r1:[],r2:it(!1)})}function et(i){const e=Qe;if(e!==null){const s=e.e;if(s!==null){var t=Fe,a=Le;e.e=null;try{for(var r=0;r<s.length;r++){var n=s[r];Ct(n.effect),St(n.reaction),Mi(n.fn)}}finally{Ct(t),St(a)}}Qe=e.p,e.m=!0}return{}}function xi(){return!Ui||Qe!==null&&Qe.l===null}function it(i,e){var t={f:0,v:i,reactions:null,equals:gn,rv:0,wv:0};return t}function Qs(i){return _n(it(i))}function wi(i,e=!1){var a;const t=it(i);return e||(t.equals=yr),Ui&&Qe!==null&&Qe.l!==null&&((a=Qe.l).s??(a.s=[])).push(t),t}function $e(i,e=!1){return _n(wi(i,e))}function _n(i){return Le!==null&&!At&&Le.f&_t&&(Mt===null?sl([i]):Mt.push(i)),i}function Ue(i,e){return K(i,Et(()=>f(i))),e}function K(i,e){return Le!==null&&!At&&xi()&&Le.f&(_t|ka)&&(Mt===null||!Mt.includes(i))&&Os(),zt(i,e)}function zt(i,e){return i.equals(e)||(i.v,i.v=e,i.wv=Nn(),Sn(i,Ht),xi()&&Fe!==null&&Fe.f&nt&&!(Fe.f&(Rt|ji))&&(Bt===null?ll([i]):Bt.push(i))),e}function Sn(i,e){var t=i.reactions;if(t!==null)for(var a=xi(),r=t.length,n=0;n<r;n++){var s=t[n],o=s.f;o&Ht||!a&&s===Fe||(Pt(s,e),o&(nt|mt)&&(o&_t?Sn(s,Di):Ba(s)))}}let Cn=!1;function jt(i,e=null,t){if(typeof i!="object"||i===null||qt in i)return i;const a=gr(i);if(a!==ms&&a!==_s)return i;var r=new Map,n=pr(i),s=it(0);n&&r.set("length",it(i.length));var o;return new Proxy(i,{defineProperty(d,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&Ps();var v=r.get(l);return v===void 0?(v=it(c.value),r.set(l,v)):K(v,jt(c.value,o)),!0},deleteProperty(d,l){var c=r.get(l);if(c===void 0)l in d&&r.set(l,it(Je));else{if(n&&typeof l=="string"){var v=r.get("length"),p=Number(l);Number.isInteger(p)&&p<v.v&&K(v,p)}K(c,Je),Or(s)}return!0},get(d,l,c){var m;if(l===qt)return i;var v=r.get(l),p=l in d;if(v===void 0&&(!p||(m=_i(d,l))!=null&&m.writable)&&(v=it(jt(p?d[l]:Je,o)),r.set(l,v)),v!==void 0){var h=f(v);return h===Je?void 0:h}return Reflect.get(d,l,c)},getOwnPropertyDescriptor(d,l){var c=Reflect.getOwnPropertyDescriptor(d,l);if(c&&"value"in c){var v=r.get(l);v&&(c.value=f(v))}else if(c===void 0){var p=r.get(l),h=p==null?void 0:p.v;if(p!==void 0&&h!==Je)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return c},has(d,l){var h;if(l===qt)return!0;var c=r.get(l),v=c!==void 0&&c.v!==Je||Reflect.has(d,l);if(c!==void 0||Fe!==null&&(!v||(h=_i(d,l))!=null&&h.writable)){c===void 0&&(c=it(v?jt(d[l],o):Je),r.set(l,c));var p=f(c);if(p===Je)return!1}return v},set(d,l,c,v){var P;var p=r.get(l),h=l in d;if(n&&l==="length")for(var m=c;m<p.v;m+=1){var C=r.get(m+"");C!==void 0?K(C,Je):m in d&&(C=it(Je),r.set(m+"",C))}p===void 0?(!h||(P=_i(d,l))!=null&&P.writable)&&(p=it(void 0),K(p,jt(c,o)),r.set(l,p)):(h=p.v!==Je,K(p,jt(c,o)));var y=Reflect.getOwnPropertyDescriptor(d,l);if(y!=null&&y.set&&y.set.call(v,c),!h){if(n&&typeof l=="string"){var S=r.get("length"),k=Number(l);Number.isInteger(k)&&k>=S.v&&K(S,k+1)}Or(s)}return!0},ownKeys(d){f(s);var l=Reflect.ownKeys(d).filter(p=>{var h=r.get(p);return h===void 0||h.v!==Je});for(var[c,v]of r)v.v!==Je&&!(c in d)&&l.push(c);return l},setPrototypeOf(){Bs()}})}function Or(i,e=1){K(i,i.v+e)}function Lr(i){return i!==null&&typeof i=="object"&&qt in i?i[qt]:i}function bn(i,e){return Object.is(Lr(i),Lr(e))}var qr,wn,Tn,kn;function Ks(){if(qr===void 0){qr=window,wn=/Firefox/.test(navigator.userAgent);var i=Element.prototype,e=Node.prototype;Tn=_i(e,"firstChild").get,kn=_i(e,"nextSibling").get,i.__click=void 0,i.__className="",i.__attributes=null,i.__styles=null,i.__e=void 0,Text.prototype.__t=void 0}}function xa(i=""){return document.createTextNode(i)}function ua(i){return Tn.call(i)}function Aa(i){return kn.call(i)}function g(i,e){return ua(i)}function se(i,e){{var t=ua(i);return t instanceof Comment&&t.data===""?Aa(t):t}}function _(i,e=1,t=!1){let a=i;for(;e--;)a=Aa(a);return a}function Xs(i){i.textContent=""}function ii(i){var e=_t|Ht,t=Le!==null&&Le.f&_t?Le:null;return Fe===null||t!==null&&t.f&mt?e|=mt:Fe.f|=hn,{ctx:Qe,deps:null,effects:null,equals:gn,f:e,fn:i,reactions:null,rv:0,v:null,wv:0,parent:t??Fe}}function Ce(i){const e=ii(i);return e.equals=yr,e}function En(i){var e=i.effects;if(e!==null){i.effects=null;for(var t=0;t<e.length;t+=1)Wt(e[t])}}function Js(i){for(var e=i.parent;e!==null;){if(!(e.f&_t))return e;e=e.parent}return null}function Is(i){var e,t=Fe;Ct(Js(i));try{En(i),e=Hn(i)}finally{Ct(t)}return e}function Dn(i){var e=Is(i),t=(Gt||i.f&mt)&&i.deps!==null?Di:nt;Pt(i,t),i.equals(e)||(i.v=e,i.wv=Nn())}function xn(i){Fe===null&&Le===null&&xs(),Le!==null&&Le.f&mt&&Fe===null&&Ds(),br&&Es()}function el(i,e){var t=e.last;t===null?e.last=e.first=i:(t.next=i,i.prev=t,e.last=i)}function Ai(i,e,t,a=!0){var r=(i&ji)!==0,n=Fe,s={ctx:Qe,deps:null,nodes_start:null,nodes_end:null,f:i|Ht,first:null,fn:e,last:null,next:null,parent:r?null:n,prev:null,teardown:null,transitions:null,wv:0};if(t){var o=Si;try{Rr(!0),wr(s),s.f|=fn}catch(c){throw Wt(s),c}finally{Rr(o)}}else e!==null&&Ba(s);var d=t&&s.deps===null&&s.first===null&&s.nodes_start===null&&s.teardown===null&&(s.f&(hn|la))===0;if(!d&&!r&&a&&(n!==null&&el(s,n),Le!==null&&Le.f&_t)){var l=Le;(l.effects??(l.effects=[])).push(s)}return s}function Sr(i){const e=Ai(Ta,null,!1);return Pt(e,nt),e.teardown=i,e}function Nr(i){xn();var e=Fe!==null&&(Fe.f&Rt)!==0&&Qe!==null&&!Qe.m;if(e){var t=Qe;(t.e??(t.e=[])).push({fn:i,effect:Fe,reaction:Le})}else{var a=Mi(i);return a}}function tl(i){return xn(),Gi(i)}function il(i){const e=Ai(ji,i,!0);return(t={})=>new Promise(a=>{t.outro?It(e,()=>{Wt(e),a(void 0)}):(Wt(e),a(void 0))})}function Mi(i){return Ai(vn,i,!1)}function Gi(i){return Ai(Ta,i,!0)}function x(i,e=[],t=ii){const a=e.map(t);return Ma(()=>i(...a.map(f)))}function Ma(i,e=0){return Ai(Ta|ka|e,i,!0)}function ai(i,e=!0){return Ai(Ta|Rt,i,!0,e)}function An(i){var e=i.teardown;if(e!==null){const t=br,a=Le;Hr(!0),St(null);try{e.call(null)}finally{Hr(t),St(a)}}}function Mn(i,e=!1){var t=i.first;for(i.first=i.last=null;t!==null;){var a=t.next;Wt(t,e),t=a}}function al(i){for(var e=i.first;e!==null;){var t=e.next;e.f&Rt||Wt(e),e=t}}function Wt(i,e=!0){var t=!1;if((e||i.f&ws)&&i.nodes_start!==null){for(var a=i.nodes_start,r=i.nodes_end;a!==null;){var n=a===r?null:Aa(a);a.remove(),a=n}t=!0}Mn(i,e&&!t),fa(i,0),Pt(i,Ea);var s=i.transitions;if(s!==null)for(const d of s)d.stop();An(i);var o=i.parent;o!==null&&o.first!==null&&Pn(i),i.next=i.prev=i.teardown=i.ctx=i.deps=i.fn=i.nodes_start=i.nodes_end=null}function Pn(i){var e=i.parent,t=i.prev,a=i.next;t!==null&&(t.next=a),a!==null&&(a.prev=t),e!==null&&(e.first===i&&(e.first=a),e.last===i&&(e.last=t))}function It(i,e){var t=[];Cr(i,t,!0),Bn(t,()=>{Wt(i),e&&e()})}function Bn(i,e){var t=i.length;if(t>0){var a=()=>--t||e();for(var r of i)r.out(a)}else e()}function Cr(i,e,t){if(!(i.f&Lt)){if(i.f^=Lt,i.transitions!==null)for(const s of i.transitions)(s.is_global||t)&&e.push(s);for(var a=i.first;a!==null;){var r=a.next,n=(a.f&Da)!==0||(a.f&Rt)!==0;Cr(a,e,n?t:!1),a=r}}}function Ti(i){Fn(i,!0)}function Fn(i,e){if(i.f&Lt){i.f^=Lt,i.f&nt||(i.f^=nt),zi(i)&&(Pt(i,Ht),Ba(i));for(var t=i.first;t!==null;){var a=t.next,r=(t.f&Da)!==0||(t.f&Rt)!==0;Fn(t,r?e:!1),t=a}if(i.transitions!==null)for(const n of i.transitions)(n.is_global||e)&&n.in()}}let da=!1,Qa=[];function On(){da=!1;const i=Qa.slice();Qa=[],Ya(i)}function ri(i){da||(da=!0,queueMicrotask(On)),Qa.push(i)}function rl(){da&&On()}const Ln=0,nl=1;let aa=!1,ra=Ln,$i=!1,Zi=null,Si=!1,br=!1;function Rr(i){Si=i}function Hr(i){br=i}let Jt=[],Ci=0;let Le=null,At=!1;function St(i){Le=i}let Fe=null;function Ct(i){Fe=i}let Mt=null;function sl(i){Mt=i}let at=null,dt=0,Bt=null;function ll(i){Bt=i}let qn=1,va=0,Gt=!1,Ut=null;function Nn(){return++qn}function zi(i){var v;var e=i.f;if(e&Ht)return!0;if(e&Di){var t=i.deps,a=(e&mt)!==0;if(t!==null){var r,n,s=(e&oa)!==0,o=a&&Fe!==null&&!Gt,d=t.length;if(s||o){var l=i,c=l.parent;for(r=0;r<d;r++)n=t[r],(s||!((v=n==null?void 0:n.reactions)!=null&&v.includes(l)))&&(n.reactions??(n.reactions=[])).push(l);s&&(l.f^=oa),o&&c!==null&&!(c.f&mt)&&(l.f^=mt)}for(r=0;r<d;r++)if(n=t[r],zi(n)&&Dn(n),n.wv>i.wv)return!0}(!a||Fe!==null&&!Gt)&&Pt(i,nt)}return!1}function ol(i,e){for(var t=e;t!==null;){if(t.f&la)try{t.fn(i);return}catch{t.f^=la}t=t.parent}throw aa=!1,i}function cl(i){return(i.f&Ea)===0&&(i.parent===null||(i.parent.f&la)===0)}function Pa(i,e,t,a){if(aa){if(t===null&&(aa=!1),cl(e))throw i;return}t!==null&&(aa=!0);{ol(i,e);return}}function Rn(i,e,t=!0){var a=i.reactions;if(a!==null)for(var r=0;r<a.length;r++){var n=a[r];n.f&_t?Rn(n,e,!1):e===n&&(t?Pt(n,Ht):n.f&nt&&Pt(n,Di),Ba(n))}}function Hn(i){var h;var e=at,t=dt,a=Bt,r=Le,n=Gt,s=Mt,o=Qe,d=At,l=i.f;at=null,dt=0,Bt=null,Le=l&(Rt|ji)?null:i,Gt=(l&mt)!==0&&(!Si||r===null||d),Mt=null,ca(i.ctx),At=!1,va++;try{var c=(0,i.fn)(),v=i.deps;if(at!==null){var p;if(fa(i,dt),v!==null&&dt>0)for(v.length=dt+at.length,p=0;p<at.length;p++)v[dt+p]=at[p];else i.deps=v=at;if(!Gt)for(p=dt;p<v.length;p++)((h=v[p]).reactions??(h.reactions=[])).push(i)}else v!==null&&dt<v.length&&(fa(i,dt),v.length=dt);if(xi()&&Bt!==null&&!At&&v!==null&&!(i.f&(_t|Di|Ht)))for(p=0;p<Bt.length;p++)Rn(Bt[p],i);return r!==null&&va++,c}finally{at=e,dt=t,Bt=a,Le=r,Gt=n,Mt=s,ca(o),At=d}}function ul(i,e){let t=e.reactions;if(t!==null){var a=ys.call(t,i);if(a!==-1){var r=t.length-1;r===0?t=e.reactions=null:(t[a]=t[r],t.pop())}}t===null&&e.f&_t&&(at===null||!at.includes(e))&&(Pt(e,Di),e.f&(mt|oa)||(e.f^=oa),En(e),fa(e,0))}function fa(i,e){var t=i.deps;if(t!==null)for(var a=e;a<t.length;a++)ul(i,t[a])}function wr(i){var e=i.f;if(!(e&Ea)){Pt(i,nt);var t=Fe,a=Qe;Fe=i;try{e&ka?al(i):Mn(i),An(i);var r=Hn(i);i.teardown=typeof r=="function"?r:null,i.wv=qn;var n=i.deps,s;Wa&&Ls&&i.f&Ht}catch(o){Pa(o,i,t,a||i.ctx)}finally{Fe=t}}}function $n(){if(Ci>1e3){Ci=0;try{As()}catch(i){if(Zi!==null)Pa(i,Zi,null);else throw i}}Ci++}function Zn(i){var e=i.length;if(e!==0){$n();var t=Si;Si=!0;try{for(var a=0;a<e;a++){var r=i[a];r.f&nt||(r.f^=nt);var n=fl(r);dl(n)}}finally{Si=t}}}function dl(i){var e=i.length;if(e!==0)for(var t=0;t<e;t++){var a=i[t];if(!(a.f&(Ea|Lt)))try{zi(a)&&(wr(a),a.deps===null&&a.first===null&&a.nodes_start===null&&(a.teardown===null?Pn(a):a.fn=null))}catch(r){Pa(r,a,null,a.ctx)}}}function vl(){if($i=!1,Ci>1001)return;const i=Jt;Jt=[],Zn(i),$i||(Ci=0,Zi=null)}function Ba(i){ra===Ln&&($i||($i=!0,queueMicrotask(vl))),Zi=i;for(var e=i;e.parent!==null;){e=e.parent;var t=e.f;if(t&(ji|Rt)){if(!(t&nt))return;e.f^=nt}}Jt.push(e)}function fl(i){var e=[],t=i.first;e:for(;t!==null;){var a=t.f,r=(a&Rt)!==0,n=r&&(a&nt)!==0,s=t.next;if(!n&&!(a&Lt)){if(a&vn)e.push(t);else if(r)t.f^=nt;else{var o=Le;try{Le=t,zi(t)&&wr(t)}catch(c){Pa(c,t,null,t.ctx)}finally{Le=o}}var d=t.first;if(d!==null){t=d;continue}}if(s===null){let c=t.parent;for(;c!==null;){if(i===c)break e;var l=c.next;if(l!==null){t=l;continue e}c=c.parent}}t=s}return e}function Tr(i){var e=ra,t=Jt;try{$n();const r=[];ra=nl,Jt=r,$i=!1,Zn(t);var a=i==null?void 0:i();return rl(),(Jt.length>0||r.length>0)&&Tr(),Ci=0,Zi=null,a}finally{ra=e,Jt=t}}async function pl(){await Promise.resolve(),Tr()}function f(i){var e=i.f,t=(e&_t)!==0;if(Ut!==null&&Ut.add(i),Le!==null&&!At){Mt!==null&&Mt.includes(i)&&Fs();var a=Le.deps;i.rv<va&&(i.rv=va,at===null&&a!==null&&a[dt]===i?dt++:at===null?at=[i]:(!Gt||!at.includes(i))&&at.push(i))}else if(t&&i.deps===null&&i.effects===null){var r=i,n=r.parent;n!==null&&!(n.f&mt)&&(r.f^=mt)}return t&&(r=i,zi(r)&&Dn(r)),i.v}function hl(i){var e=Ut;Ut=new Set;var t=Ut,a;try{if(Et(i),e!==null)for(a of Ut)e.add(a)}finally{Ut=e}return t}function na(i){var e=hl(()=>Et(i));for(var t of e)if(t.f&pn)for(const a of t.deps||[])a.f&_t||zt(a,a.v);else zt(t,t.v)}function Et(i){var e=At;try{return At=!0,i()}finally{At=e}}const gl=-7169;function Pt(i,e){i.f=i.f&gl|e}function yl(i){if(!(typeof i!="object"||!i||i instanceof EventTarget)){if(qt in i)Ka(i);else if(!Array.isArray(i))for(let e in i){const t=i[e];typeof t=="object"&&t&&qt in t&&Ka(t)}}}function Ka(i,e=new Set){if(typeof i=="object"&&i!==null&&!(i instanceof EventTarget)&&!e.has(i)){e.add(i),i instanceof Date&&i.getTime();for(let a in i)try{Ka(i[a],e)}catch{}const t=gr(i);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const a=dn(t);for(let r in a){const n=a[r].get;if(n)try{n.call(i)}catch{}}}}}const ml=["touchstart","touchmove"];function _l(i){return ml.includes(i)}let $r=!1;function Sl(){$r||($r=!0,document.addEventListener("reset",i=>{Promise.resolve().then(()=>{var e;if(!i.defaultPrevented)for(const t of i.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function kr(i){var e=Le,t=Fe;St(null),Ct(null);try{return i()}finally{St(e),Ct(t)}}function Fa(i,e,t,a=t){i.addEventListener(e,()=>kr(t));const r=i.__on_r;r?i.__on_r=()=>{r(),a(!0)}:i.__on_r=()=>a(!0),Sl()}const jn=new Set,Xa=new Set;function Cl(i,e,t,a={}){function r(n){if(a.capture||Oi.call(e,n),!n.cancelBubble)return kr(()=>t==null?void 0:t.call(this,n))}return i.startsWith("pointer")||i.startsWith("touch")||i==="wheel"?ri(()=>{e.addEventListener(i,r,a)}):e.addEventListener(i,r,a),r}function ze(i,e,t,a,r){var n={capture:a,passive:r},s=Cl(i,e,t,n);(e===document.body||e===window||e===document)&&Sr(()=>{e.removeEventListener(i,s,n)})}function Vi(i){for(var e=0;e<i.length;e++)jn.add(i[e]);for(var t of Xa)t(i)}function Oi(i){var k;var e=this,t=e.ownerDocument,a=i.type,r=((k=i.composedPath)==null?void 0:k.call(i))||[],n=r[0]||i.target,s=0,o=i.__root;if(o){var d=r.indexOf(o);if(d!==-1&&(e===document||e===window)){i.__root=e;return}var l=r.indexOf(e);if(l===-1)return;d<=l&&(s=d)}if(n=r[s]||i.target,n!==e){un(i,"currentTarget",{configurable:!0,get(){return n||t}});var c=Le,v=Fe;St(null),Ct(null);try{for(var p,h=[];n!==null;){var m=n.assignedSlot||n.parentNode||n.host||null;try{var C=n["__"+a];if(C!==void 0&&!n.disabled)if(pr(C)){var[y,...S]=C;y.apply(n,[i,...S])}else C.call(n,i)}catch(P){p?h.push(P):p=P}if(i.cancelBubble||m===e||m===null)break;n=m}if(p){for(let P of h)queueMicrotask(()=>{throw P});throw p}}finally{i.__root=e,delete i.currentTarget,St(c),Ct(v)}}}function bl(i){var e=document.createElement("template");return e.innerHTML=i,e.content}function pa(i,e){var t=Fe;t.nodes_start===null&&(t.nodes_start=i,t.nodes_end=e)}function w(i,e){var t=(e&Ws)!==0,a=(e&Ys)!==0,r,n=!i.startsWith("<!>");return()=>{r===void 0&&(r=bl(n?i:"<!>"+i),t||(r=ua(r)));var s=a||wn?document.importNode(r,!0):r.cloneNode(!0);if(t){var o=ua(s),d=s.lastChild;pa(o,d)}else pa(s,s);return s}}function Kt(i=""){{var e=xa(i+"");return pa(e,e),e}}function Ne(){var i=document.createDocumentFragment(),e=document.createComment(""),t=xa();return i.append(e,t),pa(e,t),i}function b(i,e){i!==null&&i.before(e)}let Ja=!0;function E(i,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(i.__t??(i.__t=i.nodeValue))&&(i.__t=t,i.nodeValue=t+"")}function wl(i,e){return Tl(i,e)}const vi=new Map;function Tl(i,{target:e,anchor:t,props:a={},events:r,context:n,intro:s=!0}){Ks();var o=new Set,d=v=>{for(var p=0;p<v.length;p++){var h=v[p];if(!o.has(h)){o.add(h);var m=_l(h);e.addEventListener(h,Oi,{passive:m});var C=vi.get(h);C===void 0?(document.addEventListener(h,Oi,{passive:m}),vi.set(h,1)):vi.set(h,C+1)}}};d(hr(jn)),Xa.add(d);var l=void 0,c=il(()=>{var v=t??e.appendChild(xa());return ai(()=>{if(n){Ie({});var p=Qe;p.c=n}r&&(a.$$events=r),Ja=s,l=i(v,a)||{},Ja=!0,n&&et()}),()=>{var m;for(var p of o){e.removeEventListener(p,Oi);var h=vi.get(p);--h===0?(document.removeEventListener(p,Oi),vi.delete(p)):vi.set(p,h)}Xa.delete(d),v!==t&&((m=v.parentNode)==null||m.removeChild(v))}});return kl.set(l,c),l}let kl=new WeakMap;const $a=0,Ii=1,Za=2;function Li(i,e,t,a,r){var n=i,s=xi(),o=Qe,d=Je,l,c,v,p=(s?it:wi)(void 0),h=(s?it:wi)(void 0),m=!1;function C(S,k){m=!0,k&&(Ct(y),St(y),ca(o));try{S===$a&&t&&(l?Ti(l):l=ai(()=>t(n))),S===Ii&&a&&(c?Ti(c):c=ai(()=>a(n,p))),S!==$a&&l&&It(l,()=>l=null),S!==Ii&&c&&It(c,()=>c=null),S!==Za&&v&&It(v,()=>v=null)}finally{k&&(ca(null),St(null),Ct(null),Tr())}}var y=Ma(()=>{if(d!==(d=e())){if(Cs(d)){var S=d;m=!1,S.then(k=>{S===d&&(zt(p,k),C(Ii,!0))},k=>{if(S===d)throw zt(h,k),C(Za,!0),h.v}),ri(()=>{m||C($a,!0)})}else zt(p,d),C(Ii,!1);return()=>d=Je}})}function H(i,e,t=!1){var a=i,r=null,n=null,s=Je,o=t?Da:0,d=!1;const l=(v,p=!0)=>{d=!0,c(p,v)},c=(v,p)=>{s!==(s=v)&&(s?(r?Ti(r):p&&(r=ai(()=>p(a))),n&&It(n,()=>{n=null})):(n?Ti(n):p&&(n=ai(()=>p(a))),r&&It(r,()=>{r=null})))};Ma(()=>{d=!1,e(l),d||c(null,null)},o)}function ce(i,e){return e}function El(i,e,t,a){for(var r=[],n=e.length,s=0;s<n;s++)Cr(e[s].e,r,!0);var o=n>0&&r.length===0&&t!==null;if(o){var d=t.parentNode;Xs(d),d.append(t),a.clear(),$t(i,e[0].prev,e[n-1].next)}Bn(r,()=>{for(var l=0;l<n;l++){var c=e[l];o||(a.delete(c.k),$t(i,c.prev,c.next)),Wt(c.e,!o)}})}function ue(i,e,t,a,r,n=null){var s=i,o={flags:e,items:new Map,first:null},d=(e&mn)!==0;if(d){var l=i;s=l.appendChild(xa())}var c=null,v=!1,p=Ce(()=>{var h=t();return pr(h)?h:h==null?[]:hr(h)});Ma(()=>{var h=f(p),m=h.length;v&&m===0||(v=m===0,Dl(h,o,s,r,e,a,t),n!==null&&(m===0?c?Ti(c):c=ai(()=>n(s)):c!==null&&It(c,()=>{c=null})),f(p))})}function Dl(i,e,t,a,r,n,s){var J,B,G,le;var o=(r&Ns)!==0,d=(r&(mr|_r))!==0,l=i.length,c=e.items,v=e.first,p=v,h,m=null,C,y=[],S=[],k,P,O,T;if(o)for(T=0;T<l;T+=1)k=i[T],P=n(k,T),O=c.get(P),O!==void 0&&((J=O.a)==null||J.measure(),(C??(C=new Set)).add(O));for(T=0;T<l;T+=1){if(k=i[T],P=n(k,T),O=c.get(P),O===void 0){var D=p?p.e.nodes_start:t;m=Al(D,e,m,m===null?e.first:m.next,k,P,T,a,r,s),c.set(P,m),y=[],S=[],p=m.next;continue}if(d&&xl(O,k,T,r),O.e.f&Lt&&(Ti(O.e),o&&((B=O.a)==null||B.unfix(),(C??(C=new Set)).delete(O))),O!==p){if(h!==void 0&&h.has(O)){if(y.length<S.length){var q=S[0],M;m=q.prev;var X=y[0],Z=y[y.length-1];for(M=0;M<y.length;M+=1)Zr(y[M],q,t);for(M=0;M<S.length;M+=1)h.delete(S[M]);$t(e,X.prev,Z.next),$t(e,m,X),$t(e,Z,q),p=q,m=Z,T-=1,y=[],S=[]}else h.delete(O),Zr(O,p,t),$t(e,O.prev,O.next),$t(e,O,m===null?e.first:m.next),$t(e,m,O),m=O;continue}for(y=[],S=[];p!==null&&p.k!==P;)p.e.f&Lt||(h??(h=new Set)).add(p),S.push(p),p=p.next;if(p===null)continue;O=p}y.push(O),m=O,p=O.next}if(p!==null||h!==void 0){for(var Y=h===void 0?[]:hr(h);p!==null;)p.e.f&Lt||Y.push(p),p=p.next;var Se=Y.length;if(Se>0){var qe=r&mn&&l===0?t:null;if(o){for(T=0;T<Se;T+=1)(G=Y[T].a)==null||G.measure();for(T=0;T<Se;T+=1)(le=Y[T].a)==null||le.fix()}El(e,Y,qe,c)}}o&&ri(()=>{var A;if(C!==void 0)for(O of C)(A=O.a)==null||A.apply()}),Fe.first=e.first&&e.first.e,Fe.last=m&&m.e}function xl(i,e,t,a){a&mr&&zt(i.v,e),a&_r?zt(i.i,t):i.i=t}function Al(i,e,t,a,r,n,s,o,d,l){var c=(d&mr)!==0,v=(d&Rs)===0,p=c?v?wi(r):it(r):r,h=d&_r?it(s):s,m={i:h,v:p,k:n,a:null,e:null,prev:t,next:a};try{return m.e=ai(()=>o(i,p,h,l),Cn),m.e.prev=t&&t.e,m.e.next=a&&a.e,t===null?e.first=m:(t.next=m,t.e.next=m.e),a!==null&&(a.prev=m,a.e.prev=m.e),m}finally{}}function Zr(i,e,t){for(var a=i.next?i.next.e.nodes_start:t,r=e?e.e.nodes_start:t,n=i.e.nodes_start;n!==a;){var s=Aa(n);r.before(n),n=s}}function $t(i,e,t){e===null?i.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Un(i){var e,t,a="";if(typeof i=="string"||typeof i=="number")a+=i;else if(typeof i=="object")if(Array.isArray(i)){var r=i.length;for(e=0;e<r;e++)i[e]&&(t=Un(i[e]))&&(a&&(a+=" "),a+=t)}else for(t in i)i[t]&&(a&&(a+=" "),a+=t);return a}function Ml(){for(var i,e,t=0,a="",r=arguments.length;t<r;t++)(i=arguments[t])&&(e=Un(i))&&(a&&(a+=" "),a+=e);return a}function fi(i){return typeof i=="object"?Ml(i):i??""}function Nt(i,e,t,a){var r=i.__attributes??(i.__attributes={});r[e]!==(r[e]=t)&&(e==="style"&&"__styles"in i&&(i.__styles={}),e==="loading"&&(i[ks]=t),t==null?i.removeAttribute(e):typeof t!="string"&&Pl(i).includes(e)?i[e]=t:i.setAttribute(e,t))}var jr=new Map;function Pl(i){var e=jr.get(i.nodeName);if(e)return e;jr.set(i.nodeName,e=[]);for(var t,a=i,r=Element.prototype;r!==a;){t=dn(a);for(var n in t)t[n].set&&e.push(n);a=gr(a)}return e}function me(i,e,t){var a=i.__className,r=Bl(e,t);(a!==r||Cn)&&(e==null&&!t?i.removeAttribute("class"):i.className=r,i.__className=r)}function Bl(i,e){return(i??"")+(e?" "+e:"")}const Fl=()=>performance.now(),Ot={tick:i=>requestAnimationFrame(i),now:()=>Fl(),tasks:new Set};function Gn(){const i=Ot.now();Ot.tasks.forEach(e=>{e.c(i)||(Ot.tasks.delete(e),e.f())}),Ot.tasks.size!==0&&Ot.tick(Gn)}function Ol(i){let e;return Ot.tasks.size===0&&Ot.tick(Gn),{promise:new Promise(t=>{Ot.tasks.add(e={c:i,f:t})}),abort(){Ot.tasks.delete(e)}}}function ea(i,e){kr(()=>{i.dispatchEvent(new CustomEvent(e))})}function Ll(i){if(i==="float")return"cssFloat";if(i==="offset")return"cssOffset";if(i.startsWith("--"))return i;const e=i.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function Ur(i){const e={},t=i.split(";");for(const a of t){const[r,n]=a.split(":");if(!r||n===void 0)break;const s=Ll(r.trim());e[s]=n.trim()}return e}const ql=i=>i;function pi(i,e,t,a){var r=(i&Gs)!==0,n=(i&zs)!==0,s=r&&n,o=(i&Vs)!==0,d=s?"both":r?"in":"out",l,c=e.inert,v=e.style.overflow,p,h;function m(){var P=Le,O=Fe;St(null),Ct(null);try{return l??(l=t()(e,(a==null?void 0:a())??{},{direction:d}))}finally{St(P),Ct(O)}}var C={is_global:o,in(){var P;if(e.inert=c,!r){h==null||h.abort(),(P=h==null?void 0:h.reset)==null||P.call(h);return}n||p==null||p.abort(),ea(e,"introstart"),p=Ia(e,m(),h,1,()=>{ea(e,"introend"),p==null||p.abort(),p=l=void 0,e.style.overflow=v})},out(P){if(!n){P==null||P(),l=void 0;return}e.inert=!0,ea(e,"outrostart"),h=Ia(e,m(),p,0,()=>{ea(e,"outroend"),P==null||P()})},stop:()=>{p==null||p.abort(),h==null||h.abort()}},y=Fe;if((y.transitions??(y.transitions=[])).push(C),r&&Ja){var S=o;if(!S){for(var k=y.parent;k&&k.f&Da;)for(;(k=k.parent)&&!(k.f&ka););S=!k||(k.f&fn)!==0}S&&Mi(()=>{Et(()=>C.in())})}}function Ia(i,e,t,a,r){var n=a===1;if(Ss(e)){var s,o=!1;return ri(()=>{if(!o){var y=e({direction:n?"in":"out"});s=Ia(i,y,t,a,r)}}),{abort:()=>{o=!0,s==null||s.abort()},deactivate:()=>s.deactivate(),reset:()=>s.reset(),t:()=>s.t()}}if(t==null||t.deactivate(),!(e!=null&&e.duration))return r(),{abort:kt,deactivate:kt,reset:kt,t:()=>a};const{delay:d=0,css:l,tick:c,easing:v=ql}=e;var p=[];if(n&&t===void 0&&(c&&c(0,1),l)){var h=Ur(l(0,1));p.push(h,h)}var m=()=>1-a,C=i.animate(p,{duration:d});return C.onfinish=()=>{var y=(t==null?void 0:t.t())??1-a;t==null||t.abort();var S=a-y,k=e.duration*Math.abs(S),P=[];if(k>0){var O=!1;if(l)for(var T=Math.ceil(k/16.666666666666668),D=0;D<=T;D+=1){var q=y+S*v(D/T),M=Ur(l(q,1-q));P.push(M),O||(O=M.overflow==="hidden")}O&&(i.style.overflow="hidden"),m=()=>{var X=C.currentTime;return y+S*v(X/k)},c&&Ol(()=>{if(C.playState!=="running")return!1;var X=m();return c(X,1-X),!0})}C=i.animate(P,{duration:k,fill:"forwards"}),C.onfinish=()=>{m=()=>a,c==null||c(a,1-a),r()}},{abort:()=>{C&&(C.cancel(),C.effect=null,C.onfinish=kt)},deactivate:()=>{r=kt},reset:()=>{a===0&&(c==null||c(1,0))},t:()=>m()}}function er(i,e,t=e){var a=xi();Fa(i,"input",r=>{var n=r?i.defaultValue:i.value;if(n=Ua(i)?Ga(n):n,t(n),a&&n!==(n=e())){var s=i.selectionStart,o=i.selectionEnd;i.value=n??"",o!==null&&(i.selectionStart=s,i.selectionEnd=Math.min(o,i.value.length))}}),Et(e)==null&&i.value&&t(Ua(i)?Ga(i.value):i.value),Gi(()=>{var r=e();Ua(i)&&r===Ga(i.value)||i.type==="date"&&!r&&!i.value||r!==i.value&&(i.value=r??"")})}const ja=new Set;function hi(i,e,t,a,r=a){var n=t.getAttribute("type")==="checkbox",s=i;if(e!==null)for(var o of e)s=s[o]??(s[o]=[]);s.push(t),Fa(t,"change",()=>{var d=t.__value;n&&(d=Rl(s,d,t.checked)),r(d)},()=>r(n?[]:null)),Gi(()=>{var d=a();n?(d=d||[],t.checked=d.includes(t.__value)):t.checked=bn(t.__value,d)}),Sr(()=>{var d=s.indexOf(t);d!==-1&&s.splice(d,1)}),ja.has(s)||(ja.add(s),ri(()=>{s.sort((d,l)=>d.compareDocumentPosition(l)===4?-1:1),ja.delete(s)})),ri(()=>{})}function Nl(i,e,t=e){Fa(i,"change",a=>{var r=a?i.defaultChecked:i.checked;t(r)}),Et(e)==null&&t(i.checked),Gi(()=>{var a=e();i.checked=!!a})}function Rl(i,e,t){for(var a=new Set,r=0;r<i.length;r+=1)i[r].checked&&a.add(i[r].__value);return t||a.delete(e),Array.from(a)}function Ua(i){var e=i.type;return e==="number"||e==="range"}function Ga(i){return i===""?null:+i}function zn(i,e,t){if(i.multiple)return $l(i,e);for(var a of i.options){var r=qi(a);if(bn(r,e)){a.selected=!0;return}}(!t||e!==void 0)&&(i.selectedIndex=-1)}function Hl(i,e){Mi(()=>{var t=new MutationObserver(()=>{var a=i.__value;zn(i,a)});return t.observe(i,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{t.disconnect()}})}function sa(i,e,t=e){var a=!0;Fa(i,"change",r=>{var n=r?"[selected]":":checked",s;if(i.multiple)s=[].map.call(i.querySelectorAll(n),qi);else{var o=i.querySelector(n)??i.querySelector("option:not([disabled])");s=o&&qi(o)}t(s)}),Mi(()=>{var r=e();if(zn(i,r,a),a&&r===void 0){var n=i.querySelector(":checked");n!==null&&(r=qi(n),t(r))}i.__value=r,a=!1}),Hl(i)}function $l(i,e){for(var t of i.options)t.selected=~e.indexOf(qi(t))}function qi(i){return"__value"in i?i.__value:i.value}function Gr(i,e){return i===e||(i==null?void 0:i[qt])===e}function Zl(i={},e,t,a){return Mi(()=>{var r,n;return Gi(()=>{r=n,n=[],Et(()=>{i!==t(...n)&&(e(i,...n),r&&Gr(t(...r),i)&&e(null,...r))})}),()=>{ri(()=>{n&&Gr(t(...n),i)&&e(null,...n)})}}),i}function ft(i=!1){const e=Qe,t=e.l.u;if(!t)return;let a=()=>yl(e.s);if(i){let r=0,n={};const s=ii(()=>{let o=!1;const d=e.s;for(const l in d)d[l]!==n[l]&&(n[l]=d[l],o=!0);return o&&r++,r});a=()=>f(s)}t.b.length&&tl(()=>{zr(e,a),Ya(t.b)}),Nr(()=>{const r=Et(()=>t.m.map(bs));return()=>{for(const n of r)typeof n=="function"&&n()}}),t.a.length&&Nr(()=>{zr(e,a),Ya(t.a)})}function zr(i,e){if(i.l.s)for(const t of i.l.s)f(t);e()}function Vn(i,e,t){if(i==null)return e(void 0),kt;const a=Et(()=>i.subscribe(e,t));return a.unsubscribe?()=>a.unsubscribe():a}const gi=[];function jl(i,e=kt){let t=null;const a=new Set;function r(o){if(yn(i,o)&&(i=o,t)){const d=!gi.length;for(const l of a)l[1](),gi.push(l,i);if(d){for(let l=0;l<gi.length;l+=2)gi[l][0](gi[l+1]);gi.length=0}}}function n(o){r(o(i))}function s(o,d=kt){const l=[o,d];return a.add(l),a.size===1&&(t=e(r,n)||kt),o(i),()=>{a.delete(l),a.size===0&&t&&(t(),t=null)}}return{set:r,update:n,subscribe:s}}function Ul(i){let e;return Vn(i,t=>e=t)(),e}let ta=!1,tr=Symbol();function Gl(i,e,t){const a=t[e]??(t[e]={store:null,source:wi(void 0),unsubscribe:kt});if(a.store!==i&&!(tr in t))if(a.unsubscribe(),a.store=i??null,i==null)a.source.v=void 0,a.unsubscribe=kt;else{var r=!0;a.unsubscribe=Vn(i,n=>{r?a.source.v=n:K(a.source,n)}),r=!1}return i&&tr in t?Ul(i):f(a.source)}function zl(){const i={};function e(){Sr(()=>{for(var t in i)i[t].unsubscribe();un(i,tr,{enumerable:!1,value:!0})})}return[i,e]}function Vl(i){var e=ta;try{return ta=!1,[i(),ta]}finally{ta=e}}function Oe(i,e,t,a){var q;var r=(t&Hs)!==0,n=!Ui||(t&$s)!==0,s=(t&js)!==0,o=(t&Us)!==0,d=!1,l;s?[l,d]=Vl(()=>i[e]):l=i[e];var c=qt in i||Ts in i,v=s&&(((q=_i(i,e))==null?void 0:q.set)??(c&&e in i&&(M=>i[e]=M)))||void 0,p=a,h=!0,m=!1,C=()=>(m=!0,h&&(h=!1,o?p=Et(a):p=a),p);l===void 0&&a!==void 0&&(v&&n&&Ms(),l=C(),v&&v(l));var y;if(n)y=()=>{var M=i[e];return M===void 0?C():(h=!0,m=!1,M)};else{var S=(r?ii:Ce)(()=>i[e]);S.f|=pn,y=()=>{var M=f(S);return M!==void 0&&(p=void 0),M===void 0?p:M}}if(!(t&Zs))return y;if(v){var k=i.$$legacy;return function(M,X){return arguments.length>0?((!n||!X||k||d)&&v(X?y():M),M):y()}}var P=!1,O=!1,T=wi(l),D=ii(()=>{var M=y(),X=f(T);return P?(P=!1,O=!0,X):(O=!1,T.v=M)});return r||(D.equals=yr),function(M,X){if(Ut!==null&&(P=O,y(),f(T)),arguments.length>0){const Z=X?f(D):n&&s?jt(M):M;return D.equals(Z)||(P=!0,K(T,Z),m&&p!==void 0&&(p=Z),Et(()=>f(D))),M}return f(D)}}const Wl="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Wl);qs();class Yl{constructor(e,t,a){u(this,"_dbname");u(this,"_dbversion");u(this,"dbPromise");u(this,"getTran",async(e,t)=>(await this.dbPromise).transaction(e,t));u(this,"reset",async()=>(await indexedDB.databases().then(e=>{console.log(e)}),await new Promise((e,t)=>{const a=indexedDB.deleteDatabase(this._dbname);a.onsuccess=()=>{console.log("onsuccess"),e()},a.onerror=r=>{console.log("onerror"),t(r)}})));u(this,"getAll",async e=>{const t=await this.dbPromise;return new Promise((a,r)=>{const o=t.transaction([e],"readonly").objectStore(e).getAll();o.onsuccess=()=>{a(o.result)},o.onerror=d=>{r(d)}})});u(this,"get",async(e,t)=>{const a=await this.dbPromise;return new Promise((r,n)=>{const d=a.transaction([e],"readonly").objectStore(e).get(t);d.onsuccess=()=>{r(d.result)},d.onerror=l=>{n(l)}})});u(this,"getMany",async(e,t)=>{const n=(await this.dbPromise).transaction([e],"readonly").objectStore(e),s=t.map(o=>new Promise((d,l)=>{const c=n.get(o);c.onsuccess=()=>{d(c.result)},c.onerror=v=>{l(v)}}));return await Promise.all(s)});u(this,"putRecords",async(e,t)=>{const r=(await this.dbPromise).transaction([e],"readwrite"),n=r.objectStore(e),s=t.map(o=>({record:o,request:n.put(o)}));return new Promise((o,d)=>{r.oncomplete=()=>o(s.map(l=>Object.assign({id:l.request.result},l.record))),r.onerror=l=>d(l)})});u(this,"deleteRecords",async(e,t)=>{const r=(await this.dbPromise).transaction([e],"readwrite"),n=r.objectStore(e),s=t.map(o=>({key:o,request:n.delete(o)}));return new Promise((o,d)=>{r.oncomplete=()=>{console.log(s.map(l=>l.request.result)),o()},r.onerror=l=>d(l)})});this._dbname=e,this._dbversion=t,this.dbPromise=new Promise((r,n)=>{const s=indexedDB.open(e,t);s.onsuccess=o=>{if(console.log(o),!o.target){console.log("event.target is undefined"),n("event.target is undefined");return}const d=o.target.result;if(!d){console.log("event.target.result is undefined"),n("event.target.result is undefined");return}d.onversionchange=l=>{console.log(l),d.close()},r(d)},s.onupgradeneeded=o=>{console.log("onupgradeneeded");const d=o.target.result;a.filter(l=>!d.objectStoreNames.contains(l)).map(l=>d.createObjectStore(l,{keyPath:"id",autoIncrement:!0}))},s.onerror=o=>{console.log(o),n(o)},s.onblocked=o=>{console.log(o),n(o)}}),console.log(this.dbPromise)}get dbversion(){return this._dbversion}}class Ke{constructor(){u(this,"handlers",[])}append(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}trigger(e){this.handlers.slice(0).filter(t=>t(e)==="RemoveMe").forEach(t=>this.remove(t))}clear(){this.handlers.splice(0)}expose(){return this}}class Vr{constructor(){u(this,"handlers",[])}append(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}async trigger(e){const t=await Promise.all(this.handlers.slice(0).map(async a=>{const r=await a(e);return{h:a,result:r}}));console.log(t),t.filter(a=>a.result==="RemoveMe").map(a=>a.h).forEach(a=>this.remove(a))}clear(){this.handlers.splice(0)}expose(){return this}}class Wr{constructor(){u(this,"handler")}set(e){this.handler=e}async call(e){if(!this.handler)throw Error("illegal state error");return await this.handler(e)}expose(){return this}}class Er{constructor(e,t,a,r){u(this,"_name");u(this,"_createVersion");u(this,"mountResolver",()=>{});u(this,"_indexedDb");u(this,"onInsertEvent",new Ke);u(this,"onBeforeInsertEvent",new Wr);u(this,"onUpdateEvent",new Ke);u(this,"onBeforeUpdateEvent",new Wr);u(this,"onDeleteEvent",new Ke);u(this,"prepareInitialRecords",()=>{const e=new Date;return this._prepareInitialRecords().map(t=>Object.assign(t,{createdAt:e,updatedAt:e,dbVersion:this._createVersion}))});u(this,"resolveMount",()=>this.mountResolver());u(this,"patchForInsert",(e,t)=>{e.newRecords.forEach(a=>{t[a.id]=a})});u(this,"patchForUpdate",(e,t)=>{e.recordPairs.forEach(a=>{t[a.newRecord.id]={...a.newRecord}})});u(this,"patchForDelete",(e,t)=>{e.oldRecords.forEach(a=>{delete t[a.id]})});this._indexedDb=e,this._name=t,this._createVersion=e.dbversion,this.getAll().then(n=>n.reduce((s,o)=>(s[o.id]=o,s),{})).then(n=>{console.log(this.name,n),this.onBeforeInsertEvent.set(a??(()=>Promise.resolve())),this.onBeforeUpdateEvent.set(r??(()=>Promise.resolve()))})}get name(){return this._name}get createVersion(){return this._createVersion}get oninsert(){return this.onInsertEvent.expose()}get onbeforeinsert(){return this.onBeforeInsertEvent.expose()}get onupdate(){return this.onUpdateEvent.expose()}get onbeforeupdate(){return this.onBeforeUpdateEvent.expose()}get ondelete(){return this.onDeleteEvent.expose()}getAll(){return this._indexedDb.getAll(this.name)}get(e){return this._indexedDb.get(this.name,e)}async insertMany(e){const t=new Date,a=e.map(n=>{const s={createdAt:t,updatedAt:t,dbVersion:this._createVersion};return Object.assign(n,s)});await this.onBeforeInsertEvent.call({sender:this,newRecords:a,timestamp:t});const r=await this._indexedDb.putRecords(this.name,a);return this.onInsertEvent.trigger({sender:this,newRecords:r,timestamp:t}),r}async insert(e){return(await this.insertMany([e]))[0]}async updateMany(e,t){const a=new Date,r=[];return(await this._indexedDb.getMany(this.name,e)).forEach(s=>{const o={...s},d={...o};r.push({newRecord:Object.assign(t(d),{updatedAt:a,dbVersion:this._createVersion}),oldRecord:o})}),await this.onBeforeUpdateEvent.call({sender:this,recordPairs:r,timestamp:a}),await this._indexedDb.putRecords(this.name,r.map(s=>s.newRecord)),this.onUpdateEvent.trigger({sender:this,recordPairs:r,timestamp:a}),r.map(s=>s.newRecord)}async update(e,t){return(await this.updateMany([e],t))[0]}async delete(e){const t=new Date,a=await this._indexedDb.getMany(this.name,e);await this._indexedDb.deleteRecords(this.name,e),this.onDeleteEvent.trigger({sender:this,oldRecords:a,timestamp:t})}}const Ql=["Deck","ExtraDeck"],Kl={Deck:"メインデッキ",ExtraDeck:"エクストラデッキ"},ir=["Monster","Spell","Trap","XyzMaterial"],Wn={Monster:"モンスター",Spell:"魔法",Trap:"罠",XyzMaterial:"XYZ素材"},ki=["Fusion","Syncro","Xyz","Link"],Yn=[...ki,"SpecialSummon","Ritual"],Xl=["Toon","Spirit","Union","Gemini","FlipEffect"],Jl=["Tuner","Effect","Normal","Pendulum","Token","NormalSummonOnly","RegularSpecialSummonOnly"],Yr=[...Yn,...Xl,...Jl],Oa={Syncro:"シンクロ",Fusion:"融合",Xyz:"エクシーズ",Link:"リンク",Ritual:"儀式",SpecialSummon:"特殊召喚",Toon:"トゥーン",Spirit:"スピリット",Union:"ユニオン",Gemini:"デュアル",FlipEffect:"リバース",Tuner:"チューナー",Effect:"効果",Normal:"通常",Pendulum:"ペンデュラム",Token:"トークン",NormalSummonOnly:"特殊召喚不可",RegularSpecialSummonOnly:"正規特殊召喚のみ"},Wi={Syncro:"🎵",Fusion:"🌀",Xyz:"📰",Link:"⛓️",Ritual:"📜",SpecialSummon:"🔯",Toon:"📖",Spirit:"👻",Union:"🚗",Gemini:"👫",FlipEffect:"🔄",Tuner:"🎶",Effect:"✨",Normal:"🔘",Pendulum:"💠",Token:"🐏",NormalSummonOnly:"🔲",RegularSpecialSummonOnly:"❗"},Qr=["Light","Dark","Earth","Water","Fire","Wind","Divine"],Dr={Light:"光",Dark:"闇",Earth:"地",Water:"水",Fire:"炎",Wind:"風",Divine:"神"},Kr=["Aqua","Beast","BeastWarrior","CreatorGod","Cyberse","Dinosaur","DivineBeast","Dragon","Fairy","Fiend","Fish","Insect","Illusion","Machine","Plant","Psychic","Pyro","Reptile","Rock","SeaSerpent","Spellcaster","Thunder","Warrior","WingedBeast","Wyrm","Zombie"],Xr=["Normal","Continuous","Field","QuickPlay","Equip","Ritual","PendulumScale"],Yi={Normal:"通常",Continuous:"永続",Field:"フィールド",QuickPlay:"速攻",Equip:"装備",Ritual:"儀式",PendulumScale:"ペンデュラム"},Jr=["Normal","Continuous","Counter"],Qi={Normal:"通常",Continuous:"永続",Counter:"カウンター"},Xe=["Attack","Defense"],ia={Attack:"攻撃表示",Defense:"守備表示",Set:"裏側守備表示"},Qn=["level","rank","attack","defense","pendulumScaleR","pendulumScaleL"],Il=({wikiName:i,wikiHref:e,wikiTextAll:t,nameKana:a,description:r,pendulumDescription:n,...s})=>s,eo=i=>Il(i),La={Aqua:"水",Beast:"獣",BeastWarrior:"獣戦士",CreatorGod:"創造神",Cyberse:"サイバース",Dinosaur:"恐竜",DivineBeast:"幻獣神",Dragon:"ドラゴン",Fairy:"天使",Fiend:"悪魔",Fish:"魚",Insect:"昆虫",Illusion:"幻想魔",Machine:"機械",Plant:"植物",Psychic:"サイキック",Pyro:"炎",Reptile:"爬虫類",Rock:"岩石",SeaSerpent:"海竜",Spellcaster:"魔法使い",Thunder:"雷",Warrior:"戦士",WingedBeast:"鳥獣",Wyrm:"幻竜",Zombie:"アンデット"},Ki={Aqua:"🚰",Beast:"🐅",BeastWarrior:"🦁",CreatorGod:"🔆",Cyberse:"💻️",Dinosaur:"🦖",DivineBeast:"💫",Dragon:"🐲",Fairy:"👼",Fiend:"👿",Fish:"🐟️",Insect:"🦋",Illusion:"🤡",Machine:"🤖",Plant:"🌱",Psychic:"👁️",Pyro:"🔥",Reptile:"🦎",Rock:"⛰",SeaSerpent:"🐍",Spellcaster:"🧙",Thunder:"⚡️",Warrior:"⚔️",WingedBeast:"🦅",Wyrm:"🐉",Zombie:"🦴"},to={TopLeft:{name:"左上",arrowhead:{offsetRow:-1,offsetColumn:-1}},TopCenter:{name:"上",arrowhead:{offsetRow:-1,offsetColumn:0}},TopRight:{name:"右上",arrowhead:{offsetRow:-1,offsetColumn:1}},MiddleLeft:{name:"左",arrowhead:{offsetRow:0,offsetColumn:-1}},MiddleRight:{name:"右",arrowhead:{offsetRow:0,offsetColumn:1}},BottomLeft:{name:"左下",arrowhead:{offsetRow:1,offsetColumn:-1}},BottomCenter:{name:"下",arrowhead:{offsetRow:1,offsetColumn:0}},BottomRight:{name:"右下",arrowhead:{offsetRow:1,offsetColumn:1}}},io=i=>i.cardId??!1?`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=2&cid=${i.cardId}`:`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=1&sess=1&rp=10&mode=&sort=1&keyword=${i.name}&stype=1&ctype=&othercon=2&starfr=&starto=&pscalefr=&pscaleto=&linkmarkerfr=&linkmarkerto=&link_m=2&atkfr=&atkto=&deffr=&defto=&releaseDStart=1&releaseMStart=1&releaseYStart=1999&releaseDEnd=&releaseMEnd=&releaseYEnd=`,Ni=(i,e)=>{const t=i.monsterCategories??[],a=e.monsterCategories??[];for(const r of ki.toReversed()){if(t.includes(r)&&!a.includes(r))return 1;if(!t.includes(r)&&a.includes(r))return-1}if(i.kind===e.kind){if(i.kind==="Monster"){if((i.link??0)!==(e.link??0))return(i.link??0)-(e.link??0);if((i.rank??0)!==(e.rank??0))return(i.rank??0)-(e.rank??0);if((i.level??0)!==(e.level??0))return(i.level??0)-(e.level??0);if((i.attack??0)!==(e.attack??0))return(i.attack??0)-(e.attack??0);if((i.defense??0)!==(e.defense??0))return(i.defense??0)-(e.defense??0)}return i.name.localeCompare(e.name,"Ja")}for(const r of ir){if(i.kind===r)return-1;if(e.kind===r)return 1}return i.name.localeCompare(e.name,"Ja")},ha=(...i)=>i.length?i.reduce((e,t)=>e>t?e:t):-Number.MAX_VALUE,ar=(...i)=>i.length?i.reduce((e,t)=>e<t?e:t):Number.MAX_VALUE,yi=(i,e)=>{if((i[0]??Number.MAX_VALUE)>e)return 0;if(i.slice(-1)[0]<e)return i.length;let t=0,a=i.length-1;for(;;){const r=Math.round((t+a)/2);if(r===a||r===t)return i[t]<e?a:t;if(i[r]<e){t=r;continue}a=r}},Tt=[3,5,5,6,6,6,7,8,9,10,11,11,11,12,12,13,13,14,15,15,15,15,15,15,16,16,16,17,18,18,18,21,21,21,22,23,25,25,26,28,28,28,30,30,31,32,32,33,33,34,35,35,36,36,36,37,37,38,38,38,39,41,42,42,43,45,45,45,45,48,48,48,50,51,52,54,54,54,54,56,57,58,59,59,59,59,60,61,63,65,65,65,65,66,67,67,67,69,69,71,71,72,73,73,73,73,73,74,75,75,76,76,77,78,79,80,80,80,80,84,84,84,84,84,84,85,85,85,87,90,91,94,96,96,97,98,101,101,101,101,101];console.log(Tt.length);Tt.forEach((i,e)=>{((Tt[yi(Tt,e)-1]||-Number.MAX_VALUE)>=e||(Tt[yi(Tt,e)]||Number.MAX_VALUE)<e)&&console.log(e,yi(Tt,e),(Tt[yi(Tt,e)-1]||-Number.MAX_VALUE)<e,(Tt[yi(Tt,e)]||Number.MAX_VALUE)>=e)});const gt=class gt{constructor(e){u(this,"id");u(this,"name");u(this,"description");u(this,"previousNpcId");u(this,"previousStartMode");u(this,"save",async e=>{const t=e??{id:this.id,name:this.name,description:this.description,previousNpcId:this.previousNpcId,previousStartMode:this.previousStartMode},a=await gt.tblHeader.update(this.id,r=>({...r,...t}));return new gt(a)});var t;console.log(e),this.id=e.id,this.name=e.name,this.description=e.description,this.previousNpcId=((t=Ri.find(a=>a.id===e.previousNpcId))==null?void 0:t.id)??ar(...Ri.map(a=>a.id)),this.previousStartMode=ic.includes(e.previousStartMode)?e.previousStartMode:"Random"}get npcLvl(){return Number.MAX_VALUE}};u(gt,"tblHeader"),u(gt,"getOrCreateNew",async e=>{gt.tblHeader||(gt.tblHeader=new ao(e));const t=await gt.tblHeader.getAll();if(t.length)return new gt(t[0]);const a=await gt.tblHeader.insert({name:"あなた",description:"ここの文字列を何に使うかは未定。",previousNpcId:0,previousStartMode:"Random"});return new gt(a)});let rr=gt;class ao extends Er{constructor(t){super(t,"TblDuelistProfile");u(this,"_prepareInitialRecords",()=>[])}}let za=-1;const Ri=[{id:za--,name:"サンドバッグくん棒立ち",description:"攻撃宣言なし、強制効果以外の効果の発動なし。",npcLvl:0},{id:za--,name:"サンドバッグくん非暴力",description:"攻撃宣言なし。",npcLvl:100},{id:za--,name:"サンドバッグくん白帯",description:"とくに制限なし。",npcLvl:200}];Array.prototype.shuffle=function(){return this.map(e=>({item:e,seq:Math.random()})).toSorted((e,t)=>e.seq-t.seq).map(e=>e.item)};Array.prototype.randomPickMany=function(i){return this.shuffle().slice(0,i)};Array.prototype.randomPick=function(){return this.shuffle().slice(0,1)[0]};Array.prototype.reset=function(...i){this.splice(0),this.push(...i)};Array.prototype.union=function(i){return this.filter(e=>i.find(t=>e===t))};Array.prototype.getAllOnOffPattern=function(){const i=[];return this.forEach(e=>{if(i.length==0){i.push([e]),i.push([]);return}i.forEach(t=>i.push([...t,e]))}),i};Array.prototype.getDistinct=function(){return Array.from(new Set(this))};Array.prototype.distinct=function(){this.reset(...this.getDistinct())};const Sa=class Sa{constructor(e,t,a){u(this,"seq");u(this,"entity");u(this,"_definition");u(this,"validateDuelist",e=>this.entity.controller===e?this.definition.executableDuelistTypes.includes("Controller"):this.definition.executableDuelistTypes.includes("Opponent"));this.seq=e==="AutoSeq"?Sa.nextSeq++:e,this.entity=t,this._definition=a}get definition(){return this._definition}get title(){return this.definition.title}get isMandatory(){return this.definition.isMandatory}get executableCells(){return this.definition.executableCells}get executablePeriods(){return this.definition.executablePeriods}get executableDuelistTypes(){return this.definition.executableDuelistTypes}get isOnlyNTimesPerDuel(){return this.definition.isOnlyNTimesPerDuel??0}get isOnlyNTimesPerTurn(){return this.definition.isOnlyNTimesPerTurn??0}get isOnlyNTimesPerTurnIfFaceup(){return this.definition.isOnlyNTimesPerTurnIfFaceup??0}get isOnlyNTimesIfFaceup(){return this.definition.isOnlyNTimesIfFaceup??0}get isOnlyNTimesPerChain(){return this.definition.isOnlyNTimesPerChain??0}get actionGroupNamePerTurn(){return this.definition.actionGroupNamePerTurn}get duel(){return this.entity.duel}};u(Sa,"nextSeq",0);let ga=Sa;const Be=class Be{constructor(){}};u(Be,"_tryMarkForDestory",(e,t)=>{if(e.info.isDying||e.status.kind==="XyzMaterial"||!e.isOnField&&e.fieldCell.cellType!=="Deck"&&e.fieldCell.cellType!=="Hand")return!1;const a=t.action.playType==="Battle"?"BattleDestroy":"EffectDestroy",r=a==="BattleDestroy"&&t.action.entity===e?t.selectedEntities[0]:t.action.entity;return e.info.isDying=e.validateDestory(a,t.activator,r,t.action),e.info.isDying&&(e.info.causeOfDeath=[a],e.info.isKilledBy=r,e.info.isKilledByWhom=t.activator,a==="BattleDestroy"&&(e.info.isKilledByWhom=r.controller)),e.info.isDying}),u(Be,"releaseManyForTheSameReason",(e,t,a,r)=>e.length?(t.includes("Cost")&&r.writeInfoLog(`${e.map(n=>n.nm).join(" ")}をリリースし――、`),Be.bringManyToSameCellForTheSameReason("Graveyard","Top",e,"FaceUp","Vertical",["Release",...t],a,r)):Promise.resolve()),u(Be,"sendManyToGraveyardForTheSameReason",(e,t,a,r)=>e.length?(r&&t.includes("Cost")&&(t.includes("FusionMaterial")?r.writeInfoLog(`${e.map(n=>n.nm).join(" ")}を融合素材とし――、`):t.includes("SyncroMaterial")?r.writeInfoLog(`${e.map(n=>n.nm).join(" ")}をシンクロと素材し――、`):t.includes("LinkMaterial")?r.writeInfoLog(`${e.map(n=>n.nm).join(" ")}をリンクマーカーにセッティング――、`):r.writeInfoLog(`${e.map(n=>n.nm).join(" ")}を墓地に送り――、`)),Be.bringManyToSameCellForTheSameReason("Graveyard","Top",e,"FaceUp","Vertical",t,a,r)):Promise.resolve()),u(Be,"addManyToHand",(e,t,a,r)=>e.length?(r&&t.includes("Cost")&&r.writeInfoLog(`${e.map(n=>n.nm).join(" ")}を手札から捨て――、`),Be.bringManyToSameCellForTheSameReason("Hand","Bottom",e,"FaceDown","Vertical",t,a,r)):Promise.resolve()),u(Be,"discardManyForTheSameReason",(e,t,a,r)=>e.length?(r&&t.includes("Cost")&&r.writeInfoLog(`${e.map(n=>n.nm).join(" ")}を手札から捨て――、`),Be.bringManyToSameCellForTheSameReason("Graveyard","Top",e,"FaceUp","Vertical",["Discard",...t],a,r)):Promise.resolve()),u(Be,"banishManyForTheSameReason",(e,t,a,r)=>e.length?(r&&t.includes("Cost")&&r.writeInfoLog(`${e.map(n=>n.nm).join(" ")}をゲームから除外し――、`),Be.bringManyToSameCellForTheSameReason("Banished","Top",e,"FaceUp","Vertical",t,a,r)):Promise.resolve()),u(Be,"returnManyToDeckForTheSameReason",(e,t,a,r,n)=>t.length?(n&&a.includes("Cost")&&n.writeInfoLog(`${t.map(s=>s.nm).join(" ")}をデッキに戻し――、`),Be.bringManyToSameCellForTheSameReason("Deck",e,t,"FaceDown","Vertical",a,r,n)):Promise.resolve()),u(Be,"returnManyToHandForTheSameReason",(e,t,a,r)=>e.length?(r&&t.includes("Cost")&&r.writeInfoLog(`${e.map(n=>n.nm).join(" ")}を手札に戻し――、`),Be.bringManyToSameCellForTheSameReason("Hand","Bottom",e,"FaceDown","Vertical",t,a,r)):Promise.resolve()),u(Be,"convertManyToXyzMaterials",(e,t,a,r)=>e.length?(r&&t.includes("Cost")&&r.writeInfoLog(`${e.map(n=>n.nm).join(" ")}によって、オーバーレイネットワークを構築――、`),De.moveMany(e.map(n=>[n,n.fieldCell,"XyzMaterial","FaceUp","Vertical","Top",t,a,r,r]))):Promise.resolve()),u(Be,"moveToXyzOwner",(e,t,a,r,n)=>t.length?(a.includes("Effect")&&n.writeInfoLog(`${t.map(s=>s.nm).join(" ")}をXYZ素材として吸収。`),De.moveMany(t.map(s=>[s,e,"XyzMaterial","FaceUp","Vertical","Top",a,r,n,n]))):Promise.resolve()),u(Be,"banishMany",(e,t)=>De.bringManyToSameCell("Banished","Top",e.map(a=>({...a,face:"FaceUp",orientation:"Vertical"})),t)),u(Be,"bringManyToSameCellForTheSameReason",(e,t,a,r,n,s,o,d)=>De.bringManyToSameCell(e,t,a.map(l=>({entity:l,face:r,orientation:n,causedAs:s,causedBy:o,activator:d})))),u(Be,"tryDestroy",async(e,t)=>{const a=await Be.tryMarkForDestory(e,t);return await Be.waitCorpseDisposal(t.activator.duel),a}),u(Be,"waitCorpseDisposal",e=>De.sendManyToGraveyard(e.field.getCardsOnField().filter(t=>t.info.isDying).map(t=>({entity:t,causedAs:t.info.causeOfDeath??[],causedBy:t.info.isKilledBy,activator:t.info.isKilledByWhom})))),u(Be,"tryMarkForDestory",async(e,t)=>{let a=e.filter(o=>Be._tryMarkForDestory(o,t));if(!a.length)return[];const r=t.action.playType==="Battle"?"BattleDestroy":"EffectDestroy";(await Promise.all(e[0].field.getAllEntities().flatMap(o=>o.substituteEffects.filter(d=>d.isMandatory).filter(d=>d.executableCells.includes(o.fieldCell.cellType)).filter(d=>d.isApplicableTo(r,e,t).length).flatMap(d=>d.substitute(r,e,t))))).flatMap(o=>o).forEach(o=>{o.resetCauseOfDeath()}),a=a.filter(o=>o.info.isDying);let n=e[0].field.getAllEntities().flatMap(o=>o.substituteEffects.filter(d=>!d.isMandatory).filter(d=>d.executableCells.includes(o.fieldCell.cellType)).filter(d=>d.isApplicableTo(r,e,t).length).map(d=>({chooser:o.owner,effect:d,sacrifice:o})));for(const o of n.map(d=>d.sacrifice.controller).getDistinct()){const d=n.filter(p=>p.sacrifice.controller===o),l=d.map(p=>ni.createDammyAction(p.sacrifice,p.effect.title,[])),c=await e[0].duel.view.waitSubAction(o,l,"身代わり効果を適用する？",!0);if(!c||!c.action)continue;const v=d.filter(p=>{var h;return p.effect.title===((h=c.action)==null?void 0:h.title)}).find(p=>{var h;return p.sacrifice===((h=c.action)==null?void 0:h.entity)});if(!v)throw new ve("想定されない状態",c,l,a);if((await v.effect.substitute(r,a,t)).forEach(p=>{p.resetCauseOfDeath()}),a=a.filter(p=>p.info.isDying),!a.length)return[];n=n.filter(p=>p.effect.isApplicableTo(r,e,t).length)}const s=a.filter(o=>o.info.isDying);return s.forEach(o=>o.duel.log.info(`${o.toString()}を${Wo[r]}。`,o.info.isKilledByWhom)),s}),u(Be,"tryBanish",async(e,t,a)=>{const r=t.filter(n=>n.canBeBanished(e,a.activator,a.action.entity,a.action));return await Be.banishManyForTheSameReason(r,["Effect"],a.action.entity,a.activator),r.filter(n=>n.fieldCell.cellType==="Banished").filter(n=>n.moveLog.latestRecord.movedBy===a.action.entity)}),u(Be,"negateSummonMany",(e,t)=>{const a=t.duel.field.getPendingMonstersOnField();return a.forEach(r=>{r.info.summonKinds=[],r.info.materials=[],r.moveLog.negateSummon(e,t)}),t.writeInfoLog(`${a.map(r=>r.toString()).join(" ")}.の召喚は無効にされた。`),a});let pe=Be;const ro=["NormalSummon","SpecialSummon","FlipSummon"],xr=["IgnitionEffect","TriggerEffect","QuickEffect","CardActivation"],no=["ChangeBattlePosition","Battle","SpellTrapSet","LingeringEffect"],so=i=>i==="CardActivation"?"CardActivation":xr.some(e=>e===i)?"EffectActivation":"NonActivate",Ir=["NormalSummon","AdvanceSummon","SpecialSummon","SpecialSummonFromDeck","SendToGraveyardFromDeck","Draw","SearchFromDeck","BanishFromDeck","BanishFromGraveyard","AddToHandFromGraveyard","ReturnToDeckFromGraveyard","SpecialSummonFromGraveyard","SpecialSummonFromBanished","ReturnToHandFromGraveyard","ReturnToHandFromField","BanishFromField","BanishFromHand","Destroy","DestroyMultiple","DestroyOnField","DestroyMultipleOnField","DestroyOnOpponentField","DestroyMultipleOnOpponentField","DestroyMonsterOnField","DestroyMonstersOnField","DestroySpellTrapOnField","DestroySpellTrapsOnField","SpecialSummonFromHand","SpecialSummonFromExtraDeck","IfNormarlSummonSucceed","IfSpecialSummonSucceed","DamageToOpponent","DamageToSelf","PayLifePoint","DiscordAsCost","DiscordAsEffect","RollDice","BounceToHand","NegateCardEffect","NegateCardActivation","NegateNormalSummon","NegateSpecialSummon"],Xt=class Xt extends ga{constructor(t,a,r,n){super(t,a,r);u(this,"toString",()=>this.isWithChainBlock?` «${this.title}»`:this.title);u(this,"addhocMateriallimitation");u(this,"getClone",t=>new Xt(this.seq,this.entity,this.definition,t));u(this,"getEnableMaterialPatterns",t=>{var a,r;return((r=(a=this.definition).getEnableMaterialPatterns)==null?void 0:r.call(a,t).filter(this.addhocMateriallimitation))??[]});u(this,"validate",(t,a,r)=>{if(this.playType==="CardActivation"&&this.entity.isOnField&&this.entity.face==="FaceUp"||r&&this.needsToPayCost||this.isOnlyNTimesPerDuel>0&&this.entity.field.duel.chainBlockLog.records.filter(l=>!l.chainBlockInfo.isNegatedActivationBy).filter(l=>this.isSameGroupPerTurn(l.chainBlockInfo.action)).filter(l=>l.chainBlockInfo.activator===t).length>=this.isOnlyNTimesPerDuel||this.isOnlyNTimesPerTurn>0&&this.entity.field.duel.chainBlockLog.records.filter(l=>!l.chainBlockInfo.isNegatedActivationBy).filter(l=>this.isSameGroupPerTurn(l.chainBlockInfo.action)).filter(l=>l.clock.turn===this.entity.field.duel.clock.turn).filter(l=>l.chainBlockInfo.activator===t).length>=this.isOnlyNTimesPerTurn)return;const n=a.filter(l=>l.action.seq===this.seq).length;if(this.isOnlyNTimesPerChain>0&&n>=this.isOnlyNTimesPerChain)return;const s=n+this.entity.counterHolder.getActionCount(this);if(this.isOnlyNTimesPerTurnIfFaceup>0&&s>=this.isOnlyNTimesPerTurnIfFaceup||this.isOnlyNTimesIfFaceup>0&&s>=this.isOnlyNTimesIfFaceup)return;const o=ha(0,...a.map(l=>l.chainNumber??-1)),d={index:a.length,chainNumber:this.isWithChainBlock?o+1:void 0,action:this,activator:t,targetChainBlock:a.slice(-1)[0],isActivatedIn:this.entity.fieldCell,isActivatedAt:this.duel.clock.getClone(),costInfo:{},state:"unloaded",dest:void 0,ignoreCost:!1};if(!(this.definition.canPayCosts&&!r&&!this.definition.canPayCosts(d,a)))return this.definition.validate(d,a)});u(this,"prepare",async(t,a,r,n,s,o)=>{var h,m;let d=s;this.isLikeContinuousSpell&&(this.entity.info.isPending=!0);const l=this.isWithChainBlock?ha(0,...n.map(C=>C.chainNumber??-1))+1:void 0;let c="";if(l!==void 0&&(c+=`チェーン${l}: `),this.playType==="CardActivation"||this.playType==="SpellTrapSet")if(this.entity.fieldCell.cellType==="Hand"){let C=a?[a]:this.entity.status.spellCategory==="Field"?[t.getFieldZone()]:t.getAvailableSpellTrapZones();if(this.entity.status.spellCategory==="Field"){const S=t.getFieldZone().cardEntities;if(S.length){const k=S[0];await pe.sendManyToGraveyardForTheSameReason(t.getFieldZone().cardEntities,["Rule"],this.entity,t),t.writeInfoLog(`フィールド魔法の上書きにより、${k.toString()}は墓地に送られた。`),d=!1}}(h=this.entity.status.monsterCategories)!=null&&h.includes("Pendulum")&&(C=C.filter(S=>S.isAvailableForPendulum));let y=C[0];if(C.length>1){y=C.randomPick();const S=this.playType==="SpellTrapSet"?"セット":"カードの発動",k=await this.duel.view.waitDammyActions(t,this.entity,C,"カードを移動先へドラッグ",S,d);if(!k)return;y=k}c+="手札から",this.playType==="SpellTrapSet"?c+="魔法・罠カードをセット。":c+=`${this.entity.toString()}を発動。`,t.writeInfoLog(c),(m=this.entity.status.monsterCategories)!=null&&m.includes("Pendulum")?await this.entity.activateAsPendulumScale(y,["CardActivation"],this.entity,t):this.playType==="CardActivation"?await this.entity.activateSpellTrapFromHand(y,this.entity.status.kind,["CardActivation"],this.entity,t):await this.entity.setAsSpellTrap(y,this.entity.status.kind,["SpellTrapSet"],this.entity,t),d=!1}else this.entity.isOnFieldAsSpellTrap&&this.entity.face==="FaceDown"&&(c+=`セットされていた${this.entity.toString()}を発動。`,t.writeInfoLog(c),await this.entity.setNonFieldMonsterPosition(this.entity.origin.kind,"FaceUp",["Rule"]),d=!1);else l!==void 0&&(c+=`${this.entity.toString()}の効果、${this.toString()}を発動。`,t.writeInfoLog(c));const v={index:n.length,chainNumber:l,action:this,activator:t,targetChainBlock:r,isActivatedIn:this.entity.fieldCell,isActivatedAt:this.duel.clock.getClone(),costInfo:{},state:"ready",dest:a,ignoreCost:!1};if(this.definition.payCosts&&!o){const C=await this.definition.payCosts(v,n,d);if(!C)return;v.costInfo=C}const p=await this.definition.prepare(v,n,d);if(p!==void 0)return console.log(this.entity.toString(),p),{...v,...p}});u(this,"execute",async(t,a)=>{if(t.action.isLikeContinuousSpell&&!t.action.entity.isOnField)return this.entity.info.isPending=!1,!1;const r=await this.definition.execute(t,a);if(t.action.isLikeContinuousSpell)for(const n of this.entity.continuousEffects)this.entity.info.isPending=!1,await n.updateState();return r});u(this,"settle",(t,a)=>(this.isOnlyNTimesPerTurnIfFaceup>0?this.entity.counterHolder.incrementActionCountPerTurn(this):this.isOnlyNTimesIfFaceup>0&&this.entity.counterHolder.incrementActionCount(this),this.definition.settle(t,a)));u(this,"directExecute",async(t,a)=>{const r=await this.prepare(t,void 0,void 0,[],!1,a);if(!r)throw new ve("想定されない状態",this,t,a);const n=await this.execute(r,[]);return this.settle(r,[]),n});u(this,"isSame",t=>this.entity.origin.name===t.entity.origin.name&&this.title===t.title);u(this,"isSameGroupPerTurn",t=>this.actionGroupNamePerTurn?this.entity.origin.name===t.entity.origin.name&&this.actionGroupNamePerTurn===t.actionGroupNamePerTurn:this.isSame(t));u(this,"calcChainBlockTagsForDestroy",t=>{if(!Ir.length)return[];const a=["Destroy"];Ir.length>1&&a.push("DestroyMultiple");const r=t.filter(d=>d.isOnField);r.length&&(a.push("DestroyOnField"),r.length>1&&a.push("DestroyMultipleOnField"));const n=r.filter(d=>d.status.kind==="Monster");n.length&&(a.push("DestroyMonsterOnField"),n.length>1&&a.push("DestroyMonstersOnField")),r.filter(d=>d.status.kind!=="Monster").length&&(a.push("DestroySpellTrapOnField"),n.length>1&&a.push("DestroySpellTrapsOnField"));const o=r.filter(d=>d.controller!==this.entity.controller);return o.length&&(a.push("DestroyOnOpponentField"),o.length>1&&a.push("DestroyMultipleOnOpponentField")),a});this.addhocMateriallimitation=n??(()=>!0)}get definition(){return super.definition}get playType(){return this.definition.playType}get spellSpeed(){return this.definition.spellSpeed}get needsToPayCost(){return this.definition.needsToPayCost??!1}get hasToTargetCards(){return this.definition.hasToTargetCards??!1}get isWithChainBlock(){return xr.some(t=>t===this.playType)}get isLikeContinuousSpell(){return this.definition.isLikeContinuousSpell||this.entity.isLikeContinuousSpell&&this.playType==="CardActivation"}get negatePreviousBlock(){return this.definition.negatePreviousBlock??!1}get negateSummon(){return this.definition.negateSummon??!1}get priorityForNPC(){return this.definition.priorityForNPC??Number.NaN}};u(Xt,"createNew",(t,a)=>new Xt("AutoSeq",t,a)),u(Xt,"createDammyAction",(t,a,r,n)=>{const s=Xt.createNew(t,{title:a,isMandatory:!1,executableCells:[],executablePeriods:[],executableDuelistTypes:[],playType:"Dammy",spellSpeed:"Dammy",validate:()=>r,prepare:async()=>{},execute:async()=>!1,settle:async()=>!1});return s.pos=n,s.cell=r[0],s.dragAndDropOnly=r.length>1,s});let ni=Xt;const Ca=class Ca{constructor(e,t,a,r,n,s=[]){u(this,"duel");u(this,"seat");u(this,"_entity");u(this,"profile");u(this,"deckInfo");u(this,"info");u(this,"infoOrigin");u(this,"status");u(this,"statusOrigin");u(this,"duelistType");u(this,"lifeLog");u(this,"actionBlackListForNPC");u(this,"_lp");u(this,"initHand");u(this,"writeInfoLog",e=>{this.duel.log.info(e,this)});u(this,"initForDrawPhase",()=>{this.info={...this.infoOrigin}});u(this,"canDiscard",e=>(console.log(e),!0));u(this,"canSendToGraveyard",e=>(console.log(e),!0));u(this,"canRelease",e=>(console.log(e),!0));u(this,"canTryBanish",(e,t,a)=>this.entity.procFilterBundle.operators.filter(r=>r.procTypes.includes(t)).every(r=>r.filter(this,this.entity,a,[e])));u(this,"battleDamage",(e,t)=>this.setLp(this._lp-e,t,"BattleDamage"));u(this,"effectDamage",(e,t)=>this.setLp(this._lp-e,t,"EffectDamage"));u(this,"lostLp",(e,t)=>this.setLp(this._lp-e,t,"Lost"));u(this,"payLp",(e,t)=>this.setLp(this._lp-e,t,"Pay"));u(this,"heal",(e,t)=>this.setLp(this._lp+e,t,"Heal"));u(this,"setLp",(e,t,a)=>{const r={clock:this.duel.clock,reason:a||"Set",beforeLp:this._lp,afterLp:e,entity:t};return this.lifeLog.push(r),this._lp=e,this.writeInfoLog(`ライフポイント変動：${r.afterLp-r.beforeLp}（${r.beforeLp} ⇒ ${r.afterLp}）`),r});u(this,"getOpponentPlayer",()=>this.duel.firstPlayer===this?this.duel.secondPlayer:this.duel.firstPlayer);u(this,"getHandCell",()=>this.duel.field.getCells("Hand").filter(e=>e.owner===this)[0]);u(this,"getDeckCell",()=>this.duel.field.getCells("Deck").filter(e=>e.owner===this)[0]);u(this,"getExtraDeck",()=>this.duel.field.getCells("ExtraDeck").filter(e=>e.owner===this)[0]);u(this,"getGraveyard",()=>this.duel.field.getCells("Graveyard").filter(e=>e.owner===this)[0]);u(this,"getFieldZone",()=>this.duel.field.getCells("FieldSpellZone").filter(e=>e.owner===this)[0]);u(this,"getBanished",()=>this.duel.field.getCells("Banished").filter(e=>e.owner===this)[0]);u(this,"getMonsterZones",()=>this.duel.field.getCells("MonsterZone").filter(e=>e.owner===this));u(this,"getExtraMonsterZones",()=>this.duel.field.getCells("ExtraMonsterZone").filter(e=>{var t;return((t=e.cardEntities[0])==null?void 0:t.controller)===this}));u(this,"getSpellTrapZones",()=>this.duel.field.getCells("SpellAndTrapZone").filter(e=>e.owner===this));u(this,"getXyzMaterialZone",()=>this.duel.field.getCells("XyzMaterialZone").filter(e=>e.owner===this)[0]);u(this,"getEmptyMonsterZones",()=>this.getMonsterZones().filter(e=>e.cardEntities.length===0));u(this,"getEmptyExtraZones",()=>this.getExtraMonsterZones().length===0?this.getMonsterZones().filter(e=>e.cardEntities.length===0):[]);u(this,"getAvailableMonsterZones",()=>this.getMonsterZones().filter(e=>e.isAvailable));u(this,"getAvailableExtraZones",()=>this.getExtraMonsterZones().length===0?this.duel.field.getCells("ExtraMonsterZone").filter(e=>e.isAvailable):[]);u(this,"getAvailableSpellTrapZones",()=>this.getSpellTrapZones().filter(e=>e.isAvailable));u(this,"getReleasableMonsters",()=>this.getMonstersOnField());u(this,"getMonstersOnField",()=>this.duel.field.getMonstersOnField().filter(e=>e.controller===this));u(this,"getEntiteisOnField",()=>this.duel.field.getCardsOnField().filter(e=>e.controller===this));u(this,"pushDeck",()=>{this.deckInfo.cardNames.map(e=>rt[e]).filter(e=>e).forEach(e=>De.createCardEntity(this,e)),this.duel.log.info(`デッキをセット。メイン${this.getDeckCell().cardEntities.length}枚。エクストラ${this.getExtraDeck().cardEntities.length}枚。`,this)});u(this,"draw",async(e,t,a)=>{var s;if(e<1)return;const r=this.getDeckCell(),n=[];this.writeInfoLog(`デッキからカードを${e}枚ドロー。`);for(const o of Array(e)){if(!r.cardEntities.length)throw this.writeInfoLog(n.length>0?`デッキからカードを${e}枚ドローしようとしたが、${n.length}枚しかドローできなかった。${n}`:"デッキからカードをドローできなかった。"),this.duel.isEnded=!0,this.setLp(0),new ti(this.getOpponentPlayer());const d=r.cardEntities[0];await d.draw(t?["Effect"]:["Rule"],t,a),n.push(((s=d.origin)==null?void 0:s.name)||"!名称取得失敗!")}});u(this,"discard",async(e,t,a,r,n,s)=>{const o=n||(()=>!0),d=this.getHandCell().cardEntities.filter(o);if(d.length<e)return[];let l=[];return(r||this).duelistType==="NPC"?l=d.randomPickMany(e):l=await this.duel.view.waitSelectEntities(r||this,d,e,c=>c.length===e,`${e}枚カードを捨てる。`,!1)||[],this.writeInfoLog(`手札からカードを${l.length}枚捨てた。${l.map(c=>{var v;return(v=c.origin)==null?void 0:v.name})}。`),await pe.discardManyForTheSameReason(l,["Discard",...t],a,s),l});u(this,"getEnableSummonList",(e,t,a,r,n,s,o)=>{const d=this.duel.field.getCells("ExtraMonsterZone"),l=d.filter(v=>!s.map(p=>p.material).includes(v.cardEntities[0])).filter(v=>v.owner===this),c=[];return l.length&&c.push(...d.filter(v=>!l.includes(v)).filter(v=>v.isAvailable)),n.map(v=>({...v,summoner:this})).map(v=>{var p;return this.duel.field.canExtraLink(v.monster,s)||(v.cells=v.cells.filter(h=>!c.includes(h))),(p=v.monster.status.monsterCategories)!=null&&p.includes("Link")&&(v.posList=v.posList.filter(h=>h==="Attack")),v}).map(v=>({...v,cells:v.cells.filter(p=>p.cardEntities.length===0||s.some(h=>h.material===p.cardEntities[0]))})).filter(v=>v.cells.length&&v.posList.length).map(v=>this.entity.summonFilterBundle.filter(e,t,a,r,v,s,o)).filter(v=>v.cells.length&&v.posList.length).map(v=>v.monster.summonFilterBundle.filter(e,t,a,r,v,s,o)).filter(v=>v.cells.length&&v.posList.length).map(v=>s.map(p=>p.material.summonFilterBundle).reduce((p,h)=>h.filter(e,t,a,r,v,s,o),v)).filter(v=>v.cells.length&&v.posList.length)});u(this,"prepareToSummonMany",async(e,t,a,r,n,s,o,d,l,c="特殊召喚するモンスターを選択。")=>{const v=this.getEnableSummonList(e,t,a,r,n,s,o);if(!v.length)return[];let p=v.map(m=>m.monster);if(console.log(n,d([])),n.length!==1||d([])){console.log(n,d);const m=await this.duel.view.waitSelectEntities(this,p,void 0,d,c,l);console.log(m),p=m??[],console.log(n,d)}console.log(v,p);const h=[];for(const m of v.filter(C=>p.includes(C.monster))){const C=m.cells.filter(k=>!h.map(P=>P.dest).includes(k));if(!C.length)continue;let y=[...m.posList].randomPick(),S=C.randomPick();if((C.length>1||m.posList.length>1)&&this.duelistType!=="NPC"){const k=C.length>1?"カードを召喚先へドラッグ。":"表示形式を選択。",P=m.posList.map(q=>ni.createDammyAction(m.monster,q,C,q)),O=this.duel.view.modalController.selectAction(this.duel.view,{title:k,activator:this,actions:P,cancelable:!1}),T=this.duel.view.waitSubAction(this,P,k,l).then(q=>q.action),D=await Promise.any([O,T]);if(!D)throw new ve("想定されない状態",v,p,h);S=D.cell||S,y=D.pos||y}h.push({summoner:this,monster:m.monster,pos:y,dest:S})}return h});u(this,"summonAll",(e,t,a,r,n,s,o,d,l)=>this.summonMany(e,t,a,r,n,s,o,c=>c.length===n.length,d,l));u(this,"summonMany",(e,t,a,r,n,s,o,d,l,c)=>Ca.summonMany(e,t,a,r,n.map(v=>({...v,summoner:this})),s,o,d,l,c));u(this,"selectAttackTargetForNPC",(e,t)=>{const a=e.atk??0,r=e.getAttackTargets();if(!r.length)return;const n=r.find(s=>s.entityType==="Duelist");return n&&(a>=ar(1600,this.getOpponentPlayer().lp)||e.info.battlePotisionChangeCount>0)?n:r.find(s=>s.battlePosition==="Attack"?a>=(s.atk??0):a<(s.battlePosition==="Set"?1e3:s.def??0)?!1:s.validateDestory("BattleDestroy",this,e,t))});u(this,"selectActionForNPC",(e,t)=>{if(!e.length)return;const a=e.filter(y=>y.isMandatory);if(a.length)return a.randomPick();let r=e.filter(y=>!this.actionBlackListForNPC.includes(y.playType));const n=r.filter(y=>!Number.isNaN(y.priorityForNPC)).shuffle().sort((y,S)=>y.priorityForNPC-S.priorityForNPC);if(n.length)return n[0];const s=r.filter(y=>y.playType==="TriggerEffect");if(s.length)return s.randomPick();if(this.duel.phase!=="main1"&&this.duel.phase!=="main2"){const y=r.filter(S=>S.playType==="IgnitionEffect");if(y.length)return y.randomPick()}const o=r.filter(y=>y.playType==="Battle").sort((y,S)=>(y.entity.atk??0)-(S.entity.atk??0));if(o.length)return o.find(y=>this.selectAttackTargetForNPC(y.entity,y));r=r.filter(y=>y.playType!=="Battle");const d=r.length?t.slice(-1)[0]:void 0,l=r.filter(y=>y.negatePreviousBlock);if(d&&d.activator!==this&&l)return l.randomPick();if(r=r.filter(y=>!y.negatePreviousBlock),!r.length)return;const c=ha(...this.getOpponentPlayer().getMonstersOnField().filter(y=>y.battlePosition==="Attack").map(y=>y.atk??0),1600),v=ar(...this.getOpponentPlayer().getMonstersOnField().map(y=>y.battlePosition==="Set"?1500:(y.battlePosition==="Attack"?y.atk:y.def)??0),1500),p=this.getMonstersOnField(),h=ha(...p.filter(y=>y.battlePosition==="Attack").map(y=>y.atk??0),0);let m=r.filter(y=>y.playType!=="ChangeBattlePosition").filter(y=>y.entity.battlePosition!=="Attack").filter(y=>(y.entity.atk??0)>=c||(y.entity.atk??0)>v&&(y.entity.atk??0)>2300);if(m.length)return m.randomPick();r=r.filter(y=>y.playType!=="ChangeBattlePosition").filter(y=>y.playType!=="SpellTrapSet").filter(y=>y.entity.actions.filter(S=>S.playType!=="NormalSummon"&&S.playType!=="SpecialSummon").flatMap(S=>S.executableCells).every(S=>S!=="Hand")||y.playType!=="NormalSummon"&&y.playType!=="SpecialSummon");const C=[...r.filter(y=>y.playType==="NormalSummon").filter(y=>(y.entity.lvl??12)<5),...r.filter(y=>y.playType==="SpecialSummon"),...r.filter(y=>y.playType==="NormalSummon").filter(y=>(y.entity.atk??0)>2600||(y.entity.atk??0)>2300&&(y.entity.lvl??12)<7).filter(y=>(y.entity.atk??0)>=h),...r.filter(y=>y.entity.face==="FaceUp").filter(y=>y.entity.isOnField)];if(C.length)return C.randomPick();if(r=r.filter(y=>y.playType!=="NormalSummon").filter(y=>y.playType!=="SpecialSummon"),this.duel.phase==="main2"){if(m=e.filter(y=>y.playType==="ChangeBattlePosition").filter(y=>y.entity.battlePosition==="Attack").filter(y=>(y.entity.atk??0)<c||(y.entity.atk??0)>v&&(y.entity.atk??0)>2300),m.length)return m.randomPick();if(this.getAvailableSpellTrapZones.length>1)return e.filter(y=>y.playType==="SpellTrapSet").filter(y=>y.entity.status.kind!=="Spell"||y.entity.status.spellCategory==="QuickPlay").randomPick()}if(Math.random()<r.length/4)return r.randomPick()});this.duel=e,this.seat=t,this.profile=a,this.duelistType=r,this.deckInfo=n,this.initHand=s,this.lifeLog=[],this.infoOrigin={maxRuleNormalSummonCount:1,ruleNormalSummonCount:0,ruleNormalSummonCountQty:0,effectNormalSummonCount:0,effectNormalSummonCountQty:0,specialSummonCount:0,specialSummonCountQty:0},this.info={...this.infoOrigin},this.statusOrigin={maxSpecialSummonCount:Number.MAX_VALUE,canDrawByEffect:!0,canSearchFromDeck:!0,canDiscardAsCost:!0,canDiscardAsEffect:!0},this.status={...this.statusOrigin},this._lp=8e3;const o=[];this.duelistType==="NPC"&&(this.profile.npcLvl<1&&o.push("CardActivation","IgnitionEffect","TriggerEffect","QuickEffect"),this.profile.npcLvl<101&&o.push("Battle")),this.actionBlackListForNPC=o}get entity(){const e=this.getHandCell().entities.find(t=>t.entityType==="Duelist");return e||De.createPlayerEntity(this)}get lp(){return this._lp}get isTurnPlayer(){return this.duel.getTurnPlayer()===this}get canDraw(){return!0}get canAddToHandFromDeck(){return!0}};u(Ca,"summonMany",async(e,t,a,r,n,s,o,d,l,c="特殊召喚するモンスターを選択。")=>{const v=n.map(h=>h.summoner).getDistinct(),p=[];console.log(p);for(const h of v){const m=await h.prepareToSummonMany(e,t,a,r,n.filter(C=>C.summoner===h),s,o,d,l,c);console.log(m),p.push(...m)}if(p.length)return p.forEach(h=>h.monster.info.materials.reset(...s)),await pe.moveToXyzOwner(p[0].dest,s.map(h=>h.material).filter(h=>h.status.kind==="XyzMaterial"),["XyzMaterial","Rule"],p[0].monster,e),await De.summonMany(p,t,a,r.entity,e),p.map(h=>h.monster)});let si=Ca;const Kn=["Deck","ExtraDeck"],Xn=["Graveyard","Banished"],Jn=[...Kn,...Xn],lo=[...Jn,"Hand"],st=["MonsterZone","ExtraMonsterZone"],Yt=["SpellAndTrapZone","FieldSpellZone"],li=[...st,...Yt],In=["XyzMaterialZone","Disable"],bi=[...lo,...li,...In],nr={0:{0:"Hand"},1:{0:"Deck",1:"SpellAndTrapZone",2:"SpellAndTrapZone",3:"SpellAndTrapZone",4:"SpellAndTrapZone",5:"SpellAndTrapZone",6:"ExtraDeck"},2:{0:"Graveyard",1:"MonsterZone",2:"MonsterZone",3:"MonsterZone",4:"MonsterZone",5:"MonsterZone",6:"FieldSpellZone"},3:{0:"Banished",1:"XyzMaterialZone",2:"ExtraMonsterZone",3:"Disable",4:"ExtraMonsterZone",5:"XyzMaterialZone",6:"Banished"},4:{0:"FieldSpellZone",1:"MonsterZone",2:"MonsterZone",3:"MonsterZone",4:"MonsterZone",5:"MonsterZone",6:"Graveyard"},5:{0:"ExtraDeck",1:"SpellAndTrapZone",2:"SpellAndTrapZone",3:"SpellAndTrapZone",4:"SpellAndTrapZone",5:"SpellAndTrapZone",6:"Deck"},6:{0:"Hand"}};let oo=class{constructor(e,t,a,r){u(this,"onUpdateEvent",new Ke);u(this,"field");u(this,"row");u(this,"column");u(this,"cellType");u(this,"_owner");u(this,"_requiresRecalcArrowheads");u(this,"_arrowheadSources");u(this,"_needsShuffle",!1);u(this,"recalcArrowheads",()=>{this.isMonsterZoneLikeCell&&(this._requiresRecalcArrowheads=!1,this._arrowheadSources=this.neighbors.filter(e=>e.isMonsterZoneLikeCell).filter(e=>e.cardEntities.length).filter(e=>e.cardEntities[0].arrowheads.some(t=>this.row===e.row+t.offsetRow&&this.column===e.column+t.offsetColumn)).map(e=>e.cardEntities[0]))});u(this,"_entities");u(this,"releaseEntities",e=>{var t;return this._entities=this._entities.filter(a=>a!==e),this.isMonsterZoneLikeCell&&((t=e.origin.monsterCategories)!=null&&t.includes("Link"))&&(this._requiresRecalcArrowheads=!0),this.onUpdateEvent.trigger(),e});u(this,"acceptEntities",(e,t)=>{var a;t==="Top"?this._entities.unshift(e):this._entities.push(e),t==="Random"&&(this._needsShuffle=!0),this._entities.forEach(r=>{r.fieldCell=this}),this.isMonsterZoneLikeCell&&((a=e.origin.monsterCategories)!=null&&a.includes("Link"))&&(this._requiresRecalcArrowheads=!0),this.onUpdateEvent.trigger()});u(this,"shuffle",()=>{this._entities=this.entities.shuffle(),this._needsShuffle=!1,this.field.duel.log.info("デッキをシャッフル。",this.owner)});u(this,"toString",()=>this.isMonsterZoneLikeCell||this.cellType==="SpellAndTrapZone"?`${this.cellType}(${this.row},${this.column})`:this.cellType);this.field=e,this.row=t,this.column=a,this.cellType=nr[t][a],this._owner=r,this._entities=[],this._arrowheadSources=[],this._requiresRecalcArrowheads=!1}get onUpdate(){return this.onUpdateEvent.expose()}get owner(){var e;return this._owner||((e=this.cardEntities[0])==null?void 0:e.owner)}get requiresRecalcArrowheads(){return this._requiresRecalcArrowheads}get arrowheadSources(){return this._arrowheadSources}get needsShuffle(){return this._needsShuffle}get entities(){return this._entities}get visibleEntities(){return this._entities.filter(e=>an.find(t=>t===e.entityType))}get cardEntities(){return this._entities.filter(e=>an.find(t=>t===e.entityType)).filter(e=>e.status.kind!=="XyzMaterial")}get xyzMaterials(){return this._entities.filter(e=>e.status.kind==="XyzMaterial")}get targetForAttack(){return this.cellType==="Hand"?this._entities.find(e=>e.entityType==="Duelist"):this.cardEntities[0]}get isAvailable(){return this.cardEntities.length===0&&this._entities.filter(e=>Yo.find(t=>t===e.entityType)).length===0}get isAvailableForPendulum(){return this.isAvailable&&this.isSpellTrapZoneLikeCell&&(this.column===1||this.column===5)}get isStackCell(){return Jn.some(e=>e===this.cellType)}get isPlayFieldCell(){return li.some(e=>e===this.cellType)}get isMonsterZoneLikeCell(){return st.some(e=>e===this.cellType)}get isSpellTrapZoneLikeCell(){return Yt.some(e=>e===this.cellType)}get isDisabledCell(){return In.some(e=>e===this.cellType)}get neighbors(){const e=[this.row-1,this.row,this.row+1].filter(a=>a>=0&&a<=6),t=[this.column-1,this.column,this.column+1].filter(a=>a>=0&&a<=6);return e.flatMap(a=>t.map(r=>this.field.cells[a][r])).filter(a=>a.isMonsterZoneLikeCell).filter(a=>a!==this)}};class qa{constructor(){u(this,"pooledOperators",[]);u(this,"bundles",[]);u(this,"excludesExpired",()=>{this.bundles=this.bundles.filter(e=>!e.entity.hasDisappeared),this.bundles.forEach(e=>e.excludesExpired()),this.pooledOperators=this.pooledOperators.filter(e=>e.validateAlive())});u(this,"append",e=>{this.bundles.push(e)});u(this,"push",e=>{if(!e.isContinuous)throw new ve("staticへの追加は永続以外不可",e);this.excludesExpired(),this.distribute(e),this.pooledOperators.push(e)});u(this,"distributeAll",e=>(this.excludesExpired(),this.pooledOperators.flatMap(this.distribute).getDistinct().forEach(t=>t.operators.sort((a,r)=>a.seq-r.seq)),this.afterDistributeAll(e)));u(this,"distribute",e=>this.bundles.filter(t=>t.operators.every(a=>a.seq!==e.seq)).filter(t=>e.isApplicableTo(t.entity)).filter(t=>t.entity.canBeEffected(e.effectOwner,e.isSpawnedBy,e.actionAttr)).map(t=>(t.push(e),t)));u(this,"removeItem",e=>{this.pooledOperators=this.pooledOperators.filter(t=>t.seq!==e)})}}class Na{constructor(e,t){u(this,"pool");u(this,"entity");u(this,"_operators");u(this,"excludesExpired",()=>{this._operators=this._operators.filter(e=>{const t=e.validateAlive()&&e.isApplicableTo(this.entity);return t||(console.info(`before remove ${this.entity.toString} ${e.title}`),e.beforeRemove(this)),t})});u(this,"push",e=>{this.entity.procFilterBundle.operators.filter(t=>t.procTypes.includes("Effect")).some(t=>!t.filter(t.effectOwner,t.isSpawnedBy,t.actionAttr,[]))||(this.beforePush(e),this._operators.push(e))});u(this,"removeItem",e=>{this._operators=this._operators.filter(t=>t.seq!==e?!0:(t.beforeRemove(this),!1))});this.pool=e,this.entity=t,this._operators=[],this.pool.append(this)}get operators(){return this._operators}}const ba=class ba{constructor(e,t,a,r,n,s){u(this,"seq");u(this,"title");u(this,"validateAlive");u(this,"isContinuous");u(this,"isSpawnedBy");u(this,"isSpawnedAt");u(this,"activateType");u(this,"actionAttr");u(this,"isApplicableTo");u(this,"effectOwner");this.seq=ba.nextSeq++,this.title=e,this.validateAlive=()=>t(this),this.isContinuous=a,this.isSpawnedBy=r,this.isSpawnedAt=r.duel.clock.getClone(),this.isApplicableTo=o=>s(this,o),this.actionAttr=n,this.activateType=this.actionAttr.playType?so(this.actionAttr.playType):"NonActivate",this.effectOwner=this.isSpawnedBy.controller}get isEffective(){return!this.isContinuous||this.activateType==="NonActivate"?!0:this.isSpawnedBy.isEffective}};u(ba,"nextSeq",0);let Ei=ba;class co extends qa{constructor(){super(...arguments);u(this,"afterDistributeAll",()=>this.bundles.every(t=>t.applyEffectFilter()))}}class uo extends Na{constructor(){super(...arguments);u(this,"applyEffectFilter",()=>{const t=this.entity.allStickyEffectOperators.length,a=[];for(;;){const r=this.operators.filter(n=>n.procTypes.includes("Effect")).filter(n=>n.isContinuous).find(n=>!a.includes(n.seq));if(!r)break;a.push(r.seq),r.eraseOperators(this.entity)}return this.entity.allStickyEffectOperators.length===t});u(this,"beforePush",t=>t.eraseOperators(this.entity))}}const mi=class mi extends Ei{constructor(t,a,r,n,s,o,d,l){super(t,a,r,n,s,o);u(this,"beforeRemove",()=>{});u(this,"procTypes");u(this,"filter");u(this,"eraseOperators",t=>{if(!this.procTypes.includes("Effect"))return 0;console.log("ここはまだ通らない想定");const a=t.allStickyEffectOperators.filter(r=>r.isContinuous).filter(r=>!this.filter(r.effectOwner,r.isSpawnedBy,r.actionAttr,[])).map(r=>r.seq);return a.forEach(t.procFilterBundle.removeItem),a.forEach(t.statusOperatorBundle.removeItem),a.forEach(t.numericOprsBundle.removeItem),a.length});this.procTypes=d,this.filter=l}};u(mi,"createContinuous",(t,a,r,n,s,o,d)=>new mi(t,a,!0,r,n,s,o,d)),u(mi,"createLingering",(t,a,r,n,s,o,d)=>new mi(t,a,!1,r,n,s,o,d));let ya=mi;const en={level:1,rank:1,attack:0,defense:0,pendulumScaleR:0,pendulumScaleL:0};class vo extends qa{constructor(){super(...arguments);u(this,"afterDistributeAll",t=>{if(this.bundles.forEach(r=>r.calcStateAll()),t.field.getMonstersOnField().flatMap(r=>r.numericOprsBundle).flatMap(r=>r.operators).some(r=>r.targetStateGen==="calculated")){const n=t.field.getMonstersOnField().filter(s=>(s.atk??0)>=0).map(s=>s.atk??0).reduce((s,o)=>s>o?s:o,0);t.field.getMonstersOnField().forEach(s=>{s.numericOprsBundle.operators.filter(o=>o.targetStateGen==="calculated").forEach(o=>{var d;if(!((d=s.status.monsterCategories)!=null&&d.includes("Link")&&o.targetState==="defense")){if(o.stateOperationType==="THE_DEVILS_AVATAR"){s.numericStatus.calculated[o.targetState]=n+100;return}console.log(s.toString(),s.numericStatus.calculated[o.targetState]),s.numericStatus.calculated[o.targetState]=o.calcValue(s,s.numericStatus.calculated[o.targetState]??0)}})})}return!0})}}class fo extends Na{constructor(){super(...arguments);u(this,"beforePush",t=>{const a=this.operators.filter(n=>n.targetState===t.targetState).filter(n=>n.isEffective);if(t.kind==="O-L-F"||t.kind==="O-C-F"?(a.filter(n=>n.kind==="O-L-F").forEach(n=>n.negate()),a.filter(n=>n.kind==="L-F").forEach(n=>n.negate())):t.kind==="L-F"||t.kind==="C-F"?a.filter(n=>n.kind==="L-F"||n.kind==="L-A").forEach(n=>n.negate()):t.kind==="X-C-X"&&a.filter(n=>!n.isContinuous).forEach(n=>n.negate()),a.filter(n=>n.isEffective).some(n=>n.kind==="X-C-X")&&!t.isContinuous)return;if(t.stateOperationType!=="Addition"&&t.targetStateGen==="wip"&&a.filter(n=>!n.isContinuous).forEach(n=>n.negate()),t.stateOperationType==="THE_DEVILS_AVATAR"||t.stateOperationType==="Gradius'_Option"){this.entity.numericStatus.calculated[t.targetState]=-Number.MAX_VALUE;return}const r=this.entity.numericStatus.calculated[t.targetState]??0;if(t.stateOperationType==="THE_DEVILS_DREAD-ROOT"){this.entity.numericStatus.calculated[t.targetState]=t.calcValue(this.entity,r);return}if(t.kind==="L-F"){console.log(this.entity.toString(),r),this.entity.numericStatus.wip[t.targetState]=t.calcValue(this.entity,r);return}});u(this,"calcStateAll",()=>Qn.forEach(this.calcState));u(this,"calcState",t=>{if(this.entity.status.kind!=="Monster"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories){this.entity.numericStatus.calculated[t]=void 0;return}if(this.entity.status.monsterCategories.includes("Link")&&t!=="attack"){this.entity.numericStatus.calculated[t]=void 0;return}if(this.entity.status.monsterCategories.includes("Xyz")&&t==="level"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories.includes("Xyz")&&t==="rank"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories.includes("Pendulum")&&(t==="pendulumScaleL"||t==="pendulumScaleR")){this.entity.numericStatus.calculated[t]=void 0;return}if(t!=="level"&&!this.entity.isOnField){this.entity.numericStatus.origin[t]=this.entity.origin[t],this.entity.numericStatus.wip[t]=this.entity.origin[t],this.entity.numericStatus.calculated[t]=this.entity.origin[t];return}const a=this.entity.origin[t]??0,r=this.entity.numericStatus.wip[t]??0,n=this._operators.filter(c=>c.targetState===t).filter(c=>c.isEffective);if(n.some(c=>c.stateOperationType==="THE_DEVILS_AVATAR"||c.stateOperationType==="Gradius'_Option")&&this.entity.isEffective){this.entity.numericStatus.calculated[t]=-Number.MAX_VALUE;return}const s=n.filter(c=>c.targetState===t).findLast(c=>c.targetStateGen==="origin"),o=s?s.calcValue(this.entity,a??0):a;this.entity.numericStatus.origin[t]=o;let d=o;const l=n.filter(c=>c.targetState===t).filter(c=>c.targetStateGen==="wip").findLast(c=>c.stateOperationType==="Fixation");if(!l)d=n.filter(c=>c.stateOperationType==="Addition").reduce((c,v)=>v.calcValue(this.entity,c),d),this.entity.numericStatus.wip[t]=d;else if(l.isContinuous)d=l.calcValue(this.entity,d),d=n.filter(c=>c.stateOperationType==="Addition").reduce((c,v)=>v.calcValue(this.entity,c),d),this.entity.numericStatus.wip[t]=d;else{console.log("hoge");let c=!1;d=n.filter(v=>(c=c||v===l,c&&v!==l)).filter(v=>v.stateOperationType==="Addition").reduce((v,p)=>p.calcValue(this.entity,v),r)}d<en[t]&&(d=en[t]),this.entity.numericStatus.calculated[t]=d})}}const Zt=class Zt extends Ei{constructor(t,a,r,n,s,o,d,l,c,v){super(t,a,r,n,s,o);u(this,"beforeRemove",()=>{});u(this,"targetState");u(this,"targetStateGen");u(this,"stateOperationType");u(this,"calcValue");u(this,"_isEffective");u(this,"negate",()=>{this._isEffective=!1});this._isEffective=!0,this.targetState=d,this.targetStateGen=l,this.stateOperationType=c,this.calcValue=(p,h)=>v(this.isSpawnedBy,p,h)}get isEffective(){return this._isEffective&&super.isEffective}get kind(){if(this.targetStateGen==="origin"){if(this.stateOperationType==="Fixation")return this.isContinuous?"O-C-F":"O-L-F";throw new ve("矛盾したプロパティ",this)}if(this.targetStateGen==="wip"){if(this.stateOperationType==="Addition")return this.isContinuous?"C-A":"L-A";if(this.stateOperationType==="Fixation")return this.isContinuous?"C-F":"L-F";throw new ve("矛盾したプロパティ",this)}if(this.stateOperationType==="THE_DEVILS_DREAD-ROOT")return"X-C-F";if(this.stateOperationType==="THE_DEVILS_AVATAR"||this.stateOperationType==="Gradius'_Option")return"X-C-X";throw new ve("矛盾したプロパティ",this)}};u(Zt,"createContinuous",(t,a,r,n,s,o,d,l)=>new Zt(t,a,!0,r,{},n,s,o,d,l)),u(Zt,"createLingeringFixation",(t,a,r,n,s,o)=>new Zt(t,a,!1,r,n,()=>!0,s,"wip","Fixation",o)),u(Zt,"createLingeringAddition",(t,a,r,n,s,o)=>new Zt(t,a,!1,r,n,()=>!0,s,"wip","Addition",o));let lt=Zt;const es=i=>Object.keys(i),po={draw:"ドローフェイズ",standby:"スタンバイフェイズ",main1:"メインフェイズ１",battle1:"バトルフェイズ",battle2:"バトルフェイズ（追加）",main2:"メインフェイズ２",end:"エンドフェイズ"},ho={start:"スタートステップ",battle:"バトルステップ",damage:"ダメージステップ",end:"エンドステップ"},go={start:"ダメージステップ開始時",beforeDmgCalc:"ダメージ計算前",dmgCalc:"ダメージ計算時",afterDmgCalc:"ダメージ計算後",end:"ダメージステップ終了時"},Me=["draw","stanby","main1","b1Start","b1Battle","b1End","b2Start","b2Battle","b2End","main2","end"],Ye=["b1DStart","b1DBeforeDmgCalc","b1DAfterDmgCalc","b1DEnd","b2DStart","b2DBeforeDmgCalc","b2DAfterDmgCalc","b2DEnd"],yo=["b1DDmgCalc","b2DDmgCalc"],Vt=[...Me,...Ye,...yo],tn={draw:{phase:"draw",step:void 0,stage:void 0},stanby:{phase:"standby",step:void 0,stage:void 0},main1:{phase:"main1",step:void 0,stage:void 0},b1Start:{phase:"battle1",step:"start",stage:void 0},b1Battle:{phase:"battle1",step:"battle",stage:void 0},b1DStart:{phase:"battle1",step:"battle",stage:"start"},b1DBeforeDmgCalc:{phase:"battle1",step:"battle",stage:"beforeDmgCalc"},b1DDmgCalc:{phase:"battle1",step:"battle",stage:"dmgCalc"},b1DAfterDmgCalc:{phase:"battle1",step:"battle",stage:"afterDmgCalc"},b1DEnd:{phase:"battle1",step:"battle",stage:"end"},b1End:{phase:"battle1",step:"end",stage:void 0},b2Start:{phase:"battle2",step:"start",stage:void 0},b2Battle:{phase:"battle2",step:"battle",stage:void 0},b2DStart:{phase:"battle2",step:"battle",stage:"start"},b2DBeforeDmgCalc:{phase:"battle2",step:"battle",stage:"beforeDmgCalc"},b2DDmgCalc:{phase:"battle2",step:"battle",stage:"dmgCalc"},b2DAfterDmgCalc:{phase:"battle2",step:"battle",stage:"afterDmgCalc"},b2DEnd:{phase:"battle2",step:"battle",stage:"end"},b2End:{phase:"battle2",step:"end",stage:void 0},main2:{phase:"main2",step:void 0,stage:void 0},end:{phase:"end",step:void 0,stage:void 0}},mo=i=>i.stage?go[i.stage]:i.step?ho[i.step]:po[i.phase],Qt=es(tn).reduce((i,e)=>(i[e].key=e,i[e].name=mo(i[e]),i),tn),wa=class wa{constructor(e,t){u(this,"entity");u(this,"isRegular");u(this,"_isStarted");u(this,"info");u(this,"continuousEffectBase");u(this,"updateState",async()=>{if(this.hasToStart!==this.isStarted){if(this.isStarted){if(!this.info)throw new ve("illegal state");this._isStarted=!1,await this.continuousEffectBase.finish(this.entity,this.info),this.info=void 0;return}this.info=await this.continuousEffectBase.start(this.entity),this._isStarted=!0}});this._isStarted=!1,this.entity=e,this.continuousEffectBase=t,this.isRegular=this.appliableCellTypes.every(a=>li.find(r=>r===a))&&this.faceList.length===1&&this.faceList[0]==="FaceUp"}get isStarted(){return this._isStarted}get appliableCellTypes(){return this.continuousEffectBase.appliableCellTypes}get appliableDuelPeriodKeys(){return this.continuousEffectBase.appliableDuelPeriodKeys}get faceList(){return this.continuousEffectBase.faceList}get hasToStart(){return!this.appliableCellTypes.includes(this.entity.fieldCell.cellType)||!this.appliableDuelPeriodKeys.includes(this.entity.duel.clock.period.key)||!this.faceList.includes(this.entity.face)?!1:this.continuousEffectBase.canStart(this.entity)}};u(wa,"createNew",(e,t)=>new wa(e,t));let sr=wa;const _o=(i,e,t,a,r)=>({title:i,appliableCellTypes:e==="Monster"?["MonsterZone","ExtraMonsterZone"]:["FieldSpellZone","SpellAndTrapZone"],appliableDuelPeriodKeys:Vt,faceList:["FaceUp"],canStart:n=>!n.info.isPending&&!n.info.isDying&&t(n),start:async n=>{const s=a(n);return s.forEach(r(n).push),s.map(o=>o.seq)},finish:async(n,s)=>{s.forEach(o=>r(n).removeItem(o))}}),Ar=(i,e,t,a,r,n)=>({title:i,appliableCellTypes:e==="Monster"?["MonsterZone","ExtraMonsterZone"]:["FieldSpellZone","SpellAndTrapZone"],appliableDuelPeriodKeys:Vt,faceList:["FaceUp"],canStart:s=>!s.info.isPending&&!s.info.isDying&&a(s),start:async s=>{const o=r(s),d=t(s);return console.info(`start : ${s.toString()} ⇒ ${d.map(l=>l.toString()).join(" ")} (${o.map(l=>l.title).join(" ")})`),d.map(n).forEach(l=>o.forEach(l.push)),{targets:d,seqList:o.map(l=>l.seq)}},finish:async(s,o)=>{o.targets.map(n).forEach(d=>o.seqList.forEach(l=>d.removeItem(l)))}}),So=(i,e,t,a,r)=>Ar(i,e,t,a,r,n=>n.procFilterBundle),ma=(i,e,t,a)=>_o(i,e,t,a,r=>r.field.numericStateOperatorPool),Xi=(i,e,t,a,r)=>Ar(i,e,t,a,r,n=>n.numericOprsBundle),Co=(i,e,t,a,r)=>Ar(i,e,t,a,r,n=>n.statusOperatorBundle);class bo extends qa{constructor(){super(...arguments);u(this,"afterDistributeAll",t=>t.field.getAllEntities().map(a=>a.statusOperatorBundle).every(a=>a.calcStatus()))}}class wo extends Na{constructor(){super(...arguments);u(this,"calcStatus",()=>{const t=this.entity.isEffective;return this.entity.status=this._operators.reduce((a,r)=>({...a,...r.statusCalculator(r,a)}),this.entity.status),this.entity.isEffective===t});u(this,"beforePush",()=>{})}}class Mr extends Ei{constructor(t,a,r,n,s,o,d){super(t,a,r,n,s,o);u(this,"beforeRemove",()=>{});u(this,"statusCalculator");this.statusCalculator=d}}class To extends qa{constructor(){super(...arguments);u(this,"afterDistributeAll",()=>!0)}}class ko extends Na{constructor(){super(...arguments);u(this,"beforePush",()=>{});u(this,"filter",(t,a,r,n,s,o,d)=>this.operators.filter(l=>l.summonKinds.includes(a)).reduce((l,c)=>({...l,...c.filter(this.entity,t,s.summoner,r,n,s.monster,o,l.posList,l.cells,d)}),s))}}class Eo extends Ei{constructor(t,a,r,n,s,o,d,l){super(t,a,r,n,s,o);u(this,"beforeRemove",()=>{});u(this,"summonKinds");u(this,"filter");this.summonKinds=d,this.filter=(...c)=>l(this,...c)}}class Do{constructor(e){u(this,"cells");u(this,"duel");u(this,"summonFilterPool");u(this,"procFilterPool");u(this,"numericStateOperatorPool");u(this,"statusOperatorPool");u(this,"moveLog");u(this,"getAllCells",()=>this.cells.flat());u(this,"getCells",(...e)=>this.getAllCells().filter(t=>e.includes(t.cellType)));u(this,"getAvailableExtraMonsterZones",()=>this.getCells("ExtraMonsterZone").filter(e=>e.isAvailable));u(this,"getAllEntities",()=>this.getAllCells().map(e=>e.entities).flat());u(this,"getAllCardEntities",()=>this.getAllCells().map(e=>e.cardEntities).flat());u(this,"getCardsOnField",()=>this.getCells(...li).map(e=>e.cardEntities).filter(e=>e.length>0).map(e=>e[0]).filter(e=>e.isOnField));u(this,"getMonstersOnField",()=>this.getCardsOnField().filter(e=>e.isOnFieldAsMonster));u(this,"getPendingCardsOnField",()=>this.getCells(...li).map(e=>e.cardEntities).filter(e=>e.length>0).map(e=>e[0]).filter(e=>e.info.isPending));u(this,"getPendingMonstersOnField",()=>this.getPendingCardsOnField().filter(e=>e.status.kind==="Monster"));u(this,"getEntities",e=>this.getAllEntities().filter(t=>t.controller===e));u(this,"recalcArrowheads",()=>{const e=this.getAllCells().filter(t=>t.isMonsterZoneLikeCell);e.some(t=>t.recalcArrowheads)&&e.forEach(t=>t.recalcArrowheads())});u(this,"canExtraLink",(e,t)=>{if(!e.arrowheads.length)return!1;const a=t.map(l=>l.material),r=this.getCells("ExtraMonsterZone").filter(l=>l.isAvailable||a.includes(l.cardEntities[0]));if(r.length!==1)return!1;const n=r[0],s=e.arrowheads.map(l=>this.cells[n.row+l.offsetRow][n.column+l.offsetColumn]);let o=n.arrowheadSources.filter(l=>!a.includes(l)).filter(l=>s.includes(l.fieldCell));if(!o.length)return!1;let d=-1;for(;d!==o.length;){const l=o.flatMap(c=>c.coLinkedEntities).filter(c=>!a.includes(c));if(l.some(c=>c.fieldCell.cellType==="ExtraMonsterZone"))return!0;o=[...o,...l].getDistinct(),d=o.length}return!1});u(this,"drawAtSameTime",async(e,t,a,r,n,s)=>{const o=[],d=[],l=[e.draw(t,n,s),a.draw(r,n,s)].map(c=>c.catch(v=>{v instanceof ti?v.winner&&o.push(v.winner):d.push(v)}));if(await Promise.all(l),d.length)throw new ve("ドロー処理で想定されない例外が発生した。",e,t,a,r,n,...d);if(o.length!==0)throw o.length===1?new ti(o[0]):new ti});u(this,"sendToGraveyard",async(e,t,a,r,n,s,o,d)=>{if(r>0&&a.length<r)return;const l=await this.duel.view.waitSelectEntities(t,a,r,n,e,d);if(l)return await De.sendManyToGraveyard(l.map(c=>({entity:c,causedAs:s,causedBy:o,activator:t}))),this.duel.log.info(`${l.map(c=>c.status.name).join(", ")}を墓地に送った（${s.getDistinct().join(", ")}）。`,t),l});this.duel=e,this.cells=[...Array(7)].map(()=>[]);for(const t of Object.keys(nr).map(Number))for(const a of Object.keys(nr[t]).map(Number))this.cells[t][a]=new oo(this,t,a,t<3?e.duelists.Above:t>3?e.duelists.Below:a<2?e.duelists.Above:a>4?e.duelists.Below:void 0);this.summonFilterPool=new To,this.procFilterPool=new co,this.numericStateOperatorPool=new vo,this.statusOperatorPool=new bo,this.moveLog=new xo(this)}}class xo{constructor(e){u(this,"_field");u(this,"_records",[]);u(this,"getIndexOfStartPoint",e=>yi(this._records.map(t=>t.movedAt.totalProcSeq),e));u(this,"push",e=>{this._records.push(e)});u(this,"getCurrentTurnLog",()=>this.getTermLog("Current","turn"));u(this,"getPriviousChainLog",()=>this.getTermLog("Previous","chainSeq"));this._field=e}*getTermLog(e,t){const a=e==="Current"?this._field.duel.clock.currentStartPoints[t]:this._field.duel.clock.previousStartPoints[t];for(let r=this.getIndexOfStartPoint(a);r<this._records.length;r++)yield this._records[r]}}class Ao{constructor(e){u(this,"entity");u(this,"_records");u(this,"_push",e=>{this.entity.field.moveLog.push(e),this._records.push(e)});u(this,"pushForRuleAction",e=>{this._push({entity:this.entity,cell:this.entity.fieldCell,face:this.entity.face,orientation:this.entity.orientation,movedAt:this.entity.duel.clock.getClone(),movedAs:[...e,"Rule"]})});u(this,"push",(e,t,a,r)=>{let n=this.entity.fieldCell;this.entity.status.kind==="XyzMaterial"&&(n=this.entity.controller.getXyzMaterialZone()),this._push({entity:this.entity,cell:n,face:this.entity.face,orientation:this.entity.orientation,movedAt:this.entity.duel.clock.getClone(),movedAs:e.getDistinct(),movedBy:t,actionOwner:a,chooser:r??a})});u(this,"negateSummon",(e,t)=>{const a=this.records.slice(-1)[0];a.cell=this.entity.field.getCells("Disable")[0],a.movedBy=e,a.movedAs=["SummonNegated"],a.actionOwner=t});this.entity=e,this._records=[]}get records(){return this._records}get latestRecord(){return this.records.slice(-1)[0]}get previousPlaceRecord(){return this.records.findLast(e=>e.cell.cellType!==this.entity.fieldCell.cellType)??this._records[0]}get currentProcRecords(){return this.records.filter(e=>e.movedAt.totalProcSeq===this.entity.duel.clock.totalProcSeq)}}const lr=["SpellCounter","KaijuCounter","NamelessCounter","IceCounter"],or=["CycleFlip","SonicBarrier","SonicVerse"],Mo=["GoldSarcophagus"],Po=[...lr,...or,...Mo],Bo={SpellCounter:"🔮",KaijuCounter:"☢",NamelessCounter:"💠",IceCounter:"❄"};class Fo{constructor(){u(this,"dic");u(this,"temporaryCounterNames");u(this,"add",(e,t=1,a)=>(this.dic[e]=[...this.dic[e]??[],...Array(t).fill(a)],this.dic[e]));u(this,"setQty",(e,t=1,a)=>(this.dic[e]=[...Array(t).fill(a)],this.dic[e]));u(this,"remove",(e,t=1,a)=>{const r=this.dic[e].length;if(r===void 0)return[];if(t>=r)return delete this.dic[e],[];if(a){const n=this.dic[e].filter(o=>o===a),s=this.dic[e].filter(o=>o!==a);this.dic[e]=[...n.slice(t),...s]}else this.dic[e]=this.dic[e].slice(t);return this.dic[e]});u(this,"removeAll",(e,t)=>{if(t){const r=this.dic[e].filter(n=>n===t).length;return this.dic[e]=this.dic[e].filter(n=>n!==t),r}const a=this.dic[e];return delete this.dic[e],a});u(this,"getQty",(e,t)=>this.dic[e]?t?this.dic[e].filter(a=>a===t).length:this.dic[e].length??0:0);u(this,"incrementActionCountPerTurn",e=>{this.temporaryCounterNames.push(e.title),this.incrementActionCount(e)});u(this,"incrementActionCount",e=>{this.dic[e.title]=[e.entity,...this.dic[e.title]??[]]});u(this,"getActionCount",e=>this.dic[e.title]?this.dic[e.title].filter(t=>t===e.entity).length:0);u(this,"corpseDisposal",()=>{this.temporaryCounterNames.forEach(e=>delete this.dic[e]),this.temporaryCounterNames.reset(),or.forEach(e=>delete this.dic[e])});u(this,"removeAllActualCounters",()=>{lr.forEach(e=>delete this.dic[e])});u(this,"removeAllWhenfaceDown",()=>{this.temporaryCounterNames.forEach(e=>delete this.dic[e]),this.temporaryCounterNames.reset(),lr.forEach(e=>delete this.dic[e])});u(this,"clear",()=>{or.forEach(e=>delete this.dic[e]),this.temporaryCounterNames.forEach(e=>delete this.dic[e]),this.temporaryCounterNames.reset(),Po.forEach(e=>delete this.dic[e])});this.dic={},this.temporaryCounterNames=[]}}const vt=async()=>({selectedEntities:[],chainBlockTags:[],prepared:void 0}),Oo=async(i,e,t)=>(i.activator.payLp(t,i.action.entity),{lifePoint:t}),Ji=i=>i.activator.canTryBanish(i.action.entity,"BanishAsCost",i.action)&&i.action.entity.canBeBanished("BanishAsCost",i.activator,i.action.entity,i.action),Ra=async i=>(await i.action.entity.banish(["Cost"],i.action.entity,i.activator),{banish:[i.action.entity]}),Lo=(i,e,t=1)=>e.filter(a=>i.activator.canTryBanish(a,"BanishAsCost",i.action)).filter(a=>a.canBeBanished("BanishAsCost",i.activator,i.action.entity,i.action)).length>=t,qo=async(i,e,t,a)=>{const r=e.filter(s=>i.activator.canTryBanish(s,"BanishAsCost",i.action)).filter(s=>s.canBeBanished("BanishAsCost",i.activator,i.action.entity,i.action)),n=await i.activator.duel.view.waitSelectEntities(i.activator,r,a,t,"コストとして除外するカードを選択",!1)??[];return await pe.banishManyForTheSameReason(n,["Cost"],i.action.entity,i.activator),{banish:n}},Pi=async(i,e,t=Xe,a=r=>r.length===1)=>{const r=i.activator.getMonsterZones(),n=i.activator.getEnableSummonList(i.activator,"SpecialSummon",["Effect"],i.action,e.filter(d=>d.canBeTargetOfEffect(i)).map(d=>({monster:d,posList:t,cells:r})),[],!1),s=await i.action.entity.field.duel.view.waitSelectEntities(i.activator,n.map(d=>d.monster),1,a,"特殊召喚するモンスターを選択",!1)??[];if(!s.length)throw new ui(i);const o=s.map(d=>d.fieldCell.cellType).getDistinct().filter(d=>d==="Graveyard"||d==="Banished").map(d=>d==="Graveyard"?"SpecialSummonFromGraveyard":"SpecialSummonFromBanished");return{selectedEntities:s,chainBlockTags:o,prepared:void 0}},Bi=async(i,e=["Attack","Defense"],t=!0)=>{const a=i.activator.getMonsterZones(),r=i.selectedEntities.filter(n=>!n.wasMovedAfter(i.isActivatedAt)).map(n=>({monster:n,posList:e,cells:a}));return t&&(r.length!==i.selectedEntities.length||a.length<r.length)?!1:(await i.activator.summonAll(i.activator,"SpecialSummon",["Effect"],i.action,r,[],!1,!1),!0)},ts=async(i,e,t=["Attack","Defense"])=>{const a=i.activator.getMonsterZones(),r=e.map(n=>({monster:n,posList:t,cells:a}));return await i.activator.summonAll(i.activator,"SpecialSummon",["Effect"],i.action,r,[],!1,!1),!0},No=(i,e,t)=>({title:i,playType:"SystemPeriodAction",spellSpeed:"Normal",executableCells:bi,executablePeriods:e,executableDuelistTypes:["Controller","Opponent"],isMandatory:!0,validate:t,prepare:vt,execute:async()=>!0,settle:async()=>!0}),Ro=i=>{if(!(i.activator.info.ruleNormalSummonCount>=i.activator.info.maxRuleNormalSummonCount)&&i.action.entity.lvl)if(i.action.entity.lvl<5){const e=i.activator.getEnableSummonList(i.activator,"NormalSummon",["Rule"],i.action,[{monster:i.action.entity,posList:["Attack","Set"],cells:i.activator.getMonsterZones()}],[],!1);return e.length?e.flatMap(t=>t.cells).getDistinct():void 0}else{const e=i.activator.getReleasableMonsters(),t=i.action.entity.lvl<7?1:2;if(e.length<t)return;if(e.getAllOnOffPattern().filter(r=>r.length===t).some(r=>i.activator.getEnableSummonList(i.activator,"AdvanceSummon",["Rule","NormalSummon"],i.action,[{monster:i.action.entity,posList:["Attack","Set"],cells:i.activator.getMonsterZones()}],r.map(n=>({material:n})),!1).length))return[]}},Ho=async(i,e,t)=>{if(!i.action.entity.lvl)return;if(i.action.entity.lvl<5)return{};const a=i.activator.getAvailableMonsterZones(),r=i.activator.getReleasableMonsters(),n=i.activator.getExtraMonsterZones(),s=i.action.entity.lvl<7?1:2;n.length>=s&&r.filter(l=>l.fieldCell.cellType!=="ExtraMonsterZone");const o=await i.activator.duel.view.waitSelectEntities(i.activator,i.activator.getReleasableMonsters(),s,l=>(t||l.length>0)&&(s<0||l.length===s)&&(a.length>0||l.some(c=>c.fieldCell.cellType==="ExtraMonsterZone")),"リリースするモンスターを選択",t)??[];return o.length?(await pe.releaseManyForTheSameReason(o,["Cost","AdvanceSummonRelease","Rule"],i.action.entity,i.activator),{summonMaterialInfos:o.map(l=>({material:l}))}):void 0},$o=async i=>{var r;const e=["Rule","NormalSummon"];let t="NormalSummon";(r=i.costInfo.summonMaterialInfos)!=null&&r.length&&(t="AdvanceSummon",e.push("AdvanceSummon"));const a=i.dest?[i.dest]:i.activator.getAvailableMonsterZones();return oi(i,t,e,["Attack","Set"],a)},oi=async(i,e,t,a,r)=>{let n=r;return n||(n=i.activator.getMonsterZones(),i.action.entity.fieldCell.cellType==="ExtraDeck"&&n.push(...i.activator.duel.field.getCells("ExtraMonsterZone"))),await i.activator.summon(e,t,i.action,i.action.entity,a,n,i.costInfo.summonMaterialInfos??[],!1),{selectedEntities:[],chainBlockTags:[],prepared:void 0}},ci=async i=>(i.action.entity.info.isRebornable=!0,i.action.entity.info.isPending=!1,!0),We={title:"通常召喚",isMandatory:!1,playType:"NormalSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Ro,payCosts:Ho,prepare:$o,execute:ci,settle:async()=>!0},cr=(i,e,t)=>{const a=i.activator.getMonsterZones();if(i.action.entity.fieldCell.cellType==="ExtraDeck"&&a.push(...i.activator.getAvailableExtraZones()),!!i.activator.getEnableSummonList(i.activator,"SpecialSummon",["Rule"],i.action,[{monster:i.action.entity,posList:e,cells:a}],t,!1).length)return t.length===0?a:[]},Zo=i=>{if(!i.activator.isTurnPlayer)return;const e=i.action.entity.getAttackTargets();return e.length?e.map(t=>t.fieldCell):void 0},jo=async i=>{var a;if(i.action.entity.info.attackCount>0||i.action.entity.battlePosition!=="Attack")return;if((a=i.dest)!=null&&a.targetForAttack){const r=i.dest.entities.find(n=>n.entityType==="Duelist");return{selectedEntities:r?[r]:i.dest.cardEntities,chainBlockTags:[],prepared:void 0}}const e=i.action.entity.getAttackTargets();if(e.length===0)throw new ve("想定されない状態",i);if(e.length===1)return{selectedEntities:e,chainBlockTags:[],prepared:void 0};if(i.activator.duelistType==="NPC"){let r=i.activator.selectAttackTargetForNPC(i.action.entity,i.action);return r||(i.activator.duel.log.warn("NPCの攻撃対象選択に失敗したため、ランダムに攻撃対象を選択。"),r=e.randomPick()),{selectedEntities:[r],chainBlockTags:[],prepared:void 0}}const t=await i.action.entity.field.duel.view.waitSelectEntities(i.activator,e,1,r=>r.length===1,"攻撃対象を選択。",!0);if(t)return{selectedEntities:t,chainBlockTags:[],prepared:void 0}},Uo=async i=>(i.action.entity.field.duel.declareAnAttack(i.action.entity,i.selectedEntities[0]),!0),he={title:"攻撃宣言",isMandatory:!1,playType:"Battle",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["b1Battle","b2Battle"],executableDuelistTypes:["Controller"],validate:Zo,prepare:jo,execute:Uo,settle:async()=>!0},is=async i=>{if(!(i.action.entity.info.battlePotisionChangeCount>0||!i.activator.isTurnPlayer))return await i.action.entity.setBattlePosition(i.action.entity.battlePosition==="Attack"?"Defense":"Attack",["Rule"],i.action.entity,i.activator),i.action.entity.info.battlePotisionChangeCount++,i.action.entity.info.isPending=!1,{selectedEntities:[],chainBlockTags:[],prepared:void 0}},Te={title:"反転召喚",isMandatory:!1,playType:"FlipSummon",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:i=>i.action.entity.info.battlePotisionChangeCount===0&&i.action.entity.info.attackCount===0&&i.activator.isTurnPlayer&&i.action.entity.face==="FaceDown"?[]:void 0,prepare:is,execute:async i=>(i.action.entity.info.isPending=!1,!0),settle:async()=>!0},_e={title:"表示形式変更",isMandatory:!1,playType:"ChangeBattlePosition",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:i=>i.action.entity.info.battlePotisionChangeCount===0&&i.action.entity.info.attackCount===0&&i.activator.isTurnPlayer&&i.action.entity.face==="FaceUp"?[]:void 0,prepare:is,execute:async i=>(i.action.entity.info.isPending=!1,!0),settle:async()=>!0},ei=async(i,e=["Attack","Defense"])=>{const t=i.activator.getMonsterZones();return i.action.entity.wasMovedAfter(i.isActivatedAt)?!1:(await i.activator.summon("SpecialSummon",["Effect"],i.action,i.action.entity,e,t,[],!1),!0)},ct=(i,e,t,a,r,n,s,o,d,l,c)=>{const v={posList:d,cells:l},p={posList:[],cells:[]};return e!==s||s.status.kind!=="Monster"||!s.origin.monsterCategories?v:s.origin.monsterCategories.includes("NormalSummonOnly")?r.includes("NormalSummon")||r.includes("AdvanceSummon")?v:p:s.origin.monsterCategories.includes("SpecialSummon")?s.isInTrashCell?s.info.isRebornable?v:p:r.union(rs).length?v:s.origin.monsterCategories.includes("RegularSpecialSummonOnly")?c?v:p:v:v},Va={},Go=i=>(Va[i]||(Va[i]={title:`戦闘破壊耐性(${i})`,isMandatory:!0,executableCells:["MonsterZone"],executablePeriods:["b1DDmgCalc","b2DDmgCalc"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:i,isApplicableTo:(e,t,a)=>(console.log(e.entity.toString(),e,t,a),a.includes(e.entity)?t!=="BattleDestroy"?[]:[e.entity]:[]),substitute:async(e,t,a)=>a.includes(e.entity)?t!=="BattleDestroy"?[]:e.entity.isEffective?(e.entity.controller.writeInfoLog(`${e.entity.toString()}は１ターンに１度だけ戦闘では破壊されない。`),[e.entity]):[]:[]}),Va[i]),Pr=i=>i.activator.canRelease([i.action.entity])&&i.action.entity.canBeReleased(i.activator,i.action.entity,["ReleaseAsCost"],i.action),_a=async i=>(await i.action.entity.release(["Cost"],i.action.entity,i.activator),{release:[i.action.entity]}),as=i=>({title:"シンクロ召喚",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:st,executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerChain:1,validate:e=>e.activator.isTurnPlayer?void 0:e.activator.getExtraDeck().cardEntities.filter(a=>{var r;return(r=a.status.monsterCategories)==null?void 0:r.includes("Syncro")}).flatMap(a=>a.actions).filter(a=>a.playType==="SpecialSummon").map(a=>({index:-1,chainNumber:void 0,action:a,activator:e.activator,targetChainBlock:void 0,isActivatedIn:a.entity.fieldCell,isActivatedAt:e.isActivatedAt,costInfo:{},state:"unloaded",dest:void 0,ignoreCost:!1})).some(a=>a.action.getEnableMaterialPatterns(a).some(r=>{const n=r.map(s=>s.material);return n.every(s=>s.controller===e.activator)&&n.every(s=>s.isOnFieldAsMonster)&&n.includes(e.action.entity)}))?[]:void 0,prepare:vt,execute:async e=>{if(e.activator!==e.action.entity.controller||e.activator.getMonstersOnField().filter(s=>s.lvl!==void 0).length<2)return!1;const t=e.activator.getExtraDeck().cardEntities.filter(s=>{var o;return(o=s.status.monsterCategories)==null?void 0:o.includes("Syncro")}).flatMap(s=>s.actions).filter(s=>s.playType==="SpecialSummon").map(s=>({index:-1,chainNumber:void 0,action:s,activator:e.activator,targetChainBlock:void 0,isActivatedIn:s.entity.fieldCell,isActivatedAt:e.isActivatedAt,costInfo:{},state:"unloaded",dest:void 0,ignoreCost:!1})).filter(s=>s.action.getEnableMaterialPatterns(s).some(o=>{const d=o.map(l=>l.material);return d.every(l=>l.controller===e.activator)&&d.every(l=>l.isOnFieldAsMonster)&&d.includes(e.action.entity)})).map(s=>s.action.entity).getDistinct();if(!t.length)return!1;const a=await e.activator.duel.view.waitSelectEntities(e.activator,t,1,s=>s.length===1,"シンクロ召喚するモンスターを選択。",!1)??[];if(!a.length)throw new ve("想定されない状態",e);const r=a[0].actions.find(s=>s.playType==="SpecialSummon");if(!r)throw new ve("想定されない状態",e);const n=r.getClone(s=>{const o=s.map(d=>d.material);return o.every(d=>d.controller===e.activator)&&o.every(d=>d.isOnFieldAsMonster)&&o.includes(e.action.entity)});return e.nextAction=n,!0},settle:async()=>!0,...i}),Hi=class Hi extends ga{constructor(){super(...arguments);u(this,"isApplicableTo",(t,a,r)=>{console.log(this.entity.toString(),this,t,a);const n=this.entity.counterHolder.getActionCount(this);return this.isOnlyNTimesPerTurnIfFaceup>0&&n>=this.isOnlyNTimesPerTurnIfFaceup?this.entity.counterHolder.incrementActionCountPerTurn(this):this.isOnlyNTimesIfFaceup>0&&n>=this.isOnlyNTimesIfFaceup&&this.entity.counterHolder.incrementActionCount(this),this.definition.isApplicableTo(this,t,a,r)});u(this,"substitute",async(t,a,r)=>{const n=await this.definition.substitute(this,t,a,r);return this.isOnlyNTimesPerTurnIfFaceup>0?this.entity.counterHolder.incrementActionCountPerTurn(this):this.isOnlyNTimesIfFaceup>0&&this.entity.counterHolder.incrementActionCount(this),n});u(this,"getClone",()=>new Hi(this.seq,this.entity,this.definition))}get definition(){return super.definition}};u(Hi,"createNew",(t,a)=>new Hi("AutoSeq",t,a));let ur=Hi;const rs=["FusionSummon","SyncroSummon","XyzSummon","PendulumSummon","LinkSummon","RitualSummon","FlipSummon"],zo={FusionSummon:"融合召喚",SyncroSummon:"シンクロ召喚",XyzSummon:"エクシーズ召喚",PendulumSummon:"ペンデュラム召喚",LinkSummon:"リンク召喚",RitualSummon:"儀式召喚",FlipSummon:"反転召喚"},Vo=[...rs,"AdvanceSummon","NormalSummon","SpecialSummon"],Wo={BattleDestroy:"戦闘破壊",EffectDestroy:"効果破壊",RuleDestroy:"ルール破壊"},ns=i=>i+"Summon",an=["Card","Token","Avatar"],Yo=["Duelist","Squatter"],ss=(i,e)=>Ni(i.origin,e.origin),Ge=class Ge{constructor(e,t,a,r,n,s,o){u(this,"onBeforeMoveEvent",new Vr);u(this,"onAfterMoveEvent",new Vr);u(this,"seq");u(this,"origin");u(this,"entityType");u(this,"summonFilterBundle");u(this,"procFilterBundle");u(this,"numericOprsBundle");u(this,"statusOperatorBundle");u(this,"moveLog");u(this,"counterHolder");u(this,"face");u(this,"orientation");u(this,"owner");u(this,"fieldCell");u(this,"_status");u(this,"_numericStatus");u(this,"_info");u(this,"actions",[]);u(this,"continuousEffects",[]);u(this,"substituteEffects",[]);u(this,"canBeReleased",(e,t,a,r)=>this.procFilterBundle.operators.filter(n=>n.procTypes.union(a).length).every(n=>n.filter(e,t,r,[this])));u(this,"_hasDisappeared",!1);u(this,"toString",()=>this.entityType==="Card"?`《${this.nm}》`:this.nm);u(this,"setBattlePosition",async(e,t,a,r)=>{let n=`表示形式の変更：${this.toString()}（${this.battlePositionName}⇒${ia[e]}）`;const s=[...t];this.battlePosition==="Set"&&(this.info.isPending=!0,s.push("Flip"),t.includes("Rule")&&(n=`${this.toString()}を反転召喚`,this.info.summonKinds.push("FlipSummon"),s.push("FlipSummon"),s.push("AttackSummon"))),this.duel.log.info(n,r),await this.moveAlone(this.fieldCell,"Monster",e==="Set"?"FaceDown":"FaceUp",e==="Attack"?"Vertical":"Horizontal","Top",s,a,r,r)});u(this,"activateAsPendulumScale",(e,t,a,r)=>this.moveAlone(e,"Spell","FaceUp","Vertical","Top",["CardActivation",...t],a,r,r));u(this,"setNonFieldMonsterPosition",async(e,t,a,r,n)=>{this.moveAlone(this.fieldCell,e,t==="FaceUp"?"FaceUp":"FaceDown","Vertical","Top",a,r,n,n)});u(this,"setAsSpellTrap",async(e,t,a,r,n)=>{await this.moveAlone(e,t,"FaceDown","Vertical","Top",[...a,"SpellTrapSet"],r,n,n)});u(this,"activateSpellTrapFromHand",async(e,t,a,r,n)=>{await this.moveAlone(e,t,"FaceUp","Vertical","Top",[...a,"CardActivation"],r,n,n)});u(this,"activateSpellTrapOnField",async(e,t,a,r)=>{await this.moveAlone(this.fieldCell,e,"FaceUp","Vertical","Top",[...t,"CardActivation"],a,r,r)});u(this,"draw",async(e,t,a)=>await this.addToHand([...e,"Draw"],t,a));u(this,"addToHand",async(e,t,a)=>await this.moveAlone(this.owner.getHandCell(),this.origin.kind,"FaceDown","Vertical","Bottom",[...e],t,a,a));u(this,"summon",(e,t,a,r,n,s,o)=>Ge.summonMany([{monster:this,dest:e,summoner:o??s,pos:t}],a,r,n,s));u(this,"moveAlone",async(e,t,a,r,n,s,o,d,l)=>(await Ge.moveMany([[this,e,t,a,r,n,s,o,d,l]],void 0),this.fieldCell));u(this,"_move",async(e,t,a,r,n,s,o,d,l)=>{if(!e)throw new Error("illegal argument: to");if(await this.onBeforeMoveEvent.trigger({entity:this,args:[e,t,a,r,n,s,o,d,l]}),this._status.kind=t,this.face=a,this.orientation=r,e!==this.fieldCell){if(this.field.duel.clock.turn>0&&(this.duel.log.info(`移動：${this.toString()}  ${this.fieldCell.toString()} ⇒ ${e.toString()}`,d),await this.field.duel.view.waitAnimation({entity:this,to:e,index:n,count:0})),this.fieldCell.releaseEntities(this),this.fieldCell.isPlayFieldCell&&!e.isPlayFieldCell&&(this.counterHolder.clear(),this.resetCauseOfDeath(),this.entityType==="Token")){this._hasDisappeared=!0,this.field.duel.log.info(`${this.nm}は消滅した。`,this.controller);return}this.status.kind!=="XyzMaterial"&&(this.fieldCell.isMonsterZoneLikeCell&&!e.isMonsterZoneLikeCell||t!=="Monster")&&(this.info.equipEntities.filter(c=>c.isOnFieldAsSpellTrap).forEach(c=>{c.info.isDying=!0,c.info.causeOfDeath=["RuleDestroy"],this.controller.writeInfoLog(`装備対象${this.toString()}不在により${c.toString()}は破壊された。`)}),this.info.equipEntities=[],this.fieldCell.xyzMaterials.forEach(c=>{c.info.isDying=!0,c.info.causeOfDeath=["LostXyzOwner"],this.controller.writeInfoLog(`エクシーズモンスター${this.toString()}不在により${c.toString()}は墓地に送られた。`)}),this.resetNumericStatus()),this.fieldCell.cellType==="SpellAndTrapZone"&&e.cellType!=="SpellAndTrapZone"&&(this.info.equipedBy=void 0,this.info.equipedAs=void 0),e.acceptEntities(this,n),(e===this.isBelongTo||e.cellType==="Hand"||e.cellType==="Banished"&&this.face==="FaceDown")&&(this.counterHolder.clear(),this.resetInfoAll(),this.resetStatusAll())}return(this.isOnField&&this.face==="FaceDown"||t==="XyzMaterial")&&(this.info.equipEntities.forEach(c=>{c.info.isDying=!0,c.info.causeOfDeath=["RuleDestroy"],this.controller.writeInfoLog(`装備対象${this.toString()}不在により${c.toString()}は破壊された。`)}),this.counterHolder.removeAllWhenfaceDown(),this.info.materials=[],this._status.isEffective=!0,this.info.isEffectiveIn=[...bi],this.info.willBeBanished=!1,this.info.willReturnToDeck=void 0,this.resetNumericStatus(),this.info.isSettingSickness=this.status.kind==="Trap"||this.status.spellCategory==="QuickPlay"),this.moveLog.push(s,o,d,l),console.log(this.toString()),await this.onAfterMoveEvent.trigger(this),e});u(this,"initForTurn",()=>{console.log("hoge"),this.info.isSettingSickness=!1,this.info.attackCount=0,this.info.battlePotisionChangeCount=0,this.counterHolder.corpseDisposal()});u(this,"resetInfoIfLeavesTheField",()=>{console.log("hoge"),this._info={...this._info,isDying:!1,isPending:!1,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,effectTargets:{},attackCount:0,battlePotisionChangeCount:0,materials:[],equipedBy:void 0,equipedAs:void 0,equipEntities:[]},this._info.isEffectiveIn.push(...li),this._info.isEffectiveIn.distinct()});u(this,"resetInfoAll",()=>{var e;console.log("hoge"),this._info={isDying:!1,isPending:!1,isEffectiveIn:[...bi],causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,isVanished:!1,isRebornable:((e=this.origin.monsterCategories)==null?void 0:e.union(Yn).length)===0,isSettingSickness:!1,summonKinds:[],materials:[],effectTargets:{},willBeBanished:!1,willReturnToDeck:void 0,attackCount:0,battlePotisionChangeCount:0,equipedBy:void 0,equipedAs:void 0,validateEquipOwner:()=>!0,equipEntities:[]},this.counterHolder.clear()});u(this,"resetNumericStatus",()=>{const e=Qn.reduce((t,a)=>(t[a]=this.origin[a],t),{});this._numericStatus={origin:{...e},wip:{...e},calculated:{...e}}});u(this,"resetStatus",()=>{this._status={...this.origin,canAttack:!0,isEffective:!0,canDirectAttack:!1,canActivateEffect:!0,isSelectableForAttack:!0,allowHandSyncro:!1,allowHandLink:!1,maxCounterQty:{}}});u(this,"resetStatusAll",()=>{this.resetNumericStatus(),this.resetStatus()});u(this,"resetCauseOfDeath",()=>{this.info.isDying=!1,this.info.causeOfDeath=[],this.info.isKilledBy=void 0,this.info.isKilledByWhom=void 0});var c;this.seq=Ge.nextEntitySeq++,this.counterHolder=new Fo,this.owner=e,this.fieldCell=t,this.entityType=a,this.origin=r,this._status=JSON.parse(JSON.stringify(r)),this._numericStatus=JSON.parse(JSON.stringify(r)),this.resetStatusAll(),this._info={isEffectiveIn:[...bi],attackCount:0,battlePotisionChangeCount:0,isDying:!1,isPending:!1,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,isVanished:!1,isRebornable:!0,isSettingSickness:!1,summonKinds:[],materials:[],effectTargets:{},willBeBanished:!1,willReturnToDeck:void 0,equipedBy:void 0,equipedAs:void 0,validateEquipOwner:()=>!0,equipEntities:[]},this.resetInfoAll(),this.face=n,this.orientation=s,this.summonFilterBundle=new ko(t.field.summonFilterPool,this),this.procFilterBundle=new uo(t.field.procFilterPool,this),this.numericOprsBundle=new fo(t.field.numericStateOperatorPool,this),this.statusOperatorBundle=new wo(t.field.statusOperatorPool,this),t.acceptEntities(this,"Top"),this.moveLog=new Ao(this),this.moveLog.pushForRuleAction(["Spawn"]);let d=[],l=[];this.origin.kind==="Monster"&&((c=this.origin.monsterCategories)!=null&&c.includes("Normal"))?d=[We,he,_e,Te]:o&&(d=o.actions,l=o.continuousEffects??[],this.substituteEffects.push(...(o.substituteEffects??[]).map(v=>ur.createNew(this,v))),o.defaultSummonFilter&&this.summonFilterBundle.push(new Eo("default",()=>!0,!0,this,{},()=>!0,Vo,o.defaultSummonFilter)),o.defaultStatus&&this.statusOperatorBundle.push(new Mr("default",()=>!0,!0,this,{},()=>!0,()=>o.defaultStatus??{}))),this.actions.push(...d.map(v=>ni.createNew(this,v))),this.continuousEffects.push(...l.map(v=>sr.createNew(this,v)))}get onBeforeMove(){return this.onBeforeMoveEvent.expose()}get onAfterMove(){return this.onAfterMoveEvent.expose()}get isUnderControl(){return this.face==="FaceUp"||Kn.every(e=>e!==this.fieldCell.cellType)}get controller(){return this.fieldCell.owner??this.owner}get field(){return this.owner.duel.field}get duel(){return this.owner.duel.field.duel}get actionLogRecords(){return this.duel.chainBlockLog.records.filter(e=>e.chainBlockInfo.action.entity===this)}get status(){return this._status}set status(e){this._status={...e}}get numericStatus(){return this._numericStatus}get info(){return this._info}get nm(){return this.status.name}get atk(){return this._numericStatus.calculated.attack}get def(){return this._numericStatus.calculated.defense}get lvl(){return this._numericStatus.calculated.level}get rank(){return this._numericStatus.calculated.rank}get attr(){return this.status.attributes??[]}get types(){return this.status.types??[]}get psL(){return this._numericStatus.calculated.pendulumScaleL}get psR(){return this._numericStatus.calculated.pendulumScaleR}get arrowheads(){let e=(this.origin.arrowheadKeys??[]).map(t=>to[t].arrowhead);return this.controller.seat==="Above"&&(e=e.map(t=>({offsetColumn:t.offsetColumn*-1,offsetRow:t.offsetRow*-1}))),e}get arrowheadDests(){var e;return(e=this.origin.monsterCategories)!=null&&e.includes("Link")?this.isOnFieldAsMonster?this.arrowheads.map(t=>[this.fieldCell.row+t.offsetRow,this.fieldCell.column+t.offsetColumn]).map(([t,a])=>this.field.cells[t][a]).filter(t=>t.isMonsterZoneLikeCell):[]:[]}get linkedEntities(){return this.isOnFieldAsMonster?[...this.arrowheadDests.map(e=>e.cardEntities[0]).map(e=>e),...this.fieldCell.arrowheadSources].getDistinct():[]}get coLinkedEntities(){var e;return this.isOnFieldAsMonster?(e=this.origin.monsterCategories)!=null&&e.includes("Link")?(console.log(this,this.arrowheadDests,this.arrowheadDests.map(t=>t.cardEntities[0]).filter(t=>t),this.fieldCell.arrowheadSources),this.arrowheadDests.map(t=>t.cardEntities[0]).filter(t=>t).union(this.fieldCell.arrowheadSources)):[]:[]}get isEffective(){return this.status.isEffective&&this.info.isEffectiveIn.includes(this.fieldCell.cellType)}get isEffectiveWeakly(){return this.status.isEffective}get battlePosition(){if(this.isOnField&&this.status.kind==="Monster")return this.orientation==="Vertical"?"Attack":this.face==="FaceUp"?"Defense":"Set"}get battlePositionName(){const e=this.battlePosition;if(e)return ia[e]}get wasMovedAtCurrentProc(){return this.field.duel.clock.totalProcSeq===this.moveLog.latestRecord.movedAt.totalProcSeq}get wasMovedAtPreviousProc(){return this.field.duel.clock.totalProcSeq===this.moveLog.latestRecord.movedAt.totalProcSeq+1}get wasMovedAtCurrentTurn(){return this.field.duel.clock.isSameTurn(this.moveLog.latestRecord.movedAt)}get wasMovedAtCurrentChain(){return this.field.duel.clock.isSameChain(this.moveLog.latestRecord.movedAt)}get wasMovedAtPreviousChain(){return this.field.duel.clock.isPreviousChain(this.moveLog.latestRecord.movedAt)}get wasMovedAtPreviousTurn(){return this.field.duel.clock.isPreviousTurn(this.moveLog.latestRecord.movedAt)}get wasMovedFrom(){return this.moveLog.previousPlaceRecord.cell}get isOnField(){return li.some(e=>e===this.fieldCell.cellType)&&!this.info.isPending&&this.status.kind!=="XyzMaterial"}get isOnFieldAsMonster(){return st.some(e=>e===this.fieldCell.cellType)&&!this.info.isPending&&this.status.kind!=="XyzMaterial"}get isOnFieldAsSpellTrap(){return Yt.some(e=>e===this.fieldCell.cellType)&&!this.info.isPending&&this.status.kind!=="XyzMaterial"}get isInTrashCell(){return Xn.some(e=>e===this.fieldCell.cellType)}get isLikeContinuousSpell(){return this.status.spellCategory==="Continuous"||this.status.spellCategory==="Field"||this.status.spellCategory==="Equip"||this.status.trapCategory==="Continuous"||(this.status.monsterCategories??[]).includes("Pendulum")}get isBelongTo(){return this.origin.monsterCategories&&this.origin.monsterCategories.union(ki).length?this.owner.getExtraDeck():this.owner.getDeckCell()}get hasDisappeared(){return this._hasDisappeared}get allStickyEffectOperators(){return[...this.procFilterBundle.operators,...this.numericOprsBundle.operators]}};u(Ge,"nextEntitySeq",0),u(Ge,"splitBattlePos",e=>({face:e==="Set"?"FaceDown":"FaceUp",orientation:e==="Attack"?"Vertical":"Horizontal"})),u(Ge,"recreateArray",(e,t)=>{if(!t.length)return[];const a=e.getAllCells().flatMap(r=>r.entities);return t.map(r=>r.seq).map(r=>a.find(n=>n.seq===r)).filter(r=>r!==void 0)}),u(Ge,"createPlayerEntity",e=>{const t=e.getHandCell();return new Ge(e,t,"Duelist",{name:e.profile.name,kind:"Monster",wikiEncodedName:"%A5%D7%A5%EC%A5%A4%A5%E4%A1%BC"},"FaceUp","Vertical",void 0)}),u(Ge,"createCardEntity",(e,t)=>{const a=t.monsterCategories&&t.monsterCategories.union(ki).length?e.getExtraDeck():e.getDeckCell(),r=new Ge(e,a,"Card",eo(t),"FaceDown","Vertical",fr.get(t.name));return Object.hasOwn(rt,r.origin.name)||e.duel.log.info(`未実装カード${t.name}がデッキに投入された。`,e),r}),u(Ge,"moveMany",async(e,t)=>{if(!e.length)return;const a=e[0][0].duel,n=[...e.filter(([o,d])=>o.fieldCell!==d).map(([o])=>o).filter(o=>!(t??[]).includes(o)),...a.field.getCardsOnField().filter(o=>o.info.isDying)],s=new Map;for(e.forEach(([o,d,l,c,v,p,...h])=>{let m=d,C=l,y=c,S=p,k=v;o.info.willBeBanished&&(m=o.owner.getBanished(),y="FaceUp",k="Vertical"),o.info.willReturnToDeck&&(m=o.isBelongTo,y="FaceDown",S=o.info.willReturnToDeck,k="Vertical"),o.isBelongTo.cellType==="ExtraDeck"&&(m.cellType==="Hand"||m.cellType==="Deck")&&(m=o.isBelongTo,y="FaceDown",k="Vertical"),m.isPlayFieldCell||(C=o.origin.kind),m.isMonsterZoneLikeCell||(k="Vertical"),s.set(m,[[o,m,C,y,k,S,...h],...s.get(m)??[]])});;){const o=Array.from(s.values()).map(l=>l.pop()).filter(l=>l!==void 0).map(([l,...c])=>l._move(...c));if(!o.length)break;await Promise.all(o);const d=a.field.getCardsOnField().filter(l=>l.info.isDying).filter(l=>!n.includes(l)).map(l=>({entity:l,causedAs:l.info.causeOfDeath??[],causedBy:l.info.isKilledBy,activator:l.info.isKilledByWhom}));d.length&&await Ge.sendManyToGraveyard(d,n)}console.log(e.map(([o])=>o.toString())),Ge.settleEntityMove(a),console.log(e.map(([o])=>o.toString()))}),u(Ge,"summonMany",async(e,t,a,r,n)=>{if(!e.length)return;const s={Attack:"AttackSummon",Defense:"DefenseSummon",Set:"SetSummon"};await Promise.all(e.map(async({monster:o,dest:d,pos:l,summoner:c})=>{if(o.info.summonKinds=[t],t==="NormalSummon"||t==="AdvanceSummon"){o.info.summonKinds.push("NormalSummon");const h=t==="AdvanceSummon"?"アドバンス":"";l==="Attack"?o.field.duel.log.info(`${o.toString()}を${h}召喚`,c):o.duel.log.info(`${o.toString()}を${h}セット`,c),a.includes("Rule")?c.info.ruleNormalSummonCountQty++:c.info.effectNormalSummonCountQty++}else t==="SpecialSummon"?o.duel.log.info(`${o.toString()}を${ia[l]}で特殊召喚`,c):(o.info.summonKinds.push("SpecialSummon"),o.duel.log.info(`${o.toString()}を${ia[l]}で${zo[t]}！`,c)),c.info.specialSummonCountQty++;o.info.summonKinds=o.info.summonKinds.getDistinct(),console.log("hoge"),o.info.battlePotisionChangeCount=1;const{face:v,orientation:p}=Ge.splitBattlePos(l);a.includes("Rule")&&(o.info.isPending=!0),await o._move(d,"Monster",v,p,"Top",[t,s[l],...a],r,n,c)})),e.map(o=>o.summoner).forEach(o=>{t==="NormalSummon"||t==="AdvanceSummon"?a.includes("Rule")?o.info.ruleNormalSummonCount++:o.info.effectNormalSummonCount++:o.info.specialSummonCount++}),Ge.settleEntityMove(e[0].monster.duel)}),u(Ge,"sendManyToGraveyard",(e,t)=>Ge.bringManyToSameCell("Graveyard","Top",e.map(a=>({...a,face:"FaceUp",orientation:"Vertical"})),t)),u(Ge,"bringManyToSameCell",(e,t,a,r)=>Ge.moveMany(a.map(n=>[n.entity,n.entity.field.getCells(e).filter(s=>s.owner===n.entity.owner)[0],n.entity.origin.kind,n.face,n.orientation,t,n.causedAs,n.causedBy,n.activator,n.activator]),r)),u(Ge,"settleEntityMove",e=>{e.field.recalcArrowheads(),e.distributeOperators(e.clock);const t=e.field.getAllEntities().filter(a=>a.wasMovedAtCurrentProc);t.filter(a=>!a.isOnField&&!a.info.isPending).forEach(a=>a.resetInfoIfLeavesTheField()),t.filter(a=>a.face==="FaceDown").filter(a=>a.fieldCell===a.isBelongTo).forEach(a=>{a.resetInfoAll(),a.resetStatusAll()}),t.flatMap(a=>a.continuousEffects).forEach(a=>a.updateState()),e.field.getAllCells().filter(a=>a.needsShuffle).map(a=>a.shuffle())});let De=Ge;De.prototype.hasBeenSummonedNow=function(i,e=["Attack","Defense"]){const t=this,a=e.map(ns),r=t.moveLog.latestRecord.movedAs;return!(!t.wasMovedAtPreviousChain||!r.union(i).length||!r.union(a).length)};De.prototype.hasBeenSummonedJustNow=function(i,e=["Attack","Defense"]){const t=this,a=e.map(ns),r=t.moveLog.latestRecord.movedAs;return!(!t.wasMovedAtPreviousProc||!r.union(i).length||!r.union(a).length)};De.prototype.getAttackTargets=function(){if(!this.hasAttackRight())return[];const i=this.controller.getOpponentPlayer().getMonstersOnField().filter(e=>e.status.isSelectableForAttack);return(this.status.canDirectAttack||!i.length)&&i.push(this.controller.getOpponentPlayer().entity),i.filter(e=>e.canBeTargetOfBattle(this.controller,this)).filter(e=>this.procFilterBundle.operators.filter(t=>t.procTypes.includes("BattleTarget")).every(t=>t.filter(this.controller,this,{},[e])))};De.prototype.canDirectAttack=function(){return this.getAttackTargets().some(i=>i.entityType==="Duelist")};De.prototype.canAttackToMonster=function(){return this.getAttackTargets().some(i=>i.entityType!=="Duelist")};De.prototype.hasAttackRight=function(){return this.battlePosition==="Attack"&&this.info.attackCount===0&&this.status.canAttack};De.prototype.canBeEffected=function(i,e,t){return this.procFilterBundle.operators.filter(r=>r.procTypes.some(n=>n==="Effect")).every(r=>r.filter(i,e,t,[this]))};const ls=(i,e,t,a,r)=>i.canBeEffected(t,a,r)&&i.procFilterBundle.operators.filter(n=>n.procTypes.some(s=>s===e)).every(n=>n.filter(t,a,r,[i]));De.prototype.canBeTargetOfEffect=function(i){return ls(this,"EffectTarget",i.activator,i.action.entity,i.action)};De.prototype.canBeBanished=function(i,e,t,a){return this.fieldCell.cellType==="Banished"?!1:ls(this,i,e,t,a)};De.prototype.canBeTargetOfBattle=function(i,e){const t=this;return t.procFilterBundle.operators.filter(a=>a.procTypes.some(r=>r==="BattleTarget")).every(a=>a.filter(i,e,{},[t]))};De.prototype.validateDestory=function(i,e,t,a){const r=this;let n=r.procFilterBundle.operators.filter(s=>s.procTypes.includes(i)).every(s=>s.filter(e,t,a??{},[r]));return n&&i==="EffectDestroy"&&(n=r.canBeEffected(e,t,a)),n};De.prototype.getIndexInCell=function(){const i=this;if(i.info.isVanished)return-1;const e=i.fieldCell.cardEntities.indexOf(i);if(e<0)throw new ve("エンティティとセルの状態が矛盾している。",[i,i.fieldCell]);return e};De.prototype.getXyzMaterials=function(){const i=this;return(i.status.monsterCategories??[]).includes("Xyz")?i.fieldCell.xyzMaterials:[]};De.prototype.wasMovedAfter=function(i){return console.log(this.toString(),this.moveLog.latestRecord.movedAt.totalProcSeq,i.totalProcSeq),this.moveLog.latestRecord.movedAt.totalProcSeq>i.totalProcSeq};De.prototype.release=async function(i,e,t){return await this.sendToGraveyard([...i,"Release"],e,t),this.info.isVanished?void 0:this.fieldCell};De.prototype.ruleDestory=async function(){return await this.sendToGraveyard(["RuleDestroy"],void 0,void 0),this.info.isVanished?void 0:this.fieldCell};De.prototype.sendToGraveyard=function(i,e,t){return pe.sendManyToGraveyardForTheSameReason([this],i,e,t)};De.prototype.discard=function(i,e,t){return pe.discardManyForTheSameReason([this],i,e,t)};De.prototype.returnToDeck=function(i,e,t,a){return pe.returnManyToDeckForTheSameReason(i,[this],e,t,a)};De.prototype.banish=function(i,e,t){return pe.banishManyForTheSameReason([this],i,e,t)};si.prototype.summon=async function(i,e,t,a,r,n,s,o){return(await this.summonMany(this,i,e,t,[{monster:a,posList:r,cells:n}],s,!1,l=>l.length===1,o)??[])[0]};si.prototype.waitSelectEntities=function(i,e,t,a,r=!1){return this.duel.view.waitSelectEntities(this,i,e,t,a,r)};si.prototype.waitSelectEntity=async function(i,e,t=!1){const a=await this.waitSelectEntities(i,1,r=>r.length===1,e,t);return a?a[0]:void 0};let Qo=class{constructor(e){u(this,"onUpdateEvent",new Ke);u(this,"nextSeq");u(this,"records",[]);u(this,"duel");u(this,"dispose",()=>{this.onUpdateEvent.clear()});u(this,"error",e=>{console.error(e);const t=["エラー発生"];e instanceof Error?(e instanceof ve&&(t.push("-- エラーメッセージ --"),t.push(e.message),t.push("-- 関連オブジェクト --"),e.items.forEach(a=>t.push(JSON.stringify(a)))),t.push("-- エラー名称 --"),t.push(e.name||"エラー名称取得失敗"),t.push("-- スタックトレース --"),t.push(e.stack||"スタックトレース取得失敗")):(t.push("-- エラー型特定失敗 --"),t.push(JSON.stringify(e))),this.write("error","System",t,void 0,void 0,void 0,void 0,void 0)});u(this,"warn",e=>{this.write("warn","System",["【注意】",e],void 0,void 0,void 0,void 0,void 0)});u(this,"info",(e,t)=>{this.write("info","Others",[e],t,void 0,void 0,void 0,void 0)});u(this,"pushMoveLog",(e,t,a,r)=>{this.write("info","EntityMove",["移動"],e,t,void 0,a,r)});u(this,"write",(e,t,a,r,n,s,o,d)=>{const l=a.join(`
`);console.log(this.nextSeq),this.records.push({seq:this.nextSeq++,lvl:e,type:t,clock:this.duel.clock.getClone(),text:l,duelist:r,mainEntity:n,subEntities:s??[],from:o,to:d}),this.onUpdateEvent.trigger(this.nextSeq-1),console.log(this.nextSeq-1)});this.nextSeq=0,this.duel=e}get onUpdate(){return this.onUpdateEvent.expose()}get lastRecord(){return this.records.slice(-1)[0]}};const rn=["DuelEntitiesSelector","DuelActionSelector","DuelTextSelector"];class Ko{constructor(e){u(this,"onUpdateEvent",new Ke);u(this,"states");u(this,"view");u(this,"cancelAll",()=>{rn.forEach(e=>this.states[e]="Disable"),console.info(this,"cancelAll"),this.onUpdateEvent.trigger()});u(this,"duelEntitiesSelectorArg",{title:"対象を選択",entities:[],validator:()=>!0,qty:-1,cancelable:!1,chainBlockInfos:[]});u(this,"duelEntitiesSelectorValue");u(this,"duelEntitiesSelectorResolve",()=>{});u(this,"selectDuelEntities",async e=>(this.duelEntitiesSelectorArg=e,this.states.DuelEntitiesSelector="Shown",this.onUpdateEvent.trigger(),new Promise(t=>{this.duelEntitiesSelectorResolve=a=>{this.states.DuelEntitiesSelector="Disable",this.onUpdateEvent.trigger(),t(a)}})));u(this,"cardActionSelectorArg",{title:"カード操作を選択。",activator:void 0,actions:[],cancelable:!1});u(this,"cardActionSelectorResolve",()=>{});u(this,"cardActionSelectorValue");u(this,"selectAction",async(e,t)=>(this.cardActionSelectorArg=t,this.states.DuelActionSelector="Shown",e.onWaitEnd.append(this.cancelAll),this.onUpdateEvent.trigger(),new Promise(a=>{this.cardActionSelectorResolve=r=>{this.states.DuelActionSelector="Disable",e.onWaitEnd.remove(this.cancelAll),this.onUpdateEvent.trigger(),a(r)}})));u(this,"duelTextSelectorArg",{title:"カード操作を選択。",choises:[],cancelable:!1});u(this,"duelTextSelectorResolve",()=>{});u(this,"duelTextSelectorValue");u(this,"selectText",async(e,t)=>(this.duelTextSelectorArg=t,this.states.DuelTextSelector="Shown",e.onWaitEnd.append(this.cancelAll),this.onUpdateEvent.trigger(),new Promise(a=>{this.duelTextSelectorResolve=r=>{this.states.DuelTextSelector="Disable",e.onWaitEnd.remove(this.cancelAll),this.onUpdateEvent.trigger(),a(r)}})));this.view=e,this.states=rn.reduce((t,a)=>(t[a]="Disable",t),{})}get onUpdate(){return this.onUpdateEvent.expose()}}const Xo=i=>new Promise(e=>setTimeout(e,i)),Jo=()=>{let i=()=>{},e=()=>{};return{promise:new Promise((a,r)=>{i=a,e=r}),resolve:i,reject:e}};class Io{constructor(e){u(this,"onDuelUpdateEvent",new Ke);u(this,"requireUpdate",()=>{this.onDuelUpdateEvent.trigger()});u(this,"onWaitStartEvent",new Ke);u(this,"onWaitEndEvent",new Ke);u(this,"onDragStartEvent",new Ke);u(this,"onDragEndEvent",new Ke);u(this,"onAnimationStartEvent",new Ke);u(this,"onShowCardEntityEvent",new Ke);u(this,"duel");u(this,"modalController");u(this,"_message");u(this,"waitMode");u(this,"infoBoardState");u(this,"infoBoardCell");u(this,"removeSvelteInfo",e=>{const t={...e};return t.selectedEntities&&(t.selectedEntities=De.recreateArray(this.duel.field,t.selectedEntities)),t});u(this,"getCell",(e,t)=>this.duel.field.cells[e][t]);u(this,"showCardInfo",(e,t)=>{this.onShowCardEntityEvent.trigger({card:e,mode:t})});u(this,"dispose",()=>{this.onDragStartEvent.clear(),this.onDragEndEvent.clear(),this.onDuelUpdateEvent.clear(),this.onWaitStartEvent.clear(),this.onWaitEndEvent.clear()});u(this,"waitFieldAction",async e=>{if(this.duel.getTurnPlayer().duelistType==="NPC"){const t=this.duel.getTurnPlayer().selectActionForNPC(e,[]);return t?{action:t}:{phaseChange:this.duel.nextPhaseList[0]}}return await this._waitDuelistAction(this.duel.getTurnPlayer(),e,"SelectFieldAction","")});u(this,"waitQuickEffect",async(e,t,a,r,n)=>{if(t.length===0)return;if(e.duelistType==="NPC")return e.selectActionForNPC(t,a);const s=[];return s.push(this.modalController.selectAction(this,{title:r,activator:e,actions:t,cancelable:n}).then(o=>o&&o)),s.push(this._waitDuelistAction(e,t,"SelectAction",this.message).then(o=>(this.infoBoardState="Log",o.action))),await Promise.any(s)});u(this,"waitSubAction",async(e,t,a,r=!1)=>{if(e.duelistType==="NPC")throw Error("Not implemented");return await this._waitDuelistAction(e,t,"SelectAction",a,void 0,void 0,void 0,r)});u(this,"waitSelectEntities",async(e,t,a,r,n,s=!1)=>{if(!t.length)return;let o=[];if(a&&t.length===a)return[...t];if(e.duelistType==="NPC"){for(;!r(o);){const l=a&&a>0?a:Math.floor(Math.random()*t.length)+1;o=t.randomPickMany(l)}return o}this.waitMode=t.every(l=>l.fieldCell.isPlayFieldCell&&l.getIndexInCell()===0||l.fieldCell.cellType==="Hand"&&l.controller===e)?"SelectFieldEntities":"SelectEntities",console.log(t);const d=await this._waitDuelistAction(e,[],this.waitMode,n,t,a,r,s);return console.log(d),[...d.selectedEntities??[]]});u(this,"_waitDuelistAction",async(e,t,a,r,n,s,o,d=!1)=>{this.waitMode=a,this._message=r,this.onDuelUpdateEvent.trigger();const l=Jo(),c={resolve:l.resolve,activator:e,enableActions:t,qty:s,chainBlockInfos:e.duel.chainBlockInfos,entitiesValidator:o||(()=>!1),selectableEntities:n||[]};n&&o&&this.waitMode==="SelectEntities"&&(c.duelEntitiesSelectorArg={title:r,entities:n,validator:o,qty:s??-1,cancelable:!1,chainBlockInfos:e.duel.chainBlockInfos}),this.onWaitStartEvent.trigger(c);const v=await l.promise;if(this.waitMode="None",this.onWaitEndEvent.trigger(),v.surrender)throw new ti(this.duel.duelists.Above);if(!d&&v.cancel)throw new ve("キャンセル不可のアクションがキャンセルされた。",v,t,a,n);return this.infoBoardState="Log",this.removeSvelteInfo(v)});u(this,"waitSelectSummonDest",async(e,t,a,r,n)=>{const s=a.length>1?"カードを召喚先へドラッグ。":"表示形式を選択。",o=r.map(v=>ni.createDammyAction(t,v,a,v)),d=this.modalController.selectAction(t.field.duel.view,{title:s,activator:e,actions:o,cancelable:!1}),l=this.waitSubAction(t.controller,o,s,n).then(v=>v.action),c=await Promise.any([d,l]);if(!c&&!n)throw new ve("キャンセル不可のアクションがキャンセルされた。",c);if(c){if(!c.cell)throw new ve("召喚先のセルが指定されなかった。",c);if(!c.pos)throw new ve("表示形式が指定されなかった。",c);return{dest:c.cell,pos:c.pos}}});u(this,"waitSelectText",async(e,t,a=!1)=>this.duel.view.modalController.selectText(this.duel.view,{title:t,choises:e,cancelable:a}));u(this,"waitAnimation",async e=>(this._message="",this.waitMode="Animation",this.onDuelUpdateEvent.trigger(),new Promise(t=>this.onAnimationStartEvent.trigger({...e,resolve:t}))));u(this,"setDraggingActions",e=>{this.onDragStartEvent.trigger(e),this.requireUpdate()});u(this,"removeDraggingActions",()=>{this.onDragEndEvent.trigger()});u(this,"waitDammyActions",async(e,t,a,r,n,s=!1)=>{let o=a.randomPick();if(a.length>1&&e.duelistType!=="NPC"){const d=[ni.createDammyAction(t,n,a,void 0)];this.duel.view.modalController.selectAction(this.duel.view,{title:r,activator:e,actions:d,cancelable:!1});const l=await this.duel.view.waitSubAction(e,d,r,s),c=l.action;if(!c&&!s)throw new ui("",l);if(!c)return;o=c.cell||o}return o});this.duel=e,this._message="",this.waitMode="None",this.infoBoardState="Log",this.infoBoardCell=e.duelists.Below.getExtraDeck(),this.modalController=new Ko(this)}get onDuelUpdate(){return this.onDuelUpdateEvent.expose()}get onWaitStart(){return this.onWaitStartEvent.expose()}get onWaitEnd(){return this.onWaitEndEvent.expose()}get onDragStart(){return this.onDragStartEvent.expose()}get onDragEnd(){return this.onDragEndEvent.expose()}get onAnimation(){return this.onAnimationStartEvent.expose()}get onShowCardEntity(){return this.onShowCardEntityEvent.expose()}get message(){return this._message||this.duel.log.lastRecord.text}}const dr=["turn","phaseSeq","stepSeq","stageSeq","chainSeq","chainBlockSeq","procSeq"];[...dr];class ec{constructor(){u(this,"onClockChangeEvents",{turn:new Ke,phaseSeq:new Ke,stepSeq:new Ke,stageSeq:new Ke,chainSeq:new Ke,chainBlockSeq:new Ke,procSeq:new Ke});u(this,"_turn",0);u(this,"_phaseSeq",0);u(this,"_stepSeq",0);u(this,"_stageSeq",0);u(this,"_chainSeq",0);u(this,"_chainBlockSeq",0);u(this,"_procSeq",0);u(this,"_totalProcSeq",0);u(this,"_periodKey");u(this,"_previousStartPoints",{turn:0,phaseSeq:0,stepSeq:0,stageSeq:0,chainSeq:0,chainBlockSeq:0,procSeq:0});u(this,"_currentStartPoints",{turn:0,phaseSeq:0,stepSeq:0,stageSeq:0,chainSeq:0,chainBlockSeq:0,procSeq:0});u(this,"setPhase",(e,t)=>{const a=Object.values(Qt).filter(r=>r.phase===t).find(r=>(r.step??"start")==="start");if(!a)throw new ve("想定されない状態",this.period,t,Qt);t==="draw"?(this.turn>0&&e.log.info("ターン終了。",e.getTurnPlayer()),this._turn++,this._phaseSeq=0):(e.log.info(`フェイズ移行（${this.period.name}→${a.name}）`,e.getTurnPlayer()),this._phaseSeq++),this._stepSeq=0,this._stageSeq=0,this.periodKey=a.key});u(this,"setStep",(e,t)=>{const a=this.period.phase,r=Object.values(Qt).filter(n=>n.phase===a).find(n=>(n.step??"")===t);if(!r)throw new ve("想定されない状態",this.period,t,Qt);this.period.name!==r.name&&(e.log.info(`ステップ移行（${this.period.name}→${r.name}）`,e.getTurnPlayer()),this._stepSeq++,this._stageSeq=0,this.periodKey=r.key)});u(this,"setStage",(e,t)=>{const a=this.period,r=Object.values(Qt).filter(n=>n.phase===a.phase).filter(n=>n.step===a.step).find(n=>(n.stage??"")===t);if(!r)throw new ve("想定されない状態",this.period,t,Qt);e.log.info(`タイミング移行（${this.period.name}→${r.name}）`,e.getTurnPlayer()),this._stageSeq++,this.periodKey=r.key});u(this,"incrementChainSeq",()=>{this._chainSeq++,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq()});u(this,"incrementChainBlockSeq",()=>{this._chainBlockSeq++,this._procSeq=0,this.incrementTotalProcSeq()});u(this,"incrementProcSeq",()=>{this._procSeq++,this.incrementTotalProcSeq()});u(this,"incrementTotalProcSeq",()=>{this._totalProcSeq++;let e=!1;dr.toReversed().forEach(t=>{e&&(this._previousStartPoints[t]=this.currentStartPoints[t],this._currentStartPoints[t]=this.totalProcSeq),e=this[t]===0}),this.onClockChangeEvents.procSeq.trigger(this),dr.toReversed().filter(t=>this._currentStartPoints[t]=this.totalProcSeq).forEach(t=>{console.info(this.constructor.name,"event trigger",t,this.periodKey,this.totalProcSeq),this.onClockChangeEvents[t].trigger(this)})});u(this,"toString",()=>`${this.totalProcSeq}(t${this.turn}-phs${this.phaseSeq}-stp${this.stepSeq}-stg${this.stepSeq}-c${this.chainSeq}-cb${this.chainBlockSeq}-prc${this.procSeq})`);u(this,"getClone",()=>({turn:this.turn,phaseSeq:this.phaseSeq,stepSeq:this.stepSeq,stageSeq:this.stageSeq,chainSeq:this.chainSeq,chainBlockSeq:this.chainBlockSeq,procSeq:this.procSeq,totalProcSeq:this.totalProcSeq,period:this.period}));u(this,"isSameTurn",e=>this.turn===e.turn);u(this,"isSameChain",e=>this.turn===e.turn&&this.phaseSeq===e.phaseSeq&&this.stepSeq===e.stepSeq&&this.stageSeq===e.stageSeq&&this.chainSeq===e.chainSeq);u(this,"isPreviousChain",e=>this.turn===e.turn&&this.phaseSeq===e.phaseSeq&&this.stepSeq===e.stepSeq&&this.stageSeq===e.stageSeq&&this.chainSeq===e.chainSeq+1);u(this,"isPreviousTurn",e=>this.turn===e.turn+1);u(this,"isPreviousProc",e=>this.totalProcSeq===e.totalProcSeq+1);u(this,"isUponAttackDeclaration",()=>this.period.step==="battle"&&this.chainSeq===1);this._periodKey="end"}get onTurnChange(){return this.onClockChangeEvents.turn.expose()}get onStageChange(){return this.onClockChangeEvents.stageSeq.expose()}get onProcSeqChange(){return this.onClockChangeEvents.procSeq.expose()}get previousStartPoints(){return this._previousStartPoints}get currentStartPoints(){return this._currentStartPoints}set periodKey(e){this._periodKey!==e&&(this._periodKey=e,this._chainSeq=0,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq())}get periodKey(){return this._periodKey}get period(){return Qt[this.periodKey]}get turn(){return this._turn}get phaseSeq(){return this._phaseSeq}get stepSeq(){return this._stepSeq}get stageSeq(){return this._stageSeq}get chainSeq(){return this._chainSeq}get chainBlockSeq(){return this._chainBlockSeq}get procSeq(){return this._procSeq}get totalProcSeq(){return this._totalProcSeq}get isFirstChain(){return this.chainSeq===0}}class tc{constructor(e){u(this,"nextSeq");u(this,"records",[]);u(this,"duel");u(this,"push",e=>{this.records.push({seq:this.nextSeq++,clock:this.duel.clock.getClone(),chainBlockInfo:e})});this.nextSeq=0,this.duel=e}}const ic=["PlayFirst","DrawFirst","Random"],nn={PlayFirst:"先攻",DrawFirst:"後攻",Random:"ランダム"};class ti extends Error{constructor(t){const a=t?`デュエルが終了した。勝者：${t.profile.name}`:"デュエルが終了した。ドロー。";super(a);u(this,"winner");this.winner=t}}class ve extends Error{constructor(t,...a){super(t);u(this,"message");u(this,"items");this.message=t,this.items=a}}class ui extends ve{constructor(...e){super("キャンセル不可のアクションがキャンセルされた。",...e)}}class ac{constructor(e,t,a,r=[],n,s,o,d=[],l="Random"){u(this,"view");u(this,"log");u(this,"chainBlockLog");u(this,"clock");u(this,"nextPhaseList");u(this,"field");u(this,"attackingMonster");u(this,"targetForAttack");u(this,"_chainBlockInfos");u(this,"duelists");u(this,"priorityHolder");u(this,"isEnded");u(this,"coin",!1);u(this,"startMode");u(this,"distributeOperators",e=>{console.info(`[totalProcSeq]:${e.totalProcSeq}`);let t=0;for(;;){if(t++,t>10)throw new ve("無限ループ発生");if(this.field.procFilterPool.distributeAll(this)&&this.field.statusOperatorPool.distributeAll(this)&&this.field.numericStateOperatorPool.distributeAll(this)&&this.field.summonFilterPool.distributeAll(this))return}});u(this,"getTurnPlayer",()=>this.clock.turn%2===0?this.secondPlayer:this.firstPlayer);u(this,"getNonTurnPlayer",()=>this.clock.turn%2===0?this.firstPlayer:this.secondPlayer);u(this,"main",async()=>{console.info("main start!"),this.coin=this.startMode==="PlayFirst"?!0:this.startMode==="DrawFirst"?!1:Math.random()>.5,this.priorityHolder=this.firstPlayer;for(const e of Object.values(this.duelists))e.pushDeck(),e.getDeckCell().shuffle(),e.initHand.length&&e.initHand.forEach(t=>{const a=e.getDeckCell().cardEntities.find(r=>r.origin.name===t);if(!a){this.log.info(`初手操作により${t}を手札に加えようとしたが、デッキに存在しない。`);return}a.addToHand(["System"],void 0,void 0),this.log.info(`初手操作により${a.toString()}を手札に加えた`,e)}),await e.draw(5-e.getHandCell().cardEntities.length,void 0,void 0);this.log.info(`【デュエル開始】${this.firstPlayer.profile.name} V.S. ${this.secondPlayer.profile.name}`),this.log.info(`先攻：${this.firstPlayer.profile.name} 後攻：${this.secondPlayer.profile.name}`),this.moveNextPhase("draw"),this.view.requireUpdate();try{for(;!this.isEnded&&(this.clock.period.phase==="draw"?await this.procDrawPhase():this.phase==="standby"?await this.procStanbyPhase():this.phase==="main1"?await this.procMainPhase():this.phase==="battle1"?await this.procBattlePhase():this.phase==="battle2"?await this.procBattlePhase():this.phase==="main2"?await this.procMainPhase():this.phase==="end"&&await this.procEndPhase(),!(this.clock.turn>1e3)););}catch(e){e instanceof ti?(console.info(e),this.isEnded=!0,this.log.info(e.winner?`デュエル終了。勝者${e.winner.profile.name}`:"引き分け")):e instanceof Error&&this.log.error(e)}finally{this.view.requireUpdate(),this.view.dispose(),this.log.dispose()}});u(this,"moveNextPhase",e=>{this.clock.setPhase(this,e),this.phase==="main2"||this.clock.turn===1?this.nextPhaseList=["end"]:this.phase==="battle1"||this.phase==="battle2"?this.nextPhaseList=["main2"]:this.phase==="main1"?this.nextPhaseList=["battle1","end"]:this.nextPhaseList=[]});u(this,"declareAnAttack",(e,t)=>{var r;this.attackingMonster=e,this.targetForAttack=t;let a=" ("+((r=t.battlePosition==="Attack"?t.atk:t.def)==null?void 0:r.toString())+")";t.face==="FaceDown"&&(a=" (????)"),t.entityType==="Duelist"&&(a=""),e.info.attackCount++,this.log.info(`攻撃宣言：${e.toString()} (${e.atk})⇒ ${t.toString()}${a}`,e.controller)});u(this,"procDrawPhase",async()=>{Object.values(this.duelists).forEach(e=>e.initForDrawPhase()),this.log.info("ドローフェイズ開始。",this.getTurnPlayer()),this.clock.turn===1?this.log.info("先攻プレイヤーはドローできない。",this.getTurnPlayer()):await this.getTurnPlayer().draw(1,void 0,void 0),this.field.getCardsOnField().forEach(e=>e.initForTurn()),await this.procSpellSpeed1(),this.moveNextPhase("standby")});u(this,"procStanbyPhase",async()=>{await this.procSpellSpeed1(),this.moveNextPhase("main1")});u(this,"procMainPhase",async()=>{for(;;){this.priorityHolder=this.getTurnPlayer();const e=await this.view.waitFieldAction(this.getEnableActions(this.priorityHolder,["NormalSummon","SpellTrapSet","SpecialSummon","FlipSummon","ChangeBattlePosition","IgnitionEffect","QuickEffect","CardActivation"],["Normal","Quick","Counter"],[]));if(e&&e.action){if([...no].includes(e.action.playType)){const a=await e.action.prepare(this.priorityHolder,e.action.cell,void 0,[],!0,!1);if(a===void 0)continue;await e.action.execute(a,this.chainBlockInfos),this.clock.incrementChainSeq()}else await this.procChainBlock({activator:this.priorityHolder,action:e.action},void 0);for(;await this.procChainBlock(void 0,void 0););continue}const t=e.phaseChange;if(t){this.priorityHolder=this.getNonTurnPlayer();const a=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(this.priorityHolder,["QuickEffect","TriggerEffect"],["Quick","Counter"],[]),[],"",!0);if(a){for(await this.procChainBlock({activator:this.priorityHolder,action:a},void 0);await this.procChainBlock(void 0,void 0););continue}this.moveNextPhase(t);return}}});u(this,"procBattlePhase",async()=>{await this.procBattlePhaseStartStep(),await this.procBattlePhaseBattleStep(),await this.procBattlePhaseEndStep()});u(this,"procBattlePhaseStartStep",async()=>{this.clock.setStep(this,"start"),this.priorityHolder=this.getTurnPlayer(),this.attackingMonster=void 0,this.targetForAttack=void 0,await this.procSpellSpeed1()});u(this,"procBattlePhaseBattleStep",async()=>{for(;;){this.clock.setStep(this,"battle"),this.priorityHolder=this.getTurnPlayer();const e=await this.view.waitFieldAction(this.getEnableActions(this.priorityHolder,["Battle"],["Normal"],[]));if(e.phaseChange)break;if(e.action){const t=await e.action.prepare(this.priorityHolder,e.action.cell,void 0,[],!0,!1);if(!t)continue;await e.action.execute(t,[]),this.clock.incrementChainSeq();let a=!0;for(;;){const r=this.getNonTurnPlayer().getMonstersOnField().map(s=>[s.seq,s.moveLog.latestRecord.movedAt.totalProcSeq]);for(;await this.procChainBlock(void 0,void 0););if(!this.attackingMonster)throw new ve("想定されない状態");this.attackingMonster.isOnField?this.attackingMonster.face==="FaceDown"?(this.log.info(`${this.attackingMonster.toString()}が裏側守備表示になったため、戦闘が中断された。`),a=!1):this.attackingMonster.orientation==="Horizontal"&&(this.log.info(`${this.attackingMonster.toString()}が守備表示になったため、戦闘が中断された。`),a=!1):(this.log.info(`${this.attackingMonster.toString()}がフィールドにいなくなったため、戦闘が中断された。`),a=!1);const n=this.getNonTurnPlayer().getMonstersOnField().map(s=>[s.seq,s.moveLog.latestRecord.movedAt.totalProcSeq]);if(r.length!==n.length)throw this.log.info("モンスターの数が増減したためバトルステップの巻き戻しが発生。"),new ve("巻き戻し未実装");if(r.some(([s,o])=>n.every(([d,l])=>d!==s||l!==o)))throw this.log.info("モンスターの数が増減したためバトルステップの巻き戻しが発生。"),new ve("巻き戻し未実装");break}if(!a)continue;await this.procBattlePhaseDamageStep(t)}}});u(this,"procBattlePhaseDamageStep",async e=>{if(!this.attackingMonster||!this.targetForAttack)throw new ve("想定されない状態",this.attackingMonster,this.targetForAttack);if(this.targetForAttack.entityType!=="Duelist"&&!this.targetForAttack.isOnFieldAsMonster)throw console.log("想定されない状態",this.attackingMonster,this.targetForAttack),new ve("想定されない状態",this.attackingMonster,this.targetForAttack);await this.procBattlePhaseDamageStep1(),await this.procBattlePhaseDamageStep2(this.attackingMonster,this.targetForAttack),await this.procBattlePhaseDamageStep3(e,this.attackingMonster,this.targetForAttack),await this.procBattlePhaseDamageStep4(),await this.procBattlePhaseDamageStep5()});u(this,"procBattlePhaseDamageStep1",async()=>{for(this.clock.setStage(this,"start");await this.procChainBlock(void 0,void 0););});u(this,"procBattlePhaseDamageStep2",async(e,t)=>{for(this.clock.setStage(this,"beforeDmgCalc"),(t==null?void 0:t.battlePosition)==="Set"&&t.setBattlePosition("Defense",["Flip","FlipByBattle"],e,e.controller);await this.procChainBlock(void 0,void 0););});u(this,"procBattlePhaseDamageStep3",async(e,t,a)=>{if(t.atk===void 0)throw new ve("想定されない状態",this.attackingMonster,this.targetForAttack);for(this.clock.setStage(this,"dmgCalc");await this.procChainBlock(void 0,void 0););const r=t.atk,n=(a.battlePosition==="Attack"?a.atk:a.def)??0;a.entityType==="Duelist"?(e.activator.writeInfoLog(`ダメージ計算：${t.toString()} (${r}) ⇒ ${a.toString()}`),t.controller.getOpponentPlayer().battleDamage(r-n,t)):(e.activator.writeInfoLog(`ダメージ計算：${t.toString()} (${r}) ⇒ ${a.toString()} (${n})`),r>0&&r>n&&a.battlePosition==="Attack"?t.controller.getOpponentPlayer().battleDamage(r-n,t):r<n&&t.controller.battleDamage(n-r,a),r>0&&(r>n||r===n&&a.battlePosition==="Attack")&&await pe.tryMarkForDestory([a],e),a.battlePosition==="Attack"&&r<=n&&await pe.tryMarkForDestory([t],e));const s=Object.values(this.duelists).filter(o=>o.lp<=0);if(s.length>0)throw new ti(Object.values(this.duelists).filter(o=>!s.includes(o)).pop())});u(this,"procBattlePhaseDamageStep4",async()=>{for(this.clock.setStage(this,"afterDmgCalc");await this.procChainBlock(void 0,void 0););});u(this,"procBattlePhaseDamageStep5",async()=>{for(this.clock.setStage(this,"end"),console.log(this.clock.period.key,this.clock.toString()),await pe.waitCorpseDisposal(this),console.log(this.clock.period.key,this.clock.toString()),this.clock.incrementChainSeq(),console.log(this.clock.period.key,this.clock.toString());await this.procChainBlock(void 0,void 0););});u(this,"procBattlePhaseEndStep",async()=>{this.clock.setStep(this,"end"),this.priorityHolder=this.getTurnPlayer(),await this.procSpellSpeed1(),this.moveNextPhase("main2")});u(this,"procEndPhase",async()=>{for(await this.procSpellSpeed1();;){const t=this.getTurnPlayer().getHandCell().cardEntities.length;if(t<7)break;await this.getTurnPlayer().discard(t-6,["Rule"])}this.moveNextPhase("draw")});u(this,"procSpellSpeed1",async()=>{this.priorityHolder=this.getTurnPlayer();let e=0;const t={Above:Number.MAX_VALUE,Below:Number.MAX_VALUE};for(;Object.values(t).some(a=>a!==0);){const a=this.getEnableActions(this.priorityHolder,["IgnitionEffect","QuickEffect","CardActivation","LingeringEffect"],["Normal","Quick","Counter"],[]);t[this.priorityHolder.seat]=a.filter(s=>s.isMandatory).length;let r=a.find(s=>s.isMandatory),n=!r;if(this.priorityHolder.isTurnPlayer?e===0&&(n=!0):t[this.priorityHolder.getOpponentPlayer().seat]>=0&&(n=!0),a.length&&(a.length>1||!r)&&(r=await this.view.waitQuickEffect(this.priorityHolder,a,[],n?"":"まだ発動しなければならない効果が残っている。",n)),r){if(xr.some(s=>s===r.playType))await this.procChainBlock({activator:this.priorityHolder,action:r},void 0);else{const s=await r.prepare(this.priorityHolder,void 0,void 0,[],!0,!1);if(!s)continue;await r.execute(s,[]),await r.settle(s,[]),this.clock.incrementChainSeq()}await this.procFreeChain(),this.priorityHolder=this.getTurnPlayer(),e=0;continue}this.priorityHolder=this.priorityHolder.getOpponentPlayer(),e++}});u(this,"procFreeChain",async()=>{for(;await this.procChainBlock(void 0,void 0););});u(this,"procChainBlock",async(e,t)=>{const a=this.chainBlockInfos.length===0;let r=e?[]:t??Object.values(this.duelists).flatMap(o=>this.getEnableActions(o,["TriggerEffect"],[this.chainBlockInfos.length?"Quick":"Normal"],this.chainBlockInfos).map(d=>({activator:o,action:d,targetChainBlock:this.chainBlockInfos.slice(-1)[0]}))),n=!1,s;if(e)s={...e,targetChainBlock:void 0},this.priorityHolder=s.activator,n=!0;else if(r.length>0){const o=await this.selectTriggerEffect(r);o?(r=r.filter(d=>d!==o),s=o,this.priorityHolder=s.activator,n=!0):r=[]}if(!n){let o=0;for(;o<2;){this.priorityHolder=this.priorityHolder.getOpponentPlayer();const d=["Counter"];this.chainBlockInfos.every(v=>v.action.spellSpeed!=="Counter")&&d.push("Quick");const l=this.chainBlockInfos.length?"※メッセージ考え中※":"クイックエフェクト発動タイミング。効果を発動しますか？",c=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(this.priorityHolder,["QuickEffect","CardActivation"],d,this.chainBlockInfos),this.chainBlockInfos,l,!0);if(c){s={activator:this.priorityHolder,action:c,targetChainBlock:this.chainBlockInfos.slice(-1)[0]},n=!0;break}o++}}if(console.info("selected action: ",s),s){const o=s.activator,d=await s.action.prepare(o,s.action.cell,s.targetChainBlock,this.chainBlockInfos,!1,!1);if(!d)throw new ui(s);this.chainBlockLog.push(d);const l=[...d.action.entity.info.isEffectiveIn];if(this._chainBlockInfos.push(d),this.clock.incrementProcSeq(),this.clock.incrementChainBlockSeq(),await this.procChainBlock(void 0,r.length?r.filter(c=>c.action.seq!==(s==null?void 0:s.action.seq)):void 0),d.chainNumber&&this.log.info(`チェーン${d.chainNumber}: ${d.action.toString()}の効果処理。`,o),d.isNegatedActivationBy)d.chainNumber&&this.log.info(`チェーン${d.chainNumber}: ${d.action.toString()}を${d.action.toString()}によって発動を無効にした。`,d.activator);else{let c=d.action.entity.isEffective,v="";if(c){if(d.isNegatedEffectBy)v=`チェーン${d.chainNumber}: ${d.action.toString()}を${d.action.toString()}によって効果を無効にした。`,c=!1;else if(!l.includes(d.isActivatedIn.cellType)){const p=d.action.entity.moveLog.records.findLast(h=>h.face==="FaceDown"&&h.orientation==="Horizontal");c=(p&&this.clock.isSameChain(p.movedAt))??!1}}c?(await d.action.execute(d,this.chainBlockInfos),d.state="done"):(d.state="failed",d.chainNumber&&(v=v||`チェーン${d.chainNumber}: カードの効果が無効となっているため${d.action.toString()}の効果処理を行えない。`),this.log.info(v,d.activator)),await s.action.settle(d,this.chainBlockInfos)}console.log(this.clock.totalProcSeq),this.clock.incrementChainBlockSeq(),console.log(this.clock.totalProcSeq),a?(await pe.sendManyToGraveyardForTheSameReason(this._chainBlockInfos.filter(c=>c.action.playType==="CardActivation").filter(c=>!c.action.isLikeContinuousSpell).map(c=>c.action.entity).filter(c=>c.isOnField).filter(c=>c.face==="FaceUp"),["Rule"],void 0,void 0),this._chainBlockInfos.reset(),d.nextAction&&await this.procChainBlock({activator:d.activator,action:d.nextAction},void 0),this.clock.incrementChainSeq()):d.nextAction&&await d.nextAction.directExecute(d.activator,!1)}return n});u(this,"selectTriggerEffect",async e=>{if(e.length>0)for(const t of[!0,!1])for(const a of[this.getTurnPlayer(),this.getNonTurnPlayer()]){const r=e.filter(s=>s.action.isMandatory===t&&s.activator===a);if(r.length===0)continue;if(r.length===1&&t)return r[0];const n=await this.view.waitQuickEffect(a,r.map(s=>s.action),this.chainBlockInfos,"トリガーエフェクトを選択。",!t);if(n)return r.find(s=>s.action===n)}});u(this,"executeSystemPeriodActions",()=>{Object.values(this.duelists).flatMap(e=>this.getEnableActions(e,["SystemPeriodAction"],["Normal"],[]).map(t=>({duelist:e,action:t})))});u(this,"getEnableActions",(e,t,a,r)=>{const n=ro.some(s=>{var o;return s===((o=r.slice(-1)[0])==null?void 0:o.action.playType)});return this.field.getAllCardEntities().flatMap(s=>s.actions).filter(s=>s.negateSummon||!n).filter(s=>s.executableCells.includes(s.entity.fieldCell.cellType)).filter(s=>s.executablePeriods.includes(this.clock.period.key)).filter(s=>t.includes(s.playType)).filter(s=>a.includes(s.spellSpeed)).filter(s=>s.validateDuelist(e)).filter(s=>s.validate(e,r,!1))});this.clock=new ec,this.nextPhaseList=[],this.isEnded=!1,this.startMode=l,this.duelists={Below:new si(this,"Below",e,t,a,r),Above:new si(this,"Above",n,s,o,d)},this.priorityHolder=this.firstPlayer,this._chainBlockInfos=[],this.field=new Do(this),this.clock.onProcSeqChange.append(this.distributeOperators),this.clock.onStageChange.append(this.executeSystemPeriodActions),this.view=new Io(this),this.log=new Qo(this),this.chainBlockLog=new tc(this)}get phase(){return this.clock.period.phase}get step(){return this.clock.period.step}get stage(){return this.clock.period.stage}get chainBlockInfos(){return this._chainBlockInfos}get firstPlayer(){return this.coin?this.duelists.Below:this.duelists.Above}get secondPlayer(){return this.coin?this.duelists.Above:this.duelists.Below}}const rc=()=>{const i=[];["サイバー・ドラゴン","六武衆のご隠居","アンノウン・シンクロン"].forEach(c=>i.push({name:c,actions:[We,he,_e,Te,{title:"特殊召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:c==="アンノウン・シンクロン"?1:void 0,validate:v=>{const p=v.action.entity.field.getMonstersOnField();if(!(p.length==0||p.some(h=>h.controller===v.activator)))return cr(v,["Attack","Defense"],[])},prepare:v=>oi(v,"SpecialSummon",["SpecialSummon","Rule"],Xe),execute:ci,settle:async()=>!0}]}));const e={name:"ジャンク・フォアード",actions:[We,he,_e,Te,{title:"特殊召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:c=>{if(!c.activator.getMonstersOnField().length)return cr(c,Xe,[])},prepare:c=>oi(c,"SpecialSummon",["SpecialSummon","Rule"],Xe),execute:ci,settle:async()=>!0}]};i.push(e);const t={name:"Ｄ－ＨＥＲＯ ディアボリックガイ",actions:[We,he,_e,Te,{title:"①リクルート",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:10,canPayCosts:Ji,validate:c=>c.activator.getDeckCell().cardEntities.filter(p=>p.nm==="Ｄ－ＨＥＲＯ ディアボリックガイ").length===0?void 0:c.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:Ra,prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async c=>{const v=c.activator.getDeckCell().cardEntities.find(p=>p.nm==="Ｄ－ＨＥＲＯ ディアボリックガイ");return v?ts(c,[v]):!1},settle:async()=>!0}]};i.push(t);const a={name:"ゾンビキャリア",actions:[We,he,_e,Te,{title:"①自己再生",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],canPayCosts:c=>c.activator.getHandCell().cardEntities.length>0,validate:c=>c.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:async c=>{const v=c.activator.getHandCell().cardEntities,p=await c.activator.duel.view.waitSelectEntities(c.activator,v,1,h=>h.length===1,"デッキトップに戻すカードを一枚選択。");if(!p)throw new ui(c);return await p[0].returnToDeck("Top",["Cost"],c.action.entity,c.activator),{returnToDeck:p}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:async c=>(c.action.entity.info.willBeBanished=await ei(c),c.action.entity.info.willBeBanished),settle:async()=>!0}]};i.push(a);const r={name:"グローアップ・バルブ",actions:[We,he,_e,Te,{title:"①自己再生",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:1,canPayCosts:c=>c.activator.getDeckCell().cardEntities.length>0,validate:c=>c.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:async c=>{const v=c.activator.getDeckCell().cardEntities[0];return await c.activator.getDeckCell().cardEntities[0].sendToGraveyard(["Cost"],c.action.entity,c.activator),{sendToGraveyard:[v]}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:c=>ei(c),settle:async()=>!0}]};i.push(r);const n={name:"終末の騎士",actions:[We,he,_e,Te,{title:"①墓地送り",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...Me,...Ye],executableDuelistTypes:["Controller"],validate:c=>{if(c.action.entity.hasBeenSummonedNow(["NormalSummon","SpecialSummon","FlipSummon"])&&c.activator.getDeckCell().cardEntities.filter(v=>v.attr.includes("Dark")).length!==0)return[]},prepare:async c=>{const v=["SendToGraveyardFromDeck"];return c.action.entity.moveLog.latestRecord.movedAs.includes("NormalSummon")?v.push("IfNormarlSummonSucceed"):v.push("IfSpecialSummonSucceed"),{selectedEntities:[],chainBlockTags:v,prepared:void 0}},execute:async c=>{const v=c.activator.getDeckCell().cardEntities.filter(p=>p.attr.includes("Dark"));return v.length===0?!1:(await c.action.entity.field.sendToGraveyard("墓地に送るモンスターを選択",c.activator,v,1,p=>p.length===1,["Effect"],c.action.entity,!1),c.activator.getDeckCell().shuffle(),!0)},settle:async()=>!0}]};i.push(n);const s={name:"マスマティシャン",actions:[We,he,_e,Te,{title:"①墓地送り",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...Me,...Ye],executableDuelistTypes:["Controller"],validate:c=>{if(c.action.entity.hasBeenSummonedNow(["NormalSummon"])&&c.activator.getDeckCell().cardEntities.find(v=>(v.lvl??5)<5))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["IfNormarlSummonSucceed","SendToGraveyardFromDeck"],prepared:void 0}),execute:async c=>{const v=c.activator.getDeckCell().cardEntities.filter(p=>(p.lvl??5)<5);return v.length===0?!1:(await c.action.entity.field.sendToGraveyard("墓地に送るモンスターを選択",c.activator,v,1,p=>p.length===1,["Effect"],c.action.entity,!1),c.activator.getDeckCell().shuffle(),!0)},settle:async()=>!0},{title:"②ドロー",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...Me,...Ye],executableDuelistTypes:["Controller"],validate:c=>{if(c.action.entity.face!=="FaceDown"&&c.action.entity.moveLog.latestRecord.movedAs.includes("BattleDestroy")&&c.action.entity.wasMovedAtPreviousChain&&c.activator.getDeckCell().cardEntities.length!==0)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async c=>(await c.activator.draw(1,c.action.entity,c.activator),!0),settle:async()=>!0}]};i.push(s);const o={name:"ライトロード・ビースト ウォルフ",actions:[he,_e,Te,{title:"①自己再生",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...Me,...Ye],executableDuelistTypes:["Controller"],validate:c=>{if(c.action.entity.wasMovedAtPreviousChain&&c.action.entity.wasMovedFrom.cellType==="Deck")return c.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:c=>ei(c),settle:async()=>!0}],canBeSummoned:()=>!0};i.push(o);const d={name:"伝説の白石",actions:[he,_e,Te,We,{title:"①サーチ",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:Vt,executableDuelistTypes:["Controller"],validate:c=>{if(c.action.entity.wasMovedAtPreviousChain&&c.action.entity.wasMovedFrom.cellType!=="Banished")return c.activator.getDeckCell().cardEntities.find(v=>v.nm==="青眼の白龍")?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async c=>{const v=c.activator.getDeckCell().cardEntities.find(p=>p.nm==="青眼の白龍");return v?(await v.addToHand(["Effect"],c.action.entity,c.activator),c.activator.getDeckCell().shuffle(),!0):!1},settle:async()=>!0}]};return i.push(d),[{name:"灰流うらら",chainBlockTags:["Draw","SearchFromDeck","SendToGraveyardFromDeck","SpecialSummonFromDeck"]},{name:"屋敷わらし",chainBlockTags:["BanishFromGraveyard","SpecialSummonFromGraveyard","AddToHandFromGraveyard"]}].forEach(c=>{i.push({name:c.name,actions:[he,_e,Te,We,{title:"①無効化",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:["Hand"],executablePeriods:Me,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,negatePreviousBlock:!0,canPayCosts:v=>v.activator.canDiscard([v.action.entity]),validate:(v,p)=>p.length===0?void 0:p[v.index-1].chainBlockTags.union(c.chainBlockTags).length>0?[]:void 0,payCosts:async v=>(await v.action.entity.discard(["Cost"],v.action.entity,v.activator),{sendToGraveyard:[v.action.entity]}),prepare:async()=>({selectedEntities:[],chainBlockTags:["NegateCardEffect"],prepared:void 0}),execute:async(v,p)=>{const h=p[v.index-1];return h.isNegatedEffectBy=v.action,!0},settle:async()=>!0}]})}),["翻弄するエルフの剣士","ロードランナー","氷結界の修験者"].forEach(c=>{i.push({name:c,actions:[he,_e,Te,We],continuousEffects:[So("①戦闘破壊耐性","Monster",v=>[v],()=>!0,v=>[new ya("①戦闘破壊耐性",()=>!0,!0,v,{},()=>!0,["BattleDestroy"],(p,h)=>(console.log(p,h),!v.isEffective||(h.atk??0)<1900?!0:(v.duel.log.info(`${v.toString()}は攻撃力1900以上のモンスターとの先頭では破壊されない。`,v.controller),!1)))])]})}),i},nc=i=>{if(i.action.entity.status.spellCategory==="Field")return[i.activator.getFieldZone()];const e=i.activator.getAvailableSpellTrapZones();return e.length>0?e:void 0},ke={title:"セット",playType:"SpellTrapSet",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isMandatory:!1,validate:nc,prepare:vt,execute:async()=>!0,settle:async()=>!0},Ee=i=>{if(i.action.entity.info.isPending||i.action.entity.info.isDying||i.action.entity.info.isSettingSickness)return;if(Yt.some(t=>t===i.action.entity.fieldCell.cellType))return i.action.entity.face==="FaceDown"?[]:void 0;if(!i.activator.isTurnPlayer)return;if(i.action.entity.status.spellCategory==="Field")return[i.activator.getFieldZone()];const e=i.activator.getAvailableSpellTrapZones();return e.length>0?e:void 0},sc=(i,e,t=()=>!0)=>i.action.entity.field.getMonstersOnField().filter(r=>r.face==="FaceUp").filter(r=>r.canBeTargetOfEffect(i)).filter(r=>t(r,i.action.entity)).length?Ee(i):void 0,lc=async(i,e,t,a,r,n=()=>!0)=>{const s=i.action.entity.field.getMonstersOnField().filter(d=>d.face==="FaceUp").filter(d=>d.canBeTargetOfEffect(i)).filter(d=>n(d,i.action.entity)),o=await i.action.entity.duel.view.waitSelectEntities(i.activator,s,1,d=>d.length===1,"装備対象モンスターを選択",t);if(o)return i.action.entity.info.equipedBy=o[0],i.action.entity.info.effectTargets[i.action.seq]=o,{chainBlockTags:a??[],selectedEntities:o,prepared:r}},os=async(i,e,t=()=>!0)=>{const a=i.selectedEntities[0];return i.action.entity.info.equipedBy=a,i.action.entity.info.effectTargets[i.action.seq]=[a],t(a,i.action.entity)?(i.action.entity.info.equipedBy=a,i.action.entity.info.validateEquipOwner=t,a.info.equipEntities.push(i.action.entity),!0):(await i.action.entity.ruleDestory(),i.activator.writeInfoLog(`${a.toString()}が装備条件を満たさなくなったため、${i.action.entity.toString()}は破壊された。`),!1)},vr=(i=()=>!0)=>({title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:(e,t)=>sc(e,t,i),prepare:(e,t,a)=>lc(e,t,a,[],void 0,i),execute:os,settle:async()=>!0}),oc=()=>{const i=[],e={name:"おろかな埋葬",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:l=>{if(l.activator.getDeckCell().cardEntities.filter(c=>c.status.kind==="Monster").length!==0)return Ee(l)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SendToGraveyardFromDeck"],prepared:void 0}),execute:async l=>{const c=l.activator.getDeckCell().cardEntities.filter(p=>p.status.kind==="Monster");if(c.length===0)return!1;const v=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,c,1,p=>p.length===1,"墓地に送るモンスターを選択",!1);if(!v)throw new ui(l);return await pe.sendManyToGraveyardForTheSameReason(v,["Effect"],l.action.entity,l.activator),await l.activator.getDeckCell().shuffle(),!0},settle:async()=>!0},ke]};i.push(e);const t={name:"おろかな副葬",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,priorityForNPC:40,validate:l=>{if(l.activator.getDeckCell().cardEntities.filter(c=>c.status.kind!=="Monster").length!==0)return Ee(l)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SendToGraveyardFromDeck"],prepared:void 0}),execute:async l=>{const c=l.activator.getDeckCell().cardEntities.filter(p=>p.status.kind!=="Monster");if(c.length===0)return!1;const v=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,c,1,p=>p.length===1,"墓地に送る魔法罠を選択",!1);if(!v)throw new ui(l);return await pe.sendManyToGraveyardForTheSameReason(v,["Effect"],l.action.entity,l.activator),await l.activator.getDeckCell().shuffle(),!0},settle:async()=>!0},ke]};i.push(t);const a={name:"死者蘇生",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:l=>{const c=l.activator.getMonsterZones();if(l.activator.getEnableSummonList(l.activator,"SpecialSummon",["Effect"],l.action,l.activator.duel.field.getCells("Graveyard").flatMap(p=>p.cardEntities).filter(p=>p.status.kind==="Monster").filter(p=>p.canBeTargetOfEffect(l)).map(p=>({monster:p,posList:Xe,cells:c})),[],!1).length)return Ee(l)},prepare:l=>Pi(l,l.activator.duel.field.getCells("Graveyard").flatMap(c=>c.cardEntities).filter(c=>c.status.kind==="Monster").filter(c=>c.canBeTargetOfEffect(l))),execute:async l=>Bi(l),settle:async()=>!0},ke]};i.push(a),[{name:"大嵐",cellTypes:Yt,isOnlyEnemies:!1},{name:"ハーピィの羽根帚",cellTypes:Yt,isOnlyEnemies:!0},{name:"ブラック・ホール",cellTypes:st,isOnlyEnemies:!1},{name:"サンダー・ボルト",cellTypes:st,isOnlyEnemies:!0}].forEach(l=>{i.push({name:l.name,actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:c=>{let v=c.action.entity.field.getCells(...l.cellTypes).flatMap(p=>p.cardEntities).filter(p=>p!==c.action.entity);if(l.isOnlyEnemies&&(v=v.filter(p=>p.controller!==c.activator)),!!v.length)return Ee(c)},prepare:async c=>{let v=c.action.entity.field.getCells(...l.cellTypes).flatMap(p=>p.cardEntities).filter(p=>p!==c.action.entity);return l.isOnlyEnemies&&(v=v.filter(p=>p.controller!==c.activator)),{selectedEntities:[],chainBlockTags:c.action.calcChainBlockTagsForDestroy(v),prepared:void 0}},execute:async c=>{let v=c.action.entity.field.getCells(...l.cellTypes).flatMap(p=>p.cardEntities).filter(p=>p!==c.action.entity);return l.isOnlyEnemies&&(v=v.filter(p=>p.controller!==c.activator)),await pe.tryDestroy(v,c),!0},settle:async()=>!0},ke]})});const r={name:"ハリケーン",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:l=>{if(l.action.entity.field.getCells("SpellAndTrapZone","FieldSpellZone").flatMap(v=>v.cardEntities).filter(v=>v!==l.action.entity).length)return Ee(l)},prepare:async()=>({selectedEntities:[],chainBlockTags:["BounceToHand"],prepared:void 0}),execute:async(l,c)=>{const v=c.map(h=>h.action).filter(h=>h.playType==="CardActivation").map(h=>h.entity).filter(h=>h.isOnField).filter(h=>h.face==="FaceUp").filter(h=>!h.isLikeContinuousSpell),p=l.action.entity.field.getCells("SpellAndTrapZone","FieldSpellZone").flatMap(h=>h.cardEntities).filter(h=>!v.includes(h));return await pe.returnManyToHandForTheSameReason(p,["Effect"],l.action.entity,l.activator),!0},settle:async()=>!0},ke]};i.push(r);const n={name:"光の援軍",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,canPayCosts:l=>l.activator.getDeckCell().cardEntities.length>3,validate:l=>{if(l.activator.getDeckCell().cardEntities.filter(c=>c.status.kind==="Monster").filter(c=>(c.lvl??13)<5).filter(c=>c.status.nameTags&&c.status.nameTags.includes("ライトロード")).length!==0)return Ee(l)},payCosts:async l=>{const c=l.activator.getDeckCell().cardEntities.slice(0,3);return await pe.sendManyToGraveyardForTheSameReason(c,["Cost"],l.action.entity,l.activator),{sendToGraveyard:c}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async l=>{const c=l.activator.getDeckCell().cardEntities.filter(p=>p.status.kind==="Monster").filter(p=>(p.lvl??13)<5).filter(p=>p.status.nameTags&&p.status.nameTags.includes("ライトロード"));if(c.length===0)return!1;const v=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,c,1,p=>p.length===1,"手札に加えるモンスターを選択",!1);for(const p of v??[])await p.addToHand(["Effect"],l.action.entity,l.activator);return l.activator.getDeckCell().shuffle(),!0},settle:async()=>!0},ke]};i.push(n);const s={name:"調律",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:l=>{const c=l.activator.getDeckCell().cardEntities;if(!(c.length<2)&&c.filter(v=>{var p;return(p=v.status.nameTags)==null?void 0:p.includes("シンクロン")}).filter(v=>{var p;return(p=v.status.monsterCategories)==null?void 0:p.includes("Tuner")}).length!==0)return Ee(l)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck","SendToGraveyardFromDeck"],prepared:void 0}),execute:async l=>{const c=l.activator.getDeckCell().cardEntities;if(c.length<2)return;const v=c.filter(h=>{var m;return(m=h.status.nameTags)==null?void 0:m.includes("シンクロン")}).filter(h=>{var m;return(m=h.status.monsterCategories)==null?void 0:m.includes("Tuner")});if(v.length===0)return!1;const p=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,v,1,h=>h.length===1,"手札に加えるモンスターを選択",!1);for(const h of p??[])await h.addToHand(["Effect"],l.action.entity,l.activator);return l.activator.duel.clock.incrementProcSeq(),l.activator.getDeckCell().shuffle(),await l.activator.getDeckCell().cardEntities[0].sendToGraveyard(["Effect"],l.action.entity,l.activator),!0},settle:async()=>!0},ke]};i.push(s);const o={name:"ワン・フォー・ワン",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,canPayCosts:l=>{if(l.activator.getDeckCell().cardEntities.every(c=>(c.lvl??12)>1)){if(l.activator.getHandCell().cardEntities.every(c=>(c.lvl??12)>1)||l.activator.getHandCell().cardEntities.filter(c=>c.status.kind==="Monster").length<2)return!1}else if(l.activator.getHandCell().cardEntities.filter(c=>c.status.kind==="Monster").length===0)return!1;return!0},validate:l=>{let c=[...l.activator.getDeckCell().cardEntities.filter(m=>(m.lvl??12)===1),...l.activator.getHandCell().cardEntities.filter(m=>(m.lvl??12)===1)];const v=l.activator.getHandCell().cardEntities;(v.length<2||!l.ignoreCost)&&(c=c.filter(m=>!v.includes(m)));const p=l.activator.getMonsterZones();if(l.activator.getEnableSummonList(l.activator,"SpecialSummon",["Effect"],l.action,c.map(m=>({monster:m,posList:Xe,cells:p})),[],!1).length)return Ee(l)},payCosts:async(l,c,v)=>{const p=[...l.activator.getDeckCell().cardEntities.filter(S=>(S.lvl??12)===1),...l.activator.getHandCell().cardEntities.filter(S=>(S.lvl??12)===1)],h=l.activator.getMonsterZones(),m=l.activator.getEnableSummonList(l.activator,"SpecialSummon",["Effect"],l.action,p.map(S=>({monster:S,posList:Xe,cells:h})),[],!1);let C=l.activator.getHandCell().cardEntities.filter(S=>S.status.kind==="Monster");m.length===1&&(C=C.filter(S=>!m.map(k=>k.monster).includes(S)));const y=await l.activator.duel.view.waitSelectEntities(l.activator,C,1,S=>S.length===1,"墓地へ送るモンスターを選択",v)??[];if(y.length)return await pe.sendManyToGraveyardForTheSameReason(y,["Cost"],l.action.entity,l.activator),{sendToGraveyard:y}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async l=>{const c=[...l.activator.getDeckCell().cardEntities.filter(h=>h.lvl===1),...l.activator.getHandCell().cardEntities.filter(h=>h.lvl===1)],v=l.activator.getMonsterZones();return!!await l.activator.summonMany(l.activator,"SpecialSummon",["Effect"],l.action,c.map(h=>({monster:h,posList:Xe,cells:v})),[],!1,h=>h.length===1,!1)},settle:async()=>!0},ke]};i.push(o);const d={name:"封印の黄金櫃",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:l=>{if(!l.activator.getDeckCell().cardEntities.every(c=>!l.activator.canTryBanish(c,"BanishAsEffect",l.action)))return Ee(l)},prepare:async()=>({selectedEntities:[],chainBlockTags:["BanishFromDeck"],prepared:void 0}),execute:async l=>{const c=l.activator.getDeckCell().cardEntities.filter(h=>l.activator.canTryBanish(h,"BanishAsEffect",l.action)),v=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,c,1,h=>h.length===1,"除外するカードを選択。",!1);if(!v)throw new Error("illegal state");return(await pe.tryBanish("BanishAsEffect",v,l)).forEach(h=>h.counterHolder.removeAll("GoldSarcophagus")),!0},settle:async()=>!0},No("回収カウント進行",["stanby"],l=>{l.activator.isTurnPlayer&&l.action.entity.field.getCells("Banished").flatMap(c=>c.cardEntities).filter(c=>c.moveLog.latestRecord.movedBy===l.action.entity).filter(c=>c.moveLog.latestRecord.actionOwner===l.activator).forEach(c=>{c.counterHolder.add("GoldSarcophagus",1,l.action.entity);const v=c.counterHolder.getQty("GoldSarcophagus",l.action.entity);v<3&&l.activator.duel.log.info(`${c.toString()}のターンカウント：${v-1}⇒${v}`)})}),{title:"回収",isMandatory:!0,playType:"LingeringEffect",spellSpeed:"Normal",executableCells:bi,executablePeriods:["stanby"],executableDuelistTypes:["Controller","Opponent"],validate:l=>{if(l.activator.isTurnPlayer)return l.action.entity.field.getCells("Banished").flatMap(c=>c.cardEntities).filter(c=>c.moveLog.latestRecord.movedBy===l.action.entity).filter(c=>c.moveLog.latestRecord.actionOwner===l.activator).some(c=>c.counterHolder.getQty("GoldSarcophagus")===2)?[]:void 0},prepare:vt,execute:async l=>{const c=l.action.entity.field.getCells("Banished").flatMap(p=>p.cardEntities).filter(p=>p.moveLog.latestRecord.movedBy===l.action.entity).filter(p=>p.moveLog.latestRecord.actionOwner===l.activator).filter(p=>p.counterHolder.getQty("GoldSarcophagus")===2);if(!c.length)throw new ve("想定されない状態",l);let v=c[0];if(c.length>1){const p=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,c,1,h=>h.length===1,"回収するカードを選択。",!1);if(!p||!p.length)throw new ve("想定されない状態",l,p);v=p[0]}return await v.addToHand(["Effect"],l.action.entity,l.activator),!0},settle:async()=>!0},ke]};return i.push(d),i},cc=(i,e,t,a,r)=>({title:"①リクルート",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:r,executablePeriods:a.includes("EffectDestroy")?[...Me,...Ye]:["b1DEnd","b2DEnd"],executableDuelistTypes:["Controller"],validate:n=>{if(!n.action.entity.wasMovedAtPreviousChain){console.log(n.action.entity.toString(),n);return}const s=n.activator.getMonsterZones();if(n.activator.getEnableSummonList(n.activator,"SpecialSummon",["Effect"],n.action,n.activator.getDeckCell().cardEntities.filter(i).filter(d=>d.status.kind==="Monster").filter(d=>d.canBeTargetOfEffect(n)).map(d=>({monster:d,posList:t,cells:s})),[],!1).length)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async n=>{const s=n.activator.getDeckCell().cardEntities.filter(i),o=n.activator.getMonsterZones();return!!n.activator.summonMany(n.activator,"SpecialSummon",["Effect"],n.action,s.map(l=>({monster:l,posList:t,cells:o})),[],!1,l=>e.includes(l.length),!1)},settle:async()=>!0}),uc=()=>{const i=[];return[{name:"キラー・ポテト",filter:e=>e.attr.includes("Dark")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["EffectDestroy"],executableCells:["Graveyard"]},{name:"キラー・トマト",filter:e=>e.attr.includes("Dark")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"巨大ネズミ",filter:e=>e.attr.includes("Earth")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"グリズリーマザー",filter:e=>e.attr.includes("Water")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"シャインエンジェル",filter:e=>e.attr.includes("Light")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ドラゴンフライ",filter:e=>e.attr.includes("Wind")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ＵＦＯタートル",filter:e=>e.attr.includes("Fire")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"荒野の女戦士",filter:e=>e.attr.includes("Earth")&&e.types.includes("Warrior")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"リトル・トルーパー",filter:e=>e.types.includes("Warrior")&&(e.lvl??9999)<3,qtyList:[1],posList:["Set"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard","Banished"]},{name:"破面竜",filter:e=>e.types.includes("Warrior")&&(e.def??9999)<=1500,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"共鳴虫",filter:e=>e.types.includes("Insect")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ピラミッド・タートル",filter:e=>e.types.includes("Zombie")&&(e.def??9999)<=2e3,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ユーフォロイド",filter:e=>e.types.includes("Machine")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ヘル・セキュリティ",filter:e=>e.types.includes("Fiend")&&(e.lvl??9999)===1,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ガスタ・イグル",filter:e=>(e.status.nameTags??[]).includes("ガスタ")&&(e.status.monsterCategories??[]).includes("Tuner"),qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"幻影の魔術士",filter:e=>(e.status.nameTags??[]).includes("ＨＥＲＯ")&&(e.atk??9999)<=1e3,qtyList:[1],posList:["Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ジェネクス・サーチャー",filter:e=>(e.status.nameTags??[]).includes("ジェネクス")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"紫炎の足軽",filter:e=>(e.status.nameTags??[]).includes("六武衆")&&(e.lvl??12)<=3,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"スレイブ・エイプ",filter:e=>(e.status.nameTags??[]).includes("剣闘獣")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ゼンマイハニー",filter:e=>(e.status.nameTags??[]).includes("ゼンマイ")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ＸＸ－セイバー エマーズブレイド",filter:e=>(e.status.nameTags??[]).includes("Ｘ－セイバー")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"軍隊竜",filter:e=>e.nm==="軍隊竜",qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"アサルト・ガンドッグ",filter:e=>e.nm==="アサルト・ガンドッグ",qtyList:[1,2,3,4,5],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ハイエナ",filter:e=>e.nm==="ハイエナ",qtyList:[1,2,3,4,5],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]}].forEach(e=>{i.push({name:e.name,actions:[cc(e.filter,e.qtyList,e.posList,e.destoryTypes,e.executableCells),he,_e,Te,We]})}),i},dc=i=>({title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:e=>{if(e.activator.getDeckCell().cardEntities.filter(i).length!==0&&e.activator.canDraw)return Ee(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(i);if(t.length===0)return!1;const a=await e.action.entity.field.duel.view.waitSelectEntities(e.activator,t,1,r=>r.length===1,"手札に加えるカードを選択",!1);for(const r of a??[])await r.addToHand(["Effect"],e.action.entity,e.activator);return e.activator.getDeckCell().shuffle(),!0},settle:async()=>!0}),vc=(i,e)=>({title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,priorityForNPC:40,validate:t=>{if(!(t.activator.getGraveyard().cardEntities.filter(i).length<e))return Ee(t)},prepare:async()=>({selectedEntities:[],chainBlockTags:["AddToHandFromGraveyard"],prepared:void 0}),execute:async t=>{const a=t.activator.getGraveyard().cardEntities.filter(i);if(a.length===0)return!1;const r=await t.action.entity.field.duel.view.waitSelectEntities(t.activator,a,e,n=>n.length===e,"手札に加えるカードを選択",!1);for(const n of r??[])await n.addToHand(["Effect"],t.action.entity,t.activator);return!0},settle:async()=>!0}),fc=i=>({title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,canPayCosts:e=>e.activator.getHandCell().cardEntities.filter(i).some(t=>e.activator.canDiscard([t])),validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<2))return Ee(e)},payCosts:async e=>({discard:await e.activator.discard(1,["Discard","Cost"],e.action.entity,e.activator,i)}),prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(2,e.action.entity,e.activator),!0),settle:async()=>!0}),pc=i=>({title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Ee,prepare:async e=>{const[t,a]=i(e.action.entity),r=[];return t<0&&r.push("DamageToSelf"),a<0&&r.push("DamageToOpponent"),{selectedEntities:[],chainBlockTags:r,prepared:void 0}},execute:async e=>{const[t,a]=i(e.action.entity);return a>0?e.activator.getOpponentPlayer().heal(a,e.action.entity):a<0&&e.activator.getOpponentPlayer().effectDamage(Math.abs(a),e.action.entity),t>0?e.activator.heal(t,e.action.entity):t<0&&e.activator.effectDamage(Math.abs(t),e.action.entity),!0},settle:async()=>!0}),hc=()=>{const i=[];return[{name:"増援",filter:e=>e.origin.kind==="Monster"&&e.types.includes("Warrior")&&(e.origin.level??5)<5},{name:"化石調査",filter:e=>e.origin.kind==="Monster"&&e.types.includes("Dinosaur")&&(e.origin.level??6)<6},{name:"Ｅ－エマージェンシーコール",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("Ｅ・ＨＥＲＯ")},{name:"召集の聖刻印",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("聖刻")},{name:"召喚師のスキル",filter:e=>e.origin.kind==="Monster"&&(e.origin.monsterCategories??[]).includes("Normal")&&(e.origin.level??4)>4},{name:"トゥーンのもくじ",filter:e=>(e.origin.nameTags??[]).includes("トゥーン")},{name:"融合賢者",filter:e=>e.origin.name==="融合"},{name:"虹の架け橋",filter:e=>e.origin.kind!=="Monster"&&(e.origin.nameTags??[]).includes("宝玉")},{name:"紫炎の狼煙",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("六武衆")&&(e.origin.level??4)<4},{name:"テラ・フォーミング",filter:e=>e.origin.kind==="Spell"&&e.origin.spellCategory==="Field"},{name:"コール・リゾネーター",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("リゾネーター")}].forEach(e=>{i.push({name:e.name,actions:[dc(e.filter),ke]})}),[{name:"戦士の生還",filter:e=>e.status.kind==="Monster"&&e.types.includes("Warrior"),qty:1},{name:"ダーク・バースト",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Dark")&&(e.atk??9999)<=1500,qty:1},{name:"悪夢再び",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Dark")&&(e.def??9999)===0,qty:2},{name:"サルベージ",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Water")&&(e.atk??9999)<=1500,qty:2},{name:"バッテリーリサイクル",filter:e=>e.status.kind==="Monster"&&e.types.includes("Thunder")&&(e.atk??9999)<=1500,qty:2},{name:"闇の量産工場",filter:e=>e.status.kind==="Monster"&&(e.status.monsterCategories??[]).includes("Normal"),qty:2}].forEach(e=>{i.push({name:e.name,actions:[vc(e.filter,e.qty),ke]})}),[{name:"トレード・イン",filter:e=>e.status.kind==="Monster"&&(e.lvl??0)===8},{name:"調和の宝札",filter:e=>e.status.kind==="Monster"&&(e.origin.monsterCategories??[]).includes("Tuner")&&e.types.includes("Dragon")&&(e.atk??9999)<=1e3},{name:"デステニー・ドロー",filter:e=>e.status.kind==="Monster"&&(e.origin.nameTags??[]).includes("Ｄ－ＨＥＲＯ")}].forEach(e=>{i.push({name:e.name,actions:[fc(e.filter),ke]})}),[{name:"火の粉",calcHeal:()=>[0,-200]},{name:"雷鳴",calcHeal:()=>[0,-300]},{name:"ファイヤー・ボール",calcHeal:()=>[0,-500]},{name:"火あぶりの刑",calcHeal:()=>[0,-600]},{name:"昼夜の大火事",calcHeal:()=>[0,-800]},{name:"火炎地獄",calcHeal:()=>[-500,-1e3]},{name:"盗人ゴブリン",calcHeal:()=>[500,-500]},{name:"ブルー・ポーション",calcHeal:()=>[400,0]},{name:"レッド・ポーション",calcHeal:()=>[500,0]},{name:"ゴブリンの秘薬",calcHeal:()=>[600,0]},{name:"天使の生き血",calcHeal:()=>[800,0]},{name:"治療の神 ディアン・ケト",calcHeal:()=>[1e3,0]},{name:"恵みの雨",calcHeal:()=>[1e3,1e3]}].forEach(e=>{i.push({name:e.name,actions:[pc(e.calcHeal),ke]})}),i},gc=(i,e,t,a,r,n)=>{if(!i.action.entity.origin.level||a.some(l=>!l.lvl)||a.map(l=>l.lvl??0).reduce((l,c)=>l+c,0)!==i.action.entity.origin.level)return;const s=a.filter(l=>{var c;return(c=l.status.monsterCategories)==null?void 0:c.some(v=>v==="Tuner")}),o=a.filter(l=>{var c;return(c=l.status.monsterCategories)==null?void 0:c.every(v=>v!=="Tuner")});if(!r(s)||!n(o))return;const d=[...s.map(l=>({material:l,isAsTuner:!0})),...o.map(l=>({material:l,isAsTuner:!1}))];if(i.activator.getEnableSummonList(i.activator,"SyncroSummon",["Rule","SpecialSummon"],i.action,[{monster:i.action.entity,posList:e,cells:t}],d,!1).length)return d},yc=(i,e=a=>a.length===1,t=a=>a.length>0)=>{let a=[...i.activator.getMonstersOnField().filter(s=>s.battlePosition!=="Set"),...i.activator.getHandCell().cardEntities.filter(s=>s.origin.kind==="Monster")];if(a.every(s=>!s.status.allowHandSyncro)&&(a=a.filter(s=>s.fieldCell.isPlayFieldCell)),a.length<2)return[];const r=[...i.activator.getMonsterZones(),...i.activator.duel.field.getCells("ExtraMonsterZone")],n=["Attack","Defense"];return a.getAllOnOffPattern().map(s=>gc(i,n,r,s,e,t)??[]).filter(s=>s.length)},mc=async(i,e,t)=>{var d;const a=i.action.getEnableMaterialPatterns(i),r=a.map(l=>({infos:l,materialSeqList:l.map(c=>c.material.seq).sort()}));let n=a[0].map(l=>l.material);if(a.length>1){const l=a.flatMap(v=>v.map(p=>p.material)).getDistinct(),c=await i.action.entity.duel.view.waitSelectEntities(i.activator,l,void 0,v=>{const p=v.map(h=>h.seq).sort();return r.some(h=>p.length===h.materialSeqList.length&&p.every((m,C)=>m===h.materialSeqList[C]))},"シンクロ素材とするモンスターを選択",t);if(!c)return;n=c}const s=n.map(l=>l.seq).sort(),o=(d=r.find(l=>s.length===l.materialSeqList.length&&s.every((c,v)=>c===l.materialSeqList[v])))==null?void 0:d.infos;if(!o)throw new ve("想定されない状態",i,n);return await pe.sendManyToGraveyardForTheSameReason(n,["SyncroMaterial","Cost","Rule","SpecialSummonMaterial"],i.action.entity,i.activator),{summonMaterialInfos:o}},yt=(i=t=>t.length===1,e=t=>t.length>0)=>({title:"シンクロ召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],getEnableMaterialPatterns:t=>yc(t,i,e),canPayCosts:t=>t.action.getEnableMaterialPatterns(t).length>0,validate:t=>!t.ignoreCost||t.activator.getAvailableExtraZones().length+t.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:mc,prepare:t=>oi(t,"SyncroSummon",["Rule","SpecialSummon","SyncroSummon"],["Attack","Defense"]),execute:ci,settle:async()=>!0}),_c=()=>{const i=[];return["大地の騎士ガイアナイト","スクラップ・デスデーモン"].forEach(e=>i.push({name:e,actions:[he,_e,Te,yt()],defaultSummonFilter:ct})),i.push({name:"ナチュル・ガオドレイク",actions:[he,_e,Te,yt(e=>e.length===1&&e.every(t=>t.attr.some(a=>a==="Earth")),e=>e.length>0&&e.every(t=>t.attr.some(a=>a==="Earth")))],defaultSummonFilter:ct}),i.push({name:"マジカル・アンドロイド",actions:[he,_e,Te,yt(),{title:"回復",isMandatory:!0,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["end"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,validate:e=>e.action.entity.duel.phase==="end"&&e.activator.isTurnPlayer&&e.action.entity.face==="FaceUp"?[]:void 0,prepare:vt,execute:async e=>(e.activator.heal(e.activator.getMonstersOnField().filter(t=>t.face==="FaceUp").filter(t=>t.types.includes("Psychic")).length*600,e.action.entity),!0),settle:async()=>!0}],defaultSummonFilter:ct}),i},Sc=()=>{const i=[];return[{name:"草原",up:["Warrior","BeastWarrior"],down:[]},{name:"森",up:["Insect","Plant","Beast","BeastWarrior"],down:[]},{name:"山",up:["Dragon","WingedBeast","Thunder"],down:[]},{name:"荒野",up:["Dinosaur","Zombie","Rock"],down:[]},{name:"海",up:["Aqua","SeaSerpent","Fish"],down:["Machine","Pyro"]},{name:"闇",up:["Fiend","Spellcaster"],down:["Fairy"]}].forEach(e=>{i.push({name:e.name,actions:[{title:"発動",isMandatory:!1,canIgnoreCosts:!0,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Ee,prepare:vt,execute:async()=>!0,settle:async()=>!0},ke],continuousEffects:[ma("発動","Spell",t=>t.isOnField&&t.face==="FaceUp",t=>["attack","defense"].flatMap(a=>["up","down"].map(r=>lt.createContinuous("発動",n=>n.isSpawnedBy.isOnField&&n.isSpawnedBy.face==="FaceUp",t,(n,s)=>s.isOnField&&s.face==="FaceUp"&&(s.status.monsterCategories??!1)&&e[r].union(s.types).length>0,a,"wip","Addition",(n,s,o)=>!n.isEffective||s.face==="FaceDown"?o:o+(r==="up"?200:-200)))))]})}),[{name:"バーニングブラッド",attr:"Fire"},{name:"ウォーターワールド",attr:"Water"},{name:"ガイアパワー",attr:"Earth"},{name:"シャインスパーク",attr:"Light"},{name:"ダークゾーン",attr:"Dark"},{name:"デザートストーム",attr:"Wind"}].forEach(e=>{i.push({name:e.name,actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","FieldSpellZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Ee,prepare:vt,execute:async()=>!0,settle:async()=>!0},ke],continuousEffects:[ma("発動","Spell",t=>t.isOnField&&t.face==="FaceUp",t=>["attack","defense"].flatMap(a=>lt.createContinuous("発動",r=>r.isSpawnedBy.isOnField&&r.isSpawnedBy.face==="FaceUp",t,(r,n)=>n.isOnField&&n.face==="FaceUp"&&n.attr.includes(e.attr),a,"wip","Addition",(r,n,s)=>!r.isEffective||n.face==="FaceDown"?s:s+(a==="attack"?500:-400))))]})}),i},Cc=()=>{const i=[],e={name:"連合軍",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Ee,prepare:vt,execute:async()=>!0,settle:async()=>!0},ke],continuousEffects:[ma("発動","Spell",t=>t.isOnField&&t.face==="FaceUp",t=>[lt.createContinuous("発動",a=>a.isSpawnedBy.isOnField&&a.isSpawnedBy.face==="FaceUp",t,(a,r)=>r.controller===a.isSpawnedBy.controller&&r.types.includes("Warrior")&&r.isOnField&&r.face==="FaceUp","attack","wip","Addition",(a,r,n)=>{if(!a.isEffective||r.face==="FaceDown")return n;const s=a.controller.getMonstersOnField().filter(o=>o.face==="FaceUp").filter(o=>o.types.includes("Warrior")||o.types.includes("Spellcaster")).length;return n+s*200})])]};return i.push(e),i},bc=()=>{const i=[];[{name:"団結の力",kind:["Monster"],rate:800},{name:"魔導師の力",kind:["Spell","Trap"],rate:500}].forEach(t=>{i.push({name:t.name,actions:[vr(),ke],continuousEffects:[Xi(t.name,"Spell",a=>a.info.equipedBy?[a.info.equipedBy]:[],a=>a.isOnField&&a.face==="FaceUp",a=>["attack","defense"].map(r=>lt.createContinuous("発動",n=>n.isSpawnedBy.isOnField&&n.isSpawnedBy.face==="FaceUp",a,(n,s)=>s.isOnField&&s.face==="FaceUp",r,"wip","Addition",(n,s,o)=>{if(!n.isEffective)return o;const d=n.controller.getEntiteisOnField().filter(l=>t.kind.includes(l.status.kind)).length;return o+d*t.rate})))]})});const e={name:"早すぎた埋葬",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,canPayCosts:t=>t.activator.lp>=800,validate:t=>{const a=t.activator.getMonsterZones();if(t.activator.getEnableSummonList(t.activator,"SpecialSummon",["Effect"],t.action,t.activator.getGraveyard().cardEntities.filter(n=>n.status.kind==="Monster").filter(n=>n.canBeTargetOfEffect(t)).map(n=>({monster:n,posList:["Attack"],cells:a})),[],!1).length)return Ee(t)},payCosts:(t,a)=>Oo(t,a,800),prepare:async t=>{const a=await Pi(t,t.activator.getGraveyard().cardEntities.filter(r=>r.status.kind==="Monster").filter(r=>r.canBeTargetOfEffect(t)),["Attack"]);return a.chainBlockTags.push("PayLifePoint"),a},execute:async(t,a)=>t.action.entity.info.equipedBy?(await t.action.entity.ruleDestory(),!1):await Bi(t,["Attack"])?(t.action.entity.onBeforeMove.append(async n=>{if(n.entity.face!=="FaceUp"||!n.entity.isOnFieldAsSpellTrap)return"RemoveMe";const s=n.entity.info.equipedBy;if(!s)return"RemoveMe";console.log(n.entity.toString(),n.entity);const[,,,,,o]=n.args;return s.isOnField&&s.face==="FaceUp"&&n.entity.isEffective&&o.union(["EffectDestroy","RuleDestroy"]).length&&(console.log(t.action.entity.toString()),n.entity.controller.writeInfoLog(`${t.action.entity.toString()}が破壊されたため、装備対象モンスター${s.toString()}を破壊。`),pe.tryMarkForDestory([s],t)),"RemoveMe"}),os(t,a,(n,s)=>{var o;return(o=s.info.effectTargets[t.action.seq])==null?void 0:o.includes(n)})):(await t.action.entity.ruleDestory(),!1),settle:async()=>!0},ke]};return i.push(e),i.push({name:"幻惑の巻物",actions:[vr(),ke],continuousEffects:[]}),i},wc=()=>{const i=[];return[{name:"伝説の剣",attr:void 0,monType:"Warrior",atk:200,def:200},{name:"秘術の書",attr:void 0,monType:"Spellcaster",atk:200,def:200},{name:"ポセイドンの力",attr:void 0,monType:"Aqua",atk:200,def:200},{name:"紫水晶",attr:void 0,monType:"Zombie",atk:200,def:200},{name:"猛獣の歯",attr:void 0,monType:"Beast",atk:200,def:200},{name:"機械改造工場",attr:void 0,monType:"Machine",atk:200,def:200},{name:"体温の上昇",attr:void 0,monType:"Reptile",atk:200,def:200},{name:"魔菌",attr:void 0,monType:"Plant",atk:200,def:200},{name:"闇・エネルギー",attr:void 0,monType:"Fiend",atk:200,def:200},{name:"レーザー砲機甲鎧",attr:void 0,monType:"Insect",atk:200,def:200},{name:"銀の弓矢",attr:void 0,monType:"Fairy",atk:200,def:200},{name:"電撃鞭",attr:void 0,monType:"Thunder",atk:200,def:200},{name:"ドラゴンの秘宝",attr:void 0,monType:"Dragon",atk:200,def:200},{name:"フォロー・ウィンド",attr:void 0,monType:"WingedBeast",atk:200,def:200},{name:"魔性の月",attr:void 0,monType:"BeastWarrior",atk:200,def:200},{name:"エルフの光",attr:"Light",monType:void 0,atk:400,def:-200},{name:"覚醒",attr:"Earth",monType:void 0,atk:400,def:-200},{name:"灼熱の槍",attr:"Fire",monType:void 0,atk:400,def:-200},{name:"突風の扇",attr:"Wind",monType:void 0,atk:400,def:-200},{name:"はがねの甲羅",attr:"Water",monType:void 0,atk:400,def:-200},{name:"闇の破神剣",attr:"Dark",monType:void 0,atk:400,def:-200},{name:"火器付機甲鎧",attr:void 0,monType:"Insect",atk:700,def:0},{name:"サラマンドラ",attr:"Fire",monType:void 0,atk:700,def:0},{name:"シャイン・キャッスル",attr:"Light",monType:void 0,atk:700,def:0}].forEach(e=>{i.push({name:e.name,actions:[vr(t=>(!e.attr||t.attr.includes(e.attr))&&(!e.monType||t.types.includes(e.monType))),ke],continuousEffects:[Xi(e.name,"Spell",t=>t.info.equipedBy?[t.info.equipedBy]:[],t=>t.isOnField&&t.face==="FaceUp",t=>{const a=[];return e.atk!==0&&a.push(["attack",e.atk]),e.def!==0&&a.push(["defense",e.def]),a.map(([r,n])=>lt.createContinuous("発動",s=>s.isSpawnedBy.isOnField&&s.isSpawnedBy.face==="FaceUp",t,(s,o)=>o.isOnField&&o.face==="FaceUp"&&(!e.monType||o.types.includes(e.monType))&&(!e.attr||o.attr.includes(e.attr)),r,"wip","Addition",(s,o,d)=>s.isEffective?d+n:d))})]})}),i},Tc=()=>{const i=[],e={name:"にせアバター",actions:[We,he,_e,Te],continuousEffects:[Xi("THE_DEVILS_AVATAR","Monster",a=>[a],a=>a.isOnField&&a.face==="FaceUp",a=>["attack","defense"].map(r=>lt.createContinuous("THE_DEVILS_AVATAR",n=>n.isSpawnedBy.isOnField&&n.isSpawnedBy.face==="FaceUp",a,(n,s)=>s.isOnField&&s.face==="FaceUp",r,"calculated","THE_DEVILS_AVATAR",()=>Number.MIN_VALUE)))]};i.push(e);const t={name:"にせドレッド・ルート",actions:[We,he,_e,Te],continuousEffects:[ma("THE_DEVILS_DREAD-ROOT","Monster",a=>a.isOnField&&a.face==="FaceUp",a=>["attack","defense"].map(r=>lt.createContinuous("THE_DEVILS_DREAD-ROOT",n=>n.isSpawnedBy.isOnField&&n.isSpawnedBy.face==="FaceUp",a,(n,s)=>s.status.kind==="Monster"&&s.isOnField&&s.face==="FaceUp"&&s!==n.isSpawnedBy,r,"calculated","THE_DEVILS_DREAD-ROOT",(n,s,o)=>Math.round(o/2))))]};return i.push(t),i},kc=()=>{const i=[],e={name:"ご隠居の猛毒薬",actions:[ke,{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:Me,executableDuelistTypes:["Controller"],validate:Ee,prepare:async(a,r,n)=>{const s=await a.action.entity.field.duel.view.waitSelectText([{seq:0,text:"●自分は１２００ＬＰ回復する。"},{seq:1,text:"●相手に８００ダメージを与える。"}],"使用する効果を選択",!1);if(s===void 0&&!n)throw new ui(a);const o=[];return s===1&&o.push("DamageToOpponent"),{selectedEntities:[],chainBlockTags:o,prepared:s??0}},execute:async a=>a.prepared===1?(a.activator.getOpponentPlayer().effectDamage(800,a.action.entity),!0):(a.activator.heal(1200,a.action.entity),!0),settle:async()=>!0}]};i.push(e);const t={name:"月の書",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:Me,executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:a=>{if(a.action.entity.field.getMonstersOnField().filter(n=>n.canBeTargetOfEffect(a)).length)return Ee(a)},prepare:async(a,r,n)=>{const s=a.action.entity.field.getMonstersOnField().filter(d=>d.canBeTargetOfEffect(a)),o=await a.action.entity.duel.view.waitSelectEntities(a.activator,s,1,d=>d.length===1,"対象とするモンスターを選択",n);if(o)return{selectedEntities:o,chainBlockTags:[],prepared:void 0}},execute:async a=>{const r=a.selectedEntities[0];if(!r.isOnFieldAsMonster||r.battlePosition==="Set")return!1;if(!r.canBeEffected(a.activator,a.action.entity,a.action)){a.activator.duel.log.info(`${r.toString()}は${a.action.entity.toString()}の効果を受けない。`);return}return console.log(r.toString(),r.info.equipEntities),await r.setBattlePosition("Set",["Effect"],a.action.entity,a.activator),!0},settle:async()=>!0},ke]};return i.push(t),i.push({name:"突進",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:[...Me,...Ye],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:a=>{if(a.action.entity.field.getMonstersOnField().filter(n=>n.canBeTargetOfEffect(a)).length)return Ee(a)},prepare:async(a,r,n)=>{const s=a.action.entity.field.getMonstersOnField().filter(d=>d.canBeTargetOfEffect(a)),o=await a.action.entity.duel.view.waitSelectEntities(a.activator,s,1,d=>d.length===1,"対象とするモンスターを選択",n);if(o)return console.log(o[0].toString(),o[0].info.equipEntities),{selectedEntities:o,chainBlockTags:[],prepared:void 0}},execute:async a=>{const r=a.selectedEntities[0];if(!r.isOnFieldAsMonster||r.battlePosition==="Set")return!1;if(!r.canBeEffected(a.activator,a.action.entity,a.action)){a.activator.duel.log.info(`${r.toString()}は${a.action.entity.toString()}の効果を受けない。`);return}return r.numericOprsBundle.push(lt.createLingeringAddition("攻撃力上昇",n=>n.effectOwner.duel.clock.isSameTurn(n.isSpawnedAt),a.action.entity,a.action,"attack",(n,s,o)=>o+700)),!0},settle:async()=>!0},ke]}),i},Ec=(i,e)=>{const t=`魔力充填可能(${e})`;return Co(t,i,a=>[a],()=>!0,a=>[new Mr(t,()=>!0,!0,a,{},(r,n)=>r.isSpawnedBy===n,(r,n)=>(n.maxCounterQty.SpellCounter=e,{maxCounterQty:n.maxCounterQty}))])},Dc=(i,e,t)=>i.action.entity.counterHolder.getQty("SpellCounter")>=t,xc=(i,e,t,a)=>{const r=a[0];return i.action.entity.counterHolder.remove("SpellCounter",r),{counter:r}},Ac=()=>{const i=[],e={name:"魔導戦士 ブレイカー",actions:[he,_e,Te,We,{title:"①魔力充填",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:t=>{if(t.action.entity.hasBeenSummonedNow(["NormalSummon"]))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["IfNormarlSummonSucceed"],prepared:void 0}),execute:async t=>t.action.entity.face==="FaceDown"?!1:(t.action.entity.counterHolder.setQty("SpellCounter",1,t.action.entity),!0),settle:async()=>!0},{title:"③マナブレイク",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],canPayCosts:(t,a)=>Dc(t,a,1),validate:t=>{const a=t.action.entity.field.getCells(...Yt).flatMap(r=>r.cardEntities).filter(r=>r.canBeTargetOfEffect(t));if(a.length)return a.map(r=>r.fieldCell)},payCosts:async(t,a,r)=>xc(t,a,r,[1]),prepare:async(t,a,r)=>{var s;let n=(s=t.dest)==null?void 0:s.cardEntities[0];if(!n){const o=t.action.entity.field.getCells(...Yt).flatMap(l=>l.cardEntities).filter(l=>l.canBeTargetOfEffect(t)),d=await t.action.entity.duel.view.waitSelectEntities(t.activator,o,1,l=>l.length===1,"破壊する対象を選択。",r);if(!d||!d.length)return;n=d[0]}return{selectedEntities:[n],chainBlockTags:t.action.calcChainBlockTagsForDestroy([n]),prepared:void 0}},execute:async t=>{if(!t.selectedEntities.every(a=>!a.isOnFieldAsSpellTrap))return await pe.tryDestroy(t.selectedEntities,t),!0},settle:async()=>!0}],continuousEffects:[Ec("Monster",1),Xi("②攻撃力上昇","Monster",t=>[t],()=>!0,t=>[lt.createContinuous("②攻撃力上昇",()=>!0,t,()=>!0,"attack","wip","Addition",(a,r,n)=>a.isEffective?n+a.counterHolder.getQty("SpellCounter")*300:n)])]};return i.push(e),i},Mc=()=>{const i=[];return["炸裂装甲","次元幽閉"].forEach(e=>{i.push({name:e,actions:[ke,{title:"発動",playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:["b1Battle","b2Battle"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:t=>{if(!t.activator.duel.clock.isUponAttackDeclaration()||t.activator.isTurnPlayer)return;const a=t.activator.duel.attackingMonster;if(!a)throw new ve("想定されない状態",t,a);if(a.canBeTargetOfEffect(t))return e==="次元幽閉"&&!t.activator.canTryBanish(a,"BanishAsEffect",t.action)?!1:Ee(t)},prepare:async t=>{const a=t.activator.duel.attackingMonster;if(!a)throw new ve("想定されない状態",t,a);const r=e==="炸裂装甲"?t.action.calcChainBlockTagsForDestroy([a]):["BanishFromField"];return{selectedEntities:[a],chainBlockTags:r,prepared:void 0}},execute:async t=>(e==="炸裂装甲"?await pe.tryDestroy(t.selectedEntities,t):await pe.tryBanish("BanishAsEffect",t.selectedEntities,t),!0),settle:async()=>!0}]})}),i},Pc=()=>{const i=[];return i.push({name:"強欲な瓶",actions:[ke,{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:Me,executableDuelistTypes:["Controller"],validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<2)&&e.activator.canDraw&&e.activator.canAddToHandFromDeck)return Ee(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(1,e.action.entity,e.activator),!0),settle:async()=>!0}]}),i.push({name:"戦線復帰",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:Me,executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:e=>{const t=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getGraveyard().cardEntities.filter(r=>r.status.kind==="Monster").filter(r=>r.canBeTargetOfEffect(e)).map(r=>({monster:r,posList:["Defense"],cells:t})),[],!1).length)return Ee(e)},prepare:e=>Pi(e,e.activator.getGraveyard().cardEntities.filter(t=>t.status.kind==="Monster").filter(t=>t.canBeTargetOfEffect(e)),["Defense"]),execute:async e=>Bi(e,["Defense"]),settle:async()=>!0},ke]}),i},Bc=()=>{const i=[],e={name:"強欲な壺",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:20,validate:s=>{if(!(s.activator.getDeckCell().cardEntities.length<2)&&s.activator.canDraw&&s.activator.canAddToHandFromDeck)return Ee(s)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async s=>(await s.activator.draw(2,s.action.entity,s.activator),!0),settle:async()=>!0},ke]};i.push(e);const t={name:"貪欲な壺",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:30,validate:s=>{if(!(s.activator.getGraveyard().cardEntities.filter(o=>o.status.kind==="Monster").filter(o=>o.canBeTargetOfEffect(s)).length<5)&&s.activator.canDraw&&s.activator.canAddToHandFromDeck)return Ee(s)},prepare:async s=>{const o=await s.action.entity.field.duel.view.waitSelectEntities(s.activator,s.activator.getGraveyard().cardEntities.filter(d=>d.status.kind==="Monster").filter(d=>d.canBeTargetOfEffect(s)),5,d=>d.length===5,"デッキに戻すモンスターを選択。",!1);if(o)return{selectedEntities:o,chainBlockTags:["Draw","ReturnToDeckFromGraveyard"],prepared:void 0}},execute:async s=>s.selectedEntities.some(o=>o.wasMovedAtCurrentChain)?!1:(await pe.returnManyToDeckForTheSameReason("Random",s.selectedEntities,["Effect"],s.action.entity,s.activator),await s.activator.draw(2,s.action.entity,s.activator),!0),settle:async()=>!0},ke]};i.push(t);const a={name:"天使の施し",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:30,validate:s=>{if(!(s.activator.getDeckCell().cardEntities.length<3))return Ee(s)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw","DiscordAsEffect"],prepared:void 0}),execute:async s=>(await s.activator.draw(3,s.action.entity,s.activator),await s.activator.discard(2,["Effect","Discard"],s.action.entity,s.activator,()=>!0,s.activator),!0),settle:async()=>!0},ke]};i.push(a);const r={name:"成金ゴブリン",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:20,validate:s=>{if(!(s.activator.getDeckCell().cardEntities.length<1))return Ee(s)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async s=>(await s.activator.draw(1,s.action.entity,s.activator),s.action.entity.field.duel.clock.incrementProcSeq(),s.activator.getOpponentPlayer().heal(1e3,s.action.entity),!0),settle:async()=>!0},ke]};i.push(r);const n={name:"手札抹殺",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:s=>{if(!(s.activator.getDeckCell().cardEntities.length<s.activator.getHandCell().cardEntities.filter(o=>o.seq!==s.action.entity.seq).length)&&s.action.entity.field.getAllCells().filter(o=>o.cellType==="Hand").flatMap(o=>o.cardEntities).filter(o=>o.seq!==s.action.entity.seq).length!==0)return Ee(s)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async s=>{const o=s.activator.getHandCell().cardEntities.length,d=s.activator.getOpponentPlayer().getHandCell().cardEntities.length;return await pe.sendManyToGraveyardForTheSameReason(s.action.entity.field.getCells("Hand").flatMap(l=>l.cardEntities),["Effect","Discard"],s.action.entity,s.activator),s.activator.duel.clock.incrementProcSeq(),await s.action.entity.field.drawAtSameTime(s.activator,o,s.activator.getOpponentPlayer(),d,s.action.entity,s.activator),!0},settle:async()=>!0},ke]};return i.push(n),i},Fc=(i,e,t,a,r=2,n=2,s)=>{if(!i.action.entity.origin.rank||a.length<r||a.length>n||a.some(d=>!d.lvl)||a.some(d=>d.lvl!==i.action.entity.rank)||!s(a))return;const o=a.map(d=>({material:d,level:d.status.level}));if(i.activator.getEnableSummonList(i.activator,"XyzSummon",["Rule","XyzSummon","SpecialSummon"],i.action,[{monster:i.action.entity,posList:e,cells:t}],o,!1).length)return o},Oc=(i,e=2,t=2,a=r=>r.length>1)=>{const r=i.activator.getMonstersOnField().filter(s=>s.battlePosition!=="Set");if(r.length<e)return[];const n=[...i.activator.getMonsterZones(),...i.activator.getAvailableExtraZones()];return r.getAllOnOffPattern().filter(s=>s.length>=e).filter(s=>s.length<=t).map(s=>Fc(i,Xe,n,s,e,t,a)??[]).filter(s=>s.length)},Lc=async(i,e,t)=>{var d;const a=i.action.getEnableMaterialPatterns(i),r=a.map(l=>({infos:l,materialSeqList:l.map(c=>c.material.seq).sort()}));let n=a[0].map(l=>l.material);if(a.length>1){const l=a.flatMap(v=>v.map(p=>p.material)).getDistinct(),c=await i.action.entity.duel.view.waitSelectEntities(i.activator,l,void 0,v=>{const p=v.map(h=>h.seq).sort();return r.some(h=>p.length===h.materialSeqList.length&&p.every((m,C)=>m===h.materialSeqList[C]))},"エクシーズ素材とするモンスターを選択",t);if(!c)return;n=c}console.log(a,n);const s=n.map(l=>l.seq).sort(),o=(d=r.find(l=>s.length===l.materialSeqList.length&&s.every((c,v)=>c===l.materialSeqList[v])))==null?void 0:d.infos;if(!o)throw new ve("想定されない状態",i,n);return await pe.convertManyToXyzMaterials(o.map(l=>l.material),["XyzMaterial","Rule","Cost"],i.action.entity,i.activator),{summonMaterialInfos:o}},qc=(i=2,e=2,t=a=>a.length>1)=>({title:"エクシーズ召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],getEnableMaterialPatterns:a=>Oc(a,i,e,t),canPayCosts:a=>a.action.getEnableMaterialPatterns(a).length>0,validate:a=>!a.ignoreCost||a.activator.getAvailableExtraZones().length+a.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:Lc,prepare:a=>oi(a,"XyzSummon",["Rule","SpecialSummon","XyzSummon"],["Attack","Defense"]),execute:ci,settle:async()=>!0}),Nc=()=>{const i=[];return[{name:"ジェムナイト・パール",qty:2},{name:"覚醒の勇士 ガガギゴ",qty:3}].forEach(e=>i.push({name:e.name,actions:[he,_e,Te,qc(e.qty,e.qty)],defaultSummonFilter:ct})),i},Rc=()=>{const i=[];return i.push({name:"ＢＦ－疾風のゲイル",actions:[We,he,_e,Te,{title:"①特殊召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(e.activator.getMonstersOnField().filter(a=>(a.status.nameTags??[]).includes("ＢＦ")).filter(a=>a.nm!==e.action.entity.origin.name).length)return cr(e,["Attack","Defense"],[])},prepare:e=>oi(e,"SpecialSummon",["SpecialSummon","Rule"],Xe),execute:ci,settle:async()=>!0},{title:"②攻守半減",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,isOnlyNTimesPerTurnIfFaceup:1,validate:e=>{const t=e.activator.getOpponentPlayer().getMonstersOnField().filter(a=>a.face==="FaceUp").filter(a=>a.canBeTargetOfEffect(e));if(t.length)return t.length?t:void 0},prepare:async(e,t,a)=>{var n;let r=(n=e.dest)==null?void 0:n.cardEntities[0];if(!r){const s=e.activator.getOpponentPlayer().getMonstersOnField().filter(d=>d.face==="FaceUp").filter(d=>d.canBeTargetOfEffect(e)),o=await e.action.entity.duel.view.waitSelectEntities(e.activator,s,1,d=>d.length===1,"効果対象を選択。",a);if(!o||!o.length)return;r=o[0]}return{selectedEntities:[r],chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.selectedEntities.filter(a=>a.isOnFieldAsMonster).filter(a=>a.face==="FaceUp").find(a=>a.canBeEffected(e.activator,e.action.entity,e.action));if(t)return["attack","defense"].map(a=>lt.createLingeringFixation("②攻守半減",()=>!0,e.action.entity,e.action,a,(r,n,s)=>Math.round(s/2))).forEach(a=>t.numericOprsBundle.push(a)),!0},settle:async()=>!0}]}),i},Hc=()=>{const i=[];return i.push({name:"ダーク・リゾネーター",actions:[he,_e,Te,We],substituteEffects:[Go(1)]}),i.push({name:"レッド・リゾネーター",actions:[he,_e,Te,We,{title:"①特殊召喚",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...Me,...Ye],executableDuelistTypes:["Controller"],validate:e=>{if(!e.action.entity.hasBeenSummonedNow(["NormalSummon"]))return;const t=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getHandCell().cardEntities.filter(r=>r.status.kind==="Monster").filter(r=>(r.lvl??12)<5).map(r=>({monster:r,posList:Xe,cells:t})),[],!1).length)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromHand"],prepared:void 0}),execute:async e=>{const t=e.activator.getMonsterZones(),a=e.activator.getHandCell().cardEntities.filter(n=>n.status.kind==="Monster").filter(n=>(n.lvl??12)<5).map(n=>({monster:n,posList:Xe,cells:t}));return!!await e.activator.summonMany(e.activator,"SpecialSummon",["Effect"],e.action,a,[],!1,n=>n.length===1,!1)},settle:async()=>!0},{title:"②回復",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...Me,...Ye],executableDuelistTypes:["Controller"],hasToTargetCards:!0,isOnlyNTimesPerTurn:1,validate:e=>{if(e.action.entity.hasBeenSummonedNow(["SpecialSummon"]))return e.activator.getMonstersOnField().filter(t=>t.canBeTargetOfEffect(e)).filter(t=>(t.atk??0)>0).some(t=>t.info.summonKinds.includes("SpecialSummon"))?[]:void 0},prepare:async e=>{const t=await e.activator.waitSelectEntity(e.activator.getMonstersOnField().filter(a=>a.canBeTargetOfEffect(e)).filter(a=>(a.atk??0)>0).filter(a=>a.info.summonKinds.includes("SpecialSummon")),"対象とするモンスターを選択",!1);if(t)return{selectedEntities:[t],chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.activator.lp;return e.selectedEntities.filter(a=>a.isOnFieldAsMonster).forEach(a=>e.activator.heal(a.atk??0,e.action.entity)),e.activator.lp!==t},settle:async()=>!0}]}),i},$c=()=>{const i=[];return i.push({name:"スターダスト・ドラゴン",actions:[he,_e,Te,yt(),{title:"①ヴィクテム・サンクチュアリ",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:Vt,executableDuelistTypes:["Controller"],canPayCosts:Pr,validate:(e,t)=>t.length===0?void 0:t[e.index-1].chainBlockTags.includes("DestroyOnField")?[]:void 0,payCosts:_a,prepare:async(e,t)=>{const a=t.slice(-1)[0];return{selectedEntities:[],chainBlockTags:e.action.calcChainBlockTagsForDestroy([a.action.entity]),prepared:void 0}},execute:async(e,t)=>{const a=t[e.index-1];return a.isNegatedActivationBy=e.action,await pe.tryDestroy([a.action.entity],e),!0},settle:async()=>!0},{title:"②自己再生",playType:"IgnitionEffect",isMandatory:!1,spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["end"],executableDuelistTypes:["Controller"],validate:e=>{const t=e.action.entity.moveLog.latestRecord;if(t.movedBy!==e.action.entity||!e.activator.duel.clock.isSameTurn(t.movedAt)||!t.movedAs.includes("Cost"))return;const a=e.activator.duel,r=e.action.entity.actionLogRecords.filter(s=>a.clock.isSameTurn(s.clock)).map(s=>s.chainBlockInfo).findLast(s=>s.action.title==="①ヴィクテム・サンクチュアリ");return!r||r.state!=="done"?void 0:e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:vt,execute:e=>ei(e),settle:async()=>!0}],defaultSummonFilter:ct}),i.push({name:"閃珖竜 スターダスト",defaultSummonFilter:ct,actions:[he,_e,yt(),{title:"波動音壁",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:st,executablePeriods:Me,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,hasToTargetCards:!0,validate:e=>{const t=e.activator.getEntiteisOnField().filter(a=>a.face==="FaceUp").filter(a=>a.canBeTargetOfEffect(e));if(t.length)return t.map(a=>a.fieldCell)},prepare:async(e,t,a)=>{if(e.dest)return{selectedEntities:e.dest.cardEntities,chainBlockTags:[],prepared:void 0};const r=e.activator.getEntiteisOnField().filter(s=>s.face==="FaceUp").filter(s=>s.canBeTargetOfEffect(e));if(!r.length)return;const n=await e.action.entity.duel.view.waitSelectEntities(e.activator,r,1,s=>s.length===1,"対象とするカードを選択",a);if(n)return{selectedEntities:n,chainBlockTags:[],prepared:void 0}},execute:async e=>(e.selectedEntities.filter(t=>t.isOnField).filter(t=>t.face==="FaceUp").filter(t=>t.canBeEffected(e.activator,e.action.entity,e.action)).forEach(t=>{t.counterHolder.add("SonicBarrier",1,e.action.entity)}),!0),settle:async()=>!0}],substituteEffects:[{title:"波動音壁（適用）",isMandatory:!0,executableCells:bi,executablePeriods:Vt,executableDuelistTypes:["Controller"],isApplicableTo:(e,t,a)=>a.filter(r=>r.counterHolder.getQty("SonicBarrier",e.entity)>0),substitute:async(e,t,a)=>{const r=a.filter(n=>n.counterHolder.getQty("SonicBarrier",e.entity)>0);return r.forEach(n=>{n.counterHolder.removeAll("SonicBarrier",e.entity),e.entity.controller.writeInfoLog(`波動音壁により${n.toString()}は１ターンに１度だけ戦闘効果では破壊されない。`)}),r}}]}),i.push({name:"真閃珖竜 スターダスト・クロニクル",defaultSummonFilter:ct,actions:[he,_e,yt(e=>e.length===1&&e.every(t=>{var a;return(a=t.status.monsterCategories)==null?void 0:a.includes("Syncro")}),e=>e.length>0&&e.every(t=>{var a;return(a=t.status.monsterCategories)==null?void 0:a.includes("Syncro")})),{title:"波動護魂",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:st,executablePeriods:Me,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,canPayCosts:e=>Lo(e,e.activator.getGraveyard().cardEntities.filter(t=>{var a;return(a=t.status.monsterCategories)==null?void 0:a.includes("Syncro")})),validate:()=>[],payCosts:e=>qo(e,e.activator.getGraveyard().cardEntities.filter(t=>{var a;return(a=t.status.monsterCategories)==null?void 0:a.includes("Syncro")}),t=>t.length===1,1),prepare:vt,execute:async e=>(e.action.entity.procFilterBundle.push(ya.createLingering(e.action.title,t=>t.effectOwner.duel.clock.isSameTurn(t.isSpawnedAt),e.action.entity,e.action,()=>!0,["Effect"],()=>!1)),!0),settle:async()=>!0},{title:"②蘇生",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Banished"],executablePeriods:[...Me,...Ye],executableDuelistTypes:["Controller"],validate:e=>{if(!e.action.entity.wasMovedAtPreviousChain){console.log(e.action.entity.toString(),e);return}const t=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getBanished().cardEntities.filter(r=>r.status.kind==="Monster").filter(r=>r.face==="FaceUp").filter(r=>r.types.includes("Dragon")).filter(r=>{var n;return(n=r.status.monsterCategories)==null?void 0:n.includes("Syncro")}).filter(r=>r.canBeTargetOfEffect(e)).map(r=>({monster:r,posList:Xe,cells:t})),[],!1).length)return[]},prepare:e=>Pi(e,e.activator.getBanished().cardEntities.filter(t=>t.status.kind==="Monster").filter(t=>t.face==="FaceUp").filter(t=>t.types.includes("Dragon")).filter(t=>{var a;return(a=t.status.monsterCategories)==null?void 0:a.includes("Syncro")}).filter(t=>t.canBeTargetOfEffect(e))),execute:async e=>Bi(e),settle:async()=>!0}]}),i.push({name:"聖珖神竜 スターダスト・シフル",defaultSummonFilter:ct,actions:[he,_e,yt(e=>e.length===1&&e.every(t=>{var a;return(a=t.status.monsterCategories)==null?void 0:a.includes("Syncro")}),e=>e.length>1&&e.every(t=>{var a;return(a=t.status.monsterCategories)==null?void 0:a.includes("Syncro")})),{title:"②珖波動反撃",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:["Hand"],executablePeriods:Me,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,negatePreviousBlock:!0,validate:e=>{if(e.targetChainBlock&&e.activator!==e.targetChainBlock.activator&&e.targetChainBlock.action.entity.status.kind==="Monster"&&e.targetChainBlock.action.isWithChainBlock)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["NegateCardEffect","DestroyOnField"],prepared:void 0}),execute:async e=>{if(!e.targetChainBlock)return!1;const t=e.targetChainBlock;t.isNegatedEffectBy=e.action;const a=await e.activator.duel.view.waitSelectEntities(e.activator,e.action.duel.field.getCardsOnField(),1,n=>n.length===1,"破壊するカードを選択。",!1)??[];return(await pe.tryDestroy(a,e)).length>0},settle:async()=>!0},{title:"③蘇生",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:10,canPayCosts:Ji,validate:e=>e.activator.getBanished().cardEntities.filter(a=>{var r;return(r=a.status.nameTags)==null?void 0:r.includes("スターダスト")}).filter(a=>(a.lvl??12)<9).length===0?void 0:e.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:Ra,prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:async e=>{const t=await e.activator.duel.view.waitSelectEntities(e.activator,e.activator.getBanished().cardEntities.filter(a=>{var r;return(r=a.status.nameTags)==null?void 0:r.includes("スターダスト")}).filter(a=>(a.lvl??12)<9),1,a=>a.length===1,"蘇生するモンスターを選択。",!1)??[];return ts(e,t)},settle:async()=>!0}],substituteEffects:[{title:"波動聖句",isMandatory:!0,executableCells:["MonsterZone"],executablePeriods:Vt,executableDuelistTypes:["Controller"],isApplicableTo:(e,t,a)=>a.filter(r=>r.controller===e.entity.controller).filter(r=>r.counterHolder.getQty("SonicVerse",e.entity)===0),substitute:async(e,t,a)=>{if(!e.entity.isEffective)return[];const r=a.filter(n=>n.controller===e.entity.controller).filter(n=>n.counterHolder.getQty("SonicVerse",e.entity)===0);return r.forEach(n=>{n.counterHolder.add("SonicVerse",1,e.entity),e.entity.controller.writeInfoLog(`${e.entity.toString()}の効果により${n.toString()}は１ターンに１度だけ破壊されない。`)}),r}}]}),i},Zc=()=>{const i=[];return[{name:"リビングデッドの呼び声",pos:"Attack",filter:()=>!0},{name:"エンジェル・リフト",pos:"Attack",filter:e=>(e.lvl??12)<3},{name:"正統なる血統",pos:"Attack",filter:e=>{var t;return(t=e.status.monsterCategories)==null?void 0:t.includes("Normal")}},{name:"蘇りし魂",pos:"Defense",filter:e=>{var t;return(t=e.status.monsterCategories)==null?void 0:t.includes("Normal")}},{name:"リミット・リバース",pos:"Attack",filter:e=>(e.atk??9999)<=1e3,onMonsterAfterMove:async(e,t)=>{if(!t.isOnFieldAsMonster||t.face==="FaceDown")return"RemoveMe";if(e.action.entity.isEffective&&t.battlePosition==="Defense")return e.action.entity.controller.writeInfoLog(`${t.toString()}が守備表示になったため、${e.action.entity.toString()}とともに破壊される。`),await pe.tryMarkForDestory([t,e.action.entity],e),"RemoveMe"}}].forEach(e=>i.push({name:e.name,actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:Me,executableDuelistTypes:["Controller"],validate:t=>{const a=t.activator.getMonsterZones();if(t.activator.getEnableSummonList(t.activator,"SpecialSummon",["Effect"],t.action,t.activator.getGraveyard().cardEntities.filter(n=>n.status.kind==="Monster").filter(e.filter).filter(n=>n.canBeTargetOfEffect(t)).map(n=>({monster:n,posList:["Attack"],cells:a})),[],!1).length)return Ee(t)},prepare:t=>Pi(t,t.activator.getGraveyard().cardEntities.filter(a=>a.status.kind==="Monster").filter(e.filter).filter(a=>a.canBeTargetOfEffect(t)),["Attack"]),execute:async t=>{if(!await Bi(t,["Attack"])||!t.selectedEntities.length)return!1;t.action.entity.info.effectTargets[t.action.seq]=t.selectedEntities,t.action.entity.onBeforeMove.append(async n=>{if(n.entity.face!=="FaceUp"||!n.entity.isOnFieldAsSpellTrap)return"RemoveMe";const s=Object.values(n.entity.info.effectTargets).flatMap(l=>l),[o]=n.args;if(!s.length)return"RemoveMe";const d=s[0];return d.isOnField&&d.face==="FaceUp"&&n.entity.isEffective&&!o.isSpellTrapZoneLikeCell&&(console.log(t.action.entity.toString()),n.entity.controller.writeInfoLog(`${t.action.entity.toString()}がフィールドを離れたため、対象モンスター${d.toString()}を破壊。`),await pe.tryMarkForDestory([d],t)),"RemoveMe"});const r=t.selectedEntities[0];return r.onBeforeMove.append(async n=>{if(n.entity.face!=="FaceUp"||!n.entity.isOnFieldAsMonster)return"RemoveMe";console.log(n.entity.toString(),n.entity);const[,,,,,s]=n.args;return t.action.entity.isOnField&&t.action.entity.face==="FaceUp"&&n.entity.isEffective&&s.union(["EffectDestroy","RuleDestroy"]).length&&(console.log(t.action.entity.toString()),t.activator.writeInfoLog(`${n.entity.toString()}が破壊されたため、${t.action.entity.toString()}を破壊。`),await pe.tryMarkForDestory([r],t)),"RemoveMe"}),r.onAfterMove.append(async n=>e.onMonsterAfterMove?await e.onMonsterAfterMove(t,n):"RemoveMe"),!0},settle:async()=>!0},ke]})),i},jc=(i,e,t,a)=>{if(!i.action.entity.origin.link||i.action.entity.origin.link<t.length)return;let r=t.map(s=>({material:s,link:1}));if(i.action.entity.origin.link>t.length){if(t.every(d=>(d.origin.link??1)<2))return;const s=[r];t.filter(d=>(d.origin.link??1)>1).forEach(d=>{[...s].forEach(l=>{s.push([...l.filter(c=>c.material!==d),{material:d,link:d.origin.link??1}])})});const o=s.find(d=>d.reduce((l,c)=>l+c.link,0)===i.action.entity.origin.link);if(!o)return;r=o}if(!a(t)||!i.activator.getEnableSummonList(i.activator,"LinkSummon",["Rule","SpecialSummon"],i.action,[{monster:i.action.entity,posList:["Attack"],cells:e}],r,!1).length)return;if(i.activator.getAvailableExtraZones().length)return r;const n=i.activator.duel.field.getCells("ExtraMonsterZone").map(s=>s.cardEntities[0]).filter(s=>s);if(n.filter(s=>s.controller===i.activator).length>0&&n.length===t.filter(s=>s.fieldCell.cellType==="ExtraMonsterZone").length||i.activator.getMonsterZones().flatMap(s=>s.arrowheadSources).some(s=>!t.includes(s))||i.activator.duel.field.canExtraLink(i.action.entity,r))return r},Uc=(i,e=()=>!0)=>{let t=[...i.activator.getMonstersOnField().filter(r=>r.battlePosition!=="Set"),...i.activator.getHandCell().entities.filter(r=>r.origin.kind==="Monster")];if(t.every(r=>!r.status.allowHandLink)&&(t=t.filter(r=>r.fieldCell.isPlayFieldCell)),t.length<1)return[];const a=[...i.activator.getMonsterZones(),...i.activator.duel.field.getAvailableExtraMonsterZones()];return t.getAllOnOffPattern().map(r=>jc(i,a,r,e)??[]).filter(r=>r.length)},Gc=async(i,e,t)=>{var d;const a=i.action.getEnableMaterialPatterns(i),r=a.map(l=>({infos:l,materialSeqList:l.map(c=>c.material.seq).sort()}));let n=a[0].map(l=>l.material);if(a.length>1){const l=a.flatMap(v=>v.map(p=>p.material)).getDistinct(),c=await i.action.entity.duel.view.waitSelectEntities(i.activator,l,void 0,v=>{const p=v.map(h=>h.seq).sort();return r.some(h=>p.length===h.materialSeqList.length&&p.every((m,C)=>m===h.materialSeqList[C]))},"リンク素材とするモンスターを選択",t);if(!c)return;n=c}console.log(a,n);const s=n.map(l=>l.seq).sort(),o=(d=r.find(l=>s.length===l.materialSeqList.length&&s.every((c,v)=>c===l.materialSeqList[v])))==null?void 0:d.infos;if(!o)throw new ve("想定されない状態",i,n);return await pe.sendManyToGraveyardForTheSameReason(n,["LinkMaterial","Cost","Rule","SpecialSummonMaterial"],i.action.entity,i.activator),{summonMaterialInfos:o}},Br=(i=()=>!0)=>({title:"リンク召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],getEnableMaterialPatterns:e=>Uc(e,i),canPayCosts:e=>e.action.getEnableMaterialPatterns(e).length>0,validate:e=>!e.ignoreCost||e.activator.getAvailableExtraZones().length+e.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:Gc,prepare:e=>oi(e,"LinkSummon",["Rule","SpecialSummon","LinkSummon"],["Attack"]),execute:ci,settle:async()=>!0}),zc=()=>{const i=[];return[{name:"ＬＡＮフォリンクス",validator:e=>e.length===2},{name:"トラフィックゴースト",validator:e=>e.length===3},{name:"天威の鬼神",validator:e=>e.length>1&&e.some(t=>{var a;return(a=t.status.monsterCategories)==null?void 0:a.includes("Link")})},{name:"天威の拳僧",validator:e=>e.every(t=>{var a,r;return((a=t.status.nameTags)==null?void 0:a.includes("天威"))&&!((r=t.status.monsterCategories)!=null&&r.includes("Link"))})},{name:"電影の騎士ガイアセイバー",validator:e=>e.length>1}].forEach(e=>i.push({name:e.name,actions:[he,Br(e.validator)],defaultSummonFilter:ct})),i},Vc=()=>{const i=[];return i.push({name:"ファイアウォール・ドラゴン・シンギュラリティ",actions:[he,Br(e=>e.length>2),{title:"①バウンス＆自己強化",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:st,executablePeriods:[...Me,...Ye],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>[...e.activator.getGraveyard().cardEntities,...e.activator.getMonstersOnField()].flatMap(n=>n.status.monsterCategories??[]).getDistinct().union(["Ritual","Fusion","Syncro","Xyz"]).length<1?void 0:[...e.activator.getOpponentPlayer().getGraveyard().cardEntities,...e.activator.getOpponentPlayer().getEntiteisOnField()].filter(n=>n.canBeTargetOfEffect(e)).length?[]:void 0,prepare:async e=>{const a=[...e.activator.getGraveyard().cardEntities,...e.activator.getMonstersOnField()].flatMap(s=>s.status.monsterCategories??[]).getDistinct().union(["Ritual","Fusion","Syncro","Xyz"]).length;if(a<1)return;const r=[...e.activator.getOpponentPlayer().getGraveyard().cardEntities,...e.activator.getOpponentPlayer().getEntiteisOnField()].filter(s=>s.canBeTargetOfEffect(e));if(r.length<1)return;const n=await e.action.entity.duel.view.waitSelectEntities(e.activator,r,void 0,s=>s.length>0&&s.length<=a,"手札に戻すカードを選択。",!1)??[];if(n.length)return{selectedEntities:n,chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.selectedEntities.filter(r=>r.isOnField||r.fieldCell.cellType==="Graveyard").filter(r=>r.canBeEffected(e.activator,e.action.entity,e.action));await pe.returnManyToHandForTheSameReason(t,["Effect"],e.action.entity,e.activator);const a=t.filter(r=>r.fieldCell.cellType==="Hand"||r.fieldCell.cellType==="ExtraDeck").length;return e.action.entity.numericOprsBundle.push(lt.createLingeringAddition(e.action.title,r=>r.isSpawnedBy.isEffective,e.action.entity,e.action,"attack",(r,n,s)=>s+500*a)),!0},settle:async()=>!0},{title:"②蘇生",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:st,executablePeriods:Vt,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>{const t=e.action.entity.moveLog.latestRecord.movedAt,a=e.action.duel.field.moveLog.getPriviousChainLog().filter(s=>s.entity.fieldCell.cellType==="Graveyard"||s.movedAs.includes("BattleDestroy")).filter(s=>s.movedAt.totalProcSeq>t.totalProcSeq).map(s=>s.entity.wasMovedFrom).toArray();if(e.action.duel.field.moveLog.getPriviousChainLog().forEach(s=>console.log(s.entity.toString(),s.entity.wasMovedFrom,s.entity.fieldCell,t,s.movedAt)),!e.action.entity.arrowheadDests.union(a).length)return;const r=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getGraveyard().cardEntities.filter(s=>s.status.kind==="Monster").filter(s=>s.types.includes("Cyberse")).filter(s=>s.canBeTargetOfEffect(e)).map(s=>({monster:s,posList:Xe,cells:r})),[],!1).length)return Ee(e)},prepare:e=>Pi(e,e.activator.getGraveyard().cardEntities.filter(t=>t.status.kind==="Monster").filter(t=>t.types.includes("Cyberse")).filter(t=>t.canBeTargetOfEffect(e)),Xe),execute:async e=>Bi(e,Xe),settle:async()=>!0}],defaultSummonFilter:ct}),i},Wc=()=>{const i=[];return i.push({name:"ドットスケーパー",actions:[he,_e,We,Te,{title:"①自己再生",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...Me,...Ye],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:1,actionGroupNamePerTurn:"ドットスケーパー",validate:e=>{if(e.action.entity.wasMovedAtPreviousChain)return e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:async e=>(console.log(e.action.actionGroupNamePerTurn),{selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:e=>ei(e),settle:async()=>!0},{title:"②自己帰還",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Banished"],executablePeriods:[...Me,...Ye],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:1,actionGroupNamePerTurn:"ドットスケーパー",validate:e=>{if(e.action.entity.wasMovedAtPreviousChain)return e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:async e=>(console.log(e.action.actionGroupNamePerTurn),{selectedEntities:[],chainBlockTags:["SpecialSummonFromBanished"],prepared:void 0}),execute:e=>ei(e),settle:async()=>!0}]}),i},Yc=()=>{const i=[];return i.push({name:"昇天の黒角笛",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Counter",executableCells:["SpellAndTrapZone"],executablePeriods:Vt,executableDuelistTypes:["Controller"],negateSummon:!0,validate:e=>{if(e.targetChainBlock&&e.targetChainBlock.action.playType==="SpecialSummon"&&e.targetChainBlock.activator!==e.activator&&e.activator.duel.field.getPendingMonstersOnField().length===1)return Ee(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["NegateSpecialSummon"],prepared:void 0}),execute:async e=>{const t=pe.negateSummonMany(e.action.entity,e.activator);return await pe.tryDestroy(t,e),!0},settle:async()=>!0},ke]}),i},Qc=()=>{const i=[];return i.push({name:"フォーミュラ・シンクロン",actions:[he,_e,Te,yt(),{title:"①ドロー",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:st,executablePeriods:[...Me,...Ye],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.hasBeenSummonedJustNow(["SyncroSummon"])&&e.activator.getDeckCell().cardEntities.length)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(1,e.action.entity,e.activator),!0),settle:async()=>!0},as({title:"②シンクロ召喚",isOnlyNTimesPerChain:1})],defaultSummonFilter:ct}),i},Kc=()=>{const i=[];return i.push({name:"死霊騎士デスカリバー・ナイト",actions:[he,_e,We,Te,{title:"①モンスター効果無効",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Quick",executableCells:["Graveyard"],executablePeriods:[...Me,...Ye],executableDuelistTypes:["Controller"],negatePreviousBlock:!0,canPayCosts:Pr,validate:e=>e.targetChainBlock&&e.targetChainBlock.action.entity.status.kind!=="Monster"&&e.targetChainBlock.action.isWithChainBlock?[]:void 0,payCosts:_a,prepare:async(e,t)=>{const a=e.targetChainBlock,r=t[e.index-1];return a!==r?{selectedEntities:[],chainBlockTags:[],prepared:void 0}:{selectedEntities:[],chainBlockTags:["NegateCardEffect",...e.action.calcChainBlockTagsForDestroy([a.action.entity])],prepared:void 0}},execute:async(e,t)=>{const a=t.find(n=>n.action.entity.status.kind!=="Monster"&&n.action.isWithChainBlock),r=t[e.index-1];return r!==a?!1:(r.isNegatedActivationBy=e.action,await pe.tryDestroy([r.action.entity],e),!0)},settle:async()=>!0}]}),i},Xc=()=>{const i=[];return i.push({name:"ゼラの天使",actions:[he,_e,Te,yt(),{title:"②自己帰還",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Banished"],executablePeriods:[...Me,...Ye],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.wasMovedAtPreviousTurn)return e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromBanished"],prepared:void 0}),execute:e=>ei(e),settle:async()=>!0}],continuousEffects:[Xi("②攻撃力上昇","Monster",e=>[e],()=>!0,e=>[lt.createContinuous("①攻撃力上昇",()=>!0,e,()=>!0,"attack","wip","Addition",(t,a,r)=>t.isEffective?r+t.controller.getOpponentPlayer().getBanished().cardEntities.length*100:r)])],defaultSummonFilter:ct}),i},Jc=()=>{const i=[];return i.push({name:"星杯の妖精リース",actions:[he,_e,Te,yt(),{title:"①サーチ",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...Me,...Ye],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.hasBeenSummonedNow(["NormalSummon","SpecialSummon"])&&e.activator.getDeckCell().cardEntities.filter(t=>t.status.kind==="Monster").filter(t=>{var a;return(a=t.status.nameTags)==null?void 0:a.includes("星杯")}).length!==0)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(r=>r.status.kind==="Monster").filter(r=>{var n;return(n=r.status.nameTags)==null?void 0:n.includes("星杯")});if(t.length===0)return!1;const a=await e.activator.waitSelectEntity(t,"手札に加えるモンスターを選択",!1);if(!a)throw new ve("想定されない状態",e);return await a.addToHand(["Effect"],e.action.entity,e.activator),!0},settle:async()=>!0}]}),i.push({name:"星遺物－『星杯』",actions:[he,_e,Te,yt(),{title:"①墓地送り",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...Me,...Ye],executableDuelistTypes:["Controller"],canPayCosts:Pr,validate:e=>e.activator.duel.field.moveLog.getPriviousChainLog().filter(t=>t.movedAs.includes("SpecialSummon")).map(t=>t.entity).some(t=>t.wasMovedFrom.cellType==="ExtraDeck")?[]:void 0,payCosts:_a,prepare:vt,execute:async e=>{const t=e.activator.duel.field.moveLog.getPriviousChainLog().filter(a=>a.movedAs.includes("SpecialSummon")).map(a=>a.entity).filter(a=>a.wasMovedFrom.cellType==="ExtraDeck").filter(a=>a.isOnFieldAsMonster).filter(a=>a.canBeEffected(e.activator,e.action.entity,e.action)).toArray();return await pe.sendManyToGraveyardForTheSameReason(t,["Effect"],e.action.entity,e.activator),!0},settle:async()=>!0},{title:"②リクルート",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Hand","Graveyard","Banished"],executablePeriods:[...Me,...Ye],executableDuelistTypes:["Controller"],validate:e=>{if(!e.action.entity.wasMovedAtPreviousChain||!e.action.entity.info.summonKinds.includes("NormalSummon")||e.action.entity.moveLog.previousPlaceRecord.face==="FaceDown")return;const t=e.activator.getDeckCell().cardEntities.filter(n=>n.status.kind==="Monster").filter(n=>{var s;return(s=n.status.nameTags)==null?void 0:s.includes("星杯")}).filter(n=>n.nm!=="星遺物－『星杯』"),a=e.activator.getMonsterZones();return e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,t.map(n=>({monster:n,cells:a,posList:Xe})),[],!1).length>1?[]:void 0},payCosts:_a,prepare:vt,execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(n=>n.status.kind==="Monster").filter(n=>{var s;return(s=n.status.nameTags)==null?void 0:s.includes("星杯")}).filter(n=>n.nm!=="星遺物－『星杯』"),a=e.activator.getMonsterZones();return(await e.activator.summonMany(e.activator,"SpecialSummon",["Effect"],e.action,t.map(n=>({monster:n,cells:a,posList:Xe})),[],!1,n=>n.length==2,!1)??[]).length==2},settle:async()=>!0},{title:"③サーチ",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],canPayCosts:Ji,validate:e=>{if(!e.action.entity.wasMovedAtCurrentChain)return e.activator.getDeckCell().cardEntities.filter(t=>{var a;return(a=t.status.nameTags)==null?void 0:a.includes("星遺物")}).length>0?[]:void 0},payCosts:Ra,prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>{const t=await e.activator.waitSelectEntity(e.activator.getDeckCell().cardEntities.filter(a=>{var r;return(r=a.status.nameTags)==null?void 0:r.includes("星遺物")}),"手札に加えるカードを選択",!1);return t?(await t.addToHand(["Effect"],e.action.entity,e.activator),!0):!1},settle:async()=>!0}]}),i},Ic=()=>{const i=[];return i.push({name:"水晶機巧－ハリファイバー",actions:[he,Br(e=>e.length===2&&e.some(t=>{var a;return(a=t.status.monsterCategories)==null?void 0:a.includes("Tuner")})),{title:"①リクルート",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:st,executablePeriods:[...Me,...Ye],executableDuelistTypes:["Controller"],validate:e=>{if(!e.action.entity.hasBeenSummonedNow(["LinkSummon"]))return;const t=[e.activator.getHandCell(),e.activator.getDeckCell()].flatMap(n=>n.cardEntities).filter(n=>(n.lvl??12)<4).filter(n=>{var s;return(s=n.status.monsterCategories)==null?void 0:s.includes("Tuner")}),a=e.activator.getMonsterZones();return e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,t.map(n=>({monster:n,cells:a,posList:["Defense"]})),[],!1).length?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async e=>{const t=[e.activator.getHandCell(),e.activator.getDeckCell()].flatMap(n=>n.cardEntities).filter(n=>(n.lvl??12)<4).filter(n=>{var s;return(s=n.status.monsterCategories)==null?void 0:s.includes("Tuner")}),a=e.activator.getMonsterZones(),r=await e.activator.summonMany(e.activator,"SpecialSummon",["Effect"],e.action,t.map(n=>({monster:n,cells:a,posList:["Defense"]})),[],!1,n=>n.length==1,!1)??[];return r.forEach(n=>n.statusOperatorBundle.push(new Mr("効果発動不可",s=>s.effectOwner.duel.clock.isSameTurn(s.isSpawnedAt),!1,e.action.entity,e.action,()=>!0,()=>({canActivateEffect:!1})))),r.length==1},settle:async()=>!0},{title:"②シンクロ召喚",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:st,executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerChain:1,canPayCosts:Ji,validate:e=>{if(e.activator.isTurnPlayer)return;const t=[...e.activator.getMonsterZones(),...e.activator.duel.field.getCells("ExtraMonsterZone")],a=e.activator.getExtraDeck().cardEntities.filter(n=>{var s;return(s=n.status.monsterCategories)==null?void 0:s.includes("Syncro")}).filter(n=>{var s;return(s=n.status.monsterCategories)==null?void 0:s.includes("Tuner")});return e.activator.getEnableSummonList(e.activator,"SyncroSummon",["SpecialSummon","Effect"],e.action,a.map(n=>({monster:n,cells:t,posList:Xe})),[{material:e.action.entity}],!1).length?[]:void 0},payCosts:Ra,prepare:vt,execute:async e=>{const t=[...e.activator.getMonsterZones(),...e.activator.duel.field.getCells("ExtraMonsterZone")],a=e.activator.getExtraDeck().cardEntities.filter(r=>{var n;return(n=r.status.monsterCategories)==null?void 0:n.includes("Syncro")}).filter(r=>{var n;return(n=r.status.monsterCategories)==null?void 0:n.includes("Tuner")});return await e.activator.summonMany(e.activator,"SyncroSummon",["SpecialSummon","Effect"],e.action,a.map(r=>({monster:r,cells:t,posList:Xe})),[],!1,r=>r.length===1,!1),!0},settle:async()=>!0}],defaultSummonFilter:ct}),i},eu=()=>{const i=[];return i.push({name:"エキセントリック・ボーイ",actions:[he,_e,We,Te],defaultSummonFilter:(e,t,a,r,n,s,o,d,l,c)=>{const v={posList:l,cells:c},p={posList:[],cells:[]};if(!n.includes("SyncroSummon"))return v;const h=d.map(C=>C.material),m=h.find(C=>C===e.isSpawnedBy);return m?h.length!==2?p:h.filter(C=>C!==m).every(C=>C.fieldCell.cellType==="Hand")?v:p:v},defaultStatus:{allowHandSyncro:!0}}),i},tu=()=>{const i=[];return i.push({name:"シューティング・ライザー・ドラゴン",actions:[he,_e,Te,yt(),{title:"①墓地送り",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:st,executablePeriods:[...Me,...Ye],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>{if(console.log(e.action.entity.toString()),!e.action.entity.hasBeenSummonedNow(["SyncroSummon"])){console.log(e.action.entity.toString());return}if(!e.activator.getDeckCell().cardEntities.some(t=>(t.lvl??12)<(e.action.entity.lvl??0))){console.log(e.action.entity.toString());return}return console.log(e.action.entity.toString()),[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SendToGraveyardFromDeck","IfSpecialSummonSucceed"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(n=>(n.lvl??12)<(e.action.entity.lvl??0));if(t.length===0)return!1;const a=await e.activator.waitSelectEntity(t,"墓地に送るモンスターを選択",!1);if(!a)throw new ve("想定されない状況",e);await a.sendToGraveyard(["Effect"],e.action.entity,e.activator);const r=a.lvl??0;return e.action.entity.numericOprsBundle.push(lt.createLingeringAddition("レベル減少",()=>!0,e.action.entity,e.action,"level",(n,s,o)=>o-r)),!0},settle:async()=>!0},as({title:"②シンクロ召喚",isOnlyNTimesPerChain:1})],defaultSummonFilter:ct}),i},iu=()=>{const i=[];return i.push({name:"ジャンク・コレクター",actions:[he,_e,Te,We,{title:"罠コピー",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:st,executablePeriods:Me,executableDuelistTypes:["Controller"],canPayCosts:e=>(e.activator.getGraveyard().cardEntities.filter(t=>t.status.kind==="Trap").filter(t=>t.status.trapCategory==="Normal").filter(t=>e.activator.canTryBanish(t,"BanishAsCost",e.action)).filter(t=>t.canBeBanished("BanishAsCost",e.activator,e.action.entity,e.action)).flatMap(t=>t.actions).filter(t=>t.playType==="CardActivation").filter(t=>t.needsToPayCost).filter(t=>t.validate(e.activator,[],!0)),Ji(e)),validate:()=>[],payCosts:async(e,t,a)=>{const r=e.activator.getGraveyard().cardEntities.filter(o=>o.status.kind==="Trap").filter(o=>o.status.trapCategory==="Normal").filter(o=>e.activator.canTryBanish(o,"BanishAsCost",e.action)).filter(o=>o.canBeBanished("BanishAsCost",e.activator,e.action.entity,e.action)).flatMap(o=>o.actions).filter(o=>o.playType==="CardActivation").filter(o=>!o.needsToPayCost).filter(o=>o.validate(e.activator,[],!0)).map(o=>o.entity),n=await e.activator.waitSelectEntity(r,"コピーする罠を選択。",a);if(!n)return;const s=[e.action.entity,n];return await pe.banishManyForTheSameReason(s,["Cost"],e.action.entity,e.activator),{banish:s}},prepare:async(e,t)=>{var n;const a=(n=e.costInfo.banish)==null?void 0:n.find(s=>s!==e.action.entity);if(!a)throw new ve("想定されない状況",e,e.costInfo);const r=a.actions.find(s=>s.playType==="CardActivation");if(!r)throw new ve("想定されない状況",e,e.costInfo,a);return await r.prepare(e.activator,void 0,void 0,t,!1,!0)},execute:async(e,t)=>{var n;const a=(n=e.costInfo.banish)==null?void 0:n.find(s=>s!==e.action.entity);if(!a)throw new ve("想定されない状況",e,e.costInfo);const r=a.actions.find(s=>s.playType==="CardActivation");if(!r)throw new ve("想定されない状況",e,e.costInfo,a);return await r.execute(e,t)},settle:async()=>!0}]}),i},au=()=>{const i=[...rc(),...uc(),..._c(),...oc(),...hc(),...kc(),...Sc(),...Cc(),...bc(),...wc(),...Tc(),...Ac(),...Rc(),...Pc(),...Mc(),...Zc(),...Bc(),...Nc(),...Hc(),...$c(),...zc(),...Vc(),...Wc(),...Yc(),...Qc(),...Kc(),...Xc(),...Jc(),...Ic(),...eu(),...tu(),...iu()],e=i.map(a=>a.name);console.info(e);const t=Object.values(Object.groupBy(e,a=>a)).filter(a=>((a==null?void 0:a.length)??2)>1).map(a=>a==null?void 0:a[0]);if(t.length>0)throw new ve("カード定義重複",...t);return i},cs=new Map;au().forEach(i=>{cs.set(i.name,i)});const fr=cs,ru=gs,rt=Object.values(ru).reduce((i,e)=>(i[e.name]=e,i),{}),us=[{id:-1,name:"サンプルデッキ１",description:"",cardNames:["アンノウン・シンクロン","六武衆のご隠居","ジャンク・フォアード","ジャンク・フォアード","ジャンク・フォアード","チューン・ウォリアー","チューン・ウォリアー","ガード・オブ・フレムベル","ガード・オブ・フレムベル","守護竜ユスティア","守護竜ユスティア","エンジェル・トランペッター","エンジェル・トランペッター","ジェムナイト・サフィア","ジェムナイト・サフィア","魂虎","魂虎","暗黒界の番兵 レンジ","暗黒界の番兵 レンジ","バトルフットボーラー","バトルフットボーラー","球騎士の三人娘","球騎士の三人娘","エンジェル・トランペッター","エンジェル・トランペッター","Ｇ戦隊 シャインブラック","Ｇ戦隊 シャインブラック","しゃりの軍貫","しゃりの軍貫","ジョングルグールの幻術師","ジョングルグールの幻術師","ゾンビーノ","ゾンビーノ","メガロスマッシャーＸ","メガロスマッシャーＸ","ライドロン","ライドロン","機界騎士アヴラム","機界騎士アヴラム","幻のグリフォン","幻のグリフォン","幻殻竜","幻殻竜","アレキサンドライドラゴン","アレキサンドライドラゴン","ジェネティック・ワーウルフ","ジェネティック・ワーウルフ","サイバー・ドラゴン","フロストザウルス","フロストザウルス","フロストザウルス","青眼の白龍","マジカル・アンドロイド","マジカル・アンドロイド","マジカル・アンドロイド","大地の騎士ガイアナイト","大地の騎士ガイアナイト","大地の騎士ガイアナイト","スクラップ・デスデーモン","スクラップ・デスデーモン","スクラップ・デスデーモン","スターダスト・ドラゴン","スターダスト・ドラゴン","スターダスト・ドラゴン","ナチュル・ガオドレイク","ナチュル・ガオドレイク","ナチュル・ガオドレイク"]},{id:-2,name:"サンプルデッキ２",description:"",cardNames:["アンノウン・シンクロン","六武衆のご隠居","ジャンク・フォアード","グローアップ・バルブ","ガード・オブ・フレムベル","伝説の白石","伝説の白石","伝説の白石","守護竜ユスティア","ギャラクシーサーペント","ジェネクス・コントローラー","Ｅ・ＨＥＲＯ フェザーマン","Ｅ・ＨＥＲＯ バーストレディ","チューン・ウォリアー","Ｅ・ＨＥＲＯ クレイマン","Ｅ・ＨＥＲＯ スパークマン","しゃりの軍貫","ジョングルグールの幻術師","ゾンビーノ","ジェネティック・ワーウルフ","ライトロード・ビースト ウォルフ","サイバー・ドラゴン","サイバー・ドラゴン","サイバー・ドラゴン","ラブラドライドラゴン","Ｄ－ＨＥＲＯ ディアボリックガイ","Ｄ－ＨＥＲＯ ディアボリックガイ","Ｄ－ＨＥＲＯ ディアボリックガイ","フロストザウルス","Ｅ・ＨＥＲＯ ネオス","青眼の白龍","青眼の白龍","青眼の白龍","Ｅ－エマージェンシーコール","おろかな埋葬","トレード・イン","トレード・イン","トレード・イン","闇の量産工場","強欲な壺","強欲な壺","強欲な壺","死者蘇生","死者蘇生","死者蘇生","召喚師のスキル","召喚師のスキル","召喚師のスキル","成金ゴブリン","成金ゴブリン","成金ゴブリン","戦士の生還","増援","調和の宝札","調和の宝札","調和の宝札","天使の施し","天使の施し","天使の施し","貪欲な壺","貪欲な壺","貪欲な壺","マジカル・アンドロイド","マジカル・アンドロイド","マジカル・アンドロイド","大地の騎士ガイアナイト","大地の騎士ガイアナイト","大地の騎士ガイアナイト","スクラップ・デスデーモン","スクラップ・デスデーモン","スクラップ・デスデーモン","スターダスト・ドラゴン","スターダスト・ドラゴン","スターダスト・ドラゴン","ナチュル・ガオドレイク","ナチュル・ガオドレイク","ナチュル・ガオドレイク"]}],ge=class ge{constructor(e,t){u(this,"id");u(this,"name");u(this,"description");u(this,"lastUsedAt");u(this,"cardNames");u(this,"getIllegalCardNames",()=>Array.from(new Set(this.cardNames.filter(e=>!Object.keys(rt).includes(e)))));u(this,"getDisableCardNames",()=>Array.from(new Set(this.cardNames.filter(e=>!Object.keys(rt).includes(e)))));u(this,"createCardInfos",()=>{const e=this.getIllegalCardNames();if(e.length>0)throw new Error(`存在しないカード名からデッキを生成しようとした。${e}`);return this.cardNames.map(t=>rt==null?void 0:rt[t]).filter(t=>t)});u(this,"copy",async()=>ge.createNewDeck(this.name,this.description,this.cardNames));u(this,"updateTimestamp",async()=>{await ge.tblHeader.update(this.id,e=>({...e,lastUsedAt:new Date}))});u(this,"saveDeckInfo",async e=>{const t=e??this;await ge.tblHeader.update(this.id,n=>({...n,name:t.name,description:t.description,lastUsedAt:new Date}));const a=(await ge.tblDetail.getAll()).filter(n=>n.deckId===this.id);await ge.tblDetail.delete(a.map(n=>n.id));const r=await ge.tblDetail.insertMany(t.cardNames.map((n,s)=>({deckId:this.id,seq:s,name:n,description:""})));return new ge(await ge.tblHeader.get(this.id),r)});u(this,"delete",async()=>{await ge.tblHeader.delete([this.id]);const e=(await ge.tblDetail.getAll()).filter(t=>t.deckId===this.id);await ge.tblDetail.delete(e.map(t=>t.id))});this.id=e.id,this.name=e.name,this.description=e.description,this.lastUsedAt=e.lastUsedAt,this.cardNames=t.filter(a=>a.deckId===this.id).map(a=>a.name)}};u(ge,"toJson",e=>{const t=e.map(a=>{const{id:r,name:n,description:s,lastUsedAt:o,cardNames:d}=a;return{id:r,name:n,description:s,lastUsedAt:o,cardNames:d}});return t.forEach(a=>{a.cardNames=a.cardNames.map(r=>rt[r]).sort(Ni).map(r=>r.name)}),JSON.stringify(t,null,2)}),u(ge,"convertToObjectURL",e=>{const t=ge.toJson(e),a=new Blob([t],{type:"text/plain"});return window.URL.createObjectURL(a)}),u(ge,"idb"),u(ge,"tblHeader"),u(ge,"tblDetail"),u(ge,"getAllDeckInfo",async e=>{if(e&&(ge.idb=e),!ge.idb)throw new Error("illegal argument: idb is undefined.");ge.tblHeader||(ge.tblHeader=new nu(ge.idb)),ge.tblDetail||(ge.tblDetail=new su(ge.idb));const t=await ge.tblHeader.getAll(),a=await ge.tblDetail.getAll();return t.length?t.map(r=>new ge(r,a)):[await ge.prepareSampleDeck()]}),u(ge,"createNewDeck",async(e,t,a)=>{const r=await ge.tblHeader.insert({name:e,description:t,lastUsedAt:new Date}),n=await ge.tblDetail.insertMany(a.map((s,o)=>({deckId:r.id,seq:o,name:s,description:""})));return new ge(r,n)}),u(ge,"prepareSampleDeck",async()=>{const e=us.slice(-1)[0];return await ge.createNewDeck(e.name,e.description,e.cardNames)});let xt=ge;class nu extends Er{constructor(t){super(t,"TblDeckHeader");u(this,"_prepareInitialRecords",()=>[])}}class su extends Er{constructor(t){super(t,"TblDeckDetail");u(this,"_prepareInitialRecords",()=>[])}}const sn=us.map(i=>({...i,lastUsedAt:new Date})).filter(i=>i.id<0);function lu(i){const e=i-1;return e*e*e+1}function ln(i,e){for(const t in e)i[t]=e[t];return i}function ou({fallback:i,...e}){const t=new Map,a=new Map;function r(s,o,d){const{delay:l=0,duration:c=D=>Math.sqrt(D)*30,easing:v=lu}=ln(ln({},e),d),p=s.getBoundingClientRect(),h=o.getBoundingClientRect(),m=p.left-h.left,C=p.top-h.top,y=p.width/h.width,S=p.height/h.height,k=Math.sqrt(m*m+C*C),P=getComputedStyle(o),O=P.transform==="none"?"":P.transform,T=+P.opacity;return{delay:l,duration:typeof c=="function"?c(k):c,easing:v,css:(D,q)=>`
			   opacity: ${D*T};
			   transform-origin: top left;
			   transform: ${O} translate(${q*m}px,${q*C}px) scale(${D+(1-D)*y}, ${D+(1-D)*S});
		   `}}function n(s,o,d){return(l,c)=>(s.set(c.key,l),()=>{if(o.has(c.key)){const v=o.get(c.key);return o.delete(c.key),r(v,l,c)}return s.delete(c.key),i&&i(l,c,d)})}return[n(a,t,!1),n(t,a,!0)]}var cu=w("<div></div>"),uu=w('<div class="duel_card_row svelte-1vsjnqs"><div> </div> <div> </div></div>'),du=w('<div class="duel_card_row svelte-1vsjnqs"><div class="svelte-1vsjnqs"></div> <div class="svelte-1vsjnqs"> </div></div>'),vu=w('<div class="duel_card_row svelte-1vsjnqs"><div class="svelte-1vsjnqs"></div> <div class="svelte-1vsjnqs"> </div></div>'),fu=w('<div class="duel_card_row svelte-1vsjnqs"><div> </div> <div> </div></div>'),pu=w('<div class="duel_card_row duel_card_detail svelte-1vsjnqs"><div class="svelte-1vsjnqs"> </div></div> <div class="duel_card_row duel_card_detail svelte-1vsjnqs"><div class="svelte-1vsjnqs"></div> <div class="svelte-1vsjnqs"><span> </span> / <span> </span></div></div>',1),hu=w('<button><div class="duel_card duel_card_visible svelte-1vsjnqs"><div class="duel_card_row svelte-1vsjnqs" style="position:relative"><div class="svelte-1vsjnqs"> </div> <div class="svelte-1vsjnqs"></div> <!></div> <!> <!> <!></div></button>'),gu=w('<button><div class="svelte-1vsjnqs">裏守備</div></button>'),yu=w('<div class="duel_card duel_card_face_down svelte-1vsjnqs"><div class="svelte-1vsjnqs">セット</div></div>');function Ft(i,e){Ie(e,!1);let t=Oe(e,"entity",8),a=Oe(e,"state",8,"Disabled"),r=Oe(e,"selectedList",28,()=>[]),n=Oe(e,"isVisibleForcibly",8,!1),s=Oe(e,"isWideMode",8,!1),o=Oe(e,"actions",24,()=>[]),d=Oe(e,"cardActionResolve",8),l=Oe(e,"entitySelectResolve",8,()=>{}),c,v=$e(!1),p=()=>{},h=Oe(e,"qty",12,void 0);const m=Z=>{c=Z.activator,K(v,!1),h(Z.qty),p=Z.resolve};t().field.duel.view.onWaitStart.append(m);let C=$e(!1);const y=()=>{if(a()!=="Disabled"&&a()==="Selectable"&&h()===1){if(r().some(Z=>Z.seq!==t().seq)){r([t()]);return}h()===1&&l()&&l()([t()])}},S=Z=>{(t().face==="FaceUp"||t().owner===t().field.duel.duelists.Below&&(t().isUnderControl||n()))&&t().field.duel.view.showCardInfo(t(),Z??"Normal")},k=()=>{if(S(),a()==="Disabled")return;if(a()==="Selectable"){K(v,!f(v)),h()===1&&(r().splice(0),t().duel.view.requireUpdate()),r(f(v)?[...r(),t()]:r().filter(Y=>Y!==t()));return}if(o().length===0)return;if(o().length===1){if(o()[0].dragAndDropOnly)return;if(d()){d()(o()[0]);return}p({action:o()[0]});return}if(!c)return;const Z=t().field.duel.view;Z.modalController.selectAction(Z,{title:"行動を選択。",activator:c,actions:o(),cancelable:!0}).then(Y=>{p({action:Y})})},P=Z=>{console.info("drag start",Z,o()),t().field.duel.view.setDraggingActions(o()),K(C,!0)},O=Z=>{console.info("drag end",Z,o()),t().field.duel.view.removeDraggingActions(),Z.dataTransfer&&K(C,!1)},T=()=>(S("Debug"),!1);ft();var D=Ne(),q=se(D);{var M=Z=>{var Y=hu(),Se=g(Y),qe=g(Se),J=g(qe),B=g(J),G=_(J,4);ue(G,1,()=>t().attr,ce,(R,V)=>{var Q=cu();x(()=>me(Q,`monster_attr ${f(V)??""} svelte-1vsjnqs`)),b(R,Q)});var le=_(qe,2);{var A=R=>{var V=uu(),Q=g(V),I=g(Q),ee=_(Q,2),ne=g(ee);x((ie,ae)=>{me(Q,fi(t().lvl!==t().origin.level?"different_from_its_origin":""),"svelte-1vsjnqs"),E(I,ie),me(ee,fi(t().rank!==t().origin.rank?"different_from_its_origin":""),"svelte-1vsjnqs"),E(ne,ae)},[()=>"★".repeat(t().lvl||0),()=>"☆".repeat(t().rank||0)],Ce),b(R,V)},U=R=>{var V=Ne(),Q=se(V);{var I=ne=>{var ie=du(),ae=_(g(ie),2),N=g(ae);x(()=>E(N,`${Yi[t().status.spellCategory]??""}魔法`)),b(ne,ie)},ee=ne=>{var ie=Ne(),ae=se(ie);{var N=$=>{var de=vu(),te=_(g(de),2),fe=g(te);x(()=>E(fe,`${Qi[t().status.trapCategory]??""}罠`)),b($,de)};H(ae,$=>{t().status.kind==="Trap"&&t().status.trapCategory&&$(N)},!0)}b(ne,ie)};H(Q,ne=>{t().status.kind==="Spell"&&t().status.spellCategory?ne(I):ne(ee,!1)},!0)}b(R,V)};H(le,R=>{t().status.kind==="Monster"?R(A):R(U,!1)})}var re=_(le,2);{var j=R=>{var V=fu(),Q=g(V),I=g(Q),ee=_(Q,2),ne=g(ee);x(()=>{me(Q,fi(t().psL!==t().origin.pendulumScaleL?"different_from_its_origin":""),"svelte-1vsjnqs"),E(I,`◀ ${t().psL??""}`),me(ee,fi(t().psR!==t().origin.pendulumScaleR?"different_from_its_origin":""),"svelte-1vsjnqs"),E(ne,`${t().psR??""} ▶`)}),b(R,V)};H(re,R=>{var V;(V=t().status.monsterCategories)!=null&&V.includes("Pendulum")&&R(j)})}var z=_(re,2);{var W=R=>{var V=pu(),Q=se(V),I=g(Q),ee=g(I),ne=_(Q,2),ie=_(g(ne),2),ae=g(ie),N=g(ae),$=_(ae,2),de=g($);x((te,fe)=>{E(ee,`${te??""}
            ${fe??""}`),me(ae,fi(t().atk!==t().origin.attack?"different_from_its_origin":""),"svelte-1vsjnqs"),E(N,t().atk??"?"),me($,fi(t().def!==t().origin.defense?"different_from_its_origin":""),"svelte-1vsjnqs"),E(de,t().def??"?")},[()=>t().types.map(te=>Ki[te]+(s()?La[te]:"")).join(),()=>{var te;return(te=t().status.monsterCategories)==null?void 0:te.map(fe=>Wi[fe]+(s()?Oa[fe]:"")).join()}],Ce),b(R,V)};H(z,R=>{t().status.kind==="Monster"&&R(W)})}x(R=>{me(Y,`duel_card button_style_reset ${t().status.kind??""} ${R??""} ${(f(v)?"duel_card_selected":"")??""} ${a()??""} duel_card_${t().orientation??""} ${(f(C)?"isDragging":"")??""} ${(s()?"duel_card_wide":"")??""} duel_card_${t().face??""} ${(t().isOnField?"duel_card_is_on_field":"")??""} svelte-1vsjnqs`),Nt(Y,"draggable",a()==="Draggable"),Nt(Y,"title",t().nm),E(B,t().nm)},[()=>{var R;return((R=t().status.monsterCategories)==null?void 0:R.join(" "))||""}],Ce),ze("dragstart",Y,P),ze("dragend",Y,O),ze("click",Y,k),ze("dblclick",Y,y),ze("mouseenter",Y,()=>S()),ze("contextmenu",Y,T),b(Z,Y)},X=Z=>{var Y=Ne(),Se=se(Y);{var qe=B=>{var G=gu();x(()=>me(G,`duel_card duel_card_face_down duel_card_face_down_defense ${a()??""}  ${(f(v)?"duel_card_selected":"")??""} svelte-1vsjnqs`)),ze("click",G,k),ze("dblclick",G,y),b(B,G)},J=B=>{var G=yu();b(B,G)};H(Se,B=>{t().battlePosition==="Set"?B(qe):B(J,!1)},!0)}b(Z,Y)};H(q,Z=>{t().face==="FaceUp"||n()||t().controller.duelistType==="Player"&&t().isUnderControl?Z(M):Z(X,!1)})}b(i,D),et()}var mu=w('<div class="phase_display svelte-rtvlgx"><span class="svelte-rtvlgx"> </span> </div>'),_u=w('<div class="lifepoint_display svelte-rtvlgx"><div class="svelte-rtvlgx"> </div> <div class="svelte-rtvlgx"> </div></div>'),Su=(i,e,t)=>e(f(t)),Cu=w('<div class="svelte-rtvlgx"><button class="phase_button svelte-rtvlgx"> </button></div>'),bu=w("<div><!></div>"),wu=w('<div class="svelte-rtvlgx"><!></div>'),Tu=w("<div><!></div>"),ku=w("<!> <!> <!>",1),Eu=w('<div style="position: absolute;" class="card_animation_receiver svelte-rtvlgx"><!></div>'),Du=w('<div style="position: absolute; top:0rem" class="svelte-rtvlgx">｛効果対象｝</div>'),xu=w('<!> <div style="position: absolute; display:flex;justify-content: center;" class="svelte-rtvlgx"><!></div>',1),Au=w(" <!> 】",1),Mu=w('<div style="position: absolute; bottom:0rem" class="svelte-rtvlgx"> <!></div>'),Pu=w("<!> <!>",1),Bu=w('<div class="badge svelte-rtvlgx"> </div>'),Fu=w('<div class="card_animation_receiver svelte-rtvlgx"><!></div>'),Ou=w("<!> <!> <!> <!>",1),Lu=w('<td><div role="listitem"><!></div></td>');function qu(i,e){Ie(e,!1);let t=Oe(e,"view",8),a=Oe(e,"row",8),r=Oe(e,"column",8),n=Oe(e,"selectedList",28,()=>[]),s=$e(t().getCell(a(),r()));const o=()=>{K(s,t().getCell(a(),r()))};f(s).onUpdate.append(o),t().onDuelUpdate.append(o),t().modalController.onUpdate.append(o);let d,l=$e([]),c=()=>{},v,p=$e([]);const h=A=>{K(T,void 0),n().reset(),d=A.activator,c=A.resolve,K(l,A.enableActions),K(p,A.chainBlockInfos.flatMap(U=>U.selectedEntities).getDistinct()),v=A.selectableEntities,A.entitiesValidator};t().onWaitStart.append(h);const m=()=>{d=void 0,K(l,[]),c=()=>{},v=[],K(p,[])};t().onWaitEnd.append(m);let C,y=$e(!1);const S=A=>{C=A,K(y,A.some(U=>{var re;return(re=U.validate(t().duel.priorityHolder,t().duel.chainBlockInfos,!1))==null?void 0:re.includes(f(s))})||!1),o()},k=()=>{C=void 0,K(y,!1),o()};t().onDragStart.append(S),t().onDragEnd.append(k);const[P,O]=jd;let T=$e(void 0);const D=A=>{if(d=void 0,f(s)===A.to||f(s).entities.includes(A.entity)){K(T,A);const U=A.resolve;K(s,f(s)),setTimeout(()=>{K(T,void 0),A.count++,A.count>1&&U()},600)}};t().onAnimation.append(D);const q=A=>{c({phaseChange:A})},M=()=>f(s).isStackCell&&f(s).entities.flatMap(A=>A.actions).filter(A=>f(l).map(U=>U.seq).some(U=>U===A.seq)).length>0,X=()=>{if(Ue(s,f(s).field.duel.view.infoBoardState="Log"),f(s).isStackCell){Ue(s,f(s).field.duel.view.infoBoardState="CellInfo"),Ue(s,f(s).field.duel.view.infoBoardCell=f(s)),f(s).field.duel.view.requireUpdate();const A=f(s).entities.flatMap(U=>U.actions).filter(U=>f(l).map(re=>re.seq).some(re=>re===U.seq));if(A.length){if(!d)return;const U=f(s).field.duel.view;U.modalController.selectAction(U,{title:"カードを選択。",activator:d,actions:A,cancelable:!0}).then(re=>{c({action:re})});return}}f(s).field.duel.view.requireUpdate(),console.info(f(s))},Z=A=>{A.preventDefault(),A.dataTransfer&&(A.dataTransfer.dropEffect="move")},Y=A=>{A.preventDefault(),console.info("drop",A,f(y),C),A.dataTransfer&&(A.dataTransfer.dropEffect="move");try{if(f(y)&&C){if(console.info(C,f(s)),C.length===1){const U=C[0].getClone();U.cell=f(s),U.pos=C[0].pos,c({action:U})}else if(C.length>1){if(!d)throw new ve("想定されない状態");f(s).field.duel.view.modalController.cancelAll(),f(s).field.duel.view.modalController.selectAction(f(s).field.duel.view,{title:"選択",activator:d,actions:C,cancelable:!1})}}}finally{t().removeDraggingActions()}},Se=(...A)=>{if(t().waitMode==="Animation")return"Disabled";if(v&&v.find(j=>A.find(z=>j===z)))return"Selectable";if(!f(l)||f(l).length===0||t().waitMode!=="SelectFieldAction"||Object.values(t().modalController.states).some(j=>j==="Shown"))return"Disabled";const U=f(l).filter(j=>A.includes(j.entity));if(U.length===0)return"Disabled";if(U.length>1||f(s).isStackCell||U[0].entity!==A[0])return"Clickable";const re=U[0].validate(t().duel.priorityHolder,t().duel.chainBlockInfos,!1);return re&&re.length>0?"Draggable":"Clickable"};ft();var qe=Lu(),J=g(qe);J.__click=X;var B=g(J);{var G=A=>{var U=Ne(),re=se(U);{var j=z=>{var W=Ne(),R=se(W);{var V=I=>{var ee=mu(),ne=g(ee),ie=g(ne),ae=_(ne,1,!0);x((N,$)=>{E(ie,N),E(ae,$)},[()=>String(f(s).field.duel.clock.turn).padStart(2,"0"),()=>f(s).field.duel.phase.toUpperCase()],Ce),b(I,ee)},Q=I=>{var ee=Ne(),ne=se(ee);{var ie=N=>{var $=_u(),de=g($),te=g(de),fe=_(de,2),Pe=g(fe);x(()=>{E(te,f(s).field.duel.duelists.Above.lp),E(Pe,f(s).field.duel.duelists.Below.lp)}),b(N,$)},ae=N=>{var $=Ne(),de=se($);{var te=fe=>{var Pe=Ne(),Ze=se(Pe);{var Re=F=>{var L=Ne(),ye=se(L);{var oe=be=>{var He=Ne(),je=se(He);ue(je,1,()=>t().duel.nextPhaseList,ce,(pt,ot)=>{var xe=Cu(),Ae=g(xe);Ae.__click=[Su,q,ot];var we=g(Ae);x(Ve=>E(we,Ve),[()=>f(ot).toUpperCase()],Ce),b(pt,xe)}),b(be,He)};H(ye,be=>{t().duel.isEnded||be(oe)})}b(F,L)};H(Ze,F=>{t().waitMode==="SelectFieldAction"&&F(Re)})}b(fe,Pe)};H(de,fe=>{f(s).column===5&&fe(te)},!0)}b(N,$)};H(ne,N=>{f(s).column===3?N(ie):N(ae,!1)},!0)}b(I,ee)};H(R,I=>{f(s).column===1?I(V):I(Q,!1)})}b(z,W)};H(re,z=>{f(s).row===3&&z(j)})}b(A,U)},le=A=>{var U=Ne(),re=se(U);{var j=W=>{var R=ku(),V=se(R);{var Q=ie=>{var ae=bu(),N=g(ae);Ft(N,{get entity(){return f(T).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),x(()=>me(ae,`card_animation_receiver ${f(s).cellType??""} svelte-rtvlgx`)),pi(1,ae,()=>O,()=>({key:f(T).entity.seq})),b(ie,ae)};H(V,ie=>{f(T)&&f(T).entity&&f(T).to===f(s)&&f(T).index==="Top"&&ie(Q)})}var I=_(V,2);ue(I,1,()=>f(s).visibleEntities,ce,(ie,ae)=>{var N=Ne(),$=se(N);{var de=te=>{var fe=wu(),Pe=g(fe);const Ze=Ce(()=>Se(f(ae))),Re=Ce(()=>f(l).filter(F=>F.entity===f(ae)));Ft(Pe,{get entity(){return f(ae)},get state(){return f(Ze)},get actions(){return f(Re)},cardActionResolve:void 0,get selectedList(){return n()},set selectedList(F){n(F)},$$legacy:!0}),pi(2,fe,()=>P,()=>({key:f(ae).seq})),b(te,fe)};H($,te=>{(!f(T)||f(T).entity.seq!==f(ae).seq)&&te(de)})}b(ie,N)});var ee=_(I,2);{var ne=ie=>{var ae=Tu(),N=g(ae);Ft(N,{get entity(){return f(T).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),x(()=>me(ae,`card_animation_receiver ${f(s).cellType??""} svelte-rtvlgx`)),pi(1,ae,()=>O,()=>({key:f(T).entity.seq})),b(ie,ae)};H(ee,ie=>{f(T)&&f(T).entity&&f(T).to===f(s)&&f(T).index!=="Top"&&ie(ne)})}b(W,R)},z=W=>{var R=Ou(),V=se(R);{var Q=$=>{var de=Eu(),te=g(de);Ft(te,{get entity(){return f(T).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),pi(1,de,()=>O,()=>({key:f(T).entity.seq})),b($,de)};H(V,$=>{f(T)&&f(T).entity&&f(T).to===f(s)&&f(T).index!=="Top"&&$(Q)})}var I=_(V,2);{var ee=$=>{var de=Pu(),te=se(de);ue(te,1,()=>f(s).visibleEntities.map((Ze,Re)=>({index:Re,entity:Ze})).toReversed(),ce,(Ze,Re)=>{var F=Ne(),L=se(F);{var ye=oe=>{var be=xu(),He=se(be);{var je=we=>{var Ve=Du();b(we,Ve)};H(He,we=>{f(p).includes(f(Re).entity)&&we(je)})}var pt=_(He,2),ot=g(pt);const xe=Ce(()=>!f(s).isStackCell&&f(Re).index===0?Se(...f(s).visibleEntities):void 0),Ae=Ce(()=>f(Re).index===0?f(l).filter(we=>f(s).visibleEntities.includes(we.entity)):void 0);Ft(ot,{get entity(){return f(Re).entity},get state(){return f(xe)},get actions(){return f(Ae)},cardActionResolve:void 0,get selectedList(){return n()},set selectedList(we){n(we)},$$legacy:!0}),pi(2,pt,()=>P,()=>({key:f(Re).entity.seq})),b(oe,be)};H(L,oe=>{(!f(T)||f(T).entity.seq!==f(Re).entity.seq)&&oe(ye)})}b(Ze,F)});var fe=_(te,2);{var Pe=Ze=>{var Re=Mu(),F=g(Re),L=_(F);ue(L,1,()=>Object.keys(f(s).visibleEntities[0].status.maxCounterQty),ce,(ye,oe)=>{var be=Au(),He=se(be),je=_(He);{var pt=ot=>{var xe=Kt();x(()=>E(xe,`/${f(s).visibleEntities[0].status.maxCounterQty[f(oe)]??""}`)),b(ot,xe)};H(je,ot=>{(f(s).visibleEntities[0].status.maxCounterQty[f(oe)]??!1)&&ot(pt)})}x(ot=>E(He,`【
              ${Bo[f(oe)]??""}${ot??""} `),[()=>f(s).visibleEntities[0].counterHolder.getQty(f(oe))],Ce),b(ye,be)}),x(()=>E(F,`【${f(s).visibleEntities[0].battlePositionName??""}】 `)),b(Ze,Re)};H(fe,Ze=>{f(s).visibleEntities[0].battlePosition&&Ze(Pe)})}b($,de)};H(I,$=>{f(s).visibleEntities.length>0&&$(ee)})}var ne=_(I,2);{var ie=$=>{var de=Bu(),te=g(de);x(()=>E(te,f(s).visibleEntities.length)),b($,de)};H(ne,$=>{f(s).isStackCell&&$(ie)})}var ae=_(ne,2);{var N=$=>{var de=Fu(),te=g(de);Ft(te,{get entity(){return f(T).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),pi(1,de,()=>O,()=>({key:f(T).entity.seq})),b($,de)};H(ae,$=>{f(T)&&f(T).entity&&f(T).to===f(s)&&f(T).index==="Top"&&$(N)})}b(W,R)};H(re,W=>{f(s).cellType==="Hand"?W(j):W(z,!1)},!0)}b(A,U)};H(B,A=>{f(s).isDisabledCell?A(G):A(le,!1)})}x(A=>{me(qe,`${`duel_field_cell duel_field_cell_${f(s).cellType} ${f(s).arrowheadSources.length===0?"":"duel_field_cell_linked"}`??""} svelte-rtvlgx`),Nt(qe,"colspan",f(s).cellType==="Hand"?7:1),me(J,`${A??""} svelte-rtvlgx`)},[()=>`duel_card_wrapper ${f(s).cellType} ${f(y)?"can_accept_drop":""} ${M()?"can_action":""} `],Ce),ze("dragover",J,A=>Z(A)),ze("drop",J,A=>Y(A)),b(i,qe),et()}Vi(["click"]);var Nu=w('<div class="title svelte-1sjjr5s"> </div>'),Ru=w('<div class="title svelte-1sjjr5s"> </div>'),Hu=w('<div class="duel_log_record svelte-1sjjr5s"> </div>'),$u=w('<div><div style=" white-space: nowrap;text-align: center;"> </div> <!></div>'),Zu=w("<div><!> <!></div>"),ju=w("<div><!> <!></div>"),Uu=w('<div class="duel_log svelte-1sjjr5s"><div class="duel_log_header svelte-1sjjr5s"></div> <div class="duel_log_body svelte-1sjjr5s"></div> <div class="duel_log_footer svelte-1sjjr5s"></div></div>');function Gu(i,e){Ie(e,!1);let t=$e(void 0),a=Oe(e,"log",8),r,n=$e([]);const s=()=>{const c=((r==null?void 0:r.seq)??-1)+1;console.log(a(),c,f(n).length),a().records.slice(c).forEach(v=>{if(!r){K(n,[[[[v]]]]),r=v;return}if(!f(n)[v.clock.turn]){Ue(n,f(n)[v.clock.turn]=[[[v]]]),r=v;return}if(!f(n)[v.clock.turn][v.clock.phaseSeq]){Ue(n,f(n)[v.clock.turn][v.clock.phaseSeq]=[[v]]),r=v;return}if(r.clock.chainSeq===v.clock.chainSeq&&r.clock.chainBlockSeq===v.clock.chainBlockSeq&&r.duelist===v.duelist){f(n)[v.clock.turn][v.clock.phaseSeq].slice(-1)[0].push(v),r=v;return}f(n)[v.clock.turn][v.clock.phaseSeq].push([v]),r=v}),K(n,f(n)),pl().then(()=>f(t)&&f(t).scroll(0,f(t).clientHeight*990))};a().onUpdate.append(s),a().duel.view.onDuelUpdate.append(s),ft();var o=Ne(),d=se(o);{var l=c=>{var v=Uu(),p=_(g(v),2);ue(p,5,()=>f(n),ce,(h,m)=>{var C=ju(),y=g(C);{var S=P=>{var O=Nu(),T=g(O);x(()=>E(T,`ターン：${f(m)[0][0][0].clock.turn??""}`)),b(P,O)};H(y,P=>{f(m)[0][0][0].clock.turn>0&&P(S)})}var k=_(y,2);ue(k,1,()=>f(m),ce,(P,O)=>{var T=Zu(),D=g(T);{var q=X=>{var Z=Ru(),Y=g(Z);x(()=>E(Y,f(O)[0][0].clock.period.name)),b(X,Z)};H(D,X=>{f(O)[0][0].clock.turn>0&&X(q)})}var M=_(D,2);ue(M,1,()=>f(O),ce,(X,Z)=>{var Y=$u(),Se=g(Y),qe=g(Se),J=_(Se,2);ue(J,1,()=>f(Z),ce,(B,G)=>{var le=Hu(),A=g(le);x(()=>E(A,f(G).text)),b(B,le)}),x(()=>{var B,G,le;me(Y,`duel_log_block_duelist duel_log_block_duelist_${((B=f(Z)[0].duelist)==null?void 0:B.seat)??"system"} svelte-1sjjr5s`),me(Se,`duelist ${((G=f(Z)[0].duelist)==null?void 0:G.seat)??""} svelte-1sjjr5s`),E(qe,((le=f(Z)[0].duelist)==null?void 0:le.profile.name)||"SYSTEM")}),b(X,Y)}),x(()=>me(T,`duel_log_block_phase duel_log_block_phase_${f(O)[0][0].clock.period.key??""} svelte-1sjjr5s`)),b(P,T)}),x(()=>me(C,`duel_log_block_turn duel_log_block_turn_${f(m)[0][0][0].clock.turn??""} svelte-1sjjr5s`)),b(h,C)}),Zl(p,h=>K(t,h),()=>f(t)),b(c,v)};H(d,c=>{a().duel.view.infoBoardState==="Log"&&c(l)})}b(i,o),et()}var zu=w('<div><div class="duelist_name svelte-1u7codf"> </div> <div> </div></div>');function on(i,e){Ie(e,!1);let t=Oe(e,"duelist",12),a=$e(0),r=$e();const n=async()=>{const p=t().lp-f(a);if(!f(r)||Math.abs(p)<10){K(a,t().lp),f(r)&&(f(r)(),K(r,void 0));return}K(a,f(a)+Math.floor(Math.random()*p)),await Xo(100),n()},s=()=>{t(t()),!f(r)&&t().lp!==f(a)&&new Promise(p=>{K(r,p),Math.abs(t().lp-f(a)),n()})};t().duel.log.onUpdate.append(s),n(),ft();var o=zu(),d=g(o),l=g(d),c=_(d,2),v=g(c);x(()=>{me(o,`duelist ${t().seat??""} svelte-1u7codf`),E(l,t().profile.name),me(c,`duelist_lp ${(f(r)?"vibration":"")??""} svelte-1u7codf`),E(v,f(a))}),b(i,o),et()}const Vu=()=>{};var Wu=w("<div><!></div>"),Yu=w("<div></div>"),Qu=(i,e,t)=>e.resolve(f(t)),Ku=(i,e)=>e.resolve(void 0),Xu=w('<button class="svelte-25k6xl">Cancel</button>'),Ju=w('<div class="base svelte-25k6xl"><button class="overlay svelte-25k6xl">☆</button> <div class="window svelte-25k6xl"><div> </div> <!> <div><button class="svelte-25k6xl">OK</button> <!></div></div></div>');function Iu(i,e){Ie(e,!0);let t=Qs(jt([])),a=e.chainBlockInfos.flatMap(o=>o.selectedEntities).getDistinct();var r=Ne(),n=se(r);{var s=o=>{var d=Ju(),l=g(d);l.__click=[Vu];var c=_(l,2),v=g(c),p=g(v),h=_(v,2);ue(h,17,()=>e.entities.map(k=>k.controller.seat).getDistinct(),ce,(k,P)=>{var O=Yu();ue(O,21,()=>e.entities.filter(T=>T.controller.seat===f(P)).toSorted(ss),ce,(T,D)=>{var q=Wu(),M=g(q);Ft(M,{get entity(){return f(D)},isVisibleForcibly:!0,state:"Selectable",entitySelectResolve:X=>e.resolve(X),get qty(){return e.qty},cardActionResolve:void 0,get selectedList(){return f(t)},set selectedList(X){K(t,jt(X))}}),x(X=>me(q,`entities_list_item ${X??""} svelte-25k6xl`),[()=>a.includes(f(D))?"effect_target":""]),b(T,q)}),x(()=>me(O,`entities_list ${f(P)??""} svelte-25k6xl`)),b(k,O)});var m=_(h,2),C=g(m);C.__click=[Qu,e,t];var y=_(C,2);{var S=k=>{var P=Xu();P.__click=[Ku,e],b(k,P)};H(y,k=>{e.cancelable&&k(S)})}x(k=>{E(p,e.title),C.disabled=k},[()=>!e.validator(f(t))]),b(o,d)};H(n,o=>{o(s)})}b(i,r),et()}Vi(["click"]);const ed=(i,e)=>{e.cancelable&&e.resolve(void 0)};var td=w('<div class="duel_card_wrapper svelte-5snthj"><!> <div> </div></div>'),id=(i,e)=>e.resolve(),ad=w('<div><button class="cancel_button svelte-5snthj">Cancel</button></div>'),rd=w('<div><button>★</button> <div><div> </div> <div class="flex svelte-5snthj"></div> <!></div></div>');function nd(i,e){Ie(e,!0);const[t,a]=zl(),r=()=>Gl(n,"$isDragging",t);let n=jl(!1);const s=()=>n.set(!0),o=()=>n.set(!1);e.view.onDragStart.append(s),e.view.onDragEnd.append(o);const d=p=>{if(e.activator.duelistType==="NPC")return"Disabled";const h=p.validate(e.activator,e.view.duel.chainBlockInfos,!1);return h&&h.length>0?"Draggable":"Clickable"};var l=Ne(),c=se(l);{var v=p=>{var h=rd(),m=g(h);m.__click=[ed,e];var C=_(m,2),y=g(C),S=g(y),k=_(y,2);ue(k,21,()=>e.actions,ce,(T,D)=>{var q=td(),M=g(q);const X=ii(()=>d(f(D))),Z=ii(()=>e.dragAndDropOnly?[]:[f(D)]);Ft(M,{get entity(){return f(D).entity},isVisibleForcibly:!0,get state(){return f(X)},get actions(){return f(Z)},get cardActionResolve(){return e.resolve}});var Y=_(M,2),Se=g(Y);x(()=>E(Se,`«${f(D).title??""}»`)),b(T,q)});var P=_(k,2);{var O=T=>{var D=ad(),q=g(D);q.__click=[id,e],b(T,D)};H(P,T=>{e.cancelable&&T(O)})}x(()=>{me(h,`${`base ${r()?"minimum_mode":""}`??""} svelte-5snthj`),me(m,`${`overlay ${r()?"minimum_mode":""}`??""} svelte-5snthj`),me(C,`${`window ${r()?"minimum_mode":""}`??""} svelte-5snthj`),E(S,e.title)}),b(p,h)};H(c,p=>{p(v)})}b(i,l),et(),a()}Vi(["click"]);const sd=(i,e,t,a)=>{e().cancelable&&(t()(void 0),K(a,!1))};var ld=(i,e,t)=>e()(t()),od=w("<li><button> </button></li>"),cd=(i,e)=>e()(void 0),ud=w("<button>Cancel</button>"),dd=w('<div class="base svelte-1103gpy"><button class="overlay svelte-1103gpy">★</button> <div class="window svelte-1103gpy"><div> </div> <ui class="text_list svelte-1103gpy"></ui> <!></div></div>');function vd(i,e){Ie(e,!1);let t=Oe(e,"arg",8),a=Oe(e,"resolve",8),r=$e(!0);ft();var n=Ne(),s=se(n);{var o=d=>{var l=dd(),c=g(l);c.__click=[sd,t,a,r];var v=_(c,2),p=g(v),h=g(p),m=_(p,2);ue(m,5,()=>t().choises,ce,(S,k)=>{let P=()=>f(k).seq,O=()=>f(k).text;var T=od(),D=g(T);D.__click=[ld,a,P];var q=g(D);x(()=>{me(T,`text_item ${P()??""} svelte-1103gpy`),E(q,O())}),b(S,T)});var C=_(m,2);{var y=S=>{var k=ud();k.__click=[cd,a],b(S,k)};H(C,S=>{t().cancelable&&S(y)})}x(()=>E(h,t().title)),b(d,l)};H(s,d=>{f(r)&&d(o)})}b(i,n),et()}Vi(["click"]);var fd=w('<div class="base svelte-1y912d"><!> <!> <!></div>');function pd(i,e){var v,p;Ie(e,!1);let t=Oe(e,"modalController",12);const a=()=>{t(t())};(p=(v=t())==null?void 0:v.onUpdate)==null||p.append(a),ft();var r=fd(),n=g(r);{var s=h=>{Iu(h,{get title(){return t().duelEntitiesSelectorArg.title},get entities(){return t().duelEntitiesSelectorArg.entities},get validator(){return t().duelEntitiesSelectorArg.validator},get qty(){return t().duelEntitiesSelectorArg.qty},get cancelable(){return t().duelEntitiesSelectorArg.cancelable},get chainBlockInfos(){return t().duelEntitiesSelectorArg.chainBlockInfos},resolve:m=>{t().duelEntitiesSelectorResolve(m)}})};H(n,h=>{t().states.DuelEntitiesSelector==="Shown"&&h(s)})}var o=_(n,2);{var d=h=>{const m=Ce(()=>t().cardActionSelectorArg.dragAndDropOnly??!1);nd(h,{get view(){return t().view},get title(){return t().cardActionSelectorArg.title},get activator(){return t().cardActionSelectorArg.activator},get actions(){return t().cardActionSelectorArg.actions},get dragAndDropOnly(){return f(m)},get cancelable(){return t().cardActionSelectorArg.cancelable},resolve:C=>{console.info(C),t().cardActionSelectorResolve(C)}})};H(o,h=>{t().states.DuelActionSelector==="Shown"&&h(d)})}var l=_(o,2);{var c=h=>{vd(h,{get arg(){return t().duelTextSelectorArg},resolve:m=>{console.info(m),t().duelTextSelectorResolve(m)}})};H(l,h=>{t().states.DuelTextSelector==="Shown"&&h(c)})}b(i,r),et()}const hd=(i,e)=>(e(e()==="Normal"?"Debug":"Normal"),!0);var gd=w('<div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"><pre class="description svelte-nn7bjy"> </pre></div></div> <div class="duel_card_info_row svelte-nn7bjy" style=" justify-content: space-between;"><div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"> </div></div>',1),yd=w('<div></div> <div class="svelte-nn7bjy"> </div>',1),md=w("<div> </div>"),_d=w("<div> </div>"),Sd=w('<div class="duel_card_info_row svelte-nn7bjy"><!> <!></div> <div class="duel_card_info_row svelte-nn7bjy"></div>',1),Cd=w('<div class="duel_card_row svelte-nn7bjy"><div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"> </div></div>'),bd=w('<div class="duel_card_row svelte-nn7bjy"><div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"> </div></div>'),wd=w("<!> <!>",1),Td=w('<div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"><pre class="description svelte-nn7bjy"> </pre></div></div>'),kd=w('<div class="svelte-nn7bjy"> </div>'),Ed=w('<div class="svelte-nn7bjy"> </div>'),Dd=w('<div class="svelte-nn7bjy"> </div>'),xd=w('<div class="svelte-nn7bjy"> </div>'),Ad=w('<div class="svelte-nn7bjy"> </div>'),Md=w('<div class="svelte-nn7bjy"> </div>'),Pd=w('<div class="svelte-nn7bjy"> </div>'),Bd=w('<div class="svelte-nn7bjy"> </div>'),Fd=w('<div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"><div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"></div></div></div>'),Od=w('<div class="svelte-nn7bjy">※テスト用カードです</div>'),Ld=w('<div class="duel_card_info_links svelte-nn7bjy"><a target="_blank" rel="noopener noreferrer" title="遊戯王カードWiki" class="svelte-nn7bjy">⇒遊戯王カードWiki</a> <a target="_blank" rel="noopener noreferrer" title="コナミカードデータベース" class="svelte-nn7bjy"> </a></div>'),qd=w('<div role="contentinfo"><div class="duel_card_info_header svelte-nn7bjy"><div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"> </div></div> <div class="duel_card_info_row svelte-nn7bjy" style="position:sticky; top:0;"><div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"> </div></div> <!></div> <div class="duel_card_info_body svelte-nn7bjy"><!></div> <div class="duel_card_info_footer svelte-nn7bjy"><!></div></div>');function Nd(i,e){Ie(e,!1);let t=Oe(e,"entity",8,void 0);const a=()=>t()?rt[t().origin.name]:void 0,r=()=>{var l;return t()&&(t().origin.cardId??!1)?`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=2&cid=${t().origin.cardId}`:`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=1&sess=1&rp=10&mode=&sort=1&keyword=${(l=a())==null?void 0:l.name}&stype=1&ctype=&othercon=2&starfr=&starto=&pscalefr=&pscaleto=&linkmarkerfr=&linkmarkerto=&link_m=2&atkfr=&atkto=&deffr=&defto=&releaseDStart=1&releaseMStart=1&releaseYStart=1999&releaseDEnd=&releaseMEnd=&releaseYEnd=`};let n=Oe(e,"mode",12,"Normal");ft();var s=Ne(),o=se(s);{var d=l=>{var c=qd();c.__contextmenu=[hd,n];var v=g(c),p=g(v),h=g(p),m=g(h),C=_(p,2),y=g(C),S=g(y),k=_(y,2),P=g(k),O=_(C,2);{var T=J=>{var B=wd(),G=se(B);{var le=j=>{var z=gd(),W=se(z),R=g(W),V=g(R),Q=g(V),I=_(W,2),ee=g(I),ne=g(ee),ie=_(ee,2),ae=g(ie);x(()=>{E(Q,rt[t().origin.name].pendulumDescription),E(ne,`◀ ${t().psL??""}`),E(ae,`${t().psR??""} ▶`)}),b(j,z)};H(G,j=>{var z;(z=t().status.monsterCategories)!=null&&z.includes("Pendulum")&&j(le)})}var A=_(G,2);{var U=j=>{var z=Sd(),W=se(z),R=g(W);ue(R,1,()=>t().attr,ce,(I,ee)=>{var ne=yd(),ie=se(ne),ae=_(ie,2),N=g(ae);x(()=>{me(ie,`monster_attr ${f(ee)??""} svelte-nn7bjy`),E(N,`${Dr[f(ee)]??""}属性`)}),b(I,ne)});var V=_(R,2);ue(V,1,()=>t().types,ce,(I,ee)=>{var ne=md(),ie=g(ne);x(()=>{me(ne,`monster_cat ${f(ee)??""} svelte-nn7bjy`),E(ie,`${Ki[f(ee)]??""}${La[f(ee)]??""}族`)}),b(I,ne)});var Q=_(W,2);ue(Q,5,()=>t().status.monsterCategories??[],ce,(I,ee)=>{var ne=_d(),ie=g(ne);x(()=>{me(ne,`monster_cat ${f(ee)??""} svelte-nn7bjy`),E(ie,`${Wi[f(ee)]??""}${Oa[f(ee)]??""}`)}),b(I,ne)}),b(j,z)},re=j=>{var z=Ne(),W=se(z);{var R=Q=>{var I=Cd(),ee=_(g(I),2),ne=g(ee);x(()=>E(ne,`${Yi[t().status.spellCategory]??""}魔法`)),b(Q,I)},V=Q=>{var I=Ne(),ee=se(I);{var ne=ie=>{var ae=bd(),N=_(g(ae),2),$=g(N);x(()=>E($,`${Qi[t().status.trapCategory]??""}罠`)),b(ie,ae)};H(ee,ie=>{t().status.kind==="Trap"&&t().status.trapCategory&&ie(ne)},!0)}b(Q,I)};H(W,Q=>{t().status.kind==="Spell"&&t().status.spellCategory?Q(R):Q(V,!1)},!0)}b(j,z)};H(A,j=>{t().status.kind==="Monster"?j(U):j(re,!1)})}b(J,B)};H(O,J=>{n()==="Normal"&&J(T)})}var D=_(v,2),q=g(D);{var M=J=>{var B=Td(),G=g(B),le=g(G),A=g(le);x(U=>E(A,U),[()=>{var U;return(U=a())==null?void 0:U.description}],Ce),b(J,B)},X=J=>{var B=Fd(),G=g(B),le=g(G);le.textContent='"info" :{';var A=_(le,2);ue(A,1,()=>Object.entries(t().info),ce,(xe,Ae)=>{let we=()=>f(Ae)[0],Ve=()=>f(Ae)[1];var ut=kd(),Fi=g(ut);x(wt=>E(Fi,`"${we()??""}" :${wt??""},`),[()=>{var wt;return(wt=Ve())==null?void 0:wt.toString()}],Ce),b(xe,ut)});var U=_(A,2);U.textContent="},";var re=_(U,2);re.textContent='"status" :{';var j=_(re,2);ue(j,1,()=>Object.entries(t().status),ce,(xe,Ae)=>{let we=()=>f(Ae)[0],Ve=()=>f(Ae)[1];var ut=Ed(),Fi=g(ut);x(wt=>E(Fi,`"${we()??""}" :${wt??""},`),[()=>{var wt;return(wt=Ve())==null?void 0:wt.toString()}],Ce),b(xe,ut)});var z=_(j,2);z.textContent="},";var W=_(z,2);W.textContent='"actions" :[';var R=_(W,2);ue(R,1,()=>t().actions,ce,(xe,Ae)=>{var we=Dd(),Ve=g(we);x(()=>E(Ve,`"${f(Ae).playType??""} ${f(Ae).title??""}",`)),b(xe,we)});var V=_(R,2);V.textContent="],";var Q=_(V,2);Q.textContent='"substituteEffects" :[';var I=_(Q,2);ue(I,1,()=>t().substituteEffects,ce,(xe,Ae)=>{var we=xd(),Ve=g(we);x(()=>E(Ve,`"${f(Ae).title??""}",`)),b(xe,we)});var ee=_(I,2);ee.textContent="],";var ne=_(ee,2);ne.textContent='"continuousEffects" :[';var ie=_(ne,2);ue(ie,1,()=>t().continuousEffects,ce,(xe,Ae)=>{var we=Ad(),Ve=g(we);x(()=>E(Ve,`"${f(Ae).isStarted??""}",`)),b(xe,we)});var ae=_(ie,2);ae.textContent="],";var N=_(ae,2);N.textContent='"procFilters" :[';var $=_(N,2);ue($,1,()=>t().procFilterBundle.operators,ce,(xe,Ae)=>{var we=Md(),Ve=g(we);x(ut=>E(Ve,`"${ut??""} ${f(Ae).title??""}",`),[()=>f(Ae).isSpawnedBy.toString()],Ce),b(xe,we)});var de=_($,2);de.textContent="],";var te=_(de,2);te.textContent='"numericStateOperators" :[';var fe=_(te,2);ue(fe,1,()=>t().numericOprsBundle.operators,ce,(xe,Ae)=>{var we=Pd(),Ve=g(we);x(ut=>E(Ve,`"${ut??""} ${f(Ae).title??""}",`),[()=>f(Ae).isSpawnedBy.toString()],Ce),b(xe,we)});var Pe=_(fe,2);Pe.textContent="],";var Ze=_(Pe,2);Ze.textContent='"stateOperators" :[';var Re=_(Ze,2);ue(Re,1,()=>t().statusOperatorBundle.operators,ce,(xe,Ae)=>{var we=Bd(),Ve=g(we);x(ut=>E(Ve,`"${ut??""} ${f(Ae).title??""}",`),[()=>f(Ae).isSpawnedBy.toString()],Ce),b(xe,we)});var F=_(Re,2);F.textContent="],";var L=_(F,2);L.textContent='"lastMoveLogRecord" :{';var ye=_(L,2),oe=g(ye),be=_(ye,2),He=g(be),je=_(be,2),pt=g(je),ot=_(je,2);ot.textContent="},",x((xe,Ae)=>{E(oe,`"movedBy":"${xe??""}",`),E(He,`"movedAs":"${Ae??""}",`),E(pt,`"movedAt":"${t().moveLog.latestRecord.movedAt??""}",`)},[()=>{var xe;return(xe=t().moveLog.latestRecord.movedBy)==null?void 0:xe.toString()},()=>t().moveLog.latestRecord.movedAs.join(" ")],Ce),b(J,B)};H(q,J=>{n()==="Normal"?J(M):J(X,!1)})}var Z=_(D,2),Y=g(Z);{var Se=J=>{var B=Od();b(J,B)},qe=J=>{var B=Ld(),G=g(B),le=_(G,2),A=g(le);x(U=>{var re;Nt(G,"href",`https://yugioh-wiki.net/index.php?${t().origin.wikiEncodedName}`),Nt(le,"href",U),E(A,`⇒${((re=t())!=null&&re.origin.cardId?"公式カードページ":"公式で検索")??""}`)},[r],Ce),b(J,B)};H(Y,J=>{var B;(B=t())!=null&&B.origin.isForTest?J(Se):J(qe,!1)})}x((J,B,G)=>{me(c,`duel_card duel_card_info ${t().origin.kind??""} ${J??""} svelte-nn7bjy`),E(m,t().nm),E(S,B),E(P,G)},[()=>{var J;return(J=t().origin.monsterCategories)==null?void 0:J.join(" ")},()=>"★".repeat(t().lvl||0),()=>"☆".repeat(t().rank||0)],Ce),b(l,c)};H(o,l=>{t()&&l(d)})}b(i,s),et()}Vi(["contextmenu"]);var Rd=w('<div class="duel_field_cell_info_item svelte-1xj7qf1"><!></div>'),Hd=w('<div class="duel_field_cell_info_box svelte-1xj7qf1"><div class="duel_field_cell_info_label svelte-1xj7qf1"> </div> <!></div>'),$d=w('<div class="duel_field_cell_info svelte-1xj7qf1"><div class="duel_field_cell_info_header item_btn svelte-1xj7qf1"><div class="svelte-1xj7qf1"> </div> <div class="svelte-1xj7qf1"> </div></div> <div class="duel_field_cell_info_body svelte-1xj7qf1"></div></div>');function Zd(i,e){Ie(e,!1);let t=Oe(e,"cell",12);const a=()=>{t(t())},r=d=>t().cardEntities.filter(l=>l.face===d);t().field.duel.view.onDuelUpdate.append(a),ft();var n=Ne(),s=se(n);{var o=d=>{var l=$d(),c=g(l),v=g(c),p=g(v),h=_(v,2),m=g(h),C=_(c,2);ue(C,4,()=>["FaceUp","FaceDown"],ce,(y,S)=>{var k=Ne(),P=se(k);{var O=T=>{var D=Hd(),q=g(D),M=g(q),X=_(q,2);ue(X,1,()=>r(S).toSorted(ss),ce,(Z,Y)=>{var Se=Rd(),qe=g(Se);const J=Ce(()=>t().owner===t().field.duel.duelists.Below);Ft(qe,{get entity(){return f(Y)},get isVisibleForcibly(){return f(J)},isWideMode:!0,cardActionResolve:void 0}),b(Z,Se)}),x(()=>E(M,S==="FaceUp"?"表向き":"裏向き")),b(T,D)};H(P,T=>{r(S).length&&T(O)})}b(y,k)}),x(()=>{var y;E(p,(y=t().owner)==null?void 0:y.profile.name),E(m,t().cellType)}),b(d,l)};H(s,d=>{t().field.duel.view.infoBoardState==="CellInfo"&&d(o)})}b(i,n),et()}const jd=ou({duration:400});var Ud=w('<div class="duel_field_header_message svelte-accyye"> </div> <div class="duel_field_header_buttons svelte-accyye"><button class="svelte-accyye">サレンダー</button></div>',1),Gd=w("<tr></tr>"),zd=w('<table class="duel_field svelte-accyye"><tbody class="svelte-accyye"></tbody></table>'),Vd=w('<button class="svelte-accyye">OK</button>'),Wd=w('<div class="flex duel_desk svelte-accyye"><div class="duel_desk_left v_flex svelte-accyye"><!> <!> <!></div> <div class=" duel_desk_center v_flex svelte-accyye"><div class="duel_field_header svelte-accyye"><!></div> <div class="svelte-accyye"><!></div> <div class="duel_field_footer svelte-accyye"><!></div></div> <div class=" duel_desk_right svelte-accyye" style="text-align: left;"><!> <!></div></div> <div style="position:absolute;left:0;bottom:0"> </div> <!>',1);function Yd(i,e){Ie(e,!1);let t=Oe(e,"duel",12),a=()=>{},r=$e(()=>!0),n=$e([]);const s=j=>{a=j.resolve,K(r,j.entitiesValidator),K(n,j.selectableEntities),j.duelEntitiesSelectorArg&&t().view.modalController.selectDuelEntities(j.duelEntitiesSelectorArg).then(z=>{a({selectedEntities:z})})};t().view.onWaitStart.append(s);const o=()=>{a=()=>{},K(r,()=>!0),K(n,[])};t().view.onWaitEnd.append(o);let d=$e(void 0),l=$e("Normal");const c=({card:j,mode:z})=>{K(d,j),K(l,z)};t().view.onShowCardEntity.append(c);let v=Oe(e,"selectedList",28,()=>[]);const p=()=>{t(t())};t().view.onDuelUpdate.append(p),t().log.onUpdate.append(p);const h=()=>{f(r)(v())&&a({selectedEntities:v()})},m=()=>{a({surrender:!0})};t().main(),ft();var C=Wd(),y=se(C),S=g(y),k=g(S);on(k,{get duelist(){return t().duelists.Above}});var P=_(k,2);Nd(P,{get entity(){return f(d)},get mode(){return f(l)}});var O=_(P,2);on(O,{get duelist(){return t().duelists.Below}});var T=_(S,2),D=g(T),q=g(D);{var M=j=>{var z=Ud(),W=se(z),R=g(W),V=_(W,2),Q=g(V);x(()=>E(R,`[TURN:${t().clock.turn}][PHASE:${t().phase}] ${t().view.message}`)),ze("click",Q,m),b(j,z)};H(q,j=>{t().isEnded||j(M)})}var X=_(D,2),Z=g(X);{var Y=j=>{var z=zd(),W=g(z);ue(W,5,()=>t().field.cells,ce,(R,V,Q)=>{var I=Gd();me(I,`${`duel_desk_row_${Q}`??""} svelte-accyye`),ue(I,5,()=>f(V),ce,(ee,ne,ie)=>{qu(ee,{get view(){return t().view},row:Q,column:ie,get selectedList(){return v()},set selectedList(ae){v(ae)},$$legacy:!0})}),b(R,I)}),b(j,z)};H(Z,j=>{t().clock.turn>0&&j(Y)})}var Se=_(X,2),qe=g(Se);{var J=j=>{var z=Vd();x(W=>z.disabled=W,[()=>!f(r)(v())],Ce),ze("click",z,h),b(j,z)};H(qe,j=>{f(n)&&f(n).length>0&&j(J)})}var B=_(T,2),G=g(B);Gu(G,{get log(){return t().log}});var le=_(G,2);Zd(le,{get cell(){return t().view.infoBoardCell}});var A=_(y,2),U=g(A),re=_(A,2);pd(re,{get modalController(){return t().view.modalController}}),x(j=>E(U,j),[()=>t().clock.toString()],Ce),b(i,C),et()}var Qd=w("<div></div>"),Kd=w('<span> </span> / <span style="display: inline-block;width:2rem;text-align: right;"> </span>',1),Xd=w('<li class="deck_editor_item svelte-vivzk2"><div role="listitem"><div class="svelte-vivzk2"><div class="svelte-vivzk2"> </div> <div style="display:flex" class="svelte-vivzk2"><div class="svelte-vivzk2"><!> <!> <!> <!> <!> <!> <!></div> <div style="flex-grow: 1; width:0.1rem" class="svelte-vivzk2"></div> <div class="svelte-vivzk2"><!></div></div></div></div> <button class="button_style_reset svelte-vivzk2" title="※shiftキー同時押しで一括投入">+</button> <button class="button_style_reset svelte-vivzk2" title="※shiftキー同時押しで一括外し">-</button></li>'),Jd=w('<div class="deck_editor_card_kind svelte-vivzk2"><span class="svelte-vivzk2"> </span> <ul class="svelte-vivzk2"></ul></div>'),Id=w('<div class="deck_editor_deck_type svelte-vivzk2"><span class="svelte-vivzk2"> </span> <!></div>'),ev=w('<div class="deck_editor_card_list svelte-vivzk2"></div>');function cn(i,e){Ie(e,!1);let t=Oe(e,"allCardInfos",8),a=Oe(e,"deckCardInfos",12),r=Oe(e,"mode",8),n=Oe(e,"onAttention",8);const s={Deck:["Monster","Spell","Trap"],ExtraDeck:["Monster"]},o=(v,p)=>(r()==="List"?t():a()).filter(h=>{var m;return fr.has(h.name)||((m=h.monsterCategories)==null?void 0:m.includes("Normal"))}).filter(h=>!p||h.kind===p).filter(h=>{var m,C;return!v||v==="Deck"&&!((m=h==null?void 0:h.monsterCategories)!=null&&m.union(ki).length)||v==="ExtraDeck"&&((C=h==null?void 0:h.monsterCategories)==null?void 0:C.union(ki).length)}),d=(v,p)=>{const h=a().filter(C=>C.name===p.name).length;if(h>2)return;const m=v.shiftKey?3-h:1;m<1||(a().push(...Array(m).fill(p)),a().sort(Ni),a(a()))},l=(v,p)=>{let h=0;a(a().filter(m=>m.name!==p.name?!0:(h++,!v.shiftKey&&h>1))),a().sort(Ni)};ft();var c=ev();ue(c,5,()=>Ql,ce,(v,p)=>{var h=Id(),m=g(h),C=g(m),y=_(m,2);ue(y,1,()=>s[f(p)],ce,(S,k)=>{var P=Jd(),O=g(P),T=g(O),D=_(O,2);ue(D,5,()=>o(f(p),f(k)).toSorted(Ni),ce,(q,M)=>{var X=Xd(),Z=g(X),Y=g(Z),Se=g(Y),qe=g(Se),J=_(Se,2),B=g(J),G=g(B);{var le=N=>{var $=Kt();x(()=>E($,`★${f(M).level??""}`)),b(N,$)};H(G,N=>{f(M).level&&N(le)})}var A=_(G,2);{var U=N=>{var $=Kt();x(()=>E($,`☆${f(M).rank??""}`)),b(N,$)};H(A,N=>{f(M).rank&&N(U)})}var re=_(A,2);ue(re,1,()=>f(M).attributes??[],ce,(N,$)=>{var de=Qd();x(()=>me(de,`monster_attr ${f($)??""} svelte-vivzk2`)),b(N,de)});var j=_(re,2);ue(j,1,()=>f(M).types??[],ce,(N,$)=>{var de=Kt();x(()=>E(de,Ki[f($)])),b(N,de)});var z=_(j,2);ue(z,1,()=>f(M).monsterCategories??[],ce,(N,$)=>{var de=Kt();x(()=>E(de,Wi[f($)])),b(N,de)});var W=_(z,2);{var R=N=>{var $=Kt();x(()=>E($,`${Yi[f(M).spellCategory]??""}魔法`)),b(N,$)};H(W,N=>{f(M).spellCategory!==void 0&&N(R)})}var V=_(W,2);{var Q=N=>{var $=Kt();x(()=>E($,`${Qi[f(M).trapCategory]??""}罠`)),b(N,$)};H(V,N=>{f(M).trapCategory!==void 0&&N(Q)})}var I=_(B,4),ee=g(I);{var ne=N=>{var $=Kd(),de=se($),te=g(de),fe=_(de,2),Pe=g(fe);x(()=>{E(te,f(M).attack??"?"),E(Pe,f(M).defense??"?")}),b(N,$)};H(ee,N=>{f(M).kind==="Monster"&&N(ne)})}var ie=_(Z,2),ae=_(ie,2);x(N=>{me(Z,`${N??""} svelte-vivzk2`),E(qe,f(M).name)},[()=>{var N,$;return`deck_editor_card duel_card ${f(M).kind} ${($=(N=f(M))==null?void 0:N.monsterCategories)==null?void 0:$.join(" ")} ${fr.has(f(M).name)?"is_implemented":"is_not_implemented"}`}],Ce),ze("mouseenter",Z,()=>n()(f(M))),ze("click",ie,N=>d(N,f(M))),ze("click",ae,N=>l(N,f(M))),b(q,X)}),x(q=>E(T,`${Wn[f(k)]??""}（${q??""}枚）`),[()=>o(f(p),f(k)).length],Ce),b(S,P)}),x(S=>E(C,`${Kl[f(p)]??""}（${S??""}枚）`),[()=>o(f(p)).length],Ce),b(v,h)}),b(i,c),et()}var tv=w('<div class="duel_card_info_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"><pre class="description svelte-1xf9hqi"> </pre></div></div> <div class="duel_card_info_row svelte-1xf9hqi" style=" justify-content: space-between;"><div class="svelte-1xf9hqi"> </div> <div class="svelte-1xf9hqi"> </div></div>',1),iv=w('<div></div> <div class="svelte-1xf9hqi"> </div>',1),av=w("<div> </div>"),rv=w("<div> </div>"),nv=w('<div class="duel_card_info_row svelte-1xf9hqi"><!> <!></div> <div class="duel_card_info_row svelte-1xf9hqi"></div>',1),sv=w('<div class="duel_card_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"></div> <div class="svelte-1xf9hqi"> </div></div>'),lv=w('<div class="duel_card_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"></div> <div class="svelte-1xf9hqi"> </div></div>'),ov=w('<div class="duel_card_info_row svelte-1xf9hqi"><div class="svelte-1xf9hqi">※テスト用カードです</div></div>'),cv=w('<div class="duel_card_info_links svelte-1xf9hqi"><a target="_blank" rel="noopener noreferrer" title="遊戯王カードWiki" class="svelte-1xf9hqi">⇒遊戯王カードWiki</a> <a target="_blank" rel="noopener noreferrer" title="コナミカードデータベース" class="svelte-1xf9hqi"> </a></div>'),uv=w('<div><div class="duel_card_info_header svelte-1xf9hqi"><div class="duel_card_info_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"> </div></div> <div class="duel_card_info_row svelte-1xf9hqi" style="position:sticky; top:0;"><div class="svelte-1xf9hqi"> </div> <div class="svelte-1xf9hqi"> </div></div></div> <div class="duel_card_info_body svelte-1xf9hqi"><!> <!> <div class="duel_card_info_row description svelte-1xf9hqi"><div class="svelte-1xf9hqi"><pre class="description svelte-1xf9hqi"> </pre></div></div> <!></div></div>');function dv(i,e){Ie(e,!1);let t=Oe(e,"cardInfo",8,void 0);const a=()=>t()?rt[t().name]:void 0;ft();var r=Ne(),n=se(r);{var s=o=>{var d=uv(),l=g(d),c=g(l),v=g(c),p=g(v),h=_(c,2),m=g(h),C=g(m),y=_(m,2),S=g(y),k=_(l,2),P=g(k);{var O=B=>{var G=tv(),le=se(G),A=g(le),U=g(A),re=g(U),j=_(le,2),z=g(j),W=g(z),R=_(z,2),V=g(R);x(()=>{E(re,rt[t().name].pendulumDescription),E(W,`◀ ${t().pendulumScaleL??""}`),E(V,`${t().pendulumScaleR??""} ▶`)}),b(B,G)};H(P,B=>{var G;(G=t().monsterCategories)!=null&&G.includes("Pendulum")&&B(O)})}var T=_(P,2);{var D=B=>{var G=nv(),le=se(G),A=g(le);{var U=W=>{var R=iv(),V=se(R),Q=_(V,2),I=g(Q);x(()=>{me(V,`monster_attr ${t().attributes[0]??""} svelte-1xf9hqi`),E(I,`${Dr[t().attributes[0]]??""}属性`)}),b(W,R)};H(A,W=>{t().attributes&&W(U)})}var re=_(A,2);{var j=W=>{var R=av(),V=g(R);x(()=>{me(R,`monster_cat ${t().types[0]??""} svelte-1xf9hqi`),E(V,`${Ki[t().types[0]]??""}${La[t().types[0]]??""}族`)}),b(W,R)};H(re,W=>{t().types&&W(j)})}var z=_(le,2);ue(z,5,()=>t().monsterCategories??[],ce,(W,R)=>{var V=rv(),Q=g(V);x(()=>{me(V,`monster_cat ${f(R)??""} svelte-1xf9hqi`),E(Q,`${Wi[f(R)]??""}${Oa[f(R)]??""}`)}),b(W,V)}),b(B,G)},q=B=>{var G=Ne(),le=se(G);{var A=re=>{var j=sv(),z=_(g(j),2),W=g(z);x(()=>E(W,`${Yi[t().spellCategory]??""}魔法`)),b(re,j)},U=re=>{var j=Ne(),z=se(j);{var W=R=>{var V=lv(),Q=_(g(V),2),I=g(Q);x(()=>E(I,`${Qi[t().trapCategory]??""}罠`)),b(R,V)};H(z,R=>{t().kind==="Trap"&&t().trapCategory&&R(W)},!0)}b(re,j)};H(le,re=>{t().kind==="Spell"&&t().spellCategory?re(A):re(U,!1)},!0)}b(B,G)};H(T,B=>{t().kind==="Monster"?B(D):B(q,!1)})}var M=_(T,2),X=g(M),Z=g(X),Y=g(Z),Se=_(M,2);{var qe=B=>{var G=ov();b(B,G)},J=B=>{var G=cv(),le=g(G),A=_(le,2),U=g(A);x(re=>{Nt(le,"href",`https://yugioh-wiki.net/index.php?${t().wikiEncodedName}`),Nt(A,"href",re),E(U,`⇒${(t().cardId?"公式カードページ":"公式で検索")??""}`)},[()=>io(t())],Ce),b(B,G)};H(Se,B=>{t().isForTest?B(qe):B(J,!1)})}x((B,G,le,A)=>{me(d,`duel_card duel_card_info ${t().kind??""} ${B??""} svelte-1xf9hqi`),E(p,t().name),E(C,G),E(S,le),E(Y,A)},[()=>{var B;return(B=t().monsterCategories)==null?void 0:B.join(" ")},()=>"★".repeat(t().level||0),()=>"☆".repeat(t().rank||0),()=>{var B;return(B=a())==null?void 0:B.description}],Ce),b(o,d)};H(n,o=>{t()&&o(s)})}b(i,r),et()}const vv={0:{aaa:"日",aaaa:"日曜日",ddd:"Sun",dddd:"Sunday"},1:{aaa:"月",aaaa:"月曜日",ddd:"Mon",dddd:"Monday"},2:{aaa:"火",aaaa:"火曜日",ddd:"Tue",dddd:"Tuesday"},3:{aaa:"水",aaaa:"水曜日",ddd:"Wed",dddd:"Wednesday"},4:{aaa:"木",aaaa:"木曜日",ddd:"Thu",dddd:"Thursday"},5:{aaa:"金",aaaa:"金曜日",ddd:"Fri",dddd:"Friday"},6:{aaa:"土",aaaa:"土曜日",ddd:"Sat",dddd:"Saturday"}};class fv{constructor(){u(this,"DefaultSeparator1","/");u(this,"DefaultSeparator2"," ");u(this,"DefaultSeparator3",":");u(this,"createDate",e=>{if(!e)return;const t=new Date(e);if(!isNaN(t.getTime()))return t});u(this,"createDateOr",(e,t)=>this.createDate(e)||t||new Date);u(this,"truncateDate",e=>{const t=e||new Date;return new Date(t.getFullYear(),t.getMonth(),t.getDate())});u(this,"addDate",(e,t)=>{const a=this.createDateOr(e);return a.setDate(a.getDate()+t),a});u(this,"addMonth",(e,t)=>{const a=this.createDateOr(e);return a.setMonth(a.getMonth()+t),a});u(this,"addYear",(e,t)=>{const a=this.createDateOr(e);return a.setFullYear(a.getFullYear()+t),a});u(this,"getDayOfWeek",(e,t="dddd")=>{const a=this.createDate(e);return a?vv[a.getDay()][t]:""});u(this,"formatToYYYYMMDD",(e,t=this.DefaultSeparator1)=>{const a=this.createDate(e);if(!a)return"";const r=a.getFullYear().toString(),n=("0"+(a.getMonth()+1)).slice(-2),s=("0"+a.getDate()).slice(-2);return r+t+n+t+s});u(this,"formatToYYYYMM",(e,t=this.DefaultSeparator1)=>{const a=this.createDate(e);if(!a)return"";t||(t="");const r=a.getFullYear().toString(),n=("0"+(a.getMonth()+1)).slice(-2);return r+t+n});u(this,"formatToHHMMSS",(e,t=this.DefaultSeparator3)=>{const a=this.createDate(e);if(!a)return"";t||(t="");const r=a.getHours(),n=a.getMinutes(),s=a.getSeconds();return("0"+r).slice(-2)+t+("0"+n).slice(-2)+t+("0"+s).slice(-2)});u(this,"formatToHHMM",(e,t=this.DefaultSeparator3)=>{const a=this.createDate(e);if(!a)return"";t||(t="");const r=("0"+a.getHours()).slice(-2),n=("0"+a.getMinutes()).slice(-2);return r+t+n});u(this,"formatToYYYYMMDD_HHMM",(e,t=this.DefaultSeparator1,a=this.DefaultSeparator2,r=this.DefaultSeparator3)=>{const n=this.createDate(e);return n?this.formatToYYYYMMDD(n,t)+a+this.formatToHHMM(n,r):""});u(this,"formatToYYYYMMDD_HHMMSS",(e,t=this.DefaultSeparator1,a=this.DefaultSeparator2,r=this.DefaultSeparator3)=>{const n=this.createDate(e);return n?this.formatToYYYYMMDD(n,t)+a+this.formatToHHMMSS(n,r):""})}}const bt=new fv;Date.prototype.truncateDate=function(){return bt.truncateDate(this)};Date.prototype.getCloneOr=function(i){return bt.createDateOr(this,i)};Date.prototype.addDate=function(i){return bt.addDate(this,i)};Date.prototype.addMonth=function(i){return bt.addDate(this,i)};Date.prototype.addYear=function(i){return bt.addDate(this,i)};Date.prototype.getDayOfWeek=function(i="dddd"){return bt.getDayOfWeek(this,i)};Date.prototype.formatToYYYYMM=function(i){return bt.formatToYYYYMM(this,i)};Date.prototype.formatToYYYYMMDD=function(i){return bt.formatToYYYYMMDD(this,i)};Date.prototype.formatToYYYYMMDD_HHMM=function(i,e,t){return bt.formatToYYYYMMDD_HHMM(this,i,e,t)};Date.prototype.formatToYYYYMMDD_HHMMSS=function(i,e,t){return bt.formatToYYYYMMDD_HHMMSS(this,i,e,t)};Date.prototype.formatToHHMM=function(i){return bt.formatToHHMM(this,i)};Date.prototype.formatToHHMMSS=function(i){return bt.formatToHHMMSS(this,i)};var pv=w('<label><input type="checkbox"> </label>'),hv=w('<label><input type="checkbox"> </label>'),gv=w('<label><input type="checkbox"> <div style="display: inline-block;"></div> </label>'),yv=w('<label><input type="checkbox"> </label>'),mv=w('<label><input type="checkbox"> </label>'),_v=w('<label><input type="checkbox"> </label>'),Sv=w("<option> </option>"),Cv=w('<div class="svelte-b5thz2"><a class="white_button svelte-b5thz2" download="SVS_DeckInfos.json">ダウンロード</a></div>'),bv=w('<div class="svelte-b5thz2"></div>'),wv=w('<div class="svelte-b5thz2"><a class="white_button svelte-b5thz2" download="SVS_DeckInfos.json">ダウンロード（一括）</a></div>'),Tv=w('<div class="svelte-b5thz2"></div>'),kv=w('<div class="deck_editor_body_right_header svelte-b5thz2"><div class="deck_editor_body_right_header_row svelte-b5thz2"><div class="svelte-b5thz2">編集対象 <select></select></div> <div class="svelte-b5thz2"></div> <div class="svelte-b5thz2">新規名称 <input type="text"></div></div> <div class="deck_editor_body_right_header_row svelte-b5thz2"></div> <div class="deck_editor_body_right_header_row svelte-b5thz2"><div class="svelte-b5thz2">基本操作</div> <div class="svelte-b5thz2"><button class="white_button svelte-b5thz2">デッキを保存</button></div> <div class="svelte-b5thz2"></div> <div class="svelte-b5thz2"><button class="white_button svelte-b5thz2">デッキを複製</button></div> <div class="svelte-b5thz2"><button class="white_button svelte-b5thz2" title="shiftキー押下で確認メッセージスキップ">デッキを削除</button></div></div> <div class="deck_editor_body_right_header_row svelte-b5thz2"><div class="svelte-b5thz2">DL/UL</div> <!> <!></div></div> <!>',1),Ev=w("<div>デッキ情報読込中</div>"),Dv=w('<div class="deck_editor svelte-b5thz2"><div class="deck_editor_header"></div> <div class="deck_editor_body svelte-b5thz2"><div class="deck_editor_body_left svelte-b5thz2"><div class="deck_editor_search_box svelte-b5thz2"><div class="deck_editor_search_box_header svelte-b5thz2"><div>検索条件</div> <div><button class="white_button svelte-b5thz2">条件クリア</button></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">名称</div> <div class="svelte-b5thz2"><input type="text" style="width:70%">※ルビには対応していません</div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">種類</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">モンスター</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">属性</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">種族</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">魔法</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">罠</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">テスト用</div> <div class="svelte-b5thz2"><label><input type="checkbox"> テスト用カードを表示する</label></div></div></div> <!></div> <div class="deck_editor_body_center svelte-b5thz2"><!></div> <div class="deck_editor_body_right svelte-b5thz2"><!></div></div></div>');function xv(i,e){Ie(e,!1);const t=[],a=[],r=[],n=[],s=[],o=[],d=async()=>{Ue(S,f(S).name=""),Ue(S,f(S).cardKinds=[]),Ue(S,f(S).monsterCategories=[]),Ue(S,f(S).monsterAttributes=[]),Ue(S,f(S).monsterTypes=[]),Ue(S,f(S).spellCategories=[]),Ue(S,f(S).trapCategories=[]),Ue(S,f(S).isForTest=!1)},l=async()=>{const L=(await f(p)).find(ye=>ye.id===f(v));L&&K(C,{...L,cardInfos:L.cardNames.map(ye=>rt[ye])})},c=()=>xt.getAllDeckInfo().then(F=>(F.forEach(L=>console.log(L.id,L.lastUsedAt,L.lastUsedAt.getTime())),console.log(Math.max(...F.map(L=>L.lastUsedAt.getTime()))),K(v,(F.find(L=>L.lastUsedAt.getTime()===Math.max(...F.map(ye=>ye.lastUsedAt.getTime())))??F[0]).id),F));let v=$e(-1),p=$e(c()),h=$e(f(p).then(F=>xt.convertToObjectURL(F)));f(p).then(l);const m=()=>{K(p,c()),K(h,f(p).then(F=>xt.convertToObjectURL(F))),l()};let C=$e({id:-Number.MAX_VALUE,name:"",description:"",lastUsedAt:new Date,cardInfos:[]}),y=$e(rt.ゾンビーノ);const S=$e({name:"",cardKinds:[...ir],monsterCategories:[...Yr].filter(F=>F!=="Normal"&&F!=="Token"),monsterAttributes:[...Qr],monsterTypes:[...Kr],spellCategories:[...Xr],trapCategories:[...Jr],isForTest:!1}),k=()=>Object.values(rt).filter(F=>{if(!f(S).cardKinds.includes(F.kind)||f(S).name.trim().length&&!F.name.includes(f(S).name)||F.isForTest&&!f(S).isForTest)return!1;if(F.kind==="Monster")return F.attributes&&!f(S).monsterAttributes.union(F.attributes).length||F.types&&!f(S).monsterTypes.union(F.types).length||!F.monsterCategories?!1:F.monsterCategories.union(f(S).monsterCategories).length;if(F.kind==="Spell")return F.spellCategory&&f(S).spellCategories.includes(F.spellCategory);if(F.kind==="Trap")return F.trapCategory&&f(S).trapCategories.includes(F.trapCategory)}),P=F=>{K(y,F)},O=async()=>{const L=(await f(p)).find(ye=>ye.id===f(v));if(!L)throw new Error("illegal state");return L},T=async()=>{const F=await O();await F.saveDeckInfo({...F,name:f(C).name,cardNames:f(C).cardInfos.map(L=>L.name),lastUsedAt:new Date}),m()},D=async()=>{(await xt.createNewDeck(`デッキ_${new Date().formatToYYYYMMDD_HHMMSS("","","")}`,`コピー日時：${new Date().formatToYYYYMMDD_HHMMSS("-"," ",":")}`,f(C).cardInfos.map(L=>L.name))).saveDeckInfo(),m()},q=async F=>{const L=await O();!F.shiftKey&&!confirm(`デッキ【${L.name}】を削除します。
よろしいですか？`)||(await L.delete(),m())};ft();var M=Dv(),X=_(g(M),2),Z=g(X),Y=g(Z),Se=g(Y),qe=_(g(Se),2),J=g(qe),B=_(Se,2),G=_(g(B),2),le=g(G),A=_(B,2),U=_(g(A),2);ue(U,5,()=>ir.filter(F=>F!=="XyzMaterial"),ce,(F,L)=>{var ye=pv(),oe=g(ye),be,He=_(oe);x(()=>{be!==(be=f(L))&&(oe.value=(oe.__value=f(L))==null?"":f(L)),E(He,` ${Wn[f(L)]??""}`)}),hi(t,[],oe,()=>(f(L),f(S).cardKinds),je=>Ue(S,f(S).cardKinds=je)),b(F,ye)});var re=_(A,2),j=_(g(re),2);ue(j,5,()=>Yr,ce,(F,L)=>{var ye=hv(),oe=g(ye),be,He=_(oe);x(()=>{be!==(be=f(L))&&(oe.value=(oe.__value=f(L))==null?"":f(L)),E(He,` ${Wi[f(L)]??""}${Oa[f(L)]??""}`)}),hi(a,[],oe,()=>(f(L),f(S).monsterCategories),je=>Ue(S,f(S).monsterCategories=je)),b(F,ye)});var z=_(re,2),W=_(g(z),2);ue(W,5,()=>Qr,ce,(F,L)=>{var ye=gv(),oe=g(ye),be,He=_(oe,2),je=_(He);x(()=>{be!==(be=f(L))&&(oe.value=(oe.__value=f(L))==null?"":f(L)),me(He,`monster_attr ${f(L)??""} svelte-b5thz2`),E(je,` ${Dr[f(L)]??""}`)}),hi(r,[],oe,()=>(f(L),f(S).monsterAttributes),pt=>Ue(S,f(S).monsterAttributes=pt)),b(F,ye)});var R=_(z,2),V=_(g(R),2);ue(V,5,()=>Kr,ce,(F,L)=>{var ye=yv(),oe=g(ye),be,He=_(oe);x(()=>{be!==(be=f(L))&&(oe.value=(oe.__value=f(L))==null?"":f(L)),E(He,` ${Ki[f(L)]??""}
                ${La[f(L)]??""}`)}),hi(n,[],oe,()=>(f(L),f(S).monsterTypes),je=>Ue(S,f(S).monsterTypes=je)),b(F,ye)});var Q=_(R,2),I=_(g(Q),2);ue(I,5,()=>Xr,ce,(F,L)=>{var ye=mv(),oe=g(ye),be,He=_(oe);x(()=>{be!==(be=f(L))&&(oe.value=(oe.__value=f(L))==null?"":f(L)),E(He,` ${Yi[f(L)]??""}`)}),hi(s,[],oe,()=>(f(L),f(S).spellCategories),je=>Ue(S,f(S).spellCategories=je)),b(F,ye)});var ee=_(Q,2),ne=_(g(ee),2);ue(ne,5,()=>Jr,ce,(F,L)=>{var ye=_v(),oe=g(ye),be,He=_(oe);x(()=>{be!==(be=f(L))&&(oe.value=(oe.__value=f(L))==null?"":f(L)),E(He,` ${Qi[f(L)]??""}`)}),hi(o,[],oe,()=>(f(L),f(S).trapCategories),je=>Ue(S,f(S).trapCategories=je)),b(F,ye)});var ie=_(ee,2),ae=_(g(ie),2),N=g(ae),$=g(N),de=_(Y,2);dv(de,{get cardInfo(){return f(y)}});var te=_(Z,2),fe=g(te);const Pe=Ce(k);cn(fe,{mode:"List",get allCardInfos(){return f(Pe)},onAttention:P,get deckCardInfos(){return f(C).cardInfos},set deckCardInfos(F){Ue(C,f(C).cardInfos=F)},$$legacy:!0});var Ze=_(te,2),Re=g(Ze);Li(Re,()=>f(p),F=>{var L=Ev();b(F,L)},(F,L)=>{var ye=kv(),oe=se(ye),be=g(oe),He=g(be),je=_(g(He));x(()=>{f(v),na(()=>{f(L)})}),ue(je,5,()=>f(L),ce,(tt,ht)=>{var Dt=Sv(),di={},Ha=g(Dt);x(()=>{di!==(di=f(ht).id)&&(Dt.value=(Dt.__value=f(ht).id)==null?"":f(ht).id),E(Ha,f(ht).name)}),b(tt,Dt)});var pt=_(He,4),ot=_(g(pt)),xe=_(be,4),Ae=_(g(xe),2),we=g(Ae),Ve=_(Ae,4),ut=g(Ve),Fi=_(Ve,2),wt=g(Fi),ds=_(xe,2),Fr=_(g(ds),2);Li(Fr,O,tt=>{var ht=bv();b(tt,ht)},(tt,ht)=>{var Dt=Cv(),di=g(Dt);x(Ha=>Nt(di,"href",Ha),[()=>xt.convertToObjectURL([f(ht)])],Ce),b(tt,Dt)});var vs=_(Fr,2);Li(vs,()=>f(h),tt=>{var ht=Tv();b(tt,ht)},(tt,ht)=>{var Dt=wv(),di=g(Dt);x(()=>Nt(di,"href",f(ht))),b(tt,Dt)});var fs=_(oe,2);cn(fs,{mode:"Deck",allCardInfos:[],onAttention:P,get deckCardInfos(){return f(C).cardInfos},set deckCardInfos(tt){Ue(C,f(C).cardInfos=tt)},$$legacy:!0}),sa(je,()=>f(v),tt=>K(v,tt)),ze("change",je,l),er(ot,()=>f(C).name,tt=>Ue(C,f(C).name=tt)),ze("click",we,T),ze("click",ut,D),ze("click",wt,q),b(F,ye)}),ze("click",J,d),er(le,()=>f(S).name,F=>Ue(S,f(S).name=F)),Nl($,()=>f(S).isForTest,F=>Ue(S,f(S).isForTest=F)),b(i,M),et()}const Av="2025-04-18 21:30:55",Mv={timestamp:Av},Pv=["TblDeckHeader","TblDeckDetail","TblDuelistProfile"],Bv=3;var Fv=w("<option> </option>"),Ov=w("<option> </option>"),Lv=w("<option> </option>"),qv=w('<div class="svelte-1vi4vvn"><label for="deck_selector" class="deck_selector svelte-1vi4vvn">デッキ：</label> <select id="deck_selector" class="deck_selector svelte-1vi4vvn"></select></div> <div class="svelte-1vi4vvn"><label for="npc_selector" class="npc_selector svelte-1vi4vvn">対戦相手：</label> <select id="npc_selector" class="npc_selector svelte-1vi4vvn"></select> <div> </div></div> <div class="svelte-1vi4vvn"><label for="npc_selector" class="npc_selector svelte-1vi4vvn">先攻後攻：</label> <select id="npc_selector" class="npc_selector svelte-1vi4vvn"></select></div> <div class="svelte-1vi4vvn"><button class="btn svelte-1vi4vvn">duel start!</button></div>',1),Nv=w('<div class="svelte-1vi4vvn">デッキ情報の読み込み、もしくは作成中...</div>'),Rv=w('<div class="svelte-1vi4vvn"><label for="duelist_name" class="duelist_name svelte-1vi4vvn">名前：</label> <input id="duelist_name" class="duelist_name svelte-1vi4vvn" type="text"></div> <!> <div class="svelte-1vi4vvn"><button class="btn svelte-1vi4vvn">deck edit</button></div>',1),Hv=w('<div class="svelte-1vi4vvn">デュエリスト情報の読み込み、もしくは作成中...</div>'),$v=w('<div class="app_body svelte-1vi4vvn"><!></div>'),Zv=w('<main class="svelte-1vi4vvn"><div class="link link_left svelte-1vi4vvn"><a href="https://github.com/Setta238/stk_ygo_svelte" target="_blank" rel="noopener noreferrer" title="repository" class="svelte-1vi4vvn">repository</a> <a href="https://x.com/ninja_no" target="_blank" rel="noopener noreferrer" title="repository" class="svelte-1vi4vvn">X(Twitter)</a> <a href="https://posfie.com/@ninja_no/p/Lx7FLj3" target="_blank" rel="noopener noreferrer" title="posfie" class="svelte-1vi4vvn">posfie(toggeter)</a></div> <div class="link link_right svelte-1vi4vvn"><a href="/stk_ygo_svelte/note.html" target="_blank" rel="noopener noreferrer" title="repository" class="svelte-1vi4vvn">現時点とこの先のこと</a></div> <!> <div class="debug_info svelte-1vi4vvn"><span> </span> <span class="screen_info"></span></div></main>');function jv(i,e){Ie(e,!1);const t=new Yl("stk_ygo_svelte",Bv,Pv);let a=$e(),r=$e("None"),n=$e(0);const s=rr.getOrCreateNew(t);let o=$e(xt.getAllDeckInfo(t).then(D=>(Promise.all(D.filter(q=>!q.lastUsedAt).map(q=>{q.saveDeckInfo()})),K(n,(D.find(q=>q.lastUsedAt.getTime()===Math.max(...D.map(M=>M.lastUsedAt.getTime())))??D[0]).id),D)));const d=async()=>{let D=(await f(o)).find(q=>q.id===f(n));if(D||(D=(await c()).find(q=>q.id===f(n))),!D)throw new Error("illegal state");return D},l=async()=>{const D=await s;console.log(D),D.save()},c=()=>(K(o,xt.getAllDeckInfo(t).then(D=>(K(n,(D.find(q=>q.lastUsedAt.getTime()===Math.max(...D.map(M=>M.lastUsedAt.getTime())))??D[0]).id),D))),f(o)),v=async()=>{(await f(o)).length||(await xt.prepareSampleDeck(),c())},p=async()=>{await Promise.all([l(),v()]);const D=await d(),q=await s;D.updateTimestamp();const M=Ri.find(Z=>Z.id===q.previousNpcId);let X=sn.slice(-1)[0];M&&(M.id===-1&&(X=sn.find(Z=>Z.id===-1)??X),console.log(M),K(a,new ac(q,"Player",await d(),[],M,"NPC",X,[],q.previousStartMode)))},h=async()=>{await Promise.all([l(),v()]),K(r,"DeckEdit")},m=async D=>{await l(),D.key==="Enter"&&!D.repeat&&(await s).save()};v(),ft();var C=Zv(),y=_(g(C),4);{var S=D=>{Yd(D,{get duel(){return f(a)}})},k=D=>{var q=Ne(),M=se(q);{var X=Y=>{xv(Y,{})},Z=Y=>{var Se=$v(),qe=g(Se);Li(qe,()=>s,J=>{var B=Hv();b(J,B)},(J,B)=>{var G=Rv(),le=se(G),A=_(g(le),2),U=_(le,2);Li(U,()=>f(o),z=>{var W=Nv();b(z,W)},(z,W)=>{var R=qv(),V=se(R),Q=_(g(V),2);x(()=>{f(n),na(()=>{f(W)})}),ue(Q,5,()=>f(W),ce,(te,fe)=>{var Pe=Fv(),Ze={},Re=g(Pe);x(()=>{Ze!==(Ze=f(fe).id)&&(Pe.value=(Pe.__value=f(fe).id)==null?"":f(fe).id),E(Re,f(fe).name)}),b(te,Pe)});var I=_(V,2),ee=_(g(I),2);x(()=>{f(B),na(()=>{})}),ue(ee,5,()=>Ri,ce,(te,fe)=>{var Pe=Ov(),Ze={},Re=g(Pe);x(()=>{Ze!==(Ze=f(fe).id)&&(Pe.value=(Pe.__value=f(fe).id)==null?"":f(fe).id),E(Re,f(fe).name)}),b(te,Pe)});var ne=_(ee,2),ie=g(ne),ae=_(I,2),N=_(g(ae),2);x(()=>{f(B),na(()=>{})}),ue(N,5,()=>es(nn),ce,(te,fe)=>{var Pe=Lv(),Ze={},Re=g(Pe);x(()=>{Ze!==(Ze=f(fe))&&(Pe.value=(Pe.__value=f(fe))==null?"":f(fe)),E(Re,nn[f(fe)])}),b(te,Pe)});var $=_(ae,2),de=g($);x(te=>E(ie,`※${te??""}`),[()=>{var te;return(te=Ri.find(fe=>fe.id===f(B).previousNpcId))==null?void 0:te.description}],Ce),sa(Q,()=>f(n),te=>K(n,te)),sa(ee,()=>f(B).previousNpcId,te=>f(B).previousNpcId=te),sa(N,()=>f(B).previousStartMode,te=>f(B).previousStartMode=te),ze("click",de,p),b(z,R)});var re=_(U,2),j=g(re);er(A,()=>f(B).name,z=>f(B).name=z),ze("keypress",A,m),ze("click",j,h),b(J,G)}),b(Y,Se)};H(M,Y=>{f(r)==="DeckEdit"?Y(X):Y(Z,!1)},!0)}b(D,q)};H(y,D=>{f(a)?D(S):D(k,!1)})}var P=_(y,2),O=g(P),T=g(O);x(()=>E(T,`build at: ${Mv.timestamp}`)),b(i,C),et()}wl(jv,{target:document.getElementById("app")});
