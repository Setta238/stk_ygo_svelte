var ha=Object.defineProperty;var ya=(r,e,t)=>e in r?ha(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var c=(r,e,t)=>ya(r,typeof e!="symbol"?e+"":e,t);import{j as ga}from"./cardInfo.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();const si=!1;var bi=Array.isArray,ma=Array.prototype.indexOf,Ci=Array.from,_n=Object.defineProperty,Ut=Object.getOwnPropertyDescriptor,Sn=Object.getOwnPropertyDescriptors,_a=Object.prototype,Sa=Array.prototype,Di=Object.getPrototypeOf;function wa(r){return typeof r=="function"}const Ie=()=>{};function Ta(r){return typeof(r==null?void 0:r.then)=="function"}function ka(r){return r()}function li(r){for(var e=0;e<r.length;e++)r[e]()}const Ke=2,wn=4,$r=8,Ur=16,vt=32,lr=64,Er=128,ze=256,Ar=512,Ue=1024,pt=2048,zt=4096,dt=8192,Zr=16384,Tn=32768,jr=65536,kn=1<<17,ba=1<<19,bn=1<<20,ut=Symbol("$state"),Ca=Symbol("legacy props"),Da=Symbol("");function Cn(r){return r===this.v}function Dn(r,e){return r!=r?e==e:r!==e||r!==null&&typeof r=="object"||typeof r=="function"}function Ei(r){return!Dn(r,this.v)}function Ea(r){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Aa(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function xa(r){throw new Error("https://svelte.dev/e/effect_orphan")}function Ma(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Pa(r){throw new Error("https://svelte.dev/e/props_invalid_value")}function Fa(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function qa(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Oa(){throw new Error("https://svelte.dev/e/state_unsafe_local_read")}function Ba(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let or=!1,Ra=!1;function Na(){or=!0}const Ai=1,xi=2,En=4,La=8,Ha=16,$a=1,Ua=2,Za=4,ja=8,Ga=16,Va=1,Ya=2,Wa=4,za=1,Ka=2,Be=Symbol();let xe=null;function xr(r){xe=r}function Re(r,e=!1,t){xe={p:xe,c:null,e:null,m:!1,s:r,x:null,l:null},or&&!e&&(xe.l={s:null,u:null,r1:[],r2:Le(!1)})}function Ne(r){const e=xe;if(e!==null){const s=e.e;if(s!==null){var t=ye,i=me;e.e=null;try{for(var n=0;n<s.length;n++){var a=s[n];Je(a.effect),Qe(a.reaction),Jt(a.fn)}}finally{Je(t),Qe(i)}}xe=e.p,e.m=!0}return{}}function Kt(){return!or||xe!==null&&xe.l===null}function Le(r,e){var t={f:0,v:r,reactions:null,equals:Cn,rv:0,wv:0};return t}function Qa(r){return An(Le(r))}function Gt(r,e=!1){var i;const t=Le(r);return e||(t.equals=Ei),or&&xe!==null&&xe.l!==null&&((i=xe.l).s??(i.s=[])).push(t),t}function De(r,e=!1){return An(Gt(r,e))}function An(r){return me!==null&&!rt&&me.f&Ke&&(it===null?ls([r]):it.push(r)),r}function Ze(r,e){return ie(r,et(()=>v(r))),e}function ie(r,e){return me!==null&&!rt&&Kt()&&me.f&(Ke|Ur)&&(it===null||!it.includes(r))&&Ba(),_t(r,e)}function _t(r,e){return r.equals(e)||(r.v,r.v=e,r.wv=Yn(),xn(r,pt),Kt()&&ye!==null&&ye.f&Ue&&!(ye.f&(vt|lr))&&(lt===null?os([r]):lt.push(r))),e}function xn(r,e){var t=r.reactions;if(t!==null)for(var i=Kt(),n=t.length,a=0;a<n;a++){var s=t[a],l=s.f;l&pt||!i&&s===ye||(nt(s,e),l&(Ue|ze)&&(l&Ke?xn(s,zt):zr(s)))}}let Mn=!1;function yt(r,e=null,t){if(typeof r!="object"||r===null||ut in r)return r;const i=Di(r);if(i!==_a&&i!==Sa)return r;var n=new Map,a=bi(r),s=Le(0);a&&n.set("length",Le(r.length));var l;return new Proxy(r,{defineProperty(f,u,d){(!("value"in d)||d.configurable===!1||d.enumerable===!1||d.writable===!1)&&Fa();var y=n.get(u);return y===void 0?(y=Le(d.value),n.set(u,y)):ie(y,yt(d.value,l)),!0},deleteProperty(f,u){var d=n.get(u);if(d===void 0)u in f&&n.set(u,Le(Be));else{if(a&&typeof u=="string"){var y=n.get("length"),h=Number(u);Number.isInteger(h)&&h<y.v&&ie(y,h)}ie(d,Be),ji(s)}return!0},get(f,u,d){var p;if(u===ut)return r;var y=n.get(u),h=u in f;if(y===void 0&&(!h||(p=Ut(f,u))!=null&&p.writable)&&(y=Le(yt(h?f[u]:Be,l)),n.set(u,y)),y!==void 0){var o=v(y);return o===Be?void 0:o}return Reflect.get(f,u,d)},getOwnPropertyDescriptor(f,u){var d=Reflect.getOwnPropertyDescriptor(f,u);if(d&&"value"in d){var y=n.get(u);y&&(d.value=v(y))}else if(d===void 0){var h=n.get(u),o=h==null?void 0:h.v;if(h!==void 0&&o!==Be)return{enumerable:!0,configurable:!0,value:o,writable:!0}}return d},has(f,u){var o;if(u===ut)return!0;var d=n.get(u),y=d!==void 0&&d.v!==Be||Reflect.has(f,u);if(d!==void 0||ye!==null&&(!y||(o=Ut(f,u))!=null&&o.writable)){d===void 0&&(d=Le(y?yt(f[u],l):Be),n.set(u,d));var h=v(d);if(h===Be)return!1}return y},set(f,u,d,y){var F;var h=n.get(u),o=u in f;if(a&&u==="length")for(var p=d;p<h.v;p+=1){var m=n.get(p+"");m!==void 0?ie(m,Be):p in f&&(m=Le(Be),n.set(p+"",m))}h===void 0?(!o||(F=Ut(f,u))!=null&&F.writable)&&(h=Le(void 0),ie(h,yt(d,l)),n.set(u,h)):(o=h.v!==Be,ie(h,yt(d,l)));var _=Reflect.getOwnPropertyDescriptor(f,u);if(_!=null&&_.set&&_.set.call(y,d),!o){if(a&&typeof u=="string"){var k=n.get("length"),w=Number(u);Number.isInteger(w)&&w>=k.v&&ie(k,w+1)}ji(s)}return!0},ownKeys(f){v(s);var u=Reflect.ownKeys(f).filter(h=>{var o=n.get(h);return o===void 0||o.v!==Be});for(var[d,y]of n)y.v!==Be&&!(d in f)&&u.push(d);return u},setPrototypeOf(){qa()}})}function ji(r,e=1){ie(r,r.v+e)}function Gi(r){return r!==null&&typeof r=="object"&&ut in r?r[ut]:r}function Pn(r,e){return Object.is(Gi(r),Gi(e))}var Vi,Fn,qn,On;function Ja(){if(Vi===void 0){Vi=window,Fn=/Firefox/.test(navigator.userAgent);var r=Element.prototype,e=Node.prototype;qn=Ut(e,"firstChild").get,On=Ut(e,"nextSibling").get,r.__click=void 0,r.__className="",r.__attributes=null,r.__styles=null,r.__e=void 0,Text.prototype.__t=void 0}}function Gr(r=""){return document.createTextNode(r)}function Mr(r){return qn.call(r)}function Vr(r){return On.call(r)}function g(r,e){return Mr(r)}function ne(r,e){{var t=Mr(r);return t instanceof Comment&&t.data===""?Vr(t):t}}function S(r,e=1,t=!1){let i=r;for(;e--;)i=Vr(i);return i}function Xa(r){r.textContent=""}function At(r){var e=Ke|pt,t=me!==null&&me.f&Ke?me:null;return ye===null||t!==null&&t.f&ze?e|=ze:ye.f|=bn,{ctx:xe,deps:null,effects:null,equals:Cn,f:e,fn:r,reactions:null,rv:0,v:null,wv:0,parent:t??ye}}function _e(r){const e=At(r);return e.equals=Ei,e}function Bn(r){var e=r.effects;if(e!==null){r.effects=null;for(var t=0;t<e.length;t+=1)St(e[t])}}function Ia(r){for(var e=r.parent;e!==null;){if(!(e.f&Ke))return e;e=e.parent}return null}function es(r){var e,t=ye;Je(Ia(r));try{Bn(r),e=zn(r)}finally{Je(t)}return e}function Rn(r){var e=es(r),t=(mt||r.f&ze)&&r.deps!==null?zt:Ue;nt(r,t),r.equals(e)||(r.v=e,r.wv=Yn())}function Nn(r){ye===null&&me===null&&xa(),me!==null&&me.f&ze&&ye===null&&Aa(),Fi&&Ea()}function ts(r,e){var t=e.last;t===null?e.last=e.first=r:(t.next=r,r.prev=t,e.last=r)}function Qt(r,e,t,i=!0){var n=(r&lr)!==0,a=ye,s={ctx:xe,deps:null,nodes_start:null,nodes_end:null,f:r|pt,first:null,fn:e,last:null,next:null,parent:n?null:a,prev:null,teardown:null,transitions:null,wv:0};if(t){var l=Zt;try{Wi(!0),qi(s),s.f|=Tn}catch(d){throw St(s),d}finally{Wi(l)}}else e!==null&&zr(s);var f=t&&s.deps===null&&s.first===null&&s.nodes_start===null&&s.teardown===null&&(s.f&(bn|Er))===0;if(!f&&!n&&i&&(a!==null&&ts(s,a),me!==null&&me.f&Ke)){var u=me;(u.effects??(u.effects=[])).push(s)}return s}function Mi(r){const e=Qt($r,null,!1);return nt(e,Ue),e.teardown=r,e}function Yi(r){Nn();var e=ye!==null&&(ye.f&vt)!==0&&xe!==null&&!xe.m;if(e){var t=xe;(t.e??(t.e=[])).push({fn:r,effect:ye,reaction:me})}else{var i=Jt(r);return i}}function rs(r){return Nn(),cr(r)}function is(r){const e=Qt(lr,r,!0);return(t={})=>new Promise(i=>{t.outro?bt(e,()=>{St(e),i(void 0)}):(St(e),i(void 0))})}function Jt(r){return Qt(wn,r,!1)}function cr(r){return Qt($r,r,!0)}function O(r,e=[],t=At){const i=e.map(t);return Yr(()=>r(...i.map(v)))}function Yr(r,e=0){return Qt($r|Ur|e,r,!0)}function xt(r,e=!0){return Qt($r|vt,r,!0,e)}function Ln(r){var e=r.teardown;if(e!==null){const t=Fi,i=me;zi(!0),Qe(null);try{e.call(null)}finally{zi(t),Qe(i)}}}function Hn(r,e=!1){var t=r.first;for(r.first=r.last=null;t!==null;){var i=t.next;St(t,e),t=i}}function ns(r){for(var e=r.first;e!==null;){var t=e.next;e.f&vt||St(e),e=t}}function St(r,e=!0){var t=!1;if((e||r.f&ba)&&r.nodes_start!==null){for(var i=r.nodes_start,n=r.nodes_end;i!==null;){var a=i===n?null:Vr(i);i.remove(),i=a}t=!0}Hn(r,e&&!t),qr(r,0),nt(r,Zr);var s=r.transitions;if(s!==null)for(const f of s)f.stop();Ln(r);var l=r.parent;l!==null&&l.first!==null&&$n(r),r.next=r.prev=r.teardown=r.ctx=r.deps=r.fn=r.nodes_start=r.nodes_end=null}function $n(r){var e=r.parent,t=r.prev,i=r.next;t!==null&&(t.next=i),i!==null&&(i.prev=t),e!==null&&(e.first===r&&(e.first=i),e.last===r&&(e.last=t))}function bt(r,e){var t=[];Pi(r,t,!0),Un(t,()=>{St(r),e&&e()})}function Un(r,e){var t=r.length;if(t>0){var i=()=>--t||e();for(var n of r)n.out(i)}else e()}function Pi(r,e,t){if(!(r.f&dt)){if(r.f^=dt,r.transitions!==null)for(const s of r.transitions)(s.is_global||t)&&e.push(s);for(var i=r.first;i!==null;){var n=i.next,a=(i.f&jr)!==0||(i.f&vt)!==0;Pi(i,e,a?t:!1),i=n}}}function Vt(r){Zn(r,!0)}function Zn(r,e){if(r.f&dt){r.f^=dt,r.f&Ue||(r.f^=Ue),dr(r)&&(nt(r,pt),zr(r));for(var t=r.first;t!==null;){var i=t.next,n=(t.f&jr)!==0||(t.f&vt)!==0;Zn(t,n?e:!1),t=i}if(r.transitions!==null)for(const a of r.transitions)(a.is_global||e)&&a.in()}}let Pr=!1,oi=[];function jn(){Pr=!1;const r=oi.slice();oi=[],li(r)}function Mt(r){Pr||(Pr=!0,queueMicrotask(jn)),oi.push(r)}function as(){Pr&&jn()}const Gn=0,ss=1;let kr=!1,br=Gn,rr=!1,ir=null,Zt=!1,Fi=!1;function Wi(r){Zt=r}function zi(r){Fi=r}let kt=[],jt=0;let me=null,rt=!1;function Qe(r){me=r}let ye=null;function Je(r){ye=r}let it=null;function ls(r){it=r}let He=null,Ve=0,lt=null;function os(r){lt=r}let Vn=1,Fr=0,mt=!1,gt=null;function Yn(){return++Vn}function dr(r){var y;var e=r.f;if(e&pt)return!0;if(e&zt){var t=r.deps,i=(e&ze)!==0;if(t!==null){var n,a,s=(e&Ar)!==0,l=i&&ye!==null&&!mt,f=t.length;if(s||l){var u=r,d=u.parent;for(n=0;n<f;n++)a=t[n],(s||!((y=a==null?void 0:a.reactions)!=null&&y.includes(u)))&&(a.reactions??(a.reactions=[])).push(u);s&&(u.f^=Ar),l&&d!==null&&!(d.f&ze)&&(u.f^=ze)}for(n=0;n<f;n++)if(a=t[n],dr(a)&&Rn(a),a.wv>r.wv)return!0}(!i||ye!==null&&!mt)&&nt(r,Ue)}return!1}function cs(r,e){for(var t=e;t!==null;){if(t.f&Er)try{t.fn(r);return}catch{t.f^=Er}t=t.parent}throw kr=!1,r}function ds(r){return(r.f&Zr)===0&&(r.parent===null||(r.parent.f&Er)===0)}function Wr(r,e,t,i){if(kr){if(t===null&&(kr=!1),ds(e))throw r;return}t!==null&&(kr=!0);{cs(r,e);return}}function Wn(r,e,t=!0){var i=r.reactions;if(i!==null)for(var n=0;n<i.length;n++){var a=i[n];a.f&Ke?Wn(a,e,!1):e===a&&(t?nt(a,pt):a.f&Ue&&nt(a,zt),zr(a))}}function zn(r){var o;var e=He,t=Ve,i=lt,n=me,a=mt,s=it,l=xe,f=rt,u=r.f;He=null,Ve=0,lt=null,me=u&(vt|lr)?null:r,mt=(u&ze)!==0&&(!Zt||n===null||f),it=null,xr(r.ctx),rt=!1,Fr++;try{var d=(0,r.fn)(),y=r.deps;if(He!==null){var h;if(qr(r,Ve),y!==null&&Ve>0)for(y.length=Ve+He.length,h=0;h<He.length;h++)y[Ve+h]=He[h];else r.deps=y=He;if(!mt)for(h=Ve;h<y.length;h++)((o=y[h]).reactions??(o.reactions=[])).push(r)}else y!==null&&Ve<y.length&&(qr(r,Ve),y.length=Ve);if(Kt()&&lt!==null&&!rt&&y!==null&&!(r.f&(Ke|zt|pt)))for(h=0;h<lt.length;h++)Wn(lt[h],r);return n!==null&&Fr++,d}finally{He=e,Ve=t,lt=i,me=n,mt=a,it=s,xr(l),rt=f}}function us(r,e){let t=e.reactions;if(t!==null){var i=ma.call(t,r);if(i!==-1){var n=t.length-1;n===0?t=e.reactions=null:(t[i]=t[n],t.pop())}}t===null&&e.f&Ke&&(He===null||!He.includes(e))&&(nt(e,zt),e.f&(ze|Ar)||(e.f^=Ar),Bn(e),qr(e,0))}function qr(r,e){var t=r.deps;if(t!==null)for(var i=e;i<t.length;i++)us(r,t[i])}function qi(r){var e=r.f;if(!(e&Zr)){nt(r,Ue);var t=ye,i=xe;ye=r;try{e&Ur?ns(r):Hn(r),Ln(r);var n=zn(r);r.teardown=typeof n=="function"?n:null,r.wv=Vn;var a=r.deps,s;si&&Ra&&r.f&pt}catch(l){Wr(l,r,t,i||r.ctx)}finally{ye=t}}}function Kn(){if(jt>1e3){jt=0;try{Ma()}catch(r){if(ir!==null)Wr(r,ir,null);else throw r}}jt++}function Qn(r){var e=r.length;if(e!==0){Kn();var t=Zt;Zt=!0;try{for(var i=0;i<e;i++){var n=r[i];n.f&Ue||(n.f^=Ue);var a=ps(n);fs(a)}}finally{Zt=t}}}function fs(r){var e=r.length;if(e!==0)for(var t=0;t<e;t++){var i=r[t];if(!(i.f&(Zr|dt)))try{dr(i)&&(qi(i),i.deps===null&&i.first===null&&i.nodes_start===null&&(i.teardown===null?$n(i):i.fn=null))}catch(n){Wr(n,i,null,i.ctx)}}}function vs(){if(rr=!1,jt>1001)return;const r=kt;kt=[],Qn(r),rr||(jt=0,ir=null)}function zr(r){br===Gn&&(rr||(rr=!0,queueMicrotask(vs))),ir=r;for(var e=r;e.parent!==null;){e=e.parent;var t=e.f;if(t&(lr|vt)){if(!(t&Ue))return;e.f^=Ue}}kt.push(e)}function ps(r){var e=[],t=r.first;e:for(;t!==null;){var i=t.f,n=(i&vt)!==0,a=n&&(i&Ue)!==0,s=t.next;if(!a&&!(i&dt)){if(i&wn)e.push(t);else if(n)t.f^=Ue;else{var l=me;try{me=t,dr(t)&&qi(t)}catch(d){Wr(d,t,null,t.ctx)}finally{me=l}}var f=t.first;if(f!==null){t=f;continue}}if(s===null){let d=t.parent;for(;d!==null;){if(r===d)break e;var u=d.next;if(u!==null){t=u;continue e}d=d.parent}}t=s}return e}function Oi(r){var e=br,t=kt;try{Kn();const n=[];br=ss,kt=n,rr=!1,Qn(t);var i=r==null?void 0:r();return as(),(kt.length>0||n.length>0)&&Oi(),jt=0,ir=null,i}finally{br=e,kt=t}}async function hs(){await Promise.resolve(),Oi()}function v(r){var e=r.f,t=(e&Ke)!==0;if(gt!==null&&gt.add(r),me!==null&&!rt){it!==null&&it.includes(r)&&Oa();var i=me.deps;r.rv<Fr&&(r.rv=Fr,He===null&&i!==null&&i[Ve]===r?Ve++:He===null?He=[r]:(!mt||!He.includes(r))&&He.push(r))}else if(t&&r.deps===null&&r.effects===null){var n=r,a=n.parent;a!==null&&!(a.f&ze)&&(n.f^=ze)}return t&&(n=r,dr(n)&&Rn(n)),r.v}function ys(r){var e=gt;gt=new Set;var t=gt,i;try{if(et(r),e!==null)for(i of gt)e.add(i)}finally{gt=e}return t}function Jn(r){var e=ys(()=>et(r));for(var t of e)if(t.f&kn)for(const i of t.deps||[])i.f&Ke||_t(i,i.v);else _t(t,t.v)}function et(r){var e=rt;try{return rt=!0,r()}finally{rt=e}}const gs=-7169;function nt(r,e){r.f=r.f&gs|e}function ms(r){if(!(typeof r!="object"||!r||r instanceof EventTarget)){if(ut in r)ci(r);else if(!Array.isArray(r))for(let e in r){const t=r[e];typeof t=="object"&&t&&ut in t&&ci(t)}}}function ci(r,e=new Set){if(typeof r=="object"&&r!==null&&!(r instanceof EventTarget)&&!e.has(r)){e.add(r),r instanceof Date&&r.getTime();for(let i in r)try{ci(r[i],e)}catch{}const t=Di(r);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const i=Sn(t);for(let n in i){const a=i[n].get;if(a)try{a.call(r)}catch{}}}}}const _s=["touchstart","touchmove"];function Ss(r){return _s.includes(r)}let Ki=!1;function ws(){Ki||(Ki=!0,document.addEventListener("reset",r=>{Promise.resolve().then(()=>{var e;if(!r.defaultPrevented)for(const t of r.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function Bi(r){var e=me,t=ye;Qe(null),Je(null);try{return r()}finally{Qe(e),Je(t)}}function Kr(r,e,t,i=t){r.addEventListener(e,()=>Bi(t));const n=r.__on_r;n?r.__on_r=()=>{n(),i(!0)}:r.__on_r=()=>i(!0),ws()}const Xn=new Set,di=new Set;function Ts(r,e,t,i={}){function n(a){if(i.capture||It.call(e,a),!a.cancelBubble)return Bi(()=>t==null?void 0:t.call(this,a))}return r.startsWith("pointer")||r.startsWith("touch")||r==="wheel"?Mt(()=>{e.addEventListener(r,n,i)}):e.addEventListener(r,n,i),n}function Me(r,e,t,i,n){var a={capture:i,passive:n},s=Ts(r,e,t,a);(e===document.body||e===window||e===document)&&Mi(()=>{e.removeEventListener(r,s,a)})}function ur(r){for(var e=0;e<r.length;e++)Xn.add(r[e]);for(var t of di)t(r)}function It(r){var w;var e=this,t=e.ownerDocument,i=r.type,n=((w=r.composedPath)==null?void 0:w.call(r))||[],a=n[0]||r.target,s=0,l=r.__root;if(l){var f=n.indexOf(l);if(f!==-1&&(e===document||e===window)){r.__root=e;return}var u=n.indexOf(e);if(u===-1)return;f<=u&&(s=f)}if(a=n[s]||r.target,a!==e){_n(r,"currentTarget",{configurable:!0,get(){return a||t}});var d=me,y=ye;Qe(null),Je(null);try{for(var h,o=[];a!==null;){var p=a.assignedSlot||a.parentNode||a.host||null;try{var m=a["__"+i];if(m!==void 0&&!a.disabled)if(bi(m)){var[_,...k]=m;_.apply(a,[r,...k])}else m.call(a,r)}catch(F){h?o.push(F):h=F}if(r.cancelBubble||p===e||p===null)break;a=p}if(h){for(let F of o)queueMicrotask(()=>{throw F});throw h}}finally{r.__root=e,delete r.currentTarget,Qe(d),Je(y)}}}function ks(r){var e=document.createElement("template");return e.innerHTML=r,e.content}function Or(r,e){var t=ye;t.nodes_start===null&&(t.nodes_start=r,t.nodes_end=e)}function D(r,e){var t=(e&za)!==0,i=(e&Ka)!==0,n,a=!r.startsWith("<!>");return()=>{n===void 0&&(n=ks(a?r:"<!>"+r),t||(n=Mr(n)));var s=i||Fn?document.importNode(n,!0):n.cloneNode(!0);if(t){var l=Mr(s),f=s.lastChild;Or(l,f)}else Or(s,s);return s}}function qt(r=""){{var e=Gr(r+"");return Or(e,e),e}}function Te(){var r=document.createDocumentFragment(),e=document.createComment(""),t=Gr();return r.append(e,t),Or(e,t),r}function T(r,e){r!==null&&r.before(e)}let ui=!0;function x(r,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(r.__t??(r.__t=r.nodeValue))&&(r.__t=t,r.nodeValue=t+"")}function bs(r,e){return Cs(r,e)}const Ot=new Map;function Cs(r,{target:e,anchor:t,props:i={},events:n,context:a,intro:s=!0}){Ja();var l=new Set,f=y=>{for(var h=0;h<y.length;h++){var o=y[h];if(!l.has(o)){l.add(o);var p=Ss(o);e.addEventListener(o,It,{passive:p});var m=Ot.get(o);m===void 0?(document.addEventListener(o,It,{passive:p}),Ot.set(o,1)):Ot.set(o,m+1)}}};f(Ci(Xn)),di.add(f);var u=void 0,d=is(()=>{var y=t??e.appendChild(Gr());return xt(()=>{if(a){Re({});var h=xe;h.c=a}n&&(i.$$events=n),ui=s,u=r(y,i)||{},ui=!0,a&&Ne()}),()=>{var p;for(var h of l){e.removeEventListener(h,It);var o=Ot.get(h);--o===0?(document.removeEventListener(h,It),Ot.delete(h)):Ot.set(h,o)}di.delete(f),y!==t&&((p=y.parentNode)==null||p.removeChild(y))}});return Ds.set(u,d),u}let Ds=new WeakMap;const ti=0,_r=1,ri=2;function fi(r,e,t,i,n){var a=r,s=Kt(),l=xe,f=Be,u,d,y,h=(s?Le:Gt)(void 0),o=(s?Le:Gt)(void 0),p=!1;function m(k,w){p=!0,w&&(Je(_),Qe(_),xr(l));try{k===ti&&t&&(u?Vt(u):u=xt(()=>t(a))),k===_r&&i&&(d?Vt(d):d=xt(()=>i(a,h))),k!==ti&&u&&bt(u,()=>u=null),k!==_r&&d&&bt(d,()=>d=null),k!==ri&&y&&bt(y,()=>y=null)}finally{w&&(xr(null),Qe(null),Je(null),Oi())}}var _=Yr(()=>{if(f!==(f=e())){if(Ta(f)){var k=f;p=!1,k.then(w=>{k===f&&(_t(h,w),m(_r,!0))},w=>{if(k===f)throw _t(o,w),m(ri,!0),o.v}),Mt(()=>{p||m(ti,!0)})}else _t(h,f),m(_r,!1);return()=>f=Be}})}function H(r,e,t=!1){var i=r,n=null,a=null,s=Be,l=t?jr:0,f=!1;const u=(y,h=!0)=>{f=!0,d(h,y)},d=(y,h)=>{s!==(s=y)&&(s?(n?Vt(n):h&&(n=xt(()=>h(i))),a&&bt(a,()=>{a=null})):(a?Vt(a):h&&(a=xt(()=>h(i))),n&&bt(n,()=>{n=null})))};Yr(()=>{f=!1,e(u),f||d(null,null)},l)}function fe(r,e){return e}function Es(r,e,t,i){for(var n=[],a=e.length,s=0;s<a;s++)Pi(e[s].e,n,!0);var l=a>0&&n.length===0&&t!==null;if(l){var f=t.parentNode;Xa(f),f.append(t),i.clear(),ht(r,e[0].prev,e[a-1].next)}Un(n,()=>{for(var u=0;u<a;u++){var d=e[u];l||(i.delete(d.k),ht(r,d.prev,d.next)),St(d.e,!l)}})}function ve(r,e,t,i,n,a=null){var s=r,l={flags:e,items:new Map,first:null},f=(e&En)!==0;if(f){var u=r;s=u.appendChild(Gr())}var d=null,y=!1,h=_e(()=>{var o=t();return bi(o)?o:o==null?[]:Ci(o)});Yr(()=>{var o=v(h),p=o.length;y&&p===0||(y=p===0,As(o,l,s,n,e,i,t),a!==null&&(p===0?d?Vt(d):d=xt(()=>a(s)):d!==null&&bt(d,()=>{d=null})),v(h))})}function As(r,e,t,i,n,a,s){var te,b,P,J;var l=(n&La)!==0,f=(n&(Ai|xi))!==0,u=r.length,d=e.items,y=e.first,h=y,o,p=null,m,_=[],k=[],w,F,N,U;if(l)for(U=0;U<u;U+=1)w=r[U],F=a(w,U),N=d.get(F),N!==void 0&&((te=N.a)==null||te.measure(),(m??(m=new Set)).add(N));for(U=0;U<u;U+=1){if(w=r[U],F=a(w,U),N=d.get(F),N===void 0){var M=h?h.e.nodes_start:t;p=Ms(M,e,p,p===null?e.first:p.next,w,F,U,i,n,s),d.set(F,p),_=[],k=[],h=p.next;continue}if(f&&xs(N,w,U,n),N.e.f&dt&&(Vt(N.e),l&&((b=N.a)==null||b.unfix(),(m??(m=new Set)).delete(N))),N!==h){if(o!==void 0&&o.has(N)){if(_.length<k.length){var z=k[0],A;p=z.prev;var Y=_[0],Q=_[_.length-1];for(A=0;A<_.length;A+=1)Qi(_[A],z,t);for(A=0;A<k.length;A+=1)o.delete(k[A]);ht(e,Y.prev,Q.next),ht(e,p,Y),ht(e,Q,z),h=z,p=Q,U-=1,_=[],k=[]}else o.delete(N),Qi(N,h,t),ht(e,N.prev,N.next),ht(e,N,p===null?e.first:p.next),ht(e,p,N),p=N;continue}for(_=[],k=[];h!==null&&h.k!==F;)h.e.f&dt||(o??(o=new Set)).add(h),k.push(h),h=h.next;if(h===null)continue;N=h}_.push(N),p=N,h=N.next}if(h!==null||o!==void 0){for(var ue=o===void 0?[]:Ci(o);h!==null;)h.e.f&dt||ue.push(h),h=h.next;var Se=ue.length;if(Se>0){var Ae=n&En&&u===0?t:null;if(l){for(U=0;U<Se;U+=1)(P=ue[U].a)==null||P.measure();for(U=0;U<Se;U+=1)(J=ue[U].a)==null||J.fix()}Es(e,ue,Ae,d)}}l&&Mt(()=>{var re;if(m!==void 0)for(N of m)(re=N.a)==null||re.apply()}),ye.first=e.first&&e.first.e,ye.last=p&&p.e}function xs(r,e,t,i){i&Ai&&_t(r.v,e),i&xi?_t(r.i,t):r.i=t}function Ms(r,e,t,i,n,a,s,l,f,u){var d=(f&Ai)!==0,y=(f&Ha)===0,h=d?y?Gt(n):Le(n):n,o=f&xi?Le(s):s,p={i:o,v:h,k:a,a:null,e:null,prev:t,next:i};try{return p.e=xt(()=>l(r,h,o,u),Mn),p.e.prev=t&&t.e,p.e.next=i&&i.e,t===null?e.first=p:(t.next=p,t.e.next=p.e),i!==null&&(i.prev=p,i.e.prev=p.e),p}finally{}}function Qi(r,e,t){for(var i=r.next?r.next.e.nodes_start:t,n=e?e.e.nodes_start:t,a=r.e.nodes_start;a!==i;){var s=Vr(a);n.before(a),a=s}}function ht(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function In(r){var e,t,i="";if(typeof r=="string"||typeof r=="number")i+=r;else if(typeof r=="object")if(Array.isArray(r)){var n=r.length;for(e=0;e<n;e++)r[e]&&(t=In(r[e]))&&(i&&(i+=" "),i+=t)}else for(t in r)r[t]&&(i&&(i+=" "),i+=t);return i}function Ps(){for(var r,e,t=0,i="",n=arguments.length;t<n;t++)(r=arguments[t])&&(e=In(r))&&(i&&(i+=" "),i+=e);return i}function Bt(r){return typeof r=="object"?Ps(r):r??""}function Yt(r,e,t,i){var n=r.__attributes??(r.__attributes={});n[e]!==(n[e]=t)&&(e==="style"&&"__styles"in r&&(r.__styles={}),e==="loading"&&(r[Da]=t),t==null?r.removeAttribute(e):typeof t!="string"&&Fs(r).includes(e)?r[e]=t:r.setAttribute(e,t))}var Ji=new Map;function Fs(r){var e=Ji.get(r.nodeName);if(e)return e;Ji.set(r.nodeName,e=[]);for(var t,i=r,n=Element.prototype;n!==i;){t=Sn(i);for(var a in t)t[a].set&&e.push(a);i=Di(i)}return e}function pe(r,e,t){var i=r.__className,n=qs(e,t);(i!==n||Mn)&&(e==null&&!t?r.removeAttribute("class"):r.className=n,r.__className=n)}function qs(r,e){return(r??"")+(e?" "+e:"")}const Os=()=>performance.now(),ct={tick:r=>requestAnimationFrame(r),now:()=>Os(),tasks:new Set};function ea(){const r=ct.now();ct.tasks.forEach(e=>{e.c(r)||(ct.tasks.delete(e),e.f())}),ct.tasks.size!==0&&ct.tick(ea)}function Bs(r){let e;return ct.tasks.size===0&&ct.tick(ea),{promise:new Promise(t=>{ct.tasks.add(e={c:r,f:t})}),abort(){ct.tasks.delete(e)}}}function Sr(r,e){Bi(()=>{r.dispatchEvent(new CustomEvent(e))})}function Rs(r){if(r==="float")return"cssFloat";if(r==="offset")return"cssOffset";if(r.startsWith("--"))return r;const e=r.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function Xi(r){const e={},t=r.split(";");for(const i of t){const[n,a]=i.split(":");if(!n||a===void 0)break;const s=Rs(n.trim());e[s]=a.trim()}return e}const Ns=r=>r;function Rt(r,e,t,i){var n=(r&Va)!==0,a=(r&Ya)!==0,s=n&&a,l=(r&Wa)!==0,f=s?"both":n?"in":"out",u,d=e.inert,y=e.style.overflow,h,o;function p(){var F=me,N=ye;Qe(null),Je(null);try{return u??(u=t()(e,(i==null?void 0:i())??{},{direction:f}))}finally{Qe(F),Je(N)}}var m={is_global:l,in(){var F;if(e.inert=d,!n){o==null||o.abort(),(F=o==null?void 0:o.reset)==null||F.call(o);return}a||h==null||h.abort(),Sr(e,"introstart"),h=vi(e,p(),o,1,()=>{Sr(e,"introend"),h==null||h.abort(),h=u=void 0,e.style.overflow=y})},out(F){if(!a){F==null||F(),u=void 0;return}e.inert=!0,Sr(e,"outrostart"),o=vi(e,p(),h,0,()=>{Sr(e,"outroend"),F==null||F()})},stop:()=>{h==null||h.abort(),o==null||o.abort()}},_=ye;if((_.transitions??(_.transitions=[])).push(m),n&&ui){var k=l;if(!k){for(var w=_.parent;w&&w.f&jr;)for(;(w=w.parent)&&!(w.f&Ur););k=!w||(w.f&Tn)!==0}k&&Jt(()=>{et(()=>m.in())})}}function vi(r,e,t,i,n){var a=i===1;if(wa(e)){var s,l=!1;return Mt(()=>{if(!l){var _=e({direction:a?"in":"out"});s=vi(r,_,t,i,n)}}),{abort:()=>{l=!0,s==null||s.abort()},deactivate:()=>s.deactivate(),reset:()=>s.reset(),t:()=>s.t()}}if(t==null||t.deactivate(),!(e!=null&&e.duration))return n(),{abort:Ie,deactivate:Ie,reset:Ie,t:()=>i};const{delay:f=0,css:u,tick:d,easing:y=Ns}=e;var h=[];if(a&&t===void 0&&(d&&d(0,1),u)){var o=Xi(u(0,1));h.push(o,o)}var p=()=>1-i,m=r.animate(h,{duration:f});return m.onfinish=()=>{var _=(t==null?void 0:t.t())??1-i;t==null||t.abort();var k=i-_,w=e.duration*Math.abs(k),F=[];if(w>0){var N=!1;if(u)for(var U=Math.ceil(w/16.666666666666668),M=0;M<=U;M+=1){var z=_+k*y(M/U),A=Xi(u(z,1-z));F.push(A),N||(N=A.overflow==="hidden")}N&&(r.style.overflow="hidden"),p=()=>{var Y=m.currentTime;return _+k*y(Y/w)},d&&Bs(()=>{if(m.playState!=="running")return!1;var Y=p();return d(Y,1-Y),!0})}m=r.animate(F,{duration:w,fill:"forwards"}),m.onfinish=()=>{p=()=>i,d==null||d(i,1-i),n()}},{abort:()=>{m&&(m.cancel(),m.effect=null,m.onfinish=Ie)},deactivate:()=>{n=Ie},reset:()=>{i===0&&(d==null||d(1,0))},t:()=>p()}}function pi(r,e,t=e){var i=Kt();Kr(r,"input",n=>{var a=n?r.defaultValue:r.value;if(a=ni(r)?ai(a):a,t(a),i&&a!==(a=e())){var s=r.selectionStart,l=r.selectionEnd;r.value=a??"",l!==null&&(r.selectionStart=s,r.selectionEnd=Math.min(l,r.value.length))}}),et(e)==null&&r.value&&t(ni(r)?ai(r.value):r.value),cr(()=>{var n=e();ni(r)&&n===ai(r.value)||r.type==="date"&&!n&&!r.value||n!==r.value&&(r.value=n??"")})}const ii=new Set;function Nt(r,e,t,i,n=i){var a=t.getAttribute("type")==="checkbox",s=r;if(e!==null)for(var l of e)s=s[l]??(s[l]=[]);s.push(t),Kr(t,"change",()=>{var f=t.__value;a&&(f=Hs(s,f,t.checked)),n(f)},()=>n(a?[]:null)),cr(()=>{var f=i();a?(f=f||[],t.checked=f.includes(t.__value)):t.checked=Pn(t.__value,f)}),Mi(()=>{var f=s.indexOf(t);f!==-1&&s.splice(f,1)}),ii.has(s)||(ii.add(s),Mt(()=>{s.sort((f,u)=>f.compareDocumentPosition(u)===4?-1:1),ii.delete(s)})),Mt(()=>{})}function Ls(r,e,t=e){Kr(r,"change",i=>{var n=i?r.defaultChecked:r.checked;t(n)}),et(e)==null&&t(r.checked),cr(()=>{var i=e();r.checked=!!i})}function Hs(r,e,t){for(var i=new Set,n=0;n<r.length;n+=1)r[n].checked&&i.add(r[n].__value);return t||i.delete(e),Array.from(i)}function ni(r){var e=r.type;return e==="number"||e==="range"}function ai(r){return r===""?null:+r}function ta(r,e,t){if(r.multiple)return Us(r,e);for(var i of r.options){var n=tr(i);if(Pn(n,e)){i.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function $s(r,e){Jt(()=>{var t=new MutationObserver(()=>{var i=r.__value;ta(r,i)});return t.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{t.disconnect()}})}function ra(r,e,t=e){var i=!0;Kr(r,"change",n=>{var a=n?"[selected]":":checked",s;if(r.multiple)s=[].map.call(r.querySelectorAll(a),tr);else{var l=r.querySelector(a)??r.querySelector("option:not([disabled])");s=l&&tr(l)}t(s)}),Jt(()=>{var n=e();if(ta(r,n,i),i&&n===void 0){var a=r.querySelector(":checked");a!==null&&(n=tr(a),t(n))}r.__value=n,i=!1}),$s(r)}function Us(r,e){for(var t of r.options)t.selected=~e.indexOf(tr(t))}function tr(r){return"__value"in r?r.__value:r.value}function Ii(r,e){return r===e||(r==null?void 0:r[ut])===e}function Zs(r={},e,t,i){return Jt(()=>{var n,a;return cr(()=>{n=a,a=[],et(()=>{r!==t(...a)&&(e(r,...a),n&&Ii(t(...n),r)&&e(null,...n))})}),()=>{Mt(()=>{a&&Ii(t(...a),r)&&e(null,...a)})}}),r}function Ye(r=!1){const e=xe,t=e.l.u;if(!t)return;let i=()=>ms(e.s);if(r){let n=0,a={};const s=At(()=>{let l=!1;const f=e.s;for(const u in f)f[u]!==a[u]&&(a[u]=f[u],l=!0);return l&&n++,n});i=()=>v(s)}t.b.length&&rs(()=>{en(e,i),li(t.b)}),Yi(()=>{const n=et(()=>t.m.map(ka));return()=>{for(const a of n)typeof a=="function"&&a()}}),t.a.length&&Yi(()=>{en(e,i),li(t.a)})}function en(r,e){if(r.l.s)for(const t of r.l.s)v(t);e()}function ia(r,e,t){if(r==null)return e(void 0),Ie;const i=et(()=>r.subscribe(e,t));return i.unsubscribe?()=>i.unsubscribe():i}const Lt=[];function js(r,e=Ie){let t=null;const i=new Set;function n(l){if(Dn(r,l)&&(r=l,t)){const f=!Lt.length;for(const u of i)u[1](),Lt.push(u,r);if(f){for(let u=0;u<Lt.length;u+=2)Lt[u][0](Lt[u+1]);Lt.length=0}}}function a(l){n(l(r))}function s(l,f=Ie){const u=[l,f];return i.add(u),i.size===1&&(t=e(n,a)||Ie),l(r),()=>{i.delete(u),i.size===0&&t&&(t(),t=null)}}return{set:n,update:a,subscribe:s}}function Gs(r){let e;return ia(r,t=>e=t)(),e}let wr=!1,hi=Symbol();function Vs(r,e,t){const i=t[e]??(t[e]={store:null,source:Gt(void 0),unsubscribe:Ie});if(i.store!==r&&!(hi in t))if(i.unsubscribe(),i.store=r??null,r==null)i.source.v=void 0,i.unsubscribe=Ie;else{var n=!0;i.unsubscribe=ia(r,a=>{n?i.source.v=a:ie(i.source,a)}),n=!1}return r&&hi in t?Gs(r):v(i.source)}function Ys(){const r={};function e(){Mi(()=>{for(var t in r)r[t].unsubscribe();_n(r,hi,{enumerable:!1,value:!0})})}return[r,e]}function Ws(r){var e=wr;try{return wr=!1,[r(),wr]}finally{wr=e}}function ge(r,e,t,i){var z;var n=(t&$a)!==0,a=!or||(t&Ua)!==0,s=(t&ja)!==0,l=(t&Ga)!==0,f=!1,u;s?[u,f]=Ws(()=>r[e]):u=r[e];var d=ut in r||Ca in r,y=s&&(((z=Ut(r,e))==null?void 0:z.set)??(d&&e in r&&(A=>r[e]=A)))||void 0,h=i,o=!0,p=!1,m=()=>(p=!0,o&&(o=!1,l?h=et(i):h=i),h);u===void 0&&i!==void 0&&(y&&a&&Pa(),u=m(),y&&y(u));var _;if(a)_=()=>{var A=r[e];return A===void 0?m():(o=!0,p=!1,A)};else{var k=(n?At:_e)(()=>r[e]);k.f|=kn,_=()=>{var A=v(k);return A!==void 0&&(h=void 0),A===void 0?h:A}}if(!(t&Za))return _;if(y){var w=r.$$legacy;return function(A,Y){return arguments.length>0?((!a||!Y||w||f)&&y(Y?_():A),A):_()}}var F=!1,N=!1,U=Gt(u),M=At(()=>{var A=_(),Y=v(U);return F?(F=!1,N=!0,Y):(N=!1,U.v=A)});return n||(M.equals=Ei),function(A,Y){if(gt!==null&&(F=N,_(),v(U)),arguments.length>0){const Q=Y?v(M):a&&s?yt(A):A;return M.equals(Q)||(F=!0,ie(U,Q),p&&h!==void 0&&(h=Q),et(()=>v(M))),A}return v(M)}}const zs="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(zs);Na();class Ks{constructor(e,t,i){c(this,"_dbname");c(this,"_dbversion");c(this,"dbPromise");c(this,"getTran",async(e,t)=>(await this.dbPromise).transaction(e,t));c(this,"reset",async()=>(await indexedDB.databases().then(e=>{console.log(e)}),await new Promise((e,t)=>{const i=indexedDB.deleteDatabase(this._dbname);i.onsuccess=()=>{console.log("onsuccess"),e()},i.onerror=n=>{console.log("onerror"),t(n)}})));c(this,"getAll",async e=>{const t=await this.dbPromise;return new Promise((i,n)=>{const l=t.transaction([e],"readonly").objectStore(e).getAll();l.onsuccess=()=>{i(l.result)},l.onerror=f=>{n(f)}})});c(this,"get",async(e,t)=>{const i=await this.dbPromise;return new Promise((n,a)=>{const f=i.transaction([e],"readonly").objectStore(e).get(t);f.onsuccess=()=>{n(f.result)},f.onerror=u=>{a(u)}})});c(this,"getMany",async(e,t)=>{const a=(await this.dbPromise).transaction([e],"readonly").objectStore(e),s=t.map(l=>new Promise((f,u)=>{const d=a.get(l);d.onsuccess=()=>{f(d.result)},d.onerror=y=>{u(y)}}));return await Promise.all(s)});c(this,"putRecords",async(e,t)=>{const n=(await this.dbPromise).transaction([e],"readwrite"),a=n.objectStore(e),s=t.map(l=>({record:l,request:a.put(l)}));return new Promise((l,f)=>{n.oncomplete=()=>l(s.map(u=>Object.assign({id:u.request.result},u.record))),n.onerror=u=>f(u)})});c(this,"deleteRecords",async(e,t)=>{const n=(await this.dbPromise).transaction([e],"readwrite"),a=n.objectStore(e),s=t.map(l=>({key:l,request:a.delete(l)}));return new Promise((l,f)=>{n.oncomplete=()=>{console.log(s.map(u=>u.request.result)),l()},n.onerror=u=>f(u)})});this._dbname=e,this._dbversion=t,this.dbPromise=new Promise((n,a)=>{const s=indexedDB.open(e,t);s.onsuccess=l=>{if(console.log(l),!l.target){console.log("event.target is undefined"),a("event.target is undefined");return}const f=l.target.result;if(!f){console.log("event.target.result is undefined"),a("event.target.result is undefined");return}f.onversionchange=u=>{console.log(u),f.close()},n(f)},s.onupgradeneeded=l=>{console.log("onupgradeneeded");const f=l.target.result;i.filter(u=>!f.objectStoreNames.contains(u)).map(u=>f.createObjectStore(u,{keyPath:"id",autoIncrement:!0}))},s.onerror=l=>{console.log(l),a(l)},s.onblocked=l=>{console.log(l),a(l)}}),console.log(this.dbPromise)}get dbversion(){return this._dbversion}}class Ge{constructor(){c(this,"handlers",[])}append(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}trigger(e){this.handlers.slice(0).forEach(t=>t(e))}clear(){this.handlers.splice(0)}expose(){return this}}class tn{constructor(){c(this,"handler")}set(e){this.handler=e}async call(e){if(!this.handler)throw Error("illegal state error");return await this.handler(e)}expose(){return this}}class Ri{constructor(e,t,i,n){c(this,"_name");c(this,"_createVersion");c(this,"mountResolver",()=>{});c(this,"_indexedDb");c(this,"onInsertEvent",new Ge);c(this,"onBeforeInsertEvent",new tn);c(this,"onUpdateEvent",new Ge);c(this,"onBeforeUpdateEvent",new tn);c(this,"onDeleteEvent",new Ge);c(this,"prepareInitialRecords",()=>{const e=new Date;return this._prepareInitialRecords().map(t=>Object.assign(t,{createdAt:e,updatedAt:e,dbVersion:this._createVersion}))});c(this,"resolveMount",()=>this.mountResolver());c(this,"patchForInsert",(e,t)=>{e.newRecords.forEach(i=>{console.log(i),t[i.id]=i})});c(this,"patchForUpdate",(e,t)=>{e.recordPairs.forEach(i=>{console.log(t[i.newRecord.id],i.newRecord),t[i.newRecord.id]={...i.newRecord}})});c(this,"patchForDelete",(e,t)=>{e.oldRecords.forEach(i=>{console.log(i),delete t[i.id]})});this._indexedDb=e,this._name=t,this._createVersion=e.dbversion,this.getAll().then(a=>a.reduce((s,l)=>(s[l.id]=l,s),{})).then(a=>{console.log(this.name,a),this.onBeforeInsertEvent.set(i??(()=>Promise.resolve())),this.onBeforeUpdateEvent.set(n??(()=>Promise.resolve()))})}get name(){return this._name}get createVersion(){return this._createVersion}get oninsert(){return this.onInsertEvent.expose()}get onbeforeinsert(){return this.onBeforeInsertEvent.expose()}get onupdate(){return this.onUpdateEvent.expose()}get onbeforeupdate(){return this.onBeforeUpdateEvent.expose()}get ondelete(){return this.onDeleteEvent.expose()}getAll(){return this._indexedDb.getAll(this.name)}get(e){return this._indexedDb.get(this.name,e)}async insertMany(e){const t=new Date,i=e.map(a=>{const s={createdAt:t,updatedAt:t,dbVersion:this._createVersion};return Object.assign(a,s)});await this.onBeforeInsertEvent.call({sender:this,newRecords:i,timestamp:t});const n=await this._indexedDb.putRecords(this.name,i);return this.onInsertEvent.trigger({sender:this,newRecords:n,timestamp:t}),n}async insert(e){return(await this.insertMany([e]))[0]}async updateMany(e,t){const i=new Date,n=[];return(await this._indexedDb.getMany(this.name,e)).forEach(s=>{const l={...s},f={...l};n.push({newRecord:Object.assign(t(f),{updatedAt:i,dbVersion:this._createVersion}),oldRecord:l})}),await this.onBeforeUpdateEvent.call({sender:this,recordPairs:n,timestamp:i}),await this._indexedDb.putRecords(this.name,n.map(s=>s.newRecord)),this.onUpdateEvent.trigger({sender:this,recordPairs:n,timestamp:i}),n.map(s=>s.newRecord)}async update(e,t){return(await this.updateMany([e],t))[0]}async delete(e){const t=new Date,i=await this._indexedDb.getMany(this.name,e);await this._indexedDb.deleteRecords(this.name,e),this.onDeleteEvent.trigger({sender:this,oldRecords:i,timestamp:t})}}const We=class We{constructor(e){c(this,"id");c(this,"name");c(this,"description");c(this,"save",async e=>{const t=e??{id:this.id,name:this.name,description:this.description},i=await We.tblHeader.update(this.id,n=>({...n,...t}));return new We(i)});this.id=e.id,this.name=e.name,this.description=e.description}};c(We,"tblHeader"),c(We,"getOrCreateNew",async e=>{We.tblHeader||(We.tblHeader=new Qs(e));const t=await We.tblHeader.getAll();if(t.length)return new We(t[0]);const i=await We.tblHeader.insert({name:"あなた",description:"ここの文字列を何に使うかは未定。"});return new We(i)});let yi=We;class Qs extends Ri{constructor(t){super(t,"TblDuelistProfile");c(this,"_prepareInitialRecords",()=>[])}}let Js=-1;const Xs=[{id:Js--,name:"NPC",description:""}],Is=["Deck","ExtraDeck"],el={Deck:"メインデッキ",ExtraDeck:"エクストラデッキ"},gi=["Monster","Spell","Trap"],na={Monster:"モンスター",Spell:"魔法",Trap:"罠"},Wt=["Fusion","Syncro","Xyz","Link"],aa=[...Wt,"SpecialSummon"],tl=["Toon","Spirit","Union","Gemini","FlipEffect"],rl=["Tuner","Effect","Normal","Pendulum","Token","NormalSummonOnly"],rn=[...aa,...tl,...rl],Qr={Syncro:"シンクロ",Fusion:"融合",Xyz:"エクシーズ",Link:"リンク",SpecialSummon:"特殊召喚",Toon:"トゥーン",Spirit:"スピリット",Union:"ユニオン",Gemini:"デュアル",FlipEffect:"リバース",Tuner:"チューナー",Effect:"効果",Normal:"通常",Pendulum:"ペンデュラム",Token:"トークン",NormalSummonOnly:"特殊召喚不可"},fr={Syncro:"🎵",Fusion:"🌀",Xyz:"📰",Link:"⛓️",SpecialSummon:"🔯",Toon:"📖",Spirit:"👻",Union:"🚗",Gemini:"👫",FlipEffect:"🔄",Tuner:"🎶",Effect:"✨",Normal:"🔘",Pendulum:"💠",Token:"🐏",NormalSummonOnly:"🔲"},nn=["Light","Dark","Earth","Water","Fire","Wind","Divine"],Ni={Light:"光",Dark:"闇",Earth:"地",Water:"水",Fire:"炎",Wind:"風",Divine:"神"},an=["Aqua","Beast","BeastWarrior","CreatorGod","Cyberse","Dinosaur","DivineBeast","Dragon","Fairy","Fiend","Fish","Insect","Illusion","Machine","Plant","Psychic","Pyro","Reptile","Rock","SeaSerpent","Spellcaster","Thunder","Warrior","WingedBeast","Wyrm","Zombie"],sn=["Normal","Continuous","Field","QuickPlay","Equip","Ritual"],vr={Normal:"通常",Continuous:"永続",Field:"フィールド",QuickPlay:"速攻",Equip:"装備",Ritual:"儀式"},ln=["Normal","Continuous","Counter"],pr={Normal:"通常",Continuous:"永続",Counter:"カウンター"},Tr={Attack:"攻撃表示",Defense:"守備表示",Set:"裏側守備表示"},sa=["level","rank","attack","defense","pendulumScaleR","pendulumScaleL"],il=({wikiName:r,wikiHref:e,wikiTextAll:t,nameKana:i,description:n,pendulumDescription:a,...s})=>s,nl=r=>il(r),Jr={Aqua:"水",Beast:"獣",BeastWarrior:"獣戦士",CreatorGod:"創造神",Cyberse:"サイバース",Dinosaur:"恐竜",DivineBeast:"幻獣神",Dragon:"ドラゴン",Fairy:"天使",Fiend:"悪魔",Fish:"魚",Insect:"昆虫",Illusion:"幻想魔",Machine:"機械",Plant:"植物",Psychic:"サイキック",Pyro:"炎",Reptile:"爬虫類",Rock:"岩石",SeaSerpent:"海竜",Spellcaster:"魔法使い",Thunder:"雷",Warrior:"戦士",WingedBeast:"鳥獣",Wyrm:"幻竜",Zombie:"アンデット"},hr={Aqua:"🚰",Beast:"🐅",BeastWarrior:"🦁",CreatorGod:"🔆",Cyberse:"💻️",Dinosaur:"🦖",DivineBeast:"💫",Dragon:"🐲",Fairy:"👼",Fiend:"👿",Fish:"🐟️",Insect:"🦋",Illusion:"🤡",Machine:"🤖",Plant:"🌱",Psychic:"👁️",Pyro:"🔥",Reptile:"🦎",Rock:"⛰",SeaSerpent:"🐍",Spellcaster:"🧙",Thunder:"⚡️",Warrior:"⚔️",WingedBeast:"🦅",Wyrm:"🐉",Zombie:"🦴"},la=["Deck","ExtraDeck"],al=[...la,"Graveyard","Banished"],Br=["MonsterZone","ExtraMonsterZone"],nr=["SpellAndTrapZone","FieldSpellZone"],Xr=[...Br,...nr],mi={0:{0:"Hand"},1:{0:"Deck",1:"SpellAndTrapZone",2:"SpellAndTrapZone",3:"SpellAndTrapZone",4:"SpellAndTrapZone",5:"SpellAndTrapZone",6:"ExtraDeck"},2:{0:"Graveyard",1:"MonsterZone",2:"MonsterZone",3:"MonsterZone",4:"MonsterZone",5:"MonsterZone",6:"FieldSpellZone"},3:{0:"Banished",1:"Disable",2:"ExtraMonsterZone",3:"Disable",4:"ExtraMonsterZone",5:"Disable",6:"Banished"},4:{0:"FieldSpellZone",1:"MonsterZone",2:"MonsterZone",3:"MonsterZone",4:"MonsterZone",5:"MonsterZone",6:"Graveyard"},5:{0:"ExtraDeck",1:"SpellAndTrapZone",2:"SpellAndTrapZone",3:"SpellAndTrapZone",4:"SpellAndTrapZone",5:"SpellAndTrapZone",6:"Deck"},6:{0:"Hand"}};class sl{constructor(e,t,i,n){c(this,"onUpdateEvent",new Ge);c(this,"field");c(this,"row");c(this,"column");c(this,"cellType");c(this,"owner");c(this,"_needsShuffle",!1);c(this,"_entities");c(this,"releaseEntities",e=>(this._entities=this._entities.filter(t=>!e.includes(t)),this.onUpdateEvent.trigger(),e));c(this,"acceptEntities",(e,t)=>{t==="Top"?this._entities.unshift(...e):this._entities.push(...e),t==="Random"&&(this._needsShuffle=!0),this._entities.forEach(i=>{i.fieldCell=this}),this.onUpdateEvent.trigger()});c(this,"shuffle",()=>{this._entities=this.entities.shuffle(),this._needsShuffle=!1});this.field=e,this.row=t,this.column=i,this.cellType=mi[t][i],this.owner=n,this._entities=[]}get onUpdate(){return this.onUpdateEvent.expose()}get needsShuffle(){return this._needsShuffle}get entities(){return this._entities}get cardEntities(){return this._entities.filter(e=>Rl.find(t=>t===e.entityType))}get targetForAttack(){return this.cellType==="Hand"?this._entities.find(e=>e.entityType==="Duelist"):this.cardEntities[0]}get isAvailable(){return this._entities.length===0}get isStackCell(){return al.some(e=>e===this.cellType)}get isPlayFieldCell(){return Xr.some(e=>e===this.cellType)}}Array.prototype.shuffle=function(){return this.map(e=>({item:e,seq:Math.random()})).toSorted((e,t)=>e.seq-t.seq).map(e=>e.item)};Array.prototype.randomPick=function(r){return this.shuffle().slice(0,r)};Array.prototype.reset=function(...r){this.splice(0),this.push(...r)};Array.prototype.union=function(r){return this.filter(e=>r.find(t=>e===t))};Array.prototype.getAllOnOffPattern=function(){const r=[];return this.forEach(e=>{if(r.length==0){r.push([e]),r.push([]);return}r.forEach(t=>r.push([...t,e]))}),r};Array.prototype.getDistinct=function(){return Array.from(new Set(this))};const ll=["NormalSummon","SpecialSummon","ChangeBattlePosition","Battle","SpellTrapSet","SpellTrapActivate"],on=["NormalSummon","AdvanceSummon","SpecialSummon","SpecialSummonFromDeck","SendToGraveyardFromDeck","Draw","SearchFromDeck","BanishFromGraveyard","AddToHandFromGraveyard","ReturnToDeckFromGraveyard","SpecialSummonFromGraveyard","Destroy","DestroyMultiple","DestroyOnField","DestroyMultipleOnField","DestroyOnOpponentField","DestroyMultipleOnOpponentField","DestroyMonsterOnField","DestroyMonstersOnField","DestroySpellTrapOnField","DestroySpellTrapsOnField","IfNormarlSummonSucceed","IfSpecialSummonSucceed","DamageToOpponent","DamageToSelf","PayLifePoint","DiscordAsCost","DiscordAsEffect","RollDice","BounceToHand","NegateCardEffect","NegateCardActivation"],Ht=r=>r.playType==="CardActivation"?r.entity.nm:`${r.entity.nm}«${r.title}»`,st=class st{constructor(e,t,i){c(this,"seq");c(this,"entity");c(this,"cardActionBase");c(this,"getClone",()=>new st(this.seq,this.entity,this.cardActionBase));c(this,"validate",e=>{if(!(this.isOnlyNTimesPerDuel>0&&this.entity.field.duel.cardActionLog.records.filter(t=>this.isSame(t.cardAction)).filter(t=>t.activator).length>=this.isOnlyNTimesPerDuel)&&!(this.isOnlyNTimesPerTurn>0&&this.entity.field.duel.cardActionLog.records.filter(t=>this.isSameGroupPerTurn(t.cardAction)).filter(t=>t.clock.turn===this.entity.field.duel.clock.turn).filter(t=>t.activator).length>=this.isOnlyNTimesPerTurn))return this.cardActionBase.validate(this,e)});c(this,"prepare",async(e,t,i)=>{this.isLikeContinuousSpell&&(this.entity.info.isPending=!0);const n=await this.cardActionBase.prepare(this,e,t,i);if(n!==void 0)return this.entity.field.duel.cardActionLog.push(this.entity.controller,this),{...n,action:this,activator:this.entity.controller}});c(this,"execute",async(e,t)=>{if(e.action.isLikeContinuousSpell&&!e.action.entity.isOnField)return this.entity.info.isPending=!1,!1;const i=await this.cardActionBase.execute(e,t);if(e.action.isLikeContinuousSpell)for(const n of this.entity.continuousEffects)this.entity.info.isPending=!1,await n.updateState();return i});c(this,"settle",(e,t)=>this.cardActionBase.settle(e,t));c(this,"isSame",e=>this.entity.origin.name===e.entity.origin.name&&this.title===e.title);c(this,"isSameGroupPerTurn",e=>this.actionGroupNamePerTurn?this.entity.origin.name===e.entity.origin.name&&this.actionGroupNamePerTurn===e.actionGroupNamePerTurn:this.isSame(e));c(this,"calcChainBlockTagsForDestroy",e=>{if(!on.length)return[];const t=["Destroy"];on.length>1&&t.push("DestroyMultiple");const i=e.filter(l=>l.isOnField);i.length&&(t.push("DestroyOnField"),i.length>1&&t.push("DestroyMultipleOnField"));const n=i.filter(l=>l.status.kind==="Monster");n.length&&(t.push("DestroyMonsterOnField"),n.length>1&&t.push("DestroyMonstersOnField")),i.filter(l=>l.status.kind!=="Monster").length&&(t.push("DestroySpellTrapOnField"),n.length>1&&t.push("DestroySpellTrapsOnField"));const s=i.filter(l=>l.controller!==this.entity.controller);return s.length&&(t.push("DestroyOnOpponentField"),s.length>1&&t.push("DestroyMultipleOnOpponentField")),t});this.seq=e,this.entity=t,this.cardActionBase=i}get title(){return this.cardActionBase.title}get playType(){return this.cardActionBase.playType}get spellSpeed(){return this.cardActionBase.spellSpeed}get hasToTargetCards(){return this.cardActionBase.hasToTargetCards??!1}get executableCells(){return this.cardActionBase.executableCells}get isOnlyNTimesPerDuel(){return this.cardActionBase.isOnlyNTimesPerDuel??0}get isOnlyNTimesPerTurn(){return this.cardActionBase.isOnlyNTimesPerTurn??0}get isLikeContinuousSpell(){return this.cardActionBase.isLikeContinuousSpell||this.entity.isLikeContinuousSpell&&this.playType==="CardActivation"}get actionGroupNamePerTurn(){return this.cardActionBase.actionGroupNamePerTurn}get canExecuteOnDamageStep(){return this.cardActionBase.canExecuteOnDamageStep??!1}};c(st,"nextActionSeq",0),c(st,"createNew",(e,t)=>new st(st.nextActionSeq++,e,t)),c(st,"createDammyAction",(e,t,i,n)=>({seq:st.nextActionSeq++,title:t,entity:e,playType:"Dammy",spellSpeed:"Dammy",executableCells:[e.fieldCell.cellType],hasToTargetCards:!1,isOnlyNTimesPerDuel:0,isOnlyNTimesPerTurn:0,isLikeContinuousSpell:!1,getClone:function(){return this},validate:()=>i,prepare:async()=>{},execute:async()=>!1,settle:async()=>!1,pos:n,cell:i[0],dragAndDropOnly:i.length>1}));let wt=st;const ol=async()=>({selectedEntities:[],chainBlockTags:[],prepared:void 0}),cl=r=>{if(r.entity.controller.info.ruleNormalSummonCount>=r.entity.controller.info.maxRuleNormalSummonCount||!r.entity.lvl)return;const e=r.entity.controller.getAvailableMonsterZones();return r.entity.lvl<5?e.length>0?e:void 0:r.entity.controller.getReleasableMonsters().length<(r.entity.lvl<7?1:2)?void 0:[]},dl=async(r,e,t,i)=>{if(!r.entity.lvl)return;let n=e?[e]:r.entity.controller.getAvailableMonsterZones();if(n.length===0)return;let a=i,s=[];if(r.entity.lvl>4){const u=r.entity.controller.getReleasableMonsters(),d=r.entity.controller.getExtraMonsterZones(),y=r.entity.lvl<7?1:2;d.length>=y&&u.filter(o=>o.fieldCell.cellType!=="ExtraMonsterZone");const h=await r.entity.field.release(r.entity.controller,r.entity.controller.getReleasableMonsters(),y,"Cost",["AdvanceSummonRelease","Rule"],r.entity,a);if(!h)return;s=h,a=!1,n=r.entity.controller.getAvailableMonsterZones()}let l=(r.entity.atk??0)>0&&(r.entity.atk??0)>=(r.entity.def??0)?"Attack":"Set",f=n.randomPick(1)[0];if(r.entity.controller.duelistType!=="NPC"){const u=await r.entity.field.duel.view.waitSelectSummonDest(r.entity,n,["Attack","Set"],a);if(!u)return;f=u.dest,l=u.pos}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:f,pos:l,materials:s}}},ul=async r=>{const e=["Rule","NormalSummon"];return r.prepared.materials.length>0&&(r.action.entity.info.materials.reset(...r.prepared.materials),e.push("AdvanceSummon")),await r.action.entity.summon(r.prepared.dest,r.prepared.pos,"NormalSummon",e,r.action.entity,r.activator),r.activator.info.ruleNormalSummonCount++,r.activator.info.ruleNormalSummonCountQty++,!0},cn=(r,e,t)=>{const i=r.entity.controller.getAvailableMonsterZones();if(r.entity.fieldCell.cellType==="ExtraDeck"&&i.push(...r.entity.controller.getAvailableExtraZones()),!(!i.length&&(!t.length||t.every(n=>n.fieldCell.cellType!=="MonsterZone")&&r.entity.fieldCell.cellType!=="ExtraDeck"))&&r.entity.controller.canSummon(r.entity.controller,r.entity,r,"SpecialSummon",e,t).length)return t.length===0?i:[]},dn=async(r,e,t,i,n)=>{const a=e?[e]:r.entity.controller.getAvailableMonsterZones();if(a.length===0)return;const s=r.entity.controller.canSummon(r.entity.controller,r.entity,r,"SpecialSummon",t,i);if(s.length===0)return;let l=s.randomPick(1)[0],f=a.randomPick(1)[0];if(s.length&&s.includes("Attack")&&(l=(r.entity.atk??0)>0&&(r.entity.atk??0)>=(r.entity.def??0)?"Attack":s.filter(u=>u!=="Attack").randomPick(1)[0]),r.entity.controller.duelistType!=="NPC"){const u=await r.entity.field.duel.view.waitSelectSummonDest(r.entity,a,s,n);if(!u)return;f=u.dest,l=u.pos}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:f,pos:l,materials:i}}},un=async r=>{const e=["Rule","SpecialSummon"];return await r.action.entity.summon(r.prepared.dest,r.prepared.pos,"SpecialSummon",e,r.action.entity,r.activator),r.action.entity.info.materials=r.prepared.materials,!0},je={title:"通常召喚",playType:"NormalSummon",spellSpeed:"Normal",executableCells:["Hand"],validate:cl,prepare:dl,execute:ul,settle:async()=>!0},fl=r=>{if(r.entity.info.attackCount>0||r.entity.battlePosition!=="Attack"||!r.entity.controller.isTurnPlayer)return;const e=r.entity.controller.getAttackTargetMonsters();return e.length>0?e.map(t=>t.fieldCell):[r.entity.controller.getOpponentPlayer().getHandCell()]},vl=async(r,e)=>{if(r.entity.info.attackCount>0||r.entity.battlePosition!=="Attack")return;if(e!=null&&e.targetForAttack)return{selectedEntities:[],chainBlockTags:[],prepared:{target:e.targetForAttack}};const t=r.entity.controller.getAttackTargetMonsters(),i=r.entity.controller.getOpponentPlayer().entity;if(t.length===0)return{selectedEntities:[],chainBlockTags:[],prepared:{target:i}};if(t.length===1)return{selectedEntities:[],chainBlockTags:[],prepared:{target:t[0]}};const n=await r.entity.field.duel.view.waitSelectEntities(r.entity.controller,t,1,a=>a.length===1,"攻撃対象を選択。",!0);if(n)return{selectedEntities:[],chainBlockTags:[],prepared:{target:n[0]}}},pl=async r=>(r.action.entity.field.duel.declareAnAttack(r.action.entity,r.prepared.target),!0),Fe={title:"攻撃宣言",playType:"Battle",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],validate:fl,prepare:vl,execute:pl,settle:async()=>!0},hl=r=>{if(!(r.entity.info.battlePotisionChangeCount>0||r.entity.info.attackCount>0||!r.entity.controller.isTurnPlayer))return[]},yl=async r=>r.action.entity.info.battlePotisionChangeCount>0||!r.action.entity.controller.isTurnPlayer?!1:(await r.action.entity.setBattlePosition(r.action.entity.battlePosition==="Attack"?"Defense":"Attack",["Rule"]),r.action.entity.info.battlePotisionChangeCount++,!0),qe={title:"表示形式変更",playType:"ChangeBattlePosition",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],validate:hl,prepare:ol,execute:yl,settle:async()=>!0},oa=(r,e,t,i)=>!r.entity.origin.level||e.some(n=>!n.lvl)||e.map(n=>n.lvl??0).reduce((n,a)=>n+a,0)!==r.entity.origin.level||!t(e.filter(n=>{var a;return(a=n.status.monsterCategories)==null?void 0:a.some(s=>s==="Tuner")}))?!1:i(e.filter(n=>{var a;return(a=n.status.monsterCategories)==null?void 0:a.every(s=>s!=="Tuner")}))?e.every(n=>n.canBeMaterials("SyncroSummon",r,e))?r.entity.owner.canSummon(r.entity.owner,r.entity,r,"SyncroSummon",["Attack","Defense"],e).length?!0:(console.log("piyo"),!1):(console.log("fuga"),!1):(console.log("hoge"),!1),ca=(r,e=i=>i.length===1,t=i=>i.length>0)=>{let i=[...r.entity.controller.getMonstersOnField().filter(n=>n.battlePosition!=="Set"),...r.entity.controller.getHandCell().entities.filter(n=>n.origin.kind==="Monster")];return i.every(n=>!n.status.allowHandSyncro)&&(i=i.filter(n=>n.fieldCell.isPlayFieldCell)),i.length<2?[]:i.getAllOnOffPattern().filter(n=>oa(r,n,e,t))},gl=(r,e=i=>i.length===1,t=i=>i.length>0)=>ca(r,e,t).length>0?[]:void 0,ml=async(r,e,t,i=a=>a.length===1,n=a=>a.length>0)=>{const a=ca(r,i,n);let s=a[0];if(a.length>1){const d=a.flatMap(h=>h).getDistinct(),y=await r.entity.duel.view.waitSelectEntities(r.entity.controller,d,void 0,h=>oa(r,h,i,n),"シンクロ素材とするモンスターを選択",!0);if(!y)return;s=y}r.entity.field.duel.log.info(`シンクロ素材として、${s.map(d=>"《"+d.nm+"》").join("")}を墓地に送り――`,r.entity.controller),await Pe.sendManyToGraveyardForTheSameReason(s,["SyncroMaterial","Rule","SpecialSummonMaterial"],r.entity,r.entity.controller);const l=[...r.entity.controller.getAvailableMonsterZones(),...r.entity.controller.getAvailableExtraZones()];let f=(r.entity.atk??0)>0&&(r.entity.atk??0)>=(r.entity.def??0)?"Attack":"Defense",u=l.randomPick(1)[0];if(r.entity.controller.duelistType!=="NPC"){const d=await r.entity.field.duel.view.waitSelectSummonDest(r.entity,l,["Attack","Defense"],!1);if(!d)return;u=d.dest,f=d.pos}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:u,pos:f,materials:s}}},_l=async r=>{const e=["Rule","SpecialSummon","SyncroSummon"];return await r.action.entity.summon(r.prepared.dest,r.prepared.pos,"SyncroSummon",e,r.action.entity,r.activator),r.action.entity.info.isRebornable=!0,!0},fn=(r=t=>t.length===1,e=t=>t.length>0)=>({title:"シンクロ召喚",playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],validate:t=>gl(t,r,e),prepare:(t,i,n,a)=>ml(t,i,a,r,e),execute:_l,settle:async()=>!0}),Sl=(r,e,t,i,n)=>({title:"①リクルート",playType:"TriggerEffect",spellSpeed:"Normal",executableCells:n,canExecuteOnDamageStep:!0,validate:a=>{if(!a.entity.wasMovedAtPreviousChain||!a.entity.moveLog.latestRecord.movedAs.includes("BattleDestroy"))return;const s=a.entity.controller.getDeckCell().cardEntities.filter(r);if(s.length!==0&&!s.every(l=>!a.entity.controller.canSummon(a.entity.controller,a.entity,a,"SpecialSummon",t,[l]).length))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async a=>{const s=a.action.entity.controller.getDeckCell().cardEntities.filter(r);if(s.length===0)return!1;const l=await a.action.entity.field.duel.view.waitSelectEntities(a.activator,s,e.length===1?e[0]:-1,f=>e.includes(f.length),"特殊召喚するモンスターを選択",!1);if(!l)throw new Error("illegal state");for(const f of l)await a.activator.summon(f,t,a.activator.getAvailableMonsterZones(),"SpecialSummon",["Effect"],a.action.entity,!1);return a.activator.shuffleDeck(),!0},settle:async()=>!0});class Li{constructor(){c(this,"pooledOperators",[]);c(this,"bundles",[]);c(this,"excludesExpired",()=>{this.bundles=this.bundles.filter(e=>!e.entity.hasDisappeared),this.bundles.forEach(e=>e.excludesExpired()),this.pooledOperators=this.pooledOperators.filter(e=>e.validateAlive(e.isSpawnedBy))});c(this,"append",e=>{this.bundles.push(e)});c(this,"push",e=>{if(!e.isContinuous)throw new Oe("staticへの追加は永続以外不可",e);this.excludesExpired(),this.distribute(e),this.pooledOperators.push(e)});c(this,"distributeAll",()=>{this.excludesExpired(),this.pooledOperators.flatMap(this.distribute)});c(this,"distribute",e=>(console.log(this,e),this.bundles.filter(t=>t.operators.every(i=>i.seq!==e.seq)).filter(t=>e.isApplicableTo(e.isSpawnedBy,t.entity)).map(t=>(t.push(e),t))));c(this,"removeItem",(e,t)=>{this.pooledOperators=this.pooledOperators.filter(i=>i.isSpawnedBy!==e&&i.title!==t)})}}class Hi{constructor(e,t){c(this,"pool");c(this,"entity");c(this,"_operators");c(this,"excludesExpired",()=>{this._operators=this._operators.filter(e=>{const t=e.validateAlive(e.isSpawnedBy)&&e.isApplicableTo(e.isSpawnedBy,this.entity);return t||(console.log(this),e.beforeRemove()),t})});c(this,"push",e=>{this.beforePush(e),this._operators.push(e)});c(this,"removeItem",(e,t)=>{this._operators=this._operators.filter(i=>{const n=i.isSpawnedBy!==e&&i.title!==t;return i.beforeRemove(),n})});this.pool=e,this.entity=t,this._operators=[],this.pool.append(this)}get operators(){return this._operators}}const Nr=class Nr{constructor(e,t,i,n,a){c(this,"seq");c(this,"title");c(this,"validateAlive");c(this,"isContinuous");c(this,"isSpawnedBy");c(this,"isApplicableTo");c(this,"effectOwner");this.seq=Nr.nextSeq++,this.title=e,this.validateAlive=t,this.isContinuous=i,this.isSpawnedBy=n,this.isApplicableTo=a,this.effectOwner=this.isSpawnedBy.controller}};c(Nr,"nextSeq",0);let ar=Nr;class wl extends Li{}class Tl extends Hi{constructor(){super(...arguments);c(this,"beforePush",()=>{})}}class kl extends ar{constructor(t,i,n,a,s,l,f){super(t,i,n,a,s);c(this,"beforeRemove",()=>{});c(this,"procTypes");c(this,"filter");this.procTypes=l,this.filter=f}}const vn={level:1,rank:1,attack:0,defense:0,pendulumScaleR:0,pendulumScaleL:0};class bl extends Li{constructor(){super(...arguments);c(this,"calcStateAll",t=>{if(this.bundles.forEach(n=>n.calcStateAll()),t.field.getMonstersOnField().flatMap(n=>n.numericOprsBundle).flatMap(n=>n.operators).some(n=>n.stateOperationType==="THE_DEVILS_AVATAR"||n.stateOperationType==="THE_DEVILS_DREAD-ROOT"||n.stateOperationType==="Gradius'_Option")){const a=t.field.getMonstersOnField().filter(s=>(s.atk??0)>=0).map(s=>s.atk??0).reduce((s,l)=>s>l?s:l,0);t.field.getMonstersOnField().forEach(s=>{let l;s.info.effectTargets["Gradius'_Option"]&&(l=s.info.effectTargets["Gradius'_Option"][0]),s.numericOprsBundle.operators.forEach(f=>{var u;if(!((u=s.status.monsterCategories)!=null&&u.includes("Link")&&f.targetState==="defense")){if(f.stateOperationType==="Gradius'_Option"){s.status.calculated[f.targetState]=(l==null?void 0:l.status.calculated[f.targetState])??0;return}if(f.stateOperationType==="THE_DEVILS_AVATAR"){s.status.calculated[f.targetState]=a+100;return}if(f.stateOperationType==="THE_DEVILS_DREAD-ROOT"){s.status.calculated[f.targetState]=f.calcValue(f.isSpawnedBy,s,s.status.calculated[f.targetState]??0);return}}})})}})}}class Cl extends Hi{constructor(){super(...arguments);c(this,"dominantOperators",{level:void 0,rank:void 0,attack:void 0,defense:void 0,pendulumScaleR:void 0,pendulumScaleL:void 0});c(this,"beforePush",t=>{if(t.stateOperationType==="THE_DEVILS_AVATAR"||t.stateOperationType==="Gradius'_Option")return;const i=this.entity.origin[t.targetState]??0,n=this.entity.status.origin[t.targetState]??0,a=this.entity.status.current[t.targetState]??0,s=this.entity.status.calculated[t.targetState]??0,l=this.dominantOperators[t.targetState];if(t.stateOperationType==="THE_DEVILS_DREAD-ROOT"){this.entity.status.calculated[t.targetState]=t.calcValue(t.isSpawnedBy,this.entity,s);return}if(t.stateOperationType==="Addition"){if(t.targetStateGen==="origin")throw new Oe("ありえない組合せ",t);t.isContinuous||(this.entity.status.current[t.targetState]=t.calcValue(t.isSpawnedBy,this.entity,a)),this.entity.status.calculated[t.targetState]=t.calcValue(t.isSpawnedBy,this.entity,a);return}if(t.targetStateGen==="origin"){const f=t.calcValue(t.isSpawnedBy,this.entity,i);l&&!l.isContinuous&&l.targetStateGen!=="current"&&(this.entity.status.current[t.targetState]=f,this.dominantOperators[t.targetState]=void 0),this.entity.status.origin[t.targetState]=f,this.dominantOperators[t.targetState]=l??t}else t.isContinuous?(this.entity.status.current[t.targetState]=t.calcValue(t.isSpawnedBy,this.entity,n),this.dominantOperators[t.targetState]=t):(this.entity.status.current[t.targetState]=t.calcValue(t.isSpawnedBy,this.entity,s),this.dominantOperators[t.targetState]=t)});c(this,"calcStateAll",()=>sa.forEach(this.calcState));c(this,"calcState",t=>{if(this.entity.status.kind!=="Monster"){this.entity.status.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories){this.entity.status.calculated[t]=void 0;return}if(this.entity.status.monsterCategories.includes("Link")&&t!=="attack"){this.entity.status.calculated[t]=void 0;return}if(this.entity.status.monsterCategories.includes("Xyz")&&t==="level"){this.entity.status.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories.includes("Xyz")&&t==="rank"){this.entity.status.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories.includes("Pendulum")&&(t==="pendulumScaleL"||t==="pendulumScaleR")){this.entity.status.calculated[t]=void 0;return}if(t!=="level"&&!this.entity.isOnField){this.entity.status.origin[t]=this.entity.origin[t],this.entity.status.current[t]=this.entity.origin[t],this.entity.status.calculated[t]=this.entity.origin[t];return}const i=this._operators.filter(u=>u.targetState===t);if(i.some(u=>u.stateOperationType==="THE_DEVILS_AVATAR"||u.stateOperationType==="Gradius'_Option")&&this.entity.status.isEffective){this.entity.status.calculated[t]=-Number.MAX_VALUE;return}const n=this.dominantOperators[t],a=this.entity.status.origin[t]??0;let s=this.entity.status.current[t]??0,l=-1;n&&(n.targetStateGen==="current"&&n.isContinuous?(l=i.findLastIndex(u=>u.stateOperationType==="Fixation"&&u!==n),s=n.calcValue(n.isSpawnedBy,this.entity,a)):l=i.findIndex(u=>u===n)),l++;let f=s;if(l<i.length)for(let u=l;u<i.length;u++){const d=i[u];d.isContinuous&&d.targetStateGen==="current"&&d.stateOperationType==="Addition"&&(f=d.calcValue(d.isSpawnedBy,this.entity,f))}f<vn[t]&&(f=vn[t]),this.entity.status.calculated[t]=f})}}const $t=class $t extends ar{constructor(t,i,n,a,s,l,f,u,d){super(t,i,n,a,s);c(this,"beforeRemove",()=>{});c(this,"targetState");c(this,"targetStateGen");c(this,"stateOperationType");c(this,"calcValue");this.targetState=l,this.targetStateGen=f,this.stateOperationType=u,this.calcValue=d}};c($t,"createContinuous",(t,i,n,a,s,l,f,u)=>new $t(t,i,!0,n,a,s,l,f,u)),c($t,"createLingering",(t,i,n,a,s,l,f,u)=>new $t(t,i,!1,n,a,s,l,f,()=>u));let ft=$t;const Lr=class Lr{constructor(e,t){c(this,"entity");c(this,"isRegular");c(this,"_isStarted");c(this,"info");c(this,"continuousEffectBase");c(this,"updateState",async()=>{if(this.hasToStart!==this.isStarted){if(this.isStarted){if(!this.info)throw new Oe("illegal state");this._isStarted=!1,await this.continuousEffectBase.finish(this.entity,this.info),this.info=void 0;return}this.info=await this.continuousEffectBase.start(this.entity),this._isStarted=!0}});this._isStarted=!1,this.entity=e,this.continuousEffectBase=t,this.isRegular=this.executableCellTypes.every(i=>Xr.find(n=>n===i))&&this.faceList.length===1&&this.faceList[0]==="FaceUp"}get isStarted(){return this._isStarted}get executableCellTypes(){return this.continuousEffectBase.executableCellTypes}get faceList(){return this.continuousEffectBase.faceList}get hasToStart(){return this.entity.nm==="早すぎた埋葬"&&console.log("早すぎた埋葬",this,this.entity,this.entity.info,this.entity.info.isPending,this._isStarted),this.entity.info.isPending||!this.executableCellTypes.includes(this.entity.fieldCell.cellType)||!this.faceList.includes(this.entity.face)?!1:this.continuousEffectBase.canStart(this.entity)}};c(Lr,"createNew",(e,t)=>new Lr(e,t));let _i=Lr;const Dl=(r,e,t,i,n)=>({title:r,executableCellTypes:e==="Monster"?["MonsterZone","ExtraMonsterZone"]:["FieldSpellZone","SpellAndTrapZone"],faceList:["FaceUp"],canStart:t,start:async a=>{const s=i(a);return s.forEach(n(a).push),s.map(l=>l.title).getDistinct()},finish:async(a,s)=>{s.forEach(l=>n(a).removeItem(a,l))}}),$i=(r,e,t,i,n,a)=>(console.log(r,e,t,i,n,a),{title:r,executableCellTypes:e==="Monster"?["MonsterZone","ExtraMonsterZone"]:["FieldSpellZone","SpellAndTrapZone"],faceList:["FaceUp"],canStart:i,start:async s=>{console.log(s);const l=n(s);console.log(l);const f=t(s);return console.log(t,f),f.map(a).forEach(u=>l.forEach(u.push)),{targets:f,titles:l.map(u=>u.title).getDistinct()}},finish:async(s,l)=>{l.targets.map(a).forEach(f=>l.titles.forEach(u=>f.removeItem(s,u)))}}),El=(r,e,t,i,n)=>$i(r,e,t,i,n,a=>a.procFilterBundle),Rr=(r,e,t,i)=>Dl(r,e,t,i,n=>n.field.numericStateOperatorPool),Ui=(r,e,t,i,n)=>$i(r,e,t,i,n,a=>a.numericOprsBundle),Si=(r,e,t,i)=>$i(r,e,n=>(console.log(r,n,n.info,n.info.effectTargets),n.info.effectTargets[r]),t,i,n=>n.cardRelationBundle);class Al extends Li{}class xl extends Hi{constructor(){super(...arguments);c(this,"beforePush",()=>{})}}const Hr=class Hr extends ar{constructor(t,i,n,a,s,l,f,u){super(t,i,n,a,s);c(this,"relationType");c(this,"target");c(this,"beforeRemove");this.relationType=l,this.target=f,this.beforeRemove=()=>u(this)}};c(Hr,"createRegularEquipRelation",(t,i,n,a,s=()=>!0)=>new Hr(t,i,!0,n,(l,f)=>(console.log(f),f.isOnField&&f.face==="FaceUp"&&a(l,f)),"Equip",n.info.effectTargets[t][0],l=>{console.log("beforeRemove",l.isSpawnedBy,l.target),s(l)&&(l.isSpawnedBy.isOnField&&!l.isSpawnedBy.info.isDying&&(l.isSpawnedBy.info.isDying=!0,l.isSpawnedBy.info.causeOfDeath=["RuleDestroy"],l.isSpawnedBy.duel.log.info(`装備対象${l.target.toString()}不在により${l.isSpawnedBy.toString()}は破壊された。`,l.effectOwner)),l.isSpawnedBy.info.effectTargets[t]=[])}));let sr=Hr;class Ml{constructor(e){c(this,"entity");c(this,"_records");c(this,"pushForRuleAction",e=>{this._records.push({cell:this.entity.fieldCell,face:this.entity.face,orientation:this.entity.orientation,movedAt:this.entity.duel.clock.getClone(),movedAs:[...e,"Rule"]})});c(this,"push",(e,t,i,n)=>{this._records.push({cell:this.entity.fieldCell,face:this.entity.face,orientation:this.entity.orientation,movedAt:this.entity.duel.clock.getClone(),movedAs:e.getDistinct(),movedBy:t,actionOwner:i,chooser:n??i})});c(this,"pushByChainBlockInfo",(e,t)=>{this.push(t,e.action.entity,e.activator)});this.entity=e,this._records=[]}get records(){return this._records}get latestRecord(){return this._records.slice(-1)[0]}get previousPlaceRecord(){return this._records.findLast(e=>e.cell.cellType!==this.entity.fieldCell.cellType)??this._records[0]}get currentProcRecords(){return this._records.filter(e=>e.movedAt.procTotalSeq===this.entity.duel.clock.procTotalSeq)}}const wi=["SpellCounter","KaijuCounter","NamelessCounter"],Ti=["①","②","③","④"],da=["CycleFlip"],Pl=[...wi,...Ti,...da];class Fl{constructor(){c(this,"dic");c(this,"put",(e,t=1)=>{this.dic[e]=(this.dic[e]??0)+t});c(this,"remove",(e,t=1)=>{this.dic[e]=(this.dic[e]??0)-t});c(this,"getQty",e=>this.dic[e]??0);c(this,"corpseDisposal",()=>{Ti.forEach(e=>delete this.dic[e]),da.forEach(e=>delete this.dic[e])});c(this,"removeAllActualCounters",()=>{wi.forEach(e=>delete this.dic[e])});c(this,"removeAllWhenfaceDown",()=>{Ti.forEach(e=>delete this.dic[e]),wi.forEach(e=>delete this.dic[e])});c(this,"clear",()=>{Pl.forEach(e=>delete this.dic[e])});this.dic={}}}const ql={FusionSummon:"融合召喚",SyncroSummon:"シンクロ召喚",XyzSummon:"エクシーズ召喚",PendulumSummon:"ペンデュラム召喚",LinkSummon:"リンク召喚"},Ol={BattleDestroy:"戦闘破壊",EffectDestroy:"効果破壊",RuleDestroy:"ルール破壊"},Bl=r=>r+"Summon",Rl=["Card","Token","Avatar"],Cr=(r,e)=>{const t=r.monsterCategories??[],i=e.monsterCategories??[];for(const n of Wt.toReversed()){if(t.includes(n)&&!i.includes(n))return 1;if(!t.includes(n)&&i.includes(n))return-1}if(r.kind===e.kind){if(r.kind==="Monster"){if((r.link??0)!==(e.link??0))return(r.link??0)-(e.link??0);if((r.rank??0)!==(e.rank??0))return(r.rank??0)-(e.rank??0);if((r.level??0)!==(e.level??0))return(r.level??0)-(e.level??0);if((r.attack??0)!==(e.attack??0))return(r.attack??0)-(e.attack??0);if((r.defense??0)!==(e.defense??0))return(r.defense??0)-(e.defense??0)}return r.name.localeCompare(e.name,"Ja")}for(const n of gi){if(r.kind===n)return-1;if(e.kind===n)return 1}return r.name.localeCompare(e.name,"Ja")},ua=(r,e)=>Cr(r.origin,e.origin),ae=class ae{constructor(e,t,i,n,a,s){c(this,"seq");c(this,"origin");c(this,"entityType");c(this,"procFilterBundle");c(this,"numericOprsBundle");c(this,"cardRelationBundle");c(this,"moveLog");c(this,"counterHolder");c(this,"face");c(this,"orientation");c(this,"owner");c(this,"fieldCell");c(this,"_status");c(this,"_info");c(this,"actions",[]);c(this,"continuousEffects",[]);c(this,"_hasDisappeared",!1);c(this,"toString",()=>`《${this.nm}》`);c(this,"canBeTargetOfEffect",(e,t,i)=>this.procFilterBundle.operators.filter(n=>n.procTypes.some(a=>a==="EffectTarget")).every(n=>n.filter(e,t,i,[this])));c(this,"canBeSpecialSummoned",(e,t,i,n)=>{var a,s;return(a=this.origin.monsterCategories)!=null&&a.includes("NormalSummonOnly")||(s=this.origin.monsterCategories)!=null&&s.includes("SpecialSummon")&&!this.status.canReborn&&!this.info.isRebornable&&(this.fieldCell.cellType==="Graveyard"||this.fieldCell.cellType==="Banished")?!1:this.procFilterBundle.operators.filter(l=>l.procTypes.some(f=>f==="SpecialSummon"||f===e)).every(l=>l.filter(t,i,n,[this]))});c(this,"canBeTargetOfBattle",(e,t,i)=>this.procFilterBundle.operators.filter(n=>n.procTypes.some(a=>a==="BattleTarget")).every(n=>n.filter(e,t,i,[this])));c(this,"tryDestory",(e,t,i,n)=>(this.info.isDying=this.procFilterBundle.operators.filter(a=>a.procTypes.some(s=>s===e)).every(a=>a.filter(t,i,n,[this])),this.info.isDying&&(this.duel.log.info(`${this.toString()}を${Ol[e]}`,i.controller),this.info.causeOfDeath=[e],this.info.isKilledBy=i,this.info.isKilledByWhom=i.controller),this.info.isDying));c(this,"canBeMaterials",(e,t,i)=>this.procFilterBundle.operators.filter(n=>n.procTypes.some(a=>a===e)).every(n=>n.filter(t.entity.controller,t.entity,t,i)));c(this,"getIndexInCell",()=>{if(this.info.isVanished)return-1;const e=this.fieldCell.cardEntities.indexOf(this);if(e<0)throw new Oe("エンティティとセルの状態が矛盾している。",[this,this.fieldCell]);return e});c(this,"setBattlePosition",async(e,t,i,n)=>{let a=`表示形式の変更：${this.toString()}（${this.battlePositionName}⇒${Tr[e]}）`;const s=[...t];this.battlePosition==="Set"&&(s.push("Flip"),t.includes("Rule")&&(a=`${this.toString()}を反転召喚`,s.push("FlipSummon"))),this.moveAlone(this.fieldCell,e==="Set"?"FaceDown":"FaceUp",e==="Attack"?"Vertical":"Horizontal","Top",s,i,n,n),this.duel.log.info(a,n)});c(this,"setNonFieldMonsterPosition",async(e,t,i,n)=>{this.moveAlone(this.fieldCell,e==="FaceUp"?"FaceUp":"FaceDown",e==="XysMaterial"?"Horizontal":"Vertical","Top",t,i,n,n)});c(this,"setAsSpellTrap",async(e,t,i,n)=>{await this.moveAlone(e,"FaceDown","Vertical","Top",[...t,"SpellTrapSet"],i,n,n)});c(this,"activateSpellTrapFromHand",async(e,t,i,n)=>{await this.moveAlone(e,"FaceUp","Vertical","Top",[...t,"SpellTrapActivate"],i,n,n)});c(this,"activateSpellTrapOnField",async(e,t,i)=>{await this.moveAlone(this.fieldCell,"FaceUp","Vertical","Top",[...e,"SpellTrapActivate"],t,i,i)});c(this,"draw",async(e,t,i)=>await this.addToHand([...e,"Draw"],t,i));c(this,"addToHand",async(e,t,i)=>await this.moveAlone(this.owner.getHandCell(),"FaceDown","Vertical","Bottom",[...e],t,i,i));c(this,"release",async(e,t,i)=>(await this.sendToGraveyard([...e,"Release"],t,i),this.info.isVanished?void 0:this.fieldCell));c(this,"sendToGraveyard",(e,t,i)=>ae.sendManyToGraveyardForTheSameReason([this],e,t,i));c(this,"returnToDeck",(e,t,i,n)=>ae.returnManyToDeckForTheSameReason(e,[this],t,i,n));c(this,"banish",(e,t,i)=>ae.banishManyForTheSameReason([this],e,t,i));c(this,"summon",(e,t,i,n,a,s,l)=>ae.summonMany([{entity:this,to:e,chooser:l??s,pos:t}],i,n,a,s));c(this,"moveAlone",async(e,t,i,n,a,s,l,f)=>(await ae.moveMany([[this,e,t,i,n,a,s,l,f]],void 0),this.fieldCell));c(this,"_move",async(e,t,i,n,a,s,l,f)=>{if(!e)throw new Error("illegal argument: to");if(this.face=t,this.orientation=i,this.field.duel.clock.turn>0&&await this.field.duel.view.waitAnimation({entity:this,to:e,index:n,count:0}),e!==this.fieldCell){if(this.fieldCell.releaseEntities([this]),this.fieldCell.isPlayFieldCell&&!e.isPlayFieldCell&&(this.counterHolder.clear(),this.resetCauseOfDeath(),this.entityType==="Token")){this._hasDisappeared=!0,this.field.duel.log.info(`${this.nm}は消滅した。`,this.controller);return}e.acceptEntities([this],n),(e===this.isBelongTo||e.cellType==="Hand"||e.cellType==="Banished"&&this.face==="FaceDown")&&(this.resetInfo(),this.resetStatus())}return this.moveLog.push(a,s,l,f),e});c(this,"initForTurn",()=>{this.info.isSettingSickness=!1,this.info.attackCount=0,this.info.battlePotisionChangeCount=0,this.counterHolder.corpseDisposal()});c(this,"resetInfo",()=>{var e;this._info={isDying:!1,isPending:!1,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,isVanished:!1,isRebornable:((e=this.origin.monsterCategories)==null?void 0:e.union(aa).length)===0||(this.origin.canReborn??!1),isSettingSickness:!1,materials:[],effectTargets:{},willBeBanished:!1,willReturnToDeck:void 0,attackCount:0,battlePotisionChangeCount:0},this.counterHolder.clear()});c(this,"resetStatus",()=>{const e=sa.reduce((t,i)=>(t[i]=this.origin[i],t),{});this._status={...JSON.parse(JSON.stringify(this.origin)),origin:{...e},current:{...e},calculated:{...e},canAttack:!0,isEffective:!0,canDirectAttack:!1,attackCount:0,isSelectableForAttack:!0,canBeSyncroMaterial:!0,willBeBanished:!1}});c(this,"resetCauseOfDeath",()=>{this.info.isDying=!1,this.info.causeOfDeath=[],this.info.isKilledBy=void 0,this.info.isKilledByWhom=void 0});this.seq=ae.nextEntitySeq++,this.owner=e,this.fieldCell=t,this.entityType=i,this.origin=n,this._status=JSON.parse(JSON.stringify(n)),this.resetStatus(),this._info={attackCount:0,battlePotisionChangeCount:0,isDying:!1,isPending:!1,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,isVanished:!1,isRebornable:!0,isSettingSickness:!1,materials:[],effectTargets:{},willBeBanished:!1,willReturnToDeck:void 0},this.resetInfo(),this.face=a,this.orientation=s,this.procFilterBundle=new Tl(t.field.procFilterPool,this),this.numericOprsBundle=new Cl(t.field.numericStateOperatorPool,this),this.cardRelationBundle=new xl(t.field.cardRelationPool,this),t.acceptEntities([this],"Top"),this.counterHolder=new Fl,this.moveLog=new Ml(this),this.moveLog.pushForRuleAction(["Spawn"])}get isUnderControl(){return this.face==="FaceUp"||la.every(e=>e!==this.fieldCell.cellType)}get controller(){return this.fieldCell.owner??this.owner}get field(){return this.owner.duel.field}get duel(){return this.owner.duel.field.duel}get status(){return this._status}get info(){return this._info}get nm(){return this.status.name}get atk(){return this.status.calculated.attack}get def(){return this.status.calculated.defense}get lvl(){return this.status.calculated.level}get rank(){return this.status.calculated.rank}get attr(){return this.status.attribute?[this.status.attribute]:[]}get type(){return this.status.type?[this.status.type]:[]}get psL(){return this.status.calculated.pendulumScaleL}get psR(){return this.status.calculated.pendulumScaleR}get battlePosition(){if(this.isOnField&&this.status.kind==="Monster")return this.orientation==="Vertical"?"Attack":this.face==="FaceUp"?"Defense":"Set"}get battlePositionName(){const e=this.battlePosition;if(e)return Tr[e]}get wasMovedAtCurrentProc(){return this.field.duel.clock.procTotalSeq===this.moveLog.latestRecord.movedAt.procTotalSeq&&this.moveLog.records.slice(-2)[0].cell.cellType!==this.fieldCell.cellType}get wasMovedAtPreviousProc(){return this.field.duel.clock.procTotalSeq===this.moveLog.latestRecord.movedAt.procTotalSeq+1&&this.moveLog.records.slice(-2)[0].cell.cellType!==this.fieldCell.cellType}get wasMovedAtCurrentChain(){return this.field.duel.clock.isSameChain(this.moveLog.latestRecord.movedAt)&&this.moveLog.records.slice(-2)[0].cell.cellType!==this.fieldCell.cellType}get wasMovedAtPreviousChain(){return this.field.duel.clock.isPreviousChain(this.moveLog.latestRecord.movedAt)&&this.moveLog.records.slice(-2)[0].cell.cellType!==this.fieldCell.cellType}get wasMovedFrom(){return this.moveLog.previousPlaceRecord.cell}get isOnField(){return Xr.some(e=>e===this.fieldCell.cellType)}get isLikeContinuousSpell(){return this.status.spellCategory==="Continuous"||this.status.spellCategory==="Field"||this.status.spellCategory==="Equip"||this.status.trapCategory==="Continuous"}get isBelongTo(){return this.origin.monsterCategories&&this.origin.monsterCategories.union(Wt).length?this.owner.getExtraDeck():this.owner.getDeckCell()}get hasDisappeared(){return this._hasDisappeared}};c(ae,"nextEntitySeq",0),c(ae,"splitBattlePos",e=>({face:e==="Set"?"FaceDown":"FaceUp",orientation:e==="Attack"?"Vertical":"Horizontal"})),c(ae,"recreateArray",(e,t)=>{if(!t.length)return[];const i=e.getAllCells().flatMap(n=>n.entities);return t.map(n=>n.seq).map(n=>i.find(a=>a.seq===n)).filter(n=>n!==void 0)}),c(ae,"createPlayerEntity",e=>{const t=e.getHandCell();return new ae(e,t,"Duelist",{name:e.profile.name,kind:"Monster",wikiEncodedName:"%A5%D7%A5%EC%A5%A4%A5%E4%A1%BC"},"FaceUp","Vertical")}),c(ae,"createCardEntity",(e,t)=>{var f;const i=t.monsterCategories&&t.monsterCategories.union(Wt).length?e.getExtraDeck():e.getDeckCell(),n=new ae(e,i,"Card",nl(t),"FaceDown","Vertical");Object.hasOwn($e,n.origin.name)||e.duel.log.info(`未実装カード${t.name}がデッキに投入された。`,e);const a=$e[n.origin.name];let s=[],l=[];if(a.kind==="Monster"&&((f=a.monsterCategories)!=null&&f.includes("Normal")))s=[je,Fe,qe];else{const u=ki.get(n.origin.name);u&&(s=u.actions,l=u.continuousEffects??[])}return n.actions.push(...s.map(u=>wt.createNew(n,u))),n.continuousEffects.push(...l.map(u=>_i.createNew(n,u))),n}),c(ae,"waitCorpseDisposal",e=>ae.sendManyToGraveyard(e.field.getEntiteisOnField().filter(t=>t.info.isDying).map(t=>({entity:t,causedAs:t.info.causeOfDeath??[],causedBy:t.info.isKilledBy,activator:t.info.isKilledByWhom})))),c(ae,"sendManyToGraveyardForTheSameReason",(e,t,i,n)=>ae.bringManyToSameCellForTheSameReason("Graveyard","Top",e,"FaceUp","Vertical",t,i,n)),c(ae,"banishManyForTheSameReason",(e,t,i,n)=>ae.bringManyToSameCellForTheSameReason("Banished","Top",e,"FaceDown","Vertical",t,i,n)),c(ae,"returnManyToDeckForTheSameReason",(e,t,i,n,a)=>ae.bringManyToSameCellForTheSameReason("Deck",e,t,"FaceDown","Vertical",i,n,a)),c(ae,"returnManyToHandForTheSameReason",(e,t,i,n)=>ae.bringManyToSameCellForTheSameReason("Hand","Bottom",e,"FaceDown","Vertical",t,i,n)),c(ae,"sendManyToGraveyard",(e,t)=>ae.bringManyToSameCell("Graveyard","Top",e.map(i=>({...i,face:"FaceUp",orientation:"Vertical"})),t)),c(ae,"banishMany",(e,t)=>ae.bringManyToSameCell("Banished","Top",e.map(i=>({...i,face:"FaceUp",orientation:"Vertical"})),t)),c(ae,"bringManyToSameCellForTheSameReason",(e,t,i,n,a,s,l,f)=>ae.bringManyToSameCell(e,t,i.map(u=>({entity:u,face:n,orientation:a,causedAs:s,causedBy:l,activator:f})))),c(ae,"bringManyToSameCell",(e,t,i,n)=>ae.moveMany(i.map(a=>[a.entity,a.entity.field.getCells(e).filter(s=>s.owner===a.entity.owner)[0],a.face,a.orientation,t,a.causedAs,a.causedBy,a.activator,a.activator]),n)),c(ae,"moveMany",async(e,t)=>{if(!e.length)return;const i=e[0][0].duel,n=e.map(([l])=>l).filter(l=>!(t??[]).includes(l)),a=[...n,...i.field.getEntiteisOnField().filter(l=>l.info.isDying)];console.log(n);const s=new Map;for(e.forEach(([l,f,u,d,y,...h])=>{let o=f,p=u,m=y,_=d;l.info.willBeBanished&&(console.log(l),o=l.owner.getBanished(),p="FaceUp",_="Vertical"),l.info.willReturnToDeck&&(o=l.isBelongTo,p="FaceDown",m=l.info.willReturnToDeck,_="Vertical"),l.isBelongTo.cellType==="ExtraDeck"&&(o.cellType==="Hand"||o.cellType==="Deck")&&(o=l.isBelongTo,p="FaceDown",_="Vertical"),s.set(o,[[l,o,p,_,m,...h],...s.get(o)??[]])});;){const l=Array.from(s.values()).map(u=>u.pop()).filter(u=>u!==void 0).map(([u,...d])=>u._move(...d));if(!l.length)break;await Promise.all(l),i.field.cardRelationPool.excludesExpired();const f=i.field.getEntiteisOnField().filter(u=>u.info.isDying).filter(u=>!a.includes(u)).map(u=>({entity:u,causedAs:u.info.causeOfDeath??[],causedBy:u.info.isKilledBy,activator:u.info.isKilledByWhom}));f.length&&await ae.sendManyToGraveyard(f,a)}ae.settleEntityMove(i)}),c(ae,"summonMany",async(e,t,i,n,a)=>{if(!e.length)return;const s={Attack:"AttackSummon",Defense:"DefenseSummon",Set:"SetSummon"};await Promise.all(e.map(async({entity:l,to:f,pos:u,chooser:d})=>{if(t==="NormalSummon"||t==="AdvanceSummon"){const o=t==="AdvanceSummon"?"アドバンス":"";u==="Attack"?l.field.duel.log.info(`${l.toString()}を${o}召喚`,d):l.duel.log.info(`${l.toString()}を${o}セット`,d),i.includes("Rule")?d.info.ruleNormalSummonCountQty++:d.info.effectNormalSummonCountQty++}else t==="SpecialSummon"?l.duel.log.info(`${l.toString()}を${Tr[u]}で特殊召喚`,d):l.duel.log.info(`${l.toString()}を${Tr[u]}で${ql[t]}！`,d),d.info.specialSummonCountQty++;l.info.battlePotisionChangeCount=1;const{face:y,orientation:h}=ae.splitBattlePos(u);await l._move(f,y,h,"Top",[t,s[u],...i],n,a,d)})),e.map(l=>l.chooser).forEach(l=>{t==="NormalSummon"||t==="AdvanceSummon"?i.includes("Rule")?l.info.ruleNormalSummonCount++:l.info.effectNormalSummonCount++:l.info.specialSummonCount++}),ae.settleEntityMove(e[0].entity.duel)}),c(ae,"settleEntityMove",e=>{e.distributeOperators();const t=e.field.getAllEntities().filter(i=>i.wasMovedAtCurrentProc);t.filter(i=>!i.isOnField).forEach(i=>i.resetInfo()),t.flatMap(i=>i.continuousEffects).forEach(i=>i.updateState())});let Pe=ae;class pn{constructor(e,t,i,n,a){c(this,"duel");c(this,"seat");c(this,"_entity");c(this,"profile");c(this,"deckInfo");c(this,"info");c(this,"infoOrigin");c(this,"status");c(this,"statusOrigin");c(this,"duelistType");c(this,"lifeLog");c(this,"_lp");c(this,"initForDrawPhase",()=>{this.info={...this.infoOrigin}});c(this,"canSummon",(e,t,i,n,a,s)=>this.entity.procFilterBundle.operators.filter(l=>l.procTypes.some(f=>f===n)).every(l=>l.filter(e,t,i,s))?a.filter(l=>this.entity.procFilterBundle.operators.filter(f=>f.procTypes.some(u=>u===Bl(l))).every(f=>f.filter(e,t,i,s))):[]);c(this,"battleDamage",(e,t)=>this.setLp(this._lp-e,t,"BattleDamage"));c(this,"effectDamage",(e,t)=>this.setLp(this._lp-e,t,"EffectDamage"));c(this,"lostLp",(e,t)=>this.setLp(this._lp-e,t,"Lost"));c(this,"payLp",(e,t)=>this.setLp(this._lp-e,t,"Pay"));c(this,"heal",(e,t)=>this.setLp(this._lp+e,t,"Heal"));c(this,"setLp",(e,t,i)=>{const n={clock:this.duel.clock,reason:i||"Set",beforeLp:this._lp,afterLp:e,entity:t};return this.lifeLog.push(n),this._lp=e,this.duel.log.info(`ライフポイント変動：${n.afterLp-n.beforeLp}（${n.beforeLp} ⇒ ${n.afterLp}）`,this),n});c(this,"getOpponentPlayer",()=>this.duel.firstPlayer===this?this.duel.secondPlayer:this.duel.firstPlayer);c(this,"getHandCell",()=>this.duel.field.getCells("Hand").filter(e=>e.owner===this)[0]);c(this,"getDeckCell",()=>this.duel.field.getCells("Deck").filter(e=>e.owner===this)[0]);c(this,"getExtraDeck",()=>this.duel.field.getCells("ExtraDeck").filter(e=>e.owner===this)[0]);c(this,"getGraveyard",()=>this.duel.field.getCells("Graveyard").filter(e=>e.owner===this)[0]);c(this,"getFieldZone",()=>this.duel.field.getCells("FieldSpellZone").filter(e=>e.owner===this)[0]);c(this,"getBanished",()=>this.duel.field.getCells("Banished").filter(e=>e.owner===this)[0]);c(this,"getMonsterZones",()=>this.duel.field.getCells("MonsterZone").filter(e=>e.owner===this));c(this,"getExtraMonsterZones",()=>this.duel.field.getCells("ExtraMonsterZone").filter(e=>{var t;return((t=e.cardEntities[0])==null?void 0:t.controller)===this}));c(this,"getSpellTrapZones",()=>this.duel.field.getCells("SpellAndTrapZone").filter(e=>e.owner===this));c(this,"getEmptyMonsterZones",()=>this.getMonsterZones().filter(e=>e.cardEntities.length===0));c(this,"getEmptyExtraZones",()=>this.getExtraMonsterZones().length===0?this.getMonsterZones().filter(e=>e.cardEntities.length===0):[]);c(this,"getAvailableMonsterZones",()=>this.getMonsterZones().filter(e=>e.isAvailable));c(this,"getAvailableExtraZones",()=>this.getExtraMonsterZones().length===0?this.duel.field.getCells("ExtraMonsterZone").filter(e=>e.isAvailable):[]);c(this,"getAvailableSpellTrapZones",()=>this.getSpellTrapZones().filter(e=>e.isAvailable));c(this,"getReleasableMonsters",()=>this.getMonstersOnField());c(this,"getMonstersOnField",()=>this.duel.field.getMonstersOnField().filter(e=>e.controller===this));c(this,"getEntiteisOnField",()=>this.duel.field.getEntiteisOnField().filter(e=>e.controller===this));c(this,"getAttackTargetMonsters",()=>this.duel.field.getMonstersOnField().filter(e=>e.status.isSelectableForAttack&&e.controller!==this));c(this,"pushDeck",()=>{this.deckInfo.cardNames.map(e=>$e[e]).filter(e=>e).forEach(e=>Pe.createCardEntity(this,e)),this.duel.log.info(`デッキをセット。メイン${this.getDeckCell().cardEntities.length}枚。エクストラ${this.getExtraDeck().cardEntities.length}枚。`,this)});c(this,"draw",async(e,t,i)=>{var s;if(e<1)return;const n=this.getDeckCell(),a=[];for(const l of Array(e)){if(!n.cardEntities.length)throw this.duel.log.info(a.length>0?`デッキからカードを${e}枚ドローしようとしたが、${a.length}枚しかドローできなかった。${a}`:"デッキからカードをドローできなかった。",this),this.duel.isEnded=!0,this.setLp(0),new Ct(this.getOpponentPlayer());const f=n.cardEntities[0];await f.draw(t?["Effect"]:["Rule"],t,i),console.log(f),a.push(((s=f.origin)==null?void 0:s.name)||"!名称取得失敗!")}this.duel.log.info(`デッキからカードを${a.length}枚ドロー。${a}。`,this)});c(this,"shuffleDeck",()=>{this.getDeckCell().shuffle(),this.duel.log.info("デッキをシャッフル。",this)});c(this,"discard",async(e,t,i,n,a,s)=>{const l=a||(()=>!0),f=this.getHandCell().cardEntities.filter(l);if(f.length<e)return[];let u=[];return(n||this).duelistType==="NPC"?u=f.randomPick(e):u=await this.duel.view.waitSelectEntities(n||this,f,e,d=>d.length===e,`${e}枚カードを捨てる。`,!1)||[],await Pe.sendManyToGraveyardForTheSameReason(u,["Discard",...t],i,s),this.duel.log.info(`手札からカードを${u.length}枚捨てた。${u.map(d=>{var y;return(y=d.origin)==null?void 0:y.name})}。`,this),u});c(this,"summon",async(e,t,i,n,a,s,l=!1)=>{let f=t.randomPick(1)[0],u=i.randomPick(1)[0];if((i.length>1||t.length>1)&&this.duelistType!=="NPC"){const d=i.length>1?"カードを召喚先へドラッグ。":"表示形式を選択。",y=t.map(m=>wt.createDammyAction(e,m,i,m)),h=this.duel.view.modalController.selectAction(this.duel.view,{title:d,actions:y,cancelable:!1}),o=this.duel.view.waitSubAction(this,y,d,l).then(m=>m.action),p=await Promise.any([h,o]);if(!p&&!l)throw new Oe("",p);if(!p)return;u=p.cell||u,f=p.pos||f}return console.log(u,f,n,a,s),await e.summon(u,f,n,a,s,this),e});this.duel=e,this.seat=t,this.profile=i,this.duelistType=n,this.deckInfo=a,this.lifeLog=[],this.infoOrigin={maxRuleNormalSummonCount:1,ruleNormalSummonCount:0,ruleNormalSummonCountQty:0,effectNormalSummonCount:0,effectNormalSummonCountQty:0,specialSummonCount:0,specialSummonCountQty:0},this.info={...this.infoOrigin},this.statusOrigin={maxSpecialSummonCount:Number.MAX_VALUE,canDrawByEffect:!0,canSearchFromDeck:!0,canDiscardAsCost:!0,canDiscardAsEffect:!0},this.status={...this.statusOrigin},this._lp=8e3}get entity(){const e=this.getHandCell().entities.find(t=>t.entityType==="Duelist");return e||Pe.createPlayerEntity(this)}get lp(){return this._lp}get isTurnPlayer(){return this.duel.getTurnPlayer()===this}get canDraw(){return!0}get canAddToHandFromDeck(){return!0}}class Nl{constructor(e){c(this,"cells");c(this,"duel");c(this,"procFilterPool");c(this,"numericStateOperatorPool");c(this,"cardRelationPool");c(this,"getAllCells",()=>this.cells.flat());c(this,"getCells",(...e)=>this.getAllCells().filter(t=>e.includes(t.cellType)));c(this,"getAllEntities",()=>this.getAllCells().map(e=>e.entities).flat());c(this,"getAllCardEntities",()=>this.getAllCells().map(e=>e.cardEntities).flat());c(this,"getMonstersOnField",()=>this.getCells(...Br).map(e=>e.cardEntities).filter(e=>e.length>0).map(e=>e[0]));c(this,"getEntiteisOnField",()=>this.getCells(...Xr).map(e=>e.cardEntities).filter(e=>e.length>0).map(e=>e[0]));c(this,"getEntities",e=>this.getAllEntities().filter(t=>t.controller===e));c(this,"drawAtSameTime",async(e,t,i,n,a,s)=>{const l=[],f=[],u=[e.draw(t,a,s),i.draw(n,a,s)].map(d=>d.catch(y=>{y instanceof Ct?y.winner&&l.push(y.winner):f.push(y)}));if(await Promise.all(u),f.length)throw new Oe("ドロー処理で想定されない例外が発生した。",e,t,i,n,a,...f);if(l.length!==0)throw l.length===1?new Ct(l[0]):new Ct});c(this,"sendToGraveyard",async(e,t,i,n,a,s,l,f)=>{if(n>0&&i.length<n)return;const u=await this.duel.view.waitSelectEntities(t,i,n,a,e,f);if(u)return await Pe.sendManyToGraveyard(u.map(d=>({entity:d,causedAs:s,causedBy:l,activator:t}))),this.duel.log.info(`${u.map(d=>d.status.name).join(", ")}を墓地に送った（${s.getDistinct().join(", ")}）。`,t),u});c(this,"release",async(e,t,i,n,a,s,l,f)=>{if(i>0&&t.length<i)return;const u=await this.duel.view.waitSelectEntities(e,t,i,y=>(l||y.length>0)&&(i<0||y.length===i),"リリースするモンスターを選択",f);if(!u)return;const d=[];for(const y of u)await y.release(["Release",n,...a],s,e),d.push(y);return this.duel.log.info(`${d.map(y=>y.status.name).join(", ")}をリリース（${d.flatMap(y=>y.moveLog.latestRecord.movedAs).getDistinct().join(", ")}）。`,e),d});c(this,"activateSpellTrapFromHand",async(e,t,i,n,a,s=!1)=>{const l=a??(n==null?void 0:n.controller)??e.controller;let f=t.randomPick(1)[0];if(t.length>1&&l.duelistType!=="NPC"){const u=[wt.createDammyAction(e,"カードの発動",t,void 0)];this.duel.view.modalController.selectAction(this.duel.view,{title:"カードを魔法罠ゾーンへドラッグ",actions:u,cancelable:!1});const d=await this.duel.view.waitSubAction(l,u,"カードを魔法罠ゾーンへドラッグ。",s),y=d.action;if(!y&&!s)throw new Oe("",d);if(!y)return;f=y.cell||f}return await e.activateSpellTrapFromHand(f,i,n,l),e});c(this,"setSpellTrap",async(e,t,i,n,a=!1)=>{let s=t[0];const l=n??(i==null?void 0:i.controller)??e.controller;if(t.length>1&&l.duelistType!=="NPC"){const f=[wt.createDammyAction(e,"セット",t)],u=this.duel.view.modalController.selectAction(this.duel.view,{title:"カードをセット先へドラッグ",actions:f,cancelable:a}),d=this.duel.view.waitSubAction(l,f,"カードをセット先へドラッグ",a),y=await Promise.any([u,d.then(h=>h.action)]);if(!y&&!a)throw new Oe("",y);if(!y)return;s=y.cell||s}return await e.setAsSpellTrap(s,["SpellTrapSet"],i,l),this.duel.log.info(`${e.status.name}をセット（SpellTrapSet）。`,n??(i==null?void 0:i.controller)??e.controller),s});this.duel=e,this.cells=[...Array(7)].map(()=>[]);for(const t of Object.keys(mi).map(Number))for(const i of Object.keys(mi[t]).map(Number))this.cells[t][i]=new sl(this,t,i,t<3?e.duelists.Above:t>3?e.duelists.Below:i===0?e.duelists.Above:i===6?e.duelists.Below:void 0);this.procFilterPool=new wl,this.numericStateOperatorPool=new bl,this.cardRelationPool=new Al}}let Ll=class{constructor(e){c(this,"onUpdateEvent",new Ge);c(this,"nextSeq");c(this,"records",[]);c(this,"duel");c(this,"dispose",()=>{this.onUpdateEvent.clear()});c(this,"error",e=>{console.error(e);const t=["エラー発生"];e instanceof Error?(e instanceof Oe&&(t.push("-- エラーメッセージ --"),t.push(e.message),t.push("-- 関連オブジェクト --"),e.items.forEach(i=>t.push(JSON.stringify(i)))),t.push("-- エラー名称 --"),t.push(e.name||"エラー名称取得失敗"),t.push("-- スタックトレース --"),t.push(e.stack||"スタックトレース取得失敗")):(t.push("-- エラー型特定失敗 --"),t.push(JSON.stringify(e))),this.info(t)});c(this,"info",(e,t)=>{const i=Array.isArray(e)?e.join(`
`):e;this.records.push({seq:this.nextSeq++,turn:this.duel.clock.turn,phase:this.duel.phase,phaseStep:this.duel.phaseStep,clock:this.duel.clock,duelist:t,text:i}),this.onUpdateEvent.trigger()});this.nextSeq=0,this.duel=e}get onUpdate(){return this.onUpdateEvent.expose()}};const hn=["DuelEntitiesSelector","DuelActionSelector","DuelTextSelector"];class Hl{constructor(e){c(this,"onUpdateEvent",new Ge);c(this,"states");c(this,"view");c(this,"cancelAll",()=>{hn.forEach(e=>this.states[e]="Disable"),console.info(this,"cancelAll"),this.onUpdateEvent.trigger()});c(this,"duelEntitiesSelectorArg",{title:"対象を選択",entities:[],validator:()=>!0,qty:-1,cancelable:!1});c(this,"duelEntitiesSelectorValue");c(this,"duelEntitiesSelectorResolve",()=>{});c(this,"selectDuelEntities",async e=>(this.duelEntitiesSelectorArg=e,this.states.DuelEntitiesSelector="Shown",this.onUpdateEvent.trigger(),new Promise(t=>{this.duelEntitiesSelectorResolve=i=>{this.states.DuelEntitiesSelector="Disable",this.onUpdateEvent.trigger(),t(i)}})));c(this,"cardActionSelectorArg",{title:"カード操作を選択。",actions:[],cancelable:!1});c(this,"cardActionSelectorResolve",()=>{});c(this,"cardActionSelectorValue");c(this,"selectAction",async(e,t)=>(this.cardActionSelectorArg=t,this.states.DuelActionSelector="Shown",e.onWaitEnd.append(this.cancelAll),this.onUpdateEvent.trigger(),new Promise(i=>{this.cardActionSelectorResolve=n=>{console.log(n),this.states.DuelActionSelector="Disable",e.onWaitEnd.remove(this.cancelAll),this.onUpdateEvent.trigger(),i(n)}})));c(this,"duelTextSelectorArg",{title:"カード操作を選択。",choises:[],cancelable:!1});c(this,"duelTextSelectorResolve",()=>{});c(this,"duelTextSelectorValue");c(this,"selectText",async(e,t)=>(this.duelTextSelectorArg=t,this.states.DuelTextSelector="Shown",e.onWaitEnd.append(this.cancelAll),this.onUpdateEvent.trigger(),new Promise(i=>{this.duelTextSelectorResolve=n=>{console.log(n),this.states.DuelTextSelector="Disable",e.onWaitEnd.remove(this.cancelAll),this.onUpdateEvent.trigger(),i(n)}})));this.view=e,this.states=hn.reduce((t,i)=>(t[i]="Disable",t),{})}get onUpdate(){return this.onUpdateEvent.expose()}}const $l=r=>new Promise(e=>setTimeout(e,r)),Ul=()=>{let r=()=>{},e=()=>{};return{promise:new Promise((i,n)=>{r=i,e=n}),resolve:r,reject:e}};class Zl{constructor(e){c(this,"onDuelUpdateEvent",new Ge);c(this,"requireUpdate",()=>{this.onDuelUpdateEvent.trigger()});c(this,"onWaitStartEvent",new Ge);c(this,"onWaitEndEvent",new Ge);c(this,"onDragStartEvent",new Ge);c(this,"onDragEndEvent",new Ge);c(this,"onAnimationStartEvent",new Ge);c(this,"onShowCardEntityEvent",new Ge);c(this,"duel");c(this,"modalController");c(this,"message");c(this,"waitMode");c(this,"infoBoardState");c(this,"infoBoardCell");c(this,"removeSvelteInfo",e=>{const t={...e};return t.selectedEntities&&(t.selectedEntities=Pe.recreateArray(this.duel.field,t.selectedEntities)),t});c(this,"getCell",(e,t)=>this.duel.field.cells[e][t]);c(this,"showCardInfo",(e,t)=>{this.onShowCardEntityEvent.trigger({card:e,mode:t})});c(this,"dispose",()=>{this.onDragStartEvent.clear(),this.onDragEndEvent.clear(),this.onDuelUpdateEvent.clear(),this.onWaitStartEvent.clear(),this.onWaitEndEvent.clear()});c(this,"waitFieldAction",async(e,t)=>{if(console.log(e),this.duel.getTurnPlayer().duelistType==="NPC"){const i=e.toSorted((n,a)=>(a.entity.atk||0)-(n.entity.atk||0)).find(n=>n.playType==="NormalSummon"||n.playType==="SpecialSummon"||n.playType==="CardActivation");return i?{action:i}:{phaseChange:this.duel.nextPhaseList[0]}}return await this._waitDuelistAction(e,"SelectFieldAction",t)});c(this,"waitQuickEffect",async(e,t,i,n)=>{if(t.length===0)return;if(e.duelistType==="NPC")return t.randomPick(1)[0];const a=[];return a.push(this.modalController.selectAction(this,{title:i,actions:t,cancelable:n}).then(s=>s&&s)),a.push(this._waitDuelistAction(t,"SelectAction",this.message).then(s=>(this.infoBoardState="Log",s.action))),await Promise.any(a)});c(this,"waitSubAction",async(e,t,i,n=!1)=>{if(e.duelistType==="NPC")throw Error("Not implemented");return await this._waitDuelistAction(t,"SelectAction",i,void 0,void 0,void 0,n)});c(this,"waitSelectEntities",async(e,t,i,n,a,s=!1)=>{let l=[];if(i&&t.length===i)return[...t];if(e.duelistType==="NPC"){for(;!n(l);){const u=i&&i>0?i:Math.floor(Math.random()*t.length)+1;l=t.randomPick(u)}return l}this.waitMode=t.every(u=>(u.fieldCell.cellType==="MonsterZone"||u.fieldCell.cellType==="ExtraMonsterZone")&&u.getIndexInCell()===0||u.fieldCell.cellType==="Hand"&&u.controller===e)?"SelectFieldEntities":"SelectEntities",console.log(this.waitMode);const f=await this._waitDuelistAction([],this.waitMode,a,t,i,n,s);return console.log(f),f.selectedEntities});c(this,"_waitDuelistAction",async(e,t,i,n,a,s,l=!1)=>{this.waitMode=t,this.message=i,this.onDuelUpdateEvent.trigger();const f=Ul(),u={resolve:f.resolve,enableActions:e,qty:a,entitiesValidator:s||(()=>!1),selectableEntities:n||[]};n&&s&&this.waitMode==="SelectEntities"&&(u.duelEntitiesSelectorArg={title:i,entities:n,validator:s,qty:a??-1,cancelable:!1}),this.onWaitStartEvent.trigger(u);const d=await f.promise;if(console.log(d),this.waitMode="None",this.onWaitEndEvent.trigger(),d.surrender)throw new Ct(this.duel.duelists.Above);if(!l&&d.cancel)throw new Oe("キャンセル不可のアクションがキャンセルされた。",d,e,t,n);return this.infoBoardState="Log",this.removeSvelteInfo(d)});c(this,"waitSelectSummonDest",async(e,t,i,n)=>{const a=t.length>1?"カードを召喚先へドラッグ。":"表示形式を選択。",s=i.map(d=>wt.createDammyAction(e,d,t,d)),l=this.modalController.selectAction(e.field.duel.view,{title:a,actions:s,cancelable:!1}),f=this.waitSubAction(e.controller,s,a,n).then(d=>d.action),u=await Promise.any([l,f]);if(!u&&!n)throw new Oe("キャンセル不可のアクションがキャンセルされた。",u);if(u){if(!u.cell)throw new Oe("召喚先のセルが指定されなかった。",u);if(!u.pos)throw new Oe("表示形式が指定されなかった。",u);return{dest:u.cell,pos:u.pos}}});c(this,"waitSelectText",async(e,t,i=!1)=>this.duel.view.modalController.selectText(this.duel.view,{title:t,choises:e,cancelable:i}));c(this,"waitAnimation",async e=>(this.onDuelUpdateEvent.trigger(),new Promise(t=>this.onAnimationStartEvent.trigger({...e,resolve:t}))));c(this,"setDraggingActions",e=>{this.onDragStartEvent.trigger(e),this.requireUpdate()});c(this,"removeDraggingActions",()=>{this.onDragEndEvent.trigger()});this.duel=e,this.message="",this.waitMode="None",this.infoBoardState="Log",this.infoBoardCell=e.duelists.Below.getExtraDeck(),this.modalController=new Hl(this)}get onDuelUpdate(){return this.onDuelUpdateEvent.expose()}get onWaitStart(){return this.onWaitStartEvent.expose()}get onWaitEnd(){return this.onWaitEndEvent.expose()}get onDragStart(){return this.onDragStartEvent.expose()}get onDragEnd(){return this.onDragEndEvent.expose()}get onAnimation(){return this.onAnimationStartEvent.expose()}get onShowCardEntity(){return this.onShowCardEntityEvent.expose()}}class jl{constructor(){c(this,"onTotalProcSeqChangeEvent",new Ge);c(this,"_turn",0);c(this,"_phaseSeq",0);c(this,"_stepSeq",0);c(this,"_chainSeq",0);c(this,"_chainBlockSeq",0);c(this,"_procSeq",0);c(this,"_procTotalSeq",0);c(this,"incrementTurn",()=>{this._turn++,this._phaseSeq=0,this._stepSeq=0,this._chainSeq=0,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq()});c(this,"incrementPhaseSeq",()=>{this._phaseSeq++,this._stepSeq=0,this._chainSeq=0,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq()});c(this,"incrementStepSeq",()=>{this._stepSeq++,this._chainSeq=0,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq()});c(this,"incrementChainSeq",()=>{this._chainSeq++,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq()});c(this,"incrementChainBlockSeq",()=>{this._chainBlockSeq++,this._procSeq=0,this.incrementTotalProcSeq()});c(this,"incrementProcSeq",()=>{this._procSeq++,this.incrementTotalProcSeq()});c(this,"incrementTotalProcSeq",()=>{this._procTotalSeq++,this.onTotalProcSeqChangeEvent.trigger(this.procTotalSeq)});c(this,"toString",()=>`${this.procTotalSeq}(t${this.turn}-p${this.phaseSeq}-ps${this.stepSeq}-c${this.chainSeq}-cb${this.chainBlockSeq}-p${this.procSeq})`);c(this,"getClone",()=>({turn:this.turn,phaseSeq:this.phaseSeq,stepSeq:this.stepSeq,chainSeq:this.chainSeq,chainBlockSeq:this.chainBlockSeq,procSeq:this.procSeq,procTotalSeq:this.procTotalSeq}));c(this,"isSameChain",e=>this.turn===e.turn&&this.phaseSeq===e.phaseSeq&&this.stepSeq===e.stepSeq&&this.chainSeq===e.chainSeq);c(this,"isPreviousChain",e=>this.turn===e.turn&&this.phaseSeq===e.phaseSeq&&this.stepSeq===e.stepSeq&&this.chainSeq===e.chainSeq+1);c(this,"isPreviousProc",e=>this.procTotalSeq===e.procTotalSeq+1)}get onTotalProcSeqChange(){return this.onTotalProcSeqChangeEvent.expose()}get turn(){return this._turn}get phaseSeq(){return this._phaseSeq}get stepSeq(){return this._stepSeq}get chainSeq(){return this._chainSeq}get chainBlockSeq(){return this._chainBlockSeq}get procSeq(){return this._procSeq}get procTotalSeq(){return this._procTotalSeq}}class Gl{constructor(e){c(this,"nextSeq");c(this,"records",[]);c(this,"duel");c(this,"push",(e,t)=>{this.records.push({seq:this.nextSeq++,clock:this.duel.clock.getClone(),activator:e,cardAction:t})});this.nextSeq=0,this.duel=e}}class Ct extends Error{constructor(t){const i=t?`デュエルが終了した。勝者：${t.profile.name}`:"デュエルが終了した。ドロー。";super(i);c(this,"winner");this.winner=t}}class Oe extends Error{constructor(t,...i){super(t);c(this,"message");c(this,"items");this.message=t,this.items=i}}class Dt extends Oe{constructor(...e){super("キャンセル不可のアクションがキャンセルされた。",...e)}}class Vl{constructor(e,t,i,n,a,s){c(this,"view");c(this,"log");c(this,"cardActionLog");c(this,"clock");c(this,"phase");c(this,"phaseStep");c(this,"nextPhaseList");c(this,"field");c(this,"attackingMonster");c(this,"targetForAttack");c(this,"_chainBlockInfos");c(this,"duelists");c(this,"priorityHolder");c(this,"isEnded");c(this,"coin",!1);c(this,"distributeOperators",()=>{this.field.procFilterPool.distributeAll(),this.field.cardRelationPool.distributeAll(),this.field.numericStateOperatorPool.distributeAll(),this.field.numericStateOperatorPool.calcStateAll(this)});c(this,"getTurnPlayer",()=>this.clock.turn%2===0?this.secondPlayer:this.firstPlayer);c(this,"getNonTurnPlayer",()=>this.clock.turn%2===0?this.firstPlayer:this.secondPlayer);c(this,"main",async(e=Math.random()>.5,t=[],i=[])=>{console.info("main start!"),this.coin=e,this.priorityHolder=this.firstPlayer,this.log.info("【デュエル開始】"),this.log.info(`先攻：${this.firstPlayer.profile.name}`),Object.values(this.duelists).forEach(a=>a.pushDeck()),Object.values(this.duelists).forEach(a=>a.shuffleDeck()),[{hand:t,duelist:this.duelists.Below},{hand:i,duelist:this.duelists.Above}].forEach(a=>{a.hand.length&&a.hand.forEach(s=>{const l=a.duelist.getDeckCell().cardEntities.find(f=>f.origin.name===s);if(!l){this.log.info(`初手操作により${s}を手札に加えようとしたが、デッキに存在しない。`);return}l.addToHand(["System"],void 0,void 0),this.log.info(`初手操作により${l.toString()}を手札に加えた`,a.duelist)})}),await Promise.all(Object.values(this.duelists).map(a=>a.draw(5-a.getHandCell().cardEntities.length,void 0,void 0))),this.moveNextPhase("draw"),this.view.requireUpdate();try{for(;!this.isEnded&&(this.phase==="draw"?await this.procDrawPhase():this.phase==="standby"?await this.procStanbyPhase():this.phase==="main1"?await this.procMainPhase():this.phase==="battle"?await this.procBattlePhase():this.phase==="main2"?await this.procMainPhase():this.phase==="end"&&await this.procEndPhase(),!(this.clock.turn>1e3)););}catch(a){a instanceof Ct?(console.info(a),this.isEnded=!0,this.log.info(a.winner?`デュエル終了。勝者${a.winner.profile.name}`:"引き分け")):a instanceof Error&&this.log.error(a)}finally{this.view.requireUpdate(),this.view.dispose(),this.log.dispose()}});c(this,"moveNextPhase",e=>{this.clock.turn<1?this.phase="draw":e==="draw"?this.log.info("ターン終了。",this.getTurnPlayer()):this.log.info(`フェイズ移行（${this.phase}→${e}）`,this.getTurnPlayer()),e==="draw"?this.clock.incrementTurn():this.clock.incrementPhaseSeq(),this.phase=e,this.phaseStep=void 0,this.phase==="main2"||this.clock.turn===1?this.nextPhaseList=["end"]:this.phase==="battle"?this.nextPhaseList=["main2"]:this.phase==="main1"?this.nextPhaseList=["battle","end"]:this.nextPhaseList=[]});c(this,"declareAnAttack",(e,t)=>{this.attackingMonster=e,this.targetForAttack=t,e.info.attackCount++,this.log.info(`攻撃宣言：${e.status.name} ⇒ ${t.status.name}`,e.controller)});c(this,"procDrawPhase",async()=>{for(Object.values(this.duelists).forEach(e=>e.initForDrawPhase()),this.log.info("ドローフェイズ開始。",this.getTurnPlayer()),this.clock.turn===1?this.log.info("先攻プレイヤーはドローできない。",this.getTurnPlayer()):await this.getTurnPlayer().draw(1,void 0,void 0);await this.procChainBlock(void 0,void 0););this.field.getEntiteisOnField().forEach(e=>e.initForTurn()),this.moveNextPhase("standby")});c(this,"procStanbyPhase",async()=>{for(;await this.procChainBlock(void 0,void 0););this.moveNextPhase("main1")});c(this,"procMainPhase",async()=>{for(;;){this.priorityHolder=this.getTurnPlayer();const e=await this.view.waitFieldAction(this.getEnableActions(["NormalSummon","SpellTrapSet","SpecialSummon","ChangeBattlePosition","IgnitionEffect","QuickEffect","CardActivation"],["Normal","Quick","Counter"],[]),"あなたの手番です。");if(console.log(e),e&&e.action){if([...ll].includes(e.action.playType)){console.log("is not chainable",e);const i=await e.action.prepare(e.action.cell,[],!0);if(i===void 0)continue;await e.action.execute(i,this.chainBlockInfos),this.clock.incrementChainSeq()}else console.log("is chainable",e),await this.procChainBlock(e.action,void 0);for(;await this.procChainBlock(void 0,void 0););continue}const t=e.phaseChange;if(t){this.priorityHolder=this.getNonTurnPlayer();const i=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(["QuickEffect","TriggerEffect"],["Quick","Counter"],[]),"",!0);if(i){for(await this.procChainBlock(i,void 0);await this.procChainBlock(void 0,void 0););continue}this.moveNextPhase(t);return}}});c(this,"procBattlePhase",async()=>{await this.procBattlePhaseStartStep(),await this.procBattlePhaseBattleStep(),await this.procBattlePhaseEndStep()});c(this,"procBattlePhaseStartStep",async()=>{for(this.phaseStep="start",this.priorityHolder=this.getTurnPlayer(),this.attackingMonster=void 0,this.targetForAttack=void 0;await this.procChainBlock(void 0,void 0););});c(this,"procBattlePhaseBattleStep",async()=>{for(;;){this.phaseStep="battle",this.priorityHolder=this.getTurnPlayer();const e=await this.view.waitFieldAction(this.getEnableActions(["Battle"],["Normal"],[]),"攻撃モンスターと対象を選択。");if(e.phaseChange)break;if(e.action){const t=await e.action.prepare(e.action.cell,[],!0);if(!t)continue;for(await e.action.execute(t,[]),this.clock.incrementChainSeq();await this.procChainBlock(void 0,void 0););this.clock.incrementStepSeq(),await this.procBattlePhaseDamageStep(t)}}this.clock.incrementStepSeq()});c(this,"procBattlePhaseDamageStep",async e=>{this.phaseStep="damage";const t=this.attackingMonster,i=this.targetForAttack;if(!t||t.atk===void 0)throw new Oe("想定されない状態",this.attackingMonster,this.targetForAttack);if(!i)throw new Oe("想定されない状態",this.attackingMonster,this.targetForAttack);this.log.info("ダメージステップ開始時",this.getTurnPlayer()),this.log.info("ダメージ計算前",this.getTurnPlayer()),(i==null?void 0:i.battlePosition)==="Set"&&i.setBattlePosition("Defense",["Flip","FlipByBattle"],t,t.controller),this.log.info("ダメージ計算時",this.getTurnPlayer());const n=t.atk,a=(i.battlePosition==="Attack"?i.atk:i.def)??0;i.entityType==="Duelist"?t.controller.getOpponentPlayer().battleDamage(n-a,t):(n>0&&n>a&&i.battlePosition==="Attack"?t.controller.getOpponentPlayer().battleDamage(n-a,t):n<a&&t.controller.battleDamage(a-n,i),n>0&&(n>a||n===a&&i.battlePosition==="Attack")&&i.tryDestory("BattleDestroy",t.controller,t,e.action),i.battlePosition==="Attack"&&n<=a&&t.tryDestory("BattleDestroy",t.controller,i,e.action));const s=Object.values(this.duelists).filter(l=>l.lp<=0);if(s.length>0)throw new Ct(Object.values(this.duelists).filter(l=>!s.includes(l)).pop());for(await Pe.waitCorpseDisposal(this),this.clock.incrementChainSeq(),this.log.info("ダメージ計算後",this.getTurnPlayer());await this.procChainBlock(void 0,void 0););this.log.info("ダメージステップ終了時",this.getTurnPlayer()),this.clock.incrementStepSeq()});c(this,"procBattlePhaseEndStep",async()=>{for(this.phaseStep="end",this.priorityHolder=this.getTurnPlayer();await this.procChainBlock(void 0,void 0););this.moveNextPhase("main2")});c(this,"procEndPhase",async()=>{for(;await this.procChainBlock(void 0,void 0););for(;;){const t=this.getTurnPlayer().getHandCell().cardEntities.length;if(t<7)break;await this.getTurnPlayer().discard(t-6,["Rule"])}this.moveNextPhase("draw")});c(this,"procChainBlock",async(e,t)=>{const i=this.clock.chainBlockSeq===0;let n=t??Object.values(this.duelists).flatMap(l=>(this.priorityHolder=l,this.getEnableActions(["TriggerMandatoryEffect","TriggerEffect"],["Normal"],[]))),a=!1,s;if(e)s=e,a=!0;else if(n.length>0){const l=await this.selectTriggerEffect(n);l&&(n=n.filter(f=>f!==l),s=l,a=!0)}if(!a){let l=0;for(;l<2;){this.priorityHolder=this.priorityHolder.getOpponentPlayer();const f=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(["QuickEffect","CardActivation"],["Quick","Counter"],this.chainBlockInfos),"クイックエフェクト発動タイミング。効果を発動しますか？",!0);if(f){s=f,a=!0;break}l++}}if(console.info("selected action: ",s),s){const l=s.entity.controller,f=this.clock.chainBlockSeq+1;this.log.info(`チェーン${f}: ${Ht(s)}を発動`,l);const u=await s.prepare(s.cell,this.chainBlockInfos,!1);if(!u)throw new Dt(s);u.selectedEntities.length&&this.log.info(`対象⇒${u.selectedEntities.map(d=>d.toString()).join(" ")}`),this._chainBlockInfos.push(u),console.log(this.chainBlockInfos),this.clock.incrementProcSeq(),this.clock.incrementChainBlockSeq(),await this.procChainBlock(void 0,n.filter(d=>d.seq!==(s==null?void 0:s.seq))),this.log.info(`チェーン${f}: ${Ht(s)}の効果処理。`,l),console.log(u),u.isNegatedActivationBy?this.log.info(`チェーン${f}: ${Ht(s)}を${Ht(u.isNegatedActivationBy)}によって発動を無効にした。`,u.activator):(u.isNegatedEffectBy?this.log.info(`チェーン${f}: ${Ht(s)}を${Ht(u.isNegatedEffectBy)}によって効果を無効にした。`,u.activator):await s.execute(u,this.chainBlockInfos),await s.settle(u,this.chainBlockInfos)),this.clock.incrementProcSeq(),i&&(await Pe.sendManyToGraveyardForTheSameReason(this._chainBlockInfos.filter(d=>d.action.playType==="CardActivation").filter(d=>!d.action.isLikeContinuousSpell).map(d=>d.action.entity).filter(d=>d.isOnField).filter(d=>d.face==="FaceUp").filter(d=>!d.isLikeContinuousSpell),["Rule"],void 0,void 0),this._chainBlockInfos.reset(),this.clock.incrementChainSeq())}return a});c(this,"selectTriggerEffect",async e=>{if(e.length>0)for(const t of["TriggerMandatoryEffect","TriggerEffect"])for(const i of[this.getTurnPlayer(),this.getNonTurnPlayer()]){this.priorityHolder=i;const n=e.filter(s=>s.playType===t&&s.entity.controller===i);if(n.length===0)continue;if(n.length===1&&t==="TriggerMandatoryEffect")return console.log(n[0]),n[0];const a=await this.view.waitQuickEffect(this.priorityHolder,n,"効果を選択。",t==="TriggerEffect");if(a)return a}});c(this,"getEnableActions",(e,t,i)=>{let n=this.field.getAllCardEntities().filter(a=>a.controller===this.priorityHolder).flatMap(a=>a.actions).filter(a=>a.executableCells.includes(a.entity.fieldCell.cellType)).filter(a=>e.includes(a.playType)).filter(a=>t.includes(a.spellSpeed));return this.phaseStep==="damage"&&(n=n.filter(a=>a.canExecuteOnDamageStep)),n.filter(a=>a.validate(i))});this.phase="end",this.clock=new jl,this.nextPhaseList=[],this.isEnded=!1,this.duelists={Below:new pn(this,"Below",e,t,i),Above:new pn(this,"Above",n,a,s)},this.priorityHolder=this.firstPlayer,this._chainBlockInfos=[],this.field=new Nl(this),this.clock.onTotalProcSeqChange.append(this.distributeOperators),this.view=new Zl(this),this.log=new Ll(this),this.cardActionLog=new Gl(this)}get chainBlockInfos(){return this._chainBlockInfos}get firstPlayer(){return this.coin?this.duelists.Below:this.duelists.Above}get secondPlayer(){return this.coin?this.duelists.Above:this.duelists.Below}}const Yl=()=>{const r=[];["サイバー・ドラゴン","六武衆のご隠居","アンノウン・シンクロン"].forEach(d=>r.push({name:d,actions:[je,Fe,qe,{title:"特殊召喚",playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],isOnlyNTimesPerDuel:d==="アンノウン・シンクロン"?1:void 0,validate:y=>{const h=y.entity.field.getMonstersOnField();if(!(h.length==0||h.some(o=>o.controller===y.entity.controller)))return cn(y,["Attack","Defense"],[])},prepare:(y,h,o,p)=>dn(y,h,["Attack","Defense"],[],p),execute:un,settle:async()=>!0}]}));const e={name:"ジャンク・フォアード",actions:[je,Fe,qe,{title:"特殊召喚",playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],validate:d=>{if(d.entity.controller.getAvailableMonsterZones().length)return cn(d,["Attack","Defense"],[])},prepare:(d,y,h,o)=>dn(d,y,["Attack","Defense"],[],o),execute:un,settle:async()=>!0}]};r.push(e);const t={name:"Ｄ－ＨＥＲＯ ディアボリックガイ",actions:[je,Fe,qe,{title:"①リクルート",playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],validate:d=>d.entity.controller.getDeckCell().cardEntities.filter(h=>h.nm==="Ｄ－ＨＥＲＯ ディアボリックガイ").length===0?void 0:d.entity.controller.getAvailableMonsterZones().length>0?[]:void 0,prepare:async d=>(await d.entity.banish(["Cost"],d.entity,d.entity.controller),{selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async d=>{const y=d.activator.getAvailableMonsterZones();if(!y.length)return!1;const h=d.activator.getDeckCell().cardEntities.find(o=>o.nm==="Ｄ－ＨＥＲＯ ディアボリックガイ");return h?(await d.activator.summon(h,["Attack","Defense"],y,"SpecialSummon",["Effect"],d.action.entity,!1),!0):!1},settle:async()=>!0}]};r.push(t);const i={name:"ゾンビキャリア",actions:[je,Fe,qe,{title:"①自己再生",playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],validate:d=>d.entity.controller.getHandCell().cardEntities.length===0?void 0:d.entity.controller.getAvailableMonsterZones().length>0?[]:void 0,prepare:async d=>{const y=d.entity.controller.getHandCell().cardEntities,h=await d.entity.controller.duel.view.waitSelectEntities(d.entity.controller,y,1,o=>o.length===1,"デッキトップに戻すカードを一枚選択。");if(!h)throw new Dt(d);return await h[0].returnToDeck("Top",["Cost"],d.entity,d.entity.controller),{selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}},execute:async d=>{if(d.action.entity.wasMovedAtCurrentChain)return!1;const y=d.action.entity.controller.getAvailableMonsterZones();return y.length===0?!1:(await d.activator.summon(d.action.entity,["Attack","Defense"],y,"SpecialSummon",["Effect"],d.action.entity,!1),d.action.entity.info.willBeBanished=!0,!0)},settle:async()=>!0}]};r.push(i);const n={name:"グローアップ・バルブ",actions:[je,Fe,qe,{title:"①自己再生",playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],isOnlyNTimesPerDuel:1,validate:d=>d.entity.controller.getDeckCell().cardEntities.length===0?void 0:d.entity.controller.getAvailableMonsterZones().length>0?[]:void 0,prepare:async d=>(await d.entity.controller.getDeckCell().cardEntities[0].sendToGraveyard(["Cost"],d.entity,d.entity.controller),{selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:async d=>{if(d.action.entity.wasMovedAtCurrentChain)return!1;const y=d.action.entity.controller.getAvailableMonsterZones();return y.length===0?!1:(await d.activator.summon(d.action.entity,["Attack","Defense"],y,"SpecialSummon",["Effect"],d.action.entity),!0)},settle:async()=>!0}]};r.push(n);const a={name:"終末の騎士",actions:[je,Fe,qe,{title:"①墓地送り",playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],canExecuteOnDamageStep:!0,validate:d=>{const y=d.entity.moveLog.latestRecord;if(d.entity.face!=="FaceDown"&&d.entity.wasMovedAtPreviousChain&&y.movedAs.union(["SpecialSummon","NormalSummon"]).length!==0&&d.entity.controller.getDeckCell().cardEntities.filter(h=>h.attr.includes("Dark")).length!==0)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SendToGraveyardFromDeck"],prepared:void 0}),execute:async d=>{const y=d.action.entity.controller.getDeckCell().cardEntities.filter(h=>h.attr.includes("Dark"));return y.length===0?!1:(await d.action.entity.field.sendToGraveyard("墓地に送るモンスターを選択",d.activator,y,1,h=>h.length===1,["Effect"],d.action.entity,!1),d.activator.shuffleDeck(),!0)},settle:async()=>!0}]};r.push(a);const s={name:"マスマティシャン",actions:[je,Fe,qe,{title:"①墓地送り",playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],validate:d=>{if(d.entity.face!=="FaceDown"&&d.entity.moveLog.latestRecord.movedAs.includes("NormalSummon")&&d.entity.wasMovedAtPreviousChain&&d.entity.controller.getDeckCell().cardEntities.find(y=>(y.lvl??5)<5))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SendToGraveyardFromDeck"],prepared:void 0}),execute:async d=>{const y=d.activator.getDeckCell().cardEntities.filter(h=>(h.lvl??5)<5);return y.length===0?!1:(await d.action.entity.field.sendToGraveyard("墓地に送るモンスターを選択",d.activator,y,1,h=>h.length===1,["Effect"],d.action.entity,!1),d.activator.shuffleDeck(),!0)},settle:async()=>!0},{title:"②ドロー",playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],canExecuteOnDamageStep:!0,validate:d=>{if(d.entity.face!=="FaceDown"&&d.entity.moveLog.latestRecord.movedAs.includes("BattleDestroy")&&d.entity.wasMovedAtPreviousChain&&d.entity.controller.getDeckCell().cardEntities.length!==0)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async d=>(await d.activator.draw(1,d.action.entity,d.activator),!0),settle:async()=>!0}]};r.push(s);const l={name:"ライトロード・ビースト ウォルフ",actions:[Fe,qe,{title:"①自己再生",playType:"TriggerMandatoryEffect",spellSpeed:"Normal",executableCells:["Graveyard"],validate:d=>{if(d.entity.wasMovedAtPreviousChain&&d.entity.wasMovedFrom.cellType==="Deck")return d.entity.controller.getAvailableMonsterZones().length>0?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:async d=>{if(d.action.entity.wasMovedAtCurrentChain)return!1;const y=d.action.entity.controller.getAvailableMonsterZones();return!y.length||d.action.entity.fieldCell.cellType!=="Graveyard"&&d.action.entity.fieldCell.cellType!=="Banished"||d.action.entity.face==="FaceDown"?!1:(await d.activator.summon(d.action.entity,["Attack","Defense"],y,"SpecialSummon",["Effect"],d.action.entity),!0)},settle:async()=>!0}]};r.push(l);const f={name:"伝説の白石",actions:[Fe,qe,je,{title:"①サーチ",playType:"TriggerMandatoryEffect",spellSpeed:"Normal",executableCells:["Graveyard"],validate:d=>{if(d.entity.wasMovedAtPreviousChain&&d.entity.wasMovedFrom.cellType!=="Banished")return d.entity.controller.getDeckCell().cardEntities.find(y=>y.nm==="青眼の白龍")?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async d=>{const y=d.activator.getDeckCell().cardEntities.find(h=>h.nm==="青眼の白龍");return y?(await y.addToHand(["Effect"],d.action.entity,d.activator),d.activator.shuffleDeck(),!0):!1},settle:async()=>!0}]};return r.push(f),[{name:"灰流うらら",chainBlockTags:["Draw","SearchFromDeck","SendToGraveyardFromDeck","SpecialSummonFromDeck"]},{name:"屋敷わらし",chainBlockTags:["BanishFromGraveyard","SpecialSummonFromGraveyard","AddToHandFromGraveyard"]}].forEach(d=>{r.push({name:d.name,actions:[Fe,qe,je,{title:"①無効化",playType:"QuickEffect",spellSpeed:"Quick",executableCells:["Hand"],isOnlyNTimesPerTurn:!0,validate:(y,h)=>{if(h.length===0)return;const o=h.slice(-1)[0];return console.log(o),o.chainBlockTags.union(d.chainBlockTags).length>0?[]:void 0},prepare:async(y,h,o)=>(await y.entity.sendToGraveyard(["Discard","Cost"],y.entity,y.entity.controller),{selectedEntities:[],chainBlockTags:["NegateCardEffect"],prepared:o.length}),execute:async(y,h)=>{const o=h[y.prepared-1];return o.isNegatedEffectBy=y.action,!0},settle:async()=>!0}]})}),["翻弄するエルフの剣士","ロードランナー","氷結界の修験者"].forEach(d=>{r.push({name:d,actions:[Fe,qe,je],continuousEffects:[El("①戦闘破壊耐性","Monster",y=>[y],()=>!0,y=>[new kl("①戦闘破壊耐性",()=>!0,!0,y,()=>!0,["BattleDestory"],(h,o)=>!o.status.isEffective||(o.atk??0)<1900?!0:(y.duel.log.info(`${y.toString()}は攻撃力1900以上のモンスターとの先頭では破壊されない。`,y.controller),!1))])]})}),r},Wl=r=>{if(r.entity.status.spellCategory==="Field")return[r.entity.controller.getFieldZone()];const e=r.entity.controller.getAvailableSpellTrapZones();return e.length>0?e:void 0},zl=async(r,e)=>{if(r.entity.status.spellCategory==="Field"){const n=r.entity.controller.getFieldZone(),a=n.cardEntities[0];return await Pe.sendManyToGraveyardForTheSameReason(n.cardEntities,["Rule"],r.entity,r.entity.controller),r.entity.field.duel.log.info(`フィールド魔法の上書きにより、${a.toString()}は墓地に送られた。`,r.entity.controller),{selectedEntities:[],chainBlockTags:[],prepared:{dest:n}}}if(e)return{selectedEntities:[],chainBlockTags:[],prepared:{dest:e}};const t=r.entity.controller.getAvailableSpellTrapZones();if(t.length===0)return;let i=t[0];if(t.length>1&&r.entity.controller.duelistType!=="NPC"){const n=[wt.createDammyAction(r.entity,"セット",t)],a=r.entity.field.duel.view.modalController.selectAction(r.entity.field.duel.view,{title:"カードをセット先へドラッグ",actions:n,cancelable:!0}),s=r.entity.field.duel.view.waitSubAction(r.entity.controller,n,"カードをセット先へドラッグ",!0),l=await Promise.any([a,s.then(f=>f.action)]);if(!l)return;i=l.cell||i}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:i}}},Kl=async r=>(await r.action.entity.setAsSpellTrap(r.prepared.dest,["Rule","SpellTrapSet"],r.action.entity,r.activator),r.activator.duel.log.info(`${r.action.entity.status.name}をセット（SpellTrapSet）。`,r.activator),r.action.entity.info.isSettingSickness=r.action.entity.status.kind==="Trap"||r.action.entity.status.spellCategory==="QuickPlay",!0),ke={title:"セット",playType:"SpellTrapSet",spellSpeed:"Normal",executableCells:["Hand"],validate:Wl,prepare:zl,execute:Kl,settle:async()=>!0},be=r=>{if(r.entity.info.isPending||r.entity.info.isDying||r.entity.info.isSettingSickness)return;if(nr.some(t=>t===r.entity.fieldCell.cellType))return r.entity.face==="FaceDown"?[]:void 0;if(!r.entity.controller.isTurnPlayer)return;if(r.entity.status.spellCategory==="Field")return[r.entity.controller.getFieldZone()];const e=r.entity.controller.getAvailableSpellTrapZones();return e.length>0?e:void 0},Ce=async(r,e,t,i,n,a,s)=>{if(nr.some(l=>l===r.entity.fieldCell.cellType)&&r.entity.face==="FaceDown")return await r.entity.setNonFieldMonsterPosition("FaceUp",["Rule"]),{chainBlockTags:n??[],selectedEntities:a??[],prepared:s};if(r.entity.status.spellCategory==="Field"){const l=r.entity.controller.getFieldZone().cardEntities;if(l.length){const f=l[0];await Pe.sendManyToGraveyardForTheSameReason(r.entity.controller.getFieldZone().cardEntities,["Rule"],r.entity,r.entity.controller),r.entity.controller.duel.log.info(`フィールド魔法の上書きにより、${f.toString()}は墓地に送られた。`,r.entity.controller)}}if(r.entity.fieldCell.cellType==="Hand"){const l=["SpellTrapActivate"],f=e?[e]:r.entity.status.spellCategory==="Field"?[r.entity.controller.getFieldZone()]:r.entity.controller.getAvailableSpellTrapZones();return await r.entity.field.activateSpellTrapFromHand(r.entity,f,l,r.entity,r.entity.controller,i),{chainBlockTags:n??[],selectedEntities:a??[],prepared:s}}},Ql=r=>({title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],validate:e=>{if(e.entity.controller.getDeckCell().cardEntities.filter(r).length!==0&&e.entity.controller.canDraw)return be(e)},prepare:(e,t,i,n)=>Ce(e,t,i,n,["SearchFromDeck"],[],void 0),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(r);if(t.length===0)return!1;const i=await e.action.entity.field.duel.view.waitSelectEntities(e.activator,t,1,n=>n.length===1,"手札に加えるカードを選択",!1);for(const n of i??[])await n.addToHand(["Effect"],e.action.entity,e.activator);return e.activator.shuffleDeck(),!0},settle:async()=>!0}),Jl=(r,e)=>({title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],hasToTargetCards:!0,validate:t=>{if(!(t.entity.controller.getGraveyard().cardEntities.filter(r).length<e))return be(t)},prepare:(t,i,n,a)=>Ce(t,i,n,a,["AddToHandFromGraveyard"],[],void 0),execute:async t=>{const i=t.activator.getGraveyard().cardEntities.filter(r);if(i.length===0)return!1;const n=await t.action.entity.field.duel.view.waitSelectEntities(t.activator,i,e,a=>a.length===e,"手札に加えるカードを選択",!1);for(const a of n??[])await a.addToHand(["Effect"],t.action.entity,t.activator);return!0},settle:async()=>!0}),Xl=r=>({title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],validate:e=>{if(e.entity.controller.getHandCell().cardEntities.filter(r).length!==0&&!(e.entity.controller.getDeckCell().cardEntities.length<2))return be(e)},prepare:async(e,t,i,n)=>(await e.entity.controller.discard(1,["Discard","Cost"],e.entity,e.entity.controller,r),Ce(e,t,i,n,["SearchFromDeck"],[],void 0)),execute:async e=>(await e.activator.draw(2,e.action.entity,e.activator),!0),settle:async()=>!0}),Il=r=>({title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],validate:be,prepare:(e,t,i,n)=>{const[a,s]=r(e.entity),l=[];return a<0&&l.push("DamageToSelf"),s<0&&l.push("DamageToOpponent"),Ce(e,t,i,n,l,[],void 0)},execute:async e=>{const[t,i]=r(e.action.entity);return i>0?e.activator.getOpponentPlayer().heal(i,e.action.entity):i<0&&e.activator.getOpponentPlayer().effectDamage(Math.abs(i),e.action.entity),t>0?e.activator.heal(t,e.action.entity):t<0&&e.activator.effectDamage(Math.abs(t),e.action.entity),!0},settle:async()=>!0}),eo=()=>{const r=[],e={name:"強欲な壺",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],validate:o=>{if(!(o.entity.controller.getDeckCell().cardEntities.length<2)&&o.entity.controller.canDraw&&o.entity.controller.canAddToHandFromDeck)return be(o)},prepare:(o,p,m,_)=>Ce(o,p,m,_,["Draw","SearchFromDeck"],[],void 0),execute:async o=>(await o.activator.draw(2,o.action.entity,o.activator),!0),settle:async()=>!0},ke]};r.push(e);const t={name:"貪欲な壺",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],validate:o=>{if(!(o.entity.controller.getGraveyard().cardEntities.filter(p=>p.status.kind==="Monster").filter(p=>p.canBeTargetOfEffect(o.entity.controller,o.entity,o)).length<5)&&o.entity.controller.canDraw&&o.entity.controller.canAddToHandFromDeck)return be(o)},prepare:async(o,p,m,_)=>{const k=await o.entity.field.duel.view.waitSelectEntities(o.entity.controller,o.entity.controller.getGraveyard().cardEntities.filter(w=>w.status.kind==="Monster").filter(w=>w.canBeTargetOfEffect(o.entity.controller,o.entity,o)),5,w=>w.length===5,"デッキに戻すモンスターを選択。",!1);if(k)return Ce(o,p,m,_,["Draw","SearchFromDeck","ReturnToDeckFromGraveyard"],k,void 0)},execute:async o=>o.selectedEntities.some(p=>p.wasMovedAtCurrentChain)?!1:(await Pe.returnManyToDeckForTheSameReason("Random",o.selectedEntities,["Effect"],o.action.entity,o.activator),o.action.entity.field.getCells("Deck").filter(p=>p.needsShuffle).forEach(p=>p.shuffle()),await o.activator.draw(2,o.action.entity,o.activator),!0),settle:async()=>!0},ke]};r.push(t);const i={name:"天使の施し",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],validate:o=>{if(!(o.entity.controller.getDeckCell().cardEntities.length<3))return be(o)},prepare:(o,p,m)=>Ce(o,p,m,!1,["Draw","SearchFromDeck","DiscordAsEffect"],[],void 0),execute:async o=>(await o.activator.draw(3,o.action.entity,o.activator),await o.activator.discard(2,["Effect","Discard"],o.action.entity,o.activator),!0),settle:async()=>!0},ke]};r.push(i);const n={name:"成金ゴブリン",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],validate:o=>{if(!(o.entity.controller.getDeckCell().cardEntities.length<1))return be(o)},prepare:(o,p,m)=>Ce(o,p,m,!1,["Draw","SearchFromDeck"],[],void 0),execute:async o=>(await o.activator.draw(1,o.action.entity,o.activator),o.action.entity.field.duel.clock.incrementProcSeq(),o.activator.getOpponentPlayer().heal(1e3,o.action.entity),!0),settle:async()=>!0},ke]};r.push(n);const a={name:"おろかな埋葬",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],validate:o=>{if(o.entity.controller.getDeckCell().cardEntities.filter(p=>p.status.kind==="Monster").length!==0)return be(o)},prepare:(o,p,m)=>Ce(o,p,m,!1,["SendToGraveyardFromDeck"],[],void 0),execute:async o=>{const p=o.activator.getDeckCell().cardEntities.filter(_=>_.status.kind==="Monster");if(p.length===0)return!1;const m=await o.action.entity.field.duel.view.waitSelectEntities(o.activator,p,1,_=>_.length===1,"墓地に送るモンスターを選択",!1);if(!m)throw new Dt(o);return await Pe.sendManyToGraveyardForTheSameReason(m,["Effect"],o.action.entity,o.activator),await o.activator.shuffleDeck(),!0},settle:async()=>!0},ke]};r.push(a);const s={name:"おろかな副葬",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],isOnlyNTimesPerTurn:1,validate:o=>{if(o.entity.controller.getDeckCell().cardEntities.filter(p=>p.status.kind!=="Monster").length!==0)return be(o)},prepare:(o,p,m)=>Ce(o,p,m,!1,["SendToGraveyardFromDeck"],[],void 0),execute:async o=>{const p=o.activator.getDeckCell().cardEntities.filter(_=>_.status.kind!=="Monster");if(p.length===0)return!1;const m=await o.action.entity.field.duel.view.waitSelectEntities(o.activator,p,1,_=>_.length===1,"墓地に送る魔法罠を選択",!1);if(!m)throw new Dt(o);return await Pe.sendManyToGraveyardForTheSameReason(m,["Effect"],o.action.entity,o.activator),await o.activator.shuffleDeck(),!0},settle:async()=>!0},ke]};r.push(s);const l={name:"死者蘇生",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],hasToTargetCards:!0,validate:o=>{if(o.entity.field.getCells("Graveyard").flatMap(p=>p.cardEntities).filter(p=>p.status.kind==="Monster").filter(p=>p.info.isRebornable).filter(p=>p.canBeTargetOfEffect(o.entity.controller,o.entity,o)).filter(p=>p.canBeSpecialSummoned("SpecialSummon",o.entity.controller,o.entity,o)).length!==0&&o.entity.controller.getAvailableMonsterZones().length!==0)return be(o)},prepare:async(o,p,m)=>{const _=await o.entity.field.duel.view.waitSelectEntities(o.entity.controller,o.entity.field.getCells("Graveyard").flatMap(k=>k.cardEntities).filter(k=>k.status.kind==="Monster").filter(k=>k.info.isRebornable).filter(k=>k.canBeTargetOfEffect(o.entity.controller,o.entity,o)).filter(k=>k.canBeSpecialSummoned("SpecialSummon",o.entity.controller,o.entity,o)),1,k=>k.length===1,"蘇生対象とするモンスターを選択",!1);if(!_)throw new Dt(o);return await Ce(o,p,m,!1,["SpecialSummonFromGraveyard"],_,void 0)},execute:async o=>{const p=o.activator.getEmptyMonsterZones(),m=o.selectedEntities[0];return await o.activator.summon(m,["Attack","Defense"],p,"SpecialSummon",["Effect"],o.action.entity,!1),!0},settle:async()=>!0},ke]};r.push(l),[{name:"大嵐",cellTypes:nr,isOnlyEnemies:!1},{name:"ハーピィの羽根帚",cellTypes:nr,isOnlyEnemies:!0},{name:"ブラック・ホール",cellTypes:Br,isOnlyEnemies:!1},{name:"サンダー・ボルト",cellTypes:Br,isOnlyEnemies:!0}].forEach(o=>{r.push({name:o.name,actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],hasToTargetCards:!0,validate:p=>{let m=p.entity.field.getCells(...o.cellTypes).flatMap(_=>_.cardEntities).filter(_=>_!==p.entity);if(o.isOnlyEnemies&&(m=m.filter(_=>_.controller!==p.entity.controller)),!!m.length)return be(p)},prepare:async(p,m,_)=>{let k=p.entity.field.getCells(...o.cellTypes).flatMap(w=>w.cardEntities).filter(w=>w!==p.entity);return o.isOnlyEnemies&&(k=k.filter(w=>w.controller!==p.entity.controller)),await Ce(p,m,_,!1,p.calcChainBlockTagsForDestroy(k),[],void 0)},execute:async p=>{let m=p.action.entity.field.getCells(...o.cellTypes).flatMap(_=>_.cardEntities).filter(_=>_!==p.action.entity);return o.isOnlyEnemies&&(m=m.filter(_=>_.controller!==p.action.entity.controller)),m.forEach(_=>_.tryDestory("EffectDestroy",p.activator,p.action.entity,p.action)),await Pe.waitCorpseDisposal(p.activator.duel),!0},settle:async()=>!0},ke]})});const f={name:"ハリケーン",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],hasToTargetCards:!0,validate:o=>{if(o.entity.field.getCells("SpellAndTrapZone","FieldSpellZone").flatMap(m=>m.cardEntities).filter(m=>m!==o.entity).length)return be(o)},prepare:async(o,p,m)=>await Ce(o,p,m,!1,["BounceToHand"],[],void 0),execute:async(o,p)=>{const m=p.map(k=>k.action).filter(k=>k.playType==="CardActivation").map(k=>k.entity).filter(k=>k.isOnField).filter(k=>k.face==="FaceUp").filter(k=>!k.isLikeContinuousSpell),_=o.action.entity.field.getCells("SpellAndTrapZone","FieldSpellZone").flatMap(k=>k.cardEntities).filter(k=>!m.includes(k));return await Pe.returnManyToHandForTheSameReason(_,["Effect"],o.action.entity,o.activator),!0},settle:async()=>!0},ke]};r.push(f);const u={name:"手札抹殺",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],validate:o=>{if(!(o.entity.controller.getDeckCell().cardEntities.length<o.entity.controller.getHandCell().cardEntities.filter(p=>p.seq!==o.entity.seq).length)&&o.entity.field.getAllCells().filter(p=>p.cellType==="Hand").flatMap(p=>p.cardEntities).filter(p=>p.seq!==o.entity.seq).length!==0)return be(o)},prepare:(o,p,m)=>Ce(o,p,m,!1,["SearchFromDeck"],[],void 0),execute:async o=>{const p=o.activator.getHandCell().cardEntities.length,m=o.activator.getOpponentPlayer().getHandCell().cardEntities.length;return await Pe.sendManyToGraveyardForTheSameReason(o.action.entity.field.getCells("Hand").flatMap(_=>_.cardEntities),["Effect","Discard"],o.action.entity,o.activator),o.activator.duel.clock.incrementProcSeq(),await o.action.entity.field.drawAtSameTime(o.activator,p,o.activator.getOpponentPlayer(),m,o.action.entity,o.activator),!0},settle:async()=>!0},ke]};r.push(u);const d={name:"光の援軍",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],validate:o=>{if(!(o.entity.controller.getDeckCell().cardEntities.length<4)&&o.entity.controller.getDeckCell().cardEntities.filter(p=>p.status.kind==="Monster").filter(p=>(p.lvl??13)<5).filter(p=>p.status.nameTags&&p.status.nameTags.includes("ライトロード")).length!==0)return be(o)},prepare:async(o,p,m)=>{const _=o.entity.controller.getDeckCell();return await Pe.sendManyToGraveyardForTheSameReason(_.cardEntities.slice(0,3),["Cost"],o.entity,o.entity.controller),await Ce(o,p,m,!1,["SearchFromDeck","SendToGraveyardFromDeck"],[],void 0)},execute:async o=>{const p=o.activator.getDeckCell().cardEntities.filter(_=>_.status.kind==="Monster").filter(_=>(_.lvl??13)<5).filter(_=>_.status.nameTags&&_.status.nameTags.includes("ライトロード"));if(p.length===0)return!1;const m=await o.action.entity.field.duel.view.waitSelectEntities(o.activator,p,1,_=>_.length===1,"手札に加えるモンスターを選択",!1);for(const _ of m??[])await _.addToHand(["Effect"],o.action.entity,o.activator);return!0},settle:async()=>!0},ke]};r.push(d);const y={name:"調律",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],validate:o=>{const p=o.entity.controller.getDeckCell().cardEntities;if(!(p.length<2)&&p.filter(m=>{var _;return(_=m.status.nameTags)==null?void 0:_.includes("シンクロン")}).filter(m=>{var _;return(_=m.status.monsterCategories)==null?void 0:_.includes("Tuner")}).length!==0)return be(o)},prepare:(o,p,m)=>Ce(o,p,m,!1,["SearchFromDeck","SendToGraveyardFromDeck"],[],void 0),execute:async o=>{const p=o.activator.getDeckCell().cardEntities;if(p.length<2)return;const m=p.filter(k=>{var w;return(w=k.status.nameTags)==null?void 0:w.includes("シンクロン")}).filter(k=>{var w;return(w=k.status.monsterCategories)==null?void 0:w.includes("Tuner")});if(m.length===0)return!1;const _=await o.action.entity.field.duel.view.waitSelectEntities(o.activator,m,1,k=>k.length===1,"手札に加えるモンスターを選択",!1);for(const k of _??[])await k.addToHand(["Effect"],o.action.entity,o.activator);return o.activator.duel.clock.incrementProcSeq(),o.activator.getDeckCell().shuffle(),await o.activator.getDeckCell().cardEntities[0].sendToGraveyard(["Effect"],o.action.entity,o.activator),!0},settle:async()=>!0},ke]};r.push(y);const h={name:"ワン・フォー・ワン",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],validate:o=>{if(o.entity.controller.getDeckCell().cardEntities.filter(p=>p.lvl===1).length===0){if(o.entity.controller.getHandCell().cardEntities.filter(p=>p.lvl===1).length===0||o.entity.controller.getHandCell().cardEntities.filter(p=>p.status.kind==="Monster").length<2)return}else if(o.entity.controller.getHandCell().cardEntities.filter(p=>p.status.kind==="Monster").length===0)return;return be(o)},prepare:async(o,p,m)=>{let _=o.entity.controller.getHandCell().cardEntities.filter(w=>w.status.kind==="Monster");if(o.entity.controller.getDeckCell().cardEntities.filter(w=>w.lvl===1).length===0){const w=o.entity.controller.getHandCell().cardEntities.filter(F=>F.lvl===1);w.length===1&&(_=_.filter(F=>F!==w[0]))}if(await o.entity.field.sendToGraveyard("墓地送るモンスターを選択",o.entity.controller,_,1,w=>w.length===1,["Cost"],o.entity,!0))return await Ce(o,p,m,!1,["SpecialSummonFromDeck"],[],void 0)},execute:async o=>{const p=[...o.action.entity.controller.getDeckCell().cardEntities.filter(_=>_.lvl===1),...o.action.entity.controller.getHandCell().cardEntities.filter(_=>_.lvl===1)];if(p.length===0)return!1;const m=await o.action.entity.field.duel.view.waitSelectEntities(o.activator,p,1,_=>_.length===1,"特殊召喚するモンスターを選択",!1);if(!m)throw new Error("illegal state");return await o.activator.summon(m[0],["Attack","Defense"],o.activator.getAvailableMonsterZones(),"SpecialSummon",["Effect"],o.action.entity,!1),o.activator.shuffleDeck(),!0},settle:async()=>!0},ke]};return r.push(h),r},to=()=>{const r=[],e={name:"ご隠居の猛毒薬",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],validate:be,prepare:async(t,i,n,a)=>{const s=await t.entity.field.duel.view.waitSelectText([{seq:0,text:"●自分は１２００ＬＰ回復する。"},{seq:1,text:"●相手に８００ダメージを与える。"}],"使用する効果を選択",!1);if(s===void 0&&!a)throw new Dt(t);const l=[];return s===1&&l.push("DamageToOpponent"),Ce(t,i,n,a,l,[],s??0)},execute:async t=>t.prepared===1?(t.activator.getOpponentPlayer().effectDamage(800,t.action.entity),!0):(t.activator.heal(1200,t.action.entity),!0),settle:async()=>!0},ke]};return r.push(e),r},ro=()=>{const r=[];return[{name:"キラー・ポテト",filter:e=>e.attr.includes("Dark")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["EffectDestroy"],executableCells:["Graveyard"]},{name:"キラー・トマト",filter:e=>e.attr.includes("Dark")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"巨大ネズミ",filter:e=>e.attr.includes("Earth")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"グリズリーマザー",filter:e=>e.attr.includes("Water")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"シャインエンジェル",filter:e=>e.attr.includes("Light")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ドラゴンフライ",filter:e=>e.attr.includes("Wind")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ＵＦＯタートル",filter:e=>e.attr.includes("Fire")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"荒野の女戦士",filter:e=>e.attr.includes("Earth")&&e.type.includes("Warrior")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"リトル・トルーパー",filter:e=>e.type.includes("Warrior")&&(e.lvl??9999)<3,qtyList:[1],posList:["Set"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard","Banished"]},{name:"破面竜",filter:e=>e.type.includes("Warrior")&&(e.def??9999)<=1500,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"共鳴虫",filter:e=>e.type.includes("Insect")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ピラミッド・タートル",filter:e=>e.type.includes("Zombie")&&(e.def??9999)<=2e3,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ユーフォロイド",filter:e=>e.type.includes("Machine")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ヘル・セキュリティ",filter:e=>e.type.includes("Fiend")&&(e.lvl??9999)===1,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ガスタ・イグル",filter:e=>(e.status.nameTags??[]).includes("ガスタ")&&(e.status.monsterCategories??[]).includes("Tuner"),qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"幻影の魔術士",filter:e=>(e.status.nameTags??[]).includes("ＨＥＲＯ")&&(e.atk??9999)<=1e3,qtyList:[1],posList:["Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ジェネクス・サーチャー",filter:e=>(e.status.nameTags??[]).includes("ジェネクス")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"紫炎の足軽",filter:e=>(e.status.nameTags??[]).includes("六武衆")&&(e.lvl??12)<=3,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"スレイブ・エイプ",filter:e=>(e.status.nameTags??[]).includes("剣闘獣")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ゼンマイハニー",filter:e=>(e.status.nameTags??[]).includes("ゼンマイ")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ＸＸ－セイバー エマーズブレイド",filter:e=>(e.status.nameTags??[]).includes("Ｘ－セイバー")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"軍隊竜",filter:e=>e.nm==="軍隊竜",qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"アサルト・ガンドッグ",filter:e=>e.nm==="アサルト・ガンドッグ",qtyList:[1,2,3,4,5],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ハイエナ",filter:e=>e.nm==="ハイエナ",qtyList:[1,2,3,4,5],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]}].forEach(e=>{r.push({name:e.name,actions:[Sl(e.filter,e.qtyList,e.posList,e.destoryTypes,e.executableCells),Fe,qe,je]})}),r},io=()=>{const r=[];return[{name:"増援",filter:e=>e.origin.kind==="Monster"&&e.origin.type==="Warrior"&&(e.origin.level??5)<5},{name:"化石調査",filter:e=>e.origin.kind==="Monster"&&e.origin.type==="Dinosaur"&&(e.origin.level??6)<6},{name:"Ｅ－エマージェンシーコール",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("Ｅ・ＨＥＲＯ")},{name:"召集の聖刻印",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("聖刻")},{name:"召喚師のスキル",filter:e=>e.origin.kind==="Monster"&&(e.origin.monsterCategories??[]).includes("Normal")&&(e.origin.level??4)>4},{name:"トゥーンのもくじ",filter:e=>(e.origin.nameTags??[]).includes("トゥーン")},{name:"融合賢者",filter:e=>e.origin.name==="融合"},{name:"虹の架け橋",filter:e=>e.origin.kind!=="Monster"&&(e.origin.nameTags??[]).includes("宝玉")},{name:"紫炎の狼煙",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("六武衆")&&(e.origin.level??4)<4},{name:"テラ・フォーミング",filter:e=>e.origin.kind==="Spell"&&e.origin.spellCategory==="Field"},{name:"コール・リゾネーター",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("リゾネーター")}].forEach(e=>{r.push({name:e.name,actions:[Ql(e.filter),ke]})}),[{name:"戦士の生還",filter:e=>e.status.kind==="Monster"&&e.type.includes("Warrior"),qty:1},{name:"ダーク・バースト",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Dark")&&(e.atk??9999)<=1500,qty:1},{name:"悪夢再び",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Dark")&&(e.def??9999)===0,qty:2},{name:"サルベージ",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Water")&&(e.atk??9999)<=1500,qty:2},{name:"バッテリーリサイクル",filter:e=>e.status.kind==="Monster"&&e.type.includes("Thunder")&&(e.atk??9999)<=1500,qty:2},{name:"闇の量産工場",filter:e=>e.status.kind==="Monster"&&(e.status.monsterCategories??[]).includes("Normal"),qty:2}].forEach(e=>{r.push({name:e.name,actions:[Jl(e.filter,e.qty),ke]})}),[{name:"トレード・イン",filter:e=>e.status.kind==="Monster"&&(e.lvl??0)===8},{name:"調和の宝札",filter:e=>e.status.kind==="Monster"&&(e.origin.monsterCategories??[]).includes("Tuner")&&e.type.includes("Dragon")&&(e.atk??9999)<=1e3},{name:"デステニー・ドロー",filter:e=>e.status.kind==="Monster"&&(e.origin.nameTags??[]).includes("Ｄ－ＨＥＲＯ")}].forEach(e=>{r.push({name:e.name,actions:[Xl(e.filter),ke]})}),[{name:"火の粉",calcHeal:()=>[0,-200]},{name:"雷鳴",calcHeal:()=>[0,-300]},{name:"ファイヤー・ボール",calcHeal:()=>[0,-500]},{name:"火あぶりの刑",calcHeal:()=>[0,-600]},{name:"昼夜の大火事",calcHeal:()=>[0,-800]},{name:"火炎地獄",calcHeal:()=>[-500,-1e3]},{name:"盗人ゴブリン",calcHeal:()=>[500,-500]},{name:"ブルー・ポーション",calcHeal:()=>[400,0]},{name:"レッド・ポーション",calcHeal:()=>[500,0]},{name:"ゴブリンの秘薬",calcHeal:()=>[600,0]},{name:"天使の生き血",calcHeal:()=>[800,0]},{name:"治療の神 ディアン・ケト",calcHeal:()=>[1e3,0]},{name:"恵みの雨",calcHeal:()=>[1e3,1e3]}].forEach(e=>{r.push({name:e.name,actions:[Il(e.calcHeal),ke]})}),r},no=()=>{const r=[];["大地の騎士ガイアナイト","スクラップ・デスデーモン"].forEach(t=>r.push({name:t,actions:[Fe,qe,fn()]}));const e={name:"ナチュル・ガオドレイク",actions:[Fe,qe,fn(t=>t.length===1&&t.every(i=>i.attr.some(n=>n==="Earth")),t=>t.length>0&&t.every(i=>i.attr.some(n=>n==="Earth")))]};return r.push(e),r},ao=()=>{const r=[];return[{name:"草原",up:["Warrior","BeastWarrior"],down:[]},{name:"森",up:["Insect","Plant","Beast","BeastWarrior"],down:[]},{name:"山",up:["Dragon","WingedBeast","Thunder"],down:[]},{name:"荒野",up:["Dinosaur","Zombie","Rock"],down:[]},{name:"海",up:["Aqua","SeaSerpent","Fish"],down:["Machine","Pyro"]},{name:"闇",up:["Fiend","Spellcaster"],down:["Fairy"]}].forEach(e=>{r.push({name:e.name,actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",isLikeContinuousSpell:!0,executableCells:["Hand","FieldSpellZone"],validate:be,prepare:Ce,execute:async()=>!0,settle:async()=>!0},ke],continuousEffects:[Rr("発動","Spell",t=>t.isOnField&&t.face==="FaceUp",t=>["attack","defense"].flatMap(i=>["up","down"].map(n=>ft.createContinuous("発動",a=>a.isOnField&&a.face==="FaceUp",t,(a,s)=>s.isOnField&&s.face==="FaceUp"&&(s.status.monsterCategories??!1)&&e[n].some(l=>l===s.status.type),i,"current","Addition",(a,s,l)=>!a.status.isEffective||s.face==="FaceDown"?l:l+(n==="up"?200:-200)))))]})}),[{name:"バーニングブラッド",attr:"Fire"},{name:"ウォーターワールド",attr:"Water"},{name:"ガイアパワー",attr:"Earth"},{name:"シャインスパーク",attr:"Light"},{name:"ダークゾーン",attr:"Dark"},{name:"デザートストーム",attr:"Wind"}].forEach(e=>{r.push({name:e.name,actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","FieldSpellZone"],isLikeContinuousSpell:!0,validate:be,prepare:Ce,execute:async()=>!0,settle:async()=>!0},ke],continuousEffects:[Rr("発動","Spell",t=>t.isOnField&&t.face==="FaceUp",t=>["attack","defense"].flatMap(i=>ft.createContinuous("発動",n=>n.isOnField&&n.face==="FaceUp",t,(n,a)=>a.isOnField&&a.face==="FaceUp"&&a.attr.includes(e.attr),i,"current","Addition",(n,a,s)=>!n.status.isEffective||a.face==="FaceDown"?s:s+(i==="attack"?500:-400))))]})}),r},so=()=>{const r=[],e={name:"連合軍",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],isLikeContinuousSpell:!0,validate:be,prepare:Ce,execute:async()=>!0,settle:async()=>!0},ke],continuousEffects:[Rr("発動","Spell",t=>t.isOnField&&t.face==="FaceUp",t=>[ft.createContinuous("発動",i=>i.isOnField&&i.face==="FaceUp",t,(i,n)=>n.controller===i.controller&&n.type.includes("Warrior")&&n.isOnField&&n.face==="FaceUp","attack","current","Addition",(i,n,a)=>{if(!i.status.isEffective||n.face==="FaceDown")return a;const s=i.controller.getMonstersOnField().filter(l=>l.face==="FaceUp").filter(l=>l.type.includes("Warrior")||l.type.includes("Spellcaster")).length;return a+s*200})])]};return r.push(e),r},lo=()=>{const r=[];[{name:"団結の力",kind:["Monster"],rate:800},{name:"魔導師の力",kind:["Spell","Trap"],rate:500}].forEach(t=>{r.push({name:t.name,actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],isLikeContinuousSpell:!0,validate:i=>i.entity.field.getMonstersOnField().filter(a=>a.face==="FaceUp").filter(a=>a.canBeTargetOfEffect(i.entity.controller,i.entity,i)).length?be(i):void 0,prepare:async(i,n,a,s)=>{const l=i.entity.field.getMonstersOnField().filter(u=>u.face==="FaceUp").filter(u=>u.canBeTargetOfEffect(i.entity.controller,i.entity,i)),f=await i.entity.duel.view.waitSelectEntities(i.entity.controller,l,1,u=>u.length===1,"装備対象モンスターを選択",s);if(f)return console.log(f),i.entity.info.effectTargets.EquipTarget=f,console.log(i.entity,i.entity.info.effectTargets.EquipTarget),await Ce(i,n,a,!1,[],f,void 0)},execute:async()=>!0,settle:async()=>!0},ke],continuousEffects:[Si("EquipTarget","Spell",()=>!0,i=>[sr.createRegularEquipRelation("EquipTarget",()=>!0,i,()=>!0)]),Ui(t.name,"Spell",i=>i.info.effectTargets.EquipTarget,i=>i.isOnField&&i.face==="FaceUp",i=>["attack","defense"].map(n=>ft.createContinuous("発動",a=>a.isOnField&&a.face==="FaceUp",i,(a,s)=>s.isOnField&&s.face==="FaceUp",n,"current","Addition",(a,s,l)=>{if(!a.status.isEffective)return l;const f=a.controller.getEntiteisOnField().filter(u=>t.kind.includes(u.status.kind)).length;return l+f*t.rate})))]})});const e={name:"早すぎた埋葬",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],hasToTargetCards:!0,isLikeContinuousSpell:!0,validate:t=>{if(t.entity.controller.getGraveyard().cardEntities.filter(i=>i.status.kind==="Monster").filter(i=>i.info.isRebornable).filter(i=>i.canBeTargetOfEffect(t.entity.controller,t.entity,t)).filter(i=>i.canBeSpecialSummoned("SpecialSummon",t.entity.controller,t.entity,t)).length!==0&&t.entity.controller.getAvailableMonsterZones().length!==0&&!(t.entity.controller.lp<800))return be(t)},prepare:async(t,i,n)=>{const a=await t.entity.field.duel.view.waitSelectEntities(t.entity.controller,t.entity.controller.getGraveyard().cardEntities.filter(s=>s.status.kind==="Monster").filter(s=>s.info.isRebornable).filter(s=>s.canBeTargetOfEffect(t.entity.controller,t.entity,t)).filter(s=>s.canBeSpecialSummoned("SpecialSummon",t.entity.controller,t.entity,t)),1,s=>s.length===1,"蘇生対象とするモンスターを選択",!1);if(!a)throw new Dt(t);return t.entity.controller.payLp(800,t.entity),t.entity.info.effectTargets.EquipTarget=a,await Ce(t,i,n,!1,["SpecialSummonFromGraveyard","PayLifePoint"],a,void 0)},execute:async t=>{console.log("早すぎた埋葬 execute");const i=t.activator.getEmptyMonsterZones(),n=t.selectedEntities[0];return await t.activator.summon(n,["Attack"],i,"SpecialSummon",["Effect"],t.action.entity,!1),!0},settle:async()=>!0},ke],continuousEffects:[Si("EquipTarget","Spell",()=>!0,t=>[sr.createRegularEquipRelation("EquipTarget",()=>!0,t,()=>!0,i=>(!i.target.isOnField||i.target.face==="FaceDown"||i.isSpawnedBy.moveLog.currentProcRecords.flatMap(n=>n.movedAs).find(n=>n==="Destroy")&&i.target.tryDestory("EffectDestroy",i.effectOwner,i.isSpawnedBy,void 0),!0))])]};return r.push(e),r},oo=()=>{const r=[];return[{name:"伝説の剣",attr:void 0,monType:"Warrior",atk:200,def:200},{name:"秘術の書",attr:void 0,monType:"Spellcaster",atk:200,def:200},{name:"ポセイドンの力",attr:void 0,monType:"Aqua",atk:200,def:200},{name:"紫水晶",attr:void 0,monType:"Zombie",atk:200,def:200},{name:"猛獣の歯",attr:void 0,monType:"Beast",atk:200,def:200},{name:"機械改造工場",attr:void 0,monType:"Machine",atk:200,def:200},{name:"体温の上昇",attr:void 0,monType:"Reptile",atk:200,def:200},{name:"魔菌",attr:void 0,monType:"Plant",atk:200,def:200},{name:"闇・エネルギー",attr:void 0,monType:"Fiend",atk:200,def:200},{name:"レーザー砲機甲鎧",attr:void 0,monType:"Insect",atk:200,def:200},{name:"銀の弓矢",attr:void 0,monType:"Fairy",atk:200,def:200},{name:"電撃鞭",attr:void 0,monType:"Thunder",atk:200,def:200},{name:"ドラゴンの秘宝",attr:void 0,monType:"Dragon",atk:200,def:200},{name:"フォロー・ウィンド",attr:void 0,monType:"WingedBeast",atk:200,def:200},{name:"魔性の月",attr:void 0,monType:"BeastWarrior",atk:200,def:200},{name:"エルフの光",attr:"Light",monType:void 0,atk:400,def:-200},{name:"覚醒",attr:"Earth",monType:void 0,atk:400,def:-200},{name:"灼熱の槍",attr:"Fire",monType:void 0,atk:400,def:-200},{name:"突風の扇",attr:"Wind",monType:void 0,atk:400,def:-200},{name:"はがねの甲羅",attr:"Water",monType:void 0,atk:400,def:-200},{name:"闇の破神剣",attr:"Dark",monType:void 0,atk:400,def:-200},{name:"火器付機甲鎧",attr:void 0,monType:"Insect",atk:700,def:0},{name:"サラマンドラ",attr:"Fire",monType:void 0,atk:700,def:0},{name:"シャイン・キャッスル",attr:"Light",monType:void 0,atk:700,def:0}].forEach(e=>{r.push({name:e.name,actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],isLikeContinuousSpell:!0,validate:t=>t.entity.field.getMonstersOnField().filter(n=>n.face==="FaceUp").filter(n=>n.canBeTargetOfEffect(t.entity.controller,t.entity,t)).filter(n=>!e.attr||n.attr.includes(e.attr)).filter(n=>!e.monType||n.type.includes(e.monType)).length?be(t):void 0,prepare:async(t,i,n,a)=>{const s=t.entity.field.getMonstersOnField().filter(f=>f.face==="FaceUp").filter(f=>f.canBeTargetOfEffect(t.entity.controller,t.entity,t)).filter(f=>!e.attr||f.attr.includes(e.attr)).filter(f=>!e.monType||f.type.includes(e.monType)),l=await t.entity.duel.view.waitSelectEntities(t.entity.controller,s,1,f=>f.length===1,"装備対象モンスターを選択",a);if(l)return console.log(l),t.entity.info.effectTargets.EquipTarget=l,console.log(t.entity,t.entity.info.effectTargets.EquipTarget),await Ce(t,i,n,!1,[],l,void 0)},execute:async()=>!0,settle:async()=>!0},ke],continuousEffects:[Si("EquipTarget","Spell",()=>!0,t=>[sr.createRegularEquipRelation("EquipTarget",()=>!0,t,()=>!0)]),Ui(e.name,"Spell",t=>t.info.effectTargets.EquipTarget,t=>t.isOnField&&t.face==="FaceUp",t=>{const i=[];return e.atk!==0&&i.push(["attack",e.atk]),e.def!==0&&i.push(["defense",e.def]),i.map(([n,a])=>ft.createContinuous("発動",s=>s.isOnField&&s.face==="FaceUp",t,(s,l)=>l.isOnField&&l.face==="FaceUp"&&(!e.monType||l.type.includes(e.monType))&&(!e.attr||l.attr.includes(e.attr)),n,"current","Addition",(s,l,f)=>s.status.isEffective?f+a:f))})]})}),r},co=()=>{const r=[],e={name:"にせアバター",actions:[je,Fe,qe],continuousEffects:[Ui("THE_DEVILS_AVATAR","Monster",i=>[i],i=>i.isOnField&&i.face==="FaceUp",i=>["attack","defense"].map(n=>ft.createContinuous("THE_DEVILS_AVATAR",a=>a.isOnField&&a.face==="FaceUp",i,a=>a.isOnField&&a.face==="FaceUp",n,"current","THE_DEVILS_AVATAR",()=>Number.MIN_VALUE)))]};r.push(e);const t={name:"にせドレッド・ルート",actions:[je,Fe,qe],continuousEffects:[Rr("THE_DEVILS_DREAD-ROOT","Monster",i=>i.isOnField&&i.face==="FaceUp",i=>["attack","defense"].map(n=>ft.createContinuous("THE_DEVILS_DREAD-ROOT",a=>a.isOnField&&a.face==="FaceUp",i,(a,s)=>s.status.kind==="Monster"&&s.isOnField&&s.face==="FaceUp"&&s!==a,n,"current","THE_DEVILS_DREAD-ROOT",(a,s,l)=>Math.round(l/2))))]};return r.push(t),r},uo=()=>{const r=[...Yl(),...ro(),...no(),...eo(),...io(),...to(),...ao(),...so(),...lo(),...oo(),...co()],e=r.map(i=>i.name);console.info(e);const t=Object.values(Object.groupBy(e,i=>i)).filter(i=>((i==null?void 0:i.length)??2)>1).map(i=>i==null?void 0:i[0]);if(t.length>0)throw new Oe("カード定義重複",...t);return r},fa=new Map;uo().forEach(r=>{fa.set(r.name,r)});const ki=fa,fo=ga,$e=Object.values(fo).reduce((r,e)=>(r[e.name]=e,r),{}),de=class de{constructor(e,t){c(this,"id");c(this,"name");c(this,"description");c(this,"lastUsedAt");c(this,"cardNames");c(this,"getIllegalCardNames",()=>Array.from(new Set(this.cardNames.filter(e=>!Object.keys($e).includes(e)))));c(this,"getDisableCardNames",()=>Array.from(new Set(this.cardNames.filter(e=>!Object.keys($e).includes(e)))));c(this,"createCardInfos",()=>{const e=this.getIllegalCardNames();if(e.length>0)throw new Error(`存在しないカード名からデッキを生成しようとした。${e}`);return this.cardNames.map(t=>$e==null?void 0:$e[t]).filter(t=>t)});c(this,"copy",async()=>de.createNewDeck(this.name,this.description,this.cardNames));c(this,"updateTimestamp",async()=>{await de.tblHeader.update(this.id,e=>({...e,lastUsedAt:new Date}))});c(this,"saveDeckInfo",async e=>{const t=e??this;await de.tblHeader.update(this.id,a=>({...a,name:t.name,description:t.description,lastUsedAt:new Date}));const i=(await de.tblDetail.getAll()).filter(a=>a.deckId===this.id);console.log(t.cardNames),await de.tblDetail.delete(i.map(a=>a.id));const n=await de.tblDetail.insertMany(t.cardNames.map((a,s)=>({deckId:this.id,seq:s,name:a,description:""})));return console.log(n),new de(await de.tblHeader.get(this.id),n)});c(this,"delete",async()=>{await de.tblHeader.delete([this.id]);const e=(await de.tblDetail.getAll()).filter(t=>t.deckId===this.id);await de.tblDetail.delete(e.map(t=>t.id))});this.id=e.id,this.name=e.name,this.description=e.description,this.lastUsedAt=e.lastUsedAt,this.cardNames=t.filter(i=>i.deckId===this.id).map(i=>i.name)}};c(de,"idb"),c(de,"tblHeader"),c(de,"tblDetail"),c(de,"getAllDeckInfo",async e=>{if(e&&(de.idb=e),!de.idb)throw new Error("illegal argument: idb is undefined.");de.tblHeader||(de.tblHeader=new vo(de.idb)),de.tblDetail||(de.tblDetail=new po(de.idb));const t=await de.tblHeader.getAll(),i=await de.tblDetail.getAll();return t.length?t.map(n=>new de(n,i)):[await de.prepareSampleDeck()]}),c(de,"createNewDeck",async(e,t,i)=>{const n=await de.tblHeader.insert({name:e,description:t,lastUsedAt:new Date}),a=await de.tblDetail.insertMany(i.map((s,l)=>({deckId:n.id,seq:l,name:s,description:""})));return new de(n,a)}),c(de,"prepareSampleDeck",async()=>await de.createNewDeck(Dr[0].name,Dr[0].description,Dr[0].cardNames));let Et=de;class vo extends Ri{constructor(t){super(t,"TblDeckHeader");c(this,"_prepareInitialRecords",()=>[])}}class po extends Ri{constructor(t){super(t,"TblDeckDetail");c(this,"_prepareInitialRecords",()=>[])}}let ho=-1,er=["おろかな埋葬","成金ゴブリン","強欲な壺","天使の施し","増援","トレード・イン","調和の宝札","死者蘇生","召喚師のスキル","サイバー・ドラゴン","Ｄ－ＨＥＲＯ ディアボリックガイ","ライトロード・ビースト ウォルフ","ナチュル・ガオドレイク","スクラップ・デスデーモン","大地の騎士ガイアナイト","青眼の白龍"];er=[...er,...er,...er,"Ｅ－エマージェンシーコール","闇の量産工場","戦士の生還","トレード・イン","ジェネティック・ワーウルフ","ジョングルグールの幻術師","ゾンビーノ","フロストザウルス","しゃりの軍貫","チューン・ウォリアー","貪欲な壺","ガード・オブ・フレムベル","ギャラクシーサーペント","ハロハロ","ラブラドライドラゴン","守護竜ユスティア","Ｅ・ＨＥＲＯ クレイマン","Ｅ・ＨＥＲＯ スパークマン","Ｅ・ＨＥＲＯ ネオス","Ｅ・ＨＥＲＯ バーストレディ","Ｅ・ＨＥＲＯ フェザーマン"];const Dr=[{id:ho--,name:"サンプルデッキ１",description:"",lastUsedAt:new Date,cardNames:er}];function yo(r){const e=r-1;return e*e*e+1}function yn(r,e){for(const t in e)r[t]=e[t];return r}function go({fallback:r,...e}){const t=new Map,i=new Map;function n(s,l,f){const{delay:u=0,duration:d=M=>Math.sqrt(M)*30,easing:y=yo}=yn(yn({},e),f),h=s.getBoundingClientRect(),o=l.getBoundingClientRect(),p=h.left-o.left,m=h.top-o.top,_=h.width/o.width,k=h.height/o.height,w=Math.sqrt(p*p+m*m),F=getComputedStyle(l),N=F.transform==="none"?"":F.transform,U=+F.opacity;return{delay:u,duration:typeof d=="function"?d(w):d,easing:y,css:(M,z)=>`
			   opacity: ${M*U};
			   transform-origin: top left;
			   transform: ${N} translate(${z*p}px,${z*m}px) scale(${M+(1-M)*_}, ${M+(1-M)*k});
		   `}}function a(s,l,f){return(u,d)=>(s.set(d.key,u),()=>{if(l.has(d.key)){const y=l.get(d.key);return l.delete(d.key),n(y,u,d)}return s.delete(d.key),r&&r(u,d,f)})}return[a(i,t,!1),a(t,i,!0)]}var mo=D("<div></div>"),_o=D('<div class="duel_card_row svelte-1kuignv"><div> </div> <div> </div></div>'),So=D('<div class="duel_card_row svelte-1kuignv"><div class="svelte-1kuignv"></div> <div class="svelte-1kuignv"> </div></div>'),wo=D('<div class="duel_card_row svelte-1kuignv"><div class="svelte-1kuignv"></div> <div class="svelte-1kuignv"> </div></div>'),To=D('<div class="duel_card_row svelte-1kuignv"><div> </div> <div> </div></div>'),ko=D('<div class="duel_card_row duel_card_detail svelte-1kuignv"><div class="svelte-1kuignv"> </div></div> <div class="duel_card_row duel_card_detail svelte-1kuignv"><div class="svelte-1kuignv"></div> <div class="svelte-1kuignv"><span> </span> / <span> </span></div></div>',1),bo=D('<button><div class="duel_card duel_card_visible svelte-1kuignv"><div class="duel_card_row svelte-1kuignv" style="position:relative"><div class="svelte-1kuignv"> </div> <div class="svelte-1kuignv"></div> <!></div> <!> <!> <!></div></button>'),Co=D('<div class="duel_card duel_card_face_down duel_card_face_down_defense svelte-1kuignv"><div class="svelte-1kuignv"></div></div>'),Do=D('<div class="duel_card duel_card_face_down svelte-1kuignv"><div class="svelte-1kuignv"></div></div>');function ot(r,e){Re(e,!1);let t=ge(e,"entity",8),i=ge(e,"state",8,"Disabled"),n=ge(e,"selectedList",28,()=>[]),a=ge(e,"isVisibleForcibly",8,!1),s=ge(e,"isWideMode",8,!1),l=ge(e,"actions",24,()=>[]),f=ge(e,"cardActionResolve",8),u=ge(e,"entitySelectResolve",8,()=>{}),d=De(!1),y=()=>{},h=ge(e,"qty",12,void 0);const o=Y=>{ie(d,!1),h(Y.qty),y=Y.resolve};t().field.duel.view.onWaitStart.append(o);let p=De(!1);const m=()=>{if(i()!=="Disabled"&&(console.log(h()),i()==="Selectable"&&h()&&h()===1)){if(n().some(Y=>Y.seq!==t().seq)){n([t()]);return}h()&&h()===1&&u()&&u()([t()])}},_=Y=>{(t().face==="FaceUp"||t().owner===t().field.duel.duelists.Below&&(t().isUnderControl||a()))&&t().field.duel.view.showCardInfo(t(),Y??"Normal")},k=()=>{if(console.log(t(),i()),_(),i()==="Disabled")return;if(i()==="Selectable"){ie(d,!v(d)),n(v(d)?[...n(),t()]:n().filter(Q=>Q!==t()));return}if(l().length===0)return;if(l().length===1){if(l()[0].dragAndDropOnly)return;if(f()){f()(l()[0]);return}console.log(l()[0],y),y({action:l()[0]});return}const Y=t().field.duel.view;Y.modalController.selectAction(Y,{title:"行動を選択。",actions:l(),cancelable:!0}).then(Q=>{y({action:Q})})},w=Y=>{console.info("drag start",Y,l()),t().field.duel.view.setDraggingActions(l()),ie(p,!0)},F=Y=>{console.info("drag end",Y,l()),t().field.duel.view.removeDraggingActions(),Y.dataTransfer&&ie(p,!1)},N=()=>(_("Debug"),!1);Ye();var U=Te(),M=ne(U);{var z=Y=>{var Q=bo(),ue=g(Q),Se=g(ue),Ae=g(Se),te=g(Ae),b=S(Ae,4);ve(b,1,()=>t().attr,fe,(q,B)=>{var $=mo();O(()=>pe($,`monster_attr ${v(B)??""} svelte-1kuignv`)),T(q,$)});var P=S(Se,2);{var J=q=>{var B=_o(),$=g(B),ee=g($),X=S($,2),G=g(X);O((W,L)=>{pe($,Bt(t().lvl!==t().origin.level?"different_from_its_origin":""),"svelte-1kuignv"),x(ee,W),pe(X,Bt(t().rank!==t().origin.rank?"different_from_its_origin":""),"svelte-1kuignv"),x(G,L)},[()=>"★".repeat(t().lvl||0),()=>"☆".repeat(t().rank||0)],_e),T(q,B)},re=q=>{var B=Te(),$=ne(B);{var ee=G=>{var W=So(),L=S(g(W),2),I=g(L);O(()=>x(I,`${vr[t().status.spellCategory]??""}魔法`)),T(G,W)},X=G=>{var W=Te(),L=ne(W);{var I=oe=>{var he=wo(),Z=S(g(he),2),C=g(Z);O(()=>x(C,`${pr[t().status.trapCategory]??""}罠`)),T(oe,he)};H(L,oe=>{t().status.kind==="Trap"&&t().status.trapCategory&&oe(I)},!0)}T(G,W)};H($,G=>{t().status.kind==="Spell"&&t().status.spellCategory?G(ee):G(X,!1)},!0)}T(q,B)};H(P,q=>{t().status.kind==="Monster"?q(J):q(re,!1)})}var se=S(P,2);{var le=q=>{var B=To(),$=g(B),ee=g($),X=S($,2),G=g(X);O(()=>{pe($,Bt(t().psL!==t().origin.pendulumScaleL?"different_from_its_origin":""),"svelte-1kuignv"),x(ee,`◀ ${t().psL??""}`),pe(X,Bt(t().psR!==t().origin.pendulumScaleR?"different_from_its_origin":""),"svelte-1kuignv"),x(G,`${t().psR??""} ▶`)}),T(q,B)};H(se,q=>{var B;(B=t().status.monsterCategories)!=null&&B.includes("Pendulum")&&q(le)})}var R=S(se,2);{var j=q=>{var B=ko(),$=ne(B),ee=g($),X=g(ee),G=S($,2),W=S(g(G),2),L=g(W),I=g(L),oe=S(L,2),he=g(oe);O((Z,C)=>{x(X,`${Z??""}
            ${C??""}`),pe(L,Bt(t().atk!==t().origin.attack?"different_from_its_origin":""),"svelte-1kuignv"),x(I,t().atk??"?"),pe(oe,Bt(t().def!==t().origin.defense?"different_from_its_origin":""),"svelte-1kuignv"),x(he,t().def??"?")},[()=>t().type.map(Z=>hr[Z]+(s()?Jr[Z]:"")).join(),()=>{var Z;return(Z=t().status.monsterCategories)==null?void 0:Z.map(C=>fr[C]+(s()?Qr[C]:"")).join()}],_e),T(q,B)};H(R,q=>{t().status.kind==="Monster"&&q(j)})}O(q=>{pe(Q,`duel_card button_style_reset ${t().status.kind??""} ${q??""} ${(v(d)?"duel_card_selected":"")??""} ${i()??""} duel_card_${t().orientation??""} ${(v(p)?"isDragging":"")??""} ${(s()?"duel_card_wide":"")??""} duel_card_${t().face??""} ${(t().isOnField?"duel_card_is_on_field":"")??""} svelte-1kuignv`),Yt(Q,"draggable",i()==="Draggable"),Yt(Q,"title",t().nm),x(te,t().nm)},[()=>{var q;return((q=t().status.monsterCategories)==null?void 0:q.join(" "))||""}],_e),Me("dragstart",Q,w),Me("dragend",Q,F),Me("click",Q,k),Me("dblclick",Q,m),Me("mouseenter",Q,()=>_()),Me("contextmenu",Q,N),T(Y,Q)},A=Y=>{var Q=Te(),ue=ne(Q);{var Se=te=>{var b=Co();T(te,b)},Ae=te=>{var b=Do();T(te,b)};H(ue,te=>{t().battlePosition==="Set"?te(Se):te(Ae,!1)},!0)}T(Y,Q)};H(M,Y=>{t().face==="FaceUp"||a()||t().controller.duelistType==="Player"&&t().isUnderControl?Y(z):Y(A,!1)})}T(r,U),Ne()}var Eo=D('<div class="phase_display svelte-1mupj1p"><span class="svelte-1mupj1p"> </span> </div>'),Ao=D('<div class="lifepoint_display svelte-1mupj1p"><div class="svelte-1mupj1p"> </div> <div class="svelte-1mupj1p"> </div></div>'),xo=(r,e,t)=>e(v(t)),Mo=D('<div class="svelte-1mupj1p"><button class="phase_button svelte-1mupj1p"> </button></div>'),Po=D("<div><!></div>"),Fo=D('<div class="svelte-1mupj1p"><!></div>'),qo=D("<div><!></div>"),Oo=D("<!> <!> <!>",1),Bo=D('<div style="position: absolute;" class="card_animation_receiver svelte-1mupj1p"><!></div>'),Ro=D('<div style="position: absolute; display:flex;justify-content: center;" class="svelte-1mupj1p"><!></div>'),No=D('<div style="position: absolute; bottom:0rem" class="svelte-1mupj1p"> </div>'),Lo=D("<!> <!>",1),Ho=D('<div class="badge svelte-1mupj1p"> </div>'),$o=D('<div class="card_animation_receiver svelte-1mupj1p"><!></div>'),Uo=D("<!> <!> <!> <!>",1),Zo=D('<td><div role="listitem"><!></div></td>');function jo(r,e){Re(e,!1);let t=ge(e,"view",8),i=ge(e,"row",8),n=ge(e,"column",8),a=ge(e,"selectedList",28,()=>[]),s=De(t().getCell(i(),n()));const l=()=>{ie(s,t().getCell(i(),n()))};v(s).onUpdate.append(l),t().onDuelUpdate.append(l),t().modalController.onUpdate.append(l);let f=De([]),u=()=>{},d;const y=b=>{ie(w,void 0),a().reset(),u=b.resolve,ie(f,b.enableActions),d=b.selectableEntities,b.entitiesValidator};t().onWaitStart.append(y);let h,o=De(!1);const p=b=>{h=b,ie(o,b.some(P=>{var J;return(J=P.validate(t().duel.chainBlockInfos))==null?void 0:J.includes(v(s))})||!1),l()},m=()=>{h=void 0,ie(o,!1),l()};t().onDragStart.append(p),t().onDragEnd.append(m);const[_,k]=Uc;let w=De(void 0);const F=b=>{if(v(s)===b.to||v(s).entities.includes(b.entity)){ie(w,b);const P=b.resolve;ie(s,v(s)),setTimeout(()=>{ie(w,void 0),b.count++,b.count>1&&P()},600)}};t().onAnimation.append(F);const N=b=>{u({phaseChange:b})},U=()=>v(s).isStackCell&&v(s).entities.flatMap(b=>b.actions).filter(b=>v(f).map(P=>P.seq).some(P=>P===b.seq)).length>0,M=()=>{if(Ze(s,v(s).field.duel.view.infoBoardState="Log"),v(s).isStackCell){Ze(s,v(s).field.duel.view.infoBoardState="CellInfo"),Ze(s,v(s).field.duel.view.infoBoardCell=v(s)),v(s).field.duel.view.requireUpdate();const b=v(s).entities.flatMap(P=>P.actions).filter(P=>v(f).map(J=>J.seq).some(J=>J===P.seq));if(console.log(v(f)),console.log(b),b.length){const P=v(s).field.duel.view;P.modalController.selectAction(P,{title:"カードを選択。",actions:b,cancelable:!0}).then(J=>{u({action:J})});return}}v(s).field.duel.view.requireUpdate(),console.info(v(s))},z=b=>{b.preventDefault(),b.dataTransfer&&(b.dataTransfer.dropEffect="move")},A=b=>{b.preventDefault(),console.info("drop",b,v(o),h),b.dataTransfer&&(b.dataTransfer.dropEffect="move");try{if(v(o)&&h)if(console.info(h,v(s)),h.length===1){const P=h[0].getClone();P.cell=v(s),u({action:P})}else h.length>1&&(v(s).field.duel.view.modalController.cancelAll(),v(s).field.duel.view.modalController.selectAction(v(s).field.duel.view,{title:"選択",actions:h,cancelable:!1}))}finally{t().removeDraggingActions()}},Y=(...b)=>{if(d&&d.find(re=>b.find(se=>re===se)))return"Selectable";if(!v(f)||v(f).length===0||t().waitMode!=="SelectFieldAction"||Object.values(t().modalController.states).some(re=>re==="Shown"))return"Disabled";const P=v(f).filter(re=>b.includes(re.entity));if(P.length===0)return"Disabled";if(P.length>1)return"Clickable";if(v(f)[0].playType==="RuleDraw")return"Draggable";if(v(s).isStackCell||P[0].entity!==b[0])return"Clickable";const J=P[0].validate(t().duel.chainBlockInfos);return J&&J.length>0?"Draggable":"Clickable"};Ye();var Q=Zo(),ue=g(Q);ue.__click=M;var Se=g(ue);{var Ae=b=>{var P=Te(),J=ne(P);{var re=se=>{var le=Te(),R=ne(le);{var j=B=>{var $=Eo(),ee=g($),X=g(ee),G=S(ee,1,!0);O((W,L)=>{x(X,W),x(G,L)},[()=>String(v(s).field.duel.clock.turn).padStart(2,"0"),()=>v(s).field.duel.phase.toUpperCase()],_e),T(B,$)},q=B=>{var $=Te(),ee=ne($);{var X=W=>{var L=Ao(),I=g(L),oe=g(I),he=S(I,2),Z=g(he);O(()=>{x(oe,v(s).field.duel.duelists.Above.lp),x(Z,v(s).field.duel.duelists.Below.lp)}),T(W,L)},G=W=>{var L=Te(),I=ne(L);{var oe=he=>{var Z=Te(),C=ne(Z);{var E=V=>{var K=Te(),ce=ne(K);{var we=Ee=>{var tt=Te(),Xt=ne(tt);ve(Xt,1,()=>t().duel.nextPhaseList,fe,(Pt,Ft)=>{var at=Mo(),yr=g(at);yr.__click=[xo,N,Ft];var Ir=g(yr);O(ei=>x(Ir,ei),[()=>v(Ft).toUpperCase()],_e),T(Pt,at)}),T(Ee,tt)};H(ce,Ee=>{t().duel.isEnded||Ee(we)})}T(V,K)};H(C,V=>{t().waitMode==="SelectFieldAction"&&V(E)})}T(he,Z)};H(I,he=>{v(s).column===5&&he(oe)},!0)}T(W,L)};H(ee,W=>{v(s).column===3?W(X):W(G,!1)},!0)}T(B,$)};H(R,B=>{v(s).column===1?B(j):B(q,!1)})}T(se,le)};H(J,se=>{v(s).row===3&&se(re)})}T(b,P)},te=b=>{var P=Te(),J=ne(P);{var re=le=>{var R=Oo(),j=ne(R);{var q=X=>{var G=Po(),W=g(G);ot(W,{get entity(){return v(w).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),O(()=>pe(G,`card_animation_receiver ${v(s).cellType??""} svelte-1mupj1p`)),Rt(1,G,()=>k,()=>({key:v(w).entity.seq})),T(X,G)};H(j,X=>{v(w)&&v(w).entity&&v(w).to===v(s)&&v(w).index==="Top"&&X(q)})}var B=S(j,2);ve(B,1,()=>v(s).cardEntities,fe,(X,G)=>{var W=Te(),L=ne(W);{var I=oe=>{var he=Fo(),Z=g(he);const C=_e(()=>Y(v(G))),E=_e(()=>v(f).filter(V=>V.entity===v(G)));ot(Z,{get entity(){return v(G)},get state(){return v(C)},get actions(){return v(E)},cardActionResolve:void 0,get selectedList(){return a()},set selectedList(V){a(V)},$$legacy:!0}),Rt(2,he,()=>_,()=>({key:v(G).seq})),T(oe,he)};H(L,oe=>{(!v(w)||v(w).entity.seq!==v(G).seq)&&oe(I)})}T(X,W)});var $=S(B,2);{var ee=X=>{var G=qo(),W=g(G);ot(W,{get entity(){return v(w).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),O(()=>pe(G,`card_animation_receiver ${v(s).cellType??""} svelte-1mupj1p`)),Rt(1,G,()=>k,()=>({key:v(w).entity.seq})),T(X,G)};H($,X=>{v(w)&&v(w).entity&&v(w).to===v(s)&&v(w).index==="Bottom"&&X(ee)})}T(le,R)},se=le=>{var R=Uo(),j=ne(R);{var q=L=>{var I=Bo(),oe=g(I);ot(oe,{get entity(){return v(w).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),Rt(1,I,()=>k,()=>({key:v(w).entity.seq})),T(L,I)};H(j,L=>{v(w)&&v(w).entity&&v(w).to===v(s)&&v(w).index==="Bottom"&&L(q)})}var B=S(j,2);{var $=L=>{var I=Lo(),oe=ne(I);ve(oe,1,()=>v(s).cardEntities.toReversed(),fe,(C,E,V)=>{var K=Te(),ce=ne(K);{var we=Ee=>{var tt=Ro(),Xt=g(tt);const Pt=_e(()=>V===0&&!v(s).isStackCell?Y(...v(s).cardEntities):void 0),Ft=_e(()=>V===0?v(f).filter(at=>v(s).cardEntities.includes(at.entity)):void 0);ot(Xt,{get entity(){return v(E)},get state(){return v(Pt)},get actions(){return v(Ft)},cardActionResolve:void 0,get selectedList(){return a()},set selectedList(at){a(at)},$$legacy:!0}),Rt(2,tt,()=>_,()=>({key:v(E).seq})),T(Ee,tt)};H(ce,Ee=>{(!v(w)||v(w).entity.seq!==v(E).seq)&&Ee(we)})}T(C,K)});var he=S(oe,2);{var Z=C=>{var E=No(),V=g(E);O(()=>x(V,`【${v(s).cardEntities[0].battlePositionName??""}】`)),T(C,E)};H(he,C=>{v(s).cardEntities[0].battlePosition&&C(Z)})}T(L,I)};H(B,L=>{v(s).cardEntities.length>0&&L($)})}var ee=S(B,2);{var X=L=>{var I=Ho(),oe=g(I);O(()=>x(oe,v(s).cardEntities.length)),T(L,I)};H(ee,L=>{v(s).isStackCell&&L(X)})}var G=S(ee,2);{var W=L=>{var I=$o(),oe=g(I);ot(oe,{get entity(){return v(w).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),Rt(1,I,()=>k,()=>({key:v(w).entity.seq})),T(L,I)};H(G,L=>{v(w)&&v(w).entity&&v(w).to===v(s)&&v(w).index==="Top"&&L(W)})}T(le,R)};H(J,le=>{v(s).cellType==="Hand"?le(re):le(se,!1)},!0)}T(b,P)};H(Se,b=>{v(s).cellType==="Disable"?b(Ae):b(te,!1)})}O(b=>{pe(Q,`${`duel_field_cell duel_field_cell_${v(s).cellType}`??""} svelte-1mupj1p`),Yt(Q,"colspan",v(s).cellType==="Hand"?7:1),pe(ue,`${b??""} svelte-1mupj1p`)},[()=>`duel_card_wrapper ${v(s).cellType} ${v(o)?"can_accept_drop":""} ${U()?"can_action":""}`],_e),Me("dragover",ue,b=>z(b)),Me("drop",ue,b=>A(b)),T(r,Q),Ne()}ur(["click"]);var Go=D('<tr><td style=" white-space: nowrap;text-align: center;"> </td><td class="svelte-13svkzh"> </td></tr>'),Vo=D('<div class="duel_log svelte-13svkzh"><table><tbody></tbody></table></div>');function Yo(r,e){var f,u;Re(e,!1);let t=De(void 0),i=ge(e,"log",12);const n=()=>{i(i()),hs().then(()=>v(t)&&v(t).scroll(0,v(t).clientHeight*10))};(u=(f=i())==null?void 0:f.onUpdate)==null||u.append(n),Ye();var a=Vo(),s=g(a),l=g(s);ve(l,5,()=>i().records,fe,(d,y)=>{var h=Go(),o=g(h),p=g(o),m=S(o),_=g(m);O(()=>{var k,w;pe(o,`duelist ${((k=v(y).duelist)==null?void 0:k.seat)??""} svelte-13svkzh`),x(p,((w=v(y).duelist)==null?void 0:w.profile.name)||"SYSTEM"),x(_,v(y).text)}),T(d,h)}),Zs(a,d=>ie(t,d),()=>v(t)),T(r,a),Ne()}var Wo=D('<div><div class="duelist_name svelte-12u0sqq"> </div> <div> </div></div>');function gn(r,e){Re(e,!1);let t=ge(e,"duelist",12),i=De(0),n=De();const a=async()=>{const h=t().lp-v(i);if(!v(n)||Math.abs(h)<10){ie(i,t().lp),v(n)&&(v(n)(),ie(n,void 0));return}ie(i,v(i)+Math.floor(Math.random()*h)),await $l(100),a()},s=()=>{t(t()),!v(n)&&t().lp!==v(i)&&new Promise(h=>{ie(n,h),Math.abs(t().lp-v(i)),a()})};t().duel.log.onUpdate.append(s),a(),Ye();var l=Wo(),f=g(l),u=g(f),d=S(f,2),y=g(d);O(()=>{pe(l,`duelist ${t().seat??""} svelte-12u0sqq`),x(u,t().profile.name),pe(d,`duelist_lp ${(v(n)?"vibration":"")??""} svelte-12u0sqq`),x(y,v(i))}),T(r,l),Ne()}const zo=()=>{};var Ko=D("<div><!></div>"),Qo=D("<div></div>"),Jo=(r,e,t)=>e.resolve(v(t)),Xo=(r,e)=>e.resolve(void 0),Io=D('<button class="svelte-1h1of0m">Cancel</button>'),ec=D('<div class="base svelte-1h1of0m"><button class="overlay svelte-1h1of0m">☆</button> <div class="window svelte-1h1of0m"><div> </div> <!> <div><button class="svelte-1h1of0m">OK</button> <!></div></div></div>');function tc(r,e){Re(e,!0);let t=Qa(yt([]));var i=Te(),n=ne(i);{var a=s=>{var l=ec(),f=g(l);f.__click=[zo];var u=S(f,2),d=g(u),y=g(d),h=S(d,2);ve(h,17,()=>e.entities.map(k=>k.controller.seat).getDistinct(),fe,(k,w)=>{var F=Qo();ve(F,21,()=>e.entities.filter(N=>N.controller.seat===v(w)).toSorted(ua),fe,(N,U)=>{var M=Ko(),z=g(M);ot(z,{get entity(){return v(U)},isVisibleForcibly:!0,state:"Selectable",entitySelectResolve:A=>e.resolve(A),get qty(){return e.qty},cardActionResolve:void 0,get selectedList(){return v(t)},set selectedList(A){ie(t,yt(A))}}),T(N,M)}),O(()=>pe(F,`entities_list ${v(w)??""} svelte-1h1of0m`)),T(k,F)});var o=S(h,2),p=g(o);p.__click=[Jo,e,t];var m=S(p,2);{var _=k=>{var w=Io();w.__click=[Xo,e],T(k,w)};H(m,k=>{e.cancelable&&k(_)})}O(k=>{x(y,e.title),p.disabled=k},[()=>!e.validator(v(t))]),T(s,l)};H(n,s=>{s(a)})}T(r,i),Ne()}ur(["click"]);const rc=(r,e)=>{e.cancelable&&e.resolve(void 0)};var ic=D('<div class="duel_card_wrapper svelte-11mc7y0"><!> <div> </div></div>'),nc=(r,e)=>e.resolve(),ac=D('<div><button class="cancel_button svelte-11mc7y0">Cancel</button></div>'),sc=D('<div><button>★</button> <div><div> </div> <div class="flex svelte-11mc7y0"></div> <!></div></div>');function lc(r,e){Re(e,!0);const[t,i]=Ys(),n=()=>Vs(a,"$isDragging",t);let a=js(!1);const s=()=>a.set(!0),l=()=>a.set(!1);e.view.onDragStart.append(s),e.view.onDragEnd.append(l);const f=h=>{const o=h.validate(e.view.duel.chainBlockInfos);return o&&o.length>0?"Draggable":"Clickable"};var u=Te(),d=ne(u);{var y=h=>{var o=sc(),p=g(o);p.__click=[rc,e];var m=S(p,2),_=g(m),k=g(_),w=S(_,2);ve(w,21,()=>e.actions,fe,(U,M)=>{var z=ic(),A=g(z);const Y=At(()=>f(v(M))),Q=At(()=>e.dragAndDropOnly?[]:[v(M)]);ot(A,{get entity(){return v(M).entity},isVisibleForcibly:!0,get state(){return v(Y)},get actions(){return v(Q)},get cardActionResolve(){return e.resolve}});var ue=S(A,2),Se=g(ue);O(()=>x(Se,`«${v(M).title??""}»`)),T(U,z)});var F=S(w,2);{var N=U=>{var M=ac(),z=g(M);z.__click=[nc,e],T(U,M)};H(F,U=>{e.cancelable&&U(N)})}O(()=>{pe(o,`${`base ${n()?"minimum_mode":""}`??""} svelte-11mc7y0`),pe(p,`${`overlay ${n()?"minimum_mode":""}`??""} svelte-11mc7y0`),pe(m,`${`window ${n()?"minimum_mode":""}`??""} svelte-11mc7y0`),x(k,e.title)}),T(h,o)};H(d,h=>{h(y)})}T(r,u),Ne(),i()}ur(["click"]);const oc=(r,e,t,i)=>{e().cancelable&&(t()(void 0),ie(i,!1))};var cc=(r,e,t)=>e()(t()),dc=D("<li><button> </button></li>"),uc=(r,e)=>e()(void 0),fc=D("<button>Cancel</button>"),vc=D('<div class="base svelte-1103gpy"><button class="overlay svelte-1103gpy">★</button> <div class="window svelte-1103gpy"><div> </div> <ui class="text_list svelte-1103gpy"></ui> <!></div></div>');function pc(r,e){Re(e,!1);let t=ge(e,"arg",8),i=ge(e,"resolve",8),n=De(!0);Ye();var a=Te(),s=ne(a);{var l=f=>{var u=vc(),d=g(u);d.__click=[oc,t,i,n];var y=S(d,2),h=g(y),o=g(h),p=S(h,2);ve(p,5,()=>t().choises,fe,(k,w)=>{let F=()=>v(w).seq,N=()=>v(w).text;var U=dc(),M=g(U);M.__click=[cc,i,F];var z=g(M);O(()=>{pe(U,`text_item ${F()??""} svelte-1103gpy`),x(z,N())}),T(k,U)});var m=S(p,2);{var _=k=>{var w=fc();w.__click=[uc,i],T(k,w)};H(m,k=>{t().cancelable&&k(_)})}O(()=>x(o,t().title)),T(f,u)};H(s,f=>{v(n)&&f(l)})}T(r,a),Ne()}ur(["click"]);var hc=D('<div class="base svelte-1y912d"><!> <!> <!></div>');function yc(r,e){var y,h;Re(e,!1);let t=ge(e,"modalController",12);const i=()=>{t(t())};(h=(y=t())==null?void 0:y.onUpdate)==null||h.append(i),Ye();var n=hc(),a=g(n);{var s=o=>{tc(o,{get title(){return t().duelEntitiesSelectorArg.title},get entities(){return t().duelEntitiesSelectorArg.entities},get validator(){return t().duelEntitiesSelectorArg.validator},get qty(){return t().duelEntitiesSelectorArg.qty},get cancelable(){return t().duelEntitiesSelectorArg.cancelable},resolve:p=>{t().duelEntitiesSelectorResolve(p)}})};H(a,o=>{t().states.DuelEntitiesSelector==="Shown"&&o(s)})}var l=S(a,2);{var f=o=>{const p=_e(()=>t().cardActionSelectorArg.dragAndDropOnly??!1);lc(o,{get view(){return t().view},get title(){return t().cardActionSelectorArg.title},get actions(){return t().cardActionSelectorArg.actions},get dragAndDropOnly(){return v(p)},get cancelable(){return t().cardActionSelectorArg.cancelable},resolve:m=>{console.info(m),t().cardActionSelectorResolve(m)}})};H(l,o=>{t().states.DuelActionSelector==="Shown"&&o(f)})}var u=S(l,2);{var d=o=>{pc(o,{get arg(){return t().duelTextSelectorArg},resolve:p=>{console.info(p),t().duelTextSelectorResolve(p)}})};H(u,o=>{t().states.DuelTextSelector==="Shown"&&o(d)})}T(r,n),Ne()}const gc=(r,e)=>(e(e()==="Normal"?"Debug":"Normal"),!0);var mc=D('<div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"><pre class="description svelte-nn7bjy"> </pre></div></div> <div class="duel_card_info_row svelte-nn7bjy" style=" justify-content: space-between;"><div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"> </div></div>',1),_c=D('<div></div> <div class="svelte-nn7bjy"> </div>',1),Sc=D("<div> </div>"),wc=D("<div> </div>"),Tc=D('<div class="duel_card_info_row svelte-nn7bjy"><!> <!></div> <div class="duel_card_info_row svelte-nn7bjy"></div>',1),kc=D('<div class="duel_card_row svelte-nn7bjy"><div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"> </div></div>'),bc=D('<div class="duel_card_row svelte-nn7bjy"><div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"> </div></div>'),Cc=D("<!> <!>",1),Dc=D('<div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"><pre class="description svelte-nn7bjy"> </pre></div></div>'),Ec=D('<div class="svelte-nn7bjy"> </div>'),Ac=D('<div class="svelte-nn7bjy"> </div>'),xc=D('<div class="svelte-nn7bjy"> </div>'),Mc=D('<div class="svelte-nn7bjy"> </div>'),Pc=D('<div class="svelte-nn7bjy"> </div>'),Fc=D('<div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"><pre class="json svelte-nn7bjy"> </pre> <pre class="json svelte-nn7bjy"> </pre> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div></div></div>'),qc=D('<div class="svelte-nn7bjy">※テスト用カードです</div>'),Oc=D('<div class="duel_card_info_links svelte-nn7bjy"><a target="_blank" rel="noopener noreferrer" title="遊戯王カードWiki" class="svelte-nn7bjy">⇒遊戯王カードWiki</a> <a target="_blank" rel="noopener noreferrer" title="コナミカードデータベース" class="svelte-nn7bjy"> </a></div>'),Bc=D('<div role="contentinfo"><div class="duel_card_info_header svelte-nn7bjy"><div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"> </div></div> <div class="duel_card_info_row svelte-nn7bjy" style="position:sticky; top:0;"><div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"> </div></div> <!></div> <div class="duel_card_info_body svelte-nn7bjy"><!></div> <div class="duel_card_info_footer svelte-nn7bjy"><!></div></div>');function Rc(r,e){Re(e,!1);let t=ge(e,"entity",8,void 0);const i=()=>t()?$e[t().origin.name]:void 0,n=()=>{var u;return t()&&(t().origin.cardId??!1)?`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=2&cid=${t().origin.cardId}`:`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=1&sess=1&rp=10&mode=&sort=1&keyword=${(u=i())==null?void 0:u.name}&stype=1&ctype=&othercon=2&starfr=&starto=&pscalefr=&pscaleto=&linkmarkerfr=&linkmarkerto=&link_m=2&atkfr=&atkto=&deffr=&defto=&releaseDStart=1&releaseMStart=1&releaseYStart=1999&releaseDEnd=&releaseMEnd=&releaseYEnd=`};let a=ge(e,"mode",12,"Normal");Ye();var s=Te(),l=ne(s);{var f=u=>{var d=Bc();d.__contextmenu=[gc,a];var y=g(d),h=g(y),o=g(h),p=g(o),m=S(h,2),_=g(m),k=g(_),w=S(_,2),F=g(w),N=S(m,2);{var U=te=>{var b=Cc(),P=ne(b);{var J=R=>{var j=mc(),q=ne(j),B=g(q),$=g(B),ee=g($),X=S(q,2),G=g(X),W=g(G),L=S(G,2),I=g(L);O(()=>{x(ee,$e[t().origin.name].pendulumDescription),x(W,`◀ ${t().psL??""}`),x(I,`${t().psR??""} ▶`)}),T(R,j)};H(P,R=>{var j;(j=t().status.monsterCategories)!=null&&j.includes("Pendulum")&&R(J)})}var re=S(P,2);{var se=R=>{var j=Tc(),q=ne(j),B=g(q);ve(B,1,()=>t().attr,fe,(G,W)=>{var L=_c(),I=ne(L),oe=S(I,2),he=g(oe);O(()=>{pe(I,`monster_attr ${v(W)??""} svelte-nn7bjy`),x(he,`${Ni[v(W)]??""}属性`)}),T(G,L)});var $=S(B,2);{var ee=G=>{var W=Sc(),L=g(W);O(()=>{pe(W,`monster_cat ${t().status.type??""} svelte-nn7bjy`),x(L,`${hr[t().status.type]??""}${Jr[t().status.type]??""}族`)}),T(G,W)};H($,G=>{t().status.type&&G(ee)})}var X=S(q,2);ve(X,5,()=>t().status.monsterCategories??[],fe,(G,W)=>{var L=wc(),I=g(L);O(()=>{pe(L,`monster_cat ${v(W)??""} svelte-nn7bjy`),x(I,`${fr[v(W)]??""}${Qr[v(W)]??""}`)}),T(G,L)}),T(R,j)},le=R=>{var j=Te(),q=ne(j);{var B=ee=>{var X=kc(),G=S(g(X),2),W=g(G);O(()=>x(W,`${vr[t().status.spellCategory]??""}魔法`)),T(ee,X)},$=ee=>{var X=Te(),G=ne(X);{var W=L=>{var I=bc(),oe=S(g(I),2),he=g(oe);O(()=>x(he,`${pr[t().status.trapCategory]??""}罠`)),T(L,I)};H(G,L=>{t().status.kind==="Trap"&&t().status.trapCategory&&L(W)},!0)}T(ee,X)};H(q,ee=>{t().status.kind==="Spell"&&t().status.spellCategory?ee(B):ee($,!1)},!0)}T(R,j)};H(re,R=>{t().status.kind==="Monster"?R(se):R(le,!1)})}T(te,b)};H(N,te=>{a()==="Normal"&&te(U)})}var M=S(y,2),z=g(M);{var A=te=>{var b=Dc(),P=g(b),J=g(P),re=g(J);O(se=>x(re,se),[()=>{var se;return(se=i())==null?void 0:se.description}],_e),T(te,b)},Y=te=>{var b=Fc(),P=g(b),J=g(P),re=g(J),se=S(J,2),le=g(se),R=S(se,2);R.textContent='"actions" :[';var j=S(R,2);ve(j,1,()=>t().actions,fe,(E,V)=>{var K=Ec(),ce=g(K);O(()=>x(ce,`"${v(V).playType??""} ${v(V).title??""}",`)),T(E,K)});var q=S(j,2);q.textContent="],";var B=S(q,2);B.textContent='"continuousEffects" :[';var $=S(B,2);ve($,1,()=>t().continuousEffects,fe,(E,V)=>{var K=Ac(),ce=g(K);O(()=>x(ce,`"${v(V).isStarted??""}",`)),T(E,K)});var ee=S($,2);ee.textContent="],";var X=S(ee,2);X.textContent='"procFilters" :[';var G=S(X,2);ve(G,1,()=>t().procFilterBundle.operators,fe,(E,V)=>{var K=xc(),ce=g(K);O(we=>x(ce,`"${we??""} ${v(V).title??""}",`),[()=>v(V).isSpawnedBy.toString()],_e),T(E,K)});var W=S(G,2);W.textContent="],";var L=S(W,2);L.textContent='"numericStateOperators" :[';var I=S(L,2);ve(I,1,()=>t().numericOprsBundle.operators,fe,(E,V)=>{var K=Mc(),ce=g(K);O(we=>x(ce,`"${we??""} ${v(V).title??""}",`),[()=>v(V).isSpawnedBy.toString()],_e),T(E,K)});var oe=S(I,2);oe.textContent="],";var he=S(oe,2);he.textContent='"cardRelations" :[';var Z=S(he,2);ve(Z,1,()=>t().cardRelationBundle.operators,fe,(E,V)=>{var K=Pc(),ce=g(K);O(we=>x(ce,`"${we??""} ${v(V).title??""}",`),[()=>v(V).isSpawnedBy.toString()],_e),T(E,K)});var C=S(Z,2);C.textContent="],",O((E,V)=>{x(re,`"info" :${E??""},`),x(le,`"status" :${V??""},`)},[()=>JSON.stringify(t().info,null,2),()=>JSON.stringify(t().status,null,2)],_e),T(te,b)};H(z,te=>{a()==="Normal"?te(A):te(Y,!1)})}var Q=S(M,2),ue=g(Q);{var Se=te=>{var b=qc();T(te,b)},Ae=te=>{var b=Oc(),P=g(b),J=S(P,2),re=g(J);O(se=>{var le;Yt(P,"href",`https://yugioh-wiki.net/index.php?${t().origin.wikiEncodedName}`),Yt(J,"href",se),x(re,`⇒${((le=t())!=null&&le.origin.cardId?"公式カードページ":"公式で検索")??""}`)},[n],_e),T(te,b)};H(ue,te=>{var b;(b=t())!=null&&b.origin.isForTest?te(Se):te(Ae,!1)})}O((te,b,P)=>{pe(d,`duel_card duel_card_info ${t().origin.kind??""} ${te??""} svelte-nn7bjy`),x(p,t().nm),x(k,b),x(F,P)},[()=>{var te;return(te=t().origin.monsterCategories)==null?void 0:te.join(" ")},()=>"★".repeat(t().lvl||0),()=>"☆".repeat(t().rank||0)],_e),T(u,d)};H(l,u=>{t()&&u(f)})}T(r,s),Ne()}ur(["contextmenu"]);var Nc=D('<div class="duel_field_cell_info_item svelte-1xj7qf1"><!></div>'),Lc=D('<div class="duel_field_cell_info_box svelte-1xj7qf1"><div class="duel_field_cell_info_label svelte-1xj7qf1"> </div> <!></div>'),Hc=D('<div class="duel_field_cell_info svelte-1xj7qf1"><div class="duel_field_cell_info_header item_btn svelte-1xj7qf1"><div class="svelte-1xj7qf1"> </div> <div class="svelte-1xj7qf1"> </div></div> <div class="duel_field_cell_info_body svelte-1xj7qf1"></div></div>');function $c(r,e){Re(e,!1);let t=ge(e,"cell",12);const i=()=>{t(t())},n=h=>t().cardEntities.filter(o=>o.face===h);t().field.duel.view.onDuelUpdate.append(i),Ye();var a=Hc(),s=g(a),l=g(s),f=g(l),u=S(l,2),d=g(u),y=S(s,2);ve(y,4,()=>["FaceUp","FaceDown"],fe,(h,o)=>{var p=Te(),m=ne(p);{var _=k=>{var w=Lc(),F=g(w),N=g(F),U=S(F,2);ve(U,1,()=>n(o).toSorted(ua),fe,(M,z)=>{var A=Nc(),Y=g(A);const Q=_e(()=>t().owner===t().field.duel.duelists.Below);ot(Y,{get entity(){return v(z)},get isVisibleForcibly(){return v(Q)},isWideMode:!0,cardActionResolve:void 0}),T(M,A)}),O(()=>x(N,o==="FaceUp"?"表向き":"裏向き")),T(k,w)};H(m,k=>{n(o).length&&k(_)})}T(h,p)}),O(()=>{var h;x(f,(h=t().owner)==null?void 0:h.profile.name),x(d,t().cellType)}),T(r,a),Ne()}const Uc=go({duration:400});var Zc=D('<div class="duel_field_header_message svelte-accyye"> </div> <div class="duel_field_header_buttons svelte-accyye"><button class="svelte-accyye">サレンダー</button></div>',1),jc=D("<tr></tr>"),Gc=D('<table class="duel_field svelte-accyye"><tbody class="svelte-accyye"></tbody></table>'),Vc=D('<button class="svelte-accyye">OK</button>'),Yc=D('<div style="position:absolute;right:0;top:0"> </div> <div class="flex duel_desk svelte-accyye"><div class="duel_desk_left v_flex svelte-accyye"><!> <!> <!></div> <div class=" duel_desk_center v_flex svelte-accyye"><div class="duel_field_header svelte-accyye"><!></div> <div class="svelte-accyye"><!></div> <div class="duel_field_footer svelte-accyye"><!></div></div> <div class=" duel_desk_right svelte-accyye" style="text-align: left;"><!></div></div> <!>',1);function Wc(r,e){Re(e,!1);let t=ge(e,"duel",12),i=()=>{},n=De(()=>!0),a=De();const s=R=>{i=R.resolve,ie(n,R.entitiesValidator),ie(a,R.selectableEntities),R.duelEntitiesSelectorArg&&t().view.modalController.selectDuelEntities(R.duelEntitiesSelectorArg).then(j=>{i({selectedEntities:j})})};t().view.onWaitStart.append(s);let l=De(void 0),f=De("Normal");const u=({card:R,mode:j})=>{ie(l,R),ie(f,j)};t().view.onShowCardEntity.append(u);let d=ge(e,"selectedList",28,()=>[]);const y=()=>{t(t())};t().view.onDuelUpdate.append(y);const h=()=>{console.log(d()),v(n)(d())&&(console.log(d()),i({selectedEntities:d()}))},o=()=>{i({surrender:!0})};t().main(),Ye();var p=Yc(),m=ne(p),_=g(m),k=S(m,2),w=g(k),F=g(w);gn(F,{get duelist(){return t().duelists.Above}});var N=S(F,2);Rc(N,{get entity(){return v(l)},get mode(){return v(f)}});var U=S(N,2);gn(U,{get duelist(){return t().duelists.Below}});var M=S(w,2),z=g(M),A=g(z);{var Y=R=>{var j=Zc(),q=ne(j),B=g(q),$=S(q,2),ee=g($);O(()=>x(B,`[TURN:${t().clock.turn}][PHASE:${t().phase}] ${t().view.message}`)),Me("click",ee,o),T(R,j)};H(A,R=>{t().isEnded||R(Y)})}var Q=S(z,2),ue=g(Q);{var Se=R=>{var j=Gc(),q=g(j);ve(q,5,()=>t().field.cells,fe,(B,$,ee)=>{var X=jc();pe(X,`${`duel_desk_row_${ee}`??""} svelte-accyye`),ve(X,5,()=>v($),fe,(G,W,L)=>{jo(G,{get view(){return t().view},row:ee,column:L,get selectedList(){return d()},set selectedList(I){d(I)},$$legacy:!0})}),T(B,X)}),T(R,j)};H(ue,R=>{t().clock.turn>0&&R(Se)})}var Ae=S(Q,2),te=g(Ae);{var b=R=>{var j=Vc();O(q=>j.disabled=q,[()=>!v(n)(d())],_e),Me("click",j,h),T(R,j)};H(te,R=>{v(a)&&v(a).length>0&&R(b)})}var P=S(M,2),J=g(P);{var re=R=>{Yo(R,{get log(){return t().log}})},se=R=>{var j=Te(),q=ne(j);{var B=$=>{$c($,{get cell(){return t().view.infoBoardCell}})};H(q,$=>{t().view.infoBoardState==="CellInfo"&&$(B)},!0)}T(R,j)};H(J,R=>{t().view.infoBoardState==="Log"?R(re):R(se,!1)})}var le=S(k,2);yc(le,{get modalController(){return t().view.modalController}}),O(R=>x(_,R),[()=>t().clock.toString()],_e),T(r,p),Ne()}var zc=D("<div></div>"),Kc=D('<span> </span> / <span style="display: inline-block;width:2rem;text-align: right;"> </span>',1),Qc=D('<li class="deck_editor_item svelte-vivzk2"><div role="listitem"><div class="svelte-vivzk2"><div class="svelte-vivzk2"> </div> <div style="display:flex" class="svelte-vivzk2"><div class="svelte-vivzk2"><!> <!> <!> <!> <!> <!> <!></div> <div style="flex-grow: 1; width:0.1rem" class="svelte-vivzk2"></div> <div class="svelte-vivzk2"><!></div></div></div></div> <button class="button_style_reset svelte-vivzk2">+</button> <button class="button_style_reset svelte-vivzk2">-</button></li>'),Jc=D('<div class="deck_editor_card_kind svelte-vivzk2"><span class="svelte-vivzk2"> </span> <ul class="svelte-vivzk2"></ul></div>'),Xc=D('<div class="deck_editor_deck_type svelte-vivzk2"><span class="svelte-vivzk2"> </span> <!></div>'),Ic=D('<div class="deck_editor_card_list svelte-vivzk2"></div>');function mn(r,e){Re(e,!1);let t=ge(e,"allCardInfos",8),i=ge(e,"deckCardInfos",12),n=ge(e,"mode",8),a=ge(e,"onAttention",8);const s={Deck:["Monster","Spell","Trap"],ExtraDeck:["Monster"]},l=(y,h)=>(n()==="List"?t():i()).filter(o=>{var p;return ki.has(o.name)||((p=o.monsterCategories)==null?void 0:p.includes("Normal"))}).filter(o=>!h||o.kind===h).filter(o=>{var p,m;return!y||y==="Deck"&&!((p=o==null?void 0:o.monsterCategories)!=null&&p.union(Wt).length)||y==="ExtraDeck"&&((m=o==null?void 0:o.monsterCategories)==null?void 0:m.union(Wt).length)}).toSorted(Cr),f=(y,h)=>{const o=i().filter(m=>m.name===h.name).length;if(o>2)return;const p=y.shiftKey?3-o:1;p<1||(i().push(...Array(p).fill(h)),i().sort(Cr),i(i()))},u=(y,h)=>{let o=0;i(i().filter(p=>p.name!==h.name?!0:(o++,!y.shiftKey&&o>1))),i().sort(Cr)};Ye();var d=Ic();ve(d,5,()=>Is,fe,(y,h)=>{var o=Xc(),p=g(o),m=g(p),_=S(p,2);ve(_,1,()=>s[v(h)],fe,(k,w)=>{var F=Jc(),N=g(F),U=g(N),M=S(N,2);ve(M,5,()=>l(v(h),v(w)),fe,(z,A)=>{var Y=Qc(),Q=g(Y),ue=g(Q),Se=g(ue),Ae=g(Se),te=S(Se,2),b=g(te),P=g(b);{var J=Z=>{var C=qt();O(()=>x(C,`★${v(A).level??""}`)),T(Z,C)};H(P,Z=>{v(A).level&&Z(J)})}var re=S(P,2);{var se=Z=>{var C=qt();O(()=>x(C,`☆${v(A).rank??""}`)),T(Z,C)};H(re,Z=>{v(A).rank&&Z(se)})}var le=S(re,2);{var R=Z=>{var C=zc();O(()=>pe(C,`monster_attr ${v(A).attribute??""} svelte-vivzk2`)),T(Z,C)};H(le,Z=>{v(A).attribute!==void 0&&Z(R)})}var j=S(le,2);{var q=Z=>{var C=qt();O(()=>x(C,hr[v(A).type])),T(Z,C)};H(j,Z=>{v(A).type!==void 0&&Z(q)})}var B=S(j,2);ve(B,1,()=>v(A).monsterCategories??[],fe,(Z,C)=>{var E=qt();O(()=>x(E,fr[v(C)])),T(Z,E)});var $=S(B,2);{var ee=Z=>{var C=qt();O(()=>x(C,`${vr[v(A).spellCategory]??""}魔法`)),T(Z,C)};H($,Z=>{v(A).spellCategory!==void 0&&Z(ee)})}var X=S($,2);{var G=Z=>{var C=qt();O(()=>x(C,`${pr[v(A).trapCategory]??""}罠`)),T(Z,C)};H(X,Z=>{v(A).trapCategory!==void 0&&Z(G)})}var W=S(b,4),L=g(W);{var I=Z=>{var C=Kc(),E=ne(C),V=g(E),K=S(E,2),ce=g(K);O(()=>{x(V,v(A).attack??"?"),x(ce,v(A).defense??"?")}),T(Z,C)};H(L,Z=>{v(A).kind==="Monster"&&Z(I)})}var oe=S(Q,2),he=S(oe,2);O(Z=>{pe(Q,`${Z??""} svelte-vivzk2`),x(Ae,v(A).name)},[()=>{var Z,C;return`deck_editor_card duel_card ${v(A).kind} ${(C=(Z=v(A))==null?void 0:Z.monsterCategories)==null?void 0:C.join(" ")} ${ki.has(v(A).name)?"is_implemented":"is_not_implemented"}`}],_e),Me("mouseenter",Q,()=>a()(v(A))),Me("click",oe,Z=>f(Z,v(A))),Me("click",he,Z=>u(Z,v(A))),T(z,Y)}),O(()=>x(U,na[v(w)])),T(k,F)}),O(()=>x(m,el[v(h)])),T(y,o)}),T(r,d),Ne()}var ed=D('<div class="duel_card_info_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"><pre class="description svelte-1xf9hqi"> </pre></div></div> <div class="duel_card_info_row svelte-1xf9hqi" style=" justify-content: space-between;"><div class="svelte-1xf9hqi"> </div> <div class="svelte-1xf9hqi"> </div></div>',1),td=D('<div></div> <div class="svelte-1xf9hqi"> </div>',1),rd=D("<div> </div>"),id=D("<div> </div>"),nd=D('<div class="duel_card_info_row svelte-1xf9hqi"><!> <!></div> <div class="duel_card_info_row svelte-1xf9hqi"></div>',1),ad=D('<div class="duel_card_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"></div> <div class="svelte-1xf9hqi"> </div></div>'),sd=D('<div class="duel_card_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"></div> <div class="svelte-1xf9hqi"> </div></div>'),ld=D('<div class="duel_card_info_row svelte-1xf9hqi"><div class="svelte-1xf9hqi">※テスト用カードです</div></div>'),od=D('<div class="duel_card_info_links svelte-1xf9hqi"><a target="_blank" rel="noopener noreferrer" title="遊戯王カードWiki" class="svelte-1xf9hqi">⇒遊戯王カードWiki</a></div>'),cd=D('<div><div class="duel_card_info_header svelte-1xf9hqi"><div class="duel_card_info_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"> </div></div> <div class="duel_card_info_row svelte-1xf9hqi" style="position:sticky; top:0;"><div class="svelte-1xf9hqi"> </div> <div class="svelte-1xf9hqi"> </div></div></div> <div class="duel_card_info_body svelte-1xf9hqi"><!> <!> <div class="duel_card_info_row description svelte-1xf9hqi"><div class="svelte-1xf9hqi"><pre class="description svelte-1xf9hqi"> </pre></div></div> <!></div></div>');function dd(r,e){Re(e,!1);let t=ge(e,"cardInfo",8,void 0);const i=()=>t()?$e[t().name]:void 0;Ye();var n=Te(),a=ne(n);{var s=l=>{var f=cd(),u=g(f),d=g(u),y=g(d),h=g(y),o=S(d,2),p=g(o),m=g(p),_=S(p,2),k=g(_),w=S(u,2),F=g(w);{var N=b=>{var P=ed(),J=ne(P),re=g(J),se=g(re),le=g(se),R=S(J,2),j=g(R),q=g(j),B=S(j,2),$=g(B);O(()=>{x(le,$e[t().name].pendulumDescription),x(q,`◀ ${t().pendulumScaleL??""}`),x($,`${t().pendulumScaleR??""} ▶`)}),T(b,P)};H(F,b=>{var P;(P=t().monsterCategories)!=null&&P.includes("Pendulum")&&b(N)})}var U=S(F,2);{var M=b=>{var P=nd(),J=ne(P),re=g(J);{var se=q=>{var B=td(),$=ne(B),ee=S($,2),X=g(ee);O(()=>{pe($,`monster_attr ${t().attribute??""} svelte-1xf9hqi`),x(X,`${Ni[t().attribute]??""}属性`)}),T(q,B)};H(re,q=>{t().attribute&&q(se)})}var le=S(re,2);{var R=q=>{var B=rd(),$=g(B);O(()=>{pe(B,`monster_cat ${t().type??""} svelte-1xf9hqi`),x($,`${hr[t().type]??""}${Jr[t().type]??""}族`)}),T(q,B)};H(le,q=>{t().type&&q(R)})}var j=S(J,2);ve(j,5,()=>t().monsterCategories??[],fe,(q,B)=>{var $=id(),ee=g($);O(()=>{pe($,`monster_cat ${v(B)??""} svelte-1xf9hqi`),x(ee,`${fr[v(B)]??""}${Qr[v(B)]??""}`)}),T(q,$)}),T(b,P)},z=b=>{var P=Te(),J=ne(P);{var re=le=>{var R=ad(),j=S(g(R),2),q=g(j);O(()=>x(q,`${vr[t().spellCategory]??""}魔法`)),T(le,R)},se=le=>{var R=Te(),j=ne(R);{var q=B=>{var $=sd(),ee=S(g($),2),X=g(ee);O(()=>x(X,`${pr[t().trapCategory]??""}罠`)),T(B,$)};H(j,B=>{t().kind==="Trap"&&t().trapCategory&&B(q)},!0)}T(le,R)};H(J,le=>{t().kind==="Spell"&&t().spellCategory?le(re):le(se,!1)},!0)}T(b,P)};H(U,b=>{t().kind==="Monster"?b(M):b(z,!1)})}var A=S(U,2),Y=g(A),Q=g(Y),ue=g(Q),Se=S(A,2);{var Ae=b=>{var P=ld();T(b,P)},te=b=>{var P=od(),J=g(P);O(re=>Yt(J,"href",re),[()=>{var re;return(re=i())==null?void 0:re.wikiHref}],_e),T(b,P)};H(Se,b=>{t().isForTest?b(Ae):b(te,!1)})}O((b,P,J,re)=>{pe(f,`duel_card duel_card_info ${t().kind??""} ${b??""} svelte-1xf9hqi`),x(h,t().name),x(m,P),x(k,J),x(ue,re)},[()=>{var b;return(b=t().monsterCategories)==null?void 0:b.join(" ")},()=>"★".repeat(t().level||0),()=>"☆".repeat(t().rank||0),()=>{var b;return(b=i())==null?void 0:b.description}],_e),T(l,f)};H(a,l=>{t()&&l(s)})}T(r,n),Ne()}const ud={0:{aaa:"日",aaaa:"日曜日",ddd:"Sun",dddd:"Sunday"},1:{aaa:"月",aaaa:"月曜日",ddd:"Mon",dddd:"Monday"},2:{aaa:"火",aaaa:"火曜日",ddd:"Tue",dddd:"Tuesday"},3:{aaa:"水",aaaa:"水曜日",ddd:"Wed",dddd:"Wednesday"},4:{aaa:"木",aaaa:"木曜日",ddd:"Thu",dddd:"Thursday"},5:{aaa:"金",aaaa:"金曜日",ddd:"Fri",dddd:"Friday"},6:{aaa:"土",aaaa:"土曜日",ddd:"Sat",dddd:"Saturday"}};class fd{constructor(){c(this,"DefaultSeparator1","/");c(this,"DefaultSeparator2"," ");c(this,"DefaultSeparator3",":");c(this,"createDate",e=>{if(!e)return;const t=new Date(e);if(!isNaN(t.getTime()))return t});c(this,"createDateOr",(e,t)=>this.createDate(e)||t||new Date);c(this,"truncateDate",e=>{const t=e||new Date;return new Date(t.getFullYear(),t.getMonth(),t.getDate())});c(this,"addDate",(e,t)=>{const i=this.createDateOr(e);return i.setDate(i.getDate()+t),i});c(this,"addMonth",(e,t)=>{const i=this.createDateOr(e);return i.setMonth(i.getMonth()+t),i});c(this,"addYear",(e,t)=>{const i=this.createDateOr(e);return i.setFullYear(i.getFullYear()+t),i});c(this,"getDayOfWeek",(e,t="dddd")=>{const i=this.createDate(e);return i?ud[i.getDay()][t]:""});c(this,"formatToYYYYMMDD",(e,t=this.DefaultSeparator1)=>{const i=this.createDate(e);if(!i)return"";const n=i.getFullYear().toString(),a=("0"+(i.getMonth()+1)).slice(-2),s=("0"+i.getDate()).slice(-2);return n+t+a+t+s});c(this,"formatToYYYYMM",(e,t=this.DefaultSeparator1)=>{const i=this.createDate(e);if(!i)return"";t||(t="");const n=i.getFullYear().toString(),a=("0"+(i.getMonth()+1)).slice(-2);return n+t+a});c(this,"formatToHHMMSS",(e,t=this.DefaultSeparator3)=>{const i=this.createDate(e);if(!i)return"";t||(t="");const n=i.getHours(),a=i.getMinutes(),s=i.getSeconds();return("0"+n).slice(-2)+t+("0"+a).slice(-2)+t+("0"+s).slice(-2)});c(this,"formatToHHMM",(e,t=this.DefaultSeparator3)=>{const i=this.createDate(e);if(!i)return"";t||(t="");const n=("0"+i.getHours()).slice(-2),a=("0"+i.getMinutes()).slice(-2);return n+t+a});c(this,"formatToYYYYMMDD_HHMM",(e,t=this.DefaultSeparator1,i=this.DefaultSeparator2,n=this.DefaultSeparator3)=>{const a=this.createDate(e);return a?this.formatToYYYYMMDD(a,t)+i+this.formatToHHMM(a,n):""});c(this,"formatToYYYYMMDD_HHMMSS",(e,t=this.DefaultSeparator1,i=this.DefaultSeparator2,n=this.DefaultSeparator3)=>{const a=this.createDate(e);return a?this.formatToYYYYMMDD(a,t)+i+this.formatToHHMMSS(a,n):""})}}const Xe=new fd;Date.prototype.truncateDate=function(){return Xe.truncateDate(this)};Date.prototype.getCloneOr=function(r){return Xe.createDateOr(this,r)};Date.prototype.addDate=function(r){return Xe.addDate(this,r)};Date.prototype.addMonth=function(r){return Xe.addDate(this,r)};Date.prototype.addYear=function(r){return Xe.addDate(this,r)};Date.prototype.getDayOfWeek=function(r="dddd"){return Xe.getDayOfWeek(this,r)};Date.prototype.formatToYYYYMM=function(r){return Xe.formatToYYYYMM(this,r)};Date.prototype.formatToYYYYMMDD=function(r){return Xe.formatToYYYYMMDD(this,r)};Date.prototype.formatToYYYYMMDD_HHMM=function(r,e,t){return Xe.formatToYYYYMMDD_HHMM(this,r,e,t)};Date.prototype.formatToYYYYMMDD_HHMMSS=function(r,e,t){return Xe.formatToYYYYMMDD_HHMMSS(this,r,e,t)};Date.prototype.formatToHHMM=function(r){return Xe.formatToHHMM(this,r)};Date.prototype.formatToHHMMSS=function(r){return Xe.formatToHHMMSS(this,r)};var vd=D('<label><input type="checkbox"> </label>'),pd=D('<label><input type="checkbox"> </label>'),hd=D('<label><input type="checkbox"> <div style="display: inline-block;"></div> </label>'),yd=D('<label><input type="checkbox"> </label>'),gd=D('<label><input type="checkbox"> </label>'),md=D('<label><input type="checkbox"> </label>'),_d=D("<option> </option>"),Sd=D('<div class="deck_editor_body_right_header svelte-rsq0rf"><div class="deck_editor_body_right_header_row svelte-rsq0rf"><div class="svelte-rsq0rf">編集対象</div> <select></select></div> <div class="deck_editor_body_right_header_row svelte-rsq0rf"><div class="svelte-rsq0rf">新規名称</div> <input type="text"></div> <div class="deck_editor_body_right_header_row svelte-rsq0rf"><div class="svelte-rsq0rf">操作</div> <div class="svelte-rsq0rf"><button class="svelte-rsq0rf">デッキを保存</button></div> <div class="svelte-rsq0rf"></div> <div class="svelte-rsq0rf"><button class="svelte-rsq0rf">デッキを複製</button></div> <div class="svelte-rsq0rf"><button title="shiftキー押下で確認メッセージスキップ" class="svelte-rsq0rf">デッキを削除</button></div></div></div> <!>',1),wd=D("<div>デッキ情報読込中</div>"),Td=D('<div class="deck_editor svelte-rsq0rf"><div class="deck_editor_header"></div> <div class="deck_editor_body svelte-rsq0rf"><div class="deck_editor_body_left svelte-rsq0rf"><div class="deck_editor_search_box svelte-rsq0rf"><div><div>検索条件</div></div> <div class="deck_editor_search_box_row svelte-rsq0rf"><div class="svelte-rsq0rf">名称</div> <div class="svelte-rsq0rf"><input type="text" style="width:70%">※ルビには対応していません</div></div> <div class="deck_editor_search_box_row svelte-rsq0rf"><div class="svelte-rsq0rf">種類</div> <div class="svelte-rsq0rf"></div></div> <div class="deck_editor_search_box_row svelte-rsq0rf"><div class="svelte-rsq0rf">モンスター</div> <div class="svelte-rsq0rf"></div></div> <div class="deck_editor_search_box_row svelte-rsq0rf"><div class="svelte-rsq0rf">属性</div> <div class="svelte-rsq0rf"></div></div> <div class="deck_editor_search_box_row svelte-rsq0rf"><div class="svelte-rsq0rf">種族</div> <div class="svelte-rsq0rf"></div></div> <div class="deck_editor_search_box_row svelte-rsq0rf"><div class="svelte-rsq0rf">魔法</div> <div class="svelte-rsq0rf"></div></div> <div class="deck_editor_search_box_row svelte-rsq0rf"><div class="svelte-rsq0rf">罠</div> <div class="svelte-rsq0rf"></div></div> <div class="deck_editor_search_box_row svelte-rsq0rf"><div class="svelte-rsq0rf">テスト用</div> <div class="svelte-rsq0rf"><label><input type="checkbox"> テスト用カードを表示する</label></div></div></div> <!></div> <div class="deck_editor_body_center svelte-rsq0rf"><!></div> <div class="deck_editor_body_right svelte-rsq0rf"><!></div></div></div>');function kd(r,e){Re(e,!1);const t=[],i=[],n=[],a=[],s=[],l=[],f=async()=>{const E=(await v(y)).find(V=>V.id===v(d));E&&ie(o,{...E,cardInfos:E.cardNames.map(V=>$e[V])})},u=()=>Et.getAllDeckInfo().then(C=>(C.forEach(E=>console.log(E.id,E.lastUsedAt,E.lastUsedAt.getTime())),console.log(Math.max(...C.map(E=>E.lastUsedAt.getTime()))),ie(d,(C.find(E=>E.lastUsedAt.getTime()===Math.max(...C.map(V=>V.lastUsedAt.getTime())))??C[0]).id),C));let d=De(-1),y=De(u());v(y).then(f);const h=()=>{ie(y,u()),f()};let o=De({id:-Number.MAX_VALUE,name:"",description:"",lastUsedAt:new Date,cardInfos:[]}),p=De($e.ゾンビーノ);const m=De({name:"",cardKinds:[...gi],monsterCategories:[...rn].filter(C=>C!=="Normal"&&C!=="Token"),monsterAttributes:[...nn],monsterTypes:[...an],spellCategories:[...sn],trapCategories:[...ln],isForTest:!1}),_=()=>Object.values($e).filter(C=>{if(!v(m).cardKinds.includes(C.kind)||v(m).name.trim().length&&!C.name.includes(v(m).name)||C.isForTest&&!v(m).isForTest)return!1;if(C.kind==="Monster")return C.attribute&&!v(m).monsterAttributes.includes(C.attribute)||C.type&&!v(m).monsterTypes.includes(C.type)||!C.monsterCategories?!1:C.monsterCategories.union(v(m).monsterCategories).length;if(C.kind==="Spell")return C.spellCategory&&v(m).spellCategories.includes(C.spellCategory);if(C.kind==="Trap")return C.trapCategory&&v(m).trapCategories.includes(C.trapCategory)}),k=C=>{ie(p,C)},w=async()=>{const E=(await v(y)).find(V=>V.id===v(d));if(!E)throw new Error("illegal state");return E},F=async()=>{const C=await w();await C.saveDeckInfo({...C,name:v(o).name,cardNames:v(o).cardInfos.map(E=>E.name),lastUsedAt:new Date}),h()},N=async()=>{(await Et.createNewDeck(`デッキ_${new Date().formatToYYYYMMDD_HHMMSS("","","")}`,`コピー日時：${new Date().formatToYYYYMMDD_HHMMSS("-"," ",":")}`,v(o).cardInfos.map(E=>E.name))).saveDeckInfo(),h()},U=async C=>{const E=await w();!C.shiftKey&&!confirm(`デッキ【${E.name}】を削除します。
よろしいですか？`)||(await E.delete(),h())};Ye();var M=Td(),z=S(g(M),2),A=g(z),Y=g(A),Q=S(g(Y),2),ue=S(g(Q),2),Se=g(ue),Ae=S(Q,2),te=S(g(Ae),2);ve(te,5,()=>gi,fe,(C,E)=>{var V=vd(),K=g(V),ce,we=S(K);O(()=>{ce!==(ce=v(E))&&(K.value=(K.__value=v(E))==null?"":v(E)),x(we,` ${na[v(E)]??""}`)}),Nt(t,[],K,()=>(v(E),v(m).cardKinds),Ee=>Ze(m,v(m).cardKinds=Ee)),T(C,V)});var b=S(Ae,2),P=S(g(b),2);ve(P,5,()=>rn,fe,(C,E)=>{var V=pd(),K=g(V),ce,we=S(K);O(()=>{ce!==(ce=v(E))&&(K.value=(K.__value=v(E))==null?"":v(E)),x(we,` ${fr[v(E)]??""}${Qr[v(E)]??""}`)}),Nt(i,[],K,()=>(v(E),v(m).monsterCategories),Ee=>Ze(m,v(m).monsterCategories=Ee)),T(C,V)});var J=S(b,2),re=S(g(J),2);ve(re,5,()=>nn,fe,(C,E)=>{var V=hd(),K=g(V),ce,we=S(K,2),Ee=S(we);O(()=>{ce!==(ce=v(E))&&(K.value=(K.__value=v(E))==null?"":v(E)),pe(we,`monster_attr ${v(p).attribute??""} svelte-rsq0rf`),x(Ee,` ${Ni[v(E)]??""}`)}),Nt(n,[],K,()=>(v(E),v(m).monsterAttributes),tt=>Ze(m,v(m).monsterAttributes=tt)),T(C,V)});var se=S(J,2),le=S(g(se),2);ve(le,5,()=>an,fe,(C,E)=>{var V=yd(),K=g(V),ce,we=S(K);O(()=>{ce!==(ce=v(E))&&(K.value=(K.__value=v(E))==null?"":v(E)),x(we,` ${hr[v(E)]??""}
                ${Jr[v(E)]??""}`)}),Nt(a,[],K,()=>(v(E),v(m).monsterTypes),Ee=>Ze(m,v(m).monsterTypes=Ee)),T(C,V)});var R=S(se,2),j=S(g(R),2);ve(j,5,()=>sn,fe,(C,E)=>{var V=gd(),K=g(V),ce,we=S(K);O(()=>{ce!==(ce=v(E))&&(K.value=(K.__value=v(E))==null?"":v(E)),x(we,` ${vr[v(E)]??""}`)}),Nt(s,[],K,()=>(v(E),v(m).spellCategories),Ee=>Ze(m,v(m).spellCategories=Ee)),T(C,V)});var q=S(R,2),B=S(g(q),2);ve(B,5,()=>ln,fe,(C,E)=>{var V=md(),K=g(V),ce,we=S(K);O(()=>{ce!==(ce=v(E))&&(K.value=(K.__value=v(E))==null?"":v(E)),x(we,` ${pr[v(E)]??""}`)}),Nt(l,[],K,()=>(v(E),v(m).trapCategories),Ee=>Ze(m,v(m).trapCategories=Ee)),T(C,V)});var $=S(q,2),ee=S(g($),2),X=g(ee),G=g(X),W=S(Y,2);dd(W,{get cardInfo(){return v(p)}});var L=S(A,2),I=g(L);const oe=_e(_);mn(I,{mode:"List",get allCardInfos(){return v(oe)},onAttention:k,get deckCardInfos(){return v(o).cardInfos},set deckCardInfos(C){Ze(o,v(o).cardInfos=C)},$$legacy:!0});var he=S(L,2),Z=g(he);fi(Z,()=>v(y),C=>{var E=wd();T(C,E)},(C,E)=>{var V=Sd(),K=ne(V),ce=g(K),we=S(g(ce),2);O(()=>{v(d),Jn(()=>{v(E)})}),ve(we,5,()=>v(E),fe,(Tt,gr)=>{var mr=_d(),Zi={},pa=g(mr);O(()=>{Zi!==(Zi=v(gr).id)&&(mr.value=(mr.__value=v(gr).id)==null?"":v(gr).id),x(pa,v(gr).name)}),T(Tt,mr)});var Ee=S(ce,2),tt=S(g(Ee),2),Xt=S(Ee,2),Pt=S(g(Xt),2),Ft=g(Pt),at=S(Pt,4),yr=g(at),Ir=S(at,2),ei=g(Ir),va=S(K,2);mn(va,{mode:"Deck",allCardInfos:[],onAttention:k,get deckCardInfos(){return v(o).cardInfos},set deckCardInfos(Tt){Ze(o,v(o).cardInfos=Tt)},$$legacy:!0}),ra(we,()=>v(d),Tt=>ie(d,Tt)),Me("change",we,f),pi(tt,()=>v(o).name,Tt=>Ze(o,v(o).name=Tt)),Me("click",Ft,F),Me("click",yr,N),Me("click",ei,U),T(C,V)}),pi(Se,()=>v(m).name,C=>Ze(m,v(m).name=C)),Ls(G,()=>v(m).isForTest,C=>Ze(m,v(m).isForTest=C)),T(r,M),Ne()}const bd="2025-03-23 10:29:59",Cd={timestamp:bd},Dd=["TblDeckHeader","TblDeckDetail","TblDuelistProfile"],Ed=3;var Ad=D("<option> </option>"),xd=D('<div class="svelte-bc2zvv"><label for="deck_selector" class="deck_selector svelte-bc2zvv">デッキ：</label> <select id="deck_selector" class="deck_selector svelte-bc2zvv"></select></div> <div class="svelte-bc2zvv"><button class="btn svelte-bc2zvv">duel start!</button></div>',1),Md=D('<div class="svelte-bc2zvv">デッキ情報の読み込み、もしくは作成中...</div>'),Pd=D('<div class="svelte-bc2zvv"><label for="duelist_name" class="duelist_name svelte-bc2zvv">名前：</label> <input id="duelist_name" class="duelist_name svelte-bc2zvv" type="text"></div> <!> <div class="svelte-bc2zvv"><button class="btn svelte-bc2zvv">deck edit</button></div>',1),Fd=D('<div class="svelte-bc2zvv">デュエリスト情報の読み込み、もしくは作成中...</div>'),qd=D('<div class="app_body svelte-bc2zvv"><!></div>'),Od=D('<main class="svelte-bc2zvv"><!> <div class="debug_info svelte-bc2zvv"><span> </span> <span class="screen_info"></span></div></main>');function Bd(r,e){Re(e,!1);const t=new Ks("stk_ygo_svelte",Ed,Dd);let i=De(),n=De("None"),a=De(0);const s=yi.getOrCreateNew(t);let l=De(Et.getAllDeckInfo(t).then(M=>(Promise.all(M.filter(z=>!z.lastUsedAt).map(z=>{z.saveDeckInfo()})),ie(a,(M.find(z=>z.lastUsedAt.getTime()===Math.max(...M.map(A=>A.lastUsedAt.getTime())))??M[0]).id),M)));const f=async()=>{let M=(await v(l)).find(z=>z.id===v(a));if(M||(M=(await d()).find(z=>z.id===v(a))),!M)throw new Error("illegal state");return M},u=async()=>{(await s).save()},d=()=>(ie(l,Et.getAllDeckInfo(t).then(M=>(ie(a,(M.find(z=>z.lastUsedAt.getTime()===Math.max(...M.map(A=>A.lastUsedAt.getTime())))??M[0]).id),M))),v(l)),y=async()=>{(await v(l)).length||(await Et.prepareSampleDeck(),d())},h=async()=>{await Promise.all([u(),y()]),(await f()).updateTimestamp(),ie(i,new Vl(await s,"Player",await f(),Xs[0],"NPC",Dr[0]))},o=async()=>{console.log("hoge"),await Promise.all([u(),y()]),ie(n,"DeckEdit")},p=async M=>{await u(),M.key==="Enter"&&!M.repeat&&(await s).save()};y(),Ye();var m=Od(),_=g(m);{var k=M=>{Wc(M,{get duel(){return v(i)}})},w=M=>{var z=Te(),A=ne(z);{var Y=ue=>{kd(ue,{})},Q=ue=>{var Se=qd(),Ae=g(Se);fi(Ae,()=>s,te=>{var b=Fd();T(te,b)},(te,b)=>{var P=Pd(),J=ne(P),re=S(g(J),2),se=S(J,2);fi(se,()=>v(l),j=>{var q=Md();T(j,q)},(j,q)=>{var B=xd(),$=ne(B),ee=S(g($),2);O(()=>{v(a),Jn(()=>{v(q)})}),ve(ee,5,()=>v(q),fe,(W,L)=>{var I=Ad(),oe={},he=g(I);O(()=>{oe!==(oe=v(L).id)&&(I.value=(I.__value=v(L).id)==null?"":v(L).id),x(he,v(L).name)}),T(W,I)});var X=S($,2),G=g(X);ra(ee,()=>v(a),W=>ie(a,W)),Me("click",G,h),T(j,B)});var le=S(se,2),R=g(le);pi(re,()=>v(b).name,j=>v(b).name=j),Me("keypress",re,p),Me("click",R,o),T(te,P)}),T(ue,Se)};H(A,ue=>{v(n)==="DeckEdit"?ue(Y):ue(Q,!1)},!0)}T(M,z)};H(_,M=>{v(i)?M(k):M(w,!1)})}var F=S(_,2),N=g(F),U=g(N);O(()=>x(U,`build at: ${Cd.timestamp}`)),T(r,m),Ne()}bs(Bd,{target:document.getElementById("app")});
