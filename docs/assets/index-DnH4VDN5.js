var Us=Object.defineProperty;var Gs=(a,e,t)=>e in a?Us(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var u=(a,e,t)=>Gs(a,typeof e!="symbol"?e+"":e,t);import{j as js}from"./cardInfo.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();const nr=!1;var Tr=Array.isArray,Vs=Array.prototype.indexOf,br=Array.from,zs=Object.defineProperty,Ei=Object.getOwnPropertyDescriptor,Mn=Object.getOwnPropertyDescriptors,Ws=Object.prototype,Ys=Array.prototype,Er=Object.getPrototypeOf;function Qs(a){return typeof a=="function"}const Xt=()=>{};function Ks(a){return typeof(a==null?void 0:a.then)=="function"}function Xs(a){return a()}function sr(a){for(var e=0;e<a.length;e++)a[e]()}const Dt=2,Pn=4,Fa=8,Oa=16,Yt=32,Ii=64,ya=128,Et=256,ma=512,gt=1024,Qt=2048,Li=4096,Vt=8192,La=16384,Bn=32768,qa=65536,Fn=1<<17,Js=1<<19,On=1<<20,zt=Symbol("$state"),Is=Symbol("legacy props"),el=Symbol("");function Ln(a){return a===this.v}function qn(a,e){return a!=a?e==e:a!==e||a!==null&&typeof a=="object"||typeof a=="function"}function Dr(a){return!qn(a,this.v)}function tl(a){throw new Error("https://svelte.dev/e/effect_in_teardown")}function il(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function al(a){throw new Error("https://svelte.dev/e/effect_orphan")}function rl(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function nl(a){throw new Error("https://svelte.dev/e/props_invalid_value")}function sl(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function ll(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function ol(){throw new Error("https://svelte.dev/e/state_unsafe_local_read")}function cl(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let ea=!1,ul=!1;function dl(){ea=!0}const Ar=1,xr=2,Nn=4,fl=8,vl=16,pl=1,hl=2,gl=4,yl=8,ml=16,_l=1,Sl=2,Cl=4,kl=1,wl=2,st=Symbol();let et=null;function _a(a){et=a}function ct(a,e=!1,t){et={p:et,c:null,e:null,m:!1,s:a,x:null,l:null},ea&&!e&&(et.l={s:null,u:null,r1:[],r2:pt(!1)})}function ut(a){const e=et;if(e!==null){const s=e.e;if(s!==null){var t=Ze,i=Ge;e.e=null;try{for(var r=0;r<s.length;r++){var n=s[r];xt(n.effect),At(n.reaction),Ri(n.fn)}}finally{xt(t),At(i)}}et=e.p,e.m=!0}return{}}function qi(){return!ea||et!==null&&et.l===null}function pt(a,e){var t={f:0,v:a,reactions:null,equals:Ln,rv:0,wv:0};return t}function Tl(a){return Rn(pt(a))}function Yi(a,e=!1){var i;const t=pt(a);return e||(t.equals=Dr),ea&&et!==null&&et.l!==null&&((i=et.l).s??(i.s=[])).push(t),t}function Ae(a,e=!1){return Rn(Yi(a,e))}function Rn(a){return Ge!==null&&!Lt&&Ge.f&Dt&&(Nt===null?Ll([a]):Nt.push(a)),a}function We(a,e){return L(a,$t(()=>f(a))),e}function L(a,e){return Ge!==null&&!Lt&&qi()&&Ge.f&(Dt|Oa)&&(Nt===null||!Nt.includes(a))&&cl(),ti(a,e)}function ti(a,e){return a.equals(e)||(a.v,a.v=e,a.wv=as(),Hn(a,Qt),qi()&&Ze!==null&&Ze.f&gt&&!(Ze.f&(Yt|Ii))&&(Ut===null?ql([a]):Ut.push(a))),e}function Hn(a,e){var t=a.reactions;if(t!==null)for(var i=qi(),r=t.length,n=0;n<r;n++){var s=t[n],l=s.f;l&Qt||!i&&s===Ze||(Zt(s,e),l&(gt|Et)&&(l&Dt?Hn(s,Li):Za(s)))}}let $n=!1;function Jt(a,e=null,t){if(typeof a!="object"||a===null||zt in a)return a;const i=Er(a);if(i!==Ws&&i!==Ys)return a;var r=new Map,n=Tr(a),s=pt(0);n&&r.set("length",pt(a.length));var l;return new Proxy(a,{defineProperty(d,o,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&sl();var v=r.get(o);return v===void 0?(v=pt(c.value),r.set(o,v)):L(v,Jt(c.value,l)),!0},deleteProperty(d,o){var c=r.get(o);if(c===void 0)o in d&&r.set(o,pt(st));else{if(n&&typeof o=="string"){var v=r.get("length"),p=Number(o);Number.isInteger(p)&&p<v.v&&L(v,p)}L(c,st),Wr(s)}return!0},get(d,o,c){var m;if(o===zt)return a;var v=r.get(o),p=o in d;if(v===void 0&&(!p||(m=Ei(d,o))!=null&&m.writable)&&(v=pt(Jt(p?d[o]:st,l)),r.set(o,v)),v!==void 0){var h=f(v);return h===st?void 0:h}return Reflect.get(d,o,c)},getOwnPropertyDescriptor(d,o){var c=Reflect.getOwnPropertyDescriptor(d,o);if(c&&"value"in c){var v=r.get(o);v&&(c.value=f(v))}else if(c===void 0){var p=r.get(o),h=p==null?void 0:p.v;if(p!==void 0&&h!==st)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return c},has(d,o){var h;if(o===zt)return!0;var c=r.get(o),v=c!==void 0&&c.v!==st||Reflect.has(d,o);if(c!==void 0||Ze!==null&&(!v||(h=Ei(d,o))!=null&&h.writable)){c===void 0&&(c=pt(v?Jt(d[o],l):st),r.set(o,c));var p=f(c);if(p===st)return!1}return v},set(d,o,c,v){var E;var p=r.get(o),h=o in d;if(n&&o==="length")for(var m=c;m<p.v;m+=1){var C=r.get(m+"");C!==void 0?L(C,st):m in d&&(C=pt(st),r.set(m+"",C))}p===void 0?(!h||(E=Ei(d,o))!=null&&E.writable)&&(p=pt(void 0),L(p,Jt(c,l)),r.set(o,p)):(h=p.v!==st,L(p,Jt(c,l)));var y=Reflect.getOwnPropertyDescriptor(d,o);if(y!=null&&y.set&&y.set.call(v,c),!h){if(n&&typeof o=="string"){var T=r.get("length"),w=Number(o);Number.isInteger(w)&&w>=T.v&&L(T,w+1)}Wr(s)}return!0},ownKeys(d){f(s);var o=Reflect.ownKeys(d).filter(p=>{var h=r.get(p);return h===void 0||h.v!==st});for(var[c,v]of r)v.v!==st&&!(c in d)&&o.push(c);return o},setPrototypeOf(){ll()}})}function Wr(a,e=1){L(a,a.v+e)}function Yr(a){return a!==null&&typeof a=="object"&&zt in a?a[zt]:a}function Zn(a,e){return Object.is(Yr(a),Yr(e))}var Qr,Un,Gn,jn;function bl(){if(Qr===void 0){Qr=window,Un=/Firefox/.test(navigator.userAgent);var a=Element.prototype,e=Node.prototype;Gn=Ei(e,"firstChild").get,jn=Ei(e,"nextSibling").get,a.__click=void 0,a.__className="",a.__attributes=null,a.__styles=null,a.__e=void 0,Text.prototype.__t=void 0}}function Na(a=""){return document.createTextNode(a)}function Sa(a){return Gn.call(a)}function Ra(a){return jn.call(a)}function g(a,e){return Sa(a)}function I(a,e){{var t=Sa(a);return t instanceof Comment&&t.data===""?Ra(t):t}}function _(a,e=1,t=!1){let i=a;for(;e--;)i=Ra(i);return i}function El(a){a.textContent=""}function Qi(a){var e=Dt|Qt,t=Ge!==null&&Ge.f&Dt?Ge:null;return Ze===null||t!==null&&t.f&Et?e|=Et:Ze.f|=On,{ctx:et,deps:null,effects:null,equals:Ln,f:e,fn:a,reactions:null,rv:0,v:null,wv:0,parent:t??Ze}}function we(a){const e=Qi(a);return e.equals=Dr,e}function Vn(a){var e=a.effects;if(e!==null){a.effects=null;for(var t=0;t<e.length;t+=1)ai(e[t])}}function Dl(a){for(var e=a.parent;e!==null;){if(!(e.f&Dt))return e;e=e.parent}return null}function Al(a){var e,t=Ze;xt(Dl(a));try{Vn(a),e=ns(a)}finally{xt(t)}return e}function zn(a){var e=Al(a),t=(ei||a.f&Et)&&a.deps!==null?Li:gt;Zt(a,t),a.equals(e)||(a.v=e,a.wv=as())}function Wn(a){Ze===null&&Ge===null&&al(),Ge!==null&&Ge.f&Et&&Ze===null&&il(),Pr&&tl()}function xl(a,e){var t=e.last;t===null?e.last=e.first=a:(t.next=a,a.prev=t,e.last=a)}function Ni(a,e,t,i=!0){var r=(a&Ii)!==0,n=Ze,s={ctx:et,deps:null,nodes_start:null,nodes_end:null,f:a|Qt,first:null,fn:e,last:null,next:null,parent:r?null:n,prev:null,teardown:null,transitions:null,wv:0};if(t){var l=Di;try{Xr(!0),Br(s),s.f|=Bn}catch(c){throw ai(s),c}finally{Xr(l)}}else e!==null&&Za(s);var d=t&&s.deps===null&&s.first===null&&s.nodes_start===null&&s.teardown===null&&(s.f&(On|ya))===0;if(!d&&!r&&i&&(n!==null&&xl(s,n),Ge!==null&&Ge.f&Dt)){var o=Ge;(o.effects??(o.effects=[])).push(s)}return s}function Yn(a){const e=Ni(Fa,null,!1);return Zt(e,gt),e.teardown=a,e}function Kr(a){Wn();var e=Ze!==null&&(Ze.f&Yt)!==0&&et!==null&&!et.m;if(e){var t=et;(t.e??(t.e=[])).push({fn:a,effect:Ze,reaction:Ge})}else{var i=Ri(a);return i}}function Ml(a){return Wn(),ta(a)}function Pl(a){const e=Ni(Ii,a,!0);return(t={})=>new Promise(i=>{t.outro?ci(e,()=>{ai(e),i(void 0)}):(ai(e),i(void 0))})}function Ri(a){return Ni(Pn,a,!1)}function ta(a){return Ni(Fa,a,!0)}function A(a,e=[],t=Qi){const i=e.map(t);return Ha(()=>a(...i.map(f)))}function Ha(a,e=0){return Ni(Fa|Oa|e,a,!0)}function di(a,e=!0){return Ni(Fa|Yt,a,!0,e)}function Qn(a){var e=a.teardown;if(e!==null){const t=Pr,i=Ge;Jr(!0),At(null);try{e.call(null)}finally{Jr(t),At(i)}}}function Kn(a,e=!1){var t=a.first;for(a.first=a.last=null;t!==null;){var i=t.next;ai(t,e),t=i}}function Bl(a){for(var e=a.first;e!==null;){var t=e.next;e.f&Yt||ai(e),e=t}}function ai(a,e=!0){var t=!1;if((e||a.f&Js)&&a.nodes_start!==null){for(var i=a.nodes_start,r=a.nodes_end;i!==null;){var n=i===r?null:Ra(i);i.remove(),i=n}t=!0}Kn(a,e&&!t),wa(a,0),Zt(a,La);var s=a.transitions;if(s!==null)for(const d of s)d.stop();Qn(a);var l=a.parent;l!==null&&l.first!==null&&Xn(a),a.next=a.prev=a.teardown=a.ctx=a.deps=a.fn=a.nodes_start=a.nodes_end=null}function Xn(a){var e=a.parent,t=a.prev,i=a.next;t!==null&&(t.next=i),i!==null&&(i.prev=t),e!==null&&(e.first===a&&(e.first=i),e.last===a&&(e.last=t))}function ci(a,e){var t=[];Mr(a,t,!0),Jn(t,()=>{ai(a),e&&e()})}function Jn(a,e){var t=a.length;if(t>0){var i=()=>--t||e();for(var r of a)r.out(i)}else e()}function Mr(a,e,t){if(!(a.f&Vt)){if(a.f^=Vt,a.transitions!==null)for(const s of a.transitions)(s.is_global||t)&&e.push(s);for(var i=a.first;i!==null;){var r=i.next,n=(i.f&qa)!==0||(i.f&Yt)!==0;Mr(i,e,n?t:!1),i=r}}}function Bi(a){In(a,!0)}function In(a,e){if(a.f&Vt){a.f^=Vt,a.f&gt||(a.f^=gt),ia(a)&&(Zt(a,Qt),Za(a));for(var t=a.first;t!==null;){var i=t.next,r=(t.f&qa)!==0||(t.f&Yt)!==0;In(t,r?e:!1),t=i}if(a.transitions!==null)for(const n of a.transitions)(n.is_global||e)&&n.in()}}let Ca=!1,lr=[];function es(){Ca=!1;const a=lr.slice();lr=[],sr(a)}function fi(a){Ca||(Ca=!0,queueMicrotask(es)),lr.push(a)}function Fl(){Ca&&es()}const ts=0,Ol=1;let pa=!1,ha=ts,Ki=!1,Xi=null,Di=!1,Pr=!1;function Xr(a){Di=a}function Jr(a){Pr=a}let oi=[],Ai=0;let Ge=null,Lt=!1;function At(a){Ge=a}let Ze=null;function xt(a){Ze=a}let Nt=null;function Ll(a){Nt=a}let ht=null,wt=0,Ut=null;function ql(a){Ut=a}let is=1,ka=0,ei=!1,It=null;function as(){return++is}function ia(a){var v;var e=a.f;if(e&Qt)return!0;if(e&Li){var t=a.deps,i=(e&Et)!==0;if(t!==null){var r,n,s=(e&ma)!==0,l=i&&Ze!==null&&!ei,d=t.length;if(s||l){var o=a,c=o.parent;for(r=0;r<d;r++)n=t[r],(s||!((v=n==null?void 0:n.reactions)!=null&&v.includes(o)))&&(n.reactions??(n.reactions=[])).push(o);s&&(o.f^=ma),l&&c!==null&&!(c.f&Et)&&(o.f^=Et)}for(r=0;r<d;r++)if(n=t[r],ia(n)&&zn(n),n.wv>a.wv)return!0}(!i||Ze!==null&&!ei)&&Zt(a,gt)}return!1}function Nl(a,e){for(var t=e;t!==null;){if(t.f&ya)try{t.fn(a);return}catch{t.f^=ya}t=t.parent}throw pa=!1,a}function Rl(a){return(a.f&La)===0&&(a.parent===null||(a.parent.f&ya)===0)}function $a(a,e,t,i){if(pa){if(t===null&&(pa=!1),Rl(e))throw a;return}t!==null&&(pa=!0);{Nl(a,e);return}}function rs(a,e,t=!0){var i=a.reactions;if(i!==null)for(var r=0;r<i.length;r++){var n=i[r];n.f&Dt?rs(n,e,!1):e===n&&(t?Zt(n,Qt):n.f&gt&&Zt(n,Li),Za(n))}}function ns(a){var h;var e=ht,t=wt,i=Ut,r=Ge,n=ei,s=Nt,l=et,d=Lt,o=a.f;ht=null,wt=0,Ut=null,Ge=o&(Yt|Ii)?null:a,ei=(o&Et)!==0&&(!Di||r===null||d),Nt=null,_a(a.ctx),Lt=!1,ka++;try{var c=(0,a.fn)(),v=a.deps;if(ht!==null){var p;if(wa(a,wt),v!==null&&wt>0)for(v.length=wt+ht.length,p=0;p<ht.length;p++)v[wt+p]=ht[p];else a.deps=v=ht;if(!ei)for(p=wt;p<v.length;p++)((h=v[p]).reactions??(h.reactions=[])).push(a)}else v!==null&&wt<v.length&&(wa(a,wt),v.length=wt);if(qi()&&Ut!==null&&!Lt&&v!==null&&!(a.f&(Dt|Li|Qt)))for(p=0;p<Ut.length;p++)rs(Ut[p],a);return r!==null&&ka++,c}finally{ht=e,wt=t,Ut=i,Ge=r,ei=n,Nt=s,_a(l),Lt=d}}function Hl(a,e){let t=e.reactions;if(t!==null){var i=Vs.call(t,a);if(i!==-1){var r=t.length-1;r===0?t=e.reactions=null:(t[i]=t[r],t.pop())}}t===null&&e.f&Dt&&(ht===null||!ht.includes(e))&&(Zt(e,Li),e.f&(Et|ma)||(e.f^=ma),Vn(e),wa(e,0))}function wa(a,e){var t=a.deps;if(t!==null)for(var i=e;i<t.length;i++)Hl(a,t[i])}function Br(a){var e=a.f;if(!(e&La)){Zt(a,gt);var t=Ze,i=et;Ze=a;try{e&Oa?Bl(a):Kn(a),Qn(a);var r=ns(a);a.teardown=typeof r=="function"?r:null,a.wv=is;var n=a.deps,s;nr&&ul&&a.f&Qt}catch(l){$a(l,a,t,i||a.ctx)}finally{Ze=t}}}function ss(){if(Ai>1e3){Ai=0;try{rl()}catch(a){if(Xi!==null)$a(a,Xi,null);else throw a}}Ai++}function ls(a){var e=a.length;if(e!==0){ss();var t=Di;Di=!0;try{for(var i=0;i<e;i++){var r=a[i];r.f&gt||(r.f^=gt);var n=Ul(r);$l(n)}}finally{Di=t}}}function $l(a){var e=a.length;if(e!==0)for(var t=0;t<e;t++){var i=a[t];if(!(i.f&(La|Vt)))try{ia(i)&&(Br(i),i.deps===null&&i.first===null&&i.nodes_start===null&&(i.teardown===null?Xn(i):i.fn=null))}catch(r){$a(r,i,null,i.ctx)}}}function Zl(){if(Ki=!1,Ai>1001)return;const a=oi;oi=[],ls(a),Ki||(Ai=0,Xi=null)}function Za(a){ha===ts&&(Ki||(Ki=!0,queueMicrotask(Zl))),Xi=a;for(var e=a;e.parent!==null;){e=e.parent;var t=e.f;if(t&(Ii|Yt)){if(!(t&gt))return;e.f^=gt}}oi.push(e)}function Ul(a){var e=[],t=a.first;e:for(;t!==null;){var i=t.f,r=(i&Yt)!==0,n=r&&(i&gt)!==0,s=t.next;if(!n&&!(i&Vt)){if(i&Pn)e.push(t);else if(r)t.f^=gt;else{var l=Ge;try{Ge=t,ia(t)&&Br(t)}catch(c){$a(c,t,null,t.ctx)}finally{Ge=l}}var d=t.first;if(d!==null){t=d;continue}}if(s===null){let c=t.parent;for(;c!==null;){if(a===c)break e;var o=c.next;if(o!==null){t=o;continue e}c=c.parent}}t=s}return e}function Fr(a){var e=ha,t=oi;try{ss();const r=[];ha=Ol,oi=r,Ki=!1,ls(t);var i=a==null?void 0:a();return Fl(),(oi.length>0||r.length>0)&&Fr(),Ai=0,Xi=null,i}finally{ha=e,oi=t}}async function Gl(){await Promise.resolve(),Fr()}function f(a){var e=a.f,t=(e&Dt)!==0;if(It!==null&&It.add(a),Ge!==null&&!Lt){Nt!==null&&Nt.includes(a)&&ol();var i=Ge.deps;a.rv<ka&&(a.rv=ka,ht===null&&i!==null&&i[wt]===a?wt++:ht===null?ht=[a]:(!ei||!ht.includes(a))&&ht.push(a))}else if(t&&a.deps===null&&a.effects===null){var r=a,n=r.parent;n!==null&&!(n.f&Et)&&(r.f^=Et)}return t&&(r=a,ia(r)&&zn(r)),a.v}function jl(a){var e=It;It=new Set;var t=It,i;try{if($t(a),e!==null)for(i of It)e.add(i)}finally{It=e}return t}function $i(a){var e=jl(()=>$t(a));for(var t of e)if(t.f&Fn)for(const i of t.deps||[])i.f&Dt||ti(i,i.v);else ti(t,t.v)}function $t(a){var e=Lt;try{return Lt=!0,a()}finally{Lt=e}}const Vl=-7169;function Zt(a,e){a.f=a.f&Vl|e}function zl(a){if(!(typeof a!="object"||!a||a instanceof EventTarget)){if(zt in a)or(a);else if(!Array.isArray(a))for(let e in a){const t=a[e];typeof t=="object"&&t&&zt in t&&or(t)}}}function or(a,e=new Set){if(typeof a=="object"&&a!==null&&!(a instanceof EventTarget)&&!e.has(a)){e.add(a),a instanceof Date&&a.getTime();for(let i in a)try{or(a[i],e)}catch{}const t=Er(a);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const i=Mn(t);for(let r in i){const n=i[r].get;if(n)try{n.call(a)}catch{}}}}}const Wl=["touchstart","touchmove"];function Yl(a){return Wl.includes(a)}let Ir=!1;function Ql(){Ir||(Ir=!0,document.addEventListener("reset",a=>{Promise.resolve().then(()=>{var e;if(!a.defaultPrevented)for(const t of a.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function Or(a){var e=Ge,t=Ze;At(null),xt(null);try{return a()}finally{At(e),xt(t)}}function Ua(a,e,t,i=t){a.addEventListener(e,()=>Or(t));const r=a.__on_r;r?a.__on_r=()=>{r(),i(!0)}:a.__on_r=()=>i(!0),Ql()}const os=new Set,cr=new Set;function Kl(a,e,t,i={}){function r(n){if(i.capture||Zi.call(e,n),!n.cancelBubble)return Or(()=>t==null?void 0:t.call(this,n))}return a.startsWith("pointer")||a.startsWith("touch")||a==="wheel"?fi(()=>{e.addEventListener(a,r,i)}):e.addEventListener(a,r,i),r}function De(a,e,t,i,r){var n={capture:i,passive:r},s=Kl(a,e,t,n);(e===document.body||e===window||e===document)&&Yn(()=>{e.removeEventListener(a,s,n)})}function Hi(a){for(var e=0;e<a.length;e++)os.add(a[e]);for(var t of cr)t(a)}function Zi(a){var w;var e=this,t=e.ownerDocument,i=a.type,r=((w=a.composedPath)==null?void 0:w.call(a))||[],n=r[0]||a.target,s=0,l=a.__root;if(l){var d=r.indexOf(l);if(d!==-1&&(e===document||e===window)){a.__root=e;return}var o=r.indexOf(e);if(o===-1)return;d<=o&&(s=d)}if(n=r[s]||a.target,n!==e){zs(a,"currentTarget",{configurable:!0,get(){return n||t}});var c=Ge,v=Ze;At(null),xt(null);try{for(var p,h=[];n!==null;){var m=n.assignedSlot||n.parentNode||n.host||null;try{var C=n["__"+i];if(C!==void 0&&!n.disabled)if(Tr(C)){var[y,...T]=C;y.apply(n,[a,...T])}else C.call(n,a)}catch(E){p?h.push(E):p=E}if(a.cancelBubble||m===e||m===null)break;n=m}if(p){for(let E of h)queueMicrotask(()=>{throw E});throw p}}finally{a.__root=e,delete a.currentTarget,At(c),xt(v)}}}function Xl(a){var e=document.createElement("template");return e.innerHTML=a,e.content}function Ta(a,e){var t=Ze;t.nodes_start===null&&(t.nodes_start=a,t.nodes_end=e)}function k(a,e){var t=(e&kl)!==0,i=(e&wl)!==0,r,n=!a.startsWith("<!>");return()=>{r===void 0&&(r=Xl(n?a:"<!>"+a),t||(r=Sa(r)));var s=i||Un?document.importNode(r,!0):r.cloneNode(!0);if(t){var l=Sa(s),d=s.lastChild;Ta(l,d)}else Ta(s,s);return s}}function ni(a=""){{var e=Na(a+"");return Ta(e,e),e}}function Oe(){var a=document.createDocumentFragment(),e=document.createComment(""),t=Na();return a.append(e,t),Ta(e,t),a}function S(a,e){a!==null&&a.before(e)}let ur=!0;function D(a,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(a.__t??(a.__t=a.nodeValue))&&(a.__t=t,a.nodeValue=t+"")}function Jl(a,e){return Il(a,e)}const Si=new Map;function Il(a,{target:e,anchor:t,props:i={},events:r,context:n,intro:s=!0}){bl();var l=new Set,d=v=>{for(var p=0;p<v.length;p++){var h=v[p];if(!l.has(h)){l.add(h);var m=Yl(h);e.addEventListener(h,Zi,{passive:m});var C=Si.get(h);C===void 0?(document.addEventListener(h,Zi,{passive:m}),Si.set(h,1)):Si.set(h,C+1)}}};d(br(os)),cr.add(d);var o=void 0,c=Pl(()=>{var v=t??e.appendChild(Na());return di(()=>{if(n){ct({});var p=et;p.c=n}r&&(i.$$events=r),ur=s,o=a(v,i)||{},ur=!0,n&&ut()}),()=>{var m;for(var p of l){e.removeEventListener(p,Zi);var h=Si.get(p);--h===0?(document.removeEventListener(p,Zi),Si.delete(p)):Si.set(p,h)}cr.delete(d),v!==t&&((m=v.parentNode)==null||m.removeChild(v))}});return eo.set(o,c),o}let eo=new WeakMap;const Ka=0,ua=1,Xa=2;function Gi(a,e,t,i,r){var n=a,s=qi(),l=et,d=st,o,c,v,p=(s?pt:Yi)(void 0),h=(s?pt:Yi)(void 0),m=!1;function C(T,w){m=!0,w&&(xt(y),At(y),_a(l));try{T===Ka&&t&&(o?Bi(o):o=di(()=>t(n))),T===ua&&i&&(c?Bi(c):c=di(()=>i(n,p))),T!==Ka&&o&&ci(o,()=>o=null),T!==ua&&c&&ci(c,()=>c=null),T!==Xa&&v&&ci(v,()=>v=null)}finally{w&&(_a(null),At(null),xt(null),Fr())}}var y=Ha(()=>{if(d!==(d=e())){if(Ks(d)){var T=d;m=!1,T.then(w=>{T===d&&(ti(p,w),C(ua,!0))},w=>{if(T===d)throw ti(h,w),C(Xa,!0),h.v}),fi(()=>{m||C(Ka,!0)})}else ti(p,d),C(ua,!1);return()=>d=st}})}function N(a,e,t=!1){var i=a,r=null,n=null,s=st,l=t?qa:0,d=!1;const o=(v,p=!0)=>{d=!0,c(p,v)},c=(v,p)=>{s!==(s=v)&&(s?(r?Bi(r):p&&(r=di(()=>p(i))),n&&ci(n,()=>{n=null})):(n?Bi(n):p&&(n=di(()=>p(i))),r&&ci(r,()=>{r=null})))};Ha(()=>{d=!1,e(o),d||c(null,null)},l)}function ne(a,e){return e}function to(a,e,t,i){for(var r=[],n=e.length,s=0;s<n;s++)Mr(e[s].e,r,!0);var l=n>0&&r.length===0&&t!==null;if(l){var d=t.parentNode;El(d),d.append(t),i.clear(),Kt(a,e[0].prev,e[n-1].next)}Jn(r,()=>{for(var o=0;o<n;o++){var c=e[o];l||(i.delete(c.k),Kt(a,c.prev,c.next)),ai(c.e,!l)}})}function se(a,e,t,i,r,n=null){var s=a,l={flags:e,items:new Map,first:null},d=(e&Nn)!==0;if(d){var o=a;s=o.appendChild(Na())}var c=null,v=!1,p=we(()=>{var h=t();return Tr(h)?h:h==null?[]:br(h)});Ha(()=>{var h=f(p),m=h.length;v&&m===0||(v=m===0,io(h,l,s,r,e,i,t),n!==null&&(m===0?c?Bi(c):c=di(()=>n(s)):c!==null&&ci(c,()=>{c=null})),f(p))})}function io(a,e,t,i,r,n,s){var R,P,G,X;var l=(r&fl)!==0,d=(r&(Ar|xr))!==0,o=a.length,c=e.items,v=e.first,p=v,h,m=null,C,y=[],T=[],w,E,B,U;if(l)for(U=0;U<o;U+=1)w=a[U],E=n(w,U),B=c.get(E),B!==void 0&&((R=B.a)==null||R.measure(),(C??(C=new Set)).add(B));for(U=0;U<o;U+=1){if(w=a[U],E=n(w,U),B=c.get(E),B===void 0){var ee=p?p.e.nodes_start:t;m=ro(ee,e,m,m===null?e.first:m.next,w,E,U,i,r,s),c.set(E,m),y=[],T=[],p=m.next;continue}if(d&&ao(B,w,U,r),B.e.f&Vt&&(Bi(B.e),l&&((P=B.a)==null||P.unfix(),(C??(C=new Set)).delete(B))),B!==p){if(h!==void 0&&h.has(B)){if(y.length<T.length){var J=T[0],q;m=J.prev;var ie=y[0],K=y[y.length-1];for(q=0;q<y.length;q+=1)en(y[q],J,t);for(q=0;q<T.length;q+=1)h.delete(T[q]);Kt(e,ie.prev,K.next),Kt(e,m,ie),Kt(e,K,J),p=J,m=K,U-=1,y=[],T=[]}else h.delete(B),en(B,p,t),Kt(e,B.prev,B.next),Kt(e,B,m===null?e.first:m.next),Kt(e,m,B),m=B;continue}for(y=[],T=[];p!==null&&p.k!==E;)p.e.f&Vt||(h??(h=new Set)).add(p),T.push(p),p=p.next;if(p===null)continue;B=p}y.push(B),m=B,p=B.next}if(p!==null||h!==void 0){for(var W=h===void 0?[]:br(h);p!==null;)p.e.f&Vt||W.push(p),p=p.next;var Ne=W.length;if(Ne>0){var Y=r&Nn&&o===0?t:null;if(l){for(U=0;U<Ne;U+=1)(G=W[U].a)==null||G.measure();for(U=0;U<Ne;U+=1)(X=W[U].a)==null||X.fix()}to(e,W,Y,c)}}l&&fi(()=>{var ae;if(C!==void 0)for(B of C)(ae=B.a)==null||ae.apply()}),Ze.first=e.first&&e.first.e,Ze.last=m&&m.e}function ao(a,e,t,i){i&Ar&&ti(a.v,e),i&xr?ti(a.i,t):a.i=t}function ro(a,e,t,i,r,n,s,l,d,o){var c=(d&Ar)!==0,v=(d&vl)===0,p=c?v?Yi(r):pt(r):r,h=d&xr?pt(s):s,m={i:h,v:p,k:n,a:null,e:null,prev:t,next:i};try{return m.e=di(()=>l(a,p,h,o),$n),m.e.prev=t&&t.e,m.e.next=i&&i.e,t===null?e.first=m:(t.next=m,t.e.next=m.e),i!==null&&(i.prev=m,i.e.prev=m.e),m}finally{}}function en(a,e,t){for(var i=a.next?a.next.e.nodes_start:t,r=e?e.e.nodes_start:t,n=a.e.nodes_start;n!==i;){var s=Ra(n);r.before(n),n=s}}function Kt(a,e,t){e===null?a.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function cs(a){var e,t,i="";if(typeof a=="string"||typeof a=="number")i+=a;else if(typeof a=="object")if(Array.isArray(a)){var r=a.length;for(e=0;e<r;e++)a[e]&&(t=cs(a[e]))&&(i&&(i+=" "),i+=t)}else for(t in a)a[t]&&(i&&(i+=" "),i+=t);return i}function no(){for(var a,e,t=0,i="",r=arguments.length;t<r;t++)(a=arguments[t])&&(e=cs(a))&&(i&&(i+=" "),i+=e);return i}function Ci(a){return typeof a=="object"?no(a):a??""}function Wt(a,e,t,i){var r=a.__attributes??(a.__attributes={});r[e]!==(r[e]=t)&&(e==="style"&&"__styles"in a&&(a.__styles={}),e==="loading"&&(a[el]=t),t==null?a.removeAttribute(e):typeof t!="string"&&so(a).includes(e)?a[e]=t:a.setAttribute(e,t))}var tn=new Map;function so(a){var e=tn.get(a.nodeName);if(e)return e;tn.set(a.nodeName,e=[]);for(var t,i=a,r=Element.prototype;r!==i;){t=Mn(i);for(var n in t)t[n].set&&e.push(n);i=Er(i)}return e}function Ee(a,e,t){var i=a.__className,r=lo(e,t);(i!==r||$n)&&(e==null&&!t?a.removeAttribute("class"):a.className=r,a.__className=r)}function lo(a,e){return(a??"")+(e?" "+e:"")}const oo=()=>performance.now(),jt={tick:a=>requestAnimationFrame(a),now:()=>oo(),tasks:new Set};function us(){const a=jt.now();jt.tasks.forEach(e=>{e.c(a)||(jt.tasks.delete(e),e.f())}),jt.tasks.size!==0&&jt.tick(us)}function co(a){let e;return jt.tasks.size===0&&jt.tick(us),{promise:new Promise(t=>{jt.tasks.add(e={c:a,f:t})}),abort(){jt.tasks.delete(e)}}}function da(a,e){Or(()=>{a.dispatchEvent(new CustomEvent(e))})}function uo(a){if(a==="float")return"cssFloat";if(a==="offset")return"cssOffset";if(a.startsWith("--"))return a;const e=a.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function an(a){const e={},t=a.split(";");for(const i of t){const[r,n]=i.split(":");if(!r||n===void 0)break;const s=uo(r.trim());e[s]=n.trim()}return e}const fo=a=>a;function si(a,e,t,i){var r=(a&_l)!==0,n=(a&Sl)!==0,s=r&&n,l=(a&Cl)!==0,d=s?"both":r?"in":"out",o,c=e.inert,v=e.style.overflow,p,h;function m(){var E=Ge,B=Ze;At(null),xt(null);try{return o??(o=t()(e,(i==null?void 0:i())??{},{direction:d}))}finally{At(E),xt(B)}}var C={is_global:l,in(){var E;if(e.inert=c,!r){h==null||h.abort(),(E=h==null?void 0:h.reset)==null||E.call(h);return}n||p==null||p.abort(),da(e,"introstart"),p=dr(e,m(),h,1,()=>{da(e,"introend"),p==null||p.abort(),p=o=void 0,e.style.overflow=v})},out(E){if(!n){E==null||E(),o=void 0;return}e.inert=!0,da(e,"outrostart"),h=dr(e,m(),p,0,()=>{da(e,"outroend"),E==null||E()})},stop:()=>{p==null||p.abort(),h==null||h.abort()}},y=Ze;if((y.transitions??(y.transitions=[])).push(C),r&&ur){var T=l;if(!T){for(var w=y.parent;w&&w.f&qa;)for(;(w=w.parent)&&!(w.f&Oa););T=!w||(w.f&Bn)!==0}T&&Ri(()=>{$t(()=>C.in())})}}function dr(a,e,t,i,r){var n=i===1;if(Qs(e)){var s,l=!1;return fi(()=>{if(!l){var y=e({direction:n?"in":"out"});s=dr(a,y,t,i,r)}}),{abort:()=>{l=!0,s==null||s.abort()},deactivate:()=>s.deactivate(),reset:()=>s.reset(),t:()=>s.t()}}if(t==null||t.deactivate(),!(e!=null&&e.duration))return r(),{abort:Xt,deactivate:Xt,reset:Xt,t:()=>i};const{delay:d=0,css:o,tick:c,easing:v=fo}=e;var p=[];if(n&&t===void 0&&(c&&c(0,1),o)){var h=an(o(0,1));p.push(h,h)}var m=()=>1-i,C=a.animate(p,{duration:d});return C.onfinish=()=>{var y=(t==null?void 0:t.t())??1-i;t==null||t.abort();var T=i-y,w=e.duration*Math.abs(T),E=[];if(w>0){var B=!1;if(o)for(var U=Math.ceil(w/16.666666666666668),ee=0;ee<=U;ee+=1){var J=y+T*v(ee/U),q=an(o(J,1-J));E.push(q),B||(B=q.overflow==="hidden")}B&&(a.style.overflow="hidden"),m=()=>{var ie=C.currentTime;return y+T*v(ie/w)},c&&co(()=>{if(C.playState!=="running")return!1;var ie=m();return c(ie,1-ie),!0})}C=a.animate(E,{duration:w,fill:"forwards"}),C.onfinish=()=>{m=()=>i,c==null||c(i,1-i),r()}},{abort:()=>{C&&(C.cancel(),C.effect=null,C.onfinish=Xt)},deactivate:()=>{r=Xt},reset:()=>{i===0&&(c==null||c(1,0))},t:()=>m()}}function fr(a,e,t=e){var i=qi();Ua(a,"input",r=>{var n=r?a.defaultValue:a.value;if(n=Ia(a)?er(n):n,t(n),i&&n!==(n=e())){var s=a.selectionStart,l=a.selectionEnd;a.value=n??"",l!==null&&(a.selectionStart=s,a.selectionEnd=Math.min(l,a.value.length))}}),$t(e)==null&&a.value&&t(Ia(a)?er(a.value):a.value),ta(()=>{var r=e();Ia(a)&&r===er(a.value)||a.type==="date"&&!r&&!a.value||r!==a.value&&(a.value=r??"")})}const Ja=new Set;function ki(a,e,t,i,r=i){var n=t.getAttribute("type")==="checkbox",s=a;if(e!==null)for(var l of e)s=s[l]??(s[l]=[]);s.push(t),Ua(t,"change",()=>{var d=t.__value;n&&(d=po(s,d,t.checked)),r(d)},()=>r(n?[]:null)),ta(()=>{var d=i();n?(d=d||[],t.checked=d.includes(t.__value)):t.checked=Zn(t.__value,d)}),Yn(()=>{var d=s.indexOf(t);d!==-1&&s.splice(d,1)}),Ja.has(s)||(Ja.add(s),fi(()=>{s.sort((d,o)=>d.compareDocumentPosition(o)===4?-1:1),Ja.delete(s)})),fi(()=>{})}function vo(a,e,t=e){Ua(a,"change",i=>{var r=i?a.defaultChecked:a.checked;t(r)}),$t(e)==null&&t(a.checked),ta(()=>{var i=e();a.checked=!!i})}function po(a,e,t){for(var i=new Set,r=0;r<a.length;r+=1)a[r].checked&&i.add(a[r].__value);return t||i.delete(e),Array.from(i)}function Ia(a){var e=a.type;return e==="number"||e==="range"}function er(a){return a===""?null:+a}function ds(a,e,t){if(a.multiple)return go(a,e);for(var i of a.options){var r=ji(i);if(Zn(r,e)){i.selected=!0;return}}(!t||e!==void 0)&&(a.selectedIndex=-1)}function ho(a,e){Ri(()=>{var t=new MutationObserver(()=>{var i=a.__value;ds(a,i)});return t.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{t.disconnect()}})}function Ui(a,e,t=e){var i=!0;Ua(a,"change",r=>{var n=r?"[selected]":":checked",s;if(a.multiple)s=[].map.call(a.querySelectorAll(n),ji);else{var l=a.querySelector(n)??a.querySelector("option:not([disabled])");s=l&&ji(l)}t(s)}),Ri(()=>{var r=e();if(ds(a,r,i),i&&r===void 0){var n=a.querySelector(":checked");n!==null&&(r=ji(n),t(r))}a.__value=r,i=!1}),ho(a)}function go(a,e){for(var t of a.options)t.selected=~e.indexOf(ji(t))}function ji(a){return"__value"in a?a.__value:a.value}function rn(a,e){return a===e||(a==null?void 0:a[zt])===e}function yo(a={},e,t,i){return Ri(()=>{var r,n;return ta(()=>{r=n,n=[],$t(()=>{a!==t(...n)&&(e(a,...n),r&&rn(t(...r),a)&&e(null,...r))})}),()=>{fi(()=>{n&&rn(t(...n),a)&&e(null,...n)})}}),a}function Ct(a=!1){const e=et,t=e.l.u;if(!t)return;let i=()=>zl(e.s);if(a){let r=0,n={};const s=Qi(()=>{let l=!1;const d=e.s;for(const o in d)d[o]!==n[o]&&(n[o]=d[o],l=!0);return l&&r++,r});i=()=>f(s)}t.b.length&&Ml(()=>{nn(e,i),sr(t.b)}),Kr(()=>{const r=$t(()=>t.m.map(Xs));return()=>{for(const n of r)typeof n=="function"&&n()}}),t.a.length&&Kr(()=>{nn(e,i),sr(t.a)})}function nn(a,e){if(a.l.s)for(const t of a.l.s)f(t);e()}const wi=[];function mo(a,e=Xt){let t=null;const i=new Set;function r(l){if(qn(a,l)&&(a=l,t)){const d=!wi.length;for(const o of i)o[1](),wi.push(o,a);if(d){for(let o=0;o<wi.length;o+=2)wi[o][0](wi[o+1]);wi.length=0}}}function n(l){r(l(a))}function s(l,d=Xt){const o=[l,d];return i.add(o),i.size===1&&(t=e(r,n)||Xt),l(a),()=>{i.delete(o),i.size===0&&t&&(t(),t=null)}}return{set:r,update:n,subscribe:s}}let fa=!1;function _o(a){var e=fa;try{return fa=!1,[a(),fa]}finally{fa=e}}function Le(a,e,t,i){var J;var r=(t&pl)!==0,n=!ea||(t&hl)!==0,s=(t&yl)!==0,l=(t&ml)!==0,d=!1,o;s?[o,d]=_o(()=>a[e]):o=a[e];var c=zt in a||Is in a,v=s&&(((J=Ei(a,e))==null?void 0:J.set)??(c&&e in a&&(q=>a[e]=q)))||void 0,p=i,h=!0,m=!1,C=()=>(m=!0,h&&(h=!1,l?p=$t(i):p=i),p);o===void 0&&i!==void 0&&(v&&n&&nl(),o=C(),v&&v(o));var y;if(n)y=()=>{var q=a[e];return q===void 0?C():(h=!0,m=!1,q)};else{var T=(r?Qi:we)(()=>a[e]);T.f|=Fn,y=()=>{var q=f(T);return q!==void 0&&(p=void 0),q===void 0?p:q}}if(!(t&gl))return y;if(v){var w=a.$$legacy;return function(q,ie){return arguments.length>0?((!n||!ie||w||d)&&v(ie?y():q),q):y()}}var E=!1,B=!1,U=Yi(o),ee=Qi(()=>{var q=y(),ie=f(U);return E?(E=!1,B=!0,ie):(B=!1,U.v=q)});return r||(ee.equals=Dr),function(q,ie){if(It!==null&&(E=B,y(),f(U)),arguments.length>0){const K=ie?f(ee):n&&s?Jt(q):q;return ee.equals(K)||(E=!0,L(U,K),m&&p!==void 0&&(p=K),$t(()=>f(ee))),q}return f(ee)}}const So="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(So);dl();class Co{constructor(e,t,i){u(this,"_dbname");u(this,"_dbversion");u(this,"dbPromise");u(this,"getTran",async(e,t)=>(await this.dbPromise).transaction(e,t));u(this,"reset",async()=>(await indexedDB.databases().then(e=>{console.log(e)}),await new Promise((e,t)=>{const i=indexedDB.deleteDatabase(this._dbname);i.onsuccess=()=>{console.log("onsuccess"),e()},i.onerror=r=>{console.log("onerror"),t(r)}})));u(this,"getAll",async e=>{const t=await this.dbPromise;return new Promise((i,r)=>{const l=t.transaction([e],"readonly").objectStore(e).getAll();l.onsuccess=()=>{i(l.result)},l.onerror=d=>{r(d)}})});u(this,"get",async(e,t)=>{const i=await this.dbPromise;return new Promise((r,n)=>{const d=i.transaction([e],"readonly").objectStore(e).get(t);d.onsuccess=()=>{r(d.result)},d.onerror=o=>{n(o)}})});u(this,"getMany",async(e,t)=>{const n=(await this.dbPromise).transaction([e],"readonly").objectStore(e),s=t.map(l=>new Promise((d,o)=>{const c=n.get(l);c.onsuccess=()=>{d(c.result)},c.onerror=v=>{o(v)}}));return await Promise.all(s)});u(this,"putRecords",async(e,t)=>{const r=(await this.dbPromise).transaction([e],"readwrite"),n=r.objectStore(e),s=t.map(l=>({record:l,request:n.put(l)}));return new Promise((l,d)=>{r.oncomplete=()=>l(s.map(o=>Object.assign({id:o.request.result},o.record))),r.onerror=o=>d(o)})});u(this,"deleteRecords",async(e,t)=>{const r=(await this.dbPromise).transaction([e],"readwrite"),n=r.objectStore(e),s=t.map(l=>({key:l,request:n.delete(l)}));return new Promise((l,d)=>{r.oncomplete=()=>{console.log(s.map(o=>o.request.result)),l()},r.onerror=o=>d(o)})});this._dbname=e,this._dbversion=t,this.dbPromise=new Promise((r,n)=>{const s=indexedDB.open(e,t);s.onsuccess=l=>{if(console.log(l),!l.target){console.log("event.target is undefined"),n("event.target is undefined");return}const d=l.target.result;if(!d){console.log("event.target.result is undefined"),n("event.target.result is undefined");return}d.onversionchange=o=>{console.log(o),d.close()},r(d)},s.onupgradeneeded=l=>{console.log("onupgradeneeded");const d=l.target.result;i.filter(o=>!d.objectStoreNames.contains(o)).map(o=>d.createObjectStore(o,{keyPath:"id",autoIncrement:!0}))},s.onerror=l=>{console.log(l),n(l)},s.onblocked=l=>{console.log(l),n(l)}}),console.log(this.dbPromise)}get dbversion(){return this._dbversion}}class Je{constructor(){u(this,"handlers",[])}append(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}trigger(e){this.handlers.slice(0).filter(t=>t(e)==="RemoveMe").forEach(t=>this.remove(t))}clear(){this.handlers.splice(0)}expose(){return this}}class sn{constructor(){u(this,"handlers",[])}append(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}async trigger(e){(await Promise.all(this.handlers.slice(0).map(async i=>{const r=await i(e);return{h:i,result:r}}))).filter(i=>i.result==="RemoveMe").map(i=>i.h).forEach(i=>this.remove(i))}clear(){this.handlers.splice(0)}expose(){return this}}class ln{constructor(){u(this,"handler")}set(e){this.handler=e}async call(e){if(!this.handler)throw Error("illegal state error");return await this.handler(e)}expose(){return this}}class Lr{constructor(e,t,i,r){u(this,"_name");u(this,"_createVersion");u(this,"mountResolver",()=>{});u(this,"_indexedDb");u(this,"onInsertEvent",new Je);u(this,"onBeforeInsertEvent",new ln);u(this,"onUpdateEvent",new Je);u(this,"onBeforeUpdateEvent",new ln);u(this,"onDeleteEvent",new Je);u(this,"prepareInitialRecords",()=>{const e=new Date;return this._prepareInitialRecords().map(t=>Object.assign(t,{createdAt:e,updatedAt:e,dbVersion:this._createVersion}))});u(this,"resolveMount",()=>this.mountResolver());u(this,"patchForInsert",(e,t)=>{e.newRecords.forEach(i=>{t[i.id]=i})});u(this,"patchForUpdate",(e,t)=>{e.recordPairs.forEach(i=>{t[i.newRecord.id]={...i.newRecord}})});u(this,"patchForDelete",(e,t)=>{e.oldRecords.forEach(i=>{delete t[i.id]})});this._indexedDb=e,this._name=t,this._createVersion=e.dbversion,this.getAll().then(n=>n.reduce((s,l)=>(s[l.id]=l,s),{})).then(n=>{console.log(this.name,n),this.onBeforeInsertEvent.set(i??(()=>Promise.resolve())),this.onBeforeUpdateEvent.set(r??(()=>Promise.resolve()))})}get name(){return this._name}get createVersion(){return this._createVersion}get oninsert(){return this.onInsertEvent.expose()}get onbeforeinsert(){return this.onBeforeInsertEvent.expose()}get onupdate(){return this.onUpdateEvent.expose()}get onbeforeupdate(){return this.onBeforeUpdateEvent.expose()}get ondelete(){return this.onDeleteEvent.expose()}getAll(){return this._indexedDb.getAll(this.name)}get(e){return this._indexedDb.get(this.name,e)}async insertMany(e){const t=new Date,i=e.map(n=>{const s={createdAt:t,updatedAt:t,dbVersion:this._createVersion};return Object.assign(n,s)});await this.onBeforeInsertEvent.call({sender:this,newRecords:i,timestamp:t});const r=await this._indexedDb.putRecords(this.name,i);return this.onInsertEvent.trigger({sender:this,newRecords:r,timestamp:t}),r}async insert(e){return(await this.insertMany([e]))[0]}async updateMany(e,t){const i=new Date,r=[];return(await this._indexedDb.getMany(this.name,e)).forEach(s=>{const l={...s},d={...l};r.push({newRecord:Object.assign(t(d),{updatedAt:i,dbVersion:this._createVersion}),oldRecord:l})}),await this.onBeforeUpdateEvent.call({sender:this,recordPairs:r,timestamp:i}),await this._indexedDb.putRecords(this.name,r.map(s=>s.newRecord)),this.onUpdateEvent.trigger({sender:this,recordPairs:r,timestamp:i}),r.map(s=>s.newRecord)}async update(e,t){return(await this.updateMany([e],t))[0]}async delete(e){const t=new Date,i=await this._indexedDb.getMany(this.name,e);await this._indexedDb.deleteRecords(this.name,e),this.onDeleteEvent.trigger({sender:this,oldRecords:i,timestamp:t})}}const ko=["Deck","ExtraDeck"],wo={Deck:"メインデッキ",ExtraDeck:"エクストラデッキ"},vr=["Monster","Spell","Trap","XyzMaterial"],fs={Monster:"モンスター",Spell:"魔法",Trap:"罠",XyzMaterial:"XYZ素材"},Fi=["Fusion","Syncro","Xyz","Link"],vs=[...Fi,"SpecialSummon","Ritual"],To=["Toon","Spirit","Union","Gemini","FlipEffect"],bo=["Tuner","Effect","Normal","Pendulum","Token","FreeReborn","NormalSummonOnly","RegularSpecialSummonOnly"],on=[...vs,...To,...bo],Ga={Syncro:"シンクロ",Fusion:"融合",Xyz:"エクシーズ",Link:"リンク",Ritual:"儀式",SpecialSummon:"特殊召喚",Toon:"トゥーン",Spirit:"スピリット",Union:"ユニオン",Gemini:"デュアル",FlipEffect:"リバース",Tuner:"チューナー",Effect:"効果",Normal:"通常",Pendulum:"ペンデュラム",Token:"トークン",FreeReborn:"特殊召喚モンスター（蘇生制限なし）",NormalSummonOnly:"特殊召喚不可",RegularSpecialSummonOnly:"正規の方法以外での特殊召喚不可"},aa={Syncro:"🎵",Fusion:"🌀",Xyz:"📰",Link:"⛓️",Ritual:"📜",SpecialSummon:"🔯",Toon:"📖",Spirit:"👻",Union:"🚗",Gemini:"👫",FlipEffect:"🔄",Tuner:"🎶",Effect:"✨",Normal:"🔘",Pendulum:"💠",Token:"🐏",FreeReborn:"🆓",NormalSummonOnly:"🔲",RegularSpecialSummonOnly:"❗"},cn=["Light","Dark","Earth","Water","Fire","Wind","Divine"],qr={Light:"光",Dark:"闇",Earth:"地",Water:"水",Fire:"炎",Wind:"風",Divine:"神"},un=["Aqua","Beast","BeastWarrior","CreatorGod","Cyberse","Dinosaur","DivineBeast","Dragon","Fairy","Fiend","Fish","Insect","Illusion","Machine","Plant","Psychic","Pyro","Reptile","Rock","SeaSerpent","Spellcaster","Thunder","Warrior","WingedBeast","Wyrm","Zombie"],dn=["Normal","Continuous","Field","QuickPlay","Equip","Ritual","PendulumScale"],ra={Normal:"通常",Continuous:"永続",Field:"フィールド",QuickPlay:"速攻",Equip:"装備",Ritual:"儀式",PendulumScale:"ペンデュラム"},fn=["Normal","Continuous","Counter"],na={Normal:"通常",Continuous:"永続",Counter:"カウンター"},Ye=["Attack","Defense"],va={Attack:"攻撃表示",Defense:"守備表示",Set:"裏側守備表示"},ps=["level","rank","attack","defense","pendulumScaleR","pendulumScaleL"],Eo=({wikiName:a,wikiHref:e,wikiTextAll:t,nameKana:i,description:r,pendulumDescription:n,...s})=>s,vn=a=>Eo(a),ja={Aqua:"水",Beast:"獣",BeastWarrior:"獣戦士",CreatorGod:"創造神",Cyberse:"サイバース",Dinosaur:"恐竜",DivineBeast:"幻獣神",Dragon:"ドラゴン",Fairy:"天使",Fiend:"悪魔",Fish:"魚",Insect:"昆虫",Illusion:"幻想魔",Machine:"機械",Plant:"植物",Psychic:"サイキック",Pyro:"炎",Reptile:"爬虫類",Rock:"岩石",SeaSerpent:"海竜",Spellcaster:"魔法使い",Thunder:"雷",Warrior:"戦士",WingedBeast:"鳥獣",Wyrm:"幻竜",Zombie:"アンデット"},sa={Aqua:"🚰",Beast:"🐅",BeastWarrior:"🦁",CreatorGod:"🔆",Cyberse:"💻️",Dinosaur:"🦖",DivineBeast:"💫",Dragon:"🐲",Fairy:"👼",Fiend:"👿",Fish:"🐟️",Insect:"🦋",Illusion:"🤡",Machine:"🤖",Plant:"🌱",Psychic:"👁️",Pyro:"🔥",Reptile:"🦎",Rock:"⛰",SeaSerpent:"🐍",Spellcaster:"🧙",Thunder:"⚡️",Warrior:"⚔️",WingedBeast:"🦅",Wyrm:"🐉",Zombie:"🦴"},Do=["TopLeft","TopCenter","TopRight","MiddleLeft","MiddleRight","BottomLeft","BottomCenter","BottomRight"],hs={TopLeft:{name:"左上",linkArrow:{offsetRow:-1,offsetColumn:-1}},TopCenter:{name:"上",linkArrow:{offsetRow:-1,offsetColumn:0}},TopRight:{name:"右上",linkArrow:{offsetRow:-1,offsetColumn:1}},MiddleLeft:{name:"左",linkArrow:{offsetRow:0,offsetColumn:-1}},MiddleRight:{name:"右",linkArrow:{offsetRow:0,offsetColumn:1}},BottomLeft:{name:"左下",linkArrow:{offsetRow:1,offsetColumn:-1}},BottomCenter:{name:"下",linkArrow:{offsetRow:1,offsetColumn:0}},BottomRight:{name:"右下",linkArrow:{offsetRow:1,offsetColumn:1}}};Do.reduce((a,e)=>(a[hs[e].name]=e,a),{});const Ao=a=>a.cardId??!1?`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=2&cid=${a.cardId}`:`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=1&sess=1&rp=10&mode=&sort=1&keyword=${a.name}&stype=1&ctype=&othercon=2&starfr=&starto=&pscalefr=&pscaleto=&linkmarkerfr=&linkmarkerto=&link_m=2&atkfr=&atkto=&deffr=&defto=&releaseDStart=1&releaseMStart=1&releaseYStart=1999&releaseDEnd=&releaseMEnd=&releaseYEnd=`,Vi=(a,e)=>{const t=a.monsterCategories??[],i=e.monsterCategories??[];for(const r of Fi.toReversed()){if(t.includes(r)&&!i.includes(r))return 1;if(!t.includes(r)&&i.includes(r))return-1}if(a.kind===e.kind){if(a.kind==="Monster"){if((a.link??0)!==(e.link??0))return(a.link??0)-(e.link??0);if((a.rank??0)!==(e.rank??0))return(a.rank??0)-(e.rank??0);if((a.level??0)!==(e.level??0))return(a.level??0)-(e.level??0);if((a.attack??0)!==(e.attack??0))return(a.attack??0)-(e.attack??0);if((a.defense??0)!==(e.defense??0))return(a.defense??0)-(e.defense??0)}return a.name.localeCompare(e.name,"Ja")}for(const r of vr){if(a.kind===r)return-1;if(e.kind===r)return 1}return a.name.localeCompare(e.name,"Ja")},ba=(...a)=>a.length?a.reduce((e,t)=>e>t?e:t):-Number.MAX_VALUE,pr=(...a)=>a.length?a.reduce((e,t)=>e<t?e:t):Number.MAX_VALUE,Ti=(a,e)=>{if((a[0]??Number.MAX_VALUE)>e)return 0;if(a.slice(-1)[0]<e)return a.length;let t=0,i=a.length-1;for(;;){const r=Math.round((t+i)/2);if(r===i||r===t)return a[t]<e?i:t;if(a[r]<e){t=r;continue}i=r}},Pt=[3,5,5,6,6,6,7,8,9,10,11,11,11,12,12,13,13,14,15,15,15,15,15,15,16,16,16,17,18,18,18,21,21,21,22,23,25,25,26,28,28,28,30,30,31,32,32,33,33,34,35,35,36,36,36,37,37,38,38,38,39,41,42,42,43,45,45,45,45,48,48,48,50,51,52,54,54,54,54,56,57,58,59,59,59,59,60,61,63,65,65,65,65,66,67,67,67,69,69,71,71,72,73,73,73,73,73,74,75,75,76,76,77,78,79,80,80,80,80,84,84,84,84,84,84,85,85,85,87,90,91,94,96,96,97,98,101,101,101,101,101];console.log(Pt.length);Pt.forEach((a,e)=>{((Pt[Ti(Pt,e)-1]||-Number.MAX_VALUE)>=e||(Pt[Ti(Pt,e)]||Number.MAX_VALUE)<e)&&console.log(e,Ti(Pt,e),(Pt[Ti(Pt,e)-1]||-Number.MAX_VALUE)<e,(Pt[Ti(Pt,e)]||Number.MAX_VALUE)>=e)});const bt=class bt{constructor(e){u(this,"id");u(this,"name");u(this,"description");u(this,"previousNpcId");u(this,"previousNpcDeckId");u(this,"previousStartMode");u(this,"save",async e=>{console.log(this.previousNpcDeckId,Number.MIN_SAFE_INTEGER);const t=e??{id:this.id,name:this.name,description:this.description,previousNpcId:this.previousNpcId,previousStartMode:this.previousStartMode,previousNpcDeckId:this.previousNpcDeckId>-1?this.previousNpcDeckId:Number.MIN_SAFE_INTEGER};console.log(this.previousNpcDeckId,Number.MIN_SAFE_INTEGER,t);const i=await bt.tblHeader.update(this.id,r=>({...r,...t}));return console.log(this.previousNpcDeckId,Number.MIN_SAFE_INTEGER,t,i),new bt(i)});var t;this.id=e.id,this.name=e.name,this.description=e.description,this.previousNpcId=((t=zi.find(i=>i.id===e.previousNpcId))==null?void 0:t.id)??pr(...zi.map(i=>i.id)),this.previousStartMode=Lc.includes(e.previousStartMode)?e.previousStartMode:"Random",this.previousNpcDeckId=e.previousNpcDeckId}get npcLvl(){return Number.MAX_VALUE}};u(bt,"tblHeader"),u(bt,"getOrCreateNew",async e=>{bt.tblHeader||(bt.tblHeader=new xo(e));const t=await bt.tblHeader.getAll();if(t.length)return console.log(t[0].previousNpcDeckId),new bt(t[0]);const i=await bt.tblHeader.insert({name:"あなた",description:"ここの文字列を何に使うかは未定。",previousNpcId:0,previousNpcDeckId:Number.MIN_SAFE_INTEGER,previousStartMode:"Random"});return new bt(i)});let hr=bt;class xo extends Lr{constructor(t){super(t,"TblDuelistProfile");u(this,"_prepareInitialRecords",()=>[])}}let tr=-1;const zi=[{id:tr--,name:"サンドバッグくん棒立ち",description:"攻撃宣言なし、強制効果以外の効果の発動なし。",npcLvl:0},{id:tr--,name:"サンドバッグくん非暴力",description:"攻撃宣言なし。",npcLvl:100},{id:tr--,name:"サンドバッグくん白帯",description:"とくに制限なし。",npcLvl:200}];Array.prototype.shuffle=function(){return this.map(e=>({item:e,seq:Math.random()})).toSorted((e,t)=>e.seq-t.seq).map(e=>e.item)};Array.prototype.randomPickMany=function(a){return this.shuffle().slice(0,a)};Array.prototype.randomPick=function(){return this.shuffle().slice(0,1)[0]};Array.prototype.reset=function(...a){this.splice(0),this.push(...a)};Array.prototype.union=function(a){return this.filter(e=>a.find(t=>e===t))};Array.prototype.getAllOnOffPattern=function(){const a=[];return this.forEach(e=>{if(a.length==0){a.push([e]),a.push([]);return}a.forEach(t=>a.push([...t,e]))}),a};Array.prototype.getDistinct=function(){return Array.from(new Set(this))};Array.prototype.distinct=function(){this.reset(...this.getDistinct())};const xa=class xa{constructor(e,t,i){u(this,"seq");u(this,"entity");u(this,"_definition");u(this,"validateDuelist",e=>this.entity.controller===e?this.definition.executableDuelistTypes.includes("Controller"):this.definition.executableDuelistTypes.includes("Opponent"));this.seq=e==="AutoSeq"?xa.nextSeq++:e,this.entity=t,this._definition=i}get definition(){return this._definition}get title(){return this.definition.title}get isMandatory(){return this.definition.isMandatory}get executableCells(){return this.definition.executableCells}get executablePeriods(){return this.definition.executablePeriods}get executableDuelistTypes(){return this.definition.executableDuelistTypes}get isOnlyNTimesPerDuel(){return this.definition.isOnlyNTimesPerDuel??0}get isOnlyNTimesPerTurn(){return this.definition.isOnlyNTimesPerTurn??0}get isOnlyNTimesPerTurnIfFaceup(){return this.definition.isOnlyNTimesPerTurnIfFaceup??0}get isOnlyNTimesIfFaceup(){return this.definition.isOnlyNTimesIfFaceup??0}get isOnlyNTimesPerChain(){return this.definition.isOnlyNTimesPerChain??0}get actionGroupName(){return this.definition.actionGroupName}get duel(){return this.entity.duel}};u(xa,"nextSeq",0);let Ea=xa;const He=class He{constructor(){}};u(He,"_tryMarkForDestory",(e,t)=>{if(e.info.isDying||e.status.kind==="XyzMaterial"||!e.isOnFieldStrictly&&e.fieldCell.cellType!=="Deck"&&e.fieldCell.cellType!=="Hand")return!1;const i=t.action.playType==="Battle"?"BattleDestroy":"EffectDestroy",r=i==="BattleDestroy"&&t.action.entity===e?t.selectedEntities[0]:t.action.entity;return e.info.isDying=e.validateDestory(i,t.activator,r,t.action),e.info.isDying&&(e.info.causeOfDeath=[i],e.info.isKilledBy=r,e.info.isKilledByWhom=t.activator,i==="BattleDestroy"&&(e.info.isKilledByWhom=r.controller)),e.info.isDying}),u(He,"releaseManyForTheSameReason",(e,t,i,r)=>e.length?(t.includes("Cost")&&r.writeInfoLog(`${e.map(n=>n.toString()).join(" ")}をリリースし――、`),He.bringManyToSameCellForTheSameReason("Graveyard","Top",e,"FaceUp","Vertical",["Release",...t],i,r)):Promise.resolve()),u(He,"sendManyToGraveyardForTheSameReason",(e,t,i,r)=>e.length?(r&&t.includes("Cost")&&(t.includes("FusionMaterial")?r.writeInfoLog(`${e.map(n=>n.toString()).join(" ")}を融合素材とし――、`):t.includes("SyncroMaterial")?r.writeInfoLog(`${e.map(n=>n.toString()).join(" ")}をシンクロと素材し――、`):t.includes("LinkMaterial")?r.writeInfoLog(`${e.map(n=>n.toString()).join(" ")}をリンクマーカーにセッティング――、`):r.writeInfoLog(`${e.map(n=>n.toString()).join(" ")}を墓地に送り――、`)),He.bringManyToSameCellForTheSameReason("Graveyard","Top",e,"FaceUp","Vertical",t,i,r)):Promise.resolve()),u(He,"addManyToHand",(e,t,i,r)=>e.length?He.bringManyToSameCellForTheSameReason("Hand","Bottom",e,"FaceDown","Vertical",t,i,r):Promise.resolve()),u(He,"discardManyForTheSameReason",(e,t,i,r)=>e.length?(r&&t.includes("Cost")&&r.writeInfoLog(`${e.map(n=>n.toString()).join(" ")}を手札から捨て――、`),He.bringManyToSameCellForTheSameReason("Graveyard","Top",e,"FaceUp","Vertical",["Discard",...t],i,r)):Promise.resolve()),u(He,"banishManyForTheSameReason",(e,t,i,r)=>e.length?(r&&t.includes("Cost")&&r.writeInfoLog(`${e.map(n=>n.toString()).join(" ")}をゲームから除外し――、`),He.bringManyToSameCellForTheSameReason("Banished","Top",e,"FaceUp","Vertical",t,i,r)):Promise.resolve()),u(He,"returnManyToDeckForTheSameReason",(e,t,i,r,n)=>t.length?(n&&i.includes("Cost")&&n.writeInfoLog(`${t.map(s=>s.toString()).join(" ")}をデッキに戻し――、`),He.bringManyToSameCellForTheSameReason("Deck",e,t,"FaceDown","Vertical",i,r,n)):Promise.resolve()),u(He,"returnManyToHandForTheSameReason",(e,t,i,r)=>e.length?(r&&t.includes("Cost")&&r.writeInfoLog(`${e.map(n=>n.toString()).join(" ")}を手札に戻し――、`),He.bringManyToSameCellForTheSameReason("Hand","Bottom",e,"FaceDown","Vertical",t,i,r)):Promise.resolve()),u(He,"convertManyToXyzMaterials",(e,t,i,r)=>e.length?(r&&t.includes("Cost")&&r.writeInfoLog(`${e.map(n=>n.toString()).join(" ")}によって、オーバーレイネットワークを構築――、`),Me.moveMany(e.map(n=>[n,n.fieldCell,"XyzMaterial","FaceUp","Vertical","Top",t,i,r,r]))):Promise.resolve()),u(He,"moveToXyzOwner",(e,t,i,r,n)=>t.length?(i.includes("Effect")&&n.writeInfoLog(`${t.map(s=>s.toString()).join(" ")}をXYZ素材として吸収。`),Me.moveMany(t.map(s=>[s,e,"XyzMaterial","FaceUp","Vertical","Top",i,r,n,n]))):Promise.resolve()),u(He,"banishMany",(e,t)=>Me.bringManyToSameCell("Banished","Top",e.map(i=>({...i,face:"FaceUp",orientation:"Vertical"})),t)),u(He,"bringManyToSameCellForTheSameReason",(e,t,i,r,n,s,l,d)=>Me.bringManyToSameCell(e,t,i.map(o=>({entity:o,face:r,orientation:n,causedAs:s,causedBy:l,activator:d})))),u(He,"tryDestroy",async(e,t)=>{const i=await He.tryMarkForDestory(e,t);return await He.waitCorpseDisposal(t.activator.duel),i}),u(He,"waitCorpseDisposal",e=>Me.sendManyToGraveyard([...e.field.getCardsOnFieldStrictly(),...e.field.getPendingCardsOnField()].filter(t=>t.info.isDying).map(t=>({entity:t,causedAs:t.info.causeOfDeath??[],causedBy:t.info.isKilledBy,activator:t.info.isKilledByWhom})))),u(He,"tryMarkForDestory",async(e,t)=>{let i=e.filter(l=>He._tryMarkForDestory(l,t));if(!i.length)return[];const r=t.action.playType==="Battle"?"BattleDestroy":"EffectDestroy";(await Promise.all(e[0].field.getAllEntities().flatMap(l=>l.substituteEffects.filter(d=>d.isMandatory).filter(d=>d.executableCells.includes(l.fieldCell.cellType)).filter(d=>d.isApplicableTo(r,e,t).length).flatMap(d=>d.substitute(r,e,t))))).flatMap(l=>l).forEach(l=>{l.resetCauseOfDeath()}),i=i.filter(l=>l.info.isDying);let n=e[0].field.getAllEntities().flatMap(l=>l.substituteEffects.filter(d=>!d.isMandatory).filter(d=>d.executableCells.includes(l.fieldCell.cellType)).filter(d=>d.isApplicableTo(r,e,t).length).map(d=>({chooser:l.owner,effect:d,sacrifice:l})));for(const l of n.map(d=>d.sacrifice.controller).getDistinct()){const d=n.filter(c=>c.sacrifice.controller===l),o=await l.duel.view.waitSelectAction(l,d.map(c=>({entity:c.sacrifice,title:c.effect.title,origin:c.effect})),"身代わり効果を適用する？",!0);if(o){if((await o.substitute(r,i,t)).forEach(c=>{c.resetCauseOfDeath()}),i=i.filter(c=>c.info.isDying),!i.length)return[];n=n.filter(c=>c.effect.isApplicableTo(r,e,t).length)}}const s=i.filter(l=>l.info.isDying);return s.forEach(l=>l.duel.log.info(`${l.toString()}を${wc[r]}。`,l.info.isKilledByWhom)),s}),u(He,"tryBanish",async(e,t,i)=>{const r=t.filter(n=>n.canBeBanished(e,i.activator,i.action.entity,i.action));return await He.banishManyForTheSameReason(r,["Effect"],i.action.entity,i.activator),r.filter(n=>n.fieldCell.cellType==="Banished").filter(n=>n.moveLog.latestRecord.movedBy===i.action.entity)}),u(He,"negateSummonMany",(e,t)=>{const i=t.duel.field.getPendingMonstersOnField();return i.forEach(r=>{r.info.summonKinds=[],r.info.materials=[],r.moveLog.negateSummon(e,t)}),t.writeInfoLog(`${i.map(r=>r.toString()).join(" ")}.の召喚は無効にされた。`),i});let ve=He;const Mo=["NormalSummon","SpecialSummon","FlipSummon"],Nr=["IgnitionEffect","TriggerEffect","QuickEffect","CardActivation"],Po=["ChangeBattlePosition","Battle","SpellTrapSet","LingeringEffect"],Bo=a=>a==="CardActivation"?"CardActivation":Nr.some(e=>e===a)?"EffectActivation":"NonActivate",pn=["NormalSummon","AdvanceSummon","SpecialSummon","SpecialSummonFromDeck","SendToGraveyardFromDeck","Draw","SearchFromDeck","BanishFromDeck","BanishFromGraveyard","AddToHandFromGraveyard","ReturnToDeckFromGraveyard","SpecialSummonFromGraveyard","SpecialSummonFromBanished","ReturnToHandFromGraveyard","ReturnToHandFromField","BanishFromField","BanishFromHand","Destroy","DestroyMultiple","DestroyOnField","DestroyMultipleOnField","DestroyOnOpponentField","DestroyMultipleOnOpponentField","DestroyMonsterOnField","DestroyMonstersOnField","DestroySpellTrapOnField","DestroySpellTrapsOnField","SpecialSummonFromHand","SpecialSummonFromExtraDeck","IfNormarlSummonSucceed","IfSpecialSummonSucceed","DamageToOpponent","DamageToSelf","PayLifePoint","DiscordAsCost","DiscordAsEffect","RollDice","BounceToHand","NegateCardEffect","NegateCardActivation","NegateNormalSummon","NegateSpecialSummon"],li=class li extends Ea{constructor(t,i,r,n){super(t,i,r);u(this,"toString",()=>this.isWithChainBlock&&this.playType!=="CardActivation"?`${this.entity.toString()}の«${this.title}»`:`${this.entity.toString()}の${this.title}`);u(this,"addhocMaterialLimitation");u(this,"getClone",t=>new li(this.seq,this.entity,this.definition,t));u(this,"getEnableMaterialPatterns",t=>{var i,r;return((r=(i=this.definition).getEnableMaterialPatterns)==null?void 0:r.call(i,t).filter(this.addhocMaterialLimitation))??[]});u(this,"validateCount",(t,i)=>{const r=i.filter(s=>this.isSameGroup(s.action)).length;if(this.isOnlyNTimesPerDuel>0&&this.entity.field.duel.chainBlockLog.records.filter(s=>!s.chainBlockInfo.isNegatedActivationBy).filter(s=>this.isSameGroup(s.chainBlockInfo.action)).filter(s=>s.chainBlockInfo.activator===t).length+r>=this.isOnlyNTimesPerDuel||this.isOnlyNTimesPerTurn>0&&this.entity.field.duel.chainBlockLog.records.filter(s=>!s.chainBlockInfo.isNegatedActivationBy).filter(s=>this.isSameGroup(s.chainBlockInfo.action)).filter(s=>s.clock.turn===this.entity.field.duel.clock.turn).filter(s=>s.chainBlockInfo.activator===t).length+r>=this.isOnlyNTimesPerTurn||this.isOnlyNTimesPerChain>0&&r>=this.isOnlyNTimesPerChain)return!1;const n=r+this.entity.counterHolder.getActionCount(this);return!(this.isOnlyNTimesPerTurnIfFaceup>0&&n>=this.isOnlyNTimesPerTurnIfFaceup||this.isOnlyNTimesIfFaceup>0&&n>=this.isOnlyNTimesIfFaceup)});u(this,"validate",(t,i,r)=>{if(this.playType==="CardActivation"&&this.entity.isOnFieldStrictly&&this.entity.face==="FaceUp"||this.isWithChainBlock&&!this.entity.status.canActivateEffect||r&&this.needsToPayCost||!this.validateCount(t,i))return;const n=ba(0,...i.map(d=>d.chainNumber??-1)),s={index:i.length,chainNumber:this.isWithChainBlock?n+1:void 0,action:this,activator:t,targetChainBlock:i.slice(-1)[0],isActivatedIn:this.entity.fieldCell,isActivatedAt:this.duel.clock.getClone(),costInfo:{},state:"unloaded",dest:void 0,ignoreCost:!1};if(this.definition.canPayCosts&&!r&&!this.definition.canPayCosts(s,this.playType==="AfterChainBlock"?[]:i))return;const l=this.definition.validate(s,this.playType==="AfterChainBlock"?[]:i);if(l)return{action:this,dests:l,originSeq:this.seq}});u(this,"prepare",async(t,i,r,n,s,l)=>{var m,C;let d=s;this.isLikeContinuousSpell&&(this.entity.info.isPending=!0);const o=this.isWithChainBlock?ba(0,...n.map(y=>y.chainNumber??-1))+1:void 0;let c="";if(o!==void 0&&(c+=`チェーン${o}: `),this.playType==="CardActivation"||this.playType==="SpellTrapSet")if(this.entity.fieldCell.cellType==="Hand"){let y=i?[i]:this.entity.status.spellCategory==="Field"?[t.getFieldZone()]:t.getAvailableSpellTrapZones();if(this.entity.status.spellCategory==="Field"){const w=t.getFieldZone().cardEntities;if(w.length){const E=w[0];await ve.sendManyToGraveyardForTheSameReason(t.getFieldZone().cardEntities,["Rule"],this.entity,t),t.writeInfoLog(`フィールド魔法の上書きにより、${E.toString()}は墓地に送られた。`),d=!1}}(m=this.entity.status.monsterCategories)!=null&&m.includes("Pendulum")&&(y=y.filter(w=>w.isAvailableForPendulum));let T=y[0];if(y.length>1){T=y.randomPick();const w=this.playType==="SpellTrapSet"?"セット":"カードの発動",E=await this.duel.view.waitSelectDestination(t,this.entity,y,"カードを移動先へドラッグ",w,d);if(!E)return;T=E}c+="手札から",this.playType==="SpellTrapSet"?c+="魔法・罠カードをセット。":c+=`${this.entity.toString()}を発動。`,t.writeInfoLog(c),(C=this.entity.status.monsterCategories)!=null&&C.includes("Pendulum")?await this.entity.activateAsPendulumScale(T,["CardActivation"],this.entity,t):this.playType==="CardActivation"?await this.entity.activateSpellTrapFromHand(T,this.entity.status.kind,["CardActivation"],this.entity,t):await this.entity.setAsSpellTrap(T,this.entity.status.kind,["SpellTrapSet"],this.entity,t),d=!1}else this.entity.isOnField&&this.entity.face==="FaceDown"&&(c+=`セットされていた${this.entity.toString()}を発動。`,t.writeInfoLog(c),await this.entity.setNonFieldMonsterPosition(this.entity.origin.kind,"FaceUp",["Rule"]),d=!1);else o!==void 0&&(c+=`${this.toString()}を発動。`,t.writeInfoLog(c));const v={index:n.length,chainNumber:o,action:this,activator:t,targetChainBlock:r,isActivatedIn:this.entity.fieldCell,isActivatedAt:this.duel.clock.getClone(),costInfo:{},state:"ready",dest:i,ignoreCost:!1};if(console.log(this.definition.payCosts,l),this.definition.payCosts&&!l){const y=await this.definition.payCosts(v,n,d);if(!y)return;v.costInfo=y}const p=await this.definition.prepare(v,n,d);if(p===void 0)return;const h={...p};if(Mo.some(y=>y===this.playType)){const y=p.nextChainBlockFilter??(()=>!0);h.nextChainBlockFilter=(T,w)=>w.negateSummon&&y(T,w)}return{...v,...h}});u(this,"execute",async(t,i)=>{if(t.action.isLikeContinuousSpell&&!t.action.entity.isOnField)return this.entity.info.isPending=!1,!1;const r=await this.definition.execute(t,i);return this.entity.determine(),r});u(this,"settle",(t,i)=>(this.isOnlyNTimesPerTurnIfFaceup>0?this.entity.counterHolder.incrementActionCountPerTurn(this):this.isOnlyNTimesIfFaceup>0&&this.entity.counterHolder.incrementActionCount(this),this.definition.settle(t,i)));u(this,"directExecute",async(t,i,r)=>{const n=await this.prepare(t,void 0,i,[],!1,r);if(!n)throw new oe("想定されない状態",this,t,r);const s=await this.execute(n,[]);return await this.settle(n,[]),s});u(this,"isSame",t=>this.entity.origin.name===t.entity.origin.name&&this.title===t.title);u(this,"isSameGroup",t=>this.actionGroupName?this.entity.origin.name===t.entity.origin.name&&this.actionGroupName===t.actionGroupName:this.isSame(t));u(this,"calcChainBlockTagsForDestroy",t=>{if(!pn.length)return[];const i=["Destroy"];pn.length>1&&i.push("DestroyMultiple");const r=t.filter(d=>d.isOnFieldStrictly);r.length&&(i.push("DestroyOnField"),r.length>1&&i.push("DestroyMultipleOnField"));const n=r.filter(d=>d.status.kind==="Monster");n.length&&(i.push("DestroyMonsterOnField"),n.length>1&&i.push("DestroyMonstersOnField")),r.filter(d=>d.status.kind!=="Monster").length&&(i.push("DestroySpellTrapOnField"),n.length>1&&i.push("DestroySpellTrapsOnField"));const l=r.filter(d=>d.controller!==this.entity.controller);return l.length&&(i.push("DestroyOnOpponentField"),l.length>1&&i.push("DestroyMultipleOnOpponentField")),i});this.addhocMaterialLimitation=n??(()=>!0)}get definition(){return super.definition}get playType(){return this.definition.playType}get spellSpeed(){return this.definition.spellSpeed}get needsToPayCost(){return this.definition.needsToPayCost??!1}get hasToTargetCards(){return this.definition.hasToTargetCards??!1}get isWithChainBlock(){return Nr.some(t=>t===this.playType)}get isLikeContinuousSpell(){return this.definition.isLikeContinuousSpell||this.entity.isLikeContinuousSpell&&this.playType==="CardActivation"}get negatePreviousBlock(){return this.definition.negatePreviousBlock??!1}get negateSummon(){return this.definition.negateSummon??!1}get priorityForNPC(){return this.definition.priorityForNPC??Number.NaN}};u(li,"createNew",(t,i)=>new li("AutoSeq",t,i)),u(li,"createDummyAction",(t,i,r,n,s)=>({action:li.createNew(t,{title:i,isMandatory:!1,executableCells:[],executablePeriods:[],executableDuelistTypes:[],playType:"Dammy",spellSpeed:"Dammy",validate:()=>r,prepare:async()=>{},execute:async()=>!1,settle:async()=>!1}),dests:r,battlePosition:n,originSeq:(s==null?void 0:s.seq)??-1}));let xi=li;const Ma=class Ma{constructor(e,t,i,r,n,s=[]){u(this,"duel");u(this,"seat");u(this,"_entity");u(this,"profile");u(this,"deckInfo");u(this,"info");u(this,"infoOrigin");u(this,"status");u(this,"statusOrigin");u(this,"duelistType");u(this,"lifeLog");u(this,"actionBlackListForNPC");u(this,"_lp");u(this,"initHand");u(this,"writeInfoLog",e=>{this.duel.log.info(e,this)});u(this,"initForDrawPhase",()=>{this.info={...this.infoOrigin}});u(this,"canDiscard",e=>(console.log(e),!0));u(this,"canSendToGraveyard",e=>(console.log(e),!0));u(this,"canRelease",e=>(console.log(e),!0));u(this,"canTryBanish",(e,t,i)=>this.entity.procFilterBundle.effectiveOperators.filter(r=>r.procTypes.includes(t)).every(r=>r.filter(this,this.entity,i,[e])));u(this,"battleDamage",(e,t)=>this.setLp(this._lp-e,t,"BattleDamage"));u(this,"effectDamage",(e,t)=>this.setLp(this._lp-e,t,"EffectDamage"));u(this,"lostLp",(e,t)=>this.setLp(this._lp-e,t,"Lost"));u(this,"payLp",(e,t)=>this.setLp(this._lp-e,t,"Pay"));u(this,"heal",(e,t)=>this.setLp(this._lp+e,t,"Heal"));u(this,"setLp",(e,t,i)=>{const r={clock:this.duel.clock.getClone(),reason:i||"Set",beforeLp:this._lp,afterLp:e,entity:t};return this.lifeLog.push(r),this._lp=e,this.writeInfoLog(`ライフポイント変動：${r.afterLp-r.beforeLp}（${r.beforeLp} ⇒ ${r.afterLp}）`),r});u(this,"getOpponentPlayer",()=>this.duel.firstPlayer===this?this.duel.secondPlayer:this.duel.firstPlayer);u(this,"getHandCell",()=>this.duel.field.getCells("Hand").filter(e=>e.owner===this)[0]);u(this,"getDeckCell",()=>this.duel.field.getCells("Deck").filter(e=>e.owner===this)[0]);u(this,"getExtraDeck",()=>this.duel.field.getCells("ExtraDeck").filter(e=>e.owner===this)[0]);u(this,"getGraveyard",()=>this.duel.field.getCells("Graveyard").filter(e=>e.owner===this)[0]);u(this,"getFieldZone",()=>this.duel.field.getCells("FieldSpellZone").filter(e=>e.owner===this)[0]);u(this,"getBanished",()=>this.duel.field.getCells("Banished").filter(e=>e.owner===this)[0]);u(this,"getMonsterZones",()=>this.duel.field.getCells("MonsterZone").filter(e=>e.owner===this));u(this,"getExtraMonsterZones",()=>this.duel.field.getCells("ExtraMonsterZone").filter(e=>{var t;return((t=e.cardEntities[0])==null?void 0:t.controller)===this}));u(this,"getSpellTrapZones",()=>this.duel.field.getCells("SpellAndTrapZone").filter(e=>e.owner===this));u(this,"getXyzMaterialZone",()=>this.duel.field.getCells("XyzMaterialZone").filter(e=>e.owner===this)[0]);u(this,"getEmptyMonsterZones",()=>this.getMonsterZones().filter(e=>e.cardEntities.length===0));u(this,"getEmptyExtraZones",()=>this.getExtraMonsterZones().length===0?this.getMonsterZones().filter(e=>e.cardEntities.length===0):[]);u(this,"getAvailableMonsterZones",()=>this.getMonsterZones().filter(e=>e.isAvailable));u(this,"getAvailableExtraZones",()=>this.getExtraMonsterZones().length===0?this.duel.field.getCells("ExtraMonsterZone").filter(e=>e.isAvailable):[]);u(this,"getAvailableSpellTrapZones",()=>this.getSpellTrapZones().filter(e=>e.isAvailable));u(this,"getReleasableMonsters",()=>this.getMonstersOnField());u(this,"getMonstersOnField",()=>this.duel.field.getMonstersOnFieldStrictly().filter(e=>e.controller===this));u(this,"getSpellTrapsOnField",()=>this.duel.field.getSpellTrapsOnFieldStrictly().filter(e=>e.controller===this));u(this,"getPendingMonstersOnField",()=>this.duel.field.getPendingMonstersOnField().filter(e=>e.controller===this));u(this,"getPendulumScaleMonsters",()=>this.duel.field.getCardsOnFieldStrictly().filter(e=>e.isPendulumScale).filter(e=>e.controller===this));u(this,"getPendulumScales",()=>{const e=this.getPendulumScaleMonsters();if(e.length<2)return;const t=e.find(s=>s.fieldCell.column===(this.seat==="Below"?1:5)),i=e.find(s=>s.fieldCell.column===(this.seat==="Below"?5:1));if(!t||!i)throw new oe("想定されない状態",e);const r=t.psR,n=i.psL;if(r===void 0||n===void 0)throw new oe("想定されない状態",e);return r>n?{upperBound:r,lowerBound:n}:{upperBound:n,lowerBound:r}});u(this,"getEntiteisOnField",()=>this.duel.field.getCardsOnFieldStrictly().filter(e=>e.controller===this));u(this,"pushDeck",()=>{this.deckInfo.cardNames.map(e=>St[e]).filter(e=>e).forEach(e=>Me.createCardEntity(this,e)),this.duel.log.info(`デッキをセット。メイン${this.getDeckCell().cardEntities.length}枚。エクストラ${this.getExtraDeck().cardEntities.length}枚。`,this)});u(this,"draw",async(e,t,i)=>{var s;if(e<1)return;const r=this.getDeckCell(),n=[];this.writeInfoLog(`デッキからカードを${e}枚ドロー。`);for(const l of Array(e)){if(!r.cardEntities.length)throw this.writeInfoLog(n.length>0?`デッキからカードを${e}枚ドローしようとしたが、${n.length}枚しかドローできなかった。${n}`:"デッキからカードをドローできなかった。"),this.duel.isEnded=!0,this.setLp(0),new Ht(this.getOpponentPlayer(),"対戦相手がデッキからカードをドローできなかった。");const d=r.cardEntities[0];await d.draw(t?["Effect"]:["Rule"],t,i),n.push(((s=d.origin)==null?void 0:s.name)||"!名称取得失敗!")}});u(this,"discard",async(e,t,i,r,n,s)=>{const l=n||(()=>!0),d=this.getHandCell().cardEntities.filter(l);if(d.length<e)return[];let o=[];return(r||this).duelistType==="NPC"?o=d.randomPickMany(e):o=await this.duel.view.waitSelectEntities(r||this,{selectables:d,qty:e,validator:c=>c.length===e,cancelable:!1},`${e}枚カードを捨てる。`)||[],this.writeInfoLog(`手札からカードを${o.length}枚捨てた。${o.map(c=>{var v;return(v=c.origin)==null?void 0:v.name})}。`),await ve.discardManyForTheSameReason(o,["Discard",...t],i,s),o});u(this,"getEnableSummonList",(e,t,i,r,n,s,l)=>{const d=this.duel.field.getCells("ExtraMonsterZone"),o=d.filter(v=>!s.map(p=>p.material).includes(v.cardEntities[0])).filter(v=>v.owner===this),c=[];return o.length&&c.push(...d.filter(v=>!o.includes(v)).filter(v=>v.isAvailable)),n.map(v=>({...v,summoner:this})).map(v=>{var p;return(t!=="LinkSummon"||!this.duel.field.canExtraLink(v.monster,s))&&(v.cells=v.cells.filter(h=>!c.includes(h))),(p=v.monster.status.monsterCategories)!=null&&p.includes("Link")&&(v.posList=v.posList.filter(h=>h==="Attack")),v}).map(v=>({...v,cells:v.cells.filter(p=>p.cardEntities.length===0||s.some(h=>h.material===p.cardEntities[0]))})).map(v=>{var p;return v.monster.fieldCell.cellType!=="ExtraDeck"?{...v,cells:v.cells.filter(h=>h.cellType!=="ExtraMonsterZone")}:(p=v.monster.status.monsterCategories)!=null&&p.includes("Link")||t==="PendulumSummon"?{...v,cells:v.cells.filter(h=>h.cellType==="ExtraMonsterZone"||h.linkArrowSources.filter(m=>!s.map(C=>C.material).includes(m)).length)}:v}).filter(v=>v.cells.length&&v.posList.length).map(v=>this.entity.summonFilterBundle.filter(e,t,i,r,v,s,l)).filter(v=>v.cells.length&&v.posList.length).map(v=>v.monster.summonFilterBundle.filter(e,t,i,r,v,s,l)).filter(v=>v.cells.length&&v.posList.length).map(v=>s.map(p=>p.material.summonFilterBundle).reduce((p,h)=>h.filter(e,t,i,r,p,s,l),v)).filter(v=>v.cells.length&&v.posList.length)});u(this,"prepareToSummonMany",async(e,t,i,r,n,s,l,d,o,c,v="特殊召喚するモンスターを選択。")=>{const p=this.getEnableSummonList(e,t,i,r,n,s,l);if(!p.length)return[];let h=p.map(C=>C.monster);(n.length!==1||o([]))&&(h=await this.duel.view.waitSelectEntities(this,{selectables:h,qty:d,validator:o,cancelable:c},v)??[]);const m=[];for(const C of p.filter(y=>h.includes(y.monster))){const y=C.cells.filter(E=>!m.map(B=>B.dest).includes(E));if(!y.length)continue;let T=[...C.posList].randomPick(),w=y.randomPick();if((y.length>1||C.posList.length>1)&&this.duelistType!=="NPC"){const E=await this.duel.view.waitSelectSummonDestination(C.summoner,C.monster,y,C.posList,c);if(!E)return[];w=E.dest,T=E.battlePosition}m.push({summoner:this,monster:C.monster,pos:T,dest:w})}return m});u(this,"summonAll",(e,t,i,r,n,s,l,d,o)=>this.summonMany(e,t,i,r,n,s,l,n.length,c=>c.length===n.length,d,o));u(this,"summonOne",(e,t,i,r,n,s,l,d,o)=>this.summonMany(e,t,i,r,n,s,l,1,c=>c.length===1,d,o));u(this,"summonMany",(e,t,i,r,n,s,l,d,o,c,v)=>Ma.summonMany(e,t,i,r,n.map(p=>({...p,summoner:this})),s,l,d,o,c,v));u(this,"selectAttackTargetForNPC",(e,t)=>{const i=e.atk??0,r=e.getAttackTargets();if(!r.length)return;const n=r.find(s=>s.entityType==="Duelist");return n&&(i>=pr(1600,this.getOpponentPlayer().lp)||e.info.battlePotisionChangeCount>0)?n:r.find(s=>s.battlePosition==="Attack"?i>=(s.atk??0):i<(s.battlePosition==="Set"?1e3:s.def??0)?!1:s.validateDestory("BattleDestroy",this,e,t))});u(this,"selectActionForNPC",(e,t)=>{if(!e.length)return;const i=e.filter(y=>y.action.isMandatory);if(i.length)return i.randomPick();let r=e.filter(y=>!this.actionBlackListForNPC.includes(y.action.playType));const n=r.filter(y=>!Number.isNaN(y.action.priorityForNPC)).shuffle().sort((y,T)=>y.action.priorityForNPC-T.action.priorityForNPC);if(n.length)return n[0];const s=r.filter(y=>y.action.playType==="TriggerEffect");if(s.length)return s.randomPick();if(this.duel.phase!=="main1"&&this.duel.phase!=="main2"){const y=r.filter(T=>T.action.playType==="IgnitionEffect");if(y.length)return y.randomPick()}const l=r.filter(y=>y.action.playType==="Battle").sort((y,T)=>(y.action.entity.atk??0)-(T.action.entity.atk??0));if(l.length)return l.find(y=>this.selectAttackTargetForNPC(y.action.entity,y.action));r=r.filter(y=>y.action.playType!=="Battle");const d=r.length?t.slice(-1)[0]:void 0,o=r.filter(y=>y.action.negatePreviousBlock);if(d&&d.activator!==this&&o)return o.randomPick();if(r=r.filter(y=>!y.action.negatePreviousBlock),!r.length)return;const c=ba(...this.getOpponentPlayer().getMonstersOnField().filter(y=>y.battlePosition==="Attack").map(y=>y.atk??0),1600),v=pr(...this.getOpponentPlayer().getMonstersOnField().map(y=>y.battlePosition==="Set"?1500:(y.battlePosition==="Attack"?y.atk:y.def)??0),1500),p=this.getMonstersOnField(),h=ba(...p.filter(y=>y.battlePosition==="Attack").map(y=>y.atk??0),0);let m=r.filter(y=>y.action.playType!=="ChangeBattlePosition").filter(y=>y.action.entity.battlePosition!=="Attack").filter(y=>(y.action.entity.atk??0)>=c||(y.action.entity.atk??0)>v&&(y.action.entity.atk??0)>2300);if(m.length)return m.randomPick();r=r.filter(y=>y.action.playType!=="ChangeBattlePosition").filter(y=>y.action.playType!=="SpellTrapSet").filter(y=>y.action.entity.actions.filter(T=>T.playType!=="NormalSummon"&&T.playType!=="SpecialSummon").flatMap(T=>T.executableCells).every(T=>T!=="Hand")||y.action.playType!=="NormalSummon"&&y.action.playType!=="SpecialSummon");const C=[...r.filter(y=>y.action.playType==="NormalSummon").filter(y=>(y.action.entity.lvl??12)<5),...r.filter(y=>y.action.playType==="SpecialSummon"),...r.filter(y=>y.action.playType==="NormalSummon").filter(y=>(y.action.entity.atk??0)>2600||(y.action.entity.atk??0)>2300&&(y.action.entity.lvl??12)<7).filter(y=>(y.action.entity.atk??0)>=h),...r.filter(y=>y.action.entity.face==="FaceUp").filter(y=>y.action.entity.isOnFieldStrictly)];if(C.length)return C.randomPick();if(r=r.filter(y=>y.action.playType!=="NormalSummon").filter(y=>y.action.playType!=="SpecialSummon"),this.duel.phase==="main2"){if(m=e.filter(y=>y.action.playType==="ChangeBattlePosition").filter(y=>y.action.entity.battlePosition==="Attack").filter(y=>(y.action.entity.atk??0)<c||(y.action.entity.atk??0)>v&&(y.action.entity.atk??0)>2300),m.length)return m.randomPick();if(this.getAvailableSpellTrapZones.length>1)return e.filter(y=>y.action.playType==="SpellTrapSet").filter(y=>y.action.entity.status.kind!=="Spell"||y.action.entity.status.spellCategory==="QuickPlay").randomPick()}if(Math.random()<r.length/4)return r.randomPick()});this.duel=e,this.seat=t,this.profile=i,this.duelistType=r,this.deckInfo=n,this.initHand=s,this.lifeLog=[],this.infoOrigin={maxRuleNormalSummonCount:1,ruleNormalSummonCount:0,ruleNormalSummonCountQty:0,effectNormalSummonCount:0,effectNormalSummonCountQty:0,specialSummonCount:0,specialSummonCountQty:0},this.info={...this.infoOrigin},this.statusOrigin={maxSpecialSummonCount:Number.MAX_VALUE,canDrawByEffect:!0,canSearchFromDeck:!0,canDiscardAsCost:!0,canDiscardAsEffect:!0},this.status={...this.statusOrigin},this._lp=8e3;const l=[];this.duelistType==="NPC"&&(this.profile.npcLvl<1&&l.push("CardActivation","IgnitionEffect","TriggerEffect","QuickEffect"),this.profile.npcLvl<101&&l.push("Battle")),this.actionBlackListForNPC=l}get entity(){const e=this.getHandCell().entities.find(t=>t.entityType==="Duelist");return e||Me.createPlayerEntity(this)}get lp(){return this._lp}get isTurnPlayer(){return this.duel.getTurnPlayer()===this}get canDraw(){return!0}get canAddToHandFromDeck(){return!0}};u(Ma,"summonMany",async(e,t,i,r,n,s,l,d,o,c,v="特殊召喚するモンスターを選択。")=>{const p=n.map(m=>m.summoner).getDistinct(),h=[];for(const m of p){const C=await m.prepareToSummonMany(e,t,i,r,n.filter(y=>y.summoner===m),s,l,d,o,c,v);h.push(...C)}if(h.length)return h.forEach(m=>m.monster.info.materials.reset(...s)),await ve.moveToXyzOwner(h[0].dest,s.map(m=>m.material).filter(m=>m.status.kind==="XyzMaterial"),["XyzMaterial","Rule"],h[0].monster,e),await Me.summonMany(h,t,i,r.entity,e),h.map(m=>m.monster)});let vi=Ma;const gs=["Deck","ExtraDeck"],ys=["Graveyard","Banished"],ms=[...gs,...ys],Fo=[...ms,"Hand"],yt=["MonsterZone","ExtraMonsterZone"],pi=["SpellAndTrapZone","FieldSpellZone"],ii=[...yt,...pi],_s=["XyzMaterialZone","Disable"],Mi=[...Fo,...ii,..._s],gr={0:{0:"Hand"},1:{0:"Deck",1:"SpellAndTrapZone",2:"SpellAndTrapZone",3:"SpellAndTrapZone",4:"SpellAndTrapZone",5:"SpellAndTrapZone",6:"ExtraDeck"},2:{0:"Graveyard",1:"MonsterZone",2:"MonsterZone",3:"MonsterZone",4:"MonsterZone",5:"MonsterZone",6:"FieldSpellZone"},3:{0:"Banished",1:"XyzMaterialZone",2:"ExtraMonsterZone",3:"Disable",4:"ExtraMonsterZone",5:"XyzMaterialZone",6:"Banished"},4:{0:"FieldSpellZone",1:"MonsterZone",2:"MonsterZone",3:"MonsterZone",4:"MonsterZone",5:"MonsterZone",6:"Graveyard"},5:{0:"ExtraDeck",1:"SpellAndTrapZone",2:"SpellAndTrapZone",3:"SpellAndTrapZone",4:"SpellAndTrapZone",5:"SpellAndTrapZone",6:"Deck"},6:{0:"Hand"}};let Oo=class{constructor(e,t,i,r){u(this,"onUpdateEvent",new Je);u(this,"field");u(this,"row");u(this,"column");u(this,"cellType");u(this,"_owner");u(this,"_requiresRecalcLinkArrows");u(this,"_linkArrowSources");u(this,"_needsShuffle",!1);u(this,"recalcLinkArrows",()=>{this.isMonsterZoneLikeCell&&(this._requiresRecalcLinkArrows=!1,this._linkArrowSources=this.neighbors.filter(e=>e.isMonsterZoneLikeCell).filter(e=>e.cardEntities.length).filter(e=>e.cardEntities[0].linkArrows.some(t=>this.row===e.row+t.offsetRow&&this.column===e.column+t.offsetColumn)).map(e=>e.cardEntities[0]))});u(this,"_entities");u(this,"releaseEntities",e=>{var t;return this._entities=this._entities.filter(i=>i!==e),this.isMonsterZoneLikeCell&&((t=e.origin.monsterCategories)!=null&&t.includes("Link"))&&(this._requiresRecalcLinkArrows=!0),this.onUpdateEvent.trigger(),e});u(this,"acceptEntities",(e,t)=>{var i;t==="Top"?this._entities.unshift(e):this._entities.push(e),t==="Random"&&(this._needsShuffle=!0),this._entities.forEach(r=>{r.fieldCell=this}),this.isMonsterZoneLikeCell&&((i=e.origin.monsterCategories)!=null&&i.includes("Link"))&&(this._requiresRecalcLinkArrows=!0),this.onUpdateEvent.trigger()});u(this,"shuffle",()=>{this._entities=this.entities.shuffle(),this._needsShuffle=!1,this.field.duel.log.info("デッキをシャッフル。",this.owner)});u(this,"toString",()=>this.isMonsterZoneLikeCell||this.cellType==="SpellAndTrapZone"?`${this.cellType}(${this.row},${this.column})`:this.cellType);this.field=e,this.row=t,this.column=i,this.cellType=gr[t][i],this._owner=r,this._entities=[],this._linkArrowSources=[],this._requiresRecalcLinkArrows=!1}get onUpdate(){return this.onUpdateEvent.expose()}get owner(){var e;return this._owner||((e=this.cardEntities[0])==null?void 0:e.owner)}get requiresRecalcLinkArrows(){return this._requiresRecalcLinkArrows}get linkArrowSources(){return this._linkArrowSources}get needsShuffle(){return this._needsShuffle}get entities(){return this._entities}get visibleEntities(){return this._entities.filter(e=>yn.find(t=>t===e.entityType))}get cardEntities(){return this._entities.filter(e=>yn.find(t=>t===e.entityType)).filter(e=>e.status.kind!=="XyzMaterial")}get xyzMaterials(){return this._entities.filter(e=>e.status.kind==="XyzMaterial")}get targetForAttack(){return this.cellType==="Hand"?this._entities.find(e=>e.entityType==="Duelist"):this.cardEntities[0]}get isAvailable(){return this.cardEntities.length===0&&this._entities.filter(e=>Tc.find(t=>t===e.entityType)).length===0}get isAvailableForPendulum(){return this.isAvailable&&this.isSpellTrapZoneLikeCell&&(this.column===1||this.column===5)}get isStackCell(){return ms.some(e=>e===this.cellType)}get isPlayFieldCell(){return ii.some(e=>e===this.cellType)}get isMonsterZoneLikeCell(){return yt.some(e=>e===this.cellType)}get isSpellTrapZoneLikeCell(){return pi.some(e=>e===this.cellType)}get isDisabledCell(){return _s.some(e=>e===this.cellType)}get isTrashCell(){return ys.some(e=>e===this.cellType)}get neighbors(){const e=[this.row-1,this.row,this.row+1].filter(i=>i>=0&&i<=6),t=[this.column-1,this.column,this.column+1].filter(i=>i>=0&&i<=6);return e.flatMap(i=>t.map(r=>this.field.cells[i][r])).filter(i=>i.isMonsterZoneLikeCell).filter(i=>i!==this)}};class Va{constructor(){u(this,"pooledOperators",[]);u(this,"bundles",[]);u(this,"excludesExpired",()=>{this.bundles=this.bundles.filter(e=>!e.entity.hasDisappeared),this.bundles.forEach(e=>e.excludesExpired()),this.pooledOperators=this.pooledOperators.filter(e=>e.validateAlive())});u(this,"append",e=>{this.bundles.push(e)});u(this,"push",e=>{if(!e.isContinuous)throw new oe("staticへの追加は永続以外不可",e);this.excludesExpired(),this.distribute(e),this.pooledOperators.push(e)});u(this,"distributeAll",e=>(this.excludesExpired(),this.pooledOperators.flatMap(this.distribute).getDistinct().forEach(t=>t.operators.sort((i,r)=>i.seq-r.seq)),this.afterDistributeAll(e)));u(this,"distribute",e=>this.bundles.filter(t=>t.operators.every(i=>i.seq!==e.seq)).filter(t=>e.isApplicableTo(t.entity)).filter(t=>t.entity.canBeEffected(e.effectOwner,e.isSpawnedBy,e.actionAttr)).map(t=>(t.push(e),t)));u(this,"removeItem",e=>{this.pooledOperators=this.pooledOperators.filter(t=>t.seq!==e)})}}class za{constructor(e,t){u(this,"pool");u(this,"entity");u(this,"_operators");u(this,"excludesExpired",()=>{this._operators=this._operators.filter(e=>{const t=e.validateAlive()&&e.isApplicableTo(this.entity);return t||(console.info(`before remove ${this.entity.toString} ${e.title}`),e.beforeRemove(this)),t})});u(this,"push",e=>{this.entity.procFilterBundle.effectiveOperators.filter(t=>t.procTypes.includes("Effect")).some(t=>!t.filter(t.effectOwner,t.isSpawnedBy,t.actionAttr,[]))||(this.beforePush(e),this._operators.push(e))});u(this,"removeItem",e=>{this._operators=this._operators.filter(t=>t.seq!==e?!0:(t.beforeRemove(this),!1))});this.pool=e,this.entity=t,this._operators=[],this.pool.append(this)}get operators(){return this._operators}get effectiveOperators(){return this.operators.filter(e=>e.isSpawnedBy.isEffective||!e.isContinuous)}}const Pa=class Pa{constructor(e,t,i,r,n,s){u(this,"seq");u(this,"title");u(this,"validateAlive");u(this,"isContinuous");u(this,"isSpawnedBy");u(this,"isSpawnedAt");u(this,"activateType");u(this,"actionAttr");u(this,"isApplicableTo");u(this,"effectOwner");this.seq=Pa.nextSeq++,this.title=e,this.validateAlive=()=>t(this),this.isContinuous=i,this.isSpawnedBy=r,this.isSpawnedAt=r.duel.clock.getClone(),this.isApplicableTo=l=>s(this,l),this.actionAttr=n,this.activateType=this.actionAttr.playType?Bo(this.actionAttr.playType):"NonActivate",this.effectOwner=this.isSpawnedBy.controller}get isEffective(){return!this.isContinuous||this.activateType==="NonActivate"?!0:this.isSpawnedBy.isEffective}};u(Pa,"nextSeq",0);let Oi=Pa;class Lo extends Va{constructor(){super(...arguments);u(this,"afterDistributeAll",()=>this.bundles.every(t=>t.applyEffectFilter()))}}class qo extends za{constructor(){super(...arguments);u(this,"applyEffectFilter",()=>{const t=this.entity.allStickyEffectOperators.length,i=[];for(;;){const r=this.effectiveOperators.filter(n=>n.procTypes.includes("Effect")).filter(n=>n.isContinuous).find(n=>!i.includes(n.seq));if(!r)break;i.push(r.seq),r.eraseOperators(this.entity)}return this.entity.allStickyEffectOperators.length===t});u(this,"beforePush",t=>t.eraseOperators(this.entity))}}const bi=class bi extends Oi{constructor(t,i,r,n,s,l,d,o){super(t,i,r,n,s,l);u(this,"beforeRemove",()=>{});u(this,"procTypes");u(this,"filter");u(this,"eraseOperators",t=>{if(!this.procTypes.includes("Effect"))return 0;const i=t.allStickyEffectOperators.filter(r=>r.isContinuous).filter(r=>!this.filter(r.effectOwner,r.isSpawnedBy,r.actionAttr,[])).map(r=>r.seq);return i.forEach(t.procFilterBundle.removeItem),i.forEach(t.statusOperatorBundle.removeItem),i.forEach(t.numericOprsBundle.removeItem),i.length});this.procTypes=d,this.filter=o}};u(bi,"createContinuous",(t,i,r,n,s,l,d)=>new bi(t,i,!0,r,n,s,l,d)),u(bi,"createLingering",(t,i,r,n,s,l,d)=>new bi(t,i,!1,r,n,s,l,d));let Da=bi;const hn={level:1,rank:1,attack:0,defense:0,pendulumScaleR:0,pendulumScaleL:0};class No extends Va{constructor(){super(...arguments);u(this,"afterDistributeAll",t=>{if(this.bundles.forEach(r=>r.calcStateAll()),t.field.getMonstersOnFieldStrictly().flatMap(r=>r.numericOprsBundle).flatMap(r=>r.effectiveOperators).some(r=>r.targetStateGen==="calculated")){const n=t.field.getMonstersOnFieldStrictly().filter(s=>(s.atk??0)>=0).map(s=>s.atk??0).reduce((s,l)=>s>l?s:l,0);t.field.getMonstersOnFieldStrictly().forEach(s=>{s.numericOprsBundle.effectiveOperators.filter(l=>l.targetStateGen==="calculated").forEach(l=>{var d;if(!((d=s.status.monsterCategories)!=null&&d.includes("Link")&&l.targetState==="defense")){if(l.stateOperationType==="THE_DEVILS_AVATAR"){s.numericStatus.calculated[l.targetState]=n+100;return}s.numericStatus.calculated[l.targetState]=l.calcValue(s,s.numericStatus.calculated[l.targetState]??0)}})})}return!0})}}class Ro extends za{constructor(){super(...arguments);u(this,"beforePush",t=>{const i=this.effectiveOperators.filter(n=>n.targetState===t.targetState).filter(n=>n.isEffective);if(t.kind==="O-L-F"||t.kind==="O-C-F"?(i.filter(n=>n.kind==="O-L-F").forEach(n=>n.negate()),i.filter(n=>n.kind==="L-F").forEach(n=>n.negate())):t.kind==="L-F"||t.kind==="C-F"?i.filter(n=>n.kind==="L-F"||n.kind==="L-A").forEach(n=>n.negate()):t.kind==="X-C-X"&&i.filter(n=>!n.isContinuous).forEach(n=>n.negate()),i.filter(n=>n.isEffective).some(n=>n.kind==="X-C-X")&&!t.isContinuous)return;if(t.stateOperationType!=="Addition"&&t.targetStateGen==="wip"&&i.filter(n=>!n.isContinuous).forEach(n=>n.negate()),t.stateOperationType==="THE_DEVILS_AVATAR"||t.stateOperationType==="Gradius'_Option"){this.entity.numericStatus.calculated[t.targetState]=-Number.MAX_VALUE;return}const r=this.entity.numericStatus.calculated[t.targetState]??0;if(t.stateOperationType==="THE_DEVILS_DREAD-ROOT"){this.entity.numericStatus.calculated[t.targetState]=t.calcValue(this.entity,r);return}if(t.kind==="L-F"){this.entity.numericStatus.wip[t.targetState]=t.calcValue(this.entity,r);return}});u(this,"calcStateAll",()=>ps.forEach(this.calcState));u(this,"calcState",t=>{if(this.entity.status.kind!=="Monster"&&!this.entity.isPendulumScale){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories){this.entity.numericStatus.calculated[t]=void 0;return}if(this.entity.status.monsterCategories.includes("Link")&&t!=="attack"){this.entity.numericStatus.calculated[t]=void 0;return}if(this.entity.status.monsterCategories.includes("Xyz")&&t==="level"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories.includes("Xyz")&&t==="rank"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories.includes("Pendulum")&&(t==="pendulumScaleL"||t==="pendulumScaleR")){this.entity.numericStatus.calculated[t]=void 0;return}if(t!=="level"&&!this.entity.isOnFieldStrictly){this.entity.numericStatus.origin[t]=this.entity.origin[t],this.entity.numericStatus.wip[t]=this.entity.origin[t],this.entity.numericStatus.calculated[t]=this.entity.origin[t];return}const i=this.entity.origin[t]??0,r=this.entity.numericStatus.wip[t]??0,n=this._operators.filter(c=>c.targetState===t).filter(c=>c.isEffective);if(n.some(c=>c.stateOperationType==="THE_DEVILS_AVATAR"||c.stateOperationType==="Gradius'_Option")&&this.entity.isEffective){this.entity.numericStatus.calculated[t]=-Number.MAX_VALUE;return}const s=n.filter(c=>c.targetState===t).findLast(c=>c.targetStateGen==="origin"),l=s?s.calcValue(this.entity,i??0):i;this.entity.numericStatus.origin[t]=l;let d=l;const o=n.filter(c=>c.targetState===t).filter(c=>c.targetStateGen==="wip").findLast(c=>c.stateOperationType==="Fixation");if(!o)d=n.filter(c=>c.stateOperationType==="Addition").reduce((c,v)=>v.calcValue(this.entity,c),d),this.entity.numericStatus.wip[t]=d;else if(o.isContinuous)d=o.calcValue(this.entity,d),d=n.filter(c=>c.stateOperationType==="Addition").reduce((c,v)=>v.calcValue(this.entity,c),d),this.entity.numericStatus.wip[t]=d;else{let c=!1;d=n.filter(v=>(c=c||v===o,c&&v!==o)).filter(v=>v.stateOperationType==="Addition").reduce((v,p)=>p.calcValue(this.entity,v),r)}d<hn[t]&&(d=hn[t]),this.entity.numericStatus.calculated[t]=d})}}const Ft=class Ft extends Oi{constructor(t,i,r,n,s,l,d,o,c,v){super(t,i,r,n,s,l);u(this,"beforeRemove",()=>{});u(this,"targetState");u(this,"targetStateGen");u(this,"stateOperationType");u(this,"calcValue");u(this,"_isEffective");u(this,"negate",()=>{this._isEffective=!1});this._isEffective=!0,this.targetState=d,this.targetStateGen=o,this.stateOperationType=c,this.calcValue=(p,h)=>v(this.isSpawnedBy,p,h)}get isEffective(){return this._isEffective&&super.isEffective}get kind(){if(this.targetStateGen==="origin"){if(this.stateOperationType==="Fixation")return this.isContinuous?"O-C-F":"O-L-F";throw new oe("矛盾したプロパティ",this)}if(this.targetStateGen==="wip"){if(this.stateOperationType==="Addition")return this.isContinuous?"C-A":"L-A";if(this.stateOperationType==="Fixation")return this.isContinuous?"C-F":"L-F";throw new oe("矛盾したプロパティ",this)}if(this.stateOperationType==="THE_DEVILS_DREAD-ROOT")return"X-C-F";if(this.stateOperationType==="THE_DEVILS_AVATAR"||this.stateOperationType==="Gradius'_Option")return"X-C-X";throw new oe("矛盾したプロパティ",this)}};u(Ft,"createContinuous",(t,i,r,n,s,l,d,o)=>new Ft(t,i,!0,r,{},n,s,l,d,o)),u(Ft,"createLingering",(t,i,r,n,s,l,d)=>new Ft(t,i,!1,r,n,(o,c)=>c.isOnFieldAsMonsterStrictly,s,"wip",l,d)),u(Ft,"createLingeringFixation",(t,i,r,n,s,l)=>Ft.createLingering(t,i,r,n,s,"Fixation",l)),u(Ft,"createLingeringAddition",(t,i,r,n,s,l)=>Ft.createLingering(t,i,r,n,s,"Addition",l));let mt=Ft;const Ss=a=>Object.keys(a),Ho={draw:"ドローフェイズ",standby:"スタンバイフェイズ",main1:"メインフェイズ１",battle1:"バトルフェイズ",battle2:"バトルフェイズ（追加）",main2:"メインフェイズ２",end:"エンドフェイズ"},$o={start:"スタートステップ",battle:"バトルステップ",damage:"ダメージステップ",end:"エンドステップ"},Zo={start:"ダメージステップ開始時",beforeDmgCalc:"ダメージ計算前",dmgCalc:"ダメージ計算時",afterDmgCalc:"ダメージ計算後",end:"ダメージステップ終了時"},qe=["draw","stanby","main1","b1Start","b1Battle","b1End","b2Start","b2Battle","b2End","main2","end"],Ie=["b1DStart","b1DBeforeDmgCalc","b1DAfterDmgCalc","b1DEnd","b2DStart","b2DBeforeDmgCalc","b2DAfterDmgCalc","b2DEnd"],Uo=["b1DDmgCalc","b2DDmgCalc"],Rt=[...qe,...Ie,...Uo],gn={draw:{phase:"draw",step:void 0,stage:void 0},stanby:{phase:"standby",step:void 0,stage:void 0},main1:{phase:"main1",step:void 0,stage:void 0},b1Start:{phase:"battle1",step:"start",stage:void 0},b1Battle:{phase:"battle1",step:"battle",stage:void 0},b1DStart:{phase:"battle1",step:"battle",stage:"start"},b1DBeforeDmgCalc:{phase:"battle1",step:"battle",stage:"beforeDmgCalc"},b1DDmgCalc:{phase:"battle1",step:"battle",stage:"dmgCalc"},b1DAfterDmgCalc:{phase:"battle1",step:"battle",stage:"afterDmgCalc"},b1DEnd:{phase:"battle1",step:"battle",stage:"end"},b1End:{phase:"battle1",step:"end",stage:void 0},b2Start:{phase:"battle2",step:"start",stage:void 0},b2Battle:{phase:"battle2",step:"battle",stage:void 0},b2DStart:{phase:"battle2",step:"battle",stage:"start"},b2DBeforeDmgCalc:{phase:"battle2",step:"battle",stage:"beforeDmgCalc"},b2DDmgCalc:{phase:"battle2",step:"battle",stage:"dmgCalc"},b2DAfterDmgCalc:{phase:"battle2",step:"battle",stage:"afterDmgCalc"},b2DEnd:{phase:"battle2",step:"battle",stage:"end"},b2End:{phase:"battle2",step:"end",stage:void 0},main2:{phase:"main2",step:void 0,stage:void 0},end:{phase:"end",step:void 0,stage:void 0}},Go=a=>a.stage?Zo[a.stage]:a.step?$o[a.step]:Ho[a.phase],ri=Ss(gn).reduce((a,e)=>(a[e].key=e,a[e].name=Go(a[e]),a),gn),Ba=class Ba{constructor(e,t){u(this,"entity");u(this,"isRegular");u(this,"_isStarted");u(this,"info");u(this,"continuousEffectBase");u(this,"updateState",async()=>{if(this.hasToStart!==this.isStarted){if(this.isStarted){if(!this.info)throw new oe("illegal state");this._isStarted=!1,await this.continuousEffectBase.finish(this.entity,this.info),this.info=void 0;return}this.info=await this.continuousEffectBase.start(this.entity),this._isStarted=!0}});this._isStarted=!1,this.entity=e,this.continuousEffectBase=t,this.isRegular=this.appliableCellTypes.every(i=>ii.find(r=>r===i))&&this.faceList.length===1&&this.faceList[0]==="FaceUp"}get isStarted(){return this._isStarted}get appliableCellTypes(){return this.continuousEffectBase.appliableCellTypes}get appliableDuelPeriodKeys(){return this.continuousEffectBase.appliableDuelPeriodKeys}get faceList(){return this.continuousEffectBase.faceList}get hasToStart(){return!this.appliableCellTypes.includes(this.entity.fieldCell.cellType)||!this.appliableDuelPeriodKeys.includes(this.entity.duel.clock.period.key)||!this.faceList.includes(this.entity.face)?!1:this.continuousEffectBase.canStart(this.entity)}};u(Ba,"createNew",(e,t)=>new Ba(e,t));let yr=Ba;const jo=(a,e,t,i,r)=>({title:a,appliableCellTypes:e==="Monster"?["MonsterZone","ExtraMonsterZone"]:["FieldSpellZone","SpellAndTrapZone"],appliableDuelPeriodKeys:Rt,faceList:["FaceUp"],canStart:n=>!n.info.isPending&&!n.info.isDying&&t(n),start:async n=>{const s=i(n);return s.forEach(r(n).push),s.map(l=>l.seq)},finish:async(n,s)=>{s.forEach(l=>r(n).removeItem(l))}}),Rr=(a,e,t,i,r,n)=>({title:a,appliableCellTypes:e==="Monster"?["MonsterZone","ExtraMonsterZone"]:["FieldSpellZone","SpellAndTrapZone"],appliableDuelPeriodKeys:Rt,faceList:["FaceUp"],canStart:s=>!s.info.isPending&&!s.info.isDying&&i(s),start:async s=>{const l=r(s),d=t(s);return console.info(`start : ${s.toString()} ⇒ ${d.map(o=>o.toString()).join(" ")} (${l.map(o=>o.title).join(" ")})`),d.map(n).forEach(o=>l.forEach(o.push)),{targets:d,seqList:l.map(o=>o.seq)}},finish:async(s,l)=>{l.targets.map(n).forEach(d=>l.seqList.forEach(o=>d.removeItem(o)))}}),Vo=(a,e,t,i,r)=>Rr(a,e,t,i,r,n=>n.procFilterBundle),Aa=(a,e,t,i)=>jo(a,e,t,i,r=>r.field.numericStateOperatorPool),la=(a,e,t,i,r)=>Rr(a,e,t,i,r,n=>n.numericOprsBundle),Cs=(a,e,t,i,r)=>Rr(a,e,t,i,r,n=>n.statusOperatorBundle);class zo extends Va{constructor(){super(...arguments);u(this,"afterDistributeAll",t=>t.field.getAllEntities().map(i=>i.statusOperatorBundle).every(i=>i.calcStatus()))}}class Wo extends za{constructor(){super(...arguments);u(this,"calcStatus",()=>{const t=this.entity.isEffective;return this.entity.resetStatus(),this.entity.status=this._operators.filter(i=>i.isSpawnedBy.isEffective||!i.isContinuous).reduce((i,r)=>({...i,...r.statusCalculator(r,i)}),this.entity.status),this.entity.isEffective===t});u(this,"beforePush",()=>{})}}class oa extends Oi{constructor(t,i,r,n,s,l,d){super(t,i,r,n,s,l);u(this,"beforeRemove",()=>{});u(this,"statusCalculator");this.statusCalculator=d}}class Yo extends Va{constructor(){super(...arguments);u(this,"afterDistributeAll",()=>!0)}}class Qo extends za{constructor(){super(...arguments);u(this,"beforePush",()=>{});u(this,"filter",(t,i,r,n,s,l,d)=>this.effectiveOperators.filter(o=>o.summonKinds.includes(i)).reduce((o,c)=>({...o,...c.filter(this.entity,t,s.summoner,[i,...r],n,s.monster,l,o.posList,o.cells,d)}),s))}}class Ko extends Oi{constructor(t,i,r,n,s,l,d,o){super(t,i,r,n,s,l);u(this,"beforeRemove",()=>{});u(this,"summonKinds");u(this,"filter");this.summonKinds=d,this.filter=(...c)=>o(this,...c)}}class Xo{constructor(e){u(this,"cells");u(this,"duel");u(this,"summonFilterPool");u(this,"procFilterPool");u(this,"numericStateOperatorPool");u(this,"statusOperatorPool");u(this,"moveLog");u(this,"getAllCells",()=>this.cells.flat());u(this,"getCells",(...e)=>this.getAllCells().filter(t=>e.includes(t.cellType)));u(this,"getAvailableExtraMonsterZones",()=>this.getCells("ExtraMonsterZone").filter(e=>e.isAvailable));u(this,"getAllEntities",()=>this.getAllCells().map(e=>e.entities).flat());u(this,"getAllCardEntities",()=>this.getAllCells().map(e=>e.cardEntities).flat());u(this,"getCardsOnFieldStrictly",()=>this.getCells(...ii).map(e=>e.cardEntities).filter(e=>e.length>0).map(e=>e[0]).filter(e=>e.isOnFieldStrictly));u(this,"getMonstersOnFieldStrictly",()=>this.getCardsOnFieldStrictly().filter(e=>e.isOnFieldAsMonsterStrictly));u(this,"getSpellTrapsOnFieldStrictly",()=>this.getCardsOnFieldStrictly().filter(e=>e.isOnFieldAsSpellTrapStrictly));u(this,"getPendulumScalesOnFieldStrictly",()=>this.getCardsOnFieldStrictly().filter(e=>{var t;return(t=e.origin.monsterCategories)==null?void 0:t.includes("Pendulum")}).filter(e=>e.isOnFieldAsSpellTrapStrictly).filter(e=>!e.status.spellCategory));u(this,"getPendingCardsOnField",()=>this.getCells(...ii).map(e=>e.cardEntities).filter(e=>e.length>0).map(e=>e[0]).filter(e=>e.info.isPending));u(this,"getPendingMonstersOnField",()=>this.getPendingCardsOnField().filter(e=>e.status.kind==="Monster"));u(this,"getEntities",e=>this.getAllEntities().filter(t=>t.controller===e));u(this,"recalcLinkArrows",()=>{const e=this.getAllCells().filter(t=>t.isMonsterZoneLikeCell);e.some(t=>t.recalcLinkArrows)&&e.forEach(t=>t.recalcLinkArrows())});u(this,"canExtraLink",(e,t)=>{if(!e.linkArrows.length)return!1;const i=t.map(o=>o.material),r=this.getCells("ExtraMonsterZone").filter(o=>o.isAvailable||i.includes(o.cardEntities[0]));if(r.length!==1)return!1;const n=r[0],s=e.linkArrows.map(o=>this.cells[n.row+o.offsetRow][n.column+o.offsetColumn]);let l=n.linkArrowSources.filter(o=>!i.includes(o)).filter(o=>s.includes(o.fieldCell));if(!l.length)return!1;let d=-1;for(;d!==l.length;){const o=l.flatMap(c=>c.coLinkedEntities).filter(c=>!i.includes(c));if(o.some(c=>c.fieldCell.cellType==="ExtraMonsterZone"))return!0;l=[...l,...o].getDistinct(),d=l.length}return!1});u(this,"drawAtSameTime",async(e,t,i,r,n,s)=>{const l=[],d=[],o=[e.draw(t,n,s),i.draw(r,n,s)].map(c=>c.catch(v=>{v instanceof Ht?v.winner&&l.push(v.winner):d.push(v)}));if(await Promise.all(o),d.length)throw new oe("ドロー処理で想定されない例外が発生した。",e,t,i,r,n,...d);if(l.length!==0)throw l.length===1?new Ht(l[0],"対戦相手がデッキからドローできなかった。"):new Ht(void 0,"お互いにデッキからカードをドローできなかった。")});u(this,"sendToGraveyard",async(e,t,i,r,n,s,l,d)=>{if(r>0&&i.length<r)return;const o=await this.duel.view.waitSelectEntities(t,{selectables:i,qty:r,validator:n,cancelable:d??!1},e);if(o)return await Me.sendManyToGraveyard(o.map(c=>({entity:c,causedAs:s,causedBy:l,activator:t}))),this.duel.log.info(`${o.map(c=>c.status.name).join(", ")}を墓地に送った（${s.getDistinct().join(", ")}）。`,t),o});this.duel=e,this.cells=[...Array(7)].map(()=>[]);for(const t of Object.keys(gr).map(Number))for(const i of Object.keys(gr[t]).map(Number))this.cells[t][i]=new Oo(this,t,i,t<3?e.duelists.Above:t>3?e.duelists.Below:i<2?e.duelists.Above:i>4?e.duelists.Below:void 0);this.summonFilterPool=new Yo,this.procFilterPool=new Lo,this.numericStateOperatorPool=new No,this.statusOperatorPool=new zo,this.moveLog=new Jo(this)}}class Jo{constructor(e){u(this,"_field");u(this,"_records",[]);u(this,"getIndexOfStartPoint",e=>Ti(this._records.map(t=>t.movedAt.totalProcSeq),e));u(this,"push",e=>{this._records.push(e)});u(this,"getCurrentTurnLog",()=>this.getTermLog("Current","turn"));u(this,"getPriviousChainLog",()=>this.getTermLog("Previous","chainSeq"));this._field=e}*getTermLog(e,t){const i=e==="Current"?this._field.duel.clock.currentStartPoints[t]:this._field.duel.clock.previousStartPoints[t];for(let r=this.getIndexOfStartPoint(i);r<this._records.length;r++)yield this._records[r]}}class Io{constructor(e){u(this,"entity");u(this,"_records");u(this,"_push",e=>{this.entity.field.moveLog.push(e),this._records.push(e)});u(this,"pushForRuleAction",e=>{this._push({entity:this.entity,kind:this.entity.origin.kind,cell:this.entity.fieldCell,face:this.entity.face,orientation:this.entity.orientation,isPending:this.entity.info.isPending,movedAt:this.entity.duel.clock.getClone(),movedAs:[...e,"Rule"]})});u(this,"push",(e,t,i,r,n)=>{let s=this.entity.fieldCell;this.entity.status.kind==="XyzMaterial"&&(s=this.entity.controller.getXyzMaterialZone()),this._push({entity:this.entity,kind:e,cell:s,face:this.entity.face,orientation:this.entity.orientation,isPending:this.entity.info.isPending,movedAt:this.entity.duel.clock.getClone(),movedAs:t.getDistinct(),movedBy:i,actionOwner:r,chooser:n??r})});u(this,"finalize",()=>{if(!this.latestRecord.isPending)throw new oe("想定されない状況");if(this.entity.info.isPending)throw new oe("想定されない状況");this._push({...this.latestRecord,isPending:!1,movedAt:this.entity.duel.clock.getClone()})});u(this,"negateSummon",(e,t)=>{const i=this.records.slice(-1)[0];i.cell=this.entity.field.getCells("Disable")[0],i.movedBy=e,i.movedAs=["SummonNegated"],i.actionOwner=t});this.entity=e,this._records=[]}get records(){return this._records}get latestRecord(){return this.records.slice(-1)[0]}get previousPlaceRecord(){return this.records.findLast(e=>e.cell.cellType!==this.entity.fieldCell.cellType)??this._records[0]}get currentProcRecords(){return this.records.filter(e=>e.movedAt.totalProcSeq===this.entity.duel.clock.totalProcSeq)}}const mr=["SpellCounter","KaijuCounter","NamelessCounter","IceCounter"],_r=["CycleFlip","SonicBarrier","SonicVerse"],ec=["GoldSarcophagus"],tc=[...mr,..._r,...ec],ic={SpellCounter:"🔮",KaijuCounter:"☢",NamelessCounter:"💠",IceCounter:"❄"};class ac{constructor(e){u(this,"dic");u(this,"temporaryCounterNames");u(this,"entity");u(this,"add",(e,t=1,i)=>{this.dic[e]=[...this.dic[e]??[],...Array(t).fill(i)];const r=this.entity.status.maxCounterQty[e]??0;return r&&(this.dic[e]=this.dic[e].slice(0,r)),this.dic[e]});u(this,"setQty",(e,t=1,i)=>(this.dic[e]=[...Array(t).fill(i)],this.dic[e]));u(this,"remove",(e,t=1,i)=>{const r=this.dic[e].length;if(r===void 0)return[];if(t>=r)return delete this.dic[e],[];if(i){const n=this.dic[e].filter(l=>l===i),s=this.dic[e].filter(l=>l!==i);this.dic[e]=[...n.slice(t),...s]}else this.dic[e]=this.dic[e].slice(t);return this.dic[e]});u(this,"removeAll",(e,t)=>{if(t){const r=this.dic[e].filter(n=>n===t).length;return this.dic[e]=this.dic[e].filter(n=>n!==t),r}const i=this.dic[e];return delete this.dic[e],i});u(this,"getQty",(e,t)=>this.dic[e]?t?this.dic[e].filter(i=>i===t).length:this.dic[e].length??0:0);u(this,"incrementActionCountPerTurn",e=>{this.temporaryCounterNames.push(e.title),this.incrementActionCount(e)});u(this,"incrementActionCount",e=>{this.dic[e.title]=[e.entity,...this.dic[e.title]??[]]});u(this,"getActionCount",e=>this.dic[e.title]?this.dic[e.title].filter(t=>t===e.entity).length:0);u(this,"corpseDisposal",()=>{this.temporaryCounterNames.forEach(e=>delete this.dic[e]),this.temporaryCounterNames.reset(),_r.forEach(e=>delete this.dic[e])});u(this,"removeAllActualCounters",()=>{mr.forEach(e=>delete this.dic[e])});u(this,"removeAllWhenfaceDown",()=>{this.temporaryCounterNames.forEach(e=>delete this.dic[e]),this.temporaryCounterNames.reset(),mr.forEach(e=>delete this.dic[e])});u(this,"clear",()=>{_r.forEach(e=>delete this.dic[e]),this.temporaryCounterNames.forEach(e=>delete this.dic[e]),this.temporaryCounterNames.reset(),tc.forEach(e=>delete this.dic[e])});this.dic={},this.temporaryCounterNames=[],this.entity=e}}const nt=async()=>({selectedEntities:[],chainBlockTags:[],prepared:void 0}),rc=async(a,e,t)=>(a.activator.payLp(t,a.action.entity),{lifePoint:t}),nc=a=>a.activator.canSendToGraveyard([a.action.entity])&&a.action.entity.canBeSentToGraveyard(a.activator,a.action.entity,"SendToGraveyardAsCost",a.action),sc=async a=>(await a.action.entity.sendToGraveyard(["Cost"],a.action.entity,a.activator),{sendToGraveyard:[a.action.entity]}),ca=a=>a.activator.canTryBanish(a.action.entity,"BanishAsCost",a.action)&&a.action.entity.canBeBanished("BanishAsCost",a.activator,a.action.entity,a.action),Wa=async a=>(await a.action.entity.banish(["Cost"],a.action.entity,a.activator),{banish:[a.action.entity]}),lc=(a,e,t=1)=>e.filter(i=>a.activator.canTryBanish(i,"BanishAsCost",a.action)).filter(i=>i.canBeBanished("BanishAsCost",a.activator,a.action.entity,a.action)).length>=t,oc=async(a,e,t,i)=>{const r=e.filter(s=>a.activator.canTryBanish(s,"BanishAsCost",a.action)).filter(s=>s.canBeBanished("BanishAsCost",a.activator,a.action.entity,a.action)),n=await a.activator.waitSelectEntities(r,i,t,"コストとして除外するカードを選択",!1)??[];return await ve.banishManyForTheSameReason(n,["Cost"],a.action.entity,a.activator),{banish:n}},hi=async(a,e,t=Ye,i=n=>n.length===1,r=1)=>{const n=a.activator.getMonsterZones(),s=a.activator.getEnableSummonList(a.activator,"SpecialSummon",["Effect"],a.action,e.filter(o=>o.status.kind==="Monster").filter(o=>o.canBeTargetOfEffect(a)).map(o=>({monster:o,posList:t,cells:n})),[],!1),l=await a.activator.waitSelectEntities(s.map(o=>o.monster),r,i,"特殊召喚するモンスターを選択",!1)??[];if(!l.length)throw new lt(a);const d=l.map(o=>o.fieldCell.cellType).getDistinct().filter(o=>o==="Graveyard"||o==="Banished").map(o=>o==="Graveyard"?"SpecialSummonFromGraveyard":"SpecialSummonFromBanished");return{selectedEntities:l,chainBlockTags:d,prepared:void 0}},gi=async(a,e=["Attack","Defense"],t=!0)=>{const i=a.activator.getMonsterZones(),r=a.selectedEntities.filter(n=>!n.wasMovedAfter(a.isActivatedAt)).map(n=>({monster:n,posList:e,cells:i}));return t&&(r.length!==a.selectedEntities.length||i.length<r.length)?!1:(await a.activator.summonAll(a.activator,"SpecialSummon",["Effect"],a.action,r,[],!1,!1),!0)},cc=async(a,e,t=["Attack","Defense"])=>{const i=a.activator.getMonsterZones(),r=e.map(n=>({monster:n,posList:t,cells:i}));return await a.activator.summonAll(a.activator,"SpecialSummon",["Effect"],a.action,r,[],!1,!1),!0},uc=(a,e,t)=>({title:a,playType:"SystemPeriodAction",spellSpeed:"Normal",executableCells:Mi,executablePeriods:e,executableDuelistTypes:["Controller","Opponent"],isMandatory:!0,validate:t,prepare:nt,execute:async()=>!0,settle:async()=>!0}),dc=a=>{if(!(a.activator.info.ruleNormalSummonCount>=a.activator.info.maxRuleNormalSummonCount)&&a.action.entity.lvl)if(a.action.entity.lvl<5){const e=a.activator.getEnableSummonList(a.activator,"NormalSummon",["Rule"],a.action,[{monster:a.action.entity,posList:["Attack","Set"],cells:a.activator.getMonsterZones()}],[],!1);return e.length?e.flatMap(t=>t.cells).getDistinct():void 0}else{const e=a.activator.getReleasableMonsters(),t=a.action.entity.lvl<7?1:2;if(e.length<t)return;if(e.getAllOnOffPattern().filter(r=>r.length===t).some(r=>a.activator.getEnableSummonList(a.activator,"AdvanceSummon",["Rule","NormalSummon"],a.action,[{monster:a.action.entity,posList:["Attack","Set"],cells:a.activator.getMonsterZones()}],r.map(n=>({material:n,cell:n.fieldCell})),!1).length))return[]}},fc=async(a,e,t)=>{if(!a.action.entity.lvl)return;if(a.action.entity.lvl<5)return{};const i=a.activator.getAvailableMonsterZones(),r=a.activator.getReleasableMonsters(),n=a.activator.getExtraMonsterZones(),s=a.action.entity.lvl<7?1:2;n.length>=s&&r.filter(o=>o.fieldCell.cellType!=="ExtraMonsterZone");const l=await a.activator.waitSelectEntities(a.activator.getReleasableMonsters(),s,o=>(t||o.length>0)&&(s<0||o.length===s)&&(i.length>0||o.some(c=>c.fieldCell.cellType==="ExtraMonsterZone")),"リリースするモンスターを選択",t??!1)??[];return l.length?(await ve.releaseManyForTheSameReason(l,["Cost","AdvanceSummonRelease","Rule"],a.action.entity,a.activator),{summonMaterialInfos:l.map(o=>({material:o,cell:o.fieldCell}))}):void 0},vc=async a=>{var r;const e=["Rule","NormalSummon"];let t="NormalSummon";(r=a.costInfo.summonMaterialInfos)!=null&&r.length&&(t="AdvanceSummon",e.push("AdvanceSummon"));const i=a.dest?[a.dest]:a.activator.getAvailableMonsterZones();return yi(a,t,e,["Attack","Set"],i)},yi=async(a,e,t,i,r)=>{let n=r;return n||(n=a.activator.getMonsterZones(),a.action.entity.fieldCell.cellType==="ExtraDeck"&&n.push(...a.activator.duel.field.getCells("ExtraMonsterZone"))),await a.activator.summon(e,t,a.action,a.action.entity,i,n,a.costInfo.summonMaterialInfos??[],!1),{selectedEntities:[],chainBlockTags:[],prepared:void 0}},mi=async a=>{var e,t;return a.action.entity.info.isRebornable=!((e=a.action.entity.origin.monsterCategories)!=null&&e.includes("RegularSpecialSummonOnly")),a.action.entity.determine(),(t=a.costInfo.summonMaterialInfos)==null||t.map(i=>i.material).forEach(i=>i.onUsedAsMaterial(a,a.action.entity)),!0},Ue={title:"通常召喚",isMandatory:!1,playType:"NormalSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:dc,payCosts:fc,prepare:vc,execute:mi,settle:async()=>!0},Sr=(a,e,t)=>{const i=a.activator.getMonsterZones();if(a.action.entity.fieldCell.cellType==="ExtraDeck"&&i.push(...a.activator.getAvailableExtraZones()),!!a.activator.getEnableSummonList(a.activator,"SpecialSummon",["Rule"],a.action,[{monster:a.action.entity,posList:e,cells:i}],t,!1).length)return t.length===0?i:[]},pc=a=>{if(!a.activator.isTurnPlayer)return;const e=a.action.entity.getAttackTargets();return e.length?e.map(t=>t.fieldCell):void 0},hc=async a=>{var i;if(a.action.entity.info.attackCount>0||a.action.entity.battlePosition!=="Attack")return;if((i=a.dest)!=null&&i.targetForAttack){const r=a.dest.entities.find(n=>n.entityType==="Duelist");return{selectedEntities:r?[r]:a.dest.cardEntities,chainBlockTags:[],prepared:void 0}}const e=a.action.entity.getAttackTargets();if(e.length===0)throw new oe("想定されない状態",a);if(e.length===1)return{selectedEntities:e,chainBlockTags:[],prepared:void 0};if(a.activator.duelistType==="NPC"){let r=a.activator.selectAttackTargetForNPC(a.action.entity,a.action);return r||(a.activator.duel.log.warn("NPCの攻撃対象選択に失敗したため、ランダムに攻撃対象を選択。"),r=e.randomPick()),{selectedEntities:[r],chainBlockTags:[],prepared:void 0}}const t=await a.activator.waitSelectEntity(e,"攻撃対象を選択。",!0);if(t)return{selectedEntities:[t],chainBlockTags:[],prepared:void 0}},gc=async a=>(a.action.entity.field.duel.declareAnAttack(a.action.entity,a.selectedEntities[0]),!0),fe={title:"攻撃宣言",isMandatory:!1,playType:"Battle",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["b1Battle","b2Battle"],executableDuelistTypes:["Controller"],validate:pc,prepare:hc,execute:gc,settle:async()=>!0},ks=async a=>{if(!(a.action.entity.info.battlePotisionChangeCount>0||!a.activator.isTurnPlayer))return await a.action.entity.setBattlePosition(a.action.entity.battlePosition==="Attack"?"Defense":"Attack",["Rule"],a.action.entity,a.activator),a.action.entity.info.battlePotisionChangeCount++,{selectedEntities:[],chainBlockTags:[],prepared:void 0}},ke={title:"反転召喚",isMandatory:!1,playType:"FlipSummon",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:a=>a.action.entity.info.battlePotisionChangeCount===0&&a.action.entity.info.attackCount===0&&a.activator.isTurnPlayer&&a.action.entity.face==="FaceDown"?[]:void 0,prepare:ks,execute:async a=>(a.action.entity.determine(),!0),settle:async()=>!0},ye={title:"表示形式変更",isMandatory:!1,playType:"ChangeBattlePosition",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:a=>a.action.entity.info.battlePotisionChangeCount===0&&a.action.entity.info.attackCount===0&&a.activator.isTurnPlayer&&a.action.entity.face==="FaceUp"?[]:void 0,prepare:ks,execute:async a=>(a.action.entity.determine(),!0),settle:async()=>!0},ui=async(a,e=["Attack","Defense"])=>{const t=a.activator.getMonsterZones();return a.action.entity.wasMovedAfter(a.isActivatedAt)?!1:(await a.activator.summon("SpecialSummon",["Effect"],a.action,a.action.entity,e,t,[],!1),!0)},ot=(a,e,t,i,r,n,s,l,d,o,c)=>{const v={posList:d,cells:o},p={posList:[],cells:[]};return e!==s||s.status.kind!=="Monster"||!s.origin.monsterCategories?v:s.origin.monsterCategories.includes("NormalSummonOnly")?r.includes("NormalSummon")||r.includes("AdvanceSummon")?v:p:s.origin.monsterCategories.includes("SpecialSummon")?s.isInTrashCell&&!s.origin.monsterCategories.includes("RegularSpecialSummonOnly")?s.info.isRebornable||s.origin.monsterCategories.includes("FreeReborn")?v:p:r.includes("PendulumSummon")&&s.origin.monsterCategories.includes("FreeReborn")?p:r.union(Ts).length?v:s.origin.monsterCategories.includes("RegularSpecialSummonOnly")?c?v:p:v:v},ir={},yc=a=>(ir[a]||(ir[a]={title:`戦闘破壊耐性(${a})`,isMandatory:!0,executableCells:["MonsterZone"],executablePeriods:["b1DDmgCalc","b2DDmgCalc"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:a,isApplicableTo:(e,t,i)=>i.includes(e.entity)?t!=="BattleDestroy"?[]:[e.entity]:[],substitute:async(e,t,i)=>i.includes(e.entity)?t!=="BattleDestroy"?[]:e.entity.isEffective?(e.entity.controller.writeInfoLog(`${e.entity.toString()}は１ターンに１度だけ戦闘では破壊されない。`),[e.entity]):[]:[]}),ir[a]),Hr=a=>a.activator.canRelease([a.action.entity])&&a.action.entity.canBeReleased(a.activator,a.action.entity,["ReleaseAsCost"],a.action),$r=async a=>(await a.action.entity.release(["Cost"],a.action.entity,a.activator),{release:[a.action.entity]}),ws=a=>({title:"シンクロ召喚",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:yt,executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerChain:1,validate:e=>e.activator.isTurnPlayer?void 0:e.activator.getExtraDeck().cardEntities.filter(i=>{var r;return(r=i.status.monsterCategories)==null?void 0:r.includes("Syncro")}).flatMap(i=>i.actions).filter(i=>i.playType==="SpecialSummon").map(i=>({index:-1,chainNumber:void 0,action:i,activator:e.activator,targetChainBlock:void 0,isActivatedIn:i.entity.fieldCell,isActivatedAt:e.isActivatedAt,costInfo:{},state:"unloaded",dest:void 0,ignoreCost:!1})).some(i=>i.action.getEnableMaterialPatterns(i).some(r=>{const n=r.map(s=>s.material);return n.every(s=>s.controller===e.activator)&&n.every(s=>s.isOnFieldAsMonsterStrictly)&&n.includes(e.action.entity)}))?[]:void 0,prepare:nt,execute:async e=>{if(e.activator!==e.action.entity.controller||e.activator.getMonstersOnField().filter(s=>s.lvl!==void 0).length<2)return!1;const t=e.activator.getExtraDeck().cardEntities.filter(s=>{var l;return(l=s.status.monsterCategories)==null?void 0:l.includes("Syncro")}).flatMap(s=>s.actions).filter(s=>s.playType==="SpecialSummon").map(s=>({index:-1,chainNumber:void 0,action:s,activator:e.activator,targetChainBlock:void 0,isActivatedIn:s.entity.fieldCell,isActivatedAt:e.isActivatedAt,costInfo:{},state:"unloaded",dest:void 0,ignoreCost:!1})).filter(s=>s.action.getEnableMaterialPatterns(s).some(l=>{const d=l.map(o=>o.material);return d.every(o=>o.controller===e.activator)&&d.every(o=>o.isOnFieldAsMonsterStrictly)&&d.includes(e.action.entity)})).map(s=>s.action.entity).getDistinct();if(!t.length)return!1;const i=await e.activator.waitSelectEntities(t,1,s=>s.length===1,"シンクロ召喚するモンスターを選択。",!1)??[];if(!i.length)throw new oe("想定されない状態",e);const r=i[0].actions.find(s=>s.playType==="SpecialSummon");if(!r)throw new oe("想定されない状態",e);const n=r.getClone(s=>{const l=s.map(d=>d.material);return l.every(d=>d.controller===e.activator)&&l.every(d=>d.isOnFieldAsMonsterStrictly)&&l.includes(e.action.entity)});return e.nextActionInfo={action:n,originSeq:n.seq},!0},settle:async()=>!0,...a}),mc=Cs("直接攻撃","Monster",a=>[a],()=>!0,a=>[new oa("直接攻撃",()=>!0,!0,a,{},(e,t)=>e.isSpawnedBy===t,(e,t)=>({...t,canDirectAttack:!0}))]),Wi=class Wi extends Ea{constructor(){super(...arguments);u(this,"isApplicableTo",(t,i,r)=>{const n=this.entity.counterHolder.getActionCount(this);return this.isOnlyNTimesPerTurnIfFaceup>0&&n>=this.isOnlyNTimesPerTurnIfFaceup?this.entity.counterHolder.incrementActionCountPerTurn(this):this.isOnlyNTimesIfFaceup>0&&n>=this.isOnlyNTimesIfFaceup&&this.entity.counterHolder.incrementActionCount(this),this.definition.isApplicableTo(this,t,i,r)});u(this,"substitute",async(t,i,r)=>{const n=await this.definition.substitute(this,t,i,r);return this.isOnlyNTimesPerTurnIfFaceup>0?this.entity.counterHolder.incrementActionCountPerTurn(this):this.isOnlyNTimesIfFaceup>0&&this.entity.counterHolder.incrementActionCount(this),n});u(this,"getClone",()=>new Wi(this.seq,this.entity,this.definition))}get definition(){return super.definition}};u(Wi,"createNew",(t,i)=>new Wi("AutoSeq",t,i));let Cr=Wi;const _c={title:"ペンデュラム召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:a=>{const e=a.activator.getPendulumScales();if(!e||e.upperBound-e.lowerBound<2)return;const t=[...a.activator.getHandCell().cardEntities.filter(n=>n.status.kind==="Monster"),...a.activator.getExtraDeck().cardEntities.filter(n=>n.face==="FaceUp")].filter(n=>n.status.kind==="Monster").filter(n=>n.lvl&&n.lvl>e.lowerBound).filter(n=>n.lvl&&n.lvl<e.upperBound);if(!t.length)return;const i=[...a.activator.getMonsterZones(),...a.activator.getEmptyExtraZones()];return a.activator.getEnableSummonList(a.activator,"PendulumSummon",["Rule"],a.action,t.map(n=>({monster:n,cells:i,posList:Ye})),[],!1).length?[]:void 0},prepare:async a=>{const e=a.activator.getPendulumScales();if(!e||e.upperBound-e.lowerBound<2)return;const t=[...a.activator.getHandCell().cardEntities.filter(r=>r.status.kind==="Monster"),...a.activator.getExtraDeck().cardEntities.filter(r=>r.face==="FaceUp")].filter(r=>r.status.kind==="Monster").filter(r=>r.lvl&&r.lvl>e.lowerBound).filter(r=>r.lvl&&r.lvl<e.upperBound);if(!t.length)return;const i=[...a.activator.getMonsterZones(),...a.activator.getEmptyExtraZones()];return await a.activator.summonMany(a.activator,"PendulumSummon",["Rule"],a.action,t.map(r=>({monster:r,posList:Ye,cells:i})),[],!1,void 0,r=>r.length>0,!1),nt()},execute:async a=>(a.activator.getPendingMonstersOnField().forEach(e=>e.determine()),!0),settle:async()=>!0},Sc=[_c],Ts=["FusionSummon","SyncroSummon","XyzSummon","PendulumSummon","LinkSummon","RitualSummon","FlipSummon"],Cc={FusionSummon:"融合召喚",SyncroSummon:"シンクロ召喚",XyzSummon:"エクシーズ召喚",PendulumSummon:"ペンデュラム召喚",LinkSummon:"リンク召喚",RitualSummon:"儀式召喚",FlipSummon:"反転召喚"},kc=[...Ts,"AdvanceSummon","NormalSummon","SpecialSummon"],wc={BattleDestroy:"戦闘破壊",EffectDestroy:"効果破壊",RuleDestroy:"ルール破壊"},bs=a=>a+"Summon",yn=["Card","Token","Avatar"],Tc=["Duelist","Squatter"],Es=(a,e)=>Vi(a.origin,e.origin),Xe=class Xe{constructor(e,t,i,r,n,s,l){u(this,"onBeforeMoveEvent",new sn);u(this,"onAfterMoveEvent",new sn);u(this,"seq");u(this,"origin");u(this,"entityType");u(this,"summonFilterBundle");u(this,"procFilterBundle");u(this,"numericOprsBundle");u(this,"statusOperatorBundle");u(this,"moveLog");u(this,"counterHolder");u(this,"face");u(this,"orientation");u(this,"owner");u(this,"fieldCell");u(this,"_status");u(this,"_numericStatus");u(this,"_info");u(this,"actions",[]);u(this,"continuousEffects",[]);u(this,"substituteEffects",[]);u(this,"canBeReleased",(e,t,i,r)=>!this.isInTrashCell&&this.procFilterBundle.effectiveOperators.filter(n=>n.procTypes.union(i).length).every(n=>n.filter(e,t,r,[this])));u(this,"canBeSentToGraveyard",(e,t,i,r)=>!this.info.willBeBanished&&!this.info.willReturnToDeck&&this.procFilterBundle.effectiveOperators.filter(n=>n.procTypes.includes(i)).every(n=>n.filter(e,t,r,[this])));u(this,"_hasDisappeared",!1);u(this,"cardDefinition");u(this,"toString",()=>this.entityType==="Card"?`《${this.nm}》`:this.nm);u(this,"onUsedAsMaterial",(e,t)=>{this.cardDefinition&&this.cardDefinition.onUsedAsMaterial&&this.cardDefinition.onUsedAsMaterial(e,t)});u(this,"setBattlePosition",async(e,t,i,r)=>{let n=`表示形式の変更：${this.toString()}（${this.battlePositionName}⇒${va[e]}）`;const s=[...t];this.battlePosition==="Set"&&(s.push("Flip"),t.includes("Rule")&&(this.info.isPending=!0,n=`${this.toString()}を反転召喚`,this.info.summonKinds.push("FlipSummon"),s.push("FlipSummon"),s.push("AttackSummon"))),this.duel.log.info(n,r),await this.moveAlone(this.fieldCell,"Monster",e==="Set"?"FaceDown":"FaceUp",e==="Attack"?"Vertical":"Horizontal","Top",s,i,r,r)});u(this,"activateAsPendulumScale",(e,t,i,r)=>this.moveAlone(e,"Spell","FaceUp","Vertical","Top",["CardActivation",...t],i,r,r));u(this,"setNonFieldMonsterPosition",async(e,t,i,r,n)=>{this.moveAlone(this.fieldCell,e,t==="FaceUp"?"FaceUp":"FaceDown","Vertical","Top",i,r,n,n)});u(this,"setAsSpellTrap",async(e,t,i,r,n)=>{await this.moveAlone(e,t,"FaceDown","Vertical","Top",[...i,"SpellTrapSet"],r,n,n)});u(this,"activateSpellTrapFromHand",async(e,t,i,r,n)=>{await this.moveAlone(e,t,"FaceUp","Vertical","Top",[...i,"CardActivation"],r,n,n)});u(this,"putDirectly",async(e,t,i,r,n)=>{await this.moveAlone(e,t,"FaceUp","Vertical","Top",[...i,"PutDirectly"],r,n,n)});u(this,"activateSpellTrapOnField",async(e,t,i,r)=>{await this.moveAlone(this.fieldCell,e,"FaceUp","Vertical","Top",[...t,"CardActivation"],i,r,r)});u(this,"draw",async(e,t,i)=>await this.addToHand([...e,"Draw"],t,i));u(this,"addToHand",async(e,t,i)=>await this.moveAlone(this.owner.getHandCell(),this.origin.kind,"FaceDown","Vertical","Bottom",[...e],t,i,i));u(this,"summon",(e,t,i,r,n,s,l)=>Xe.summonMany([{monster:this,dest:e,summoner:l??s,pos:t}],i,r,n,s));u(this,"moveForcibly",async(e,t,i,r,n,s,l)=>{await this.moveAlone(e,this.origin.kind,t,i,r,["Rule",...n],s,l,l)});u(this,"moveAlone",async(e,t,i,r,n,s,l,d,o)=>(await Xe.moveMany([[this,e,t,i,r,n,s,l,d,o]],void 0),this.fieldCell));u(this,"determine",()=>{this.info.isPending&&(this.info.isPending=!1,this.moveLog.finalize(),this.continuousEffects.forEach(e=>e.updateState()))});u(this,"_move",async(e,t,i,r,n,s,l,d,o)=>{if(!e)throw new Error("illegal argument: to");if(await this.onBeforeMoveEvent.trigger({entity:this,args:[e,t,i,r,n,s,l,d,o]}),this.face=i,this.orientation=r,e!==this.fieldCell){if(this.field.duel.clock.turn>0&&(this.duel.log.info(`移動：${this.toString()}  ${this.fieldCell.toString()} ⇒ ${e.toString()}`,d),await this.field.duel.view.waitAnimation({entity:this,to:e,index:n,count:0})),this.fieldCell.releaseEntities(this),this.fieldCell.isPlayFieldCell&&!e.isPlayFieldCell&&(this.counterHolder.clear(),this.resetCauseOfDeath(),this.entityType==="Token")){this._hasDisappeared=!0,this.field.duel.log.info(`${this.nm}は消滅した。`,this.controller);return}this.status.kind!=="XyzMaterial"&&(this.fieldCell.isMonsterZoneLikeCell&&!e.isMonsterZoneLikeCell||t!=="Monster")&&(this.info.equipEntities.filter(c=>c.isOnFieldAsSpellTrapStrictly).forEach(c=>{c.info.isDying=!0,c.info.causeOfDeath=["RuleDestroy"],this.controller.writeInfoLog(`装備対象${this.toString()}不在により${c.toString()}は破壊された。`)}),this.info.equipEntities=[],this.fieldCell.xyzMaterials.forEach(c=>{c.info.isDying=!0,c.info.causeOfDeath=["LostXyzOwner"],this.controller.writeInfoLog(`エクシーズモンスター${this.toString()}不在により${c.toString()}は墓地に送られた。`)}),this.resetNumericStatus(),this.info.willBeBanished=!1,this.info.willReturnToDeck=void 0,this.info.isEffectiveIn.push(...ii)),this.fieldCell.cellType==="SpellAndTrapZone"&&e.cellType!=="SpellAndTrapZone"&&(this.info.equipedBy=void 0,this.info.equipedAs=void 0,this.info.willBeBanished=!1,this.info.willReturnToDeck=void 0,this.info.isEffectiveIn.push(...ii)),e.acceptEntities(this,n),(e===this.isBelongTo||e.cellType==="Hand"||e.cellType==="Banished"&&this.face==="FaceDown")&&(this.counterHolder.clear(),this.resetInfoAll(),this.resetStatusAll())}return(this.isOnFieldStrictly&&this.face==="FaceDown"||t==="XyzMaterial")&&(this.info.equipEntities.forEach(c=>{c.info.isDying=!0,c.info.causeOfDeath=["RuleDestroy"],this.controller.writeInfoLog(`装備対象${this.toString()}不在により${c.toString()}は破壊された。`)}),this.counterHolder.removeAllWhenfaceDown(),this.info.materials=[],this._status.isEffective=!0,this.info.isEffectiveIn=[...Mi],this.info.willBeBanished=!1,this.info.willReturnToDeck=void 0,this.resetNumericStatus(),this.info.isSettingSickness=this.status.kind==="Trap"||this.status.spellCategory==="QuickPlay"),this._status.kind=t,this.moveLog.push(t,s,l,d,o),await this.onAfterMoveEvent.trigger(this),e});u(this,"initForTurn",()=>{this.info.isSettingSickness=!1,this.info.attackCount=0,this.info.battlePotisionChangeCount=0,this.counterHolder.corpseDisposal()});u(this,"resetInfoIfLeavesTheField",()=>{this._info={...this._info,isDying:!1,isPending:!1,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,effectTargets:{},attackCount:0,battlePotisionChangeCount:0,materials:[],equipedBy:void 0,equipedAs:void 0,equipEntities:[]},this._info.isEffectiveIn.push(...ii),this._info.isEffectiveIn.distinct()});u(this,"resetInfoAll",()=>{var e;this._info={isDying:!1,isPending:!1,isEffectiveIn:[...Mi],causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,isVanished:!1,isRebornable:((e=this.origin.monsterCategories)==null?void 0:e.union(vs).length)===0,isSettingSickness:!1,summonKinds:[],materials:[],effectTargets:{},willBeBanished:!1,willReturnToDeck:void 0,attackCount:0,battlePotisionChangeCount:0,equipedBy:void 0,equipedAs:void 0,validateEquipOwner:()=>!0,equipEntities:[],battleLog:[]},this.counterHolder.clear()});u(this,"resetNumericStatus",()=>{const e=ps.reduce((t,i)=>(t[i]=this.origin[i],t),{});this._numericStatus={origin:{...e},wip:{...e},calculated:{...e}}});u(this,"resetStatus",()=>{this._status={...this.origin,canAttack:!0,isEffective:!0,canDirectAttack:!1,canActivateEffect:!0,isSelectableForAttack:!0,allowHandSyncro:!1,allowHandLink:!1,maxCounterQty:{}}});u(this,"resetStatusAll",()=>{this.resetNumericStatus(),this.resetStatus()});u(this,"resetCauseOfDeath",()=>{this.info.isDying=!1,this.info.causeOfDeath=[],this.info.isKilledBy=void 0,this.info.isKilledByWhom=void 0});var c,v;this.seq=Xe.nextEntitySeq++,this.counterHolder=new ac(this),this.cardDefinition=l,this.owner=e,this.fieldCell=t,this.entityType=i,this.origin=r,this._status=JSON.parse(JSON.stringify(r)),this._numericStatus=JSON.parse(JSON.stringify(r)),this.resetStatusAll(),this._info={isEffectiveIn:[...Mi],attackCount:0,battlePotisionChangeCount:0,isDying:!1,isPending:!1,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,isVanished:!1,isRebornable:!0,isSettingSickness:!1,summonKinds:[],materials:[],effectTargets:{},willBeBanished:!1,willReturnToDeck:void 0,equipedBy:void 0,equipedAs:void 0,validateEquipOwner:()=>!0,equipEntities:[],battleLog:[]},this.resetInfoAll(),this.face=n,this.orientation=s,this.summonFilterBundle=new Qo(t.field.summonFilterPool,this),this.procFilterBundle=new qo(t.field.procFilterPool,this),this.numericOprsBundle=new Ro(t.field.numericStateOperatorPool,this),this.statusOperatorBundle=new Wo(t.field.statusOperatorPool,this),t.acceptEntities(this,"Top"),this.moveLog=new Io(this),this.moveLog.pushForRuleAction(["Spawn"]);let d=[],o=[];this.origin.kind==="Monster"&&((c=this.origin.monsterCategories)!=null&&c.includes("Normal"))&&!((v=this.origin.monsterCategories)!=null&&v.includes("Pendulum"))?d=[Ue,fe,ye,ke]:l&&(d=l.actions,o=l.continuousEffects??[],this.substituteEffects.push(...(l.substituteEffects??[]).map(p=>Cr.createNew(this,p))),this.origin.kind==="Monster"&&this.entityType==="Card"&&this.summonFilterBundle.push(new Ko("default",()=>!0,!0,this,{},()=>!0,kc,l.defaultSummonFilter??ot)),l.defaultStatus&&this.statusOperatorBundle.push(new oa("default",()=>!0,!0,this,{},()=>!0,()=>l.defaultStatus??{}))),this.actions.push(...d.map(p=>xi.createNew(this,p))),this.continuousEffects.push(...o.map(p=>yr.createNew(this,p)))}get onBeforeMove(){return this.onBeforeMoveEvent.expose()}get onAfterMove(){return this.onAfterMoveEvent.expose()}get isUnderControl(){return this.face==="FaceUp"||gs.every(e=>e!==this.fieldCell.cellType)}get controller(){return this.fieldCell.owner??this.owner}get field(){return this.owner.duel.field}get duel(){return this.owner.duel.field.duel}get actionLogRecords(){return this.duel.chainBlockLog.records.filter(e=>e.chainBlockInfo.action.entity===this)}get status(){return this._status}set status(e){this._status={...e}}get numericStatus(){return this._numericStatus}get info(){return this._info}get nm(){return this.status.name}get atk(){return this._numericStatus.calculated.attack}get def(){return this._numericStatus.calculated.defense}get lvl(){return this._numericStatus.calculated.level}get rank(){return this._numericStatus.calculated.rank}get attr(){return this.status.attributes??[]}get types(){return this.status.types??[]}get psL(){return this._numericStatus.calculated.pendulumScaleL}get psR(){return this._numericStatus.calculated.pendulumScaleR}get linkArrows(){let e=(this.origin.linkArrowKeys??[]).map(t=>hs[t].linkArrow);return this.controller.seat==="Above"&&(e=e.map(t=>({offsetColumn:t.offsetColumn*-1,offsetRow:t.offsetRow*-1}))),e}get linkArrowDests(){var e;return(e=this.origin.monsterCategories)!=null&&e.includes("Link")?this.isOnFieldAsMonsterStrictly?this.linkArrows.map(t=>[this.fieldCell.row+t.offsetRow,this.fieldCell.column+t.offsetColumn]).map(([t,i])=>this.field.cells[t][i]).filter(t=>t.isMonsterZoneLikeCell):[]:[]}get linkedEntities(){return this.isOnFieldAsMonsterStrictly?[...this.linkArrowDests.map(e=>e.cardEntities[0]).map(e=>e),...this.fieldCell.linkArrowSources].getDistinct():[]}get coLinkedEntities(){var e;return this.isOnFieldAsMonsterStrictly?(e=this.origin.monsterCategories)!=null&&e.includes("Link")?this.linkArrowDests.map(t=>t.cardEntities[0]).filter(t=>t).union(this.fieldCell.linkArrowSources):[]:[]}get isEffective(){return this.status.isEffective&&this.info.isEffectiveIn.includes(this.fieldCell.cellType)}get isEffectiveWeakly(){return this.status.isEffective}get battlePosition(){if(this.isOnFieldStrictly&&this.status.kind==="Monster")return this.orientation==="Vertical"?"Attack":this.face==="FaceUp"?"Defense":"Set"}get battlePositionName(){const e=this.battlePosition;if(e)return va[e]}get wasMovedAtCurrentProc(){return this.field.duel.clock.totalProcSeq===this.moveLog.latestRecord.movedAt.totalProcSeq}get wasMovedAtPreviousProc(){return this.field.duel.clock.totalProcSeq===this.moveLog.latestRecord.movedAt.totalProcSeq+1}get wasMovedAtCurrentTurn(){return this.field.duel.clock.isSameTurn(this.moveLog.latestRecord.movedAt)}get wasMovedAtCurrentChain(){return this.field.duel.clock.isSameChain(this.moveLog.latestRecord.movedAt)}get wasMovedAtPreviousChain(){return this.field.duel.clock.isPreviousChain(this.moveLog.latestRecord.movedAt)}get wasMovedAtPreviousTurn(){return this.field.duel.clock.isPreviousTurn(this.moveLog.latestRecord.movedAt)}get wasMovedFrom(){return this.moveLog.previousPlaceRecord.cell}get isPendulumScale(){var e;return!(!((e=this.origin.monsterCategories)!=null&&e.includes("Pendulum"))||!this.isOnField||!this.fieldCell.isSpellTrapZoneLikeCell||this.status.spellCategory)}get isOnField(){return this.fieldCell.isPlayFieldCell}get isOnFieldStrictly(){return this.isOnField&&!this.info.isPending&&this.status.kind!=="XyzMaterial"}get isOnFieldAsMonsterStrictly(){return this.fieldCell.isMonsterZoneLikeCell&&this.isOnFieldStrictly}get isOnFieldAsSpellTrapStrictly(){return this.fieldCell.isSpellTrapZoneLikeCell&&this.isOnFieldStrictly}get isInTrashCell(){return this.fieldCell.isTrashCell}get isLikeContinuousSpell(){return this.status.spellCategory==="Continuous"||this.status.spellCategory==="Field"||this.status.spellCategory==="Equip"||this.status.trapCategory==="Continuous"||(this.status.monsterCategories??[]).includes("Pendulum")}get isBelongTo(){return this.origin.monsterCategories&&this.origin.monsterCategories.union(Fi).length?this.owner.getExtraDeck():this.owner.getDeckCell()}get hasDisappeared(){return this._hasDisappeared}get allStickyEffectOperators(){return[...this.procFilterBundle.effectiveOperators,...this.numericOprsBundle.effectiveOperators]}};u(Xe,"nextEntitySeq",0),u(Xe,"splitBattlePos",e=>({face:e==="Set"?"FaceDown":"FaceUp",orientation:e==="Attack"?"Vertical":"Horizontal"})),u(Xe,"recreateArray",(e,t)=>{if(!t.length)return[];const i=e.getAllCells().flatMap(r=>r.entities);return t.map(r=>r.seq).map(r=>i.find(n=>n.seq===r)).filter(r=>r!==void 0)}),u(Xe,"createPlayerEntity",e=>{const t=e.getHandCell();return new Xe(e,t,"Duelist",{name:e.profile.name,kind:"Monster",wikiEncodedName:"%A5%D7%A5%EC%A5%A4%A5%E4%A1%BC"},"FaceUp","Vertical",{name:e.profile.name,actions:[...Sc]})}),u(Xe,"createCardEntity",(e,t)=>{var s,l;const i=t.monsterCategories&&t.monsterCategories.union(Fi).length?e.getExtraDeck():e.getDeckCell(),r=vn(t),n=wr.get(t.name);if(r.kind==="Monster"&&((s=r.monsterCategories)!=null&&s.includes("Normal"))&&!((l=r.monsterCategories)!=null&&l.includes("Pendulum"))||n)return new Xe(e,i,"Card",vn(t),"FaceDown","Vertical",n);console.info(`${t.name}のカード効果が未定義のため、デッキに投入されなかった。`)}),u(Xe,"moveMany",async(e,t)=>{if(!e.length)return;const i=e[0][0].duel,n=[...e.filter(([l,d])=>l.fieldCell!==d).map(([l])=>l).filter(l=>!(t??[]).includes(l)),...i.field.getCardsOnFieldStrictly().filter(l=>l.info.isDying)],s=new Map;for(e.forEach(([l,d,o,c,v,p,...h])=>{var E;let m=d,C=o,y=c,T=p,w=v;l.info.willBeBanished?(m=l.owner.getBanished(),y="FaceUp",w="Vertical"):l.info.willReturnToDeck?(m=l.isBelongTo,y="FaceDown",T=l.info.willReturnToDeck,w="Vertical"):(E=l.status.monsterCategories)!=null&&E.includes("Pendulum")&&l.isOnFieldStrictly&&l.face==="FaceUp"&&d.isTrashCell&&(m=l.owner.getExtraDeck(),y="FaceUp",T="Top",w="Vertical"),m.cellType==="ExtraDeck"&&(T=y==="FaceUp"?"Top":"Bottom"),l.isBelongTo.cellType==="ExtraDeck"&&(m.cellType==="Hand"||m.cellType==="Deck")&&(m=l.isBelongTo,y="FaceDown",w="Vertical"),m.isPlayFieldCell||(C=l.origin.kind),m.isMonsterZoneLikeCell||(w="Vertical"),s.set(m,[[l,m,C,y,w,T,...h],...s.get(m)??[]])});;){const l=Array.from(s.values()).map(o=>o.pop()).filter(o=>o!==void 0).map(([o,...c])=>o._move(...c));if(!l.length)break;await Promise.all(l);const d=i.field.getCardsOnFieldStrictly().filter(o=>o.info.isDying).filter(o=>!n.includes(o)).map(o=>({entity:o,causedAs:o.info.causeOfDeath??[],causedBy:o.info.isKilledBy,activator:o.info.isKilledByWhom}));d.length&&await Xe.sendManyToGraveyard(d,n)}Xe.settleEntityMove(i)}),u(Xe,"summonMany",async(e,t,i,r,n)=>{if(!e.length)return;const s={Attack:"AttackSummon",Defense:"DefenseSummon",Set:"SetSummon"},l=e.map(({monster:d,dest:o,pos:c,summoner:v})=>{if(d.info.summonKinds=[t],t==="NormalSummon"||t==="AdvanceSummon"){d.info.summonKinds.push("NormalSummon");const m=t==="AdvanceSummon"?"アドバンス":"";c==="Attack"?d.field.duel.log.info(`${d.toString()}を${m}召喚`,v):d.duel.log.info(`${d.toString()}を${m}セット`,v),i.includes("Rule")?v.info.ruleNormalSummonCountQty++:v.info.effectNormalSummonCountQty++}else t==="SpecialSummon"?d.duel.log.info(`${d.toString()}を${va[c]}で特殊召喚`,v):(d.info.summonKinds.push("SpecialSummon"),d.duel.log.info(`${d.toString()}を${va[c]}で${Cc[t]}！`,v)),v.info.specialSummonCountQty++;d.info.summonKinds=d.info.summonKinds.getDistinct(),d.info.battlePotisionChangeCount=1;const{face:p,orientation:h}=Xe.splitBattlePos(c);return i.includes("Rule")&&(d.info.isPending=!0),{entity:d,args:[o,"Monster",p,h,"Top",[t,s[c],...i],r,n,v]}}).map(d=>d.entity._move(...d.args));await Promise.all(l),e.map(d=>d.summoner).forEach(d=>{t==="NormalSummon"||t==="AdvanceSummon"?i.includes("Rule")?d.info.ruleNormalSummonCount++:d.info.effectNormalSummonCount++:d.info.specialSummonCount++}),Xe.settleEntityMove(e[0].monster.duel)}),u(Xe,"sendManyToGraveyard",(e,t)=>Xe.bringManyToSameCell("Graveyard","Top",e.map(i=>({...i,face:"FaceUp",orientation:"Vertical"})),t)),u(Xe,"bringManyToSameCell",(e,t,i,r)=>Xe.moveMany(i.map(n=>[n.entity,n.entity.field.getCells(e).filter(s=>s.owner===n.entity.owner)[0],n.entity.origin.kind,n.face,n.orientation,t,n.causedAs,n.causedBy,n.activator,n.activator]),r)),u(Xe,"settleEntityMove",e=>{e.field.recalcLinkArrows(),e.distributeOperators(e.clock);const t=e.field.getAllEntities().filter(i=>i.wasMovedAtCurrentProc);t.filter(i=>!i.isOnFieldStrictly&&!i.info.isPending).forEach(i=>i.resetInfoIfLeavesTheField()),t.filter(i=>i.face==="FaceDown").filter(i=>i.fieldCell===i.isBelongTo).forEach(i=>{i.resetInfoAll(),i.resetStatusAll()}),t.flatMap(i=>i.continuousEffects).forEach(i=>i.updateState()),e.field.getAllCells().filter(i=>i.needsShuffle).map(i=>i.shuffle())});let Me=Xe;Me.prototype.hasBeenSummonedNow=function(a,e=["Attack","Defense"]){const t=this,i=e.map(bs),r=t.moveLog.latestRecord.movedAs;return!(!t.wasMovedAtPreviousChain||!r.union(a).length||!r.union(i).length)};Me.prototype.hasBeenSummonedJustNow=function(a,e=["Attack","Defense"]){const t=this,i=e.map(bs),r=t.moveLog.latestRecord.movedAs;return!(!t.wasMovedAtPreviousProc||!r.union(a).length||!r.union(i).length)};Me.prototype.getAttackTargets=function(){if(!this.hasAttackRight())return[];const a=this.controller.getOpponentPlayer().getMonstersOnField().filter(e=>e.status.isSelectableForAttack);return console.log(this.toString(),this.status.canDirectAttack),(this.status.canDirectAttack||!a.length)&&a.push(this.controller.getOpponentPlayer().entity),a.filter(e=>e.canBeTargetOfBattle(this.controller,this)).filter(e=>this.procFilterBundle.effectiveOperators.filter(t=>t.procTypes.includes("BattleTarget")).every(t=>t.filter(this.controller,this,{},[e])))};Me.prototype.canDirectAttack=function(){return this.getAttackTargets().some(a=>a.entityType==="Duelist")};Me.prototype.canAttackToMonster=function(){return this.getAttackTargets().some(a=>a.entityType!=="Duelist")};Me.prototype.hasAttackRight=function(){return this.battlePosition==="Attack"&&this.info.attackCount===0&&this.status.canAttack};Me.prototype.canBeEffected=function(a,e,t){return this.procFilterBundle.effectiveOperators.filter(r=>r.procTypes.some(n=>n==="Effect")).every(r=>r.filter(a,e,t,[this]))};const Ds=(a,e,t,i,r)=>a.canBeEffected(t,i,r)&&a.procFilterBundle.effectiveOperators.filter(n=>n.procTypes.some(s=>s===e)).every(n=>n.filter(t,i,r,[a]));Me.prototype.canBeTargetOfEffect=function(a){return Ds(this,"EffectTarget",a.activator,a.action.entity,a.action)};Me.prototype.canBeBanished=function(a,e,t,i){return this.fieldCell.cellType==="Banished"?!1:Ds(this,a,e,t,i)};Me.prototype.canBeTargetOfBattle=function(a,e){const t=this;return t.procFilterBundle.effectiveOperators.filter(i=>i.procTypes.some(r=>r==="BattleTarget")).every(i=>i.filter(a,e,{},[t]))};Me.prototype.validateDestory=function(a,e,t,i){const r=this;let n=r.procFilterBundle.effectiveOperators.filter(s=>s.procTypes.includes(a)).every(s=>s.filter(e,t,i??{},[r]));return n&&a==="EffectDestroy"&&(n=r.canBeEffected(e,t,i)),n};Me.prototype.getIndexInCell=function(){const a=this;if(a.info.isVanished)return-1;const e=a.fieldCell.cardEntities.indexOf(a);if(e<0)throw new oe("エンティティとセルの状態が矛盾している。",[a,a.fieldCell]);return e};Me.prototype.getXyzMaterials=function(){const a=this;return(a.status.monsterCategories??[]).includes("Xyz")?a.fieldCell.xyzMaterials:[]};Me.prototype.wasMovedAfter=function(a){return this.moveLog.latestRecord.movedAt.totalProcSeq>a.totalProcSeq};Me.prototype.hadArrivedToFieldAt=function(){let a=this.moveLog.latestRecord.movedAt;return this.moveLog.records.findLast(e=>!e.cell.isPlayFieldCell||e.isPending||e.kind!==this.status.kind||e.face==="FaceDown"?!0:(a=e.movedAt,!1)),a};Me.prototype.release=async function(a,e,t){return await this.sendToGraveyard([...a,"Release"],e,t),this.info.isVanished?void 0:this.fieldCell};Me.prototype.ruleDestory=async function(){return await this.sendToGraveyard(["RuleDestroy"],void 0,void 0),this.info.isVanished?void 0:this.fieldCell};Me.prototype.sendToGraveyard=function(a,e,t){return ve.sendManyToGraveyardForTheSameReason([this],a,e,t)};Me.prototype.discard=function(a,e,t){return ve.discardManyForTheSameReason([this],a,e,t)};Me.prototype.returnToDeck=function(a,e,t,i){return ve.returnManyToDeckForTheSameReason(a,[this],e,t,i)};Me.prototype.banish=function(a,e,t){return ve.banishManyForTheSameReason([this],a,e,t)};vi.prototype.summon=async function(a,e,t,i,r,n,s,l){return(await this.summonMany(this,a,e,t,[{monster:i,posList:r,cells:n}],s,!1,1,o=>o.length===1,l)??[])[0]};vi.prototype.waitSelectEntities=function(a,e,t,i,r=!1){return this.duel.view.waitSelectEntities(this,{selectables:a,qty:e,validator:t,cancelable:r},i)};vi.prototype.waitSelectEntity=async function(a,e,t=!1){const i=await this.waitSelectEntities(a,1,r=>r.length===1,e,t);return i?i[0]:void 0};let bc=class{constructor(e){u(this,"onUpdateEvent",new Je);u(this,"nextSeq");u(this,"records",[]);u(this,"duel");u(this,"dispose",()=>{this.onUpdateEvent.clear()});u(this,"error",e=>{console.error(e);const t=["エラー発生"];e instanceof Error?(e instanceof oe&&(t.push("-- エラーメッセージ --"),t.push(e.message),t.push("-- 関連オブジェクト --"),e.items.forEach(i=>t.push(JSON.stringify(i))),console.error(e.items)),t.push("-- エラー名称 --"),t.push(e.name||"エラー名称取得失敗"),t.push("-- スタックトレース --"),t.push(e.stack||"スタックトレース取得失敗")):(t.push("-- エラー型特定失敗 --"),t.push(JSON.stringify(e))),this.write("error","System",t,void 0,void 0,void 0,void 0,void 0)});u(this,"warn",e=>{this.write("warn","System",["【注意】",e],void 0,void 0,void 0,void 0,void 0)});u(this,"info",(e,t)=>{this.write("info","Others",[e],t,void 0,void 0,void 0,void 0)});u(this,"pushMoveLog",(e,t,i,r)=>{this.write("info","EntityMove",["移動"],e,t,void 0,i,r)});u(this,"write",(e,t,i,r,n,s,l,d)=>{const o=i.join(`
`);this.records.push({seq:this.nextSeq++,lvl:e,type:t,clock:this.duel.clock.getClone(),text:o,duelist:r,mainEntity:n,subEntities:s??[],from:l,to:d}),this.onUpdateEvent.trigger(this.nextSeq-1)});this.nextSeq=0,this.duel=e}get onUpdate(){return this.onUpdateEvent.expose()}get lastRecord(){return this.records.slice(-1)[0]}};const Ec=a=>new Promise(e=>setTimeout(e,a)),As=()=>{let a=()=>{},e=()=>{};return{promise:new Promise((i,r)=>{a=i,e=r}),resolve:a,reject:e}};class ar{constructor(e){u(this,"onUpdateEvent",new Je);u(this,"_state","Disable");u(this,"defaultArgs");u(this,"_args");u(this,"resolve",()=>{});u(this,"show",e=>{this._args=e,this._state="Shown",this.onUpdateEvent.trigger();const{promise:t,resolve:i}=As();return this.resolve=r=>{this._state="Disable",i(r),this.resolve=()=>{},this.onUpdateEvent.trigger()},t});u(this,"cancel",()=>{this._state!=="Disable"&&this.resolve(void 0),this.terminate()});u(this,"terminate",()=>{this._state="Disable",this._args=this.defaultArgs,this.resolve=()=>{}});this.defaultArgs=e,this._args=e}get onUpdate(){return this.onUpdateEvent.expose()}get state(){return this._state}get args(){return this._args}}class Dc{constructor(e){u(this,"onUpdateEvent",new Je);u(this,"actionSelector",new ar({title:"カード操作を選択。",activator:void 0,dummyActionInfos:[],cancelable:!1}));u(this,"entitySelector",new ar({title:"対象を選択",entitiesChoices:{selectables:[],validator:()=>!0,cancelable:!1},cancelable:!1,chainBlockInfos:[]}));u(this,"textSelector",new ar({title:"カード操作を選択。",choises:[],cancelable:!1}));u(this,"modals",[this.actionSelector,this.entitySelector,this.textSelector]);u(this,"view");u(this,"terminateAll",()=>{this.modals.forEach(e=>e.terminate()),this.onUpdateEvent.trigger()});this.view=e,this.modals.forEach(t=>t.onUpdate.append(()=>this.onUpdateEvent.trigger()))}get onUpdate(){return this.onUpdateEvent.expose()}}const mn=a=>{let e=[];do{const t=a.qty&&a.qty>0?a.qty:Math.floor(Math.random()*a.selectables.length+1);e=a.selectables.randomPickMany(t)}while(!a.validator(e));return e},Ac=[{seq:10,name:"Internet Explorer",key:"msie"},{seq:20,name:"Internet Explorer",key:"trident"},{seq:30,name:"Edge",key:"edge"},{seq:40,name:"Google Chrome",key:"chrome"},{seq:50,name:"Safari",key:"safari"},{seq:60,name:"Mozilla Firefox",key:"firefox"},{seq:70,name:"Opera",key:"opera"}],xc=[{seq:10,name:"Microsoft Windows",key:"windows nt"},{seq:20,name:"Android",key:"android"},{seq:30,name:"iOS",key:"iphone"},{seq:40,name:"iOS",key:"ipad"},{seq:50,name:"macOS",key:"mac os x"}],Ji=window.navigator.userAgent.toLowerCase();var An;const Mc=((An=Ac.find(a=>Ji.indexOf(a.key)!==-1))==null?void 0:An.name)??"Unknown Browser";var xn;const Zr=((xn=xc.find(a=>Ji.indexOf(a.key)!==-1))==null?void 0:xn.name)??"Unknown OS",xs=Ji.indexOf("iphone")!==-1||Zr==="Android"&&Ji.indexOf("mobile")!==-1,Pc=Ji.indexOf("ipad")!==-1||Zr==="Android"&&!xs,_n=xs?"Smart Phone":Pc?"Tablet Device":"PC",ga={canDragElement:_n==="PC",text:`${_n} ${Zr} ${Mc}`};class Bc{constructor(e){u(this,"onDuelUpdateEvent",new Je);u(this,"requireUpdate",()=>{this.onDuelUpdateEvent.trigger()});u(this,"onWaitStartEvent",new Je);u(this,"onWaitEndEvent",new Je);u(this,"onDragStartEvent",new Je);u(this,"onDragEndEvent",new Je);u(this,"onAnimationStartEvent",new Je);u(this,"onShowCardEntityEvent",new Je);u(this,"duel");u(this,"modalController");u(this,"_message");u(this,"waitMode");u(this,"infoBoardState");u(this,"infoBoardCell");u(this,"getCell",(e,t)=>this.duel.field.cells[e][t]);u(this,"showCardInfo",(e,t)=>{this.onShowCardEntityEvent.trigger({card:e,mode:t})});u(this,"dispose",()=>{this.onDragStartEvent.clear(),this.onDragEndEvent.clear(),this.onDuelUpdateEvent.clear(),this.onWaitStartEvent.clear(),this.onWaitEndEvent.clear()});u(this,"waitFieldAction",async e=>{if(this.duel.getTurnPlayer().duelistType==="NPC"){const n=this.duel.getTurnPlayer().selectActionForNPC(e,[]);return n?{actionInfo:n}:{phaseChange:this.duel.nextPhaseList[0]}}const t=await this._waitDuelistAction(this.duel.getTurnPlayer(),e,"Free","",void 0,void 0,!1);if(!t.actionInfo)return{...t,actionInfo:void 0};const i={...t.actionInfo},r=e.find(n=>{var s;return((s=t.actionInfo)==null?void 0:s.originSeq)===n.originSeq});if(!r)throw new oe("想定されない状態",e,t);return{...t,actionInfo:{dest:i.dest,battlePosition:i.battlePosition,action:r.action,originSeq:r.originSeq}}});u(this,"waitQuickEffect",async(e,t,i,r,n)=>{if(t.length===0)return;if(e.duelistType==="NPC")return e.selectActionForNPC(t,i);const s=[];return s.push(this.modalController.actionSelector.show({title:r,activator:e,dummyActionInfos:t,cancelable:n}).then(l=>{if(l)return t.find(d=>d.originSeq===l.originSeq)})),s.push(this._waitDuelistAction(e,t,"Modal",this.message,void 0,void 0,!1).then(l=>(this.infoBoardState="Log",t.find(d=>{var o;return((o=l.actionInfo)==null?void 0:o.originSeq)===d.originSeq})))),await Promise.any(s)});u(this,"waitSubAction",async(e,t,i,r=!1)=>{if(e.duelistType==="NPC")throw Error("Not implemented");const n=await this._waitDuelistAction(e,t,"Modal",i,void 0,void 0,r);if(n&&n.actionInfo)return n.actionInfo});u(this,"waitSelectEntities",async(e,t,i)=>{if(!t.selectables.length)return;if(t.qty&&t.selectables.length===t.qty)return[...t.selectables];if(e.duelistType==="NPC")return mn(t);let r;t.selectables.some(s=>s.entityType==="Duelist")&&(r={...t,selectables:t.selectables.filter(s=>s.entityType==="Duelist").map(s=>s.fieldCell),qty:1,validator:s=>s.length===1});const n=await this._waitDuelistAction(e,[],"Modal",i,t,r,t.cancelable);return[...n.selectedEntities??[],...(n.selectedCells??[]).flatMap(s=>s.entities).filter(s=>s.entityType==="Duelist")]});u(this,"waitSelectText",(e,t,i=!1)=>this.modalController.textSelector.show({title:t,choises:e,cancelable:i}));u(this,"waitAnimation",async e=>(this._message="",this.waitMode="Animation",this.onDuelUpdateEvent.trigger(),new Promise(t=>this.onAnimationStartEvent.trigger({...e,resolve:t}))));u(this,"setDraggingActions",e=>{this.onDragStartEvent.trigger(e),this.requireUpdate()});u(this,"removeDraggingActions",()=>{this.onDragEndEvent.trigger()});u(this,"waitSelectAction",async(e,t,i,r)=>{var d;const n=t.map(o=>xi.createDummyAction(o.entity,o.title,[],void 0,o.origin)),s=await this._waitDammyAction(e,n,i,r);if(!s)return;const l=(d=t.find(o=>o.origin.seq===s.originSeq))==null?void 0:d.origin;if(!l)throw new oe("想定されない状態",t,s);return l});u(this,"waitSelectSummonDestination",async(e,t,i,r,n)=>{const s=i.length>1&&ga.canDragElement?"カードを召喚先へドラッグ。":"表示形式を選択。";if(!i.length&&!r.length){if(n)return;throw new oe("想定されない状態",e,t,i,r,n)}let l=[...r];for(;;){const d={dest:i.randomPick(),battlePosition:l[0]};if(l.length===1&&!ga.canDragElement){const v=await this.waitSelectCell(e,i,n,"召喚先を選択。");return v?{dest:v,battlePosition:r[0]}:void 0}const o=l.map(v=>xi.createDummyAction(t,v,i,v)),c=await this._waitDammyAction(e,o,s,n);if(!c)return;if(c.battlePosition&&(l=[c.battlePosition]),!(i.length>1&&!c.dest))return d.dest=c.dest??d.dest,d.battlePosition=c.battlePosition??d.battlePosition,d}});u(this,"waitSelectDestination",async(e,t,i,r,n,s=!1)=>{if(!i.length)return;if(i.length===1)return i[0];if(!ga.canDragElement)return await this.waitSelectCell(e,i,s,r);let l=i.randomPick();const d=[xi.createDummyAction(t,n,i,void 0)],o=await this._waitDammyAction(e,d,r,s);if(o)return l=o.dest??l,l});u(this,"_waitDammyAction",async(e,t,i,r=!1)=>{if(!t.length)return;const n=t.randomPick();let s={...n,dest:n.dest??n.dests.randomPick()};if(e.duelistType!=="NPC"){const l=[this.modalController.actionSelector.show({title:i,activator:e,dummyActionInfos:t,cancelable:!1}),this.duel.view.waitSubAction(e,t,i,r)],d=await Promise.any(l);if(!d&&!r)throw new lt(d,l);if(!d)return;s=d??s}return s});u(this,"waitSelectCell",async(e,t,i,r)=>t.length?e.duelistType==="NPC"?t.randomPick():(await this.waitSelectCells(e,{selectables:t,qty:1,validator:s=>s.length===1,cancelable:i},r)??[])[0]:void 0);u(this,"waitSelectCells",async(e,t,i)=>{if(!t.selectables.length)return;if(e.duelistType==="NPC")return mn(t);const r=await this._waitDuelistAction(e,[],"Modal",i,void 0,t,t.cancelable);if((!r||!r.selectedCells)&&!t.cancelable)throw new lt(e,t,i);return r.selectedCells});u(this,"_waitDuelistAction",async(e,t,i,r,n,s,l=!1)=>{this.waitMode=i,this._message=r,this.onDuelUpdateEvent.trigger();const d=As(),o={resolve:d.resolve,activator:e,dummyActionInfos:t,chainBlockInfos:e.duel.chainBlockInfos,entitiesChoices:n,cellsChoices:s};this.onWaitStartEvent.trigger(o);const c=await d.promise;if(this.modalController.terminateAll(),this.waitMode="None",this.onWaitEndEvent.trigger(),c.surrender)throw new Ht(e.getOpponentPlayer(),`${e.profile.name}がサレンダーした。`);if(!l&&c.cancel)throw new oe("キャンセル不可のアクションがキャンセルされた。",c,t,i,n,s);return this.infoBoardState="Log",c});this.duel=e,this._message="",this.waitMode="None",this.infoBoardState="Log",this.infoBoardCell=e.duelists.Below.getExtraDeck(),this.modalController=new Dc(this)}get onDuelUpdate(){return this.onDuelUpdateEvent.expose()}get onWaitStart(){return this.onWaitStartEvent.expose()}get onWaitEnd(){return this.onWaitEndEvent.expose()}get onDragStart(){return this.onDragStartEvent.expose()}get onDragEnd(){return this.onDragEndEvent.expose()}get onAnimation(){return this.onAnimationStartEvent.expose()}get onShowCardEntity(){return this.onShowCardEntityEvent.expose()}get message(){return this._message||this.duel.log.lastRecord.text}}const kr=["turn","phaseSeq","stepSeq","stageSeq","chainSeq","chainBlockSeq","procSeq"];[...kr];class Fc{constructor(){u(this,"onClockChangeEvents",{turn:new Je,phaseSeq:new Je,stepSeq:new Je,stageSeq:new Je,chainSeq:new Je,chainBlockSeq:new Je,procSeq:new Je});u(this,"_turn",0);u(this,"_phaseSeq",0);u(this,"_stepSeq",0);u(this,"_stageSeq",0);u(this,"_chainSeq",0);u(this,"_chainBlockSeq",0);u(this,"_procSeq",0);u(this,"_totalProcSeq",0);u(this,"_periodKey");u(this,"_previousStartPoints",{turn:0,phaseSeq:0,stepSeq:0,stageSeq:0,chainSeq:0,chainBlockSeq:0,procSeq:0});u(this,"_currentStartPoints",{turn:0,phaseSeq:0,stepSeq:0,stageSeq:0,chainSeq:0,chainBlockSeq:0,procSeq:0});u(this,"setPhase",(e,t)=>{const i=Object.values(ri).filter(r=>r.phase===t).find(r=>(r.step??"start")==="start");if(!i)throw new oe("想定されない状態",this.period,t,ri);t==="draw"?(this.turn>0&&e.log.info("ターン終了。",e.getTurnPlayer()),this._turn++,this._phaseSeq=0):(e.log.info(`フェイズ移行（${this.period.name}→${i.name}）`,e.getTurnPlayer()),this._phaseSeq++),this._stepSeq=0,this._stageSeq=0,this.periodKey=i.key});u(this,"setStep",(e,t)=>{const i=this.period.phase,r=Object.values(ri).filter(n=>n.phase===i).find(n=>(n.step??"")===t);if(!r)throw new oe("想定されない状態",this.period,t,ri);this.period.name!==r.name&&(e.log.info(`ステップ移行（${this.period.name}→${r.name}）`,e.getTurnPlayer()),this._stepSeq++,this._stageSeq=0,this.periodKey=r.key)});u(this,"setStage",(e,t)=>{const i=this.period,r=Object.values(ri).filter(n=>n.phase===i.phase).filter(n=>n.step===i.step).find(n=>(n.stage??"")===t);if(!r)throw new oe("想定されない状態",this.period,t,ri);e.log.info(`タイミング移行（${this.period.name}→${r.name}）`,e.getTurnPlayer()),this._stageSeq++,this.periodKey=r.key});u(this,"incrementChainSeq",()=>{this._chainSeq++,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq()});u(this,"incrementChainBlockSeq",()=>{this._chainBlockSeq++,this._procSeq=0,this.incrementTotalProcSeq()});u(this,"incrementProcSeq",()=>{this._procSeq++,this.incrementTotalProcSeq()});u(this,"incrementTotalProcSeq",()=>{this._totalProcSeq++;let e=!1;kr.toReversed().forEach(t=>{e&&(this._previousStartPoints[t]=this.currentStartPoints[t],this._currentStartPoints[t]=this.totalProcSeq),e=this[t]===0}),kr.toReversed().filter(t=>this._currentStartPoints[t]=this.totalProcSeq).filter(t=>t!=="procSeq").forEach(t=>this.onClockChangeEvents[t].trigger(this)),this.onClockChangeEvents.procSeq.trigger(this)});u(this,"toString",()=>`${this.totalProcSeq}(t${this.turn}-phs${this.phaseSeq}-stp${this.stepSeq}-stg${this.stepSeq}-c${this.chainSeq}-cb${this.chainBlockSeq}-prc${this.procSeq})`);u(this,"getClone",()=>({turn:this.turn,phaseSeq:this.phaseSeq,stepSeq:this.stepSeq,stageSeq:this.stageSeq,chainSeq:this.chainSeq,chainBlockSeq:this.chainBlockSeq,procSeq:this.procSeq,totalProcSeq:this.totalProcSeq,period:this.period}));u(this,"isSameTurn",e=>this.turn===e.turn);u(this,"isSameChain",e=>this.turn===e.turn&&this.phaseSeq===e.phaseSeq&&this.stepSeq===e.stepSeq&&this.stageSeq===e.stageSeq&&this.chainSeq===e.chainSeq);u(this,"isPreviousChain",e=>this.turn===e.turn&&this.phaseSeq===e.phaseSeq&&this.stepSeq===e.stepSeq&&this.stageSeq===e.stageSeq&&this.chainSeq===e.chainSeq+1);u(this,"isPreviousStage",e=>this.turn===e.turn&&this.phaseSeq===e.phaseSeq&&this.stepSeq===e.stepSeq&&this.stageSeq===e.stageSeq+1);u(this,"isPreviousTurn",e=>this.turn===e.turn+1);u(this,"isPreviousProc",e=>this.totalProcSeq===e.totalProcSeq+1);u(this,"isUponAttackDeclaration",()=>this.period.step==="battle"&&this.chainSeq===1);this._periodKey="end"}get onTurnChange(){return this.onClockChangeEvents.turn.expose()}get onStageChange(){return this.onClockChangeEvents.stageSeq.expose()}get onProcSeqChange(){return this.onClockChangeEvents.procSeq.expose()}get previousStartPoints(){return this._previousStartPoints}get currentStartPoints(){return this._currentStartPoints}set periodKey(e){this._periodKey!==e&&(this._periodKey=e,this._chainSeq=0,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq())}get periodKey(){return this._periodKey}get period(){return ri[this.periodKey]}get turn(){return this._turn}get phaseSeq(){return this._phaseSeq}get stepSeq(){return this._stepSeq}get stageSeq(){return this._stageSeq}get chainSeq(){return this._chainSeq}get chainBlockSeq(){return this._chainBlockSeq}get procSeq(){return this._procSeq}get totalProcSeq(){return this._totalProcSeq}get isFirstChain(){return this.chainSeq===0}}class Oc{constructor(e){u(this,"nextSeq");u(this,"records",[]);u(this,"duel");u(this,"push",e=>{this.records.push({seq:this.nextSeq++,clock:this.duel.clock.getClone(),chainBlockInfo:e})});this.nextSeq=0,this.duel=e}}const Lc=["PlayFirst","DrawFirst","Random"],Sn={PlayFirst:"先攻",DrawFirst:"後攻",Random:"ランダム"};class Ht extends Error{constructor(t,i){super(t?`デュエルが終了した。勝者：${t.profile.name}`:"デュエルが終了した。ドロー。");u(this,"winner");u(this,"message");this.winner=t,this.message=i}}class oe extends Error{constructor(t,...i){super(t);u(this,"message");u(this,"items");this.message=t,this.items=i}}class lt extends oe{constructor(...e){super("キャンセル不可のアクションがキャンセルされた。",...e)}}class qc{constructor(e,t,i,r=[],n,s,l,d=[],o="Random"){u(this,"onDuelEndEvent",new Je);u(this,"view");u(this,"log");u(this,"chainBlockLog");u(this,"clock");u(this,"nextPhaseList");u(this,"field");u(this,"attackingMonster");u(this,"targetForAttack");u(this,"_chainBlockInfos");u(this,"duelists");u(this,"priorityHolder");u(this,"isEnded");u(this,"winner");u(this,"coin",!1);u(this,"startMode");u(this,"distributeOperators",e=>{console.info(`[totalProcSeq]:${e.totalProcSeq}`);let t=0;for(;;){if(t++,t>10)throw new oe("無限ループ発生");if(this.field.procFilterPool.distributeAll(this)&&this.field.statusOperatorPool.distributeAll(this)&&this.field.numericStateOperatorPool.distributeAll(this)&&this.field.summonFilterPool.distributeAll(this))return}});u(this,"getTurnPlayer",()=>this.clock.turn%2===0?this.secondPlayer:this.firstPlayer);u(this,"getNonTurnPlayer",()=>this.clock.turn%2===0?this.firstPlayer:this.secondPlayer);u(this,"main",async()=>{console.info("main start!"),this.coin=this.startMode==="PlayFirst"?!0:this.startMode==="DrawFirst"?!1:Math.random()>.5,this.priorityHolder=this.firstPlayer;for(const e of Object.values(this.duelists))e.pushDeck(),e.getDeckCell().shuffle(),e.initHand.length&&e.initHand.forEach(t=>{const i=e.getDeckCell().cardEntities.find(r=>r.origin.name===t);if(!i){this.log.info(`初手操作により${t}を手札に加えようとしたが、デッキに存在しない。`);return}i.addToHand(["System"],void 0,void 0),this.log.info(`初手操作により${i.toString()}を手札に加えた`,e)}),await e.draw(5-e.getHandCell().cardEntities.length,void 0,void 0);this.log.info(`【デュエル開始】${this.firstPlayer.profile.name} V.S. ${this.secondPlayer.profile.name}`),this.log.info(`先攻：${this.firstPlayer.profile.name} 後攻：${this.secondPlayer.profile.name}`),this.moveNextPhase("draw");try{for(const e of Object.values(this.duelists))for(const t of this.getEnableActions(e,["Exodia"],["Normal"],[]))await t.action.directExecute(e,void 0,!1);for(;!this.isEnded&&(this.clock.period.phase==="draw"?await this.procDrawPhase():this.phase==="standby"?await this.procStanbyPhase():this.phase==="main1"?await this.procMainPhase():this.phase==="battle1"?await this.procBattlePhase():this.phase==="battle2"?await this.procBattlePhase():this.phase==="main2"?await this.procMainPhase():this.phase==="end"&&await this.procEndPhase(),!(this.clock.turn>1e3)););}catch(e){e instanceof Ht?(this.clock.incrementChainSeq(),console.info(e),this.isEnded=!0,this.winner=e.winner,this.log.info(e.winner?`デュエル終了。勝者${e.winner.profile.name}。${e.message}`:`デュエル終了。引き分け。${e.message}`),this.onDuelEndEvent.trigger()):e instanceof Error&&this.log.error(e)}finally{this.log.dispose()}});u(this,"moveNextPhase",e=>{this.clock.setPhase(this,e),this.phase==="main2"||this.clock.turn===1?this.nextPhaseList=["end"]:this.phase==="battle1"||this.phase==="battle2"?this.nextPhaseList=["main2"]:this.phase==="main1"?this.nextPhaseList=["battle1","end"]:this.nextPhaseList=[]});u(this,"declareAnAttack",(e,t)=>{var r;this.attackingMonster=e,this.targetForAttack=t;let i=" ("+((r=t.battlePosition==="Attack"?t.atk:t.def)==null?void 0:r.toString())+")";t.face==="FaceDown"&&(i=" (????)"),t.entityType==="Duelist"&&(i=""),e.info.attackCount++,this.log.info(`攻撃宣言：${e.toString()} (${e.atk})⇒ ${t.toString()}${i}`,e.controller)});u(this,"procDrawPhase",async()=>{if(Object.values(this.duelists).forEach(e=>e.initForDrawPhase()),this.log.info("ドローフェイズ開始。",this.getTurnPlayer()),this.clock.turn===1)this.log.info("先攻プレイヤーはドローできない。",this.getTurnPlayer());else{await this.getTurnPlayer().draw(1,void 0,void 0);for(const e of this.getEnableActions(this.getTurnPlayer(),["Exodia"],["Normal"],[]))await e.action.directExecute(this.getTurnPlayer(),void 0,!1)}this.field.getCardsOnFieldStrictly().forEach(e=>e.initForTurn()),await this.procSpellSpeed1(),this.moveNextPhase("standby")});u(this,"procStanbyPhase",async()=>{await this.procSpellSpeed1(),this.moveNextPhase("main1")});u(this,"procMainPhase",async()=>{for(;;){this.priorityHolder=this.getTurnPlayer();const e=await this.view.waitFieldAction(this.getEnableActions(this.priorityHolder,["NormalSummon","SpellTrapSet","SpecialSummon","FlipSummon","ChangeBattlePosition","IgnitionEffect","QuickEffect","CardActivation"],["Normal","Quick","Counter"],[]));if(console.info("response",e),e&&e.actionInfo){if([...Po].includes(e.actionInfo.action.playType)){const i=await e.actionInfo.action.prepare(this.priorityHolder,e.actionInfo.dest,void 0,[],!0,!1);if(i===void 0)continue;await e.actionInfo.action.execute(i,this.chainBlockInfos),this.clock.incrementChainSeq()}else if(await this.procChainBlock({activator:this.priorityHolder,actionInfo:e.actionInfo},void 0)==="cancel")continue;await this.procFreeChain();continue}const t=e.phaseChange;if(t){this.priorityHolder=this.getNonTurnPlayer();let i="done";for(;;){const r=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(this.priorityHolder,["QuickEffect","TriggerEffect"],["Quick","Counter"],[]),[],"",!0);if(!r){this.moveNextPhase(t);return}if(i=await this.procChainBlock({activator:this.priorityHolder,actionInfo:r},void 0),i==="done")break}if(i==="done"){await this.procFreeChain();continue}}}});u(this,"procBattlePhase",async()=>{await this.procBattlePhaseStartStep(),await this.procBattlePhaseBattleStep(),await this.procBattlePhaseEndStep()});u(this,"procBattlePhaseStartStep",async()=>{this.clock.setStep(this,"start"),this.priorityHolder=this.getTurnPlayer(),this.attackingMonster=void 0,this.targetForAttack=void 0,await this.procSpellSpeed1()});u(this,"procBattlePhaseBattleStep",async()=>{for(;;){this.clock.setStep(this,"battle"),this.priorityHolder=this.getTurnPlayer();const e=await this.view.waitFieldAction(this.getEnableActions(this.priorityHolder,["Battle"],["Normal"],[]));if(e.phaseChange)break;if(e.actionInfo){const t=await e.actionInfo.action.prepare(this.priorityHolder,e.actionInfo.dest,void 0,[],!0,!1);if(!t)continue;await e.actionInfo.action.execute(t,[]),this.clock.incrementChainSeq();let i=!0;for(;;){const r=this.getNonTurnPlayer().getMonstersOnField().map(s=>[s.seq,s.moveLog.latestRecord.movedAt.totalProcSeq]);if(await this.procFreeChain(),!this.attackingMonster)throw new oe("想定されない状態");this.attackingMonster.isOnFieldStrictly?this.attackingMonster.face==="FaceDown"?(this.log.info(`${this.attackingMonster.toString()}が裏側守備表示になったため、戦闘が中断された。`),i=!1):this.attackingMonster.orientation==="Horizontal"&&(this.log.info(`${this.attackingMonster.toString()}が守備表示になったため、戦闘が中断された。`),i=!1):(this.log.info(`${this.attackingMonster.toString()}がフィールドにいなくなったため、戦闘が中断された。`),i=!1);const n=this.getNonTurnPlayer().getMonstersOnField().map(s=>[s.seq,s.moveLog.latestRecord.movedAt.totalProcSeq]);if(r.length!==n.length)throw this.log.info("モンスターの数が増減したためバトルステップの巻き戻しが発生。"),new oe("巻き戻し未実装");if(r.some(([s,l])=>n.every(([d,o])=>d!==s||o!==l)))throw this.log.info("モンスターの数が増減したためバトルステップの巻き戻しが発生。"),new oe("巻き戻し未実装");break}if(!i)continue;await this.procBattlePhaseDamageStep(t)}}});u(this,"procBattlePhaseDamageStep",async e=>{if(!this.attackingMonster||!this.targetForAttack)throw new oe("想定されない状態",this.attackingMonster,this.targetForAttack);if(this.targetForAttack.entityType!=="Duelist"&&!this.targetForAttack.isOnFieldAsMonsterStrictly)throw new oe("想定されない状態",this.attackingMonster,this.targetForAttack);await this.procBattlePhaseDamageStep1(),await this.procBattlePhaseDamageStep2(this.attackingMonster,this.targetForAttack),await this.procBattlePhaseDamageStep3(e,this.attackingMonster,this.targetForAttack),await this.procBattlePhaseDamageStep4(),await this.procBattlePhaseDamageStep5()});u(this,"procBattlePhaseDamageStep1",async()=>{this.clock.setStage(this,"start"),await this.procFreeChain()});u(this,"procBattlePhaseDamageStep2",async(e,t)=>{this.clock.setStage(this,"beforeDmgCalc"),(t==null?void 0:t.battlePosition)==="Set"&&t.setBattlePosition("Defense",["Flip","FlipByBattle"],e,e.controller),await this.procFreeChain()});u(this,"procBattlePhaseDamageStep3",async(e,t,i)=>{if(t.atk===void 0)throw new oe("想定されない状態",this.attackingMonster,this.targetForAttack);this.clock.setStage(this,"dmgCalc"),await this.procFreeChain();const r=t.atk,n=(i.battlePosition==="Attack"?i.atk:i.def)??0;i.entityType==="Duelist"?(e.activator.writeInfoLog(`ダメージ計算：${t.toString()} (${r}) ⇒ ${i.toString()}`),t.controller.getOpponentPlayer().battleDamage(r-n,t)):(e.activator.writeInfoLog(`ダメージ計算：${t.toString()} (${r}) ⇒ ${i.toString()} (${n})`),r>0&&r>n&&i.battlePosition==="Attack"?t.controller.getOpponentPlayer().battleDamage(r-n,t):r<n&&t.controller.battleDamage(n-r,i),r>0&&(r>n||r===n&&i.battlePosition==="Attack")&&await ve.tryMarkForDestory([i],e),i.battlePosition==="Attack"&&r<=n&&await ve.tryMarkForDestory([t],e)),t.info.battleLog.push({enemy:i,timestamp:this.clock.getClone()}),i.info.battleLog.push({enemy:t,timestamp:this.clock.getClone()});const s=Object.values(this.duelists).filter(l=>l.lp<=0);if(s.length)throw s.length===1?new Ht(s[0].getOpponentPlayer(),"戦闘ダメージによって、相手のライフポイントをゼロにした。"):new Ht(void 0,"戦闘ダメージによって、お互いのライフポイントがゼロになった。")});u(this,"procBattlePhaseDamageStep4",async()=>{this.clock.setStage(this,"afterDmgCalc"),await this.procFreeChain()});u(this,"procBattlePhaseDamageStep5",async()=>{this.clock.setStage(this,"end"),await ve.waitCorpseDisposal(this),this.clock.incrementChainSeq(),await this.procFreeChain()});u(this,"procBattlePhaseEndStep",async()=>{this.clock.setStep(this,"end"),this.priorityHolder=this.getTurnPlayer(),await this.procSpellSpeed1(),this.moveNextPhase("main2")});u(this,"procEndPhase",async()=>{for(await this.procSpellSpeed1();;){const t=this.getTurnPlayer().getHandCell().cardEntities.length;if(t<7)break;await this.getTurnPlayer().discard(t-6,["Rule"])}this.moveNextPhase("draw")});u(this,"procSpellSpeed1",async()=>{this.priorityHolder=this.getTurnPlayer();let e=0;const t={Above:Number.MAX_VALUE,Below:Number.MAX_VALUE};for(;Object.values(t).some(i=>i!==0);){const i=this.getEnableActions(this.priorityHolder,["IgnitionEffect","QuickEffect","CardActivation","LingeringEffect"],["Normal","Quick","Counter"],[]);t[this.priorityHolder.seat]=i.filter(l=>l.action.isMandatory).length;const r=i.find(l=>l.action.isMandatory);let n=r?{action:r.action,originSeq:r.action.seq}:void 0,s=!n;if(this.priorityHolder.isTurnPlayer?e===0&&(s=!0):t[this.priorityHolder.getOpponentPlayer().seat]>=0&&(s=!0),i.length&&(i.length>1||!n)&&(n=await this.view.waitQuickEffect(this.priorityHolder,i,[],s?"":"まだ発動しなければならない効果が残っている。",s)),n){if(Nr.some(l=>l===n.action.playType))await this.procChainBlock({activator:this.priorityHolder,actionInfo:n},void 0);else{const l=await n.action.prepare(this.priorityHolder,void 0,void 0,[],!0,!1);if(!l)continue;await n.action.execute(l,[]),await n.action.settle(l,[]),this.clock.incrementChainSeq()}await this.procFreeChain(),this.priorityHolder=this.getTurnPlayer(),e=0;continue}this.priorityHolder=this.priorityHolder.getOpponentPlayer(),e++}});u(this,"procFreeChain",async()=>{for(;await this.procChainBlock(void 0,void 0)!=="pass";);});u(this,"procChainBlock",async(e,t)=>{const i=this.chainBlockInfos.length===0;let r=e?[]:t??Object.values(this.duelists).flatMap(s=>this.getEnableActions(s,["TriggerEffect"],[this.chainBlockInfos.length?"Quick":"Normal"],this.chainBlockInfos).map(l=>({activator:s,actionInfo:l,targetChainBlock:this.chainBlockInfos.slice(-1)[0]}))),n;if(e)n={activator:e.activator,action:e.actionInfo.action,dest:e.actionInfo.dest,targetChainBlock:void 0},this.priorityHolder=n.activator;else if(r.length>0){const s=await this.selectTriggerEffect(r);s?(r=r.filter(l=>l!==s),n={...s,action:s.actionInfo.action},this.priorityHolder=n.activator):r=[]}if(!n){let s=0;for(;s<2;){this.priorityHolder=this.priorityHolder.getOpponentPlayer();const l=["Counter"];this.chainBlockInfos.every(c=>c.action.spellSpeed!=="Counter")&&l.push("Quick");const d=this.chainBlockInfos.length?"※メッセージ考え中※":"クイックエフェクト発動タイミング。効果を発動しますか？",o=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(this.priorityHolder,["QuickEffect","CardActivation"],l,this.chainBlockInfos),this.chainBlockInfos,d,!0);if(o){n={...o,activator:this.priorityHolder,targetChainBlock:this.chainBlockInfos.slice(-1)[0]};break}s++}}if(console.info("selected action: ",n),n){const s=n.activator,l=await n.action.prepare(s,n.dest,n.targetChainBlock,this.chainBlockInfos,i,!1);if(!l)return"cancel";this.chainBlockLog.push(l);const d=[...l.action.entity.info.isEffectiveIn];if(this._chainBlockInfos.push(l),this.clock.incrementProcSeq(),this.clock.incrementChainBlockSeq(),r=r.filter(o=>o.actionInfo.action.seq!==(n==null?void 0:n.action.seq)).filter(o=>o.actionInfo.action.validateCount(o.activator,this.chainBlockInfos)),await this.procChainBlock(void 0,r.length?r:void 0),l.chainNumber&&this.log.info(`チェーン${l.chainNumber}: ${l.action.toString()}の効果処理。`,s),l.isNegatedActivationBy)l.chainNumber&&this.log.info(`チェーン${l.chainNumber}: ${l.action.toString()}を${l.isNegatedActivationBy.toString()}によって発動を無効にした。`,l.activator);else{let o=l.action.entity.isEffective,c="";if(o){if(l.isNegatedEffectBy)c=`チェーン${l.chainNumber}: ${l.action.toString()}を${l.isNegatedEffectBy.toString()}によって効果を無効にした。`,o=!1;else if(!d.includes(l.isActivatedIn.cellType)){const v=l.action.entity.moveLog.records.findLast(p=>p.face==="FaceDown"&&p.orientation==="Horizontal");o=(v&&this.clock.isSameChain(v.movedAt))??!1}}if(o?(await l.action.execute(l,this.chainBlockInfos),l.state="done"):(l.state="failed",l.chainNumber&&(c=c||`チェーン${l.chainNumber}: カードの効果が無効となっているため${l.action.toString()}の効果処理を行えない。`),this.log.info(c,l.activator)),await n.action.settle(l,this.chainBlockInfos),l.state==="done")for(const v of[this.getTurnPlayer(),this.getNonTurnPlayer()]){for(const p of this.getEnableActions(v,["Exodia"],["Normal"],[l]))await p.action.directExecute(v,l,!1);for(const p of this.getEnableActions(v,["AfterChainBlock"],["Normal"],[l])){await p.action.directExecute(v,l,!1);for(const h of this.getEnableActions(v,["Exodia"],["Normal"],[l]))await h.action.directExecute(v,l,!1)}}}i?(await ve.sendManyToGraveyardForTheSameReason(this._chainBlockInfos.filter(o=>o.action.playType==="CardActivation").filter(o=>!o.action.isLikeContinuousSpell).map(o=>o.action.entity).filter(o=>o.isOnFieldStrictly).filter(o=>o.face==="FaceUp"),["Rule"],void 0,void 0),this._chainBlockInfos.reset(),l.nextActionInfo&&await this.procChainBlock({activator:l.activator,actionInfo:l.nextActionInfo},void 0),this.clock.incrementChainSeq()):(l.nextActionInfo&&await l.nextActionInfo.action.directExecute(l.activator,void 0,!1),this.clock.incrementChainBlockSeq())}return n?"done":"pass"});u(this,"selectTriggerEffect",async e=>{if(e.length>0)for(const t of[!0,!1])for(const i of[this.getTurnPlayer(),this.getNonTurnPlayer()]){const r=e.filter(s=>s.actionInfo.action.isMandatory===t&&s.activator===i);if(r.length===0)continue;if(r.length===1&&t)return r[0];const n=await this.view.waitQuickEffect(i,r.map(s=>s.actionInfo),this.chainBlockInfos,"トリガーエフェクトを選択。",!t);if(n)return r.find(s=>s.actionInfo.action===n.action)}});u(this,"executeSystemPeriodActions",()=>{Object.values(this.duelists).flatMap(e=>this.getEnableActions(e,["SystemPeriodAction"],["Normal"],[]).map(t=>({duelist:e,action:t})))});u(this,"getEnableActions",(e,t,i,r)=>{var s;const n=((s=r.slice(-1)[0])==null?void 0:s.nextChainBlockFilter)??(()=>!0);return[...this.field.getAllCardEntities(),e.entity].flatMap(l=>l.actions).filter(l=>l.executableCells.includes(l.entity.fieldCell.cellType)).filter(l=>l.executablePeriods.includes(this.clock.period.key)).filter(l=>i.includes(l.spellSpeed)).filter(l=>l.validateDuelist(e)).filter(l=>t.includes(l.playType)).filter(l=>n(e,l)).map(l=>l.validate(e,r,!1)).filter(l=>l!==void 0)});this.clock=new Fc,this.nextPhaseList=[],this.isEnded=!1,this.startMode=o,this.duelists={Below:new vi(this,"Below",e,t,i,r),Above:new vi(this,"Above",n,s,l,d)},this.priorityHolder=this.firstPlayer,this._chainBlockInfos=[],this.field=new Xo(this),this.clock.onProcSeqChange.append(this.distributeOperators),this.clock.onStageChange.append(this.executeSystemPeriodActions),this.view=new Bc(this),this.log=new bc(this),this.chainBlockLog=new Oc(this)}get onDuelEnd(){return this.onDuelEndEvent.expose()}get phase(){return this.clock.period.phase}get step(){return this.clock.period.step}get stage(){return this.clock.period.stage}get chainBlockInfos(){return this._chainBlockInfos}get firstPlayer(){return this.coin?this.duelists.Below:this.duelists.Above}get secondPlayer(){return this.coin?this.duelists.Above:this.duelists.Below}}const Nc=()=>{const a=[];["サイバー・ドラゴン","六武衆のご隠居","アンノウン・シンクロン"].forEach(c=>a.push({name:c,actions:[Ue,fe,ye,ke,{title:"特殊召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:c==="アンノウン・シンクロン"?1:void 0,validate:v=>{const p=v.action.entity.field.getMonstersOnFieldStrictly();if(!(p.length==0||p.some(h=>h.controller===v.activator)))return Sr(v,["Attack","Defense"],[])},prepare:v=>yi(v,"SpecialSummon",["SpecialSummon","Rule"],Ye),execute:mi,settle:async()=>!0}]}));const e={name:"ジャンク・フォアード",actions:[Ue,fe,ye,ke,{title:"特殊召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:c=>{if(!c.activator.getMonstersOnField().length)return Sr(c,Ye,[])},prepare:c=>yi(c,"SpecialSummon",["SpecialSummon","Rule"],Ye),execute:mi,settle:async()=>!0}]};a.push(e);const t={name:"Ｄ－ＨＥＲＯ ディアボリックガイ",actions:[Ue,fe,ye,ke,{title:"①リクルート",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:10,canPayCosts:ca,validate:c=>c.activator.getDeckCell().cardEntities.filter(p=>p.nm==="Ｄ－ＨＥＲＯ ディアボリックガイ").length===0?void 0:c.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:Wa,prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async c=>{const v=c.activator.getDeckCell().cardEntities.find(p=>p.nm==="Ｄ－ＨＥＲＯ ディアボリックガイ");return v?cc(c,[v]):!1},settle:async()=>!0}]};a.push(t);const i={name:"ゾンビキャリア",actions:[Ue,fe,ye,ke,{title:"①自己再生",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],canPayCosts:c=>c.activator.getHandCell().cardEntities.length>0,validate:c=>c.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:async(c,v,p)=>{const h=c.activator.getHandCell().cardEntities,m=await c.activator.waitSelectEntity(h,"デッキトップに戻すカードを一枚選択。",p);if(!m)throw new lt(c);return await m.returnToDeck("Top",["Cost"],c.action.entity,c.activator),{returnToDeck:[m]}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:async c=>(c.action.entity.info.willBeBanished=await ui(c),c.action.entity.info.willBeBanished),settle:async()=>!0}]};a.push(i);const r={name:"グローアップ・バルブ",actions:[Ue,fe,ye,ke,{title:"①自己再生",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:1,canPayCosts:c=>c.activator.getDeckCell().cardEntities.length>0,validate:c=>c.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:async c=>{const v=c.activator.getDeckCell().cardEntities[0];return await c.activator.getDeckCell().cardEntities[0].sendToGraveyard(["Cost"],c.action.entity,c.activator),{sendToGraveyard:[v]}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:c=>ui(c),settle:async()=>!0}]};a.push(r);const n={name:"終末の騎士",actions:[Ue,fe,ye,ke,{title:"①墓地送り",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...qe,...Ie],executableDuelistTypes:["Controller"],validate:c=>{if(c.action.entity.hasBeenSummonedNow(["NormalSummon","SpecialSummon","FlipSummon"])&&c.activator.getDeckCell().cardEntities.filter(v=>v.attr.includes("Dark")).length!==0)return[]},prepare:async c=>{const v=["SendToGraveyardFromDeck"];return c.action.entity.moveLog.latestRecord.movedAs.includes("NormalSummon")?v.push("IfNormarlSummonSucceed"):v.push("IfSpecialSummonSucceed"),{selectedEntities:[],chainBlockTags:v,prepared:void 0}},execute:async c=>{const v=c.activator.getDeckCell().cardEntities.filter(p=>p.attr.includes("Dark"));return v.length===0?!1:(await c.action.entity.field.sendToGraveyard("墓地に送るモンスターを選択",c.activator,v,1,p=>p.length===1,["Effect"],c.action.entity,!1),c.activator.getDeckCell().shuffle(),!0)},settle:async()=>!0}]};a.push(n);const s={name:"マスマティシャン",actions:[Ue,fe,ye,ke,{title:"①墓地送り",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...qe,...Ie],executableDuelistTypes:["Controller"],validate:c=>{if(c.action.entity.hasBeenSummonedNow(["NormalSummon"])&&c.activator.getDeckCell().cardEntities.find(v=>(v.lvl??5)<5))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["IfNormarlSummonSucceed","SendToGraveyardFromDeck"],prepared:void 0}),execute:async c=>{const v=c.activator.getDeckCell().cardEntities.filter(p=>(p.lvl??5)<5);return v.length===0?!1:(await c.action.entity.field.sendToGraveyard("墓地に送るモンスターを選択",c.activator,v,1,p=>p.length===1,["Effect"],c.action.entity,!1),c.activator.getDeckCell().shuffle(),!0)},settle:async()=>!0},{title:"②ドロー",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...qe,...Ie],executableDuelistTypes:["Controller"],validate:c=>{if(c.action.entity.face!=="FaceDown"&&c.action.entity.moveLog.latestRecord.movedAs.includes("BattleDestroy")&&c.action.entity.wasMovedAtPreviousChain&&c.activator.getDeckCell().cardEntities.length!==0)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async c=>(await c.activator.draw(1,c.action.entity,c.activator),!0),settle:async()=>!0}]};a.push(s);const l={name:"ライトロード・ビースト ウォルフ",actions:[fe,ye,ke,{title:"①自己再生",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...qe,...Ie],executableDuelistTypes:["Controller"],validate:c=>{if(!c.action.entity.wasMovedAtPreviousChain||c.action.entity.wasMovedFrom.cellType!=="Deck")return;const v=c.activator.getMonsterZones();return c.activator.getEnableSummonList(c.activator,"SpecialSummon",["Effect"],c.action,[{monster:c.action.entity,posList:Ye,cells:v}],[],!1).length?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:c=>ui(c),settle:async()=>!0}]};a.push(l);const d={name:"伝説の白石",actions:[fe,ye,ke,Ue,{title:"①サーチ",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:Rt,executableDuelistTypes:["Controller"],validate:c=>{if(c.action.entity.wasMovedAtPreviousChain&&c.action.entity.wasMovedFrom.cellType!=="Banished")return c.activator.getDeckCell().cardEntities.find(v=>v.nm==="青眼の白龍")?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async c=>{const v=c.activator.getDeckCell().cardEntities.find(p=>p.nm==="青眼の白龍");return v?(await v.addToHand(["Effect"],c.action.entity,c.activator),c.activator.getDeckCell().shuffle(),!0):!1},settle:async()=>!0}]};return a.push(d),[{name:"灰流うらら",chainBlockTags:["Draw","SearchFromDeck","SendToGraveyardFromDeck","SpecialSummonFromDeck"]},{name:"屋敷わらし",chainBlockTags:["BanishFromGraveyard","SpecialSummonFromGraveyard","AddToHandFromGraveyard"]}].forEach(c=>{a.push({name:c.name,actions:[fe,ye,ke,Ue,{title:"①無効化",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:["Hand"],executablePeriods:qe,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,negatePreviousBlock:!0,canPayCosts:v=>v.activator.canDiscard([v.action.entity]),validate:(v,p)=>p.length===0?void 0:p[v.index-1].chainBlockTags.union(c.chainBlockTags).length>0?[]:void 0,payCosts:async v=>(await v.action.entity.discard(["Cost"],v.action.entity,v.activator),{sendToGraveyard:[v.action.entity]}),prepare:async()=>({selectedEntities:[],chainBlockTags:["NegateCardEffect"],prepared:void 0}),execute:async(v,p)=>{const h=p[v.index-1];return h.isNegatedEffectBy=v.action,!0},settle:async()=>!0}]})}),["翻弄するエルフの剣士","ロードランナー","氷結界の修験者"].forEach(c=>{a.push({name:c,actions:[fe,ye,ke,Ue],continuousEffects:[Vo("①戦闘破壊耐性","Monster",v=>[v],()=>!0,v=>[new Da("①戦闘破壊耐性",()=>!0,!0,v,{},()=>!0,["BattleDestroy"],(p,h)=>!v.isEffective||(h.atk??0)<1900?!0:(v.duel.log.info(`${v.toString()}は攻撃力1900以上のモンスターとの先頭では破壊されない。`,v.controller),!1))])]})}),a},Rc=a=>{if(a.action.entity.status.spellCategory==="Field")return[a.activator.getFieldZone()];const e=a.activator.getAvailableSpellTrapZones();return e.length>0?e:void 0},Te={title:"セット",playType:"SpellTrapSet",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isMandatory:!1,validate:Rc,prepare:nt,execute:async()=>!0,settle:async()=>!0},xe=a=>{var t;if(a.action.entity.info.isPending||a.action.entity.info.isDying||a.action.entity.info.isSettingSickness)return;if(pi.some(i=>i===a.action.entity.fieldCell.cellType))return a.action.entity.face==="FaceDown"?[]:void 0;if(a.action.spellSpeed==="Normal"&&!a.activator.isTurnPlayer||a.action.entity.fieldCell.cellType==="Hand"&&!a.activator.isTurnPlayer)return;if(a.action.entity.status.spellCategory==="Field")return[a.activator.getFieldZone()];let e=a.activator.getAvailableSpellTrapZones();return(t=a.action.entity.status.monsterCategories)!=null&&t.includes("Pendulum")&&(e=e.filter(i=>i.isAvailableForPendulum)),e.length>0?e:void 0},Ms={title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:xe,prepare:nt,execute:async()=>!0,settle:async()=>!0},Hc=(a,e,t=()=>!0)=>a.action.entity.field.getMonstersOnFieldStrictly().filter(r=>r.face==="FaceUp").filter(r=>r.canBeTargetOfEffect(a)).filter(r=>t(r,a.action.entity)).length?xe(a):void 0,$c=async(a,e,t,i,r,n=()=>!0)=>{const s=a.action.entity.field.getMonstersOnFieldStrictly().filter(d=>d.face==="FaceUp").filter(d=>d.canBeTargetOfEffect(a)).filter(d=>n(d,a.action.entity)),l=await a.activator.waitSelectEntity(s,"装備対象モンスターを選択",t);if(l)return a.action.entity.info.equipedBy=l,a.action.entity.info.effectTargets[a.action.seq]=[l],{chainBlockTags:i??[],selectedEntities:[l],prepared:r}},Ps=async(a,e,t=()=>!0)=>{const i=a.selectedEntities[0];return a.action.entity.info.equipedBy=i,a.action.entity.info.effectTargets[a.action.seq]=[i],t(i,a.action.entity)?(a.action.entity.info.equipedBy=i,a.action.entity.info.validateEquipOwner=t,i.info.equipEntities.push(a.action.entity),!0):(await a.action.entity.ruleDestory(),a.activator.writeInfoLog(`${i.toString()}が装備条件を満たさなくなったため、${a.action.entity.toString()}は破壊された。`),!1)},Pi=(a=()=>!0)=>({title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:(e,t)=>Hc(e,t,a),prepare:(e,t,i)=>$c(e,t,i,[],void 0,a),execute:Ps,settle:async()=>!0}),Zc=()=>{const a=[],e={name:"おろかな埋葬",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:o=>{if(o.activator.getDeckCell().cardEntities.filter(c=>c.status.kind==="Monster").length!==0)return xe(o)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SendToGraveyardFromDeck"],prepared:void 0}),execute:async o=>{const c=o.activator.getDeckCell().cardEntities.filter(p=>p.status.kind==="Monster");if(c.length===0)return!1;const v=await o.activator.waitSelectEntity(c,"墓地に送るモンスターを選択",!1);if(!v)throw new lt(o);return await v.sendToGraveyard(["Effect"],o.action.entity,o.activator),await o.activator.getDeckCell().shuffle(),!0},settle:async()=>!0},Te]};a.push(e);const t={name:"おろかな副葬",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,priorityForNPC:40,validate:o=>{if(o.activator.getDeckCell().cardEntities.filter(c=>c.status.kind!=="Monster").length!==0)return xe(o)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SendToGraveyardFromDeck"],prepared:void 0}),execute:async o=>{const c=o.activator.getDeckCell().cardEntities.filter(p=>p.status.kind!=="Monster");if(c.length===0)return!1;const v=await o.activator.waitSelectEntity(c,"墓地に送る魔法罠を選択",!1);if(!v)throw new lt(o);return await v.sendToGraveyard(["Effect"],o.action.entity,o.activator),!0},settle:async()=>!0},Te]};a.push(t);const i={name:"死者蘇生",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:o=>{const c=o.activator.getMonsterZones();if(o.activator.getEnableSummonList(o.activator,"SpecialSummon",["Effect"],o.action,o.activator.duel.field.getCells("Graveyard").flatMap(p=>p.cardEntities).filter(p=>p.status.kind==="Monster").filter(p=>p.canBeTargetOfEffect(o)).map(p=>({monster:p,posList:Ye,cells:c})),[],!1).length)return xe(o)},prepare:o=>hi(o,o.activator.duel.field.getCells("Graveyard").flatMap(c=>c.cardEntities).filter(c=>c.status.kind==="Monster").filter(c=>c.canBeTargetOfEffect(o))),execute:async o=>gi(o),settle:async()=>!0},Te]};a.push(i),[{name:"大嵐",cellTypes:pi,isOnlyEnemies:!1},{name:"ハーピィの羽根帚",cellTypes:pi,isOnlyEnemies:!0},{name:"ブラック・ホール",cellTypes:yt,isOnlyEnemies:!1},{name:"サンダー・ボルト",cellTypes:yt,isOnlyEnemies:!0}].forEach(o=>{a.push({name:o.name,actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:c=>{let v=c.action.entity.field.getCells(...o.cellTypes).flatMap(p=>p.cardEntities).filter(p=>p!==c.action.entity);if(o.isOnlyEnemies&&(v=v.filter(p=>p.controller!==c.activator)),!!v.length)return xe(c)},prepare:async c=>{let v=c.action.entity.field.getCells(...o.cellTypes).flatMap(p=>p.cardEntities).filter(p=>p!==c.action.entity);return o.isOnlyEnemies&&(v=v.filter(p=>p.controller!==c.activator)),{selectedEntities:[],chainBlockTags:c.action.calcChainBlockTagsForDestroy(v),prepared:void 0}},execute:async c=>{let v=c.action.entity.field.getCells(...o.cellTypes).flatMap(p=>p.cardEntities).filter(p=>p!==c.action.entity);return o.isOnlyEnemies&&(v=v.filter(p=>p.controller!==c.activator)),await ve.tryDestroy(v,c),!0},settle:async()=>!0},Te]})});const r={name:"ハリケーン",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:o=>{if(o.action.entity.field.getCells("SpellAndTrapZone","FieldSpellZone").flatMap(v=>v.cardEntities).filter(v=>v!==o.action.entity).length)return xe(o)},prepare:async()=>({selectedEntities:[],chainBlockTags:["BounceToHand"],prepared:void 0}),execute:async(o,c)=>{const v=c.map(h=>h.action).filter(h=>h.playType==="CardActivation").map(h=>h.entity).filter(h=>h.isOnFieldStrictly).filter(h=>h.face==="FaceUp").filter(h=>!h.isLikeContinuousSpell),p=o.action.entity.field.getCells("SpellAndTrapZone","FieldSpellZone").flatMap(h=>h.cardEntities).filter(h=>!v.includes(h));return await ve.returnManyToHandForTheSameReason(p,["Effect"],o.action.entity,o.activator),!0},settle:async()=>!0},Te]};a.push(r);const n={name:"光の援軍",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,canPayCosts:o=>o.activator.getDeckCell().cardEntities.length>3,validate:o=>{if(o.activator.getDeckCell().cardEntities.filter(c=>c.status.kind==="Monster").filter(c=>(c.lvl??13)<5).filter(c=>c.status.nameTags&&c.status.nameTags.includes("ライトロード")).length!==0)return xe(o)},payCosts:async o=>{const c=o.activator.getDeckCell().cardEntities.slice(0,3);return await ve.sendManyToGraveyardForTheSameReason(c,["Cost"],o.action.entity,o.activator),{sendToGraveyard:c}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async o=>{const c=o.activator.getDeckCell().cardEntities.filter(p=>p.status.kind==="Monster").filter(p=>(p.lvl??13)<5).filter(p=>p.status.nameTags&&p.status.nameTags.includes("ライトロード"));if(c.length===0)return!1;const v=await o.activator.waitSelectEntity(c,"手札に加えるモンスターを選択",!1);if(!v)throw new lt(o);return await v.addToHand(["Effect"],o.action.entity,o.activator),!0},settle:async()=>!0},Te]};a.push(n);const s={name:"調律",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:o=>{const c=o.activator.getDeckCell().cardEntities;if(!(c.length<2)&&c.filter(v=>{var p;return(p=v.status.nameTags)==null?void 0:p.includes("シンクロン")}).filter(v=>{var p;return(p=v.status.monsterCategories)==null?void 0:p.includes("Tuner")}).length!==0)return xe(o)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck","SendToGraveyardFromDeck"],prepared:void 0}),execute:async o=>{const c=o.activator.getDeckCell().cardEntities;if(c.length<2)return;const v=c.filter(h=>{var m;return(m=h.status.nameTags)==null?void 0:m.includes("シンクロン")}).filter(h=>{var m;return(m=h.status.monsterCategories)==null?void 0:m.includes("Tuner")});if(v.length===0)return!1;const p=await o.activator.waitSelectEntity(v,"手札に加えるモンスターを選択",!1);if(!p)throw new lt(o);return await p.addToHand(["Effect"],o.action.entity,o.activator),o.activator.getDeckCell().shuffle(),o.activator.duel.clock.incrementProcSeq(),await o.activator.getDeckCell().cardEntities[0].sendToGraveyard(["Effect"],o.action.entity,o.activator),!0},settle:async()=>!0},Te]};a.push(s);const l={name:"ワン・フォー・ワン",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,canPayCosts:o=>{if(o.activator.getDeckCell().cardEntities.every(c=>(c.lvl??12)>1)){if(o.activator.getHandCell().cardEntities.every(c=>(c.lvl??12)>1)||o.activator.getHandCell().cardEntities.filter(c=>c.status.kind==="Monster").length<2)return!1}else if(o.activator.getHandCell().cardEntities.filter(c=>c.status.kind==="Monster").length===0)return!1;return!0},validate:o=>{let c=[...o.activator.getDeckCell().cardEntities.filter(m=>(m.lvl??12)===1),...o.activator.getHandCell().cardEntities.filter(m=>(m.lvl??12)===1)];const v=o.activator.getHandCell().cardEntities;(v.length<2||!o.ignoreCost)&&(c=c.filter(m=>!v.includes(m)));const p=o.activator.getMonsterZones();if(o.activator.getEnableSummonList(o.activator,"SpecialSummon",["Effect"],o.action,c.map(m=>({monster:m,posList:Ye,cells:p})),[],!1).length)return xe(o)},payCosts:async(o,c,v)=>{const p=[...o.activator.getDeckCell().cardEntities.filter(T=>(T.lvl??12)===1),...o.activator.getHandCell().cardEntities.filter(T=>(T.lvl??12)===1)],h=o.activator.getMonsterZones(),m=o.activator.getEnableSummonList(o.activator,"SpecialSummon",["Effect"],o.action,p.map(T=>({monster:T,posList:Ye,cells:h})),[],!1);let C=o.activator.getHandCell().cardEntities.filter(T=>T.status.kind==="Monster");m.length===1&&(C=C.filter(T=>!m.map(w=>w.monster).includes(T)));const y=await o.activator.waitSelectEntity(C,"墓地へ送るモンスターを選択",v);if(!y)throw new lt(o);return await y.sendToGraveyard(["Cost"],o.action.entity,o.activator),{sendToGraveyard:[y]}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async o=>{const c=[...o.activator.getDeckCell().cardEntities.filter(h=>h.lvl===1),...o.activator.getHandCell().cardEntities.filter(h=>h.lvl===1)],v=o.activator.getMonsterZones();return!!await o.activator.summonOne(o.activator,"SpecialSummon",["Effect"],o.action,c.map(h=>({monster:h,posList:Ye,cells:v})),[],!1,!1)},settle:async()=>!0},Te]};a.push(l);const d={name:"封印の黄金櫃",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:o=>{if(!o.activator.getDeckCell().cardEntities.every(c=>!o.activator.canTryBanish(c,"BanishAsEffect",o.action)))return xe(o)},prepare:async()=>({selectedEntities:[],chainBlockTags:["BanishFromDeck"],prepared:void 0}),execute:async o=>{const c=o.activator.getDeckCell().cardEntities.filter(h=>o.activator.canTryBanish(h,"BanishAsEffect",o.action)),v=await o.activator.waitSelectEntity(c,"除外するカードを選択。",!1);if(!v)throw new lt(o);return(await ve.tryBanish("BanishAsEffect",[v],o)).forEach(h=>h.counterHolder.removeAll("GoldSarcophagus")),!0},settle:async()=>!0},uc("回収カウント進行",["stanby"],o=>{o.activator.isTurnPlayer&&o.action.entity.field.getCells("Banished").flatMap(c=>c.cardEntities).filter(c=>c.moveLog.latestRecord.movedBy===o.action.entity).filter(c=>c.moveLog.latestRecord.actionOwner===o.activator).forEach(c=>{c.counterHolder.add("GoldSarcophagus",1,o.action.entity);const v=c.counterHolder.getQty("GoldSarcophagus",o.action.entity);v<3&&o.activator.duel.log.info(`${c.toString()}のターンカウント：${v-1}⇒${v}`)})}),{title:"回収",isMandatory:!0,playType:"LingeringEffect",spellSpeed:"Normal",executableCells:Mi,executablePeriods:["stanby"],executableDuelistTypes:["Controller","Opponent"],validate:o=>{if(o.activator.isTurnPlayer)return o.action.entity.field.getCells("Banished").flatMap(c=>c.cardEntities).filter(c=>c.moveLog.latestRecord.movedBy===o.action.entity).filter(c=>c.moveLog.latestRecord.actionOwner===o.activator).some(c=>c.counterHolder.getQty("GoldSarcophagus")===2)?[]:void 0},prepare:nt,execute:async o=>{const c=o.action.entity.field.getCells("Banished").flatMap(p=>p.cardEntities).filter(p=>p.moveLog.latestRecord.movedBy===o.action.entity).filter(p=>p.moveLog.latestRecord.actionOwner===o.activator).filter(p=>p.counterHolder.getQty("GoldSarcophagus")===2);if(!c.length)throw new oe("想定されない状態",o);let v=c[0];if(c.length>1){const p=await o.activator.waitSelectEntity(c,"回収するカードを選択。",!1);if(!p)throw new lt(o);v=p}return await v.addToHand(["Effect"],o.action.entity,o.activator),!0},settle:async()=>!0},Te]};return a.push(d),a},Uc=(a,e,t,i,r)=>({title:"①リクルート",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:r,executablePeriods:i.includes("EffectDestroy")?[...qe,...Ie]:["b1DEnd","b2DEnd"],executableDuelistTypes:["Controller"],validate:n=>{if(!n.action.entity.wasMovedAtPreviousChain)return;const s=n.activator.getMonsterZones();if(n.activator.getEnableSummonList(n.activator,"SpecialSummon",["Effect"],n.action,n.activator.getDeckCell().cardEntities.filter(a).filter(d=>d.status.kind==="Monster").filter(d=>d.canBeTargetOfEffect(n)).map(d=>({monster:d,posList:t,cells:s})),[],!1).length)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async n=>{const s=n.activator.getDeckCell().cardEntities.filter(a),l=n.activator.getMonsterZones();return!!n.activator.summonMany(n.activator,"SpecialSummon",["Effect"],n.action,s.map(o=>({monster:o,posList:t,cells:l})),[],!1,e.length>1?void 0:e[0],o=>e.includes(o.length),!1)},settle:async()=>!0}),Gc=()=>{const a=[];return[{name:"キラー・ポテト",filter:e=>e.attr.includes("Dark")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["EffectDestroy"],executableCells:["Graveyard"]},{name:"キラー・トマト",filter:e=>e.attr.includes("Dark")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"巨大ネズミ",filter:e=>e.attr.includes("Earth")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"グリズリーマザー",filter:e=>e.attr.includes("Water")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"シャインエンジェル",filter:e=>e.attr.includes("Light")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ドラゴンフライ",filter:e=>e.attr.includes("Wind")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ＵＦＯタートル",filter:e=>e.attr.includes("Fire")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"荒野の女戦士",filter:e=>e.attr.includes("Earth")&&e.types.includes("Warrior")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"リトル・トルーパー",filter:e=>e.types.includes("Warrior")&&(e.lvl??9999)<3,qtyList:[1],posList:["Set"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard","Banished"]},{name:"破面竜",filter:e=>e.types.includes("Warrior")&&(e.def??9999)<=1500,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"共鳴虫",filter:e=>e.types.includes("Insect")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ピラミッド・タートル",filter:e=>e.types.includes("Zombie")&&(e.def??9999)<=2e3,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ユーフォロイド",filter:e=>e.types.includes("Machine")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ヘル・セキュリティ",filter:e=>e.types.includes("Fiend")&&(e.lvl??9999)===1,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ガスタ・イグル",filter:e=>(e.status.nameTags??[]).includes("ガスタ")&&(e.status.monsterCategories??[]).includes("Tuner"),qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"幻影の魔術士",filter:e=>(e.status.nameTags??[]).includes("ＨＥＲＯ")&&(e.atk??9999)<=1e3,qtyList:[1],posList:["Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ジェネクス・サーチャー",filter:e=>(e.status.nameTags??[]).includes("ジェネクス")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"紫炎の足軽",filter:e=>(e.status.nameTags??[]).includes("六武衆")&&(e.lvl??12)<=3,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"スレイブ・エイプ",filter:e=>(e.status.nameTags??[]).includes("剣闘獣")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ゼンマイハニー",filter:e=>(e.status.nameTags??[]).includes("ゼンマイ")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ＸＸ－セイバー エマーズブレイド",filter:e=>(e.status.nameTags??[]).includes("Ｘ－セイバー")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"軍隊竜",filter:e=>e.nm==="軍隊竜",qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"アサルト・ガンドッグ",filter:e=>e.nm==="アサルト・ガンドッグ",qtyList:[1,2,3,4,5],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ハイエナ",filter:e=>e.nm==="ハイエナ",qtyList:[1,2,3,4,5],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]}].forEach(e=>{a.push({name:e.name,actions:[Uc(e.filter,e.qtyList,e.posList,e.destoryTypes,e.executableCells),fe,ye,ke,Ue]})}),a},jc=a=>({title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:e=>{if(e.activator.getDeckCell().cardEntities.filter(a).length!==0&&e.activator.canDraw)return xe(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(a);if(!t.length)return!1;const i=await e.activator.waitSelectEntity(t,"手札に加えるカードを選択",!1);return i?(await i.addToHand(["Effect"],e.action.entity,e.activator),e.activator.getDeckCell().shuffle(),!0):!1},settle:async()=>!0}),Vc=(a,e)=>({title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,priorityForNPC:40,validate:t=>{if(!(t.activator.getGraveyard().cardEntities.filter(a).length<e))return xe(t)},prepare:async()=>({selectedEntities:[],chainBlockTags:["AddToHandFromGraveyard"],prepared:void 0}),execute:async t=>{const i=t.activator.getGraveyard().cardEntities.filter(a);if(i.length===0)return!1;const r=await t.activator.waitSelectEntities(i,e,n=>n.length===e,"手札に加えるカードを選択",!1);for(const n of r??[])await n.addToHand(["Effect"],t.action.entity,t.activator);return!0},settle:async()=>!0}),zc=a=>({title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,canPayCosts:e=>e.activator.getHandCell().cardEntities.filter(a).some(t=>e.activator.canDiscard([t])),validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<2))return xe(e)},payCosts:async e=>({discard:await e.activator.discard(1,["Discard","Cost"],e.action.entity,e.activator,a)}),prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(2,e.action.entity,e.activator),!0),settle:async()=>!0}),Wc=a=>({title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:xe,prepare:async e=>{const[t,i]=a(e.action.entity),r=[];return t<0&&r.push("DamageToSelf"),i<0&&r.push("DamageToOpponent"),{selectedEntities:[],chainBlockTags:r,prepared:void 0}},execute:async e=>{const[t,i]=a(e.action.entity);return i>0?e.activator.getOpponentPlayer().heal(i,e.action.entity):i<0&&e.activator.getOpponentPlayer().effectDamage(Math.abs(i),e.action.entity),t>0?e.activator.heal(t,e.action.entity):t<0&&e.activator.effectDamage(Math.abs(t),e.action.entity),!0},settle:async()=>!0}),Yc=()=>{const a=[];return[{name:"増援",filter:e=>e.origin.kind==="Monster"&&e.types.includes("Warrior")&&(e.origin.level??5)<5},{name:"化石調査",filter:e=>e.origin.kind==="Monster"&&e.types.includes("Dinosaur")&&(e.origin.level??6)<6},{name:"Ｅ－エマージェンシーコール",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("Ｅ・ＨＥＲＯ")},{name:"召集の聖刻印",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("聖刻")},{name:"召喚師のスキル",filter:e=>e.origin.kind==="Monster"&&(e.origin.monsterCategories??[]).includes("Normal")&&(e.origin.level??4)>4},{name:"トゥーンのもくじ",filter:e=>(e.origin.nameTags??[]).includes("トゥーン")},{name:"融合賢者",filter:e=>e.origin.name==="融合"},{name:"虹の架け橋",filter:e=>e.origin.kind!=="Monster"&&(e.origin.nameTags??[]).includes("宝玉")},{name:"紫炎の狼煙",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("六武衆")&&(e.origin.level??4)<4},{name:"テラ・フォーミング",filter:e=>e.origin.kind==="Spell"&&e.origin.spellCategory==="Field"},{name:"コール・リゾネーター",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("リゾネーター")}].forEach(e=>{a.push({name:e.name,actions:[jc(e.filter),Te]})}),[{name:"戦士の生還",filter:e=>e.status.kind==="Monster"&&e.types.includes("Warrior"),qty:1},{name:"ダーク・バースト",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Dark")&&(e.atk??9999)<=1500,qty:1},{name:"悪夢再び",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Dark")&&(e.def??9999)===0,qty:2},{name:"サルベージ",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Water")&&(e.atk??9999)<=1500,qty:2},{name:"バッテリーリサイクル",filter:e=>e.status.kind==="Monster"&&e.types.includes("Thunder")&&(e.atk??9999)<=1500,qty:2},{name:"闇の量産工場",filter:e=>e.status.kind==="Monster"&&(e.status.monsterCategories??[]).includes("Normal"),qty:2}].forEach(e=>{a.push({name:e.name,actions:[Vc(e.filter,e.qty),Te]})}),[{name:"トレード・イン",filter:e=>e.status.kind==="Monster"&&(e.lvl??0)===8},{name:"調和の宝札",filter:e=>e.status.kind==="Monster"&&(e.origin.monsterCategories??[]).includes("Tuner")&&e.types.includes("Dragon")&&(e.atk??9999)<=1e3},{name:"デステニー・ドロー",filter:e=>e.status.kind==="Monster"&&(e.origin.nameTags??[]).includes("Ｄ－ＨＥＲＯ")}].forEach(e=>{a.push({name:e.name,actions:[zc(e.filter),Te]})}),[{name:"火の粉",calcHeal:()=>[0,-200]},{name:"雷鳴",calcHeal:()=>[0,-300]},{name:"ファイヤー・ボール",calcHeal:()=>[0,-500]},{name:"火あぶりの刑",calcHeal:()=>[0,-600]},{name:"昼夜の大火事",calcHeal:()=>[0,-800]},{name:"火炎地獄",calcHeal:()=>[-500,-1e3]},{name:"盗人ゴブリン",calcHeal:()=>[500,-500]},{name:"ブルー・ポーション",calcHeal:()=>[400,0]},{name:"レッド・ポーション",calcHeal:()=>[500,0]},{name:"ゴブリンの秘薬",calcHeal:()=>[600,0]},{name:"天使の生き血",calcHeal:()=>[800,0]},{name:"治療の神 ディアン・ケト",calcHeal:()=>[1e3,0]},{name:"恵みの雨",calcHeal:()=>[1e3,1e3]}].forEach(e=>{a.push({name:e.name,actions:[Wc(e.calcHeal),Te]})}),a},Qc=(a,e,t,i,r,n)=>{if(!a.action.entity.origin.level||i.some(o=>!o.lvl)||i.map(o=>o.lvl??0).reduce((o,c)=>o+c,0)!==a.action.entity.origin.level)return;const s=i.filter(o=>{var c;return(c=o.status.monsterCategories)==null?void 0:c.some(v=>v==="Tuner")}),l=i.filter(o=>{var c;return(c=o.status.monsterCategories)==null?void 0:c.every(v=>v!=="Tuner")});if(!r(s)||!n(l))return;const d=[...s.map(o=>({material:o,cell:o.fieldCell,isAsTuner:!0})),...l.map(o=>({material:o,cell:o.fieldCell,isAsTuner:!1}))];if(a.activator.getEnableSummonList(a.activator,"SyncroSummon",["Rule","SpecialSummon"],a.action,[{monster:a.action.entity,posList:e,cells:t}],d,!1).length)return d},Kc=(a,e=i=>i.length===1,t=i=>i.length>0)=>{let i=[...a.activator.getMonstersOnField().filter(s=>s.battlePosition!=="Set"),...a.activator.getHandCell().cardEntities.filter(s=>s.origin.kind==="Monster")];if(i.every(s=>!s.status.allowHandSyncro)&&(i=i.filter(s=>s.fieldCell.isPlayFieldCell)),i.length<2)return[];const r=[...a.activator.getMonsterZones(),...a.activator.duel.field.getCells("ExtraMonsterZone")],n=["Attack","Defense"];return i.getAllOnOffPattern().filter(s=>s.some(l=>l.status.allowHandSyncro)||s.every(l=>l.isOnFieldAsMonsterStrictly)).map(s=>Qc(a,n,r,s,e,t)??[]).filter(s=>s.length)},Xc=async(a,e,t)=>{var d;const i=a.action.getEnableMaterialPatterns(a),r=i.map(o=>({infos:o,materialSeqList:o.map(c=>c.material.seq).sort()}));let n=i[0].map(o=>o.material);if(i.length>1){const o=i.flatMap(v=>v.map(p=>p.material)).getDistinct(),c=await a.activator.waitSelectEntities(o,void 0,v=>{const p=v.map(h=>h.seq).sort();return r.some(h=>p.length===h.materialSeqList.length&&p.every((m,C)=>m===h.materialSeqList[C]))},"シンクロ素材とするモンスターを選択",t);if(!c)return;n=c}const s=n.map(o=>o.seq).sort(),l=(d=r.find(o=>s.length===o.materialSeqList.length&&s.every((c,v)=>c===o.materialSeqList[v])))==null?void 0:d.infos;if(!l)throw new oe("想定されない状態",a,n);return await ve.sendManyToGraveyardForTheSameReason(n,["SyncroMaterial","Cost","Rule","SpecialSummonMaterial"],a.action.entity,a.activator),{summonMaterialInfos:l}},qt=(a=t=>t.length===1,e=t=>t.length>0)=>({title:"シンクロ召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],getEnableMaterialPatterns:t=>Kc(t,a,e),canPayCosts:t=>t.action.getEnableMaterialPatterns(t).length>0,validate:t=>!t.ignoreCost||t.activator.getAvailableExtraZones().length+t.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:Xc,prepare:t=>yi(t,"SyncroSummon",["Rule","SpecialSummon","SyncroSummon"],["Attack","Defense"]),execute:mi,settle:async()=>!0}),Jc=()=>{const a=[];return["大地の騎士ガイアナイト","スクラップ・デスデーモン"].forEach(e=>a.push({name:e,actions:[fe,ye,ke,qt()],defaultSummonFilter:ot})),a.push({name:"ナチュル・ガオドレイク",actions:[fe,ye,ke,qt(e=>e.length===1&&e.every(t=>t.attr.some(i=>i==="Earth")),e=>e.length>0&&e.every(t=>t.attr.some(i=>i==="Earth")))],defaultSummonFilter:ot}),a.push({name:"マジカル・アンドロイド",actions:[fe,ye,ke,qt(),{title:"回復",isMandatory:!0,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["end"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,validate:e=>e.action.entity.duel.phase==="end"&&e.activator.isTurnPlayer&&e.action.entity.face==="FaceUp"?[]:void 0,prepare:nt,execute:async e=>(e.activator.heal(e.activator.getMonstersOnField().filter(t=>t.face==="FaceUp").filter(t=>t.types.includes("Psychic")).length*600,e.action.entity),!0),settle:async()=>!0}],defaultSummonFilter:ot}),a},Ic=()=>{const a=[];return[{name:"草原",up:["Warrior","BeastWarrior"],down:[]},{name:"森",up:["Insect","Plant","Beast","BeastWarrior"],down:[]},{name:"山",up:["Dragon","WingedBeast","Thunder"],down:[]},{name:"荒野",up:["Dinosaur","Zombie","Rock"],down:[]},{name:"海",up:["Aqua","SeaSerpent","Fish"],down:["Machine","Pyro"]},{name:"闇",up:["Fiend","Spellcaster"],down:["Fairy"]}].forEach(e=>{a.push({name:e.name,actions:[{title:"発動",isMandatory:!1,canIgnoreCosts:!0,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:xe,prepare:nt,execute:async()=>!0,settle:async()=>!0},Te],continuousEffects:[Aa("発動","Spell",t=>t.isOnFieldStrictly&&t.face==="FaceUp",t=>["attack","defense"].flatMap(i=>["up","down"].map(r=>mt.createContinuous("発動",n=>n.isSpawnedBy.isOnFieldStrictly&&n.isSpawnedBy.face==="FaceUp",t,(n,s)=>s.isOnFieldStrictly&&s.face==="FaceUp"&&(s.status.monsterCategories??!1)&&e[r].union(s.types).length>0,i,"wip","Addition",(n,s,l)=>!n.isEffective||s.face==="FaceDown"?l:l+(r==="up"?200:-200)))))]})}),[{name:"バーニングブラッド",attr:"Fire"},{name:"ウォーターワールド",attr:"Water"},{name:"ガイアパワー",attr:"Earth"},{name:"シャインスパーク",attr:"Light"},{name:"ダークゾーン",attr:"Dark"},{name:"デザートストーム",attr:"Wind"}].forEach(e=>{a.push({name:e.name,actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","FieldSpellZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:xe,prepare:nt,execute:async()=>!0,settle:async()=>!0},Te],continuousEffects:[Aa("発動","Spell",t=>t.isOnFieldStrictly&&t.face==="FaceUp",t=>["attack","defense"].flatMap(i=>mt.createContinuous("発動",r=>r.isSpawnedBy.isOnFieldStrictly&&r.isSpawnedBy.face==="FaceUp",t,(r,n)=>n.isOnFieldStrictly&&n.face==="FaceUp"&&n.attr.includes(e.attr),i,"wip","Addition",(r,n,s)=>!r.isEffective||n.face==="FaceDown"?s:s+(i==="attack"?500:-400))))]})}),a},eu=()=>{const a=[],e={name:"連合軍",actions:[Ms,Te],continuousEffects:[Aa("発動","Spell",t=>t.isOnFieldStrictly&&t.face==="FaceUp",t=>[mt.createContinuous("発動",i=>i.isSpawnedBy.isOnFieldStrictly&&i.isSpawnedBy.face==="FaceUp",t,(i,r)=>r.controller===i.isSpawnedBy.controller&&r.types.includes("Warrior")&&r.isOnFieldStrictly&&r.face==="FaceUp","attack","wip","Addition",(i,r,n)=>{if(!i.isEffective||r.face==="FaceDown")return n;const s=i.controller.getMonstersOnField().filter(l=>l.face==="FaceUp").filter(l=>l.types.includes("Warrior")||l.types.includes("Spellcaster")).length;return n+s*200})])]};return a.push(e),a},tu=()=>{const a=[];[{name:"団結の力",kind:["Monster"],rate:800},{name:"魔導師の力",kind:["Spell","Trap"],rate:500}].forEach(t=>{a.push({name:t.name,actions:[Pi(),Te],continuousEffects:[la(t.name,"Spell",i=>i.info.equipedBy?[i.info.equipedBy]:[],i=>i.isOnFieldStrictly&&i.face==="FaceUp",i=>["attack","defense"].map(r=>mt.createContinuous("発動",n=>n.isSpawnedBy.isOnFieldStrictly&&n.isSpawnedBy.face==="FaceUp",i,(n,s)=>s.isOnFieldStrictly&&s.face==="FaceUp",r,"wip","Addition",(n,s,l)=>{if(!n.isEffective)return l;const d=n.controller.getEntiteisOnField().filter(o=>t.kind.includes(o.status.kind)).length;return l+d*t.rate})))]})});const e={name:"早すぎた埋葬",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,canPayCosts:t=>t.activator.lp>=800,validate:t=>{const i=t.activator.getMonsterZones();if(t.activator.getEnableSummonList(t.activator,"SpecialSummon",["Effect"],t.action,t.activator.getGraveyard().cardEntities.filter(n=>n.status.kind==="Monster").filter(n=>n.canBeTargetOfEffect(t)).map(n=>({monster:n,posList:["Attack"],cells:i})),[],!1).length)return xe(t)},payCosts:(t,i)=>rc(t,i,800),prepare:async t=>{const i=await hi(t,t.activator.getGraveyard().cardEntities,["Attack"]);return i.chainBlockTags.push("PayLifePoint"),i},execute:async(t,i)=>t.action.entity.info.equipedBy?(await t.action.entity.ruleDestory(),!1):await gi(t,["Attack"])?(t.action.entity.onBeforeMove.append(async n=>{if(n.entity.face!=="FaceUp"||!n.entity.isOnFieldAsSpellTrapStrictly)return"RemoveMe";const s=n.entity.info.equipedBy;if(!s)return"RemoveMe";const[,,,,,l]=n.args;return s.isOnFieldStrictly&&s.face==="FaceUp"&&n.entity.isEffective&&l.union(["EffectDestroy","RuleDestroy"]).length&&(n.entity.controller.writeInfoLog(`${t.action.entity.toString()}が破壊されたため、装備対象モンスター${s.toString()}を破壊。`),ve.tryMarkForDestory([s],t)),"RemoveMe"}),Ps(t,i,(n,s)=>{var l;return(l=s.info.effectTargets[t.action.seq])==null?void 0:l.includes(n)})):(await t.action.entity.ruleDestory(),!1),settle:async()=>!0},Te]};return a.push(e),a.push({name:"幻惑の巻物",actions:[Pi(),Te],continuousEffects:[]}),a},iu=()=>{const a=[];return[{name:"伝説の剣",attr:void 0,monType:"Warrior",atk:200,def:200},{name:"秘術の書",attr:void 0,monType:"Spellcaster",atk:200,def:200},{name:"ポセイドンの力",attr:void 0,monType:"Aqua",atk:200,def:200},{name:"紫水晶",attr:void 0,monType:"Zombie",atk:200,def:200},{name:"猛獣の歯",attr:void 0,monType:"Beast",atk:200,def:200},{name:"機械改造工場",attr:void 0,monType:"Machine",atk:200,def:200},{name:"体温の上昇",attr:void 0,monType:"Reptile",atk:200,def:200},{name:"魔菌",attr:void 0,monType:"Plant",atk:200,def:200},{name:"闇・エネルギー",attr:void 0,monType:"Fiend",atk:200,def:200},{name:"レーザー砲機甲鎧",attr:void 0,monType:"Insect",atk:200,def:200},{name:"銀の弓矢",attr:void 0,monType:"Fairy",atk:200,def:200},{name:"電撃鞭",attr:void 0,monType:"Thunder",atk:200,def:200},{name:"ドラゴンの秘宝",attr:void 0,monType:"Dragon",atk:200,def:200},{name:"フォロー・ウィンド",attr:void 0,monType:"WingedBeast",atk:200,def:200},{name:"魔性の月",attr:void 0,monType:"BeastWarrior",atk:200,def:200},{name:"エルフの光",attr:"Light",monType:void 0,atk:400,def:-200},{name:"覚醒",attr:"Earth",monType:void 0,atk:400,def:-200},{name:"灼熱の槍",attr:"Fire",monType:void 0,atk:400,def:-200},{name:"突風の扇",attr:"Wind",monType:void 0,atk:400,def:-200},{name:"はがねの甲羅",attr:"Water",monType:void 0,atk:400,def:-200},{name:"闇の破神剣",attr:"Dark",monType:void 0,atk:400,def:-200},{name:"火器付機甲鎧",attr:void 0,monType:"Insect",atk:700,def:0},{name:"サラマンドラ",attr:"Fire",monType:void 0,atk:700,def:0},{name:"シャイン・キャッスル",attr:"Light",monType:void 0,atk:700,def:0}].forEach(e=>{a.push({name:e.name,actions:[Pi(t=>(!e.attr||t.attr.includes(e.attr))&&(!e.monType||t.types.includes(e.monType))),Te],continuousEffects:[la(e.name,"Spell",t=>t.info.equipedBy?[t.info.equipedBy]:[],t=>t.isOnFieldStrictly&&t.face==="FaceUp",t=>{const i=[];return e.atk!==0&&i.push(["attack",e.atk]),e.def!==0&&i.push(["defense",e.def]),i.map(([r,n])=>mt.createContinuous("発動",s=>s.isSpawnedBy.isOnFieldStrictly&&s.isSpawnedBy.face==="FaceUp",t,(s,l)=>l.isOnFieldStrictly&&l.face==="FaceUp"&&(!e.monType||l.types.includes(e.monType))&&(!e.attr||l.attr.includes(e.attr)),r,"wip","Addition",(s,l,d)=>s.isEffective?d+n:d))})]})}),a},au=()=>{const a=[],e={name:"にせアバター",actions:[Ue,fe,ye,ke],continuousEffects:[la("THE_DEVILS_AVATAR","Monster",i=>[i],i=>i.isOnFieldStrictly&&i.face==="FaceUp",i=>["attack","defense"].map(r=>mt.createContinuous("THE_DEVILS_AVATAR",n=>n.isSpawnedBy.isOnFieldStrictly&&n.isSpawnedBy.face==="FaceUp",i,(n,s)=>s.isOnFieldStrictly&&s.face==="FaceUp",r,"calculated","THE_DEVILS_AVATAR",()=>Number.MIN_VALUE)))]};a.push(e);const t={name:"にせドレッド・ルート",actions:[Ue,fe,ye,ke],continuousEffects:[Aa("THE_DEVILS_DREAD-ROOT","Monster",i=>i.isOnFieldStrictly&&i.face==="FaceUp",i=>["attack","defense"].map(r=>mt.createContinuous("THE_DEVILS_DREAD-ROOT",n=>n.isSpawnedBy.isOnFieldStrictly&&n.isSpawnedBy.face==="FaceUp",i,(n,s)=>s.status.kind==="Monster"&&s.isOnFieldStrictly&&s.face==="FaceUp"&&s!==n.isSpawnedBy,r,"calculated","THE_DEVILS_DREAD-ROOT",(n,s,l)=>Math.round(l/2))))]};return a.push(t),a},ru=()=>{const a=[],e={name:"ご隠居の猛毒薬",actions:[Te,{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:qe,executableDuelistTypes:["Controller"],validate:xe,prepare:async(i,r,n)=>{const s=await i.action.entity.field.duel.view.waitSelectText([{seq:0,text:"●自分は１２００ＬＰ回復する。"},{seq:1,text:"●相手に８００ダメージを与える。"}],"使用する効果を選択",!1);if(s===void 0&&!n)throw new lt(i);const l=[];return s===1&&l.push("DamageToOpponent"),{selectedEntities:[],chainBlockTags:l,prepared:s??0}},execute:async i=>i.prepared===1?(i.activator.getOpponentPlayer().effectDamage(800,i.action.entity),!0):(i.activator.heal(1200,i.action.entity),!0),settle:async()=>!0}]};a.push(e);const t={name:"月の書",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:qe,executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:i=>{if(i.action.entity.field.getMonstersOnFieldStrictly().filter(n=>n.canBeTargetOfEffect(i)).filter(n=>n.face==="FaceUp").length)return xe(i)},prepare:async(i,r,n)=>{const s=i.action.entity.field.getMonstersOnFieldStrictly().filter(d=>d.canBeTargetOfEffect(i)).filter(d=>d.face==="FaceUp"),l=await i.activator.waitSelectEntity(s,"対象とするモンスターを選択",n);if(l)return{selectedEntities:[l],chainBlockTags:[],prepared:void 0}},execute:async i=>{const r=i.selectedEntities[0];if(!r.isOnFieldAsMonsterStrictly||r.battlePosition==="Set")return!1;if(!r.canBeEffected(i.activator,i.action.entity,i.action)){i.activator.duel.log.info(`${r.toString()}は${i.action.entity.toString()}の効果を受けない。`);return}return await r.setBattlePosition("Set",["Effect"],i.action.entity,i.activator),!0},settle:async()=>!0},Te]};return a.push(t),a.push({name:"突進",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:[...qe,...Ie],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:i=>{if(i.action.entity.field.getMonstersOnFieldStrictly().filter(n=>n.canBeTargetOfEffect(i)).length)return xe(i)},prepare:async(i,r,n)=>{const s=i.action.entity.field.getMonstersOnFieldStrictly().filter(d=>d.canBeTargetOfEffect(i)),l=await i.activator.waitSelectEntity(s,"対象とするモンスターを選択",n);if(l)return{selectedEntities:[l],chainBlockTags:[],prepared:void 0}},execute:async i=>{const r=i.selectedEntities[0];if(!r.isOnFieldAsMonsterStrictly||r.battlePosition==="Set")return!1;if(!r.canBeEffected(i.activator,i.action.entity,i.action)){i.activator.duel.log.info(`${r.toString()}は${i.action.entity.toString()}の効果を受けない。`);return}return r.numericOprsBundle.push(mt.createLingeringAddition("攻撃力上昇",n=>n.effectOwner.duel.clock.isSameTurn(n.isSpawnedAt),i.action.entity,i.action,"attack",(n,s,l)=>l+700)),!0},settle:async()=>!0},Te]}),a},Cn=(a,e)=>{const t=e?`魔力充填可能(${e})`:"魔力充填可能";return Cs(t,a,i=>[i],()=>!0,i=>[new oa(t,()=>!0,!0,i,{},(r,n)=>r.isSpawnedBy===n,(r,n)=>(n.maxCounterQty.SpellCounter=e??Number.MAX_VALUE,{...n,maxCounterQty:n.maxCounterQty}))])},rr={},nu=(a,e=1)=>(rr[e]||(rr[e]={title:`魔力回収(${e})`,isMandatory:!0,playType:"AfterChainBlock",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:Rt,executableDuelistTypes:["Controller"],validate:t=>{if(!t.targetChainBlock||t.targetChainBlock.action.playType!=="CardActivation"||t.targetChainBlock.action.entity.status.kind!=="Spell"||!t.action.entity.isEffective||t.action.entity.face==="FaceDown")return;const i=t.action.entity.status.maxCounterQty.SpellCounter??0;if(!(t.action.entity.counterHolder.getQty("SpellCounter")>=i)&&!(t.action.entity.hadArrivedToFieldAt().totalProcSeq>t.targetChainBlock.isActivatedAt.totalProcSeq))return[]},prepare:nt,execute:async t=>t.action.entity.face==="FaceDown"||!t.action.entity.isOnFieldAsMonsterStrictly||!t.action.entity.isEffective?!1:(t.action.entity.counterHolder.add("SpellCounter",e,t.action.entity),!0),settle:async()=>!0}),{...rr[e],title:`${a}魔力回収(${e})`}),kn=(a,e,t)=>a.action.entity.counterHolder.getQty("SpellCounter")>=t,wn=(a,e,t,i)=>{const r=i[0];return a.action.entity.counterHolder.remove("SpellCounter",r),{counter:r}},su=()=>{const a=[];return a.push({name:"魔導戦士 ブレイカー",actions:[fe,ye,ke,Ue,{title:"①魔力充填",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.hasBeenSummonedNow(["NormalSummon"]))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["IfNormarlSummonSucceed"],prepared:void 0}),execute:async e=>e.action.entity.face==="FaceDown"?!1:(e.action.entity.counterHolder.setQty("SpellCounter",1,e.action.entity),!0),settle:async()=>!0},{title:"③マナブレイク",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,canPayCosts:(e,t)=>kn(e,t,1),validate:e=>{const t=e.action.entity.field.getCells(...pi).flatMap(i=>i.cardEntities).filter(i=>i.canBeTargetOfEffect(e));if(t.length)return t.map(i=>i.fieldCell)},payCosts:async(e,t,i)=>wn(e,t,i,[1]),prepare:async(e,t,i)=>{var n;let r=(n=e.dest)==null?void 0:n.cardEntities[0];if(!r){const s=e.action.entity.field.getCells(...pi).flatMap(d=>d.cardEntities).filter(d=>d.canBeTargetOfEffect(e)),l=await e.activator.waitSelectEntity(s,"破壊する対象を選択。",i);if(!l)return;r=l}return{selectedEntities:[r],chainBlockTags:e.action.calcChainBlockTagsForDestroy([r]),prepared:void 0}},execute:async e=>e.selectedEntities.every(t=>!t.isOnFieldAsSpellTrapStrictly)?!1:(await ve.tryDestroy(e.selectedEntities,e),!0),settle:async()=>!0}],continuousEffects:[Cn("Monster",1),la("②攻撃力上昇","Monster",e=>[e],()=>!0,e=>[mt.createContinuous("②攻撃力上昇",()=>!0,e,()=>!0,"attack","wip","Addition",(t,i,r)=>t.isEffective?r+t.counterHolder.getQty("SpellCounter")*300:r)])]}),a.push({name:"王立魔法図書館",actions:[fe,ye,ke,Ue,{...nu("①",1)},{title:"②ドロー",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],canPayCosts:(e,t)=>kn(e,t,3),validate:e=>{if(e.activator.getDeckCell().cardEntities.length)return[]},payCosts:async(e,t,i)=>wn(e,t,i,[3]),prepare:nt,execute:async e=>(await e.activator.draw(1,e.action.entity,e.activator),!0),settle:async()=>!0}],continuousEffects:[Cn("Monster",3)]}),a},lu=()=>{const a=[];return["炸裂装甲","次元幽閉"].forEach(e=>{a.push({name:e,actions:[Te,{title:"発動",playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:["b1Battle","b2Battle"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:t=>{if(!t.activator.duel.clock.isUponAttackDeclaration()||t.activator.isTurnPlayer)return;const i=t.activator.duel.attackingMonster;if(!i)throw new oe("想定されない状態",t,i);if(i.canBeTargetOfEffect(t))return e==="次元幽閉"&&!t.activator.canTryBanish(i,"BanishAsEffect",t.action)?!1:xe(t)},prepare:async t=>{const i=t.activator.duel.attackingMonster;if(!i)throw new oe("想定されない状態",t,i);const r=e==="炸裂装甲"?t.action.calcChainBlockTagsForDestroy([i]):["BanishFromField"];return{selectedEntities:[i],chainBlockTags:r,prepared:void 0}},execute:async t=>(e==="炸裂装甲"?await ve.tryDestroy(t.selectedEntities,t):await ve.tryBanish("BanishAsEffect",t.selectedEntities,t),!0),settle:async()=>!0}]})}),a},ou=()=>{const a=[];return a.push({name:"強欲な瓶",actions:[Te,{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:qe,executableDuelistTypes:["Controller"],validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<2)&&e.activator.canDraw&&e.activator.canAddToHandFromDeck)return xe(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(1,e.action.entity,e.activator),!0),settle:async()=>!0}]}),a.push({name:"戦線復帰",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:qe,executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:e=>{const t=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getGraveyard().cardEntities.filter(r=>r.status.kind==="Monster").filter(r=>r.canBeTargetOfEffect(e)).map(r=>({monster:r,posList:["Defense"],cells:t})),[],!1).length)return xe(e)},prepare:e=>hi(e,e.activator.getGraveyard().cardEntities.filter(t=>t.status.kind==="Monster").filter(t=>t.canBeTargetOfEffect(e)),["Defense"]),execute:async e=>gi(e,["Defense"]),settle:async()=>!0},Te]}),a},cu=()=>{const a=[];a.push({name:"強欲な壺",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:20,validate:n=>{if(!(n.activator.getDeckCell().cardEntities.length<2)&&n.activator.canDraw&&n.activator.canAddToHandFromDeck)return xe(n)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async n=>(await n.activator.draw(2,n.action.entity,n.activator),!0),settle:async()=>!0},Te]});const e={name:"貪欲な壺",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:30,validate:n=>{if(!(n.activator.getGraveyard().cardEntities.filter(s=>s.status.kind==="Monster").filter(s=>s.canBeTargetOfEffect(n)).length<5)&&n.activator.canDraw&&n.activator.canAddToHandFromDeck)return xe(n)},prepare:async n=>{const s=await n.activator.waitSelectEntities(n.activator.getGraveyard().cardEntities.filter(l=>l.status.kind==="Monster").filter(l=>l.canBeTargetOfEffect(n)),5,l=>l.length===5,"デッキに戻すモンスターを選択。",!1);if(s)return{selectedEntities:s,chainBlockTags:["Draw","ReturnToDeckFromGraveyard"],prepared:void 0}},execute:async n=>n.selectedEntities.some(s=>s.wasMovedAtCurrentChain)?!1:(await ve.returnManyToDeckForTheSameReason("Random",n.selectedEntities,["Effect"],n.action.entity,n.activator),await n.activator.draw(2,n.action.entity,n.activator),!0),settle:async()=>!0},Te]};a.push(e);const t={name:"天使の施し",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:30,validate:n=>{if(!(n.activator.getDeckCell().cardEntities.length<3))return xe(n)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw","DiscordAsEffect"],prepared:void 0}),execute:async n=>(await n.activator.draw(3,n.action.entity,n.activator),await n.activator.discard(2,["Effect","Discard"],n.action.entity,n.activator,()=>!0,n.activator),!0),settle:async()=>!0},Te]};a.push(t);const i={name:"成金ゴブリン",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:20,validate:n=>{if(!(n.activator.getDeckCell().cardEntities.length<1))return xe(n)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async n=>(await n.activator.draw(1,n.action.entity,n.activator),n.action.entity.field.duel.clock.incrementProcSeq(),n.activator.getOpponentPlayer().heal(1e3,n.action.entity),!0),settle:async()=>!0},Te]};a.push(i);const r={name:"手札抹殺",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:n=>{if(!(n.activator.getDeckCell().cardEntities.length<n.activator.getHandCell().cardEntities.filter(s=>s.seq!==n.action.entity.seq).length)&&n.action.entity.field.getAllCells().filter(s=>s.cellType==="Hand").flatMap(s=>s.cardEntities).filter(s=>s.seq!==n.action.entity.seq).length!==0)return xe(n)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async n=>{const s=n.activator.getHandCell().cardEntities.length,l=n.activator.getOpponentPlayer().getHandCell().cardEntities.length;return await ve.sendManyToGraveyardForTheSameReason(n.action.entity.field.getCells("Hand").flatMap(d=>d.cardEntities),["Effect","Discard"],n.action.entity,n.activator),n.activator.duel.clock.incrementProcSeq(),await n.action.entity.field.drawAtSameTime(n.activator,s,n.activator.getOpponentPlayer(),l,n.action.entity,n.activator),!0},settle:async()=>!0},Te]};return a.push(r),a},uu=(a,e,t,i,r=2,n=2,s)=>{if(!a.action.entity.origin.rank||i.length<r||i.length>n||i.some(d=>!d.lvl)||i.some(d=>d.lvl!==a.action.entity.rank)||!s(i))return;const l=i.map(d=>({material:d,cell:d.fieldCell,level:d.status.level}));if(a.activator.getEnableSummonList(a.activator,"XyzSummon",["Rule","XyzSummon","SpecialSummon"],a.action,[{monster:a.action.entity,posList:e,cells:t}],l,!1).length)return l},du=(a,e=2,t=2,i=r=>r.length>1)=>{const r=a.activator.getMonstersOnField().filter(s=>s.battlePosition!=="Set");if(r.length<e)return[];const n=[...a.activator.getMonsterZones(),...a.activator.getAvailableExtraZones()];return r.getAllOnOffPattern().filter(s=>s.length>=e).filter(s=>s.length<=t).map(s=>uu(a,Ye,n,s,e,t,i)??[]).filter(s=>s.length)},fu=async(a,e,t)=>{var d;const i=a.action.getEnableMaterialPatterns(a),r=i.map(o=>({infos:o,materialSeqList:o.map(c=>c.material.seq).sort()}));let n=i[0].map(o=>o.material);if(i.length>1){const o=i.flatMap(v=>v.map(p=>p.material)).getDistinct(),c=await a.activator.waitSelectEntities(o,void 0,v=>{const p=v.map(h=>h.seq).sort();return r.some(h=>p.length===h.materialSeqList.length&&p.every((m,C)=>m===h.materialSeqList[C]))},"エクシーズ素材とするモンスターを選択",t);if(!c)return;n=c}const s=n.map(o=>o.seq).sort(),l=(d=r.find(o=>s.length===o.materialSeqList.length&&s.every((c,v)=>c===o.materialSeqList[v])))==null?void 0:d.infos;if(!l)throw new oe("想定されない状態",a,n);return await ve.convertManyToXyzMaterials(l.map(o=>o.material),["XyzMaterial","Rule","Cost"],a.action.entity,a.activator),{summonMaterialInfos:l}},vu=(a=2,e=2,t=i=>i.length>1)=>({title:"エクシーズ召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],getEnableMaterialPatterns:i=>du(i,a,e,t),canPayCosts:i=>i.action.getEnableMaterialPatterns(i).length>0,validate:i=>!i.ignoreCost||i.activator.getAvailableExtraZones().length+i.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:fu,prepare:i=>yi(i,"XyzSummon",["Rule","SpecialSummon","XyzSummon"],["Attack","Defense"]),execute:mi,settle:async()=>!0}),pu=()=>{const a=[];return[{name:"ジェムナイト・パール",qty:2},{name:"覚醒の勇士 ガガギゴ",qty:3}].forEach(e=>a.push({name:e.name,actions:[fe,ye,ke,vu(e.qty,e.qty)],defaultSummonFilter:ot})),a},hu=()=>{const a=[];return a.push({name:"ＢＦ－疾風のゲイル",actions:[Ue,fe,ye,ke,{title:"①特殊召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(e.activator.getMonstersOnField().filter(i=>(i.status.nameTags??[]).includes("ＢＦ")).filter(i=>i.nm!==e.action.entity.origin.name).length)return Sr(e,["Attack","Defense"],[])},prepare:e=>yi(e,"SpecialSummon",["SpecialSummon","Rule"],Ye),execute:mi,settle:async()=>!0},{title:"②攻守半減",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,isOnlyNTimesPerTurnIfFaceup:1,validate:e=>{const t=e.activator.getOpponentPlayer().getMonstersOnField().filter(i=>i.face==="FaceUp").filter(i=>i.canBeTargetOfEffect(e));if(t.length)return t.length?t:void 0},prepare:async(e,t,i)=>{var n;let r=(n=e.dest)==null?void 0:n.cardEntities[0];if(!r){const s=e.activator.getOpponentPlayer().getMonstersOnField().filter(d=>d.face==="FaceUp").filter(d=>d.canBeTargetOfEffect(e)),l=await e.activator.waitSelectEntity(s,"効果対象を選択。",i);if(!l)return;r=l}return{selectedEntities:[r],chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.selectedEntities.filter(i=>i.isOnFieldAsMonsterStrictly).filter(i=>i.face==="FaceUp").find(i=>i.canBeEffected(e.activator,e.action.entity,e.action));if(t)return["attack","defense"].map(i=>mt.createLingeringFixation("②攻守半減",()=>!0,e.action.entity,e.action,i,(r,n,s)=>Math.round(s/2))).forEach(i=>t.numericOprsBundle.push(i)),!0},settle:async()=>!0}]}),a},gu=()=>{const a=[];return a.push({name:"ダーク・リゾネーター",actions:[fe,ye,ke,Ue],substituteEffects:[yc(1)]}),a.push({name:"レッド・リゾネーター",actions:[fe,ye,ke,Ue,{title:"①特殊召喚",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...qe,...Ie],executableDuelistTypes:["Controller"],validate:e=>{if(!e.action.entity.hasBeenSummonedNow(["NormalSummon"]))return;const t=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getHandCell().cardEntities.filter(r=>r.status.kind==="Monster").filter(r=>(r.lvl??12)<5).map(r=>({monster:r,posList:Ye,cells:t})),[],!1).length)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromHand"],prepared:void 0}),execute:async e=>{const t=e.activator.getMonsterZones(),i=e.activator.getHandCell().cardEntities.filter(n=>n.status.kind==="Monster").filter(n=>(n.lvl??12)<5).map(n=>({monster:n,posList:Ye,cells:t}));return!!await e.activator.summonOne(e.activator,"SpecialSummon",["Effect"],e.action,i,[],!1,!1)},settle:async()=>!0},{title:"②回復",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...qe,...Ie],executableDuelistTypes:["Controller"],hasToTargetCards:!0,isOnlyNTimesPerTurn:1,validate:e=>{if(e.action.entity.hasBeenSummonedNow(["SpecialSummon"]))return e.activator.getMonstersOnField().filter(t=>t.canBeTargetOfEffect(e)).filter(t=>(t.atk??0)>0).some(t=>t.info.summonKinds.includes("SpecialSummon"))?[]:void 0},prepare:async e=>{const t=await e.activator.waitSelectEntity(e.activator.getMonstersOnField().filter(i=>i.canBeTargetOfEffect(e)).filter(i=>(i.atk??0)>0).filter(i=>i.info.summonKinds.includes("SpecialSummon")),"対象とするモンスターを選択",!1);if(t)return{selectedEntities:[t],chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.activator.lp;return e.selectedEntities.filter(i=>i.isOnFieldAsMonsterStrictly).forEach(i=>e.activator.heal(i.atk??0,e.action.entity)),e.activator.lp!==t},settle:async()=>!0}]}),a},yu=()=>{const a=[];return a.push({name:"スターダスト・ドラゴン",actions:[fe,ye,ke,qt(),{title:"①ヴィクテム・サンクチュアリ",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:Rt,executableDuelistTypes:["Controller"],canPayCosts:Hr,validate:(e,t)=>t.length===0?void 0:t[e.index-1].chainBlockTags.includes("DestroyOnField")?[]:void 0,payCosts:$r,prepare:async(e,t)=>{const i=t.slice(-1)[0];return{selectedEntities:[],chainBlockTags:e.action.calcChainBlockTagsForDestroy([i.action.entity]),prepared:void 0}},execute:async(e,t)=>{const i=t[e.index-1];return i.isNegatedActivationBy=e.action,await ve.tryDestroy([i.action.entity],e),!0},settle:async()=>!0},{title:"②自己再生",playType:"IgnitionEffect",isMandatory:!1,spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["end"],executableDuelistTypes:["Controller"],validate:e=>{const t=e.action.entity.moveLog.latestRecord;if(t.movedBy!==e.action.entity||!e.activator.duel.clock.isSameTurn(t.movedAt)||!t.movedAs.includes("Cost"))return;const i=e.activator.duel,r=e.action.entity.actionLogRecords.filter(s=>i.clock.isSameTurn(s.clock)).map(s=>s.chainBlockInfo).findLast(s=>s.action.title==="①ヴィクテム・サンクチュアリ");return!r||r.state!=="done"?void 0:e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:nt,execute:e=>ui(e),settle:async()=>!0}],defaultSummonFilter:ot}),a.push({name:"閃珖竜 スターダスト",defaultSummonFilter:ot,actions:[fe,ye,qt(),{title:"波動音壁",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:yt,executablePeriods:qe,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,hasToTargetCards:!0,validate:e=>{const t=e.activator.getEntiteisOnField().filter(i=>i.face==="FaceUp").filter(i=>i.canBeTargetOfEffect(e));if(t.length)return t.map(i=>i.fieldCell)},prepare:async(e,t,i)=>{if(e.dest)return{selectedEntities:e.dest.cardEntities,chainBlockTags:[],prepared:void 0};const r=e.activator.getEntiteisOnField().filter(s=>s.face==="FaceUp").filter(s=>s.canBeTargetOfEffect(e));if(!r.length)return;const n=await e.activator.waitSelectEntity(r,"対象とするカードを選択",i);if(n)return{selectedEntities:[n],chainBlockTags:[],prepared:void 0}},execute:async e=>(e.selectedEntities.filter(t=>t.isOnFieldStrictly).filter(t=>t.face==="FaceUp").filter(t=>t.canBeEffected(e.activator,e.action.entity,e.action)).forEach(t=>{t.counterHolder.add("SonicBarrier",1,e.action.entity)}),!0),settle:async()=>!0}],substituteEffects:[{title:"波動音壁（適用）",isMandatory:!0,executableCells:Mi,executablePeriods:Rt,executableDuelistTypes:["Controller"],isApplicableTo:(e,t,i)=>i.filter(r=>r.counterHolder.getQty("SonicBarrier",e.entity)>0),substitute:async(e,t,i)=>{const r=i.filter(n=>n.counterHolder.getQty("SonicBarrier",e.entity)>0);return r.forEach(n=>{n.counterHolder.removeAll("SonicBarrier",e.entity),e.entity.controller.writeInfoLog(`波動音壁により${n.toString()}は１ターンに１度だけ戦闘効果では破壊されない。`)}),r}}]}),a.push({name:"真閃珖竜 スターダスト・クロニクル",defaultSummonFilter:ot,actions:[fe,ye,qt(e=>e.length===1&&e.every(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")}),e=>e.length>0&&e.every(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")})),{title:"波動護魂",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:yt,executablePeriods:qe,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,canPayCosts:e=>lc(e,e.activator.getGraveyard().cardEntities.filter(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")})),validate:()=>[],payCosts:e=>oc(e,e.activator.getGraveyard().cardEntities.filter(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")}),t=>t.length===1,1),prepare:nt,execute:async e=>(e.action.entity.procFilterBundle.push(Da.createLingering(e.action.title,t=>t.effectOwner.duel.clock.isSameTurn(t.isSpawnedAt),e.action.entity,e.action,()=>!0,["Effect"],()=>!1)),!0),settle:async()=>!0},{title:"②蘇生",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Banished"],executablePeriods:[...qe,...Ie],executableDuelistTypes:["Controller"],validate:e=>{if(!e.action.entity.wasMovedAtPreviousChain)return;const t=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getBanished().cardEntities.filter(r=>r.status.kind==="Monster").filter(r=>r.face==="FaceUp").filter(r=>r.types.includes("Dragon")).filter(r=>{var n;return(n=r.status.monsterCategories)==null?void 0:n.includes("Syncro")}).filter(r=>r.canBeTargetOfEffect(e)).map(r=>({monster:r,posList:Ye,cells:t})),[],!1).length)return[]},prepare:e=>hi(e,e.activator.getBanished().cardEntities.filter(t=>t.status.kind==="Monster").filter(t=>t.face==="FaceUp").filter(t=>t.types.includes("Dragon")).filter(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")}).filter(t=>t.canBeTargetOfEffect(e))),execute:async e=>gi(e),settle:async()=>!0}]}),a.push({name:"聖珖神竜 スターダスト・シフル",defaultSummonFilter:ot,actions:[fe,ye,qt(e=>e.length===1&&e.every(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")}),e=>e.length>1&&e.every(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")})),{title:"②珖波動反撃",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:["Hand"],executablePeriods:qe,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,negatePreviousBlock:!0,validate:e=>{if(e.targetChainBlock&&e.activator!==e.targetChainBlock.activator&&e.targetChainBlock.action.entity.status.kind==="Monster"&&e.targetChainBlock.action.isWithChainBlock)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["NegateCardEffect","DestroyOnField"],prepared:void 0}),execute:async e=>{if(!e.targetChainBlock)return!1;const t=e.targetChainBlock;t.isNegatedEffectBy=e.action;const i=await e.activator.waitSelectEntity(e.action.duel.field.getCardsOnFieldStrictly(),"破壊するカードを選択。",!1);return(await ve.tryDestroy(i?[i]:[],e)).length>0},settle:async()=>!0},{title:"③蘇生",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:10,canPayCosts:ca,validate:e=>e.activator.getBanished().cardEntities.filter(i=>{var r;return(r=i.status.nameTags)==null?void 0:r.includes("スターダスト")}).filter(i=>(i.lvl??12)<9).length===0?void 0:e.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:Wa,prepare:e=>hi(e,e.activator.getBanished().cardEntities.filter(t=>{var i;return(i=t.status.nameTags)==null?void 0:i.includes("スターダスト")}).filter(t=>(t.lvl??12)<9),Ye,t=>t.length===1),execute:e=>gi(e,Ye),settle:async()=>!0}],substituteEffects:[{title:"波動聖句",isMandatory:!0,executableCells:["MonsterZone"],executablePeriods:Rt,executableDuelistTypes:["Controller"],isApplicableTo:(e,t,i)=>i.filter(r=>r.controller===e.entity.controller).filter(r=>r.counterHolder.getQty("SonicVerse",e.entity)===0),substitute:async(e,t,i)=>{if(!e.entity.isEffective)return[];const r=i.filter(n=>n.controller===e.entity.controller).filter(n=>n.counterHolder.getQty("SonicVerse",e.entity)===0);return r.forEach(n=>{n.counterHolder.add("SonicVerse",1,e.entity),e.entity.controller.writeInfoLog(`${e.entity.toString()}の効果により${n.toString()}は１ターンに１度だけ破壊されない。`)}),r}}]}),a},mu=()=>{const a=[];return[{name:"リビングデッドの呼び声",pos:"Attack",filter:()=>!0},{name:"エンジェル・リフト",pos:"Attack",filter:e=>(e.lvl??12)<3},{name:"正統なる血統",pos:"Attack",filter:e=>{var t;return(t=e.status.monsterCategories)==null?void 0:t.includes("Normal")}},{name:"蘇りし魂",pos:"Defense",filter:e=>{var t;return(t=e.status.monsterCategories)==null?void 0:t.includes("Normal")}},{name:"リミット・リバース",pos:"Attack",filter:e=>(e.atk??9999)<=1e3,onMonsterAfterMove:async(e,t)=>{if(!t.isOnFieldAsMonsterStrictly||t.face==="FaceDown")return"RemoveMe";if(e.action.entity.isEffective&&t.battlePosition==="Defense")return e.action.entity.controller.writeInfoLog(`${t.toString()}が守備表示になったため、${e.action.entity.toString()}とともに破壊される。`),await ve.tryMarkForDestory([t,e.action.entity],e),"RemoveMe"}}].forEach(e=>a.push({name:e.name,actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:qe,executableDuelistTypes:["Controller"],validate:t=>{const i=t.activator.getMonsterZones();if(t.activator.getEnableSummonList(t.activator,"SpecialSummon",["Effect"],t.action,t.activator.getGraveyard().cardEntities.filter(n=>n.status.kind==="Monster").filter(e.filter).filter(n=>n.canBeTargetOfEffect(t)).map(n=>({monster:n,posList:["Attack"],cells:i})),[],!1).length)return xe(t)},prepare:t=>hi(t,t.activator.getGraveyard().cardEntities.filter(i=>i.status.kind==="Monster").filter(e.filter).filter(i=>i.canBeTargetOfEffect(t)),["Attack"]),execute:async t=>{if(!await gi(t,["Attack"])||!t.selectedEntities.length)return!1;t.action.entity.info.effectTargets[t.action.seq]=t.selectedEntities,t.action.entity.onBeforeMove.append(async n=>{if(n.entity.face!=="FaceUp"||!n.entity.isOnFieldAsSpellTrapStrictly)return"RemoveMe";const s=Object.values(n.entity.info.effectTargets).flatMap(o=>o),[l]=n.args;if(!s.length)return"RemoveMe";const d=s[0];return d.isOnFieldStrictly&&d.face==="FaceUp"&&n.entity.isEffective&&!l.isSpellTrapZoneLikeCell&&(n.entity.controller.writeInfoLog(`${t.action.entity.toString()}がフィールドを離れたため、対象モンスター${d.toString()}を破壊。`),await ve.tryMarkForDestory([d],t)),"RemoveMe"});const r=t.selectedEntities[0];return r.onBeforeMove.append(async n=>{if(n.entity.face!=="FaceUp"||!n.entity.isOnFieldAsMonsterStrictly)return"RemoveMe";const[,,,,,s]=n.args;return t.action.entity.isOnFieldStrictly&&t.action.entity.face==="FaceUp"&&n.entity.isEffective&&s.union(["EffectDestroy","RuleDestroy"]).length&&(t.activator.writeInfoLog(`${n.entity.toString()}が破壊されたため、${t.action.entity.toString()}を破壊。`),await ve.tryMarkForDestory([r],t)),"RemoveMe"}),r.onAfterMove.append(async n=>e.onMonsterAfterMove?await e.onMonsterAfterMove(t,n):"RemoveMe"),!0},settle:async()=>!0},Te]})),a},_u=(a,e,t,i)=>{if(!a.action.entity.origin.link||a.action.entity.origin.link<t.length)return;let r=t.map(s=>({material:s,cell:s.fieldCell,link:1}));if(a.action.entity.origin.link>t.length){if(t.every(d=>(d.origin.link??1)<2))return;const s=[r];t.filter(d=>(d.origin.link??1)>1).forEach(d=>{[...s].forEach(o=>{s.push([...o.filter(c=>c.material!==d),{material:d,cell:d.fieldCell,link:d.origin.link??1}])})});const l=s.find(d=>d.reduce((o,c)=>o+c.link,0)===a.action.entity.origin.link);if(!l)return;r=l}if(!i(t)||!a.activator.getEnableSummonList(a.activator,"LinkSummon",["Rule","SpecialSummon"],a.action,[{monster:a.action.entity,posList:["Attack"],cells:e}],r,!1).length)return;if(a.activator.getAvailableExtraZones().length)return r;const n=a.activator.duel.field.getCells("ExtraMonsterZone").map(s=>s.cardEntities[0]).filter(s=>s);if(n.filter(s=>s.controller===a.activator).length&&n.filter(s=>s.controller===a.activator).length===t.filter(s=>s.fieldCell.cellType==="ExtraMonsterZone").length||a.activator.getMonsterZones().flatMap(s=>s.linkArrowSources).some(s=>!t.includes(s))||a.activator.duel.field.canExtraLink(a.action.entity,r))return r},Su=(a,e=()=>!0)=>{let t=[...a.activator.getMonstersOnField().filter(r=>r.battlePosition!=="Set"),...a.activator.getHandCell().entities.filter(r=>r.origin.kind==="Monster")];if(t.every(r=>!r.status.allowHandLink)&&(t=t.filter(r=>r.fieldCell.isPlayFieldCell)),t.length<1)return[];const i=[...a.activator.getMonsterZones(),...a.activator.duel.field.getAvailableExtraMonsterZones()];return t.getAllOnOffPattern().filter(r=>r.some(n=>n.status.allowHandLink)||r.every(n=>n.isOnFieldAsMonsterStrictly)).map(r=>_u(a,i,r,e)??[]).filter(r=>r.length)},Cu=async(a,e,t)=>{var d;const i=a.action.getEnableMaterialPatterns(a),r=i.map(o=>({infos:o,materialSeqList:o.map(c=>c.material.seq).sort()}));let n=i[0].map(o=>o.material);if(i.length>1){const o=i.flatMap(v=>v.map(p=>p.material)).getDistinct(),c=await a.action.entity.duel.view.waitSelectEntities(a.activator,{selectables:o,qty:void 0,validator:v=>{const p=v.map(h=>h.seq).sort();return r.some(h=>p.length===h.materialSeqList.length&&p.every((m,C)=>m===h.materialSeqList[C]))},cancelable:t},"リンク素材とするモンスターを選択");if(!c)return;n=c}const s=n.map(o=>o.seq).sort(),l=(d=r.find(o=>s.length===o.materialSeqList.length&&s.every((c,v)=>c===o.materialSeqList[v])))==null?void 0:d.infos;if(!l)throw new oe("想定されない状態",a,n);return await ve.sendManyToGraveyardForTheSameReason(n,["LinkMaterial","Cost","Rule","SpecialSummonMaterial"],a.action.entity,a.activator),{summonMaterialInfos:l}},Ur=(a=()=>!0)=>({title:"リンク召喚",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],getEnableMaterialPatterns:e=>Su(e,a),canPayCosts:e=>e.action.getEnableMaterialPatterns(e).length>0,validate:e=>!e.ignoreCost||e.activator.getAvailableExtraZones().length+e.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:Cu,prepare:e=>yi(e,"LinkSummon",["Rule","SpecialSummon","LinkSummon"],["Attack"]),execute:mi,settle:async()=>!0}),ku=()=>{const a=[];return[{name:"ＬＡＮフォリンクス",validator:e=>e.length===2},{name:"トラフィックゴースト",validator:e=>e.length===3},{name:"天威の鬼神",validator:e=>e.length>1&&e.some(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Link")})},{name:"天威の拳僧",validator:e=>e.every(t=>{var i,r;return((i=t.status.nameTags)==null?void 0:i.includes("天威"))&&!((r=t.status.monsterCategories)!=null&&r.includes("Link"))})},{name:"電影の騎士ガイアセイバー",validator:e=>e.length>1}].forEach(e=>a.push({name:e.name,actions:[fe,Ur(e.validator)],defaultSummonFilter:ot})),a},wu=()=>{const a=[];return a.push({name:"ファイアウォール・ドラゴン・シンギュラリティ",actions:[fe,Ur(e=>e.length>2),{title:"①バウンス＆自己強化",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:yt,executablePeriods:[...qe,...Ie],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>[...e.activator.getGraveyard().cardEntities,...e.activator.getMonstersOnField()].flatMap(n=>n.status.monsterCategories??[]).getDistinct().union(["Ritual","Fusion","Syncro","Xyz"]).length<1?void 0:[...e.activator.getOpponentPlayer().getGraveyard().cardEntities,...e.activator.getOpponentPlayer().getEntiteisOnField()].filter(n=>n.canBeTargetOfEffect(e)).length?[]:void 0,prepare:async e=>{const i=[...e.activator.getGraveyard().cardEntities,...e.activator.getMonstersOnField()].flatMap(s=>s.status.monsterCategories??[]).getDistinct().union(["Ritual","Fusion","Syncro","Xyz"]).length;if(i<1)return;const r=[...e.activator.getOpponentPlayer().getGraveyard().cardEntities,...e.activator.getOpponentPlayer().getEntiteisOnField()].filter(s=>s.canBeTargetOfEffect(e));if(r.length<1)return;const n=await e.action.entity.duel.view.waitSelectEntities(e.activator,{selectables:r,qty:void 0,validator:s=>s.length>0&&s.length<=i,cancelable:!1},"手札に戻すカードを選択。")??[];if(n.length)return{selectedEntities:n,chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.selectedEntities.filter(r=>r.isOnFieldStrictly||r.fieldCell.cellType==="Graveyard").filter(r=>r.canBeEffected(e.activator,e.action.entity,e.action));await ve.returnManyToHandForTheSameReason(t,["Effect"],e.action.entity,e.activator);const i=t.filter(r=>r.fieldCell.cellType==="Hand"||r.fieldCell.cellType==="ExtraDeck").length;return e.action.entity.numericOprsBundle.push(mt.createLingeringAddition(e.action.title,r=>r.isSpawnedBy.isEffective,e.action.entity,e.action,"attack",(r,n,s)=>s+500*i)),!0},settle:async()=>!0},{title:"②蘇生",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:yt,executablePeriods:Rt,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>{const t=e.action.entity.moveLog.latestRecord.movedAt,i=e.action.duel.field.moveLog.getPriviousChainLog().filter(s=>(console.log(s,s.entity.fieldCell.cellType==="Graveyard",s.movedAs.includes("BattleDestroy")),s.entity.fieldCell.cellType==="Graveyard"||s.movedAs.includes("BattleDestroy"))).filter(s=>s.movedAt.totalProcSeq>t.totalProcSeq).map(s=>s.entity.wasMovedFrom).toArray();if(!e.action.entity.linkArrowDests.union(i).length)return;const r=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getGraveyard().cardEntities.filter(s=>s.status.kind==="Monster").filter(s=>s.types.includes("Cyberse")).filter(s=>s.canBeTargetOfEffect(e)).map(s=>({monster:s,posList:Ye,cells:r})),[],!1).length)return xe(e)},prepare:e=>hi(e,e.activator.getGraveyard().cardEntities.filter(t=>t.status.kind==="Monster").filter(t=>t.types.includes("Cyberse")).filter(t=>t.canBeTargetOfEffect(e)),Ye),execute:e=>gi(e,Ye),settle:async()=>!0}],defaultSummonFilter:ot}),a},Tu=()=>{const a=[];return a.push({name:"ドットスケーパー",actions:[fe,ye,Ue,ke,{title:"①自己再生",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...qe,...Ie],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:1,actionGroupName:"ドットスケーパー",validate:e=>{if(e.action.entity.wasMovedAtPreviousChain)return e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:e=>ui(e),settle:async()=>!0},{title:"②自己帰還",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Banished"],executablePeriods:[...qe,...Ie],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:1,actionGroupName:"ドットスケーパー",validate:e=>{if(e.action.entity.wasMovedAtPreviousChain)return e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromBanished"],prepared:void 0}),execute:e=>ui(e),settle:async()=>!0}]}),a},bu=()=>{const a=[];return a.push({name:"昇天の黒角笛",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Counter",executableCells:["SpellAndTrapZone"],executablePeriods:Rt,executableDuelistTypes:["Controller"],negateSummon:!0,validate:e=>{if(e.targetChainBlock&&e.targetChainBlock.action.playType==="SpecialSummon"&&e.targetChainBlock.activator!==e.activator&&e.activator.duel.field.getPendingMonstersOnField().length===1)return xe(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["NegateSpecialSummon"],prepared:void 0}),execute:async e=>{const t=ve.negateSummonMany(e.action.entity,e.activator);return await ve.tryDestroy(t,e),!0},settle:async()=>!0},Te]}),a},Eu=()=>{const a=[];return a.push({name:"フォーミュラ・シンクロン",actions:[fe,ye,ke,qt(),{title:"①ドロー",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:yt,executablePeriods:[...qe,...Ie],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.hasBeenSummonedJustNow(["SyncroSummon"])&&e.activator.getDeckCell().cardEntities.length)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(1,e.action.entity,e.activator),!0),settle:async()=>!0},ws({title:"②シンクロ召喚",isOnlyNTimesPerChain:1})],defaultSummonFilter:ot}),a},Du=()=>{const a=[];return a.push({name:"死霊騎士デスカリバー・ナイト",actions:[fe,ye,Ue,ke,{title:"①モンスター効果無効",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Quick",executableCells:yt,executablePeriods:[...qe,...Ie],executableDuelistTypes:["Controller"],negatePreviousBlock:!0,canPayCosts:Hr,validate:e=>e.targetChainBlock&&e.targetChainBlock.action.entity.status.kind==="Monster"&&e.targetChainBlock.action.isWithChainBlock?[]:void 0,payCosts:$r,prepare:async(e,t)=>{const i=e.targetChainBlock,r=t[e.index-1];return i!==r?{selectedEntities:[],chainBlockTags:[],prepared:void 0}:{selectedEntities:[],chainBlockTags:["NegateCardEffect",...e.action.calcChainBlockTagsForDestroy([i.action.entity])],prepared:void 0}},execute:async(e,t)=>{const i=t.find(n=>n.action.entity.status.kind!=="Monster"&&n.action.isWithChainBlock),r=t[e.index-1];return r!==i?!1:(r.isNegatedActivationBy=e.action,await ve.tryDestroy([r.action.entity],e),!0)},settle:async()=>!0}],defaultSummonFilter:ot}),a},Au=()=>{const a=[];return a.push({name:"ゼラの天使",actions:[fe,ye,ke,qt(),{title:"②自己帰還",isMandatory:!0,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Banished"],executablePeriods:["stanby"],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.wasMovedAtPreviousTurn)return e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromBanished"],prepared:void 0}),execute:e=>ui(e),settle:async()=>!0}],continuousEffects:[la("②攻撃力上昇","Monster",e=>[e],()=>!0,e=>[mt.createContinuous("①攻撃力上昇",()=>!0,e,()=>!0,"attack","wip","Addition",(t,i,r)=>t.isEffective?r+t.controller.getOpponentPlayer().getBanished().cardEntities.length*100:r)])],defaultSummonFilter:ot}),a},xu=()=>{const a=[];return a.push({name:"星杯の妖精リース",actions:[fe,ye,ke,Ue,{title:"①サーチ",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...qe,...Ie],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>{if(e.action.entity.hasBeenSummonedNow(["NormalSummon","SpecialSummon"])&&e.activator.getDeckCell().cardEntities.filter(t=>t.status.kind==="Monster").filter(t=>{var i;return(i=t.status.nameTags)==null?void 0:i.includes("星杯")}).length!==0)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(r=>r.status.kind==="Monster").filter(r=>{var n;return(n=r.status.nameTags)==null?void 0:n.includes("星杯")});if(t.length===0)return!1;const i=await e.activator.waitSelectEntity(t,"手札に加えるモンスターを選択",!1);if(!i)throw new oe("想定されない状態",e);return await i.addToHand(["Effect"],e.action.entity,e.activator),!0},settle:async()=>!0},{title:"②自己サルベージ",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,canPayCosts:e=>[...e.activator.getMonstersOnField(),...e.activator.getHandCell().cardEntities.filter(t=>t.status.kind==="Monster")].some(t=>t.canBeSentToGraveyard(e.activator,e.action.entity,"SendToGraveyardAsCost",e.action)),validate:()=>[],payCosts:async e=>{const t=[...e.activator.getMonstersOnField(),...e.activator.getHandCell().cardEntities.filter(r=>r.status.kind==="Monster")].filter(r=>r.canBeSentToGraveyard(e.activator,e.action.entity,"SendToGraveyardAsCost",e.action)),i=await e.activator.waitSelectEntity(t,"墓地に送るモンスターを選択。",!0);if(i)return await i.sendToGraveyard(["Cost"],e.action.entity,e.activator),{sendToGraveyard:[i]}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>e.action.entity.wasMovedAfter(e.isActivatedAt)?!1:(await e.action.entity.addToHand(["Effect"],e.action.entity,e.activator),!0),settle:async()=>!0}]}),a.push({name:"星遺物－『星杯』",actions:[fe,ye,ke,Ue,{title:"①墓地送り",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...qe,...Ie],executableDuelistTypes:["Controller"],canPayCosts:Hr,validate:e=>e.activator.duel.field.moveLog.getPriviousChainLog().filter(t=>t.movedAs.includes("SpecialSummon")).map(t=>t.entity).some(t=>t.wasMovedFrom.cellType==="ExtraDeck")?[]:void 0,payCosts:$r,prepare:nt,execute:async e=>{const t=e.activator.duel.field.moveLog.getPriviousChainLog().filter(i=>i.movedAs.includes("SpecialSummon")).map(i=>i.entity).filter(i=>i.wasMovedFrom.cellType==="ExtraDeck").filter(i=>i.isOnFieldAsMonsterStrictly).filter(i=>i.canBeEffected(e.activator,e.action.entity,e.action)).toArray();return await ve.sendManyToGraveyardForTheSameReason(t,["Effect"],e.action.entity,e.activator),!0},settle:async()=>!0},{title:"②リクルート",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Hand","Graveyard","Banished"],executablePeriods:[...qe,...Ie],executableDuelistTypes:["Controller"],validate:e=>{if(!e.action.entity.wasMovedAtPreviousChain||!e.action.entity.info.summonKinds.includes("NormalSummon")||e.action.entity.moveLog.previousPlaceRecord.face==="FaceDown")return;const t=e.activator.getDeckCell().cardEntities.filter(n=>n.status.kind==="Monster").filter(n=>{var s;return(s=n.status.nameTags)==null?void 0:s.includes("星杯")}).filter(n=>n.nm!=="星遺物－『星杯』"),i=e.activator.getMonsterZones();return e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,t.map(n=>({monster:n,cells:i,posList:Ye})),[],!1).length>1?[]:void 0},prepare:nt,execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(n=>n.status.kind==="Monster").filter(n=>{var s;return(s=n.status.nameTags)==null?void 0:s.includes("星杯")}).filter(n=>n.nm!=="星遺物－『星杯』"),i=e.activator.getMonsterZones();return(await e.activator.summonMany(e.activator,"SpecialSummon",["Effect"],e.action,t.map(n=>({monster:n,cells:i,posList:Ye})),[],!1,2,n=>n.length==2,!1)??[]).length==2},settle:async()=>!0},{title:"③サーチ",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],canPayCosts:ca,validate:e=>{if(!e.action.entity.wasMovedAtCurrentTurn)return e.activator.getDeckCell().cardEntities.filter(t=>{var i;return(i=t.status.nameTags)==null?void 0:i.includes("星遺物")}).length>0?[]:void 0},payCosts:Wa,prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>{const t=await e.activator.waitSelectEntity(e.activator.getDeckCell().cardEntities.filter(i=>{var r;return(r=i.status.nameTags)==null?void 0:r.includes("星遺物")}),"手札に加えるカードを選択",!1);return t?(await t.addToHand(["Effect"],e.action.entity,e.activator),!0):!1},settle:async()=>!0}]}),a},Mu=()=>{const a=[];return a.push({name:"水晶機巧－ハリファイバー",actions:[fe,Ur(e=>e.length===2&&e.some(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Tuner")})),{title:"①リクルート",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:yt,executablePeriods:[...qe,...Ie],executableDuelistTypes:["Controller"],validate:e=>{if(!e.action.entity.hasBeenSummonedNow(["LinkSummon"]))return;const t=[e.activator.getHandCell(),e.activator.getDeckCell()].flatMap(n=>n.cardEntities).filter(n=>(n.lvl??12)<4).filter(n=>{var s;return(s=n.status.monsterCategories)==null?void 0:s.includes("Tuner")}),i=e.activator.getMonsterZones();return e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,t.map(n=>({monster:n,cells:i,posList:["Defense"]})),[],!1).length?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async e=>{const t=[e.activator.getHandCell(),e.activator.getDeckCell()].flatMap(n=>n.cardEntities).filter(n=>(n.lvl??12)<4).filter(n=>{var s;return(s=n.status.monsterCategories)==null?void 0:s.includes("Tuner")}),i=e.activator.getMonsterZones(),r=await e.activator.summonOne(e.activator,"SpecialSummon",["Effect"],e.action,t.map(n=>({monster:n,cells:i,posList:["Defense"]})),[],!1,!1)??[];return r.forEach(n=>n.statusOperatorBundle.push(new oa("効果発動不可",s=>s.effectOwner.duel.clock.isSameTurn(s.isSpawnedAt),!1,e.action.entity,e.action,()=>!0,()=>({canActivateEffect:!1})))),r.length==1},settle:async()=>!0},{title:"②シンクロ召喚",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:yt,executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerChain:1,canPayCosts:ca,validate:e=>{if(e.activator.isTurnPlayer)return;const t=[...e.activator.getMonsterZones(),...e.activator.duel.field.getCells("ExtraMonsterZone")],i=e.activator.getExtraDeck().cardEntities.filter(n=>{var s;return(s=n.status.monsterCategories)==null?void 0:s.includes("Syncro")}).filter(n=>{var s;return(s=n.status.monsterCategories)==null?void 0:s.includes("Tuner")});return e.activator.getEnableSummonList(e.activator,"SyncroSummon",["SpecialSummon","Effect"],e.action,i.map(n=>({monster:n,cells:t,posList:Ye})),[{material:e.action.entity,cell:e.action.entity.fieldCell}],!1).length?[]:void 0},payCosts:Wa,prepare:nt,execute:async e=>{const t=[...e.activator.getMonsterZones(),...e.activator.duel.field.getCells("ExtraMonsterZone")],i=e.activator.getExtraDeck().cardEntities.filter(r=>{var n;return(n=r.status.monsterCategories)==null?void 0:n.includes("Syncro")}).filter(r=>{var n;return(n=r.status.monsterCategories)==null?void 0:n.includes("Tuner")});return await e.activator.summonOne(e.activator,"SyncroSummon",["SpecialSummon","Effect"],e.action,i.map(r=>({monster:r,cells:t,posList:Ye})),[],!1,!1),!0},settle:async()=>!0}],defaultSummonFilter:ot}),a},Pu=()=>{const a=[];return a.push({name:"エキセントリック・ボーイ",actions:[fe,ye,Ue,ke],defaultSummonFilter:(e,t,i,r,n,s,l,d,o,c)=>{const v={posList:o,cells:c},p={posList:[],cells:[]};if(!n.includes("SyncroSummon"))return v;const h=d.find(m=>m.material===e.isSpawnedBy);return h?!h.cell.isMonsterZoneLikeCell||d.length!==2?p:d.filter(m=>m!==h).every(m=>m.cell.cellType==="Hand")?v:p:v},defaultStatus:{allowHandSyncro:!0},onUsedAsMaterial:(e,t)=>{t.info.summonKinds.includes("SyncroSummon")&&(t.info.willBeBanished=!0,t.info.isEffectiveIn=t.info.isEffectiveIn.filter(i=>i!=="ExtraMonsterZone").filter(i=>i!=="MonsterZone"))}}),a},Bu=()=>{const a=[];return a.push({name:"シューティング・ライザー・ドラゴン",actions:[fe,ye,ke,qt(),{title:"①墓地送り",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:yt,executablePeriods:[...qe,...Ie],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>{if(e.action.entity.hasBeenSummonedNow(["SyncroSummon"])&&e.activator.getDeckCell().cardEntities.some(t=>(t.lvl??12)<(e.action.entity.lvl??0)))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SendToGraveyardFromDeck","IfSpecialSummonSucceed"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(n=>(n.lvl??12)<(e.action.entity.lvl??0));if(t.length===0)return!1;const i=await e.activator.waitSelectEntity(t,"墓地に送るモンスターを選択",!1);if(!i)throw new oe("想定されない状況",e);await i.sendToGraveyard(["Effect"],e.action.entity,e.activator);const r=i.lvl??0;return e.action.entity.numericOprsBundle.push(mt.createLingeringAddition("レベル減少",()=>!0,e.action.entity,e.action,"level",(n,s,l)=>l-r)),!0},settle:async()=>!0},ws({title:"②シンクロ召喚",isOnlyNTimesPerChain:1})],defaultSummonFilter:ot}),a},Fu=()=>{const a=[];return a.push({name:"ジャンク・コレクター",actions:[fe,ye,ke,Ue,{title:"罠コピー",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:yt,executablePeriods:qe,executableDuelistTypes:["Controller"],canPayCosts:e=>e.activator.getGraveyard().cardEntities.filter(i=>i.status.kind==="Trap").filter(i=>i.status.trapCategory==="Normal").filter(i=>e.activator.canTryBanish(i,"BanishAsCost",e.action)).filter(i=>i.canBeBanished("BanishAsCost",e.activator,e.action.entity,e.action)).flatMap(i=>i.actions).filter(i=>i.playType==="CardActivation").filter(i=>!i.needsToPayCost).filter(i=>i.validate(e.activator,[],!0)).length?ca(e):!1,validate:()=>[],payCosts:async(e,t,i)=>{const r=e.activator.getGraveyard().cardEntities.filter(l=>l.status.kind==="Trap").filter(l=>l.status.trapCategory==="Normal").filter(l=>e.activator.canTryBanish(l,"BanishAsCost",e.action)).filter(l=>l.canBeBanished("BanishAsCost",e.activator,e.action.entity,e.action)).flatMap(l=>l.actions).filter(l=>l.playType==="CardActivation").filter(l=>!l.needsToPayCost).filter(l=>l.validate(e.activator,[],!0)).map(l=>l.entity),n=await e.activator.waitSelectEntity(r,"コピーする罠を選択。",i);if(!n)return;const s=[e.action.entity,n];return await ve.banishManyForTheSameReason(s,["Cost"],e.action.entity,e.activator),{banish:s}},prepare:async(e,t)=>{var n;const i=(n=e.costInfo.banish)==null?void 0:n.find(s=>s!==e.action.entity);if(!i)throw new oe("想定されない状況",e,e.costInfo);const r=i.actions.find(s=>s.playType==="CardActivation");if(!r)throw new oe("想定されない状況",e,e.costInfo,i);return await r.prepare(e.activator,void 0,void 0,t,!1,!0)},execute:async(e,t)=>{var n;const i=(n=e.costInfo.banish)==null?void 0:n.find(s=>s!==e.action.entity);if(!i)throw new oe("想定されない状況",e,e.costInfo);const r=i.actions.find(s=>s.playType==="CardActivation");if(!r)throw new oe("想定されない状況",e,e.costInfo,i);return await r.execute(e,t)},settle:async()=>!0}]}),a},Ou=()=>{const a=[];return["イグナイト・イーグル","イグナイト・マグナム","イグナイト・ドラグノフ","イグナイト・マスケット","イグナイト・デリンジャー","イグナイト・ライオット","イグナイト・ウージー","イグナイト・キャリバー"].forEach(e=>{a.push({name:e,actions:[fe,ye,ke,Ue,Ms,{title:"①サーチ",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:t=>{var r;const i=t.activator.getPendulumScaleMonsters().find(n=>n!==t.action.entity);if(i&&(r=i.status.nameTags)!=null&&r.includes("イグナイト"))return t.activator.getDeckCell().cardEntities.some(n=>{var s;return(s=n.status.nameTags)==null?void 0:s.includes("イグナイト")})?[]:void 0},prepare:async t=>({selectedEntities:[],chainBlockTags:["SearchFromDeck",...t.action.calcChainBlockTagsForDestroy(t.activator.getPendulumScaleMonsters())],prepared:void 0}),execute:async t=>{if(!(await ve.tryDestroy(t.activator.getPendulumScaleMonsters(),t)).length)return!1;const r=t.activator.getDeckCell().cardEntities.filter(s=>{var l;return(l=s.status.nameTags)==null?void 0:l.includes("イグナイト")});if(!r.length)return!1;const n=await t.activator.waitSelectEntity(r,"手札に加えるカードを選択。",!1);return n?(await n.addToHand(["Effect"],t.action.entity,t.activator),!0):!1},settle:async()=>!0}]})}),a},Lu=()=>{const a=[];return a.push({name:"封印されしエクゾディア",actions:[fe,ye,Ue,ke,{title:"封印開放",isMandatory:!0,playType:"Exodia",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:Rt,executableDuelistTypes:["Controller"],validate:e=>{const t=e.activator.getHandCell().cardEntities.filter(i=>{var r;return(r=i.origin.nameTags)==null?void 0:r.includes("封印されし")}).map(i=>i.origin.name).getDistinct();return console.log(e.action.entity.toString(),t),t.length===5?[]:void 0},prepare:async e=>(await ve.sendManyToGraveyardForTheSameReason(e.activator.duel.field.getCardsOnFieldStrictly(),["Rule"],e.action.entity,e.activator),{selectedEntities:[],chainBlockTags:[""],prepared:void 0,nextChainBlockFilter:()=>!1}),execute:async e=>{const t=e.activator.getOpponentPlayer().getHandCell().cardEntities.filter(r=>{var n;return(n=r.origin.nameTags)==null?void 0:n.includes("封印されし")}).map(r=>r.origin.name).getDistinct().length===5,i=[{name:"封印されし者の左足",column:4},{name:"封印されし者の右足",column:2},{name:"封印されし者の左腕",column:5},{name:"封印されし者の右腕",column:1},{name:"封印されしエクゾディア",column:3}];for(const r of i){const n=[e.activator.getHandCell().cardEntities.find(s=>s.origin.name===r.name),e.activator.getOpponentPlayer().getHandCell().cardEntities.find(s=>s.origin.name===r.name)].filter(s=>s!==void 0);if(!n.length)throw new oe("想定されない状態",e.activator.getHandCell().cardEntities,r.name);await Me.moveMany(n.map(s=>[s,s.controller.getMonsterZones().find(l=>l.column===(s.controller.seat==="Above"?6-r.column:r.column))??s.controller.getFieldZone(),"Monster","FaceUp","Vertical","Top",["Rule"],void 0,void 0,void 0]))}throw t?new Ht(void 0,`お互いが、${e.action.entity.toString()}の特殊勝利条件を同時に満たした。`):new Ht(e.activator,`${e.action.entity.toString()}の特殊勝利条件を満たした。`)},settle:async()=>!0}]}),a},qu=()=>{const a=[];return["ラージマウス","レインボー・フラワー","レッグル","女王の影武者","人造人間７号"].forEach(e=>{a.push({name:e,actions:[fe,ye,ke,Ue],continuousEffects:[mc]})}),a},Nu=()=>{const a=[];return a.push({name:"黄金色の竹光",actions:[{title:"発動",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:20,validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<2)&&e.activator.canDraw&&e.activator.canAddToHandFromDeck&&e.activator.getSpellTrapsOnField().filter(t=>{var i;return(i=t.status.nameTags)==null?void 0:i.includes("竹光")}).some(t=>t.status.spellCategory==="Equip"))return xe(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(2,e.action.entity,e.activator),!0),settle:async()=>!0},Te]}),a},Ru=()=>{const a=[];return a.push({name:"折れ竹光",actions:[Pi(),Te]}),a.push({name:"妖刀竹光",actions:[Pi(),Te,{title:"②直接攻撃付与",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>{if(!e.activator.getSpellTrapsOnField().filter(i=>{var r;return(r=i.status.nameTags)==null?void 0:r.includes("竹光")}).filter(i=>i!==e.action.entity).some(i=>i.status.spellCategory==="Equip"))return;const t=e.action.entity.info.equipedBy;if(t&&!t.status.canDirectAttack)return[]},prepare:async(e,t,i)=>{const r=await e.activator.waitSelectEntity(e.activator.getSpellTrapsOnField().filter(n=>{var s;return(s=n.status.nameTags)==null?void 0:s.includes("竹光")}).filter(n=>n!==e.action.entity).filter(n=>n.status.spellCategory==="Equip"),"手札に戻すカードを選択。",i);if(r)return{selectedEntities:[r],chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.action.entity.info.equipedBy;return t?(await ve.returnManyToHandForTheSameReason(e.selectedEntities,["Effect"],e.action.entity,e.activator),t.statusOperatorBundle.push(new oa("直接攻撃",i=>(console.log(i.effectOwner.duel.clock.turn,i.isSpawnedAt.turn),i.effectOwner.duel.clock.isSameTurn(i.isSpawnedAt)),!1,e.action.entity,e.action,()=>!0,(i,r)=>({...r,canDirectAttack:!0}))),!0):!1},settle:async()=>!0},{title:"③サーチ",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...qe,...Ie],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.wasMovedAtPreviousChain&&e.activator.canAddToHandFromDeck)return e.activator.getDeckCell().cardEntities.filter(t=>{var i;return(i=t.status.nameTags)==null?void 0:i.includes("竹光")}).some(t=>t.status.name!=="妖刀竹光")?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(r=>{var n;return(n=r.status.nameTags)==null?void 0:n.includes("竹光")}).filter(r=>r.status.name!=="妖刀竹光");if(!t.length)return!1;const i=await e.activator.waitSelectEntity(t,"手札に加えるカードを選択。",!1);if(!i)throw new lt(e);return(await i.addToHand(["Effect"],e.action.entity,e.activator)).cellType==="Hand"},settle:async()=>!0}]}),a.push({name:"真刀竹光",actions:[Pi(),Te,{title:"②相手モンスター破壊",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["SpellAndTrapZone"],executablePeriods:["b1DAfterDmgCalc","b2DAfterDmgCalc"],executableDuelistTypes:["Controller"],validate:e=>{const t=e.action.entity.info.equipedBy;if(t&&t.info.battleLog.filter(i=>e.activator.duel.clock.isPreviousStage(i.timestamp)).some(i=>i.enemy.entityType==="Duelist")&&e.activator.getOpponentPlayer().getMonstersOnField().length&&e.activator.getOpponentPlayer().lifeLog.filter(i=>e.activator.duel.clock.isPreviousStage(i.clock)).some(i=>i.entity===t))return[]},prepare:async e=>({selectedEntities:[],chainBlockTags:e.action.calcChainBlockTagsForDestroy(e.activator.getOpponentPlayer().getMonstersOnField()),prepared:void 0}),execute:async e=>(await ve.tryDestroy(e.activator.getOpponentPlayer().getMonstersOnField(),e)).length>0,settle:async()=>!0},{title:"③竹光入替",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],canPayCosts:e=>e.action.entity.info.equipedBy?nc(e):!1,validate:e=>{if(!(!e.action.entity.info.equipedBy||!e.activator.getDeckCell().cardEntities.filter(r=>{var n;return(n=r.status.nameTags)==null?void 0:n.includes("竹光")}).filter(r=>r.status.name!=="真刀竹光").filter(r=>r.status.spellCategory==="Equip").length))return e.activator.duel.field.getMonstersOnFieldStrictly().some(r=>r.canBeTargetOfEffect(e))?[]:void 0},payCosts:sc,prepare:nt,execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(d=>{var o;return(o=d.status.nameTags)==null?void 0:o.includes("竹光")}).filter(d=>d.status.name!=="真刀竹光").filter(d=>d.status.spellCategory==="Equip");if(!t.length)return!1;const i=e.activator.getAvailableSpellTrapZones();if(!i.length)return!1;const r=e.activator.duel.field.getMonstersOnFieldStrictly().filter(d=>d.canBeTargetOfEffect(e));if(!r.length)return!1;const n=await e.activator.waitSelectEntity(t,"装備するカードを選択。",!1);if(!n)throw new lt("竹光選択",e);const s=await e.activator.duel.view.waitSelectDestination(e.activator,n,i,"装備カードを置く場所を選択。","装備",!1);if(!s)throw new lt("配置場所選択",e);await n.putDirectly(s,"Spell",["Effect"],e.action.entity,e.activator);const l=await e.activator.waitSelectEntity(r,"装備する対象を選択。",!1);if(!l)throw new lt("装備対象選択",e);return n.info.equipedBy=l,n.info.effectTargets[e.action.seq]=[l],l.info.equipEntities.push(n),!0},settle:async()=>!0}]}),a},Hu=()=>{const a=[...Nc(),...Gc(),...Jc(),...Zc(),...Yc(),...ru(),...Ic(),...eu(),...tu(),...iu(),...au(),...su(),...hu(),...ou(),...lu(),...mu(),...cu(),...pu(),...gu(),...yu(),...ku(),...wu(),...Tu(),...bu(),...Eu(),...Du(),...Au(),...xu(),...Mu(),...Pu(),...Bu(),...Fu(),...Ou(),...Lu(),...qu(),...Nu(),...Ru()],e=a.map(i=>i.name);console.info(e);const t=Object.values(Object.groupBy(e,i=>i)).filter(i=>((i==null?void 0:i.length)??2)>1).map(i=>i==null?void 0:i[0]);if(t.length>0)throw new oe("カード定義重複",...t);return a},Bs=new Map;Hu().forEach(a=>{Bs.set(a.name,a)});const wr=Bs,$u=js,St=Object.values($u).reduce((a,e)=>(a[e.name]=e,a),{}),Fs=[{id:-1,name:"サンプルデッキ１",description:"",cardNames:["アンノウン・シンクロン","六武衆のご隠居","ジャンク・フォアード","ジャンク・フォアード","ジャンク・フォアード","チューン・ウォリアー","チューン・ウォリアー","ガード・オブ・フレムベル","ガード・オブ・フレムベル","守護竜ユスティア","守護竜ユスティア","エンジェル・トランペッター","エンジェル・トランペッター","ジェムナイト・サフィア","ジェムナイト・サフィア","魂虎","魂虎","暗黒界の番兵 レンジ","暗黒界の番兵 レンジ","バトルフットボーラー","バトルフットボーラー","球騎士の三人娘","球騎士の三人娘","エンジェル・トランペッター","エンジェル・トランペッター","Ｇ戦隊 シャインブラック","Ｇ戦隊 シャインブラック","しゃりの軍貫","しゃりの軍貫","ジョングルグールの幻術師","ジョングルグールの幻術師","ゾンビーノ","ゾンビーノ","メガロスマッシャーＸ","メガロスマッシャーＸ","ライドロン","ライドロン","機界騎士アヴラム","機界騎士アヴラム","幻のグリフォン","幻のグリフォン","幻殻竜","幻殻竜","アレキサンドライドラゴン","アレキサンドライドラゴン","ジェネティック・ワーウルフ","ジェネティック・ワーウルフ","サイバー・ドラゴン","フロストザウルス","フロストザウルス","フロストザウルス","青眼の白龍","マジカル・アンドロイド","マジカル・アンドロイド","マジカル・アンドロイド","大地の騎士ガイアナイト","大地の騎士ガイアナイト","大地の騎士ガイアナイト","スクラップ・デスデーモン","スクラップ・デスデーモン","スクラップ・デスデーモン","スターダスト・ドラゴン","スターダスト・ドラゴン","スターダスト・ドラゴン","ナチュル・ガオドレイク","ナチュル・ガオドレイク","ナチュル・ガオドレイク"]},{id:-2,name:"サンプルデッキ２",description:"",cardNames:["アンノウン・シンクロン","六武衆のご隠居","ジャンク・フォアード","グローアップ・バルブ","ガード・オブ・フレムベル","伝説の白石","伝説の白石","伝説の白石","守護竜ユスティア","ギャラクシーサーペント","ジェネクス・コントローラー","Ｅ・ＨＥＲＯ フェザーマン","Ｅ・ＨＥＲＯ バーストレディ","チューン・ウォリアー","Ｅ・ＨＥＲＯ クレイマン","Ｅ・ＨＥＲＯ スパークマン","しゃりの軍貫","ジョングルグールの幻術師","ゾンビーノ","ジェネティック・ワーウルフ","ライトロード・ビースト ウォルフ","サイバー・ドラゴン","サイバー・ドラゴン","サイバー・ドラゴン","ラブラドライドラゴン","Ｄ－ＨＥＲＯ ディアボリックガイ","Ｄ－ＨＥＲＯ ディアボリックガイ","Ｄ－ＨＥＲＯ ディアボリックガイ","フロストザウルス","Ｅ・ＨＥＲＯ ネオス","青眼の白龍","青眼の白龍","青眼の白龍","Ｅ－エマージェンシーコール","おろかな埋葬","トレード・イン","トレード・イン","トレード・イン","闇の量産工場","強欲な壺","強欲な壺","強欲な壺","死者蘇生","死者蘇生","死者蘇生","召喚師のスキル","召喚師のスキル","召喚師のスキル","成金ゴブリン","成金ゴブリン","成金ゴブリン","戦士の生還","増援","調和の宝札","調和の宝札","調和の宝札","天使の施し","天使の施し","天使の施し","貪欲な壺","貪欲な壺","貪欲な壺","マジカル・アンドロイド","マジカル・アンドロイド","マジカル・アンドロイド","大地の騎士ガイアナイト","大地の騎士ガイアナイト","大地の騎士ガイアナイト","スクラップ・デスデーモン","スクラップ・デスデーモン","スクラップ・デスデーモン","スターダスト・ドラゴン","スターダスト・ドラゴン","スターダスト・ドラゴン","ナチュル・ガオドレイク","ナチュル・ガオドレイク","ナチュル・ガオドレイク"]}],Ce=class Ce{constructor(e,t){u(this,"id");u(this,"name");u(this,"description");u(this,"lastUsedAt");u(this,"cardNames");u(this,"getIllegalCardNames",()=>Array.from(new Set(this.cardNames.filter(e=>!Object.keys(St).includes(e)))));u(this,"getDisableCardNames",()=>Array.from(new Set(this.cardNames.filter(e=>!Object.keys(St).includes(e)))));u(this,"createCardInfos",()=>{const e=this.getIllegalCardNames();if(e.length>0)throw new Error(`存在しないカード名からデッキを生成しようとした。${e}`);return this.cardNames.map(t=>St==null?void 0:St[t]).filter(t=>t)});u(this,"copy",async()=>Ce.createNewDeck(this.name,this.description,this.cardNames));u(this,"updateTimestamp",async()=>{await Ce.tblHeader.update(this.id,e=>({...e,lastUsedAt:new Date}))});u(this,"saveDeckInfo",async e=>{const t=e??this;await Ce.tblHeader.update(this.id,n=>({...n,name:t.name,description:t.description,lastUsedAt:new Date}));const i=(await Ce.tblDetail.getAll()).filter(n=>n.deckId===this.id);await Ce.tblDetail.delete(i.map(n=>n.id));const r=await Ce.tblDetail.insertMany(t.cardNames.map((n,s)=>({deckId:this.id,seq:s,name:n,description:""})));return new Ce(await Ce.tblHeader.get(this.id),r)});u(this,"delete",async()=>{await Ce.tblHeader.delete([this.id]);const e=(await Ce.tblDetail.getAll()).filter(t=>t.deckId===this.id);await Ce.tblDetail.delete(e.map(t=>t.id))});this.id=e.id,this.name=e.name,this.description=e.description,this.lastUsedAt=e.lastUsedAt,this.cardNames=t.filter(i=>i.deckId===this.id).map(i=>i.name)}};u(Ce,"toJson",e=>{const t=e.map(i=>{const{id:r,name:n,description:s,lastUsedAt:l,cardNames:d}=i;return{id:r,name:n,description:s,lastUsedAt:l,cardNames:d}});return t.forEach(i=>{i.cardNames=i.cardNames.map(r=>St[r]).sort(Vi).map(r=>r.name)}),JSON.stringify(t,null,2)}),u(Ce,"convertToObjectURL",e=>{const t=Ce.toJson(e),i=new Blob([t],{type:"text/plain"});return window.URL.createObjectURL(i)}),u(Ce,"idb"),u(Ce,"tblHeader"),u(Ce,"tblDetail"),u(Ce,"getAllDeckInfo",async e=>{if(e&&(Ce.idb=e),!Ce.idb)throw new Error("illegal argument: idb is undefined.");Ce.tblHeader||(Ce.tblHeader=new Zu(Ce.idb)),Ce.tblDetail||(Ce.tblDetail=new Uu(Ce.idb));const t=await Ce.tblHeader.getAll(),i=await Ce.tblDetail.getAll();return t.length?t.map(r=>new Ce(r,i)):[await Ce.prepareSampleDeck()]}),u(Ce,"createNewDeck",async(e,t,i)=>{const r=await Ce.tblHeader.insert({name:e,description:t,lastUsedAt:new Date}),n=await Ce.tblDetail.insertMany(i.map((s,l)=>({deckId:r.id,seq:l,name:s,description:""})));return new Ce(r,n)}),u(Ce,"prepareSampleDeck",async()=>{const e=Fs.slice(-1)[0];return await Ce.createNewDeck(e.name,e.description,e.cardNames)});let Ot=Ce;class Zu extends Lr{constructor(t){super(t,"TblDeckHeader");u(this,"_prepareInitialRecords",()=>[])}}class Uu extends Lr{constructor(t){super(t,"TblDeckDetail");u(this,"_prepareInitialRecords",()=>[])}}const Tn=Fs.map(a=>({...a,lastUsedAt:new Date})).filter(a=>a.id<0),Gu=a=>a;function ju(a){const e=a-1;return e*e*e+1}function Vu(a,{delay:e=0,duration:t=400,easing:i=Gu}={}){const r=+getComputedStyle(a).opacity;return{delay:e,duration:t,easing:i,css:n=>`opacity: ${n*r}`}}function bn(a,e){for(const t in e)a[t]=e[t];return a}function zu({fallback:a,...e}){const t=new Map,i=new Map;function r(s,l,d){const{delay:o=0,duration:c=ee=>Math.sqrt(ee)*30,easing:v=ju}=bn(bn({},e),d),p=s.getBoundingClientRect(),h=l.getBoundingClientRect(),m=p.left-h.left,C=p.top-h.top,y=p.width/h.width,T=p.height/h.height,w=Math.sqrt(m*m+C*C),E=getComputedStyle(l),B=E.transform==="none"?"":E.transform,U=+E.opacity;return{delay:o,duration:typeof c=="function"?c(w):c,easing:v,css:(ee,J)=>`
			   opacity: ${ee*U};
			   transform-origin: top left;
			   transform: ${B} translate(${J*m}px,${J*C}px) scale(${ee+(1-ee)*y}, ${ee+(1-ee)*T});
		   `}}function n(s,l,d){return(o,c)=>(s.set(c.key,o),()=>{if(l.has(c.key)){const v=l.get(c.key);return l.delete(c.key),r(v,o,c)}return s.delete(c.key),a&&a(o,c,d)})}return[n(i,t,!1),n(t,i,!0)]}var Wu=k("<div></div>"),Yu=k('<div class="duel_card_row svelte-14cfp8z"><div> </div> <div> </div></div>'),Qu=k('<div class="duel_card_row svelte-14cfp8z"><div class="svelte-14cfp8z"></div> <div class="svelte-14cfp8z"> </div></div>'),Ku=k('<div class="duel_card_row svelte-14cfp8z"><div class="svelte-14cfp8z"></div> <div class="svelte-14cfp8z"> </div></div>'),Xu=k('<div class="duel_card_row svelte-14cfp8z"><div> </div> <div> </div></div>'),Ju=k('<div class="duel_card_row svelte-14cfp8z"><div class="svelte-14cfp8z"></div> <div class="svelte-14cfp8z">ペンデュラム</div></div>'),Iu=k('<div class="duel_card_row duel_card_detail svelte-14cfp8z"><div class="svelte-14cfp8z"> </div></div> <div class="duel_card_row duel_card_detail svelte-14cfp8z"><div class="svelte-14cfp8z"></div> <div class="svelte-14cfp8z"><span> </span> / <span> </span></div></div>',1),ed=k('<button><div class="duel_card_body svelte-14cfp8z"><div class="duel_card_row svelte-14cfp8z" style="position:relative"><div class="svelte-14cfp8z"> </div> <div class="svelte-14cfp8z"></div> <!></div> <!> <!> <!> <!></div></button>'),td=k('<button><div class="svelte-14cfp8z">裏守備</div></button>'),id=k('<div class="duel_card duel_card_face_down svelte-14cfp8z"><div class="svelte-14cfp8z">セット</div></div>');function Gt(a,e){ct(e,!1);let t=Le(e,"entity",8),i=Le(e,"state",8,"Disabled"),r=Le(e,"selectedList",28,()=>[]),n=Le(e,"isVisibleForcibly",8,!1),s=Le(e,"isWideMode",8,!1),l=Le(e,"dummyActionInfos",24,()=>[]),d=Le(e,"cardActionResolve",8),o=Le(e,"entitySelectResolve",8,()=>{}),c,v=Ae(!1),p=()=>{},h=Le(e,"qty",12,void 0);const m=K=>{var W;c=K.activator,L(v,!1),h((W=K.entitiesChoices)==null?void 0:W.qty),p=K.resolve};t().field.duel.view.onWaitStart.append(m);let C=Ae(!1);const y=()=>{if(i()!=="Disabled"&&i()==="Selectable"&&h()===1){if(r().some(K=>K.seq!==t().seq)){r([t()]);return}h()===1&&o()&&o()([t()])}},T=K=>{(t().face==="FaceUp"||t().owner===t().field.duel.duelists.Below&&(t().isUnderControl||n()))&&t().field.duel.view.showCardInfo(t(),K??"Normal")},w=()=>{if(T(),console.log(t().toString(),i(),l().length,d()),i()==="Disabled")return;if(i()==="Selectable"){L(v,!f(v)),h()===1&&(r().splice(0),t().duel.view.requireUpdate()),r(f(v)?[...r(),t()]:r().filter(W=>W!==t()));return}if(l().length===0)return;if(l().length===1){const W=l()[0];if(d()){d()(W);return}console.log(t().toString(),i(),l().length,p),p({actionInfo:W});return}if(!c)return;t().field.duel.view.modalController.actionSelector.show({title:"行動を選択。",activator:c,dummyActionInfos:l(),cancelable:!0}).then(W=>{W&&p({actionInfo:W})})},E=K=>{var W;window.getSelection&&((W=window.getSelection())==null||W.removeAllRanges()),console.info("drag start",K,l()),t().field.duel.view.setDraggingActions(l()),L(C,!0)},B=K=>{console.info("drag end",K,l()),t().field.duel.view.removeDraggingActions(),K.dataTransfer&&L(C,!1)},U=()=>(T("Debug"),!1);Ct();var ee=Oe(),J=I(ee);{var q=K=>{var W=ed(),Ne=g(W),Y=g(Ne),R=g(Y),P=g(R),G=_(R,4);se(G,1,()=>t().attr,ne,(V,z)=>{var M=Wu();A(()=>Ee(M,`monster_attr ${f(z)??""} svelte-14cfp8z`)),S(V,M)});var X=_(Y,2);{var ae=V=>{var z=Yu(),M=g(z),x=g(M),Q=_(M,2),re=g(Q);A((O,j)=>{Ee(M,Ci(t().lvl!==t().origin.level?"different_from_its_origin":""),"svelte-14cfp8z"),D(x,O),Ee(Q,Ci(t().rank!==t().origin.rank?"different_from_its_origin":""),"svelte-14cfp8z"),D(re,j)},[()=>"★".repeat(t().lvl||0),()=>"☆".repeat(t().rank||0)],we),S(V,z)},me=V=>{var z=Oe(),M=I(z);{var x=re=>{var O=Qu(),j=_(g(O),2),ue=g(j);A(()=>D(ue,`${ra[t().status.spellCategory]??""}魔法`)),S(re,O)},Q=re=>{var O=Oe(),j=I(O);{var ue=Se=>{var de=Ku(),pe=_(g(de),2),le=g(pe);A(()=>D(le,`${na[t().status.trapCategory]??""}罠`)),S(Se,de)};N(j,Se=>{t().status.kind==="Trap"&&t().status.trapCategory&&Se(ue)},!0)}S(re,O)};N(M,re=>{t().status.kind==="Spell"&&t().status.spellCategory?re(x):re(Q,!1)},!0)}S(V,z)};N(X,V=>{t().status.kind==="Monster"?V(ae):V(me,!1)})}var _e=_(X,2);{var ge=V=>{var z=Xu(),M=g(z),x=g(M),Q=_(M,2),re=g(Q);A(()=>{Ee(M,Ci(t().psL!==t().origin.pendulumScaleL?"different_from_its_origin":""),"svelte-14cfp8z"),D(x,`◀ ${t().psL??""}`),Ee(Q,Ci(t().psR!==t().origin.pendulumScaleR?"different_from_its_origin":""),"svelte-14cfp8z"),D(re,`${t().psR??""} ▶`)}),S(V,z)};N(_e,V=>{var z;(z=t().status.monsterCategories)!=null&&z.includes("Pendulum")&&V(ge)})}var b=_(_e,2);{var H=V=>{var z=Ju();S(V,z)};N(b,V=>{t().status.kind==="Spell"&&t().isPendulumScale&&V(H)})}var Z=_(b,2);{var te=V=>{var z=Iu(),M=I(z),x=g(M),Q=g(x),re=_(M,2),O=_(g(re),2),j=g(O),ue=g(j),Se=_(j,2),de=g(Se);A((pe,le)=>{D(Q,`${pe??""}
            ${le??""}`),Ee(j,Ci(t().atk!==t().origin.attack?"different_from_its_origin":""),"svelte-14cfp8z"),D(ue,t().atk??"?"),Ee(Se,Ci(t().def!==t().origin.defense?"different_from_its_origin":""),"svelte-14cfp8z"),D(de,t().def??"?")},[()=>t().types.map(pe=>sa[pe]+(s()?ja[pe]:"")).join(),()=>{var pe;return(pe=t().status.monsterCategories)==null?void 0:pe.map(le=>aa[le]+(s()?Ga[le]:"")).join()}],we),S(V,z)};N(Z,V=>{t().status.kind==="Monster"&&V(te)})}A(V=>{Ee(W,`duel_card button_style_reset ${t().origin.kind??""} ${V??""} ${(f(v)?"duel_card_selected":"")??""} ${i()??""} duel_card_${t().orientation??""} ${(f(C)?"isDragging":"")??""} ${(s()?"duel_card_wide":"")??""} duel_card_${t().face??""} ${(t().isOnField?"duel_card_is_on_field":"")??""} svelte-14cfp8z`),Wt(W,"draggable",i()==="Draggable"),Wt(W,"title",t().nm),D(P,t().nm)},[()=>{var V;return((V=t().status.monsterCategories)==null?void 0:V.join(" "))||""}],we),De("dragstart",W,E),De("dragend",W,B),De("click",W,w),De("dblclick",W,y),De("mouseenter",W,()=>T()),De("contextmenu",W,U),S(K,W)},ie=K=>{var W=Oe(),Ne=I(W);{var Y=P=>{var G=td();A(()=>Ee(G,`duel_card duel_card_face_down duel_card_face_down_defense ${i()??""}  ${(f(v)?"duel_card_selected":"")??""} svelte-14cfp8z`)),De("click",G,w),De("dblclick",G,y),S(P,G)},R=P=>{var G=id();S(P,G)};N(Ne,P=>{t().battlePosition==="Set"?P(Y):P(R,!1)},!0)}S(K,W)};N(J,K=>{t().face==="FaceUp"||n()||t().controller.duelistType==="Player"&&t().isUnderControl?K(q):K(ie,!1)})}S(a,ee),ut()}var ad=k('<div class="phase_display svelte-1mv96a1"><span class="svelte-1mv96a1"> </span> </div>'),rd=k('<div class="lifepoint_display svelte-1mv96a1"><div class="svelte-1mv96a1"> </div> <div class="svelte-1mv96a1"> </div></div>'),nd=(a,e,t)=>e(f(t)),sd=k('<div class="svelte-1mv96a1"><button class="phase_button svelte-1mv96a1"> </button></div>'),ld=k("<div><!></div>"),od=k('<div class="svelte-1mv96a1"><!></div>'),cd=k("<div><!></div>"),ud=k("<!> <!> <!>",1),dd=k('<div style="position: absolute;" class="card_animation_receiver svelte-1mv96a1"><!></div>'),fd=k('<div style="position: absolute; top:0rem" class="svelte-1mv96a1">｛効果対象｝</div>'),vd=k('<!> <div style="position: absolute; display:flex;justify-content: center;" class="svelte-1mv96a1"><!></div>',1),pd=k(" <!> 】",1),hd=k('<div style="position: absolute; bottom:0rem" class="svelte-1mv96a1"> <!></div>'),gd=k("<!> <!>",1),yd=k('<div class="badge svelte-1mv96a1"> </div>'),md=k('<div class="card_animation_receiver svelte-1mv96a1"><!></div>'),_d=k("<!> <!> <!> <!>",1),Sd=k('<td><div role="listitem"><!></div></td>');function Cd(a,e){ct(e,!1);let t=Le(e,"view",8),i=Le(e,"row",8),r=Le(e,"column",8),n=Le(e,"selectedEntities",28,()=>[]),s=Le(e,"selectedCells",28,()=>[]),l=Ae(t().getCell(i(),r()));const d=()=>{L(l,t().getCell(i(),r()))};f(l).onUpdate.append(d),t().onDuelUpdate.append(d),t().modalController.onUpdate.append(d);let o,c=Ae([]),v=()=>{},p,h=Ae([]),m=Ae(!1),C=Ae(!1),y=!1;const T=b=>{var H,Z;L(ie,[]),n().reset(),o=b.activator,v=b.resolve,L(c,b.dummyActionInfos),L(h,b.chainBlockInfos.flatMap(te=>te.selectedEntities).getDistinct()),p=b.entitiesChoices,L(m,!1),L(C,((H=b.cellsChoices)==null?void 0:H.selectables.includes(f(l)))??!1),y=f(C)&&((Z=b.cellsChoices)==null?void 0:Z.qty)===1};t().onWaitStart.append(T);const w=()=>{o=void 0,L(c,[]),v=()=>{},p=void 0,L(h,[]),L(m,!1),L(C,!1),y=!1};t().onWaitEnd.append(w);let E=Ae(!1),B=[];const U=b=>{B=b.filter(H=>H.dests.includes(f(l))),L(E,B.length>0),d()},ee=()=>{B=[],L(E,!1),d()};t().onDragStart.append(U),t().onDragEnd.append(ee);const[J,q]=Df;let ie=Ae([]);const K=b=>{if(o=void 0,f(l)===b.to||f(l).entities.includes(b.entity)){L(ie,[...f(ie),b]);const H=b.resolve;L(l,f(l)),setTimeout(()=>{L(ie,f(ie).filter(Z=>Z!==b)),b.count++,b.count>1&&H()},600)}};t().onAnimation.append(K);const W=b=>{v({phaseChange:b})},Ne=()=>f(l).isStackCell&&f(l).entities.flatMap(b=>b.actions).filter(b=>f(c).map(H=>H.action.seq).some(H=>H===b.seq)).length>0,Y=()=>{if(We(l,f(l).field.duel.view.infoBoardState="Log"),y)v({selectedCells:[f(l)]});else if(f(C))L(m,!f(m)),s(f(m)?[...s(),f(l)]:s().filter(b=>b!==f(l)));else if(f(l).isStackCell){We(l,f(l).field.duel.view.infoBoardState="CellInfo"),We(l,f(l).field.duel.view.infoBoardCell=f(l)),f(l).field.duel.view.requireUpdate();const b=f(l).entities.flatMap(Z=>Z.actions).map(Z=>Z.seq),H=f(c).filter(Z=>b.includes(Z.action.seq));if(H.length){if(!o)return;f(l).field.duel.view.modalController.actionSelector.show({title:"カードを選択。",activator:o,dummyActionInfos:H,cancelable:!0}).then(te=>{te&&v({actionInfo:te})});return}}f(l).field.duel.view.requireUpdate(),console.info(f(l))},R=b=>{b.preventDefault(),b.dataTransfer&&(b.dataTransfer.dropEffect="move")},P=b=>{b.preventDefault(),console.info("drop",b,f(E),B),b.dataTransfer&&(b.dataTransfer.dropEffect="move");try{if(f(E)&&B){if(B.length===1){const H=B[0];v({actionInfo:{...H,dest:f(l)}})}else if(B.length>1){if(!o)throw new oe("想定されない状態");f(l).field.duel.view.modalController.terminateAll(),f(l).field.duel.view.modalController.actionSelector.show({title:"選択",activator:o,dummyActionInfos:B.map(H=>({...H,dest:f(l)})),cancelable:!1}).then(H=>{v({actionInfo:H})})}}}finally{t().removeDraggingActions()}},G=(...b)=>{if(t().waitMode==="Animation")return"Disabled";if(p&&p.selectables.find(Z=>b.find(te=>Z===te)))return"Selectable";if(!f(c)||f(c).length===0||t().waitMode!=="Free"||Object.values(t().modalController.modals).some(Z=>Z.state==="Shown"))return"Disabled";const H=f(c).filter(Z=>b.includes(Z.action.entity));return H.length===0?"Disabled":f(l).isStackCell||H[0].action.entity!==b[0]?"Clickable":H.some(Z=>Z.dests.length)?"Draggable":"Clickable"};Ct();var X=Sd(),ae=g(X);ae.__click=Y;var me=g(ae);{var _e=b=>{var H=Oe(),Z=I(H);{var te=V=>{var z=Oe(),M=I(z);{var x=re=>{var O=ad(),j=g(O),ue=g(j),Se=_(j,1,!0);A((de,pe)=>{D(ue,de),D(Se,pe)},[()=>String(f(l).field.duel.clock.turn).padStart(2,"0"),()=>f(l).field.duel.phase.toUpperCase()],we),S(re,O)},Q=re=>{var O=Oe(),j=I(O);{var ue=de=>{var pe=rd(),le=g(pe),je=g(le),Ve=_(le,2),tt=g(Ve);A(()=>{D(je,f(l).field.duel.duelists.Above.lp),D(tt,f(l).field.duel.duelists.Below.lp)}),S(de,pe)},Se=de=>{var pe=Oe(),le=I(pe);{var je=Ve=>{var tt=Oe(),_t=I(tt);{var at=Qe=>{var rt=Oe(),Be=I(rt);{var Fe=be=>{var ce=Oe(),he=I(ce);se(he,1,()=>t().duel.nextPhaseList,ne,($e,ze)=>{var Ke=sd(),kt=g(Ke);kt.__click=[nd,W,ze];var F=g(kt);A($=>D(F,$),[()=>f(ze).toUpperCase()],we),S($e,Ke)}),S(be,ce)};N(Be,be=>{t().duel.isEnded||be(Fe)})}S(Qe,rt)};N(_t,Qe=>{t().waitMode==="Free"&&Qe(at)})}S(Ve,tt)};N(le,Ve=>{f(l).column===5&&Ve(je)},!0)}S(de,pe)};N(j,de=>{f(l).column===3?de(ue):de(Se,!1)},!0)}S(re,O)};N(M,re=>{f(l).column===1?re(x):re(Q,!1)})}S(V,z)};N(Z,V=>{f(l).row===3&&V(te)})}S(b,H)},ge=b=>{var H=Oe(),Z=I(H);{var te=z=>{var M=ud();const x=we(()=>f(ie).find(Se=>Se.to===f(l)));var Q=I(M);{var re=Se=>{var de=ld(),pe=g(de);Gt(pe,{get entity(){return f(x).entity},state:"Disabled",dummyActionInfos:[],cardActionResolve:void 0}),A(()=>Ee(de,`card_animation_receiver ${f(l).cellType??""} svelte-1mv96a1`)),si(1,de,()=>q,()=>({key:f(x).entity.seq})),S(Se,de)};N(Q,Se=>{f(x)&&f(x).index==="Top"&&Se(re)})}var O=_(Q,2);se(O,1,()=>f(l).visibleEntities,ne,(Se,de)=>{var pe=Oe(),le=I(pe);{var je=Ve=>{var tt=od(),_t=g(tt);const at=we(()=>G(f(de))),Qe=we(()=>f(c).filter(rt=>rt.action.entity===f(de)));Gt(_t,{get entity(){return f(de)},get state(){return f(at)},get dummyActionInfos(){return f(Qe)},cardActionResolve:void 0,get selectedList(){return n()},set selectedList(rt){n(rt)},$$legacy:!0}),si(2,tt,()=>J,()=>({key:f(de).seq})),S(Ve,tt)};N(le,Ve=>{f(ie).every(tt=>tt.entity.seq!==f(de).seq)&&Ve(je)})}S(Se,pe)});var j=_(O,2);{var ue=Se=>{var de=cd(),pe=g(de);Gt(pe,{get entity(){return f(x).entity},state:"Disabled",dummyActionInfos:[],cardActionResolve:void 0}),A(()=>Ee(de,`card_animation_receiver ${f(l).cellType??""} svelte-1mv96a1`)),si(1,de,()=>q,()=>({key:f(x).entity.seq})),S(Se,de)};N(j,Se=>{f(x)&&f(x).index!=="Top"&&Se(ue)})}S(z,M)},V=z=>{var M=_d();const x=we(()=>f(ie).find(le=>le.to===f(l)));var Q=I(M);{var re=le=>{var je=dd(),Ve=g(je);Gt(Ve,{get entity(){return f(x).entity},state:"Disabled",dummyActionInfos:[],cardActionResolve:void 0}),si(1,je,()=>q,()=>({key:f(x).entity.seq})),S(le,je)};N(Q,le=>{f(x)&&f(x).index!=="Top"&&le(re)})}var O=_(Q,2);{var j=le=>{var je=gd(),Ve=I(je);se(Ve,1,()=>f(l).visibleEntities.map((at,Qe)=>({index:Qe,entity:at})).toReversed(),ne,(at,Qe)=>{var rt=Oe(),Be=I(rt);{var Fe=be=>{var ce=vd(),he=I(ce);{var $e=$=>{var Re=fd();S($,Re)};N(he,$=>{f(h).includes(f(Qe).entity)&&$($e)})}var ze=_(he,2),Ke=g(ze);const kt=we(()=>!f(l).isStackCell&&f(Qe).index===0?G(...f(l).visibleEntities):void 0),F=we(()=>f(Qe).index===0?f(c).filter($=>f(l).visibleEntities.includes($.action.entity)):void 0);Gt(Ke,{get entity(){return f(Qe).entity},get state(){return f(kt)},get dummyActionInfos(){return f(F)},cardActionResolve:void 0,get selectedList(){return n()},set selectedList($){n($)},$$legacy:!0}),si(2,ze,()=>J,()=>({key:f(Qe).entity.seq})),S(be,ce)};N(Be,be=>{f(ie).every(ce=>ce.entity.seq!==f(Qe).entity.seq)&&be(Fe)})}S(at,rt)});var tt=_(Ve,2);{var _t=at=>{var Qe=hd(),rt=g(Qe),Be=_(rt);se(Be,1,()=>Object.keys(f(l).visibleEntities[0].status.maxCounterQty),ne,(Fe,be)=>{var ce=pd(),he=I(ce),$e=_(he);{var ze=Ke=>{var kt=ni();A(()=>D(kt,`/${f(l).visibleEntities[0].status.maxCounterQty[f(be)]??""}`)),S(Ke,kt)};N($e,Ke=>{(f(l).visibleEntities[0].status.maxCounterQty[f(be)]??!1)&&Ke(ze)})}A(Ke=>D(he,`【
              ${ic[f(be)]??""}${Ke??""} `),[()=>f(l).visibleEntities[0].counterHolder.getQty(f(be))],we),S(Fe,ce)}),A(()=>D(rt,`【${f(l).visibleEntities[0].battlePositionName??""}】 `)),S(at,Qe)};N(tt,at=>{f(l).visibleEntities[0].battlePosition&&at(_t)})}S(le,je)};N(O,le=>{f(l).visibleEntities.length>0&&le(j)})}var ue=_(O,2);{var Se=le=>{var je=yd(),Ve=g(je);A(()=>D(Ve,f(l).visibleEntities.length)),S(le,je)};N(ue,le=>{f(l).isStackCell&&le(Se)})}var de=_(ue,2);{var pe=le=>{var je=md(),Ve=g(je);Gt(Ve,{get entity(){return f(x).entity},state:"Disabled",dummyActionInfos:[],cardActionResolve:void 0}),si(1,je,()=>q,()=>({key:f(x).entity.seq})),S(le,je)};N(de,le=>{f(x)&&f(x).index==="Top"&&le(pe)})}S(z,M)};N(Z,z=>{f(l).cellType==="Hand"?z(te):z(V,!1)},!0)}S(b,H)};N(me,b=>{f(l).isDisabledCell?b(_e):b(ge,!1)})}A(b=>{Ee(X,`${`duel_field_cell duel_field_cell_${f(l).cellType} ${f(l).linkArrowSources.length===0?"":"duel_field_cell_linked"}`??""} svelte-1mv96a1`),Wt(X,"colspan",f(l).cellType==="Hand"?7:1),Ee(ae,`${b??""} svelte-1mv96a1`)},[()=>`duel_card_wrapper ${f(l).cellType} ${f(E)?"can_accept_drop":""} ${Ne()?"can_action":""} ${f(m)?"is_selected":f(C)?"is_selectable":""} `],we),De("dragover",ae,R),De("drop",ae,P),S(a,X),ut()}Hi(["click"]);var kd=k('<div class="title svelte-1sjjr5s"> </div>'),wd=k('<div class="title svelte-1sjjr5s"> </div>'),Td=k('<div class="duel_log_record svelte-1sjjr5s"> </div>'),bd=k('<div><div style=" white-space: nowrap;text-align: center;"> </div> <!></div>'),Ed=k("<div><!> <!></div>"),Dd=k("<div><!> <!></div>"),Ad=k('<div class="duel_log svelte-1sjjr5s"><div class="duel_log_header svelte-1sjjr5s"></div> <div class="duel_log_body svelte-1sjjr5s"></div> <div class="duel_log_footer svelte-1sjjr5s"></div></div>');function xd(a,e){ct(e,!1);let t=Ae(void 0),i=Le(e,"log",8),r,n=Ae([]);const s=()=>{const c=((r==null?void 0:r.seq)??-1)+1;i().records.slice(c).forEach(v=>{if(!r){L(n,[[[[v]]]]),r=v;return}if(!f(n)[v.clock.turn]){We(n,f(n)[v.clock.turn]=[[[v]]]),r=v;return}if(!f(n)[v.clock.turn][v.clock.phaseSeq]){We(n,f(n)[v.clock.turn][v.clock.phaseSeq]=[[v]]),r=v;return}if(r.clock.chainSeq===v.clock.chainSeq&&r.clock.chainBlockSeq===v.clock.chainBlockSeq&&r.duelist===v.duelist){f(n)[v.clock.turn][v.clock.phaseSeq].slice(-1)[0].push(v),r=v;return}f(n)[v.clock.turn][v.clock.phaseSeq].push([v]),r=v}),L(n,f(n)),Gl().then(()=>f(t)&&f(t).scroll(0,f(t).clientHeight*990))};i().onUpdate.append(s),i().duel.view.onDuelUpdate.append(s),Ct();var l=Oe(),d=I(l);{var o=c=>{var v=Ad(),p=_(g(v),2);se(p,5,()=>f(n),ne,(h,m)=>{var C=Dd(),y=g(C);{var T=E=>{var B=kd(),U=g(B);A(()=>D(U,`ターン：${f(m)[0][0][0].clock.turn??""}`)),S(E,B)};N(y,E=>{f(m)[0][0][0].clock.turn>0&&E(T)})}var w=_(y,2);se(w,1,()=>f(m),ne,(E,B)=>{var U=Ed(),ee=g(U);{var J=ie=>{var K=wd(),W=g(K);A(()=>D(W,f(B)[0][0].clock.period.name)),S(ie,K)};N(ee,ie=>{f(B)[0][0].clock.turn>0&&ie(J)})}var q=_(ee,2);se(q,1,()=>f(B),ne,(ie,K)=>{var W=bd(),Ne=g(W),Y=g(Ne),R=_(Ne,2);se(R,1,()=>f(K),ne,(P,G)=>{var X=Td(),ae=g(X);A(()=>D(ae,f(G).text)),S(P,X)}),A(()=>{var P,G,X;Ee(W,`duel_log_block_duelist duel_log_block_duelist_${((P=f(K)[0].duelist)==null?void 0:P.seat)??"system"} svelte-1sjjr5s`),Ee(Ne,`duelist ${((G=f(K)[0].duelist)==null?void 0:G.seat)??""} svelte-1sjjr5s`),D(Y,((X=f(K)[0].duelist)==null?void 0:X.profile.name)||"SYSTEM")}),S(ie,W)}),A(()=>Ee(U,`duel_log_block_phase duel_log_block_phase_${f(B)[0][0].clock.period.key??""} svelte-1sjjr5s`)),S(E,U)}),A(()=>Ee(C,`duel_log_block_turn duel_log_block_turn_${f(m)[0][0][0].clock.turn??""} svelte-1sjjr5s`)),S(h,C)}),yo(p,h=>L(t,h),()=>f(t)),S(c,v)};N(d,c=>{i().duel.view.infoBoardState==="Log"&&c(o)})}S(a,l),ut()}var Md=k('<div><div class="duelist_name svelte-1u7codf"> </div> <div> </div></div>');function En(a,e){ct(e,!1);let t=Le(e,"duelist",12),i=Ae(0),r=Ae();const n=async()=>{const p=t().lp-f(i);if(!f(r)||Math.abs(p)<10){L(i,t().lp),f(r)&&(f(r)(),L(r,void 0));return}L(i,f(i)+Math.floor(Math.random()*p)),await Ec(100),n()},s=()=>{t(t()),!f(r)&&t().lp!==f(i)&&new Promise(p=>{L(r,p),Math.abs(t().lp-f(i)),n()})};t().duel.log.onUpdate.append(s),n(),Ct();var l=Md(),d=g(l),o=g(d),c=_(d,2),v=g(c);A(()=>{Ee(l,`duelist ${t().seat??""} svelte-1u7codf`),D(o,t().profile.name),Ee(c,`duelist_lp ${(f(r)?"vibration":"")??""} svelte-1u7codf`),D(v,f(i))}),S(a,l),ut()}const Pd=(a,e,t)=>{e.resolve(f(t))};var Bd=k("<div><!></div>"),Fd=k("<div></div>"),Od=(a,e)=>e.resolve(void 0),Ld=k('<button class="svelte-ynkuoo">Cancel</button>'),qd=k('<div class="modal_window svelte-ynkuoo"><div> </div> <!> <div><button class="svelte-ynkuoo">OK</button> <!></div></div>');function Nd(a,e){ct(e,!0);let t=Tl(Jt([])),i=e.args.chainBlockInfos.flatMap(l=>l.selectedEntities).getDistinct();var r=Oe(),n=I(r);{var s=l=>{var d=qd(),o=g(d),c=g(o),v=_(o,2);se(v,17,()=>e.args.entitiesChoices.selectables.map(y=>y.controller.seat).getDistinct(),ne,(y,T)=>{var w=Fd();se(w,21,()=>e.args.entitiesChoices.selectables.filter(E=>E.controller.seat===f(T)).toSorted(Es),ne,(E,B)=>{var U=Bd(),ee=g(U);Gt(ee,{get entity(){return f(B)},isVisibleForcibly:!0,state:"Selectable",entitySelectResolve:J=>e.resolve(J),get qty(){return e.args.entitiesChoices.qty},cardActionResolve:void 0,get selectedList(){return f(t)},set selectedList(J){L(t,Jt(J))}}),A(J=>Ee(U,`entities_list_item ${J??""} svelte-ynkuoo`),[()=>i.includes(f(B))?"effect_target":""]),S(E,U)}),A(()=>Ee(w,`entities_list ${f(T)??""} svelte-ynkuoo`)),S(y,w)});var p=_(v,2),h=g(p);h.__click=[Pd,e,t];var m=_(h,2);{var C=y=>{var T=Ld();T.__click=[Od,e],S(y,T)};N(m,y=>{e.args.entitiesChoices.cancelable&&y(C)})}A(y=>{D(c,e.args.title),h.disabled=y},[()=>!e.args.entitiesChoices.validator(f(t))]),S(l,d)};N(n,l=>{l(s)})}S(a,r),ut()}Hi(["click"]);var Rd=k('<div class="duel_card_wrapper svelte-1k3dhp1"><!> <div> </div></div>'),Hd=(a,e)=>e()(),$d=k('<div><button class="cancel_button svelte-1k3dhp1">Cancel</button></div>'),Zd=k('<div class="modal_window svelte-1k3dhp1"><div> </div> <div class="flex svelte-1k3dhp1" style="display: flex;"></div> <!></div>');function Ud(a,e){ct(e,!1);let t=Le(e,"view",8),i=Le(e,"args",8),r=Le(e,"resolve",8),n=mo(!1);const s=()=>n.set(!0),l=()=>n.set(!1);t().onDragStart.append(s),t().onDragEnd.append(l),Ct();var d=Oe(),o=I(d);{var c=v=>{var p=Zd(),h=g(p),m=g(h),C=_(h,2);se(C,5,()=>i().dummyActionInfos,ne,(w,E)=>{var B=Rd(),U=g(B);const ee=we(()=>f(E).dests.length?"Draggable":"Clickable"),J=we(()=>i().dragAndDropOnly?[]:[f(E)]);Gt(U,{get entity(){return f(E).action.entity},isVisibleForcibly:!0,get state(){return f(ee)},get dummyActionInfos(){return f(J)},get cardActionResolve(){return r()}});var q=_(U,2),ie=g(q);A(()=>D(ie,`«${f(E).action.title??""}»`)),S(w,B)});var y=_(C,2);{var T=w=>{var E=$d(),B=g(E);B.__click=[Hd,r],S(w,E)};N(y,w=>{i().cancelable&&w(T)})}A(()=>D(m,i().title)),S(v,p)};N(o,v=>{v(c)})}S(a,d),ut()}Hi(["click"]);var Gd=(a,e,t)=>e()(t()),jd=k('<li><button class="svelte-1w70c2f"> </button></li>'),Vd=(a,e)=>e()(void 0),zd=k('<button class="svelte-1w70c2f">Cancel</button>'),Wd=k('<div class="modal_window svelte-1w70c2f"><div class="svelte-1w70c2f"> </div> <ui class="text_list svelte-1w70c2f"></ui> <!></div>');function Yd(a,e){ct(e,!1);let t=Le(e,"arg",8),i=Le(e,"resolve",8);Ct();var r=Oe(),n=I(r);{var s=l=>{var d=Wd(),o=g(d),c=g(o),v=_(o,2);se(v,5,()=>t().choises,ne,(m,C)=>{let y=()=>f(C).seq,T=()=>f(C).text;var w=jd(),E=g(w);E.__click=[Gd,i,y];var B=g(E);A(()=>{Ee(w,`text_item ${y()??""} svelte-1w70c2f`),D(B,T())}),S(m,w)});var p=_(v,2);{var h=m=>{var C=zd();C.__click=[Vd,i],S(m,C)};N(p,m=>{t().cancelable&&m(h)})}A(()=>D(c,t().title)),S(l,d)};N(n,l=>{l(s)})}S(a,r),ut()}Hi(["click"]);const Qd=(a,e)=>{e().modals.forEach(t=>t.cancel())};var Kd=k('<button class="overlay svelte-5wiqd8">☆</button> <!> <!> <!>',1),Xd=k('<div class="base svelte-5wiqd8"><!></div>');function Jd(a,e){var l,d;ct(e,!1);let t=Le(e,"modalController",12);const i=()=>{t(t())};(d=(l=t())==null?void 0:l.onUpdate)==null||d.append(i),Ct();var r=Xd(),n=g(r);{var s=o=>{var c=Kd(),v=I(c);v.__click=[Qd,t];var p=_(v,2);{var h=w=>{Nd(w,{get args(){return t().entitySelector.args},get resolve(){return t().entitySelector.resolve}})};N(p,w=>{t().entitySelector.state==="Shown"&&w(h)})}var m=_(p,2);{var C=w=>{Ud(w,{get view(){return t().view},get args(){return t().actionSelector.args},get resolve(){return t().actionSelector.resolve}})};N(m,w=>{t().actionSelector.state==="Shown"&&w(C)})}var y=_(m,2);{var T=w=>{Yd(w,{get arg(){return t().textSelector.args},get resolve(){return t().textSelector.resolve}})};N(y,w=>{t().textSelector.state==="Shown"&&w(T)})}S(o,c)};N(n,o=>{t().modals.some(c=>c.state==="Shown")&&o(s)})}S(a,r),ut()}Hi(["click"]);const Id=(a,e)=>(e(e()==="Normal"?"Debug":"Normal"),!0);var ef=k('<div class="duel_card_info_row svelte-1qknre5"><div class="svelte-1qknre5"><pre class="description svelte-1qknre5"> </pre></div></div> <div class="duel_card_info_row svelte-1qknre5" style=" justify-content: space-between;"><div class="svelte-1qknre5"> </div> <div class="svelte-1qknre5"> </div></div>',1),tf=k('<div></div> <div class="svelte-1qknre5"> </div>',1),af=k("<div> </div>"),rf=k("<div> </div>"),nf=k('<div class="duel_card_info_row svelte-1qknre5"><!> <!></div> <div class="duel_card_info_row svelte-1qknre5"></div>',1),sf=k('<div class="duel_card_row svelte-1qknre5"><div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"> </div></div>'),lf=k('<div class="duel_card_row svelte-1qknre5"><div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"> </div></div>'),of=k("<!> <!>",1),cf=k('<div class="duel_card_info_row svelte-1qknre5"><div class="svelte-1qknre5"><pre class="description svelte-1qknre5"> </pre></div></div>'),uf=k('<div class="svelte-1qknre5"> </div>'),df=k('<div class="svelte-1qknre5"> </div>'),ff=k('<div class="svelte-1qknre5"> </div>'),vf=k('<div class="svelte-1qknre5"> </div>'),pf=k('<div class="svelte-1qknre5"> </div>'),hf=k('<div class="svelte-1qknre5"> </div>'),gf=k('<div class="svelte-1qknre5"> </div>'),yf=k('<div class="svelte-1qknre5"> </div>'),mf=k('<div class="duel_card_info_row svelte-1qknre5"><div class="svelte-1qknre5"><div class="svelte-1qknre5"></div> <!> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"></div> <!> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"></div> <!> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"></div> <!> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"></div> <!> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"></div> <!> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"></div> <!> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"></div> <!> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"></div> <div class="svelte-1qknre5"> </div> <div class="svelte-1qknre5"> </div> <div class="svelte-1qknre5"> </div> <div class="svelte-1qknre5"></div></div></div>'),_f=k('<div class="svelte-1qknre5">※テスト用カードです</div>'),Sf=k('<div class="duel_card_info_links svelte-1qknre5"><a target="_blank" rel="noopener noreferrer" title="遊戯王カードWiki" class="svelte-1qknre5">⇒遊戯王カードWiki</a> <a target="_blank" rel="noopener noreferrer" title="コナミカードデータベース" class="svelte-1qknre5"> </a></div>'),Cf=k('<div role="contentinfo"><div class="duel_card_info_header svelte-1qknre5"><div class="duel_card_info_row svelte-1qknre5"><div class="svelte-1qknre5"> </div></div> <div class="duel_card_info_row svelte-1qknre5" style="position:sticky; top:0;"><div class="svelte-1qknre5"> </div> <div class="svelte-1qknre5"> </div></div> <!></div> <div class="duel_card_info_body svelte-1qknre5"><!></div> <div class="duel_card_info_footer svelte-1qknre5"><!></div></div>');function kf(a,e){ct(e,!1);let t=Le(e,"entity",8,void 0);const i=()=>t()?St[t().origin.name]:void 0,r=()=>{var o;return t()&&(t().origin.cardId??!1)?`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=2&cid=${t().origin.cardId}`:`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=1&sess=1&rp=10&mode=&sort=1&keyword=${(o=i())==null?void 0:o.name}&stype=1&ctype=&othercon=2&starfr=&starto=&pscalefr=&pscaleto=&linkmarkerfr=&linkmarkerto=&link_m=2&atkfr=&atkto=&deffr=&defto=&releaseDStart=1&releaseMStart=1&releaseYStart=1999&releaseDEnd=&releaseMEnd=&releaseYEnd=`};let n=Le(e,"mode",12,"Normal");Ct();var s=Oe(),l=I(s);{var d=o=>{var c=Cf();c.__contextmenu=[Id,n];var v=g(c),p=g(v),h=g(p),m=g(h),C=_(p,2),y=g(C),T=g(y),w=_(y,2),E=g(w),B=_(C,2);{var U=R=>{var P=of(),G=I(P);{var X=ge=>{var b=ef(),H=I(b),Z=g(H),te=g(Z),V=g(te),z=_(H,2),M=g(z),x=g(M),Q=_(M,2),re=g(Q);A(()=>{D(V,St[t().origin.name].pendulumDescription),D(x,`◀ ${t().psL??""}`),D(re,`${t().psR??""} ▶`)}),S(ge,b)};N(G,ge=>{var b;(b=t().status.monsterCategories)!=null&&b.includes("Pendulum")&&ge(X)})}var ae=_(G,2);{var me=ge=>{var b=nf(),H=I(b),Z=g(H);se(Z,1,()=>t().attr,ne,(z,M)=>{var x=tf(),Q=I(x),re=_(Q,2),O=g(re);A(()=>{Ee(Q,`monster_attr ${f(M)??""} svelte-1qknre5`),D(O,`${qr[f(M)]??""}属性`)}),S(z,x)});var te=_(Z,2);se(te,1,()=>t().types,ne,(z,M)=>{var x=af(),Q=g(x);A(()=>{Ee(x,`monster_cat ${f(M)??""} svelte-1qknre5`),D(Q,`${sa[f(M)]??""}${ja[f(M)]??""}族`)}),S(z,x)});var V=_(H,2);se(V,5,()=>t().status.monsterCategories??[],ne,(z,M)=>{var x=rf(),Q=g(x);A(()=>{Ee(x,`monster_cat ${f(M)??""} svelte-1qknre5`),D(Q,`${aa[f(M)]??""}${Ga[f(M)]??""}`)}),S(z,x)}),S(ge,b)},_e=ge=>{var b=Oe(),H=I(b);{var Z=V=>{var z=sf(),M=_(g(z),2),x=g(M);A(()=>D(x,`${ra[t().status.spellCategory]??""}魔法`)),S(V,z)},te=V=>{var z=Oe(),M=I(z);{var x=Q=>{var re=lf(),O=_(g(re),2),j=g(O);A(()=>D(j,`${na[t().status.trapCategory]??""}罠`)),S(Q,re)};N(M,Q=>{t().status.kind==="Trap"&&t().status.trapCategory&&Q(x)},!0)}S(V,z)};N(H,V=>{t().status.kind==="Spell"&&t().status.spellCategory?V(Z):V(te,!1)},!0)}S(ge,b)};N(ae,ge=>{t().status.kind==="Monster"?ge(me):ge(_e,!1)})}S(R,P)};N(B,R=>{n()==="Normal"&&R(U)})}var ee=_(v,2),J=g(ee);{var q=R=>{var P=cf(),G=g(P),X=g(G),ae=g(X);A(me=>D(ae,me),[()=>{var me;return(me=i())==null?void 0:me.description}],we),S(R,P)},ie=R=>{var P=mf(),G=g(P),X=g(G);X.textContent='"info" :{';var ae=_(X,2);se(ae,1,()=>Object.entries(t().info),ne,(ce,he)=>{let $e=()=>f(he)[0],ze=()=>f(he)[1];var Ke=uf(),kt=g(Ke);A(F=>D(kt,`"${$e()??""}" :${F??""},`),[()=>{var F;return(F=ze())==null?void 0:F.toString()}],we),S(ce,Ke)});var me=_(ae,2);me.textContent="},";var _e=_(me,2);_e.textContent='"status" :{';var ge=_(_e,2);se(ge,1,()=>Object.entries(t().status),ne,(ce,he)=>{let $e=()=>f(he)[0],ze=()=>f(he)[1];var Ke=df(),kt=g(Ke);A(F=>D(kt,`"${$e()??""}" :${F??""},`),[()=>{var F;return(F=ze())==null?void 0:F.toString()}],we),S(ce,Ke)});var b=_(ge,2);b.textContent="},";var H=_(b,2);H.textContent='"actions" :[';var Z=_(H,2);se(Z,1,()=>t().actions,ne,(ce,he)=>{var $e=ff(),ze=g($e);A(()=>D(ze,`"${f(he).playType??""} ${f(he).title??""}",`)),S(ce,$e)});var te=_(Z,2);te.textContent="],";var V=_(te,2);V.textContent='"substituteEffects" :[';var z=_(V,2);se(z,1,()=>t().substituteEffects,ne,(ce,he)=>{var $e=vf(),ze=g($e);A(()=>D(ze,`"${f(he).title??""}",`)),S(ce,$e)});var M=_(z,2);M.textContent="],";var x=_(M,2);x.textContent='"continuousEffects" :[';var Q=_(x,2);se(Q,1,()=>t().continuousEffects,ne,(ce,he)=>{var $e=pf(),ze=g($e);A(()=>D(ze,`"${f(he).isStarted??""}",`)),S(ce,$e)});var re=_(Q,2);re.textContent="],";var O=_(re,2);O.textContent='"procFilters" :[';var j=_(O,2);se(j,1,()=>t().procFilterBundle.operators,ne,(ce,he)=>{var $e=hf(),ze=g($e);A(Ke=>D(ze,`"${Ke??""} ${f(he).title??""}",`),[()=>f(he).isSpawnedBy.toString()],we),S(ce,$e)});var ue=_(j,2);ue.textContent="],";var Se=_(ue,2);Se.textContent='"numericStateOperators" :[';var de=_(Se,2);se(de,1,()=>t().numericOprsBundle.operators,ne,(ce,he)=>{var $e=gf(),ze=g($e);A(Ke=>D(ze,`"${Ke??""} ${f(he).title??""}",`),[()=>f(he).isSpawnedBy.toString()],we),S(ce,$e)});var pe=_(de,2);pe.textContent="],";var le=_(pe,2);le.textContent='"stateOperators" :[';var je=_(le,2);se(je,1,()=>t().statusOperatorBundle.operators,ne,(ce,he)=>{var $e=yf(),ze=g($e);A(Ke=>D(ze,`"${Ke??""} ${f(he).title??""}",`),[()=>f(he).isSpawnedBy.toString()],we),S(ce,$e)});var Ve=_(je,2);Ve.textContent="],";var tt=_(Ve,2);tt.textContent='"lastMoveLogRecord" :{';var _t=_(tt,2),at=g(_t),Qe=_(_t,2),rt=g(Qe),Be=_(Qe,2),Fe=g(Be),be=_(Be,2);be.textContent="},",A((ce,he)=>{D(at,`"movedBy":"${ce??""}",`),D(rt,`"movedAs":"${he??""}",`),D(Fe,`"movedAt":"${t().moveLog.latestRecord.movedAt.totalProcSeq??""}",`)},[()=>{var ce;return(ce=t().moveLog.latestRecord.movedBy)==null?void 0:ce.toString()},()=>t().moveLog.latestRecord.movedAs.join(" ")],we),S(R,P)};N(J,R=>{n()==="Normal"?R(q):R(ie,!1)})}var K=_(ee,2),W=g(K);{var Ne=R=>{var P=_f();S(R,P)},Y=R=>{var P=Sf(),G=g(P),X=_(G,2),ae=g(X);A(me=>{var _e;Wt(G,"href",`https://yugioh-wiki.net/index.php?${t().origin.wikiEncodedName}`),Wt(X,"href",me),D(ae,`⇒${((_e=t())!=null&&_e.origin.cardId?"公式カードページ":"公式で検索")??""}`)},[r],we),S(R,P)};N(W,R=>{var P;(P=t())!=null&&P.origin.isForTest?R(Ne):R(Y,!1)})}A((R,P,G)=>{Ee(c,`duel_card duel_card_info ${t().origin.kind??""} ${R??""} svelte-1qknre5`),D(m,t().nm),D(T,P),D(E,G)},[()=>{var R;return(R=t().origin.monsterCategories)==null?void 0:R.join(" ")},()=>"★".repeat(t().lvl||0),()=>"☆".repeat(t().rank||0)],we),S(o,c)};N(l,o=>{t()&&o(d)})}S(a,s),ut()}Hi(["contextmenu"]);var wf=k('<div class="duel_field_cell_info_item svelte-1xj7qf1"><!></div>'),Tf=k('<div class="duel_field_cell_info_box svelte-1xj7qf1"><div class="duel_field_cell_info_label svelte-1xj7qf1"> </div> <!></div>'),bf=k('<div class="duel_field_cell_info svelte-1xj7qf1"><div class="duel_field_cell_info_header item_btn svelte-1xj7qf1"><div class="svelte-1xj7qf1"> </div> <div class="svelte-1xj7qf1"> </div></div> <div class="duel_field_cell_info_body svelte-1xj7qf1"></div></div>');function Ef(a,e){ct(e,!1);let t=Le(e,"cell",12);const i=()=>{t(t())},r=d=>t().cardEntities.filter(o=>o.face===d);t().field.duel.view.onDuelUpdate.append(i),Ct();var n=Oe(),s=I(n);{var l=d=>{var o=bf(),c=g(o),v=g(c),p=g(v),h=_(v,2),m=g(h),C=_(c,2);se(C,4,()=>["FaceUp","FaceDown"],ne,(y,T)=>{var w=Oe(),E=I(w);{var B=U=>{var ee=Tf(),J=g(ee),q=g(J),ie=_(J,2);se(ie,1,()=>r(T).toSorted(Es),ne,(K,W)=>{var Ne=wf(),Y=g(Ne);const R=we(()=>t().owner===t().field.duel.duelists.Below);Gt(Y,{get entity(){return f(W)},get isVisibleForcibly(){return f(R)},isWideMode:!0,cardActionResolve:void 0}),S(K,Ne)}),A(()=>D(q,T==="FaceUp"?"表向き":"裏向き")),S(U,ee)};N(E,U=>{r(T).length&&U(B)})}S(y,w)}),A(()=>{var y;D(p,(y=t().owner)==null?void 0:y.profile.name),D(m,t().cellType)}),S(d,o)};N(s,d=>{t().field.duel.view.infoBoardState==="CellInfo"&&d(l)})}S(a,n),ut()}const Df=zu({duration:400});var Af=k('<div class="duel_field_header_message svelte-accyye"> </div> <div class="duel_field_header_buttons svelte-accyye"><button class="svelte-accyye">サレンダー</button></div>',1),xf=k("<tr></tr>"),Mf=k('<table class="duel_field svelte-accyye"><tbody class="svelte-accyye"></tbody></table>'),Pf=k('<button class="svelte-accyye">cancel</button>'),Bf=k('<button class="svelte-accyye">OK</button> <!>',1),Ff=k('<button class="svelte-accyye"> </button>'),Of=k('<div class="flex duel_desk svelte-accyye"><div class="duel_desk_left v_flex svelte-accyye"><!> <!> <!></div> <div class=" duel_desk_center v_flex svelte-accyye"><div class="duel_field_header svelte-accyye"><!></div> <div class="svelte-accyye"><!></div> <div class="duel_field_footer svelte-accyye"><!></div></div> <div class=" duel_desk_right svelte-accyye" style="text-align: left;"><!> <!></div></div> <div style="position:absolute;left:0;bottom:0"> </div> <!>',1);function Lf(a,e){ct(e,!1);let t=Le(e,"duel",12),i=Ae([]),r=Ae([]),n=()=>{},s=Ae([]),l=Ae(),d=Ae(),o=Ae(()=>!1),c=Ae(!1);const v=M=>{n=M.resolve,L(s,M.dummyActionInfos.filter(x=>x.action.entity.entityType==="Duelist").filter(x=>x.action.entity.controller.seat==="Below")),L(l,void 0),L(d,void 0),L(r,[]),L(i,[]),L(c,!1),M.entitiesChoices&&(L(l,M.entitiesChoices),L(o,()=>{var x;return((x=M.entitiesChoices)==null?void 0:x.validator(f(i)))??!1}),L(c,M.entitiesChoices.cancelable),f(l).selectables.every(x=>x.fieldCell.isPlayFieldCell&&x.getIndexInCell()===0||x.fieldCell.cellType==="Hand"&&x.controller.duelistType==="Player"||x.entityType==="Duelist")||t().view.modalController.entitySelector.show({title:t().view.message,entitiesChoices:M.entitiesChoices,chainBlockInfos:M.chainBlockInfos,cancelable:M.entitiesChoices.cancelable}).then(x=>{n({selectedEntities:x})})),M.cellsChoices&&(L(d,M.cellsChoices),L(o,()=>{var x;return((x=M.cellsChoices)==null?void 0:x.validator(f(r)))??!1}),L(c,M.cellsChoices.cancelable))};t().view.onWaitStart.append(v);const p=()=>{n=()=>{},L(d,void 0),L(l,void 0),L(r,[]),L(i,[]),L(o,()=>!1),L(c,!1)};t().view.onWaitEnd.append(p);let h=Ae(void 0),m=Ae("Normal");const C=({card:M,mode:x})=>{L(h,M),L(m,x)};t().view.onShowCardEntity.append(C);const y=()=>{t(t())};t().view.onDuelUpdate.append(y),t().log.onUpdate.append(y);const T=()=>{f(l)&&f(l).validator(f(i))&&n({selectedEntities:f(i)}),f(d)&&f(d).validator(f(r))&&n({selectedCells:f(r)})},w=()=>{n({})},E=M=>{n({actionInfo:M})},B=()=>{n({surrender:!0})};t().main(),Ct();var U=Of(),ee=I(U),J=g(ee),q=g(J);En(q,{get duelist(){return t().duelists.Above}});var ie=_(q,2);kf(ie,{get entity(){return f(h)},get mode(){return f(m)}});var K=_(ie,2);En(K,{get duelist(){return t().duelists.Below}});var W=_(J,2),Ne=g(W),Y=g(Ne);{var R=M=>{var x=Af(),Q=I(x),re=g(Q),O=_(Q,2),j=g(O);A(()=>D(re,`[TURN:${t().clock.turn}][PHASE:${t().phase}] ${t().view.message}`)),De("click",j,B),S(M,x)};N(Y,M=>{t().isEnded||M(R)})}var P=_(Ne,2),G=g(P);{var X=M=>{var x=Mf(),Q=g(x);se(Q,5,()=>t().field.cells,ne,(re,O,j)=>{var ue=xf();Ee(ue,`${`duel_desk_row_${j}`??""} svelte-accyye`),se(ue,5,()=>f(O),ne,(Se,de,pe)=>{Cd(Se,{get view(){return t().view},row:j,column:pe,get selectedEntities(){return f(i)},set selectedEntities(le){L(i,le)},get selectedCells(){return f(r)},set selectedCells(le){L(r,le)},$$legacy:!0})}),S(re,ue)}),S(M,x)};N(G,M=>{t().clock.turn>0&&M(X)})}var ae=_(P,2),me=g(ae);{var _e=M=>{var x=Bf(),Q=I(x),re=_(Q,2);{var O=j=>{var ue=Pf();De("click",ue,w),S(j,ue)};N(re,j=>{f(c)&&j(O)})}A(j=>Q.disabled=j,[()=>!f(o)()],we),De("click",Q,T),S(M,x)},ge=M=>{var x=Oe(),Q=I(x);{var re=O=>{var j=Oe(),ue=I(j);se(ue,1,()=>f(s),ne,(Se,de)=>{var pe=Ff(),le=g(pe);A(()=>D(le,f(de).action.title)),De("click",pe,()=>E(f(de))),S(Se,pe)}),S(O,j)};N(Q,O=>{f(s)&&f(s).length&&O(re)},!0)}S(M,x)};N(me,M=>{f(l)&&f(l).selectables.length||f(d)&&f(d).selectables?M(_e):M(ge,!1)})}var b=_(W,2),H=g(b);xd(H,{get log(){return t().log}});var Z=_(H,2);Ef(Z,{get cell(){return t().view.infoBoardCell}});var te=_(ee,2),V=g(te),z=_(te,2);Jd(z,{get modalController(){return t().view.modalController}}),A(M=>D(V,M),[()=>t().clock.toString()],we),S(a,U),ut()}var qf=k("<div></div>"),Nf=k('<span> </span> / <span style="display: inline-block;width:2rem;text-align: right;"> </span>',1),Rf=k('<li class="deck_editor_item svelte-vivzk2"><div role="listitem"><div class="svelte-vivzk2"><div class="svelte-vivzk2"> </div> <div style="display:flex" class="svelte-vivzk2"><div class="svelte-vivzk2"><!> <!> <!> <!> <!> <!> <!></div> <div style="flex-grow: 1; width:0.1rem" class="svelte-vivzk2"></div> <div class="svelte-vivzk2"><!></div></div></div></div> <button class="button_style_reset svelte-vivzk2" title="※shiftキー同時押しで一括投入">+</button> <button class="button_style_reset svelte-vivzk2" title="※shiftキー同時押しで一括外し">-</button></li>'),Hf=k('<div class="deck_editor_card_kind svelte-vivzk2"><span class="svelte-vivzk2"> </span> <ul class="svelte-vivzk2"></ul></div>'),$f=k('<div class="deck_editor_deck_type svelte-vivzk2"><span class="svelte-vivzk2"> </span> <!></div>'),Zf=k('<div class="deck_editor_card_list svelte-vivzk2"></div>');function Dn(a,e){ct(e,!1);let t=Le(e,"allCardInfos",8),i=Le(e,"deckCardInfos",12),r=Le(e,"mode",8),n=Le(e,"onAttention",8);const s={Deck:["Monster","Spell","Trap"],ExtraDeck:["Monster"]},l=(v,p)=>(r()==="List"?t():i()).filter(h=>{var m,C;return wr.has(h.name)||((m=h.monsterCategories)==null?void 0:m.includes("Normal"))&&!((C=h.monsterCategories)!=null&&C.includes("Pendulum"))}).filter(h=>!p||h.kind===p).filter(h=>{var m,C;return!v||v==="Deck"&&!((m=h==null?void 0:h.monsterCategories)!=null&&m.union(Fi).length)||v==="ExtraDeck"&&((C=h==null?void 0:h.monsterCategories)==null?void 0:C.union(Fi).length)}),d=(v,p)=>{try{if(v.ctrlKey){i().push(p);return}const h=i().filter(C=>C.name===p.name).length;if(h>2)return;const m=v.shiftKey?3-h:1;if(m<1)return;i().push(...Array(m).fill(p))}finally{i().sort(Vi),i(i())}},o=(v,p)=>{let h=0;i(i().filter(m=>m.name!==p.name?!0:(h++,!v.shiftKey&&h>1))),i().sort(Vi)};Ct();var c=Zf();se(c,5,()=>ko,ne,(v,p)=>{var h=$f(),m=g(h),C=g(m),y=_(m,2);se(y,1,()=>s[f(p)],ne,(T,w)=>{var E=Hf(),B=g(E),U=g(B),ee=_(B,2);se(ee,5,()=>l(f(p),f(w)).toSorted(Vi),ne,(J,q)=>{var ie=Rf(),K=g(ie),W=g(K),Ne=g(W),Y=g(Ne),R=_(Ne,2),P=g(R),G=g(P);{var X=O=>{var j=ni();A(()=>D(j,`★${f(q).level??""}`)),S(O,j)};N(G,O=>{f(q).level&&O(X)})}var ae=_(G,2);{var me=O=>{var j=ni();A(()=>D(j,`☆${f(q).rank??""}`)),S(O,j)};N(ae,O=>{f(q).rank&&O(me)})}var _e=_(ae,2);se(_e,1,()=>f(q).attributes??[],ne,(O,j)=>{var ue=qf();A(()=>Ee(ue,`monster_attr ${f(j)??""} svelte-vivzk2`)),S(O,ue)});var ge=_(_e,2);se(ge,1,()=>f(q).types??[],ne,(O,j)=>{var ue=ni();A(()=>D(ue,sa[f(j)])),S(O,ue)});var b=_(ge,2);se(b,1,()=>f(q).monsterCategories??[],ne,(O,j)=>{var ue=ni();A(()=>D(ue,aa[f(j)])),S(O,ue)});var H=_(b,2);{var Z=O=>{var j=ni();A(()=>D(j,`${ra[f(q).spellCategory]??""}魔法`)),S(O,j)};N(H,O=>{f(q).spellCategory!==void 0&&O(Z)})}var te=_(H,2);{var V=O=>{var j=ni();A(()=>D(j,`${na[f(q).trapCategory]??""}罠`)),S(O,j)};N(te,O=>{f(q).trapCategory!==void 0&&O(V)})}var z=_(P,4),M=g(z);{var x=O=>{var j=Nf(),ue=I(j),Se=g(ue),de=_(ue,2),pe=g(de);A(()=>{D(Se,f(q).attack??"?"),D(pe,f(q).defense??"?")}),S(O,j)};N(M,O=>{f(q).kind==="Monster"&&O(x)})}var Q=_(K,2),re=_(Q,2);A(O=>{Ee(K,`${O??""} svelte-vivzk2`),D(Y,f(q).name)},[()=>{var O,j;return`deck_editor_card duel_card ${f(q).kind} ${(j=(O=f(q))==null?void 0:O.monsterCategories)==null?void 0:j.join(" ")} ${wr.has(f(q).name)?"is_implemented":"is_not_implemented"}`}],we),De("mouseenter",K,()=>n()(f(q))),De("click",Q,O=>d(O,f(q))),De("click",re,O=>o(O,f(q))),S(J,ie)}),A(J=>D(U,`${fs[f(w)]??""}（${J??""}枚）`),[()=>l(f(p),f(w)).length],we),S(T,E)}),A(T=>D(C,`${wo[f(p)]??""}（${T??""}枚）`),[()=>l(f(p)).length],we),S(v,h)}),S(a,c),ut()}var Uf=k('<div class="duel_card_info_row svelte-rccxcp"><div class="svelte-rccxcp"><pre class="description svelte-rccxcp"> </pre></div></div> <div class="duel_card_info_row svelte-rccxcp" style=" justify-content: space-between;"><div class="svelte-rccxcp"> </div> <div class="svelte-rccxcp"> </div></div>',1),Gf=k('<div></div> <div class="svelte-rccxcp"> </div>',1),jf=k("<div> </div>"),Vf=k("<div> </div>"),zf=k('<div class="duel_card_info_row svelte-rccxcp"><!> <!></div> <div class="duel_card_info_row svelte-rccxcp"></div>',1),Wf=k('<div class="duel_card_row svelte-rccxcp"><div class="svelte-rccxcp"></div> <div class="svelte-rccxcp"> </div></div>'),Yf=k('<div class="duel_card_row svelte-rccxcp"><div class="svelte-rccxcp"></div> <div class="svelte-rccxcp"> </div></div>'),Qf=k('<div class="duel_card_info_row svelte-rccxcp"><div class="svelte-rccxcp">※テスト用カードです</div></div>'),Kf=k('<div class="duel_card_info_links svelte-rccxcp"><a target="_blank" rel="noopener noreferrer" title="遊戯王カードWiki" class="svelte-rccxcp">⇒遊戯王カードWiki</a> <a target="_blank" rel="noopener noreferrer" title="コナミカードデータベース" class="svelte-rccxcp"> </a></div>'),Xf=k('<div><div class="duel_card_info_header svelte-rccxcp"><div class="duel_card_info_row svelte-rccxcp"><div class="svelte-rccxcp"> </div></div> <div class="duel_card_info_row svelte-rccxcp" style="position:sticky; top:0;"><div class="svelte-rccxcp"> </div> <div class="svelte-rccxcp"> </div></div></div> <div class="duel_card_info_body svelte-rccxcp"><!> <!> <div class="duel_card_info_row description svelte-rccxcp"><div class="svelte-rccxcp"><pre class="description svelte-rccxcp"> </pre></div></div> <!></div></div>');function Jf(a,e){ct(e,!1);let t=Le(e,"cardInfo",8,void 0);const i=()=>t()?St[t().name]:void 0;Ct();var r=Oe(),n=I(r);{var s=l=>{var d=Xf(),o=g(d),c=g(o),v=g(c),p=g(v),h=_(c,2),m=g(h),C=g(m),y=_(m,2),T=g(y),w=_(o,2),E=g(w);{var B=P=>{var G=Uf(),X=I(G),ae=g(X),me=g(ae),_e=g(me),ge=_(X,2),b=g(ge),H=g(b),Z=_(b,2),te=g(Z);A(()=>{D(_e,St[t().name].pendulumDescription),D(H,`◀ ${t().pendulumScaleL??""}`),D(te,`${t().pendulumScaleR??""} ▶`)}),S(P,G)};N(E,P=>{var G;(G=t().monsterCategories)!=null&&G.includes("Pendulum")&&P(B)})}var U=_(E,2);{var ee=P=>{var G=zf(),X=I(G),ae=g(X);{var me=H=>{var Z=Gf(),te=I(Z),V=_(te,2),z=g(V);A(()=>{Ee(te,`monster_attr ${t().attributes[0]??""} svelte-rccxcp`),D(z,`${qr[t().attributes[0]]??""}属性`)}),S(H,Z)};N(ae,H=>{t().attributes&&H(me)})}var _e=_(ae,2);{var ge=H=>{var Z=jf(),te=g(Z);A(()=>{Ee(Z,`monster_cat ${t().types[0]??""} svelte-rccxcp`),D(te,`${sa[t().types[0]]??""}${ja[t().types[0]]??""}族`)}),S(H,Z)};N(_e,H=>{t().types&&H(ge)})}var b=_(X,2);se(b,5,()=>t().monsterCategories??[],ne,(H,Z)=>{var te=Vf(),V=g(te);A(()=>{Ee(te,`monster_cat ${f(Z)??""} svelte-rccxcp`),D(V,`${aa[f(Z)]??""}${Ga[f(Z)]??""}`)}),S(H,te)}),S(P,G)},J=P=>{var G=Oe(),X=I(G);{var ae=_e=>{var ge=Wf(),b=_(g(ge),2),H=g(b);A(()=>D(H,`${ra[t().spellCategory]??""}魔法`)),S(_e,ge)},me=_e=>{var ge=Oe(),b=I(ge);{var H=Z=>{var te=Yf(),V=_(g(te),2),z=g(V);A(()=>D(z,`${na[t().trapCategory]??""}罠`)),S(Z,te)};N(b,Z=>{t().kind==="Trap"&&t().trapCategory&&Z(H)},!0)}S(_e,ge)};N(X,_e=>{t().kind==="Spell"&&t().spellCategory?_e(ae):_e(me,!1)},!0)}S(P,G)};N(U,P=>{t().kind==="Monster"?P(ee):P(J,!1)})}var q=_(U,2),ie=g(q),K=g(ie),W=g(K),Ne=_(q,2);{var Y=P=>{var G=Qf();S(P,G)},R=P=>{var G=Kf(),X=g(G),ae=_(X,2),me=g(ae);A(_e=>{Wt(X,"href",`https://yugioh-wiki.net/index.php?${t().wikiEncodedName}`),Wt(ae,"href",_e),D(me,`⇒${(t().cardId?"公式カードページ":"公式で検索")??""}`)},[()=>Ao(t())],we),S(P,G)};N(Ne,P=>{t().isForTest?P(Y):P(R,!1)})}A((P,G,X,ae)=>{Ee(d,`duel_card duel_card_info ${t().kind??""} ${P??""} svelte-rccxcp`),D(p,t().name),D(C,G),D(T,X),D(W,ae)},[()=>{var P;return(P=t().monsterCategories)==null?void 0:P.join(" ")},()=>"★".repeat(t().level||0),()=>"☆".repeat(t().rank||0),()=>{var P;return(P=i())==null?void 0:P.description}],we),S(l,d)};N(n,l=>{t()&&l(s)})}S(a,r),ut()}const If={0:{aaa:"日",aaaa:"日曜日",ddd:"Sun",dddd:"Sunday"},1:{aaa:"月",aaaa:"月曜日",ddd:"Mon",dddd:"Monday"},2:{aaa:"火",aaaa:"火曜日",ddd:"Tue",dddd:"Tuesday"},3:{aaa:"水",aaaa:"水曜日",ddd:"Wed",dddd:"Wednesday"},4:{aaa:"木",aaaa:"木曜日",ddd:"Thu",dddd:"Thursday"},5:{aaa:"金",aaaa:"金曜日",ddd:"Fri",dddd:"Friday"},6:{aaa:"土",aaaa:"土曜日",ddd:"Sat",dddd:"Saturday"}};class ev{constructor(){u(this,"DefaultSeparator1","/");u(this,"DefaultSeparator2"," ");u(this,"DefaultSeparator3",":");u(this,"createDate",e=>{if(!e)return;const t=new Date(e);if(!isNaN(t.getTime()))return t});u(this,"createDateOr",(e,t)=>this.createDate(e)||t||new Date);u(this,"truncateDate",e=>{const t=e||new Date;return new Date(t.getFullYear(),t.getMonth(),t.getDate())});u(this,"addDate",(e,t)=>{const i=this.createDateOr(e);return i.setDate(i.getDate()+t),i});u(this,"addMonth",(e,t)=>{const i=this.createDateOr(e);return i.setMonth(i.getMonth()+t),i});u(this,"addYear",(e,t)=>{const i=this.createDateOr(e);return i.setFullYear(i.getFullYear()+t),i});u(this,"getDayOfWeek",(e,t="dddd")=>{const i=this.createDate(e);return i?If[i.getDay()][t]:""});u(this,"formatToYYYYMMDD",(e,t=this.DefaultSeparator1)=>{const i=this.createDate(e);if(!i)return"";const r=i.getFullYear().toString(),n=("0"+(i.getMonth()+1)).slice(-2),s=("0"+i.getDate()).slice(-2);return r+t+n+t+s});u(this,"formatToYYYYMM",(e,t=this.DefaultSeparator1)=>{const i=this.createDate(e);if(!i)return"";t||(t="");const r=i.getFullYear().toString(),n=("0"+(i.getMonth()+1)).slice(-2);return r+t+n});u(this,"formatToHHMMSS",(e,t=this.DefaultSeparator3)=>{const i=this.createDate(e);if(!i)return"";t||(t="");const r=i.getHours(),n=i.getMinutes(),s=i.getSeconds();return("0"+r).slice(-2)+t+("0"+n).slice(-2)+t+("0"+s).slice(-2)});u(this,"formatToHHMM",(e,t=this.DefaultSeparator3)=>{const i=this.createDate(e);if(!i)return"";t||(t="");const r=("0"+i.getHours()).slice(-2),n=("0"+i.getMinutes()).slice(-2);return r+t+n});u(this,"formatToYYYYMMDD_HHMM",(e,t=this.DefaultSeparator1,i=this.DefaultSeparator2,r=this.DefaultSeparator3)=>{const n=this.createDate(e);return n?this.formatToYYYYMMDD(n,t)+i+this.formatToHHMM(n,r):""});u(this,"formatToYYYYMMDD_HHMMSS",(e,t=this.DefaultSeparator1,i=this.DefaultSeparator2,r=this.DefaultSeparator3)=>{const n=this.createDate(e);return n?this.formatToYYYYMMDD(n,t)+i+this.formatToHHMMSS(n,r):""})}}const Mt=new ev;Date.prototype.truncateDate=function(){return Mt.truncateDate(this)};Date.prototype.getCloneOr=function(a){return Mt.createDateOr(this,a)};Date.prototype.addDate=function(a){return Mt.addDate(this,a)};Date.prototype.addMonth=function(a){return Mt.addDate(this,a)};Date.prototype.addYear=function(a){return Mt.addDate(this,a)};Date.prototype.getDayOfWeek=function(a="dddd"){return Mt.getDayOfWeek(this,a)};Date.prototype.formatToYYYYMM=function(a){return Mt.formatToYYYYMM(this,a)};Date.prototype.formatToYYYYMMDD=function(a){return Mt.formatToYYYYMMDD(this,a)};Date.prototype.formatToYYYYMMDD_HHMM=function(a,e,t){return Mt.formatToYYYYMMDD_HHMM(this,a,e,t)};Date.prototype.formatToYYYYMMDD_HHMMSS=function(a,e,t){return Mt.formatToYYYYMMDD_HHMMSS(this,a,e,t)};Date.prototype.formatToHHMM=function(a){return Mt.formatToHHMM(this,a)};Date.prototype.formatToHHMMSS=function(a){return Mt.formatToHHMMSS(this,a)};String.prototype.format=(a,...e)=>{for(const[t,i]of e.entries()){const r=new RegExp(`\\{${t}\\}`,"g");a=a.replace(r,i)}return a};var tv=k('<label><input type="checkbox"> </label>'),iv=k('<label><input type="checkbox"> </label>'),av=k('<label><input type="checkbox"> <div style="display: inline-block;"></div> </label>'),rv=k('<label><input type="checkbox"> </label>'),nv=k('<label><input type="checkbox"> </label>'),sv=k('<label><input type="checkbox"> </label>'),lv=k("<option> </option>"),ov=k('<div class="svelte-138s9ji"><a class="white_button svelte-138s9ji" download="SVS_DeckInfos.json">ダウンロード</a></div>'),cv=k('<div class="svelte-138s9ji"></div>'),uv=k('<div class="svelte-138s9ji"><a class="white_button svelte-138s9ji" download="SVS_DeckInfos.json">ダウンロード（一括）</a></div>'),dv=k('<div class="svelte-138s9ji"></div>'),fv=k('<div class="deck_editor_body_right_header svelte-138s9ji"><div class="deck_editor_body_right_header_row svelte-138s9ji"><div class="svelte-138s9ji">編集対象 <select></select></div> <div class="svelte-138s9ji"></div> <div class="svelte-138s9ji">新規名称 <input type="text"></div></div> <div class="deck_editor_body_right_header_row svelte-138s9ji"></div> <div class="deck_editor_body_right_header_row svelte-138s9ji"><div class="svelte-138s9ji">基本操作</div> <div class="svelte-138s9ji"><button class="white_button svelte-138s9ji">デッキを保存</button></div> <div class="svelte-138s9ji"></div> <div class="svelte-138s9ji"><button class="white_button svelte-138s9ji">デッキを複製</button></div> <div class="svelte-138s9ji"><button class="white_button svelte-138s9ji" title="shiftキー押下で確認メッセージスキップ">デッキを削除</button></div></div> <div class="deck_editor_body_right_header_row svelte-138s9ji"><div class="svelte-138s9ji">DL/UL</div> <!> <!></div></div> <!>',1),vv=k("<div>デッキ情報読込中</div>"),pv=k('<div class="deck_editor svelte-138s9ji"><div class="deck_editor_header"></div> <div class="deck_editor_body svelte-138s9ji"><div class="deck_editor_body_left svelte-138s9ji"><div role="contentinfo"><div class="deck_editor_search_box_header svelte-138s9ji"><div>検索条件</div> <div><button class="white_button svelte-138s9ji">条件クリア</button></div></div> <div class="deck_editor_search_box_row svelte-138s9ji"><div class="svelte-138s9ji">名称</div> <div class="svelte-138s9ji"><input type="text" style="width:70%">※ルビには対応していません</div></div> <div class="deck_editor_search_box_row svelte-138s9ji"><div class="svelte-138s9ji"><button class="search_condition_title black_button svelte-138s9ji">種類</button></div> <div class="svelte-138s9ji"></div></div> <div class="deck_editor_search_box_row svelte-138s9ji"><div class="svelte-138s9ji"><button class="search_condition_title black_button svelte-138s9ji">モンスター</button></div> <div class="svelte-138s9ji"></div></div> <div class="deck_editor_search_box_row svelte-138s9ji"><div class="svelte-138s9ji"><button class="search_condition_title black_button svelte-138s9ji">属性</button></div> <div class="svelte-138s9ji"></div></div> <div class="deck_editor_search_box_row svelte-138s9ji"><div class="svelte-138s9ji"><button class="search_condition_title black_button svelte-138s9ji">種族</button></div> <div class="svelte-138s9ji"></div></div> <div class="deck_editor_search_box_row svelte-138s9ji"><div class="svelte-138s9ji"><button class="search_condition_title black_button svelte-138s9ji">魔法</button></div> <div class="svelte-138s9ji"></div></div> <div class="deck_editor_search_box_row svelte-138s9ji"><div class="svelte-138s9ji"><button class="search_condition_title black_button svelte-138s9ji">罠</button></div> <div class="svelte-138s9ji"></div></div> <div class="deck_editor_search_box_row svelte-138s9ji"><div class="svelte-138s9ji">テスト用</div> <div class="svelte-138s9ji"><label><input type="checkbox"> テスト用カードを表示する</label></div></div></div> <!></div> <div class="deck_editor_body_center svelte-138s9ji"><!></div> <div class="deck_editor_body_right svelte-138s9ji"><!></div></div></div>');function hv(a,e){ct(e,!1);const t=[],i=[],r=[],n=[],s=[],l=[],d={name:"",cardKinds:vr.filter(F=>F!=="XyzMaterial"),monsterCategories:[...on],monsterAttributes:[...cn],monsterTypes:[...un],spellCategories:[...dn],trapCategories:[...fn],isForTest:!1},o=Ae(structuredClone(d));let c=Ae("SearchCondition");const v=async()=>{We(o,f(o).name=""),We(o,f(o).cardKinds=[]),We(o,f(o).monsterCategories=[]),We(o,f(o).monsterAttributes=[]),We(o,f(o).monsterTypes=[]),We(o,f(o).spellCategories=[]),We(o,f(o).trapCategories=[]),We(o,f(o).isForTest=!1)},p=async()=>{const $=(await f(C)).find(Re=>Re.id===f(m));$&&L(w,{...$,cardInfos:$.cardNames.map(Re=>St[Re])})},h=()=>Ot.getAllDeckInfo().then(F=>(L(m,(F.find($=>$.lastUsedAt.getTime()===Math.max(...F.map(Re=>Re.lastUsedAt.getTime())))??F[0]).id),F));let m=Ae(-1),C=Ae(h()),y=Ae(f(C).then(F=>Ot.convertToObjectURL(F)));f(C).then(p);const T=()=>{L(C,h()),L(y,f(C).then(F=>Ot.convertToObjectURL(F))),p()};let w=Ae({id:-Number.MAX_VALUE,name:"",description:"",lastUsedAt:new Date,cardInfos:[]}),E=Ae(St.ゾンビーノ);const B=()=>Object.values(St).filter(F=>{if(!f(o).cardKinds.includes(F.kind)||f(o).name.trim().length&&!F.name.includes(f(o).name)||F.isForTest&&!f(o).isForTest)return!1;if(F.kind==="Monster")return F.attributes&&!f(o).monsterAttributes.union(F.attributes).length||F.types&&!f(o).monsterTypes.union(F.types).length||!F.monsterCategories?!1:F.monsterCategories.union(f(o).monsterCategories).length;if(F.kind==="Spell")return F.spellCategory&&f(o).spellCategories.includes(F.spellCategory);if(F.kind==="Trap")return F.trapCategory&&f(o).trapCategories.includes(F.trapCategory)}),U=F=>{L(c,"CardDetail"),L(E,F)},ee=async()=>{const $=(await f(C)).find(Re=>Re.id===f(m));if(!$)throw new Error("illegal state");return $},J=async F=>{Array.isArray(f(o)[F])&&Array.isArray(d[F])&&We(o,f(o)[F]=f(o)[F].length?[]:[...d[F]])},q=async()=>{const F=await ee();await F.saveDeckInfo({...F,name:f(w).name,cardNames:f(w).cardInfos.map($=>$.name),lastUsedAt:new Date}),T()},ie=async()=>{(await Ot.createNewDeck(`デッキ_${new Date().formatToYYYYMMDD_HHMMSS("","","")}`,`コピー日時：${new Date().formatToYYYYMMDD_HHMMSS("-"," ",":")}`,f(w).cardInfos.map($=>$.name))).saveDeckInfo(),T()},K=async F=>{const $=await ee();!F.shiftKey&&!confirm(`デッキ【${$.name}】を削除します。
よろしいですか？`)||(await $.delete(),T())};Ct();var W=pv(),Ne=_(g(W),2),Y=g(Ne),R=g(Y),P=g(R),G=_(g(P),2),X=g(G),ae=_(P,2),me=_(g(ae),2),_e=g(me),ge=_(ae,2),b=g(ge),H=g(b),Z=_(b,2);se(Z,5,()=>vr.filter(F=>F!=="XyzMaterial"),ne,(F,$)=>{var Re=tv(),Pe=g(Re),it,dt=_(Pe);A(()=>{it!==(it=f($))&&(Pe.value=(Pe.__value=f($))==null?"":f($)),D(dt,` ${fs[f($)]??""}`)}),ki(t,[],Pe,()=>(f($),f(o).cardKinds),ft=>We(o,f(o).cardKinds=ft)),S(F,Re)});var te=_(ge,2),V=g(te),z=g(V),M=_(V,2);se(M,5,()=>on,ne,(F,$)=>{var Re=iv(),Pe=g(Re),it,dt=_(Pe);A(()=>{it!==(it=f($))&&(Pe.value=(Pe.__value=f($))==null?"":f($)),D(dt,` ${aa[f($)]??""}${Ga[f($)]??""}`)}),ki(i,[],Pe,()=>(f($),f(o).monsterCategories),ft=>We(o,f(o).monsterCategories=ft)),S(F,Re)});var x=_(te,2),Q=g(x),re=g(Q),O=_(Q,2);se(O,5,()=>cn,ne,(F,$)=>{var Re=av(),Pe=g(Re),it,dt=_(Pe,2),ft=_(dt);A(()=>{it!==(it=f($))&&(Pe.value=(Pe.__value=f($))==null?"":f($)),Ee(dt,`monster_attr ${f($)??""} svelte-138s9ji`),D(ft,` ${qr[f($)]??""}`)}),ki(r,[],Pe,()=>(f($),f(o).monsterAttributes),Ya=>We(o,f(o).monsterAttributes=Ya)),S(F,Re)});var j=_(x,2),ue=g(j),Se=g(ue),de=_(ue,2);se(de,5,()=>un,ne,(F,$)=>{var Re=rv(),Pe=g(Re),it,dt=_(Pe);A(()=>{it!==(it=f($))&&(Pe.value=(Pe.__value=f($))==null?"":f($)),D(dt,` ${sa[f($)]??""}
                ${ja[f($)]??""}`)}),ki(n,[],Pe,()=>(f($),f(o).monsterTypes),ft=>We(o,f(o).monsterTypes=ft)),S(F,Re)});var pe=_(j,2),le=g(pe),je=g(le),Ve=_(le,2);se(Ve,5,()=>dn,ne,(F,$)=>{var Re=nv(),Pe=g(Re),it,dt=_(Pe);A(()=>{it!==(it=f($))&&(Pe.value=(Pe.__value=f($))==null?"":f($)),D(dt,` ${ra[f($)]??""}`)}),ki(s,[],Pe,()=>(f($),f(o).spellCategories),ft=>We(o,f(o).spellCategories=ft)),S(F,Re)});var tt=_(pe,2),_t=g(tt),at=g(_t),Qe=_(_t,2);se(Qe,5,()=>fn,ne,(F,$)=>{var Re=sv(),Pe=g(Re),it,dt=_(Pe);A(()=>{it!==(it=f($))&&(Pe.value=(Pe.__value=f($))==null?"":f($)),D(dt,` ${na[f($)]??""}`)}),ki(l,[],Pe,()=>(f($),f(o).trapCategories),ft=>We(o,f(o).trapCategories=ft)),S(F,Re)});var rt=_(tt,2),Be=_(g(rt),2),Fe=g(Be),be=g(Fe),ce=_(R,2);Jf(ce,{get cardInfo(){return f(E)}});var he=_(Y,2),$e=g(he);const ze=we(B);Dn($e,{mode:"List",get allCardInfos(){return f(ze)},onAttention:U,get deckCardInfos(){return f(w).cardInfos},set deckCardInfos(F){We(w,f(w).cardInfos=F)},$$legacy:!0});var Ke=_(he,2),kt=g(Ke);Gi(kt,()=>f(C),F=>{var $=vv();S(F,$)},(F,$)=>{var Re=fv(),Pe=I(Re),it=g(Pe),dt=g(it),ft=_(g(dt));A(()=>{f(m),$i(()=>{f($)})}),se(ft,5,()=>f($),ne,(vt,Tt)=>{var Bt=lv(),_i={},Qa=g(Bt);A(()=>{_i!==(_i=f(Tt).id)&&(Bt.value=(Bt.__value=f(Tt).id)==null?"":f(Tt).id),D(Qa,f(Tt).name)}),S(vt,Bt)});var Ya=_(dt,4),Os=_(g(Ya)),Gr=_(it,4),jr=_(g(Gr),2),Ls=g(jr),Vr=_(jr,4),qs=g(Vr),Ns=_(Vr,2),Rs=g(Ns),Hs=_(Gr,2),zr=_(g(Hs),2);Gi(zr,ee,vt=>{var Tt=cv();S(vt,Tt)},(vt,Tt)=>{var Bt=ov(),_i=g(Bt);A(Qa=>Wt(_i,"href",Qa),[()=>Ot.convertToObjectURL([f(Tt)])],we),S(vt,Bt)});var $s=_(zr,2);Gi($s,()=>f(y),vt=>{var Tt=dv();S(vt,Tt)},(vt,Tt)=>{var Bt=uv(),_i=g(Bt);A(()=>Wt(_i,"href",f(Tt))),S(vt,Bt)});var Zs=_(Pe,2);Dn(Zs,{mode:"Deck",allCardInfos:[],onAttention:U,get deckCardInfos(){return f(w).cardInfos},set deckCardInfos(vt){We(w,f(w).cardInfos=vt)},$$legacy:!0}),Ui(ft,()=>f(m),vt=>L(m,vt)),De("change",ft,p),fr(Os,()=>f(w).name,vt=>We(w,f(w).name=vt)),De("click",Ls,q),De("click",qs,ie),De("click",Rs,K),S(F,Re)}),A(()=>Ee(R,`deck_editor_search_box ${(f(c)==="SearchCondition"?"":"minimum")??""} svelte-138s9ji`)),De("click",X,v),fr(_e,()=>f(o).name,F=>We(o,f(o).name=F)),De("click",H,()=>J("cardKinds")),De("click",z,()=>J("monsterCategories")),De("click",re,()=>J("monsterAttributes")),De("click",Se,()=>J("monsterTypes")),De("click",je,()=>J("spellCategories")),De("click",at,()=>J("trapCategories")),vo(be,()=>f(o).isForTest,F=>We(o,f(o).isForTest=F)),De("mouseenter",R,()=>L(c,"SearchCondition")),S(a,W),ut()}const gv="2025-05-02 21:24:35",yv={timestamp:gv},mv=["TblDeckHeader","TblDeckDetail","TblDuelistProfile"],_v=3;var Sv=k("<option> </option>"),Cv=k("<option> </option>"),kv=k("<option> </option>"),wv=k("<option> </option>"),Tv=k('<div class="svelte-1tmphfm"><label for="deck_selector" class="deck_selector svelte-1tmphfm">デッキ：</label> <select id="deck_selector" class="deck_selector svelte-1tmphfm"></select></div> <div class="svelte-1tmphfm"><label for="npc_selector" class="npc_selector svelte-1tmphfm">対戦相手：</label> <select id="npc_selector" class="npc_selector svelte-1tmphfm"></select> <div> </div></div> <div class="svelte-1tmphfm"><label for="npc_deck_selector" class="deck_selector svelte-1tmphfm">対戦相手のデッキ：</label> <select id="npc_deck_selector" class="deck_selector svelte-1tmphfm"><option>デフォルト</option><!></select></div> <div class="svelte-1tmphfm"><label for="npc_selector" class="npc_selector svelte-1tmphfm">先攻後攻：</label> <select id="npc_selector" class="npc_selector svelte-1tmphfm"></select></div> <div class="svelte-1tmphfm"><button class="btn svelte-1tmphfm">duel start!</button></div>',1),bv=k('<div class="svelte-1tmphfm">デッキ情報の読み込み、もしくは作成中...</div>'),Ev=k('<div class="svelte-1tmphfm"><label for="duelist_name" class="duelist_name svelte-1tmphfm">名前：</label> <input id="duelist_name" class="duelist_name svelte-1tmphfm" type="text"></div> <!> <div class="svelte-1tmphfm"><button class="btn svelte-1tmphfm">deck edit</button></div>',1),Dv=k('<div class="svelte-1tmphfm">デュエリスト情報の読み込み、もしくは作成中...</div>'),Av=k('<div class="app_body svelte-1tmphfm"><!></div>'),xv=k('<div class="result_title result_win svelte-1tmphfm">YOU WIN</div>'),Mv=k('<div class="result_title result_lose svelte-1tmphfm">YOU LOSE</div>'),Pv=k('<div class="result_title result_draw svelte-1tmphfm">DRAW</div>'),Bv=k('<div class="result svelte-1tmphfm"><!> <button class="white_button svelte-1tmphfm">TOPへ戻る</button></div>'),Fv=k('<main class="svelte-1tmphfm"><div class="link link_left svelte-1tmphfm"><a href="https://github.com/Setta238/stk_ygo_svelte" target="_blank" rel="noopener noreferrer" title="repository" class="svelte-1tmphfm">repository</a> <a href="https://x.com/ninja_no" target="_blank" rel="noopener noreferrer" title="repository" class="svelte-1tmphfm">X(Twitter)</a> <a href="https://posfie.com/@ninja_no/p/Lx7FLj3" target="_blank" rel="noopener noreferrer" title="posfie" class="svelte-1tmphfm">posfie(toggeter)</a></div> <div class="link link_right svelte-1tmphfm"><a class="a_button svelte-1tmphfm" role="button" tabindex="0">TOPへ戻る</a> <a href="/stk_ygo_svelte/note.html" target="_blank" rel="noopener noreferrer" title="repository" class="svelte-1tmphfm">現時点とこの先のこと</a></div> <!> <div class="debug_info svelte-1tmphfm"><span> </span> <span class="user_agent_info"> </span> <span class="screen_info"></span></div> <!></main>');function Ov(a,e){ct(e,!1);const t=new Co("stk_ygo_svelte",_v,mv);let i=Ae(),r=Ae("None"),n=Ae(0);const s=hr.getOrCreateNew(t);let l=Ae(Ot.getAllDeckInfo(t).then(Y=>(Promise.all(Y.filter(R=>!R.lastUsedAt).map(R=>{R.saveDeckInfo()})),L(n,(Y.find(R=>R.lastUsedAt.getTime()===Math.max(...Y.map(P=>P.lastUsedAt.getTime())))??Y[0]).id),Y)));const d=async()=>{let Y=(await f(l)).find(R=>R.id===f(n));if(Y||(Y=(await c()).find(R=>R.id===f(n))),!Y)throw new Error("illegal state");return Y},o=async()=>{(await s).save()},c=()=>(L(l,Ot.getAllDeckInfo(t).then(Y=>(L(n,(Y.find(R=>R.lastUsedAt.getTime()===Math.max(...Y.map(P=>P.lastUsedAt.getTime())))??Y[0]).id),Y))),f(l)),v=async()=>{(await f(l)).length||(await Ot.prepareSampleDeck(),c())},p=async()=>{await Promise.all([o(),v()]);const Y=await d(),R=await s;await Y.updateTimestamp();const P=zi.find(X=>X.id===R.previousNpcId);let G=Tn.slice(-1)[0];P&&(R.previousNpcDeckId>-1?G=(await f(l)).find(X=>X.id===R.previousNpcDeckId)??G:P.id===-1&&(G=Tn.find(X=>X.id===-1)??G),L(i,new qc(R,"Player",Y,[],P,"NPC",G,[],R.previousStartMode)),f(i).onDuelEnd.append(()=>(L(i,f(i)),"RemoveMe")))},h=async()=>{await Promise.all([o(),v()]),L(r,"DeckEdit")},m=async Y=>{await o(),Y.key==="Enter"&&!Y.repeat&&(await s).save()},C=()=>{L(l,c()),L(i,void 0),L(r,"None")};v(),Ct();var y=Fv(),T=_(g(y),2),w=g(T),E=_(T,2);{var B=Y=>{Lf(Y,{get duel(){return f(i)}})},U=Y=>{var R=Oe(),P=I(R);{var G=ae=>{hv(ae,{})},X=ae=>{var me=Av(),_e=g(me);Gi(_e,()=>s,ge=>{var b=Dv();S(ge,b)},(ge,b)=>{var H=Ev(),Z=I(H),te=_(g(Z),2),V=_(Z,2);Gi(V,()=>f(l),x=>{var Q=bv();S(x,Q)},(x,Q)=>{var re=Tv(),O=I(re),j=_(g(O),2);A(()=>{f(n),$i(()=>{f(Q)})}),se(j,5,()=>f(Q),ne,(Be,Fe)=>{var be=Sv(),ce={},he=g(be);A(()=>{ce!==(ce=f(Fe).id)&&(be.value=(be.__value=f(Fe).id)==null?"":f(Fe).id),D(he,f(Fe).name)}),S(Be,be)});var ue=_(O,2),Se=_(g(ue),2);A(()=>{f(b),$i(()=>{})}),se(Se,5,()=>zi,ne,(Be,Fe)=>{var be=Cv(),ce={},he=g(be);A(()=>{ce!==(ce=f(Fe).id)&&(be.value=(be.__value=f(Fe).id)==null?"":f(Fe).id),D(he,f(Fe).name)}),S(Be,be)});var de=_(Se,2),pe=g(de),le=_(ue,2),je=_(g(le),2);A(()=>{f(b),$i(()=>{f(Q)})});var Ve=g(je);Ve.value=(Ve.__value=Number.MIN_SAFE_INTEGER)==null?"":Number.MIN_SAFE_INTEGER;var tt=_(Ve);se(tt,1,()=>f(Q),ne,(Be,Fe)=>{var be=kv(),ce={},he=g(be);A(()=>{ce!==(ce=f(Fe).id)&&(be.value=(be.__value=f(Fe).id)==null?"":f(Fe).id),D(he,f(Fe).name)}),S(Be,be)});var _t=_(le,2),at=_(g(_t),2);A(()=>{f(b),$i(()=>{})}),se(at,5,()=>Ss(Sn),ne,(Be,Fe)=>{var be=wv(),ce={},he=g(be);A(()=>{ce!==(ce=f(Fe))&&(be.value=(be.__value=f(Fe))==null?"":f(Fe)),D(he,Sn[f(Fe)])}),S(Be,be)});var Qe=_(_t,2),rt=g(Qe);A(Be=>D(pe,`※${Be??""}`),[()=>{var Be;return(Be=zi.find(Fe=>Fe.id===f(b).previousNpcId))==null?void 0:Be.description}],we),Ui(j,()=>f(n),Be=>L(n,Be)),Ui(Se,()=>f(b).previousNpcId,Be=>f(b).previousNpcId=Be),Ui(je,()=>f(b).previousNpcDeckId,Be=>f(b).previousNpcDeckId=Be),Ui(at,()=>f(b).previousStartMode,Be=>f(b).previousStartMode=Be),De("click",rt,p),S(x,re)});var z=_(V,2),M=g(z);fr(te,()=>f(b).name,x=>f(b).name=x),De("keypress",te,m),De("click",M,h),S(ge,H)}),S(ae,me)};N(P,ae=>{f(r)==="DeckEdit"?ae(G):ae(X,!1)},!0)}S(Y,R)};N(E,Y=>{f(i)?Y(B):Y(U,!1)})}var ee=_(E,2),J=g(ee),q=g(J),ie=_(J,2),K=g(ie),W=_(ee,2);{var Ne=Y=>{var R=Bv(),P=g(R);{var G=me=>{var _e=Oe(),ge=I(_e);{var b=Z=>{var te=xv();S(Z,te)},H=Z=>{var te=Oe(),V=I(te);{var z=M=>{var x=Mv();S(M,x)};N(V,M=>{f(i).winner.seat==="Above"&&M(z)},!0)}S(Z,te)};N(ge,Z=>{f(i).winner.seat==="Below"?Z(b):Z(H,!1)})}S(me,_e)},X=me=>{var _e=Pv();S(me,_e)};N(P,me=>{f(i).winner?me(G):me(X,!1)})}var ae=_(P,2);De("click",ae,C),si(3,R,()=>Vu,()=>({delay:200,duration:2e3})),S(Y,R)};N(W,Y=>{f(i)&&f(i).isEnded&&Y(Ne)})}A(()=>{D(q,`build at: ${yv.timestamp}`),D(K,ga.text)}),De("click",w,C),S(a,y),ut()}Jl(Ov,{target:document.getElementById("app")});
