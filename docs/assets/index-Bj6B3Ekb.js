var Ta=Object.defineProperty;var ka=(r,e,t)=>e in r?Ta(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var l=(r,e,t)=>ka(r,typeof e!="symbol"?e+"":e,t);import{j as Ca}from"./cardInfo.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();const pi=!1;var Bi=Array.isArray,Da=Array.prototype.indexOf,qi=Array.from,Cn=Object.defineProperty,Wt=Object.getOwnPropertyDescriptor,Dn=Object.getOwnPropertyDescriptors,Ea=Object.prototype,Aa=Array.prototype,Oi=Object.getPrototypeOf;function xa(r){return typeof r=="function"}const it=()=>{};function Pa(r){return typeof(r==null?void 0:r.then)=="function"}function Ma(r){return r()}function hi(r){for(var e=0;e<r.length;e++)r[e]()}const Ie=2,En=4,Gr=8,Vr=16,yt=32,dr=64,Mr=128,Xe=256,Fr=512,Ge=1024,gt=2048,er=4096,pt=8192,Wr=16384,An=32768,Yr=65536,xn=1<<17,Fa=1<<19,Pn=1<<20,ht=Symbol("$state"),Ba=Symbol("legacy props"),qa=Symbol("");function Mn(r){return r===this.v}function Fn(r,e){return r!=r?e==e:r!==e||r!==null&&typeof r=="object"||typeof r=="function"}function Ni(r){return!Fn(r,this.v)}function Oa(r){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Na(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Ra(r){throw new Error("https://svelte.dev/e/effect_orphan")}function La(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Ha(r){throw new Error("https://svelte.dev/e/props_invalid_value")}function $a(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Ua(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function ja(){throw new Error("https://svelte.dev/e/state_unsafe_local_read")}function Za(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let ur=!1,Ga=!1;function Va(){ur=!0}const Ri=1,Li=2,Bn=4,Wa=8,Ya=16,za=1,Ka=2,Qa=4,Ja=8,Xa=16,Ia=1,es=2,ts=4,rs=1,is=2,Ne=Symbol();let Fe=null;function Br(r){Fe=r}function Re(r,e=!1,t){Fe={p:Fe,c:null,e:null,m:!1,s:r,x:null,l:null},ur&&!e&&(Fe.l={s:null,u:null,r1:[],r2:Ue(!1)})}function Le(r){const e=Fe;if(e!==null){const s=e.e;if(s!==null){var t=_e,i=be;e.e=null;try{for(var n=0;n<s.length;n++){var a=s[n];tt(a.effect),et(a.reaction),ir(a.fn)}}finally{tt(t),et(i)}}Fe=e.p,e.m=!0}return{}}function tr(){return!ur||Fe!==null&&Fe.l===null}function Ue(r,e){var t={f:0,v:r,reactions:null,equals:Mn,rv:0,wv:0};return t}function ns(r){return qn(Ue(r))}function Kt(r,e=!1){var i;const t=Ue(r);return e||(t.equals=Ni),ur&&Fe!==null&&Fe.l!==null&&((i=Fe.l).s??(i.s=[])).push(t),t}function Pe(r,e=!1){return qn(Kt(r,e))}function qn(r){return be!==null&&!st&&be.f&Ie&&(lt===null?hs([r]):lt.push(r)),r}function Ve(r,e){return ie(r,nt(()=>v(r))),e}function ie(r,e){return be!==null&&!st&&tr()&&be.f&(Ie|Vr)&&(lt===null||!lt.includes(r))&&Za(),Tt(r,e)}function Tt(r,e){return r.equals(e)||(r.v,r.v=e,r.wv=Xn(),On(r,gt),tr()&&_e!==null&&_e.f&Ge&&!(_e.f&(yt|dr))&&(ut===null?ys([r]):ut.push(r))),e}function On(r,e){var t=r.reactions;if(t!==null)for(var i=tr(),n=t.length,a=0;a<n;a++){var s=t[a],o=s.f;o&gt||!i&&s===_e||(ot(s,e),o&(Ge|Xe)&&(o&Ie?On(s,er):Xr(s)))}}let Nn=!1;function St(r,e=null,t){if(typeof r!="object"||r===null||ht in r)return r;const i=Oi(r);if(i!==Ea&&i!==Aa)return r;var n=new Map,a=Bi(r),s=Ue(0);a&&n.set("length",Ue(r.length));var o;return new Proxy(r,{defineProperty(u,d,f){(!("value"in f)||f.configurable===!1||f.enumerable===!1||f.writable===!1)&&$a();var p=n.get(d);return p===void 0?(p=Ue(f.value),n.set(d,p)):ie(p,St(f.value,o)),!0},deleteProperty(u,d){var f=n.get(d);if(f===void 0)d in u&&n.set(d,Ue(Ne));else{if(a&&typeof d=="string"){var p=n.get("length"),y=Number(d);Number.isInteger(y)&&y<p.v&&ie(p,y)}ie(f,Ne),Ki(s)}return!0},get(u,d,f){var h;if(d===ht)return r;var p=n.get(d),y=d in u;if(p===void 0&&(!y||(h=Wt(u,d))!=null&&h.writable)&&(p=Ue(St(y?u[d]:Ne,o)),n.set(d,p)),p!==void 0){var c=v(p);return c===Ne?void 0:c}return Reflect.get(u,d,f)},getOwnPropertyDescriptor(u,d){var f=Reflect.getOwnPropertyDescriptor(u,d);if(f&&"value"in f){var p=n.get(d);p&&(f.value=v(p))}else if(f===void 0){var y=n.get(d),c=y==null?void 0:y.v;if(y!==void 0&&c!==Ne)return{enumerable:!0,configurable:!0,value:c,writable:!0}}return f},has(u,d){var c;if(d===ht)return!0;var f=n.get(d),p=f!==void 0&&f.v!==Ne||Reflect.has(u,d);if(f!==void 0||_e!==null&&(!p||(c=Wt(u,d))!=null&&c.writable)){f===void 0&&(f=Ue(p?St(u[d],o):Ne),n.set(d,f));var y=v(f);if(y===Ne)return!1}return p},set(u,d,f,p){var B;var y=n.get(d),c=d in u;if(a&&d==="length")for(var h=f;h<y.v;h+=1){var m=n.get(h+"");m!==void 0?ie(m,Ne):h in u&&(m=Ue(Ne),n.set(h+"",m))}y===void 0?(!c||(B=Wt(u,d))!=null&&B.writable)&&(y=Ue(void 0),ie(y,St(f,o)),n.set(d,y)):(c=y.v!==Ne,ie(y,St(f,o)));var S=Reflect.getOwnPropertyDescriptor(u,d);if(S!=null&&S.set&&S.set.call(p,f),!c){if(a&&typeof d=="string"){var T=n.get("length"),b=Number(d);Number.isInteger(b)&&b>=T.v&&ie(T,b+1)}Ki(s)}return!0},ownKeys(u){v(s);var d=Reflect.ownKeys(u).filter(y=>{var c=n.get(y);return c===void 0||c.v!==Ne});for(var[f,p]of n)p.v!==Ne&&!(f in u)&&d.push(f);return d},setPrototypeOf(){Ua()}})}function Ki(r,e=1){ie(r,r.v+e)}function Qi(r){return r!==null&&typeof r=="object"&&ht in r?r[ht]:r}function Rn(r,e){return Object.is(Qi(r),Qi(e))}var Ji,Ln,Hn,$n;function as(){if(Ji===void 0){Ji=window,Ln=/Firefox/.test(navigator.userAgent);var r=Element.prototype,e=Node.prototype;Hn=Wt(e,"firstChild").get,$n=Wt(e,"nextSibling").get,r.__click=void 0,r.__className="",r.__attributes=null,r.__styles=null,r.__e=void 0,Text.prototype.__t=void 0}}function zr(r=""){return document.createTextNode(r)}function qr(r){return Hn.call(r)}function Kr(r){return $n.call(r)}function g(r,e){return qr(r)}function ae(r,e){{var t=qr(r);return t instanceof Comment&&t.data===""?Kr(t):t}}function _(r,e=1,t=!1){let i=r;for(;e--;)i=Kr(i);return i}function ss(r){r.textContent=""}function Ot(r){var e=Ie|gt,t=be!==null&&be.f&Ie?be:null;return _e===null||t!==null&&t.f&Xe?e|=Xe:_e.f|=Pn,{ctx:Fe,deps:null,effects:null,equals:Mn,f:e,fn:r,reactions:null,rv:0,v:null,wv:0,parent:t??_e}}function me(r){const e=Ot(r);return e.equals=Ni,e}function Un(r){var e=r.effects;if(e!==null){r.effects=null;for(var t=0;t<e.length;t+=1)kt(e[t])}}function ls(r){for(var e=r.parent;e!==null;){if(!(e.f&Ie))return e;e=e.parent}return null}function os(r){var e,t=_e;tt(ls(r));try{Un(r),e=ea(r)}finally{tt(t)}return e}function jn(r){var e=os(r),t=(wt||r.f&Xe)&&r.deps!==null?er:Ge;ot(r,t),r.equals(e)||(r.v=e,r.wv=Xn())}function Zn(r){_e===null&&be===null&&Ra(),be!==null&&be.f&Xe&&_e===null&&Na(),Ui&&Oa()}function cs(r,e){var t=e.last;t===null?e.last=e.first=r:(t.next=r,r.prev=t,e.last=r)}function rr(r,e,t,i=!0){var n=(r&dr)!==0,a=_e,s={ctx:Fe,deps:null,nodes_start:null,nodes_end:null,f:r|gt,first:null,fn:e,last:null,next:null,parent:n?null:a,prev:null,teardown:null,transitions:null,wv:0};if(t){var o=Yt;try{Ii(!0),ji(s),s.f|=An}catch(f){throw kt(s),f}finally{Ii(o)}}else e!==null&&Xr(s);var u=t&&s.deps===null&&s.first===null&&s.nodes_start===null&&s.teardown===null&&(s.f&(Pn|Mr))===0;if(!u&&!n&&i&&(a!==null&&cs(s,a),be!==null&&be.f&Ie)){var d=be;(d.effects??(d.effects=[])).push(s)}return s}function Hi(r){const e=rr(Gr,null,!1);return ot(e,Ge),e.teardown=r,e}function Xi(r){Zn();var e=_e!==null&&(_e.f&yt)!==0&&Fe!==null&&!Fe.m;if(e){var t=Fe;(t.e??(t.e=[])).push({fn:r,effect:_e,reaction:be})}else{var i=ir(r);return i}}function ds(r){return Zn(),fr(r)}function us(r){const e=rr(dr,r,!0);return(t={})=>new Promise(i=>{t.outro?Mt(e,()=>{kt(e),i(void 0)}):(kt(e),i(void 0))})}function ir(r){return rr(En,r,!1)}function fr(r){return rr(Gr,r,!0)}function M(r,e=[],t=Ot){const i=e.map(t);return Qr(()=>r(...i.map(v)))}function Qr(r,e=0){return rr(Gr|Vr|e,r,!0)}function Nt(r,e=!0){return rr(Gr|yt,r,!0,e)}function Gn(r){var e=r.teardown;if(e!==null){const t=Ui,i=be;en(!0),et(null);try{e.call(null)}finally{en(t),et(i)}}}function Vn(r,e=!1){var t=r.first;for(r.first=r.last=null;t!==null;){var i=t.next;kt(t,e),t=i}}function fs(r){for(var e=r.first;e!==null;){var t=e.next;e.f&yt||kt(e),e=t}}function kt(r,e=!0){var t=!1;if((e||r.f&Fa)&&r.nodes_start!==null){for(var i=r.nodes_start,n=r.nodes_end;i!==null;){var a=i===n?null:Kr(i);i.remove(),i=a}t=!0}Vn(r,e&&!t),Rr(r,0),ot(r,Wr);var s=r.transitions;if(s!==null)for(const u of s)u.stop();Gn(r);var o=r.parent;o!==null&&o.first!==null&&Wn(r),r.next=r.prev=r.teardown=r.ctx=r.deps=r.fn=r.nodes_start=r.nodes_end=null}function Wn(r){var e=r.parent,t=r.prev,i=r.next;t!==null&&(t.next=i),i!==null&&(i.prev=t),e!==null&&(e.first===r&&(e.first=i),e.last===r&&(e.last=t))}function Mt(r,e){var t=[];$i(r,t,!0),Yn(t,()=>{kt(r),e&&e()})}function Yn(r,e){var t=r.length;if(t>0){var i=()=>--t||e();for(var n of r)n.out(i)}else e()}function $i(r,e,t){if(!(r.f&pt)){if(r.f^=pt,r.transitions!==null)for(const s of r.transitions)(s.is_global||t)&&e.push(s);for(var i=r.first;i!==null;){var n=i.next,a=(i.f&Yr)!==0||(i.f&yt)!==0;$i(i,e,a?t:!1),i=n}}}function Qt(r){zn(r,!0)}function zn(r,e){if(r.f&pt){r.f^=pt,r.f&Ge||(r.f^=Ge),vr(r)&&(ot(r,gt),Xr(r));for(var t=r.first;t!==null;){var i=t.next,n=(t.f&Yr)!==0||(t.f&yt)!==0;zn(t,n?e:!1),t=i}if(r.transitions!==null)for(const a of r.transitions)(a.is_global||e)&&a.in()}}let Or=!1,yi=[];function Kn(){Or=!1;const r=yi.slice();yi=[],hi(r)}function Rt(r){Or||(Or=!0,queueMicrotask(Kn)),yi.push(r)}function vs(){Or&&Kn()}const Qn=0,ps=1;let Er=!1,Ar=Qn,lr=!1,or=null,Yt=!1,Ui=!1;function Ii(r){Yt=r}function en(r){Ui=r}let Pt=[],zt=0;let be=null,st=!1;function et(r){be=r}let _e=null;function tt(r){_e=r}let lt=null;function hs(r){lt=r}let je=null,Ye=0,ut=null;function ys(r){ut=r}let Jn=1,Nr=0,wt=!1,bt=null;function Xn(){return++Jn}function vr(r){var p;var e=r.f;if(e&gt)return!0;if(e&er){var t=r.deps,i=(e&Xe)!==0;if(t!==null){var n,a,s=(e&Fr)!==0,o=i&&_e!==null&&!wt,u=t.length;if(s||o){var d=r,f=d.parent;for(n=0;n<u;n++)a=t[n],(s||!((p=a==null?void 0:a.reactions)!=null&&p.includes(d)))&&(a.reactions??(a.reactions=[])).push(d);s&&(d.f^=Fr),o&&f!==null&&!(f.f&Xe)&&(d.f^=Xe)}for(n=0;n<u;n++)if(a=t[n],vr(a)&&jn(a),a.wv>r.wv)return!0}(!i||_e!==null&&!wt)&&ot(r,Ge)}return!1}function gs(r,e){for(var t=e;t!==null;){if(t.f&Mr)try{t.fn(r);return}catch{t.f^=Mr}t=t.parent}throw Er=!1,r}function ms(r){return(r.f&Wr)===0&&(r.parent===null||(r.parent.f&Mr)===0)}function Jr(r,e,t,i){if(Er){if(t===null&&(Er=!1),ms(e))throw r;return}t!==null&&(Er=!0);{gs(r,e);return}}function In(r,e,t=!0){var i=r.reactions;if(i!==null)for(var n=0;n<i.length;n++){var a=i[n];a.f&Ie?In(a,e,!1):e===a&&(t?ot(a,gt):a.f&Ge&&ot(a,er),Xr(a))}}function ea(r){var c;var e=je,t=Ye,i=ut,n=be,a=wt,s=lt,o=Fe,u=st,d=r.f;je=null,Ye=0,ut=null,be=d&(yt|dr)?null:r,wt=(d&Xe)!==0&&(!Yt||n===null||u),lt=null,Br(r.ctx),st=!1,Nr++;try{var f=(0,r.fn)(),p=r.deps;if(je!==null){var y;if(Rr(r,Ye),p!==null&&Ye>0)for(p.length=Ye+je.length,y=0;y<je.length;y++)p[Ye+y]=je[y];else r.deps=p=je;if(!wt)for(y=Ye;y<p.length;y++)((c=p[y]).reactions??(c.reactions=[])).push(r)}else p!==null&&Ye<p.length&&(Rr(r,Ye),p.length=Ye);if(tr()&&ut!==null&&!st&&p!==null&&!(r.f&(Ie|er|gt)))for(y=0;y<ut.length;y++)In(ut[y],r);return n!==null&&Nr++,f}finally{je=e,Ye=t,ut=i,be=n,wt=a,lt=s,Br(o),st=u}}function _s(r,e){let t=e.reactions;if(t!==null){var i=Da.call(t,r);if(i!==-1){var n=t.length-1;n===0?t=e.reactions=null:(t[i]=t[n],t.pop())}}t===null&&e.f&Ie&&(je===null||!je.includes(e))&&(ot(e,er),e.f&(Xe|Fr)||(e.f^=Fr),Un(e),Rr(e,0))}function Rr(r,e){var t=r.deps;if(t!==null)for(var i=e;i<t.length;i++)_s(r,t[i])}function ji(r){var e=r.f;if(!(e&Wr)){ot(r,Ge);var t=_e,i=Fe;_e=r;try{e&Vr?fs(r):Vn(r),Gn(r);var n=ea(r);r.teardown=typeof n=="function"?n:null,r.wv=Jn;var a=r.deps,s;pi&&Ga&&r.f&gt}catch(o){Jr(o,r,t,i||r.ctx)}finally{_e=t}}}function ta(){if(zt>1e3){zt=0;try{La()}catch(r){if(or!==null)Jr(r,or,null);else throw r}}zt++}function ra(r){var e=r.length;if(e!==0){ta();var t=Yt;Yt=!0;try{for(var i=0;i<e;i++){var n=r[i];n.f&Ge||(n.f^=Ge);var a=ws(n);Ss(a)}}finally{Yt=t}}}function Ss(r){var e=r.length;if(e!==0)for(var t=0;t<e;t++){var i=r[t];if(!(i.f&(Wr|pt)))try{vr(i)&&(ji(i),i.deps===null&&i.first===null&&i.nodes_start===null&&(i.teardown===null?Wn(i):i.fn=null))}catch(n){Jr(n,i,null,i.ctx)}}}function bs(){if(lr=!1,zt>1001)return;const r=Pt;Pt=[],ra(r),lr||(zt=0,or=null)}function Xr(r){Ar===Qn&&(lr||(lr=!0,queueMicrotask(bs))),or=r;for(var e=r;e.parent!==null;){e=e.parent;var t=e.f;if(t&(dr|yt)){if(!(t&Ge))return;e.f^=Ge}}Pt.push(e)}function ws(r){var e=[],t=r.first;e:for(;t!==null;){var i=t.f,n=(i&yt)!==0,a=n&&(i&Ge)!==0,s=t.next;if(!a&&!(i&pt)){if(i&En)e.push(t);else if(n)t.f^=Ge;else{var o=be;try{be=t,vr(t)&&ji(t)}catch(f){Jr(f,t,null,t.ctx)}finally{be=o}}var u=t.first;if(u!==null){t=u;continue}}if(s===null){let f=t.parent;for(;f!==null;){if(r===f)break e;var d=f.next;if(d!==null){t=d;continue e}f=f.parent}}t=s}return e}function Zi(r){var e=Ar,t=Pt;try{ta();const n=[];Ar=ps,Pt=n,lr=!1,ra(t);var i=r==null?void 0:r();return vs(),(Pt.length>0||n.length>0)&&Zi(),zt=0,or=null,i}finally{Ar=e,Pt=t}}async function Ts(){await Promise.resolve(),Zi()}function v(r){var e=r.f,t=(e&Ie)!==0;if(bt!==null&&bt.add(r),be!==null&&!st){lt!==null&&lt.includes(r)&&ja();var i=be.deps;r.rv<Nr&&(r.rv=Nr,je===null&&i!==null&&i[Ye]===r?Ye++:je===null?je=[r]:(!wt||!je.includes(r))&&je.push(r))}else if(t&&r.deps===null&&r.effects===null){var n=r,a=n.parent;a!==null&&!(a.f&Xe)&&(n.f^=Xe)}return t&&(n=r,vr(n)&&jn(n)),r.v}function ks(r){var e=bt;bt=new Set;var t=bt,i;try{if(nt(r),e!==null)for(i of bt)e.add(i)}finally{bt=e}return t}function ia(r){var e=ks(()=>nt(r));for(var t of e)if(t.f&xn)for(const i of t.deps||[])i.f&Ie||Tt(i,i.v);else Tt(t,t.v)}function nt(r){var e=st;try{return st=!0,r()}finally{st=e}}const Cs=-7169;function ot(r,e){r.f=r.f&Cs|e}function Ds(r){if(!(typeof r!="object"||!r||r instanceof EventTarget)){if(ht in r)gi(r);else if(!Array.isArray(r))for(let e in r){const t=r[e];typeof t=="object"&&t&&ht in t&&gi(t)}}}function gi(r,e=new Set){if(typeof r=="object"&&r!==null&&!(r instanceof EventTarget)&&!e.has(r)){e.add(r),r instanceof Date&&r.getTime();for(let i in r)try{gi(r[i],e)}catch{}const t=Oi(r);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const i=Dn(t);for(let n in i){const a=i[n].get;if(a)try{a.call(r)}catch{}}}}}const Es=["touchstart","touchmove"];function As(r){return Es.includes(r)}let tn=!1;function xs(){tn||(tn=!0,document.addEventListener("reset",r=>{Promise.resolve().then(()=>{var e;if(!r.defaultPrevented)for(const t of r.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function Gi(r){var e=be,t=_e;et(null),tt(null);try{return r()}finally{et(e),tt(t)}}function Ir(r,e,t,i=t){r.addEventListener(e,()=>Gi(t));const n=r.__on_r;n?r.__on_r=()=>{n(),i(!0)}:r.__on_r=()=>i(!0),xs()}const na=new Set,mi=new Set;function Ps(r,e,t,i={}){function n(a){if(i.capture||nr.call(e,a),!a.cancelBubble)return Gi(()=>t==null?void 0:t.call(this,a))}return r.startsWith("pointer")||r.startsWith("touch")||r==="wheel"?Rt(()=>{e.addEventListener(r,n,i)}):e.addEventListener(r,n,i),n}function Be(r,e,t,i,n){var a={capture:i,passive:n},s=Ps(r,e,t,a);(e===document.body||e===window||e===document)&&Hi(()=>{e.removeEventListener(r,s,a)})}function pr(r){for(var e=0;e<r.length;e++)na.add(r[e]);for(var t of mi)t(r)}function nr(r){var b;var e=this,t=e.ownerDocument,i=r.type,n=((b=r.composedPath)==null?void 0:b.call(r))||[],a=n[0]||r.target,s=0,o=r.__root;if(o){var u=n.indexOf(o);if(u!==-1&&(e===document||e===window)){r.__root=e;return}var d=n.indexOf(e);if(d===-1)return;u<=d&&(s=u)}if(a=n[s]||r.target,a!==e){Cn(r,"currentTarget",{configurable:!0,get(){return a||t}});var f=be,p=_e;et(null),tt(null);try{for(var y,c=[];a!==null;){var h=a.assignedSlot||a.parentNode||a.host||null;try{var m=a["__"+i];if(m!==void 0&&!a.disabled)if(Bi(m)){var[S,...T]=m;S.apply(a,[r,...T])}else m.call(a,r)}catch(B){y?c.push(B):y=B}if(r.cancelBubble||h===e||h===null)break;a=h}if(y){for(let B of c)queueMicrotask(()=>{throw B});throw y}}finally{r.__root=e,delete r.currentTarget,et(f),tt(p)}}}function Ms(r){var e=document.createElement("template");return e.innerHTML=r,e.content}function Lr(r,e){var t=_e;t.nodes_start===null&&(t.nodes_start=r,t.nodes_end=e)}function C(r,e){var t=(e&rs)!==0,i=(e&is)!==0,n,a=!r.startsWith("<!>");return()=>{n===void 0&&(n=Ms(a?r:"<!>"+r),t||(n=qr(n)));var s=i||Ln?document.importNode(n,!0):n.cloneNode(!0);if(t){var o=qr(s),u=s.lastChild;Lr(o,u)}else Lr(s,s);return s}}function xt(r=""){{var e=zr(r+"");return Lr(e,e),e}}function ke(){var r=document.createDocumentFragment(),e=document.createComment(""),t=zr();return r.append(e,t),Lr(e,t),r}function w(r,e){r!==null&&r.before(e)}let _i=!0;function D(r,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(r.__t??(r.__t=r.nodeValue))&&(r.__t=t,r.nodeValue=t+"")}function Fs(r,e){return Bs(r,e)}const Ht=new Map;function Bs(r,{target:e,anchor:t,props:i={},events:n,context:a,intro:s=!0}){as();var o=new Set,u=p=>{for(var y=0;y<p.length;y++){var c=p[y];if(!o.has(c)){o.add(c);var h=As(c);e.addEventListener(c,nr,{passive:h});var m=Ht.get(c);m===void 0?(document.addEventListener(c,nr,{passive:h}),Ht.set(c,1)):Ht.set(c,m+1)}}};u(qi(na)),mi.add(u);var d=void 0,f=us(()=>{var p=t??e.appendChild(zr());return Nt(()=>{if(a){Re({});var y=Fe;y.c=a}n&&(i.$$events=n),_i=s,d=r(p,i)||{},_i=!0,a&&Le()}),()=>{var h;for(var y of o){e.removeEventListener(y,nr);var c=Ht.get(y);--c===0?(document.removeEventListener(y,nr),Ht.delete(y)):Ht.set(y,c)}mi.delete(u),p!==t&&((h=p.parentNode)==null||h.removeChild(p))}});return qs.set(d,f),d}let qs=new WeakMap;const oi=0,Tr=1,ci=2;function Si(r,e,t,i,n){var a=r,s=tr(),o=Fe,u=Ne,d,f,p,y=(s?Ue:Kt)(void 0),c=(s?Ue:Kt)(void 0),h=!1;function m(T,b){h=!0,b&&(tt(S),et(S),Br(o));try{T===oi&&t&&(d?Qt(d):d=Nt(()=>t(a))),T===Tr&&i&&(f?Qt(f):f=Nt(()=>i(a,y))),T!==oi&&d&&Mt(d,()=>d=null),T!==Tr&&f&&Mt(f,()=>f=null),T!==ci&&p&&Mt(p,()=>p=null)}finally{b&&(Br(null),et(null),tt(null),Zi())}}var S=Qr(()=>{if(u!==(u=e())){if(Pa(u)){var T=u;h=!1,T.then(b=>{T===u&&(Tt(y,b),m(Tr,!0))},b=>{if(T===u)throw Tt(c,b),m(ci,!0),c.v}),Rt(()=>{h||m(oi,!0)})}else Tt(y,u),m(Tr,!1);return()=>u=Ne}})}function Z(r,e,t=!1){var i=r,n=null,a=null,s=Ne,o=t?Yr:0,u=!1;const d=(p,y=!0)=>{u=!0,f(y,p)},f=(p,y)=>{s!==(s=p)&&(s?(n?Qt(n):y&&(n=Nt(()=>y(i))),a&&Mt(a,()=>{a=null})):(a?Qt(a):y&&(a=Nt(()=>y(i))),n&&Mt(n,()=>{n=null})))};Qr(()=>{u=!1,e(d),u||f(null,null)},o)}function fe(r,e){return e}function Os(r,e,t,i){for(var n=[],a=e.length,s=0;s<a;s++)$i(e[s].e,n,!0);var o=a>0&&n.length===0&&t!==null;if(o){var u=t.parentNode;ss(u),u.append(t),i.clear(),_t(r,e[0].prev,e[a-1].next)}Yn(n,()=>{for(var d=0;d<a;d++){var f=e[d];o||(i.delete(f.k),_t(r,f.prev,f.next)),kt(f.e,!o)}})}function ve(r,e,t,i,n,a=null){var s=r,o={flags:e,items:new Map,first:null},u=(e&Bn)!==0;if(u){var d=r;s=d.appendChild(zr())}var f=null,p=!1,y=me(()=>{var c=t();return Bi(c)?c:c==null?[]:qi(c)});Qr(()=>{var c=v(y),h=c.length;p&&h===0||(p=h===0,Ns(c,o,s,n,e,i,t),a!==null&&(h===0?f?Qt(f):f=Nt(()=>a(s)):f!==null&&Mt(f,()=>{f=null})),v(y))})}function Ns(r,e,t,i,n,a,s){var I,k,F,Q;var o=(n&Wa)!==0,u=(n&(Ri|Li))!==0,d=r.length,f=e.items,p=e.first,y=p,c,h=null,m,S=[],T=[],b,B,L,$;if(o)for($=0;$<d;$+=1)b=r[$],B=a(b,$),L=f.get(B),L!==void 0&&((I=L.a)==null||I.measure(),(m??(m=new Set)).add(L));for($=0;$<d;$+=1){if(b=r[$],B=a(b,$),L=f.get(B),L===void 0){var E=y?y.e.nodes_start:t;h=Ls(E,e,h,h===null?e.first:h.next,b,B,$,i,n,s),f.set(B,h),S=[],T=[],y=h.next;continue}if(u&&Rs(L,b,$,n),L.e.f&pt&&(Qt(L.e),o&&((k=L.a)==null||k.unfix(),(m??(m=new Set)).delete(L))),L!==y){if(c!==void 0&&c.has(L)){if(S.length<T.length){var z=T[0],A;h=z.prev;var V=S[0],K=S[S.length-1];for(A=0;A<S.length;A+=1)rn(S[A],z,t);for(A=0;A<T.length;A+=1)c.delete(T[A]);_t(e,V.prev,K.next),_t(e,h,V),_t(e,K,z),y=z,h=K,$-=1,S=[],T=[]}else c.delete(L),rn(L,y,t),_t(e,L.prev,L.next),_t(e,L,h===null?e.first:h.next),_t(e,h,L),h=L;continue}for(S=[],T=[];y!==null&&y.k!==B;)y.e.f&pt||(c??(c=new Set)).add(y),T.push(y),y=y.next;if(y===null)continue;L=y}S.push(L),h=L,y=L.next}if(y!==null||c!==void 0){for(var ye=c===void 0?[]:qi(c);y!==null;)y.e.f&pt||ye.push(y),y=y.next;var Te=ye.length;if(Te>0){var Me=n&Bn&&d===0?t:null;if(o){for($=0;$<Te;$+=1)(F=ye[$].a)==null||F.measure();for($=0;$<Te;$+=1)(Q=ye[$].a)==null||Q.fix()}Os(e,ye,Me,f)}}o&&Rt(()=>{var re;if(m!==void 0)for(L of m)(re=L.a)==null||re.apply()}),_e.first=e.first&&e.first.e,_e.last=h&&h.e}function Rs(r,e,t,i){i&Ri&&Tt(r.v,e),i&Li?Tt(r.i,t):r.i=t}function Ls(r,e,t,i,n,a,s,o,u,d){var f=(u&Ri)!==0,p=(u&Ya)===0,y=f?p?Kt(n):Ue(n):n,c=u&Li?Ue(s):s,h={i:c,v:y,k:a,a:null,e:null,prev:t,next:i};try{return h.e=Nt(()=>o(r,y,c,d),Nn),h.e.prev=t&&t.e,h.e.next=i&&i.e,t===null?e.first=h:(t.next=h,t.e.next=h.e),i!==null&&(i.prev=h,i.e.prev=h.e),h}finally{}}function rn(r,e,t){for(var i=r.next?r.next.e.nodes_start:t,n=e?e.e.nodes_start:t,a=r.e.nodes_start;a!==i;){var s=Kr(a);n.before(a),a=s}}function _t(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function aa(r){var e,t,i="";if(typeof r=="string"||typeof r=="number")i+=r;else if(typeof r=="object")if(Array.isArray(r)){var n=r.length;for(e=0;e<n;e++)r[e]&&(t=aa(r[e]))&&(i&&(i+=" "),i+=t)}else for(t in r)r[t]&&(i&&(i+=" "),i+=t);return i}function Hs(){for(var r,e,t=0,i="",n=arguments.length;t<n;t++)(r=arguments[t])&&(e=aa(r))&&(i&&(i+=" "),i+=e);return i}function $t(r){return typeof r=="object"?Hs(r):r??""}function Jt(r,e,t,i){var n=r.__attributes??(r.__attributes={});n[e]!==(n[e]=t)&&(e==="style"&&"__styles"in r&&(r.__styles={}),e==="loading"&&(r[qa]=t),t==null?r.removeAttribute(e):typeof t!="string"&&$s(r).includes(e)?r[e]=t:r.setAttribute(e,t))}var nn=new Map;function $s(r){var e=nn.get(r.nodeName);if(e)return e;nn.set(r.nodeName,e=[]);for(var t,i=r,n=Element.prototype;n!==i;){t=Dn(i);for(var a in t)t[a].set&&e.push(a);i=Oi(i)}return e}function ge(r,e,t){var i=r.__className,n=Us(e,t);(i!==n||Nn)&&(e==null&&!t?r.removeAttribute("class"):r.className=n,r.__className=n)}function Us(r,e){return(r??"")+(e?" "+e:"")}const js=()=>performance.now(),vt={tick:r=>requestAnimationFrame(r),now:()=>js(),tasks:new Set};function sa(){const r=vt.now();vt.tasks.forEach(e=>{e.c(r)||(vt.tasks.delete(e),e.f())}),vt.tasks.size!==0&&vt.tick(sa)}function Zs(r){let e;return vt.tasks.size===0&&vt.tick(sa),{promise:new Promise(t=>{vt.tasks.add(e={c:r,f:t})}),abort(){vt.tasks.delete(e)}}}function kr(r,e){Gi(()=>{r.dispatchEvent(new CustomEvent(e))})}function Gs(r){if(r==="float")return"cssFloat";if(r==="offset")return"cssOffset";if(r.startsWith("--"))return r;const e=r.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function an(r){const e={},t=r.split(";");for(const i of t){const[n,a]=i.split(":");if(!n||a===void 0)break;const s=Gs(n.trim());e[s]=a.trim()}return e}const Vs=r=>r;function Ut(r,e,t,i){var n=(r&Ia)!==0,a=(r&es)!==0,s=n&&a,o=(r&ts)!==0,u=s?"both":n?"in":"out",d,f=e.inert,p=e.style.overflow,y,c;function h(){var B=be,L=_e;et(null),tt(null);try{return d??(d=t()(e,(i==null?void 0:i())??{},{direction:u}))}finally{et(B),tt(L)}}var m={is_global:o,in(){var B;if(e.inert=f,!n){c==null||c.abort(),(B=c==null?void 0:c.reset)==null||B.call(c);return}a||y==null||y.abort(),kr(e,"introstart"),y=bi(e,h(),c,1,()=>{kr(e,"introend"),y==null||y.abort(),y=d=void 0,e.style.overflow=p})},out(B){if(!a){B==null||B(),d=void 0;return}e.inert=!0,kr(e,"outrostart"),c=bi(e,h(),y,0,()=>{kr(e,"outroend"),B==null||B()})},stop:()=>{y==null||y.abort(),c==null||c.abort()}},S=_e;if((S.transitions??(S.transitions=[])).push(m),n&&_i){var T=o;if(!T){for(var b=S.parent;b&&b.f&Yr;)for(;(b=b.parent)&&!(b.f&Vr););T=!b||(b.f&An)!==0}T&&ir(()=>{nt(()=>m.in())})}}function bi(r,e,t,i,n){var a=i===1;if(xa(e)){var s,o=!1;return Rt(()=>{if(!o){var S=e({direction:a?"in":"out"});s=bi(r,S,t,i,n)}}),{abort:()=>{o=!0,s==null||s.abort()},deactivate:()=>s.deactivate(),reset:()=>s.reset(),t:()=>s.t()}}if(t==null||t.deactivate(),!(e!=null&&e.duration))return n(),{abort:it,deactivate:it,reset:it,t:()=>i};const{delay:u=0,css:d,tick:f,easing:p=Vs}=e;var y=[];if(a&&t===void 0&&(f&&f(0,1),d)){var c=an(d(0,1));y.push(c,c)}var h=()=>1-i,m=r.animate(y,{duration:u});return m.onfinish=()=>{var S=(t==null?void 0:t.t())??1-i;t==null||t.abort();var T=i-S,b=e.duration*Math.abs(T),B=[];if(b>0){var L=!1;if(d)for(var $=Math.ceil(b/16.666666666666668),E=0;E<=$;E+=1){var z=S+T*p(E/$),A=an(d(z,1-z));B.push(A),L||(L=A.overflow==="hidden")}L&&(r.style.overflow="hidden"),h=()=>{var V=m.currentTime;return S+T*p(V/b)},f&&Zs(()=>{if(m.playState!=="running")return!1;var V=h();return f(V,1-V),!0})}m=r.animate(B,{duration:b,fill:"forwards"}),m.onfinish=()=>{h=()=>i,f==null||f(i,1-i),n()}},{abort:()=>{m&&(m.cancel(),m.effect=null,m.onfinish=it)},deactivate:()=>{n=it},reset:()=>{i===0&&(f==null||f(1,0))},t:()=>h()}}function wi(r,e,t=e){var i=tr();Ir(r,"input",n=>{var a=n?r.defaultValue:r.value;if(a=ui(r)?fi(a):a,t(a),i&&a!==(a=e())){var s=r.selectionStart,o=r.selectionEnd;r.value=a??"",o!==null&&(r.selectionStart=s,r.selectionEnd=Math.min(o,r.value.length))}}),nt(e)==null&&r.value&&t(ui(r)?fi(r.value):r.value),fr(()=>{var n=e();ui(r)&&n===fi(r.value)||r.type==="date"&&!n&&!r.value||n!==r.value&&(r.value=n??"")})}const di=new Set;function jt(r,e,t,i,n=i){var a=t.getAttribute("type")==="checkbox",s=r;if(e!==null)for(var o of e)s=s[o]??(s[o]=[]);s.push(t),Ir(t,"change",()=>{var u=t.__value;a&&(u=Ys(s,u,t.checked)),n(u)},()=>n(a?[]:null)),fr(()=>{var u=i();a?(u=u||[],t.checked=u.includes(t.__value)):t.checked=Rn(t.__value,u)}),Hi(()=>{var u=s.indexOf(t);u!==-1&&s.splice(u,1)}),di.has(s)||(di.add(s),Rt(()=>{s.sort((u,d)=>u.compareDocumentPosition(d)===4?-1:1),di.delete(s)})),Rt(()=>{})}function Ws(r,e,t=e){Ir(r,"change",i=>{var n=i?r.defaultChecked:r.checked;t(n)}),nt(e)==null&&t(r.checked),fr(()=>{var i=e();r.checked=!!i})}function Ys(r,e,t){for(var i=new Set,n=0;n<r.length;n+=1)r[n].checked&&i.add(r[n].__value);return t||i.delete(e),Array.from(i)}function ui(r){var e=r.type;return e==="number"||e==="range"}function fi(r){return r===""?null:+r}function la(r,e,t){if(r.multiple)return Ks(r,e);for(var i of r.options){var n=sr(i);if(Rn(n,e)){i.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function zs(r,e){ir(()=>{var t=new MutationObserver(()=>{var i=r.__value;la(r,i)});return t.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{t.disconnect()}})}function oa(r,e,t=e){var i=!0;Ir(r,"change",n=>{var a=n?"[selected]":":checked",s;if(r.multiple)s=[].map.call(r.querySelectorAll(a),sr);else{var o=r.querySelector(a)??r.querySelector("option:not([disabled])");s=o&&sr(o)}t(s)}),ir(()=>{var n=e();if(la(r,n,i),i&&n===void 0){var a=r.querySelector(":checked");a!==null&&(n=sr(a),t(n))}r.__value=n,i=!1}),zs(r)}function Ks(r,e){for(var t of r.options)t.selected=~e.indexOf(sr(t))}function sr(r){return"__value"in r?r.__value:r.value}function sn(r,e){return r===e||(r==null?void 0:r[ht])===e}function Qs(r={},e,t,i){return ir(()=>{var n,a;return fr(()=>{n=a,a=[],nt(()=>{r!==t(...a)&&(e(r,...a),n&&sn(t(...n),r)&&e(null,...n))})}),()=>{Rt(()=>{a&&sn(t(...a),r)&&e(null,...a)})}}),r}function ze(r=!1){const e=Fe,t=e.l.u;if(!t)return;let i=()=>Ds(e.s);if(r){let n=0,a={};const s=Ot(()=>{let o=!1;const u=e.s;for(const d in u)u[d]!==a[d]&&(a[d]=u[d],o=!0);return o&&n++,n});i=()=>v(s)}t.b.length&&ds(()=>{ln(e,i),hi(t.b)}),Xi(()=>{const n=nt(()=>t.m.map(Ma));return()=>{for(const a of n)typeof a=="function"&&a()}}),t.a.length&&Xi(()=>{ln(e,i),hi(t.a)})}function ln(r,e){if(r.l.s)for(const t of r.l.s)v(t);e()}function ca(r,e,t){if(r==null)return e(void 0),it;const i=nt(()=>r.subscribe(e,t));return i.unsubscribe?()=>i.unsubscribe():i}const Zt=[];function Js(r,e=it){let t=null;const i=new Set;function n(o){if(Fn(r,o)&&(r=o,t)){const u=!Zt.length;for(const d of i)d[1](),Zt.push(d,r);if(u){for(let d=0;d<Zt.length;d+=2)Zt[d][0](Zt[d+1]);Zt.length=0}}}function a(o){n(o(r))}function s(o,u=it){const d=[o,u];return i.add(d),i.size===1&&(t=e(n,a)||it),o(r),()=>{i.delete(d),i.size===0&&t&&(t(),t=null)}}return{set:n,update:a,subscribe:s}}function Xs(r){let e;return ca(r,t=>e=t)(),e}let Cr=!1,Ti=Symbol();function Is(r,e,t){const i=t[e]??(t[e]={store:null,source:Kt(void 0),unsubscribe:it});if(i.store!==r&&!(Ti in t))if(i.unsubscribe(),i.store=r??null,r==null)i.source.v=void 0,i.unsubscribe=it;else{var n=!0;i.unsubscribe=ca(r,a=>{n?i.source.v=a:ie(i.source,a)}),n=!1}return r&&Ti in t?Xs(r):v(i.source)}function el(){const r={};function e(){Hi(()=>{for(var t in r)r[t].unsubscribe();Cn(r,Ti,{enumerable:!1,value:!0})})}return[r,e]}function tl(r){var e=Cr;try{return Cr=!1,[r(),Cr]}finally{Cr=e}}function Se(r,e,t,i){var z;var n=(t&za)!==0,a=!ur||(t&Ka)!==0,s=(t&Ja)!==0,o=(t&Xa)!==0,u=!1,d;s?[d,u]=tl(()=>r[e]):d=r[e];var f=ht in r||Ba in r,p=s&&(((z=Wt(r,e))==null?void 0:z.set)??(f&&e in r&&(A=>r[e]=A)))||void 0,y=i,c=!0,h=!1,m=()=>(h=!0,c&&(c=!1,o?y=nt(i):y=i),y);d===void 0&&i!==void 0&&(p&&a&&Ha(),d=m(),p&&p(d));var S;if(a)S=()=>{var A=r[e];return A===void 0?m():(c=!0,h=!1,A)};else{var T=(n?Ot:me)(()=>r[e]);T.f|=xn,S=()=>{var A=v(T);return A!==void 0&&(y=void 0),A===void 0?y:A}}if(!(t&Qa))return S;if(p){var b=r.$$legacy;return function(A,V){return arguments.length>0?((!a||!V||b||u)&&p(V?S():A),A):S()}}var B=!1,L=!1,$=Kt(d),E=Ot(()=>{var A=S(),V=v($);return B?(B=!1,L=!0,V):(L=!1,$.v=A)});return n||(E.equals=Ni),function(A,V){if(bt!==null&&(B=L,S(),v($)),arguments.length>0){const K=V?v(E):a&&s?St(A):A;return E.equals(K)||(B=!0,ie($,K),h&&y!==void 0&&(y=K),nt(()=>v(E))),A}return v(E)}}const rl="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(rl);Va();class il{constructor(e,t,i){l(this,"_dbname");l(this,"_dbversion");l(this,"dbPromise");l(this,"getTran",async(e,t)=>(await this.dbPromise).transaction(e,t));l(this,"reset",async()=>(await indexedDB.databases().then(e=>{console.log(e)}),await new Promise((e,t)=>{const i=indexedDB.deleteDatabase(this._dbname);i.onsuccess=()=>{console.log("onsuccess"),e()},i.onerror=n=>{console.log("onerror"),t(n)}})));l(this,"getAll",async e=>{const t=await this.dbPromise;return new Promise((i,n)=>{const o=t.transaction([e],"readonly").objectStore(e).getAll();o.onsuccess=()=>{i(o.result)},o.onerror=u=>{n(u)}})});l(this,"get",async(e,t)=>{const i=await this.dbPromise;return new Promise((n,a)=>{const u=i.transaction([e],"readonly").objectStore(e).get(t);u.onsuccess=()=>{n(u.result)},u.onerror=d=>{a(d)}})});l(this,"getMany",async(e,t)=>{const a=(await this.dbPromise).transaction([e],"readonly").objectStore(e),s=t.map(o=>new Promise((u,d)=>{const f=a.get(o);f.onsuccess=()=>{u(f.result)},f.onerror=p=>{d(p)}}));return await Promise.all(s)});l(this,"putRecords",async(e,t)=>{const n=(await this.dbPromise).transaction([e],"readwrite"),a=n.objectStore(e),s=t.map(o=>({record:o,request:a.put(o)}));return new Promise((o,u)=>{n.oncomplete=()=>o(s.map(d=>Object.assign({id:d.request.result},d.record))),n.onerror=d=>u(d)})});l(this,"deleteRecords",async(e,t)=>{const n=(await this.dbPromise).transaction([e],"readwrite"),a=n.objectStore(e),s=t.map(o=>({key:o,request:a.delete(o)}));return new Promise((o,u)=>{n.oncomplete=()=>{console.log(s.map(d=>d.request.result)),o()},n.onerror=d=>u(d)})});this._dbname=e,this._dbversion=t,this.dbPromise=new Promise((n,a)=>{const s=indexedDB.open(e,t);s.onsuccess=o=>{if(console.log(o),!o.target){console.log("event.target is undefined"),a("event.target is undefined");return}const u=o.target.result;if(!u){console.log("event.target.result is undefined"),a("event.target.result is undefined");return}u.onversionchange=d=>{console.log(d),u.close()},n(u)},s.onupgradeneeded=o=>{console.log("onupgradeneeded");const u=o.target.result;i.filter(d=>!u.objectStoreNames.contains(d)).map(d=>u.createObjectStore(d,{keyPath:"id",autoIncrement:!0}))},s.onerror=o=>{console.log(o),a(o)},s.onblocked=o=>{console.log(o),a(o)}}),console.log(this.dbPromise)}get dbversion(){return this._dbversion}}class We{constructor(){l(this,"handlers",[])}append(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}trigger(e){this.handlers.slice(0).forEach(t=>t(e))}clear(){this.handlers.splice(0)}expose(){return this}}class on{constructor(){l(this,"handler")}set(e){this.handler=e}async call(e){if(!this.handler)throw Error("illegal state error");return await this.handler(e)}expose(){return this}}class Vi{constructor(e,t,i,n){l(this,"_name");l(this,"_createVersion");l(this,"mountResolver",()=>{});l(this,"_indexedDb");l(this,"onInsertEvent",new We);l(this,"onBeforeInsertEvent",new on);l(this,"onUpdateEvent",new We);l(this,"onBeforeUpdateEvent",new on);l(this,"onDeleteEvent",new We);l(this,"prepareInitialRecords",()=>{const e=new Date;return this._prepareInitialRecords().map(t=>Object.assign(t,{createdAt:e,updatedAt:e,dbVersion:this._createVersion}))});l(this,"resolveMount",()=>this.mountResolver());l(this,"patchForInsert",(e,t)=>{e.newRecords.forEach(i=>{console.log(i),t[i.id]=i})});l(this,"patchForUpdate",(e,t)=>{e.recordPairs.forEach(i=>{console.log(t[i.newRecord.id],i.newRecord),t[i.newRecord.id]={...i.newRecord}})});l(this,"patchForDelete",(e,t)=>{e.oldRecords.forEach(i=>{console.log(i),delete t[i.id]})});this._indexedDb=e,this._name=t,this._createVersion=e.dbversion,this.getAll().then(a=>a.reduce((s,o)=>(s[o.id]=o,s),{})).then(a=>{console.log(this.name,a),this.onBeforeInsertEvent.set(i??(()=>Promise.resolve())),this.onBeforeUpdateEvent.set(n??(()=>Promise.resolve()))})}get name(){return this._name}get createVersion(){return this._createVersion}get oninsert(){return this.onInsertEvent.expose()}get onbeforeinsert(){return this.onBeforeInsertEvent.expose()}get onupdate(){return this.onUpdateEvent.expose()}get onbeforeupdate(){return this.onBeforeUpdateEvent.expose()}get ondelete(){return this.onDeleteEvent.expose()}getAll(){return this._indexedDb.getAll(this.name)}get(e){return this._indexedDb.get(this.name,e)}async insertMany(e){const t=new Date,i=e.map(a=>{const s={createdAt:t,updatedAt:t,dbVersion:this._createVersion};return Object.assign(a,s)});await this.onBeforeInsertEvent.call({sender:this,newRecords:i,timestamp:t});const n=await this._indexedDb.putRecords(this.name,i);return this.onInsertEvent.trigger({sender:this,newRecords:n,timestamp:t}),n}async insert(e){return(await this.insertMany([e]))[0]}async updateMany(e,t){const i=new Date,n=[];return(await this._indexedDb.getMany(this.name,e)).forEach(s=>{const o={...s},u={...o};n.push({newRecord:Object.assign(t(u),{updatedAt:i,dbVersion:this._createVersion}),oldRecord:o})}),await this.onBeforeUpdateEvent.call({sender:this,recordPairs:n,timestamp:i}),await this._indexedDb.putRecords(this.name,n.map(s=>s.newRecord)),this.onUpdateEvent.trigger({sender:this,recordPairs:n,timestamp:i}),n.map(s=>s.newRecord)}async update(e,t){return(await this.updateMany([e],t))[0]}async delete(e){const t=new Date,i=await this._indexedDb.getMany(this.name,e);await this._indexedDb.deleteRecords(this.name,e),this.onDeleteEvent.trigger({sender:this,oldRecords:i,timestamp:t})}}const Je=class Je{constructor(e){l(this,"id");l(this,"name");l(this,"description");l(this,"save",async e=>{const t=e??{id:this.id,name:this.name,description:this.description},i=await Je.tblHeader.update(this.id,n=>({...n,...t}));return new Je(i)});this.id=e.id,this.name=e.name,this.description=e.description}};l(Je,"tblHeader"),l(Je,"getOrCreateNew",async e=>{Je.tblHeader||(Je.tblHeader=new nl(e));const t=await Je.tblHeader.getAll();if(t.length)return new Je(t[0]);const i=await Je.tblHeader.insert({name:"あなた",description:"ここの文字列を何に使うかは未定。"});return new Je(i)});let ki=Je;class nl extends Vi{constructor(t){super(t,"TblDuelistProfile");l(this,"_prepareInitialRecords",()=>[])}}let al=-1;const sl=[{id:al--,name:"NPC",description:""}],ll=["Deck","ExtraDeck"],ol={Deck:"メインデッキ",ExtraDeck:"エクストラデッキ"},Ci=["Monster","Spell","Trap"],da={Monster:"モンスター",Spell:"魔法",Trap:"罠"},Xt=["Fusion","Syncro","Xyz","Link"],ua=[...Xt,"SpecialSummon"],cl=["Toon","Spirit","Union","Gemini","FlipEffect"],dl=["Tuner","Effect","Normal","Pendulum","Token","NormalSummonOnly"],cn=[...ua,...cl,...dl],ei={Syncro:"シンクロ",Fusion:"融合",Xyz:"エクシーズ",Link:"リンク",SpecialSummon:"特殊召喚",Toon:"トゥーン",Spirit:"スピリット",Union:"ユニオン",Gemini:"デュアル",FlipEffect:"リバース",Tuner:"チューナー",Effect:"効果",Normal:"通常",Pendulum:"ペンデュラム",Token:"トークン",NormalSummonOnly:"特殊召喚不可"},hr={Syncro:"🎵",Fusion:"🌀",Xyz:"📰",Link:"⛓️",SpecialSummon:"🔯",Toon:"📖",Spirit:"👻",Union:"🚗",Gemini:"👫",FlipEffect:"🔄",Tuner:"🎶",Effect:"✨",Normal:"🔘",Pendulum:"💠",Token:"🐏",NormalSummonOnly:"🔲"},dn=["Light","Dark","Earth","Water","Fire","Wind","Divine"],Wi={Light:"光",Dark:"闇",Earth:"地",Water:"水",Fire:"炎",Wind:"風",Divine:"神"},un=["Aqua","Beast","BeastWarrior","CreatorGod","Cyberse","Dinosaur","DivineBeast","Dragon","Fairy","Fiend","Fish","Insect","Illusion","Machine","Plant","Psychic","Pyro","Reptile","Rock","SeaSerpent","Spellcaster","Thunder","Warrior","WingedBeast","Wyrm","Zombie"],fn=["Normal","Continuous","Field","QuickPlay","Equip","Ritual"],yr={Normal:"通常",Continuous:"永続",Field:"フィールド",QuickPlay:"速攻",Equip:"装備",Ritual:"儀式"},vn=["Normal","Continuous","Counter"],gr={Normal:"通常",Continuous:"永続",Counter:"カウンター"},Dr={Attack:"攻撃表示",Defense:"守備表示",Set:"裏側守備表示"},fa=["level","rank","attack","defense","pendulumScaleR","pendulumScaleL"],ul=({wikiName:r,wikiHref:e,wikiTextAll:t,nameKana:i,description:n,pendulumDescription:a,...s})=>s,fl=r=>ul(r),ti={Aqua:"水",Beast:"獣",BeastWarrior:"獣戦士",CreatorGod:"創造神",Cyberse:"サイバース",Dinosaur:"恐竜",DivineBeast:"幻獣神",Dragon:"ドラゴン",Fairy:"天使",Fiend:"悪魔",Fish:"魚",Insect:"昆虫",Illusion:"幻想魔",Machine:"機械",Plant:"植物",Psychic:"サイキック",Pyro:"炎",Reptile:"爬虫類",Rock:"岩石",SeaSerpent:"海竜",Spellcaster:"魔法使い",Thunder:"雷",Warrior:"戦士",WingedBeast:"鳥獣",Wyrm:"幻竜",Zombie:"アンデット"},mr={Aqua:"🚰",Beast:"🐅",BeastWarrior:"🦁",CreatorGod:"🔆",Cyberse:"💻️",Dinosaur:"🦖",DivineBeast:"💫",Dragon:"🐲",Fairy:"👼",Fiend:"👿",Fish:"🐟️",Insect:"🦋",Illusion:"🤡",Machine:"🤖",Plant:"🌱",Psychic:"👁️",Pyro:"🔥",Reptile:"🦎",Rock:"⛰",SeaSerpent:"🐍",Spellcaster:"🧙",Thunder:"⚡️",Warrior:"⚔️",WingedBeast:"🦅",Wyrm:"🐉",Zombie:"🦴"},va=["Deck","ExtraDeck"],vl=[...va,"Graveyard","Banished"],Hr=["MonsterZone","ExtraMonsterZone"],Lt=["SpellAndTrapZone","FieldSpellZone"],_r=[...Hr,...Lt],Di={0:{0:"Hand"},1:{0:"Deck",1:"SpellAndTrapZone",2:"SpellAndTrapZone",3:"SpellAndTrapZone",4:"SpellAndTrapZone",5:"SpellAndTrapZone",6:"ExtraDeck"},2:{0:"Graveyard",1:"MonsterZone",2:"MonsterZone",3:"MonsterZone",4:"MonsterZone",5:"MonsterZone",6:"FieldSpellZone"},3:{0:"Banished",1:"Disable",2:"ExtraMonsterZone",3:"Disable",4:"ExtraMonsterZone",5:"Disable",6:"Banished"},4:{0:"FieldSpellZone",1:"MonsterZone",2:"MonsterZone",3:"MonsterZone",4:"MonsterZone",5:"MonsterZone",6:"Graveyard"},5:{0:"ExtraDeck",1:"SpellAndTrapZone",2:"SpellAndTrapZone",3:"SpellAndTrapZone",4:"SpellAndTrapZone",5:"SpellAndTrapZone",6:"Deck"},6:{0:"Hand"}};class pl{constructor(e,t,i,n){l(this,"onUpdateEvent",new We);l(this,"field");l(this,"row");l(this,"column");l(this,"cellType");l(this,"owner");l(this,"_needsShuffle",!1);l(this,"_entities");l(this,"releaseEntities",e=>(this._entities=this._entities.filter(t=>!e.includes(t)),this.onUpdateEvent.trigger(),e));l(this,"acceptEntities",(e,t)=>{t==="Top"?this._entities.unshift(...e):this._entities.push(...e),t==="Random"&&(this._needsShuffle=!0),this._entities.forEach(i=>{i.fieldCell=this}),this.onUpdateEvent.trigger()});l(this,"shuffle",()=>{this._entities=this.entities.shuffle(),this._needsShuffle=!1});this.field=e,this.row=t,this.column=i,this.cellType=Di[t][i],this.owner=n,this._entities=[]}get onUpdate(){return this.onUpdateEvent.expose()}get needsShuffle(){return this._needsShuffle}get entities(){return this._entities}get cardEntities(){return this._entities.filter(e=>Wl.find(t=>t===e.entityType))}get targetForAttack(){return this.cellType==="Hand"?this._entities.find(e=>e.entityType==="Duelist"):this.cardEntities[0]}get isAvailable(){return this._entities.length===0}get isStackCell(){return vl.some(e=>e===this.cellType)}get isPlayFieldCell(){return _r.some(e=>e===this.cellType)}}Array.prototype.shuffle=function(){return this.map(e=>({item:e,seq:Math.random()})).toSorted((e,t)=>e.seq-t.seq).map(e=>e.item)};Array.prototype.randomPickMany=function(r){return this.shuffle().slice(0,r)};Array.prototype.randomPick=function(){return this.shuffle().slice(0,1)[0]};Array.prototype.reset=function(...r){this.splice(0),this.push(...r)};Array.prototype.union=function(r){return this.filter(e=>r.find(t=>e===t))};Array.prototype.getAllOnOffPattern=function(){const r=[];return this.forEach(e=>{if(r.length==0){r.push([e]),r.push([]);return}r.forEach(t=>r.push([...t,e]))}),r};Array.prototype.getDistinct=function(){return Array.from(new Set(this))};const hl=["NormalSummon","SpecialSummon","ChangeBattlePosition","Battle","SpellTrapSet","SpellTrapActivate"],pn=["NormalSummon","AdvanceSummon","SpecialSummon","SpecialSummonFromDeck","SendToGraveyardFromDeck","Draw","SearchFromDeck","BanishFromGraveyard","AddToHandFromGraveyard","ReturnToDeckFromGraveyard","SpecialSummonFromGraveyard","Destroy","DestroyMultiple","DestroyOnField","DestroyMultipleOnField","DestroyOnOpponentField","DestroyMultipleOnOpponentField","DestroyMonsterOnField","DestroyMonstersOnField","DestroySpellTrapOnField","DestroySpellTrapsOnField","IfNormarlSummonSucceed","IfSpecialSummonSucceed","DamageToOpponent","DamageToSelf","PayLifePoint","DiscordAsCost","DiscordAsEffect","RollDice","BounceToHand","NegateCardEffect","NegateCardActivation"],Et=r=>r.playType==="CardActivation"?r.entity.nm:`${r.entity.nm}«${r.title}»`,dt=class dt{constructor(e,t,i){l(this,"seq");l(this,"entity");l(this,"cardActionBase");l(this,"getClone",()=>new dt(this.seq,this.entity,this.cardActionBase));l(this,"validate",e=>{if(!(this.playType==="CardActivation"&&this.entity.isOnField&&this.entity.face==="FaceUp")&&!(this.isOnlyNTimesPerDuel>0&&this.entity.field.duel.cardActionLog.records.filter(t=>this.isSame(t.cardAction)).filter(t=>t.activator).length>=this.isOnlyNTimesPerDuel)&&!(this.isOnlyNTimesPerTurn>0&&this.entity.field.duel.cardActionLog.records.filter(t=>this.isSameGroupPerTurn(t.cardAction)).filter(t=>t.clock.turn===this.entity.field.duel.clock.turn).filter(t=>t.activator).length>=this.isOnlyNTimesPerTurn))return this.cardActionBase.validate(this,e)});l(this,"prepare",async(e,t,i)=>{this.isLikeContinuousSpell&&(this.entity.info.isPending=!0);const n=this.entity.fieldCell,a=await this.cardActionBase.prepare(this,e,t,i);if(a!==void 0)return this.entity.field.duel.cardActionLog.push(this.entity.controller,this),{...a,action:this,activator:this.entity.controller,isActivatedIn:n}});l(this,"execute",async(e,t)=>{if(e.action.isLikeContinuousSpell&&!e.action.entity.isOnField)return this.entity.info.isPending=!1,!1;const i=await this.cardActionBase.execute(e,t);if(e.action.isLikeContinuousSpell)for(const n of this.entity.continuousEffects)this.entity.info.isPending=!1,await n.updateState();return i});l(this,"settle",(e,t)=>this.cardActionBase.settle(e,t));l(this,"isSame",e=>this.entity.origin.name===e.entity.origin.name&&this.title===e.title);l(this,"isSameGroupPerTurn",e=>this.actionGroupNamePerTurn?this.entity.origin.name===e.entity.origin.name&&this.actionGroupNamePerTurn===e.actionGroupNamePerTurn:this.isSame(e));l(this,"calcChainBlockTagsForDestroy",e=>{if(!pn.length)return[];const t=["Destroy"];pn.length>1&&t.push("DestroyMultiple");const i=e.filter(o=>o.isOnField);i.length&&(t.push("DestroyOnField"),i.length>1&&t.push("DestroyMultipleOnField"));const n=i.filter(o=>o.status.kind==="Monster");n.length&&(t.push("DestroyMonsterOnField"),n.length>1&&t.push("DestroyMonstersOnField")),i.filter(o=>o.status.kind!=="Monster").length&&(t.push("DestroySpellTrapOnField"),n.length>1&&t.push("DestroySpellTrapsOnField"));const s=i.filter(o=>o.controller!==this.entity.controller);return s.length&&(t.push("DestroyOnOpponentField"),s.length>1&&t.push("DestroyMultipleOnOpponentField")),t});this.seq=e,this.entity=t,this.cardActionBase=i}get title(){return this.cardActionBase.title}get playType(){return this.cardActionBase.playType}get spellSpeed(){return this.cardActionBase.spellSpeed}get hasToTargetCards(){return this.cardActionBase.hasToTargetCards??!1}get executableCells(){return this.cardActionBase.executableCells}get executablePeriods(){return this.cardActionBase.executablePeriods}get executableDuelistTypes(){return this.cardActionBase.executableDuelistTypes}get executableDuelists(){const e=[];return this.cardActionBase.executableDuelistTypes.includes("Controller")&&e.push(this.entity.controller),this.cardActionBase.executableDuelistTypes.includes("Opponent")&&e.push(this.entity.controller.getOpponentPlayer()),e}get isOnlyNTimesPerDuel(){return this.cardActionBase.isOnlyNTimesPerDuel??0}get isOnlyNTimesPerTurn(){return this.cardActionBase.isOnlyNTimesPerTurn??0}get isLikeContinuousSpell(){return this.cardActionBase.isLikeContinuousSpell||this.entity.isLikeContinuousSpell&&this.playType==="CardActivation"}get actionGroupNamePerTurn(){return this.cardActionBase.actionGroupNamePerTurn}};l(dt,"nextActionSeq",0),l(dt,"createNew",(e,t)=>new dt(dt.nextActionSeq++,e,t)),l(dt,"createDammyAction",(e,t,i,n)=>({seq:dt.nextActionSeq++,title:t,entity:e,playType:"Dammy",spellSpeed:"Dammy",hasToTargetCards:!1,isOnlyNTimesPerDuel:0,isOnlyNTimesPerTurn:0,isLikeContinuousSpell:!1,getClone:function(){return this},validate:()=>i,prepare:async()=>{},execute:async()=>!1,settle:async()=>!1,pos:n,cell:i[0],dragAndDropOnly:i.length>1}));let Ct=dt;const pa=async()=>({selectedEntities:[],chainBlockTags:[],prepared:void 0}),yl=r=>{if(r.entity.controller.info.ruleNormalSummonCount>=r.entity.controller.info.maxRuleNormalSummonCount||!r.entity.lvl)return;const e=r.entity.controller.getAvailableMonsterZones();return r.entity.lvl<5?e.length>0?e:void 0:r.entity.controller.getReleasableMonsters().length<(r.entity.lvl<7?1:2)?void 0:[]},gl=async(r,e,t,i)=>{if(!r.entity.lvl)return;let n=e?[e]:r.entity.controller.getAvailableMonsterZones();if(n.length===0)return;let a=i,s=[];if(r.entity.lvl>4){const d=r.entity.controller.getReleasableMonsters(),f=r.entity.controller.getExtraMonsterZones(),p=r.entity.lvl<7?1:2;f.length>=p&&d.filter(c=>c.fieldCell.cellType!=="ExtraMonsterZone");const y=await r.entity.field.release(r.entity.controller,r.entity.controller.getReleasableMonsters(),p,"Cost",["AdvanceSummonRelease","Rule"],r.entity,a);if(!y)return;s=y,a=!1,n=r.entity.controller.getAvailableMonsterZones()}let o=(r.entity.atk??0)>0&&(r.entity.atk??0)>=(r.entity.def??0)?"Attack":"Set",u=n.randomPick();if(r.entity.controller.duelistType!=="NPC"){const d=await r.entity.field.duel.view.waitSelectSummonDest(r.entity,n,["Attack","Set"],a);if(!d)return;u=d.dest,o=d.pos}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:u,pos:o,materials:s}}},ml=async r=>{const e=["Rule","NormalSummon"];return r.prepared.materials.length>0&&(r.action.entity.info.materials.reset(...r.prepared.materials),e.push("AdvanceSummon")),await r.action.entity.summon(r.prepared.dest,r.prepared.pos,"NormalSummon",e,r.action.entity,r.activator),r.activator.info.ruleNormalSummonCount++,r.activator.info.ruleNormalSummonCountQty++,!0},hn=(r,e,t)=>{const i=r.entity.controller.getAvailableMonsterZones();if(r.entity.fieldCell.cellType==="ExtraDeck"&&i.push(...r.entity.controller.getAvailableExtraZones()),!(!i.length&&(!t.length||t.every(n=>n.fieldCell.cellType!=="MonsterZone")&&r.entity.fieldCell.cellType!=="ExtraDeck"))&&r.entity.controller.canSummon(r.entity.controller,r.entity,r,"SpecialSummon",e,t).length)return t.length===0?i:[]},yn=async(r,e,t,i,n)=>{const a=e?[e]:r.entity.controller.getAvailableMonsterZones();if(a.length===0)return;const s=r.entity.controller.canSummon(r.entity.controller,r.entity,r,"SpecialSummon",t,i);if(s.length===0)return;let o=s.randomPick(),u=a.randomPick();if(s.length&&s.includes("Attack")&&(o=(r.entity.atk??0)>0&&(r.entity.atk??0)>=(r.entity.def??0)?"Attack":s.filter(d=>d!=="Attack").randomPick()),r.entity.controller.duelistType!=="NPC"){const d=await r.entity.field.duel.view.waitSelectSummonDest(r.entity,a,s,n);if(!d)return;u=d.dest,o=d.pos}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:u,pos:o,materials:i}}},gn=async r=>{const e=["Rule","SpecialSummon"];return await r.action.entity.summon(r.prepared.dest,r.prepared.pos,"SpecialSummon",e,r.action.entity,r.activator),r.action.entity.info.materials=r.prepared.materials,!0},$e={title:"通常召喚",playType:"NormalSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:yl,prepare:gl,execute:ml,settle:async()=>!0},_l=r=>{if(r.entity.info.attackCount>0||r.entity.battlePosition!=="Attack"||!r.entity.controller.isTurnPlayer)return;const e=r.entity.controller.getAttackTargetMonsters();return e.length>0?e.map(t=>t.fieldCell):[r.entity.controller.getOpponentPlayer().getHandCell()]},Sl=async(r,e)=>{if(r.entity.info.attackCount>0||r.entity.battlePosition!=="Attack")return;if(e!=null&&e.targetForAttack)return{selectedEntities:[],chainBlockTags:[],prepared:{target:e.targetForAttack}};const t=r.entity.controller.getAttackTargetMonsters(),i=r.entity.controller.getOpponentPlayer().entity;if(t.length===0)return{selectedEntities:[],chainBlockTags:[],prepared:{target:i}};if(t.length===1)return{selectedEntities:[],chainBlockTags:[],prepared:{target:t[0]}};const n=await r.entity.field.duel.view.waitSelectEntities(r.entity.controller,t,1,a=>a.length===1,"攻撃対象を選択。",!0);if(n)return{selectedEntities:[],chainBlockTags:[],prepared:{target:n[0]}}},bl=async r=>(r.action.entity.field.duel.declareAnAttack(r.action.entity,r.prepared.target),!0),qe={title:"攻撃宣言",playType:"Battle",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["b1Battle","b2Battle"],executableDuelistTypes:["Controller"],validate:_l,prepare:Sl,execute:bl,settle:async()=>!0},wl=r=>{if(!(r.entity.info.battlePotisionChangeCount>0||r.entity.info.attackCount>0||!r.entity.controller.isTurnPlayer))return[]},Tl=async r=>r.action.entity.info.battlePotisionChangeCount>0||!r.action.entity.controller.isTurnPlayer?!1:(await r.action.entity.setBattlePosition(r.action.entity.battlePosition==="Attack"?"Defense":"Attack",["Rule"],r.action.entity,r.activator),r.action.entity.info.battlePotisionChangeCount++,!0),Oe={title:"表示形式変更",playType:"ChangeBattlePosition",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:wl,prepare:pa,execute:Tl,settle:async()=>!0},ha=(r,e,t,i)=>!(!r.entity.origin.level||e.some(n=>!n.lvl)||e.map(n=>n.lvl??0).reduce((n,a)=>n+a,0)!==r.entity.origin.level||!t(e.filter(n=>{var a;return(a=n.status.monsterCategories)==null?void 0:a.some(s=>s==="Tuner")}))||!i(e.filter(n=>{var a;return(a=n.status.monsterCategories)==null?void 0:a.every(s=>s!=="Tuner")}))||!e.every(n=>n.canBeMaterials("SyncroSummon",r,e))||!r.entity.owner.canSummon(r.entity.owner,r.entity,r,"SyncroSummon",["Attack","Defense"],e).length),ya=(r,e=i=>i.length===1,t=i=>i.length>0)=>{let i=[...r.entity.controller.getMonstersOnField().filter(n=>n.battlePosition!=="Set"),...r.entity.controller.getHandCell().entities.filter(n=>n.origin.kind==="Monster")];return i.every(n=>!n.status.allowHandSyncro)&&(i=i.filter(n=>n.fieldCell.isPlayFieldCell)),i.length<2?[]:i.getAllOnOffPattern().filter(n=>ha(r,n,e,t))},kl=(r,e=i=>i.length===1,t=i=>i.length>0)=>ya(r,e,t).length>0?[]:void 0,Cl=async(r,e,t,i=a=>a.length===1,n=a=>a.length>0)=>{const a=ya(r,i,n);let s=a[0];if(a.length>1){const f=a.flatMap(y=>y).getDistinct(),p=await r.entity.duel.view.waitSelectEntities(r.entity.controller,f,void 0,y=>ha(r,y,i,n),"シンクロ素材とするモンスターを選択",!0);if(!p)return;s=p}r.entity.field.duel.log.info(`シンクロ素材として、${s.map(f=>"《"+f.nm+"》").join("")}を墓地に送り――`,r.entity.controller),await we.sendManyToGraveyardForTheSameReason(s,["SyncroMaterial","Rule","SpecialSummonMaterial"],r.entity,r.entity.controller);const o=[...r.entity.controller.getAvailableMonsterZones(),...r.entity.controller.getAvailableExtraZones()];let u=(r.entity.atk??0)>0&&(r.entity.atk??0)>=(r.entity.def??0)?"Attack":"Defense",d=o.randomPick();if(r.entity.controller.duelistType!=="NPC"){const f=await r.entity.field.duel.view.waitSelectSummonDest(r.entity,o,["Attack","Defense"],!1);if(!f)return;d=f.dest,u=f.pos}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:d,pos:u,materials:s}}},Dl=async r=>{const e=["Rule","SpecialSummon","SyncroSummon"];return await r.action.entity.summon(r.prepared.dest,r.prepared.pos,"SyncroSummon",e,r.action.entity,r.activator),r.action.entity.info.isRebornable=!0,!0},vi=(r=t=>t.length===1,e=t=>t.length>0)=>({title:"シンクロ召喚",playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:t=>kl(t,r,e),prepare:(t,i,n,a)=>Cl(t,i,a,r,e),execute:Dl,settle:async()=>!0});class ri{constructor(){l(this,"pooledOperators",[]);l(this,"bundles",[]);l(this,"excludesExpired",()=>{this.bundles=this.bundles.filter(e=>!e.entity.hasDisappeared),this.bundles.forEach(e=>e.excludesExpired()),this.pooledOperators=this.pooledOperators.filter(e=>e.validateAlive(e.isSpawnedBy))});l(this,"append",e=>{this.bundles.push(e)});l(this,"push",e=>{if(!e.isContinuous)throw new Ae("staticへの追加は永続以外不可",e);this.excludesExpired(),this.distribute(e),this.pooledOperators.push(e)});l(this,"distributeAll",e=>(this.excludesExpired(),this.pooledOperators.flatMap(this.distribute),this.afterDistributeAll(e)));l(this,"distribute",e=>this.bundles.filter(t=>t.operators.every(i=>i.seq!==e.seq)).filter(t=>e.isApplicableTo(e.isSpawnedBy,t.entity)).map(t=>(t.push(e),t)));l(this,"removeItem",e=>{this.pooledOperators=this.pooledOperators.filter(t=>t.seq!==e)})}}class ii{constructor(e,t){l(this,"pool");l(this,"entity");l(this,"_operators");l(this,"excludesExpired",()=>{this._operators=this._operators.filter(e=>{const t=e.validateAlive(e.isSpawnedBy)&&e.isApplicableTo(e.isSpawnedBy,this.entity);return t||(console.info(`before remove ${this.entity.toString} ${e.title}`),e.beforeRemove()),t})});l(this,"push",e=>{this.entity.procFilterBundle.operators.filter(t=>t.procTypes.includes("Effect")).some(t=>!t.filter(t.effectOwner,t.isSpawnedBy,t.actionAttr,[]))||(this.beforePush(e),this._operators.push(e))});l(this,"removeItem",e=>{this._operators=this._operators.filter(t=>t.seq!==e?!0:(t.beforeRemove(),!1))});this.pool=e,this.entity=t,this._operators=[],this.pool.append(this)}get operators(){return this._operators}}const Ur=class Ur{constructor(e,t,i,n,a,s){l(this,"seq");l(this,"title");l(this,"validateAlive");l(this,"isContinuous");l(this,"isSpawnedBy");l(this,"activateType");l(this,"actionAttr");l(this,"isApplicableTo");l(this,"effectOwner");this.seq=Ur.nextSeq++,this.title=e,this.validateAlive=t,this.isContinuous=i,this.isSpawnedBy=n,this.isApplicableTo=s,this.actionAttr=a,this.activateType="NonActivate",this.actionAttr.playType&&(this.actionAttr.playType==="CardActivation"?this.activateType="CardActivation":this.activateType="EffectActivation"),this.effectOwner=this.isSpawnedBy.controller}};l(Ur,"nextSeq",0);let It=Ur;class El extends ri{constructor(){super(...arguments);l(this,"afterDistributeAll",()=>this.bundles.every(t=>t.applyEffectFilter()))}}class Al extends ii{constructor(){super(...arguments);l(this,"applyEffectFilter",()=>{const t=this.entity.allStickyEffectOperators.length,i=[];for(;;){const n=this.operators.filter(a=>a.procTypes.includes("Effect")).filter(a=>a.isContinuous).find(a=>!i.includes(a.seq));if(!n)break;i.push(n.seq),n.eraseOperators(this.entity)}return this.entity.allStickyEffectOperators.length===t});l(this,"beforePush",t=>t.eraseOperators(this.entity))}}class xl extends It{constructor(t,i,n,a,s,o,u,d){super(t,i,n,a,s,o);l(this,"isEffective");l(this,"beforeRemove",()=>{});l(this,"procTypes");l(this,"filter");l(this,"eraseOperators",t=>{if(!this.procTypes.includes("Effect"))return 0;console.log("ここはまだ通らない想定");const i=t.allStickyEffectOperators.filter(n=>n.isContinuous).filter(n=>!this.filter(n.effectOwner,n.isSpawnedBy,n.actionAttr,[])).map(n=>n.seq);return i.forEach(t.procFilterBundle.removeItem),i.forEach(t.statusOperatorBundle.removeItem),i.forEach(t.numericOprsBundle.removeItem),i.forEach(t.cardRelationBundle.removeItem),i.length});this.procTypes=u,this.filter=d,this.isEffective=!0}}const mn={level:1,rank:1,attack:0,defense:0,pendulumScaleR:0,pendulumScaleL:0};class Pl extends ri{constructor(){super(...arguments);l(this,"afterDistributeAll",t=>{if(this.bundles.forEach(n=>n.calcStateAll()),t.field.getMonstersOnField().flatMap(n=>n.numericOprsBundle).flatMap(n=>n.operators).some(n=>n.stateOperationType==="THE_DEVILS_AVATAR"||n.stateOperationType==="THE_DEVILS_DREAD-ROOT"||n.stateOperationType==="Gradius'_Option")){const a=t.field.getMonstersOnField().filter(s=>(s.atk??0)>=0).map(s=>s.atk??0).reduce((s,o)=>s>o?s:o,0);t.field.getMonstersOnField().forEach(s=>{let o;s.info.effectTargets["Gradius'_Option"]&&(o=s.info.effectTargets["Gradius'_Option"][0]),s.numericOprsBundle.operators.forEach(u=>{var d;if(!((d=s.status.monsterCategories)!=null&&d.includes("Link")&&u.targetState==="defense")){if(u.stateOperationType==="Gradius'_Option"){s.numericStatus.calculated[u.targetState]=(o==null?void 0:o.numericStatus.calculated[u.targetState])??0;return}if(u.stateOperationType==="THE_DEVILS_AVATAR"){s.numericStatus.calculated[u.targetState]=a+100;return}if(u.stateOperationType==="THE_DEVILS_DREAD-ROOT"){s.numericStatus.calculated[u.targetState]=u.calcValue(u.isSpawnedBy,s,s.numericStatus.calculated[u.targetState]??0);return}}})})}return!0})}}class Ml extends ii{constructor(){super(...arguments);l(this,"dominantOperators",{level:void 0,rank:void 0,attack:void 0,defense:void 0,pendulumScaleR:void 0,pendulumScaleL:void 0});l(this,"beforePush",t=>{if(t.stateOperationType==="THE_DEVILS_AVATAR"||t.stateOperationType==="Gradius'_Option")return;const i=this.entity.origin[t.targetState]??0,n=this.entity.numericStatus.origin[t.targetState]??0,a=this.entity.numericStatus.current[t.targetState]??0,s=this.entity.numericStatus.calculated[t.targetState]??0,o=this.dominantOperators[t.targetState];if(t.stateOperationType==="THE_DEVILS_DREAD-ROOT"){this.entity.numericStatus.calculated[t.targetState]=t.calcValue(t.isSpawnedBy,this.entity,s);return}if(t.stateOperationType==="Addition"){if(t.targetStateGen==="origin")throw new Ae("ありえない組合せ",t);t.isContinuous||(this.entity.numericStatus.current[t.targetState]=t.calcValue(t.isSpawnedBy,this.entity,a)),this.entity.numericStatus.calculated[t.targetState]=t.calcValue(t.isSpawnedBy,this.entity,a);return}if(t.targetStateGen==="origin"){const u=t.calcValue(t.isSpawnedBy,this.entity,i);o&&!o.isContinuous&&o.targetStateGen!=="current"&&(this.entity.numericStatus.current[t.targetState]=u,this.dominantOperators[t.targetState]=void 0),this.entity.numericStatus.origin[t.targetState]=u,this.dominantOperators[t.targetState]=o??t}else t.isContinuous?(this.entity.numericStatus.current[t.targetState]=t.calcValue(t.isSpawnedBy,this.entity,n),this.dominantOperators[t.targetState]=t):(this.entity.numericStatus.current[t.targetState]=t.calcValue(t.isSpawnedBy,this.entity,s),this.dominantOperators[t.targetState]=t)});l(this,"calcStateAll",()=>fa.forEach(this.calcState));l(this,"calcState",t=>{if(this.entity.status.kind!=="Monster"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories){this.entity.numericStatus.calculated[t]=void 0;return}if(this.entity.status.monsterCategories.includes("Link")&&t!=="attack"){this.entity.numericStatus.calculated[t]=void 0;return}if(this.entity.status.monsterCategories.includes("Xyz")&&t==="level"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories.includes("Xyz")&&t==="rank"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories.includes("Pendulum")&&(t==="pendulumScaleL"||t==="pendulumScaleR")){this.entity.numericStatus.calculated[t]=void 0;return}if(t!=="level"&&!this.entity.isOnField){this.entity.numericStatus.origin[t]=this.entity.origin[t],this.entity.numericStatus.current[t]=this.entity.origin[t],this.entity.numericStatus.calculated[t]=this.entity.origin[t];return}const i=this._operators.filter(d=>d.targetState===t);if(i.some(d=>d.stateOperationType==="THE_DEVILS_AVATAR"||d.stateOperationType==="Gradius'_Option")&&this.entity.isEffective){this.entity.numericStatus.calculated[t]=-Number.MAX_VALUE;return}const n=this.dominantOperators[t],a=this.entity.numericStatus.origin[t]??0;let s=this.entity.numericStatus.current[t]??0,o=-1;n&&(n.targetStateGen==="current"&&n.isContinuous?(o=i.findLastIndex(d=>d.stateOperationType==="Fixation"&&d!==n),s=n.calcValue(n.isSpawnedBy,this.entity,a)):o=i.findIndex(d=>d===n)),o++;let u=s;if(o<i.length)for(let d=o;d<i.length;d++){const f=i[d];f.isContinuous&&f.targetStateGen==="current"&&f.stateOperationType==="Addition"&&(u=f.calcValue(f.isSpawnedBy,this.entity,u))}u<mn[t]&&(u=mn[t]),this.entity.numericStatus.calculated[t]=u})}}const Vt=class Vt extends It{constructor(t,i,n,a,s,o,u,d,f,p){super(t,i,n,a,s,o);l(this,"beforeRemove",()=>{});l(this,"targetState");l(this,"targetStateGen");l(this,"stateOperationType");l(this,"calcValue");this.targetState=u,this.targetStateGen=d,this.stateOperationType=f,this.calcValue=p}};l(Vt,"createContinuous",(t,i,n,a,s,o,u,d)=>new Vt(t,i,!0,n,{},a,s,o,u,d)),l(Vt,"createLingering",(t,i,n,a,s,o,u,d,f,p)=>new Vt(t,i,!1,n,s,o,u,d,f,()=>p));let ct=Vt;const jr=class jr{constructor(e,t){l(this,"entity");l(this,"isRegular");l(this,"_isStarted");l(this,"info");l(this,"continuousEffectBase");l(this,"updateState",async()=>{if(this.hasToStart!==this.isStarted){if(this.isStarted){if(!this.info)throw new Ae("illegal state");this._isStarted=!1,await this.continuousEffectBase.finish(this.entity,this.info),this.info=void 0;return}this.info=await this.continuousEffectBase.start(this.entity),this._isStarted=!0}});this._isStarted=!1,this.entity=e,this.continuousEffectBase=t,this.isRegular=this.executableCellTypes.every(i=>_r.find(n=>n===i))&&this.faceList.length===1&&this.faceList[0]==="FaceUp"}get isStarted(){return this._isStarted}get executableCellTypes(){return this.continuousEffectBase.executableCellTypes}get faceList(){return this.continuousEffectBase.faceList}get hasToStart(){return!this.executableCellTypes.includes(this.entity.fieldCell.cellType)||!this.faceList.includes(this.entity.face)?!1:this.continuousEffectBase.canStart(this.entity)}};l(jr,"createNew",(e,t)=>new jr(e,t));let Ei=jr;const Fl=(r,e,t,i,n)=>({title:r,executableCellTypes:e==="Monster"?["MonsterZone","ExtraMonsterZone"]:["FieldSpellZone","SpellAndTrapZone"],faceList:["FaceUp"],canStart:a=>!a.info.isPending&&!a.info.isDying&&t(a),start:async a=>{const s=i(a);return s.forEach(n(a).push),s.map(o=>o.seq)},finish:async(a,s)=>{s.forEach(o=>n(a).removeItem(o))}}),ni=(r,e,t,i,n,a)=>({title:r,executableCellTypes:e==="Monster"?["MonsterZone","ExtraMonsterZone"]:["FieldSpellZone","SpellAndTrapZone"],faceList:["FaceUp"],canStart:s=>!s.info.isPending&&!s.info.isDying&&i(s),start:async s=>{const o=n(s),u=t(s);return console.info(`start : ${s.toString()} ⇒ ${u.map(d=>d.toString()).join(" ")} (${o.map(d=>d.title).join(" ")})`),u.map(a).forEach(d=>o.forEach(d.push)),{targets:u,seqList:o.map(d=>d.seq)}},finish:async(s,o)=>{o.targets.map(a).forEach(u=>o.seqList.forEach(d=>u.removeItem(d)))}}),Bl=(r,e,t,i,n)=>ni(r,e,t,i,n,a=>a.procFilterBundle),$r=(r,e,t,i)=>Fl(r,e,t,i,n=>n.field.numericStateOperatorPool),ai=(r,e,t,i,n)=>ni(r,e,t,i,n,a=>a.numericOprsBundle),Ai=(r,e,t,i)=>ni(r,e,n=>n.info.effectTargets[r],t,i,n=>n.cardRelationBundle),ql=(r,e,t,i,n)=>ni(r,e,t,i,n,a=>a.statusOperatorBundle);class Ol extends ri{constructor(){super(...arguments);l(this,"afterDistributeAll",()=>!0)}}class Nl extends ii{constructor(){super(...arguments);l(this,"beforePush",()=>{})}}const Zr=class Zr extends It{constructor(t,i,n,a,s,o,u,d,f){super(t,i,n,a,s,o);l(this,"relationType");l(this,"target");l(this,"beforeRemove");this.relationType=u,this.target=d,this.beforeRemove=()=>f(this)}};l(Zr,"createRegularEquipRelation",(t,i,n,a,s,o=()=>!0)=>new Zr(t,i,!0,n,a,(u,d)=>d.isOnField&&d.face==="FaceUp"&&s(u,d),"Equip",n.info.effectTargets[t][0],u=>{o(u)&&(u.isSpawnedBy.isOnField&&!u.isSpawnedBy.info.isDying&&(u.isSpawnedBy.info.isDying=!0,u.isSpawnedBy.info.causeOfDeath=["RuleDestroy"],u.isSpawnedBy.duel.log.info(`装備対象${u.target.toString()}不在により${u.isSpawnedBy.toString()}は破壊された。`,u.effectOwner)),u.isSpawnedBy.info.effectTargets[t]=[])}));let cr=Zr;class Rl{constructor(e){l(this,"entity");l(this,"_records");l(this,"pushForRuleAction",e=>{this._records.push({cell:this.entity.fieldCell,face:this.entity.face,orientation:this.entity.orientation,movedAt:this.entity.duel.clock.getClone(),movedAs:[...e,"Rule"]})});l(this,"push",(e,t,i,n)=>{this._records.push({cell:this.entity.fieldCell,face:this.entity.face,orientation:this.entity.orientation,movedAt:this.entity.duel.clock.getClone(),movedAs:e.getDistinct(),movedBy:t,actionOwner:i,chooser:n??i})});l(this,"pushByChainBlockInfo",(e,t)=>{this.push(t,e.action.entity,e.activator)});this.entity=e,this._records=[]}get records(){return this._records}get latestRecord(){return this._records.slice(-1)[0]}get previousPlaceRecord(){return this._records.findLast(e=>e.cell.cellType!==this.entity.fieldCell.cellType)??this._records[0]}get currentProcRecords(){return this._records.filter(e=>e.movedAt.totalProcSeq===this.entity.duel.clock.totalProcSeq)}}const xi=["SpellCounter","KaijuCounter","NamelessCounter"],Pi=["①","②","③","④"],ga=["CycleFlip"],Ll=[...xi,...Pi,...ga],Hl={SpellCounter:"🔮",KaijuCounter:"☢",NamelessCounter:"💠"};class $l{constructor(){l(this,"dic");l(this,"add",(e,t=1)=>{this.dic[e]=(this.dic[e]??0)+t});l(this,"setQty",(e,t=1)=>{this.dic[e]=t});l(this,"remove",(e,t=1)=>{this.dic[e]=(this.dic[e]??0)-t});l(this,"getQty",e=>this.dic[e]??0);l(this,"corpseDisposal",()=>{Pi.forEach(e=>delete this.dic[e]),ga.forEach(e=>delete this.dic[e])});l(this,"removeAllActualCounters",()=>{xi.forEach(e=>delete this.dic[e])});l(this,"removeAllWhenfaceDown",()=>{Pi.forEach(e=>delete this.dic[e]),xi.forEach(e=>delete this.dic[e])});l(this,"clear",()=>{Ll.forEach(e=>delete this.dic[e])});this.dic={}}}class Ul extends ri{constructor(){super(...arguments);l(this,"afterDistributeAll",t=>t.field.getAllEntities().map(i=>i.statusOperatorBundle).every(i=>i.calcStatus()))}}class jl extends ii{constructor(){super(...arguments);l(this,"calcStatus",()=>{const t=this.entity.isEffective,i={...this.entity.status},n=this._operators.reduce((a,s)=>s.statusCalculator(s,a),i);return this.entity.status=n,this.entity.isEffective===t});l(this,"beforePush",()=>{})}}class Zl extends It{constructor(t,i,n,a,s,o,u){super(t,i,n,a,s,o);l(this,"beforeRemove",()=>{});l(this,"statusCalculator");this.statusCalculator=u}}const Gl={FusionSummon:"融合召喚",SyncroSummon:"シンクロ召喚",XyzSummon:"エクシーズ召喚",PendulumSummon:"ペンデュラム召喚",LinkSummon:"リンク召喚"},Vl={BattleDestroy:"戦闘破壊",EffectDestroy:"効果破壊",RuleDestroy:"ルール破壊"},ma=r=>r+"Summon",Wl=["Card","Token","Avatar"],xr=(r,e)=>{const t=r.monsterCategories??[],i=e.monsterCategories??[];for(const n of Xt.toReversed()){if(t.includes(n)&&!i.includes(n))return 1;if(!t.includes(n)&&i.includes(n))return-1}if(r.kind===e.kind){if(r.kind==="Monster"){if((r.link??0)!==(e.link??0))return(r.link??0)-(e.link??0);if((r.rank??0)!==(e.rank??0))return(r.rank??0)-(e.rank??0);if((r.level??0)!==(e.level??0))return(r.level??0)-(e.level??0);if((r.attack??0)!==(e.attack??0))return(r.attack??0)-(e.attack??0);if((r.defense??0)!==(e.defense??0))return(r.defense??0)-(e.defense??0)}return r.name.localeCompare(e.name,"Ja")}for(const n of Ci){if(r.kind===n)return-1;if(e.kind===n)return 1}return r.name.localeCompare(e.name,"Ja")},_a=(r,e)=>xr(r.origin,e.origin),ce=class ce{constructor(e,t,i,n,a,s){l(this,"seq");l(this,"origin");l(this,"entityType");l(this,"procFilterBundle");l(this,"numericOprsBundle");l(this,"cardRelationBundle");l(this,"statusOperatorBundle");l(this,"moveLog");l(this,"counterHolder");l(this,"face");l(this,"orientation");l(this,"owner");l(this,"fieldCell");l(this,"_status");l(this,"_numericStatus");l(this,"_info");l(this,"actions",[]);l(this,"continuousEffects",[]);l(this,"_hasDisappeared",!1);l(this,"toString",()=>`《${this.nm}》`);l(this,"setBattlePosition",async(e,t,i,n)=>{let a=`表示形式の変更：${this.toString()}（${this.battlePositionName}⇒${Dr[e]}）`;const s=[...t];this.battlePosition==="Set"&&(s.push("Flip"),t.includes("Rule")&&(a=`${this.toString()}を反転召喚`,s.push("FlipSummon"))),this.moveAlone(this.fieldCell,e==="Set"?"FaceDown":"FaceUp",e==="Attack"?"Vertical":"Horizontal","Top",s,i,n,n),this.duel.log.info(a,n)});l(this,"setNonFieldMonsterPosition",async(e,t,i,n)=>{this.moveAlone(this.fieldCell,e==="FaceUp"?"FaceUp":"FaceDown",e==="XysMaterial"?"Horizontal":"Vertical","Top",t,i,n,n)});l(this,"setAsSpellTrap",async(e,t,i,n)=>{await this.moveAlone(e,"FaceDown","Vertical","Top",[...t,"SpellTrapSet"],i,n,n)});l(this,"activateSpellTrapFromHand",async(e,t,i,n)=>{await this.moveAlone(e,"FaceUp","Vertical","Top",[...t,"SpellTrapActivate"],i,n,n)});l(this,"activateSpellTrapOnField",async(e,t,i)=>{await this.moveAlone(this.fieldCell,"FaceUp","Vertical","Top",[...e,"SpellTrapActivate"],t,i,i)});l(this,"draw",async(e,t,i)=>await this.addToHand([...e,"Draw"],t,i));l(this,"addToHand",async(e,t,i)=>await this.moveAlone(this.owner.getHandCell(),"FaceDown","Vertical","Bottom",[...e],t,i,i));l(this,"release",async(e,t,i)=>(await this.sendToGraveyard([...e,"Release"],t,i),this.info.isVanished?void 0:this.fieldCell));l(this,"sendToGraveyard",(e,t,i)=>ce.sendManyToGraveyardForTheSameReason([this],e,t,i));l(this,"returnToDeck",(e,t,i,n)=>ce.returnManyToDeckForTheSameReason(e,[this],t,i,n));l(this,"banish",(e,t,i)=>ce.banishManyForTheSameReason([this],e,t,i));l(this,"summon",(e,t,i,n,a,s,o)=>ce.summonMany([{entity:this,to:e,chooser:o??s,pos:t}],i,n,a,s));l(this,"moveAlone",async(e,t,i,n,a,s,o,u)=>(await ce.moveMany([[this,e,t,i,n,a,s,o,u]],void 0),this.fieldCell));l(this,"_move",async(e,t,i,n,a,s,o,u)=>{if(!e)throw new Error("illegal argument: to");if(this.face=t,this.orientation=i,e!==this.fieldCell){if(this.field.duel.clock.turn>0&&await this.field.duel.view.waitAnimation({entity:this,to:e,index:n,count:0}),this.fieldCell.releaseEntities([this]),this.fieldCell.isPlayFieldCell&&!e.isPlayFieldCell&&(this.counterHolder.clear(),this.resetCauseOfDeath(),this.entityType==="Token")){this._hasDisappeared=!0,this.field.duel.log.info(`${this.nm}は消滅した。`,this.controller);return}e.acceptEntities([this],n),(e===this.isBelongTo||e.cellType==="Hand"||e.cellType==="Banished"&&this.face==="FaceDown")&&(this.counterHolder.clear(),this.resetInfo(),this.resetStatusAll())}return console.log(this.toString(),this),this.isOnField&&this.face==="FaceDown"&&(console.log(this.toString(),this),this.counterHolder.removeAllWhenfaceDown(),this.info.materials=[],this._status.isEffective=!0,this.info.isEffective=!0,this.info.willBeBanished=!1,this.info.willReturnToDeck=void 0,this.resetNumericStatus(),this.info.isSettingSickness=this.status.kind==="Trap"||this.status.spellCategory==="QuickPlay"),this.moveLog.push(a,s,o,u),e});l(this,"initForTurn",()=>{this.info.isSettingSickness=!1,this.info.attackCount=0,this.info.battlePotisionChangeCount=0,this.counterHolder.corpseDisposal()});l(this,"resetInfo",()=>{var e;this._info={isDying:!1,isPending:!1,isEffective:!0,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,isVanished:!1,isRebornable:((e=this.origin.monsterCategories)==null?void 0:e.union(ua).length)===0||(this.origin.canReborn??!1),isSettingSickness:!1,materials:[],effectTargets:{},willBeBanished:!1,willReturnToDeck:void 0,attackCount:0,battlePotisionChangeCount:0},this.counterHolder.clear()});l(this,"resetNumericStatus",()=>{const e=fa.reduce((t,i)=>(t[i]=this.origin[i],t),{});this._numericStatus={origin:{...e},current:{...e},calculated:{...e}}});l(this,"resetStatus",()=>{this._status={...this.origin,canAttack:!0,isEffective:!0,canDirectAttack:!1,isSelectableForAttack:!0,allowHandSyncro:!1,maxCounterQty:{}}});l(this,"resetStatusAll",()=>{this.resetNumericStatus(),this.resetStatus()});l(this,"resetCauseOfDeath",()=>{this.info.isDying=!1,this.info.causeOfDeath=[],this.info.isKilledBy=void 0,this.info.isKilledByWhom=void 0});this.seq=ce.nextEntitySeq++,this.counterHolder=new $l,this.owner=e,this.fieldCell=t,this.entityType=i,this.origin=n,this._status=JSON.parse(JSON.stringify(n)),this._numericStatus=JSON.parse(JSON.stringify(n)),this.resetStatusAll(),this._info={isEffective:!0,attackCount:0,battlePotisionChangeCount:0,isDying:!1,isPending:!1,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,isVanished:!1,isRebornable:!0,isSettingSickness:!1,materials:[],effectTargets:{},willBeBanished:!1,willReturnToDeck:void 0},this.resetInfo(),this.face=a,this.orientation=s,this.procFilterBundle=new Al(t.field.procFilterPool,this),this.numericOprsBundle=new Ml(t.field.numericStateOperatorPool,this),this.cardRelationBundle=new Nl(t.field.cardRelationPool,this),this.statusOperatorBundle=new jl(t.field.statusOperatorPool,this),t.acceptEntities([this],"Top"),this.moveLog=new Rl(this),this.moveLog.pushForRuleAction(["Spawn"])}get isUnderControl(){return this.face==="FaceUp"||va.every(e=>e!==this.fieldCell.cellType)}get controller(){return this.fieldCell.owner??this.owner}get field(){return this.owner.duel.field}get duel(){return this.owner.duel.field.duel}get status(){return this._status}set status(e){this._status={...e}}get numericStatus(){return this._numericStatus}get info(){return this._info}get nm(){return this.status.name}get atk(){return this._numericStatus.calculated.attack}get def(){return this._numericStatus.calculated.defense}get lvl(){return this._numericStatus.calculated.level}get rank(){return this._numericStatus.calculated.rank}get attr(){return this.status.attributes??[]}get types(){return this.status.types??[]}get psL(){return this._numericStatus.calculated.pendulumScaleL}get psR(){return this._numericStatus.calculated.pendulumScaleR}get isEffective(){return this.status.isEffective&&this.info.isEffective}get isNagatedStrongly(){return!this.info.isEffective}get battlePosition(){if(this.isOnField&&this.status.kind==="Monster")return this.orientation==="Vertical"?"Attack":this.face==="FaceUp"?"Defense":"Set"}get battlePositionName(){const e=this.battlePosition;if(e)return Dr[e]}get wasMovedAtCurrentProc(){return this.field.duel.clock.totalProcSeq===this.moveLog.latestRecord.movedAt.totalProcSeq}get wasMovedAtPreviousProc(){return this.field.duel.clock.totalProcSeq===this.moveLog.latestRecord.movedAt.totalProcSeq+1}get wasMovedAtCurrentChain(){return this.field.duel.clock.isSameChain(this.moveLog.latestRecord.movedAt)}get wasMovedAtPreviousChain(){return this.field.duel.clock.isPreviousChain(this.moveLog.latestRecord.movedAt)}get wasMovedFrom(){return this.moveLog.previousPlaceRecord.cell}get isOnField(){return _r.some(e=>e===this.fieldCell.cellType)}get isLikeContinuousSpell(){return this.status.spellCategory==="Continuous"||this.status.spellCategory==="Field"||this.status.spellCategory==="Equip"||this.status.trapCategory==="Continuous"||(this.status.monsterCategories??[]).includes("Pendulum")}get isBelongTo(){return this.origin.monsterCategories&&this.origin.monsterCategories.union(Xt).length?this.owner.getExtraDeck():this.owner.getDeckCell()}get hasDisappeared(){return this._hasDisappeared}get allStickyEffectOperators(){return[...this.procFilterBundle.operators,...this.numericOprsBundle.operators,...this.cardRelationBundle.operators]}};l(ce,"nextEntitySeq",0),l(ce,"splitBattlePos",e=>({face:e==="Set"?"FaceDown":"FaceUp",orientation:e==="Attack"?"Vertical":"Horizontal"})),l(ce,"recreateArray",(e,t)=>{if(!t.length)return[];const i=e.getAllCells().flatMap(n=>n.entities);return t.map(n=>n.seq).map(n=>i.find(a=>a.seq===n)).filter(n=>n!==void 0)}),l(ce,"createPlayerEntity",e=>{const t=e.getHandCell();return new ce(e,t,"Duelist",{name:e.profile.name,kind:"Monster",wikiEncodedName:"%A5%D7%A5%EC%A5%A4%A5%E4%A1%BC"},"FaceUp","Vertical")}),l(ce,"createCardEntity",(e,t)=>{var u;const i=t.monsterCategories&&t.monsterCategories.union(Xt).length?e.getExtraDeck():e.getDeckCell(),n=new ce(e,i,"Card",fl(t),"FaceDown","Vertical");Object.hasOwn(Ze,n.origin.name)||e.duel.log.info(`未実装カード${t.name}がデッキに投入された。`,e);const a=Ze[n.origin.name];let s=[],o=[];if(a.kind==="Monster"&&((u=a.monsterCategories)!=null&&u.includes("Normal")))s=[$e,qe,Oe];else{const d=Fi.get(n.origin.name);d&&(s=d.actions,o=d.continuousEffects??[])}return n.actions.push(...s.map(d=>Ct.createNew(n,d))),n.continuousEffects.push(...o.map(d=>Ei.createNew(n,d))),n}),l(ce,"waitCorpseDisposal",e=>ce.sendManyToGraveyard(e.field.getEntiteisOnField().filter(t=>t.info.isDying).map(t=>({entity:t,causedAs:t.info.causeOfDeath??[],causedBy:t.info.isKilledBy,activator:t.info.isKilledByWhom})))),l(ce,"sendManyToGraveyardForTheSameReason",(e,t,i,n)=>ce.bringManyToSameCellForTheSameReason("Graveyard","Top",e,"FaceUp","Vertical",t,i,n)),l(ce,"banishManyForTheSameReason",(e,t,i,n)=>ce.bringManyToSameCellForTheSameReason("Banished","Top",e,"FaceDown","Vertical",t,i,n)),l(ce,"returnManyToDeckForTheSameReason",(e,t,i,n,a)=>ce.bringManyToSameCellForTheSameReason("Deck",e,t,"FaceDown","Vertical",i,n,a)),l(ce,"returnManyToHandForTheSameReason",(e,t,i,n)=>ce.bringManyToSameCellForTheSameReason("Hand","Bottom",e,"FaceDown","Vertical",t,i,n)),l(ce,"sendManyToGraveyard",(e,t)=>ce.bringManyToSameCell("Graveyard","Top",e.map(i=>({...i,face:"FaceUp",orientation:"Vertical"})),t)),l(ce,"banishMany",(e,t)=>ce.bringManyToSameCell("Banished","Top",e.map(i=>({...i,face:"FaceUp",orientation:"Vertical"})),t)),l(ce,"bringManyToSameCellForTheSameReason",(e,t,i,n,a,s,o,u)=>ce.bringManyToSameCell(e,t,i.map(d=>({entity:d,face:n,orientation:a,causedAs:s,causedBy:o,activator:u})))),l(ce,"bringManyToSameCell",(e,t,i,n)=>ce.moveMany(i.map(a=>[a.entity,a.entity.field.getCells(e).filter(s=>s.owner===a.entity.owner)[0],a.face,a.orientation,t,a.causedAs,a.causedBy,a.activator,a.activator]),n)),l(ce,"moveMany",async(e,t)=>{if(!e.length)return;const i=e[0][0].duel,a=[...e.map(([o])=>o).filter(o=>!(t??[]).includes(o)),...i.field.getEntiteisOnField().filter(o=>o.info.isDying)],s=new Map;for(e.forEach(([o,u,d,f,p,...y])=>{let c=u,h=d,m=p,S=f;o.info.willBeBanished&&(c=o.owner.getBanished(),h="FaceUp",S="Vertical"),o.info.willReturnToDeck&&(c=o.isBelongTo,h="FaceDown",m=o.info.willReturnToDeck,S="Vertical"),o.isBelongTo.cellType==="ExtraDeck"&&(c.cellType==="Hand"||c.cellType==="Deck")&&(c=o.isBelongTo,h="FaceDown",S="Vertical"),s.set(c,[[o,c,h,S,m,...y],...s.get(c)??[]])});;){const o=Array.from(s.values()).map(d=>d.pop()).filter(d=>d!==void 0).map(([d,...f])=>d._move(...f));if(!o.length)break;await Promise.all(o),i.field.cardRelationPool.excludesExpired();const u=i.field.getEntiteisOnField().filter(d=>d.info.isDying).filter(d=>!a.includes(d)).map(d=>({entity:d,causedAs:d.info.causeOfDeath??[],causedBy:d.info.isKilledBy,activator:d.info.isKilledByWhom}));u.length&&await ce.sendManyToGraveyard(u,a)}ce.settleEntityMove(i)}),l(ce,"summonMany",async(e,t,i,n,a)=>{if(!e.length)return;const s={Attack:"AttackSummon",Defense:"DefenseSummon",Set:"SetSummon"};await Promise.all(e.map(async({entity:o,to:u,pos:d,chooser:f})=>{if(t==="NormalSummon"||t==="AdvanceSummon"){const c=t==="AdvanceSummon"?"アドバンス":"";d==="Attack"?o.field.duel.log.info(`${o.toString()}を${c}召喚`,f):o.duel.log.info(`${o.toString()}を${c}セット`,f),i.includes("Rule")?f.info.ruleNormalSummonCountQty++:f.info.effectNormalSummonCountQty++}else t==="SpecialSummon"?o.duel.log.info(`${o.toString()}を${Dr[d]}で特殊召喚`,f):o.duel.log.info(`${o.toString()}を${Dr[d]}で${Gl[t]}！`,f),f.info.specialSummonCountQty++;o.info.battlePotisionChangeCount=1;const{face:p,orientation:y}=ce.splitBattlePos(d);await o._move(u,p,y,"Top",[t,s[d],...i],n,a,f)})),e.map(o=>o.chooser).forEach(o=>{t==="NormalSummon"||t==="AdvanceSummon"?i.includes("Rule")?o.info.ruleNormalSummonCount++:o.info.effectNormalSummonCount++:o.info.specialSummonCount++}),ce.settleEntityMove(e[0].entity.duel)}),l(ce,"settleEntityMove",e=>{e.distributeOperators(e.clock.totalProcSeq);const t=e.field.getAllEntities().filter(i=>i.wasMovedAtCurrentProc);t.filter(i=>!i.isOnField).forEach(i=>i.resetInfo()),t.flatMap(i=>i.continuousEffects).forEach(i=>i.updateState()),e.field.getAllCells().filter(i=>i.needsShuffle).map(i=>i.shuffle())});let we=ce;class _n{constructor(e,t,i,n,a){l(this,"duel");l(this,"seat");l(this,"_entity");l(this,"profile");l(this,"deckInfo");l(this,"info");l(this,"infoOrigin");l(this,"status");l(this,"statusOrigin");l(this,"duelistType");l(this,"lifeLog");l(this,"_lp");l(this,"initForDrawPhase",()=>{this.info={...this.infoOrigin}});l(this,"canSummon",(e,t,i,n,a,s)=>this.entity.procFilterBundle.operators.filter(o=>o.procTypes.some(u=>u===n)).every(o=>o.filter(e,t,i,s))?a.filter(o=>this.entity.procFilterBundle.operators.filter(u=>u.procTypes.some(d=>d===ma(o))).every(u=>u.filter(e,t,i,s))):[]);l(this,"battleDamage",(e,t)=>this.setLp(this._lp-e,t,"BattleDamage"));l(this,"effectDamage",(e,t)=>this.setLp(this._lp-e,t,"EffectDamage"));l(this,"lostLp",(e,t)=>this.setLp(this._lp-e,t,"Lost"));l(this,"payLp",(e,t)=>this.setLp(this._lp-e,t,"Pay"));l(this,"heal",(e,t)=>this.setLp(this._lp+e,t,"Heal"));l(this,"setLp",(e,t,i)=>{const n={clock:this.duel.clock,reason:i||"Set",beforeLp:this._lp,afterLp:e,entity:t};return this.lifeLog.push(n),this._lp=e,this.duel.log.info(`ライフポイント変動：${n.afterLp-n.beforeLp}（${n.beforeLp} ⇒ ${n.afterLp}）`,this),n});l(this,"getOpponentPlayer",()=>this.duel.firstPlayer===this?this.duel.secondPlayer:this.duel.firstPlayer);l(this,"getHandCell",()=>this.duel.field.getCells("Hand").filter(e=>e.owner===this)[0]);l(this,"getDeckCell",()=>this.duel.field.getCells("Deck").filter(e=>e.owner===this)[0]);l(this,"getExtraDeck",()=>this.duel.field.getCells("ExtraDeck").filter(e=>e.owner===this)[0]);l(this,"getGraveyard",()=>this.duel.field.getCells("Graveyard").filter(e=>e.owner===this)[0]);l(this,"getFieldZone",()=>this.duel.field.getCells("FieldSpellZone").filter(e=>e.owner===this)[0]);l(this,"getBanished",()=>this.duel.field.getCells("Banished").filter(e=>e.owner===this)[0]);l(this,"getMonsterZones",()=>this.duel.field.getCells("MonsterZone").filter(e=>e.owner===this));l(this,"getExtraMonsterZones",()=>this.duel.field.getCells("ExtraMonsterZone").filter(e=>{var t;return((t=e.cardEntities[0])==null?void 0:t.controller)===this}));l(this,"getSpellTrapZones",()=>this.duel.field.getCells("SpellAndTrapZone").filter(e=>e.owner===this));l(this,"getEmptyMonsterZones",()=>this.getMonsterZones().filter(e=>e.cardEntities.length===0));l(this,"getEmptyExtraZones",()=>this.getExtraMonsterZones().length===0?this.getMonsterZones().filter(e=>e.cardEntities.length===0):[]);l(this,"getAvailableMonsterZones",()=>this.getMonsterZones().filter(e=>e.isAvailable));l(this,"getAvailableExtraZones",()=>this.getExtraMonsterZones().length===0?this.duel.field.getCells("ExtraMonsterZone").filter(e=>e.isAvailable):[]);l(this,"getAvailableSpellTrapZones",()=>this.getSpellTrapZones().filter(e=>e.isAvailable));l(this,"getReleasableMonsters",()=>this.getMonstersOnField());l(this,"getMonstersOnField",()=>this.duel.field.getMonstersOnField().filter(e=>e.controller===this));l(this,"getEntiteisOnField",()=>this.duel.field.getEntiteisOnField().filter(e=>e.controller===this));l(this,"getAttackTargetMonsters",()=>this.duel.field.getMonstersOnField().filter(e=>e.status.isSelectableForAttack&&e.controller!==this));l(this,"pushDeck",()=>{this.deckInfo.cardNames.map(e=>Ze[e]).filter(e=>e).forEach(e=>we.createCardEntity(this,e)),this.duel.log.info(`デッキをセット。メイン${this.getDeckCell().cardEntities.length}枚。エクストラ${this.getExtraDeck().cardEntities.length}枚。`,this)});l(this,"draw",async(e,t,i)=>{var s;if(e<1)return;const n=this.getDeckCell(),a=[];for(const o of Array(e)){if(!n.cardEntities.length)throw this.duel.log.info(a.length>0?`デッキからカードを${e}枚ドローしようとしたが、${a.length}枚しかドローできなかった。${a}`:"デッキからカードをドローできなかった。",this),this.duel.isEnded=!0,this.setLp(0),new Ft(this.getOpponentPlayer());const u=n.cardEntities[0];await u.draw(t?["Effect"]:["Rule"],t,i),a.push(((s=u.origin)==null?void 0:s.name)||"!名称取得失敗!")}this.duel.log.info(`デッキからカードを${a.length}枚ドロー。${a}。`,this)});l(this,"shuffleDeck",()=>{this.getDeckCell().shuffle(),this.duel.log.info("デッキをシャッフル。",this)});l(this,"discard",async(e,t,i,n,a,s)=>{const o=a||(()=>!0),u=this.getHandCell().cardEntities.filter(o);if(u.length<e)return[];let d=[];return(n||this).duelistType==="NPC"?d=u.randomPickMany(e):d=await this.duel.view.waitSelectEntities(n||this,u,e,f=>f.length===e,`${e}枚カードを捨てる。`,!1)||[],await we.sendManyToGraveyardForTheSameReason(d,["Discard",...t],i,s),this.duel.log.info(`手札からカードを${d.length}枚捨てた。${d.map(f=>{var p;return(p=f.origin)==null?void 0:p.name})}。`,this),d});l(this,"summon",async(e,t,i,n,a,s,o=!1)=>{let u=t.randomPick(),d=i.randomPick();if((i.length>1||t.length>1)&&this.duelistType!=="NPC"){const f=i.length>1?"カードを召喚先へドラッグ。":"表示形式を選択。",p=t.map(m=>Ct.createDammyAction(e,m,i,m)),y=this.duel.view.modalController.selectAction(this.duel.view,{title:f,actions:p,cancelable:!1}),c=this.duel.view.waitSubAction(this,p,f,o).then(m=>m.action),h=await Promise.any([y,c]);if(!h&&!o)throw new Ae("",h);if(!h)return;d=h.cell||d,u=h.pos||u}return await e.summon(d,u,n,a,s,this),e});l(this,"selectActionForNPC",e=>{let t=e.filter(i=>i.entity.status.kind==="Spell").randomPick();if(t||this.duel.phase==="main2"&&this.getAvailableSpellTrapZones.length>1&&(t=e.filter(i=>i.playType==="SpellTrapSet").filter(i=>i.entity.status.kind!=="Spell"||i.entity.status.spellCategory==="QuickPlay").randomPick(),t))return t});this.duel=e,this.seat=t,this.profile=i,this.duelistType=n,this.deckInfo=a,this.lifeLog=[],this.infoOrigin={maxRuleNormalSummonCount:1,ruleNormalSummonCount:0,ruleNormalSummonCountQty:0,effectNormalSummonCount:0,effectNormalSummonCountQty:0,specialSummonCount:0,specialSummonCountQty:0},this.info={...this.infoOrigin},this.statusOrigin={maxSpecialSummonCount:Number.MAX_VALUE,canDrawByEffect:!0,canSearchFromDeck:!0,canDiscardAsCost:!0,canDiscardAsEffect:!0},this.status={...this.statusOrigin},this._lp=8e3}get entity(){const e=this.getHandCell().entities.find(t=>t.entityType==="Duelist");return e||we.createPlayerEntity(this)}get lp(){return this._lp}get isTurnPlayer(){return this.duel.getTurnPlayer()===this}get canDraw(){return!0}get canAddToHandFromDeck(){return!0}}class Yl{constructor(e){l(this,"cells");l(this,"duel");l(this,"procFilterPool");l(this,"numericStateOperatorPool");l(this,"cardRelationPool");l(this,"statusOperatorPool");l(this,"getAllCells",()=>this.cells.flat());l(this,"getCells",(...e)=>this.getAllCells().filter(t=>e.includes(t.cellType)));l(this,"getAllEntities",()=>this.getAllCells().map(e=>e.entities).flat());l(this,"getAllCardEntities",()=>this.getAllCells().map(e=>e.cardEntities).flat());l(this,"getMonstersOnField",()=>this.getCells(...Hr).map(e=>e.cardEntities).filter(e=>e.length>0).map(e=>e[0]));l(this,"getEntiteisOnField",()=>this.getCells(..._r).map(e=>e.cardEntities).filter(e=>e.length>0).map(e=>e[0]));l(this,"getEntities",e=>this.getAllEntities().filter(t=>t.controller===e));l(this,"drawAtSameTime",async(e,t,i,n,a,s)=>{const o=[],u=[],d=[e.draw(t,a,s),i.draw(n,a,s)].map(f=>f.catch(p=>{p instanceof Ft?p.winner&&o.push(p.winner):u.push(p)}));if(await Promise.all(d),u.length)throw new Ae("ドロー処理で想定されない例外が発生した。",e,t,i,n,a,...u);if(o.length!==0)throw o.length===1?new Ft(o[0]):new Ft});l(this,"sendToGraveyard",async(e,t,i,n,a,s,o,u)=>{if(n>0&&i.length<n)return;const d=await this.duel.view.waitSelectEntities(t,i,n,a,e,u);if(d)return await we.sendManyToGraveyard(d.map(f=>({entity:f,causedAs:s,causedBy:o,activator:t}))),this.duel.log.info(`${d.map(f=>f.status.name).join(", ")}を墓地に送った（${s.getDistinct().join(", ")}）。`,t),d});l(this,"release",async(e,t,i,n,a,s,o,u)=>{if(i>0&&t.length<i)return;const d=await this.duel.view.waitSelectEntities(e,t,i,p=>(o||p.length>0)&&(i<0||p.length===i),"リリースするモンスターを選択",u);if(!d)return;const f=[];for(const p of d)await p.release(["Release",n,...a],s,e),f.push(p);return this.duel.log.info(`${f.map(p=>p.status.name).join(", ")}をリリース（${f.flatMap(p=>p.moveLog.latestRecord.movedAs).getDistinct().join(", ")}）。`,e),f});l(this,"activateSpellTrapFromHand",async(e,t,i,n,a,s=!1)=>{const o=a??(n==null?void 0:n.controller)??e.controller;let u=t.randomPick();if(t.length>1&&o.duelistType!=="NPC"){const d=[Ct.createDammyAction(e,"カードの発動",t,void 0)];this.duel.view.modalController.selectAction(this.duel.view,{title:"カードを魔法罠ゾーンへドラッグ",actions:d,cancelable:!1});const f=await this.duel.view.waitSubAction(o,d,"カードを魔法罠ゾーンへドラッグ。",s),p=f.action;if(!p&&!s)throw new Ae("",f);if(!p)return;u=p.cell||u}return await e.activateSpellTrapFromHand(u,i,n,o),e});l(this,"setSpellTrap",async(e,t,i,n,a=!1)=>{let s=t[0];const o=n??(i==null?void 0:i.controller)??e.controller;if(t.length>1&&o.duelistType!=="NPC"){const u=[Ct.createDammyAction(e,"セット",t)],d=this.duel.view.modalController.selectAction(this.duel.view,{title:"カードをセット先へドラッグ",actions:u,cancelable:a}),f=this.duel.view.waitSubAction(o,u,"カードをセット先へドラッグ",a),p=await Promise.any([d,f.then(y=>y.action)]);if(!p&&!a)throw new Ae("",p);if(!p)return;s=p.cell||s}return await e.setAsSpellTrap(s,["SpellTrapSet"],i,o),this.duel.log.info(`${e.status.name}をセット（SpellTrapSet）。`,n??(i==null?void 0:i.controller)??e.controller),s});this.duel=e,this.cells=[...Array(7)].map(()=>[]);for(const t of Object.keys(Di).map(Number))for(const i of Object.keys(Di[t]).map(Number))this.cells[t][i]=new pl(this,t,i,t<3?e.duelists.Above:t>3?e.duelists.Below:i===0?e.duelists.Above:i===6?e.duelists.Below:void 0);this.procFilterPool=new El,this.numericStateOperatorPool=new Pl,this.cardRelationPool=new Ol,this.statusOperatorPool=new Ul}}let zl=class{constructor(e){l(this,"onUpdateEvent",new We);l(this,"nextSeq");l(this,"records",[]);l(this,"duel");l(this,"dispose",()=>{this.onUpdateEvent.clear()});l(this,"error",e=>{console.error(e);const t=["エラー発生"];e instanceof Error?(e instanceof Ae&&(t.push("-- エラーメッセージ --"),t.push(e.message),t.push("-- 関連オブジェクト --"),e.items.forEach(i=>t.push(JSON.stringify(i)))),t.push("-- エラー名称 --"),t.push(e.name||"エラー名称取得失敗"),t.push("-- スタックトレース --"),t.push(e.stack||"スタックトレース取得失敗")):(t.push("-- エラー型特定失敗 --"),t.push(JSON.stringify(e))),this.info(t)});l(this,"info",(e,t)=>{const i=Array.isArray(e)?e.join(`
`):e;this.records.push({seq:this.nextSeq++,turn:this.duel.clock.turn,periodKey:this.duel.clock.period.key,clock:this.duel.clock,duelist:t,text:i}),this.onUpdateEvent.trigger()});this.nextSeq=0,this.duel=e}get onUpdate(){return this.onUpdateEvent.expose()}get lastRecord(){return this.records.slice(-1)[0]}};const Sn=["DuelEntitiesSelector","DuelActionSelector","DuelTextSelector"];class Kl{constructor(e){l(this,"onUpdateEvent",new We);l(this,"states");l(this,"view");l(this,"cancelAll",()=>{Sn.forEach(e=>this.states[e]="Disable"),console.info(this,"cancelAll"),this.onUpdateEvent.trigger()});l(this,"duelEntitiesSelectorArg",{title:"対象を選択",entities:[],validator:()=>!0,qty:-1,cancelable:!1});l(this,"duelEntitiesSelectorValue");l(this,"duelEntitiesSelectorResolve",()=>{});l(this,"selectDuelEntities",async e=>(this.duelEntitiesSelectorArg=e,this.states.DuelEntitiesSelector="Shown",this.onUpdateEvent.trigger(),new Promise(t=>{this.duelEntitiesSelectorResolve=i=>{this.states.DuelEntitiesSelector="Disable",this.onUpdateEvent.trigger(),t(i)}})));l(this,"cardActionSelectorArg",{title:"カード操作を選択。",actions:[],cancelable:!1});l(this,"cardActionSelectorResolve",()=>{});l(this,"cardActionSelectorValue");l(this,"selectAction",async(e,t)=>(this.cardActionSelectorArg=t,this.states.DuelActionSelector="Shown",e.onWaitEnd.append(this.cancelAll),this.onUpdateEvent.trigger(),new Promise(i=>{this.cardActionSelectorResolve=n=>{this.states.DuelActionSelector="Disable",e.onWaitEnd.remove(this.cancelAll),this.onUpdateEvent.trigger(),i(n)}})));l(this,"duelTextSelectorArg",{title:"カード操作を選択。",choises:[],cancelable:!1});l(this,"duelTextSelectorResolve",()=>{});l(this,"duelTextSelectorValue");l(this,"selectText",async(e,t)=>(this.duelTextSelectorArg=t,this.states.DuelTextSelector="Shown",e.onWaitEnd.append(this.cancelAll),this.onUpdateEvent.trigger(),new Promise(i=>{this.duelTextSelectorResolve=n=>{this.states.DuelTextSelector="Disable",e.onWaitEnd.remove(this.cancelAll),this.onUpdateEvent.trigger(),i(n)}})));this.view=e,this.states=Sn.reduce((t,i)=>(t[i]="Disable",t),{})}get onUpdate(){return this.onUpdateEvent.expose()}}const Ql=r=>new Promise(e=>setTimeout(e,r)),Jl=()=>{let r=()=>{},e=()=>{};return{promise:new Promise((i,n)=>{r=i,e=n}),resolve:r,reject:e}};class Xl{constructor(e){l(this,"onDuelUpdateEvent",new We);l(this,"requireUpdate",()=>{this.onDuelUpdateEvent.trigger()});l(this,"onWaitStartEvent",new We);l(this,"onWaitEndEvent",new We);l(this,"onDragStartEvent",new We);l(this,"onDragEndEvent",new We);l(this,"onAnimationStartEvent",new We);l(this,"onShowCardEntityEvent",new We);l(this,"duel");l(this,"modalController");l(this,"message");l(this,"waitMode");l(this,"infoBoardState");l(this,"infoBoardCell");l(this,"removeSvelteInfo",e=>{const t={...e};return t.selectedEntities&&(t.selectedEntities=we.recreateArray(this.duel.field,t.selectedEntities)),t});l(this,"getCell",(e,t)=>this.duel.field.cells[e][t]);l(this,"showCardInfo",(e,t)=>{this.onShowCardEntityEvent.trigger({card:e,mode:t})});l(this,"dispose",()=>{this.onDragStartEvent.clear(),this.onDragEndEvent.clear(),this.onDuelUpdateEvent.clear(),this.onWaitStartEvent.clear(),this.onWaitEndEvent.clear()});l(this,"waitFieldAction",async(e,t)=>{if(this.duel.getTurnPlayer().duelistType==="NPC"){const i=e.toSorted((n,a)=>(a.entity.atk||0)-(n.entity.atk||0)).find(n=>n.playType==="NormalSummon"||n.playType==="SpecialSummon"||n.playType==="CardActivation");return i?{action:i}:{phaseChange:this.duel.nextPhaseList[0]}}return await this._waitDuelistAction(e,"SelectFieldAction",t)});l(this,"waitQuickEffect",async(e,t,i,n)=>{if(t.length===0)return;if(e.duelistType==="NPC")return e.selectActionForNPC(t);const a=[];return a.push(this.modalController.selectAction(this,{title:i,actions:t,cancelable:n}).then(s=>s&&s)),a.push(this._waitDuelistAction(t,"SelectAction",this.message).then(s=>(this.infoBoardState="Log",s.action))),await Promise.any(a)});l(this,"waitSubAction",async(e,t,i,n=!1)=>{if(e.duelistType==="NPC")throw Error("Not implemented");return await this._waitDuelistAction(t,"SelectAction",i,void 0,void 0,void 0,n)});l(this,"waitSelectEntities",async(e,t,i,n,a,s=!1)=>{let o=[];if(i&&t.length===i)return[...t];if(e.duelistType==="NPC"){for(;!n(o);){const d=i&&i>0?i:Math.floor(Math.random()*t.length)+1;o=t.randomPickMany(d)}return o}return this.waitMode=t.every(d=>(d.fieldCell.cellType==="MonsterZone"||d.fieldCell.cellType==="ExtraMonsterZone")&&d.getIndexInCell()===0||d.fieldCell.cellType==="Hand"&&d.controller===e)?"SelectFieldEntities":"SelectEntities",(await this._waitDuelistAction([],this.waitMode,a,t,i,n,s)).selectedEntities});l(this,"_waitDuelistAction",async(e,t,i,n,a,s,o=!1)=>{this.waitMode=t,this.message=i,this.onDuelUpdateEvent.trigger();const u=Jl(),d={resolve:u.resolve,enableActions:e,qty:a,entitiesValidator:s||(()=>!1),selectableEntities:n||[]};n&&s&&this.waitMode==="SelectEntities"&&(d.duelEntitiesSelectorArg={title:i,entities:n,validator:s,qty:a??-1,cancelable:!1}),this.onWaitStartEvent.trigger(d);const f=await u.promise;if(this.waitMode="None",this.onWaitEndEvent.trigger(),f.surrender)throw new Ft(this.duel.duelists.Above);if(!o&&f.cancel)throw new Ae("キャンセル不可のアクションがキャンセルされた。",f,e,t,n);return this.infoBoardState="Log",this.removeSvelteInfo(f)});l(this,"waitSelectSummonDest",async(e,t,i,n)=>{const a=t.length>1?"カードを召喚先へドラッグ。":"表示形式を選択。",s=i.map(f=>Ct.createDammyAction(e,f,t,f)),o=this.modalController.selectAction(e.field.duel.view,{title:a,actions:s,cancelable:!1}),u=this.waitSubAction(e.controller,s,a,n).then(f=>f.action),d=await Promise.any([o,u]);if(!d&&!n)throw new Ae("キャンセル不可のアクションがキャンセルされた。",d);if(d){if(!d.cell)throw new Ae("召喚先のセルが指定されなかった。",d);if(!d.pos)throw new Ae("表示形式が指定されなかった。",d);return{dest:d.cell,pos:d.pos}}});l(this,"waitSelectText",async(e,t,i=!1)=>this.duel.view.modalController.selectText(this.duel.view,{title:t,choises:e,cancelable:i}));l(this,"waitAnimation",async e=>(this.message=this.duel.log.lastRecord.text,this.waitMode="Animation",this.onDuelUpdateEvent.trigger(),new Promise(t=>this.onAnimationStartEvent.trigger({...e,resolve:t}))));l(this,"setDraggingActions",e=>{this.onDragStartEvent.trigger(e),this.requireUpdate()});l(this,"removeDraggingActions",()=>{this.onDragEndEvent.trigger()});this.duel=e,this.message="",this.waitMode="None",this.infoBoardState="Log",this.infoBoardCell=e.duelists.Below.getExtraDeck(),this.modalController=new Kl(this)}get onDuelUpdate(){return this.onDuelUpdateEvent.expose()}get onWaitStart(){return this.onWaitStartEvent.expose()}get onWaitEnd(){return this.onWaitEndEvent.expose()}get onDragStart(){return this.onDragStartEvent.expose()}get onDragEnd(){return this.onDragEndEvent.expose()}get onAnimation(){return this.onAnimationStartEvent.expose()}get onShowCardEntity(){return this.onShowCardEntityEvent.expose()}}const Il=r=>Object.keys(r),eo={draw:"ドローフェイズ",standby:"スタンバイフェイズ",main1:"メインフェイズ１",battle1:"バトルフェイズ",battle2:"バトルフェイズ（追加）",main2:"メインフェイズ２",end:"エンドフェイズ"},to={start:"スタートステップ",battle:"バトルステップ",damage:"ダメージステップ",end:"エンドステップ"},ro={start:"ダメージステップ開始時",beforeDmgCalc:"ダメージ計算前",dmgCalc:"ダメージ計算時",afterDmgCalc:"ダメージ計算後",end:"ダメージステップ終了時"},at=["draw","stanby","main1","b1Start","b1Battle","b1End","b2Start","b2Battle","b2End","main2","end"],Gt=["b1DStart","b1DBeforeDmgCalc","b1DAfterDmgCalc","b1DEnd","b2DStart","b2DBeforeDmgCalc","b2DAfterDmgCalc","b2DEnd"],io=["b1DDmgCalc","b2DDmgCalc"];[...at,...Gt,...io];const bn={draw:{phase:"draw",step:void 0,stage:void 0},stanby:{phase:"standby",step:void 0,stage:void 0},main1:{phase:"main1",step:void 0,stage:void 0},b1Start:{phase:"battle1",step:"start",stage:void 0},b1Battle:{phase:"battle1",step:"battle",stage:void 0},b1DStart:{phase:"battle1",step:"battle",stage:"start"},b1DBeforeDmgCalc:{phase:"battle1",step:"battle",stage:"beforeDmgCalc"},b1DDmgCalc:{phase:"battle1",step:"battle",stage:"dmgCalc"},b1DAfterDmgCalc:{phase:"battle1",step:"battle",stage:"afterDmgCalc"},b1DEnd:{phase:"battle1",step:"battle",stage:"end"},b1End:{phase:"battle1",step:"end",stage:void 0},b2Start:{phase:"battle2",step:"start",stage:void 0},b2Battle:{phase:"battle2",step:"battle",stage:void 0},b2DStart:{phase:"battle2",step:"battle",stage:"start"},b2DBeforeDmgCalc:{phase:"battle2",step:"battle",stage:"beforeDmgCalc"},b2DDmgCalc:{phase:"battle2",step:"battle",stage:"dmgCalc"},b2DAfterDmgCalc:{phase:"battle2",step:"battle",stage:"afterDmgCalc"},b2DEnd:{phase:"battle2",step:"battle",stage:"end"},b2End:{phase:"battle2",step:"end",stage:void 0},main2:{phase:"main2",step:void 0,stage:void 0},end:{phase:"end",step:void 0,stage:void 0}},no=r=>r.stage?ro[r.stage]:r.step?to[r.step]:eo[r.phase],At=Il(bn).reduce((r,e)=>(r[e].key=e,r[e].name=no(r[e]),r),bn);class ao{constructor(){l(this,"onTotalProcSeqChangeEvent",new We);l(this,"_turn",0);l(this,"_phaseSeq",0);l(this,"_stepSeq",0);l(this,"_stageSeq",0);l(this,"_chainSeq",0);l(this,"_chainBlockSeq",0);l(this,"_procSeq",0);l(this,"_procTotalSeq",0);l(this,"_periodKey");l(this,"setPhase",(e,t)=>{const i=Object.values(At).filter(n=>n.phase===t).find(n=>(n.step??"start")==="start");if(!i)throw new Ae("想定されない状態",this.period,t,At);t==="draw"?(e.log.info("ターン終了。",e.getTurnPlayer()),this._turn++,this._phaseSeq=0):(e.log.info(`フェイズ移行（${this.period.phase}→${t}）`,e.getTurnPlayer()),this._phaseSeq++),this._stepSeq=0,this._stageSeq=0,this._chainSeq=0,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq(),this._periodKey=i.key});l(this,"setStep",(e,t)=>{const i=this.period.phase,n=Object.values(At).filter(a=>a.phase===i).find(a=>(a.step??"")===t);if(!n)throw new Ae("想定されない状態",this.period,t,At);e.log.info(`ステップ移行（${this.period.step}→${t}）`,e.getTurnPlayer()),this._stepSeq++,this._stageSeq=0,this._chainSeq=0,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq(),this._periodKey=n.key});l(this,"setStage",(e,t)=>{const i=this.period,n=Object.values(At).filter(a=>a.phase===i.phase).filter(a=>a.step===i.step).find(a=>(a.stage??"")===t);if(!n)throw new Ae("想定されない状態",this.period,t,At);e.log.info(`タイミング移行（${this.period.stage}→${t}）`,e.getTurnPlayer()),this._stageSeq++,this._chainSeq=0,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq(),this._periodKey=n.key});l(this,"incrementChainSeq",()=>{this._chainSeq++,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq()});l(this,"incrementChainBlockSeq",()=>{this._chainBlockSeq++,this._procSeq=0,this.incrementTotalProcSeq()});l(this,"incrementProcSeq",()=>{this._procSeq++,this.incrementTotalProcSeq()});l(this,"incrementTotalProcSeq",()=>{this._procTotalSeq++,this.onTotalProcSeqChangeEvent.trigger(this.totalProcSeq)});l(this,"toString",()=>`${this.totalProcSeq}(t${this.turn}-phs${this.phaseSeq}-stp${this.stepSeq}-stg${this.stepSeq}-c${this.chainSeq}-cb${this.chainBlockSeq}-prc${this.procSeq})`);l(this,"getClone",()=>({turn:this.turn,phaseSeq:this.phaseSeq,stepSeq:this.stepSeq,stageSeq:this.stageSeq,chainSeq:this.chainSeq,chainBlockSeq:this.chainBlockSeq,procSeq:this.procSeq,totalProcSeq:this.totalProcSeq}));l(this,"isSameChain",e=>this.turn===e.turn&&this.phaseSeq===e.phaseSeq&&this.stepSeq===e.stepSeq&&this.stageSeq===e.stageSeq&&this.chainSeq===e.chainSeq);l(this,"isPreviousChain",e=>this.turn===e.turn&&this.phaseSeq===e.phaseSeq&&this.stepSeq===e.stepSeq&&this.stageSeq===e.stageSeq&&this.chainSeq===e.chainSeq+1);l(this,"isPreviousProc",e=>this.totalProcSeq===e.totalProcSeq+1);this._periodKey="end"}get onTotalProcSeqChange(){return this.onTotalProcSeqChangeEvent.expose()}get period(){return At[this._periodKey]}get turn(){return this._turn}get phaseSeq(){return this._phaseSeq}get stepSeq(){return this._stepSeq}get stageSeq(){return this._stageSeq}get chainSeq(){return this._chainSeq}get chainBlockSeq(){return this._chainBlockSeq}get procSeq(){return this._procSeq}get totalProcSeq(){return this._procTotalSeq}get isFirstChain(){return this.chainSeq===0}}class so{constructor(e){l(this,"nextSeq");l(this,"records",[]);l(this,"duel");l(this,"push",(e,t)=>{this.records.push({seq:this.nextSeq++,clock:this.duel.clock.getClone(),activator:e,cardAction:t})});this.nextSeq=0,this.duel=e}}class Ft extends Error{constructor(t){const i=t?`デュエルが終了した。勝者：${t.profile.name}`:"デュエルが終了した。ドロー。";super(i);l(this,"winner");this.winner=t}}class Ae extends Error{constructor(t,...i){super(t);l(this,"message");l(this,"items");this.message=t,this.items=i}}class Bt extends Ae{constructor(...e){super("キャンセル不可のアクションがキャンセルされた。",...e)}}class lo{constructor(e,t,i,n,a,s){l(this,"view");l(this,"log");l(this,"cardActionLog");l(this,"clock");l(this,"nextPhaseList");l(this,"field");l(this,"attackingMonster");l(this,"targetForAttack");l(this,"_chainBlockInfos");l(this,"duelists");l(this,"priorityHolder");l(this,"isEnded");l(this,"coin",!1);l(this,"distributeOperators",e=>{console.info(`[totalProcSeq]:${e}`);let t=0;for(;;){if(t++,t>10)throw new Ae("無限ループ発生");if(this.field.procFilterPool.distributeAll(this)&&this.field.statusOperatorPool.distributeAll(this)&&this.field.cardRelationPool.distributeAll(this)&&this.field.numericStateOperatorPool.distributeAll(this))return}});l(this,"getTurnPlayer",()=>this.clock.turn%2===0?this.secondPlayer:this.firstPlayer);l(this,"getNonTurnPlayer",()=>this.clock.turn%2===0?this.firstPlayer:this.secondPlayer);l(this,"main",async(e=Math.random()>.5,t=[],i=[])=>{console.info("main start!"),this.coin=e,this.priorityHolder=this.firstPlayer,this.log.info("【デュエル開始】"),this.log.info(`先攻：${this.firstPlayer.profile.name}`),Object.values(this.duelists).forEach(a=>a.pushDeck()),Object.values(this.duelists).forEach(a=>a.shuffleDeck()),[{hand:t,duelist:this.duelists.Below},{hand:i,duelist:this.duelists.Above}].forEach(a=>{a.hand.length&&a.hand.forEach(s=>{const o=a.duelist.getDeckCell().cardEntities.find(u=>u.origin.name===s);if(!o){this.log.info(`初手操作により${s}を手札に加えようとしたが、デッキに存在しない。`);return}o.addToHand(["System"],void 0,void 0),this.log.info(`初手操作により${o.toString()}を手札に加えた`,a.duelist)})}),await Promise.all(Object.values(this.duelists).map(a=>a.draw(5-a.getHandCell().cardEntities.length,void 0,void 0))),this.moveNextPhase("draw"),this.view.requireUpdate();try{for(;!this.isEnded&&(this.clock.period.phase==="draw"?await this.procDrawPhase():this.phase==="standby"?await this.procStanbyPhase():this.phase==="main1"?await this.procMainPhase():this.phase==="battle1"?await this.procBattlePhase():this.phase==="battle2"?await this.procBattlePhase():this.phase==="main2"?await this.procMainPhase():this.phase==="end"&&await this.procEndPhase(),!(this.clock.turn>1e3)););}catch(a){a instanceof Ft?(console.info(a),this.isEnded=!0,this.log.info(a.winner?`デュエル終了。勝者${a.winner.profile.name}`:"引き分け")):a instanceof Error&&this.log.error(a)}finally{this.view.requireUpdate(),this.view.dispose(),this.log.dispose()}});l(this,"moveNextPhase",e=>{this.clock.setPhase(this,e),this.phase==="main2"||this.clock.turn===1?this.nextPhaseList=["end"]:this.phase==="battle1"||this.phase==="battle2"?this.nextPhaseList=["main2"]:this.phase==="main1"?this.nextPhaseList=["battle1","end"]:this.nextPhaseList=[]});l(this,"declareAnAttack",(e,t)=>{this.attackingMonster=e,this.targetForAttack=t,e.info.attackCount++,this.log.info(`攻撃宣言：${e.status.name} ⇒ ${t.status.name}`,e.controller)});l(this,"procDrawPhase",async()=>{for(Object.values(this.duelists).forEach(e=>e.initForDrawPhase()),this.log.info("ドローフェイズ開始。",this.getTurnPlayer()),this.clock.turn===1?this.log.info("先攻プレイヤーはドローできない。",this.getTurnPlayer()):await this.getTurnPlayer().draw(1,void 0,void 0);await this.procChainBlock(void 0,void 0););this.field.getEntiteisOnField().forEach(e=>e.initForTurn()),this.moveNextPhase("standby")});l(this,"procStanbyPhase",async()=>{for(;await this.procChainBlock(void 0,void 0););this.moveNextPhase("main1")});l(this,"procMainPhase",async()=>{for(;;){this.priorityHolder=this.getTurnPlayer();const e=await this.view.waitFieldAction(this.getEnableActions(["NormalSummon","SpellTrapSet","SpecialSummon","ChangeBattlePosition","IgnitionEffect","MandatoryIgnitionEffect","QuickEffect","CardActivation"],["Normal","Quick","Counter"],[]),"あなたの手番です。");if(e&&e.action){if([...hl].includes(e.action.playType)){const i=await e.action.prepare(e.action.cell,[],!0);if(i===void 0)continue;await e.action.execute(i,this.chainBlockInfos),this.clock.incrementChainSeq()}else await this.procChainBlock(e.action,void 0);for(;await this.procChainBlock(void 0,void 0););continue}const t=e.phaseChange;if(t){this.priorityHolder=this.getNonTurnPlayer();const i=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(["QuickEffect","TriggerEffect"],["Quick","Counter"],[]),"",!0);if(i){for(await this.procChainBlock(i,void 0);await this.procChainBlock(void 0,void 0););continue}this.moveNextPhase(t);return}}});l(this,"procBattlePhase",async()=>{await this.procBattlePhaseStartStep(),await this.procBattlePhaseBattleStep(),await this.procBattlePhaseEndStep()});l(this,"procBattlePhaseStartStep",async()=>{for(this.clock.setStep(this,"start"),this.priorityHolder=this.getTurnPlayer(),this.attackingMonster=void 0,this.targetForAttack=void 0;await this.procChainBlock(void 0,void 0););});l(this,"procBattlePhaseBattleStep",async()=>{for(;;){this.clock.setStep(this,"battle"),this.priorityHolder=this.getTurnPlayer();const e=await this.view.waitFieldAction(this.getEnableActions(["Battle"],["Normal"],[]),"攻撃モンスターと対象を選択。");if(e.phaseChange)break;if(e.action){const t=await e.action.prepare(e.action.cell,[],!0);if(!t)continue;await e.action.execute(t,[]),this.clock.incrementChainSeq();let i=!0;for(;;){const n=this.getNonTurnPlayer().getMonstersOnField().map(s=>[s.seq,s.moveLog.latestRecord.movedAt.totalProcSeq]);for(;await this.procChainBlock(void 0,void 0););if(!this.attackingMonster)throw new Ae("想定されない状態");this.attackingMonster.isOnField?this.attackingMonster.face==="FaceDown"?(this.log.info(`${this.attackingMonster.toString()}が裏側守備表示になったため、戦闘が中断された。`),i=!1):this.attackingMonster.orientation==="Horizontal"&&(this.log.info(`${this.attackingMonster.toString()}が守備表示になったため、戦闘が中断された。`),i=!1):(this.log.info(`${this.attackingMonster.toString()}がフィールドにいなくなったため、戦闘が中断された。`),i=!1);const a=this.getNonTurnPlayer().getMonstersOnField().map(s=>[s.seq,s.moveLog.latestRecord.movedAt.totalProcSeq]);if(n.length!==a.length)throw this.log.info("モンスターの数が増減したためバトルステップの巻き戻しが発生。"),new Ae("巻き戻し未実装");if(n.some(([s,o])=>a.every(([u,d])=>u!==s||d!==o)))throw this.log.info("モンスターの数が増減したためバトルステップの巻き戻しが発生。"),new Ae("巻き戻し未実装");break}if(!i)continue;await this.procBattlePhaseDamageStep(t)}}});l(this,"procBattlePhaseDamageStep",async e=>{if(!this.attackingMonster||!this.targetForAttack)throw new Ae("想定されない状態",this.attackingMonster,this.targetForAttack);await this.procBattlePhaseDamageStep1(),await this.procBattlePhaseDamageStep2(this.attackingMonster,this.targetForAttack),await this.procBattlePhaseDamageStep3(e,this.attackingMonster,this.targetForAttack),await this.procBattlePhaseDamageStep4(),await this.procBattlePhaseDamageStep5()});l(this,"procBattlePhaseDamageStep1",async()=>{for(this.clock.setStage(this,"start"),this.log.info("ダメージステップ開始時",this.getTurnPlayer());await this.procChainBlock(void 0,void 0););});l(this,"procBattlePhaseDamageStep2",async(e,t)=>{for(this.clock.setStage(this,"beforeDmgCalc"),this.log.info("ダメージ計算前",this.getTurnPlayer()),(t==null?void 0:t.battlePosition)==="Set"&&t.setBattlePosition("Defense",["Flip","FlipByBattle"],e,e.controller);await this.procChainBlock(void 0,void 0););});l(this,"procBattlePhaseDamageStep3",async(e,t,i)=>{if(t.atk===void 0)throw new Ae("想定されない状態",this.attackingMonster,this.targetForAttack);for(this.clock.setStage(this,"dmgCalc"),this.log.info("ダメージ計算時",this.getTurnPlayer());await this.procChainBlock(void 0,void 0););const n=t.atk,a=(i.battlePosition==="Attack"?i.atk:i.def)??0;if(i.entityType==="Duelist")t.controller.getOpponentPlayer().battleDamage(n-a,t);else{n>0&&n>a&&i.battlePosition==="Attack"?t.controller.getOpponentPlayer().battleDamage(n-a,t):n<a&&t.controller.battleDamage(a-n,i);const o=[];n>0&&(n>a||n===a&&i.battlePosition==="Attack")&&o.push(i.tryDestory("BattleDestroy",t.controller,t,e.action)),i.battlePosition==="Attack"&&n<=a&&o.push(t.tryDestory("BattleDestroy",t.controller,i,e.action)),await Promise.all(o)}const s=Object.values(this.duelists).filter(o=>o.lp<=0);if(s.length>0)throw new Ft(Object.values(this.duelists).filter(o=>!s.includes(o)).pop())});l(this,"procBattlePhaseDamageStep4",async()=>{for(this.clock.setStage(this,"afterDmgCalc"),this.log.info("ダメージ計算後",this.getTurnPlayer());await this.procChainBlock(void 0,void 0););});l(this,"procBattlePhaseDamageStep5",async()=>{for(this.clock.setStage(this,"end"),await we.waitCorpseDisposal(this),this.clock.incrementChainSeq(),this.log.info("ダメージステップ終了時",this.getTurnPlayer());await this.procChainBlock(void 0,void 0););});l(this,"procBattlePhaseEndStep",async()=>{this.clock.setStep(this,"end"),this.priorityHolder=this.getTurnPlayer(),await this.procSpellSpeed1(),this.moveNextPhase("main2")});l(this,"procEndPhase",async()=>{for(await this.procSpellSpeed1();;){const t=this.getTurnPlayer().getHandCell().cardEntities.length;if(t<7)break;await this.getTurnPlayer().discard(t-6,["Rule"])}this.moveNextPhase("draw")});l(this,"procSpellSpeed1",async()=>{this.priorityHolder=this.getTurnPlayer();let e=0;for(;e<2;){this.priorityHolder=this.priorityHolder.getOpponentPlayer();const t=this.getEnableActions(["IgnitionEffect","MandatoryIgnitionEffect","QuickEffect","CardActivation"],["Normal","Quick","Counter"],[]),i=t.every(a=>a.playType!=="MandatoryIgnitionEffect")||e<2;let n=t.find(a=>a.playType==="MandatoryIgnitionEffect");if((t.length!==1||t[0].playType!=="MandatoryIgnitionEffect")&&(n=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(["IgnitionEffect","MandatoryIgnitionEffect","QuickEffect","CardActivation"],["Normal","Quick","Counter"],[]),i?"効果を発動しますか？":"まだ発動しなければならない効果が残っている。",i)),n){await this.procChainBlock(n,void 0),await this.procFreeChain(),this.priorityHolder=this.getTurnPlayer(),e=0;continue}e++}});l(this,"procFreeChain",async()=>{for(;await this.procChainBlock(void 0,void 0););});l(this,"procChainBlock",async(e,t)=>{const i=this.clock.chainBlockSeq===0;let n=t??Object.values(this.duelists).flatMap(o=>(this.priorityHolder=o,this.getEnableActions(["MandatoryTriggerEffect","TriggerEffect"],["Normal"],[]))),a=!1,s;if(e)s=e,a=!0;else if(n.length>0){const o=await this.selectTriggerEffect(n);o&&(n=n.filter(u=>u!==o),s=o,a=!0)}if(!a){let o=0;for(;o<2;){this.priorityHolder=this.priorityHolder.getOpponentPlayer();const u=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(["QuickEffect","CardActivation"],["Quick","Counter"],this.chainBlockInfos),"クイックエフェクト発動タイミング。効果を発動しますか？",!0);if(u){s=u,a=!0;break}o++}}if(console.info("selected action: ",s),s){const o=s.entity.controller,u=this.clock.chainBlockSeq+1;this.log.info(`チェーン${u}: ${Et(s)}を発動`,o);const d=await s.prepare(s.cell,this.chainBlockInfos,!1);if(!d)throw new Bt(s);const f=d.action.entity.isNagatedStrongly&&_r.find(p=>p===d.isActivatedIn.cellType);if(d.selectedEntities.length&&this.log.info(`対象⇒${d.selectedEntities.map(p=>p.toString()).join(" ")}`),this._chainBlockInfos.push(d),this.clock.incrementProcSeq(),this.clock.incrementChainBlockSeq(),await this.procChainBlock(void 0,n.filter(p=>p.seq!==(s==null?void 0:s.seq))),this.log.info(`チェーン${u}: ${Et(s)}の効果処理。`,o),d.isNegatedActivationBy)this.log.info(`チェーン${u}: ${Et(s)}を${Et(d.isNegatedActivationBy)}によって発動を無効にした。`,d.activator);else{let p=d.action.entity.isEffective,y=`チェーン${u}: カードの効果が無効となっているため${Et(s)}の効果処理を行えない。`;if(p){if(d.isNegatedEffectBy)y=`チェーン${u}: ${Et(s)}を${Et(d.isNegatedEffectBy)}によって効果を無効にした。`,p=!1;else if(f){const c=d.action.entity.moveLog.records.findLast(h=>h.face==="FaceDown"&&h.orientation==="Horizontal");p=(c&&this.clock.isSameChain(c.movedAt))??!1}}p?await s.execute(d,this.chainBlockInfos):this.log.info(y,d.activator),await s.settle(d,this.chainBlockInfos)}this.clock.incrementProcSeq(),i&&(await we.sendManyToGraveyardForTheSameReason(this._chainBlockInfos.filter(p=>p.action.playType==="CardActivation").filter(p=>!p.action.isLikeContinuousSpell).map(p=>p.action.entity).filter(p=>p.isOnField).filter(p=>p.face==="FaceUp"),["Rule"],void 0,void 0),this._chainBlockInfos.reset(),this.clock.incrementChainSeq())}return a});l(this,"selectTriggerEffect",async e=>{if(e.length>0)for(const t of["MandatoryTriggerEffect","TriggerEffect"])for(const i of[this.getTurnPlayer(),this.getNonTurnPlayer()]){this.priorityHolder=i;const n=e.filter(s=>s.playType===t&&s.entity.controller===i);if(n.length===0)continue;if(n.length===1&&t==="MandatoryTriggerEffect")return n[0];const a=await this.view.waitQuickEffect(this.priorityHolder,n,"効果を選択。",t==="TriggerEffect");if(a)return a}});l(this,"getEnableActions",(e,t,i)=>this.field.getAllCardEntities().flatMap(n=>n.actions).filter(n=>n.executableCells.includes(n.entity.fieldCell.cellType)).filter(n=>n.executablePeriods.includes(this.clock.period.key)).filter(n=>e.includes(n.playType)).filter(n=>t.includes(n.spellSpeed)).filter(n=>n.executableDuelists.includes(this.priorityHolder)).filter(n=>n.validate(i)));this.clock=new ao,this.nextPhaseList=[],this.isEnded=!1,this.duelists={Below:new _n(this,"Below",e,t,i),Above:new _n(this,"Above",n,a,s)},this.priorityHolder=this.firstPlayer,this._chainBlockInfos=[],this.field=new Yl(this),this.clock.onTotalProcSeqChange.append(this.distributeOperators),this.view=new Xl(this),this.log=new zl(this),this.cardActionLog=new so(this)}get phase(){return this.clock.period.phase}get step(){return this.clock.period.step}get stage(){return this.clock.period.stage}get chainBlockInfos(){return this._chainBlockInfos}get firstPlayer(){return this.coin?this.duelists.Below:this.duelists.Above}get secondPlayer(){return this.coin?this.duelists.Above:this.duelists.Below}}we.prototype.hasBeenSummonedNow=function(r,e=["Attack","Defense"]){const t=this,i=e.map(ma),n=t.moveLog.latestRecord.movedAs;return console.log(t),!t.wasMovedAtPreviousChain||(console.log(t),!n.union(r).length)||(console.log(t),!n.union(i).length)?!1:(console.log(t),!0)};we.prototype.canBeEffected=function(r,e,t){return this.procFilterBundle.operators.filter(n=>n.procTypes.some(a=>a==="Effect")).every(n=>n.filter(r,e,t,[this]))};we.prototype.canBeTargetOfEffect=function(r,e,t){return this.procFilterBundle.operators.filter(n=>n.procTypes.some(a=>a==="EffectTarget")).every(n=>n.filter(r,e,t,[this]))};we.prototype.canBeSpecialSummoned=function(r,e,t,i){var a,s;const n=this;return(a=n.origin.monsterCategories)!=null&&a.includes("NormalSummonOnly")||(s=n.origin.monsterCategories)!=null&&s.includes("SpecialSummon")&&!n.status.canReborn&&!n.info.isRebornable&&(n.fieldCell.cellType==="Graveyard"||this.fieldCell.cellType==="Banished")?!1:n.procFilterBundle.operators.filter(o=>o.procTypes.some(u=>u==="SpecialSummon"||u===r)).every(o=>o.filter(e,t,i,[n]))};we.prototype.canBeTargetOfBattle=function(r,e){const t=this;return t.procFilterBundle.operators.filter(i=>i.procTypes.some(n=>n==="BattleTarget")).every(i=>i.filter(r,e,{},[t]))};we.prototype.tryDestory=async function(r,e,t,i){const n=this;return n.info.isDying=n.procFilterBundle.operators.filter(a=>a.procTypes.includes(r)).every(a=>a.filter(e,t,i??{},[n])),n.info.isDying&&(n.duel.log.info(`${n.toString()}を${Vl[r]}`,t.controller),n.info.causeOfDeath=[r],n.info.isKilledBy=t,n.info.isKilledByWhom=t.controller),n.info.isDying};we.prototype.canBeMaterials=function(r,e,t){return this.procFilterBundle.operators.filter(n=>n.procTypes.some(a=>a===r)).every(n=>n.filter(e.entity.controller,e.entity,e,t))};we.prototype.getIndexInCell=function(){const r=this;if(r.info.isVanished)return-1;const e=r.fieldCell.cardEntities.indexOf(r);if(e<0)throw new Ae("エンティティとセルの状態が矛盾している。",[r,r.fieldCell]);return e};class Yi{constructor(){}}l(Yi,"tryDestroy",async(e,t)=>{const i=e.filter(a=>!a.info.isDying);await Promise.all(i.map(a=>a.tryDestory("EffectDestroy",t.activator,t.action.entity,t.action)));const n=i.filter(a=>a.info.isDying);return await we.waitCorpseDisposal(t.activator.duel),n});const oo=()=>{const r=[];["サイバー・ドラゴン","六武衆のご隠居","アンノウン・シンクロン"].forEach(f=>r.push({name:f,actions:[$e,qe,Oe,{title:"特殊召喚",playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:f==="アンノウン・シンクロン"?1:void 0,validate:p=>{const y=p.entity.field.getMonstersOnField();if(!(y.length==0||y.some(c=>c.controller===p.entity.controller)))return hn(p,["Attack","Defense"],[])},prepare:(p,y,c,h)=>yn(p,y,["Attack","Defense"],[],h),execute:gn,settle:async()=>!0}]}));const e={name:"ジャンク・フォアード",actions:[$e,qe,Oe,{title:"特殊召喚",playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:f=>{if(f.entity.controller.getAvailableMonsterZones().length)return hn(f,["Attack","Defense"],[])},prepare:(f,p,y,c)=>yn(f,p,["Attack","Defense"],[],c),execute:gn,settle:async()=>!0}]};r.push(e);const t={name:"Ｄ－ＨＥＲＯ ディアボリックガイ",actions:[$e,qe,Oe,{title:"①リクルート",playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:f=>f.entity.controller.getDeckCell().cardEntities.filter(y=>y.nm==="Ｄ－ＨＥＲＯ ディアボリックガイ").length===0?void 0:f.entity.controller.getAvailableMonsterZones().length>0?[]:void 0,prepare:async f=>(await f.entity.banish(["Cost"],f.entity,f.entity.controller),{selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async f=>{const p=f.activator.getAvailableMonsterZones();if(!p.length)return!1;const y=f.activator.getDeckCell().cardEntities.find(c=>c.nm==="Ｄ－ＨＥＲＯ ディアボリックガイ");return y?(await f.activator.summon(y,["Attack","Defense"],p,"SpecialSummon",["Effect"],f.action.entity,!1),!0):!1},settle:async()=>!0}]};r.push(t);const i={name:"ゾンビキャリア",actions:[$e,qe,Oe,{title:"①自己再生",playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:f=>f.entity.controller.getHandCell().cardEntities.length===0?void 0:f.entity.controller.getAvailableMonsterZones().length>0?[]:void 0,prepare:async f=>{const p=f.entity.controller.getHandCell().cardEntities,y=await f.entity.controller.duel.view.waitSelectEntities(f.entity.controller,p,1,c=>c.length===1,"デッキトップに戻すカードを一枚選択。");if(!y)throw new Bt(f);return await y[0].returnToDeck("Top",["Cost"],f.entity,f.entity.controller),{selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}},execute:async f=>{if(f.action.entity.wasMovedAtCurrentChain)return!1;const p=f.action.entity.controller.getAvailableMonsterZones();return p.length===0?!1:(await f.activator.summon(f.action.entity,["Attack","Defense"],p,"SpecialSummon",["Effect"],f.action.entity,!1),f.action.entity.info.willBeBanished=!0,!0)},settle:async()=>!0}]};r.push(i);const n={name:"グローアップ・バルブ",actions:[$e,qe,Oe,{title:"①自己再生",playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:1,validate:f=>f.entity.controller.getDeckCell().cardEntities.length===0?void 0:f.entity.controller.getAvailableMonsterZones().length>0?[]:void 0,prepare:async f=>(await f.entity.controller.getDeckCell().cardEntities[0].sendToGraveyard(["Cost"],f.entity,f.entity.controller),{selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:async f=>{if(f.action.entity.wasMovedAtCurrentChain)return!1;const p=f.action.entity.controller.getAvailableMonsterZones();return p.length===0?!1:(await f.activator.summon(f.action.entity,["Attack","Defense"],p,"SpecialSummon",["Effect"],f.action.entity),!0)},settle:async()=>!0}]};r.push(n);const a={name:"終末の騎士",actions:[$e,qe,Oe,{title:"①墓地送り",playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...at,...Gt],executableDuelistTypes:["Controller"],validate:f=>{if(f.entity.hasBeenSummonedNow(["NormalSummon","SpecialSummon","FlipSummon"])&&f.entity.controller.getDeckCell().cardEntities.filter(p=>p.attr.includes("Dark")).length!==0)return[]},prepare:async f=>{const p=["SendToGraveyardFromDeck"];return f.entity.moveLog.latestRecord.movedAs.includes("NormalSummon")?p.push("IfNormarlSummonSucceed"):p.push("IfSpecialSummonSucceed"),{selectedEntities:[],chainBlockTags:p,prepared:void 0}},execute:async f=>{const p=f.action.entity.controller.getDeckCell().cardEntities.filter(y=>y.attr.includes("Dark"));return p.length===0?!1:(await f.action.entity.field.sendToGraveyard("墓地に送るモンスターを選択",f.activator,p,1,y=>y.length===1,["Effect"],f.action.entity,!1),f.activator.shuffleDeck(),!0)},settle:async()=>!0}]};r.push(a);const s={name:"マスマティシャン",actions:[$e,qe,Oe,{title:"①墓地送り",playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...at,...Gt],executableDuelistTypes:["Controller"],validate:f=>{if(f.entity.hasBeenSummonedNow(["NormalSummon"])&&f.entity.controller.getDeckCell().cardEntities.find(p=>(p.lvl??5)<5))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["IfNormarlSummonSucceed","SendToGraveyardFromDeck"],prepared:void 0}),execute:async f=>{const p=f.activator.getDeckCell().cardEntities.filter(y=>(y.lvl??5)<5);return p.length===0?!1:(await f.action.entity.field.sendToGraveyard("墓地に送るモンスターを選択",f.activator,p,1,y=>y.length===1,["Effect"],f.action.entity,!1),f.activator.shuffleDeck(),!0)},settle:async()=>!0},{title:"②ドロー",playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...at,...Gt],executableDuelistTypes:["Controller"],validate:f=>{if(f.entity.face!=="FaceDown"&&f.entity.moveLog.latestRecord.movedAs.includes("BattleDestroy")&&f.entity.wasMovedAtPreviousChain&&f.entity.controller.getDeckCell().cardEntities.length!==0)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async f=>(await f.activator.draw(1,f.action.entity,f.activator),!0),settle:async()=>!0}]};r.push(s);const o={name:"ライトロード・ビースト ウォルフ",actions:[qe,Oe,{title:"①自己再生",playType:"MandatoryTriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...at,...Gt],executableDuelistTypes:["Controller"],validate:f=>{if(f.entity.wasMovedAtPreviousChain&&f.entity.wasMovedFrom.cellType==="Deck")return f.entity.controller.getAvailableMonsterZones().length>0?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:async f=>{if(f.action.entity.wasMovedAtCurrentChain)return!1;const p=f.action.entity.controller.getAvailableMonsterZones();return!p.length||f.action.entity.fieldCell.cellType!=="Graveyard"&&f.action.entity.fieldCell.cellType!=="Banished"||f.action.entity.face==="FaceDown"?!1:(await f.activator.summon(f.action.entity,["Attack","Defense"],p,"SpecialSummon",["Effect"],f.action.entity),!0)},settle:async()=>!0}]};r.push(o);const u={name:"伝説の白石",actions:[qe,Oe,$e,{title:"①サーチ",playType:"MandatoryTriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:at,executableDuelistTypes:["Controller"],validate:f=>{if(f.entity.wasMovedAtPreviousChain&&f.entity.wasMovedFrom.cellType!=="Banished")return f.entity.controller.getDeckCell().cardEntities.find(p=>p.nm==="青眼の白龍")?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async f=>{const p=f.activator.getDeckCell().cardEntities.find(y=>y.nm==="青眼の白龍");return p?(await p.addToHand(["Effect"],f.action.entity,f.activator),f.activator.shuffleDeck(),!0):!1},settle:async()=>!0}]};return r.push(u),[{name:"灰流うらら",chainBlockTags:["Draw","SearchFromDeck","SendToGraveyardFromDeck","SpecialSummonFromDeck"]},{name:"屋敷わらし",chainBlockTags:["BanishFromGraveyard","SpecialSummonFromGraveyard","AddToHandFromGraveyard"]}].forEach(f=>{r.push({name:f.name,actions:[qe,Oe,$e,{title:"①無効化",playType:"QuickEffect",spellSpeed:"Quick",executableCells:["Hand"],executablePeriods:at,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:(p,y)=>y.length===0?void 0:y.slice(-1)[0].chainBlockTags.union(f.chainBlockTags).length>0?[]:void 0,prepare:async(p,y,c)=>(await p.entity.sendToGraveyard(["Discard","Cost"],p.entity,p.entity.controller),{selectedEntities:[],chainBlockTags:["NegateCardEffect"],prepared:c.length}),execute:async(p,y)=>{const c=y[p.prepared-1];return c.isNegatedEffectBy=p.action,!0},settle:async()=>!0}]})}),["翻弄するエルフの剣士","ロードランナー","氷結界の修験者"].forEach(f=>{r.push({name:f,actions:[qe,Oe,$e],continuousEffects:[Bl("①戦闘破壊耐性","Monster",p=>[p],()=>!0,p=>[new xl("①戦闘破壊耐性",()=>!0,!0,p,{},()=>!0,["BattleDestroy"],(y,c)=>!p.isEffective||(c.atk??0)<1900?!0:(p.duel.log.info(`${p.toString()}は攻撃力1900以上のモンスターとの先頭では破壊されない。`,p.controller),!1))])]})}),r},co=r=>{if(r.entity.status.spellCategory==="Field")return[r.entity.controller.getFieldZone()];const e=r.entity.controller.getAvailableSpellTrapZones();return e.length>0?e:void 0},uo=async(r,e)=>{if(r.entity.status.spellCategory==="Field"){const n=r.entity.controller.getFieldZone(),a=n.cardEntities[0];return await we.sendManyToGraveyardForTheSameReason(n.cardEntities,["Rule"],r.entity,r.entity.controller),r.entity.field.duel.log.info(`フィールド魔法の上書きにより、${a.toString()}は墓地に送られた。`,r.entity.controller),{selectedEntities:[],chainBlockTags:[],prepared:{dest:n}}}if(e)return{selectedEntities:[],chainBlockTags:[],prepared:{dest:e}};const t=r.entity.controller.getAvailableSpellTrapZones();if(t.length===0)return;let i=t[0];if(t.length>1&&r.entity.controller.duelistType!=="NPC"){const n=[Ct.createDammyAction(r.entity,"セット",t)],a=r.entity.field.duel.view.modalController.selectAction(r.entity.field.duel.view,{title:"カードをセット先へドラッグ",actions:n,cancelable:!0}),s=r.entity.field.duel.view.waitSubAction(r.entity.controller,n,"カードをセット先へドラッグ",!0),o=await Promise.any([a,s.then(u=>u.action)]);if(!o)return;i=o.cell||i}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:i}}},fo=async r=>(await r.action.entity.setAsSpellTrap(r.prepared.dest,["Rule","SpellTrapSet"],r.action.entity,r.activator),r.activator.duel.log.info(`${r.action.entity.status.name}をセット（SpellTrapSet）。`,r.activator),r.action.entity.info.isSettingSickness=r.action.entity.status.kind==="Trap"||r.action.entity.status.spellCategory==="QuickPlay",!0),De={title:"セット",playType:"SpellTrapSet",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:co,prepare:uo,execute:fo,settle:async()=>!0},Ee=r=>{if(r.entity.info.isPending||r.entity.info.isDying||r.entity.info.isSettingSickness)return;if(Lt.some(t=>t===r.entity.fieldCell.cellType))return r.entity.face==="FaceDown"?[]:void 0;if(!r.entity.controller.isTurnPlayer)return;if(r.entity.status.spellCategory==="Field")return[r.entity.controller.getFieldZone()];const e=r.entity.controller.getAvailableSpellTrapZones();return e.length>0?e:void 0},Mi=(r,e,t,i,n,a)=>xe(r,e,t,i,n,a,void 0),xe=async(r,e,t,i,n,a,s)=>{if(Lt.some(o=>o===r.entity.fieldCell.cellType)&&r.entity.face==="FaceDown")return await r.entity.setNonFieldMonsterPosition("FaceUp",["Rule"]),{chainBlockTags:n??[],selectedEntities:a??[],prepared:s};if(r.entity.status.spellCategory==="Field"){const o=r.entity.controller.getFieldZone().cardEntities;if(o.length){const u=o[0];await we.sendManyToGraveyardForTheSameReason(r.entity.controller.getFieldZone().cardEntities,["Rule"],r.entity,r.entity.controller),r.entity.controller.duel.log.info(`フィールド魔法の上書きにより、${u.toString()}は墓地に送られた。`,r.entity.controller)}}if(r.entity.fieldCell.cellType==="Hand"){const o=["SpellTrapActivate"],u=e?[e]:r.entity.status.spellCategory==="Field"?[r.entity.controller.getFieldZone()]:r.entity.controller.getAvailableSpellTrapZones();return await r.entity.field.activateSpellTrapFromHand(r.entity,u,o,r.entity,r.entity.controller,i),{chainBlockTags:n??[],selectedEntities:a??[],prepared:s}}},vo=()=>{const r=[],e={name:"強欲な壺",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:c=>{if(!(c.entity.controller.getDeckCell().cardEntities.length<2)&&c.entity.controller.canDraw&&c.entity.controller.canAddToHandFromDeck)return Ee(c)},prepare:(c,h,m,S)=>xe(c,h,m,S,["Draw","SearchFromDeck"],[],void 0),execute:async c=>(await c.activator.draw(2,c.action.entity,c.activator),!0),settle:async()=>!0},De]};r.push(e);const t={name:"貪欲な壺",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:c=>{if(!(c.entity.controller.getGraveyard().cardEntities.filter(h=>h.status.kind==="Monster").filter(h=>h.canBeTargetOfEffect(c.entity.controller,c.entity,c)).length<5)&&c.entity.controller.canDraw&&c.entity.controller.canAddToHandFromDeck)return Ee(c)},prepare:async(c,h,m,S)=>{const T=await c.entity.field.duel.view.waitSelectEntities(c.entity.controller,c.entity.controller.getGraveyard().cardEntities.filter(b=>b.status.kind==="Monster").filter(b=>b.canBeTargetOfEffect(c.entity.controller,c.entity,c)),5,b=>b.length===5,"デッキに戻すモンスターを選択。",!1);if(T)return xe(c,h,m,S,["Draw","SearchFromDeck","ReturnToDeckFromGraveyard"],T,void 0)},execute:async c=>c.selectedEntities.some(h=>h.wasMovedAtCurrentChain)?!1:(await we.returnManyToDeckForTheSameReason("Random",c.selectedEntities,["Effect"],c.action.entity,c.activator),await c.activator.draw(2,c.action.entity,c.activator),!0),settle:async()=>!0},De]};r.push(t);const i={name:"天使の施し",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:c=>{if(!(c.entity.controller.getDeckCell().cardEntities.length<3))return Ee(c)},prepare:(c,h,m)=>xe(c,h,m,!1,["Draw","SearchFromDeck","DiscordAsEffect"],[],void 0),execute:async c=>(await c.activator.draw(3,c.action.entity,c.activator),await c.activator.discard(2,["Effect","Discard"],c.action.entity,c.activator),!0),settle:async()=>!0},De]};r.push(i);const n={name:"成金ゴブリン",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:c=>{if(!(c.entity.controller.getDeckCell().cardEntities.length<1))return Ee(c)},prepare:(c,h,m)=>xe(c,h,m,!1,["Draw","SearchFromDeck"],[],void 0),execute:async c=>(await c.activator.draw(1,c.action.entity,c.activator),c.action.entity.field.duel.clock.incrementProcSeq(),c.activator.getOpponentPlayer().heal(1e3,c.action.entity),!0),settle:async()=>!0},De]};r.push(n);const a={name:"おろかな埋葬",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:c=>{if(c.entity.controller.getDeckCell().cardEntities.filter(h=>h.status.kind==="Monster").length!==0)return Ee(c)},prepare:(c,h,m)=>xe(c,h,m,!1,["SendToGraveyardFromDeck"],[],void 0),execute:async c=>{const h=c.activator.getDeckCell().cardEntities.filter(S=>S.status.kind==="Monster");if(h.length===0)return!1;const m=await c.action.entity.field.duel.view.waitSelectEntities(c.activator,h,1,S=>S.length===1,"墓地に送るモンスターを選択",!1);if(!m)throw new Bt(c);return await we.sendManyToGraveyardForTheSameReason(m,["Effect"],c.action.entity,c.activator),await c.activator.shuffleDeck(),!0},settle:async()=>!0},De]};r.push(a);const s={name:"おろかな副葬",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:c=>{if(c.entity.controller.getDeckCell().cardEntities.filter(h=>h.status.kind!=="Monster").length!==0)return Ee(c)},prepare:(c,h,m)=>xe(c,h,m,!1,["SendToGraveyardFromDeck"],[],void 0),execute:async c=>{const h=c.activator.getDeckCell().cardEntities.filter(S=>S.status.kind!=="Monster");if(h.length===0)return!1;const m=await c.action.entity.field.duel.view.waitSelectEntities(c.activator,h,1,S=>S.length===1,"墓地に送る魔法罠を選択",!1);if(!m)throw new Bt(c);return await we.sendManyToGraveyardForTheSameReason(m,["Effect"],c.action.entity,c.activator),await c.activator.shuffleDeck(),!0},settle:async()=>!0},De]};r.push(s);const o={name:"死者蘇生",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:c=>{if(c.entity.field.getCells("Graveyard").flatMap(h=>h.cardEntities).filter(h=>h.status.kind==="Monster").filter(h=>h.info.isRebornable).filter(h=>h.canBeTargetOfEffect(c.entity.controller,c.entity,c)).filter(h=>h.canBeSpecialSummoned("SpecialSummon",c.entity.controller,c.entity,c)).length!==0&&c.entity.controller.getAvailableMonsterZones().length!==0)return Ee(c)},prepare:async(c,h,m)=>{const S=await c.entity.field.duel.view.waitSelectEntities(c.entity.controller,c.entity.field.getCells("Graveyard").flatMap(T=>T.cardEntities).filter(T=>T.status.kind==="Monster").filter(T=>T.info.isRebornable).filter(T=>T.canBeTargetOfEffect(c.entity.controller,c.entity,c)).filter(T=>T.canBeSpecialSummoned("SpecialSummon",c.entity.controller,c.entity,c)),1,T=>T.length===1,"蘇生対象とするモンスターを選択",!1);if(!S)throw new Bt(c);return await xe(c,h,m,!1,["SpecialSummonFromGraveyard"],S,void 0)},execute:async c=>{const h=c.activator.getEmptyMonsterZones(),m=c.selectedEntities[0];return await c.activator.summon(m,["Attack","Defense"],h,"SpecialSummon",["Effect"],c.action.entity,!1),!0},settle:async()=>!0},De]};r.push(o),[{name:"大嵐",cellTypes:Lt,isOnlyEnemies:!1},{name:"ハーピィの羽根帚",cellTypes:Lt,isOnlyEnemies:!0},{name:"ブラック・ホール",cellTypes:Hr,isOnlyEnemies:!1},{name:"サンダー・ボルト",cellTypes:Hr,isOnlyEnemies:!0}].forEach(c=>{r.push({name:c.name,actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:h=>{let m=h.entity.field.getCells(...c.cellTypes).flatMap(S=>S.cardEntities).filter(S=>S!==h.entity);if(c.isOnlyEnemies&&(m=m.filter(S=>S.controller!==h.entity.controller)),!!m.length)return Ee(h)},prepare:async(h,m,S)=>{let T=h.entity.field.getCells(...c.cellTypes).flatMap(b=>b.cardEntities).filter(b=>b!==h.entity);return c.isOnlyEnemies&&(T=T.filter(b=>b.controller!==h.entity.controller)),await xe(h,m,S,!1,h.calcChainBlockTagsForDestroy(T),[],void 0)},execute:async h=>{let m=h.action.entity.field.getCells(...c.cellTypes).flatMap(S=>S.cardEntities).filter(S=>S!==h.action.entity);return c.isOnlyEnemies&&(m=m.filter(S=>S.controller!==h.action.entity.controller)),await Yi.tryDestroy(m,h),!0},settle:async()=>!0},De]})});const u={name:"ハリケーン",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:c=>{if(c.entity.field.getCells("SpellAndTrapZone","FieldSpellZone").flatMap(m=>m.cardEntities).filter(m=>m!==c.entity).length)return Ee(c)},prepare:async(c,h,m)=>await xe(c,h,m,!1,["BounceToHand"],[],void 0),execute:async(c,h)=>{const m=h.map(T=>T.action).filter(T=>T.playType==="CardActivation").map(T=>T.entity).filter(T=>T.isOnField).filter(T=>T.face==="FaceUp").filter(T=>!T.isLikeContinuousSpell),S=c.action.entity.field.getCells("SpellAndTrapZone","FieldSpellZone").flatMap(T=>T.cardEntities).filter(T=>!m.includes(T));return await we.returnManyToHandForTheSameReason(S,["Effect"],c.action.entity,c.activator),!0},settle:async()=>!0},De]};r.push(u);const d={name:"手札抹殺",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:c=>{if(!(c.entity.controller.getDeckCell().cardEntities.length<c.entity.controller.getHandCell().cardEntities.filter(h=>h.seq!==c.entity.seq).length)&&c.entity.field.getAllCells().filter(h=>h.cellType==="Hand").flatMap(h=>h.cardEntities).filter(h=>h.seq!==c.entity.seq).length!==0)return Ee(c)},prepare:(c,h,m)=>xe(c,h,m,!1,["SearchFromDeck"],[],void 0),execute:async c=>{const h=c.activator.getHandCell().cardEntities.length,m=c.activator.getOpponentPlayer().getHandCell().cardEntities.length;return await we.sendManyToGraveyardForTheSameReason(c.action.entity.field.getCells("Hand").flatMap(S=>S.cardEntities),["Effect","Discard"],c.action.entity,c.activator),c.activator.duel.clock.incrementProcSeq(),await c.action.entity.field.drawAtSameTime(c.activator,h,c.activator.getOpponentPlayer(),m,c.action.entity,c.activator),!0},settle:async()=>!0},De]};r.push(d);const f={name:"光の援軍",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:c=>{if(!(c.entity.controller.getDeckCell().cardEntities.length<4)&&c.entity.controller.getDeckCell().cardEntities.filter(h=>h.status.kind==="Monster").filter(h=>(h.lvl??13)<5).filter(h=>h.status.nameTags&&h.status.nameTags.includes("ライトロード")).length!==0)return Ee(c)},prepare:async(c,h,m)=>{const S=c.entity.controller.getDeckCell();return await we.sendManyToGraveyardForTheSameReason(S.cardEntities.slice(0,3),["Cost"],c.entity,c.entity.controller),await xe(c,h,m,!1,["SearchFromDeck","SendToGraveyardFromDeck"],[],void 0)},execute:async c=>{const h=c.activator.getDeckCell().cardEntities.filter(S=>S.status.kind==="Monster").filter(S=>(S.lvl??13)<5).filter(S=>S.status.nameTags&&S.status.nameTags.includes("ライトロード"));if(h.length===0)return!1;const m=await c.action.entity.field.duel.view.waitSelectEntities(c.activator,h,1,S=>S.length===1,"手札に加えるモンスターを選択",!1);for(const S of m??[])await S.addToHand(["Effect"],c.action.entity,c.activator);return c.activator.shuffleDeck(),!0},settle:async()=>!0},De]};r.push(f);const p={name:"調律",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:c=>{const h=c.entity.controller.getDeckCell().cardEntities;if(!(h.length<2)&&h.filter(m=>{var S;return(S=m.status.nameTags)==null?void 0:S.includes("シンクロン")}).filter(m=>{var S;return(S=m.status.monsterCategories)==null?void 0:S.includes("Tuner")}).length!==0)return Ee(c)},prepare:(c,h,m)=>xe(c,h,m,!1,["SearchFromDeck","SendToGraveyardFromDeck"],[],void 0),execute:async c=>{const h=c.activator.getDeckCell().cardEntities;if(h.length<2)return;const m=h.filter(T=>{var b;return(b=T.status.nameTags)==null?void 0:b.includes("シンクロン")}).filter(T=>{var b;return(b=T.status.monsterCategories)==null?void 0:b.includes("Tuner")});if(m.length===0)return!1;const S=await c.action.entity.field.duel.view.waitSelectEntities(c.activator,m,1,T=>T.length===1,"手札に加えるモンスターを選択",!1);for(const T of S??[])await T.addToHand(["Effect"],c.action.entity,c.activator);return c.activator.duel.clock.incrementProcSeq(),c.activator.getDeckCell().shuffle(),await c.activator.getDeckCell().cardEntities[0].sendToGraveyard(["Effect"],c.action.entity,c.activator),!0},settle:async()=>!0},De]};r.push(p);const y={name:"ワン・フォー・ワン",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:c=>{if(c.entity.controller.getDeckCell().cardEntities.filter(h=>h.lvl===1).length===0){if(c.entity.controller.getHandCell().cardEntities.filter(h=>h.lvl===1).length===0||c.entity.controller.getHandCell().cardEntities.filter(h=>h.status.kind==="Monster").length<2)return}else if(c.entity.controller.getHandCell().cardEntities.filter(h=>h.status.kind==="Monster").length===0)return;return Ee(c)},prepare:async(c,h,m)=>{let S=c.entity.controller.getHandCell().cardEntities.filter(b=>b.status.kind==="Monster");if(c.entity.controller.getDeckCell().cardEntities.filter(b=>b.lvl===1).length===0){const b=c.entity.controller.getHandCell().cardEntities.filter(B=>B.lvl===1);b.length===1&&(S=S.filter(B=>B!==b[0]))}if(await c.entity.field.sendToGraveyard("墓地送るモンスターを選択",c.entity.controller,S,1,b=>b.length===1,["Cost"],c.entity,!0))return await xe(c,h,m,!1,["SpecialSummonFromDeck"],[],void 0)},execute:async c=>{const h=[...c.action.entity.controller.getDeckCell().cardEntities.filter(S=>S.lvl===1),...c.action.entity.controller.getHandCell().cardEntities.filter(S=>S.lvl===1)];if(h.length===0)return!1;const m=await c.action.entity.field.duel.view.waitSelectEntities(c.activator,h,1,S=>S.length===1,"特殊召喚するモンスターを選択",!1);if(!m)throw new Error("illegal state");return await c.activator.summon(m[0],["Attack","Defense"],c.activator.getAvailableMonsterZones(),"SpecialSummon",["Effect"],c.action.entity,!1),c.activator.shuffleDeck(),!0},settle:async()=>!0},De]};return r.push(y),r},po=(r,e,t,i,n)=>({title:"①リクルート",playType:"TriggerEffect",spellSpeed:"Normal",executableCells:n,executablePeriods:i.includes("EffectDestroy")?[...at,...Gt]:["b1DEnd","b2DEnd"],executableDuelistTypes:["Controller"],validate:a=>{if(!a.entity.wasMovedAtPreviousChain||!a.entity.moveLog.latestRecord.movedAs.includes("BattleDestroy"))return;const s=a.entity.controller.getDeckCell().cardEntities.filter(r);if(s.length!==0&&!s.every(o=>!a.entity.controller.canSummon(a.entity.controller,a.entity,a,"SpecialSummon",t,[o]).length))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async a=>{const s=a.action.entity.controller.getDeckCell().cardEntities.filter(r);if(s.length===0)return!1;const o=await a.action.entity.field.duel.view.waitSelectEntities(a.activator,s,e.length===1?e[0]:-1,u=>e.includes(u.length),"特殊召喚するモンスターを選択",!1);if(!o)throw new Error("illegal state");for(const u of o)await a.activator.summon(u,t,a.activator.getAvailableMonsterZones(),"SpecialSummon",["Effect"],a.action.entity,!1);return a.activator.shuffleDeck(),!0},settle:async()=>!0}),ho=()=>{const r=[];return[{name:"キラー・ポテト",filter:e=>e.attr.includes("Dark")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["EffectDestroy"],executableCells:["Graveyard"]},{name:"キラー・トマト",filter:e=>e.attr.includes("Dark")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"巨大ネズミ",filter:e=>e.attr.includes("Earth")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"グリズリーマザー",filter:e=>e.attr.includes("Water")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"シャインエンジェル",filter:e=>e.attr.includes("Light")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ドラゴンフライ",filter:e=>e.attr.includes("Wind")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ＵＦＯタートル",filter:e=>e.attr.includes("Fire")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"荒野の女戦士",filter:e=>e.attr.includes("Earth")&&e.types.includes("Warrior")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"リトル・トルーパー",filter:e=>e.types.includes("Warrior")&&(e.lvl??9999)<3,qtyList:[1],posList:["Set"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard","Banished"]},{name:"破面竜",filter:e=>e.types.includes("Warrior")&&(e.def??9999)<=1500,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"共鳴虫",filter:e=>e.types.includes("Insect")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ピラミッド・タートル",filter:e=>e.types.includes("Zombie")&&(e.def??9999)<=2e3,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ユーフォロイド",filter:e=>e.types.includes("Machine")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ヘル・セキュリティ",filter:e=>e.types.includes("Fiend")&&(e.lvl??9999)===1,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ガスタ・イグル",filter:e=>(e.status.nameTags??[]).includes("ガスタ")&&(e.status.monsterCategories??[]).includes("Tuner"),qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"幻影の魔術士",filter:e=>(e.status.nameTags??[]).includes("ＨＥＲＯ")&&(e.atk??9999)<=1e3,qtyList:[1],posList:["Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ジェネクス・サーチャー",filter:e=>(e.status.nameTags??[]).includes("ジェネクス")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"紫炎の足軽",filter:e=>(e.status.nameTags??[]).includes("六武衆")&&(e.lvl??12)<=3,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"スレイブ・エイプ",filter:e=>(e.status.nameTags??[]).includes("剣闘獣")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ゼンマイハニー",filter:e=>(e.status.nameTags??[]).includes("ゼンマイ")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ＸＸ－セイバー エマーズブレイド",filter:e=>(e.status.nameTags??[]).includes("Ｘ－セイバー")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"軍隊竜",filter:e=>e.nm==="軍隊竜",qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"アサルト・ガンドッグ",filter:e=>e.nm==="アサルト・ガンドッグ",qtyList:[1,2,3,4,5],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ハイエナ",filter:e=>e.nm==="ハイエナ",qtyList:[1,2,3,4,5],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]}].forEach(e=>{r.push({name:e.name,actions:[po(e.filter,e.qtyList,e.posList,e.destoryTypes,e.executableCells),qe,Oe,$e]})}),r},yo=r=>({title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(e.entity.controller.getDeckCell().cardEntities.filter(r).length!==0&&e.entity.controller.canDraw)return Ee(e)},prepare:(e,t,i,n)=>xe(e,t,i,n,["SearchFromDeck"],[],void 0),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(r);if(t.length===0)return!1;const i=await e.action.entity.field.duel.view.waitSelectEntities(e.activator,t,1,n=>n.length===1,"手札に加えるカードを選択",!1);for(const n of i??[])await n.addToHand(["Effect"],e.action.entity,e.activator);return e.activator.shuffleDeck(),!0},settle:async()=>!0}),go=(r,e)=>({title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:t=>{if(!(t.entity.controller.getGraveyard().cardEntities.filter(r).length<e))return Ee(t)},prepare:(t,i,n,a)=>xe(t,i,n,a,["AddToHandFromGraveyard"],[],void 0),execute:async t=>{const i=t.activator.getGraveyard().cardEntities.filter(r);if(i.length===0)return!1;const n=await t.action.entity.field.duel.view.waitSelectEntities(t.activator,i,e,a=>a.length===e,"手札に加えるカードを選択",!1);for(const a of n??[])await a.addToHand(["Effect"],t.action.entity,t.activator);return!0},settle:async()=>!0}),mo=r=>({title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(e.entity.controller.getHandCell().cardEntities.filter(r).length!==0&&!(e.entity.controller.getDeckCell().cardEntities.length<2))return Ee(e)},prepare:async(e,t,i,n)=>{const a=e.entity.controller.discard(1,["Discard","Cost"],e.entity,e.entity.controller,r),s=xe(e,t,i,n,["SearchFromDeck"],[],void 0);return await Promise.all([a,s]),await s},execute:async e=>(await e.activator.draw(2,e.action.entity,e.activator),!0),settle:async()=>!0}),_o=r=>({title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Ee,prepare:(e,t,i,n)=>{const[a,s]=r(e.entity),o=[];return a<0&&o.push("DamageToSelf"),s<0&&o.push("DamageToOpponent"),xe(e,t,i,n,o,[],void 0)},execute:async e=>{const[t,i]=r(e.action.entity);return i>0?e.activator.getOpponentPlayer().heal(i,e.action.entity):i<0&&e.activator.getOpponentPlayer().effectDamage(Math.abs(i),e.action.entity),t>0?e.activator.heal(t,e.action.entity):t<0&&e.activator.effectDamage(Math.abs(t),e.action.entity),!0},settle:async()=>!0}),So=()=>{const r=[];return[{name:"増援",filter:e=>e.origin.kind==="Monster"&&e.types.includes("Warrior")&&(e.origin.level??5)<5},{name:"化石調査",filter:e=>e.origin.kind==="Monster"&&e.types.includes("Dinosaur")&&(e.origin.level??6)<6},{name:"Ｅ－エマージェンシーコール",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("Ｅ・ＨＥＲＯ")},{name:"召集の聖刻印",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("聖刻")},{name:"召喚師のスキル",filter:e=>e.origin.kind==="Monster"&&(e.origin.monsterCategories??[]).includes("Normal")&&(e.origin.level??4)>4},{name:"トゥーンのもくじ",filter:e=>(e.origin.nameTags??[]).includes("トゥーン")},{name:"融合賢者",filter:e=>e.origin.name==="融合"},{name:"虹の架け橋",filter:e=>e.origin.kind!=="Monster"&&(e.origin.nameTags??[]).includes("宝玉")},{name:"紫炎の狼煙",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("六武衆")&&(e.origin.level??4)<4},{name:"テラ・フォーミング",filter:e=>e.origin.kind==="Spell"&&e.origin.spellCategory==="Field"},{name:"コール・リゾネーター",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("リゾネーター")}].forEach(e=>{r.push({name:e.name,actions:[yo(e.filter),De]})}),[{name:"戦士の生還",filter:e=>e.status.kind==="Monster"&&e.types.includes("Warrior"),qty:1},{name:"ダーク・バースト",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Dark")&&(e.atk??9999)<=1500,qty:1},{name:"悪夢再び",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Dark")&&(e.def??9999)===0,qty:2},{name:"サルベージ",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Water")&&(e.atk??9999)<=1500,qty:2},{name:"バッテリーリサイクル",filter:e=>e.status.kind==="Monster"&&e.types.includes("Thunder")&&(e.atk??9999)<=1500,qty:2},{name:"闇の量産工場",filter:e=>e.status.kind==="Monster"&&(e.status.monsterCategories??[]).includes("Normal"),qty:2}].forEach(e=>{r.push({name:e.name,actions:[go(e.filter,e.qty),De]})}),[{name:"トレード・イン",filter:e=>e.status.kind==="Monster"&&(e.lvl??0)===8},{name:"調和の宝札",filter:e=>e.status.kind==="Monster"&&(e.origin.monsterCategories??[]).includes("Tuner")&&e.types.includes("Dragon")&&(e.atk??9999)<=1e3},{name:"デステニー・ドロー",filter:e=>e.status.kind==="Monster"&&(e.origin.nameTags??[]).includes("Ｄ－ＨＥＲＯ")}].forEach(e=>{r.push({name:e.name,actions:[mo(e.filter),De]})}),[{name:"火の粉",calcHeal:()=>[0,-200]},{name:"雷鳴",calcHeal:()=>[0,-300]},{name:"ファイヤー・ボール",calcHeal:()=>[0,-500]},{name:"火あぶりの刑",calcHeal:()=>[0,-600]},{name:"昼夜の大火事",calcHeal:()=>[0,-800]},{name:"火炎地獄",calcHeal:()=>[-500,-1e3]},{name:"盗人ゴブリン",calcHeal:()=>[500,-500]},{name:"ブルー・ポーション",calcHeal:()=>[400,0]},{name:"レッド・ポーション",calcHeal:()=>[500,0]},{name:"ゴブリンの秘薬",calcHeal:()=>[600,0]},{name:"天使の生き血",calcHeal:()=>[800,0]},{name:"治療の神 ディアン・ケト",calcHeal:()=>[1e3,0]},{name:"恵みの雨",calcHeal:()=>[1e3,1e3]}].forEach(e=>{r.push({name:e.name,actions:[_o(e.calcHeal),De]})}),r},bo=()=>{const r=[];return["大地の騎士ガイアナイト","スクラップ・デスデーモン"].forEach(e=>r.push({name:e,actions:[qe,Oe,vi()]})),r.push({name:"ナチュル・ガオドレイク",actions:[qe,Oe,vi(e=>e.length===1&&e.every(t=>t.attr.some(i=>i==="Earth")),e=>e.length>0&&e.every(t=>t.attr.some(i=>i==="Earth")))]}),r.push({name:"マジカル・アンドロイド",actions:[qe,Oe,vi(),{title:"回復",playType:"MandatoryIgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["end"],executableDuelistTypes:["Controller"],validate:e=>e.entity.counterHolder.getQty("①")===0&&e.entity.duel.phase==="end"&&e.entity.controller.isTurnPlayer&&e.entity.face==="FaceUp"?[]:void 0,prepare:e=>(e.entity.counterHolder.add("①"),pa()),execute:async e=>(e.activator.heal(e.activator.getMonstersOnField().filter(t=>t.face==="FaceUp").filter(t=>t.types.includes("Psychic")).length*600,e.action.entity),!0),settle:async()=>!0}]}),r},wo=()=>{const r=[];return[{name:"草原",up:["Warrior","BeastWarrior"],down:[]},{name:"森",up:["Insect","Plant","Beast","BeastWarrior"],down:[]},{name:"山",up:["Dragon","WingedBeast","Thunder"],down:[]},{name:"荒野",up:["Dinosaur","Zombie","Rock"],down:[]},{name:"海",up:["Aqua","SeaSerpent","Fish"],down:["Machine","Pyro"]},{name:"闇",up:["Fiend","Spellcaster"],down:["Fairy"]}].forEach(e=>{r.push({name:e.name,actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Ee,prepare:Mi,execute:async()=>!0,settle:async()=>!0},De],continuousEffects:[$r("発動","Spell",t=>t.isOnField&&t.face==="FaceUp",t=>["attack","defense"].flatMap(i=>["up","down"].map(n=>ct.createContinuous("発動",a=>a.isOnField&&a.face==="FaceUp",t,(a,s)=>s.isOnField&&s.face==="FaceUp"&&(s.status.monsterCategories??!1)&&e[n].union(s.types).length>0,i,"current","Addition",(a,s,o)=>!a.isEffective||s.face==="FaceDown"?o:o+(n==="up"?200:-200)))))]})}),[{name:"バーニングブラッド",attr:"Fire"},{name:"ウォーターワールド",attr:"Water"},{name:"ガイアパワー",attr:"Earth"},{name:"シャインスパーク",attr:"Light"},{name:"ダークゾーン",attr:"Dark"},{name:"デザートストーム",attr:"Wind"}].forEach(e=>{r.push({name:e.name,actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","FieldSpellZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Ee,prepare:Mi,execute:async()=>!0,settle:async()=>!0},De],continuousEffects:[$r("発動","Spell",t=>t.isOnField&&t.face==="FaceUp",t=>["attack","defense"].flatMap(i=>ct.createContinuous("発動",n=>n.isOnField&&n.face==="FaceUp",t,(n,a)=>a.isOnField&&a.face==="FaceUp"&&a.attr.includes(e.attr),i,"current","Addition",(n,a,s)=>!n.isEffective||a.face==="FaceDown"?s:s+(i==="attack"?500:-400))))]})}),r},To=()=>{const r=[],e={name:"連合軍",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Ee,prepare:Mi,execute:async()=>!0,settle:async()=>!0},De],continuousEffects:[$r("発動","Spell",t=>t.isOnField&&t.face==="FaceUp",t=>[ct.createContinuous("発動",i=>i.isOnField&&i.face==="FaceUp",t,(i,n)=>n.controller===i.controller&&n.types.includes("Warrior")&&n.isOnField&&n.face==="FaceUp","attack","current","Addition",(i,n,a)=>{if(!i.isEffective||n.face==="FaceDown")return a;const s=i.controller.getMonstersOnField().filter(o=>o.face==="FaceUp").filter(o=>o.types.includes("Warrior")||o.types.includes("Spellcaster")).length;return a+s*200})])]};return r.push(e),r},ko=()=>{const r=[];[{name:"団結の力",kind:["Monster"],rate:800},{name:"魔導師の力",kind:["Spell","Trap"],rate:500}].forEach(t=>{r.push({name:t.name,actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:i=>i.entity.field.getMonstersOnField().filter(a=>a.face==="FaceUp").filter(a=>a.canBeTargetOfEffect(i.entity.controller,i.entity,i)).length?Ee(i):void 0,prepare:async(i,n,a,s)=>{const o=i.entity.field.getMonstersOnField().filter(d=>d.face==="FaceUp").filter(d=>d.canBeTargetOfEffect(i.entity.controller,i.entity,i)),u=await i.entity.duel.view.waitSelectEntities(i.entity.controller,o,1,d=>d.length===1,"装備対象モンスターを選択",s);if(u)return i.entity.info.effectTargets.EquipTarget=u,await xe(i,n,a,!1,[],u,void 0)},execute:async()=>!0,settle:async()=>!0},De],continuousEffects:[Ai("EquipTarget","Spell",()=>!0,i=>[cr.createRegularEquipRelation("EquipTarget",()=>!0,i,{},()=>!0)]),ai(t.name,"Spell",i=>i.info.effectTargets.EquipTarget,i=>i.isOnField&&i.face==="FaceUp",i=>["attack","defense"].map(n=>ct.createContinuous("発動",a=>a.isOnField&&a.face==="FaceUp",i,(a,s)=>s.isOnField&&s.face==="FaceUp",n,"current","Addition",(a,s,o)=>{if(!a.isEffective)return o;const u=a.controller.getEntiteisOnField().filter(d=>t.kind.includes(d.status.kind)).length;return o+u*t.rate})))]})});const e={name:"早すぎた埋葬",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:t=>{if(t.entity.controller.getGraveyard().cardEntities.filter(i=>i.status.kind==="Monster").filter(i=>i.info.isRebornable).filter(i=>i.canBeTargetOfEffect(t.entity.controller,t.entity,t)).filter(i=>i.canBeSpecialSummoned("SpecialSummon",t.entity.controller,t.entity,t)).length!==0&&t.entity.controller.getAvailableMonsterZones().length!==0&&!(t.entity.controller.lp<800))return Ee(t)},prepare:async(t,i,n)=>{const a=await t.entity.field.duel.view.waitSelectEntities(t.entity.controller,t.entity.controller.getGraveyard().cardEntities.filter(s=>s.status.kind==="Monster").filter(s=>s.info.isRebornable).filter(s=>s.canBeTargetOfEffect(t.entity.controller,t.entity,t)).filter(s=>s.canBeSpecialSummoned("SpecialSummon",t.entity.controller,t.entity,t)),1,s=>s.length===1,"蘇生対象とするモンスターを選択",!1);if(!a)throw new Bt(t);return t.entity.controller.payLp(800,t.entity),t.entity.info.effectTargets.EquipTarget=a,await xe(t,i,n,!1,["SpecialSummonFromGraveyard","PayLifePoint"],a,void 0)},execute:async t=>{const i=t.activator.getEmptyMonsterZones(),n=t.selectedEntities[0];return await t.activator.summon(n,["Attack"],i,"SpecialSummon",["Effect"],t.action.entity,!1),!0},settle:async()=>!0},De],continuousEffects:[Ai("EquipTarget","Spell",()=>!0,t=>[cr.createRegularEquipRelation("EquipTarget",()=>!0,t,{},()=>!0,i=>(!i.target.isOnField||i.target.face==="FaceDown"||i.isSpawnedBy.moveLog.currentProcRecords.flatMap(n=>n.movedAs).find(n=>n==="Destroy")&&i.target.tryDestory("EffectDestroy",i.effectOwner,i.isSpawnedBy,{}),!0))])]};return r.push(e),r},Co=()=>{const r=[];return[{name:"伝説の剣",attr:void 0,monType:"Warrior",atk:200,def:200},{name:"秘術の書",attr:void 0,monType:"Spellcaster",atk:200,def:200},{name:"ポセイドンの力",attr:void 0,monType:"Aqua",atk:200,def:200},{name:"紫水晶",attr:void 0,monType:"Zombie",atk:200,def:200},{name:"猛獣の歯",attr:void 0,monType:"Beast",atk:200,def:200},{name:"機械改造工場",attr:void 0,monType:"Machine",atk:200,def:200},{name:"体温の上昇",attr:void 0,monType:"Reptile",atk:200,def:200},{name:"魔菌",attr:void 0,monType:"Plant",atk:200,def:200},{name:"闇・エネルギー",attr:void 0,monType:"Fiend",atk:200,def:200},{name:"レーザー砲機甲鎧",attr:void 0,monType:"Insect",atk:200,def:200},{name:"銀の弓矢",attr:void 0,monType:"Fairy",atk:200,def:200},{name:"電撃鞭",attr:void 0,monType:"Thunder",atk:200,def:200},{name:"ドラゴンの秘宝",attr:void 0,monType:"Dragon",atk:200,def:200},{name:"フォロー・ウィンド",attr:void 0,monType:"WingedBeast",atk:200,def:200},{name:"魔性の月",attr:void 0,monType:"BeastWarrior",atk:200,def:200},{name:"エルフの光",attr:"Light",monType:void 0,atk:400,def:-200},{name:"覚醒",attr:"Earth",monType:void 0,atk:400,def:-200},{name:"灼熱の槍",attr:"Fire",monType:void 0,atk:400,def:-200},{name:"突風の扇",attr:"Wind",monType:void 0,atk:400,def:-200},{name:"はがねの甲羅",attr:"Water",monType:void 0,atk:400,def:-200},{name:"闇の破神剣",attr:"Dark",monType:void 0,atk:400,def:-200},{name:"火器付機甲鎧",attr:void 0,monType:"Insect",atk:700,def:0},{name:"サラマンドラ",attr:"Fire",monType:void 0,atk:700,def:0},{name:"シャイン・キャッスル",attr:"Light",monType:void 0,atk:700,def:0}].forEach(e=>{r.push({name:e.name,actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:t=>t.entity.field.getMonstersOnField().filter(n=>n.face==="FaceUp").filter(n=>n.canBeTargetOfEffect(t.entity.controller,t.entity,t)).filter(n=>!e.attr||n.attr.includes(e.attr)).filter(n=>!e.monType||n.types.includes(e.monType)).length?Ee(t):void 0,prepare:async(t,i,n,a)=>{const s=t.entity.field.getMonstersOnField().filter(u=>u.face==="FaceUp").filter(u=>u.canBeTargetOfEffect(t.entity.controller,t.entity,t)).filter(u=>!e.attr||u.attr.includes(e.attr)).filter(u=>!e.monType||u.types.includes(e.monType)),o=await t.entity.duel.view.waitSelectEntities(t.entity.controller,s,1,u=>u.length===1,"装備対象モンスターを選択",a);if(o)return t.entity.info.effectTargets.EquipTarget=o,await xe(t,i,n,!1,[],o,void 0)},execute:async()=>!0,settle:async()=>!0},De],continuousEffects:[Ai("EquipTarget","Spell",()=>!0,t=>[cr.createRegularEquipRelation("EquipTarget",()=>!0,t,{},()=>!0)]),ai(e.name,"Spell",t=>t.info.effectTargets.EquipTarget,t=>t.isOnField&&t.face==="FaceUp",t=>{const i=[];return e.atk!==0&&i.push(["attack",e.atk]),e.def!==0&&i.push(["defense",e.def]),i.map(([n,a])=>ct.createContinuous("発動",s=>s.isOnField&&s.face==="FaceUp",t,(s,o)=>o.isOnField&&o.face==="FaceUp"&&(!e.monType||o.types.includes(e.monType))&&(!e.attr||o.attr.includes(e.attr)),n,"current","Addition",(s,o,u)=>s.isEffective?u+a:u))})]})}),r},Do=()=>{const r=[],e={name:"にせアバター",actions:[$e,qe,Oe],continuousEffects:[ai("THE_DEVILS_AVATAR","Monster",i=>[i],i=>i.isOnField&&i.face==="FaceUp",i=>["attack","defense"].map(n=>ct.createContinuous("THE_DEVILS_AVATAR",a=>a.isOnField&&a.face==="FaceUp",i,a=>a.isOnField&&a.face==="FaceUp",n,"current","THE_DEVILS_AVATAR",()=>Number.MIN_VALUE)))]};r.push(e);const t={name:"にせドレッド・ルート",actions:[$e,qe,Oe],continuousEffects:[$r("THE_DEVILS_DREAD-ROOT","Monster",i=>i.isOnField&&i.face==="FaceUp",i=>["attack","defense"].map(n=>ct.createContinuous("THE_DEVILS_DREAD-ROOT",a=>a.isOnField&&a.face==="FaceUp",i,(a,s)=>s.status.kind==="Monster"&&s.isOnField&&s.face==="FaceUp"&&s!==a,n,"current","THE_DEVILS_DREAD-ROOT",(a,s,o)=>Math.round(o/2))))]};return r.push(t),r},Eo=()=>{const r=[],e={name:"ご隠居の猛毒薬",actions:[De,{title:"発動",playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:at,executableDuelistTypes:["Controller"],validate:Ee,prepare:async(i,n,a,s)=>{const o=await i.entity.field.duel.view.waitSelectText([{seq:0,text:"●自分は１２００ＬＰ回復する。"},{seq:1,text:"●相手に８００ダメージを与える。"}],"使用する効果を選択",!1);if(o===void 0&&!s)throw new Bt(i);const u=[];return o===1&&u.push("DamageToOpponent"),xe(i,n,a,s,u,[],o??0)},execute:async i=>i.prepared===1?(i.activator.getOpponentPlayer().effectDamage(800,i.action.entity),!0):(i.activator.heal(1200,i.action.entity),!0),settle:async()=>!0}]};r.push(e);const t={name:"月の書",actions:[{title:"発動",playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:at,executableDuelistTypes:["Controller"],validate:i=>{if(i.entity.field.getMonstersOnField().filter(a=>a.canBeEffected(i.entity.controller,i.entity,i)).length)return Ee(i)},prepare:async(i,n,a,s)=>{const o=i.entity.field.getMonstersOnField().filter(d=>d.canBeEffected(i.entity.controller,i.entity,i)),u=await i.entity.duel.view.waitSelectEntities(i.entity.controller,o,1,d=>d.length===1,"対象とするモンスターを選択",s);if(u)return xe(i,n,a,s,[],[...u],void 0)},execute:async i=>{const n=i.selectedEntities[0];if(!n.isOnField||n.battlePosition==="Set")return!1;if(!n.canBeEffected(i.activator,i.action.entity,i.action)){i.activator.duel.log.info(`${n.toString()}は${i.action.entity.toString()}の効果を受けない。`);return}return await n.setBattlePosition("Set",["Effect"],i.action.entity,i.activator),!0},settle:async()=>!0},De]};return r.push(t),r},Ao=(r,e)=>{const t=`魔力充填可能(${e})`;return ql(t,r,i=>[i],()=>!0,i=>[new Zl(t,()=>!0,!0,i,{},(n,a)=>n===a,(n,a)=>(a.maxCounterQty.SpellCounter=e,a))])},xo=()=>{const r=[],e={name:"魔導戦士 ブレイカー",actions:[qe,Oe,$e,{title:"①魔力充填",playType:"MandatoryTriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:t=>{if(t.entity.hasBeenSummonedNow(["NormalSummon"]))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["IfNormarlSummonSucceed"],prepared:void 0}),execute:async t=>t.action.entity.face==="FaceDown"?!1:(t.action.entity.counterHolder.setQty("SpellCounter",1),!0),settle:async()=>!0},{title:"③魔法罠破壊",playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:t=>{if(!t.entity.counterHolder.getQty("SpellCounter"))return;const i=t.entity.field.getCells(...Lt).flatMap(n=>n.cardEntities).filter(n=>n.canBeTargetOfEffect(t.entity.controller,t.entity,t));if(i.length)return i.map(n=>n.fieldCell)},prepare:async(t,i,n,a)=>{let s=i==null?void 0:i.cardEntities[0];if(!s){const o=t.entity.field.getCells(...Lt).flatMap(d=>d.cardEntities).filter(d=>d.canBeTargetOfEffect(t.entity.controller,t.entity,t)),u=await t.entity.duel.view.waitSelectEntities(t.entity.controller,o,1,d=>d.length===1,"破壊する対象を選択。",a);if(!u||!u.length)return;s=u[0]}return{selectedEntities:[s],chainBlockTags:t.calcChainBlockTagsForDestroy([s]),prepared:void 0}},execute:async t=>{if(t.action.entity.counterHolder.getQty("SpellCounter"))return t.action.entity.counterHolder.remove("SpellCounter",1),await Yi.tryDestroy(t.selectedEntities,t),!0},settle:async()=>!0}],continuousEffects:[Ao("Monster",1),ai("②攻撃力上昇","Monster",t=>[t],()=>!0,t=>[ct.createContinuous("②攻撃力上昇",()=>!0,t,()=>!0,"attack","current","Addition",(i,n,a)=>i.isEffective?a+i.counterHolder.getQty("SpellCounter")*300:a)])]};return r.push(e),r},Po=()=>{const r=[...oo(),...ho(),...bo(),...vo(),...So(),...Eo(),...wo(),...To(),...ko(),...Co(),...Do(),...xo()],e=r.map(i=>i.name);console.info(e);const t=Object.values(Object.groupBy(e,i=>i)).filter(i=>((i==null?void 0:i.length)??2)>1).map(i=>i==null?void 0:i[0]);if(t.length>0)throw new Ae("カード定義重複",...t);return r},Sa=new Map;Po().forEach(r=>{Sa.set(r.name,r)});const Fi=Sa,Mo=Ca,Ze=Object.values(Mo).reduce((r,e)=>(r[e.name]=e,r),{}),he=class he{constructor(e,t){l(this,"id");l(this,"name");l(this,"description");l(this,"lastUsedAt");l(this,"cardNames");l(this,"getIllegalCardNames",()=>Array.from(new Set(this.cardNames.filter(e=>!Object.keys(Ze).includes(e)))));l(this,"getDisableCardNames",()=>Array.from(new Set(this.cardNames.filter(e=>!Object.keys(Ze).includes(e)))));l(this,"createCardInfos",()=>{const e=this.getIllegalCardNames();if(e.length>0)throw new Error(`存在しないカード名からデッキを生成しようとした。${e}`);return this.cardNames.map(t=>Ze==null?void 0:Ze[t]).filter(t=>t)});l(this,"copy",async()=>he.createNewDeck(this.name,this.description,this.cardNames));l(this,"updateTimestamp",async()=>{await he.tblHeader.update(this.id,e=>({...e,lastUsedAt:new Date}))});l(this,"saveDeckInfo",async e=>{const t=e??this;await he.tblHeader.update(this.id,a=>({...a,name:t.name,description:t.description,lastUsedAt:new Date}));const i=(await he.tblDetail.getAll()).filter(a=>a.deckId===this.id);console.log(t.cardNames),await he.tblDetail.delete(i.map(a=>a.id));const n=await he.tblDetail.insertMany(t.cardNames.map((a,s)=>({deckId:this.id,seq:s,name:a,description:""})));return console.log(n),new he(await he.tblHeader.get(this.id),n)});l(this,"delete",async()=>{await he.tblHeader.delete([this.id]);const e=(await he.tblDetail.getAll()).filter(t=>t.deckId===this.id);await he.tblDetail.delete(e.map(t=>t.id))});this.id=e.id,this.name=e.name,this.description=e.description,this.lastUsedAt=e.lastUsedAt,this.cardNames=t.filter(i=>i.deckId===this.id).map(i=>i.name)}};l(he,"idb"),l(he,"tblHeader"),l(he,"tblDetail"),l(he,"getAllDeckInfo",async e=>{if(e&&(he.idb=e),!he.idb)throw new Error("illegal argument: idb is undefined.");he.tblHeader||(he.tblHeader=new Fo(he.idb)),he.tblDetail||(he.tblDetail=new Bo(he.idb));const t=await he.tblHeader.getAll(),i=await he.tblDetail.getAll();return t.length?t.map(n=>new he(n,i)):[await he.prepareSampleDeck()]}),l(he,"createNewDeck",async(e,t,i)=>{const n=await he.tblHeader.insert({name:e,description:t,lastUsedAt:new Date}),a=await he.tblDetail.insertMany(i.map((s,o)=>({deckId:n.id,seq:o,name:s,description:""})));return new he(n,a)}),l(he,"prepareSampleDeck",async()=>await he.createNewDeck(Pr[0].name,Pr[0].description,Pr[0].cardNames));let qt=he;class Fo extends Vi{constructor(t){super(t,"TblDeckHeader");l(this,"_prepareInitialRecords",()=>[])}}class Bo extends Vi{constructor(t){super(t,"TblDeckDetail");l(this,"_prepareInitialRecords",()=>[])}}let qo=-1,ar=["成金ゴブリン","強欲な壺","天使の施し","トレード・イン","調和の宝札","死者蘇生","召喚師のスキル","サイバー・ドラゴン","Ｄ－ＨＥＲＯ ディアボリックガイ","マジカル・アンドロイド","ナチュル・ガオドレイク","スクラップ・デスデーモン","大地の騎士ガイアナイト","青眼の白龍","伝説の白石","トレード・イン","貪欲な壺"];ar=[...ar,...ar,...ar,"Ｅ－エマージェンシーコール","ライトロード・ビースト ウォルフ","増援","おろかな埋葬","闇の量産工場","戦士の生還","ジェネティック・ワーウルフ","ジョングルグールの幻術師","ゾンビーノ","フロストザウルス","しゃりの軍貫","チューン・ウォリアー","ガード・オブ・フレムベル","ギャラクシーサーペント","ハロハロ","ラブラドライドラゴン","守護竜ユスティア","Ｅ・ＨＥＲＯ クレイマン","Ｅ・ＨＥＲＯ スパークマン","Ｅ・ＨＥＲＯ ネオス","Ｅ・ＨＥＲＯ バーストレディ","Ｅ・ＨＥＲＯ フェザーマン"];const Pr=[{id:qo--,name:"サンプルデッキ１",description:"",lastUsedAt:new Date,cardNames:ar}];function Oo(r){const e=r-1;return e*e*e+1}function wn(r,e){for(const t in e)r[t]=e[t];return r}function No({fallback:r,...e}){const t=new Map,i=new Map;function n(s,o,u){const{delay:d=0,duration:f=E=>Math.sqrt(E)*30,easing:p=Oo}=wn(wn({},e),u),y=s.getBoundingClientRect(),c=o.getBoundingClientRect(),h=y.left-c.left,m=y.top-c.top,S=y.width/c.width,T=y.height/c.height,b=Math.sqrt(h*h+m*m),B=getComputedStyle(o),L=B.transform==="none"?"":B.transform,$=+B.opacity;return{delay:d,duration:typeof f=="function"?f(b):f,easing:p,css:(E,z)=>`
			   opacity: ${E*$};
			   transform-origin: top left;
			   transform: ${L} translate(${z*h}px,${z*m}px) scale(${E+(1-E)*S}, ${E+(1-E)*T});
		   `}}function a(s,o,u){return(d,f)=>(s.set(f.key,d),()=>{if(o.has(f.key)){const p=o.get(f.key);return o.delete(f.key),n(p,d,f)}return s.delete(f.key),r&&r(d,f,u)})}return[a(i,t,!1),a(t,i,!0)]}var Ro=C("<div></div>"),Lo=C('<div class="duel_card_row svelte-1kuignv"><div> </div> <div> </div></div>'),Ho=C('<div class="duel_card_row svelte-1kuignv"><div class="svelte-1kuignv"></div> <div class="svelte-1kuignv"> </div></div>'),$o=C('<div class="duel_card_row svelte-1kuignv"><div class="svelte-1kuignv"></div> <div class="svelte-1kuignv"> </div></div>'),Uo=C('<div class="duel_card_row svelte-1kuignv"><div> </div> <div> </div></div>'),jo=C('<div class="duel_card_row duel_card_detail svelte-1kuignv"><div class="svelte-1kuignv"> </div></div> <div class="duel_card_row duel_card_detail svelte-1kuignv"><div class="svelte-1kuignv"></div> <div class="svelte-1kuignv"><span> </span> / <span> </span></div></div>',1),Zo=C('<button><div class="duel_card duel_card_visible svelte-1kuignv"><div class="duel_card_row svelte-1kuignv" style="position:relative"><div class="svelte-1kuignv"> </div> <div class="svelte-1kuignv"></div> <!></div> <!> <!> <!></div></button>'),Go=C('<div class="duel_card duel_card_face_down duel_card_face_down_defense svelte-1kuignv"><div class="svelte-1kuignv"></div></div>'),Vo=C('<div class="duel_card duel_card_face_down svelte-1kuignv"><div class="svelte-1kuignv"></div></div>');function ft(r,e){Re(e,!1);let t=Se(e,"entity",8),i=Se(e,"state",8,"Disabled"),n=Se(e,"selectedList",28,()=>[]),a=Se(e,"isVisibleForcibly",8,!1),s=Se(e,"isWideMode",8,!1),o=Se(e,"actions",24,()=>[]),u=Se(e,"cardActionResolve",8),d=Se(e,"entitySelectResolve",8,()=>{}),f=Pe(!1),p=()=>{},y=Se(e,"qty",12,void 0);const c=V=>{ie(f,!1),y(V.qty),p=V.resolve};t().field.duel.view.onWaitStart.append(c);let h=Pe(!1);const m=()=>{if(i()!=="Disabled"&&i()==="Selectable"&&y()&&y()===1){if(n().some(V=>V.seq!==t().seq)){n([t()]);return}y()&&y()===1&&d()&&d()([t()])}},S=V=>{(t().face==="FaceUp"||t().owner===t().field.duel.duelists.Below&&(t().isUnderControl||a()))&&t().field.duel.view.showCardInfo(t(),V??"Normal")},T=()=>{if(S(),i()==="Disabled")return;if(i()==="Selectable"){ie(f,!v(f)),n(v(f)?[...n(),t()]:n().filter(K=>K!==t()));return}if(o().length===0)return;if(o().length===1){if(o()[0].dragAndDropOnly)return;if(u()){u()(o()[0]);return}p({action:o()[0]});return}const V=t().field.duel.view;V.modalController.selectAction(V,{title:"行動を選択。",actions:o(),cancelable:!0}).then(K=>{p({action:K})})},b=V=>{console.info("drag start",V,o()),t().field.duel.view.setDraggingActions(o()),ie(h,!0)},B=V=>{console.info("drag end",V,o()),t().field.duel.view.removeDraggingActions(),V.dataTransfer&&ie(h,!1)},L=()=>(S("Debug"),!1);ze();var $=ke(),E=ae($);{var z=V=>{var K=Zo(),ye=g(K),Te=g(ye),Me=g(Te),I=g(Me),k=_(Me,4);ve(k,1,()=>t().attr,fe,(q,R)=>{var U=Ro();M(()=>ge(U,`monster_attr ${v(R)??""} svelte-1kuignv`)),w(q,U)});var F=_(Te,2);{var Q=q=>{var R=Lo(),U=g(R),J=g(U),W=_(U,2),j=g(W);M((Y,H)=>{ge(U,$t(t().lvl!==t().origin.level?"different_from_its_origin":""),"svelte-1kuignv"),D(J,Y),ge(W,$t(t().rank!==t().origin.rank?"different_from_its_origin":""),"svelte-1kuignv"),D(j,H)},[()=>"★".repeat(t().lvl||0),()=>"☆".repeat(t().rank||0)],me),w(q,R)},re=q=>{var R=ke(),U=ae(R);{var J=j=>{var Y=Ho(),H=_(g(Y),2),ee=g(H);M(()=>D(ee,`${yr[t().status.spellCategory]??""}魔法`)),w(j,Y)},W=j=>{var Y=ke(),H=ae(Y);{var ee=N=>{var X=$o(),pe=_(g(X),2),P=g(pe);M(()=>D(P,`${gr[t().status.trapCategory]??""}罠`)),w(N,X)};Z(H,N=>{t().status.kind==="Trap"&&t().status.trapCategory&&N(ee)},!0)}w(j,Y)};Z(U,j=>{t().status.kind==="Spell"&&t().status.spellCategory?j(J):j(W,!1)},!0)}w(q,R)};Z(F,q=>{t().status.kind==="Monster"?q(Q):q(re,!1)})}var de=_(F,2);{var ue=q=>{var R=Uo(),U=g(R),J=g(U),W=_(U,2),j=g(W);M(()=>{ge(U,$t(t().psL!==t().origin.pendulumScaleL?"different_from_its_origin":""),"svelte-1kuignv"),D(J,`◀ ${t().psL??""}`),ge(W,$t(t().psR!==t().origin.pendulumScaleR?"different_from_its_origin":""),"svelte-1kuignv"),D(j,`${t().psR??""} ▶`)}),w(q,R)};Z(de,q=>{var R;(R=t().status.monsterCategories)!=null&&R.includes("Pendulum")&&q(ue)})}var O=_(de,2);{var G=q=>{var R=jo(),U=ae(R),J=g(U),W=g(J),j=_(U,2),Y=_(g(j),2),H=g(Y),ee=g(H),N=_(H,2),X=g(N);M((pe,P)=>{D(W,`${pe??""}
            ${P??""}`),ge(H,$t(t().atk!==t().origin.attack?"different_from_its_origin":""),"svelte-1kuignv"),D(ee,t().atk??"?"),ge(N,$t(t().def!==t().origin.defense?"different_from_its_origin":""),"svelte-1kuignv"),D(X,t().def??"?")},[()=>t().types.map(pe=>mr[pe]+(s()?ti[pe]:"")).join(),()=>{var pe;return(pe=t().status.monsterCategories)==null?void 0:pe.map(P=>hr[P]+(s()?ei[P]:"")).join()}],me),w(q,R)};Z(O,q=>{t().status.kind==="Monster"&&q(G)})}M(q=>{ge(K,`duel_card button_style_reset ${t().status.kind??""} ${q??""} ${(v(f)?"duel_card_selected":"")??""} ${i()??""} duel_card_${t().orientation??""} ${(v(h)?"isDragging":"")??""} ${(s()?"duel_card_wide":"")??""} duel_card_${t().face??""} ${(t().isOnField?"duel_card_is_on_field":"")??""} svelte-1kuignv`),Jt(K,"draggable",i()==="Draggable"),Jt(K,"title",t().nm),D(I,t().nm)},[()=>{var q;return((q=t().status.monsterCategories)==null?void 0:q.join(" "))||""}],me),Be("dragstart",K,b),Be("dragend",K,B),Be("click",K,T),Be("dblclick",K,m),Be("mouseenter",K,()=>S()),Be("contextmenu",K,L),w(V,K)},A=V=>{var K=ke(),ye=ae(K);{var Te=I=>{var k=Go();w(I,k)},Me=I=>{var k=Vo();w(I,k)};Z(ye,I=>{t().battlePosition==="Set"?I(Te):I(Me,!1)},!0)}w(V,K)};Z(E,V=>{t().face==="FaceUp"||a()||t().controller.duelistType==="Player"&&t().isUnderControl?V(z):V(A,!1)})}w(r,$),Le()}var Wo=C('<div class="phase_display svelte-1mupj1p"><span class="svelte-1mupj1p"> </span> </div>'),Yo=C('<div class="lifepoint_display svelte-1mupj1p"><div class="svelte-1mupj1p"> </div> <div class="svelte-1mupj1p"> </div></div>'),zo=(r,e,t)=>e(v(t)),Ko=C('<div class="svelte-1mupj1p"><button class="phase_button svelte-1mupj1p"> </button></div>'),Qo=C("<div><!></div>"),Jo=C('<div class="svelte-1mupj1p"><!></div>'),Xo=C("<div><!></div>"),Io=C("<!> <!> <!>",1),ec=C('<div style="position: absolute;" class="card_animation_receiver svelte-1mupj1p"><!></div>'),tc=C('<div style="position: absolute; display:flex;justify-content: center;" class="svelte-1mupj1p"><!></div>'),rc=C(" <!> 】",1),ic=C('<div style="position: absolute; bottom:0rem" class="svelte-1mupj1p"> <!></div>'),nc=C("<!> <!>",1),ac=C('<div class="badge svelte-1mupj1p"> </div>'),sc=C('<div class="card_animation_receiver svelte-1mupj1p"><!></div>'),lc=C("<!> <!> <!> <!>",1),oc=C('<td><div role="listitem"><!></div></td>');function cc(r,e){Re(e,!1);let t=Se(e,"view",8),i=Se(e,"row",8),n=Se(e,"column",8),a=Se(e,"selectedList",28,()=>[]),s=Pe(t().getCell(i(),n()));const o=()=>{ie(s,t().getCell(i(),n()))};v(s).onUpdate.append(o),t().onDuelUpdate.append(o),t().modalController.onUpdate.append(o);let u=Pe([]),d=()=>{},f;const p=k=>{ie(b,void 0),a().reset(),d=k.resolve,ie(u,k.enableActions),f=k.selectableEntities,k.entitiesValidator};t().onWaitStart.append(p);let y,c=Pe(!1);const h=k=>{y=k,ie(c,k.some(F=>{var Q;return(Q=F.validate(t().duel.chainBlockInfos))==null?void 0:Q.includes(v(s))})||!1),o()},m=()=>{y=void 0,ie(c,!1),o()};t().onDragStart.append(h),t().onDragEnd.append(m);const[S,T]=od;let b=Pe(void 0);const B=k=>{if(v(s)===k.to||v(s).entities.includes(k.entity)){ie(b,k);const F=k.resolve;ie(s,v(s)),setTimeout(()=>{ie(b,void 0),k.count++,k.count>1&&F()},600)}};t().onAnimation.append(B);const L=k=>{d({phaseChange:k})},$=()=>v(s).isStackCell&&v(s).entities.flatMap(k=>k.actions).filter(k=>v(u).map(F=>F.seq).some(F=>F===k.seq)).length>0,E=()=>{if(Ve(s,v(s).field.duel.view.infoBoardState="Log"),v(s).isStackCell){Ve(s,v(s).field.duel.view.infoBoardState="CellInfo"),Ve(s,v(s).field.duel.view.infoBoardCell=v(s)),v(s).field.duel.view.requireUpdate();const k=v(s).entities.flatMap(F=>F.actions).filter(F=>v(u).map(Q=>Q.seq).some(Q=>Q===F.seq));if(k.length){const F=v(s).field.duel.view;F.modalController.selectAction(F,{title:"カードを選択。",actions:k,cancelable:!0}).then(Q=>{d({action:Q})});return}}v(s).field.duel.view.requireUpdate(),console.info(v(s))},z=k=>{k.preventDefault(),k.dataTransfer&&(k.dataTransfer.dropEffect="move")},A=k=>{k.preventDefault(),console.info("drop",k,v(c),y),k.dataTransfer&&(k.dataTransfer.dropEffect="move");try{if(v(c)&&y)if(console.info(y,v(s)),y.length===1){const F=y[0].getClone();F.cell=v(s),d({action:F})}else y.length>1&&(v(s).field.duel.view.modalController.cancelAll(),v(s).field.duel.view.modalController.selectAction(v(s).field.duel.view,{title:"選択",actions:y,cancelable:!1}))}finally{t().removeDraggingActions()}},V=(...k)=>{if(t().waitMode==="Animation")return"Disabled";if(f&&f.find(re=>k.find(de=>re===de)))return"Selectable";if(!v(u)||v(u).length===0||t().waitMode!=="SelectFieldAction"||Object.values(t().modalController.states).some(re=>re==="Shown"))return"Disabled";const F=v(u).filter(re=>k.includes(re.entity));if(F.length===0)return"Disabled";if(F.length>1)return"Clickable";if(v(u)[0].playType==="RuleDraw")return"Draggable";if(v(s).isStackCell||F[0].entity!==k[0])return"Clickable";const Q=F[0].validate(t().duel.chainBlockInfos);return Q&&Q.length>0?"Draggable":"Clickable"};ze();var K=oc(),ye=g(K);ye.__click=E;var Te=g(ye);{var Me=k=>{var F=ke(),Q=ae(F);{var re=de=>{var ue=ke(),O=ae(ue);{var G=R=>{var U=Wo(),J=g(U),W=g(J),j=_(J,1,!0);M((Y,H)=>{D(W,Y),D(j,H)},[()=>String(v(s).field.duel.clock.turn).padStart(2,"0"),()=>v(s).field.duel.phase.toUpperCase()],me),w(R,U)},q=R=>{var U=ke(),J=ae(U);{var W=Y=>{var H=Yo(),ee=g(H),N=g(ee),X=_(ee,2),pe=g(X);M(()=>{D(N,v(s).field.duel.duelists.Above.lp),D(pe,v(s).field.duel.duelists.Below.lp)}),w(Y,H)},j=Y=>{var H=ke(),ee=ae(H);{var N=X=>{var pe=ke(),P=ae(pe);{var x=te=>{var le=ke(),oe=ae(le);{var ne=se=>{var Ce=ke(),He=ae(Ce);ve(He,1,()=>t().duel.nextPhaseList,fe,(mt,Ke)=>{var Qe=Ko(),Sr=g(Qe);Sr.__click=[zo,L,Ke];var si=g(Sr);M(li=>D(si,li),[()=>v(Ke).toUpperCase()],me),w(mt,Qe)}),w(se,Ce)};Z(oe,se=>{t().duel.isEnded||se(ne)})}w(te,le)};Z(P,te=>{t().waitMode==="SelectFieldAction"&&te(x)})}w(X,pe)};Z(ee,X=>{v(s).column===5&&X(N)},!0)}w(Y,H)};Z(J,Y=>{v(s).column===3?Y(W):Y(j,!1)},!0)}w(R,U)};Z(O,R=>{v(s).column===1?R(G):R(q,!1)})}w(de,ue)};Z(Q,de=>{v(s).row===3&&de(re)})}w(k,F)},I=k=>{var F=ke(),Q=ae(F);{var re=ue=>{var O=Io(),G=ae(O);{var q=W=>{var j=Qo(),Y=g(j);ft(Y,{get entity(){return v(b).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),M(()=>ge(j,`card_animation_receiver ${v(s).cellType??""} svelte-1mupj1p`)),Ut(1,j,()=>T,()=>({key:v(b).entity.seq})),w(W,j)};Z(G,W=>{v(b)&&v(b).entity&&v(b).to===v(s)&&v(b).index==="Top"&&W(q)})}var R=_(G,2);ve(R,1,()=>v(s).cardEntities,fe,(W,j)=>{var Y=ke(),H=ae(Y);{var ee=N=>{var X=Jo(),pe=g(X);const P=me(()=>V(v(j))),x=me(()=>v(u).filter(te=>te.entity===v(j)));ft(pe,{get entity(){return v(j)},get state(){return v(P)},get actions(){return v(x)},cardActionResolve:void 0,get selectedList(){return a()},set selectedList(te){a(te)},$$legacy:!0}),Ut(2,X,()=>S,()=>({key:v(j).seq})),w(N,X)};Z(H,N=>{(!v(b)||v(b).entity.seq!==v(j).seq)&&N(ee)})}w(W,Y)});var U=_(R,2);{var J=W=>{var j=Xo(),Y=g(j);ft(Y,{get entity(){return v(b).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),M(()=>ge(j,`card_animation_receiver ${v(s).cellType??""} svelte-1mupj1p`)),Ut(1,j,()=>T,()=>({key:v(b).entity.seq})),w(W,j)};Z(U,W=>{v(b)&&v(b).entity&&v(b).to===v(s)&&v(b).index==="Bottom"&&W(J)})}w(ue,O)},de=ue=>{var O=lc(),G=ae(O);{var q=H=>{var ee=ec(),N=g(ee);ft(N,{get entity(){return v(b).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),Ut(1,ee,()=>T,()=>({key:v(b).entity.seq})),w(H,ee)};Z(G,H=>{v(b)&&v(b).entity&&v(b).to===v(s)&&v(b).index==="Bottom"&&H(q)})}var R=_(G,2);{var U=H=>{var ee=nc(),N=ae(ee);ve(N,1,()=>v(s).cardEntities.toReversed(),fe,(P,x,te)=>{var le=ke(),oe=ae(le);{var ne=se=>{var Ce=tc(),He=g(Ce);const mt=me(()=>te===0&&!v(s).isStackCell?V(...v(s).cardEntities):void 0),Ke=me(()=>te===0?v(u).filter(Qe=>v(s).cardEntities.includes(Qe.entity)):void 0);ft(He,{get entity(){return v(x)},get state(){return v(mt)},get actions(){return v(Ke)},cardActionResolve:void 0,get selectedList(){return a()},set selectedList(Qe){a(Qe)},$$legacy:!0}),Ut(2,Ce,()=>S,()=>({key:v(x).seq})),w(se,Ce)};Z(oe,se=>{(!v(b)||v(b).entity.seq!==v(x).seq)&&se(ne)})}w(P,le)});var X=_(N,2);{var pe=P=>{var x=ic(),te=g(x),le=_(te);ve(le,1,()=>Object.keys(v(s).cardEntities[0].status.maxCounterQty),fe,(oe,ne)=>{var se=rc(),Ce=ae(se),He=_(Ce);{var mt=Ke=>{var Qe=xt();M(()=>D(Qe,`/${v(s).cardEntities[0].status.maxCounterQty[v(ne)]??""}`)),w(Ke,Qe)};Z(He,Ke=>{(v(s).cardEntities[0].status.maxCounterQty[v(ne)]??!1)&&Ke(mt)})}M(Ke=>D(Ce,`【
              ${Hl[v(ne)]??""}${Ke??""} `),[()=>v(s).cardEntities[0].counterHolder.getQty(v(ne))],me),w(oe,se)}),M(()=>D(te,`【${v(s).cardEntities[0].battlePositionName??""}】 `)),w(P,x)};Z(X,P=>{v(s).cardEntities[0].battlePosition&&P(pe)})}w(H,ee)};Z(R,H=>{v(s).cardEntities.length>0&&H(U)})}var J=_(R,2);{var W=H=>{var ee=ac(),N=g(ee);M(()=>D(N,v(s).cardEntities.length)),w(H,ee)};Z(J,H=>{v(s).isStackCell&&H(W)})}var j=_(J,2);{var Y=H=>{var ee=sc(),N=g(ee);ft(N,{get entity(){return v(b).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),Ut(1,ee,()=>T,()=>({key:v(b).entity.seq})),w(H,ee)};Z(j,H=>{v(b)&&v(b).entity&&v(b).to===v(s)&&v(b).index==="Top"&&H(Y)})}w(ue,O)};Z(Q,ue=>{v(s).cellType==="Hand"?ue(re):ue(de,!1)},!0)}w(k,F)};Z(Te,k=>{v(s).cellType==="Disable"?k(Me):k(I,!1)})}M(k=>{ge(K,`${`duel_field_cell duel_field_cell_${v(s).cellType}`??""} svelte-1mupj1p`),Jt(K,"colspan",v(s).cellType==="Hand"?7:1),ge(ye,`${k??""} svelte-1mupj1p`)},[()=>`duel_card_wrapper ${v(s).cellType} ${v(c)?"can_accept_drop":""} ${$()?"can_action":""}`],me),Be("dragover",ye,k=>z(k)),Be("drop",ye,k=>A(k)),w(r,K),Le()}pr(["click"]);var dc=C('<tr><td style=" white-space: nowrap;text-align: center;"> </td><td class="svelte-13svkzh"> </td></tr>'),uc=C('<div class="duel_log svelte-13svkzh"><table><tbody></tbody></table></div>');function fc(r,e){var u,d;Re(e,!1);let t=Pe(void 0),i=Se(e,"log",12);const n=()=>{i(i()),Ts().then(()=>v(t)&&v(t).scroll(0,v(t).clientHeight*10))};(d=(u=i())==null?void 0:u.onUpdate)==null||d.append(n),ze();var a=uc(),s=g(a),o=g(s);ve(o,5,()=>i().records,fe,(f,p)=>{var y=dc(),c=g(y),h=g(c),m=_(c),S=g(m);M(()=>{var T,b;ge(c,`duelist ${((T=v(p).duelist)==null?void 0:T.seat)??""} svelte-13svkzh`),D(h,((b=v(p).duelist)==null?void 0:b.profile.name)||"SYSTEM"),D(S,v(p).text)}),w(f,y)}),Qs(a,f=>ie(t,f),()=>v(t)),w(r,a),Le()}var vc=C('<div><div class="duelist_name svelte-12u0sqq"> </div> <div> </div></div>');function Tn(r,e){Re(e,!1);let t=Se(e,"duelist",12),i=Pe(0),n=Pe();const a=async()=>{const y=t().lp-v(i);if(!v(n)||Math.abs(y)<10){ie(i,t().lp),v(n)&&(v(n)(),ie(n,void 0));return}ie(i,v(i)+Math.floor(Math.random()*y)),await Ql(100),a()},s=()=>{t(t()),!v(n)&&t().lp!==v(i)&&new Promise(y=>{ie(n,y),Math.abs(t().lp-v(i)),a()})};t().duel.log.onUpdate.append(s),a(),ze();var o=vc(),u=g(o),d=g(u),f=_(u,2),p=g(f);M(()=>{ge(o,`duelist ${t().seat??""} svelte-12u0sqq`),D(d,t().profile.name),ge(f,`duelist_lp ${(v(n)?"vibration":"")??""} svelte-12u0sqq`),D(p,v(i))}),w(r,o),Le()}const pc=()=>{};var hc=C("<div><!></div>"),yc=C("<div></div>"),gc=(r,e,t)=>e.resolve(v(t)),mc=(r,e)=>e.resolve(void 0),_c=C('<button class="svelte-1h1of0m">Cancel</button>'),Sc=C('<div class="base svelte-1h1of0m"><button class="overlay svelte-1h1of0m">☆</button> <div class="window svelte-1h1of0m"><div> </div> <!> <div><button class="svelte-1h1of0m">OK</button> <!></div></div></div>');function bc(r,e){Re(e,!0);let t=ns(St([]));var i=ke(),n=ae(i);{var a=s=>{var o=Sc(),u=g(o);u.__click=[pc];var d=_(u,2),f=g(d),p=g(f),y=_(f,2);ve(y,17,()=>e.entities.map(T=>T.controller.seat).getDistinct(),fe,(T,b)=>{var B=yc();ve(B,21,()=>e.entities.filter(L=>L.controller.seat===v(b)).toSorted(_a),fe,(L,$)=>{var E=hc(),z=g(E);ft(z,{get entity(){return v($)},isVisibleForcibly:!0,state:"Selectable",entitySelectResolve:A=>e.resolve(A),get qty(){return e.qty},cardActionResolve:void 0,get selectedList(){return v(t)},set selectedList(A){ie(t,St(A))}}),w(L,E)}),M(()=>ge(B,`entities_list ${v(b)??""} svelte-1h1of0m`)),w(T,B)});var c=_(y,2),h=g(c);h.__click=[gc,e,t];var m=_(h,2);{var S=T=>{var b=_c();b.__click=[mc,e],w(T,b)};Z(m,T=>{e.cancelable&&T(S)})}M(T=>{D(p,e.title),h.disabled=T},[()=>!e.validator(v(t))]),w(s,o)};Z(n,s=>{s(a)})}w(r,i),Le()}pr(["click"]);const wc=(r,e)=>{e.cancelable&&e.resolve(void 0)};var Tc=C('<div class="duel_card_wrapper svelte-11mc7y0"><!> <div> </div></div>'),kc=(r,e)=>e.resolve(),Cc=C('<div><button class="cancel_button svelte-11mc7y0">Cancel</button></div>'),Dc=C('<div><button>★</button> <div><div> </div> <div class="flex svelte-11mc7y0"></div> <!></div></div>');function Ec(r,e){Re(e,!0);const[t,i]=el(),n=()=>Is(a,"$isDragging",t);let a=Js(!1);const s=()=>a.set(!0),o=()=>a.set(!1);e.view.onDragStart.append(s),e.view.onDragEnd.append(o);const u=y=>{const c=y.validate(e.view.duel.chainBlockInfos);return c&&c.length>0?"Draggable":"Clickable"};var d=ke(),f=ae(d);{var p=y=>{var c=Dc(),h=g(c);h.__click=[wc,e];var m=_(h,2),S=g(m),T=g(S),b=_(S,2);ve(b,21,()=>e.actions,fe,($,E)=>{var z=Tc(),A=g(z);const V=Ot(()=>u(v(E))),K=Ot(()=>e.dragAndDropOnly?[]:[v(E)]);ft(A,{get entity(){return v(E).entity},isVisibleForcibly:!0,get state(){return v(V)},get actions(){return v(K)},get cardActionResolve(){return e.resolve}});var ye=_(A,2),Te=g(ye);M(()=>D(Te,`«${v(E).title??""}»`)),w($,z)});var B=_(b,2);{var L=$=>{var E=Cc(),z=g(E);z.__click=[kc,e],w($,E)};Z(B,$=>{e.cancelable&&$(L)})}M(()=>{ge(c,`${`base ${n()?"minimum_mode":""}`??""} svelte-11mc7y0`),ge(h,`${`overlay ${n()?"minimum_mode":""}`??""} svelte-11mc7y0`),ge(m,`${`window ${n()?"minimum_mode":""}`??""} svelte-11mc7y0`),D(T,e.title)}),w(y,c)};Z(f,y=>{y(p)})}w(r,d),Le(),i()}pr(["click"]);const Ac=(r,e,t,i)=>{e().cancelable&&(t()(void 0),ie(i,!1))};var xc=(r,e,t)=>e()(t()),Pc=C("<li><button> </button></li>"),Mc=(r,e)=>e()(void 0),Fc=C("<button>Cancel</button>"),Bc=C('<div class="base svelte-1103gpy"><button class="overlay svelte-1103gpy">★</button> <div class="window svelte-1103gpy"><div> </div> <ui class="text_list svelte-1103gpy"></ui> <!></div></div>');function qc(r,e){Re(e,!1);let t=Se(e,"arg",8),i=Se(e,"resolve",8),n=Pe(!0);ze();var a=ke(),s=ae(a);{var o=u=>{var d=Bc(),f=g(d);f.__click=[Ac,t,i,n];var p=_(f,2),y=g(p),c=g(y),h=_(y,2);ve(h,5,()=>t().choises,fe,(T,b)=>{let B=()=>v(b).seq,L=()=>v(b).text;var $=Pc(),E=g($);E.__click=[xc,i,B];var z=g(E);M(()=>{ge($,`text_item ${B()??""} svelte-1103gpy`),D(z,L())}),w(T,$)});var m=_(h,2);{var S=T=>{var b=Fc();b.__click=[Mc,i],w(T,b)};Z(m,T=>{t().cancelable&&T(S)})}M(()=>D(c,t().title)),w(u,d)};Z(s,u=>{v(n)&&u(o)})}w(r,a),Le()}pr(["click"]);var Oc=C('<div class="base svelte-1y912d"><!> <!> <!></div>');function Nc(r,e){var p,y;Re(e,!1);let t=Se(e,"modalController",12);const i=()=>{t(t())};(y=(p=t())==null?void 0:p.onUpdate)==null||y.append(i),ze();var n=Oc(),a=g(n);{var s=c=>{bc(c,{get title(){return t().duelEntitiesSelectorArg.title},get entities(){return t().duelEntitiesSelectorArg.entities},get validator(){return t().duelEntitiesSelectorArg.validator},get qty(){return t().duelEntitiesSelectorArg.qty},get cancelable(){return t().duelEntitiesSelectorArg.cancelable},resolve:h=>{t().duelEntitiesSelectorResolve(h)}})};Z(a,c=>{t().states.DuelEntitiesSelector==="Shown"&&c(s)})}var o=_(a,2);{var u=c=>{const h=me(()=>t().cardActionSelectorArg.dragAndDropOnly??!1);Ec(c,{get view(){return t().view},get title(){return t().cardActionSelectorArg.title},get actions(){return t().cardActionSelectorArg.actions},get dragAndDropOnly(){return v(h)},get cancelable(){return t().cardActionSelectorArg.cancelable},resolve:m=>{console.info(m),t().cardActionSelectorResolve(m)}})};Z(o,c=>{t().states.DuelActionSelector==="Shown"&&c(u)})}var d=_(o,2);{var f=c=>{qc(c,{get arg(){return t().duelTextSelectorArg},resolve:h=>{console.info(h),t().duelTextSelectorResolve(h)}})};Z(d,c=>{t().states.DuelTextSelector==="Shown"&&c(f)})}w(r,n),Le()}const Rc=(r,e)=>(e(e()==="Normal"?"Debug":"Normal"),!0);var Lc=C('<div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"><pre class="description svelte-nn7bjy"> </pre></div></div> <div class="duel_card_info_row svelte-nn7bjy" style=" justify-content: space-between;"><div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"> </div></div>',1),Hc=C('<div></div> <div class="svelte-nn7bjy"> </div>',1),$c=C("<div> </div>"),Uc=C("<div> </div>"),jc=C('<div class="duel_card_info_row svelte-nn7bjy"><!> <!></div> <div class="duel_card_info_row svelte-nn7bjy"></div>',1),Zc=C('<div class="duel_card_row svelte-nn7bjy"><div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"> </div></div>'),Gc=C('<div class="duel_card_row svelte-nn7bjy"><div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"> </div></div>'),Vc=C("<!> <!>",1),Wc=C('<div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"><pre class="description svelte-nn7bjy"> </pre></div></div>'),Yc=C('<div class="svelte-nn7bjy"> </div>'),zc=C('<div class="svelte-nn7bjy"> </div>'),Kc=C('<div class="svelte-nn7bjy"> </div>'),Qc=C('<div class="svelte-nn7bjy"> </div>'),Jc=C('<div class="svelte-nn7bjy"> </div>'),Xc=C('<div class="svelte-nn7bjy"> </div>'),Ic=C('<div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"><pre class="json svelte-nn7bjy"> </pre> <pre class="json svelte-nn7bjy"> </pre> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div></div></div>'),ed=C('<div class="svelte-nn7bjy">※テスト用カードです</div>'),td=C('<div class="duel_card_info_links svelte-nn7bjy"><a target="_blank" rel="noopener noreferrer" title="遊戯王カードWiki" class="svelte-nn7bjy">⇒遊戯王カードWiki</a> <a target="_blank" rel="noopener noreferrer" title="コナミカードデータベース" class="svelte-nn7bjy"> </a></div>'),rd=C('<div role="contentinfo"><div class="duel_card_info_header svelte-nn7bjy"><div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"> </div></div> <div class="duel_card_info_row svelte-nn7bjy" style="position:sticky; top:0;"><div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"> </div></div> <!></div> <div class="duel_card_info_body svelte-nn7bjy"><!></div> <div class="duel_card_info_footer svelte-nn7bjy"><!></div></div>');function id(r,e){Re(e,!1);let t=Se(e,"entity",8,void 0);const i=()=>t()?Ze[t().origin.name]:void 0,n=()=>{var d;return t()&&(t().origin.cardId??!1)?`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=2&cid=${t().origin.cardId}`:`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=1&sess=1&rp=10&mode=&sort=1&keyword=${(d=i())==null?void 0:d.name}&stype=1&ctype=&othercon=2&starfr=&starto=&pscalefr=&pscaleto=&linkmarkerfr=&linkmarkerto=&link_m=2&atkfr=&atkto=&deffr=&defto=&releaseDStart=1&releaseMStart=1&releaseYStart=1999&releaseDEnd=&releaseMEnd=&releaseYEnd=`};let a=Se(e,"mode",12,"Normal");ze();var s=ke(),o=ae(s);{var u=d=>{var f=rd();f.__contextmenu=[Rc,a];var p=g(f),y=g(p),c=g(y),h=g(c),m=_(y,2),S=g(m),T=g(S),b=_(S,2),B=g(b),L=_(m,2);{var $=I=>{var k=Vc(),F=ae(k);{var Q=O=>{var G=Lc(),q=ae(G),R=g(q),U=g(R),J=g(U),W=_(q,2),j=g(W),Y=g(j),H=_(j,2),ee=g(H);M(()=>{D(J,Ze[t().origin.name].pendulumDescription),D(Y,`◀ ${t().psL??""}`),D(ee,`${t().psR??""} ▶`)}),w(O,G)};Z(F,O=>{var G;(G=t().status.monsterCategories)!=null&&G.includes("Pendulum")&&O(Q)})}var re=_(F,2);{var de=O=>{var G=jc(),q=ae(G),R=g(q);ve(R,1,()=>t().attr,fe,(W,j)=>{var Y=Hc(),H=ae(Y),ee=_(H,2),N=g(ee);M(()=>{ge(H,`monster_attr ${v(j)??""} svelte-nn7bjy`),D(N,`${Wi[v(j)]??""}属性`)}),w(W,Y)});var U=_(R,2);ve(U,1,()=>t().types,fe,(W,j)=>{var Y=$c(),H=g(Y);M(()=>{ge(Y,`monster_cat ${v(j)??""} svelte-nn7bjy`),D(H,`${mr[v(j)]??""}${ti[v(j)]??""}族`)}),w(W,Y)});var J=_(q,2);ve(J,5,()=>t().status.monsterCategories??[],fe,(W,j)=>{var Y=Uc(),H=g(Y);M(()=>{ge(Y,`monster_cat ${v(j)??""} svelte-nn7bjy`),D(H,`${hr[v(j)]??""}${ei[v(j)]??""}`)}),w(W,Y)}),w(O,G)},ue=O=>{var G=ke(),q=ae(G);{var R=J=>{var W=Zc(),j=_(g(W),2),Y=g(j);M(()=>D(Y,`${yr[t().status.spellCategory]??""}魔法`)),w(J,W)},U=J=>{var W=ke(),j=ae(W);{var Y=H=>{var ee=Gc(),N=_(g(ee),2),X=g(N);M(()=>D(X,`${gr[t().status.trapCategory]??""}罠`)),w(H,ee)};Z(j,H=>{t().status.kind==="Trap"&&t().status.trapCategory&&H(Y)},!0)}w(J,W)};Z(q,J=>{t().status.kind==="Spell"&&t().status.spellCategory?J(R):J(U,!1)},!0)}w(O,G)};Z(re,O=>{t().status.kind==="Monster"?O(de):O(ue,!1)})}w(I,k)};Z(L,I=>{a()==="Normal"&&I($)})}var E=_(p,2),z=g(E);{var A=I=>{var k=Wc(),F=g(k),Q=g(F),re=g(Q);M(de=>D(re,de),[()=>{var de;return(de=i())==null?void 0:de.description}],me),w(I,k)},V=I=>{var k=Ic(),F=g(k),Q=g(F),re=g(Q),de=_(Q,2),ue=g(de),O=_(de,2);O.textContent='"actions" :[';var G=_(O,2);ve(G,1,()=>t().actions,fe,(oe,ne)=>{var se=Yc(),Ce=g(se);M(()=>D(Ce,`"${v(ne).playType??""} ${v(ne).title??""}",`)),w(oe,se)});var q=_(G,2);q.textContent="],";var R=_(q,2);R.textContent='"continuousEffects" :[';var U=_(R,2);ve(U,1,()=>t().continuousEffects,fe,(oe,ne)=>{var se=zc(),Ce=g(se);M(()=>D(Ce,`"${v(ne).isStarted??""}",`)),w(oe,se)});var J=_(U,2);J.textContent="],";var W=_(J,2);W.textContent='"procFilters" :[';var j=_(W,2);ve(j,1,()=>t().procFilterBundle.operators,fe,(oe,ne)=>{var se=Kc(),Ce=g(se);M(He=>D(Ce,`"${He??""} ${v(ne).title??""}",`),[()=>v(ne).isSpawnedBy.toString()],me),w(oe,se)});var Y=_(j,2);Y.textContent="],";var H=_(Y,2);H.textContent='"cardRelations" :[';var ee=_(H,2);ve(ee,1,()=>t().cardRelationBundle.operators,fe,(oe,ne)=>{var se=Qc(),Ce=g(se);M(He=>D(Ce,`"${He??""} ${v(ne).title??""}",`),[()=>v(ne).isSpawnedBy.toString()],me),w(oe,se)});var N=_(ee,2);N.textContent="],";var X=_(N,2);X.textContent='"numericStateOperators" :[';var pe=_(X,2);ve(pe,1,()=>t().numericOprsBundle.operators,fe,(oe,ne)=>{var se=Jc(),Ce=g(se);M(He=>D(Ce,`"${He??""} ${v(ne).title??""}",`),[()=>v(ne).isSpawnedBy.toString()],me),w(oe,se)});var P=_(pe,2);P.textContent="],";var x=_(P,2);x.textContent='"stateOperators" :[';var te=_(x,2);ve(te,1,()=>t().statusOperatorBundle.operators,fe,(oe,ne)=>{var se=Xc(),Ce=g(se);M(He=>D(Ce,`"${He??""} ${v(ne).title??""}",`),[()=>v(ne).isSpawnedBy.toString()],me),w(oe,se)});var le=_(te,2);le.textContent="],",M((oe,ne)=>{D(re,`"info" :${oe??""},`),D(ue,`"status" :${ne??""},`)},[()=>JSON.stringify(t().info,null,2),()=>JSON.stringify(t().status,null,2)],me),w(I,k)};Z(z,I=>{a()==="Normal"?I(A):I(V,!1)})}var K=_(E,2),ye=g(K);{var Te=I=>{var k=ed();w(I,k)},Me=I=>{var k=td(),F=g(k),Q=_(F,2),re=g(Q);M(de=>{var ue;Jt(F,"href",`https://yugioh-wiki.net/index.php?${t().origin.wikiEncodedName}`),Jt(Q,"href",de),D(re,`⇒${((ue=t())!=null&&ue.origin.cardId?"公式カードページ":"公式で検索")??""}`)},[n],me),w(I,k)};Z(ye,I=>{var k;(k=t())!=null&&k.origin.isForTest?I(Te):I(Me,!1)})}M((I,k,F)=>{ge(f,`duel_card duel_card_info ${t().origin.kind??""} ${I??""} svelte-nn7bjy`),D(h,t().nm),D(T,k),D(B,F)},[()=>{var I;return(I=t().origin.monsterCategories)==null?void 0:I.join(" ")},()=>"★".repeat(t().lvl||0),()=>"☆".repeat(t().rank||0)],me),w(d,f)};Z(o,d=>{t()&&d(u)})}w(r,s),Le()}pr(["contextmenu"]);var nd=C('<div class="duel_field_cell_info_item svelte-1xj7qf1"><!></div>'),ad=C('<div class="duel_field_cell_info_box svelte-1xj7qf1"><div class="duel_field_cell_info_label svelte-1xj7qf1"> </div> <!></div>'),sd=C('<div class="duel_field_cell_info svelte-1xj7qf1"><div class="duel_field_cell_info_header item_btn svelte-1xj7qf1"><div class="svelte-1xj7qf1"> </div> <div class="svelte-1xj7qf1"> </div></div> <div class="duel_field_cell_info_body svelte-1xj7qf1"></div></div>');function ld(r,e){Re(e,!1);let t=Se(e,"cell",12);const i=()=>{t(t())},n=y=>t().cardEntities.filter(c=>c.face===y);t().field.duel.view.onDuelUpdate.append(i),ze();var a=sd(),s=g(a),o=g(s),u=g(o),d=_(o,2),f=g(d),p=_(s,2);ve(p,4,()=>["FaceUp","FaceDown"],fe,(y,c)=>{var h=ke(),m=ae(h);{var S=T=>{var b=ad(),B=g(b),L=g(B),$=_(B,2);ve($,1,()=>n(c).toSorted(_a),fe,(E,z)=>{var A=nd(),V=g(A);const K=me(()=>t().owner===t().field.duel.duelists.Below);ft(V,{get entity(){return v(z)},get isVisibleForcibly(){return v(K)},isWideMode:!0,cardActionResolve:void 0}),w(E,A)}),M(()=>D(L,c==="FaceUp"?"表向き":"裏向き")),w(T,b)};Z(m,T=>{n(c).length&&T(S)})}w(y,h)}),M(()=>{var y;D(u,(y=t().owner)==null?void 0:y.profile.name),D(f,t().cellType)}),w(r,a),Le()}const od=No({duration:400});var cd=C('<div class="duel_field_header_message svelte-accyye"> </div> <div class="duel_field_header_buttons svelte-accyye"><button class="svelte-accyye">サレンダー</button></div>',1),dd=C("<tr></tr>"),ud=C('<table class="duel_field svelte-accyye"><tbody class="svelte-accyye"></tbody></table>'),fd=C('<button class="svelte-accyye">OK</button>'),vd=C('<div style="position:absolute;right:0;top:0"> </div> <div class="flex duel_desk svelte-accyye"><div class="duel_desk_left v_flex svelte-accyye"><!> <!> <!></div> <div class=" duel_desk_center v_flex svelte-accyye"><div class="duel_field_header svelte-accyye"><!></div> <div class="svelte-accyye"><!></div> <div class="duel_field_footer svelte-accyye"><!></div></div> <div class=" duel_desk_right svelte-accyye" style="text-align: left;"><!></div></div> <!>',1);function pd(r,e){Re(e,!1);let t=Se(e,"duel",12),i=()=>{},n=Pe(()=>!0),a=Pe();const s=O=>{i=O.resolve,ie(n,O.entitiesValidator),ie(a,O.selectableEntities),O.duelEntitiesSelectorArg&&t().view.modalController.selectDuelEntities(O.duelEntitiesSelectorArg).then(G=>{i({selectedEntities:G})})};t().view.onWaitStart.append(s);let o=Pe(void 0),u=Pe("Normal");const d=({card:O,mode:G})=>{ie(o,O),ie(u,G)};t().view.onShowCardEntity.append(d);let f=Se(e,"selectedList",28,()=>[]);const p=()=>{t(t())};t().view.onDuelUpdate.append(p);const y=()=>{v(n)(f())&&i({selectedEntities:f()})},c=()=>{i({surrender:!0})};t().main(),ze();var h=vd(),m=ae(h),S=g(m),T=_(m,2),b=g(T),B=g(b);Tn(B,{get duelist(){return t().duelists.Above}});var L=_(B,2);id(L,{get entity(){return v(o)},get mode(){return v(u)}});var $=_(L,2);Tn($,{get duelist(){return t().duelists.Below}});var E=_(b,2),z=g(E),A=g(z);{var V=O=>{var G=cd(),q=ae(G),R=g(q),U=_(q,2),J=g(U);M(()=>D(R,`[TURN:${t().clock.turn}][PHASE:${t().phase}] ${t().view.message}`)),Be("click",J,c),w(O,G)};Z(A,O=>{t().isEnded||O(V)})}var K=_(z,2),ye=g(K);{var Te=O=>{var G=ud(),q=g(G);ve(q,5,()=>t().field.cells,fe,(R,U,J)=>{var W=dd();ge(W,`${`duel_desk_row_${J}`??""} svelte-accyye`),ve(W,5,()=>v(U),fe,(j,Y,H)=>{cc(j,{get view(){return t().view},row:J,column:H,get selectedList(){return f()},set selectedList(ee){f(ee)},$$legacy:!0})}),w(R,W)}),w(O,G)};Z(ye,O=>{t().clock.turn>0&&O(Te)})}var Me=_(K,2),I=g(Me);{var k=O=>{var G=fd();M(q=>G.disabled=q,[()=>!v(n)(f())],me),Be("click",G,y),w(O,G)};Z(I,O=>{v(a)&&v(a).length>0&&O(k)})}var F=_(E,2),Q=g(F);{var re=O=>{fc(O,{get log(){return t().log}})},de=O=>{var G=ke(),q=ae(G);{var R=U=>{ld(U,{get cell(){return t().view.infoBoardCell}})};Z(q,U=>{t().view.infoBoardState==="CellInfo"&&U(R)},!0)}w(O,G)};Z(Q,O=>{t().view.infoBoardState==="Log"?O(re):O(de,!1)})}var ue=_(T,2);Nc(ue,{get modalController(){return t().view.modalController}}),M(O=>D(S,O),[()=>t().clock.toString()],me),w(r,h),Le()}var hd=C("<div></div>"),yd=C('<span> </span> / <span style="display: inline-block;width:2rem;text-align: right;"> </span>',1),gd=C('<li class="deck_editor_item svelte-vivzk2"><div role="listitem"><div class="svelte-vivzk2"><div class="svelte-vivzk2"> </div> <div style="display:flex" class="svelte-vivzk2"><div class="svelte-vivzk2"><!> <!> <!> <!> <!> <!> <!></div> <div style="flex-grow: 1; width:0.1rem" class="svelte-vivzk2"></div> <div class="svelte-vivzk2"><!></div></div></div></div> <button class="button_style_reset svelte-vivzk2">+</button> <button class="button_style_reset svelte-vivzk2">-</button></li>'),md=C('<div class="deck_editor_card_kind svelte-vivzk2"><span class="svelte-vivzk2"> </span> <ul class="svelte-vivzk2"></ul></div>'),_d=C('<div class="deck_editor_deck_type svelte-vivzk2"><span class="svelte-vivzk2"> </span> <!></div>'),Sd=C('<div class="deck_editor_card_list svelte-vivzk2"></div>');function kn(r,e){Re(e,!1);let t=Se(e,"allCardInfos",8),i=Se(e,"deckCardInfos",12),n=Se(e,"mode",8),a=Se(e,"onAttention",8);const s={Deck:["Monster","Spell","Trap"],ExtraDeck:["Monster"]},o=(p,y)=>(n()==="List"?t():i()).filter(c=>{var h;return Fi.has(c.name)||((h=c.monsterCategories)==null?void 0:h.includes("Normal"))}).filter(c=>!y||c.kind===y).filter(c=>{var h,m;return!p||p==="Deck"&&!((h=c==null?void 0:c.monsterCategories)!=null&&h.union(Xt).length)||p==="ExtraDeck"&&((m=c==null?void 0:c.monsterCategories)==null?void 0:m.union(Xt).length)}).toSorted(xr),u=(p,y)=>{const c=i().filter(m=>m.name===y.name).length;if(c>2)return;const h=p.shiftKey?3-c:1;h<1||(i().push(...Array(h).fill(y)),i().sort(xr),i(i()))},d=(p,y)=>{let c=0;i(i().filter(h=>h.name!==y.name?!0:(c++,!p.shiftKey&&c>1))),i().sort(xr)};ze();var f=Sd();ve(f,5,()=>ll,fe,(p,y)=>{var c=_d(),h=g(c),m=g(h),S=_(h,2);ve(S,1,()=>s[v(y)],fe,(T,b)=>{var B=md(),L=g(B),$=g(L),E=_(L,2);ve(E,5,()=>o(v(y),v(b)),fe,(z,A)=>{var V=gd(),K=g(V),ye=g(K),Te=g(ye),Me=g(Te),I=_(Te,2),k=g(I),F=g(k);{var Q=N=>{var X=xt();M(()=>D(X,`★${v(A).level??""}`)),w(N,X)};Z(F,N=>{v(A).level&&N(Q)})}var re=_(F,2);{var de=N=>{var X=xt();M(()=>D(X,`☆${v(A).rank??""}`)),w(N,X)};Z(re,N=>{v(A).rank&&N(de)})}var ue=_(re,2);ve(ue,1,()=>v(A).attributes??[],fe,(N,X)=>{var pe=hd();M(()=>ge(pe,`monster_attr ${v(X)??""} svelte-vivzk2`)),w(N,pe)});var O=_(ue,2);ve(O,1,()=>v(A).types??[],fe,(N,X)=>{var pe=xt();M(()=>D(pe,mr[v(X)])),w(N,pe)});var G=_(O,2);ve(G,1,()=>v(A).monsterCategories??[],fe,(N,X)=>{var pe=xt();M(()=>D(pe,hr[v(X)])),w(N,pe)});var q=_(G,2);{var R=N=>{var X=xt();M(()=>D(X,`${yr[v(A).spellCategory]??""}魔法`)),w(N,X)};Z(q,N=>{v(A).spellCategory!==void 0&&N(R)})}var U=_(q,2);{var J=N=>{var X=xt();M(()=>D(X,`${gr[v(A).trapCategory]??""}罠`)),w(N,X)};Z(U,N=>{v(A).trapCategory!==void 0&&N(J)})}var W=_(k,4),j=g(W);{var Y=N=>{var X=yd(),pe=ae(X),P=g(pe),x=_(pe,2),te=g(x);M(()=>{D(P,v(A).attack??"?"),D(te,v(A).defense??"?")}),w(N,X)};Z(j,N=>{v(A).kind==="Monster"&&N(Y)})}var H=_(K,2),ee=_(H,2);M(N=>{ge(K,`${N??""} svelte-vivzk2`),D(Me,v(A).name)},[()=>{var N,X;return`deck_editor_card duel_card ${v(A).kind} ${(X=(N=v(A))==null?void 0:N.monsterCategories)==null?void 0:X.join(" ")} ${Fi.has(v(A).name)?"is_implemented":"is_not_implemented"}`}],me),Be("mouseenter",K,()=>a()(v(A))),Be("click",H,N=>u(N,v(A))),Be("click",ee,N=>d(N,v(A))),w(z,V)}),M(()=>D($,da[v(b)])),w(T,B)}),M(()=>D(m,ol[v(y)])),w(p,c)}),w(r,f),Le()}var bd=C('<div class="duel_card_info_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"><pre class="description svelte-1xf9hqi"> </pre></div></div> <div class="duel_card_info_row svelte-1xf9hqi" style=" justify-content: space-between;"><div class="svelte-1xf9hqi"> </div> <div class="svelte-1xf9hqi"> </div></div>',1),wd=C('<div></div> <div class="svelte-1xf9hqi"> </div>',1),Td=C("<div> </div>"),kd=C("<div> </div>"),Cd=C('<div class="duel_card_info_row svelte-1xf9hqi"><!> <!></div> <div class="duel_card_info_row svelte-1xf9hqi"></div>',1),Dd=C('<div class="duel_card_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"></div> <div class="svelte-1xf9hqi"> </div></div>'),Ed=C('<div class="duel_card_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"></div> <div class="svelte-1xf9hqi"> </div></div>'),Ad=C('<div class="duel_card_info_row svelte-1xf9hqi"><div class="svelte-1xf9hqi">※テスト用カードです</div></div>'),xd=C('<div class="duel_card_info_links svelte-1xf9hqi"><a target="_blank" rel="noopener noreferrer" title="遊戯王カードWiki" class="svelte-1xf9hqi">⇒遊戯王カードWiki</a></div>'),Pd=C('<div><div class="duel_card_info_header svelte-1xf9hqi"><div class="duel_card_info_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"> </div></div> <div class="duel_card_info_row svelte-1xf9hqi" style="position:sticky; top:0;"><div class="svelte-1xf9hqi"> </div> <div class="svelte-1xf9hqi"> </div></div></div> <div class="duel_card_info_body svelte-1xf9hqi"><!> <!> <div class="duel_card_info_row description svelte-1xf9hqi"><div class="svelte-1xf9hqi"><pre class="description svelte-1xf9hqi"> </pre></div></div> <!></div></div>');function Md(r,e){Re(e,!1);let t=Se(e,"cardInfo",8,void 0);const i=()=>t()?Ze[t().name]:void 0;ze();var n=ke(),a=ae(n);{var s=o=>{var u=Pd(),d=g(u),f=g(d),p=g(f),y=g(p),c=_(f,2),h=g(c),m=g(h),S=_(h,2),T=g(S),b=_(d,2),B=g(b);{var L=k=>{var F=bd(),Q=ae(F),re=g(Q),de=g(re),ue=g(de),O=_(Q,2),G=g(O),q=g(G),R=_(G,2),U=g(R);M(()=>{D(ue,Ze[t().name].pendulumDescription),D(q,`◀ ${t().pendulumScaleL??""}`),D(U,`${t().pendulumScaleR??""} ▶`)}),w(k,F)};Z(B,k=>{var F;(F=t().monsterCategories)!=null&&F.includes("Pendulum")&&k(L)})}var $=_(B,2);{var E=k=>{var F=Cd(),Q=ae(F),re=g(Q);{var de=q=>{var R=wd(),U=ae(R),J=_(U,2),W=g(J);M(()=>{ge(U,`monster_attr ${t().attributes[0]??""} svelte-1xf9hqi`),D(W,`${Wi[t().attributes[0]]??""}属性`)}),w(q,R)};Z(re,q=>{t().attributes&&q(de)})}var ue=_(re,2);{var O=q=>{var R=Td(),U=g(R);M(()=>{ge(R,`monster_cat ${t().types[0]??""} svelte-1xf9hqi`),D(U,`${mr[t().types[0]]??""}${ti[t().types[0]]??""}族`)}),w(q,R)};Z(ue,q=>{t().types&&q(O)})}var G=_(Q,2);ve(G,5,()=>t().monsterCategories??[],fe,(q,R)=>{var U=kd(),J=g(U);M(()=>{ge(U,`monster_cat ${v(R)??""} svelte-1xf9hqi`),D(J,`${hr[v(R)]??""}${ei[v(R)]??""}`)}),w(q,U)}),w(k,F)},z=k=>{var F=ke(),Q=ae(F);{var re=ue=>{var O=Dd(),G=_(g(O),2),q=g(G);M(()=>D(q,`${yr[t().spellCategory]??""}魔法`)),w(ue,O)},de=ue=>{var O=ke(),G=ae(O);{var q=R=>{var U=Ed(),J=_(g(U),2),W=g(J);M(()=>D(W,`${gr[t().trapCategory]??""}罠`)),w(R,U)};Z(G,R=>{t().kind==="Trap"&&t().trapCategory&&R(q)},!0)}w(ue,O)};Z(Q,ue=>{t().kind==="Spell"&&t().spellCategory?ue(re):ue(de,!1)},!0)}w(k,F)};Z($,k=>{t().kind==="Monster"?k(E):k(z,!1)})}var A=_($,2),V=g(A),K=g(V),ye=g(K),Te=_(A,2);{var Me=k=>{var F=Ad();w(k,F)},I=k=>{var F=xd(),Q=g(F);M(re=>Jt(Q,"href",re),[()=>{var re;return(re=i())==null?void 0:re.wikiHref}],me),w(k,F)};Z(Te,k=>{t().isForTest?k(Me):k(I,!1)})}M((k,F,Q,re)=>{ge(u,`duel_card duel_card_info ${t().kind??""} ${k??""} svelte-1xf9hqi`),D(y,t().name),D(m,F),D(T,Q),D(ye,re)},[()=>{var k;return(k=t().monsterCategories)==null?void 0:k.join(" ")},()=>"★".repeat(t().level||0),()=>"☆".repeat(t().rank||0),()=>{var k;return(k=i())==null?void 0:k.description}],me),w(o,u)};Z(a,o=>{t()&&o(s)})}w(r,n),Le()}const Fd={0:{aaa:"日",aaaa:"日曜日",ddd:"Sun",dddd:"Sunday"},1:{aaa:"月",aaaa:"月曜日",ddd:"Mon",dddd:"Monday"},2:{aaa:"火",aaaa:"火曜日",ddd:"Tue",dddd:"Tuesday"},3:{aaa:"水",aaaa:"水曜日",ddd:"Wed",dddd:"Wednesday"},4:{aaa:"木",aaaa:"木曜日",ddd:"Thu",dddd:"Thursday"},5:{aaa:"金",aaaa:"金曜日",ddd:"Fri",dddd:"Friday"},6:{aaa:"土",aaaa:"土曜日",ddd:"Sat",dddd:"Saturday"}};class Bd{constructor(){l(this,"DefaultSeparator1","/");l(this,"DefaultSeparator2"," ");l(this,"DefaultSeparator3",":");l(this,"createDate",e=>{if(!e)return;const t=new Date(e);if(!isNaN(t.getTime()))return t});l(this,"createDateOr",(e,t)=>this.createDate(e)||t||new Date);l(this,"truncateDate",e=>{const t=e||new Date;return new Date(t.getFullYear(),t.getMonth(),t.getDate())});l(this,"addDate",(e,t)=>{const i=this.createDateOr(e);return i.setDate(i.getDate()+t),i});l(this,"addMonth",(e,t)=>{const i=this.createDateOr(e);return i.setMonth(i.getMonth()+t),i});l(this,"addYear",(e,t)=>{const i=this.createDateOr(e);return i.setFullYear(i.getFullYear()+t),i});l(this,"getDayOfWeek",(e,t="dddd")=>{const i=this.createDate(e);return i?Fd[i.getDay()][t]:""});l(this,"formatToYYYYMMDD",(e,t=this.DefaultSeparator1)=>{const i=this.createDate(e);if(!i)return"";const n=i.getFullYear().toString(),a=("0"+(i.getMonth()+1)).slice(-2),s=("0"+i.getDate()).slice(-2);return n+t+a+t+s});l(this,"formatToYYYYMM",(e,t=this.DefaultSeparator1)=>{const i=this.createDate(e);if(!i)return"";t||(t="");const n=i.getFullYear().toString(),a=("0"+(i.getMonth()+1)).slice(-2);return n+t+a});l(this,"formatToHHMMSS",(e,t=this.DefaultSeparator3)=>{const i=this.createDate(e);if(!i)return"";t||(t="");const n=i.getHours(),a=i.getMinutes(),s=i.getSeconds();return("0"+n).slice(-2)+t+("0"+a).slice(-2)+t+("0"+s).slice(-2)});l(this,"formatToHHMM",(e,t=this.DefaultSeparator3)=>{const i=this.createDate(e);if(!i)return"";t||(t="");const n=("0"+i.getHours()).slice(-2),a=("0"+i.getMinutes()).slice(-2);return n+t+a});l(this,"formatToYYYYMMDD_HHMM",(e,t=this.DefaultSeparator1,i=this.DefaultSeparator2,n=this.DefaultSeparator3)=>{const a=this.createDate(e);return a?this.formatToYYYYMMDD(a,t)+i+this.formatToHHMM(a,n):""});l(this,"formatToYYYYMMDD_HHMMSS",(e,t=this.DefaultSeparator1,i=this.DefaultSeparator2,n=this.DefaultSeparator3)=>{const a=this.createDate(e);return a?this.formatToYYYYMMDD(a,t)+i+this.formatToHHMMSS(a,n):""})}}const rt=new Bd;Date.prototype.truncateDate=function(){return rt.truncateDate(this)};Date.prototype.getCloneOr=function(r){return rt.createDateOr(this,r)};Date.prototype.addDate=function(r){return rt.addDate(this,r)};Date.prototype.addMonth=function(r){return rt.addDate(this,r)};Date.prototype.addYear=function(r){return rt.addDate(this,r)};Date.prototype.getDayOfWeek=function(r="dddd"){return rt.getDayOfWeek(this,r)};Date.prototype.formatToYYYYMM=function(r){return rt.formatToYYYYMM(this,r)};Date.prototype.formatToYYYYMMDD=function(r){return rt.formatToYYYYMMDD(this,r)};Date.prototype.formatToYYYYMMDD_HHMM=function(r,e,t){return rt.formatToYYYYMMDD_HHMM(this,r,e,t)};Date.prototype.formatToYYYYMMDD_HHMMSS=function(r,e,t){return rt.formatToYYYYMMDD_HHMMSS(this,r,e,t)};Date.prototype.formatToHHMM=function(r){return rt.formatToHHMM(this,r)};Date.prototype.formatToHHMMSS=function(r){return rt.formatToHHMMSS(this,r)};var qd=C('<label><input type="checkbox"> </label>'),Od=C('<label><input type="checkbox"> </label>'),Nd=C('<label><input type="checkbox"> <div style="display: inline-block;"></div> </label>'),Rd=C('<label><input type="checkbox"> </label>'),Ld=C('<label><input type="checkbox"> </label>'),Hd=C('<label><input type="checkbox"> </label>'),$d=C("<option> </option>"),Ud=C('<div class="deck_editor_body_right_header svelte-rsq0rf"><div class="deck_editor_body_right_header_row svelte-rsq0rf"><div class="svelte-rsq0rf">編集対象</div> <select></select></div> <div class="deck_editor_body_right_header_row svelte-rsq0rf"><div class="svelte-rsq0rf">新規名称</div> <input type="text"></div> <div class="deck_editor_body_right_header_row svelte-rsq0rf"><div class="svelte-rsq0rf">操作</div> <div class="svelte-rsq0rf"><button class="svelte-rsq0rf">デッキを保存</button></div> <div class="svelte-rsq0rf"></div> <div class="svelte-rsq0rf"><button class="svelte-rsq0rf">デッキを複製</button></div> <div class="svelte-rsq0rf"><button title="shiftキー押下で確認メッセージスキップ" class="svelte-rsq0rf">デッキを削除</button></div></div></div> <!>',1),jd=C("<div>デッキ情報読込中</div>"),Zd=C('<div class="deck_editor svelte-rsq0rf"><div class="deck_editor_header"></div> <div class="deck_editor_body svelte-rsq0rf"><div class="deck_editor_body_left svelte-rsq0rf"><div class="deck_editor_search_box svelte-rsq0rf"><div><div>検索条件</div></div> <div class="deck_editor_search_box_row svelte-rsq0rf"><div class="svelte-rsq0rf">名称</div> <div class="svelte-rsq0rf"><input type="text" style="width:70%">※ルビには対応していません</div></div> <div class="deck_editor_search_box_row svelte-rsq0rf"><div class="svelte-rsq0rf">種類</div> <div class="svelte-rsq0rf"></div></div> <div class="deck_editor_search_box_row svelte-rsq0rf"><div class="svelte-rsq0rf">モンスター</div> <div class="svelte-rsq0rf"></div></div> <div class="deck_editor_search_box_row svelte-rsq0rf"><div class="svelte-rsq0rf">属性</div> <div class="svelte-rsq0rf"></div></div> <div class="deck_editor_search_box_row svelte-rsq0rf"><div class="svelte-rsq0rf">種族</div> <div class="svelte-rsq0rf"></div></div> <div class="deck_editor_search_box_row svelte-rsq0rf"><div class="svelte-rsq0rf">魔法</div> <div class="svelte-rsq0rf"></div></div> <div class="deck_editor_search_box_row svelte-rsq0rf"><div class="svelte-rsq0rf">罠</div> <div class="svelte-rsq0rf"></div></div> <div class="deck_editor_search_box_row svelte-rsq0rf"><div class="svelte-rsq0rf">テスト用</div> <div class="svelte-rsq0rf"><label><input type="checkbox"> テスト用カードを表示する</label></div></div></div> <!></div> <div class="deck_editor_body_center svelte-rsq0rf"><!></div> <div class="deck_editor_body_right svelte-rsq0rf"><!></div></div></div>');function Gd(r,e){Re(e,!1);const t=[],i=[],n=[],a=[],s=[],o=[],u=async()=>{const x=(await v(p)).find(te=>te.id===v(f));x&&ie(c,{...x,cardInfos:x.cardNames.map(te=>Ze[te])})},d=()=>qt.getAllDeckInfo().then(P=>(P.forEach(x=>console.log(x.id,x.lastUsedAt,x.lastUsedAt.getTime())),console.log(Math.max(...P.map(x=>x.lastUsedAt.getTime()))),ie(f,(P.find(x=>x.lastUsedAt.getTime()===Math.max(...P.map(te=>te.lastUsedAt.getTime())))??P[0]).id),P));let f=Pe(-1),p=Pe(d());v(p).then(u);const y=()=>{ie(p,d()),u()};let c=Pe({id:-Number.MAX_VALUE,name:"",description:"",lastUsedAt:new Date,cardInfos:[]}),h=Pe(Ze.ゾンビーノ);const m=Pe({name:"",cardKinds:[...Ci],monsterCategories:[...cn].filter(P=>P!=="Normal"&&P!=="Token"),monsterAttributes:[...dn],monsterTypes:[...un],spellCategories:[...fn],trapCategories:[...vn],isForTest:!1}),S=()=>Object.values(Ze).filter(P=>{if(!v(m).cardKinds.includes(P.kind)||v(m).name.trim().length&&!P.name.includes(v(m).name)||P.isForTest&&!v(m).isForTest)return!1;if(P.kind==="Monster")return P.attributes&&!v(m).monsterAttributes.union(P.attributes).length||P.types&&!v(m).monsterTypes.union(P.types).length||!P.monsterCategories?!1:P.monsterCategories.union(v(m).monsterCategories).length;if(P.kind==="Spell")return P.spellCategory&&v(m).spellCategories.includes(P.spellCategory);if(P.kind==="Trap")return P.trapCategory&&v(m).trapCategories.includes(P.trapCategory)}),T=P=>{ie(h,P)},b=async()=>{const x=(await v(p)).find(te=>te.id===v(f));if(!x)throw new Error("illegal state");return x},B=async()=>{const P=await b();await P.saveDeckInfo({...P,name:v(c).name,cardNames:v(c).cardInfos.map(x=>x.name),lastUsedAt:new Date}),y()},L=async()=>{(await qt.createNewDeck(`デッキ_${new Date().formatToYYYYMMDD_HHMMSS("","","")}`,`コピー日時：${new Date().formatToYYYYMMDD_HHMMSS("-"," ",":")}`,v(c).cardInfos.map(x=>x.name))).saveDeckInfo(),y()},$=async P=>{const x=await b();!P.shiftKey&&!confirm(`デッキ【${x.name}】を削除します。
よろしいですか？`)||(await x.delete(),y())};ze();var E=Zd(),z=_(g(E),2),A=g(z),V=g(A),K=_(g(V),2),ye=_(g(K),2),Te=g(ye),Me=_(K,2),I=_(g(Me),2);ve(I,5,()=>Ci,fe,(P,x)=>{var te=qd(),le=g(te),oe,ne=_(le);M(()=>{oe!==(oe=v(x))&&(le.value=(le.__value=v(x))==null?"":v(x)),D(ne,` ${da[v(x)]??""}`)}),jt(t,[],le,()=>(v(x),v(m).cardKinds),se=>Ve(m,v(m).cardKinds=se)),w(P,te)});var k=_(Me,2),F=_(g(k),2);ve(F,5,()=>cn,fe,(P,x)=>{var te=Od(),le=g(te),oe,ne=_(le);M(()=>{oe!==(oe=v(x))&&(le.value=(le.__value=v(x))==null?"":v(x)),D(ne,` ${hr[v(x)]??""}${ei[v(x)]??""}`)}),jt(i,[],le,()=>(v(x),v(m).monsterCategories),se=>Ve(m,v(m).monsterCategories=se)),w(P,te)});var Q=_(k,2),re=_(g(Q),2);ve(re,5,()=>dn,fe,(P,x)=>{var te=Nd(),le=g(te),oe,ne=_(le,2),se=_(ne);M(()=>{oe!==(oe=v(x))&&(le.value=(le.__value=v(x))==null?"":v(x)),ge(ne,`monster_attr ${v(x)??""} svelte-rsq0rf`),D(se,` ${Wi[v(x)]??""}`)}),jt(n,[],le,()=>(v(x),v(m).monsterAttributes),Ce=>Ve(m,v(m).monsterAttributes=Ce)),w(P,te)});var de=_(Q,2),ue=_(g(de),2);ve(ue,5,()=>un,fe,(P,x)=>{var te=Rd(),le=g(te),oe,ne=_(le);M(()=>{oe!==(oe=v(x))&&(le.value=(le.__value=v(x))==null?"":v(x)),D(ne,` ${mr[v(x)]??""}
                ${ti[v(x)]??""}`)}),jt(a,[],le,()=>(v(x),v(m).monsterTypes),se=>Ve(m,v(m).monsterTypes=se)),w(P,te)});var O=_(de,2),G=_(g(O),2);ve(G,5,()=>fn,fe,(P,x)=>{var te=Ld(),le=g(te),oe,ne=_(le);M(()=>{oe!==(oe=v(x))&&(le.value=(le.__value=v(x))==null?"":v(x)),D(ne,` ${yr[v(x)]??""}`)}),jt(s,[],le,()=>(v(x),v(m).spellCategories),se=>Ve(m,v(m).spellCategories=se)),w(P,te)});var q=_(O,2),R=_(g(q),2);ve(R,5,()=>vn,fe,(P,x)=>{var te=Hd(),le=g(te),oe,ne=_(le);M(()=>{oe!==(oe=v(x))&&(le.value=(le.__value=v(x))==null?"":v(x)),D(ne,` ${gr[v(x)]??""}`)}),jt(o,[],le,()=>(v(x),v(m).trapCategories),se=>Ve(m,v(m).trapCategories=se)),w(P,te)});var U=_(q,2),J=_(g(U),2),W=g(J),j=g(W),Y=_(V,2);Md(Y,{get cardInfo(){return v(h)}});var H=_(A,2),ee=g(H);const N=me(S);kn(ee,{mode:"List",get allCardInfos(){return v(N)},onAttention:T,get deckCardInfos(){return v(c).cardInfos},set deckCardInfos(P){Ve(c,v(c).cardInfos=P)},$$legacy:!0});var X=_(H,2),pe=g(X);Si(pe,()=>v(p),P=>{var x=jd();w(P,x)},(P,x)=>{var te=Ud(),le=ae(te),oe=g(le),ne=_(g(oe),2);M(()=>{v(f),ia(()=>{v(x)})}),ve(ne,5,()=>v(x),fe,(Dt,br)=>{var wr=$d(),zi={},wa=g(wr);M(()=>{zi!==(zi=v(br).id)&&(wr.value=(wr.__value=v(br).id)==null?"":v(br).id),D(wa,v(br).name)}),w(Dt,wr)});var se=_(oe,2),Ce=_(g(se),2),He=_(se,2),mt=_(g(He),2),Ke=g(mt),Qe=_(mt,4),Sr=g(Qe),si=_(Qe,2),li=g(si),ba=_(le,2);kn(ba,{mode:"Deck",allCardInfos:[],onAttention:T,get deckCardInfos(){return v(c).cardInfos},set deckCardInfos(Dt){Ve(c,v(c).cardInfos=Dt)},$$legacy:!0}),oa(ne,()=>v(f),Dt=>ie(f,Dt)),Be("change",ne,u),wi(Ce,()=>v(c).name,Dt=>Ve(c,v(c).name=Dt)),Be("click",Ke,B),Be("click",Sr,L),Be("click",li,$),w(P,te)}),wi(Te,()=>v(m).name,P=>Ve(m,v(m).name=P)),Ws(j,()=>v(m).isForTest,P=>Ve(m,v(m).isForTest=P)),w(r,E),Le()}const Vd="2025-03-27 21:29:02",Wd={timestamp:Vd},Yd=["TblDeckHeader","TblDeckDetail","TblDuelistProfile"],zd=3;var Kd=C("<option> </option>"),Qd=C('<div class="svelte-bc2zvv"><label for="deck_selector" class="deck_selector svelte-bc2zvv">デッキ：</label> <select id="deck_selector" class="deck_selector svelte-bc2zvv"></select></div> <div class="svelte-bc2zvv"><button class="btn svelte-bc2zvv">duel start!</button></div>',1),Jd=C('<div class="svelte-bc2zvv">デッキ情報の読み込み、もしくは作成中...</div>'),Xd=C('<div class="svelte-bc2zvv"><label for="duelist_name" class="duelist_name svelte-bc2zvv">名前：</label> <input id="duelist_name" class="duelist_name svelte-bc2zvv" type="text"></div> <!> <div class="svelte-bc2zvv"><button class="btn svelte-bc2zvv">deck edit</button></div>',1),Id=C('<div class="svelte-bc2zvv">デュエリスト情報の読み込み、もしくは作成中...</div>'),eu=C('<div class="app_body svelte-bc2zvv"><!></div>'),tu=C('<main class="svelte-bc2zvv"><!> <div class="debug_info svelte-bc2zvv"><span> </span> <span class="screen_info"></span></div></main>');function ru(r,e){Re(e,!1);const t=new il("stk_ygo_svelte",zd,Yd);let i=Pe(),n=Pe("None"),a=Pe(0);const s=ki.getOrCreateNew(t);let o=Pe(qt.getAllDeckInfo(t).then(E=>(Promise.all(E.filter(z=>!z.lastUsedAt).map(z=>{z.saveDeckInfo()})),ie(a,(E.find(z=>z.lastUsedAt.getTime()===Math.max(...E.map(A=>A.lastUsedAt.getTime())))??E[0]).id),E)));const u=async()=>{let E=(await v(o)).find(z=>z.id===v(a));if(E||(E=(await f()).find(z=>z.id===v(a))),!E)throw new Error("illegal state");return E},d=async()=>{(await s).save()},f=()=>(ie(o,qt.getAllDeckInfo(t).then(E=>(ie(a,(E.find(z=>z.lastUsedAt.getTime()===Math.max(...E.map(A=>A.lastUsedAt.getTime())))??E[0]).id),E))),v(o)),p=async()=>{(await v(o)).length||(await qt.prepareSampleDeck(),f())},y=async()=>{await Promise.all([d(),p()]),(await u()).updateTimestamp(),ie(i,new lo(await s,"Player",await u(),sl[0],"NPC",Pr[0]))},c=async()=>{await Promise.all([d(),p()]),ie(n,"DeckEdit")},h=async E=>{await d(),E.key==="Enter"&&!E.repeat&&(await s).save()};p(),ze();var m=tu(),S=g(m);{var T=E=>{pd(E,{get duel(){return v(i)}})},b=E=>{var z=ke(),A=ae(z);{var V=ye=>{Gd(ye,{})},K=ye=>{var Te=eu(),Me=g(Te);Si(Me,()=>s,I=>{var k=Id();w(I,k)},(I,k)=>{var F=Xd(),Q=ae(F),re=_(g(Q),2),de=_(Q,2);Si(de,()=>v(o),G=>{var q=Jd();w(G,q)},(G,q)=>{var R=Qd(),U=ae(R),J=_(g(U),2);M(()=>{v(a),ia(()=>{v(q)})}),ve(J,5,()=>v(q),fe,(Y,H)=>{var ee=Kd(),N={},X=g(ee);M(()=>{N!==(N=v(H).id)&&(ee.value=(ee.__value=v(H).id)==null?"":v(H).id),D(X,v(H).name)}),w(Y,ee)});var W=_(U,2),j=g(W);oa(J,()=>v(a),Y=>ie(a,Y)),Be("click",j,y),w(G,R)});var ue=_(de,2),O=g(ue);wi(re,()=>v(k).name,G=>v(k).name=G),Be("keypress",re,h),Be("click",O,c),w(I,F)}),w(ye,Te)};Z(A,ye=>{v(n)==="DeckEdit"?ye(V):ye(K,!1)},!0)}w(E,z)};Z(S,E=>{v(i)?E(T):E(b,!1)})}var B=_(S,2),L=g(B),$=g(L);M(()=>D($,`build at: ${Wd.timestamp}`)),w(r,m),Le()}Fs(ru,{target:document.getElementById("app")});
