var Ni=Object.defineProperty;var Li=(e,t,i)=>t in e?Ni(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var s=(e,t,i)=>Li(e,typeof t!="symbol"?t+"":t,i);import{j as qi}from"./json_20250511_151236.js";class bn{constructor(t,i,a){s(this,"_dbname");s(this,"_dbversion");s(this,"dbPromise");s(this,"getTran",async(t,i)=>(await this.dbPromise).transaction(t,i));s(this,"reset",async()=>(await indexedDB.databases().then(t=>{console.log(t)}),await new Promise((t,i)=>{const a=indexedDB.deleteDatabase(this._dbname);a.onsuccess=()=>{console.log("onsuccess"),t()},a.onerror=r=>{console.log("onerror"),i(r)}})));s(this,"getAll",async t=>{const i=await this.dbPromise;return new Promise((a,r)=>{const o=i.transaction([t],"readonly").objectStore(t).getAll();o.onsuccess=()=>{a(o.result)},o.onerror=u=>{r(u)}})});s(this,"get",async(t,i)=>{const a=await this.dbPromise;return new Promise((r,n)=>{const u=a.transaction([t],"readonly").objectStore(t).get(i);u.onsuccess=()=>{r(u.result)},u.onerror=c=>{n(c)}})});s(this,"getMany",async(t,i)=>{const n=(await this.dbPromise).transaction([t],"readonly").objectStore(t),l=i.map(o=>new Promise((u,c)=>{const d=n.get(o);d.onsuccess=()=>{u(d.result)},d.onerror=p=>{c(p)}}));return await Promise.all(l)});s(this,"putRecords",async(t,i)=>{const r=(await this.dbPromise).transaction([t],"readwrite"),n=r.objectStore(t),l=i.map(o=>({record:o,request:n.put(o)}));return new Promise((o,u)=>{r.oncomplete=()=>o(l.map(c=>Object.assign({id:c.request.result},c.record))),r.onerror=c=>u(c)})});s(this,"deleteRecords",async(t,i)=>{const r=(await this.dbPromise).transaction([t],"readwrite"),n=r.objectStore(t),l=i.map(o=>({key:o,request:n.delete(o)}));return new Promise((o,u)=>{r.oncomplete=()=>{console.log(l.map(c=>c.request.result)),o()},r.onerror=c=>u(c)})});this._dbname=t,this._dbversion=i,this.dbPromise=new Promise((r,n)=>{const l=indexedDB.open(t,i);l.onsuccess=o=>{if(console.log(o),!o.target){console.log("event.target is undefined"),n("event.target is undefined");return}const u=o.target.result;if(!u){console.log("event.target.result is undefined"),n("event.target.result is undefined");return}u.onversionchange=c=>{console.log(c),u.close()},r(u)},l.onupgradeneeded=o=>{console.log("onupgradeneeded");const u=o.target.result;a.filter(c=>!u.objectStoreNames.contains(c)).map(c=>u.createObjectStore(c,{keyPath:"id",autoIncrement:!0}))},l.onerror=o=>{console.log(o),n(o)},l.onblocked=o=>{console.log(o),n(o)}}),console.log(this.dbPromise)}get dbversion(){return this._dbversion}}class N{constructor(){s(this,"handlers",[])}get length(){return this.handlers.length}append(t){this.handlers.push(t)}remove(t){this.handlers=this.handlers.filter(i=>i!==t)}trigger(t){this.handlers.slice(0).filter(i=>i(t)==="RemoveMe").forEach(i=>this.remove(i))}clear(){this.handlers.splice(0)}expose(){return this}}class at{constructor(){s(this,"handlers",[])}append(t){this.handlers.push(t)}remove(t){this.handlers=this.handlers.filter(i=>i!==t)}async trigger(t){(await Promise.all(this.handlers.slice(0).map(async a=>{const r=await a(t);return{h:a,result:r}}))).filter(a=>a.result==="RemoveMe").map(a=>a.h).forEach(a=>this.remove(a))}clear(){this.handlers.splice(0)}expose(){return this}}class rt{constructor(){s(this,"handler")}set(t){this.handler=t}async call(t){if(!this.handler)throw Error("illegal state error");return await this.handler(t)}expose(){return this}}class Ke{constructor(t,i,a,r){s(this,"_name");s(this,"_createVersion");s(this,"mountResolver",()=>{});s(this,"_indexedDb");s(this,"onInsertEvent",new N);s(this,"onBeforeInsertEvent",new rt);s(this,"onUpdateEvent",new N);s(this,"onBeforeUpdateEvent",new rt);s(this,"onDeleteEvent",new N);s(this,"prepareInitialRecords",()=>{const t=new Date;return this._prepareInitialRecords().map(i=>Object.assign(i,{createdAt:t,updatedAt:t,dbVersion:this._createVersion}))});s(this,"resolveMount",()=>this.mountResolver());s(this,"patchForInsert",(t,i)=>{t.newRecords.forEach(a=>{i[a.id]=a})});s(this,"patchForUpdate",(t,i)=>{t.recordPairs.forEach(a=>{i[a.newRecord.id]={...a.newRecord}})});s(this,"patchForDelete",(t,i)=>{t.oldRecords.forEach(a=>{delete i[a.id]})});this._indexedDb=t,this._name=i,this._createVersion=t.dbversion,this.getAll().then(n=>n.reduce((l,o)=>(l[o.id]=o,l),{})).then(n=>{console.log(this.name,n),this.onBeforeInsertEvent.set(a??(()=>Promise.resolve())),this.onBeforeUpdateEvent.set(r??(()=>Promise.resolve()))})}get name(){return this._name}get createVersion(){return this._createVersion}get oninsert(){return this.onInsertEvent.expose()}get onbeforeinsert(){return this.onBeforeInsertEvent.expose()}get onupdate(){return this.onUpdateEvent.expose()}get onbeforeupdate(){return this.onBeforeUpdateEvent.expose()}get ondelete(){return this.onDeleteEvent.expose()}getAll(){return this._indexedDb.getAll(this.name)}get(t){return this._indexedDb.get(this.name,t)}async insertMany(t){const i=new Date,a=t.map(n=>{const l={createdAt:i,updatedAt:i,dbVersion:this._createVersion};return Object.assign(n,l)});await this.onBeforeInsertEvent.call({sender:this,newRecords:a,timestamp:i});const r=await this._indexedDb.putRecords(this.name,a);return this.onInsertEvent.trigger({sender:this,newRecords:r,timestamp:i}),r}async insert(t){return(await this.insertMany([t]))[0]}async updateMany(t,i){const a=new Date,r=[];return(await this._indexedDb.getMany(this.name,t)).forEach(l=>{const o={...l},u={...o};r.push({newRecord:Object.assign(i(u),{updatedAt:a,dbVersion:this._createVersion}),oldRecord:o})}),await this.onBeforeUpdateEvent.call({sender:this,recordPairs:r,timestamp:a}),await this._indexedDb.putRecords(this.name,r.map(l=>l.newRecord)),this.onUpdateEvent.trigger({sender:this,recordPairs:r,timestamp:a}),r.map(l=>l.newRecord)}async update(t,i){return(await this.updateMany([t],i))[0]}async delete(t){const i=new Date,a=await this._indexedDb.getMany(this.name,t);await this._indexedDb.deleteRecords(this.name,t),this.onDeleteEvent.trigger({sender:this,oldRecords:a,timestamp:i})}}const Dn=["Deck","ExtraDeck"],Pn={Deck:"„É°„Ç§„É≥„Éá„ÉÉ„Ç≠",ExtraDeck:"„Ç®„ÇØ„Çπ„Éà„É©„Éá„ÉÉ„Ç≠"},Ri=["Monster","Spell","Trap","XyzMaterial"],Mn={Monster:"„É¢„É≥„Çπ„Çø„Éº",Spell:"È≠îÊ≥ï",Trap:"ÁΩ†",XyzMaterial:"XYZÁ¥†Êùê"},Ee=["Fusion","Syncro","Xyz","Link"],mt=[...Ee,"SpecialSummon","Ritual"],St=[...mt,"NormalSummonOnly","RegularSpecialSummonOnly","FreeReborn"],Hi=["Toon","Spirit","Union","Gemini","FlipEffect"],Zi=["Tuner","Effect","Normal","Pendulum","Token"],An=[...Hi,...Zi,...St],xn={Syncro:"„Ç∑„É≥„ÇØ„É≠",Fusion:"ËûçÂêà",Xyz:"„Ç®„ÇØ„Ç∑„Éº„Ç∫",Link:"„É™„É≥„ÇØ",Ritual:"ÂÑÄÂºè",SpecialSummon:"ÁâπÊÆäÂè¨Âñö",Toon:"„Éà„Ç•„Éº„É≥",Spirit:"„Çπ„Éî„É™„ÉÉ„Éà",Union:"„É¶„Éã„Ç™„É≥",Gemini:"„Éá„É•„Ç¢„É´",FlipEffect:"„É™„Éê„Éº„Çπ",Tuner:"„ÉÅ„É•„Éº„Éä„Éº",Effect:"ÂäπÊûú",Normal:"ÈÄöÂ∏∏",Pendulum:"„Éö„É≥„Éá„É•„É©„É†",Token:"„Éà„Éº„ÇØ„É≥",FreeReborn:"ÁâπÊÆäÂè¨Âñö„É¢„É≥„Çπ„Çø„ÉºÔºàËòáÁîüÂà∂Èôê„Å™„ÅóÔºâ",NormalSummonOnly:"ÁâπÊÆäÂè¨Âñö‰∏çÂèØ",RegularSpecialSummonOnly:"Ê≠£Ë¶è„ÅÆÊñπÊ≥ï‰ª•Â§ñ„Åß„ÅÆÁâπÊÆäÂè¨Âñö‰∏çÂèØ"},Fn={Syncro:"üéµ",Fusion:"üåÄ",Xyz:"üì∞",Link:"‚õìÔ∏è",Ritual:"üìú",SpecialSummon:"üîØ",Toon:"üìñ",Spirit:"üëª",Union:"üöó",Gemini:"üë´",FlipEffect:"üîÑ",Tuner:"üé∂",Effect:"‚ú®",Normal:"üîò",Pendulum:"üí†",Token:"üêè",FreeReborn:"üÜì",NormalSummonOnly:"üî≤",RegularSpecialSummonOnly:"‚ùó"},Bn=["Light","Dark","Earth","Water","Fire","Wind","Divine"],On={Light:"ÂÖâ",Dark:"Èóá",Earth:"Âú∞",Water:"Ê∞¥",Fire:"ÁÇé",Wind:"È¢®",Divine:"Á•û"},Nn=["Aqua","Beast","BeastWarrior","CreatorGod","Cyberse","Dinosaur","DivineBeast","Dragon","Fairy","Fiend","Fish","Insect","Illusion","Machine","Plant","Psychic","Pyro","Reptile","Rock","SeaSerpent","Spellcaster","Thunder","Warrior","WingedBeast","Wyrm","Zombie"],Ln=["Normal","Continuous","Field","QuickPlay","Equip","Ritual","PendulumScale"],qn={Normal:"ÈÄöÂ∏∏",Continuous:"Ê∞∏Á∂ö",Field:"„Éï„Ç£„Éº„É´„Éâ",QuickPlay:"ÈÄüÊîª",Equip:"Ë£ÖÂÇô",Ritual:"ÂÑÄÂºè",PendulumScale:"„Éö„É≥„Éá„É•„É©„É†"},Rn=["Normal","Continuous","Counter"],Hn={Normal:"ÈÄöÂ∏∏",Continuous:"Ê∞∏Á∂ö",Counter:"„Ç´„Ç¶„É≥„Çø„Éº"},_=["Attack","Defense"],ke={Attack:"ÊîªÊíÉË°®Á§∫",Defense:"ÂÆàÂÇôË°®Á§∫",Set:"Ë£èÂÅ¥ÂÆàÂÇôË°®Á§∫"},Ct=["level","rank","attack","defense","pendulumScaleR","pendulumScaleL"],Zn={Aqua:"Ê∞¥",Beast:"Áç£",BeastWarrior:"Áç£Êà¶Â£´",CreatorGod:"ÂâµÈÄ†Á•û",Cyberse:"„Çµ„Ç§„Éê„Éº„Çπ",Dinosaur:"ÊÅêÁ´ú",DivineBeast:"ÂπªÁç£Á•û",Dragon:"„Éâ„É©„Ç¥„É≥",Fairy:"Â§©‰Ωø",Fiend:"ÊÇ™È≠î",Fish:"È≠ö",Insect:"ÊòÜËô´",Illusion:"ÂπªÊÉ≥È≠î",Machine:"Ê©üÊ¢∞",Plant:"Ê§çÁâ©",Psychic:"„Çµ„Ç§„Ç≠„ÉÉ„ÇØ",Pyro:"ÁÇé",Reptile:"Áà¨Ëô´È°û",Rock:"Â≤©Áü≥",SeaSerpent:"Êµ∑Á´ú",Spellcaster:"È≠îÊ≥ï‰Ωø„ÅÑ",Thunder:"Èõ∑",Warrior:"Êà¶Â£´",WingedBeast:"È≥•Áç£",Wyrm:"ÂπªÁ´ú",Zombie:"„Ç¢„É≥„Éá„ÉÉ„Éà"},$n={Aqua:"üö∞",Beast:"üêÖ",BeastWarrior:"ü¶Å",CreatorGod:"üîÜ",Cyberse:"üíªÔ∏è",Dinosaur:"ü¶ñ",DivineBeast:"üí´",Dragon:"üê≤",Fairy:"üëº",Fiend:"üëø",Fish:"üêüÔ∏è",Insect:"ü¶ã",Illusion:"ü§°",Machine:"ü§ñ",Plant:"üå±",Psychic:"üëÅÔ∏è",Pyro:"üî•",Reptile:"ü¶é",Rock:"‚õ∞",SeaSerpent:"üêç",Spellcaster:"üßô",Thunder:"‚ö°Ô∏è",Warrior:"‚öîÔ∏è",WingedBeast:"ü¶Ö",Wyrm:"üêâ",Zombie:"ü¶¥"},$i=["TopLeft","TopCenter","TopRight","MiddleLeft","MiddleRight","BottomLeft","BottomCenter","BottomRight"],Tt={TopLeft:{name:"Â∑¶‰∏ä",linkArrow:{offsetRow:-1,offsetColumn:-1}},TopCenter:{name:"‰∏ä",linkArrow:{offsetRow:-1,offsetColumn:0}},TopRight:{name:"Âè≥‰∏ä",linkArrow:{offsetRow:-1,offsetColumn:1}},MiddleLeft:{name:"Â∑¶",linkArrow:{offsetRow:0,offsetColumn:-1}},MiddleRight:{name:"Âè≥",linkArrow:{offsetRow:0,offsetColumn:1}},BottomLeft:{name:"Â∑¶‰∏ã",linkArrow:{offsetRow:1,offsetColumn:-1}},BottomCenter:{name:"‰∏ã",linkArrow:{offsetRow:1,offsetColumn:0}},BottomRight:{name:"Âè≥‰∏ã",linkArrow:{offsetRow:1,offsetColumn:1}}};$i.reduce((e,t)=>(e[Tt[t].name]=t,e),{});const Gn=e=>e.cardId??!1?`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=2&cid=${e.cardId}`:`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=1&sess=1&rp=10&mode=&sort=1&keyword=${e.name}&stype=1&ctype=&othercon=2&starfr=&starto=&pscalefr=&pscaleto=&linkmarkerfr=&linkmarkerto=&link_m=2&atkfr=&atkto=&deffr=&defto=&releaseDStart=1&releaseMStart=1&releaseYStart=1999&releaseDEnd=&releaseMEnd=&releaseYEnd=`,kt=(e,t)=>{const i=e.monsterCategories??[],a=t.monsterCategories??[];for(const r of Ee.toReversed()){if(i.includes(r)&&!a.includes(r))return 1;if(!i.includes(r)&&a.includes(r))return-1}if(e.kind===t.kind){if(e.kind==="Monster"){if((e.link??0)!==(t.link??0))return(e.link??0)-(t.link??0);if((e.rank??0)!==(t.rank??0))return(e.rank??0)-(t.rank??0);if((e.level??0)!==(t.level??0))return(e.level??0)-(t.level??0);if((e.attack??0)!==(t.attack??0))return(e.attack??0)-(t.attack??0);if((e.defense??0)!==(t.defense??0))return(e.defense??0)-(t.defense??0)}return e.name.localeCompare(t.name,"Ja")}for(const r of Ri){if(e.kind===r)return-1;if(t.kind===r)return 1}return e.name.localeCompare(t.name,"Ja")},Et=["Deck","ExtraDeck"],wt=["Graveyard","Banished"],_t=[...Et,...wt],Gi=[..._t,"Hand"],H=["MonsterZone","ExtraMonsterZone"],ie=["SpellAndTrapZone","FieldSpellZone"],X=[...H,...ie],bt=["XyzMaterialZone","Disable"],K=[...Gi,...X,...bt],Ge={0:{0:"Hand"},1:{0:"Deck",1:"SpellAndTrapZone",2:"SpellAndTrapZone",3:"SpellAndTrapZone",4:"SpellAndTrapZone",5:"SpellAndTrapZone",6:"ExtraDeck"},2:{0:"Graveyard",1:"MonsterZone",2:"MonsterZone",3:"MonsterZone",4:"MonsterZone",5:"MonsterZone",6:"FieldSpellZone"},3:{0:"Banished",1:"XyzMaterialZone",2:"ExtraMonsterZone",3:"Disable",4:"ExtraMonsterZone",5:"XyzMaterialZone",6:"Banished"},4:{0:"FieldSpellZone",1:"MonsterZone",2:"MonsterZone",3:"MonsterZone",4:"MonsterZone",5:"MonsterZone",6:"Graveyard"},5:{0:"ExtraDeck",1:"SpellAndTrapZone",2:"SpellAndTrapZone",3:"SpellAndTrapZone",4:"SpellAndTrapZone",5:"SpellAndTrapZone",6:"Deck"},6:{0:"Hand"}};class ji{constructor(t,i,a,r){s(this,"onUpdateEvent",new N);s(this,"field");s(this,"row");s(this,"column");s(this,"cellType");s(this,"_owner");s(this,"_requiresRecalcLinkArrows");s(this,"_linkArrowSources");s(this,"_needsShuffle",!1);s(this,"recalcLinkArrows",()=>{this.isMonsterZoneLikeCell&&(this._requiresRecalcLinkArrows=!1,this._linkArrowSources=this.neighbors.filter(t=>t.isMonsterZoneLikeCell).filter(t=>t.cardEntities.length).filter(t=>t.cardEntities[0].linkArrows.some(i=>this.row===t.row+i.offsetRow&&this.column===t.column+i.offsetColumn)).map(t=>t.cardEntities[0]))});s(this,"_entities");s(this,"releaseEntities",t=>{var i;return this._entities=this._entities.filter(a=>a!==t),this.isMonsterZoneLikeCell&&((i=t.origin.monsterCategories)!=null&&i.includes("Link"))&&(this._requiresRecalcLinkArrows=!0),this.onUpdateEvent.trigger(),t});s(this,"acceptEntities",(t,i)=>{var a;if(i==="Fix"){if(!this._entities.includes(t))throw new m("ÂºïÊï∞„Å®„Çª„É´„ÅÆÁä∂ÊÖã„ÅåÁüõÁõæ„Åó„Å¶„ÅÑ„Çã„ÄÇ",this,t,i)}else i==="Top"?this._entities.unshift(t):this._entities.push(t),i==="Random"&&(console.log(this._needsShuffle,i),this._needsShuffle=!0),this._entities.forEach(r=>{r.fieldCell=this}),this.isMonsterZoneLikeCell&&((a=t.origin.monsterCategories)!=null&&a.includes("Link"))&&(this._requiresRecalcLinkArrows=!0);this.onUpdateEvent.trigger()});s(this,"shuffle",()=>{this._entities=this.entities.shuffle(),this._needsShuffle=!1,this.field.duel.log.info("„Éá„ÉÉ„Ç≠„Çí„Ç∑„É£„ÉÉ„Éï„É´„ÄÇ",this.owner)});s(this,"toString",()=>this.isMonsterZoneLikeCell||this.cellType==="SpellAndTrapZone"?`${this.cellType}(${this.row},${this.column})`:this.cellType);this.field=t,this.row=i,this.column=a,this.cellType=Ge[i][a],this._owner=r,this._entities=[],this._linkArrowSources=[],this._requiresRecalcLinkArrows=!1}get onUpdate(){return this.onUpdateEvent.expose()}get owner(){var t;return this._owner||((t=this.cardEntities[0])==null?void 0:t.owner)}get requiresRecalcLinkArrows(){return this._requiresRecalcLinkArrows}get linkArrowSources(){return this._linkArrowSources}get needsShuffle(){return this._needsShuffle}get entities(){return this._entities}get visibleEntities(){return this._entities.filter(t=>ot.find(i=>i===t.entityType))}get cardEntities(){return this._entities.filter(t=>ot.find(i=>i===t.entityType)).filter(t=>t.kind!=="XyzMaterial")}get xyzMaterials(){return this._entities.filter(t=>t.kind==="XyzMaterial")}get targetForAttack(){return this.cellType==="Hand"?this._entities.find(t=>t.entityType==="Duelist"):this.cardEntities[0]}get isAvailable(){return this.cardEntities.length===0&&this._entities.filter(t=>Pa.find(i=>i===t.entityType)).length===0}get isAvailableForPendulum(){return this.isAvailable&&this.isSpellTrapZoneLikeCell&&(this.column===1||this.column===5)}get isStackCell(){return _t.some(t=>t===this.cellType)}get isPlayFieldCell(){return X.some(t=>t===this.cellType)}get isMonsterZoneLikeCell(){return H.some(t=>t===this.cellType)}get isSpellTrapZoneLikeCell(){return ie.some(t=>t===this.cellType)}get isDisabledCell(){return bt.some(t=>t===this.cellType)}get isTrashCell(){return wt.some(t=>t===this.cellType)}get neighbors(){const t=[this.row-1,this.row,this.row+1].filter(a=>a>=0&&a<=6),i=[this.column-1,this.column,this.column+1].filter(a=>a>=0&&a<=6);return t.flatMap(a=>i.map(r=>this.field.cells[a][r])).filter(a=>a.isMonsterZoneLikeCell).filter(a=>a!==this)}}Array.prototype.shuffle=function(){return this.map(t=>({item:t,seq:Math.random()})).toSorted((t,i)=>t.seq-i.seq).map(t=>t.item)};Array.prototype.randomPickMany=function(e){return this.shuffle().slice(0,e)};Array.prototype.randomPick=function(){return this.shuffle().slice(0,1)[0]};Array.prototype.reset=function(...e){this.splice(0),this.push(...e)};Array.prototype.union=function(e){return this.filter(t=>e.find(i=>t===i))};Array.prototype.getAllOnOffPattern=function(){const e=[];return this.forEach(t=>{if(e.length==0){e.push([t]),e.push([]);return}e.forEach(i=>e.push([...i,t]))}),e};Array.prototype.getDistinct=function(){return Array.from(new Set(this))};Array.prototype.distinct=function(){this.reset(...this.getDistinct())};class ye{constructor(){s(this,"pooledOperators",[]);s(this,"bundles",[]);s(this,"excludesExpired",()=>{this.bundles=this.bundles.filter(t=>!t.entity.hasDisappeared),this.bundles.forEach(t=>t.excludesExpired()),this.pooledOperators=this.pooledOperators.filter(t=>t.validateAlive())});s(this,"append",t=>{this.bundles.push(t)});s(this,"push",t=>{if(!t.isContinuous)throw new m("static„Å∏„ÅÆËøΩÂä†„ÅØÊ∞∏Á∂ö‰ª•Â§ñ‰∏çÂèØ",t);this.excludesExpired(),this.distribute(t),this.pooledOperators.push(t)});s(this,"distributeAll",t=>(this.excludesExpired(),this.pooledOperators.flatMap(this.distribute).getDistinct().forEach(i=>i.operators.sort((a,r)=>a.seq-r.seq)),this.afterDistributeAll(t)));s(this,"distribute",t=>this.bundles.filter(i=>i.operators.every(a=>a.seq!==t.seq)).filter(i=>t.isApplicableTo(i.entity)).filter(i=>i.entity.canBeEffected(t.effectOwner,t.isSpawnedBy,t.actionAttr)).map(i=>(i.push(t),i)));s(this,"removeItem",t=>{this.pooledOperators=this.pooledOperators.filter(i=>i.seq!==t)})}}class ve{constructor(t,i){s(this,"pool");s(this,"entity");s(this,"_operators");s(this,"excludesExpired",()=>{this._operators=this._operators.filter(t=>{const i=t.validateAlive()&&t.isApplicableTo(this.entity);return i||(console.info(`before remove ${this.entity.toString} ${t.title}`),t.beforeRemove(this)),i})});s(this,"push",t=>{this.entity.procFilterBundle.effectiveOperators.filter(i=>i.procTypes.includes("Effect")).some(i=>!i.filter(i.effectOwner,i.isSpawnedBy,i.actionAttr,[]))||(this.beforePush(t),this._operators.push(t))});s(this,"removeItem",t=>{this._operators=this._operators.filter(i=>i.seq!==t?!0:(i.beforeRemove(this),!1))});this.pool=t,this.entity=i,this._operators=[],this.pool.append(this)}get operators(){return this._operators}get effectiveOperators(){return this.operators.filter(t=>t.isSpawnedBy.isEffective||!t.isContinuous)}}const Ae=class Ae{constructor(t,i,a,r,n,l){s(this,"seq");s(this,"title");s(this,"validateAlive");s(this,"isContinuous");s(this,"isSpawnedBy");s(this,"isSpawnedAt");s(this,"activateType");s(this,"actionAttr");s(this,"isApplicableTo");s(this,"effectOwner");this.seq=Ae.nextSeq++,this.title=t,this.validateAlive=()=>i(this),this.isContinuous=a,this.isSpawnedBy=r,this.isSpawnedAt=r.duel.clock.getClone(),this.isApplicableTo=o=>l(this,o),this.actionAttr=n,this.activateType=this.actionAttr.playType?ja(this.actionAttr.playType):"NonActivate",this.effectOwner=this.isSpawnedBy.controller}get isEffective(){return!this.isContinuous||this.activateType==="NonActivate"?!0:this.isSpawnedBy.isEffective}};s(Ae,"nextSeq",0);let ae=Ae;class Ui extends ye{constructor(){super(...arguments);s(this,"afterDistributeAll",()=>this.bundles.every(i=>i.applyEffectFilter()))}}class Vi extends ve{constructor(){super(...arguments);s(this,"applyEffectFilter",()=>{const i=this.entity.allStickyEffectOperators.length,a=[];for(;;){const r=this.effectiveOperators.filter(n=>n.procTypes.includes("Effect")).filter(n=>n.isContinuous).find(n=>!a.includes(n.seq));if(!r)break;a.push(r.seq),r.eraseOperators(this.entity)}return this.entity.allStickyEffectOperators.length===i});s(this,"beforePush",i=>i.eraseOperators(this.entity))}}const ce=class ce extends ae{constructor(i,a,r,n,l,o,u,c){super(i,a,r,n,l,o);s(this,"beforeRemove",()=>{});s(this,"procTypes");s(this,"filter");s(this,"eraseOperators",i=>{if(!this.procTypes.includes("Effect"))return 0;const a=i.allStickyEffectOperators.filter(r=>r.isContinuous).filter(r=>!this.filter(r.effectOwner,r.isSpawnedBy,r.actionAttr,[])).map(r=>r.seq);return a.forEach(i.procFilterBundle.removeItem),a.forEach(i.statusOperatorBundle.removeItem),a.forEach(i.numericOprsBundle.removeItem),a.length});this.procTypes=u,this.filter=c}};s(ce,"createContinuous",(i,a,r,n,l,o,u)=>new ce(i,a,!0,r,n,l,o,u)),s(ce,"createLingering",(i,a,r,n,l,o,u)=>new ce(i,a,!1,r,n,l,o,u));let he=ce;const nt={level:1,rank:1,attack:0,defense:0,pendulumScaleR:0,pendulumScaleL:0};class zi extends ye{constructor(){super(...arguments);s(this,"afterDistributeAll",i=>{if(this.bundles.forEach(r=>r.calcStateAll()),i.field.getMonstersOnFieldStrictly().flatMap(r=>r.numericOprsBundle).flatMap(r=>r.effectiveOperators).some(r=>r.targetStateGen==="calculated")){const n=i.field.getMonstersOnFieldStrictly().filter(l=>(l.atk??0)>=0).map(l=>l.atk??0).reduce((l,o)=>l>o?l:o,0);i.field.getMonstersOnFieldStrictly().forEach(l=>{l.numericOprsBundle.effectiveOperators.filter(o=>o.targetStateGen==="calculated").forEach(o=>{var u;if(!((u=l.status.monsterCategories)!=null&&u.includes("Link")&&o.targetState==="defense")){if(o.stateOperationType==="THE_DEVILS_AVATAR"){l.numericStatus.calculated[o.targetState]=n+100;return}l.numericStatus.calculated[o.targetState]=o.calcValue(l,l.numericStatus.calculated[o.targetState]??0)}})})}return!0})}}class Qi extends ve{constructor(){super(...arguments);s(this,"beforePush",i=>{const a=this.effectiveOperators.filter(n=>n.targetState===i.targetState).filter(n=>n.isEffective);if(i.kind==="O-L-F"||i.kind==="O-C-F"?(a.filter(n=>n.kind==="O-L-F").forEach(n=>n.negate()),a.filter(n=>n.kind==="L-F").forEach(n=>n.negate())):i.kind==="L-F"||i.kind==="C-F"?a.filter(n=>n.kind==="L-F"||n.kind==="L-A").forEach(n=>n.negate()):i.kind==="X-C-X"&&a.filter(n=>!n.isContinuous).forEach(n=>n.negate()),a.filter(n=>n.isEffective).some(n=>n.kind==="X-C-X")&&!i.isContinuous)return;if(i.stateOperationType!=="Addition"&&i.targetStateGen==="wip"&&a.filter(n=>!n.isContinuous).forEach(n=>n.negate()),i.stateOperationType==="THE_DEVILS_AVATAR"||i.stateOperationType==="Gradius'_Option"){this.entity.numericStatus.calculated[i.targetState]=-Number.MAX_VALUE;return}const r=this.entity.numericStatus.calculated[i.targetState]??0;if(i.stateOperationType==="THE_DEVILS_DREAD-ROOT"){this.entity.numericStatus.calculated[i.targetState]=i.calcValue(this.entity,r);return}if(i.kind==="L-F"){this.entity.numericStatus.wip[i.targetState]=i.calcValue(this.entity,r);return}});s(this,"calcStateAll",()=>Ct.forEach(this.calcState));s(this,"calcState",i=>{if(this.entity.kind!=="Monster"&&!this.entity.isPendulumScale){this.entity.numericStatus.calculated[i]=void 0;return}if(!this.entity.status.monsterCategories){this.entity.numericStatus.calculated[i]=void 0;return}if(this.entity.status.monsterCategories.includes("Link")&&i!=="attack"){this.entity.numericStatus.calculated[i]=void 0;return}if(this.entity.status.monsterCategories.includes("Xyz")&&i==="level"){this.entity.numericStatus.calculated[i]=void 0;return}if(!this.entity.status.monsterCategories.includes("Xyz")&&i==="rank"){this.entity.numericStatus.calculated[i]=void 0;return}if(!this.entity.status.monsterCategories.includes("Pendulum")&&(i==="pendulumScaleL"||i==="pendulumScaleR")){this.entity.numericStatus.calculated[i]=void 0;return}if(i!=="level"&&!this.entity.isOnFieldStrictly){this.entity.numericStatus.origin[i]=this.entity.origin[i],this.entity.numericStatus.wip[i]=this.entity.origin[i],this.entity.numericStatus.calculated[i]=this.entity.origin[i];return}const a=this.entity.origin[i]??0,r=this.entity.numericStatus.wip[i]??0,n=this._operators.filter(d=>d.targetState===i).filter(d=>d.isEffective);if(n.some(d=>d.stateOperationType==="THE_DEVILS_AVATAR"||d.stateOperationType==="Gradius'_Option")&&this.entity.isEffective){this.entity.numericStatus.calculated[i]=-Number.MAX_VALUE;return}const l=n.filter(d=>d.targetState===i).findLast(d=>d.targetStateGen==="origin"),o=l?l.calcValue(this.entity,a??0):a;this.entity.numericStatus.origin[i]=o;let u=o;const c=n.filter(d=>d.targetState===i).filter(d=>d.targetStateGen==="wip").findLast(d=>d.stateOperationType==="Fixation");if(!c)u=n.filter(d=>d.stateOperationType==="Addition").reduce((d,p)=>p.calcValue(this.entity,d),u),this.entity.numericStatus.wip[i]=u;else if(c.isContinuous)u=c.calcValue(this.entity,u),u=n.filter(d=>d.stateOperationType==="Addition").reduce((d,p)=>p.calcValue(this.entity,d),u),this.entity.numericStatus.wip[i]=u;else{let d=!1;u=n.filter(p=>(d=d||p===c,d&&p!==c)).filter(p=>p.stateOperationType==="Addition").reduce((p,g)=>g.calcValue(this.entity,p),r)}u<nt[i]&&(u=nt[i]),this.entity.numericStatus.calculated[i]=u})}}const U=class U extends ae{constructor(i,a,r,n,l,o,u,c,d,p){super(i,a,r,n,l,o);s(this,"beforeRemove",()=>{});s(this,"targetState");s(this,"targetStateGen");s(this,"stateOperationType");s(this,"calcValue");s(this,"_isEffective");s(this,"negate",()=>{this._isEffective=!1});this._isEffective=!0,this.targetState=u,this.targetStateGen=c,this.stateOperationType=d,this.calcValue=(g,h)=>p(this.isSpawnedBy,g,h)}get isEffective(){return this._isEffective&&super.isEffective}get kind(){if(this.targetStateGen==="origin"){if(this.stateOperationType==="Fixation")return this.isContinuous?"O-C-F":"O-L-F";throw new m("ÁüõÁõæ„Åó„Åü„Éó„É≠„Éë„ÉÜ„Ç£",this)}if(this.targetStateGen==="wip"){if(this.stateOperationType==="Addition")return this.isContinuous?"C-A":"L-A";if(this.stateOperationType==="Fixation")return this.isContinuous?"C-F":"L-F";throw new m("ÁüõÁõæ„Åó„Åü„Éó„É≠„Éë„ÉÜ„Ç£",this)}if(this.stateOperationType==="THE_DEVILS_DREAD-ROOT")return"X-C-F";if(this.stateOperationType==="THE_DEVILS_AVATAR"||this.stateOperationType==="Gradius'_Option")return"X-C-X";throw new m("ÁüõÁõæ„Åó„Åü„Éó„É≠„Éë„ÉÜ„Ç£",this)}};s(U,"createContinuous",(i,a,r,n,l,o,u,c)=>new U(i,a,!0,r,{},n,l,o,u,c)),s(U,"createLingering",(i,a,r,n,l,o,u)=>new U(i,a,!1,r,n,(c,d)=>d.isOnFieldAsMonsterStrictly,l,"wip",o,u)),s(U,"createLingeringFixation",(i,a,r,n,l,o)=>U.createLingering(i,a,r,n,l,"Fixation",o)),s(U,"createLingeringAddition",(i,a,r,n,l,o)=>U.createLingering(i,a,r,n,l,"Addition",o));let Z=U;const Wi=e=>Object.keys(e),Xi={draw:"„Éâ„É≠„Éº„Éï„Çß„Ç§„Ç∫",standby:"„Çπ„Çø„É≥„Éê„Ç§„Éï„Çß„Ç§„Ç∫",main1:"„É°„Ç§„É≥„Éï„Çß„Ç§„Ç∫Ôºë",battle1:"„Éê„Éà„É´„Éï„Çß„Ç§„Ç∫",battle2:"„Éê„Éà„É´„Éï„Çß„Ç§„Ç∫ÔºàËøΩÂä†Ôºâ",main2:"„É°„Ç§„É≥„Éï„Çß„Ç§„Ç∫Ôºí",end:"„Ç®„É≥„Éâ„Éï„Çß„Ç§„Ç∫"},Ki={start:"„Çπ„Çø„Éº„Éà„Çπ„ÉÜ„ÉÉ„Éó",battle:"„Éê„Éà„É´„Çπ„ÉÜ„ÉÉ„Éó",damage:"„ÉÄ„É°„Éº„Ç∏„Çπ„ÉÜ„ÉÉ„Éó",end:"„Ç®„É≥„Éâ„Çπ„ÉÜ„ÉÉ„Éó"},Ji={start:"„ÉÄ„É°„Éº„Ç∏„Çπ„ÉÜ„ÉÉ„ÉóÈñãÂßãÊôÇ",beforeDmgCalc:"„ÉÄ„É°„Éº„Ç∏Ë®àÁÆóÂâç",dmgCalc:"„ÉÄ„É°„Éº„Ç∏Ë®àÁÆóÊôÇ",afterDmgCalc:"„ÉÄ„É°„Éº„Ç∏Ë®àÁÆóÂæå",end:"„ÉÄ„É°„Éº„Ç∏„Çπ„ÉÜ„ÉÉ„ÉóÁµÇ‰∫ÜÊôÇ"},D=["draw","stanby","main1","b1Start","b1Battle","b1End","b2Start","b2Battle","b2End","main2","end"],F=["b1DStart","b1DBeforeDmgCalc","b1DAfterDmgCalc","b1DEnd","b2DStart","b2DBeforeDmgCalc","b2DAfterDmgCalc","b2DEnd"],Yi=["b1DDmgCalc","b2DDmgCalc"],z=[...D,...F,...Yi],st={draw:{phase:"draw",step:void 0,stage:void 0},stanby:{phase:"standby",step:void 0,stage:void 0},main1:{phase:"main1",step:void 0,stage:void 0},b1Start:{phase:"battle1",step:"start",stage:void 0},b1Battle:{phase:"battle1",step:"battle",stage:void 0},b1DStart:{phase:"battle1",step:"battle",stage:"start"},b1DBeforeDmgCalc:{phase:"battle1",step:"battle",stage:"beforeDmgCalc"},b1DDmgCalc:{phase:"battle1",step:"battle",stage:"dmgCalc"},b1DAfterDmgCalc:{phase:"battle1",step:"battle",stage:"afterDmgCalc"},b1DEnd:{phase:"battle1",step:"battle",stage:"end"},b1End:{phase:"battle1",step:"end",stage:void 0},b2Start:{phase:"battle2",step:"start",stage:void 0},b2Battle:{phase:"battle2",step:"battle",stage:void 0},b2DStart:{phase:"battle2",step:"battle",stage:"start"},b2DBeforeDmgCalc:{phase:"battle2",step:"battle",stage:"beforeDmgCalc"},b2DDmgCalc:{phase:"battle2",step:"battle",stage:"dmgCalc"},b2DAfterDmgCalc:{phase:"battle2",step:"battle",stage:"afterDmgCalc"},b2DEnd:{phase:"battle2",step:"battle",stage:"end"},b2End:{phase:"battle2",step:"end",stage:void 0},main2:{phase:"main2",step:void 0,stage:void 0},end:{phase:"end",step:void 0,stage:void 0}},Ii=e=>e.stage?Ji[e.stage]:e.step?Ki[e.step]:Xi[e.phase],I=Wi(st).reduce((e,t)=>(e[t].key=t,e[t].name=Ii(e[t]),e),st),xe=class xe{constructor(t,i){s(this,"entity");s(this,"isRegular");s(this,"_isStarted");s(this,"info");s(this,"continuousEffectBase");s(this,"updateState",async()=>{if(this.hasToStart!==this.isStarted){if(this.isStarted){if(!this.info)throw new m("illegal state");this._isStarted=!1,await this.continuousEffectBase.finish(this.entity,this.info),this.info=void 0;return}this.info=await this.continuousEffectBase.start(this.entity),this._isStarted=!0}});this._isStarted=!1,this.entity=t,this.continuousEffectBase=i,this.isRegular=this.appliableCellTypes.every(a=>X.find(r=>r===a))&&this.faceList.length===1&&this.faceList[0]==="FaceUp"}get isStarted(){return this._isStarted}get appliableCellTypes(){return this.continuousEffectBase.appliableCellTypes}get appliableDuelPeriodKeys(){return this.continuousEffectBase.appliableDuelPeriodKeys}get faceList(){return this.continuousEffectBase.faceList}get hasToStart(){return!this.appliableCellTypes.includes(this.entity.fieldCell.cellType)||!this.appliableDuelPeriodKeys.includes(this.entity.duel.clock.period.key)||!this.faceList.includes(this.entity.face)?!1:this.continuousEffectBase.canStart(this.entity)}};s(xe,"createNew",(t,i)=>new xe(t,i));let je=xe;const ea=(e,t,i,a)=>({title:e,appliableCellTypes:t==="Monster"?["MonsterZone","ExtraMonsterZone"]:["FieldSpellZone","SpellAndTrapZone"],appliableDuelPeriodKeys:z,faceList:["FaceUp"],canStart:r=>!r.info.isPending&&!r.info.isDying,start:async r=>{const n=i(r);return n.forEach(a(r).push),n.map(l=>l.seq)},finish:async(r,n)=>{n.forEach(l=>a(r).removeItem(l))}}),Oe=(e,t,i,a,r)=>({title:e,appliableCellTypes:t==="Monster"?["MonsterZone","ExtraMonsterZone"]:["FieldSpellZone","SpellAndTrapZone"],appliableDuelPeriodKeys:z,faceList:["FaceUp"],canStart:n=>!n.info.isPending&&!n.info.isDying,start:async n=>{const l=a(n),o=i(n);return console.info(`start : ${n.toString()} ‚áí ${o.map(u=>u.toString()).join(" ")} (${l.map(u=>u.title).join(" ")})`),o.map(r).forEach(u=>l.forEach(u.push)),{targets:o,seqList:l.map(u=>u.seq)}},finish:async(n,l)=>{l.targets.map(r).forEach(o=>l.seqList.forEach(u=>o.removeItem(u)))}}),Dt=(e,t,i,a)=>Oe(e,t,i,a,r=>r.procFilterBundle),we=(e,t,i)=>ea(e,t,i,a=>a.field.numericStateOperatorPool),me=(e,t,i,a)=>Oe(e,t,i,a,r=>r.numericOprsBundle),Je=(e,t,i,a)=>Oe(e,t,i,a,r=>r.statusOperatorBundle),ta=(e,t,i,a)=>Oe(e,t,i,a,r=>r.damageFilterBundle),_e=(...e)=>e.length?e.reduce((t,i)=>t>i?t:i):-Number.MAX_VALUE,be=(...e)=>e.length?e.reduce((t,i)=>t<i?t:i):Number.MAX_VALUE,le=(e,t)=>{if((e[0]??Number.MAX_VALUE)>t)return 0;if(e.slice(-1)[0]<t)return e.length;let i=0,a=e.length-1;for(;;){const r=Math.round((i+a)/2);if(r===a||r===i)return e[i]<t?a:i;if(e[r]<t){i=r;continue}a=r}},j=[3,5,5,6,6,6,7,8,9,10,11,11,11,12,12,13,13,14,15,15,15,15,15,15,16,16,16,17,18,18,18,21,21,21,22,23,25,25,26,28,28,28,30,30,31,32,32,33,33,34,35,35,36,36,36,37,37,38,38,38,39,41,42,42,43,45,45,45,45,48,48,48,50,51,52,54,54,54,54,56,57,58,59,59,59,59,60,61,63,65,65,65,65,66,67,67,67,69,69,71,71,72,73,73,73,73,73,74,75,75,76,76,77,78,79,80,80,80,80,84,84,84,84,84,84,85,85,85,87,90,91,94,96,96,97,98,101,101,101,101,101];console.log(j.length);j.forEach((e,t)=>{((j[le(j,t)-1]||-Number.MAX_VALUE)>=t||(j[le(j,t)]||Number.MAX_VALUE)<t)&&console.log(t,le(j,t),(j[le(j,t)-1]||-Number.MAX_VALUE)<t,(j[le(j,t)]||Number.MAX_VALUE)>=t)});class ia{constructor(t){s(this,"_field");s(this,"_records",[]);s(this,"getIndexOfStartPoint",t=>le(this._records.map(i=>i.movedAt.totalProcSeq),t));s(this,"push",t=>{this._records.push(t)});s(this,"getCurrentTurnLog",()=>this.getTermLog("Current","turn"));s(this,"getPriviousChainLog",()=>this.getTermLog("Previous","chainSeq"));this._field=t}*getTermLog(t,i){const a=t==="Current"?this._field.duel.clock.currentStartPoints[i]:this._field.duel.clock.previousStartPoints[i];for(let r=this.getIndexOfStartPoint(a);r<this._records.length;r++)yield this._records[r]}}class aa{constructor(t){s(this,"entity");s(this,"_records");s(this,"_push",t=>{this.entity.field.moveLog.push(t),this._records.push(t)});s(this,"pushForRuleAction",t=>{this._push({entity:this.entity,kind:this.entity.origin.kind,cell:this.entity.fieldCell,face:this.entity.face,orientation:this.entity.orientation,isPending:this.entity.info.isPending,movedAt:this.entity.duel.clock.getClone(),movedAs:[...t,"Rule"]})});s(this,"push",(t,i,a,r,n)=>{let l=this.entity.fieldCell;this.entity.kind==="XyzMaterial"&&(l=this.entity.controller.getXyzMaterialZone()),this._push({entity:this.entity,kind:t,cell:l,face:this.entity.face,orientation:this.entity.orientation,isPending:this.entity.info.isPending,movedAt:this.entity.duel.clock.getClone(),movedAs:i.getDistinct(),movedBy:a,actionOwner:r,chooser:n??r})});s(this,"finalize",()=>{if(!this.latestRecord.isPending)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂Ê≥Å");if(this.entity.info.isPending)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂Ê≥Å");this._push({...this.latestRecord,isPending:!1,movedAt:this.entity.duel.clock.getClone()})});s(this,"negateSummon",(t,i)=>{const a=this.records.slice(-1)[0];a.cell=this.entity.field.getCells("Disable")[0],a.movedBy=t,a.movedAs=["SummonNegated"],a.actionOwner=i});this.entity=t,this._records=[]}get records(){return this._records}get latestRecord(){return this.records.slice(-1)[0]}get previousPlaceRecord(){return this.records.findLast(t=>t.cell.cellType!==this.entity.fieldCell.cellType)??this._records[0]}get currentProcRecords(){return this.records.filter(t=>t.movedAt.totalProcSeq===this.entity.duel.clock.totalProcSeq)}}const ra={name:"SpellCounter",type:"Actual",text:"È≠îÂäõ„Ç´„Ç¶„É≥„Çø„Éº",emoji:"üîÆ",sticky:!1,temporary:!1,isOnlyOnField:!0},na={name:"KaijuCounter",type:"Actual",text:"Â£äÁç£„Ç´„Ç¶„É≥„Çø„Éº",emoji:"‚ò¢",sticky:!1,temporary:!1,isOnlyOnField:!0},sa={name:"NamelessCounter",type:"Actual",text:"„Ç´„Ç¶„É≥„Çø„Éº",emoji:"üí†",sticky:!1,temporary:!1,isOnlyOnField:!0},la={name:"IceCounter",type:"Actual",text:"„Ç¢„Ç§„Çπ„Ç´„Ç¶„É≥„Çø„Éº",emoji:"‚ùÑ",sticky:!1,temporary:!1,isOnlyOnField:!0},oa={name:"SelfDestruction",type:"System",text:"Ëá™Â£ä",emoji:"",sticky:!1,temporary:!1,isOnlyOnField:!0},ca={name:"CycleFlip",type:"System",text:"„Çµ„Ç§„ÇØ„É´„É™„Éê„Éº„Çπ",emoji:"",sticky:!0,temporary:!0,isOnlyOnField:!0},ua={name:"SonicBarrier",type:"System",text:"Ê≥¢ÂãïÈü≥Â£Å",emoji:"",sticky:!0,temporary:!0,isOnlyOnField:!0},da={name:"SonicVerse",type:"System",text:"Ê≥¢ÂãïËÅñÂè•ÔºàÈÅ©Áî®Ê∏àÔºâ",emoji:"",sticky:!0,temporary:!0,isOnlyOnField:!0},pa={name:"IntoTheVoid",type:"System",text:"ÁÑ°„ÅÆÁÖâÁçÑ",emoji:"",sticky:!0,temporary:!0,isOnlyOnField:!1},fa={name:"GoldSarcophagus",type:"System",text:"Â∞ÅÂç∞„ÅÆÈªÑÈáëÊ´É",emoji:"",sticky:!0,temporary:!1,isOnlyOnField:!1},ha={SpellCounter:ra,KaijuCounter:na,NamelessCounter:sa,IceCounter:la,SelfDestruction:oa,CycleFlip:ca,SonicBarrier:ua,SonicVerse:da,IntoTheVoid:pa,GoldSarcophagus:fa},oe=ha,lt=Object.values(oe).filter(e=>e.type==="Actual").filter(e=>e.sticky||e.temporary||!e.isOnlyOnField);if(lt.length)throw new Error(`„Ç´„Ç¶„É≥„Çø„Éº„ÅÆË®≠ÂÆöË™§„Çä„ÄÇ${lt.map(e=>e.name).join(", ")}`);const jn=e=>oe[e].emoji;class ga{constructor(t){s(this,"dic");s(this,"temporaryCounterNames");s(this,"entity");s(this,"add",(t,i=1,a)=>{this.dic[t]=[...this.dic[t]??[],...Array(i).fill(a)];const r=this.entity.status.maxCounterQty[t]??0;return r&&(this.dic[t]=this.dic[t].slice(0,r)),this.dic[t]});s(this,"setQty",(t,i=1,a)=>(this.dic[t]=[...Array(i).fill(a)],this.dic[t]));s(this,"remove",(t,i=1,a)=>{const r=this.dic[t].length;if(r===void 0)return[];if(i>=r)return delete this.dic[t],[];if(a){const n=this.dic[t].filter(o=>o===a),l=this.dic[t].filter(o=>o!==a);this.dic[t]=[...n.slice(i),...l]}else this.dic[t]=this.dic[t].slice(i);return this.dic[t]});s(this,"removeAll",(t,i)=>{if(i){const r=this.dic[t].filter(n=>n===i).length;return this.dic[t]=this.dic[t].filter(n=>n!==i),r}const a=this.dic[t];return delete this.dic[t],a});s(this,"getQty",(t,i)=>this.dic[t]?i?this.dic[t].filter(a=>a===i).length:this.dic[t].length??0:0);s(this,"setSelfDestructionFlg",t=>{this.add("SelfDestruction",1,t)});s(this,"getSelfDestructionFlg",t=>this.getQty("SelfDestruction",t)>0);s(this,"incrementActionCountPerTurn",t=>{this.temporaryCounterNames.push(t.title),this.incrementActionCount(t)});s(this,"incrementActionCount",t=>{this.dic[t.title]=[t.entity,...this.dic[t.title]??[]]});s(this,"getActionCount",t=>this.dic[t.title]?this.dic[t.title].filter(i=>i===t.entity).length:0);s(this,"corpseDisposal",()=>{this.temporaryCounterNames.forEach(t=>delete this.dic[t]),this.temporaryCounterNames.reset(),Object.values(oe).filter(t=>t.temporary).forEach(t=>delete this.dic[t.name])});s(this,"removeAllActualCounters",()=>{Object.values(oe).filter(t=>t.type==="Actual").forEach(t=>delete this.dic[t.name])});s(this,"removeAllWhenfaceDown",()=>{this.temporaryCounterNames.forEach(t=>delete this.dic[t]),this.temporaryCounterNames.reset(),Object.values(oe).filter(t=>!t.sticky).forEach(t=>delete this.dic[t.name])});s(this,"clear",()=>{this.temporaryCounterNames.forEach(t=>delete this.dic[t]),this.temporaryCounterNames.reset(),Object.values(oe).filter(t=>t.isOnlyOnField).forEach(t=>delete this.dic[t.name])});this.dic={},this.temporaryCounterNames=[],this.entity=t}}class ya extends ye{constructor(){super(...arguments);s(this,"afterDistributeAll",i=>i.field.getAllEntities().map(a=>a.statusOperatorBundle).every(a=>a.calcStatus()))}}class va extends ve{constructor(){super(...arguments);s(this,"calcStatus",()=>{const i=this.entity.isEffective;return this.entity.resetStatus(),this.entity.status=this._operators.filter(a=>a.isSpawnedBy.isEffective||!a.isContinuous).reduce((a,r)=>({...a,...r.statusCalculator(r,a)}),this.entity.status),this.entity.isEffective===i});s(this,"beforePush",()=>{})}}class Q extends ae{constructor(i,a,r,n,l,o,u){super(i,a,r,n,l,o);s(this,"beforeRemove",()=>{});s(this,"statusCalculator");this.statusCalculator=u}}const Fe=class Fe{constructor(t,i,a){s(this,"seq");s(this,"entity");s(this,"_definition");s(this,"validateDuelist",t=>this.entity.controller===t?this.definition.executableDuelistTypes.includes("Controller"):this.definition.executableDuelistTypes.includes("Opponent"));this.seq=t==="AutoSeq"?Fe.nextSeq++:t,this.entity=i,this._definition=a}get definition(){return this._definition}get title(){return this.definition.title}get isMandatory(){return this.definition.isMandatory}get executableCells(){return this.definition.executableCells}get executablePeriods(){return this.definition.executablePeriods}get executableDuelistTypes(){return this.definition.executableDuelistTypes}get isOnlyNTimesPerDuel(){return this.definition.isOnlyNTimesPerDuel??0}get isOnlyNTimesPerTurn(){return this.definition.isOnlyNTimesPerTurn??0}get isOnlyNTimesPerTurnIfFaceup(){return this.definition.isOnlyNTimesPerTurnIfFaceup??0}get isOnlyNTimesIfFaceup(){return this.definition.isOnlyNTimesIfFaceup??0}get isOnlyNTimesPerChain(){return this.definition.isOnlyNTimesPerChain??0}get actionGroupName(){return this.definition.actionGroupName}get duel(){return this.entity.duel}};s(Fe,"nextSeq",0);let De=Fe;const fe=class fe extends De{constructor(){super(...arguments);s(this,"isApplicableTo",(i,a,r)=>{const n=this.entity.counterHolder.getActionCount(this);return this.isOnlyNTimesPerTurnIfFaceup>0&&n>=this.isOnlyNTimesPerTurnIfFaceup?this.entity.counterHolder.incrementActionCountPerTurn(this):this.isOnlyNTimesIfFaceup>0&&n>=this.isOnlyNTimesIfFaceup&&this.entity.counterHolder.incrementActionCount(this),this.definition.isApplicableTo(this,i,a,r)});s(this,"substitute",async(i,a,r)=>{const n=await this.definition.substitute(this,i,a,r);return this.isOnlyNTimesPerTurnIfFaceup>0?this.entity.counterHolder.incrementActionCountPerTurn(this):this.isOnlyNTimesIfFaceup>0&&this.entity.counterHolder.incrementActionCount(this),n});s(this,"getClone",()=>new fe(this.seq,this.entity,this.definition))}get definition(){return super.definition}};s(fe,"createNew",(i,a)=>new fe("AutoSeq",i,a));let Ue=fe;class ma extends ye{constructor(){super(...arguments);s(this,"afterDistributeAll",()=>!0)}}class Sa extends ve{constructor(){super(...arguments);s(this,"beforePush",()=>{});s(this,"filter",(i,a,r,n,l,o,u)=>this.effectiveOperators.filter(c=>c.summonKinds.includes(a)).reduce((c,d)=>({...c,...d.filter(this.entity,i,l.summoner,[a,...r],n,l.monster,o,c.posList,c.cells,u)}),l))}}class Ca extends ae{constructor(i,a,r,n,l,o,u,c){super(i,a,r,n,l,o);s(this,"beforeRemove",()=>{});s(this,"summonKinds");s(this,"filter");this.summonKinds=u,this.filter=(...d)=>c(this,...d)}}const M=class M{constructor(){}};s(M,"_tryMarkForDestory",(t,i)=>{if(t.info.isDying||t.kind==="XyzMaterial"||!t.isOnFieldStrictly&&t.fieldCell.cellType!=="Deck"&&t.fieldCell.cellType!=="Hand")return!1;const a=i.action.playType==="Battle"?"BattleDestroy":"EffectDestroy",r=a==="BattleDestroy"&&i.action.entity===t?i.selectedEntities[0]:i.action.entity;return t.info.isDying=t.validateDestory(a,i.activator,r,i.action),t.info.isDying&&(t.info.causeOfDeath=[a],t.info.isKilledBy=r,t.info.isKilledByWhom=i.activator,a==="BattleDestroy"&&(t.info.isKilledByWhom=r.controller)),t.info.isDying}),s(M,"excavateManyFromDeck",async(t,i,a,r,n)=>{const l=t.getDeckCell().cardEntities.slice(0,i);return await b.moveMany(l.map(o=>[o,o.fieldCell,o.kind,"FaceUp",o.orientation,"Fix",["Excavate",...a],r,n,void 0])),l}),s(M,"releaseManyForTheSameReason",(t,i,a,r)=>t.length?(i.includes("Cost")&&r.writeInfoLog(`${t.map(n=>n.toString()).join(" ")}„Çí„É™„É™„Éº„Çπ„Åó‚Äï‚Äï„ÄÅ`),M.bringManyToSameCellForTheSameReason("Graveyard","Top",t,"FaceUp","Vertical",["Release",...i],a,r)):Promise.resolve([])),s(M,"sendManyToGraveyardForTheSameReason",(t,i,a,r)=>t.length?(r&&i.includes("Cost")&&(i.includes("FusionMaterial")?r.writeInfoLog(`${t.map(n=>n.toString()).join(" ")}„ÇíËûçÂêàÁ¥†Êùê„Å®„Åó‚Äï‚Äï„ÄÅ`):i.includes("SyncroMaterial")?r.writeInfoLog(`${t.map(n=>n.toString()).join(" ")}„Çí„Ç∑„É≥„ÇØ„É≠„Å®Á¥†Êùê„Åó‚Äï‚Äï„ÄÅ`):i.includes("LinkMaterial")?r.writeInfoLog(`${t.map(n=>n.toString()).join(" ")}„Çí„É™„É≥„ÇØ„Éû„Éº„Ç´„Éº„Å´„Çª„ÉÉ„ÉÜ„Ç£„É≥„Ç∞‚Äï‚Äï„ÄÅ`):r.writeInfoLog(`${t.map(n=>n.toString()).join(" ")}„ÇíÂ¢ìÂú∞„Å´ÈÄÅ„Çä‚Äï‚Äï„ÄÅ`)),M.bringManyToSameCellForTheSameReason("Graveyard","Top",t,"FaceUp","Vertical",i,a,r)):Promise.resolve([])),s(M,"addManyToHand",(t,i,a,r)=>t.length?M.bringManyToSameCellForTheSameReason("Hand","Bottom",t,"FaceDown","Vertical",i,a,r):Promise.resolve([])),s(M,"discardManyForTheSameReason",(t,i,a,r)=>t.length?(r&&i.includes("Cost")&&r.writeInfoLog(`${t.map(n=>n.toString()).join(" ")}„ÇíÊâãÊú≠„Åã„ÇâÊç®„Å¶‚Äï‚Äï„ÄÅ`),M.bringManyToSameCellForTheSameReason("Graveyard","Top",t,"FaceUp","Vertical",["Discard",...i],a,r)):Promise.resolve([])),s(M,"banishManyForTheSameReason",(t,i,a,r)=>t.length?(r&&i.includes("Cost")&&r.writeInfoLog(`${t.map(n=>n.toString()).join(" ")}„Çí„Ç≤„Éº„É†„Åã„ÇâÈô§Â§ñ„Åó‚Äï‚Äï„ÄÅ`),M.bringManyToSameCellForTheSameReason("Banished","Top",t,"FaceUp","Vertical",i,a,r)):Promise.resolve([])),s(M,"returnManyToDeckForTheSameReason",(t,i,a,r,n)=>i.length?(n&&a.includes("Cost")&&n.writeInfoLog(`${i.map(l=>l.toString()).join(" ")}„Çí„Éá„ÉÉ„Ç≠„Å´Êàª„Åó‚Äï‚Äï„ÄÅ`),M.bringManyToSameCellForTheSameReason("Deck",t,i,"FaceDown","Vertical",a,r,n)):Promise.resolve([])),s(M,"returnManyToHandForTheSameReason",(t,i,a,r)=>t.length?(r&&i.includes("Cost")&&r.writeInfoLog(`${t.map(n=>n.toString()).join(" ")}„ÇíÊâãÊú≠„Å´Êàª„Åó‚Äï‚Äï„ÄÅ`),M.bringManyToSameCellForTheSameReason("Hand","Bottom",t,"FaceDown","Vertical",i,a,r)):Promise.resolve([])),s(M,"convertManyToXyzMaterials",(t,i,a,r)=>t.length?(r&&i.includes("Cost")&&r.writeInfoLog(`${t.map(n=>n.toString()).join(" ")}„Å´„Çà„Å£„Å¶„ÄÅ„Ç™„Éº„Éê„Éº„É¨„Ç§„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„ÇíÊßãÁØâ‚Äï‚Äï„ÄÅ`),b.moveMany(t.map(n=>[n,n.fieldCell,"XyzMaterial","FaceUp","Vertical","Top",i,a,r,r]))):Promise.resolve()),s(M,"moveToXyzOwner",(t,i,a,r,n)=>i.length?(a.includes("Effect")&&n.writeInfoLog(`${i.map(l=>l.toString()).join(" ")}„ÇíXYZÁ¥†Êùê„Å®„Åó„Å¶Âê∏Âèé„ÄÇ`),b.moveMany(i.map(l=>[l,t,"XyzMaterial","FaceUp","Vertical","Top",a,r,n,n]))):Promise.resolve()),s(M,"banishMany",(t,i)=>b.bringManyToSameCell("Banished","Top",t.map(a=>({...a,face:"FaceUp",orientation:"Vertical"})),i)),s(M,"bringManyToSameCellForTheSameReason",(t,i,a,r,n,l,o,u)=>b.bringManyToSameCell(t,i,a.map(c=>({entity:c,face:r,orientation:n,causedAs:l,causedBy:o,activator:u})))),s(M,"tryDestroy",async(t,i)=>{const a=await M.tryMarkForDestory(t,i);return await M.waitCorpseDisposal(i.activator.duel),a}),s(M,"waitCorpseDisposal",t=>b.sendManyToGraveyard([...t.field.getCardsOnFieldStrictly(),...t.field.getPendingCardsOnField()].filter(i=>i.info.isDying).map(i=>({entity:i,causedAs:i.info.causeOfDeath??[],causedBy:i.info.isKilledBy,activator:i.info.isKilledByWhom})))),s(M,"tryMarkForDestory",async(t,i)=>{let a=t.filter(o=>M._tryMarkForDestory(o,i));if(!a.length)return[];const r=i.action.playType==="Battle"?"BattleDestroy":"EffectDestroy";(await Promise.all(t[0].field.getAllEntities().flatMap(o=>o.substituteEffects.filter(u=>u.isMandatory).filter(u=>u.executableCells.includes(o.fieldCell.cellType)).filter(u=>u.isApplicableTo(r,t,i).length).flatMap(u=>u.substitute(r,t,i))))).flatMap(o=>o).forEach(o=>{o.resetCauseOfDeath()}),a=a.filter(o=>o.info.isDying);let n=t[0].field.getAllEntities().flatMap(o=>o.substituteEffects.filter(u=>!u.isMandatory).filter(u=>u.executableCells.includes(o.fieldCell.cellType)).filter(u=>u.isApplicableTo(r,t,i).length).map(u=>({chooser:o.owner,effect:u,sacrifice:o})));for(const o of n.map(u=>u.sacrifice.controller).getDistinct()){const u=n.filter(d=>d.sacrifice.controller===o),c=await o.duel.view.waitSelectAction(o,u.map(d=>({entity:d.sacrifice,title:d.effect.title,origin:d.effect})),"Ë∫´‰ª£„Çè„ÇäÂäπÊûú„ÇíÈÅ©Áî®„Åô„ÇãÔºü",!0);if(c){if((await c.substitute(r,a,i)).forEach(d=>{d.resetCauseOfDeath()}),a=a.filter(d=>d.info.isDying),!a.length)return[];n=n.filter(d=>d.effect.isApplicableTo(r,t,i).length)}}const l=a.filter(o=>o.info.isDying);return l.forEach(o=>o.duel.log.info(`${o.toString()}„Çí${Da[r]}„ÄÇ`,o.info.isKilledByWhom)),l}),s(M,"tryBanish",async(t,i,a)=>{const r=i.filter(n=>n.canBeBanished(t,a.activator,a.action.entity,a.action));return await M.banishManyForTheSameReason(r,["Effect"],a.action.entity,a.activator),r.filter(n=>n.fieldCell.cellType==="Banished").filter(n=>n.moveLog.latestRecord.movedBy===a.action.entity)}),s(M,"negateSummonMany",(t,i)=>{const a=i.duel.field.getPendingMonstersOnField();return a.forEach(r=>{r.info.summonKinds=[],r.info.materials=[],r.moveLog.negateSummon(t,i)}),i.writeInfoLog(`${a.map(r=>r.toString()).join(" ")}.„ÅÆÂè¨Âñö„ÅØÁÑ°Âäπ„Å´„Åï„Çå„Åü„ÄÇ`),a}),s(M,"drawAtSameTime",async(t,i,a,r)=>{const n=[],l=[],o=[t.draw(a,i,t),t.getOpponentPlayer().draw(r,i,t)].map(u=>u.catch(c=>{c instanceof $?c.winner&&n.push(c.winner):l.push(c)}));if(await Promise.all(o),l.length)throw new m("„Éâ„É≠„ÉºÂá¶ÁêÜ„ÅßÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑ‰æãÂ§ñ„ÅåÁô∫Áîü„Åó„Åü„ÄÇ",t,a,r,i,...l);if(n.length!==0)throw n.length===1?new $(n[0],"ÂØæÊà¶Áõ∏Êâã„Åå„Éá„ÉÉ„Ç≠„Åã„Çâ„Éâ„É≠„Éº„Åß„Åç„Å™„Åã„Å£„Åü„ÄÇ"):new $(void 0,"„Åä‰∫í„ÅÑ„Å´„Éá„ÉÉ„Ç≠„Åã„Çâ„Ç´„Éº„Éâ„Çí„Éâ„É≠„Éº„Åß„Åç„Å™„Åã„Å£„Åü„ÄÇ")});let v=M;class Ta extends ye{constructor(){super(...arguments);s(this,"afterDistributeAll",()=>!0)}}class ka extends ve{constructor(){super(...arguments);s(this,"beforePush",()=>{})}}class Pt extends ae{constructor(i,a,r,n,l,o,u,c){super(i,a,r,n,l,o);s(this,"beforeRemove",()=>{});s(this,"calcType");s(this,"filter");this.calcType=u,this.filter=(...d)=>c(this,...d)}}const Le=(e,t,...i)=>e.filter(a=>t.includes(a.calcType)).reduce((a,r)=>({...a,...r.filter(...i)}),{}),Mt=(...e)=>{const[t,i,a,r,n,l,o]=e,u=[a.entity,r,n].filter(p=>!!p).flatMap(p=>p.damageFilterBundle.effectiveOperators);let c=Le(u,["double_typeA","eachOther_typeA","eachOther_typeB","asEffectDamage"],...e);const d={point:t,damageToOpponent1:0,damageToOpponent2:0,damageType:l};return c.double_typeA&&(d.point*=2),c.asEffectDamage&&(d.damageType="EffectDamage"),c={...Le(u,["heal","zero_typeA","half","double_typeB","fix"],d.point,i,a,r,n,d.damageType,o),...c},c.fix!==void 0?d.point=c.fix:c.zero_typeA?d.point=0:(c.half&&(d.point=Math.round(d.point/2)),c.double_typeA&&(d.point*=2)),c={...Le(u,["zero_typeB"],d.point,i,a,r,n,d.damageType,o),...c},c.zero_typeB&&(d.point=0),c.heal?d.damageType="Heal":(c.eachOther_typeA&&(d.damageToOpponent1=d.point),c.eachOther_typeB&&(d.damageToOpponent2=d.point,c.eachOther_typeB==="Substitude"&&(d.point=0))),d},Ea=(e,t,i)=>Mt(e,t.activator,i,t.action.entity,void 0,"EffectDamage",t.action),wa=(e,t,i,a,r,n)=>Mt(e,t,i,a,r.entityType==="Duelist"?void 0:r,"BattleDamage",n),At=["FusionSummon","SyncroSummon","XyzSummon","PendulumSummon","LinkSummon","RitualSummon","FlipSummon"],_a={FusionSummon:"ËûçÂêàÂè¨Âñö",SyncroSummon:"„Ç∑„É≥„ÇØ„É≠Âè¨Âñö",XyzSummon:"„Ç®„ÇØ„Ç∑„Éº„Ç∫Âè¨Âñö",PendulumSummon:"„Éö„É≥„Éá„É•„É©„É†Âè¨Âñö",LinkSummon:"„É™„É≥„ÇØÂè¨Âñö",RitualSummon:"ÂÑÄÂºèÂè¨Âñö",FlipSummon:"ÂèçËª¢Âè¨Âñö"},ba=[...At,"AdvanceSummon","NormalSummon","SpecialSummon"],Da={BattleDestroy:"Êà¶ÈóòÁ†¥Â£ä",EffectDestroy:"ÂäπÊûúÁ†¥Â£ä",RuleDestroy:"„É´„Éº„É´Á†¥Â£ä"},xt=e=>e+"Summon",ot=["Card","Token","Avatar"],Pa=["Duelist","Squatter"],Un=(e,t)=>kt(e.origin,t.origin),O=class O{constructor(t,i,a,r,n,l){s(this,"onBeforeMoveEvent",new at);s(this,"onAfterMoveEvent",new at);s(this,"seq");s(this,"origin");s(this,"entityType");s(this,"summonFilterBundle");s(this,"procFilterBundle");s(this,"numericOprsBundle");s(this,"statusOperatorBundle");s(this,"damageFilterBundle");s(this,"moveLog");s(this,"counterHolder");s(this,"face");s(this,"orientation");s(this,"owner");s(this,"fieldCell");s(this,"_status");s(this,"_numericStatus");s(this,"_info");s(this,"actions",[]);s(this,"continuousEffects",[]);s(this,"substituteEffects",[]);s(this,"canBeReleased",(t,i,a,r)=>!this.isInTrashCell&&this.procFilterBundle.effectiveOperators.filter(n=>n.procTypes.union(a).length).every(n=>n.filter(t,i,r,[this])));s(this,"canBeSentToGraveyard",(t,i,a,r)=>!this.status.willBeBanished&&!this.status.willReturnToDeck&&this.procFilterBundle.effectiveOperators.filter(n=>n.procTypes.includes(a)).every(n=>n.filter(t,i,r,[this])));s(this,"_hasDisappeared",!1);s(this,"definition");s(this,"toString",()=>this.entityType==="Card"?`„Ää${this.nm}„Äã`:this.nm);s(this,"onUsedAsMaterial",(t,i)=>{this.definition&&this.definition.onUsedAsMaterial&&this.definition.onUsedAsMaterial(t,i)});s(this,"setBattlePosition",async(t,i,a,r)=>{let n=`Ë°®Á§∫ÂΩ¢Âºè„ÅÆÂ§âÊõ¥Ôºö${this.toString()}Ôºà${this.battlePositionName}‚áí${ke[t]}Ôºâ`;const l=[...i];this.battlePosition==="Set"&&(l.push("Flip"),i.includes("Rule")&&(this.info.isPending=!0,n=`${this.toString()}„ÇíÂèçËª¢Âè¨Âñö`,this.info.summonKinds.push("FlipSummon"),l.push("FlipSummon"),l.push("AttackSummon"))),this.duel.log.info(n,r),await this.moveAlone(this.fieldCell,"Monster",t==="Set"?"FaceDown":"FaceUp",t==="Attack"?"Vertical":"Horizontal","Top",l,a,r,r)});s(this,"activateAsPendulumScale",(t,i,a,r)=>this.moveAlone(t,"Spell","FaceUp","Vertical","Top",["CardActivation",...i],a,r,r));s(this,"setNonFieldMonsterPosition",async(t,i,a,r,n)=>{this.moveAlone(this.fieldCell,t,i==="FaceUp"?"FaceUp":"FaceDown","Vertical","Top",a,r,n,n)});s(this,"setAsSpellTrap",async(t,i,a,r,n)=>{await this.moveAlone(t,i,"FaceDown","Vertical","Top",[...a,"SpellTrapSet"],r,n,n)});s(this,"activateSpellTrapFromHand",async(t,i,a,r,n)=>{await this.moveAlone(t,i,"FaceUp","Vertical","Top",[...a,"CardActivation"],r,n,n)});s(this,"putDirectly",async(t,i,a,r,n)=>{await this.moveAlone(t,i,"FaceUp","Vertical","Top",[...a,"PutDirectly"],r,n,n)});s(this,"activateSpellTrapOnField",async(t,i,a,r)=>{await this.moveAlone(this.fieldCell,t,"FaceUp","Vertical","Top",[...i,"CardActivation"],a,r,r)});s(this,"draw",async(t,i,a)=>await this.addToHand([...t,"Draw"],i,a));s(this,"addToHand",async(t,i,a)=>await this.moveAlone(this.owner.getHandCell(),this.origin.kind,"FaceDown","Vertical","Bottom",[...t],i,a,a));s(this,"summon",(t,i,a,r,n,l,o)=>O.summonMany([{monster:this,dest:t,summoner:o??l,pos:i}],a,r,n,l));s(this,"moveForcibly",async(t,i,a,r,n,l,o)=>{await this.moveAlone(t,this.origin.kind,i,a,r,["Rule",...n],l,o,o)});s(this,"moveAlone",async(t,i,a,r,n,l,o,u,c)=>(await O.moveMany([[this,t,i,a,r,n,l,o,u,c]],void 0),this.fieldCell));s(this,"determine",()=>{this.info.isPending&&(this.info.isPending=!1,this.moveLog.finalize(),this.continuousEffects.forEach(t=>t.updateState()))});s(this,"_move",async(t,i,a,r,n,l,o,u,c)=>{if(!t)throw new Error("illegal argument: to");if(await this.onBeforeMoveEvent.trigger({entity:this,args:[t,i,a,r,n,l,o,u,c]}),this.face=a,this.orientation=r,t!==this.fieldCell&&this.field.duel.clock.turn>0&&(this.duel.log.info(`ÁßªÂãïÔºö${this.toString()}  ${this.fieldCell.toString()} ‚áí ${t.toString()}`,u),await this.field.duel.view.waitAnimation({entity:this,to:t,index:n,count:0})),t!==this.fieldCell||n==="Random"){if(this.fieldCell.releaseEntities(this),this.fieldCell.isPlayFieldCell&&!t.isPlayFieldCell&&(this.counterHolder.clear(),this.resetCauseOfDeath(),this.entityType==="Token")){this._hasDisappeared=!0,this.field.duel.log.info(`${this.nm}„ÅØÊ∂àÊªÖ„Åó„Åü„ÄÇ`,this.controller);return}this.kind!=="XyzMaterial"&&(this.fieldCell.isMonsterZoneLikeCell&&!t.isMonsterZoneLikeCell||i!=="Monster")&&(this.info.equipEntities.filter(d=>d.isOnFieldAsSpellTrapStrictly).forEach(d=>{d.info.isDying=!0,d.info.causeOfDeath=["RuleDestroy"],this.controller.writeInfoLog(`Ë£ÖÂÇôÂØæË±°${this.toString()}‰∏çÂú®„Å´„Çà„Çä${d.toString()}„ÅØÁ†¥Â£ä„Åï„Çå„Åü„ÄÇ`)}),this.info.equipEntities=[],this.fieldCell.xyzMaterials.forEach(d=>{d.info.isDying=!0,d.info.causeOfDeath=["LostXyzOwner"],this.controller.writeInfoLog(`„Ç®„ÇØ„Ç∑„Éº„Ç∫„É¢„É≥„Çπ„Çø„Éº${this.toString()}‰∏çÂú®„Å´„Çà„Çä${d.toString()}„ÅØÂ¢ìÂú∞„Å´ÈÄÅ„Çâ„Çå„Åü„ÄÇ`)}),this.resetNumericStatus(),this.info.isEffectiveIn.push(...X)),this.fieldCell.cellType==="SpellAndTrapZone"&&t.cellType!=="SpellAndTrapZone"&&(this.info.equipedBy=void 0,this.info.equipedAs=void 0,this.info.isEffectiveIn.push(...X)),console.log(this.toString(),t.cellType,n),t.acceptEntities(this,n),(t===this.isBelongTo||t.cellType==="Hand"||t.cellType==="Banished"&&this.face==="FaceDown")&&(this.counterHolder.clear(),this.resetInfoAll(),this.resetStatusAll())}return(this.isOnFieldStrictly&&this.face==="FaceDown"||i==="XyzMaterial")&&(this.info.equipEntities.forEach(d=>{d.info.isDying=!0,d.info.causeOfDeath=["RuleDestroy"],this.controller.writeInfoLog(`Ë£ÖÂÇôÂØæË±°${this.toString()}‰∏çÂú®„Å´„Çà„Çä${d.toString()}„ÅØÁ†¥Â£ä„Åï„Çå„Åü„ÄÇ`)}),this.counterHolder.removeAllWhenfaceDown(),this.info.materials=[],this._status.isEffective=!0,this.info.isEffectiveIn=[...K],this.resetNumericStatus(),this.info.isSettingSickness=this.kind==="Trap"||this.status.spellCategory==="QuickPlay"),this._info.kind=i,this.moveLog.push(i,l,o,u,c),await this.onAfterMoveEvent.trigger(this),t});s(this,"initForTurn",()=>{this.info.isSettingSickness=!1,this.info.attackDeclareCount=0,this.info.battlePotisionChangeCount=0,this.counterHolder.corpseDisposal()});s(this,"resetInfoIfLeavesTheField",()=>{this._info={...this._info,isDying:!1,isPending:!1,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,effectTargets:{},attackDeclareCount:0,battlePotisionChangeCount:0,materials:[],equipedBy:void 0,equipedAs:void 0,equipEntities:[]},this._info.isEffectiveIn.push(...X),this._info.isEffectiveIn.distinct()});s(this,"resetInfoAll",()=>{var t;this._info={kind:this.origin.kind,isDying:!1,isPending:!1,isEffectiveIn:[...K],causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,isVanished:!1,isRebornable:((t=this.origin.monsterCategories)==null?void 0:t.union(mt).length)===0,isSettingSickness:!1,summonKinds:[],materials:[],effectTargets:{},attackDeclareCount:0,battlePotisionChangeCount:0,equipedBy:void 0,equipedAs:void 0,validateEquipOwner:()=>!0,equipEntities:[],battleLog:[]},this.counterHolder.clear()});s(this,"resetNumericStatus",()=>{const t=Ct.reduce((i,a)=>(i[a]=this.origin[a],i),{});this._numericStatus={origin:{...t},wip:{...t},calculated:{...t}}});s(this,"resetStatus",()=>{this._status={...this.origin,canAttack:!0,isEffective:!0,canDirectAttack:!1,canActivateEffect:!0,isSelectableForAttack:!0,allowHandSyncro:!1,allowHandLink:!1,willBeBanished:!1,willReturnToDeck:void 0,maxCounterQty:{},piercingTo:[]}});s(this,"resetStatusAll",()=>{this.resetNumericStatus(),this.resetStatus()});s(this,"resetCauseOfDeath",()=>{this.info.isDying=!1,this.info.causeOfDeath=[],this.info.isKilledBy=void 0,this.info.isKilledByWhom=void 0});this.seq=O.nextEntitySeq++,this.counterHolder=new ga(this),this.definition=r,this.owner=t,this.fieldCell=i,this.entityType=a,this.origin=r.staticInfo,this._status=JSON.parse(JSON.stringify(r.staticInfo)),this._numericStatus=JSON.parse(JSON.stringify(r.staticInfo)),this.resetStatusAll(),this._info={kind:this.origin.kind,isEffectiveIn:[...K],attackDeclareCount:0,battlePotisionChangeCount:0,isDying:!1,isPending:!1,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,isVanished:!1,isRebornable:!0,isSettingSickness:!1,summonKinds:[],materials:[],effectTargets:{},equipedBy:void 0,equipedAs:void 0,validateEquipOwner:()=>!0,equipEntities:[],battleLog:[]},this.resetInfoAll(),this.face=n,this.orientation=l,this.summonFilterBundle=new Sa(i.field.summonFilterPool,this),this.procFilterBundle=new Vi(i.field.procFilterPool,this),this.numericOprsBundle=new Qi(i.field.numericStateOperatorPool,this),this.statusOperatorBundle=new va(i.field.statusOperatorPool,this),this.damageFilterBundle=new ka(i.field.damageFilterPool,this),i.acceptEntities(this,"Top"),this.moveLog=new aa(this),this.moveLog.pushForRuleAction(["Spawn"]);let o=[];o=r.continuousEffects??[],this.substituteEffects.push(...(r.substituteEffects??[]).map(u=>Ue.createNew(this,u))),this.origin.kind==="Monster"&&this.entityType==="Card"&&r.summonFilter&&this.summonFilterBundle.push(new Ca("default",()=>!0,!0,this,{},()=>!0,ba,r.summonFilter)),r.defaultStatus&&this.statusOperatorBundle.push(new Q("default",()=>!0,!0,this,{},()=>!0,()=>r.defaultStatus??{})),this.actions.push(...r.actions.map(u=>ue.createNew(this,u))),this.continuousEffects.push(...o.map(u=>je.createNew(this,u)))}get onBeforeMove(){return this.onBeforeMoveEvent.expose()}get onAfterMove(){return this.onAfterMoveEvent.expose()}get isUnderControl(){return this.face==="FaceUp"||Et.every(t=>t!==this.fieldCell.cellType)}get controller(){return this.fieldCell.owner??this.owner}get field(){return this.owner.duel.field}get duel(){return this.owner.duel.field.duel}get actionLogRecords(){return this.duel.chainBlockLog.records.filter(t=>t.chainBlockInfo.action.entity===this)}get status(){return this._status}set status(t){this._status={...t}}get numericStatus(){return this._numericStatus}get info(){return this._info}get kind(){return this.info.kind}get nm(){return this.status.name}get atk(){return this._numericStatus.calculated.attack}get def(){return this._numericStatus.calculated.defense}get lvl(){return this._numericStatus.calculated.level}get rank(){return this._numericStatus.calculated.rank}get attr(){return this.status.attributes??[]}get types(){return this.status.types??[]}get psL(){return this._numericStatus.calculated.pendulumScaleL}get psR(){return this._numericStatus.calculated.pendulumScaleR}get linkArrows(){let t=(this.origin.linkArrowKeys??[]).map(i=>Tt[i].linkArrow);return this.controller.seat==="Above"&&(t=t.map(i=>({offsetColumn:i.offsetColumn*-1,offsetRow:i.offsetRow*-1}))),t}get linkArrowDests(){var t;return(t=this.origin.monsterCategories)!=null&&t.includes("Link")?this.isOnFieldAsMonsterStrictly?this.linkArrows.map(i=>[this.fieldCell.row+i.offsetRow,this.fieldCell.column+i.offsetColumn]).map(([i,a])=>this.field.cells[i][a]).filter(i=>i.isMonsterZoneLikeCell):[]:[]}get linkedEntities(){return this.isOnFieldAsMonsterStrictly?[...this.linkArrowDests.map(t=>t.cardEntities[0]).map(t=>t),...this.fieldCell.linkArrowSources].getDistinct():[]}get coLinkedEntities(){var t;return this.isOnFieldAsMonsterStrictly?(t=this.origin.monsterCategories)!=null&&t.includes("Link")?this.linkArrowDests.map(i=>i.cardEntities[0]).filter(i=>i).union(this.fieldCell.linkArrowSources):[]:[]}get isEffective(){return this.status.isEffective&&this.info.isEffectiveIn.includes(this.fieldCell.cellType)}get isEffectiveWeakly(){return this.status.isEffective}get battlePosition(){if(this.isOnFieldStrictly&&this.kind==="Monster")return this.orientation==="Vertical"?"Attack":this.face==="FaceUp"?"Defense":"Set"}get battlePositionName(){const t=this.battlePosition;if(t)return ke[t]}get wasMovedAtCurrentProc(){return this.field.duel.clock.totalProcSeq===this.moveLog.latestRecord.movedAt.totalProcSeq}get wasMovedAtPreviousProc(){return this.field.duel.clock.totalProcSeq===this.moveLog.latestRecord.movedAt.totalProcSeq+1}get wasMovedAtCurrentTurn(){return this.field.duel.clock.isSameTurn(this.moveLog.latestRecord.movedAt)}get wasMovedAtCurrentChain(){return this.field.duel.clock.isSameChain(this.moveLog.latestRecord.movedAt)}get wasMovedAtPreviousChain(){return this.field.duel.clock.isPreviousChain(this.moveLog.latestRecord.movedAt)}get wasMovedAtPreviousTurn(){return this.field.duel.clock.isPreviousTurn(this.moveLog.latestRecord.movedAt)}get wasMovedFrom(){return this.moveLog.previousPlaceRecord.cell}get isPendulumScale(){var t;return!(!((t=this.origin.monsterCategories)!=null&&t.includes("Pendulum"))||!this.isOnField||!this.fieldCell.isSpellTrapZoneLikeCell||this.status.spellCategory)}get isOnField(){return this.fieldCell.isPlayFieldCell}get isOnFieldStrictly(){return this.isOnField&&!this.info.isPending&&this.kind!=="XyzMaterial"}get isOnFieldAsMonsterStrictly(){return this.fieldCell.isMonsterZoneLikeCell&&this.isOnFieldStrictly}get isOnFieldAsSpellTrapStrictly(){return this.fieldCell.isSpellTrapZoneLikeCell&&this.isOnFieldStrictly}get isInTrashCell(){return this.fieldCell.isTrashCell}get isLikeContinuousSpell(){return this.status.spellCategory==="Continuous"||this.status.spellCategory==="Field"||this.status.spellCategory==="Equip"||this.status.trapCategory==="Continuous"||(this.status.monsterCategories??[]).includes("Pendulum")}get isBelongTo(){return this.origin.monsterCategories&&this.origin.monsterCategories.union(Ee).length?this.owner.getExtraDeck():this.owner.getDeckCell()}get hasDisappeared(){return this._hasDisappeared}get allStickyEffectOperators(){return[...this.procFilterBundle.effectiveOperators,...this.numericOprsBundle.effectiveOperators]}};s(O,"nextEntitySeq",0),s(O,"splitBattlePos",t=>({face:t==="Set"?"FaceDown":"FaceUp",orientation:t==="Attack"?"Vertical":"Horizontal"})),s(O,"recreateArray",(t,i)=>{if(!i.length)return[];const a=t.getAllCells().flatMap(r=>r.entities);return i.map(r=>r.seq).map(r=>a.find(n=>n.seq===r)).filter(r=>r!==void 0)}),s(O,"createPlayerEntity",t=>{const i=t.getHandCell();return new O(t,i,"Duelist",Cn(t),"FaceUp","Vertical")}),s(O,"createCardEntity",(t,i)=>{const a=i.staticInfo.monsterCategories&&i.staticInfo.monsterCategories.union(Ee).length?t.getExtraDeck():t.getDeckCell();return new O(t,a,"Card",i,"FaceDown","Vertical")}),s(O,"moveMany",async(t,i)=>{if(!t.length)return;const a=t[0][0].duel,n=[...t.filter(([o,u])=>o.fieldCell!==u).map(([o])=>o).filter(o=>!(i??[]).includes(o)),...a.field.getCardsOnFieldStrictly().filter(o=>o.info.isDying)],l=new Map;for(t.forEach(([o,u,c,d,p,g,...h])=>{var B;let y=u,P=c,f=d,A=g,L=p;o.status.willBeBanished?(y=o.owner.getBanished(),f="FaceUp",L="Vertical"):o.status.willReturnToDeck?(y=o.isBelongTo,f="FaceDown",A=o.status.willReturnToDeck,L="Vertical"):(B=o.status.monsterCategories)!=null&&B.includes("Pendulum")&&o.isOnFieldStrictly&&o.face==="FaceUp"&&u.isTrashCell&&(y=o.owner.getExtraDeck(),f="FaceUp",A="Top",L="Vertical"),y.cellType==="ExtraDeck"&&(A=f==="FaceUp"?"Top":"Bottom"),o.isBelongTo.cellType==="ExtraDeck"&&(y.cellType==="Hand"||y.cellType==="Deck")&&(y=o.isBelongTo,f="FaceDown",L="Vertical"),y.isPlayFieldCell||(P=o.origin.kind),y.isMonsterZoneLikeCell||(L="Vertical"),l.set(y,[[o,y,P,f,L,A,...h],...l.get(y)??[]])});;){const o=Array.from(l.values()).map(c=>c.pop()).filter(c=>c!==void 0).map(([c,...d])=>c._move(...d));if(!o.length)break;await Promise.all(o);const u=a.field.getCardsOnFieldStrictly().filter(c=>c.info.isDying).filter(c=>!n.includes(c)).map(c=>({entity:c,causedAs:c.info.causeOfDeath??[],causedBy:c.info.isKilledBy,activator:c.info.isKilledByWhom}));u.length&&await O.sendManyToGraveyard(u,n)}O.settleEntityMove(a)}),s(O,"summonMany",async(t,i,a,r,n)=>{if(!t.length)return;const l={Attack:"AttackSummon",Defense:"DefenseSummon",Set:"SetSummon"},o=t.map(({monster:u,dest:c,pos:d,summoner:p})=>{if(u.info.summonKinds=[i],i==="NormalSummon"||i==="AdvanceSummon"){u.info.summonKinds.push("NormalSummon");const y=i==="AdvanceSummon"?"„Ç¢„Éâ„Éê„É≥„Çπ":"";d==="Attack"?u.field.duel.log.info(`${u.toString()}„Çí${y}Âè¨Âñö`,p):u.duel.log.info(`${u.toString()}„Çí${y}„Çª„ÉÉ„Éà`,p),a.includes("Rule")?p.info.ruleNormalSummonCountQty++:p.info.effectNormalSummonCountQty++}else i==="SpecialSummon"?u.duel.log.info(`${u.toString()}„Çí${ke[d]}„ÅßÁâπÊÆäÂè¨Âñö`,p):(u.info.summonKinds.push("SpecialSummon"),u.duel.log.info(`${u.toString()}„Çí${ke[d]}„Åß${_a[i]}ÔºÅ`,p)),p.info.specialSummonCountQty++;u.info.summonKinds=u.info.summonKinds.getDistinct(),u.info.battlePotisionChangeCount=1;const{face:g,orientation:h}=O.splitBattlePos(d);return a.includes("Rule")&&(u.info.isPending=!0),{entity:u,args:[c,"Monster",g,h,"Top",[i,l[d],...a],r,n,p]}}).map(u=>u.entity._move(...u.args));await Promise.all(o),t.map(u=>u.summoner).forEach(u=>{i==="NormalSummon"||i==="AdvanceSummon"?a.includes("Rule")?u.info.ruleNormalSummonCount++:u.info.effectNormalSummonCount++:u.info.specialSummonCount++}),O.settleEntityMove(t[0].monster.duel)}),s(O,"sendManyToGraveyard",(t,i)=>O.bringManyToSameCell("Graveyard","Top",t.map(a=>({...a,face:"FaceUp",orientation:"Vertical"})),i)),s(O,"bringManyToSameCell",async(t,i,a,r)=>(await O.moveMany(a.map(n=>[n.entity,n.entity.field.getCells(t).filter(l=>l.owner===n.entity.owner)[0],n.entity.origin.kind,n.face,n.orientation,i,n.causedAs,n.causedBy,n.activator,n.activator]),r),a.map(n=>n.entity).filter(n=>n.fieldCell.cellType===t))),s(O,"settleEntityMove",t=>{t.field.recalcLinkArrows(),t.distributeOperators(t.clock);const i=t.field.getAllEntities().filter(a=>a.wasMovedAtCurrentProc);i.filter(a=>!a.isOnFieldStrictly&&!a.info.isPending).forEach(a=>a.resetInfoIfLeavesTheField()),i.filter(a=>a.face==="FaceDown").filter(a=>a.fieldCell===a.isBelongTo).forEach(a=>{a.resetInfoAll(),a.resetStatusAll()}),i.flatMap(a=>a.continuousEffects).forEach(a=>a.updateState()),t.field.getAllCells().filter(a=>a.needsShuffle).map(a=>a.shuffle())});let b=O;b.prototype.hasBeenSummonedNow=function(e,t=["Attack","Defense"]){const i=this,a=t.map(xt),r=i.moveLog.latestRecord.movedAs;return!(!i.wasMovedAtPreviousChain||!r.union(e).length||!r.union(a).length)};b.prototype.hasBeenSummonedJustNow=function(e,t=["Attack","Defense"]){const i=this,a=t.map(xt),r=i.moveLog.latestRecord.movedAs;return!(!i.wasMovedAtPreviousProc||!r.union(e).length||!r.union(a).length)};b.prototype.getAttackTargets=function(){const e=this.controller.getOpponentPlayer().getMonstersOnField().filter(t=>t.status.isSelectableForAttack);return console.log(this.toString(),e,this.status.canDirectAttack),(this.status.canDirectAttack||!e.length)&&(console.log(this.toString(),e,this.status.canDirectAttack),e.push(this.controller.getOpponentPlayer().entity)),console.log(this.toString(),e,this.status.canDirectAttack,e.filter(t=>t.canBeTargetOfBattle(this.controller,this)).filter(t=>this.procFilterBundle.effectiveOperators.filter(i=>i.procTypes.includes("BattleTarget")).every(i=>i.filter(this.controller,this,{},[t])))),e.filter(t=>t.canBeTargetOfBattle(this.controller,this)).filter(t=>this.procFilterBundle.effectiveOperators.filter(i=>i.procTypes.includes("BattleTarget")).every(i=>i.filter(this.controller,this,{},[t])))};b.prototype.canDirectAttack=function(){return this.getAttackTargets().some(e=>e.entityType==="Duelist")};b.prototype.canAttackToMonster=function(){return this.getAttackTargets().some(e=>e.entityType!=="Duelist")};b.prototype.hasAttackRight=function(){return this.battlePosition==="Attack"&&this.info.attackDeclareCount===0&&this.status.canAttack};b.prototype.canBeEffected=function(e,t,i){return this.procFilterBundle.effectiveOperators.filter(r=>r.procTypes.some(n=>n==="Effect")).every(r=>r.filter(e,t,i,[this]))};const Ft=(e,t,i,a,r)=>e.canBeEffected(i,a,r)&&e.procFilterBundle.effectiveOperators.filter(n=>n.procTypes.some(l=>l===t)).every(n=>n.filter(i,a,r,[e]));b.prototype.canBeTargetOfEffect=function(e){return Ft(this,"EffectTarget",e.activator,e.action.entity,e.action)};b.prototype.canBeBanished=function(e,t,i,a){return this.fieldCell.cellType==="Banished"?!1:Ft(this,e,t,i,a)};b.prototype.canBeTargetOfBattle=function(e,t){const i=this;return i.procFilterBundle.effectiveOperators.filter(a=>a.procTypes.some(r=>r==="BattleTarget")).every(a=>a.filter(e,t,{},[i]))};b.prototype.validateDestory=function(e,t,i,a){const r=this;let n=r.procFilterBundle.effectiveOperators.filter(l=>l.procTypes.includes(e)).every(l=>l.filter(t,i,a??{},[r]));return n&&e==="EffectDestroy"&&(n=r.canBeEffected(t,i,a)),n};b.prototype.getIndexInCell=function(){const e=this;if(e.info.isVanished)return-1;const t=e.fieldCell.cardEntities.indexOf(e);if(t<0)throw new m("„Ç®„É≥„ÉÜ„Ç£„ÉÜ„Ç£„Å®„Çª„É´„ÅÆÁä∂ÊÖã„ÅåÁüõÁõæ„Åó„Å¶„ÅÑ„Çã„ÄÇ",[e,e.fieldCell]);return t};b.prototype.getXyzMaterials=function(){const e=this;return(e.status.monsterCategories??[]).includes("Xyz")?e.fieldCell.xyzMaterials:[]};b.prototype.wasMovedAfter=function(e){return this.moveLog.latestRecord.movedAt.totalProcSeq>e.totalProcSeq};b.prototype.hadArrivedToFieldAt=function(){let e=this.moveLog.latestRecord.movedAt;return this.moveLog.records.findLast(t=>!t.cell.isPlayFieldCell||t.isPending||t.kind!==this.kind||t.face==="FaceDown"?!0:(e=t.movedAt,!1)),e};b.prototype.release=async function(e,t,i){return await this.sendToGraveyard([...e,"Release"],t,i),this.info.isVanished?void 0:this.fieldCell};b.prototype.ruleDestory=async function(){return await this.sendToGraveyard(["RuleDestroy"],void 0,void 0),this.info.isVanished?void 0:this.fieldCell};b.prototype.sendToGraveyard=async function(e,t,i){await v.sendManyToGraveyardForTheSameReason([this],e,t,i)};b.prototype.discard=async function(e,t,i){await v.discardManyForTheSameReason([this],e,t,i)};b.prototype.returnToDeck=async function(e,t,i,a){await v.returnManyToDeckForTheSameReason(e,[this],t,i,a)};b.prototype.banish=async function(e,t,i){await v.banishManyForTheSameReason([this],e,t,i)};class Ma{constructor(t){s(this,"cells");s(this,"duel");s(this,"summonFilterPool");s(this,"procFilterPool");s(this,"numericStateOperatorPool");s(this,"statusOperatorPool");s(this,"damageFilterPool");s(this,"moveLog");s(this,"getAllCells",()=>this.cells.flat());s(this,"getCells",(...t)=>this.getAllCells().filter(i=>t.includes(i.cellType)));s(this,"getAvailableExtraMonsterZones",()=>this.getCells("ExtraMonsterZone").filter(t=>t.isAvailable));s(this,"getAllEntities",()=>this.getAllCells().map(t=>t.entities).flat());s(this,"getAllCardEntities",()=>this.getAllCells().map(t=>t.cardEntities).flat());s(this,"getCardsOnFieldStrictly",()=>this.getCells(...X).map(t=>t.cardEntities).filter(t=>t.length>0).map(t=>t[0]).filter(t=>t.isOnFieldStrictly));s(this,"getMonstersOnFieldStrictly",()=>this.getCardsOnFieldStrictly().filter(t=>t.isOnFieldAsMonsterStrictly));s(this,"getSpellTrapsOnFieldStrictly",()=>this.getCardsOnFieldStrictly().filter(t=>t.isOnFieldAsSpellTrapStrictly));s(this,"getPendulumScalesOnFieldStrictly",()=>this.getCardsOnFieldStrictly().filter(t=>{var i;return(i=t.origin.monsterCategories)==null?void 0:i.includes("Pendulum")}).filter(t=>t.isOnFieldAsSpellTrapStrictly).filter(t=>!t.status.spellCategory));s(this,"getPendingCardsOnField",()=>this.getCells(...X).map(t=>t.cardEntities).filter(t=>t.length>0).map(t=>t[0]).filter(t=>t.info.isPending));s(this,"getPendingMonstersOnField",()=>this.getPendingCardsOnField().filter(t=>t.kind==="Monster"));s(this,"getEntities",t=>this.getAllEntities().filter(i=>i.controller===t));s(this,"recalcLinkArrows",()=>{const t=this.getAllCells().filter(i=>i.isMonsterZoneLikeCell);t.some(i=>i.recalcLinkArrows)&&t.forEach(i=>i.recalcLinkArrows())});s(this,"canExtraLink",(t,i)=>{if(!t.linkArrows.length)return!1;const a=i.map(c=>c.material),r=this.getCells("ExtraMonsterZone").filter(c=>c.isAvailable||a.includes(c.cardEntities[0]));if(r.length!==1)return!1;const n=r[0],l=t.linkArrows.map(c=>this.cells[n.row+c.offsetRow][n.column+c.offsetColumn]);let o=n.linkArrowSources.filter(c=>!a.includes(c)).filter(c=>l.includes(c.fieldCell));if(!o.length)return!1;let u=-1;for(;u!==o.length;){const c=o.flatMap(d=>d.coLinkedEntities).filter(d=>!a.includes(d));if(c.some(d=>d.fieldCell.cellType==="ExtraMonsterZone"))return!0;o=[...o,...c].getDistinct(),u=o.length}return!1});s(this,"drawAtSameTime",async(t,i,a,r,n,l)=>{const o=[],u=[],c=[t.draw(i,n,l),a.draw(r,n,l)].map(d=>d.catch(p=>{p instanceof $?p.winner&&o.push(p.winner):u.push(p)}));if(await Promise.all(c),u.length)throw new m("„Éâ„É≠„ÉºÂá¶ÁêÜ„ÅßÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑ‰æãÂ§ñ„ÅåÁô∫Áîü„Åó„Åü„ÄÇ",t,i,a,r,n,...u);if(o.length!==0)throw o.length===1?new $(o[0],"ÂØæÊà¶Áõ∏Êâã„Åå„Éá„ÉÉ„Ç≠„Åã„Çâ„Éâ„É≠„Éº„Åß„Åç„Å™„Åã„Å£„Åü„ÄÇ"):new $(void 0,"„Åä‰∫í„ÅÑ„Å´„Éá„ÉÉ„Ç≠„Åã„Çâ„Ç´„Éº„Éâ„Çí„Éâ„É≠„Éº„Åß„Åç„Å™„Åã„Å£„Åü„ÄÇ")});s(this,"sendToGraveyard",async(t,i,a,r,n,l,o,u)=>{if(r>0&&a.length<r)return;const c=await this.duel.view.waitSelectEntities(i,{selectables:a,qty:r,validator:n,cancelable:u??!1},t);if(c)return await b.sendManyToGraveyard(c.map(d=>({entity:d,causedAs:l,causedBy:o,activator:i}))),this.duel.log.info(`${c.map(d=>d.status.name).join(", ")}„ÇíÂ¢ìÂú∞„Å´ÈÄÅ„Å£„ÅüÔºà${l.getDistinct().join(", ")}Ôºâ„ÄÇ`,i),c});this.duel=t,this.cells=[...Array(7)].map(()=>[]);for(const i of Object.keys(Ge).map(Number))for(const a of Object.keys(Ge[i]).map(Number))this.cells[i][a]=new ji(this,i,a,i<3?t.duelists.Above:i>3?t.duelists.Below:a<2?t.duelists.Above:a>4?t.duelists.Below:void 0);this.summonFilterPool=new ma,this.procFilterPool=new Ui,this.numericStateOperatorPool=new zi,this.statusOperatorPool=new ya,this.damageFilterPool=new Ta,this.moveLog=new ia(this)}}class Aa{constructor(t){s(this,"onUpdateEvent",new N);s(this,"nextSeq");s(this,"records",[]);s(this,"duel");s(this,"dispose",()=>{this.onUpdateEvent.clear()});s(this,"error",t=>{console.error(t);const i=["„Ç®„É©„ÉºÁô∫Áîü"];t instanceof Error?(t instanceof m&&(i.push("-- „Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏ --"),i.push(t.message),i.push("-- Èñ¢ÈÄ£„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà --"),t.items.forEach(a=>i.push(JSON.stringify(a))),console.error(t.items)),i.push("-- „Ç®„É©„ÉºÂêçÁß∞ --"),i.push(t.name||"„Ç®„É©„ÉºÂêçÁß∞ÂèñÂæóÂ§±Êïó"),i.push("-- „Çπ„Çø„ÉÉ„ÇØ„Éà„É¨„Éº„Çπ --"),i.push(t.stack||"„Çπ„Çø„ÉÉ„ÇØ„Éà„É¨„Éº„ÇπÂèñÂæóÂ§±Êïó")):(i.push("-- „Ç®„É©„ÉºÂûãÁâπÂÆöÂ§±Êïó --"),i.push(JSON.stringify(t))),this.write("error","System",i,void 0,void 0,void 0,void 0,void 0)});s(this,"warn",t=>{this.write("warn","System",["„ÄêÊ≥®ÊÑè„Äë",t],void 0,void 0,void 0,void 0,void 0)});s(this,"info",(t,i)=>{this.write("info","Others",[t],i,void 0,void 0,void 0,void 0)});s(this,"pushMoveLog",(t,i,a,r)=>{this.write("info","EntityMove",["ÁßªÂãï"],t,i,void 0,a,r)});s(this,"write",(t,i,a,r,n,l,o,u)=>{const c=a.join(`
`);this.records.push({seq:this.nextSeq++,lvl:t,type:i,clock:this.duel.clock.getClone(),text:c,duelist:r,mainEntity:n,subEntities:l??[],from:o,to:u}),this.onUpdateEvent.trigger(this.nextSeq-1)});this.nextSeq=0,this.duel=t}get onUpdate(){return this.onUpdateEvent.expose()}get lastRecord(){return this.records.slice(-1)[0]}}const xa=e=>new Promise(t=>setTimeout(t,e)),Bt=()=>{let e=()=>{},t=()=>{};return{promise:new Promise((a,r)=>{e=a,t=r}),resolve:e,reject:t}};class qe{constructor(t){s(this,"onUpdateEvent",new N);s(this,"_state","Disable");s(this,"defaultArgs");s(this,"_args");s(this,"resolve",()=>{});s(this,"show",t=>{this._args=t,this._state="Shown",this.onUpdateEvent.trigger();const{promise:i,resolve:a}=Bt();return this.resolve=r=>{this._state="Disable",a(r),this.resolve=()=>{},this.onUpdateEvent.trigger()},i});s(this,"cancel",()=>{console.log(this),this.args.cancelable&&(this._state!=="Disable"&&this.resolve(void 0),this.terminate())});s(this,"terminate",()=>{this._state="Disable",this._args=this.defaultArgs,this.resolve=()=>{}});this.defaultArgs=t,this._args=t}get onUpdate(){return this.onUpdateEvent.expose()}get state(){return this._state}get args(){return this._args}}class Fa{constructor(t){s(this,"onUpdateEvent",new N);s(this,"actionSelector",new qe({title:"„Ç´„Éº„ÉâÊìç‰Ωú„ÇíÈÅ∏Êäû„ÄÇ",activator:void 0,dummyActionInfos:[],cancelable:!1}));s(this,"entitySelector",new qe({title:"ÂØæË±°„ÇíÈÅ∏Êäû",entitiesChoices:{selectables:[],validator:()=>!0,cancelable:!1},cancelable:!1,chainBlockInfos:[]}));s(this,"textSelector",new qe({title:"„Ç´„Éº„ÉâÊìç‰Ωú„ÇíÈÅ∏Êäû„ÄÇ",choises:[],cancelable:!1}));s(this,"modals",[this.actionSelector,this.entitySelector,this.textSelector]);s(this,"view");s(this,"terminateAll",()=>{this.modals.forEach(t=>t.terminate()),this.onUpdateEvent.trigger()});this.view=t,this.modals.forEach(i=>i.onUpdate.append(()=>this.onUpdateEvent.trigger()))}get onUpdate(){return this.onUpdateEvent.expose()}}const ct=e=>{let t=[];do{const i=e.qty&&e.qty>0?e.qty:Math.floor(Math.random()*e.selectables.length+1);t=e.selectables.randomPickMany(i)}while(!e.validator(t));return t},Ba=[{seq:10,name:"Internet Explorer",key:"msie"},{seq:20,name:"Internet Explorer",key:"trident"},{seq:30,name:"Edge",key:"edge"},{seq:40,name:"Google Chrome",key:"chrome"},{seq:50,name:"Safari",key:"safari"},{seq:60,name:"Mozilla Firefox",key:"firefox"},{seq:70,name:"Opera",key:"opera"}],Oa=[{seq:10,name:"Microsoft Windows",key:"windows nt"},{seq:20,name:"Android",key:"android"},{seq:30,name:"iOS",key:"iphone"},{seq:40,name:"iOS",key:"ipad"},{seq:50,name:"macOS",key:"mac os x"}],ge=window.navigator.userAgent.toLowerCase();var yt;const Na=((yt=Ba.find(e=>ge.indexOf(e.key)!==-1))==null?void 0:yt.name)??"Unknown Browser";var vt;const Ye=((vt=Oa.find(e=>ge.indexOf(e.key)!==-1))==null?void 0:vt.name)??"Unknown OS",Ot=ge.indexOf("iphone")!==-1||Ye==="Android"&&ge.indexOf("mobile")!==-1,La=ge.indexOf("ipad")!==-1||Ye==="Android"&&!Ot,ut=Ot?"Smart Phone":La?"Tablet Device":"PC",Re={canDragElement:ut==="PC",text:`${ut} ${Ye} ${Na}`};class qa{constructor(t){s(this,"onDuelUpdateEvent",new N);s(this,"requireUpdate",()=>{this.onDuelUpdateEvent.trigger()});s(this,"onWaitStartEvent",new N);s(this,"onWaitEndEvent",new N);s(this,"onDragStartEvent",new N);s(this,"onDragEndEvent",new N);s(this,"onAnimationStartEvent",new N);s(this,"onShowCardEntityEvent",new N);s(this,"duel");s(this,"modalController");s(this,"_message");s(this,"waitMode");s(this,"infoBoardState");s(this,"infoBoardCell");s(this,"getCell",(t,i)=>this.duel.field.cells[t][i]);s(this,"showCardInfo",(t,i)=>{this.onShowCardEntityEvent.trigger({card:t,mode:i})});s(this,"dispose",()=>{this.onDragStartEvent.clear(),this.onDragEndEvent.clear(),this.onDuelUpdateEvent.clear(),this.onWaitStartEvent.clear(),this.onWaitEndEvent.clear()});s(this,"waitFieldAction",async t=>{if(this.duel.getTurnPlayer().duelistType==="NPC"){const n=this.duel.getTurnPlayer().selectActionForNPC(t,[]);return n?{actionInfo:n}:{phaseChange:this.duel.nextPhaseList[0]}}const i=await this._waitDuelistAction(this.duel.getTurnPlayer(),t,"Free","",void 0,void 0,!1);if(!i.actionInfo)return{...i,actionInfo:void 0};const a={...i.actionInfo},r=t.find(n=>{var l;return((l=i.actionInfo)==null?void 0:l.originSeq)===n.originSeq});if(!r)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",t,i);return{...i,actionInfo:{dest:a.dest,battlePosition:a.battlePosition,action:r.action,originSeq:r.originSeq}}});s(this,"waitQuickEffect",async(t,i,a,r,n)=>{if(i.length===0)return;if(t.duelistType==="NPC")return t.selectActionForNPC(i,a);const l=[this.modalController.actionSelector.show({title:r,activator:t,dummyActionInfos:i,cancelable:n}),this._waitDuelistAction(t,i,"Modal",this.message,void 0,void 0,!1).then(c=>c.actionInfo)],o=await Promise.any(l);if(!o)return;this.infoBoardState="Default";const u=i.find(c=>o.originSeq===c.originSeq);if(!u)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",o);return{...u,dest:o.dest}});s(this,"waitSubAction",async(t,i,a,r=!1)=>{if(t.duelistType==="NPC")throw Error("Not implemented");const n=await this._waitDuelistAction(t,i,"Modal",a,void 0,void 0,r);if(n&&n.actionInfo)return n.actionInfo});s(this,"waitSelectEntities",async(t,i,a)=>{if(!i.selectables.length)return;if(i.qty&&i.selectables.length===i.qty)return[...i.selectables];if(t.duelistType==="NPC")return ct(i);let r;i.selectables.some(o=>o.entityType==="Duelist")&&(r={...i,selectables:i.selectables.filter(o=>o.entityType==="Duelist").map(o=>o.fieldCell),qty:1,validator:o=>o.length===1});const n=await this._waitDuelistAction(t,[],"Modal",a,i,r,i.cancelable),l=[...n.selectedEntities??[],...(n.selectedCells??[]).flatMap(o=>o.entities).filter(o=>o.entityType==="Duelist")];return l.length?l:[]});s(this,"waitYesOrNo",async(t,i)=>{const a=await this.waitSelectText(t,[{seq:0,text:"Yes"},{seq:1,text:"No"}],i,!1);return(a==null?void 0:a.seq)===0});s(this,"waitSelectText",async(t,i,a,r=!1)=>{if(t.duelistType==="NPC")return i.randomPick();const n=await this.modalController.textSelector.show({title:a,choises:i,cancelable:r});if(n===void 0){if(!r)throw new q(t,i,a,r);return}return i.find(l=>l.seq===n)});s(this,"waitAnimation",async t=>{var i;return this._message="",this.waitMode="Animation",window.getSelection&&((i=window.getSelection())==null||i.removeAllRanges()),this.onDuelUpdateEvent.trigger(),new Promise(a=>this.onAnimationStartEvent.trigger({...t,resolve:a}))});s(this,"setDraggingActions",t=>{this.onDragStartEvent.trigger(t),this.requireUpdate()});s(this,"removeDraggingActions",()=>{this.onDragEndEvent.trigger()});s(this,"waitSelectAction",async(t,i,a,r)=>{var u;const n=i.map(c=>ue.createDummyAction(c.entity,c.title,[],void 0,c.origin)),l=await this._waitDammyAction(t,n,a,r);if(!l)return;const o=(u=i.find(c=>c.origin.seq===l.originSeq))==null?void 0:u.origin;if(!o)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",i,l);return o});s(this,"waitSelectSummonDestination",async(t,i,a,r,n)=>{const l=a.length>1&&Re.canDragElement?"„Ç´„Éº„Éâ„ÇíÂè¨ÂñöÂÖà„Å∏„Éâ„É©„ÉÉ„Ç∞„ÄÇ":"Ë°®Á§∫ÂΩ¢Âºè„ÇíÈÅ∏Êäû„ÄÇ";if(!a.length&&!r.length){if(n)return;throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",t,i,a,r,n)}let o=[...r];for(;;){const u={dest:a.randomPick(),battlePosition:o[0]};if(o.length===1&&!Re.canDragElement){const p=await this.waitSelectCell(t,a,n,"Âè¨ÂñöÂÖà„ÇíÈÅ∏Êäû„ÄÇ");return p?{...u,dest:p}:void 0}const c=o.map(p=>ue.createDummyAction(i,p,a,p)),d=await this._waitDammyAction(t,c,l,n);if(!d)return;if(d.battlePosition&&(o=[d.battlePosition]),!(a.length>1&&!d.dest))return u.dest=d.dest??u.dest,u.battlePosition=d.battlePosition??u.battlePosition,u}});s(this,"waitSelectDestination",async(t,i,a,r,n,l=!1)=>{if(!a.length)return;if(a.length===1)return a[0];if(!Re.canDragElement)return await this.waitSelectCell(t,a,l,r);let o=a.randomPick();const u=[ue.createDummyAction(i,n,a,void 0)],c=await this._waitDammyAction(t,u,r,l);if(c)return o=c.dest??o,o});s(this,"_waitDammyAction",async(t,i,a,r=!1)=>{if(!i.length)return;const n=i.randomPick();let l={...n,dest:n.dest??n.dests.randomPick()};if(t.duelistType!=="NPC"){const o=[this.modalController.actionSelector.show({title:a,activator:t,dummyActionInfos:i,cancelable:r}),this.duel.view.waitSubAction(t,i,a,r)],u=await Promise.any(o);if(!u&&!r)throw new q(u,o);if(!u)return;l=u??l}return l});s(this,"waitSelectCell",async(t,i,a,r)=>i.length?t.duelistType==="NPC"?i.randomPick():(await this.waitSelectCells(t,{selectables:i,qty:1,validator:l=>l.length===1,cancelable:a},r)??[])[0]:void 0);s(this,"waitSelectCells",async(t,i,a)=>{if(!i.selectables.length)return;if(t.duelistType==="NPC")return ct(i);const r=await this._waitDuelistAction(t,[],"Modal",a,void 0,i,i.cancelable);if((!r||!r.selectedCells)&&!i.cancelable)throw new q(t,i,a);return r.selectedCells});s(this,"_waitDuelistAction",async(t,i,a,r,n,l,o=!1)=>{for(this.waitMode=a,this._message=r;this.onDuelUpdateEvent.length<38;)await xa(1);this.onDuelUpdateEvent.trigger();const u=Bt(),c={resolve:u.resolve,activator:t,dummyActionInfos:i,chainBlockInfos:t.duel.chainBlockInfos,entitiesChoices:n,cellsChoices:l};console.info("wait start",c),this.onWaitStartEvent.trigger(c);const d=await u.promise;if(console.info("response",d),this.modalController.terminateAll(),this.waitMode="None",this.onWaitEndEvent.trigger(),d.surrender)throw new $(t.getOpponentPlayer(),`${t.profile.name}„Åå„Çµ„É¨„É≥„ÉÄ„Éº„Åó„Åü„ÄÇ`);if(!o&&d.cancel)throw new m("„Ç≠„É£„É≥„Çª„É´‰∏çÂèØ„ÅÆ„Ç¢„ÇØ„Ç∑„Éß„É≥„Åå„Ç≠„É£„É≥„Çª„É´„Åï„Çå„Åü„ÄÇ",d,i,a,n,l);return this.infoBoardState="Default",d});this.duel=t,this._message="",this.waitMode="None",this.infoBoardState="Default",this.infoBoardCell=t.duelists.Below.getExtraDeck(),this.modalController=new Fa(this)}get onDuelUpdate(){return this.onDuelUpdateEvent.expose()}get onWaitStart(){return this.onWaitStartEvent.expose()}get onWaitEnd(){return this.onWaitEndEvent.expose()}get onDragStart(){return this.onDragStartEvent.expose()}get onDragEnd(){return this.onDragEndEvent.expose()}get onAnimation(){return this.onAnimationStartEvent.expose()}get onShowCardEntity(){return this.onShowCardEntityEvent.expose()}get message(){var t;return(this._message||((t=this.duel.log.lastRecord)==null?void 0:t.text))??""}}const Ve=["turn","phaseSeq","stepSeq","stageSeq","chainSeq","chainBlockSeq","procSeq"];[...Ve];class Ra{constructor(){s(this,"onClockChangeEvents",{turn:new N,phaseSeq:new N,stepSeq:new N,stageSeq:new N,chainSeq:new N,chainBlockSeq:new N,procSeq:new N});s(this,"_turn",0);s(this,"_phaseSeq",0);s(this,"_stepSeq",0);s(this,"_stageSeq",0);s(this,"_chainSeq",0);s(this,"_chainBlockSeq",0);s(this,"_procSeq",0);s(this,"_totalProcSeq",0);s(this,"_periodKey");s(this,"_previousStartPoints",{turn:0,phaseSeq:0,stepSeq:0,stageSeq:0,chainSeq:0,chainBlockSeq:0,procSeq:0});s(this,"_currentStartPoints",{turn:0,phaseSeq:0,stepSeq:0,stageSeq:0,chainSeq:0,chainBlockSeq:0,procSeq:0});s(this,"setPhase",(t,i)=>{const a=Object.values(I).filter(r=>r.phase===i).find(r=>(r.step??"start")==="start");if(!a)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",this.period,i,I);i==="draw"?(this.turn>0&&t.log.info("„Çø„Éº„É≥ÁµÇ‰∫Ü„ÄÇ",t.getTurnPlayer()),this._turn++,this._phaseSeq=0):(t.log.info(`„Éï„Çß„Ç§„Ç∫ÁßªË°åÔºà${this.period.name}‚Üí${a.name}Ôºâ`,t.getTurnPlayer()),this._phaseSeq++),this._stepSeq=0,this._stageSeq=0,this.periodKey=a.key});s(this,"setStep",(t,i)=>{const a=this.period.phase,r=Object.values(I).filter(n=>n.phase===a).find(n=>(n.step??"")===i);if(!r)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",this.period,i,I);this.period.name!==r.name&&(t.log.info(`„Çπ„ÉÜ„ÉÉ„ÉóÁßªË°åÔºà${this.period.name}‚Üí${r.name}Ôºâ`,t.getTurnPlayer()),this._stepSeq++,this._stageSeq=0,this.periodKey=r.key)});s(this,"setStage",(t,i)=>{const a=this.period,r=Object.values(I).filter(n=>n.phase===a.phase).filter(n=>n.step===a.step).find(n=>(n.stage??"")===i);if(!r)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",this.period,i,I);t.log.info(`„Çø„Ç§„Éü„É≥„Ç∞ÁßªË°åÔºà${this.period.name}‚Üí${r.name}Ôºâ`,t.getTurnPlayer()),this._stageSeq++,this.periodKey=r.key});s(this,"incrementChainSeq",()=>{this._chainSeq++,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq()});s(this,"incrementChainBlockSeq",()=>{this._chainBlockSeq++,this._procSeq=0,this.incrementTotalProcSeq()});s(this,"incrementProcSeq",()=>{this._procSeq++,this.incrementTotalProcSeq()});s(this,"incrementTotalProcSeq",()=>{this._totalProcSeq++;let t=!1;Ve.toReversed().forEach(i=>{t&&(this._previousStartPoints[i]=this.currentStartPoints[i],this._currentStartPoints[i]=this.totalProcSeq),t=this[i]===0}),Ve.toReversed().filter(i=>this._currentStartPoints[i]=this.totalProcSeq).filter(i=>i!=="procSeq").forEach(i=>this.onClockChangeEvents[i].trigger(this)),this.onClockChangeEvents.procSeq.trigger(this)});s(this,"toString",()=>`${this.totalProcSeq}(t${this.turn}-phs${this.phaseSeq}-stp${this.stepSeq}-stg${this.stepSeq}-c${this.chainSeq}-cb${this.chainBlockSeq}-prc${this.procSeq})`);s(this,"getClone",()=>({turn:this.turn,phaseSeq:this.phaseSeq,stepSeq:this.stepSeq,stageSeq:this.stageSeq,chainSeq:this.chainSeq,chainBlockSeq:this.chainBlockSeq,procSeq:this.procSeq,totalProcSeq:this.totalProcSeq,period:this.period}));s(this,"isSameTurn",t=>this.turn===t.turn);s(this,"isSameChain",t=>this.turn===t.turn&&this.phaseSeq===t.phaseSeq&&this.stepSeq===t.stepSeq&&this.stageSeq===t.stageSeq&&this.chainSeq===t.chainSeq);s(this,"isPreviousChain",t=>this.turn===t.turn&&this.phaseSeq===t.phaseSeq&&this.stepSeq===t.stepSeq&&this.stageSeq===t.stageSeq&&this.chainSeq===t.chainSeq+1);s(this,"isPreviousStage",t=>this.turn===t.turn&&this.phaseSeq===t.phaseSeq&&this.stepSeq===t.stepSeq&&this.stageSeq===t.stageSeq+1);s(this,"isPreviousTurn",t=>this.turn===t.turn+1);s(this,"isPreviousProc",t=>this.totalProcSeq===t.totalProcSeq+1);s(this,"isUponAttackDeclaration",()=>this.period.step==="battle"&&this.chainSeq===1);this._periodKey="end"}get onTurnChange(){return this.onClockChangeEvents.turn.expose()}get onStageChange(){return this.onClockChangeEvents.stageSeq.expose()}get onProcSeqChange(){return this.onClockChangeEvents.procSeq.expose()}get previousStartPoints(){return this._previousStartPoints}get currentStartPoints(){return this._currentStartPoints}set periodKey(t){this._periodKey!==t&&(this._periodKey=t,this._chainSeq=0,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq())}get periodKey(){return this._periodKey}get period(){return I[this.periodKey]}get turn(){return this._turn}get phaseSeq(){return this._phaseSeq}get stepSeq(){return this._stepSeq}get stageSeq(){return this._stageSeq}get chainSeq(){return this._chainSeq}get chainBlockSeq(){return this._chainBlockSeq}get procSeq(){return this._procSeq}get totalProcSeq(){return this._totalProcSeq}get isFirstChain(){return this.chainSeq===0}}class Ha{constructor(t){s(this,"onInsertEvent",new N);s(this,"nextSeq");s(this,"records",[]);s(this,"duel");s(this,"push",t=>{const i={seq:this.nextSeq++,clock:this.duel.clock.getClone(),chainBlockInfo:t};this.records.push(i),this.onInsertEvent.trigger(i)});this.nextSeq=0,this.duel=t}get onInsert(){return this.onInsertEvent.expose()}}const Za=["PlayFirst","DrawFirst","Random"],Vn={PlayFirst:"ÂÖàÊîª",DrawFirst:"ÂæåÊîª",Random:"„É©„É≥„ÉÄ„É†"};class $ extends Error{constructor(i,a){super(i?`„Éá„É•„Ç®„É´„ÅåÁµÇ‰∫Ü„Åó„Åü„ÄÇÂãùËÄÖÔºö${i.profile.name}`:"„Éá„É•„Ç®„É´„ÅåÁµÇ‰∫Ü„Åó„Åü„ÄÇ„Éâ„É≠„Éº„ÄÇ");s(this,"winner");s(this,"message");this.winner=i,this.message=a}}class m extends Error{constructor(i,...a){super(i);s(this,"message");s(this,"items");this.message=i,this.items=a}}class q extends m{constructor(...t){super("„Ç≠„É£„É≥„Çª„É´‰∏çÂèØ„ÅÆ„Ç¢„ÇØ„Ç∑„Éß„É≥„Åå„Ç≠„É£„É≥„Çª„É´„Åï„Çå„Åü„ÄÇ",...t)}}class zn{constructor(t,i,a,r=[],n,l,o,u=[],c="Random"){s(this,"onDuelEndEvent",new N);s(this,"view");s(this,"log");s(this,"chainBlockLog");s(this,"clock");s(this,"nextPhaseList");s(this,"field");s(this,"attackingMonster");s(this,"targetForAttack");s(this,"_chainBlockInfos");s(this,"duelists");s(this,"priorityHolder");s(this,"isEnded");s(this,"winner");s(this,"coin",!1);s(this,"startMode");s(this,"distributeOperators",t=>{console.info(`[totalProcSeq]:${t.totalProcSeq}`);let i=0;for(;;){if(i++,i>10)throw new m("ÁÑ°Èôê„É´„Éº„ÉóÁô∫Áîü");if(this.field.procFilterPool.distributeAll(this)&&this.field.statusOperatorPool.distributeAll(this)&&this.field.numericStateOperatorPool.distributeAll(this)&&this.field.summonFilterPool.distributeAll(this)&&this.field.damageFilterPool.distributeAll(this))return}});s(this,"getTurnPlayer",()=>this.clock.turn%2===0?this.secondPlayer:this.firstPlayer);s(this,"getNonTurnPlayer",()=>this.clock.turn%2===0?this.firstPlayer:this.secondPlayer);s(this,"main",async()=>{console.info("main start!"),this.coin=this.startMode==="PlayFirst"?!0:this.startMode==="DrawFirst"?!1:Math.random()>.5,this.priorityHolder=this.firstPlayer;const t=Sn(...Object.values(this.duelists).flatMap(i=>i.deckInfo.cardNames).getDistinct()).reduce((i,a)=>(i[a.name]=a,{...i}),{});for(const i of Object.values(this.duelists))i.pushDeck(t),i.getDeckCell().shuffle(),i.initHand.length&&i.initHand.forEach(a=>{const r=i.getDeckCell().cardEntities.find(n=>n.origin.name===a);if(!r){this.log.info(`ÂàùÊâãÊìç‰Ωú„Å´„Çà„Çä${a}„ÇíÊâãÊú≠„Å´Âä†„Åà„Çà„ÅÜ„Å®„Åó„Åü„Åå„ÄÅ„Éá„ÉÉ„Ç≠„Å´Â≠òÂú®„Åó„Å™„ÅÑ„ÄÇ`);return}r.addToHand(["System"],void 0,void 0),this.log.info(`ÂàùÊâãÊìç‰Ωú„Å´„Çà„Çä${r.toString()}„ÇíÊâãÊú≠„Å´Âä†„Åà„Åü`,i)}),await i.draw(5-i.getHandCell().cardEntities.length,void 0,void 0);this.log.info(`„Äê„Éá„É•„Ç®„É´ÈñãÂßã„Äë${this.firstPlayer.profile.name} V.S. ${this.secondPlayer.profile.name}`),this.log.info(`ÂÖàÊîªÔºö${this.firstPlayer.profile.name} ÂæåÊîªÔºö${this.secondPlayer.profile.name}`),this.moveNextPhase("draw");try{for(const i of Object.values(this.duelists))for(const a of this.getEnableActions(i,["Exodia"],["Normal"],[]))await a.action.directExecute(i,void 0,!1);for(;!this.isEnded&&(this.clock.period.phase==="draw"?await this.procDrawPhase():this.phase==="standby"?await this.procStanbyPhase():this.phase==="main1"?await this.procMainPhase():this.phase==="battle1"?await this.procBattlePhase():this.phase==="battle2"?await this.procBattlePhase():this.phase==="main2"?await this.procMainPhase():this.phase==="end"&&await this.procEndPhase(),!(this.clock.turn>1e3)););}catch(i){i instanceof $?(this.clock.incrementChainSeq(),console.info(i),this.isEnded=!0,this.winner=i.winner,this.log.info(i.winner?`„Éá„É•„Ç®„É´ÁµÇ‰∫Ü„ÄÇÂãùËÄÖ${i.winner.profile.name}„ÄÇ${i.message}`:`„Éá„É•„Ç®„É´ÁµÇ‰∫Ü„ÄÇÂºï„ÅçÂàÜ„Åë„ÄÇ${i.message}`),this.onDuelEndEvent.trigger()):i instanceof Error&&this.log.error(i)}finally{this.log.dispose()}});s(this,"moveNextPhase",t=>{this.clock.setPhase(this,t),this.phase==="main2"||this.clock.turn===1?this.nextPhaseList=["end"]:this.phase==="battle1"||this.phase==="battle2"?this.nextPhaseList=["main2"]:this.phase==="main1"?this.nextPhaseList=["battle1","end"]:this.nextPhaseList=[]});s(this,"declareAnAttack",(t,i,a=!1)=>{var l;this.attackingMonster=t,this.targetForAttack=i;let r=" ("+((l=i.battlePosition==="Attack"?i.atk:i.def)==null?void 0:l.toString())+")";i.face==="FaceDown"&&(r=" (????)"),i.entityType==="Duelist"&&(r="");const n=a?"ÊîªÊíÉÂØæË±°ÂÜçÈÅ∏Êäû":"ÊîªÊíÉÂÆ£Ë®Ä";a||t.info.attackDeclareCount++,this.log.info(`${n}:${t.toString()} (${t.atk})‚áí ${i.toString()}${r}`,t.controller)});s(this,"procDrawPhase",async()=>{if(Object.values(this.duelists).forEach(t=>t.initForDrawPhase()),this.log.info("„Éâ„É≠„Éº„Éï„Çß„Ç§„Ç∫ÈñãÂßã„ÄÇ",this.getTurnPlayer()),this.clock.turn===1)this.log.info("ÂÖàÊîª„Éó„É¨„Ç§„É§„Éº„ÅØ„Éâ„É≠„Éº„Åß„Åç„Å™„ÅÑ„ÄÇ",this.getTurnPlayer());else{await this.getTurnPlayer().draw(1,void 0,void 0);for(const t of this.getEnableActions(this.getTurnPlayer(),["Exodia"],["Normal"],[]))await t.action.directExecute(this.getTurnPlayer(),void 0,!1)}this.field.getCardsOnFieldStrictly().forEach(t=>t.initForTurn()),await this.procSpellSpeed1(),this.moveNextPhase("standby")});s(this,"procStanbyPhase",async()=>{await this.procSpellSpeed1(),this.moveNextPhase("main1")});s(this,"procMainPhase",async()=>{for(;;){this.priorityHolder=this.getTurnPlayer();const t=await this.view.waitFieldAction(this.getEnableActions(this.priorityHolder,["NormalSummon","SpellTrapSet","SpecialSummon","FlipSummon","ChangeBattlePosition","IgnitionEffect","QuickEffect","CardActivation"],["Normal","Quick","Counter"],[]));if(t.actionInfo){if(await this.procChain({activator:this.priorityHolder,actionInfo:t.actionInfo},void 0)==="cancel")continue;await this.procFreeChain();continue}const i=t.phaseChange;if(i){this.priorityHolder=this.getNonTurnPlayer();let a="done";for(;;){const r=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(this.priorityHolder,["QuickEffect","CardActivation"],["Quick","Counter"],[]),[],"Áõ∏Êâã„Åå„Éï„Çß„Ç§„Ç∫„ÇíÁµÇ‰∫Ü„Åó„Çà„ÅÜ„Å®„Åó„Å¶„ÅÑ„Çã„ÄÇ",!0);if(!r){this.moveNextPhase(i);return}if(a=await this.procChain({activator:this.priorityHolder,actionInfo:r},void 0),a==="done")break}if(a==="done"){await this.procFreeChain();continue}}}});s(this,"procBattlePhase",async()=>{await this.procBattlePhaseStartStep()&&await this.procBattlePhaseBattleStep(),await this.procBattlePhaseEndStep()});s(this,"procBattlePhaseStartStep",async()=>(this.clock.setStep(this,"start"),this.priorityHolder=this.getTurnPlayer(),this.attackingMonster=void 0,this.targetForAttack=void 0,await this.procSpellSpeed1()));s(this,"procBattlePhaseBattleStep",async()=>{for(;;){this.clock.setStep(this,"battle"),this.priorityHolder=this.getTurnPlayer();const t=await this.view.waitFieldAction(this.getEnableActions(this.priorityHolder,["Battle"],["Normal"],[]));if(t.phaseChange)break;if(t.actionInfo){const i=await t.actionInfo.action.prepare(this.priorityHolder,t.actionInfo.dest,void 0,[],!0,!1);if(!i)continue;for(await t.actionInfo.action.execute(i,[]),this.clock.incrementChainSeq();this.attackingMonster&&this.targetForAttack;){const a=this.clock.totalProcSeq,r=this.getNonTurnPlayer().getMonstersOnField(),n=await this.procChain(void 0,void 0);if(!this.attackingMonster)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã");if(!this.canContinueBattle())break;const l=this.attackingMonster.getAttackTargets();if(r.some(o=>!o.isOnFieldAsMonsterStrictly)||this.getNonTurnPlayer().getMonstersOnField().flatMap(o=>o.moveLog.records).filter(o=>o.movedAt.totalProcSeq>a).some(o=>!o.cell.isMonsterZoneLikeCell)?(this.log.info("„É¢„É≥„Çπ„Çø„Éº„ÅÆÊï∞„ÅåÂ¢óÊ∏õ„Åó„Åü„Åü„ÇÅ„Éê„Éà„É´„Çπ„ÉÜ„ÉÉ„Éó„ÅÆÂ∑ª„ÅçÊàª„Åó„ÅåÁô∫Áîü„ÄÇ"),this.targetForAttack=void 0):this.targetForAttack.entityType==="Duelist"&&l.every(o=>o!==this.targetForAttack)&&!this.attackingMonster.status.canDirectAttack&&(this.log.info(`${this.attackingMonster.toString()}„ÅåÁõ¥Êé•ÊîªÊíÉËÉΩÂäõ„ÇíÂñ™Â§±„Åó„Åü„Åü„ÇÅ„ÄÅ„Éê„Éà„É´„Çπ„ÉÜ„ÉÉ„Éó„ÅÆÂ∑ª„ÅçÊàª„Åó„ÅåÁô∫Áîü„ÄÇ`),this.targetForAttack=void 0),!this.targetForAttack){if(!l.length){this.log.info("ÊîªÊíÉÂèØËÉΩ„Å™ÂØæË±°„ÅåÂ≠òÂú®„Åó„Å™„ÅÑ„Åü„ÇÅ„ÄÅÊîªÊíÉÂØæË±°ÈÅ∏Êäû„ÇíÈÅ∏ÊäûËÇ¢„Åó„Å™„Åä„Åõ„Å™„ÅÑ„ÄÇ");break}if(this.getTurnPlayer().duelistType==="Player"&&!await this.view.waitYesOrNo(this.getTurnPlayer(),"ÊîªÊíÉÂØæË±°ÈÅ∏Êäû„ÇíÈÅ∏Êäû„ÅóÁõ¥„ÅôÔºü")){this.getTurnPlayer().writeInfoLog(`${this.attackingMonster.toString()}„ÅÆÊîªÊíÉÂÆ£Ë®Ä„Çí„Ç≠„É£„É≥„Çª„É´„ÄÇ`);break}if(this.targetForAttack=await this.getTurnPlayer().waitSelectEntity(l,"ÊîªÊíÉÂØæË±°„ÇíÈÅ∏Êäû„ÄÇ",!0),!this.targetForAttack){this.getTurnPlayer().writeInfoLog(`${this.attackingMonster.toString()}„ÅÆÊîªÊíÉÂÆ£Ë®Ä„Çí„Ç≠„É£„É≥„Çª„É´„ÄÇ`);break}this.declareAnAttack(this.attackingMonster,this.targetForAttack,!0);continue}if(n==="pass")break}this.attackingMonster&&this.targetForAttack&&await this.procBattlePhaseDamageStep(i)}}});s(this,"procBattlePhaseDamageStep",async t=>{if(!this.attackingMonster||!this.targetForAttack)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",this.attackingMonster,this.targetForAttack);if(this.targetForAttack.entityType!=="Duelist"&&!this.targetForAttack.isOnFieldAsMonsterStrictly)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",this.attackingMonster,this.targetForAttack);for(const i of[this.procBattlePhaseDamageStep1,this.procBattlePhaseDamageStep2,this.procBattlePhaseDamageStep3,this.procBattlePhaseDamageStep4,this.procBattlePhaseDamageStep5])if(!await i(t))return});s(this,"procBattlePhaseDamageStep1",async()=>(this.clock.setStage(this,"start"),await this.procFreeChain(this.canContinueBattle)));s(this,"procBattlePhaseDamageStep2",async()=>{if(!this.attackingMonster)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",this.attackingMonster);if(!this.targetForAttack)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",this.targetForAttack);const t=this.attackingMonster,i=this.targetForAttack;return this.clock.setStage(this,"beforeDmgCalc"),i.battlePosition==="Set"&&i.setBattlePosition("Defense",["Flip","FlipByBattle"],t,t.controller),await this.procFreeChain(this.canContinueBattle)});s(this,"procBattlePhaseDamageStep3",async t=>{if(!this.attackingMonster)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",this.attackingMonster);if(!this.targetForAttack)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",this.targetForAttack);const i=this.attackingMonster,a=this.targetForAttack;if(i.atk===void 0)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",this.attackingMonster,this.targetForAttack);if(this.clock.setStage(this,"dmgCalc"),!await this.procFreeChain(this.canContinueBattle))return!1;const r=i.atk,n=(a.battlePosition==="Attack"?a.atk:a.def)??0;a.entityType==="Duelist"?(t.activator.writeInfoLog(`„ÉÄ„É°„Éº„Ç∏Ë®àÁÆóÔºö${i.toString()} (${r}) ‚áí ${a.toString()}`),i.controller.getOpponentPlayer().battleDamage(r-n,i,a,t)):(t.activator.writeInfoLog(`„ÉÄ„É°„Éº„Ç∏Ë®àÁÆóÔºö${i.toString()} (${r}) ‚áí ${a.toString()} (${n})`),r>0&&r>n?a.battlePosition==="Attack"?i.controller.getOpponentPlayer().battleDamage(r-n,i,a,t):i.status.piercingTo.getDistinct().forEach(o=>o.battleDamage(r-n,i,a,t)):r<n&&i.controller.battleDamage(n-r,a,i,t),r>0&&(r>n||r===n&&a.battlePosition==="Attack")&&await v.tryMarkForDestory([a],t),a.battlePosition==="Attack"&&r<=n&&await v.tryMarkForDestory([i],t)),i.info.battleLog.push({enemy:a,timestamp:this.clock.getClone()}),a.info.battleLog.push({enemy:i,timestamp:this.clock.getClone()});const l=Object.values(this.duelists).filter(o=>o.lp<=0);if(l.length)throw l.length===1?new $(l[0].getOpponentPlayer(),"Êà¶Èóò„ÉÄ„É°„Éº„Ç∏„Å´„Çà„Å£„Å¶„ÄÅÁõ∏Êâã„ÅÆ„É©„Ç§„Éï„Éù„Ç§„É≥„Éà„Çí„Çº„É≠„Å´„Åó„Åü„ÄÇ"):new $(void 0,"Êà¶Èóò„ÉÄ„É°„Éº„Ç∏„Å´„Çà„Å£„Å¶„ÄÅ„Åä‰∫í„ÅÑ„ÅÆ„É©„Ç§„Éï„Éù„Ç§„É≥„Éà„Åå„Çº„É≠„Å´„Å™„Å£„Åü„ÄÇ");return!0});s(this,"procBattlePhaseDamageStep4",async()=>(this.clock.setStage(this,"afterDmgCalc"),!!await this.procFreeChain()));s(this,"procBattlePhaseDamageStep5",async()=>(this.clock.setStage(this,"end"),await v.waitCorpseDisposal(this),this.clock.incrementChainSeq(),!!await this.procFreeChain()));s(this,"procBattlePhaseEndStep",async()=>{this.clock.setStep(this,"end"),this.priorityHolder=this.getTurnPlayer(),await this.procSpellSpeed1(),this.moveNextPhase("main2")});s(this,"procEndPhase",async()=>{for(await this.procSpellSpeed1();;){const i=this.getTurnPlayer().getHandCell().cardEntities.length;if(i<7)break;await this.getTurnPlayer().discard(i-6,"Rule")}this.moveNextPhase("draw")});s(this,"canContinueBattle",()=>this.attackingMonster?(this.attackingMonster.isOnFieldStrictly?this.attackingMonster.face==="FaceDown"?(this.log.info(`${this.attackingMonster.toString()}„ÅåË£èÂÅ¥ÂÆàÂÇôË°®Á§∫„Å´„Å™„Å£„Åü„Åü„ÇÅ„ÄÅÊà¶Èóò„Åå‰∏≠Êñ≠„Åï„Çå„Åü„ÄÇ`),this.attackingMonster=void 0):this.attackingMonster.orientation==="Horizontal"&&(this.log.info(`${this.attackingMonster.toString()}„ÅåÂÆàÂÇôË°®Á§∫„Å´„Å™„Å£„Åü„Åü„ÇÅ„ÄÅÊà¶Èóò„Åå‰∏≠Êñ≠„Åï„Çå„Åü„ÄÇ`),this.attackingMonster=void 0):(this.log.info(`${this.attackingMonster.toString()}„Åå„Éï„Ç£„Éº„É´„Éâ„Å´Â≠òÂú®„Åó„Å™„Åè„Å™„Å£„Åü„ÇÅ„ÄÅÊà¶Èóò„Åå‰∏≠Êñ≠„Åï„Çå„Åü„ÄÇ`),this.attackingMonster=void 0),!!this.attackingMonster):!1);s(this,"procSpellSpeed1",async()=>{this.priorityHolder=this.getTurnPlayer();let t=0;const i={Above:Number.MAX_VALUE,Below:Number.MAX_VALUE};for(;;){const a=this.getEnableActions(this.priorityHolder,["IgnitionEffect","QuickEffect","CardActivation","LingeringEffect"],["Normal","Quick","Counter"],[]);if(i[this.priorityHolder.seat]=a.filter(o=>o.action.isMandatory).length,Object.values(i).every(o=>o===0)&&t>1)break;const r=a.find(o=>o.action.isMandatory);let n=r?{action:r.action,originSeq:r.action.seq}:void 0,l=!n;if(this.priorityHolder.isTurnPlayer?t===0&&(l=!0):i[this.getTurnPlayer().seat]&&(l=!0),a.length&&(a.length>1||!n)&&(this.priorityHolder.chainConfig.noticeFreeChain||a.some(o=>o.action.isNoticedForcibly))&&(n=await this.view.waitQuickEffect(this.priorityHolder,a,[],this.clock.period.name,l)),n){if(await this.procChain({activator:this.priorityHolder,actionInfo:n},void 0)==="cancel")continue;if(!await this.procFreeChain())return!1;this.priorityHolder=this.getTurnPlayer(),t=0;continue}this.priorityHolder=this.priorityHolder.getOpponentPlayer(),t++}return!0});s(this,"procFreeChain",async(t=()=>!0)=>{const i=this.clock.period.key;for(;await this.procChain(void 0,void 0)!=="pass";)if(this.clock.period.key!==i||!t())return!1;return!0});s(this,"procChain",async(t,i)=>{const a=this.chainBlockInfos.length===0;let r=t?[]:i??Object.values(this.duelists).flatMap(l=>this.getEnableActions(l,["TriggerEffect"],[this.chainBlockInfos.length?"Quick":"Normal"],this.chainBlockInfos).map(o=>({activator:l,actionInfo:o,targetChainBlock:this.chainBlockInfos.slice(-1)[0]}))),n;if(t)n={activator:t.activator,action:t.actionInfo.action,dest:t.actionInfo.dest,targetChainBlock:void 0},this.priorityHolder=n.activator;else if(r.length>0){const l=await this.selectTriggerEffect(r);l?(r=r.filter(o=>o!==l),n={...l,action:l.actionInfo.action},this.priorityHolder=n.activator):r=[]}if(!n){let l=0;for(;l<2;){this.priorityHolder=this.priorityHolder.getOpponentPlayer();const o=["Counter"];this.chainBlockInfos.every(d=>d.action.spellSpeed!=="Counter")&&o.push("Quick");let c=this.getEnableActions(this.priorityHolder,["QuickEffect","CardActivation"],o,this.chainBlockInfos).some(d=>d.action.isNoticedForcibly)||!!this.attackingMonster;if(c||(this.chainBlockInfos.length?c=this.priorityHolder.chainConfig.noticeSelfChain||this.chainBlockInfos.slice(-1)[0].activator!==this.priorityHolder:c=this.priorityHolder.chainConfig.noticeFreeChain),c){const d=this.chainBlockInfos.some(g=>g.action.isWithChainBlock)?"„ÉÅ„Çß„Éº„É≥„Åó„Å¶ÂäπÊûú„ÇíÁô∫Âãï„Åó„Åæ„Åô„ÅãÔºü":"„ÇØ„Ç§„ÉÉ„ÇØ„Ç®„Éï„Çß„ÇØ„ÉàÁô∫Âãï„Çø„Ç§„Éü„É≥„Ç∞„ÄÇÂäπÊûú„ÇíÁô∫Âãï„Åó„Åæ„Åô„ÅãÔºü",p=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(this.priorityHolder,["QuickEffect","CardActivation"],o,this.chainBlockInfos),this.chainBlockInfos,d,!0);if(p){n={...p,activator:this.priorityHolder,targetChainBlock:this.chainBlockInfos.slice(-1)[0]};break}}l++}}if(console.info("selected action: ",n),n){const l=n.activator,o=await n.action.prepare(l,n.dest,n.targetChainBlock,this.chainBlockInfos,a,!1);if(!o)return"cancel";this.chainBlockLog.push(o);const u=[...o.action.entity.info.isEffectiveIn];if(this._chainBlockInfos.push(o),this.clock.incrementProcSeq(),this.clock.incrementChainBlockSeq(),r=r.filter(c=>c.actionInfo.action.seq!==(n==null?void 0:n.action.seq)).filter(c=>c.actionInfo.action.validateCount(c.activator,this.chainBlockInfos)),Ga.some(c=>c===o.action.playType)&&await this.procChain(void 0,r.length?r:void 0),o.chainNumber&&this.log.info(`„ÉÅ„Çß„Éº„É≥${o.chainNumber}: ${o.action.toString()}„ÅÆÂäπÊûúÂá¶ÁêÜ„ÄÇ`,l),o.isNegatedActivationBy)o.chainNumber&&this.log.info(`„ÉÅ„Çß„Éº„É≥${o.chainNumber}: ${o.action.toString()}„Çí${o.isNegatedActivationBy.toString()}„Å´„Çà„Å£„Å¶Áô∫Âãï„ÇíÁÑ°Âäπ„Å´„Åó„Åü„ÄÇ`,o.activator);else{let c=o.action.entity.isEffective,d="";if(c){if(o.isNegatedEffectBy)d=`„ÉÅ„Çß„Éº„É≥${o.chainNumber}: ${o.action.toString()}„Çí${o.isNegatedEffectBy.toString()}„Å´„Çà„Å£„Å¶ÂäπÊûú„ÇíÁÑ°Âäπ„Å´„Åó„Åü„ÄÇ`,c=!1;else if(!u.includes(o.isActivatedIn.cellType)){const p=o.action.entity.moveLog.records.findLast(g=>g.face==="FaceDown"&&g.orientation==="Horizontal");c=(p&&this.clock.isSameChain(p.movedAt))??!1}}if(c?(await o.action.execute(o,this.chainBlockInfos),o.state="done"):(o.state="failed",o.chainNumber&&(d=d||`„ÉÅ„Çß„Éº„É≥${o.chainNumber}: „Ç´„Éº„Éâ„ÅÆÂäπÊûú„ÅåÁÑ°Âäπ„Å®„Å™„Å£„Å¶„ÅÑ„Çã„Åü„ÇÅ${o.action.toString()}„ÅÆÂäπÊûúÂá¶ÁêÜ„ÇíË°å„Åà„Å™„ÅÑ„ÄÇ`),this.log.info(d,o.activator)),await n.action.settle(o,this.chainBlockInfos),o.state==="done")for(const p of[this.getTurnPlayer(),this.getNonTurnPlayer()]){for(const g of this.getEnableActions(p,["Exodia"],["Normal"],[o]))await g.action.directExecute(p,o,!1);for(const g of this.getEnableActions(p,["AfterChainBlock"],["Normal"],[o])){await g.action.directExecute(p,o,!1);for(const h of this.getEnableActions(p,["Exodia"],["Normal"],[o]))await h.action.directExecute(p,o,!1)}}}a?(await v.sendManyToGraveyardForTheSameReason(this._chainBlockInfos.filter(c=>c.action.playType==="CardActivation").filter(c=>!c.action.isLikeContinuousSpell).map(c=>c.action.entity).filter(c=>c.isOnFieldStrictly).filter(c=>c.face==="FaceUp"),["Rule"],void 0,void 0),this._chainBlockInfos.reset(),o.nextActionInfo&&await this.procChain({activator:o.activator,actionInfo:o.nextActionInfo},void 0),this.clock.incrementChainSeq()):(o.nextActionInfo&&await o.nextActionInfo.action.directExecute(o.activator,void 0,!1),this.clock.incrementChainBlockSeq())}return n?"done":"pass"});s(this,"selectTriggerEffect",async t=>{if(t.length>0)for(const i of[!0,!1])for(const a of[this.getTurnPlayer(),this.getNonTurnPlayer()]){const r=t.filter(l=>l.actionInfo.action.isMandatory===i&&l.activator===a);if(r.length===0)continue;if(r.length===1&&i)return r[0];const n=await this.view.waitQuickEffect(a,r.map(l=>l.actionInfo),this.chainBlockInfos,"„Éà„É™„Ç¨„Éº„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ∏Êäû„ÄÇ",!i);if(n)return r.find(l=>l.actionInfo.action===n.action)}});s(this,"executeSystemPeriodActions",()=>{Object.values(this.duelists).flatMap(t=>this.getEnableActions(t,["SystemPeriodAction"],["Normal"],[]).map(i=>({duelist:t,action:i})))});s(this,"getEnableActions",(t,i,a,r)=>{var l;const n=((l=r.slice(-1)[0])==null?void 0:l.nextChainBlockFilter)??(()=>!0);return[...this.field.getAllCardEntities(),t.entity].flatMap(o=>o.actions).filter(o=>o.executableCells.includes(o.entity.fieldCell.cellType)).filter(o=>o.executablePeriods.includes(this.clock.period.key)).filter(o=>a.includes(o.spellSpeed)).filter(o=>o.validateDuelist(t)).filter(o=>i.includes(o.playType)).filter(o=>n(t,o)).map(o=>o.validate(t,r,!1)).filter(o=>o!==void 0)});this.clock=new Ra,this.nextPhaseList=[],this.isEnded=!1,this.startMode=c,this.duelists={Below:new Pe(this,"Below",t,i,a,r),Above:new Pe(this,"Above",n,l,o,u)},this.priorityHolder=this.firstPlayer,this._chainBlockInfos=[],this.field=new Ma(this),this.clock.onProcSeqChange.append(this.distributeOperators),this.clock.onStageChange.append(this.executeSystemPeriodActions),this.view=new qa(this),this.log=new Aa(this),this.chainBlockLog=new Ha(this)}get onDuelEnd(){return this.onDuelEndEvent.expose()}get phase(){return this.clock.period.phase}get step(){return this.clock.period.step}get stage(){return this.clock.period.stage}get chainBlockInfos(){return this._chainBlockInfos}get firstPlayer(){return this.coin?this.duelists.Below:this.duelists.Above}get secondPlayer(){return this.coin?this.duelists.Above:this.duelists.Below}}const G=class G{constructor(t){s(this,"id");s(this,"name");s(this,"description");s(this,"chainConfig");s(this,"previousGameMode");s(this,"previousNpcId");s(this,"previousNpcDeckId");s(this,"previousStartMode");s(this,"npcLvl",Number.MAX_VALUE);s(this,"npcType","None");s(this,"save",async t=>{const i={id:this.id,name:this.name,description:this.description,chainConfig:this.chainConfig??{noticeSelfChain:!1,noticeFreeChainPhase:!1,noticeFreeChainStep:!1,noticeAfterChainInMainPhase:!1},previousGameMode:this.previousGameMode??"Preset",previousNpcId:this.previousNpcId??Number.MIN_SAFE_INTEGER,previousStartMode:this.previousStartMode,previousNpcDeckId:this.previousNpcDeckId>-1?this.previousNpcDeckId:Number.MIN_SAFE_INTEGER,...t},a=await G.tblHeader.update(this.id,r=>({...r,...i}));return console.log(this.previousNpcDeckId,Number.MIN_SAFE_INTEGER,i,a),new G(a)});var i;this.id=t.id,this.name=t.name,this.description=t.description,this.chainConfig=t.chainConfig,this.previousGameMode=t.previousGameMode,this.previousNpcId=((i=pt.find(a=>a.id===t.previousNpcId))==null?void 0:i.id)??be(...pt.map(a=>a.id)),this.previousStartMode=Za.includes(t.previousStartMode)?t.previousStartMode:"Random",this.previousNpcDeckId=t.previousNpcDeckId}};s(G,"tblHeader"),s(G,"getOrCreateNew",async t=>{G.tblHeader||(G.tblHeader=new $a(t));const i=await G.tblHeader.getAll();if(i.length){let r=i[0];return r.chainConfig||(r={...r,chainConfig:{noticeSelfChain:!1,noticeFreeChain:!1}}),new G(r)}const a=await G.tblHeader.insert({name:"„ÅÇ„Å™„Åü",description:"„Åì„Åì„ÅÆÊñáÂ≠óÂàó„Çí‰Ωï„Å´‰Ωø„ÅÜ„Åã„ÅØÊú™ÂÆö„ÄÇ",chainConfig:{noticeSelfChain:!1,noticeFreeChain:!1},previousGameMode:"Preset",previousNpcId:0,previousNpcDeckId:Number.MIN_SAFE_INTEGER,previousStartMode:"Random"});return new G(a)});let dt=G;class $a extends Ke{constructor(i){super(i,"TblDuelistProfile");s(this,"_prepareInitialRecords",()=>[])}}let He=-1;const pt=[{id:He--,name:"„Çµ„É≥„Éâ„Éê„ÉÉ„Ç∞„Åè„ÇìÊ£íÁ´ã„Å°",description:"ÊîªÊíÉÂÆ£Ë®Ä„Å™„Åó„ÄÅÂº∑Âà∂ÂäπÊûú‰ª•Â§ñ„ÅÆÂäπÊûú„ÅÆÁô∫Âãï„Å™„Åó„ÄÇ",npcLvl:0,npcType:"Normal"},{id:He--,name:"„Çµ„É≥„Éâ„Éê„ÉÉ„Ç∞„Åè„ÇìÈùûÊö¥Âäõ",description:"ÊîªÊíÉÂÆ£Ë®Ä„Å™„Åó„ÄÇ",npcLvl:100,npcType:"Normal"},{id:He--,name:"„Çµ„É≥„Éâ„Éê„ÉÉ„Ç∞„Åè„ÇìÁôΩÂ∏Ø",description:"„Å®„Åè„Å´Âà∂Èôê„Å™„Åó„ÄÇ",npcLvl:200,npcType:"Normal"},{id:Number.MIN_SAFE_INTEGER,name:"FTK or Die",description:"FTK„Å´Â§±Êïó„Åô„Çã„Å®ÊïóÂåó„ÄÇ",npcLvl:Number.MIN_SAFE_INTEGER,npcType:"FtkChallenge"}],Qn=["noticeSelfChain","noticeFreeChain"],Wn={noticeSelfChain:"„Çª„É´„Éï„ÉÅ„Çß„Éº„É≥",noticeFreeChain:"„Éï„É™„Éº„ÉÅ„Çß„Éº„É≥"},Be=class Be{constructor(t,i,a,r,n,l=[]){s(this,"duel");s(this,"seat");s(this,"profile");s(this,"deckInfo");s(this,"info");s(this,"infoOrigin");s(this,"status");s(this,"statusOrigin");s(this,"duelistType");s(this,"lifeLog");s(this,"actionBlackListForNPC");s(this,"_lp");s(this,"initHand");s(this,"chainConfig");s(this,"writeInfoLog",t=>{this.duel.log.info(t,this)});s(this,"initForDrawPhase",()=>{this.info={...this.infoOrigin}});s(this,"canDiscard",t=>(this.status.canDiscardAsCost&&console.log(t),!0));s(this,"canSendToGraveyard",t=>(console.log(t),!0));s(this,"canRelease",t=>(console.log(t),!0));s(this,"canTryBanish",(t,i,a)=>this.entity.procFilterBundle.effectiveOperators.filter(r=>r.procTypes.includes(i)).every(r=>r.filter(this,this.entity,a,[t])));s(this,"battleDamage",(t,i,a,r)=>{const n=wa(t,r.activator,this,i,a,r.action);return this.damage(i,n)});s(this,"effectDamage",(t,i)=>{const a=Ea(t,i,this);return this.damage(i.action.entity,a)});s(this,"damage",(t,i)=>{const a=[];if(i.point){const r=i.damageType==="Heal"?i.point:i.point*-1;a.push(this.setLp(this._lp+r,t,i.damageType))}return i.damageToOpponent1&&a.push(this.getOpponentPlayer().setLp(this._lp-i.damageToOpponent1,t,i.damageType)),i.damageToOpponent2&&a.push(this.getOpponentPlayer().setLp(this._lp-i.damageToOpponent2,t,i.damageType)),a});s(this,"lostLp",(t,i)=>this.setLp(this._lp-t,i,"Lost"));s(this,"payLp",(t,i)=>this.setLp(this._lp-t,i,"Pay"));s(this,"heal",(t,i)=>this.setLp(this._lp+t,i,"Heal"));s(this,"setLp",(t,i,a)=>{const r={clock:this.duel.clock.getClone(),reason:a||"Set",beforeLp:this._lp,afterLp:t,entity:i};return this.lifeLog.push(r),this._lp=t,this.writeInfoLog(`„É©„Ç§„Éï„Éù„Ç§„É≥„ÉàÂ§âÂãïÔºö${r.afterLp-r.beforeLp}Ôºà${r.beforeLp} ‚áí ${r.afterLp}Ôºâ`),r});s(this,"getOpponentPlayer",()=>this.duel.firstPlayer===this?this.duel.secondPlayer:this.duel.firstPlayer);s(this,"getCells",(...t)=>this.duel.field.getCells(...t).filter(i=>i.owner===this));s(this,"getHandCell",()=>this.getCells("Hand")[0]);s(this,"getDeckCell",()=>this.getCells("Deck")[0]);s(this,"getExtraDeck",()=>this.getCells("ExtraDeck")[0]);s(this,"getGraveyard",()=>this.getCells("Graveyard")[0]);s(this,"getFieldZone",()=>this.getCells("FieldSpellZone")[0]);s(this,"getBanished",()=>this.getCells("Banished")[0]);s(this,"getMonsterZones",()=>this.getCells("MonsterZone"));s(this,"getExtraMonsterZones",()=>this.getCells("ExtraMonsterZone"));s(this,"getSpellTrapZones",()=>this.getCells("SpellAndTrapZone"));s(this,"getXyzMaterialZone",()=>this.getCells("XyzMaterialZone")[0]);s(this,"getEmptyMonsterZones",()=>this.getMonsterZones().filter(t=>t.cardEntities.length===0));s(this,"getEmptyExtraZones",()=>this.getExtraMonsterZones().length===0?this.getMonsterZones().filter(t=>t.cardEntities.length===0):[]);s(this,"getAvailableMonsterZones",()=>this.getMonsterZones().filter(t=>t.isAvailable));s(this,"getAvailableExtraZones",()=>this.getExtraMonsterZones().length===0?this.duel.field.getCells("ExtraMonsterZone").filter(t=>t.isAvailable):[]);s(this,"getAvailableSpellTrapZones",()=>this.getSpellTrapZones().filter(t=>t.isAvailable));s(this,"getMonstersOnField",()=>this.duel.field.getMonstersOnFieldStrictly().filter(t=>t.controller===this));s(this,"getSpellTrapsOnField",()=>this.duel.field.getSpellTrapsOnFieldStrictly().filter(t=>t.controller===this));s(this,"getPendingMonstersOnField",()=>this.duel.field.getPendingMonstersOnField().filter(t=>t.controller===this));s(this,"getPendulumScaleMonsters",()=>this.duel.field.getCardsOnFieldStrictly().filter(t=>t.isPendulumScale).filter(t=>t.controller===this));s(this,"getPendulumScales",()=>{const t=this.getPendulumScaleMonsters();if(t.length<2)return;const i=t.find(l=>l.fieldCell.column===(this.seat==="Below"?1:5)),a=t.find(l=>l.fieldCell.column===(this.seat==="Below"?5:1));if(!i||!a)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",t);const r=i.psR,n=a.psL;if(r===void 0||n===void 0)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",t);return r>n?{upperBound:r,lowerBound:n}:{upperBound:n,lowerBound:r}});s(this,"getEntiteisOnField",()=>this.duel.field.getCardsOnFieldStrictly().filter(t=>t.controller===this));s(this,"pushDeck",t=>{this.deckInfo.cardNames.map(i=>t[i]).filter(i=>i).forEach(i=>b.createCardEntity(this,i)),this.duel.log.info(`„Éá„ÉÉ„Ç≠„Çí„Çª„ÉÉ„Éà„ÄÇ„É°„Ç§„É≥${this.getDeckCell().cardEntities.length}Êûö„ÄÇ„Ç®„ÇØ„Çπ„Éà„É©${this.getExtraDeck().cardEntities.length}Êûö„ÄÇ`,this)});s(this,"draw",async(t,i,a)=>{var l;if(t<1)return;const r=this.getDeckCell(),n=[];this.writeInfoLog(`„Éá„ÉÉ„Ç≠„Åã„Çâ„Ç´„Éº„Éâ„Çí${t}Êûö„Éâ„É≠„Éº„ÄÇ`);for(const o of Array(t)){if(!r.cardEntities.length)throw this.writeInfoLog(n.length>0?`„Éá„ÉÉ„Ç≠„Åã„Çâ„Ç´„Éº„Éâ„Çí${t}Êûö„Éâ„É≠„Éº„Åó„Çà„ÅÜ„Å®„Åó„Åü„Åå„ÄÅ${n.length}Êûö„Åó„Åã„Éâ„É≠„Éº„Åß„Åç„Å™„Åã„Å£„Åü„ÄÇ${n}`:"„Éá„ÉÉ„Ç≠„Åã„Çâ„Ç´„Éº„Éâ„Çí„Éâ„É≠„Éº„Åß„Åç„Å™„Åã„Å£„Åü„ÄÇ"),this.duel.isEnded=!0,this.setLp(0),new $(this.getOpponentPlayer(),"ÂØæÊà¶Áõ∏Êâã„Åå„Éá„ÉÉ„Ç≠„Åã„Çâ„Ç´„Éº„Éâ„Çí„Éâ„É≠„Éº„Åß„Åç„Å™„Åã„Å£„Åü„ÄÇ");const u=r.cardEntities[0];await u.draw(i?["Effect"]:["Rule"],i,a),n.push(((l=u.origin)==null?void 0:l.name)||"!ÂêçÁß∞ÂèñÂæóÂ§±Êïó!")}});s(this,"summon",async(t,i,a,r,n,l,o,u)=>(await this.summonMany(this,t,i,a,[{monster:r,posList:n,cells:l}],o,!1,1,d=>d.length===1,u)??[])[0]);s(this,"waitSelectEntities",(t,i,a,r,n=!1)=>this.duel.view.waitSelectEntities(this,{selectables:t,qty:i,validator:a,cancelable:n},r));s(this,"waitSelectEntity",async(t,i,a=!1)=>{const r=await this.waitSelectEntities(t,1,n=>n.length===1,i,a);return r?r[0]:void 0});s(this,"waitSelectText",(t,i,a=!1)=>this.duel.view.waitSelectText(this,t,i,a));s(this,"discard",async(t,i,a=()=>!0,r,n,l,o=!1)=>{const u=this.getHandCell().cardEntities.filter(a);if(u.length<t)return[];let c=[];if(u.length===t)c=u;else if((l||this).duelistType==="NPC")c=u.randomPickMany(t);else{const d=await this.duel.view.waitSelectEntities(l||this,{selectables:u,qty:t,validator:p=>p.length===t,cancelable:o},`${t}Êûö„Ç´„Éº„Éâ„ÇíÊç®„Å¶„Çã„ÄÇ`);if(!d)return;c=d}return this.writeInfoLog(`ÊâãÊú≠„Åã„Çâ„Ç´„Éº„Éâ„Çí${c.length}ÊûöÊç®„Å¶„Åü„ÄÇ${c.map(d=>{var p;return(p=d.origin)==null?void 0:p.name})}„ÄÇ`),await v.discardManyForTheSameReason(c,["Discard",i],r,n),c});s(this,"getEnableSummonList",(t,i,a,r,n,l,o)=>{const u=this.duel.field.getCells("ExtraMonsterZone"),c=u.filter(p=>!l.map(g=>g.material).includes(p.cardEntities[0])).filter(p=>p.owner===this),d=[];return c.length&&d.push(...u.filter(p=>!c.includes(p)).filter(p=>p.isAvailable)),n.map(p=>({...p,summoner:this})).map(p=>{var g;return(i!=="LinkSummon"||!this.duel.field.canExtraLink(p.monster,l))&&(p.cells=p.cells.filter(h=>!d.includes(h))),(g=p.monster.status.monsterCategories)!=null&&g.includes("Link")&&(p.posList=p.posList.filter(h=>h==="Attack")),p}).map(p=>({...p,cells:p.cells.filter(g=>g.cardEntities.length===0||l.some(h=>h.material===g.cardEntities[0]))})).map(p=>{var g,h;if(p.monster.fieldCell.cellType==="ExtraDeck"){if((g=p.monster.status.monsterCategories)!=null&&g.includes("Link")||(h=p.monster.status.monsterCategories)!=null&&h.includes("Pendulum"))return{...p,cells:p.cells.filter(y=>y.cellType==="ExtraMonsterZone"||y.linkArrowSources.filter(P=>!l.map(f=>f.material).includes(P)).length)}}else return{...p,cells:p.cells.filter(y=>y.cellType!=="ExtraMonsterZone")};return p}).filter(p=>p.cells.length&&p.posList.length).map(p=>this.entity.summonFilterBundle.filter(t,i,a,r,p,l,o)).filter(p=>p.cells.length&&p.posList.length).map(p=>p.monster.summonFilterBundle.filter(t,i,a,r,p,l,o)).filter(p=>p.cells.length&&p.posList.length).map(p=>l.map(g=>g.material.summonFilterBundle).reduce((g,h)=>h.filter(t,i,a,r,g,l,o),p)).filter(p=>p.cells.length&&p.posList.length)});s(this,"prepareToSummonMany",async(t,i,a,r,n,l,o,u,c,d,p="ÁâπÊÆäÂè¨Âñö„Åô„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû„ÄÇ")=>{const g=this.getEnableSummonList(t,i,a,r,n,l,o);if(!g.length)return[];let h=g.map(P=>({...P,cells:[...P.cells],posList:[...P.posList]}));const y=[];for(;h.length&&y.length<(u??Number.MAX_SAFE_INTEGER);){const P=d&&!y.length||c(y.map(B=>B.monster));let f=h.randomPick();if(h.length>1){const B=await this.waitSelectEntity(h.map(pe=>pe.monster),p,P);if(!B)return y;f=h.find(pe=>pe.monster===B)??f}let A=[...f.posList].randomPick(),L=[...f.cells].randomPick();if((f.cells.length||f.posList.length)&&this.duelistType!=="NPC"){const B=await this.duel.view.waitSelectSummonDestination(f.summoner,f.monster,f.cells,f.posList,P);if(!B)return y;L=B.dest,A=B.battlePosition}y.push({summoner:this,monster:f.monster,pos:A,dest:L}),h.forEach(B=>B.cells=B.cells.filter(pe=>!y.map(Oi=>Oi.dest).includes(pe))),h=h.filter(B=>B!==f).filter(B=>B.cells.length)}return y});s(this,"summonAll",(t,i,a,r,n,l,o,u,c)=>this.summonMany(t,i,a,r,n,l,o,n.length,d=>d.length===n.length,u,c));s(this,"summonOne",async(t,i,a,r,n,l,o,u,c)=>{const d=await this.summonMany(t,i,a,r,n,l,o,1,p=>p.length===1,u,c);if(d)return d[0]});s(this,"summonMany",(t,i,a,r,n,l,o,u,c,d,p)=>Be.summonMany(t,i,a,r,n.map(g=>({...g,summoner:this})),l,o,u,c,d,p));s(this,"selectAttackTargetForNPC",(t,i)=>{const a=t.atk??0,r=t.getAttackTargets();if(!r.length)return;const n=r.find(l=>l.entityType==="Duelist");return n&&(a>=be(1600,this.getOpponentPlayer().lp)||t.info.battlePotisionChangeCount>0)?n:r.find(l=>l.battlePosition==="Attack"?a>=(l.atk??0):a<(l.battlePosition==="Set"?1e3:l.def??0)?!1:l.validateDestory("BattleDestroy",this,t,i))});s(this,"selectActionForNPC",(t,i)=>{if(!t.length)return;const a=t.filter(f=>f.action.isMandatory);if(a.length)return a.randomPick();let r=t.filter(f=>!this.actionBlackListForNPC.includes(f.action.playType));console.log(r);const n=r.filter(f=>!Number.isNaN(f.action.priorityForNPC)).shuffle().sort((f,A)=>f.action.priorityForNPC-A.action.priorityForNPC);if(n.length)return n[0];const l=r.filter(f=>f.action.playType==="TriggerEffect");if(l.length)return l.randomPick();if(this.duel.phase!=="main1"&&this.duel.phase!=="main2"){const f=r.filter(A=>A.action.playType==="IgnitionEffect");if(f.length)return f.randomPick()}const o=r.filter(f=>f.action.playType==="Battle").sort((f,A)=>(f.action.entity.atk??0)-(A.action.entity.atk??0));if(o.length)return o.find(f=>this.selectAttackTargetForNPC(f.action.entity,f.action));r=r.filter(f=>f.action.playType!=="Battle");const u=r.length?i.slice(-1)[0]:void 0,c=r.filter(f=>f.action.negatePreviousBlock);if(u&&u.activator!==this&&c)return c.randomPick();if(r=r.filter(f=>!f.action.negatePreviousBlock),!r.length)return;const d=_e(...this.getOpponentPlayer().getMonstersOnField().filter(f=>f.battlePosition==="Attack").map(f=>f.atk??0),1600),p=be(...this.getOpponentPlayer().getMonstersOnField().map(f=>f.battlePosition==="Set"?1500:(f.battlePosition==="Attack"?f.atk:f.def)??0),1500),g=this.getMonstersOnField(),h=_e(...g.filter(f=>f.battlePosition==="Attack").map(f=>f.atk??0),0);let y=r.filter(f=>f.action.playType!=="ChangeBattlePosition").filter(f=>f.action.entity.battlePosition!=="Attack").filter(f=>(f.action.entity.atk??0)>=d||(f.action.entity.atk??0)>p&&(f.action.entity.atk??0)>2300);if(y.length)return y.randomPick();r=r.filter(f=>f.action.playType!=="ChangeBattlePosition").filter(f=>f.action.playType!=="SpellTrapSet").filter(f=>f.action.entity.actions.filter(A=>A.playType!=="NormalSummon"&&A.playType!=="SpecialSummon").flatMap(A=>A.executableCells).every(A=>A!=="Hand")||f.action.playType!=="NormalSummon"&&f.action.playType!=="SpecialSummon");const P=[...r.filter(f=>f.action.playType==="NormalSummon").filter(f=>(f.action.entity.lvl??12)<5),...r.filter(f=>f.action.playType==="SpecialSummon"),...r.filter(f=>f.action.playType==="NormalSummon").filter(f=>(f.action.entity.atk??0)>2600||(f.action.entity.atk??0)>2300&&(f.action.entity.lvl??12)<7).filter(f=>(f.action.entity.atk??0)>=h),...r.filter(f=>f.action.entity.face==="FaceUp").filter(f=>f.action.entity.isOnFieldStrictly)];if(P.length)return P.randomPick();if(r=r.filter(f=>f.action.playType!=="NormalSummon").filter(f=>f.action.playType!=="SpecialSummon"),this.duel.phase==="main2"){if(y=t.filter(f=>f.action.playType==="ChangeBattlePosition").filter(f=>f.action.entity.battlePosition==="Attack").filter(f=>(f.action.entity.atk??0)<d||(f.action.entity.atk??0)>p&&(f.action.entity.atk??0)>2300),y.length)return y.randomPick();if(this.getAvailableSpellTrapZones.length>1)return t.filter(f=>f.action.playType==="SpellTrapSet").filter(f=>f.action.entity.kind!=="Spell"||f.action.entity.status.spellCategory==="QuickPlay").randomPick()}if(console.log(r),Math.random()<r.length/4)return r.randomPick()});this.duel=t,this.seat=i,this.profile=a,this.chainConfig=a.chainConfig??{noticeSelfChain:!0,noticeFreeChain:!0},this.duelistType=r,this.deckInfo=n,this.initHand=l,this.lifeLog=[],this.infoOrigin={maxRuleNormalSummonCount:1,ruleNormalSummonCount:0,ruleNormalSummonCountQty:0,effectNormalSummonCount:0,effectNormalSummonCountQty:0,specialSummonCount:0,specialSummonCountQty:0},this.info={...this.infoOrigin},this.statusOrigin={maxSpecialSummonCount:Number.MAX_VALUE,canDrawByEffect:!0,canSearchFromDeck:!0,canDiscardAsCost:!0,canDiscardAsEffect:!0},this.status={...this.statusOrigin},this._lp=8e3;const o=[];this.duelistType==="NPC"&&(this.profile.npcLvl<0&&o.push("NormalSummon","SpecialSummon","SpellTrapSet"),this.profile.npcLvl<1&&o.push("CardActivation","IgnitionEffect","TriggerEffect","QuickEffect"),this.profile.npcLvl<101&&o.push("Battle")),this.actionBlackListForNPC=o}get entity(){const t=this.getHandCell().entities.find(i=>i.entityType==="Duelist");return t||b.createPlayerEntity(this)}get lp(){return this._lp}get isTurnPlayer(){return this.duel.getTurnPlayer()===this}get canDraw(){return!0}get canAddToHandFromDeck(){return!0}};s(Be,"summonMany",async(t,i,a,r,n,l,o,u,c,d,p="ÁâπÊÆäÂè¨Âñö„Åô„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû„ÄÇ")=>{const g=n.map(y=>y.summoner).getDistinct(),h=[];for(const y of g){const P=await y.prepareToSummonMany(t,i,a,r,n.filter(f=>f.summoner===y),l,o,u,c,d,p);h.push(...P)}if(h.length)return h.forEach(y=>y.monster.info.materials.reset(...l)),await v.moveToXyzOwner(h[0].dest,l.map(y=>y.material).filter(y=>y.kind==="XyzMaterial"),["XyzMaterial","Rule"],h[0].monster,t),await b.summonMany(h,i,a,r.entity,t),h.map(y=>y.monster)});let Pe=Be;const Se=["Controller","Opponent"],Nt=["NormalSummon","SpecialSummon","FlipSummon"],Ie=["IgnitionEffect","TriggerEffect","QuickEffect","CardActivation"],Ga=[...Nt,...Ie],ja=e=>e==="CardActivation"?"CardActivation":Ie.some(t=>t===e)?"EffectActivation":"NonActivate",ft=["NormalSummon","AdvanceSummon","SpecialSummon","SpecialSummonFromDeck","SendToGraveyardFromDeck","Draw","SearchFromDeck","BanishFromDeck","BanishFromGraveyard","AddToHandFromGraveyard","ReturnToDeckFromGraveyard","SpecialSummonFromGraveyard","SpecialSummonFromBanished","ReturnToHandFromGraveyard","ReturnToHandFromField","BanishFromField","BanishFromHand","Destroy","DestroyMultiple","DestroyOnField","DestroyMultipleOnField","DestroyOnOpponentField","DestroyMultipleOnOpponentField","DestroyMonsterOnField","DestroyMonstersOnField","DestroySpellTrapOnField","DestroySpellTrapsOnField","SpecialSummonFromHand","SpecialSummonFromExtraDeck","IfNormarlSummonSucceed","IfSpecialSummonSucceed","DamageToOpponent","DamageToSelf","PayLifePoint","DiscordAsCost","DiscordAsEffect","RollDice","BounceToHand","NegateCardEffect","NegateCardActivation","NegateNormalSummon","NegateSpecialSummon"],ee=class ee extends De{constructor(i,a,r,n){super(i,a,r);s(this,"toString",()=>this.isWithChainBlock&&this.playType!=="CardActivation"?`${this.entity.toString()}„ÅÆ¬´${this.title}¬ª`:`${this.entity.toString()}„ÅÆ${this.title}`);s(this,"addhocMaterialLimitation");s(this,"getClone",i=>new ee(this.seq,this.entity,this.definition,i));s(this,"getEnableMaterialPatterns",i=>{var a,r;return((r=(a=this.definition).getEnableMaterialPatterns)==null?void 0:r.call(a,i).filter(this.addhocMaterialLimitation))??[]});s(this,"validateCount",(i,a)=>{const r=a.filter(l=>this.isSameGroup(l.action)).length;if(this.isOnlyNTimesPerDuel>0&&this.entity.field.duel.chainBlockLog.records.filter(l=>!l.chainBlockInfo.isNegatedActivationBy).filter(l=>this.isSameGroup(l.chainBlockInfo.action)).filter(l=>l.chainBlockInfo.activator===i).length+r>=this.isOnlyNTimesPerDuel||this.isOnlyNTimesPerTurn>0&&this.entity.field.duel.chainBlockLog.records.filter(l=>!l.chainBlockInfo.isNegatedActivationBy).filter(l=>this.isSameGroup(l.chainBlockInfo.action)).filter(l=>l.clock.turn===this.entity.field.duel.clock.turn).filter(l=>l.chainBlockInfo.activator===i).length+r>=this.isOnlyNTimesPerTurn||this.isOnlyNTimesPerChain>0&&r>=this.isOnlyNTimesPerChain)return!1;const n=r+this.entity.counterHolder.getActionCount(this);return!(this.isOnlyNTimesPerTurnIfFaceup>0&&n>=this.isOnlyNTimesPerTurnIfFaceup||this.isOnlyNTimesIfFaceup>0&&n>=this.isOnlyNTimesIfFaceup)});s(this,"validate",(i,a,r)=>{if(this.playType==="CardActivation"&&this.entity.isOnFieldStrictly&&this.entity.face==="FaceUp"||this.isWithChainBlock&&!this.entity.status.canActivateEffect||r&&this.needsToPayCost||!this.validateCount(i,a))return;const n=_e(0,...a.map(u=>u.chainNumber??-1)),l={index:a.length,chainNumber:this.isWithChainBlock?n+1:void 0,action:this,activator:i,targetChainBlock:a.slice(-1)[0],isActivatedIn:this.entity.fieldCell,isActivatedAt:this.duel.clock.getClone(),costInfo:{},state:"unloaded",dest:void 0,ignoreCost:!1};if(this.definition.canPayCosts&&!r&&!this.definition.canPayCosts(l,this.playType==="AfterChainBlock"?[]:a))return;const o=this.definition.validate(l,this.playType==="AfterChainBlock"?[]:a);if(o)return{action:this,dests:o,originSeq:this.seq}});s(this,"prepare",async(i,a,r,n,l,o)=>{var y,P;let u=l;const c=this.isWithChainBlock?_e(0,...n.map(f=>f.chainNumber??-1))+1:void 0;let d="";if(c!==void 0&&(d+=`„ÉÅ„Çß„Éº„É≥${c}: `),this.playType==="CardActivation"||this.playType==="SpellTrapSet")if(this.entity.fieldCell.cellType==="Hand"){let f=a?[a]:this.entity.status.spellCategory==="Field"?[i.getFieldZone()]:i.getAvailableSpellTrapZones();if(this.entity.status.spellCategory==="Field"){const L=i.getFieldZone().cardEntities;if(L.length){const B=L[0];await v.sendManyToGraveyardForTheSameReason(i.getFieldZone().cardEntities,["Rule"],this.entity,i),i.writeInfoLog(`„Éï„Ç£„Éº„É´„ÉâÈ≠îÊ≥ï„ÅÆ‰∏äÊõ∏„Åç„Å´„Çà„Çä„ÄÅ${B.toString()}„ÅØÂ¢ìÂú∞„Å´ÈÄÅ„Çâ„Çå„Åü„ÄÇ`),u=!1}}(y=this.entity.status.monsterCategories)!=null&&y.includes("Pendulum")&&(f=f.filter(L=>L.isAvailableForPendulum));let A=f[0];if(f.length>1){A=f.randomPick();const L=this.playType==="SpellTrapSet"?"„Çª„ÉÉ„Éà":"„Ç´„Éº„Éâ„ÅÆÁô∫Âãï",B=await this.duel.view.waitSelectDestination(i,this.entity,f,"„Ç´„Éº„Éâ„ÇíÁßªÂãïÂÖà„Å∏„Éâ„É©„ÉÉ„Ç∞",L,u);if(!B)return;A=B}d+="ÊâãÊú≠„Åã„Çâ",this.playType==="SpellTrapSet"?d+="È≠îÊ≥ï„ÉªÁΩ†„Ç´„Éº„Éâ„Çí„Çª„ÉÉ„Éà„ÄÇ":d+=`${this.entity.toString()}„ÇíÁô∫Âãï„ÄÇ`,i.writeInfoLog(d),u=!1,this.playType==="CardActivation"&&(this.entity.info.isPending=!0),(P=this.entity.status.monsterCategories)!=null&&P.includes("Pendulum")?await this.entity.activateAsPendulumScale(A,["CardActivation"],this.entity,i):this.playType==="CardActivation"?await this.entity.activateSpellTrapFromHand(A,this.entity.kind,["CardActivation"],this.entity,i):await this.entity.setAsSpellTrap(A,this.entity.kind,["SpellTrapSet"],this.entity,i)}else this.entity.isOnField&&this.entity.face==="FaceDown"&&(d+=`„Çª„ÉÉ„Éà„Åï„Çå„Å¶„ÅÑ„Åü${this.entity.toString()}„ÇíÁô∫Âãï„ÄÇ`,i.writeInfoLog(d),u=!1,this.playType==="CardActivation"&&(this.entity.info.isPending=!0),await this.entity.setNonFieldMonsterPosition(this.entity.origin.kind,"FaceUp",["Rule"]));else c!==void 0&&(d+=`${this.toString()}„ÇíÁô∫Âãï„ÄÇ`,i.writeInfoLog(d));const p={index:n.length,chainNumber:c,action:this,activator:i,targetChainBlock:r,isActivatedIn:this.entity.fieldCell,isActivatedAt:this.duel.clock.getClone(),costInfo:{},state:"ready",dest:a,ignoreCost:!1};if(console.log(this.definition.payCosts,o),this.definition.payCosts&&!o){const f=await this.definition.payCosts(p,n,u);if(!f)return;p.costInfo=f,u=!1}const g=await this.definition.prepare(p,n,u);if(g===void 0)return;const h={...g};if(Nt.some(f=>f===this.playType)){const f=g.nextChainBlockFilter??(()=>!0);h.nextChainBlockFilter=(A,L)=>L.negateSummon&&f(A,L)}return{...p,...h}});s(this,"execute",async(i,a)=>{if(i.action.isLikeContinuousSpell&&(i.action.entity.face==="FaceDown"||!i.action.entity.isOnField))return this.entity.info.isPending=!1,!1;const r=await this.definition.execute(i,a);return this.entity.determine(),r});s(this,"settle",(i,a)=>(this.isOnlyNTimesPerTurnIfFaceup>0?this.entity.counterHolder.incrementActionCountPerTurn(this):this.isOnlyNTimesIfFaceup>0&&this.entity.counterHolder.incrementActionCount(this),this.definition.settle(i,a)));s(this,"directExecute",async(i,a,r)=>{const n=await this.prepare(i,void 0,a,[],!1,r);if(!n)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",this,i,r);const l=await this.execute(n,[]);return await this.settle(n,[]),l});s(this,"isSame",i=>this.entity.origin.name===i.entity.origin.name&&this.title===i.title);s(this,"isSameGroup",i=>this.actionGroupName?this.entity.origin.name===i.entity.origin.name&&this.actionGroupName===i.actionGroupName:this.isSame(i));s(this,"calcChainBlockTagsForDestroy",(i,a)=>{if(!ft.length)return[];const r=["Destroy"];ft.length>1&&r.push("DestroyMultiple");const n=a.filter(c=>c.isOnFieldStrictly);n.length&&(r.push("DestroyOnField"),n.length>1&&r.push("DestroyMultipleOnField"));const l=n.filter(c=>c.kind==="Monster");l.length&&(r.push("DestroyMonsterOnField"),l.length>1&&r.push("DestroyMonstersOnField")),n.filter(c=>c.kind!=="Monster").length&&(r.push("DestroySpellTrapOnField"),l.length>1&&r.push("DestroySpellTrapsOnField"));const u=n.filter(c=>c.controller!==i);return u.length&&(r.push("DestroyOnOpponentField"),u.length>1&&r.push("DestroyMultipleOnOpponentField")),r});this.addhocMaterialLimitation=n??(()=>!0)}get definition(){return super.definition}get playType(){return this.definition.playType}get spellSpeed(){return this.definition.spellSpeed}get needsToPayCost(){return this.definition.needsToPayCost??!1}get hasToTargetCards(){return this.definition.hasToTargetCards??!1}get isWithChainBlock(){return Ie.some(i=>i===this.playType)}get isLikeContinuousSpell(){return this.definition.isLikeContinuousSpell||this.entity.isLikeContinuousSpell&&this.playType==="CardActivation"}get isNoticedForcibly(){return this.isMandatory||this.definition.playType==="TriggerEffect"||this.definition.playType==="LingeringEffect"||this.negatePreviousBlock||this.negateSummon}get negatePreviousBlock(){return this.definition.negatePreviousBlock??!1}get negateSummon(){return this.definition.negateSummon??!1}get priorityForNPC(){return this.definition.priorityForNPC??Number.NaN}};s(ee,"createNew",(i,a)=>new ee("AutoSeq",i,a)),s(ee,"createDummyAction",(i,a,r,n,l)=>({action:ee.createNew(i,{title:a,isMandatory:!1,executableCells:[],executablePeriods:[],executableDuelistTypes:[],playType:"Dammy",spellSpeed:"Dammy",validate:()=>r,prepare:async()=>{},execute:async()=>!1,settle:async()=>!1}),dests:r,battlePosition:n,originSeq:(l==null?void 0:l.seq)??-1}));let ue=ee;const R=async()=>({selectedEntities:[],chainBlockTags:[],prepared:void 0}),Ce=async(e,t,i)=>(e.activator.payLp(i,e.action.entity),{lifePoint:i}),Ua=e=>e.activator.canSendToGraveyard([e.action.entity])&&e.action.entity.canBeSentToGraveyard(e.activator,e.action.entity,"SendToGraveyardAsCost",e.action),Va=async e=>(await e.action.entity.sendToGraveyard(["Cost"],e.action.entity,e.activator),{sendToGraveyard:[e.action.entity]}),Te=e=>e.activator.canTryBanish(e.action.entity,"BanishAsCost",e.action)&&e.action.entity.canBeBanished("BanishAsCost",e.activator,e.action.entity,e.action),Ne=async e=>(await e.action.entity.banish(["Cost"],e.action.entity,e.activator),{banish:[e.action.entity]}),za=(e,t,i=1)=>t.filter(a=>e.activator.canTryBanish(a,"BanishAsCost",e.action)).filter(a=>a.canBeBanished("BanishAsCost",e.activator,e.action.entity,e.action)).length>=i,Qa=async(e,t,i,a)=>{const r=t.filter(l=>e.activator.canTryBanish(l,"BanishAsCost",e.action)).filter(l=>l.canBeBanished("BanishAsCost",e.activator,e.action.entity,e.action)),n=await e.activator.waitSelectEntities(r,a,i,"„Ç≥„Çπ„Éà„Å®„Åó„Å¶Èô§Â§ñ„Åô„Çã„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû",!1)??[];return await v.banishManyForTheSameReason(n,["Cost"],e.action.entity,e.activator),{banish:n}},Lt=(e,t=()=>!0,i=1)=>e.activator.getHandCell().cardEntities.filter(t).filter(a=>e.activator.canDiscard([a])).length>=i,qt=async(e,t=!1,i=()=>!0,a=1)=>({discard:await e.activator.discard(a,"Cost",i,e.action.entity,e.activator,e.activator,t)}),re=async(e,t,i=_,a=n=>n.length===1,r=1)=>{const n=e.activator.getMonsterZones(),l=e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,t.filter(c=>c.kind==="Monster").filter(c=>c.canBeTargetOfEffect(e)).map(c=>({monster:c,posList:i,cells:n})),[],!1),o=await e.activator.waitSelectEntities(l.map(c=>c.monster),r,a,"ÁâπÊÆäÂè¨Âñö„Åô„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",!1)??[];if(!o.length)throw new q(e);const u=o.map(c=>c.fieldCell.cellType).getDistinct().filter(c=>c==="Graveyard"||c==="Banished").map(c=>c==="Graveyard"?"SpecialSummonFromGraveyard":"SpecialSummonFromBanished");return{selectedEntities:o,chainBlockTags:u,prepared:void 0}},ne=async(e,t=["Attack","Defense"],i=!0)=>{const a=e.activator.getMonsterZones(),r=e.selectedEntities.filter(n=>!n.wasMovedAfter(e.isActivatedAt)).map(n=>({monster:n,posList:t,cells:a}));return i&&(r.length!==e.selectedEntities.length||a.length<r.length)?!1:(await e.activator.summonAll(e.activator,"SpecialSummon",["Effect"],e.action,r,[],!1,!1),!0)},Wa=async(e,t,i=["Attack","Defense"])=>{const a=e.activator.getMonsterZones(),r=t.map(n=>({monster:n,posList:i,cells:a}));return await e.activator.summonAll(e.activator,"SpecialSummon",["Effect"],e.action,r,[],!1,!1),!0},Xa=(e,t,i)=>({title:e,playType:"SystemPeriodAction",spellSpeed:"Normal",executableCells:K,executablePeriods:t,executableDuelistTypes:Se,isMandatory:!0,validate:i,prepare:R,execute:async()=>!0,settle:async()=>!0}),Ka=e=>{if(e.action.entity.status.spellCategory==="Field")return[e.activator.getFieldZone()];const t=e.activator.getAvailableSpellTrapZones();return t.length>0?t:void 0},S={title:"„Çª„ÉÉ„Éà",playType:"SpellTrapSet",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isMandatory:!1,validate:Ka,prepare:R,execute:async()=>!0,settle:async()=>!0},k=e=>{var i;if(e.action.entity.info.isPending||e.action.entity.info.isDying||e.action.entity.info.isSettingSickness)return;if(ie.some(a=>a===e.action.entity.fieldCell.cellType))return e.action.entity.face==="FaceDown"?[]:void 0;if(e.action.spellSpeed==="Normal"&&!e.activator.isTurnPlayer||e.action.entity.fieldCell.cellType==="Hand"&&!e.activator.isTurnPlayer)return;if(e.action.entity.status.spellCategory==="Field")return[e.activator.getFieldZone()];let t=e.activator.getAvailableSpellTrapZones();return(i=e.action.entity.status.monsterCategories)!=null&&i.includes("Pendulum")&&(t=t.filter(a=>a.isAvailableForPendulum)),t.length>0?t:void 0},se={title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:k,prepare:R,execute:async()=>!0,settle:async()=>!0},Ja=(e,t,i=()=>!0)=>e.action.entity.field.getMonstersOnFieldStrictly().filter(r=>r.face==="FaceUp").filter(r=>r.canBeTargetOfEffect(e)).filter(r=>i(r,e.action.entity)).length?k(e):void 0,Ya=async(e,t,i,a,r,n=()=>!0)=>{const l=e.action.entity.field.getMonstersOnFieldStrictly().filter(u=>u.face==="FaceUp").filter(u=>u.canBeTargetOfEffect(e)).filter(u=>n(u,e.action.entity)),o=await e.activator.waitSelectEntity(l,"Ë£ÖÂÇôÂØæË±°„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",i);if(o)return e.action.entity.info.equipedBy=o,e.action.entity.info.effectTargets[e.action.seq]=[o],{chainBlockTags:a??[],selectedEntities:[o],prepared:r}},Rt=async(e,t,i=()=>!0)=>{const a=e.selectedEntities[0];return e.action.entity.info.equipedBy=a,e.action.entity.info.effectTargets[e.action.seq]=[a],i(a,e.action.entity)?(e.action.entity.info.equipedBy=a,e.action.entity.info.validateEquipOwner=i,a.info.equipEntities.push(e.action.entity),!0):(await e.action.entity.ruleDestory(),e.activator.writeInfoLog(`${a.toString()}„ÅåË£ÖÂÇôÊù°‰ª∂„ÇíÊ∫Ä„Åü„Åï„Å™„Åè„Å™„Å£„Åü„Åü„ÇÅ„ÄÅ${e.action.entity.toString()}„ÅØÁ†¥Â£ä„Åï„Çå„Åü„ÄÇ`),!1)},de=(e=()=>!0)=>({title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:(t,i)=>Ja(t,i,e),prepare:(t,i,a)=>Ya(t,i,a,[],void 0,e),execute:Rt,settle:async()=>!0});function*Ia(){yield{name:"ÈÄ£ÂêàËªç",actions:[se,S],continuousEffects:[we("Áô∫Âãï","Spell",e=>[Z.createContinuous("Áô∫Âãï",t=>t.isSpawnedBy.isOnFieldStrictly&&t.isSpawnedBy.face==="FaceUp",e,(t,i)=>i.controller===t.isSpawnedBy.controller&&i.types.includes("Warrior")&&i.isOnFieldStrictly&&i.face==="FaceUp","attack","wip","Addition",(t,i,a)=>{if(!t.isEffective||i.face==="FaceDown")return a;const r=t.controller.getMonstersOnField().filter(n=>n.face==="FaceUp").filter(n=>n.types.includes("Warrior")||n.types.includes("Spellcaster")).length;return a+r*200})])]}}const Ht=Object.freeze(Object.defineProperty({__proto__:null,default:Ia},Symbol.toStringTag,{value:"Module"}));function*er(){yield*[{name:"„É™„Éì„É≥„Ç∞„Éá„ÉÉ„Éâ„ÅÆÂëº„Å≥Â£∞",pos:"Attack",filter:()=>!0},{name:"„Ç®„É≥„Ç∏„Çß„É´„Éª„É™„Éï„Éà",pos:"Attack",filter:e=>(e.lvl??12)<3},{name:"Ê≠£Áµ±„Å™„ÇãË°ÄÁµ±",pos:"Attack",filter:e=>{var t;return(t=e.status.monsterCategories)==null?void 0:t.includes("Normal")}},{name:"Ëòá„Çä„ÅóÈ≠Ç",pos:"Defense",filter:e=>{var t;return(t=e.status.monsterCategories)==null?void 0:t.includes("Normal")}},{name:"„É™„Éü„ÉÉ„Éà„Éª„É™„Éê„Éº„Çπ",pos:"Attack",filter:e=>(e.atk??9999)<=1e3,onMonsterAfterMove:async(e,t)=>{if(!t.isOnFieldAsMonsterStrictly||t.face==="FaceDown")return"RemoveMe";if(e.action.entity.isEffective&&t.battlePosition==="Defense")return e.action.entity.controller.writeInfoLog(`${t.toString()}„ÅåÂÆàÂÇôË°®Á§∫„Å´„Å™„Å£„Åü„Åü„ÇÅ„ÄÅ${e.action.entity.toString()}„Å®„Å®„ÇÇ„Å´Á†¥Â£ä„Åï„Çå„Çã„ÄÇ`),await v.tryMarkForDestory([t,e.action.entity],e),"RemoveMe"}}].map(e=>({name:e.name,actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:D,executableDuelistTypes:["Controller"],validate:t=>{const i=t.activator.getMonsterZones();if(t.activator.getEnableSummonList(t.activator,"SpecialSummon",["Effect"],t.action,t.activator.getGraveyard().cardEntities.filter(r=>r.kind==="Monster").filter(e.filter).filter(r=>r.canBeTargetOfEffect(t)).map(r=>({monster:r,posList:["Attack"],cells:i})),[],!1).length)return k(t)},prepare:t=>re(t,t.activator.getGraveyard().cardEntities.filter(i=>i.kind==="Monster").filter(e.filter).filter(i=>i.canBeTargetOfEffect(t)),["Attack"]),execute:async t=>{if(!await ne(t,["Attack"])||!t.selectedEntities.length)return!1;t.action.entity.info.effectTargets[t.action.seq]=t.selectedEntities,t.action.entity.onBeforeMove.append(async r=>{if(r.entity.face!=="FaceUp"||!r.entity.isOnFieldAsSpellTrapStrictly)return"RemoveMe";const n=Object.values(r.entity.info.effectTargets).flatMap(u=>u),[l]=r.args;if(!n.length)return"RemoveMe";const o=n[0];return o.isOnFieldStrictly&&o.face==="FaceUp"&&r.entity.isEffective&&!l.isSpellTrapZoneLikeCell&&(r.entity.controller.writeInfoLog(`${t.action.entity.toString()}„Åå„Éï„Ç£„Éº„É´„Éâ„ÇíÈõ¢„Çå„Åü„Åü„ÇÅ„ÄÅÂØæË±°„É¢„É≥„Çπ„Çø„Éº${o.toString()}„ÇíÁ†¥Â£ä„ÄÇ`),await v.tryMarkForDestory([o],t)),"RemoveMe"});const a=t.selectedEntities[0];return a.onBeforeMove.append(async r=>{if(r.entity.face!=="FaceUp"||!r.entity.isOnFieldAsMonsterStrictly)return"RemoveMe";const[,,,,,n]=r.args;return t.action.entity.isOnFieldStrictly&&t.action.entity.face==="FaceUp"&&r.entity.isEffective&&n.union(["EffectDestroy","RuleDestroy"]).length&&(t.activator.writeInfoLog(`${r.entity.toString()}„ÅåÁ†¥Â£ä„Åï„Çå„Åü„Åü„ÇÅ„ÄÅ${t.action.entity.toString()}„ÇíÁ†¥Â£ä„ÄÇ`),await v.tryMarkForDestory([a],t)),"RemoveMe"}),a.onAfterMove.append(async r=>e.onMonsterAfterMove?await e.onMonsterAfterMove(t,r):"RemoveMe"),!0},settle:async()=>!0},S]}))}const Zt=Object.freeze(Object.defineProperty({__proto__:null,default:er},Symbol.toStringTag,{value:"Module"}));function*tr(){yield{name:"ÊòáÂ§©„ÅÆÈªíËßíÁ¨õ",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Counter",executableCells:["SpellAndTrapZone"],executablePeriods:z,executableDuelistTypes:["Controller"],negateSummon:!0,validate:e=>{if(e.targetChainBlock&&e.targetChainBlock.action.playType==="SpecialSummon"&&e.targetChainBlock.activator!==e.activator&&e.activator.duel.field.getPendingMonstersOnField().length===1)return k(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["NegateSpecialSummon"],prepared:void 0}),execute:async e=>{const t=v.negateSummonMany(e.action.entity,e.activator);return await v.tryDestroy(t,e),!0},settle:async()=>!0},S]}}const $t=Object.freeze(Object.defineProperty({__proto__:null,default:tr},Symbol.toStringTag,{value:"Module"}));function*ir(){yield*[{name:"Âõ£Áµê„ÅÆÂäõ",kind:["Monster"],rate:800},{name:"È≠îÂ∞éÂ∏´„ÅÆÂäõ",kind:["Spell","Trap"],rate:500}].map(e=>({name:e.name,actions:[de(),S],continuousEffects:[me(e.name,"Spell",t=>t.info.equipedBy?[t.info.equipedBy]:[],t=>["attack","defense"].map(i=>Z.createContinuous("Áô∫Âãï",a=>a.isSpawnedBy.isOnFieldStrictly&&a.isSpawnedBy.face==="FaceUp",t,(a,r)=>r.isOnFieldStrictly&&r.face==="FaceUp",i,"wip","Addition",(a,r,n)=>{if(!a.isEffective)return n;const l=a.controller.getEntiteisOnField().filter(o=>e.kind.includes(o.kind)).length;return n+l*e.rate})))]})),yield{name:"Êó©„Åô„Åé„ÅüÂüãËë¨",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,canPayCosts:e=>e.activator.lp>=800,validate:e=>{const t=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getGraveyard().cardEntities.filter(a=>a.kind==="Monster").filter(a=>a.canBeTargetOfEffect(e)).map(a=>({monster:a,posList:["Attack"],cells:t})),[],!1).length)return k(e)},payCosts:(e,t)=>Ce(e,t,800),prepare:async e=>{const t=await re(e,e.activator.getGraveyard().cardEntities,["Attack"]);return t.chainBlockTags.push("PayLifePoint"),t},execute:async(e,t)=>e.action.entity.info.equipedBy?(await e.action.entity.ruleDestory(),!1):await ne(e,["Attack"])?(e.action.entity.onBeforeMove.append(async a=>{if(a.entity.face!=="FaceUp"||!a.entity.isOnFieldAsSpellTrapStrictly)return"RemoveMe";const r=a.entity.info.equipedBy;if(!r)return"RemoveMe";const[,,,,,n]=a.args;return r.isOnFieldStrictly&&r.face==="FaceUp"&&a.entity.isEffective&&n.union(["EffectDestroy","RuleDestroy"]).length&&(a.entity.controller.writeInfoLog(`${e.action.entity.toString()}„ÅåÁ†¥Â£ä„Åï„Çå„Åü„Åü„ÇÅ„ÄÅË£ÖÂÇôÂØæË±°„É¢„É≥„Çπ„Çø„Éº${r.toString()}„ÇíÁ†¥Â£ä„ÄÇ`),v.tryMarkForDestory([r],e)),"RemoveMe"}),Rt(e,t,(a,r)=>{var n;return(n=r.info.effectTargets[e.action.seq])==null?void 0:n.includes(a)})):(await e.action.entity.ruleDestory(),!1),settle:async()=>!0},S]},yield{name:"ÂπªÊÉë„ÅÆÂ∑ªÁâ©",actions:[de(),S],continuousEffects:[]}}const Gt=Object.freeze(Object.defineProperty({__proto__:null,default:ir},Symbol.toStringTag,{value:"Module"}));function*ar(){yield*[{name:"‰ºùË™¨„ÅÆÂâ£",attr:void 0,monType:"Warrior",atk:200,def:200},{name:"ÁßòË°ì„ÅÆÊõ∏",attr:void 0,monType:"Spellcaster",atk:200,def:200},{name:"„Éù„Çª„Ç§„Éâ„É≥„ÅÆÂäõ",attr:void 0,monType:"Aqua",atk:200,def:200},{name:"Á¥´Ê∞¥Êô∂",attr:void 0,monType:"Zombie",atk:200,def:200},{name:"ÁåõÁç£„ÅÆÊ≠Ø",attr:void 0,monType:"Beast",atk:200,def:200},{name:"Ê©üÊ¢∞ÊîπÈÄ†Â∑•Â†¥",attr:void 0,monType:"Machine",atk:200,def:200},{name:"‰ΩìÊ∏©„ÅÆ‰∏äÊòá",attr:void 0,monType:"Reptile",atk:200,def:200},{name:"È≠îËèå",attr:void 0,monType:"Plant",atk:200,def:200},{name:"Èóá„Éª„Ç®„Éç„É´„ÇÆ„Éº",attr:void 0,monType:"Fiend",atk:200,def:200},{name:"„É¨„Éº„Ç∂„ÉºÁ†≤Ê©üÁî≤Èéß",attr:void 0,monType:"Insect",atk:200,def:200},{name:"ÈäÄ„ÅÆÂºìÁü¢",attr:void 0,monType:"Fairy",atk:200,def:200},{name:"ÈõªÊíÉÈû≠",attr:void 0,monType:"Thunder",atk:200,def:200},{name:"„Éâ„É©„Ç¥„É≥„ÅÆÁßòÂÆù",attr:void 0,monType:"Dragon",atk:200,def:200},{name:"„Éï„Ç©„É≠„Éº„Éª„Ç¶„Ç£„É≥„Éâ",attr:void 0,monType:"WingedBeast",atk:200,def:200},{name:"È≠îÊÄß„ÅÆÊúà",attr:void 0,monType:"BeastWarrior",atk:200,def:200},{name:"„Ç®„É´„Éï„ÅÆÂÖâ",attr:"Light",monType:void 0,atk:400,def:-200},{name:"Ë¶öÈÜí",attr:"Earth",monType:void 0,atk:400,def:-200},{name:"ÁÅºÁÜ±„ÅÆÊßç",attr:"Fire",monType:void 0,atk:400,def:-200},{name:"Á™ÅÈ¢®„ÅÆÊâá",attr:"Wind",monType:void 0,atk:400,def:-200},{name:"„ÅØ„Åå„Å≠„ÅÆÁî≤ÁæÖ",attr:"Water",monType:void 0,atk:400,def:-200},{name:"Èóá„ÅÆÁ†¥Á•ûÂâ£",attr:"Dark",monType:void 0,atk:400,def:-200},{name:"ÁÅ´Âô®‰ªòÊ©üÁî≤Èéß",attr:void 0,monType:"Insect",atk:700,def:0},{name:"„Çµ„É©„Éû„É≥„Éâ„É©",attr:"Fire",monType:void 0,atk:700,def:0},{name:"„Ç∑„É£„Ç§„É≥„Éª„Ç≠„É£„ÉÉ„Çπ„É´",attr:"Light",monType:void 0,atk:700,def:0}].map(e=>({name:e.name,actions:[de(t=>(!e.attr||t.attr.includes(e.attr))&&(!e.monType||t.types.includes(e.monType))),S],continuousEffects:[me(e.name,"Spell",t=>t.info.equipedBy?[t.info.equipedBy]:[],t=>{const i=[];return e.atk!==0&&i.push(["attack",e.atk]),e.def!==0&&i.push(["defense",e.def]),i.map(([a,r])=>Z.createContinuous("Áô∫Âãï",n=>n.isSpawnedBy.isOnFieldStrictly&&n.isSpawnedBy.face==="FaceUp",t,(n,l)=>l.isOnFieldStrictly&&l.face==="FaceUp"&&(!e.monType||l.types.includes(e.monType))&&(!e.attr||l.attr.includes(e.attr)),a,"wip","Addition",(n,l,o)=>n.isEffective?o+r:o))})]}))}const jt=Object.freeze(Object.defineProperty({__proto__:null,default:ar},Symbol.toStringTag,{value:"Module"}));function*rr(){yield{name:"„ÉÅ„Ç≠„É≥„É¨„Éº„Çπ",actions:[se,S,{title:"‚ë°ÂäπÊûúÁô∫Âãï",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["FieldSpellZone"],executablePeriods:["main1","main2"],executableDuelistTypes:Se,isOnlyNTimesPerTurnIfFaceup:1,canPayCosts:e=>e.activator.lp>=1e3,validate:()=>[],payCosts:(e,t)=>Ce(e,t,1e3),prepare:async(e,t,i)=>{let a=[{seq:0,text:"‚óè„Éá„ÉÉ„Ç≠„Åã„ÇâÔºëÊûö„Éâ„É≠„Éº„Åô„Çã„ÄÇ",tags:["Draw"]},{seq:1,text:"‚óè„Åì„ÅÆ„Ç´„Éº„Éâ„ÇíÁ†¥Â£ä„Åô„Çã„ÄÇ",tags:e.action.calcChainBlockTagsForDestroy(e.activator,[e.action.entity])},{seq:2,text:"‚óèÁõ∏Êâã„ÅØ1000LPÂõûÂæ©„Åô„Çã„ÄÇ",tags:[]}];e.activator.getDeckCell().cardEntities.length||(a=a.filter(n=>n.seq));const r=await e.activator.waitSelectText(a,"‰ΩøÁî®„Åô„ÇãÂäπÊûú„ÇíÈÅ∏Êäû",i);if(r!==void 0)return{selectedEntities:[],chainBlockTags:r.tags,prepared:r.seq,nextChainBlockFilter:()=>!1}},execute:async e=>(e.prepared===0?await e.activator.draw(1,e.action.entity,e.activator):e.prepared===1?await v.tryDestroy([e.action.entity],e):e.prepared===2&&e.activator.getOpponentPlayer().heal(1e3,e.action.entity),!0),settle:async()=>!0}],continuousEffects:[ta("‚ë†„ÉÄ„É°„Éº„Ç∏ÁÑ°Âäπ","Spell",e=>[e.controller,e.controller.getOpponentPlayer()].map(t=>t.entity),e=>[new Pt("‚ë†„ÉÄ„É°„Éº„Ç∏ÁÑ°Âäπ",()=>!0,!0,e,{},()=>!0,"zero_typeA",(t,i,a,r)=>t.isSpawnedBy.fieldCell.cellType!=="FieldSpellZone"?{}:r.lp>=r.getOpponentPlayer().lp?{}:(a.writeInfoLog(`${r.profile.name}„ÅØ„ÉÅ„Ç≠„É≥„É¨„Éº„Çπ„ÅÆÂäπÊûú„Åß„ÉÄ„É°„Éº„Ç∏„ÇíÂèó„Åë„Å™„ÅÑ„ÄÇ`),{zero_typeA:!0}))])]}}const Ut=Object.freeze(Object.defineProperty({__proto__:null,default:rr},Symbol.toStringTag,{value:"Module"}));function*nr(){yield*[{name:"ËçâÂéü",up:["Warrior","BeastWarrior"],down:[]},{name:"Ê£Æ",up:["Insect","Plant","Beast","BeastWarrior"],down:[]},{name:"Â±±",up:["Dragon","WingedBeast","Thunder"],down:[]},{name:"ËçíÈáé",up:["Dinosaur","Zombie","Rock"],down:[]},{name:"Êµ∑",up:["Aqua","SeaSerpent","Fish"],down:["Machine","Pyro"]},{name:"Èóá",up:["Fiend","Spellcaster"],down:["Fairy"]}].map(e=>({name:e.name,actions:[se,S],continuousEffects:[we("Áô∫Âãï","Spell",t=>["attack","defense"].flatMap(i=>["up","down"].map(a=>Z.createContinuous("Áô∫Âãï",r=>r.isSpawnedBy.isOnFieldStrictly&&r.isSpawnedBy.face==="FaceUp",t,(r,n)=>n.isOnFieldStrictly&&n.face==="FaceUp"&&(n.status.monsterCategories??!1)&&e[a].union(n.types).length>0,i,"wip","Addition",(r,n,l)=>!r.isEffective||n.face==="FaceDown"?l:l+(a==="up"?200:-200)))))]})),yield*[{name:"„Éê„Éº„Éã„É≥„Ç∞„Éñ„É©„ÉÉ„Éâ",attr:"Fire"},{name:"„Ç¶„Ç©„Éº„Çø„Éº„ÉØ„Éº„É´„Éâ",attr:"Water"},{name:"„Ç¨„Ç§„Ç¢„Éë„ÉØ„Éº",attr:"Earth"},{name:"„Ç∑„É£„Ç§„É≥„Çπ„Éë„Éº„ÇØ",attr:"Light"},{name:"„ÉÄ„Éº„ÇØ„Çæ„Éº„É≥",attr:"Dark"},{name:"„Éá„Ç∂„Éº„Éà„Çπ„Éà„Éº„É†",attr:"Wind"}].map(e=>({name:e.name,actions:[se,S],continuousEffects:[we("Áô∫Âãï","Spell",t=>["attack","defense"].flatMap(i=>Z.createContinuous("Áô∫Âãï",a=>a.isSpawnedBy.isOnFieldStrictly&&a.isSpawnedBy.face==="FaceUp",t,(a,r)=>r.isOnFieldStrictly&&r.face==="FaceUp"&&r.attr.includes(e.attr),i,"wip","Addition",(a,r,n)=>!a.isEffective||r.face==="FaceDown"?n:n+(i==="attack"?500:-400))))]}))}const Vt=Object.freeze(Object.defineProperty({__proto__:null,default:nr},Symbol.toStringTag,{value:"Module"})),sr=e=>{if(!(e.activator.info.ruleNormalSummonCount>=e.activator.info.maxRuleNormalSummonCount)&&e.action.entity.lvl)if(e.action.entity.lvl<5){const t=e.activator.getEnableSummonList(e.activator,"NormalSummon",["Rule"],e.action,[{monster:e.action.entity,posList:["Attack","Set"],cells:e.activator.getMonsterZones()}],[],!1);return t.length?t.flatMap(i=>i.cells).getDistinct():void 0}else{const t=e.activator.getMonstersOnField().filter(r=>r.canBeReleased(e.activator,e.action.entity,["AdvanceSummonRelease"],e.action)),i=e.action.entity.lvl<7?1:2;if(t.length<i)return;if(t.getAllOnOffPattern().filter(r=>r.length===i).some(r=>e.activator.getEnableSummonList(e.activator,"AdvanceSummon",["Rule","NormalSummon"],e.action,[{monster:e.action.entity,posList:["Attack","Set"],cells:e.activator.getMonsterZones()}],r.map(n=>({material:n,cell:n.fieldCell})),!1).length))return[]}},lr=async(e,t,i)=>{if(!e.action.entity.lvl)return;if(e.action.entity.lvl<5)return{};const a=e.activator.getAvailableMonsterZones();let r=e.activator.getMonstersOnField().filter(c=>c.canBeReleased(e.activator,e.action.entity,["AdvanceSummonRelease"],e.action));const n=e.activator.getExtraMonsterZones(),l=e.action.entity.lvl<7?1:2;n.length>=l&&(r=r.filter(c=>c.fieldCell.cellType!=="ExtraMonsterZone"));const o=await e.activator.waitSelectEntities(r,l,c=>(i||c.length>0)&&(l<0||c.length===l)&&(a.length>0||c.some(d=>d.fieldCell.cellType==="ExtraMonsterZone")),"„É™„É™„Éº„Çπ„Åô„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",i??!1)??[];return o.length?(await v.releaseManyForTheSameReason(o,["Cost","AdvanceSummonRelease","Rule"],e.action.entity,e.activator),{summonMaterialInfos:o.map(c=>({material:c,cell:c.fieldCell}))}):void 0},or=async e=>{var r;const t=["Rule","NormalSummon"];let i="NormalSummon";(r=e.costInfo.summonMaterialInfos)!=null&&r.length&&(i="AdvanceSummon",t.push("AdvanceSummon"));const a=e.dest?[e.dest]:e.activator.getAvailableMonsterZones();return J(e,i,t,["Attack","Set"],a)},J=async(e,t,i,a,r)=>{let n=e.dest?[e.dest]:r;return n||(n=e.activator.getMonsterZones(),e.action.entity.fieldCell.cellType==="ExtraDeck"&&n.push(...e.activator.duel.field.getCells("ExtraMonsterZone"))),await e.activator.summon(t,i,e.action,e.action.entity,a,n,e.costInfo.summonMaterialInfos??[],!1),{selectedEntities:[],chainBlockTags:[],prepared:void 0}},Y=async e=>{var t,i;return e.action.entity.info.isRebornable=!((t=e.action.entity.origin.monsterCategories)!=null&&t.includes("RegularSpecialSummonOnly")),e.action.entity.determine(),(i=e.costInfo.summonMaterialInfos)==null||i.map(a=>a.material).forEach(a=>a.onUsedAsMaterial(e,e.action.entity)),!0},x={title:"ÈÄöÂ∏∏Âè¨Âñö",isMandatory:!1,playType:"NormalSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:sr,payCosts:lr,prepare:or,execute:Y,settle:async()=>!0},Me=(e,t,i)=>{const a=e.activator.getMonsterZones();e.action.entity.fieldCell.cellType==="ExtraDeck"&&a.push(...e.activator.getAvailableExtraZones());const r=e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Rule"],e.action,[{monster:e.action.entity,posList:t,cells:a}],i,!1);if(r.length)return i.length===0?r.flatMap(n=>n.cells):[]},cr=e=>{if(!e.activator.isTurnPlayer||!e.action.entity.status.canAttack||e.action.entity.info.attackDeclareCount>0||e.action.entity.battlePosition!=="Attack")return;const t=e.action.entity.getAttackTargets();return t.length?t.map(i=>i.fieldCell):void 0},ur=async e=>{var a;if(e.action.entity.info.attackDeclareCount>0||e.action.entity.battlePosition!=="Attack")return;if((a=e.dest)!=null&&a.targetForAttack){const r=e.dest.entities.find(n=>n.entityType==="Duelist");return{selectedEntities:r?[r]:e.dest.cardEntities,chainBlockTags:[],prepared:void 0}}const t=e.action.entity.getAttackTargets();if(t.length===0)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",e);if(t.length===1)return{selectedEntities:t,chainBlockTags:[],prepared:void 0};if(e.activator.duelistType==="NPC"){let r=e.activator.selectAttackTargetForNPC(e.action.entity,e.action);return r||(e.activator.duel.log.warn("NPC„ÅÆÊîªÊíÉÂØæË±°ÈÅ∏Êäû„Å´Â§±Êïó„Åó„Åü„Åü„ÇÅ„ÄÅ„É©„É≥„ÉÄ„É†„Å´ÊîªÊíÉÂØæË±°„ÇíÈÅ∏Êäû„ÄÇ"),r=t.randomPick()),{selectedEntities:[r],chainBlockTags:[],prepared:void 0}}const i=await e.activator.waitSelectEntity(t,"ÊîªÊíÉÂØæË±°„ÇíÈÅ∏Êäû„ÄÇ",!0);if(i)return{selectedEntities:[i],chainBlockTags:[],prepared:void 0}},dr=async e=>(e.action.entity.field.duel.declareAnAttack(e.action.entity,e.selectedEntities[0]),!0),C={title:"ÊîªÊíÉÂÆ£Ë®Ä",isMandatory:!1,playType:"Battle",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["b1Battle","b2Battle"],executableDuelistTypes:["Controller"],validate:cr,prepare:ur,execute:dr,settle:async()=>!0},zt=async e=>{if(!(e.action.entity.info.battlePotisionChangeCount>0||!e.activator.isTurnPlayer))return await e.action.entity.setBattlePosition(e.action.entity.battlePosition==="Attack"?"Defense":"Attack",["Rule"],e.action.entity,e.activator),e.action.entity.info.battlePotisionChangeCount++,{selectedEntities:[],chainBlockTags:[],prepared:void 0}},E={title:"ÂèçËª¢Âè¨Âñö",isMandatory:!1,playType:"FlipSummon",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>e.action.entity.info.battlePotisionChangeCount===0&&e.action.entity.info.attackDeclareCount===0&&e.activator.isTurnPlayer&&e.action.entity.face==="FaceDown"?[]:void 0,prepare:zt,execute:async e=>(e.action.entity.determine(),!0),settle:async()=>!0},T={title:"Ë°®Á§∫ÂΩ¢ÂºèÂ§âÊõ¥",isMandatory:!1,playType:"ChangeBattlePosition",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>e.action.entity.info.battlePotisionChangeCount===0&&e.action.entity.info.attackDeclareCount===0&&e.activator.isTurnPlayer&&e.action.entity.face==="FaceUp"?[]:void 0,prepare:zt,execute:async e=>(e.action.entity.determine(),!0),settle:async()=>!0},te=async(e,t=["Attack","Defense"])=>{const i=e.activator.getMonsterZones();return e.action.entity.wasMovedAfter(e.isActivatedAt)?!1:(await e.activator.summon("SpecialSummon",["Effect"],e.action,e.action.entity,t,i,[],!1),!0)},Qt=[C,T,E],pr=[...Qt,x],fr=(e,t,i,a,r,n,l,o,u,c,d)=>{const p={posList:u,cells:c},g={posList:[],cells:[]};return t!==l||l.kind!=="Monster"||!l.origin.monsterCategories?p:l.origin.monsterCategories.includes("NormalSummonOnly")?r.includes("NormalSummon")||r.includes("AdvanceSummon")?p:g:l.origin.monsterCategories.includes("SpecialSummon")?l.isInTrashCell&&!l.origin.monsterCategories.includes("RegularSpecialSummonOnly")?l.info.isRebornable||l.origin.monsterCategories.includes("FreeReborn")?p:g:r.includes("PendulumSummon")&&l.origin.monsterCategories.includes("FreeReborn")?g:r.union(At).length?p:l.origin.monsterCategories.includes("RegularSpecialSummonOnly")?d?p:g:p:p},Ze={},hr=e=>(Ze[e]||(Ze[e]={title:`Êà¶ÈóòÁ†¥Â£äËÄêÊÄß(${e})`,isMandatory:!0,executableCells:["MonsterZone"],executablePeriods:["b1DDmgCalc","b2DDmgCalc"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:e,isApplicableTo:(t,i,a)=>a.includes(t.entity)?i!=="BattleDestroy"?[]:[t.entity]:[],substitute:async(t,i,a)=>a.includes(t.entity)?i!=="BattleDestroy"?[]:t.entity.isEffective?(t.entity.controller.writeInfoLog(`${t.entity.toString()}„ÅØÔºë„Çø„Éº„É≥„Å´ÔºëÂ∫¶„Å†„ÅëÊà¶Èóò„Åß„ÅØÁ†¥Â£ä„Åï„Çå„Å™„ÅÑ„ÄÇ`),[t.entity]):[]:[]}),Ze[e]),et=e=>e.activator.canRelease([e.action.entity])&&e.action.entity.canBeReleased(e.activator,e.action.entity,["ReleaseAsCost"],e.action),tt=async e=>(await e.action.entity.release(["Cost"],e.action.entity,e.activator),{release:[e.action.entity]}),Wt=e=>({title:"„Ç∑„É≥„ÇØ„É≠Âè¨Âñö",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:H,executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerChain:1,validate:t=>t.activator.isTurnPlayer?void 0:t.activator.getExtraDeck().cardEntities.filter(a=>{var r;return(r=a.status.monsterCategories)==null?void 0:r.includes("Syncro")}).flatMap(a=>a.actions).filter(a=>a.playType==="SpecialSummon").map(a=>({index:-1,chainNumber:void 0,action:a,activator:t.activator,targetChainBlock:void 0,isActivatedIn:a.entity.fieldCell,isActivatedAt:t.isActivatedAt,costInfo:{},state:"unloaded",dest:void 0,ignoreCost:!1})).some(a=>a.action.getEnableMaterialPatterns(a).some(r=>{const n=r.map(l=>l.material);return n.every(l=>l.controller===t.activator)&&n.every(l=>l.isOnFieldAsMonsterStrictly)&&n.includes(t.action.entity)}))?[]:void 0,prepare:R,execute:async t=>{if(t.activator!==t.action.entity.controller||t.activator.getMonstersOnField().filter(l=>l.lvl!==void 0).length<2)return!1;const i=t.activator.getExtraDeck().cardEntities.filter(l=>{var o;return(o=l.status.monsterCategories)==null?void 0:o.includes("Syncro")}).flatMap(l=>l.actions).filter(l=>l.playType==="SpecialSummon").map(l=>({index:-1,chainNumber:void 0,action:l,activator:t.activator,targetChainBlock:void 0,isActivatedIn:l.entity.fieldCell,isActivatedAt:t.isActivatedAt,costInfo:{},state:"unloaded",dest:void 0,ignoreCost:!1})).filter(l=>l.action.getEnableMaterialPatterns(l).some(o=>{const u=o.map(c=>c.material);return u.every(c=>c.controller===t.activator)&&u.every(c=>c.isOnFieldAsMonsterStrictly)&&u.includes(t.action.entity)})).map(l=>l.action.entity).getDistinct();if(!i.length)return!1;const a=await t.activator.waitSelectEntities(i,1,l=>l.length===1,"„Ç∑„É≥„ÇØ„É≠Âè¨Âñö„Åô„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû„ÄÇ",!1)??[];if(!a.length)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",t);const r=a[0].actions.find(l=>l.playType==="SpecialSummon");if(!r)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",t);const n=r.getClone(l=>{const o=l.map(u=>u.material);return o.every(u=>u.controller===t.activator)&&o.every(u=>u.isOnFieldAsMonsterStrictly)&&o.includes(t.action.entity)});return t.nextActionInfo={action:n,originSeq:n.seq},!0},settle:async()=>!0,...e}),gr=Je("Áõ¥Êé•ÊîªÊíÉ","Monster",e=>[e],e=>[new Q("Áõ¥Êé•ÊîªÊíÉ",()=>!0,!0,e,{},(t,i)=>t.isSpawnedBy===i,(t,i)=>({...i,canDirectAttack:!0}))]),yr=(e,t,i,a)=>{if(!e.action.entity.origin.link||e.action.entity.origin.link<i.length)return;let r=i.map(l=>({material:l,cell:l.fieldCell,link:1}));if(e.action.entity.origin.link>i.length){if(i.every(u=>(u.origin.link??1)<2))return;const l=[r];i.filter(u=>(u.origin.link??1)>1).forEach(u=>{[...l].forEach(c=>{l.push([...c.filter(d=>d.material!==u),{material:u,cell:u.fieldCell,link:u.origin.link??1}])})});const o=l.find(u=>u.reduce((c,d)=>c+d.link,0)===e.action.entity.origin.link);if(!o)return;r=o}if(!a(i)||!e.activator.getEnableSummonList(e.activator,"LinkSummon",["Rule","SpecialSummon"],e.action,[{monster:e.action.entity,posList:["Attack"],cells:t}],r,!1).length)return;if(e.activator.getAvailableExtraZones().length)return r;const n=e.activator.duel.field.getCells("ExtraMonsterZone").map(l=>l.cardEntities[0]).filter(l=>l);if(n.filter(l=>l.controller===e.activator).length&&n.filter(l=>l.controller===e.activator).length===i.filter(l=>l.fieldCell.cellType==="ExtraMonsterZone").length||e.activator.getMonsterZones().flatMap(l=>l.linkArrowSources).some(l=>!i.includes(l))||e.activator.duel.field.canExtraLink(e.action.entity,r))return r},vr=(e,t=()=>!0)=>{let i=[...e.activator.getMonstersOnField().filter(r=>r.battlePosition!=="Set"),...e.activator.getHandCell().entities.filter(r=>r.origin.kind==="Monster")];if(i.every(r=>!r.status.allowHandLink)&&(i=i.filter(r=>r.fieldCell.isPlayFieldCell)),i.length<1)return[];const a=[...e.activator.getMonsterZones(),...e.activator.duel.field.getAvailableExtraMonsterZones()];return i.getAllOnOffPattern().filter(r=>r.some(n=>n.status.allowHandLink)||r.every(n=>n.isOnFieldAsMonsterStrictly)).map(r=>yr(e,a,r,t)??[]).filter(r=>r.length)},mr=async(e,t,i)=>{var u;const a=e.action.getEnableMaterialPatterns(e),r=a.map(c=>({infos:c,materialSeqList:c.map(d=>d.material.seq).sort()}));let n=a[0].map(c=>c.material);if(a.length>1){const c=a.flatMap(p=>p.map(g=>g.material)).getDistinct(),d=await e.activator.waitSelectEntities(c,void 0,p=>{const g=p.map(h=>h.seq).sort();return r.some(h=>g.length===h.materialSeqList.length&&g.every((y,P)=>y===h.materialSeqList[P]))},"„É™„É≥„ÇØÁ¥†Êùê„Å®„Åô„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",i);if(console.log(d),!d)return;n=d}const l=n.map(c=>c.seq).sort(),o=(u=r.find(c=>l.length===c.materialSeqList.length&&l.every((d,p)=>d===c.materialSeqList[p])))==null?void 0:u.infos;if(!o)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",e,n);return await v.sendManyToGraveyardForTheSameReason(n,["LinkMaterial","Cost","Rule","SpecialSummonMaterial"],e.action.entity,e.activator),{summonMaterialInfos:o}},it=(e=()=>!0)=>({title:"„É™„É≥„ÇØÂè¨Âñö",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],getEnableMaterialPatterns:t=>vr(t,e),canPayCosts:t=>t.action.getEnableMaterialPatterns(t).length>0,validate:t=>!t.ignoreCost||t.activator.getAvailableExtraZones().length+t.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:mr,prepare:t=>J(t,"LinkSummon",["Rule","SpecialSummon","LinkSummon"],["Attack"]),execute:Y,settle:async()=>!0});function*Sr(){yield*[{name:"Ôº¨Ôº°ÔºÆ„Éï„Ç©„É™„É≥„ÇØ„Çπ",validator:e=>e.length===2},{name:"„Éà„É©„Éï„Ç£„ÉÉ„ÇØ„Ç¥„Éº„Çπ„Éà",validator:e=>e.length===3},{name:"Â§©Â®Å„ÅÆÈ¨ºÁ•û",validator:e=>e.length>1&&e.some(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Link")})},{name:"Â§©Â®Å„ÅÆÊã≥ÂÉß",validator:e=>e.every(t=>{var i,a;return((i=t.status.nameTags)==null?void 0:i.includes("Â§©Â®Å"))&&!((a=t.status.monsterCategories)!=null&&a.includes("Link"))})},{name:"ÈõªÂΩ±„ÅÆÈ®éÂ£´„Ç¨„Ç§„Ç¢„Çª„Ç§„Éê„Éº",validator:e=>e.length>1}].map(e=>({name:e.name,actions:[C,it(e.validator)]}))}const Xt=Object.freeze(Object.defineProperty({__proto__:null,default:Sr},Symbol.toStringTag,{value:"Module"}));function*Cr(){yield*["„Çµ„Ç§„Éê„Éº„Éª„Éâ„É©„Ç¥„É≥","ÂÖ≠Ê≠¶Ë°Ü„ÅÆ„ÅîÈö†Â±Ö","„Ç¢„É≥„Éé„Ç¶„É≥„Éª„Ç∑„É≥„ÇØ„É≠„É≥"].map(e=>({name:e,actions:[x,C,T,E,{title:"ÁâπÊÆäÂè¨Âñö",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:e==="„Ç¢„É≥„Éé„Ç¶„É≥„Éª„Ç∑„É≥„ÇØ„É≠„É≥"?1:void 0,validate:t=>{const i=t.action.entity.field.getMonstersOnFieldStrictly();if(!(i.length==0||i.some(a=>a.controller===t.activator)))return Me(t,_,[])},prepare:t=>J(t,"SpecialSummon",["SpecialSummon","Rule"],_),execute:Y,settle:async()=>!0}]})),yield{name:"„Ç∏„É£„É≥„ÇØ„Éª„Éï„Ç©„Ç¢„Éº„Éâ",actions:[x,C,T,E,{title:"ÁâπÊÆäÂè¨Âñö",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(!e.activator.getMonstersOnField().length)return Me(e,_,[])},prepare:e=>J(e,"SpecialSummon",["SpecialSummon","Rule"],_),execute:Y,settle:async()=>!0}]},yield{name:"Ôº§ÔºçÔº®Ôº•Ôº≤ÔºØ „Éá„Ç£„Ç¢„Éú„É™„ÉÉ„ÇØ„Ç¨„Ç§",actions:[x,C,T,E,{title:"‚ë†„É™„ÇØ„É´„Éº„Éà",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:10,canPayCosts:Te,validate:e=>e.activator.getDeckCell().cardEntities.filter(i=>i.nm==="Ôº§ÔºçÔº®Ôº•Ôº≤ÔºØ „Éá„Ç£„Ç¢„Éú„É™„ÉÉ„ÇØ„Ç¨„Ç§").length===0?void 0:e.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:Ne,prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.find(i=>i.nm==="Ôº§ÔºçÔº®Ôº•Ôº≤ÔºØ „Éá„Ç£„Ç¢„Éú„É™„ÉÉ„ÇØ„Ç¨„Ç§");return t?Wa(e,[t]):!1},settle:async()=>!0}]},yield{name:"„Çæ„É≥„Éì„Ç≠„É£„É™„Ç¢",actions:[x,C,T,E,{title:"‚ë†Ëá™Â∑±ÂÜçÁîü",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],canPayCosts:e=>e.activator.getHandCell().cardEntities.length>0,validate:e=>e.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:async(e,t,i)=>{const a=e.activator.getHandCell().cardEntities,r=await e.activator.waitSelectEntity(a,"„Éá„ÉÉ„Ç≠„Éà„ÉÉ„Éó„Å´Êàª„Åô„Ç´„Éº„Éâ„Çí‰∏ÄÊûöÈÅ∏Êäû„ÄÇ",i);if(!r)throw new q(e);return await r.returnToDeck("Top",["Cost"],e.action.entity,e.activator),{returnToDeck:[r]}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:async e=>await te(e)?(e.action.entity.statusOperatorBundle.push(new Q("Èô§Â§ñ‰∫àÂÆö",()=>!0,!1,e.action.entity,e.action,(t,i)=>i.isOnFieldAsMonsterStrictly&&i.face==="FaceUp",(t,i)=>({...i,willBeBanished:!0}))),!0):!1,settle:async()=>!0}]},yield{name:"„Ç∞„É≠„Éº„Ç¢„ÉÉ„Éó„Éª„Éê„É´„Éñ",actions:[x,C,T,E,{title:"‚ë†Ëá™Â∑±ÂÜçÁîü",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:1,canPayCosts:e=>e.activator.getDeckCell().cardEntities.length>0,validate:e=>e.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:async e=>{const t=e.activator.getDeckCell().cardEntities[0];return await e.activator.getDeckCell().cardEntities[0].sendToGraveyard(["Cost"],e.action.entity,e.activator),{sendToGraveyard:[t]}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:e=>te(e),settle:async()=>!0}]},yield{name:"ÁµÇÊú´„ÅÆÈ®éÂ£´",actions:[x,C,T,E,{title:"‚ë†Â¢ìÂú∞ÈÄÅ„Çä",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...D,...F],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.hasBeenSummonedNow(["NormalSummon","SpecialSummon","FlipSummon"])&&e.activator.getDeckCell().cardEntities.filter(t=>t.attr.includes("Dark")).length!==0)return[]},prepare:async e=>{const t=["SendToGraveyardFromDeck"];return e.action.entity.moveLog.latestRecord.movedAs.includes("NormalSummon")?t.push("IfNormarlSummonSucceed"):t.push("IfSpecialSummonSucceed"),{selectedEntities:[],chainBlockTags:t,prepared:void 0}},execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(i=>i.attr.includes("Dark"));return t.length===0?!1:(await e.action.entity.field.sendToGraveyard("Â¢ìÂú∞„Å´ÈÄÅ„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",e.activator,t,1,i=>i.length===1,["Effect"],e.action.entity,!1),e.activator.getDeckCell().shuffle(),!0)},settle:async()=>!0}]},yield{name:"„Éû„Çπ„Éû„ÉÜ„Ç£„Ç∑„É£„É≥",actions:[x,C,T,E,{title:"‚ë†Â¢ìÂú∞ÈÄÅ„Çä",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...D,...F],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.hasBeenSummonedNow(["NormalSummon"])&&e.activator.getDeckCell().cardEntities.find(t=>(t.lvl??5)<5))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["IfNormarlSummonSucceed","SendToGraveyardFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(i=>(i.lvl??5)<5);return t.length===0?!1:(await e.action.entity.field.sendToGraveyard("Â¢ìÂú∞„Å´ÈÄÅ„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",e.activator,t,1,i=>i.length===1,["Effect"],e.action.entity,!1),e.activator.getDeckCell().shuffle(),!0)},settle:async()=>!0},{title:"‚ë°„Éâ„É≠„Éº",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...D,...F],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.face!=="FaceDown"&&e.action.entity.moveLog.latestRecord.movedAs.includes("BattleDestroy")&&e.action.entity.wasMovedAtPreviousChain&&e.activator.getDeckCell().cardEntities.length!==0)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(1,e.action.entity,e.activator),!0),settle:async()=>!0}]},yield{name:"„É©„Ç§„Éà„É≠„Éº„Éâ„Éª„Éì„Éº„Çπ„Éà „Ç¶„Ç©„É´„Éï",actions:[C,T,E,{title:"‚ë†Ëá™Â∑±ÂÜçÁîü",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...D,...F],executableDuelistTypes:["Controller"],validate:e=>{if(!e.action.entity.wasMovedAtPreviousChain||e.action.entity.wasMovedFrom.cellType!=="Deck")return;const t=e.activator.getMonsterZones();return e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,[{monster:e.action.entity,posList:_,cells:t}],[],!1).length?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:e=>te(e),settle:async()=>!0}]},yield{name:"‰ºùË™¨„ÅÆÁôΩÁü≥",actions:[C,T,E,x,{title:"‚ë†„Çµ„Éº„ÉÅ",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:z,executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.wasMovedAtPreviousChain&&e.action.entity.wasMovedFrom.cellType!=="Banished")return e.activator.getDeckCell().cardEntities.find(t=>t.nm==="ÈùíÁúº„ÅÆÁôΩÈæç")?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.find(i=>i.nm==="ÈùíÁúº„ÅÆÁôΩÈæç");return t?(await t.addToHand(["Effect"],e.action.entity,e.activator),e.activator.getDeckCell().shuffle(),!0):!1},settle:async()=>!0}]},yield*[{name:"ÁÅ∞ÊµÅ„ÅÜ„Çâ„Çâ",chainBlockTags:["Draw","SearchFromDeck","SendToGraveyardFromDeck","SpecialSummonFromDeck"]},{name:"Â±ãÊï∑„Çè„Çâ„Åó",chainBlockTags:["BanishFromGraveyard","SpecialSummonFromGraveyard","AddToHandFromGraveyard"]}].map(e=>({name:e.name,actions:[C,T,E,x,{title:"‚ë†ÁÑ°ÂäπÂåñ",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:["Hand"],executablePeriods:D,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,negatePreviousBlock:!0,canPayCosts:t=>t.activator.canDiscard([t.action.entity]),validate:(t,i)=>i.length===0?void 0:i[t.index-1].chainBlockTags.union(e.chainBlockTags).length>0?[]:void 0,payCosts:async t=>(await t.action.entity.discard(["Cost"],t.action.entity,t.activator),{sendToGraveyard:[t.action.entity]}),prepare:async()=>({selectedEntities:[],chainBlockTags:["NegateCardEffect"],prepared:void 0}),execute:async(t,i)=>{const a=i[t.index-1];return a.isNegatedEffectBy=t.action,!0},settle:async()=>!0}]})),yield*["ÁøªÂºÑ„Åô„Çã„Ç®„É´„Éï„ÅÆÂâ£Â£´","„É≠„Éº„Éâ„É©„É≥„Éä„Éº","Ê∞∑ÁµêÁïå„ÅÆ‰øÆÈ®ìËÄÖ"].map(e=>({name:e,actions:[C,T,E,x],continuousEffects:[Dt("‚ë†Êà¶ÈóòÁ†¥Â£äËÄêÊÄß","Monster",t=>[t],t=>[new he("‚ë†Êà¶ÈóòÁ†¥Â£äËÄêÊÄß",()=>!0,!0,t,{},()=>!0,["BattleDestroy"],(i,a)=>!t.isEffective||(a.atk??0)<1900?!0:(t.duel.log.info(`${t.toString()}„ÅØÊîªÊíÉÂäõ1900‰ª•‰∏ä„ÅÆ„É¢„É≥„Çπ„Çø„Éº„Å®„ÅÆÂÖàÈ†≠„Åß„ÅØÁ†¥Â£ä„Åï„Çå„Å™„ÅÑ„ÄÇ`,t.controller),!1))])]}))}const Kt=Object.freeze(Object.defineProperty({__proto__:null,default:Cr},Symbol.toStringTag,{value:"Module"}));function*Tr(){yield*["„É©„Éº„Ç∏„Éû„Ç¶„Çπ","„É¨„Ç§„É≥„Éú„Éº„Éª„Éï„É©„ÉØ„Éº","„É¨„ÉÉ„Ç∞„É´","Â•≥Áéã„ÅÆÂΩ±Ê≠¶ËÄÖ","‰∫∫ÈÄ†‰∫∫ÈñìÔºóÂè∑"].map(e=>({name:e,actions:[C,T,E,x],continuousEffects:[gr]}))}const Jt=Object.freeze(Object.defineProperty({__proto__:null,default:Tr},Symbol.toStringTag,{value:"Module"}));function*kr(){yield*[{name:"„Ç≠„É©„Éº„Éª„Éù„ÉÜ„Éà",filter:e=>e.attr.includes("Dark")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["EffectDestroy"],executableCells:["Graveyard"]},{name:"„Ç≠„É©„Éº„Éª„Éà„Éû„Éà",filter:e=>e.attr.includes("Dark")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"Â∑®Â§ß„Éç„Ç∫„Éü",filter:e=>e.attr.includes("Earth")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„Ç∞„É™„Ç∫„É™„Éº„Éû„Ç∂„Éº",filter:e=>e.attr.includes("Water")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„Ç∑„É£„Ç§„É≥„Ç®„É≥„Ç∏„Çß„É´",filter:e=>e.attr.includes("Light")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„Éâ„É©„Ç¥„É≥„Éï„É©„Ç§",filter:e=>e.attr.includes("Wind")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ÔºµÔº¶ÔºØ„Çø„Éº„Éà„É´",filter:e=>e.attr.includes("Fire")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ËçíÈáé„ÅÆÂ•≥Êà¶Â£´",filter:e=>e.attr.includes("Earth")&&e.types.includes("Warrior")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„É™„Éà„É´„Éª„Éà„É´„Éº„Éë„Éº",filter:e=>e.types.includes("Warrior")&&(e.lvl??9999)<3,qtyList:[1],posList:["Set"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard","Banished"]},{name:"Á†¥Èù¢Á´ú",filter:e=>e.types.includes("Warrior")&&(e.def??9999)<=1500,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ÂÖ±È≥¥Ëô´",filter:e=>e.types.includes("Insect")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„Éî„É©„Éü„ÉÉ„Éâ„Éª„Çø„Éº„Éà„É´",filter:e=>e.types.includes("Zombie")&&(e.def??9999)<=2e3,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„É¶„Éº„Éï„Ç©„É≠„Ç§„Éâ",filter:e=>e.types.includes("Machine")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„Éò„É´„Éª„Çª„Ç≠„É•„É™„ÉÜ„Ç£",filter:e=>e.types.includes("Fiend")&&(e.lvl??9999)===1,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„Ç¨„Çπ„Çø„Éª„Ç§„Ç∞„É´",filter:e=>(e.status.nameTags??[]).includes("„Ç¨„Çπ„Çø")&&(e.status.monsterCategories??[]).includes("Tuner"),qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ÂπªÂΩ±„ÅÆÈ≠îË°ìÂ£´",filter:e=>(e.status.nameTags??[]).includes("Ôº®Ôº•Ôº≤ÔºØ")&&(e.atk??9999)<=1e3,qtyList:[1],posList:["Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„Ç∏„Çß„Éç„ÇØ„Çπ„Éª„Çµ„Éº„ÉÅ„É£„Éº",filter:e=>(e.status.nameTags??[]).includes("„Ç∏„Çß„Éç„ÇØ„Çπ")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"Á¥´ÁÇé„ÅÆË∂≥ËªΩ",filter:e=>(e.status.nameTags??[]).includes("ÂÖ≠Ê≠¶Ë°Ü")&&(e.lvl??12)<=3,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„Çπ„É¨„Ç§„Éñ„Éª„Ç®„Ç§„Éó",filter:e=>(e.status.nameTags??[]).includes("Ââ£ÈóòÁç£")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„Çº„É≥„Éû„Ç§„Éè„Éã„Éº",filter:e=>(e.status.nameTags??[]).includes("„Çº„É≥„Éû„Ç§")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"Ôº∏Ôº∏Ôºç„Çª„Ç§„Éê„Éº „Ç®„Éû„Éº„Ç∫„Éñ„É¨„Ç§„Éâ",filter:e=>(e.status.nameTags??[]).includes("Ôº∏Ôºç„Çª„Ç§„Éê„Éº")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ËªçÈöäÁ´ú",filter:e=>e.nm==="ËªçÈöäÁ´ú",qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„Ç¢„Çµ„É´„Éà„Éª„Ç¨„É≥„Éâ„ÉÉ„Ç∞",filter:e=>e.nm==="„Ç¢„Çµ„É´„Éà„Éª„Ç¨„É≥„Éâ„ÉÉ„Ç∞",qtyList:[1,2,3,4,5],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„Éè„Ç§„Ç®„Éä",filter:e=>e.nm==="„Éè„Ç§„Ç®„Éä",qtyList:[1,2,3,4,5],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]}].map(e=>({name:e.name,actions:[{title:"‚ë†„É™„ÇØ„É´„Éº„Éà",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:e.executableCells,executablePeriods:e.destoryTypes.includes("EffectDestroy")?[...D,...F]:["b1DEnd","b2DEnd"],executableDuelistTypes:["Controller"],validate:t=>{if(!t.action.entity.wasMovedAtPreviousChain)return;const i=t.activator.getMonsterZones();if(t.activator.getEnableSummonList(t.activator,"SpecialSummon",["Effect"],t.action,t.activator.getDeckCell().cardEntities.filter(e.filter).filter(r=>r.kind==="Monster").filter(r=>r.canBeTargetOfEffect(t)).map(r=>({monster:r,posList:e.posList,cells:i})),[],!1).length)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async t=>{const i=t.activator.getDeckCell().cardEntities.filter(e.filter),a=t.activator.getMonsterZones();return!!t.activator.summonMany(t.activator,"SpecialSummon",["Effect"],t.action,i.map(n=>({monster:n,posList:e.posList,cells:a})),[],!1,e.qtyList.length>1?void 0:e.qtyList[0],n=>e.qtyList.includes(n.length),!1)},settle:async()=>!0},C,T,E,x]}))}const Yt=Object.freeze(Object.defineProperty({__proto__:null,default:kr},Symbol.toStringTag,{value:"Module"}));function*Er(){yield{name:"„Åä„Çç„Åã„Å™ÂüãËë¨",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:e=>{if(e.activator.getDeckCell().cardEntities.filter(t=>t.kind==="Monster").length!==0)return k(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SendToGraveyardFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(a=>a.kind==="Monster");if(t.length===0)return!1;const i=await e.activator.waitSelectEntity(t,"Â¢ìÂú∞„Å´ÈÄÅ„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",!1);if(!i)throw new q(e);return await i.sendToGraveyard(["Effect"],e.action.entity,e.activator),await e.activator.getDeckCell().shuffle(),!0},settle:async()=>!0},S]},yield{name:"„Åä„Çç„Åã„Å™ÂâØËë¨",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,priorityForNPC:40,validate:e=>{if(e.activator.getDeckCell().cardEntities.filter(t=>t.kind!=="Monster").length!==0)return k(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SendToGraveyardFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(a=>a.kind!=="Monster");if(t.length===0)return!1;const i=await e.activator.waitSelectEntity(t,"Â¢ìÂú∞„Å´ÈÄÅ„ÇãÈ≠îÊ≥ïÁΩ†„ÇíÈÅ∏Êäû",!1);if(!i)throw new q(e);return await i.sendToGraveyard(["Effect"],e.action.entity,e.activator),!0},settle:async()=>!0},S]},yield{name:"Ê≠ªËÄÖËòáÁîü",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:e=>{const t=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.duel.field.getCells("Graveyard").flatMap(a=>a.cardEntities).filter(a=>a.kind==="Monster").filter(a=>a.canBeTargetOfEffect(e)).map(a=>({monster:a,posList:_,cells:t})),[],!1).length)return k(e)},prepare:e=>re(e,e.activator.duel.field.getCells("Graveyard").flatMap(t=>t.cardEntities).filter(t=>t.kind==="Monster").filter(t=>t.canBeTargetOfEffect(e))),execute:async e=>ne(e),settle:async()=>!0},S]};for(const e of[{name:"Â§ßÂµê",cellTypes:ie,isOnlyEnemies:!1},{name:"„Éè„Éº„Éî„Ç£„ÅÆÁæΩÊ†πÂ∏ö",cellTypes:ie,isOnlyEnemies:!0},{name:"„Éñ„É©„ÉÉ„ÇØ„Éª„Éõ„Éº„É´",cellTypes:H,isOnlyEnemies:!1},{name:"„Çµ„É≥„ÉÄ„Éº„Éª„Éú„É´„Éà",cellTypes:H,isOnlyEnemies:!0}])yield{name:e.name,actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:t=>{let i=t.action.entity.field.getCells(...e.cellTypes).flatMap(a=>a.cardEntities).filter(a=>a!==t.action.entity);if(e.isOnlyEnemies&&(i=i.filter(a=>a.controller!==t.activator)),!!i.length)return k(t)},prepare:async t=>{let i=t.action.entity.field.getCells(...e.cellTypes).flatMap(a=>a.cardEntities).filter(a=>a!==t.action.entity);return e.isOnlyEnemies&&(i=i.filter(a=>a.controller!==t.activator)),{selectedEntities:[],chainBlockTags:t.action.calcChainBlockTagsForDestroy(t.activator,i),prepared:void 0}},execute:async t=>{let i=t.action.entity.field.getCells(...e.cellTypes).flatMap(a=>a.cardEntities).filter(a=>a!==t.action.entity);return e.isOnlyEnemies&&(i=i.filter(a=>a.controller!==t.activator)),await v.tryDestroy(i,t),!0},settle:async()=>!0},S]};yield{name:"„Éè„É™„Ç±„Éº„É≥",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.field.getCells("SpellAndTrapZone","FieldSpellZone").flatMap(i=>i.cardEntities).filter(i=>i!==e.action.entity).length)return k(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["BounceToHand"],prepared:void 0}),execute:async(e,t)=>{const i=t.map(r=>r.action).filter(r=>r.playType==="CardActivation").map(r=>r.entity).filter(r=>r.isOnFieldStrictly).filter(r=>r.face==="FaceUp").filter(r=>!r.isLikeContinuousSpell),a=e.action.entity.field.getCells("SpellAndTrapZone","FieldSpellZone").flatMap(r=>r.cardEntities).filter(r=>!i.includes(r));return await v.returnManyToHandForTheSameReason(a,["Effect"],e.action.entity,e.activator),!0},settle:async()=>!0},S]},yield{name:"ÂÖâ„ÅÆÊè¥Ëªç",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,canPayCosts:e=>e.activator.getDeckCell().cardEntities.length>3,validate:e=>{if(e.activator.getDeckCell().cardEntities.filter(t=>t.kind==="Monster").filter(t=>(t.lvl??13)<5).filter(t=>t.status.nameTags&&t.status.nameTags.includes("„É©„Ç§„Éà„É≠„Éº„Éâ")).length!==0)return k(e)},payCosts:async e=>{const t=e.activator.getDeckCell().cardEntities.slice(0,3);return await v.sendManyToGraveyardForTheSameReason(t,["Cost"],e.action.entity,e.activator),{sendToGraveyard:t}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(a=>a.kind==="Monster").filter(a=>(a.lvl??13)<5).filter(a=>a.status.nameTags&&a.status.nameTags.includes("„É©„Ç§„Éà„É≠„Éº„Éâ"));if(t.length===0)return!1;const i=await e.activator.waitSelectEntity(t,"ÊâãÊú≠„Å´Âä†„Åà„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",!1);if(!i)throw new q(e);return await i.addToHand(["Effect"],e.action.entity,e.activator),!0},settle:async()=>!0},S]},yield{name:"„ÉØ„É≥„Éª„Éï„Ç©„Éº„Éª„ÉØ„É≥",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,canPayCosts:e=>{if(e.activator.getDeckCell().cardEntities.every(t=>(t.lvl??12)>1)){if(e.activator.getHandCell().cardEntities.every(t=>(t.lvl??12)>1)||e.activator.getHandCell().cardEntities.filter(t=>t.kind==="Monster").length<2)return!1}else if(e.activator.getHandCell().cardEntities.filter(t=>t.kind==="Monster").length===0)return!1;return!0},validate:e=>{let t=[...e.activator.getDeckCell().cardEntities.filter(n=>(n.lvl??12)===1),...e.activator.getHandCell().cardEntities.filter(n=>(n.lvl??12)===1)];const i=e.activator.getHandCell().cardEntities;(i.length<2||!e.ignoreCost)&&(t=t.filter(n=>!i.includes(n)));const a=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,t.map(n=>({monster:n,posList:_,cells:a})),[],!1).length)return k(e)},payCosts:async(e,t,i)=>{const a=[...e.activator.getDeckCell().cardEntities.filter(u=>(u.lvl??12)===1),...e.activator.getHandCell().cardEntities.filter(u=>(u.lvl??12)===1)],r=e.activator.getMonsterZones(),n=e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,a.map(u=>({monster:u,posList:_,cells:r})),[],!1);let l=e.activator.getHandCell().cardEntities.filter(u=>u.kind==="Monster");n.length===1&&(l=l.filter(u=>!n.map(c=>c.monster).includes(u)));const o=await e.activator.waitSelectEntity(l,"Â¢ìÂú∞„Å∏ÈÄÅ„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",i);if(!o)throw new q(e);return await o.sendToGraveyard(["Cost"],e.action.entity,e.activator),{sendToGraveyard:[o]}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async e=>{const t=[...e.activator.getDeckCell().cardEntities.filter(r=>r.lvl===1),...e.activator.getHandCell().cardEntities.filter(r=>r.lvl===1)],i=e.activator.getMonsterZones();return!!await e.activator.summonOne(e.activator,"SpecialSummon",["Effect"],e.action,t.map(r=>({monster:r,posList:_,cells:i})),[],!1,!1)},settle:async()=>!0},S]},yield{name:"Â∞ÅÂç∞„ÅÆÈªÑÈáëÊ´É",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(!e.activator.getDeckCell().cardEntities.every(t=>!e.activator.canTryBanish(t,"BanishAsEffect",e.action)))return k(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["BanishFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(r=>e.activator.canTryBanish(r,"BanishAsEffect",e.action)),i=await e.activator.waitSelectEntity(t,"Èô§Â§ñ„Åô„Çã„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû„ÄÇ",!1);if(!i)throw new q(e);return(await v.tryBanish("BanishAsEffect",[i],e)).forEach(r=>r.counterHolder.removeAll("GoldSarcophagus")),!0},settle:async()=>!0},Xa("ÂõûÂèé„Ç´„Ç¶„É≥„ÉàÈÄ≤Ë°å",["stanby"],e=>{e.activator.isTurnPlayer&&e.action.entity.field.getCells("Banished").flatMap(t=>t.cardEntities).filter(t=>t.moveLog.latestRecord.movedBy===e.action.entity).filter(t=>t.moveLog.latestRecord.actionOwner===e.activator).forEach(t=>{t.counterHolder.add("GoldSarcophagus",1,e.action.entity);const i=t.counterHolder.getQty("GoldSarcophagus",e.action.entity);i<3&&e.activator.duel.log.info(`${t.toString()}„ÅÆ„Çø„Éº„É≥„Ç´„Ç¶„É≥„ÉàÔºö${i-1}‚áí${i}`)})}),{title:"ÂõûÂèé",isMandatory:!0,playType:"LingeringEffect",spellSpeed:"Normal",executableCells:K,executablePeriods:["stanby"],executableDuelistTypes:Se,validate:e=>{if(e.activator.isTurnPlayer)return e.action.entity.field.getCells("Banished").flatMap(t=>t.cardEntities).filter(t=>t.moveLog.latestRecord.movedBy===e.action.entity).filter(t=>t.moveLog.latestRecord.actionOwner===e.activator).some(t=>t.counterHolder.getQty("GoldSarcophagus")===2)?[]:void 0},prepare:R,execute:async e=>{const t=e.action.entity.field.getCells("Banished").flatMap(a=>a.cardEntities).filter(a=>a.moveLog.latestRecord.movedBy===e.action.entity).filter(a=>a.moveLog.latestRecord.actionOwner===e.activator).filter(a=>a.counterHolder.getQty("GoldSarcophagus")===2);if(!t.length)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",e);let i=t[0];if(t.length>1){const a=await e.activator.waitSelectEntity(t,"ÂõûÂèé„Åô„Çã„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû„ÄÇ",!1);if(!a)throw new q(e);i=a}return await i.addToHand(["Effect"],e.action.entity,e.activator),!0},settle:async()=>!0},S]},yield{name:"È≠î„ÅÆË©¶ÁùÄÈÉ®Â±ã",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],canPayCosts:e=>e.activator.lp>=800,validate:e=>{if(e.activator.getDeckCell().cardEntities.length<4)return;const t=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getDeckCell().cardEntities.filter(a=>a.kind==="Monster").filter(a=>{var r;return(r=a.status.monsterCategories)==null?void 0:r.includes("Normal")}).filter(a=>(a.lvl??12)<4).map(a=>({monster:a,posList:_,cells:t})),[],!1).length)return k(e)},payCosts:(e,t)=>Ce(e,t,800),prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async e=>{if(e.activator.getDeckCell().cardEntities.length<4)return!1;const t=await v.excavateManyFromDeck(e.activator,4,["Effect"],e.action.entity,e.activator),i=t.filter(a=>a.kind==="Monster").filter(a=>{var r;return(r=a.status.monsterCategories)==null?void 0:r.includes("Normal")}).filter(a=>(a.lvl??12)<4);if(i.length){const a=e.activator.getMonsterZones(),r=i.length>a.length?a.length:i.length;await e.activator.summonMany(e.activator,"SpecialSummon",["Effect"],e.action,i.map(n=>({monster:n,cells:a,posList:_})),[],!1,r,n=>n.length===r,!1)}return await v.sendManyToGraveyardForTheSameReason(i.filter(a=>!a.isOnFieldAsMonsterStrictly),["Effect"],e.action.entity,e.activator),console.log(t.filter(a=>a.fieldCell.cellType==="Deck")),await v.returnManyToDeckForTheSameReason("Random",t.filter(a=>a.fieldCell.cellType==="Deck"),["Effect"],e.action.entity,e.activator),!0},settle:async()=>!0},S]}}const It=Object.freeze(Object.defineProperty({__proto__:null,default:Er},Symbol.toStringTag,{value:"Module"}));function*wr(){yield{name:"Âº∑Ê¨≤„Å™Â£∫",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:20,validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<2)&&e.activator.canDraw&&e.activator.canAddToHandFromDeck)return k(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(2,e.action.entity,e.activator),!0),settle:async()=>!0},S]},yield{name:"Ë≤™Ê¨≤„Å™Â£∫",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:30,validate:e=>{if(!(e.activator.getGraveyard().cardEntities.filter(t=>t.kind==="Monster").filter(t=>t.canBeTargetOfEffect(e)).length<5)&&e.activator.canDraw&&e.activator.canAddToHandFromDeck)return k(e)},prepare:async e=>{const t=await e.activator.waitSelectEntities(e.activator.getGraveyard().cardEntities.filter(i=>i.kind==="Monster").filter(i=>i.canBeTargetOfEffect(e)),5,i=>i.length===5,"„Éá„ÉÉ„Ç≠„Å´Êàª„Åô„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû„ÄÇ",!1);if(t)return{selectedEntities:t,chainBlockTags:["Draw","ReturnToDeckFromGraveyard"],prepared:void 0}},execute:async e=>e.selectedEntities.some(t=>t.wasMovedAtCurrentChain)?!1:(await v.returnManyToDeckForTheSameReason("Random",e.selectedEntities,["Effect"],e.action.entity,e.activator),await e.activator.draw(2,e.action.entity,e.activator),!0),settle:async()=>!0},S]},yield{name:"Â§©‰Ωø„ÅÆÊñΩ„Åó",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:30,validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<3))return k(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw","DiscordAsEffect"],prepared:void 0}),execute:async e=>(await e.activator.draw(3,e.action.entity,e.activator),await e.activator.discard(2,"Effect",()=>!0,e.action.entity,e.activator),!0),settle:async()=>!0},S]},yield{name:"ÊàêÈáë„Ç¥„Éñ„É™„É≥",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:20,validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<1))return k(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(1,e.action.entity,e.activator),e.action.entity.field.duel.clock.incrementProcSeq(),e.activator.getOpponentPlayer().heal(1e3,e.action.entity),!0),settle:async()=>!0},S]},yield{name:"ÊâãÊú≠ÊäπÊÆ∫",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<e.activator.getHandCell().cardEntities.filter(t=>t.seq!==e.action.entity.seq).length)&&e.action.entity.field.getAllCells().filter(t=>t.cellType==="Hand").flatMap(t=>t.cardEntities).filter(t=>t.seq!==e.action.entity.seq).length!==0)return k(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw","DiscordAsEffect"],prepared:void 0}),execute:async e=>{const t=e.activator.getHandCell().cardEntities.length,i=e.activator.getOpponentPlayer().getHandCell().cardEntities.length;return await v.sendManyToGraveyardForTheSameReason(e.action.entity.field.getCells("Hand").flatMap(a=>a.cardEntities),["Effect","Discard"],e.action.entity,e.activator),e.activator.duel.clock.incrementProcSeq(),await v.drawAtSameTime(e.activator,e.action.entity,t,i),!0},settle:async()=>!0},S]},yield{name:"‰∏ÄÊôÇ‰ºëÊà¶",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{for(const t of[e.activator,e.activator.getOpponentPlayer()])if(!t.getDeckCell().cardEntities.length||!t.canDraw)return;return k(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await v.drawAtSameTime(e.activator,e.action.entity,1,1),[e.activator,e.activator.getOpponentPlayer()].forEach(t=>t.entity.damageFilterBundle.push(new Pt("„ÉÄ„É°„Éº„Ç∏ÁÑ°Âäπ",i=>i.effectOwner.duel.clock.turn-i.isSpawnedAt.turn<2,!1,e.action.entity,e.action,()=>!0,"zero_typeA",(i,a,r,n)=>(r.writeInfoLog(`${n.profile.name}„ÅØ${i.isSpawnedBy}„ÅÆÂäπÊûú„Åß„ÉÄ„É°„Éº„Ç∏„ÇíÂèó„Åë„Å™„ÅÑ„ÄÇ`),{zero_typeA:!0})))),!0),settle:async()=>!0},S]},yield{name:"Êâì„Å°Âá∫„ÅÆÂ∞èÊßå",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(e.activator.canDraw)return k(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>{const t=e.activator.getHandCell().cardEntities;if(!t.length)return!1;const i=await e.activator.waitSelectEntities(t,void 0,a=>a.length>0,"„Éá„ÉÉ„Ç≠„Å´Êàª„Åô„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû„ÄÇ",!1);if(!i)throw new q(e);return await v.returnManyToDeckForTheSameReason("Random",i,["Effect"],e.action.entity,e.activator),e.activator.duel.clock.incrementTotalProcSeq(),await e.activator.draw(i.length,e.action.entity,e.activator),!0},settle:async()=>!0},S]}}const ei=Object.freeze(Object.defineProperty({__proto__:null,default:wr},Symbol.toStringTag,{value:"Module"}));function*_r(){yield*[{name:"Â¢óÊè¥",filter:e=>e.origin.kind==="Monster"&&e.types.includes("Warrior")&&(e.origin.level??5)<5},{name:"ÂåñÁü≥Ë™øÊüª",filter:e=>e.origin.kind==="Monster"&&e.types.includes("Dinosaur")&&(e.origin.level??6)<6},{name:"Ôº•Ôºç„Ç®„Éû„Éº„Ç∏„Çß„É≥„Ç∑„Éº„Ç≥„Éº„É´",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("Ôº•„ÉªÔº®Ôº•Ôº≤ÔºØ")},{name:"Âè¨ÈõÜ„ÅÆËÅñÂàªÂç∞",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("ËÅñÂàª")},{name:"Âè¨ÂñöÂ∏´„ÅÆ„Çπ„Ç≠„É´",filter:e=>e.origin.kind==="Monster"&&(e.origin.monsterCategories??[]).includes("Normal")&&(e.origin.level??4)>4},{name:"„Éà„Ç•„Éº„É≥„ÅÆ„ÇÇ„Åè„Åò",filter:e=>(e.origin.nameTags??[]).includes("„Éà„Ç•„Éº„É≥")},{name:"ËûçÂêàË≥¢ËÄÖ",filter:e=>e.origin.name==="ËûçÂêà"},{name:"Ëôπ„ÅÆÊû∂„ÅëÊ©ã",filter:e=>e.origin.kind!=="Monster"&&(e.origin.nameTags??[]).includes("ÂÆùÁéâ")},{name:"Á¥´ÁÇé„ÅÆÁãºÁÖô",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("ÂÖ≠Ê≠¶Ë°Ü")&&(e.origin.level??4)<4},{name:"„ÉÜ„É©„Éª„Éï„Ç©„Éº„Éü„É≥„Ç∞",filter:e=>e.origin.kind==="Spell"&&e.origin.spellCategory==="Field"},{name:"„Ç≥„Éº„É´„Éª„É™„Çæ„Éç„Éº„Çø„Éº",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("„É™„Çæ„Éç„Éº„Çø„Éº")}].map(e=>({name:e.name,actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:t=>{if(t.activator.getDeckCell().cardEntities.filter(e.filter).length&&t.activator.canDraw)return k(t)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async t=>{const i=t.activator.getDeckCell().cardEntities.filter(e.filter);if(!i.length)return!1;const a=await t.activator.waitSelectEntity(i,"ÊâãÊú≠„Å´Âä†„Åà„Çã„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû",!1);return a?(await a.addToHand(["Effect"],t.action.entity,t.activator),!0):!1},settle:async()=>!0},S]})),yield*[{name:"Êà¶Â£´„ÅÆÁîüÈÇÑ",filter:e=>e.kind==="Monster"&&e.types.includes("Warrior"),qty:1},{name:"„ÉÄ„Éº„ÇØ„Éª„Éê„Éº„Çπ„Éà",filter:e=>e.kind==="Monster"&&e.attr.includes("Dark")&&(e.atk??9999)<=1500,qty:1},{name:"ÊÇ™Â§¢ÂÜç„Å≥",filter:e=>e.kind==="Monster"&&e.attr.includes("Dark")&&(e.def??9999)===0,qty:2},{name:"„Çµ„É´„Éô„Éº„Ç∏",filter:e=>e.kind==="Monster"&&e.attr.includes("Water")&&(e.atk??9999)<=1500,qty:2},{name:"„Éê„ÉÉ„ÉÜ„É™„Éº„É™„Çµ„Ç§„ÇØ„É´",filter:e=>e.kind==="Monster"&&e.types.includes("Thunder")&&(e.atk??9999)<=1500,qty:2},{name:"Èóá„ÅÆÈáèÁî£Â∑•Â†¥",filter:e=>e.kind==="Monster"&&(e.status.monsterCategories??[]).includes("Normal"),qty:2}].map(e=>({name:e.name,actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,priorityForNPC:40,validate:t=>{if(!(t.activator.getGraveyard().cardEntities.filter(e.filter).length<e.qty))return k(t)},prepare:async()=>({selectedEntities:[],chainBlockTags:["AddToHandFromGraveyard"],prepared:void 0}),execute:async t=>{const i=t.activator.getGraveyard().cardEntities.filter(e.filter);if(i.length===0)return!1;const a=await t.activator.waitSelectEntities(i,e.qty,r=>r.length===e.qty,"ÊâãÊú≠„Å´Âä†„Åà„Çã„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû",!1);for(const r of a??[])await r.addToHand(["Effect"],t.action.entity,t.activator);return!0},settle:async()=>!0},S]})),yield*[{name:"„Éà„É¨„Éº„Éâ„Éª„Ç§„É≥",filter:e=>e.kind==="Monster"&&(e.lvl??0)===8},{name:"Ë™øÂíå„ÅÆÂÆùÊú≠",filter:e=>e.kind==="Monster"&&(e.origin.monsterCategories??[]).includes("Tuner")&&e.types.includes("Dragon")&&(e.atk??9999)<=1e3},{name:"„Éá„Çπ„ÉÜ„Éã„Éº„Éª„Éâ„É≠„Éº",filter:e=>e.kind==="Monster"&&(e.origin.nameTags??[]).includes("Ôº§ÔºçÔº®Ôº•Ôº≤ÔºØ")}].map(e=>({name:e.name,actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,canPayCosts:t=>Lt(t,e.filter),validate:t=>{if(!(t.activator.getDeckCell().cardEntities.length<2))return k(t)},payCosts:async(t,i,a)=>qt(t,a,e.filter),prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async t=>(await t.activator.draw(2,t.action.entity,t.activator),!0),settle:async()=>!0},S]})),yield*[{name:"ÁÅ´„ÅÆÁ≤â",calcHeal:()=>[0,-200]},{name:"Èõ∑È≥¥",calcHeal:()=>[0,-300]},{name:"„Éï„Ç°„Ç§„É§„Éº„Éª„Éú„Éº„É´",calcHeal:()=>[0,-500]},{name:"ÁÅ´„ÅÇ„Å∂„Çä„ÅÆÂàë",calcHeal:()=>[0,-600]},{name:"ÊòºÂ§ú„ÅÆÂ§ßÁÅ´‰∫ã",calcHeal:()=>[0,-800]},{name:"ÁÅ´ÁÇéÂú∞ÁçÑ",calcHeal:()=>[-500,-1e3]},{name:"Áõó‰∫∫„Ç¥„Éñ„É™„É≥",calcHeal:()=>[500,-500]},{name:"„Éñ„É´„Éº„Éª„Éù„Éº„Ç∑„Éß„É≥",calcHeal:()=>[400,0]},{name:"„É¨„ÉÉ„Éâ„Éª„Éù„Éº„Ç∑„Éß„É≥",calcHeal:()=>[500,0]},{name:"„Ç¥„Éñ„É™„É≥„ÅÆÁßòËñ¨",calcHeal:()=>[600,0]},{name:"Â§©‰Ωø„ÅÆÁîü„ÅçË°Ä",calcHeal:()=>[800,0]},{name:"Ê≤ªÁôÇ„ÅÆÁ•û „Éá„Ç£„Ç¢„É≥„Éª„Ç±„Éà",calcHeal:()=>[1e3,0]},{name:"ÊÅµ„Åø„ÅÆÈõ®",calcHeal:()=>[1e3,1e3]}].map(e=>({name:e.name,actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:k,prepare:async()=>{const[t,i]=e.calcHeal(),a=[];return t<0&&a.push("DamageToSelf"),i<0&&a.push("DamageToOpponent"),{selectedEntities:[],chainBlockTags:a,prepared:void 0}},execute:async t=>{const[i,a]=e.calcHeal();return a>0?t.activator.getOpponentPlayer().heal(a,t.action.entity):a<0&&t.activator.getOpponentPlayer().effectDamage(Math.abs(a),t),i>0?t.activator.heal(i,t.action.entity):i<0&&t.activator.effectDamage(Math.abs(i),t),!0},settle:async()=>!0},S]}))}const ti=Object.freeze(Object.defineProperty({__proto__:null,default:_r},Symbol.toStringTag,{value:"Module"}));function*br(){yield{name:"Âº∑Ê¨≤„Å™Áì∂",actions:[S,{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:D,executableDuelistTypes:["Controller"],validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<2)&&e.activator.canDraw&&e.activator.canAddToHandFromDeck)return k(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(1,e.action.entity,e.activator),!0),settle:async()=>!0}]},yield{name:"Êà¶Á∑öÂæ©Â∏∞",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:D,executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:e=>{const t=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getGraveyard().cardEntities.filter(a=>a.kind==="Monster").filter(a=>a.canBeTargetOfEffect(e)).map(a=>({monster:a,posList:["Defense"],cells:t})),[],!1).length)return k(e)},prepare:e=>re(e,e.activator.getGraveyard().cardEntities.filter(t=>t.kind==="Monster").filter(t=>t.canBeTargetOfEffect(e)),["Defense"]),execute:async e=>ne(e,["Defense"]),settle:async()=>!0},S]},yield{name:"„Çµ„É≥„ÉÄ„Éº„Éª„Éñ„É¨„Ç§„ÇØ",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:D,executableDuelistTypes:["Controller"],hasToTargetCards:!0,canPayCosts:e=>Lt(e),validate:e=>{if(e.action.entity.field.getMonstersOnFieldStrictly().filter(i=>i.canBeTargetOfEffect(e)).length)return k(e)},payCosts:async(e,t,i)=>qt(e,i),prepare:async(e,t,i)=>{const a=e.action.entity.field.getMonstersOnFieldStrictly().filter(n=>n.canBeTargetOfEffect(e)),r=await e.activator.waitSelectEntity(a,"ÂØæË±°„Å®„Åô„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",i);if(r)return{selectedEntities:[r],chainBlockTags:e.action.calcChainBlockTagsForDestroy(e.activator,[r]),prepared:void 0}},execute:async e=>e.selectedEntities[0].isOnFieldAsMonsterStrictly?(await v.tryDestroy(e.selectedEntities,e),!0):!1,settle:async()=>!0},S]}}const ii=Object.freeze(Object.defineProperty({__proto__:null,default:br},Symbol.toStringTag,{value:"Module"}));function*Dr(){yield*["ÁÇ∏Ë£ÇË£ÖÁî≤","Ê¨°ÂÖÉÂπΩÈñâ"].map(e=>({name:e,actions:[S,{title:"Áô∫Âãï",playType:"CardActivation",spellSpeed:"Quick",isMandatory:!1,executableCells:["SpellAndTrapZone"],executablePeriods:["b1Battle","b2Battle"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,isNoticedForcibly:!0,validate:t=>{if(!t.activator.duel.clock.isUponAttackDeclaration()||t.activator.isTurnPlayer)return;const i=t.activator.duel.attackingMonster;if(!i)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",t,i);if(i.canBeTargetOfEffect(t)&&!(e==="Ê¨°ÂÖÉÂπΩÈñâ"&&!t.activator.canTryBanish(i,"BanishAsEffect",t.action)))return k(t)},prepare:async t=>{const i=t.activator.duel.attackingMonster;if(!i)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",t,i);const a=e==="ÁÇ∏Ë£ÇË£ÖÁî≤"?t.action.calcChainBlockTagsForDestroy(t.activator,[i]):["BanishFromField"];return{selectedEntities:[i],chainBlockTags:a,prepared:void 0}},execute:async t=>(e==="ÁÇ∏Ë£ÇË£ÖÁî≤"?await v.tryDestroy(t.selectedEntities,t):await v.tryBanish("BanishAsEffect",t.selectedEntities,t),!0),settle:async()=>!0}]}))}const ai=Object.freeze(Object.defineProperty({__proto__:null,default:Dr},Symbol.toStringTag,{value:"Module"}));function*Pr(){yield{name:"„ÅîÈö†Â±Ö„ÅÆÁåõÊØíËñ¨",actions:[S,{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:D,executableDuelistTypes:["Controller"],validate:k,prepare:async(e,t,i)=>{const a=[{seq:0,text:"‚óèËá™ÂàÜ„ÅØÔºëÔºíÔºêÔºêÔº¨Ôº∞ÂõûÂæ©„Åô„Çã„ÄÇ",tags:[]},{seq:1,text:"‚óèÁõ∏Êâã„Å´ÔºòÔºêÔºê„ÉÄ„É°„Éº„Ç∏„Çí‰∏é„Åà„Çã„ÄÇ",tags:["DamageToOpponent"]}],r=await e.activator.waitSelectText(a,"‰ΩøÁî®„Åô„ÇãÂäπÊûú„ÇíÈÅ∏Êäû",i);if(r!==void 0)return{selectedEntities:[],chainBlockTags:r.tags,prepared:r.seq}},execute:async e=>e.prepared===1?(e.activator.getOpponentPlayer().effectDamage(800,e),!0):(e.activator.heal(1200,e.action.entity),!0),settle:async()=>!0}]},yield{name:"Êúà„ÅÆÊõ∏",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:D,executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:e=>{if(e.action.entity.field.getMonstersOnFieldStrictly().filter(i=>i.canBeTargetOfEffect(e)).filter(i=>i.face==="FaceUp").length)return k(e)},prepare:async(e,t,i)=>{const a=e.action.entity.field.getMonstersOnFieldStrictly().filter(n=>n.canBeTargetOfEffect(e)).filter(n=>n.face==="FaceUp"),r=await e.activator.waitSelectEntity(a,"ÂØæË±°„Å®„Åô„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",i);if(r)return{selectedEntities:[r],chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.selectedEntities[0];return!t.isOnFieldAsMonsterStrictly||t.battlePosition==="Set"?!1:t.canBeEffected(e.activator,e.action.entity,e.action)?(await t.setBattlePosition("Set",["Effect"],e.action.entity,e.activator),!0):(e.activator.duel.log.info(`${t.toString()}„ÅØ${e.action.entity.toString()}„ÅÆÂäπÊûú„ÇíÂèó„Åë„Å™„ÅÑ„ÄÇ`),!1)},settle:async()=>!0},S]},yield{name:"Á™ÅÈÄ≤",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:[...D,...F],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:e=>{if(e.action.entity.field.getMonstersOnFieldStrictly().filter(i=>i.canBeTargetOfEffect(e)).length)return k(e)},prepare:async(e,t,i)=>{const a=e.action.entity.field.getMonstersOnFieldStrictly().filter(n=>n.canBeTargetOfEffect(e)),r=await e.activator.waitSelectEntity(a,"ÂØæË±°„Å®„Åô„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",i);if(r)return{selectedEntities:[r],chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.selectedEntities[0];return!t.isOnFieldAsMonsterStrictly||t.battlePosition==="Set"?!1:t.canBeEffected(e.activator,e.action.entity,e.action)?(t.numericOprsBundle.push(Z.createLingeringAddition("ÊîªÊíÉÂäõ‰∏äÊòá",i=>i.effectOwner.duel.clock.isSameTurn(i.isSpawnedAt),e.action.entity,e.action,"attack",(i,a,r)=>r+700)),!0):(e.activator.duel.log.info(`${t.toString()}„ÅØ${e.action.entity.toString()}„ÅÆÂäπÊûú„ÇíÂèó„Åë„Å™„ÅÑ„ÄÇ`),!1)},settle:async()=>!0},S]},yield{name:"ÊâãÊú≠Êñ≠ÊÆ∫",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:[...D,...F],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:e=>{for(const t of[e.activator,e.activator.getOpponentPlayer()])if(!t.canDraw||t.getHandCell().cardEntities.filter(i=>i.canBeSentToGraveyard(e.activator,e.action.entity,"SendToGraveyardAsEffect",e.action)).filter(i=>i!==e.action.entity).length<2||t.getDeckCell().cardEntities.length<2)return;return k(e)},prepare:async()=>(console.log("ÊâãÊú≠Êñ≠ÊÆ∫"),{selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>{if(e.activator.getHandCell().cardEntities.length<2||e.activator.getOpponentPlayer().getHandCell().cardEntities.length<2)return!1;let t=0;for(const i of[e.activator,e.activator.getOpponentPlayer()]){const a=await i.waitSelectEntities(i.getHandCell().cardEntities,2,n=>n.length===2,"Â¢ìÂú∞„Å´ÈÄÅ„Çã„Ç´„Éº„Éâ„ÇíÔºíÊûöÈÅ∏Êäû„ÄÇ",!1);if(!a)throw new q(e,i);const r=await v.sendManyToGraveyardForTheSameReason(a,["Effect"],e.action.entity,e.activator);t+=r.length}return t?(e.activator.duel.clock.incrementTotalProcSeq(),await v.drawAtSameTime(e.activator,e.action.entity,2,2),!0):!1},settle:async()=>!0},S]},yield{name:"„É™„É≠„Éº„Éâ",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:[...D,...F],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:e=>{if(e.activator.canDraw)return k(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>{const t=e.activator.getHandCell().cardEntities;return t.length?(await v.returnManyToDeckForTheSameReason("Random",t,["Effect"],e.action.entity,e.activator),e.activator.duel.clock.incrementTotalProcSeq(),await e.activator.draw(t.length,e.action.entity,e.activator),!0):!1},settle:async()=>!0},S]}}const ri=Object.freeze(Object.defineProperty({__proto__:null,default:Pr},Symbol.toStringTag,{value:"Module"})),Mr=(e,t,i,a,r,n,l)=>{if(!e.lvl||r.some(d=>!d.lvl))return;const o=r.map(d=>d.lvl??0).reduce((d,p)=>d+p,0),u=be(...r.map(d=>d.lvl??0));if(o<e.lvl||l==="Equal"&&o!==e.lvl||l==="OrMore"&&o-u>=e.lvl||!n(r))return;const c=[...r.map(d=>({material:d,cell:d.fieldCell}))];if(t.activator.getEnableSummonList(t.activator,"RitualSummon",["Effect","SpecialSummon"],t.action,[{monster:t.action.entity,posList:i,cells:a}],c,!1).length)return c},ni=(e,...t)=>{const[i,a,r,n,l]=t,o=e.activator.getCells(...i).flatMap(p=>p.cardEntities).filter(p=>{var g;return(g=p.status.monsterCategories)==null?void 0:g.includes("Ritual")}).filter(a);if(!o.length)return[];const u=e.activator.getCells(...r).flatMap(p=>p.cardEntities).filter(p=>p.lvl).filter(p=>p.canBeReleased(e.activator,e.action.entity,["RitualMaterial","ReleaseAsEffect"],e.action));if(!u.length)return[];const c=e.activator.getMonsterZones(),d=["Attack","Defense"];return o.flatMap(p=>u.filter(g=>g!==p).getAllOnOffPattern().map(g=>({monster:p,materials:g}))).map(p=>({monster:p.monster,materialInfos:Mr(p.monster,e,d,c,p.materials,n,l)??[]})).filter(p=>p.materialInfos.length)},Ar=async(e,...t)=>{var d,p,g;const i=ni(e,...t),a=i.map(h=>h.monster).getDistinct(),r=await e.activator.waitSelectEntity(a,"ÂÑÄÂºèÂè¨Âñö„Åô„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû„ÄÇ");if(!r)return!1;const n=i.filter(h=>h.monster===r).map(h=>h.materialInfos),l=n.map(h=>({infos:h,materialSeqList:h.map(y=>y.material.seq).sort()}));let o=n[0].map(h=>h.material);if(n.length>1){const h=n.flatMap(y=>y.map(P=>P.material)).getDistinct();o=await e.activator.waitSelectEntities(h,void 0,y=>{const P=y.map(f=>f.seq).sort();return l.some(f=>P.length===f.materialSeqList.length&&P.every((A,L)=>A===f.materialSeqList[L]))},"„É™„É™„Éº„Çπ„Åô„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",!1)??o}const u=o.map(h=>h.seq).sort(),c=(d=l.find(h=>u.length===h.materialSeqList.length&&u.every((y,P)=>y===h.materialSeqList[P])))==null?void 0:d.infos;if(!c)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",e,o);return await v.releaseManyForTheSameReason(o,["RitualMaterial","Effect","SpecialSummonMaterial"],e.action.entity,e.activator),await e.activator.summon("RitualSummon",["Effect","SpecialSummon"],e.action,r,_,e.activator.getMonsterZones(),c,!1),r.info.isRebornable=!((p=r.origin.monsterCategories)!=null&&p.includes("RegularSpecialSummonOnly")),(g=e.costInfo.summonMaterialInfos)==null||g.map(h=>h.material).forEach(h=>h.onUsedAsMaterial(e,e.action.entity)),!0},xr=(e,t,i,a,r)=>({title:"ÂÑÄÂºèÂè¨Âñö",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:n=>ni(n,e,t,i,a,r).length?k(n):void 0,prepare:async()=>{const n=[];return e.includes("Hand")&&n.push("SpecialSummonFromHand"),e.includes("Graveyard")&&n.push("SpecialSummonFromGraveyard"),e.includes("ExtraDeck")&&n.push("SpecialSummonFromExtraDeck"),e.includes("Banished")&&n.push("SpecialSummonFromBanished"),e.includes("Deck")&&n.push("SpecialSummonFromDeck"),{selectedEntities:[],chainBlockTags:n,prepared:void 0}},execute:n=>Ar(n,e,t,i,a,r),settle:async()=>!0});function*Fr(){for(const e of[{spellName:"„Ç´„Ç™„Çπ„ÅÆÂÑÄÂºè",monsterName:"„Ç´„Ç™„Çπ„Éª„ÇΩ„É´„Ç∏„É£„Éº"},{spellName:"‰ªÆÈù¢È≠îÁç£„ÅÆÂÑÄÂºè",monsterName:"‰ªÆÈù¢È≠îÁç£„Éû„Çπ„ÇØ„Éâ„Éª„Éò„É´„É¨„Ç§„Ç∂„Éº"},{spellName:"‰∫Ä„ÅÆË™ì„ÅÑ",monsterName:"„ÇØ„É©„Éñ„Éª„Çø„Éº„Éà„É´"},{spellName:"„Ç∏„É£„Éô„É™„É≥„Éì„Éº„Éà„É´„ÅÆÂ•ëÁ¥Ñ",monsterName:"„Ç∏„É£„Éô„É™„É≥„Éì„Éº„Éà„É´"},{spellName:"„Çº„É©„ÅÆÂÑÄÂºè",monsterName:"„Çº„É©"},{spellName:"„Ç´„Ç™„ÇπÔºçÈªíÈ≠îË°ì„ÅÆÂÑÄÂºè",monsterName:"„Éû„Ç∏„Ç∑„É£„É≥„Éª„Ç™„Éñ„Éª„Éñ„É©„ÉÉ„ÇØ„Ç´„Ç™„Çπ"},{spellName:"„Ç¨„É´„Éû„ÇΩ„Éº„Éâ„ÅÆË™ì„ÅÑ",monsterName:"„Ç¨„É´„Éû„ÇΩ„Éº„Éâ"},{spellName:"„É©„Ç§„Ç™„É≥„ÅÆÂÑÄÂºè",monsterName:"„Çπ„Éº„Éë„Éº„Éª„Ç¶„Ç©„Éº„Éª„É©„Ç§„Ç™„É≥"},{spellName:"„ÉÅ„É£„ÇØ„É©„ÅÆÂæ©Ê¥ª",monsterName:"„ÉÅ„É£„ÇØ„É©"},{spellName:"Ë¶ÅÂ°û„ÇØ„Ç∏„É©„ÅÆË™ì„ÅÑ",monsterName:"Ë¶ÅÂ°û„ÇØ„Ç∏„É©"},{spellName:"„É≠„Éº„ÅÆÁ•à„Çä",monsterName:"„É≠„Éº„Ç¨„Éº„Éá„Ç£„Ç¢„É≥"},{spellName:"„Çπ„Ç´„É´„É©„Ç§„ÉÄ„Éº„ÅÆÂæ©Ê¥ª",monsterName:"„Çπ„Ç´„É´„É©„Ç§„ÉÄ„Éº"},{spellName:"Ë∏ä„Çä„Å´„Çà„ÇãË™òÁô∫",monsterName:"„ÉÄ„É≥„Ç∑„É≥„Ç∞„Éª„ÇΩ„É´„Ç∏„É£„Éº"},{spellName:"ÊÇ™È≠îÈè°„ÅÆÂÑÄÂºè",monsterName:"„Éá„Éì„É´„Ç∫„Éª„Éü„É©„Éº"},{spellName:"„Éè„É≥„Éê„Éº„Ç¨„Éº„ÅÆ„É¨„Ç∑„Éî",monsterName:"„Éè„É≥„Ç∞„É™„Éº„Éê„Éº„Ç¨„Éº"}])yield{name:e.spellName,actions:[xr(["Hand"],t=>t.nm===e.monsterName,["Hand","MonsterZone","ExtraMonsterZone"],()=>!0,"OrMore"),S]}}const si=Object.freeze(Object.defineProperty({__proto__:null,default:Fr},Symbol.toStringTag,{value:"Module"})),Br=(e,t,i,a,r,n)=>{if(!e.action.entity.origin.level||a.some(c=>!c.lvl)||a.map(c=>c.lvl??0).reduce((c,d)=>c+d,0)!==e.action.entity.origin.level)return;const l=a.filter(c=>{var d;return(d=c.status.monsterCategories)==null?void 0:d.some(p=>p==="Tuner")}),o=a.filter(c=>{var d;return(d=c.status.monsterCategories)==null?void 0:d.every(p=>p!=="Tuner")});if(!r(l)||!n(o))return;const u=[...l.map(c=>({material:c,cell:c.fieldCell,isAsTuner:!0})),...o.map(c=>({material:c,cell:c.fieldCell,isAsTuner:!1}))];if(e.activator.getEnableSummonList(e.activator,"SyncroSummon",["Rule","SpecialSummon"],e.action,[{monster:e.action.entity,posList:t,cells:i}],u,!1).length)return u},Or=(e,t=a=>a.length===1,i=a=>a.length>0)=>{let a=[...e.activator.getMonstersOnField().filter(l=>l.battlePosition!=="Set"),...e.activator.getHandCell().cardEntities.filter(l=>l.origin.kind==="Monster")];if(a.every(l=>!l.status.allowHandSyncro)&&(a=a.filter(l=>l.fieldCell.isPlayFieldCell)),a.length<2)return[];const r=[...e.activator.getMonsterZones(),...e.activator.duel.field.getCells("ExtraMonsterZone")],n=["Attack","Defense"];return a.getAllOnOffPattern().filter(l=>l.some(o=>o.status.allowHandSyncro)||l.every(o=>o.isOnFieldAsMonsterStrictly)).map(l=>Br(e,n,r,l,t,i)??[]).filter(l=>l.length)},Nr=async(e,t,i)=>{var u;const a=e.action.getEnableMaterialPatterns(e),r=a.map(c=>({infos:c,materialSeqList:c.map(d=>d.material.seq).sort()}));let n=a[0].map(c=>c.material);if(a.length>1){const c=a.flatMap(p=>p.map(g=>g.material)).getDistinct(),d=await e.activator.waitSelectEntities(c,void 0,p=>{const g=p.map(h=>h.seq).sort();return r.some(h=>g.length===h.materialSeqList.length&&g.every((y,P)=>y===h.materialSeqList[P]))},"„Ç∑„É≥„ÇØ„É≠Á¥†Êùê„Å®„Åô„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",i);if(!d)return;n=d}const l=n.map(c=>c.seq).sort(),o=(u=r.find(c=>l.length===c.materialSeqList.length&&l.every((d,p)=>d===c.materialSeqList[p])))==null?void 0:u.infos;if(!o)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",e,n);return await v.sendManyToGraveyardForTheSameReason(n,["SyncroMaterial","Cost","Rule","SpecialSummonMaterial"],e.action.entity,e.activator),{summonMaterialInfos:o}},V=(e=i=>i.length===1,t=i=>i.length>0)=>({title:"„Ç∑„É≥„ÇØ„É≠Âè¨Âñö",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],getEnableMaterialPatterns:i=>Or(i,e,t),canPayCosts:i=>i.action.getEnableMaterialPatterns(i).length>0,validate:i=>!i.ignoreCost||i.activator.getAvailableExtraZones().length+i.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:Nr,prepare:i=>J(i,"SyncroSummon",["Rule","SpecialSummon","SyncroSummon"],["Attack","Defense"]),execute:Y,settle:async()=>!0});function*Lr(){yield*["Â§ßÂú∞„ÅÆÈ®éÂ£´„Ç¨„Ç§„Ç¢„Éä„Ç§„Éà","„Çπ„ÇØ„É©„ÉÉ„Éó„Éª„Éá„Çπ„Éá„Éº„É¢„É≥"].map(e=>({name:e,actions:[C,T,E,V()]})),yield{name:"„Éä„ÉÅ„É•„É´„Éª„Ç¨„Ç™„Éâ„É¨„Ç§„ÇØ",actions:[C,T,E,V(e=>e.length===1&&e.every(t=>t.attr.some(i=>i==="Earth")),e=>e.length>0&&e.every(t=>t.attr.some(i=>i==="Earth")))]},yield{name:"„Éû„Ç∏„Ç´„É´„Éª„Ç¢„É≥„Éâ„É≠„Ç§„Éâ",actions:[C,T,E,V(),{title:"ÂõûÂæ©",isMandatory:!0,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["end"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,validate:e=>e.action.entity.duel.phase==="end"&&e.activator.isTurnPlayer&&e.action.entity.face==="FaceUp"?[]:void 0,prepare:R,execute:async e=>(e.activator.heal(e.activator.getMonstersOnField().filter(t=>t.face==="FaceUp").filter(t=>t.types.includes("Psychic")).length*600,e.action.entity),!0),settle:async()=>!0}]}}const li=Object.freeze(Object.defineProperty({__proto__:null,default:Lr},Symbol.toStringTag,{value:"Module"}));function*qr(){yield{name:"„Å´„Åõ„Ç¢„Éê„Çø„Éº",actions:[x,C,T,E],continuousEffects:[me("THE_DEVILS_AVATAR","Monster",e=>[e],e=>["attack","defense"].map(t=>Z.createContinuous("THE_DEVILS_AVATAR",i=>i.isSpawnedBy.isOnFieldStrictly&&i.isSpawnedBy.face==="FaceUp",e,(i,a)=>a.isOnFieldStrictly&&a.face==="FaceUp",t,"calculated","THE_DEVILS_AVATAR",()=>Number.MIN_VALUE)))]},yield{name:"„Å´„Åõ„Éâ„É¨„ÉÉ„Éâ„Éª„É´„Éº„Éà",actions:[x,C,T,E],continuousEffects:[we("THE_DEVILS_DREAD-ROOT","Monster",e=>["attack","defense"].map(t=>Z.createContinuous("THE_DEVILS_DREAD-ROOT",i=>i.isSpawnedBy.isOnFieldStrictly&&i.isSpawnedBy.face==="FaceUp",e,(i,a)=>a.kind==="Monster"&&a.isOnFieldStrictly&&a.face==="FaceUp"&&a!==i.isSpawnedBy,t,"calculated","THE_DEVILS_DREAD-ROOT",(i,a,r)=>Math.round(r/2))))]}}const oi=Object.freeze(Object.defineProperty({__proto__:null,default:qr},Symbol.toStringTag,{value:"Module"})),Rr=(e,t,i,a,r=2,n=2,l)=>{if(!e.action.entity.origin.rank||a.length<r||a.length>n||a.some(u=>!u.lvl)||a.some(u=>u.lvl!==e.action.entity.rank)||!l(a))return;const o=a.map(u=>({material:u,cell:u.fieldCell,level:u.status.level}));if(e.activator.getEnableSummonList(e.activator,"XyzSummon",["Rule","XyzSummon","SpecialSummon"],e.action,[{monster:e.action.entity,posList:t,cells:i}],o,!1).length)return o},Hr=(e,t=2,i=2,a=r=>r.length>1)=>{const r=e.activator.getMonstersOnField().filter(l=>l.battlePosition!=="Set");if(r.length<t)return[];const n=[...e.activator.getMonsterZones(),...e.activator.getAvailableExtraZones()];return r.getAllOnOffPattern().filter(l=>l.length>=t).filter(l=>l.length<=i).map(l=>Rr(e,_,n,l,t,i,a)??[]).filter(l=>l.length)},Zr=async(e,t,i)=>{var u;const a=e.action.getEnableMaterialPatterns(e),r=a.map(c=>({infos:c,materialSeqList:c.map(d=>d.material.seq).sort()}));let n=a[0].map(c=>c.material);if(a.length>1){const c=a.flatMap(p=>p.map(g=>g.material)).getDistinct(),d=await e.activator.waitSelectEntities(c,void 0,p=>{const g=p.map(h=>h.seq).sort();return r.some(h=>g.length===h.materialSeqList.length&&g.every((y,P)=>y===h.materialSeqList[P]))},"„Ç®„ÇØ„Ç∑„Éº„Ç∫Á¥†Êùê„Å®„Åô„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",i);if(!d)return;n=d}const l=n.map(c=>c.seq).sort(),o=(u=r.find(c=>l.length===c.materialSeqList.length&&l.every((d,p)=>d===c.materialSeqList[p])))==null?void 0:u.infos;if(!o)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",e,n);return console.log(o),await v.convertManyToXyzMaterials(o.map(c=>c.material),["XyzMaterial","Rule","Cost"],e.action.entity,e.activator),console.log(o.map(c=>c.material.kind)),{summonMaterialInfos:o}},$r=(e=2,t=2,i=a=>a.length>1)=>({title:"„Ç®„ÇØ„Ç∑„Éº„Ç∫Âè¨Âñö",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],getEnableMaterialPatterns:a=>Hr(a,e,t,i),canPayCosts:a=>a.action.getEnableMaterialPatterns(a).length>0,validate:a=>!a.ignoreCost||a.activator.getAvailableExtraZones().length+a.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:Zr,prepare:a=>J(a,"XyzSummon",["Rule","SpecialSummon","XyzSummon"],["Attack","Defense"]),execute:Y,settle:async()=>!0});function*Gr(){yield*[{name:"„Ç∏„Çß„É†„Éä„Ç§„Éà„Éª„Éë„Éº„É´",qty:2},{name:"Ë¶öÈÜí„ÅÆÂãáÂ£´ „Ç¨„Ç¨„ÇÆ„Ç¥",qty:3}].map(e=>({name:e.name,actions:[C,T,E,$r(e.qty,e.qty)]}))}const ci=Object.freeze(Object.defineProperty({__proto__:null,default:Gr},Symbol.toStringTag,{value:"Module"}));function*jr(){yield{name:"„Ç∑„É•„Éº„ÉÜ„Ç£„É≥„Ç∞„Éª„É©„Ç§„Ç∂„Éº„Éª„Éâ„É©„Ç¥„É≥",actions:[C,T,E,V(),{title:"‚ë†Â¢ìÂú∞ÈÄÅ„Çä",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:H,executablePeriods:[...D,...F],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>{if(e.action.entity.hasBeenSummonedNow(["SyncroSummon"])&&e.activator.getDeckCell().cardEntities.some(t=>(t.lvl??12)<(e.action.entity.lvl??0)))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SendToGraveyardFromDeck","IfSpecialSummonSucceed"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(r=>(r.lvl??12)<(e.action.entity.lvl??0));if(t.length===0)return!1;const i=await e.activator.waitSelectEntity(t,"Â¢ìÂú∞„Å´ÈÄÅ„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",!1);if(!i)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂Ê≥Å",e);await i.sendToGraveyard(["Effect"],e.action.entity,e.activator);const a=i.lvl??0;return e.action.entity.numericOprsBundle.push(Z.createLingeringAddition("„É¨„Éô„É´Ê∏õÂ∞ë",()=>!0,e.action.entity,e.action,"level",(r,n,l)=>l-a)),!0},settle:async()=>!0},Wt({title:"‚ë°„Ç∑„É≥„ÇØ„É≠Âè¨Âñö",isOnlyNTimesPerChain:1})]}}const ui=Object.freeze(Object.defineProperty({__proto__:null,default:jr},Symbol.toStringTag,{value:"Module"}));function*Ur(){yield{name:"Êäò„ÇåÁ´πÂÖâ",actions:[de(),S]},yield{name:"Â¶ñÂàÄÁ´πÂÖâ",actions:[de(),S,{title:"‚ë°Áõ¥Êé•ÊîªÊíÉ‰ªò‰∏é",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>{if(!e.activator.getSpellTrapsOnField().filter(i=>{var a;return(a=i.status.nameTags)==null?void 0:a.includes("Á´πÂÖâ")}).filter(i=>i!==e.action.entity).some(i=>i.status.spellCategory==="Equip"))return;const t=e.action.entity.info.equipedBy;if(t&&!t.status.canDirectAttack)return[]},prepare:async(e,t,i)=>{const a=await e.activator.waitSelectEntity(e.activator.getSpellTrapsOnField().filter(r=>{var n;return(n=r.status.nameTags)==null?void 0:n.includes("Á´πÂÖâ")}).filter(r=>r!==e.action.entity).filter(r=>r.status.spellCategory==="Equip"),"ÊâãÊú≠„Å´Êàª„Åô„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû„ÄÇ",i);if(a)return{selectedEntities:[a],chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.action.entity.info.equipedBy;return t?(await v.returnManyToHandForTheSameReason(e.selectedEntities,["Effect"],e.action.entity,e.activator),t.statusOperatorBundle.push(new Q("Áõ¥Êé•ÊîªÊíÉ",i=>(console.log(i.effectOwner.duel.clock.turn,i.isSpawnedAt.turn),i.effectOwner.duel.clock.isSameTurn(i.isSpawnedAt)),!1,e.action.entity,e.action,()=>!0,(i,a)=>({...a,canDirectAttack:!0}))),!0):!1},settle:async()=>!0},{title:"‚ë¢„Çµ„Éº„ÉÅ",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...D,...F],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.wasMovedAtPreviousChain&&e.activator.canAddToHandFromDeck)return e.activator.getDeckCell().cardEntities.filter(t=>{var i;return(i=t.status.nameTags)==null?void 0:i.includes("Á´πÂÖâ")}).some(t=>t.status.name!=="Â¶ñÂàÄÁ´πÂÖâ")?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(a=>{var r;return(r=a.status.nameTags)==null?void 0:r.includes("Á´πÂÖâ")}).filter(a=>a.status.name!=="Â¶ñÂàÄÁ´πÂÖâ");if(!t.length)return!1;const i=await e.activator.waitSelectEntity(t,"ÊâãÊú≠„Å´Âä†„Åà„Çã„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû„ÄÇ",!1);if(!i)throw new q(e);return(await i.addToHand(["Effect"],e.action.entity,e.activator)).cellType==="Hand"},settle:async()=>!0}]},yield{name:"ÁúüÂàÄÁ´πÂÖâ",actions:[de(),S,{title:"‚ë°Áõ∏Êâã„É¢„É≥„Çπ„Çø„ÉºÁ†¥Â£ä",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["SpellAndTrapZone"],executablePeriods:["b1DAfterDmgCalc","b2DAfterDmgCalc"],executableDuelistTypes:["Controller"],validate:e=>{const t=e.action.entity.info.equipedBy;if(t&&t.info.battleLog.filter(i=>e.activator.duel.clock.isPreviousStage(i.timestamp)).some(i=>i.enemy.entityType==="Duelist")&&e.activator.getOpponentPlayer().getMonstersOnField().length&&e.activator.getOpponentPlayer().lifeLog.filter(i=>e.activator.duel.clock.isPreviousStage(i.clock)).some(i=>i.entity===t))return[]},prepare:async e=>({selectedEntities:[],chainBlockTags:e.action.calcChainBlockTagsForDestroy(e.activator,e.activator.getOpponentPlayer().getMonstersOnField()),prepared:void 0}),execute:async e=>(await v.tryDestroy(e.activator.getOpponentPlayer().getMonstersOnField(),e)).length>0,settle:async()=>!0},{title:"‚ë¢Á´πÂÖâÂÖ•Êõø",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],canPayCosts:e=>e.action.entity.info.equipedBy?Ua(e):!1,validate:e=>{if(!(!e.action.entity.info.equipedBy||!e.activator.getDeckCell().cardEntities.filter(a=>{var r;return(r=a.status.nameTags)==null?void 0:r.includes("Á´πÂÖâ")}).filter(a=>a.status.name!=="ÁúüÂàÄÁ´πÂÖâ").filter(a=>a.status.spellCategory==="Equip").length))return e.activator.duel.field.getMonstersOnFieldStrictly().some(a=>a.canBeTargetOfEffect(e))?[]:void 0},payCosts:Va,prepare:R,execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(o=>{var u;return(u=o.status.nameTags)==null?void 0:u.includes("Á´πÂÖâ")}).filter(o=>o.status.name!=="ÁúüÂàÄÁ´πÂÖâ").filter(o=>o.status.spellCategory==="Equip");if(!t.length)return!1;const i=e.activator.getAvailableSpellTrapZones();if(!i.length)return!1;const a=e.activator.duel.field.getMonstersOnFieldStrictly().filter(o=>o.canBeTargetOfEffect(e));if(!a.length)return!1;const r=await e.activator.waitSelectEntity(t,"Ë£ÖÂÇô„Åô„Çã„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû„ÄÇ",!1);if(!r)throw new q("Á´πÂÖâÈÅ∏Êäû",e);const n=await e.activator.duel.view.waitSelectDestination(e.activator,r,i,"Ë£ÖÂÇô„Ç´„Éº„Éâ„ÇíÁΩÆ„ÅèÂ†¥ÊâÄ„ÇíÈÅ∏Êäû„ÄÇ","Ë£ÖÂÇô",!1);if(!n)throw new q("ÈÖçÁΩÆÂ†¥ÊâÄÈÅ∏Êäû",e);await r.putDirectly(n,"Spell",["Effect"],e.action.entity,e.activator);const l=await e.activator.waitSelectEntity(a,"Ë£ÖÂÇô„Åô„ÇãÂØæË±°„ÇíÈÅ∏Êäû„ÄÇ",!1);if(!l)throw new q("Ë£ÖÂÇôÂØæË±°ÈÅ∏Êäû",e);return r.info.equipedBy=l,r.info.effectTargets[e.action.seq]=[l],l.info.equipEntities.push(r),!0},settle:async()=>!0}]}}const di=Object.freeze(Object.defineProperty({__proto__:null,default:Ur},Symbol.toStringTag,{value:"Module"}));function*Vr(){yield{name:"ÈªÑÈáëËâ≤„ÅÆÁ´πÂÖâ",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:20,validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<2)&&e.activator.canDraw&&e.activator.canAddToHandFromDeck&&e.activator.getSpellTrapsOnField().filter(t=>{var i;return(i=t.status.nameTags)==null?void 0:i.includes("Á´πÂÖâ")}).filter(t=>t.face==="FaceUp").some(t=>t.status.spellCategory==="Equip"))return k(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(2,e.action.entity,e.activator),!0),settle:async()=>!0},S]}}const pi=Object.freeze(Object.defineProperty({__proto__:null,default:Vr},Symbol.toStringTag,{value:"Module"}));function*zr(){yield{name:"Ôº¢Ôº¶ÔºçÁñæÈ¢®„ÅÆ„Ç≤„Ç§„É´",actions:[x,C,T,E,{title:"‚ë†ÁâπÊÆäÂè¨Âñö",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(e.activator.getMonstersOnField().filter(i=>(i.status.nameTags??[]).includes("Ôº¢Ôº¶")).filter(i=>i.nm!==e.action.entity.origin.name).length)return Me(e,["Attack","Defense"],[])},prepare:e=>J(e,"SpecialSummon",["SpecialSummon","Rule"],_),execute:Y,settle:async()=>!0},{title:"‚ë°ÊîªÂÆàÂçäÊ∏õ",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,isOnlyNTimesPerTurnIfFaceup:1,validate:e=>{const t=e.activator.getOpponentPlayer().getMonstersOnField().filter(i=>i.face==="FaceUp").filter(i=>i.canBeTargetOfEffect(e));if(t.length)return t.length?t.map(i=>i.fieldCell):void 0},prepare:async(e,t,i)=>{var r;let a=(r=e.dest)==null?void 0:r.cardEntities[0];if(!a){const n=e.activator.getOpponentPlayer().getMonstersOnField().filter(o=>o.face==="FaceUp").filter(o=>o.canBeTargetOfEffect(e)),l=await e.activator.waitSelectEntity(n,"ÂäπÊûúÂØæË±°„ÇíÈÅ∏Êäû„ÄÇ",i);if(!l)return;a=l}return{selectedEntities:[a],chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.selectedEntities.filter(i=>i.isOnFieldAsMonsterStrictly).filter(i=>i.face==="FaceUp").find(i=>i.canBeEffected(e.activator,e.action.entity,e.action));return t?(["attack","defense"].map(i=>Z.createLingeringFixation("‚ë°ÊîªÂÆàÂçäÊ∏õ",()=>!0,e.action.entity,e.action,i,(a,r,n)=>Math.round(n/2))).forEach(i=>t.numericOprsBundle.push(i)),!0):!1},settle:async()=>!0}]}}const fi=Object.freeze(Object.defineProperty({__proto__:null,default:zr},Symbol.toStringTag,{value:"Module"}));function*Qr(){yield{name:"Ê∞¥Êô∂Ê©üÂ∑ßÔºç„Éè„É™„Éï„Ç°„Ç§„Éê„Éº",actions:[C,it(e=>e.length===2&&e.some(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Tuner")})),{title:"‚ë†„É™„ÇØ„É´„Éº„Éà",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:H,executablePeriods:[...D,...F],executableDuelistTypes:["Controller"],validate:e=>{if(!e.action.entity.hasBeenSummonedNow(["LinkSummon"]))return;const t=[e.activator.getHandCell(),e.activator.getDeckCell()].flatMap(r=>r.cardEntities).filter(r=>(r.lvl??12)<4).filter(r=>{var n;return(n=r.status.monsterCategories)==null?void 0:n.includes("Tuner")}),i=e.activator.getMonsterZones();return e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,t.map(r=>({monster:r,cells:i,posList:["Defense"]})),[],!1).length?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async e=>{const t=[e.activator.getHandCell(),e.activator.getDeckCell()].flatMap(r=>r.cardEntities).filter(r=>(r.lvl??12)<4).filter(r=>{var n;return(n=r.status.monsterCategories)==null?void 0:n.includes("Tuner")}),i=e.activator.getMonsterZones(),a=await e.activator.summonOne(e.activator,"SpecialSummon",["Effect"],e.action,t.map(r=>({monster:r,cells:i,posList:["Defense"]})),[],!1,!1);if(!a)throw new q(e);return a.statusOperatorBundle.push(new Q("ÂäπÊûúÁô∫Âãï‰∏çÂèØ",r=>r.effectOwner.duel.clock.isSameTurn(r.isSpawnedAt),!1,e.action.entity,e.action,()=>!0,()=>({canActivateEffect:!1}))),!0},settle:async()=>!0},{title:"‚ë°„Ç∑„É≥„ÇØ„É≠Âè¨Âñö",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:H,executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerChain:1,canPayCosts:Te,validate:e=>{if(e.activator.isTurnPlayer)return;const t=[...e.activator.getMonsterZones(),...e.activator.duel.field.getCells("ExtraMonsterZone")],i=e.activator.getExtraDeck().cardEntities.filter(r=>{var n;return(n=r.status.monsterCategories)==null?void 0:n.includes("Syncro")}).filter(r=>{var n;return(n=r.status.monsterCategories)==null?void 0:n.includes("Tuner")});return e.activator.getEnableSummonList(e.activator,"SyncroSummon",["SpecialSummon","Effect"],e.action,i.map(r=>({monster:r,cells:t,posList:_})),[{material:e.action.entity,cell:e.action.entity.fieldCell}],!1).length?[]:void 0},payCosts:Ne,prepare:R,execute:async e=>{const t=[...e.activator.getMonsterZones(),...e.activator.duel.field.getCells("ExtraMonsterZone")],i=e.activator.getExtraDeck().cardEntities.filter(r=>{var n;return(n=r.status.monsterCategories)==null?void 0:n.includes("Syncro")}).filter(r=>{var n;return(n=r.status.monsterCategories)==null?void 0:n.includes("Tuner")});return!!await e.activator.summonOne(e.activator,"SyncroSummon",["SpecialSummon","Effect"],e.action,i.map(r=>({monster:r,cells:t,posList:_})),[],!1,!1)},settle:async()=>!0}]}}const hi=Object.freeze(Object.defineProperty({__proto__:null,default:Qr},Symbol.toStringTag,{value:"Module"}));function*Wr(){yield{name:"Â∞ÅÂç∞„Åï„Çå„Åó„Ç®„ÇØ„Çæ„Éá„Ç£„Ç¢",actions:[C,T,x,E,{title:"Â∞ÅÂç∞ÈñãÊîæ",isMandatory:!0,playType:"Exodia",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:z,executableDuelistTypes:["Controller"],validate:e=>{const t=e.activator.getHandCell().cardEntities.filter(i=>{var a;return(a=i.origin.nameTags)==null?void 0:a.includes("Â∞ÅÂç∞„Åï„Çå„Åó")}).map(i=>i.origin.name).getDistinct();return console.log(e.action.entity.toString(),t),t.length===5?[]:void 0},prepare:async e=>(await v.sendManyToGraveyardForTheSameReason(e.activator.duel.field.getCardsOnFieldStrictly(),["Rule"],e.action.entity,e.activator),{selectedEntities:[],chainBlockTags:[],prepared:void 0,nextChainBlockFilter:()=>!1}),execute:async e=>{const t=e.activator.getOpponentPlayer().getHandCell().cardEntities.filter(a=>{var r;return(r=a.origin.nameTags)==null?void 0:r.includes("Â∞ÅÂç∞„Åï„Çå„Åó")}).map(a=>a.origin.name).getDistinct().length===5,i=[{name:"Â∞ÅÂç∞„Åï„Çå„ÅóËÄÖ„ÅÆÂ∑¶Ë∂≥",column:4},{name:"Â∞ÅÂç∞„Åï„Çå„ÅóËÄÖ„ÅÆÂè≥Ë∂≥",column:2},{name:"Â∞ÅÂç∞„Åï„Çå„ÅóËÄÖ„ÅÆÂ∑¶ËÖï",column:5},{name:"Â∞ÅÂç∞„Åï„Çå„ÅóËÄÖ„ÅÆÂè≥ËÖï",column:1},{name:"Â∞ÅÂç∞„Åï„Çå„Åó„Ç®„ÇØ„Çæ„Éá„Ç£„Ç¢",column:3}];for(const a of i){const r=[e.activator.getHandCell().cardEntities.find(n=>n.origin.name===a.name),e.activator.getOpponentPlayer().getHandCell().cardEntities.find(n=>n.origin.name===a.name)].filter(n=>n!==void 0);if(!r.length)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",e.activator.getHandCell().cardEntities,a.name);await b.moveMany(r.map(n=>[n,n.controller.getMonsterZones().find(l=>l.column===(n.controller.seat==="Above"?6-a.column:a.column))??n.controller.getFieldZone(),"Monster","FaceUp","Vertical","Top",["Rule"],void 0,void 0,void 0]))}throw t?new $(void 0,`„Åä‰∫í„ÅÑ„Åå„ÄÅ${e.action.entity.toString()}„ÅÆÁâπÊÆäÂãùÂà©Êù°‰ª∂„ÇíÂêåÊôÇ„Å´Ê∫Ä„Åü„Åó„Åü„ÄÇ`):new $(e.activator,`${e.action.entity.toString()}„ÅÆÁâπÊÆäÂãùÂà©Êù°‰ª∂„ÇíÊ∫Ä„Åü„Åó„Åü„ÄÇ`)},settle:async()=>!0}]}}const gi=Object.freeze(Object.defineProperty({__proto__:null,default:Wr},Symbol.toStringTag,{value:"Module"}));function*Xr(){yield{name:"„Éï„Ç°„Ç§„Ç¢„Ç¶„Ç©„Éº„É´„Éª„Éâ„É©„Ç¥„É≥„Éª„Ç∑„É≥„ÇÆ„É•„É©„É™„ÉÜ„Ç£",actions:[C,it(e=>e.length>2),{title:"‚ë†„Éê„Ç¶„É≥„ÇπÔºÜËá™Â∑±Âº∑Âåñ",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:H,executablePeriods:[...D,...F],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>[...e.activator.getGraveyard().cardEntities,...e.activator.getMonstersOnField()].flatMap(r=>r.status.monsterCategories??[]).getDistinct().union(["Ritual","Fusion","Syncro","Xyz"]).length<1?void 0:[...e.activator.getOpponentPlayer().getGraveyard().cardEntities,...e.activator.getOpponentPlayer().getEntiteisOnField()].filter(r=>r.canBeTargetOfEffect(e)).length?[]:void 0,prepare:async(e,t,i)=>{const r=[...e.activator.getGraveyard().cardEntities,...e.activator.getMonstersOnField()].flatMap(o=>o.status.monsterCategories??[]).getDistinct().union(["Ritual","Fusion","Syncro","Xyz"]).length;if(r<1)return;const n=[...e.activator.getOpponentPlayer().getGraveyard().cardEntities,...e.activator.getOpponentPlayer().getEntiteisOnField()].filter(o=>o.canBeTargetOfEffect(e));if(n.length<1)return;const l=await e.activator.waitSelectEntities(n,void 0,o=>o.length>0&&o.length<=r,"ÊâãÊú≠„Å´Êàª„Åô„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû„ÄÇ",i);if(l)return{selectedEntities:l,chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.selectedEntities.filter(a=>a.isOnFieldStrictly||a.fieldCell.cellType==="Graveyard").filter(a=>a.canBeEffected(e.activator,e.action.entity,e.action));await v.returnManyToHandForTheSameReason(t,["Effect"],e.action.entity,e.activator);const i=t.filter(a=>a.fieldCell.cellType==="Hand"||a.fieldCell.cellType==="ExtraDeck").length;return e.action.entity.numericOprsBundle.push(Z.createLingeringAddition(e.action.title,a=>a.isSpawnedBy.isEffective,e.action.entity,e.action,"attack",(a,r,n)=>n+500*i)),!0},settle:async()=>!0},{title:"‚ë°ËòáÁîü",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:H,executablePeriods:z,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>{const t=e.action.entity.moveLog.latestRecord.movedAt,i=e.action.duel.field.moveLog.getPriviousChainLog().filter(n=>(console.log(n,n.entity.fieldCell.cellType==="Graveyard",n.movedAs.includes("BattleDestroy")),n.entity.fieldCell.cellType==="Graveyard"||n.movedAs.includes("BattleDestroy"))).filter(n=>n.movedAt.totalProcSeq>t.totalProcSeq).map(n=>n.entity.wasMovedFrom).toArray();if(!e.action.entity.linkArrowDests.union(i).length)return;const a=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getGraveyard().cardEntities.filter(n=>n.kind==="Monster").filter(n=>n.types.includes("Cyberse")).filter(n=>n.canBeTargetOfEffect(e)).map(n=>({monster:n,posList:_,cells:a})),[],!1).length)return k(e)},prepare:e=>re(e,e.activator.getGraveyard().cardEntities.filter(t=>t.kind==="Monster").filter(t=>t.types.includes("Cyberse")).filter(t=>t.canBeTargetOfEffect(e)),_),execute:e=>ne(e,_),settle:async()=>!0}]}}const yi=Object.freeze(Object.defineProperty({__proto__:null,default:Xr},Symbol.toStringTag,{value:"Module"}));function*Kr(){for(const e of[{name:"Á∞°ÊòìËûçÂêà",lvlUpperBound:5,filter:()=>!0},{name:"Á∞°Á¥†ËûçÂêà",lvlUpperBound:6,filter:t=>{var i;return!((i=t.status.monsterCategories)!=null&&i.includes("Effect"))}}])yield{name:e.name,actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,canPayCosts:t=>t.activator.lp>=1e3,validate:t=>{const i=t.activator.getMonsterZones();if(t.activator.getEnableSummonList(t.activator,"SpecialSummon",["Effect"],t.action,t.activator.getExtraDeck().cardEntities.filter(r=>{var n;return(n=r.status.monsterCategories)==null?void 0:n.includes("Fusion")}).filter(r=>r.lvl&&r.lvl<=e.lvlUpperBound).filter(e.filter).map(r=>({monster:r,posList:_,cells:i})),[],!1).length)return k(t)},payCosts:(t,i)=>Ce(t,i,1e3),prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromExtraDeck"],prepared:void 0}),execute:async t=>{const i=t.activator.getMonsterZones();if(!t.activator.getEnableSummonList(t.activator,"FusionSummon",["Effect"],t.action,t.activator.getExtraDeck().cardEntities.filter(n=>{var l;return(l=n.status.monsterCategories)==null?void 0:l.includes("Fusion")}).filter(n=>n.lvl&&n.lvl<=e.lvlUpperBound).filter(e.filter).map(n=>({monster:n,posList:_,cells:i})),[],!1).length)return!1;const r=await t.activator.summonOne(t.activator,"FusionSummon",["Effect"],t.action,t.activator.getExtraDeck().cardEntities.filter(n=>{var l;return(l=n.status.monsterCategories)==null?void 0:l.includes("Fusion")}).filter(n=>n.lvl&&n.lvl<=e.lvlUpperBound).filter(e.filter).map(n=>({monster:n,posList:_,cells:i})),[],!1,!1);return r?(r.statusOperatorBundle.push(new Q("ÊîªÊíÉ‰∏çÂèØ",()=>!0,!1,t.action.entity,t.action,(n,l)=>l.face==="FaceUp"&&l.isOnFieldAsMonsterStrictly,(n,l)=>({...l,canAttack:!1}))),r.counterHolder.setSelfDestructionFlg(t.action.entity),!0):!1},settle:async()=>!0},S,{title:"Ëá™Â£ä",isMandatory:!0,playType:"LingeringEffect",spellSpeed:"Normal",executableCells:K,executablePeriods:["end"],executableDuelistTypes:Se,validate:t=>t.action.entity.field.getMonstersOnFieldStrictly().filter(i=>i.counterHolder.getSelfDestructionFlg(t.action.entity)).length?[]:void 0,prepare:R,execute:async t=>{const i=t.action.entity.field.getMonstersOnFieldStrictly().filter(r=>r.counterHolder.getSelfDestructionFlg(t.action.entity));if(!i.length)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",t);let a=i[0];if(i.length>1){const r=await t.activator.waitSelectEntity(i,"Ëá™Â£ä„Åï„Åõ„Çã„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû„ÄÇ",!1);if(!r)throw new q(t);a=r}return await v.tryDestroy([a],t),!0},settle:async()=>!0}]}}const vi=Object.freeze(Object.defineProperty({__proto__:null,default:Kr},Symbol.toStringTag,{value:"Module"}));function*Jr(){yield*["„Ç§„Ç∞„Éä„Ç§„Éà„Éª„Ç§„Éº„Ç∞„É´","„Ç§„Ç∞„Éä„Ç§„Éà„Éª„Éû„Ç∞„Éä„É†","„Ç§„Ç∞„Éä„Ç§„Éà„Éª„Éâ„É©„Ç∞„Éé„Éï","„Ç§„Ç∞„Éä„Ç§„Éà„Éª„Éû„Çπ„Ç±„ÉÉ„Éà","„Ç§„Ç∞„Éä„Ç§„Éà„Éª„Éá„É™„É≥„Ç∏„É£„Éº","„Ç§„Ç∞„Éä„Ç§„Éà„Éª„É©„Ç§„Ç™„ÉÉ„Éà","„Ç§„Ç∞„Éä„Ç§„Éà„Éª„Ç¶„Éº„Ç∏„Éº","„Ç§„Ç∞„Éä„Ç§„Éà„Éª„Ç≠„É£„É™„Éê„Éº"].map(e=>({name:e,actions:[C,T,E,x,se,{title:"‚ë†„Çµ„Éº„ÉÅ",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:t=>{var a;const i=t.activator.getPendulumScaleMonsters().find(r=>r!==t.action.entity);if(i&&(a=i.status.nameTags)!=null&&a.includes("„Ç§„Ç∞„Éä„Ç§„Éà"))return t.activator.getDeckCell().cardEntities.some(r=>{var n;return(n=r.status.nameTags)==null?void 0:n.includes("„Ç§„Ç∞„Éä„Ç§„Éà")})?[]:void 0},prepare:async t=>({selectedEntities:[],chainBlockTags:["SearchFromDeck",...t.action.calcChainBlockTagsForDestroy(t.activator,t.activator.getPendulumScaleMonsters())],prepared:void 0}),execute:async t=>{if(!(await v.tryDestroy(t.activator.getPendulumScaleMonsters(),t)).length)return!1;const a=t.activator.getDeckCell().cardEntities.filter(n=>{var l;return(l=n.status.nameTags)==null?void 0:l.includes("„Ç§„Ç∞„Éä„Ç§„Éà")});if(!a.length)return!1;const r=await t.activator.waitSelectEntity(a,"ÊâãÊú≠„Å´Âä†„Åà„Çã„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû„ÄÇ",!1);return r?(await r.addToHand(["Effect"],t.action.entity,t.activator),!0):!1},settle:async()=>!0}]}))}const mi=Object.freeze(Object.defineProperty({__proto__:null,default:Jr},Symbol.toStringTag,{value:"Module"}));function*Yr(){yield{name:"„Ç∏„É£„É≥„ÇØ„Éª„Ç≥„É¨„ÇØ„Çø„Éº",actions:[C,T,E,x,{title:"ÁΩ†„Ç≥„Éî„Éº",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:H,executablePeriods:D,executableDuelistTypes:["Controller"],canPayCosts:e=>e.activator.getGraveyard().cardEntities.filter(i=>i.kind==="Trap").filter(i=>i.status.trapCategory==="Normal").filter(i=>e.activator.canTryBanish(i,"BanishAsCost",e.action)).filter(i=>i.canBeBanished("BanishAsCost",e.activator,e.action.entity,e.action)).flatMap(i=>i.actions).filter(i=>i.playType==="CardActivation").filter(i=>!i.needsToPayCost).filter(i=>i.validate(e.activator,[],!0)).length?Te(e):!1,validate:()=>[],payCosts:async(e,t,i)=>{const a=e.activator.getGraveyard().cardEntities.filter(l=>l.kind==="Trap").filter(l=>l.status.trapCategory==="Normal").filter(l=>e.activator.canTryBanish(l,"BanishAsCost",e.action)).filter(l=>l.canBeBanished("BanishAsCost",e.activator,e.action.entity,e.action)).flatMap(l=>l.actions).filter(l=>l.playType==="CardActivation").filter(l=>!l.needsToPayCost).filter(l=>l.validate(e.activator,[],!0)).map(l=>l.entity),r=await e.activator.waitSelectEntity(a,"„Ç≥„Éî„Éº„Åô„ÇãÁΩ†„ÇíÈÅ∏Êäû„ÄÇ",i);if(!r)return;const n=[e.action.entity,r];return await v.banishManyForTheSameReason(n,["Cost"],e.action.entity,e.activator),{banish:n}},prepare:async(e,t)=>{var r;const i=(r=e.costInfo.banish)==null?void 0:r.find(n=>n!==e.action.entity);if(!i)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂Ê≥Å",e,e.costInfo);const a=i.actions.find(n=>n.playType==="CardActivation");if(!a)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂Ê≥Å",e,e.costInfo,i);return await a.prepare(e.activator,void 0,void 0,t,!1,!0)},execute:async(e,t)=>{var r;const i=(r=e.costInfo.banish)==null?void 0:r.find(n=>n!==e.action.entity);if(!i)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂Ê≥Å",e,e.costInfo);const a=i.actions.find(n=>n.playType==="CardActivation");if(!a)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂Ê≥Å",e,e.costInfo,i);return await a.execute(e,t)},settle:async()=>!0}]}}const Si=Object.freeze(Object.defineProperty({__proto__:null,default:Yr},Symbol.toStringTag,{value:"Module"}));function*Ir(){yield{name:"„ÉÄ„Éº„ÇØ„Éª„É™„Çæ„Éç„Éº„Çø„Éº",actions:[C,T,E,x],substituteEffects:[hr(1)]},yield{name:"„É¨„ÉÉ„Éâ„Éª„É™„Çæ„Éç„Éº„Çø„Éº",actions:[C,T,E,x,{title:"‚ë†ÁâπÊÆäÂè¨Âñö",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...D,...F],executableDuelistTypes:["Controller"],validate:e=>{if(!e.action.entity.hasBeenSummonedNow(["NormalSummon"]))return;const t=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getHandCell().cardEntities.filter(a=>a.kind==="Monster").filter(a=>(a.lvl??12)<5).map(a=>({monster:a,posList:_,cells:t})),[],!1).length)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromHand"],prepared:void 0}),execute:async e=>{const t=e.activator.getMonsterZones(),i=e.activator.getHandCell().cardEntities.filter(r=>r.kind==="Monster").filter(r=>(r.lvl??12)<5).map(r=>({monster:r,posList:_,cells:t}));return!!await e.activator.summonOne(e.activator,"SpecialSummon",["Effect"],e.action,i,[],!1,!1)},settle:async()=>!0},{title:"‚ë°ÂõûÂæ©",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...D,...F],executableDuelistTypes:["Controller"],hasToTargetCards:!0,isOnlyNTimesPerTurn:1,validate:e=>{if(e.action.entity.hasBeenSummonedNow(["SpecialSummon"]))return e.activator.getMonstersOnField().filter(t=>t.canBeTargetOfEffect(e)).filter(t=>(t.atk??0)>0).some(t=>t.info.summonKinds.includes("SpecialSummon"))?[]:void 0},prepare:async e=>{const t=await e.activator.waitSelectEntity(e.activator.getMonstersOnField().filter(i=>i.canBeTargetOfEffect(e)).filter(i=>(i.atk??0)>0).filter(i=>i.info.summonKinds.includes("SpecialSummon")),"ÂØæË±°„Å®„Åô„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",!1);if(t)return{selectedEntities:[t],chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.activator.lp;return e.selectedEntities.filter(i=>i.isOnFieldAsMonsterStrictly).forEach(i=>e.activator.heal(i.atk??0,e.action.entity)),e.activator.lp!==t},settle:async()=>!0}]}}const Ci=Object.freeze(Object.defineProperty({__proto__:null,default:Ir},Symbol.toStringTag,{value:"Module"})),ht=(e,t)=>{const i=t?`È≠îÂäõÂÖÖÂ°´ÂèØËÉΩ(${t})`:"È≠îÂäõÂÖÖÂ°´ÂèØËÉΩ";return Je(i,e,a=>[a],a=>[new Q(i,()=>!0,!0,a,{},(r,n)=>r.isSpawnedBy===n,(r,n)=>(n.maxCounterQty.SpellCounter=t??Number.MAX_VALUE,{...n,maxCounterQty:n.maxCounterQty}))])},$e={},en=(e,t=1)=>($e[t]||($e[t]={title:`È≠îÂäõÂõûÂèé(${t})`,isMandatory:!0,playType:"AfterChainBlock",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:z,executableDuelistTypes:["Controller"],validate:i=>{if(!i.targetChainBlock||i.targetChainBlock.action.playType!=="CardActivation"||i.targetChainBlock.action.entity.kind!=="Spell"||!i.action.entity.isEffective||i.action.entity.face==="FaceDown")return;const a=i.action.entity.status.maxCounterQty.SpellCounter??0;if(!(i.action.entity.counterHolder.getQty("SpellCounter")>=a)&&!(i.action.entity.hadArrivedToFieldAt().totalProcSeq>i.targetChainBlock.isActivatedAt.totalProcSeq))return[]},prepare:R,execute:async i=>i.action.entity.face==="FaceDown"||!i.action.entity.isOnFieldAsMonsterStrictly||!i.action.entity.isEffective?!1:(i.action.entity.counterHolder.add("SpellCounter",t,i.action.entity),!0),settle:async()=>!0}),{...$e[t],title:`${e}È≠îÂäõÂõûÂèé(${t})`}),ze=(e,t,i)=>e.action.entity.counterHolder.getQty("SpellCounter")>=i,Qe=(e,t,i,a)=>{const r=a[0];return e.action.entity.counterHolder.remove("SpellCounter",r),{counter:r}};function*tn(){yield{name:"È≠îÂ∞éÊà¶Â£´ „Éñ„É¨„Ç§„Ç´„Éº",actions:[C,T,E,x,{title:"‚ë†È≠îÂäõÂÖÖÂ°´",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.hasBeenSummonedNow(["NormalSummon"]))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["IfNormarlSummonSucceed"],prepared:void 0}),execute:async e=>e.action.entity.face==="FaceDown"?!1:(e.action.entity.counterHolder.setQty("SpellCounter",1,e.action.entity),!0),settle:async()=>!0},{title:"‚ë¢„Éû„Éä„Éñ„É¨„Ç§„ÇØ",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,canPayCosts:(e,t)=>ze(e,t,1),validate:e=>{const t=e.action.entity.field.getCells(...ie).flatMap(i=>i.cardEntities).filter(i=>i.canBeTargetOfEffect(e));if(t.length)return t.map(i=>i.fieldCell)},payCosts:async(e,t,i)=>Qe(e,t,i,[1]),prepare:async(e,t,i)=>{var r;let a=(r=e.dest)==null?void 0:r.cardEntities[0];if(!a){const n=e.action.entity.field.getCells(...ie).flatMap(o=>o.cardEntities).filter(o=>o.canBeTargetOfEffect(e)),l=await e.activator.waitSelectEntity(n,"Á†¥Â£ä„Åô„ÇãÂØæË±°„ÇíÈÅ∏Êäû„ÄÇ",i);if(!l)return;a=l}return{selectedEntities:[a],chainBlockTags:e.action.calcChainBlockTagsForDestroy(e.activator,[a]),prepared:void 0}},execute:async e=>e.selectedEntities.every(t=>!t.isOnFieldAsSpellTrapStrictly)?!1:(await v.tryDestroy(e.selectedEntities,e),!0),settle:async()=>!0}],continuousEffects:[ht("Monster",1),me("‚ë°ÊîªÊíÉÂäõ‰∏äÊòá","Monster",e=>[e],e=>[Z.createContinuous("‚ë°ÊîªÊíÉÂäõ‰∏äÊòá",()=>!0,e,()=>!0,"attack","wip","Addition",(t,i,a)=>t.isEffective?a+t.counterHolder.getQty("SpellCounter")*300:a)])]},yield{name:"ÁéãÁ´ãÈ≠îÊ≥ïÂõ≥Êõ∏È§®",actions:[C,T,E,x,{...en("‚ë†",1)},{title:"‚ë°„Éâ„É≠„Éº",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],canPayCosts:(e,t)=>ze(e,t,3),validate:e=>{if(e.activator.getDeckCell().cardEntities.length)return[]},payCosts:async(e,t,i)=>Qe(e,t,i,[3]),prepare:R,execute:async e=>(await e.activator.draw(1,e.action.entity,e.activator),!0),settle:async()=>!0}],continuousEffects:[ht("Monster",3)]}}const Ti=Object.freeze(Object.defineProperty({__proto__:null,canPaySpellCounters:ze,default:tn,paySpellCounters:Qe},Symbol.toStringTag,{value:"Module"}));function*an(){yield{name:"„Çπ„Çø„Éº„ÉÄ„Çπ„Éà„Éª„Éâ„É©„Ç¥„É≥",actions:[C,T,E,V(),{title:"‚ë†„É¥„Ç£„ÇØ„ÉÜ„É†„Éª„Çµ„É≥„ÇØ„ÉÅ„É•„Ç¢„É™",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:z,executableDuelistTypes:["Controller"],canPayCosts:et,validate:(e,t)=>t.length===0?void 0:t[e.index-1].chainBlockTags.includes("DestroyOnField")?[]:void 0,payCosts:tt,prepare:async(e,t)=>{const i=t.slice(-1)[0];return{selectedEntities:[],chainBlockTags:e.action.calcChainBlockTagsForDestroy(e.activator,[i.action.entity]),prepared:void 0}},execute:async(e,t)=>{const i=t[e.index-1];return i.isNegatedActivationBy=e.action,await v.tryDestroy([i.action.entity],e),!0},settle:async()=>!0},{title:"‚ë°Ëá™Â∑±ÂÜçÁîü",playType:"IgnitionEffect",isMandatory:!1,spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["end"],executableDuelistTypes:["Controller"],validate:e=>{const t=e.action.entity.moveLog.latestRecord;if(t.movedBy!==e.action.entity||!e.activator.duel.clock.isSameTurn(t.movedAt)||!t.movedAs.includes("Cost"))return;const i=e.activator.duel,a=e.action.entity.actionLogRecords.filter(n=>i.clock.isSameTurn(n.clock)).map(n=>n.chainBlockInfo).findLast(n=>n.action.title==="‚ë†„É¥„Ç£„ÇØ„ÉÜ„É†„Éª„Çµ„É≥„ÇØ„ÉÅ„É•„Ç¢„É™");return!a||a.state!=="done"?void 0:e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:R,execute:e=>te(e),settle:async()=>!0}]},yield{name:"ÈñÉÁèñÁ´ú „Çπ„Çø„Éº„ÉÄ„Çπ„Éà",actions:[C,T,V(),{title:"Ê≥¢ÂãïÈü≥Â£Å",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:H,executablePeriods:D,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,hasToTargetCards:!0,validate:e=>{const t=e.activator.getEntiteisOnField().filter(i=>i.face==="FaceUp").filter(i=>i.canBeTargetOfEffect(e));if(t.length)return t.map(i=>i.fieldCell)},prepare:async(e,t,i)=>{if(e.dest)return{selectedEntities:e.dest.cardEntities,chainBlockTags:[],prepared:void 0};const a=e.activator.getEntiteisOnField().filter(n=>n.face==="FaceUp").filter(n=>n.canBeTargetOfEffect(e));if(!a.length)return;const r=await e.activator.waitSelectEntity(a,"ÂØæË±°„Å®„Åô„Çã„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû",i);if(r)return{selectedEntities:[r],chainBlockTags:[],prepared:void 0}},execute:async e=>(e.selectedEntities.filter(t=>t.isOnFieldStrictly).filter(t=>t.face==="FaceUp").filter(t=>t.canBeEffected(e.activator,e.action.entity,e.action)).forEach(t=>{t.counterHolder.add("SonicBarrier",1,e.action.entity)}),!0),settle:async()=>!0}],substituteEffects:[{title:"Ê≥¢ÂãïÈü≥Â£ÅÔºàÈÅ©Áî®Ôºâ",isMandatory:!0,executableCells:K,executablePeriods:z,executableDuelistTypes:["Controller"],isApplicableTo:(e,t,i)=>i.filter(a=>a.counterHolder.getQty("SonicBarrier",e.entity)>0),substitute:async(e,t,i)=>{const a=i.filter(r=>r.counterHolder.getQty("SonicBarrier",e.entity)>0);return a.forEach(r=>{r.counterHolder.removeAll("SonicBarrier",e.entity),e.entity.controller.writeInfoLog(`Ê≥¢ÂãïÈü≥Â£Å„Å´„Çà„Çä${r.toString()}„ÅØÔºë„Çø„Éº„É≥„Å´ÔºëÂ∫¶„Å†„ÅëÊà¶ÈóòÂäπÊûú„Åß„ÅØÁ†¥Â£ä„Åï„Çå„Å™„ÅÑ„ÄÇ`)}),a}}]},yield{name:"ÁúüÈñÉÁèñÁ´ú „Çπ„Çø„Éº„ÉÄ„Çπ„Éà„Éª„ÇØ„É≠„Éã„ÇØ„É´",actions:[C,T,V(e=>e.length===1&&e.every(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")}),e=>e.length>0&&e.every(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")})),{title:"Ê≥¢ÂãïË≠∑È≠Ç",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:H,executablePeriods:D,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,canPayCosts:e=>za(e,e.activator.getGraveyard().cardEntities.filter(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")})),validate:()=>[],payCosts:e=>Qa(e,e.activator.getGraveyard().cardEntities.filter(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")}),t=>t.length===1,1),prepare:R,execute:async e=>(e.action.entity.procFilterBundle.push(he.createLingering(e.action.title,t=>t.effectOwner.duel.clock.isSameTurn(t.isSpawnedAt),e.action.entity,e.action,()=>!0,["Effect"],()=>!1)),!0),settle:async()=>!0},{title:"‚ë°ËòáÁîü",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Banished"],executablePeriods:[...D,...F],executableDuelistTypes:["Controller"],validate:e=>{if(!e.action.entity.wasMovedAtPreviousChain)return;const t=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getBanished().cardEntities.filter(a=>a.kind==="Monster").filter(a=>a.face==="FaceUp").filter(a=>a.types.includes("Dragon")).filter(a=>{var r;return(r=a.status.monsterCategories)==null?void 0:r.includes("Syncro")}).filter(a=>a.canBeTargetOfEffect(e)).map(a=>({monster:a,posList:_,cells:t})),[],!1).length)return[]},prepare:e=>re(e,e.activator.getBanished().cardEntities.filter(t=>t.kind==="Monster").filter(t=>t.face==="FaceUp").filter(t=>t.types.includes("Dragon")).filter(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")}).filter(t=>t.canBeTargetOfEffect(e))),execute:async e=>ne(e),settle:async()=>!0}]},yield{name:"ËÅñÁèñÁ•ûÁ´ú „Çπ„Çø„Éº„ÉÄ„Çπ„Éà„Éª„Ç∑„Éï„É´",actions:[C,T,V(e=>e.length===1&&e.every(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")}),e=>e.length>1&&e.every(t=>{var i;return(i=t.status.monsterCategories)==null?void 0:i.includes("Syncro")})),{title:"‚ë°ÁèñÊ≥¢ÂãïÂèçÊíÉ",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:["Hand"],executablePeriods:D,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,negatePreviousBlock:!0,validate:e=>{if(e.targetChainBlock&&e.activator!==e.targetChainBlock.activator&&e.targetChainBlock.action.entity.kind==="Monster"&&e.targetChainBlock.action.isWithChainBlock)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["NegateCardEffect","DestroyOnField"],prepared:void 0}),execute:async e=>{if(!e.targetChainBlock)return!1;const t=e.targetChainBlock;t.isNegatedEffectBy=e.action;const i=await e.activator.waitSelectEntity(e.action.duel.field.getCardsOnFieldStrictly(),"Á†¥Â£ä„Åô„Çã„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû„ÄÇ",!1);return(await v.tryDestroy(i?[i]:[],e)).length>0},settle:async()=>!0},{title:"‚ë¢ËòáÁîü",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:10,canPayCosts:Te,validate:e=>e.activator.getBanished().cardEntities.filter(i=>{var a;return(a=i.status.nameTags)==null?void 0:a.includes("„Çπ„Çø„Éº„ÉÄ„Çπ„Éà")}).filter(i=>(i.lvl??12)<9).length===0?void 0:e.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:Ne,prepare:e=>re(e,e.activator.getBanished().cardEntities.filter(t=>{var i;return(i=t.status.nameTags)==null?void 0:i.includes("„Çπ„Çø„Éº„ÉÄ„Çπ„Éà")}).filter(t=>(t.lvl??12)<9),_,t=>t.length===1),execute:e=>ne(e,_),settle:async()=>!0}],substituteEffects:[{title:"Ê≥¢ÂãïËÅñÂè•",isMandatory:!0,executableCells:["MonsterZone"],executablePeriods:z,executableDuelistTypes:["Controller"],isApplicableTo:(e,t,i)=>i.filter(a=>a.controller===e.entity.controller).filter(a=>a.counterHolder.getQty("SonicVerse",e.entity)===0),substitute:async(e,t,i)=>{if(!e.entity.isEffective)return[];const a=i.filter(r=>r.controller===e.entity.controller).filter(r=>r.counterHolder.getQty("SonicVerse",e.entity)===0);return a.forEach(r=>{r.counterHolder.add("SonicVerse",1,e.entity),e.entity.controller.writeInfoLog(`${e.entity.toString()}„ÅÆÂäπÊûú„Å´„Çà„Çä${r.toString()}„ÅØÔºë„Çø„Éº„É≥„Å´ÔºëÂ∫¶„Å†„ÅëÁ†¥Â£ä„Åï„Çå„Å™„ÅÑ„ÄÇ`)}),a}}]}}const ki=Object.freeze(Object.defineProperty({__proto__:null,default:an},Symbol.toStringTag,{value:"Module"}));function*rn(){yield{name:"„Éï„Ç©„Éº„Éü„É•„É©„Éª„Ç∑„É≥„ÇØ„É≠„É≥",actions:[C,T,E,V(),{title:"‚ë†„Éâ„É≠„Éº",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:H,executablePeriods:[...D,...F],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.hasBeenSummonedJustNow(["SyncroSummon"])&&e.activator.getDeckCell().cardEntities.length)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(1,e.action.entity,e.activator),!0),settle:async()=>!0},Wt({title:"‚ë°„Ç∑„É≥„ÇØ„É≠Âè¨Âñö",isOnlyNTimesPerChain:1})]}}const Ei=Object.freeze(Object.defineProperty({__proto__:null,default:rn},Symbol.toStringTag,{value:"Module"}));function*nn(){yield{name:"Ë™øÂæã",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:e=>{const t=e.activator.getDeckCell().cardEntities;if(!(t.length<2)&&t.filter(i=>{var a;return(a=i.status.nameTags)==null?void 0:a.includes("„Ç∑„É≥„ÇØ„É≠„É≥")}).filter(i=>{var a;return(a=i.status.monsterCategories)==null?void 0:a.includes("Tuner")}).length!==0)return k(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck","SendToGraveyardFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities;if(t.length<2)return!1;const i=t.filter(r=>{var n;return(n=r.status.nameTags)==null?void 0:n.includes("„Ç∑„É≥„ÇØ„É≠„É≥")}).filter(r=>{var n;return(n=r.status.monsterCategories)==null?void 0:n.includes("Tuner")});if(i.length===0)return!1;const a=await e.activator.waitSelectEntity(i,"ÊâãÊú≠„Å´Âä†„Åà„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",!1);if(!a)throw new q(e);return await a.addToHand(["Effect"],e.action.entity,e.activator),e.activator.getDeckCell().shuffle(),e.activator.duel.clock.incrementProcSeq(),await e.activator.getDeckCell().cardEntities[0].sendToGraveyard(["Effect"],e.action.entity,e.activator),!0},settle:async()=>!0},S]}}const wi=Object.freeze(Object.defineProperty({__proto__:null,default:nn},Symbol.toStringTag,{value:"Module"}));function*sn(){yield{name:"„Éà„Ç•„Éº„É≥„Éª„ÉØ„Éº„É´„Éâ",actions:[{...se,canPayCosts:e=>e.activator.lp>=1e3,payCosts:(e,t)=>Ce(e,t,1e3)},S]}}const _i=Object.freeze(Object.defineProperty({__proto__:null,default:sn},Symbol.toStringTag,{value:"Module"}));function*ln(){yield{name:"ÁÑ°„ÅÆÁÖâÁçÑ",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(e.activator.getDeckCell().cardEntities.length&&!(e.activator.getHandCell().cardEntities.length<3)&&e.activator.status.canDiscardAsEffect)return k(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw","DiscordAsEffect"],prepared:void 0}),execute:async e=>(await e.activator.draw(1,e.action.entity,e.activator),e.activator.entity.counterHolder.add("IntoTheVoid",1,e.action.entity),!0),settle:async()=>!0},{title:"ÊâãÊú≠ÊäπÊÆ∫",isMandatory:!0,playType:"LingeringEffect",spellSpeed:"Normal",executableCells:K,executablePeriods:["end"],executableDuelistTypes:Se,validate:e=>e.activator.entity.counterHolder.getQty("IntoTheVoid",e.action.entity)?[]:void 0,prepare:R,execute:async e=>(await v.discardManyForTheSameReason(e.activator.getHandCell().cardEntities,["Effect"],e.action.entity,e.activator),e.activator.entity.counterHolder.remove("IntoTheVoid",1,e.action.entity),!0),settle:async()=>!0},S]}}const bi=Object.freeze(Object.defineProperty({__proto__:null,default:ln},Symbol.toStringTag,{value:"Module"}));function*on(){yield{name:"ÊòüÊùØ„ÅÆÂ¶ñÁ≤æ„É™„Éº„Çπ",actions:[C,T,E,x,{title:"‚ë†„Çµ„Éº„ÉÅ",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...D,...F],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>{if(e.action.entity.hasBeenSummonedNow(["NormalSummon","SpecialSummon"])&&e.activator.getDeckCell().cardEntities.filter(t=>t.kind==="Monster").filter(t=>{var i;return(i=t.status.nameTags)==null?void 0:i.includes("ÊòüÊùØ")}).length!==0)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(a=>a.kind==="Monster").filter(a=>{var r;return(r=a.status.nameTags)==null?void 0:r.includes("ÊòüÊùØ")});if(t.length===0)return!1;const i=await e.activator.waitSelectEntity(t,"ÊâãÊú≠„Å´Âä†„Åà„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",!1);if(!i)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",e);return await i.addToHand(["Effect"],e.action.entity,e.activator),!0},settle:async()=>!0},{title:"‚ë°Ëá™Â∑±„Çµ„É´„Éô„Éº„Ç∏",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,canPayCosts:e=>[...e.activator.getMonstersOnField(),...e.activator.getHandCell().cardEntities.filter(t=>t.kind==="Monster")].some(t=>t.canBeSentToGraveyard(e.activator,e.action.entity,"SendToGraveyardAsCost",e.action)),validate:()=>[],payCosts:async e=>{const t=[...e.activator.getMonstersOnField(),...e.activator.getHandCell().cardEntities.filter(a=>a.kind==="Monster")].filter(a=>a.canBeSentToGraveyard(e.activator,e.action.entity,"SendToGraveyardAsCost",e.action)),i=await e.activator.waitSelectEntity(t,"Â¢ìÂú∞„Å´ÈÄÅ„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû„ÄÇ",!0);if(i)return await i.sendToGraveyard(["Cost"],e.action.entity,e.activator),{sendToGraveyard:[i]}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>e.action.entity.wasMovedAfter(e.isActivatedAt)?!1:(await e.action.entity.addToHand(["Effect"],e.action.entity,e.activator),!0),settle:async()=>!0}]},yield{name:"ÊòüÈÅ∫Áâ©Ôºç„ÄéÊòüÊùØ„Äè",actions:[C,T,E,x,{title:"‚ë†Â¢ìÂú∞ÈÄÅ„Çä",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...D,...F],executableDuelistTypes:["Controller"],canPayCosts:et,validate:e=>e.activator.duel.field.moveLog.getPriviousChainLog().filter(t=>t.movedAs.includes("SpecialSummon")).map(t=>t.entity).some(t=>t.wasMovedFrom.cellType==="ExtraDeck")?[]:void 0,payCosts:tt,prepare:R,execute:async e=>{const t=e.activator.duel.field.moveLog.getPriviousChainLog().filter(i=>i.movedAs.includes("SpecialSummon")).map(i=>i.entity).filter(i=>i.wasMovedFrom.cellType==="ExtraDeck").filter(i=>i.isOnFieldAsMonsterStrictly).filter(i=>i.canBeEffected(e.activator,e.action.entity,e.action)).toArray();return await v.sendManyToGraveyardForTheSameReason(t,["Effect"],e.action.entity,e.activator),!0},settle:async()=>!0},{title:"‚ë°„É™„ÇØ„É´„Éº„Éà",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Hand","Graveyard","Banished"],executablePeriods:[...D,...F],executableDuelistTypes:["Controller"],validate:e=>{if(!e.action.entity.wasMovedAtPreviousChain||!e.action.entity.info.summonKinds.includes("NormalSummon")||e.action.entity.moveLog.previousPlaceRecord.face==="FaceDown")return;const t=e.activator.getDeckCell().cardEntities.filter(r=>r.kind==="Monster").filter(r=>{var n;return(n=r.status.nameTags)==null?void 0:n.includes("ÊòüÊùØ")}).filter(r=>r.nm!=="ÊòüÈÅ∫Áâ©Ôºç„ÄéÊòüÊùØ„Äè"),i=e.activator.getMonsterZones();return e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,t.map(r=>({monster:r,cells:i,posList:_})),[],!1).length>1?[]:void 0},prepare:R,execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(r=>r.kind==="Monster").filter(r=>{var n;return(n=r.status.nameTags)==null?void 0:n.includes("ÊòüÊùØ")}).filter(r=>r.nm!=="ÊòüÈÅ∫Áâ©Ôºç„ÄéÊòüÊùØ„Äè"),i=e.activator.getMonsterZones();return(await e.activator.summonMany(e.activator,"SpecialSummon",["Effect"],e.action,t.map(r=>({monster:r,cells:i,posList:_})),[],!1,2,r=>r.length==2,!1)??[]).length==2},settle:async()=>!0},{title:"‚ë¢„Çµ„Éº„ÉÅ",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],canPayCosts:Te,validate:e=>{if(!e.action.entity.wasMovedAtCurrentTurn)return e.activator.getDeckCell().cardEntities.filter(t=>{var i;return(i=t.status.nameTags)==null?void 0:i.includes("ÊòüÈÅ∫Áâ©")}).length>0?[]:void 0},payCosts:Ne,prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>{const t=await e.activator.waitSelectEntity(e.activator.getDeckCell().cardEntities.filter(i=>{var a;return(a=i.status.nameTags)==null?void 0:a.includes("ÊòüÈÅ∫Áâ©")}),"ÊâãÊú≠„Å´Âä†„Åà„Çã„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû",!1);return t?(await t.addToHand(["Effect"],e.action.entity,e.activator),!0):!1},settle:async()=>!0}]}}const Di=Object.freeze(Object.defineProperty({__proto__:null,default:on},Symbol.toStringTag,{value:"Module"}));function*cn(){yield{name:"„Éâ„ÉÉ„Éà„Çπ„Ç±„Éº„Éë„Éº",actions:[C,T,x,E,{title:"‚ë†Ëá™Â∑±ÂÜçÁîü",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...D,...F],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:1,actionGroupName:"„Éâ„ÉÉ„Éà„Çπ„Ç±„Éº„Éë„Éº",validate:e=>{if(e.action.entity.wasMovedAtPreviousChain)return e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:e=>te(e),settle:async()=>!0},{title:"‚ë°Ëá™Â∑±Â∏∞ÈÇÑ",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Banished"],executablePeriods:[...D,...F],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:1,actionGroupName:"„Éâ„ÉÉ„Éà„Çπ„Ç±„Éº„Éë„Éº",validate:e=>{if(e.action.entity.wasMovedAtPreviousChain)return e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromBanished"],prepared:void 0}),execute:e=>te(e),settle:async()=>!0}]}}const Pi=Object.freeze(Object.defineProperty({__proto__:null,default:cn},Symbol.toStringTag,{value:"Module"}));function*un(){yield{name:"„Çº„É©„ÅÆÂ§©‰Ωø",actions:[C,T,E,V(),{title:"‚ë°Ëá™Â∑±Â∏∞ÈÇÑ",isMandatory:!0,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Banished"],executablePeriods:["stanby"],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.wasMovedAtPreviousTurn)return e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromBanished"],prepared:void 0}),execute:e=>te(e),settle:async()=>!0}],continuousEffects:[me("‚ë°ÊîªÊíÉÂäõ‰∏äÊòá","Monster",e=>[e],e=>[Z.createContinuous("‚ë†ÊîªÊíÉÂäõ‰∏äÊòá",()=>!0,e,()=>!0,"attack","wip","Addition",(t,i,a)=>t.isEffective?a+t.controller.getOpponentPlayer().getBanished().cardEntities.length*100:a)])]}}const Mi=Object.freeze(Object.defineProperty({__proto__:null,default:un},Symbol.toStringTag,{value:"Module"}));function*dn(){yield{name:"Ê≠ªÈúäÈ®éÂ£´„Éá„Çπ„Ç´„É™„Éê„Éº„Éª„Éä„Ç§„Éà",actions:[C,T,x,E,{title:"‚ë†„É¢„É≥„Çπ„Çø„ÉºÂäπÊûúÁÑ°Âäπ",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Quick",executableCells:H,executablePeriods:[...D,...F],executableDuelistTypes:["Controller"],negatePreviousBlock:!0,canPayCosts:et,validate:e=>e.targetChainBlock&&e.targetChainBlock.action.entity.kind==="Monster"&&e.targetChainBlock.action.isWithChainBlock?[]:void 0,payCosts:tt,prepare:async(e,t)=>{const i=e.targetChainBlock,a=t[e.index-1];return i!==a?{selectedEntities:[],chainBlockTags:[],prepared:void 0}:{selectedEntities:[],chainBlockTags:["NegateCardEffect",...e.action.calcChainBlockTagsForDestroy(e.activator,[i.action.entity])],prepared:void 0}},execute:async(e,t)=>{const i=t.find(r=>r.action.entity.kind!=="Monster"&&r.action.isWithChainBlock),a=t[e.index-1];return a!==i?!1:(a.isNegatedActivationBy=e.action,await v.tryDestroy([a.action.entity],e),!0)},settle:async()=>!0}]}}const Ai=Object.freeze(Object.defineProperty({__proto__:null,default:dn},Symbol.toStringTag,{value:"Module"}));function*pn(){yield{name:"Âè¨ÂñöÂÉß„Çµ„É¢„É≥„Éó„É™„Éº„Çπ„Éà",actions:[C,T,x,E,{title:"‚ë†Ë°®Á§∫ÂΩ¢ÂºèÂ§âÊõ¥",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...D,...F],executableDuelistTypes:["Controller"],validate:e=>{if(e.action.entity.hasBeenSummonedNow(["NormalSummon","FlipSummon"]))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["IfNormarlSummonSucceed"],prepared:void 0}),execute:async e=>e.action.entity.battlePosition!=="Attack"||!e.action.entity.isOnFieldAsMonsterStrictly?!1:(await e.action.entity.setBattlePosition("Defense",["Effect"],e.action.entity,e.activator),!0),settle:async()=>!0},{title:"‚ë¢„É™„ÇØ„É´„Éº„Éà",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,canPayCosts:e=>e.activator.status.canDiscardAsCost?e.activator.getHandCell().cardEntities.some(t=>t.kind==="Spell"):!1,validate:e=>{const t=e.activator.getDeckCell().cardEntities.filter(r=>r.kind==="Monster").filter(r=>r.lvl===4),i=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,t.map(r=>({monster:r,posList:_,cells:i})),[],!1).length)return[]},payCosts:async(e,t,i)=>{const a=e.activator.getHandCell().cardEntities.filter(n=>n.kind==="Spell"),r=await e.activator.waitSelectEntity(a,"ÊâãÊú≠„Ç≥„Çπ„Éà„ÇíÈÅ∏Êäû",i);if(!r&&!i)throw new q(e);if(r)return await r.discard(["Cost"],e.action.entity,e.activator),{discard:[r]}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(r=>r.lvl===4),i=e.activator.getMonsterZones(),a=await e.activator.summonOne(e.activator,"SpecialSummon",["Effect"],e.action,t.map(r=>({monster:r,posList:_,cells:i})),[],!1,!1);return a?(a.statusOperatorBundle.push(new Q("ÊîªÊíÉ‰∏çÂèØ",r=>r.effectOwner.duel.clock.isSameTurn(r.isSpawnedAt),!1,e.action.entity,e.action,()=>!0,(r,n)=>({...n,canAttack:!1}))),!!a):!1},settle:async()=>!0}],continuousEffects:[Dt("‚ë°„É™„É™„Éº„Çπ‰∏çÂèØ","Monster",e=>[e],e=>[new he("‚ë°„É™„É™„Éº„Çπ‰∏çÂèØ",()=>!0,!0,e,{},()=>!0,["AdvanceSummonRelease","ReleaseAsEffect","ReleaseAsCost"],()=>!1)])]}}const xi=Object.freeze(Object.defineProperty({__proto__:null,default:pn},Symbol.toStringTag,{value:"Module"}));function*fn(){yield{name:"„Ç¢„É≥„Ç´„É¢„Éï„É©„Ç§„Éà",actions:[C,T,E,se,{title:"ÁâπÊÆäÂè¨Âñö",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:1,validate:e=>{if(e.action.entity.face!=="FaceDown"&&!e.activator.getExtraDeck().cardEntities.some(t=>t.nm!=="„Ç¢„É≥„Ç´„É¢„Éï„É©„Ç§„Éà"))return Me(e,_,[])},prepare:e=>J(e,"SpecialSummon",["SpecialSummon","Rule"],_),execute:Y,settle:async()=>!0},{title:"‚ë†„Éâ„É≠„Éº",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:20,isOnlyNTimesPerTurn:1,validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<1)&&!e.activator.getExtraDeck().cardEntities.some(t=>t.nm!=="„Ç¢„É≥„Ç´„É¢„Éï„É©„Ç§„Éà"))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["DestroySpellTrapOnField","Draw"],prepared:void 0}),execute:async e=>(await v.tryDestroy([e.action.entity],e)).length?(e.action.entity.field.duel.clock.incrementProcSeq(),await e.activator.draw(1,e.action.entity,e.activator),!0):!1,settle:async()=>!0}],summonFilter:(e,t,i,a,r,n,l,o,u,c)=>{const d={posList:u,cells:c},p={posList:[],cells:[]};return l!==t||n.entity===t?d:p},continuousEffects:[Je("Èô§Â§ñ‰∫àÂÆö","Monster",e=>[e],e=>[new Q("Èô§Â§ñ‰∫àÂÆö",()=>!0,!0,e,{},(t,i)=>i.isOnFieldAsMonsterStrictly&&i.face==="FaceUp",(t,i)=>({...i,willBeBanished:!0}))])]}}const Fi=Object.freeze(Object.defineProperty({__proto__:null,default:fn},Symbol.toStringTag,{value:"Module"}));function*hn(){yield{name:"„Ç®„Ç≠„Çª„É≥„Éà„É™„ÉÉ„ÇØ„Éª„Éú„Éº„Ç§",actions:[C,T,x,E],summonFilter:(e,t,i,a,r,n,l,o,u,c)=>{const d={posList:u,cells:c},p={posList:[],cells:[]};if(!r.includes("SyncroSummon"))return d;const g=o.find(h=>h.material===e.isSpawnedBy);return g?!g.cell.isMonsterZoneLikeCell||o.length!==2?p:o.filter(h=>h!==g).every(h=>h.cell.cellType==="Hand")?d:p:d},defaultStatus:{allowHandSyncro:!0},onUsedAsMaterial:(e,t)=>{t.info.summonKinds.includes("SyncroSummon")&&(e.action.entity.statusOperatorBundle.push(new Q("Èô§Â§ñ‰∫àÂÆö",()=>!0,!1,e.action.entity,e.action,(i,a)=>a.isOnFieldAsMonsterStrictly&&a.face==="FaceUp",(i,a)=>({...a,willBeBanished:!0}))),t.info.isEffectiveIn=t.info.isEffectiveIn.filter(i=>i!=="ExtraMonsterZone").filter(i=>i!=="MonsterZone"))}}}const Bi=Object.freeze(Object.defineProperty({__proto__:null,default:hn},Symbol.toStringTag,{value:"Module"})),gn={title:"„Éö„É≥„Éá„É•„É©„É†Âè¨Âñö",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>{const t=e.activator.getPendulumScales();if(!t||t.upperBound-t.lowerBound<2)return;const i=[...e.activator.getHandCell().cardEntities.filter(n=>n.kind==="Monster"),...e.activator.getExtraDeck().cardEntities.filter(n=>n.face==="FaceUp")].filter(n=>n.kind==="Monster").filter(n=>n.lvl&&n.lvl>t.lowerBound).filter(n=>n.lvl&&n.lvl<t.upperBound);if(!i.length)return;const a=[...e.activator.getMonsterZones(),...e.activator.getEmptyExtraZones()];return e.activator.getEnableSummonList(e.activator,"PendulumSummon",["Rule"],e.action,i.map(n=>({monster:n,cells:a,posList:_})),[],!1).length?[]:void 0},prepare:async e=>{const t=e.activator.getPendulumScales();if(!t||t.upperBound-t.lowerBound<2)return;const i=[...e.activator.getHandCell().cardEntities.filter(r=>r.kind==="Monster"),...e.activator.getExtraDeck().cardEntities.filter(r=>r.face==="FaceUp")].filter(r=>r.kind==="Monster").filter(r=>r.lvl&&r.lvl>t.lowerBound).filter(r=>r.lvl&&r.lvl<t.upperBound);if(!i.length)return;const a=[...e.activator.getMonsterZones(),...e.activator.getEmptyExtraZones()];return await e.activator.summonMany(e.activator,"PendulumSummon",["Rule"],e.action,i.map(r=>({monster:r,posList:_,cells:a})),[],!1,void 0,r=>r.length>0,!1),R()},execute:async e=>(e.activator.getPendingMonstersOnField().forEach(t=>t.determine()),!0),settle:async()=>!0},yn={title:"Âº∑Âà∂ÂãùÂà©",isMandatory:!0,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>e.activator.duel.clock.turn>1?[]:void 0,prepare:async e=>(await v.sendManyToGraveyardForTheSameReason(e.activator.duel.field.getCardsOnFieldStrictly(),["Rule"],e.action.entity,e.activator),{selectedEntities:[],chainBlockTags:[],prepared:void 0,nextChainBlockFilter:()=>!1}),execute:async e=>{const t=[{name:"Â∞ÅÂç∞„Åï„Çå„ÅóËÄÖ„ÅÆÂ∑¶Ë∂≥",column:4},{name:"Â∞ÅÂç∞„Åï„Çå„ÅóËÄÖ„ÅÆÂè≥Ë∂≥",column:2},{name:"Â∞ÅÂç∞„Åï„Çå„ÅóËÄÖ„ÅÆÂ∑¶ËÖï",column:5},{name:"Â∞ÅÂç∞„Åï„Çå„ÅóËÄÖ„ÅÆÂè≥ËÖï",column:1},{name:"Â∞ÅÂç∞„Åï„Çå„Åó„Ç®„ÇØ„Çæ„Éá„Ç£„Ç¢",column:3}];for(const i of t){const a=[e.activator.duel.field.getAllCardEntities().filter(r=>r.owner===e.activator).find(r=>r.origin.name===i.name),e.activator.getOpponentPlayer().getHandCell().cardEntities.find(r=>r.origin.name===i.name)].filter(r=>r!==void 0);if(!a.length)throw new m("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",e.activator.getHandCell().cardEntities,i.name);console.log(a),await b.moveMany(a.map(r=>[r,r.controller.getMonsterZones().find(n=>n.column===(r.controller.seat==="Above"?6-i.column:i.column))??r.controller.getFieldZone(),"Monster","FaceUp","Vertical","Top",["Rule"],void 0,void 0,void 0]))}throw new $(e.activator,`${e.activator.getOpponentPlayer().profile.name}„Åå„ÉØ„É≥„Çø„Éº„É≥„Ç≠„É´„Å´Â§±Êïó„Åó„Åü„ÄÇ`)},settle:async()=>!0},vn=e=>{const t=[gn];return e.profile.npcType==="FtkChallenge"&&t.push(yn),{name:e.profile.name,actions:t,staticInfo:{name:e.profile.name,kind:"Monster",wikiEncodedName:"%A5%D7%A5%EC%A5%A4%A5%E4%A1%BC"}}};function*mn(){const e={...Object.assign({"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_ContinuousSpell.ts":Ht,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_ContinuousTrap.ts":Zt,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_CounterTrap.ts":$t,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_EquipSpell.ts":Gt,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_EquipSpell_Preset.ts":jt,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_FieldSpell.ts":Ut,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_FieldSpell_Preset.ts":Vt,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_LinkMonster.ts":Xt,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_Monster.ts":Kt,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_Monster_Preset_DirectAttacker.ts":Jt,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_Monster_Preset_Recruiter.ts":Yt,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_NormalSpell.ts":It,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_NormalSpell_General_Draw.ts":ei,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_NormalSpell_Preset.ts":ti,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_NormalTrap.ts":ii,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_NormalTrap_UponAttackDeclaration.ts":ai,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_QuickPlaySpell.ts":ri,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_RitualSpell.ts":si,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_SyncroMonster.ts":li,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_TestMonster.ts":oi,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_XyzMonster.ts":ci}),...Object.assign({"/src/ygo_entity_proc/card_proc_definitions/character_yusei/CardProcDefinitions_Yusei_SyncroTunerMonster.ts":ui,"/src/ygo_entity_proc/card_proc_definitions/tag_b/CardProcDefinitions_BambooSword_EquipSpell.ts":di,"/src/ygo_entity_proc/card_proc_definitions/tag_b/CardProcDefinitions_BambooSword_NormalSpell.ts":pi,"/src/ygo_entity_proc/card_proc_definitions/tag_b/CardProcDefinitions_Blackwing_Monster.ts":fi,"/src/ygo_entity_proc/card_proc_definitions/tag_c/CardProcDefinitions_Crystron_LinkMonster.ts":hi,"/src/ygo_entity_proc/card_proc_definitions/tag_e/CardProcDefinitions_Exodia_Monster.ts":gi,"/src/ygo_entity_proc/card_proc_definitions/tag_f/CardProcDefinitions_Firewall_LinkMonster.ts":yi,"/src/ygo_entity_proc/card_proc_definitions/tag_f/CardProcDefinitions_Fusion_NormalSpell.ts":vi,"/src/ygo_entity_proc/card_proc_definitions/tag_i/CardProcDefinitions_Igknight_Monster.ts":mi,"/src/ygo_entity_proc/card_proc_definitions/tag_j/CardProcDefinitions_Junk_Monster.ts":Si,"/src/ygo_entity_proc/card_proc_definitions/tag_r/CardProcDefinitions_Resonator_Monster.ts":Ci,"/src/ygo_entity_proc/card_proc_definitions/tag_s/CardProcDefinitions_SpellCounter_Monster.ts":Ti,"/src/ygo_entity_proc/card_proc_definitions/tag_s/CardProcDefinitions_Stardust_Monster.ts":ki,"/src/ygo_entity_proc/card_proc_definitions/tag_s/CardProcDefinitions_Synchron_SyncroMonster.ts":Ei,"/src/ygo_entity_proc/card_proc_definitions/tag_s/CardProcDefinitions_Syncron_NormalSpell.ts":wi,"/src/ygo_entity_proc/card_proc_definitions/tag_t/CardProcDefinitions_Toon_ContinuousSpell.ts":_i,"/src/ygo_entity_proc/card_proc_definitions/tag_v/CardProcDefinitions_Void_NormalSpell.ts":bi,"/src/ygo_entity_proc/card_proc_definitions/tag_w/CardProcDefinitions_WorldChalice_Monster.ts":Di,"/src/ygo_entity_proc/card_proc_definitions/type_Cyberse/CardProcDefinitions_Earth_Cyberse_lvl1_Monster.ts":Pi,"/src/ygo_entity_proc/card_proc_definitions/type_Fairy/CardProcDefinitions_Light_Fairy_lvl8_SyncroMonster.ts":Mi,"/src/ygo_entity_proc/card_proc_definitions/type_Fiend/CardProcDefinitions_Dark_Fiend_lvl4_Monster.ts":Ai,"/src/ygo_entity_proc/card_proc_definitions/type_Spellcaster/CardProcDefinitions_Dark_Spellcaster_lvl4_Monster.ts":xi,"/src/ygo_entity_proc/card_proc_definitions/type_Spellcaster/CardProcDefinitions_Light_Spellcaster_lvl5_PendulumMonster.ts":Fi,"/src/ygo_entity_proc/card_proc_definitions/type_Spellcaster/CardProcDefinitions_Wind_Spellcaster_lvl3_Monster.ts":Bi})};for(const t of Object.keys(e))e[t].default&&(yield*e[t].default())}function*Sn(...e){const t={...Object.assign({"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_ContinuousSpell.ts":Ht,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_ContinuousTrap.ts":Zt,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_CounterTrap.ts":$t,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_EquipSpell.ts":Gt,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_EquipSpell_Preset.ts":jt,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_FieldSpell.ts":Ut,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_FieldSpell_Preset.ts":Vt,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_LinkMonster.ts":Xt,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_Monster.ts":Kt,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_Monster_Preset_DirectAttacker.ts":Jt,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_Monster_Preset_Recruiter.ts":Yt,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_NormalSpell.ts":It,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_NormalSpell_General_Draw.ts":ei,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_NormalSpell_Preset.ts":ti,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_NormalTrap.ts":ii,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_NormalTrap_UponAttackDeclaration.ts":ai,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_QuickPlaySpell.ts":ri,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_RitualSpell.ts":si,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_SyncroMonster.ts":li,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_TestMonster.ts":oi,"/src/ygo_entity_proc/card_proc_definitions/CardProcDefinitions_XyzMonster.ts":ci}),...Object.assign({"/src/ygo_entity_proc/card_proc_definitions/character_yusei/CardProcDefinitions_Yusei_SyncroTunerMonster.ts":ui,"/src/ygo_entity_proc/card_proc_definitions/tag_b/CardProcDefinitions_BambooSword_EquipSpell.ts":di,"/src/ygo_entity_proc/card_proc_definitions/tag_b/CardProcDefinitions_BambooSword_NormalSpell.ts":pi,"/src/ygo_entity_proc/card_proc_definitions/tag_b/CardProcDefinitions_Blackwing_Monster.ts":fi,"/src/ygo_entity_proc/card_proc_definitions/tag_c/CardProcDefinitions_Crystron_LinkMonster.ts":hi,"/src/ygo_entity_proc/card_proc_definitions/tag_e/CardProcDefinitions_Exodia_Monster.ts":gi,"/src/ygo_entity_proc/card_proc_definitions/tag_f/CardProcDefinitions_Firewall_LinkMonster.ts":yi,"/src/ygo_entity_proc/card_proc_definitions/tag_f/CardProcDefinitions_Fusion_NormalSpell.ts":vi,"/src/ygo_entity_proc/card_proc_definitions/tag_i/CardProcDefinitions_Igknight_Monster.ts":mi,"/src/ygo_entity_proc/card_proc_definitions/tag_j/CardProcDefinitions_Junk_Monster.ts":Si,"/src/ygo_entity_proc/card_proc_definitions/tag_r/CardProcDefinitions_Resonator_Monster.ts":Ci,"/src/ygo_entity_proc/card_proc_definitions/tag_s/CardProcDefinitions_SpellCounter_Monster.ts":Ti,"/src/ygo_entity_proc/card_proc_definitions/tag_s/CardProcDefinitions_Stardust_Monster.ts":ki,"/src/ygo_entity_proc/card_proc_definitions/tag_s/CardProcDefinitions_Synchron_SyncroMonster.ts":Ei,"/src/ygo_entity_proc/card_proc_definitions/tag_s/CardProcDefinitions_Syncron_NormalSpell.ts":wi,"/src/ygo_entity_proc/card_proc_definitions/tag_t/CardProcDefinitions_Toon_ContinuousSpell.ts":_i,"/src/ygo_entity_proc/card_proc_definitions/tag_v/CardProcDefinitions_Void_NormalSpell.ts":bi,"/src/ygo_entity_proc/card_proc_definitions/tag_w/CardProcDefinitions_WorldChalice_Monster.ts":Di,"/src/ygo_entity_proc/card_proc_definitions/type_Cyberse/CardProcDefinitions_Earth_Cyberse_lvl1_Monster.ts":Pi,"/src/ygo_entity_proc/card_proc_definitions/type_Fairy/CardProcDefinitions_Light_Fairy_lvl8_SyncroMonster.ts":Mi,"/src/ygo_entity_proc/card_proc_definitions/type_Fiend/CardProcDefinitions_Dark_Fiend_lvl4_Monster.ts":Ai,"/src/ygo_entity_proc/card_proc_definitions/type_Spellcaster/CardProcDefinitions_Dark_Spellcaster_lvl4_Monster.ts":xi,"/src/ygo_entity_proc/card_proc_definitions/type_Spellcaster/CardProcDefinitions_Light_Spellcaster_lvl5_PendulumMonster.ts":Fi,"/src/ygo_entity_proc/card_proc_definitions/type_Spellcaster/CardProcDefinitions_Wind_Spellcaster_lvl3_Monster.ts":Bi})},i=[];for(const a of Object.values(t))if(a.default){for(const r of a.default())if(e.includes(r.name)){const n=W[r.name];let l=r.summonFilter;n.kind==="Monster"&&n.monsterCategories&&!r.summonFilter&&n.monsterCategories.union(St).length&&(l=fr),yield{...r,summonFilter:l,staticInfo:n},i.push(r.name)}}yield*e.filter(a=>!i.includes(a)).map(a=>W[a]).filter(a=>a).filter(a=>a.kind==="Monster").filter(a=>{var r;return!((r=a.monsterCategories)!=null&&r.includes("Effect"))}).filter(a=>{var r;return!((r=a.monsterCategories)!=null&&r.includes("Pendulum"))}).map(a=>{var r,n;return i.push(a.name),(r=a.monsterCategories)!=null&&r.includes("SpecialSummon")&&console.log(a.name),{name:a.name,actions:(n=a.monsterCategories)!=null&&n.includes("SpecialSummon")?Qt:pr,staticInfo:a}}),i.length!==e.length&&console.log(e.filter(a=>!i.includes(a)))}const Cn=e=>({...vn(e),staticInfo:{name:e.profile.name,kind:"Monster",wikiEncodedName:"%A5%D7%A5%EC%A5%A4%A5%E4%A1%BC"}}),Tn=new Set,We=qi;for(const e of mn()){if(Tn.has(e.name))throw new Error(`„Ç´„Éº„ÉâÂÆöÁæ©ÈáçË§á${e.name}`);We[e.name]&&(We[e.name].isImplemented=!0)}const W=Object.values(We).reduce((e,t)=>{var i;return t.monsterCategories&&!((i=t.monsterCategories)!=null&&i.includes("Effect"))&&!t.monsterCategories.includes("Pendulum")&&(t.monsterCategories.includes("Normal")||console.log(t.name),t.isImplemented=!0),e[t.name]=t,e},{}),Xe=[{id:-1,name:"„Çµ„É≥„Éó„É´„Éá„ÉÉ„Ç≠Ôºë",deckType:"NPC",description:"",cardNames:["„Ç¢„É≥„Éé„Ç¶„É≥„Éª„Ç∑„É≥„ÇØ„É≠„É≥","ÂÖ≠Ê≠¶Ë°Ü„ÅÆ„ÅîÈö†Â±Ö","„Ç∏„É£„É≥„ÇØ„Éª„Éï„Ç©„Ç¢„Éº„Éâ","„Ç∏„É£„É≥„ÇØ„Éª„Éï„Ç©„Ç¢„Éº„Éâ","„Ç∏„É£„É≥„ÇØ„Éª„Éï„Ç©„Ç¢„Éº„Éâ","„ÉÅ„É•„Éº„É≥„Éª„Ç¶„Ç©„É™„Ç¢„Éº","„ÉÅ„É•„Éº„É≥„Éª„Ç¶„Ç©„É™„Ç¢„Éº","„Ç¨„Éº„Éâ„Éª„Ç™„Éñ„Éª„Éï„É¨„É†„Éô„É´","„Ç¨„Éº„Éâ„Éª„Ç™„Éñ„Éª„Éï„É¨„É†„Éô„É´","ÂÆàË≠∑Á´ú„É¶„Çπ„ÉÜ„Ç£„Ç¢","ÂÆàË≠∑Á´ú„É¶„Çπ„ÉÜ„Ç£„Ç¢","„Ç®„É≥„Ç∏„Çß„É´„Éª„Éà„É©„É≥„Éö„ÉÉ„Çø„Éº","„Ç®„É≥„Ç∏„Çß„É´„Éª„Éà„É©„É≥„Éö„ÉÉ„Çø„Éº","„Ç∏„Çß„É†„Éä„Ç§„Éà„Éª„Çµ„Éï„Ç£„Ç¢","„Ç∏„Çß„É†„Éä„Ç§„Éà„Éª„Çµ„Éï„Ç£„Ç¢","È≠ÇËôé","È≠ÇËôé","ÊöóÈªíÁïå„ÅÆÁï™ÂÖµ „É¨„É≥„Ç∏","ÊöóÈªíÁïå„ÅÆÁï™ÂÖµ „É¨„É≥„Ç∏","„Éê„Éà„É´„Éï„ÉÉ„Éà„Éú„Éº„É©„Éº","„Éê„Éà„É´„Éï„ÉÉ„Éà„Éú„Éº„É©„Éº","ÁêÉÈ®éÂ£´„ÅÆ‰∏â‰∫∫Â®ò","ÁêÉÈ®éÂ£´„ÅÆ‰∏â‰∫∫Â®ò","„Ç®„É≥„Ç∏„Çß„É´„Éª„Éà„É©„É≥„Éö„ÉÉ„Çø„Éº","„Ç®„É≥„Ç∏„Çß„É´„Éª„Éà„É©„É≥„Éö„ÉÉ„Çø„Éº","ÔºßÊà¶Èöä „Ç∑„É£„Ç§„É≥„Éñ„É©„ÉÉ„ÇØ","ÔºßÊà¶Èöä „Ç∑„É£„Ç§„É≥„Éñ„É©„ÉÉ„ÇØ","„Åó„ÇÉ„Çä„ÅÆËªçË≤´","„Åó„ÇÉ„Çä„ÅÆËªçË≤´","„Ç∏„Éß„É≥„Ç∞„É´„Ç∞„Éº„É´„ÅÆÂπªË°ìÂ∏´","„Ç∏„Éß„É≥„Ç∞„É´„Ç∞„Éº„É´„ÅÆÂπªË°ìÂ∏´","„Çæ„É≥„Éì„Éº„Éé","„Çæ„É≥„Éì„Éº„Éé","„É°„Ç¨„É≠„Çπ„Éû„ÉÉ„Ç∑„É£„ÉºÔº∏","„É°„Ç¨„É≠„Çπ„Éû„ÉÉ„Ç∑„É£„ÉºÔº∏","„É©„Ç§„Éâ„É≠„É≥","„É©„Ç§„Éâ„É≠„É≥","Ê©üÁïåÈ®éÂ£´„Ç¢„É¥„É©„É†","Ê©üÁïåÈ®éÂ£´„Ç¢„É¥„É©„É†","Âπª„ÅÆ„Ç∞„É™„Éï„Ç©„É≥","Âπª„ÅÆ„Ç∞„É™„Éï„Ç©„É≥","ÂπªÊÆªÁ´ú","ÂπªÊÆªÁ´ú","„Ç¢„É¨„Ç≠„Çµ„É≥„Éâ„É©„Ç§„Éâ„É©„Ç¥„É≥","„Ç¢„É¨„Ç≠„Çµ„É≥„Éâ„É©„Ç§„Éâ„É©„Ç¥„É≥","„Ç∏„Çß„Éç„ÉÜ„Ç£„ÉÉ„ÇØ„Éª„ÉØ„Éº„Ç¶„É´„Éï","„Ç∏„Çß„Éç„ÉÜ„Ç£„ÉÉ„ÇØ„Éª„ÉØ„Éº„Ç¶„É´„Éï","„Çµ„Ç§„Éê„Éº„Éª„Éâ„É©„Ç¥„É≥","„Éï„É≠„Çπ„Éà„Ç∂„Ç¶„É´„Çπ","„Éï„É≠„Çπ„Éà„Ç∂„Ç¶„É´„Çπ","„Éï„É≠„Çπ„Éà„Ç∂„Ç¶„É´„Çπ","ÈùíÁúº„ÅÆÁôΩÈæç","„Éû„Ç∏„Ç´„É´„Éª„Ç¢„É≥„Éâ„É≠„Ç§„Éâ","„Éû„Ç∏„Ç´„É´„Éª„Ç¢„É≥„Éâ„É≠„Ç§„Éâ","„Éû„Ç∏„Ç´„É´„Éª„Ç¢„É≥„Éâ„É≠„Ç§„Éâ","Â§ßÂú∞„ÅÆÈ®éÂ£´„Ç¨„Ç§„Ç¢„Éä„Ç§„Éà","Â§ßÂú∞„ÅÆÈ®éÂ£´„Ç¨„Ç§„Ç¢„Éä„Ç§„Éà","Â§ßÂú∞„ÅÆÈ®éÂ£´„Ç¨„Ç§„Ç¢„Éä„Ç§„Éà","„Çπ„ÇØ„É©„ÉÉ„Éó„Éª„Éá„Çπ„Éá„Éº„É¢„É≥","„Çπ„ÇØ„É©„ÉÉ„Éó„Éª„Éá„Çπ„Éá„Éº„É¢„É≥","„Çπ„ÇØ„É©„ÉÉ„Éó„Éª„Éá„Çπ„Éá„Éº„É¢„É≥","„Çπ„Çø„Éº„ÉÄ„Çπ„Éà„Éª„Éâ„É©„Ç¥„É≥","„Çπ„Çø„Éº„ÉÄ„Çπ„Éà„Éª„Éâ„É©„Ç¥„É≥","„Çπ„Çø„Éº„ÉÄ„Çπ„Éà„Éª„Éâ„É©„Ç¥„É≥","„Éä„ÉÅ„É•„É´„Éª„Ç¨„Ç™„Éâ„É¨„Ç§„ÇØ","„Éä„ÉÅ„É•„É´„Éª„Ç¨„Ç™„Éâ„É¨„Ç§„ÇØ","„Éä„ÉÅ„É•„É´„Éª„Ç¨„Ç™„Éâ„É¨„Ç§„ÇØ"]},{id:-2,name:"„Çµ„É≥„Éó„É´„Éá„ÉÉ„Ç≠Ôºí",deckType:"NPC",description:"",cardNames:["„Ç¢„É≥„Éé„Ç¶„É≥„Éª„Ç∑„É≥„ÇØ„É≠„É≥","ÂÖ≠Ê≠¶Ë°Ü„ÅÆ„ÅîÈö†Â±Ö","„Ç∏„É£„É≥„ÇØ„Éª„Éï„Ç©„Ç¢„Éº„Éâ","„Ç∞„É≠„Éº„Ç¢„ÉÉ„Éó„Éª„Éê„É´„Éñ","„Ç¨„Éº„Éâ„Éª„Ç™„Éñ„Éª„Éï„É¨„É†„Éô„É´","‰ºùË™¨„ÅÆÁôΩÁü≥","‰ºùË™¨„ÅÆÁôΩÁü≥","‰ºùË™¨„ÅÆÁôΩÁü≥","ÂÆàË≠∑Á´ú„É¶„Çπ„ÉÜ„Ç£„Ç¢","„ÇÆ„É£„É©„ÇØ„Ç∑„Éº„Çµ„Éº„Éö„É≥„Éà","„Ç∏„Çß„Éç„ÇØ„Çπ„Éª„Ç≥„É≥„Éà„É≠„Éº„É©„Éº","Ôº•„ÉªÔº®Ôº•Ôº≤ÔºØ „Éï„Çß„Ç∂„Éº„Éû„É≥","Ôº•„ÉªÔº®Ôº•Ôº≤ÔºØ „Éê„Éº„Çπ„Éà„É¨„Éá„Ç£","„ÉÅ„É•„Éº„É≥„Éª„Ç¶„Ç©„É™„Ç¢„Éº","Ôº•„ÉªÔº®Ôº•Ôº≤ÔºØ „ÇØ„É¨„Ç§„Éû„É≥","Ôº•„ÉªÔº®Ôº•Ôº≤ÔºØ „Çπ„Éë„Éº„ÇØ„Éû„É≥","„Åó„ÇÉ„Çä„ÅÆËªçË≤´","„Ç∏„Éß„É≥„Ç∞„É´„Ç∞„Éº„É´„ÅÆÂπªË°ìÂ∏´","„Çæ„É≥„Éì„Éº„Éé","„Ç∏„Çß„Éç„ÉÜ„Ç£„ÉÉ„ÇØ„Éª„ÉØ„Éº„Ç¶„É´„Éï","„É©„Ç§„Éà„É≠„Éº„Éâ„Éª„Éì„Éº„Çπ„Éà „Ç¶„Ç©„É´„Éï","„Çµ„Ç§„Éê„Éº„Éª„Éâ„É©„Ç¥„É≥","„Çµ„Ç§„Éê„Éº„Éª„Éâ„É©„Ç¥„É≥","„Çµ„Ç§„Éê„Éº„Éª„Éâ„É©„Ç¥„É≥","„É©„Éñ„É©„Éâ„É©„Ç§„Éâ„É©„Ç¥„É≥","Ôº§ÔºçÔº®Ôº•Ôº≤ÔºØ „Éá„Ç£„Ç¢„Éú„É™„ÉÉ„ÇØ„Ç¨„Ç§","Ôº§ÔºçÔº®Ôº•Ôº≤ÔºØ „Éá„Ç£„Ç¢„Éú„É™„ÉÉ„ÇØ„Ç¨„Ç§","Ôº§ÔºçÔº®Ôº•Ôº≤ÔºØ „Éá„Ç£„Ç¢„Éú„É™„ÉÉ„ÇØ„Ç¨„Ç§","„Éï„É≠„Çπ„Éà„Ç∂„Ç¶„É´„Çπ","Ôº•„ÉªÔº®Ôº•Ôº≤ÔºØ „Éç„Ç™„Çπ","ÈùíÁúº„ÅÆÁôΩÈæç","ÈùíÁúº„ÅÆÁôΩÈæç","ÈùíÁúº„ÅÆÁôΩÈæç","Ôº•Ôºç„Ç®„Éû„Éº„Ç∏„Çß„É≥„Ç∑„Éº„Ç≥„Éº„É´","„Åä„Çç„Åã„Å™ÂüãËë¨","„Éà„É¨„Éº„Éâ„Éª„Ç§„É≥","„Éà„É¨„Éº„Éâ„Éª„Ç§„É≥","„Éà„É¨„Éº„Éâ„Éª„Ç§„É≥","Èóá„ÅÆÈáèÁî£Â∑•Â†¥","Âº∑Ê¨≤„Å™Â£∫","Âº∑Ê¨≤„Å™Â£∫","Âº∑Ê¨≤„Å™Â£∫","Ê≠ªËÄÖËòáÁîü","Ê≠ªËÄÖËòáÁîü","Ê≠ªËÄÖËòáÁîü","Âè¨ÂñöÂ∏´„ÅÆ„Çπ„Ç≠„É´","Âè¨ÂñöÂ∏´„ÅÆ„Çπ„Ç≠„É´","Âè¨ÂñöÂ∏´„ÅÆ„Çπ„Ç≠„É´","ÊàêÈáë„Ç¥„Éñ„É™„É≥","ÊàêÈáë„Ç¥„Éñ„É™„É≥","ÊàêÈáë„Ç¥„Éñ„É™„É≥","Êà¶Â£´„ÅÆÁîüÈÇÑ","Â¢óÊè¥","Ë™øÂíå„ÅÆÂÆùÊú≠","Ë™øÂíå„ÅÆÂÆùÊú≠","Ë™øÂíå„ÅÆÂÆùÊú≠","Â§©‰Ωø„ÅÆÊñΩ„Åó","Â§©‰Ωø„ÅÆÊñΩ„Åó","Â§©‰Ωø„ÅÆÊñΩ„Åó","Ë≤™Ê¨≤„Å™Â£∫","Ë≤™Ê¨≤„Å™Â£∫","Ë≤™Ê¨≤„Å™Â£∫","„Éû„Ç∏„Ç´„É´„Éª„Ç¢„É≥„Éâ„É≠„Ç§„Éâ","„Éû„Ç∏„Ç´„É´„Éª„Ç¢„É≥„Éâ„É≠„Ç§„Éâ","„Éû„Ç∏„Ç´„É´„Éª„Ç¢„É≥„Éâ„É≠„Ç§„Éâ","Â§ßÂú∞„ÅÆÈ®éÂ£´„Ç¨„Ç§„Ç¢„Éä„Ç§„Éà","Â§ßÂú∞„ÅÆÈ®éÂ£´„Ç¨„Ç§„Ç¢„Éä„Ç§„Éà","Â§ßÂú∞„ÅÆÈ®éÂ£´„Ç¨„Ç§„Ç¢„Éä„Ç§„Éà","„Çπ„ÇØ„É©„ÉÉ„Éó„Éª„Éá„Çπ„Éá„Éº„É¢„É≥","„Çπ„ÇØ„É©„ÉÉ„Éó„Éª„Éá„Çπ„Éá„Éº„É¢„É≥","„Çπ„ÇØ„É©„ÉÉ„Éó„Éª„Éá„Çπ„Éá„Éº„É¢„É≥","„Çπ„Çø„Éº„ÉÄ„Çπ„Éà„Éª„Éâ„É©„Ç¥„É≥","„Çπ„Çø„Éº„ÉÄ„Çπ„Éà„Éª„Éâ„É©„Ç¥„É≥","„Çπ„Çø„Éº„ÉÄ„Çπ„Éà„Éª„Éâ„É©„Ç¥„É≥","„Éä„ÉÅ„É•„É´„Éª„Ç¨„Ç™„Éâ„É¨„Ç§„ÇØ","„Éä„ÉÅ„É•„É´„Éª„Ç¨„Ç™„Éâ„É¨„Ç§„ÇØ","„Éä„ÉÅ„É•„É´„Éª„Ç¨„Ç™„Éâ„É¨„Ç§„ÇØ"]},{id:-3,name:"„Çµ„É≥„Éó„É´„Éá„ÉÉ„Ç≠Ôºì",deckType:"NPC",description:"",cardNames:["„Ç¢„É≥„Éé„Ç¶„É≥„Éª„Ç∑„É≥„ÇØ„É≠„É≥","ÂÖ≠Ê≠¶Ë°Ü„ÅÆ„ÅîÈö†Â±Ö","„Ç∏„É£„É≥„ÇØ„Éª„Éï„Ç©„Ç¢„Éº„Éâ","„Ç∞„É≠„Éº„Ç¢„ÉÉ„Éó„Éª„Éê„É´„Éñ","„Ç¨„Éº„Éâ„Éª„Ç™„Éñ„Éª„Éï„É¨„É†„Éô„É´","‰ºùË™¨„ÅÆÁôΩÁü≥","‰ºùË™¨„ÅÆÁôΩÁü≥","‰ºùË™¨„ÅÆÁôΩÁü≥","ÂÆàË≠∑Á´ú„É¶„Çπ„ÉÜ„Ç£„Ç¢","„ÇÆ„É£„É©„ÇØ„Ç∑„Éº„Çµ„Éº„Éö„É≥„Éà","„Ç∏„Çß„Éç„ÇØ„Çπ„Éª„Ç≥„É≥„Éà„É≠„Éº„É©„Éº","Ôº•„ÉªÔº®Ôº•Ôº≤ÔºØ „Éï„Çß„Ç∂„Éº„Éû„É≥","Ôº•„ÉªÔº®Ôº•Ôº≤ÔºØ „Éê„Éº„Çπ„Éà„É¨„Éá„Ç£","„ÉÅ„É•„Éº„É≥„Éª„Ç¶„Ç©„É™„Ç¢„Éº","Ôº•„ÉªÔº®Ôº•Ôº≤ÔºØ „ÇØ„É¨„Ç§„Éû„É≥","Ôº•„ÉªÔº®Ôº•Ôº≤ÔºØ „Çπ„Éë„Éº„ÇØ„Éû„É≥","„Åó„ÇÉ„Çä„ÅÆËªçË≤´","„Ç∏„Éß„É≥„Ç∞„É´„Ç∞„Éº„É´„ÅÆÂπªË°ìÂ∏´","„Çæ„É≥„Éì„Éº„Éé","„Ç∏„Çß„Éç„ÉÜ„Ç£„ÉÉ„ÇØ„Éª„ÉØ„Éº„Ç¶„É´„Éï","„É©„Ç§„Éà„É≠„Éº„Éâ„Éª„Éì„Éº„Çπ„Éà „Ç¶„Ç©„É´„Éï","„Çµ„Ç§„Éê„Éº„Éª„Éâ„É©„Ç¥„É≥","„Çµ„Ç§„Éê„Éº„Éª„Éâ„É©„Ç¥„É≥","„Çµ„Ç§„Éê„Éº„Éª„Éâ„É©„Ç¥„É≥","„É©„Éñ„É©„Éâ„É©„Ç§„Éâ„É©„Ç¥„É≥","Ôº§ÔºçÔº®Ôº•Ôº≤ÔºØ „Éá„Ç£„Ç¢„Éú„É™„ÉÉ„ÇØ„Ç¨„Ç§","Ôº§ÔºçÔº®Ôº•Ôº≤ÔºØ „Éá„Ç£„Ç¢„Éú„É™„ÉÉ„ÇØ„Ç¨„Ç§","Ôº§ÔºçÔº®Ôº•Ôº≤ÔºØ „Éá„Ç£„Ç¢„Éú„É™„ÉÉ„ÇØ„Ç¨„Ç§","„Éï„É≠„Çπ„Éà„Ç∂„Ç¶„É´„Çπ","Ôº•„ÉªÔº®Ôº•Ôº≤ÔºØ „Éç„Ç™„Çπ","ÈùíÁúº„ÅÆÁôΩÈæç","ÈùíÁúº„ÅÆÁôΩÈæç","ÈùíÁúº„ÅÆÁôΩÈæç","Ôº•Ôºç„Ç®„Éû„Éº„Ç∏„Çß„É≥„Ç∑„Éº„Ç≥„Éº„É´","„Åä„Çç„Åã„Å™ÂüãËë¨","„Éà„É¨„Éº„Éâ„Éª„Ç§„É≥","„Éà„É¨„Éº„Éâ„Éª„Ç§„É≥","„Éà„É¨„Éº„Éâ„Éª„Ç§„É≥","Èóá„ÅÆÈáèÁî£Â∑•Â†¥","Âº∑Ê¨≤„Å™Â£∫","Âº∑Ê¨≤„Å™Â£∫","Âº∑Ê¨≤„Å™Â£∫","Ê≠ªËÄÖËòáÁîü","Ê≠ªËÄÖËòáÁîü","Ê≠ªËÄÖËòáÁîü","Âè¨ÂñöÂ∏´„ÅÆ„Çπ„Ç≠„É´","Âè¨ÂñöÂ∏´„ÅÆ„Çπ„Ç≠„É´","Âè¨ÂñöÂ∏´„ÅÆ„Çπ„Ç≠„É´","ÊàêÈáë„Ç¥„Éñ„É™„É≥","ÊàêÈáë„Ç¥„Éñ„É™„É≥","ÊàêÈáë„Ç¥„Éñ„É™„É≥","Êà¶Â£´„ÅÆÁîüÈÇÑ","Â¢óÊè¥","Ë™øÂíå„ÅÆÂÆùÊú≠","Ë™øÂíå„ÅÆÂÆùÊú≠","Ë™øÂíå„ÅÆÂÆùÊú≠","Â§©‰Ωø„ÅÆÊñΩ„Åó","Â§©‰Ωø„ÅÆÊñΩ„Åó","Â§©‰Ωø„ÅÆÊñΩ„Åó","Ë≤™Ê¨≤„Å™Â£∫","Ë≤™Ê¨≤„Å™Â£∫","Ë≤™Ê¨≤„Å™Â£∫","„Éû„Ç∏„Ç´„É´„Éª„Ç¢„É≥„Éâ„É≠„Ç§„Éâ","„Éû„Ç∏„Ç´„É´„Éª„Ç¢„É≥„Éâ„É≠„Ç§„Éâ","„Éû„Ç∏„Ç´„É´„Éª„Ç¢„É≥„Éâ„É≠„Ç§„Éâ","Â§ßÂú∞„ÅÆÈ®éÂ£´„Ç¨„Ç§„Ç¢„Éä„Ç§„Éà","Â§ßÂú∞„ÅÆÈ®éÂ£´„Ç¨„Ç§„Ç¢„Éä„Ç§„Éà","Â§ßÂú∞„ÅÆÈ®éÂ£´„Ç¨„Ç§„Ç¢„Éä„Ç§„Éà","„Çπ„ÇØ„É©„ÉÉ„Éó„Éª„Éá„Çπ„Éá„Éº„É¢„É≥","„Çπ„ÇØ„É©„ÉÉ„Éó„Éª„Éá„Çπ„Éá„Éº„É¢„É≥","„Çπ„ÇØ„É©„ÉÉ„Éó„Éª„Éá„Çπ„Éá„Éº„É¢„É≥","„Çπ„Çø„Éº„ÉÄ„Çπ„Éà„Éª„Éâ„É©„Ç¥„É≥","„Çπ„Çø„Éº„ÉÄ„Çπ„Éà„Éª„Éâ„É©„Ç¥„É≥","„Çπ„Çø„Éº„ÉÄ„Çπ„Éà„Éª„Éâ„É©„Ç¥„É≥","„Éä„ÉÅ„É•„É´„Éª„Ç¨„Ç™„Éâ„É¨„Ç§„ÇØ","„Éä„ÉÅ„É•„É´„Éª„Ç¨„Ç™„Éâ„É¨„Ç§„ÇØ","„Éä„ÉÅ„É•„É´„Éª„Ç¨„Ç™„Éâ„É¨„Ç§„ÇØ"]},{id:-9007199254740991,name:"FtkChallenge",deckType:"NPC",description:"FtkChallenge",cardNames:["Â∞ÅÂç∞„Åï„Çå„ÅóËÄÖ„ÅÆÂè≥Ë∂≥","Â∞ÅÂç∞„Åï„Çå„ÅóËÄÖ„ÅÆÂè≥ËÖï","Â∞ÅÂç∞„Åï„Çå„ÅóËÄÖ„ÅÆÂ∑¶Ë∂≥","Â∞ÅÂç∞„Åï„Çå„ÅóËÄÖ„ÅÆÂ∑¶ËÖï","Â∞ÅÂç∞„Åï„Çå„Åó„Ç®„ÇØ„Çæ„Éá„Ç£„Ç¢","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥","„Çπ„Ç´„Ç¥„Éñ„É™„É≥"]},{id:-1e3,name:"Âõ≥Êõ∏È§®„Ç®„ÇØ„Çæ„Éó„É™„Çª„ÉÉ„Éà",deckType:"Preset",description:"„Éó„É™„Çª„ÉÉ„Éà",cardNames:["Â∞ÅÂç∞„Åï„Çå„ÅóËÄÖ„ÅÆÂè≥Ë∂≥","Â∞ÅÂç∞„Åï„Çå„ÅóËÄÖ„ÅÆÂè≥ËÖï","Â∞ÅÂç∞„Åï„Çå„ÅóËÄÖ„ÅÆÂ∑¶Ë∂≥","Â∞ÅÂç∞„Åï„Çå„ÅóËÄÖ„ÅÆÂ∑¶ËÖï","Â∞ÅÂç∞„Åï„Çå„Åó„Ç®„ÇØ„Çæ„Éá„Ç£„Ç¢","ÁéãÁ´ãÈ≠îÊ≥ïÂõ≥Êõ∏È§®","ÁéãÁ´ãÈ≠îÊ≥ïÂõ≥Êõ∏È§®","ÁéãÁ´ãÈ≠îÊ≥ïÂõ≥Êõ∏È§®","Âè¨ÂñöÂÉß„Çµ„É¢„É≥„Éó„É™„Éº„Çπ„Éà","Âè¨ÂñöÂÉß„Çµ„É¢„É≥„Éó„É™„Éº„Çπ„Éà","Âè¨ÂñöÂÉß„Çµ„É¢„É≥„Éó„É™„Éº„Çπ„Éà","„Ç¢„É≥„Ç´„É¢„Éï„É©„Ç§„Éà","„ÉÄ„Éº„ÇØ„Éª„Éê„Éº„Çπ„Éà","„ÉÅ„Ç≠„É≥„É¨„Éº„Çπ","„ÉÅ„Ç≠„É≥„É¨„Éº„Çπ","„ÉÅ„Ç≠„É≥„É¨„Éº„Çπ","„ÉÜ„É©„Éª„Éï„Ç©„Éº„Éü„É≥„Ç∞","„Éà„Ç•„Éº„É≥„Éª„ÉØ„Éº„É´„Éâ","„Éà„Ç•„Éº„É≥„ÅÆ„ÇÇ„Åè„Åò","„Éà„Ç•„Éº„É≥„ÅÆ„ÇÇ„Åè„Åò","„Éà„Ç•„Éº„É≥„ÅÆ„ÇÇ„Åè„Åò","‰∏ÄÊôÇ‰ºëÊà¶","ÈªÑÈáëËâ≤„ÅÆÁ´πÂÖâ","ÈªÑÈáëËâ≤„ÅÆÁ´πÂÖâ","ÈªÑÈáëËâ≤„ÅÆÁ´πÂÖâ","ÊâãÊú≠Êñ≠ÊÆ∫","ÊâãÊú≠Êñ≠ÊÆ∫","ÊâãÊú≠Êñ≠ÊÆ∫","ÁúüÂàÄÁ´πÂÖâ","ÊàêÈáë„Ç¥„Éñ„É™„É≥","ÊàêÈáë„Ç¥„Éñ„É™„É≥","ÊàêÈáë„Ç¥„Éñ„É™„É≥","Êâì„Å°Âá∫„ÅÆÂ∞èÊßå","Êâì„Å°Âá∫„ÅÆÂ∞èÊßå","ÁÑ°„ÅÆÁÖâÁçÑ","ÁÑ°„ÅÆÁÖâÁçÑ","ÁÑ°„ÅÆÁÖâÁçÑ","Â¶ñÂàÄÁ´πÂÖâ","Â¶ñÂàÄÁ´πÂÖâ","Â¶ñÂàÄÁ´πÂÖâ"]}],w=class w{constructor(t,i){s(this,"id");s(this,"name");s(this,"deckType");s(this,"description");s(this,"lastUsedAt");s(this,"cardNames");s(this,"getIllegalCardNames",()=>Array.from(new Set(this.cardNames.filter(t=>!Object.keys(W).includes(t)))));s(this,"getDisableCardNames",()=>Array.from(new Set(this.cardNames.filter(t=>!Object.keys(W).includes(t)))));s(this,"createCardInfos",()=>{const t=this.getIllegalCardNames();if(t.length>0)throw new Error(`Â≠òÂú®„Åó„Å™„ÅÑ„Ç´„Éº„ÉâÂêç„Åã„Çâ„Éá„ÉÉ„Ç≠„ÇíÁîüÊàê„Åó„Çà„ÅÜ„Å®„Åó„Åü„ÄÇ${t}`);return this.cardNames.map(i=>W==null?void 0:W[i]).filter(i=>i)});s(this,"copy",async()=>w.createNewDeck(this.name,this.description,this.cardNames));s(this,"updateTimestamp",async()=>{await w.tblHeader.update(this.id,t=>({...t,lastUsedAt:new Date}))});s(this,"saveDeckInfo",async t=>{const i=t??this;await w.tblHeader.update(this.id,n=>({...n,name:i.name,description:i.description,deckType:"User",lastUsedAt:new Date}));const a=(await w.tblDetail.getAll()).filter(n=>n.deckId===this.id);await w.tblDetail.delete(a.map(n=>n.id));const r=await w.tblDetail.insertMany(i.cardNames.map((n,l)=>({deckId:this.id,seq:l,name:n,description:""})));return new w(await w.tblHeader.get(this.id),r)});s(this,"delete",async()=>{await w.tblHeader.delete([this.id]);const t=(await w.tblDetail.getAll()).filter(i=>i.deckId===this.id);await w.tblDetail.delete(t.map(i=>i.id))});this.id=t.id,this.name=t.name,this.deckType=t.deckType,this.description=t.description,this.lastUsedAt=t.lastUsedAt,this.cardNames=i.filter(a=>a.deckId===this.id).map(a=>a.name)}};s(w,"toJson",t=>{const i=t.map(a=>{const{id:r,name:n,description:l,lastUsedAt:o,cardNames:u}=a;return{id:r,name:n,description:l,lastUsedAt:o,cardNames:u}});return i.forEach(a=>{a.cardNames=a.cardNames.map(r=>W[r]).sort(kt).map(r=>r.name)}),JSON.stringify(i,null,2)}),s(w,"convertToObjectURL",t=>{const i=w.toJson(t),a=new Blob([i],{type:"text/plain"});return window.URL.createObjectURL(a)}),s(w,"idb"),s(w,"tblHeader"),s(w,"tblDetail"),s(w,"getAllDeckInfo",async t=>{if(t&&(w.idb=t),!w.idb)throw new Error("illegal argument: idb is undefined.");w.tblHeader||(w.tblHeader=new kn(w.idb)),w.tblDetail||(w.tblDetail=new En(w.idb));const i=await w.tblHeader.getAll(),a=await w.tblDetail.getAll();return i.length?i.map(r=>new w(r,a)):[await w.prepareSampleDeck()]}),s(w,"createNewDeck",async(t,i,a)=>{const r=await w.tblHeader.insert({name:t,description:i,deckType:"User",lastUsedAt:new Date}),n=await w.tblDetail.insertMany(a.map((l,o)=>({deckId:r.id,seq:o,name:l,description:""})));return new w(r,n)}),s(w,"prepareSampleDeck",async()=>{const t=Xe.find(i=>i.deckType==="Preset")??Xe.slice(-1)[0];return await w.createNewDeck(t.name,t.description,t.cardNames)});let gt=w;class kn extends Ke{constructor(i){super(i,"TblDeckHeader");s(this,"_prepareInitialRecords",()=>[])}}class En extends Ke{constructor(i){super(i,"TblDeckDetail");s(this,"_prepareInitialRecords",()=>[])}}const Xn=Xe.map(e=>({...e,lastUsedAt:new Date})).filter(e=>e.id<0);export{bn as A,dt as B,pt as C,gt as D,Xn as E,Re as F,zn as G,Vn as H,m as S,Zn as a,Fn as b,xn as c,Wi as d,xa as e,Un as f,jn as g,W as h,On as i,Wn as j,Qn as k,Ee as l,$n as m,kt as n,Mn as o,Pn as p,Dn as q,Gn as r,qn as s,Hn as t,Ri as u,Rn as v,Ln as w,Nn as x,Bn as y,An as z};
