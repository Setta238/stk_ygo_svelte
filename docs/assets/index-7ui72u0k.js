var Yn=Object.defineProperty;var Wn=(i,e,t)=>e in i?Yn(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var d=(i,e,t)=>Wn(i,typeof e!="symbol"?e+"":e,t);import{j as Kn}from"./cardInfo.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();const Ta=!1;var Wa=Array.isArray,Xn=Array.prototype.indexOf,Ka=Array.from,jr=Object.defineProperty,ai=Object.getOwnPropertyDescriptor,Ur=Object.getOwnPropertyDescriptors,Qn=Object.prototype,Jn=Array.prototype,Xa=Object.getPrototypeOf;function In(i){return typeof i=="function"}const vt=()=>{};function es(i){return typeof(i==null?void 0:i.then)=="function"}function ts(i){return i()}function ka(i){for(var e=0;e<i.length;e++)i[e]()}const lt=2,Zr=4,ta=8,ia=16,xt=32,Di=64,Gi=128,st=256,zi=512,et=1024,Pt=2048,ui=4096,kt=8192,aa=16384,Gr=32768,ra=65536,zr=1<<17,is=1<<19,Vr=1<<20,Dt=Symbol("$state"),as=Symbol("legacy props"),rs=Symbol("");function Yr(i){return i===this.v}function Wr(i,e){return i!=i?e==e:i!==e||i!==null&&typeof i=="object"||typeof i=="function"}function Qa(i){return!Wr(i,this.v)}function ns(i){throw new Error("https://svelte.dev/e/effect_in_teardown")}function ss(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function ls(i){throw new Error("https://svelte.dev/e/effect_orphan")}function os(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function cs(i){throw new Error("https://svelte.dev/e/props_invalid_value")}function ds(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function us(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function vs(){throw new Error("https://svelte.dev/e/state_unsafe_local_read")}function fs(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let Ei=!1,ps=!1;function hs(){Ei=!0}const Ja=1,Ia=2,Kr=4,gs=8,ys=16,_s=1,ms=2,Ss=4,bs=8,ws=16,Cs=1,Ts=2,ks=4,Ds=1,Es=2,Ve=Symbol();let je=null;function Vi(i){je=i}function We(i,e=!1,t){je={p:je,c:null,e:null,m:!1,s:i,x:null,l:null},Ei&&!e&&(je.l={s:null,u:null,r1:[],r2:Qe(!1)})}function Ke(i){const e=je;if(e!==null){const s=e.e;if(s!==null){var t=De,a=Ae;e.e=null;try{for(var r=0;r<s.length;r++){var n=s[r];ct(n.effect),ot(n.reaction),pi(n.fn)}}finally{ct(t),ot(a)}}je=e.p,e.m=!0}return{}}function vi(){return!Ei||je!==null&&je.l===null}function Qe(i,e){var t={f:0,v:i,reactions:null,equals:Yr,rv:0,wv:0};return t}function As(i){return Xr(Qe(i))}function si(i,e=!1){var a;const t=Qe(i);return e||(t.equals=Qa),Ei&&je!==null&&je.l!==null&&((a=je.l).s??(a.s=[])).push(t),t}function Oe(i,e=!1){return Xr(si(i,e))}function Xr(i){return Ae!==null&&!gt&&Ae.f&lt&&(yt===null?Hs([i]):yt.push(i)),i}function Re(i,e){return te(i,ft(()=>v(i))),e}function te(i,e){return Ae!==null&&!gt&&vi()&&Ae.f&(lt|ia)&&(yt===null||!yt.includes(i))&&fs(),qt(i,e)}function qt(i,e){return i.equals(e)||(i.v,i.v=e,i.wv=hn(),Qr(i,Pt),vi()&&De!==null&&De.f&et&&!(De.f&(xt|Di))&&(bt===null?$s([i]):bt.push(i))),e}function Qr(i,e){var t=i.reactions;if(t!==null)for(var a=vi(),r=t.length,n=0;n<r;n++){var s=t[n],c=s.f;c&Pt||!a&&s===De||(_t(s,e),c&(et|st)&&(c&lt?Qr(s,ui):ca(s)))}}let Jr=!1;function Bt(i,e=null,t){if(typeof i!="object"||i===null||Dt in i)return i;const a=Xa(i);if(a!==Qn&&a!==Jn)return i;var r=new Map,n=Wa(i),s=Qe(0);n&&r.set("length",Qe(i.length));var c;return new Proxy(i,{defineProperty(u,l,o){(!("value"in o)||o.configurable===!1||o.enumerable===!1||o.writable===!1)&&ds();var f=r.get(l);return f===void 0?(f=Qe(o.value),r.set(l,f)):te(f,Bt(o.value,c)),!0},deleteProperty(u,l){var o=r.get(l);if(o===void 0)l in u&&r.set(l,Qe(Ve));else{if(n&&typeof l=="string"){var f=r.get("length"),p=Number(l);Number.isInteger(p)&&p<f.v&&te(f,p)}te(o,Ve),ur(s)}return!0},get(u,l,o){var y;if(l===Dt)return i;var f=r.get(l),p=l in u;if(f===void 0&&(!p||(y=ai(u,l))!=null&&y.writable)&&(f=Qe(Bt(p?u[l]:Ve,c)),r.set(l,f)),f!==void 0){var h=v(f);return h===Ve?void 0:h}return Reflect.get(u,l,o)},getOwnPropertyDescriptor(u,l){var o=Reflect.getOwnPropertyDescriptor(u,l);if(o&&"value"in o){var f=r.get(l);f&&(o.value=v(f))}else if(o===void 0){var p=r.get(l),h=p==null?void 0:p.v;if(p!==void 0&&h!==Ve)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return o},has(u,l){var h;if(l===Dt)return!0;var o=r.get(l),f=o!==void 0&&o.v!==Ve||Reflect.has(u,l);if(o!==void 0||De!==null&&(!f||(h=ai(u,l))!=null&&h.writable)){o===void 0&&(o=Qe(f?Bt(u[l],c):Ve),r.set(l,o));var p=v(o);if(p===Ve)return!1}return f},set(u,l,o,f){var T;var p=r.get(l),h=l in u;if(n&&l==="length")for(var y=o;y<p.v;y+=1){var w=r.get(y+"");w!==void 0?te(w,Ve):y in u&&(w=Qe(Ve),r.set(y+"",w))}p===void 0?(!h||(T=ai(u,l))!=null&&T.writable)&&(p=Qe(void 0),te(p,Bt(o,c)),r.set(l,p)):(h=p.v!==Ve,te(p,Bt(o,c)));var _=Reflect.getOwnPropertyDescriptor(u,l);if(_!=null&&_.set&&_.set.call(f,o),!h){if(n&&typeof l=="string"){var S=r.get("length"),E=Number(l);Number.isInteger(E)&&E>=S.v&&te(S,E+1)}ur(s)}return!0},ownKeys(u){v(s);var l=Reflect.ownKeys(u).filter(p=>{var h=r.get(p);return h===void 0||h.v!==Ve});for(var[o,f]of r)f.v!==Ve&&!(o in u)&&l.push(o);return l},setPrototypeOf(){us()}})}function ur(i,e=1){te(i,i.v+e)}function vr(i){return i!==null&&typeof i=="object"&&Dt in i?i[Dt]:i}function Ir(i,e){return Object.is(vr(i),vr(e))}var fr,en,tn,an;function xs(){if(fr===void 0){fr=window,en=/Firefox/.test(navigator.userAgent);var i=Element.prototype,e=Node.prototype;tn=ai(e,"firstChild").get,an=ai(e,"nextSibling").get,i.__click=void 0,i.__className="",i.__attributes=null,i.__styles=null,i.__e=void 0,Text.prototype.__t=void 0}}function na(i=""){return document.createTextNode(i)}function Yi(i){return tn.call(i)}function sa(i){return an.call(i)}function g(i,e){return Yi(i)}function re(i,e){{var t=Yi(i);return t instanceof Comment&&t.data===""?sa(t):t}}function m(i,e=1,t=!1){let a=i;for(;e--;)a=sa(a);return a}function Ps(i){i.textContent=""}function Wt(i){var e=lt|Pt,t=Ae!==null&&Ae.f&lt?Ae:null;return De===null||t!==null&&t.f&st?e|=st:De.f|=Vr,{ctx:je,deps:null,effects:null,equals:Yr,f:e,fn:i,reactions:null,rv:0,v:null,wv:0,parent:t??De}}function me(i){const e=Wt(i);return e.equals=Qa,e}function rn(i){var e=i.effects;if(e!==null){i.effects=null;for(var t=0;t<e.length;t+=1)Rt(e[t])}}function Ms(i){for(var e=i.parent;e!==null;){if(!(e.f&lt))return e;e=e.parent}return null}function Fs(i){var e,t=De;ct(Ms(i));try{rn(i),e=yn(i)}finally{ct(t)}return e}function nn(i){var e=Fs(i),t=(Nt||i.f&st)&&i.deps!==null?ui:et;_t(i,t),i.equals(e)||(i.v=e,i.wv=hn())}function sn(i){De===null&&Ae===null&&ls(),Ae!==null&&Ae.f&st&&De===null&&ss(),ir&&ns()}function Bs(i,e){var t=e.last;t===null?e.last=e.first=i:(t.next=i,i.prev=t,e.last=i)}function fi(i,e,t,a=!0){var r=(i&Di)!==0,n=De,s={ctx:je,deps:null,nodes_start:null,nodes_end:null,f:i|Pt,first:null,fn:e,last:null,next:null,parent:r?null:n,prev:null,teardown:null,transitions:null,wv:0};if(t){var c=ri;try{hr(!0),ar(s),s.f|=Gr}catch(o){throw Rt(s),o}finally{hr(c)}}else e!==null&&ca(s);var u=t&&s.deps===null&&s.first===null&&s.nodes_start===null&&s.teardown===null&&(s.f&(Vr|Gi))===0;if(!u&&!r&&a&&(n!==null&&Bs(s,n),Ae!==null&&Ae.f&lt)){var l=Ae;(l.effects??(l.effects=[])).push(s)}return s}function er(i){const e=fi(ta,null,!1);return _t(e,et),e.teardown=i,e}function pr(i){sn();var e=De!==null&&(De.f&xt)!==0&&je!==null&&!je.m;if(e){var t=je;(t.e??(t.e=[])).push({fn:i,effect:De,reaction:Ae})}else{var a=pi(i);return a}}function Os(i){return sn(),Ai(i)}function Ns(i){const e=fi(Di,i,!0);return(t={})=>new Promise(a=>{t.outro?Vt(e,()=>{Rt(e),a(void 0)}):(Rt(e),a(void 0))})}function pi(i){return fi(Zr,i,!1)}function Ai(i){return fi(ta,i,!0)}function x(i,e=[],t=Wt){const a=e.map(t);return la(()=>i(...a.map(v)))}function la(i,e=0){return fi(ta|ia|e,i,!0)}function Kt(i,e=!0){return fi(ta|xt,i,!0,e)}function ln(i){var e=i.teardown;if(e!==null){const t=ir,a=Ae;gr(!0),ot(null);try{e.call(null)}finally{gr(t),ot(a)}}}function on(i,e=!1){var t=i.first;for(i.first=i.last=null;t!==null;){var a=t.next;Rt(t,e),t=a}}function qs(i){for(var e=i.first;e!==null;){var t=e.next;e.f&xt||Rt(e),e=t}}function Rt(i,e=!0){var t=!1;if((e||i.f&is)&&i.nodes_start!==null){for(var a=i.nodes_start,r=i.nodes_end;a!==null;){var n=a===r?null:sa(a);a.remove(),a=n}t=!0}on(i,e&&!t),Xi(i,0),_t(i,aa);var s=i.transitions;if(s!==null)for(const u of s)u.stop();ln(i);var c=i.parent;c!==null&&c.first!==null&&cn(i),i.next=i.prev=i.teardown=i.ctx=i.deps=i.fn=i.nodes_start=i.nodes_end=null}function cn(i){var e=i.parent,t=i.prev,a=i.next;t!==null&&(t.next=a),a!==null&&(a.prev=t),e!==null&&(e.first===i&&(e.first=a),e.last===i&&(e.last=t))}function Vt(i,e){var t=[];tr(i,t,!0),dn(t,()=>{Rt(i),e&&e()})}function dn(i,e){var t=i.length;if(t>0){var a=()=>--t||e();for(var r of i)r.out(a)}else e()}function tr(i,e,t){if(!(i.f&kt)){if(i.f^=kt,i.transitions!==null)for(const s of i.transitions)(s.is_global||t)&&e.push(s);for(var a=i.first;a!==null;){var r=a.next,n=(a.f&ra)!==0||(a.f&xt)!==0;tr(a,e,n?t:!1),a=r}}}function li(i){un(i,!0)}function un(i,e){if(i.f&kt){i.f^=kt,i.f&et||(i.f^=et),xi(i)&&(_t(i,Pt),ca(i));for(var t=i.first;t!==null;){var a=t.next,r=(t.f&ra)!==0||(t.f&xt)!==0;un(t,r?e:!1),t=a}if(i.transitions!==null)for(const n of i.transitions)(n.is_global||e)&&n.in()}}let Wi=!1,Da=[];function vn(){Wi=!1;const i=Da.slice();Da=[],ka(i)}function Xt(i){Wi||(Wi=!0,queueMicrotask(vn)),Da.push(i)}function Ls(){Wi&&vn()}const fn=0,Rs=1;let $i=!1,ji=fn,wi=!1,Ci=null,ri=!1,ir=!1;function hr(i){ri=i}function gr(i){ir=i}let Gt=[],ni=0;let Ae=null,gt=!1;function ot(i){Ae=i}let De=null;function ct(i){De=i}let yt=null;function Hs(i){yt=i}let Je=null,tt=0,bt=null;function $s(i){bt=i}let pn=1,Ki=0,Nt=!1,Ot=null;function hn(){return++pn}function xi(i){var f;var e=i.f;if(e&Pt)return!0;if(e&ui){var t=i.deps,a=(e&st)!==0;if(t!==null){var r,n,s=(e&zi)!==0,c=a&&De!==null&&!Nt,u=t.length;if(s||c){var l=i,o=l.parent;for(r=0;r<u;r++)n=t[r],(s||!((f=n==null?void 0:n.reactions)!=null&&f.includes(l)))&&(n.reactions??(n.reactions=[])).push(l);s&&(l.f^=zi),c&&o!==null&&!(o.f&st)&&(l.f^=st)}for(r=0;r<u;r++)if(n=t[r],xi(n)&&nn(n),n.wv>i.wv)return!0}(!a||De!==null&&!Nt)&&_t(i,et)}return!1}function js(i,e){for(var t=e;t!==null;){if(t.f&Gi)try{t.fn(i);return}catch{t.f^=Gi}t=t.parent}throw $i=!1,i}function Us(i){return(i.f&aa)===0&&(i.parent===null||(i.parent.f&Gi)===0)}function oa(i,e,t,a){if($i){if(t===null&&($i=!1),Us(e))throw i;return}t!==null&&($i=!0);{js(i,e);return}}function gn(i,e,t=!0){var a=i.reactions;if(a!==null)for(var r=0;r<a.length;r++){var n=a[r];n.f&lt?gn(n,e,!1):e===n&&(t?_t(n,Pt):n.f&et&&_t(n,ui),ca(n))}}function yn(i){var h;var e=Je,t=tt,a=bt,r=Ae,n=Nt,s=yt,c=je,u=gt,l=i.f;Je=null,tt=0,bt=null,Ae=l&(xt|Di)?null:i,Nt=(l&st)!==0&&(!ri||r===null||u),yt=null,Vi(i.ctx),gt=!1,Ki++;try{var o=(0,i.fn)(),f=i.deps;if(Je!==null){var p;if(Xi(i,tt),f!==null&&tt>0)for(f.length=tt+Je.length,p=0;p<Je.length;p++)f[tt+p]=Je[p];else i.deps=f=Je;if(!Nt)for(p=tt;p<f.length;p++)((h=f[p]).reactions??(h.reactions=[])).push(i)}else f!==null&&tt<f.length&&(Xi(i,tt),f.length=tt);if(vi()&&bt!==null&&!gt&&f!==null&&!(i.f&(lt|ui|Pt)))for(p=0;p<bt.length;p++)gn(bt[p],i);return r!==null&&Ki++,o}finally{Je=e,tt=t,bt=a,Ae=r,Nt=n,yt=s,Vi(c),gt=u}}function Zs(i,e){let t=e.reactions;if(t!==null){var a=Xn.call(t,i);if(a!==-1){var r=t.length-1;r===0?t=e.reactions=null:(t[a]=t[r],t.pop())}}t===null&&e.f&lt&&(Je===null||!Je.includes(e))&&(_t(e,ui),e.f&(st|zi)||(e.f^=zi),rn(e),Xi(e,0))}function Xi(i,e){var t=i.deps;if(t!==null)for(var a=e;a<t.length;a++)Zs(i,t[a])}function ar(i){var e=i.f;if(!(e&aa)){_t(i,et);var t=De,a=je;De=i;try{e&ia?qs(i):on(i),ln(i);var r=yn(i);i.teardown=typeof r=="function"?r:null,i.wv=pn;var n=i.deps,s;Ta&&ps&&i.f&Pt}catch(c){oa(c,i,t,a||i.ctx)}finally{De=t}}}function _n(){if(ni>1e3){ni=0;try{os()}catch(i){if(Ci!==null)oa(i,Ci,null);else throw i}}ni++}function mn(i){var e=i.length;if(e!==0){_n();var t=ri;ri=!0;try{for(var a=0;a<e;a++){var r=i[a];r.f&et||(r.f^=et);var n=Vs(r);Gs(n)}}finally{ri=t}}}function Gs(i){var e=i.length;if(e!==0)for(var t=0;t<e;t++){var a=i[t];if(!(a.f&(aa|kt)))try{xi(a)&&(ar(a),a.deps===null&&a.first===null&&a.nodes_start===null&&(a.teardown===null?cn(a):a.fn=null))}catch(r){oa(r,a,null,a.ctx)}}}function zs(){if(wi=!1,ni>1001)return;const i=Gt;Gt=[],mn(i),wi||(ni=0,Ci=null)}function ca(i){ji===fn&&(wi||(wi=!0,queueMicrotask(zs))),Ci=i;for(var e=i;e.parent!==null;){e=e.parent;var t=e.f;if(t&(Di|xt)){if(!(t&et))return;e.f^=et}}Gt.push(e)}function Vs(i){var e=[],t=i.first;e:for(;t!==null;){var a=t.f,r=(a&xt)!==0,n=r&&(a&et)!==0,s=t.next;if(!n&&!(a&kt)){if(a&Zr)e.push(t);else if(r)t.f^=et;else{var c=Ae;try{Ae=t,xi(t)&&ar(t)}catch(o){oa(o,t,null,t.ctx)}finally{Ae=c}}var u=t.first;if(u!==null){t=u;continue}}if(s===null){let o=t.parent;for(;o!==null;){if(i===o)break e;var l=o.next;if(l!==null){t=l;continue e}o=o.parent}}t=s}return e}function rr(i){var e=ji,t=Gt;try{_n();const r=[];ji=Rs,Gt=r,wi=!1,mn(t);var a=i==null?void 0:i();return Ls(),(Gt.length>0||r.length>0)&&rr(),ni=0,Ci=null,a}finally{ji=e,Gt=t}}async function Ys(){await Promise.resolve(),rr()}function v(i){var e=i.f,t=(e&lt)!==0;if(Ot!==null&&Ot.add(i),Ae!==null&&!gt){yt!==null&&yt.includes(i)&&vs();var a=Ae.deps;i.rv<Ki&&(i.rv=Ki,Je===null&&a!==null&&a[tt]===i?tt++:Je===null?Je=[i]:(!Nt||!Je.includes(i))&&Je.push(i))}else if(t&&i.deps===null&&i.effects===null){var r=i,n=r.parent;n!==null&&!(n.f&st)&&(r.f^=st)}return t&&(r=i,xi(r)&&nn(r)),i.v}function Ws(i){var e=Ot;Ot=new Set;var t=Ot,a;try{if(ft(i),e!==null)for(a of Ot)e.add(a)}finally{Ot=e}return t}function Ui(i){var e=Ws(()=>ft(i));for(var t of e)if(t.f&zr)for(const a of t.deps||[])a.f&lt||qt(a,a.v);else qt(t,t.v)}function ft(i){var e=gt;try{return gt=!0,i()}finally{gt=e}}const Ks=-7169;function _t(i,e){i.f=i.f&Ks|e}function Xs(i){if(!(typeof i!="object"||!i||i instanceof EventTarget)){if(Dt in i)Ea(i);else if(!Array.isArray(i))for(let e in i){const t=i[e];typeof t=="object"&&t&&Dt in t&&Ea(t)}}}function Ea(i,e=new Set){if(typeof i=="object"&&i!==null&&!(i instanceof EventTarget)&&!e.has(i)){e.add(i),i instanceof Date&&i.getTime();for(let a in i)try{Ea(i[a],e)}catch{}const t=Xa(i);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const a=Ur(t);for(let r in a){const n=a[r].get;if(n)try{n.call(i)}catch{}}}}}const Qs=["touchstart","touchmove"];function Js(i){return Qs.includes(i)}let yr=!1;function Is(){yr||(yr=!0,document.addEventListener("reset",i=>{Promise.resolve().then(()=>{var e;if(!i.defaultPrevented)for(const t of i.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function nr(i){var e=Ae,t=De;ot(null),ct(null);try{return i()}finally{ot(e),ct(t)}}function da(i,e,t,a=t){i.addEventListener(e,()=>nr(t));const r=i.__on_r;r?i.__on_r=()=>{r(),a(!0)}:i.__on_r=()=>a(!0),Is()}const Sn=new Set,Aa=new Set;function el(i,e,t,a={}){function r(n){if(a.capture||hi.call(e,n),!n.cancelBubble)return nr(()=>t==null?void 0:t.call(this,n))}return i.startsWith("pointer")||i.startsWith("touch")||i==="wheel"?Xt(()=>{e.addEventListener(i,r,a)}):e.addEventListener(i,r,a),r}function Le(i,e,t,a,r){var n={capture:a,passive:r},s=el(i,e,t,n);(e===document.body||e===window||e===document)&&er(()=>{e.removeEventListener(i,s,n)})}function Pi(i){for(var e=0;e<i.length;e++)Sn.add(i[e]);for(var t of Aa)t(i)}function hi(i){var E;var e=this,t=e.ownerDocument,a=i.type,r=((E=i.composedPath)==null?void 0:E.call(i))||[],n=r[0]||i.target,s=0,c=i.__root;if(c){var u=r.indexOf(c);if(u!==-1&&(e===document||e===window)){i.__root=e;return}var l=r.indexOf(e);if(l===-1)return;u<=l&&(s=u)}if(n=r[s]||i.target,n!==e){jr(i,"currentTarget",{configurable:!0,get(){return n||t}});var o=Ae,f=De;ot(null),ct(null);try{for(var p,h=[];n!==null;){var y=n.assignedSlot||n.parentNode||n.host||null;try{var w=n["__"+a];if(w!==void 0&&!n.disabled)if(Wa(w)){var[_,...S]=w;_.apply(n,[i,...S])}else w.call(n,i)}catch(T){p?h.push(T):p=T}if(i.cancelBubble||y===e||y===null)break;n=y}if(p){for(let T of h)queueMicrotask(()=>{throw T});throw p}}finally{i.__root=e,delete i.currentTarget,ot(o),ct(f)}}}function tl(i){var e=document.createElement("template");return e.innerHTML=i,e.content}function Qi(i,e){var t=De;t.nodes_start===null&&(t.nodes_start=i,t.nodes_end=e)}function C(i,e){var t=(e&Ds)!==0,a=(e&Es)!==0,r,n=!i.startsWith("<!>");return()=>{r===void 0&&(r=tl(n?i:"<!>"+i),t||(r=Yi(r)));var s=a||en?document.importNode(r,!0):r.cloneNode(!0);if(t){var c=Yi(s),u=s.lastChild;Qi(c,u)}else Qi(s,s);return s}}function Zt(i=""){{var e=na(i+"");return Qi(e,e),e}}function Fe(){var i=document.createDocumentFragment(),e=document.createComment(""),t=na();return i.append(e,t),Qi(e,t),i}function b(i,e){i!==null&&i.before(e)}let xa=!0;function D(i,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(i.__t??(i.__t=i.nodeValue))&&(i.__t=t,i.nodeValue=t+"")}function il(i,e){return al(i,e)}const Jt=new Map;function al(i,{target:e,anchor:t,props:a={},events:r,context:n,intro:s=!0}){xs();var c=new Set,u=f=>{for(var p=0;p<f.length;p++){var h=f[p];if(!c.has(h)){c.add(h);var y=Js(h);e.addEventListener(h,hi,{passive:y});var w=Jt.get(h);w===void 0?(document.addEventListener(h,hi,{passive:y}),Jt.set(h,1)):Jt.set(h,w+1)}}};u(Ka(Sn)),Aa.add(u);var l=void 0,o=Ns(()=>{var f=t??e.appendChild(na());return Kt(()=>{if(n){We({});var p=je;p.c=n}r&&(a.$$events=r),xa=s,l=i(f,a)||{},xa=!0,n&&Ke()}),()=>{var y;for(var p of c){e.removeEventListener(p,hi);var h=Jt.get(p);--h===0?(document.removeEventListener(p,hi),Jt.delete(p)):Jt.set(p,h)}Aa.delete(u),f!==t&&((y=f.parentNode)==null||y.removeChild(f))}});return rl.set(l,o),l}let rl=new WeakMap;const _a=0,Ni=1,ma=2;function yi(i,e,t,a,r){var n=i,s=vi(),c=je,u=Ve,l,o,f,p=(s?Qe:si)(void 0),h=(s?Qe:si)(void 0),y=!1;function w(S,E){y=!0,E&&(ct(_),ot(_),Vi(c));try{S===_a&&t&&(l?li(l):l=Kt(()=>t(n))),S===Ni&&a&&(o?li(o):o=Kt(()=>a(n,p))),S!==_a&&l&&Vt(l,()=>l=null),S!==Ni&&o&&Vt(o,()=>o=null),S!==ma&&f&&Vt(f,()=>f=null)}finally{E&&(Vi(null),ot(null),ct(null),rr())}}var _=la(()=>{if(u!==(u=e())){if(es(u)){var S=u;y=!1,S.then(E=>{S===u&&(qt(p,E),w(Ni,!0))},E=>{if(S===u)throw qt(h,E),w(ma,!0),h.v}),Xt(()=>{y||w(_a,!0)})}else qt(p,u),w(Ni,!1);return()=>u=Ve}})}function j(i,e,t=!1){var a=i,r=null,n=null,s=Ve,c=t?ra:0,u=!1;const l=(f,p=!0)=>{u=!0,o(p,f)},o=(f,p)=>{s!==(s=f)&&(s?(r?li(r):p&&(r=Kt(()=>p(a))),n&&Vt(n,()=>{n=null})):(n?li(n):p&&(n=Kt(()=>p(a))),r&&Vt(r,()=>{r=null})))};la(()=>{u=!1,e(l),u||o(null,null)},c)}function ue(i,e){return e}function nl(i,e,t,a){for(var r=[],n=e.length,s=0;s<n;s++)tr(e[s].e,r,!0);var c=n>0&&r.length===0&&t!==null;if(c){var u=t.parentNode;Ps(u),u.append(t),a.clear(),Mt(i,e[0].prev,e[n-1].next)}dn(r,()=>{for(var l=0;l<n;l++){var o=e[l];c||(a.delete(o.k),Mt(i,o.prev,o.next)),Rt(o.e,!c)}})}function ve(i,e,t,a,r,n=null){var s=i,c={flags:e,items:new Map,first:null},u=(e&Kr)!==0;if(u){var l=i;s=l.appendChild(na())}var o=null,f=!1,p=me(()=>{var h=t();return Wa(h)?h:h==null?[]:Ka(h)});la(()=>{var h=v(p),y=h.length;f&&y===0||(f=y===0,sl(h,c,s,r,e,a,t),n!==null&&(y===0?o?li(o):o=Kt(()=>n(s)):o!==null&&Vt(o,()=>{o=null})),v(p))})}function sl(i,e,t,a,r,n,s){var ie,M,k,H;var c=(r&gs)!==0,u=(r&(Ja|Ia))!==0,l=i.length,o=e.items,f=e.first,p=f,h,y=null,w,_=[],S=[],E,T,N,$;if(c)for($=0;$<l;$+=1)E=i[$],T=n(E,$),N=o.get(T),N!==void 0&&((ie=N.a)==null||ie.measure(),(w??(w=new Set)).add(N));for($=0;$<l;$+=1){if(E=i[$],T=n(E,$),N=o.get(T),N===void 0){var P=p?p.e.nodes_start:t;y=ol(P,e,y,y===null?e.first:y.next,E,T,$,a,r,s),o.set(T,y),_=[],S=[],p=y.next;continue}if(u&&ll(N,E,$,r),N.e.f&kt&&(li(N.e),c&&((M=N.a)==null||M.unfix(),(w??(w=new Set)).delete(N))),N!==p){if(h!==void 0&&h.has(N)){if(_.length<S.length){var G=S[0],A;y=G.prev;var fe=_[0],V=_[_.length-1];for(A=0;A<_.length;A+=1)_r(_[A],G,t);for(A=0;A<S.length;A+=1)h.delete(S[A]);Mt(e,fe.prev,V.next),Mt(e,y,fe),Mt(e,V,G),p=G,y=V,$-=1,_=[],S=[]}else h.delete(N),_r(N,p,t),Mt(e,N.prev,N.next),Mt(e,N,y===null?e.first:y.next),Mt(e,y,N),y=N;continue}for(_=[],S=[];p!==null&&p.k!==T;)p.e.f&kt||(h??(h=new Set)).add(p),S.push(p),p=p.next;if(p===null)continue;N=p}_.push(N),y=N,p=N.next}if(p!==null||h!==void 0){for(var I=h===void 0?[]:Ka(h);p!==null;)p.e.f&kt||I.push(p),p=p.next;var we=I.length;if(we>0){var Ue=r&Kr&&l===0?t:null;if(c){for($=0;$<we;$+=1)(k=I[$].a)==null||k.measure();for($=0;$<we;$+=1)(H=I[$].a)==null||H.fix()}nl(e,I,Ue,o)}}c&&Xt(()=>{var Q;if(w!==void 0)for(N of w)(Q=N.a)==null||Q.apply()}),De.first=e.first&&e.first.e,De.last=y&&y.e}function ll(i,e,t,a){a&Ja&&qt(i.v,e),a&Ia?qt(i.i,t):i.i=t}function ol(i,e,t,a,r,n,s,c,u,l){var o=(u&Ja)!==0,f=(u&ys)===0,p=o?f?si(r):Qe(r):r,h=u&Ia?Qe(s):s,y={i:h,v:p,k:n,a:null,e:null,prev:t,next:a};try{return y.e=Kt(()=>c(i,p,h,l),Jr),y.e.prev=t&&t.e,y.e.next=a&&a.e,t===null?e.first=y:(t.next=y,t.e.next=y.e),a!==null&&(a.prev=y,a.e.prev=y.e),y}finally{}}function _r(i,e,t){for(var a=i.next?i.next.e.nodes_start:t,r=e?e.e.nodes_start:t,n=i.e.nodes_start;n!==a;){var s=sa(n);r.before(n),n=s}}function Mt(i,e,t){e===null?i.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function bn(i){var e,t,a="";if(typeof i=="string"||typeof i=="number")a+=i;else if(typeof i=="object")if(Array.isArray(i)){var r=i.length;for(e=0;e<r;e++)i[e]&&(t=bn(i[e]))&&(a&&(a+=" "),a+=t)}else for(t in i)i[t]&&(a&&(a+=" "),a+=t);return a}function cl(){for(var i,e,t=0,a="",r=arguments.length;t<r;t++)(i=arguments[t])&&(e=bn(i))&&(a&&(a+=" "),a+=e);return a}function It(i){return typeof i=="object"?cl(i):i??""}function Et(i,e,t,a){var r=i.__attributes??(i.__attributes={});r[e]!==(r[e]=t)&&(e==="style"&&"__styles"in i&&(i.__styles={}),e==="loading"&&(i[rs]=t),t==null?i.removeAttribute(e):typeof t!="string"&&dl(i).includes(e)?i[e]=t:i.setAttribute(e,t))}var mr=new Map;function dl(i){var e=mr.get(i.nodeName);if(e)return e;mr.set(i.nodeName,e=[]);for(var t,a=i,r=Element.prototype;r!==a;){t=Ur(a);for(var n in t)t[n].set&&e.push(n);a=Xa(a)}return e}function _e(i,e,t){var a=i.__className,r=ul(e,t);(a!==r||Jr)&&(e==null&&!t?i.removeAttribute("class"):i.className=r,i.__className=r)}function ul(i,e){return(i??"")+(e?" "+e:"")}const vl=()=>performance.now(),Ct={tick:i=>requestAnimationFrame(i),now:()=>vl(),tasks:new Set};function wn(){const i=Ct.now();Ct.tasks.forEach(e=>{e.c(i)||(Ct.tasks.delete(e),e.f())}),Ct.tasks.size!==0&&Ct.tick(wn)}function fl(i){let e;return Ct.tasks.size===0&&Ct.tick(wn),{promise:new Promise(t=>{Ct.tasks.add(e={c:i,f:t})}),abort(){Ct.tasks.delete(e)}}}function qi(i,e){nr(()=>{i.dispatchEvent(new CustomEvent(e))})}function pl(i){if(i==="float")return"cssFloat";if(i==="offset")return"cssOffset";if(i.startsWith("--"))return i;const e=i.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function Sr(i){const e={},t=i.split(";");for(const a of t){const[r,n]=a.split(":");if(!r||n===void 0)break;const s=pl(r.trim());e[s]=n.trim()}return e}const hl=i=>i;function ei(i,e,t,a){var r=(i&Cs)!==0,n=(i&Ts)!==0,s=r&&n,c=(i&ks)!==0,u=s?"both":r?"in":"out",l,o=e.inert,f=e.style.overflow,p,h;function y(){var T=Ae,N=De;ot(null),ct(null);try{return l??(l=t()(e,(a==null?void 0:a())??{},{direction:u}))}finally{ot(T),ct(N)}}var w={is_global:c,in(){var T;if(e.inert=o,!r){h==null||h.abort(),(T=h==null?void 0:h.reset)==null||T.call(h);return}n||p==null||p.abort(),qi(e,"introstart"),p=Pa(e,y(),h,1,()=>{qi(e,"introend"),p==null||p.abort(),p=l=void 0,e.style.overflow=f})},out(T){if(!n){T==null||T(),l=void 0;return}e.inert=!0,qi(e,"outrostart"),h=Pa(e,y(),p,0,()=>{qi(e,"outroend"),T==null||T()})},stop:()=>{p==null||p.abort(),h==null||h.abort()}},_=De;if((_.transitions??(_.transitions=[])).push(w),r&&xa){var S=c;if(!S){for(var E=_.parent;E&&E.f&ra;)for(;(E=E.parent)&&!(E.f&ia););S=!E||(E.f&Gr)!==0}S&&pi(()=>{ft(()=>w.in())})}}function Pa(i,e,t,a,r){var n=a===1;if(In(e)){var s,c=!1;return Xt(()=>{if(!c){var _=e({direction:n?"in":"out"});s=Pa(i,_,t,a,r)}}),{abort:()=>{c=!0,s==null||s.abort()},deactivate:()=>s.deactivate(),reset:()=>s.reset(),t:()=>s.t()}}if(t==null||t.deactivate(),!(e!=null&&e.duration))return r(),{abort:vt,deactivate:vt,reset:vt,t:()=>a};const{delay:u=0,css:l,tick:o,easing:f=hl}=e;var p=[];if(n&&t===void 0&&(o&&o(0,1),l)){var h=Sr(l(0,1));p.push(h,h)}var y=()=>1-a,w=i.animate(p,{duration:u});return w.onfinish=()=>{var _=(t==null?void 0:t.t())??1-a;t==null||t.abort();var S=a-_,E=e.duration*Math.abs(S),T=[];if(E>0){var N=!1;if(l)for(var $=Math.ceil(E/16.666666666666668),P=0;P<=$;P+=1){var G=_+S*f(P/$),A=Sr(l(G,1-G));T.push(A),N||(N=A.overflow==="hidden")}N&&(i.style.overflow="hidden"),y=()=>{var fe=w.currentTime;return _+S*f(fe/E)},o&&fl(()=>{if(w.playState!=="running")return!1;var fe=y();return o(fe,1-fe),!0})}w=i.animate(T,{duration:E,fill:"forwards"}),w.onfinish=()=>{y=()=>a,o==null||o(a,1-a),r()}},{abort:()=>{w&&(w.cancel(),w.effect=null,w.onfinish=vt)},deactivate:()=>{r=vt},reset:()=>{a===0&&(o==null||o(1,0))},t:()=>y()}}function Ma(i,e,t=e){var a=vi();da(i,"input",r=>{var n=r?i.defaultValue:i.value;if(n=ba(i)?wa(n):n,t(n),a&&n!==(n=e())){var s=i.selectionStart,c=i.selectionEnd;i.value=n??"",c!==null&&(i.selectionStart=s,i.selectionEnd=Math.min(c,i.value.length))}}),ft(e)==null&&i.value&&t(ba(i)?wa(i.value):i.value),Ai(()=>{var r=e();ba(i)&&r===wa(i.value)||i.type==="date"&&!r&&!i.value||r!==i.value&&(i.value=r??"")})}const Sa=new Set;function ti(i,e,t,a,r=a){var n=t.getAttribute("type")==="checkbox",s=i;if(e!==null)for(var c of e)s=s[c]??(s[c]=[]);s.push(t),da(t,"change",()=>{var u=t.__value;n&&(u=yl(s,u,t.checked)),r(u)},()=>r(n?[]:null)),Ai(()=>{var u=a();n?(u=u||[],t.checked=u.includes(t.__value)):t.checked=Ir(t.__value,u)}),er(()=>{var u=s.indexOf(t);u!==-1&&s.splice(u,1)}),Sa.has(s)||(Sa.add(s),Xt(()=>{s.sort((u,l)=>u.compareDocumentPosition(l)===4?-1:1),Sa.delete(s)})),Xt(()=>{})}function gl(i,e,t=e){da(i,"change",a=>{var r=a?i.defaultChecked:i.checked;t(r)}),ft(e)==null&&t(i.checked),Ai(()=>{var a=e();i.checked=!!a})}function yl(i,e,t){for(var a=new Set,r=0;r<i.length;r+=1)i[r].checked&&a.add(i[r].__value);return t||a.delete(e),Array.from(a)}function ba(i){var e=i.type;return e==="number"||e==="range"}function wa(i){return i===""?null:+i}function Cn(i,e,t){if(i.multiple)return ml(i,e);for(var a of i.options){var r=_i(a);if(Ir(r,e)){a.selected=!0;return}}(!t||e!==void 0)&&(i.selectedIndex=-1)}function _l(i,e){pi(()=>{var t=new MutationObserver(()=>{var a=i.__value;Cn(i,a)});return t.observe(i,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{t.disconnect()}})}function Zi(i,e,t=e){var a=!0;da(i,"change",r=>{var n=r?"[selected]":":checked",s;if(i.multiple)s=[].map.call(i.querySelectorAll(n),_i);else{var c=i.querySelector(n)??i.querySelector("option:not([disabled])");s=c&&_i(c)}t(s)}),pi(()=>{var r=e();if(Cn(i,r,a),a&&r===void 0){var n=i.querySelector(":checked");n!==null&&(r=_i(n),t(r))}i.__value=r,a=!1}),_l(i)}function ml(i,e){for(var t of i.options)t.selected=~e.indexOf(_i(t))}function _i(i){return"__value"in i?i.__value:i.value}function br(i,e){return i===e||(i==null?void 0:i[Dt])===e}function Sl(i={},e,t,a){return pi(()=>{var r,n;return Ai(()=>{r=n,n=[],ft(()=>{i!==t(...n)&&(e(i,...n),r&&br(t(...r),i)&&e(null,...r))})}),()=>{Xt(()=>{n&&br(t(...n),i)&&e(null,...n)})}}),i}function it(i=!1){const e=je,t=e.l.u;if(!t)return;let a=()=>Xs(e.s);if(i){let r=0,n={};const s=Wt(()=>{let c=!1;const u=e.s;for(const l in u)u[l]!==n[l]&&(n[l]=u[l],c=!0);return c&&r++,r});a=()=>v(s)}t.b.length&&Os(()=>{wr(e,a),ka(t.b)}),pr(()=>{const r=ft(()=>t.m.map(ts));return()=>{for(const n of r)typeof n=="function"&&n()}}),t.a.length&&pr(()=>{wr(e,a),ka(t.a)})}function wr(i,e){if(i.l.s)for(const t of i.l.s)v(t);e()}function Tn(i,e,t){if(i==null)return e(void 0),vt;const a=ft(()=>i.subscribe(e,t));return a.unsubscribe?()=>a.unsubscribe():a}const ii=[];function bl(i,e=vt){let t=null;const a=new Set;function r(c){if(Wr(i,c)&&(i=c,t)){const u=!ii.length;for(const l of a)l[1](),ii.push(l,i);if(u){for(let l=0;l<ii.length;l+=2)ii[l][0](ii[l+1]);ii.length=0}}}function n(c){r(c(i))}function s(c,u=vt){const l=[c,u];return a.add(l),a.size===1&&(t=e(r,n)||vt),c(i),()=>{a.delete(l),a.size===0&&t&&(t(),t=null)}}return{set:r,update:n,subscribe:s}}function wl(i){let e;return Tn(i,t=>e=t)(),e}let Li=!1,Fa=Symbol();function Cl(i,e,t){const a=t[e]??(t[e]={store:null,source:si(void 0),unsubscribe:vt});if(a.store!==i&&!(Fa in t))if(a.unsubscribe(),a.store=i??null,i==null)a.source.v=void 0,a.unsubscribe=vt;else{var r=!0;a.unsubscribe=Tn(i,n=>{r?a.source.v=n:te(a.source,n)}),r=!1}return i&&Fa in t?wl(i):v(a.source)}function Tl(){const i={};function e(){er(()=>{for(var t in i)i[t].unsubscribe();jr(i,Fa,{enumerable:!1,value:!0})})}return[i,e]}function kl(i){var e=Li;try{return Li=!1,[i(),Li]}finally{Li=e}}function Ee(i,e,t,a){var G;var r=(t&_s)!==0,n=!Ei||(t&ms)!==0,s=(t&bs)!==0,c=(t&ws)!==0,u=!1,l;s?[l,u]=kl(()=>i[e]):l=i[e];var o=Dt in i||as in i,f=s&&(((G=ai(i,e))==null?void 0:G.set)??(o&&e in i&&(A=>i[e]=A)))||void 0,p=a,h=!0,y=!1,w=()=>(y=!0,h&&(h=!1,c?p=ft(a):p=a),p);l===void 0&&a!==void 0&&(f&&n&&cs(),l=w(),f&&f(l));var _;if(n)_=()=>{var A=i[e];return A===void 0?w():(h=!0,y=!1,A)};else{var S=(r?Wt:me)(()=>i[e]);S.f|=zr,_=()=>{var A=v(S);return A!==void 0&&(p=void 0),A===void 0?p:A}}if(!(t&Ss))return _;if(f){var E=i.$$legacy;return function(A,fe){return arguments.length>0?((!n||!fe||E||u)&&f(fe?_():A),A):_()}}var T=!1,N=!1,$=si(l),P=Wt(()=>{var A=_(),fe=v($);return T?(T=!1,N=!0,fe):(N=!1,$.v=A)});return r||(P.equals=Qa),function(A,fe){if(Ot!==null&&(T=N,_(),v($)),arguments.length>0){const V=fe?v(P):n&&s?Bt(A):A;return P.equals(V)||(T=!0,te($,V),y&&p!==void 0&&(p=V),ft(()=>v(P))),A}return v(P)}}const Dl="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Dl);hs();class El{constructor(e,t,a){d(this,"_dbname");d(this,"_dbversion");d(this,"dbPromise");d(this,"getTran",async(e,t)=>(await this.dbPromise).transaction(e,t));d(this,"reset",async()=>(await indexedDB.databases().then(e=>{console.log(e)}),await new Promise((e,t)=>{const a=indexedDB.deleteDatabase(this._dbname);a.onsuccess=()=>{console.log("onsuccess"),e()},a.onerror=r=>{console.log("onerror"),t(r)}})));d(this,"getAll",async e=>{const t=await this.dbPromise;return new Promise((a,r)=>{const c=t.transaction([e],"readonly").objectStore(e).getAll();c.onsuccess=()=>{a(c.result)},c.onerror=u=>{r(u)}})});d(this,"get",async(e,t)=>{const a=await this.dbPromise;return new Promise((r,n)=>{const u=a.transaction([e],"readonly").objectStore(e).get(t);u.onsuccess=()=>{r(u.result)},u.onerror=l=>{n(l)}})});d(this,"getMany",async(e,t)=>{const n=(await this.dbPromise).transaction([e],"readonly").objectStore(e),s=t.map(c=>new Promise((u,l)=>{const o=n.get(c);o.onsuccess=()=>{u(o.result)},o.onerror=f=>{l(f)}}));return await Promise.all(s)});d(this,"putRecords",async(e,t)=>{const r=(await this.dbPromise).transaction([e],"readwrite"),n=r.objectStore(e),s=t.map(c=>({record:c,request:n.put(c)}));return new Promise((c,u)=>{r.oncomplete=()=>c(s.map(l=>Object.assign({id:l.request.result},l.record))),r.onerror=l=>u(l)})});d(this,"deleteRecords",async(e,t)=>{const r=(await this.dbPromise).transaction([e],"readwrite"),n=r.objectStore(e),s=t.map(c=>({key:c,request:n.delete(c)}));return new Promise((c,u)=>{r.oncomplete=()=>{console.log(s.map(l=>l.request.result)),c()},r.onerror=l=>u(l)})});this._dbname=e,this._dbversion=t,this.dbPromise=new Promise((r,n)=>{const s=indexedDB.open(e,t);s.onsuccess=c=>{if(console.log(c),!c.target){console.log("event.target is undefined"),n("event.target is undefined");return}const u=c.target.result;if(!u){console.log("event.target.result is undefined"),n("event.target.result is undefined");return}u.onversionchange=l=>{console.log(l),u.close()},r(u)},s.onupgradeneeded=c=>{console.log("onupgradeneeded");const u=c.target.result;a.filter(l=>!u.objectStoreNames.contains(l)).map(l=>u.createObjectStore(l,{keyPath:"id",autoIncrement:!0}))},s.onerror=c=>{console.log(c),n(c)},s.onblocked=c=>{console.log(c),n(c)}}),console.log(this.dbPromise)}get dbversion(){return this._dbversion}}class ze{constructor(){d(this,"handlers",[])}append(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}trigger(e){this.handlers.slice(0).filter(t=>t(e)==="RemoveMe").forEach(t=>this.remove(t))}clear(){this.handlers.splice(0)}expose(){return this}}class Cr{constructor(){d(this,"handler")}set(e){this.handler=e}async call(e){if(!this.handler)throw Error("illegal state error");return await this.handler(e)}expose(){return this}}class sr{constructor(e,t,a,r){d(this,"_name");d(this,"_createVersion");d(this,"mountResolver",()=>{});d(this,"_indexedDb");d(this,"onInsertEvent",new ze);d(this,"onBeforeInsertEvent",new Cr);d(this,"onUpdateEvent",new ze);d(this,"onBeforeUpdateEvent",new Cr);d(this,"onDeleteEvent",new ze);d(this,"prepareInitialRecords",()=>{const e=new Date;return this._prepareInitialRecords().map(t=>Object.assign(t,{createdAt:e,updatedAt:e,dbVersion:this._createVersion}))});d(this,"resolveMount",()=>this.mountResolver());d(this,"patchForInsert",(e,t)=>{e.newRecords.forEach(a=>{t[a.id]=a})});d(this,"patchForUpdate",(e,t)=>{e.recordPairs.forEach(a=>{t[a.newRecord.id]={...a.newRecord}})});d(this,"patchForDelete",(e,t)=>{e.oldRecords.forEach(a=>{delete t[a.id]})});this._indexedDb=e,this._name=t,this._createVersion=e.dbversion,this.getAll().then(n=>n.reduce((s,c)=>(s[c.id]=c,s),{})).then(n=>{console.log(this.name,n),this.onBeforeInsertEvent.set(a??(()=>Promise.resolve())),this.onBeforeUpdateEvent.set(r??(()=>Promise.resolve()))})}get name(){return this._name}get createVersion(){return this._createVersion}get oninsert(){return this.onInsertEvent.expose()}get onbeforeinsert(){return this.onBeforeInsertEvent.expose()}get onupdate(){return this.onUpdateEvent.expose()}get onbeforeupdate(){return this.onBeforeUpdateEvent.expose()}get ondelete(){return this.onDeleteEvent.expose()}getAll(){return this._indexedDb.getAll(this.name)}get(e){return this._indexedDb.get(this.name,e)}async insertMany(e){const t=new Date,a=e.map(n=>{const s={createdAt:t,updatedAt:t,dbVersion:this._createVersion};return Object.assign(n,s)});await this.onBeforeInsertEvent.call({sender:this,newRecords:a,timestamp:t});const r=await this._indexedDb.putRecords(this.name,a);return this.onInsertEvent.trigger({sender:this,newRecords:r,timestamp:t}),r}async insert(e){return(await this.insertMany([e]))[0]}async updateMany(e,t){const a=new Date,r=[];return(await this._indexedDb.getMany(this.name,e)).forEach(s=>{const c={...s},u={...c};r.push({newRecord:Object.assign(t(u),{updatedAt:a,dbVersion:this._createVersion}),oldRecord:c})}),await this.onBeforeUpdateEvent.call({sender:this,recordPairs:r,timestamp:a}),await this._indexedDb.putRecords(this.name,r.map(s=>s.newRecord)),this.onUpdateEvent.trigger({sender:this,recordPairs:r,timestamp:a}),r.map(s=>s.newRecord)}async update(e,t){return(await this.updateMany([e],t))[0]}async delete(e){const t=new Date,a=await this._indexedDb.getMany(this.name,e);await this._indexedDb.deleteRecords(this.name,e),this.onDeleteEvent.trigger({sender:this,oldRecords:a,timestamp:t})}}const Tr=(...i)=>i.length?i.reduce((e,t)=>e>t?e:t):-Number.MAX_VALUE,Ba=(...i)=>i.length?i.reduce((e,t)=>e<t?e:t):Number.MAX_VALUE,rt=class rt{constructor(e){d(this,"id");d(this,"name");d(this,"description");d(this,"previousNpcId");d(this,"previousStartMode");d(this,"save",async e=>{const t=e??{id:this.id,name:this.name,description:this.description,previousNpcId:this.previousNpcId,previousStartMode:this.previousStartMode},a=await rt.tblHeader.update(this.id,r=>({...r,...t}));return new rt(a)});var t;console.log(e),this.id=e.id,this.name=e.name,this.description=e.description,this.previousNpcId=((t=mi.find(a=>a.id===e.previousNpcId))==null?void 0:t.id)??Ba(...mi.map(a=>a.id)),this.previousStartMode=Ro.includes(e.previousStartMode)?e.previousStartMode:"Random"}get npcLvl(){return Number.MAX_VALUE}};d(rt,"tblHeader"),d(rt,"getOrCreateNew",async e=>{rt.tblHeader||(rt.tblHeader=new Al(e));const t=await rt.tblHeader.getAll();if(t.length)return new rt(t[0]);const a=await rt.tblHeader.insert({name:"ã‚ãªãŸ",description:"ã“ã“ã®æ–‡å­—åˆ—ã‚’ä½•ã«ä½¿ã†ã‹ã¯æœªå®šã€‚",previousNpcId:0,previousStartMode:"Random"});return new rt(a)});let Oa=rt;class Al extends sr{constructor(t){super(t,"TblDuelistProfile");d(this,"_prepareInitialRecords",()=>[])}}let Ca=-1;const mi=[{id:Ca--,name:"ã‚µãƒ³ãƒ‰ãƒãƒƒã‚°ãã‚“æ£’ç«‹ã¡",description:"æ”»æ’ƒå®£è¨€ãªã—ã€å¼·åˆ¶åŠ¹æžœä»¥å¤–ã®åŠ¹æžœã®ç™ºå‹•ãªã—ã€‚",npcLvl:0},{id:Ca--,name:"ã‚µãƒ³ãƒ‰ãƒãƒƒã‚°ãã‚“éžæš´åŠ›",description:"æ”»æ’ƒå®£è¨€ãªã—ã€‚",npcLvl:100},{id:Ca--,name:"ã‚µãƒ³ãƒ‰ãƒãƒƒã‚°ãã‚“ç™½å¸¯",description:"ã¨ãã«åˆ¶é™ãªã—ã€‚",npcLvl:200}],xl=["Deck","ExtraDeck"],Pl={Deck:"ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒƒã‚­",ExtraDeck:"ã‚¨ã‚¯ã‚¹ãƒˆãƒ©ãƒ‡ãƒƒã‚­"},Na=["Monster","Spell","Trap","XyzMaterial"],kn={Monster:"ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼",Spell:"é­”æ³•",Trap:"ç½ ",XyzMaterial:"XYZç´ æ"},oi=["Fusion","Syncro","Xyz","Link"],Dn=[...oi,"SpecialSummon"],Ml=["Toon","Spirit","Union","Gemini","FlipEffect"],Fl=["Tuner","Effect","Normal","Pendulum","Token","NormalSummonOnly"],kr=[...Dn,...Ml,...Fl],ua={Syncro:"ã‚·ãƒ³ã‚¯ãƒ­",Fusion:"èžåˆ",Xyz:"ã‚¨ã‚¯ã‚·ãƒ¼ã‚º",Link:"ãƒªãƒ³ã‚¯",SpecialSummon:"ç‰¹æ®Šå¬å–š",Toon:"ãƒˆã‚¥ãƒ¼ãƒ³",Spirit:"ã‚¹ãƒ”ãƒªãƒƒãƒˆ",Union:"ãƒ¦ãƒ‹ã‚ªãƒ³",Gemini:"ãƒ‡ãƒ¥ã‚¢ãƒ«",FlipEffect:"ãƒªãƒãƒ¼ã‚¹",Tuner:"ãƒãƒ¥ãƒ¼ãƒŠãƒ¼",Effect:"åŠ¹æžœ",Normal:"é€šå¸¸",Pendulum:"ãƒšãƒ³ãƒ‡ãƒ¥ãƒ©ãƒ ",Token:"ãƒˆãƒ¼ã‚¯ãƒ³",NormalSummonOnly:"ç‰¹æ®Šå¬å–šä¸å¯"},Mi={Syncro:"ðŸŽµ",Fusion:"ðŸŒ€",Xyz:"ðŸ“°",Link:"â›“ï¸",SpecialSummon:"ðŸ”¯",Toon:"ðŸ“–",Spirit:"ðŸ‘»",Union:"ðŸš—",Gemini:"ðŸ‘«",FlipEffect:"ðŸ”„",Tuner:"ðŸŽ¶",Effect:"âœ¨",Normal:"ðŸ”˜",Pendulum:"ðŸ’ ",Token:"ðŸ",NormalSummonOnly:"ðŸ”²"},Dr=["Light","Dark","Earth","Water","Fire","Wind","Divine"],lr={Light:"å…‰",Dark:"é—‡",Earth:"åœ°",Water:"æ°´",Fire:"ç‚Ž",Wind:"é¢¨",Divine:"ç¥ž"},Er=["Aqua","Beast","BeastWarrior","CreatorGod","Cyberse","Dinosaur","DivineBeast","Dragon","Fairy","Fiend","Fish","Insect","Illusion","Machine","Plant","Psychic","Pyro","Reptile","Rock","SeaSerpent","Spellcaster","Thunder","Warrior","WingedBeast","Wyrm","Zombie"],Ar=["Normal","Continuous","Field","QuickPlay","Equip","Ritual"],Fi={Normal:"é€šå¸¸",Continuous:"æ°¸ç¶š",Field:"ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰",QuickPlay:"é€Ÿæ”»",Equip:"è£…å‚™",Ritual:"å„€å¼"},xr=["Normal","Continuous","Counter"],Bi={Normal:"é€šå¸¸",Continuous:"æ°¸ç¶š",Counter:"ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼"},Tt=["Attack","Defense"],Ri={Attack:"æ”»æ’ƒè¡¨ç¤º",Defense:"å®ˆå‚™è¡¨ç¤º",Set:"è£å´å®ˆå‚™è¡¨ç¤º"},En=["level","rank","attack","defense","pendulumScaleR","pendulumScaleL"],Bl=({wikiName:i,wikiHref:e,wikiTextAll:t,nameKana:a,description:r,pendulumDescription:n,...s})=>s,Ol=i=>Bl(i),va={Aqua:"æ°´",Beast:"ç£",BeastWarrior:"ç£æˆ¦å£«",CreatorGod:"å‰µé€ ç¥ž",Cyberse:"ã‚µã‚¤ãƒãƒ¼ã‚¹",Dinosaur:"æç«œ",DivineBeast:"å¹»ç£ç¥ž",Dragon:"ãƒ‰ãƒ©ã‚´ãƒ³",Fairy:"å¤©ä½¿",Fiend:"æ‚ªé­”",Fish:"é­š",Insect:"æ˜†è™«",Illusion:"å¹»æƒ³é­”",Machine:"æ©Ÿæ¢°",Plant:"æ¤ç‰©",Psychic:"ã‚µã‚¤ã‚­ãƒƒã‚¯",Pyro:"ç‚Ž",Reptile:"çˆ¬è™«é¡ž",Rock:"å²©çŸ³",SeaSerpent:"æµ·ç«œ",Spellcaster:"é­”æ³•ä½¿ã„",Thunder:"é›·",Warrior:"æˆ¦å£«",WingedBeast:"é³¥ç£",Wyrm:"å¹»ç«œ",Zombie:"ã‚¢ãƒ³ãƒ‡ãƒƒãƒˆ"},Oi={Aqua:"ðŸš°",Beast:"ðŸ…",BeastWarrior:"ðŸ¦",CreatorGod:"ðŸ”†",Cyberse:"ðŸ’»ï¸",Dinosaur:"ðŸ¦–",DivineBeast:"ðŸ’«",Dragon:"ðŸ²",Fairy:"ðŸ‘¼",Fiend:"ðŸ‘¿",Fish:"ðŸŸï¸",Insect:"ðŸ¦‹",Illusion:"ðŸ¤¡",Machine:"ðŸ¤–",Plant:"ðŸŒ±",Psychic:"ðŸ‘ï¸",Pyro:"ðŸ”¥",Reptile:"ðŸ¦Ž",Rock:"â›°",SeaSerpent:"ðŸ",Spellcaster:"ðŸ§™",Thunder:"âš¡ï¸",Warrior:"âš”ï¸",WingedBeast:"ðŸ¦…",Wyrm:"ðŸ‰",Zombie:"ðŸ¦´"},Nl=i=>i.cardId??!1?`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=2&cid=${i.cardId}`:`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=1&sess=1&rp=10&mode=&sort=1&keyword=${i.name}&stype=1&ctype=&othercon=2&starfr=&starto=&pscalefr=&pscaleto=&linkmarkerfr=&linkmarkerto=&link_m=2&atkfr=&atkto=&deffr=&defto=&releaseDStart=1&releaseMStart=1&releaseYStart=1999&releaseDEnd=&releaseMEnd=&releaseYEnd=`,Si=(i,e)=>{const t=i.monsterCategories??[],a=e.monsterCategories??[];for(const r of oi.toReversed()){if(t.includes(r)&&!a.includes(r))return 1;if(!t.includes(r)&&a.includes(r))return-1}if(i.kind===e.kind){if(i.kind==="Monster"){if((i.link??0)!==(e.link??0))return(i.link??0)-(e.link??0);if((i.rank??0)!==(e.rank??0))return(i.rank??0)-(e.rank??0);if((i.level??0)!==(e.level??0))return(i.level??0)-(e.level??0);if((i.attack??0)!==(e.attack??0))return(i.attack??0)-(e.attack??0);if((i.defense??0)!==(e.defense??0))return(i.defense??0)-(e.defense??0)}return i.name.localeCompare(e.name,"Ja")}for(const r of Na){if(i.kind===r)return-1;if(e.kind===r)return 1}return i.name.localeCompare(e.name,"Ja")},An=["Deck","ExtraDeck"],xn=[...An,"Graveyard","Banished"],ql=[...xn,"Hand"],ci=["MonsterZone","ExtraMonsterZone"],At=["SpellAndTrapZone","FieldSpellZone"],di=[...ci,...At],Pn=["XyzMaterialZone","Disable"],bi=[...ql,...di,...Pn],qa={0:{0:"Hand"},1:{0:"Deck",1:"SpellAndTrapZone",2:"SpellAndTrapZone",3:"SpellAndTrapZone",4:"SpellAndTrapZone",5:"SpellAndTrapZone",6:"ExtraDeck"},2:{0:"Graveyard",1:"MonsterZone",2:"MonsterZone",3:"MonsterZone",4:"MonsterZone",5:"MonsterZone",6:"FieldSpellZone"},3:{0:"Banished",1:"XyzMaterialZone",2:"ExtraMonsterZone",3:"Disable",4:"ExtraMonsterZone",5:"XyzMaterialZone",6:"Banished"},4:{0:"FieldSpellZone",1:"MonsterZone",2:"MonsterZone",3:"MonsterZone",4:"MonsterZone",5:"MonsterZone",6:"Graveyard"},5:{0:"ExtraDeck",1:"SpellAndTrapZone",2:"SpellAndTrapZone",3:"SpellAndTrapZone",4:"SpellAndTrapZone",5:"SpellAndTrapZone",6:"Deck"},6:{0:"Hand"}};let Ll=class{constructor(e,t,a,r){d(this,"onUpdateEvent",new ze);d(this,"field");d(this,"row");d(this,"column");d(this,"cellType");d(this,"owner");d(this,"_needsShuffle",!1);d(this,"_entities");d(this,"releaseEntities",e=>(this._entities=this._entities.filter(t=>!e.includes(t)),this.onUpdateEvent.trigger(),e));d(this,"acceptEntities",(e,t)=>{t==="Top"?this._entities.unshift(...e):this._entities.push(...e),t==="Random"&&(this._needsShuffle=!0),this._entities.forEach(a=>{a.fieldCell=this}),this.onUpdateEvent.trigger()});d(this,"shuffle",()=>{this._entities=this.entities.shuffle(),this._needsShuffle=!1,this.field.duel.log.info("ãƒ‡ãƒƒã‚­ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã€‚",this.owner)});this.field=e,this.row=t,this.column=a,this.cellType=qa[t][a],this.owner=r,this._entities=[]}get onUpdate(){return this.onUpdateEvent.expose()}get needsShuffle(){return this._needsShuffle}get entities(){return this._entities}get visibleEntities(){return this._entities.filter(e=>Br.find(t=>t===e.entityType))}get cardEntities(){return this._entities.filter(e=>Br.find(t=>t===e.entityType)).filter(e=>e.status.kind!=="XyzMaterial")}get xyzMaterials(){return this._entities.filter(e=>e.status.kind==="XyzMaterial")}get targetForAttack(){return this.cellType==="Hand"?this._entities.find(e=>e.entityType==="Duelist"):this.cardEntities[0]}get isAvailable(){return this.cardEntities.length===0&&this._entities.filter(e=>xo.find(t=>t===e.entityType)).length===0}get isStackCell(){return xn.some(e=>e===this.cellType)}get isPlayFieldCell(){return di.some(e=>e===this.cellType)}get isMonsterZoneLikeCell(){return ci.some(e=>e===this.cellType)}get isSpellTrapZoneLikeCell(){return At.some(e=>e===this.cellType)}get isDisabledCell(){return Pn.some(e=>e===this.cellType)}};Array.prototype.shuffle=function(){return this.map(e=>({item:e,seq:Math.random()})).toSorted((e,t)=>e.seq-t.seq).map(e=>e.item)};Array.prototype.randomPickMany=function(i){return this.shuffle().slice(0,i)};Array.prototype.randomPick=function(){return this.shuffle().slice(0,1)[0]};Array.prototype.reset=function(...i){this.splice(0),this.push(...i)};Array.prototype.union=function(i){return this.filter(e=>i.find(t=>e===t))};Array.prototype.getAllOnOffPattern=function(){const i=[];return this.forEach(e=>{if(i.length==0){i.push([e]),i.push([]);return}i.forEach(t=>i.push([...t,e]))}),i};Array.prototype.getDistinct=function(){return Array.from(new Set(this))};Array.prototype.distinct=function(){this.reset(...this.getDistinct())};const Mn=["IgnitionEffect","MandatoryIgnitionEffect","TriggerEffect","MandatoryTriggerEffect","QuickEffect","CardActivation"],Rl=["NormalSummon","SpecialSummon","ChangeBattlePosition","Battle","SpellTrapSet","LingeringEffect","MandatoryLingeringEffect"],Hl=i=>i==="CardActivation"?"CardActivation":Mn.some(e=>e===i)?"EffectActivation":"NonActivate",Pr=["NormalSummon","AdvanceSummon","SpecialSummon","SpecialSummonFromDeck","SendToGraveyardFromDeck","Draw","SearchFromDeck","BanishFromDeck","BanishFromGraveyard","AddToHandFromGraveyard","ReturnToDeckFromGraveyard","SpecialSummonFromGraveyard","Banish","BanishFromField","Destroy","DestroyMultiple","DestroyOnField","DestroyMultipleOnField","DestroyOnOpponentField","DestroyMultipleOnOpponentField","DestroyMonsterOnField","DestroyMonstersOnField","DestroySpellTrapOnField","DestroySpellTrapsOnField","IfNormarlSummonSucceed","IfSpecialSummonSucceed","DamageToOpponent","DamageToSelf","PayLifePoint","DiscordAsCost","DiscordAsEffect","RollDice","BounceToHand","NegateCardEffect","NegateCardActivation"],jt=i=>i.playType==="CardActivation"?i.entity.nm:`${i.entity.nm}Â«${i.title}Â»`,St=class St{constructor(e,t,a){d(this,"seq");d(this,"entity");d(this,"cardActionBase");d(this,"getClone",()=>new St(this.seq,this.entity,this.cardActionBase));d(this,"validate",(e,t)=>{if(this.playType==="CardActivation"&&this.entity.isOnField&&this.entity.face==="FaceUp"||this.isOnlyNTimesPerDuel>0&&this.entity.field.duel.chainBlockLog.records.filter(n=>!n.chainBlockInfo.isNegatedActivationBy).filter(n=>this.isSame(n.chainBlockInfo.action)).filter(n=>n.chainBlockInfo.activator===e).length>=this.isOnlyNTimesPerDuel||this.isOnlyNTimesPerTurn>0&&this.entity.field.duel.chainBlockLog.records.filter(n=>!n.chainBlockInfo.isNegatedActivationBy).filter(n=>this.isSameGroupPerTurn(n.chainBlockInfo.action)).filter(n=>n.clock.turn===this.entity.field.duel.clock.turn).filter(n=>n.chainBlockInfo.activator===e).length>=this.isOnlyNTimesPerTurn)return;const a=t.filter(n=>n.action.seq===this.seq).length;if(this.isOnlyNTimesPerTurnIfFaceup>0&&this.entity.counterHolder.getActionCount(this)+a>=this.isOnlyNTimesPerTurnIfFaceup||this.isOnlyNTimesIfFaceup>0&&this.entity.counterHolder.getActionCount(this)+a>=this.isOnlyNTimesIfFaceup)return;const r={index:t.length,action:this,activator:e,isActivatedIn:this.entity.fieldCell,state:"unloaded"};return this.cardActionBase.validate(r,t)});d(this,"prepare",async(e,t,a,r)=>{this.isLikeContinuousSpell&&(this.entity.info.isPending=!0);const n=this.entity.fieldCell,s={index:a.length,action:this,activator:e,isActivatedIn:n,state:"ready"},c=await this.cardActionBase.prepare(s,t,a,r);if(c!==void 0)return{...s,...c}});d(this,"execute",async(e,t)=>{if(e.action.isLikeContinuousSpell&&!e.action.entity.isOnField)return this.entity.info.isPending=!1,!1;const a=await this.cardActionBase.execute(e,t);if(e.action.isLikeContinuousSpell)for(const r of this.entity.continuousEffects)this.entity.info.isPending=!1,await r.updateState();return a});d(this,"settle",(e,t)=>(this.isOnlyNTimesPerTurnIfFaceup>0?this.entity.counterHolder.incrementActionCountPerTurn(e.action):this.isOnlyNTimesIfFaceup>0&&this.entity.counterHolder.incrementActionCount(e.action),this.cardActionBase.settle(e,t)));d(this,"isSame",e=>this.entity.origin.name===e.entity.origin.name&&this.title===e.title);d(this,"isSameGroupPerTurn",e=>this.actionGroupNamePerTurn?this.entity.origin.name===e.entity.origin.name&&this.actionGroupNamePerTurn===e.actionGroupNamePerTurn:this.isSame(e));d(this,"calcChainBlockTagsForDestroy",e=>{if(!Pr.length)return[];const t=["Destroy"];Pr.length>1&&t.push("DestroyMultiple");const a=e.filter(c=>c.isOnField);a.length&&(t.push("DestroyOnField"),a.length>1&&t.push("DestroyMultipleOnField"));const r=a.filter(c=>c.status.kind==="Monster");r.length&&(t.push("DestroyMonsterOnField"),r.length>1&&t.push("DestroyMonstersOnField")),a.filter(c=>c.status.kind!=="Monster").length&&(t.push("DestroySpellTrapOnField"),r.length>1&&t.push("DestroySpellTrapsOnField"));const s=a.filter(c=>c.controller!==this.entity.controller);return s.length&&(t.push("DestroyOnOpponentField"),s.length>1&&t.push("DestroyMultipleOnOpponentField")),t});this.seq=e,this.entity=t,this.cardActionBase=a}get isMandatory(){return this.playType==="MandatoryIgnitionEffect"||this.playType==="MandatoryLingeringEffect"||this.playType==="MandatoryTriggerEffect"}get title(){return this.cardActionBase.title}get playType(){return this.cardActionBase.playType}get spellSpeed(){return this.cardActionBase.spellSpeed}get hasToTargetCards(){return this.cardActionBase.hasToTargetCards??!1}get executableCells(){return this.cardActionBase.executableCells}get executablePeriods(){return this.cardActionBase.executablePeriods}get executableDuelistTypes(){return this.cardActionBase.executableDuelistTypes}get executableDuelists(){const e=[];return this.cardActionBase.executableDuelistTypes.includes("Controller")&&e.push(this.entity.controller),this.cardActionBase.executableDuelistTypes.includes("Opponent")&&e.push(this.entity.controller.getOpponentPlayer()),e}get isOnlyNTimesPerDuel(){return this.cardActionBase.isOnlyNTimesPerDuel??0}get isOnlyNTimesPerTurn(){return this.cardActionBase.isOnlyNTimesPerTurn??0}get isOnlyNTimesPerTurnIfFaceup(){return this.cardActionBase.isOnlyNTimesPerTurnIfFaceup??0}get isOnlyNTimesIfFaceup(){return this.cardActionBase.isOnlyNTimesIfFaceup??0}get isLikeContinuousSpell(){return this.cardActionBase.isLikeContinuousSpell||this.entity.isLikeContinuousSpell&&this.playType==="CardActivation"}get actionGroupNamePerTurn(){return this.cardActionBase.actionGroupNamePerTurn}get negatePreviousBlock(){return this.cardActionBase.negatePreviousBlock??!1}get priorityForNPC(){return this.cardActionBase.priorityForNPC??Number.NaN}};d(St,"nextActionSeq",0),d(St,"createNew",(e,t)=>new St(St.nextActionSeq++,e,t)),d(St,"createDammyAction",(e,t,a,r)=>({seq:St.nextActionSeq++,title:t,entity:e,playType:"Dammy",spellSpeed:"Dammy",hasToTargetCards:!1,isOnlyNTimesPerDuel:0,isOnlyNTimesPerTurn:0,isLikeContinuousSpell:!1,getClone:function(){return this},validate:()=>a,prepare:async()=>{},execute:async()=>!1,settle:async()=>!1,pos:r,cell:a[0],dragAndDropOnly:a.length>1}));let Ht=St;class fa{constructor(){d(this,"pooledOperators",[]);d(this,"bundles",[]);d(this,"excludesExpired",()=>{this.bundles=this.bundles.filter(e=>!e.entity.hasDisappeared),this.bundles.forEach(e=>e.excludesExpired()),this.pooledOperators=this.pooledOperators.filter(e=>e.validateAlive())});d(this,"append",e=>{this.bundles.push(e)});d(this,"push",e=>{if(!e.isContinuous)throw new Se("staticã¸ã®è¿½åŠ ã¯æ°¸ç¶šä»¥å¤–ä¸å¯",e);this.excludesExpired(),this.distribute(e),this.pooledOperators.push(e)});d(this,"distributeAll",e=>(this.excludesExpired(),this.pooledOperators.flatMap(this.distribute).getDistinct().forEach(t=>t.operators.sort((a,r)=>a.seq-r.seq)),this.afterDistributeAll(e)));d(this,"distribute",e=>this.bundles.filter(t=>t.operators.every(a=>a.seq!==e.seq)).filter(t=>e.isApplicableTo(t.entity)).map(t=>(t.push(e),t)));d(this,"removeItem",e=>{this.pooledOperators=this.pooledOperators.filter(t=>t.seq!==e)})}}class pa{constructor(e,t){d(this,"pool");d(this,"entity");d(this,"_operators");d(this,"excludesExpired",()=>{this._operators=this._operators.filter(e=>{const t=e.validateAlive()&&e.isApplicableTo(this.entity);return t||(console.info(`before remove ${this.entity.toString} ${e.title}`),e.beforeRemove(this)),t})});d(this,"push",e=>{this.entity.procFilterBundle.operators.filter(t=>t.procTypes.includes("Effect")).some(t=>!t.filter(t.effectOwner,t.isSpawnedBy,t.actionAttr,[]))||(this.beforePush(e),this._operators.push(e))});d(this,"removeItem",e=>{this._operators=this._operators.filter(t=>t.seq!==e?!0:(t.beforeRemove(this),!1))});this.pool=e,this.entity=t,this._operators=[],this.pool.append(this)}get operators(){return this._operators}}const Ii=class Ii{constructor(e,t,a,r,n,s){d(this,"seq");d(this,"title");d(this,"validateAlive");d(this,"isContinuous");d(this,"isSpawnedBy");d(this,"isSpawnedAt");d(this,"activateType");d(this,"actionAttr");d(this,"isApplicableTo");d(this,"effectOwner");this.seq=Ii.nextSeq++,this.title=e,this.validateAlive=()=>t(this),this.isContinuous=a,this.isSpawnedBy=r,this.isSpawnedAt=r.duel.clock.getClone(),this.isApplicableTo=c=>s(this,c),this.actionAttr=n,this.activateType=this.actionAttr.playType?Hl(this.actionAttr.playType):"NonActivate",this.effectOwner=this.isSpawnedBy.controller}get isEffective(){return!this.isContinuous||this.activateType==="NonActivate"?!0:this.isSpawnedBy.isEffective}};d(Ii,"nextSeq",0);let Ti=Ii;class $l extends fa{constructor(){super(...arguments);d(this,"afterDistributeAll",()=>this.bundles.every(t=>t.applyEffectFilter()))}}class jl extends pa{constructor(){super(...arguments);d(this,"applyEffectFilter",()=>{const t=this.entity.allStickyEffectOperators.length,a=[];for(;;){const r=this.operators.filter(n=>n.procTypes.includes("Effect")).filter(n=>n.isContinuous).find(n=>!a.includes(n.seq));if(!r)break;a.push(r.seq),r.eraseOperators(this.entity)}return this.entity.allStickyEffectOperators.length===t});d(this,"beforePush",t=>t.eraseOperators(this.entity))}}class Ul extends Ti{constructor(t,a,r,n,s,c,u,l){super(t,a,r,n,s,c);d(this,"beforeRemove",()=>{});d(this,"procTypes");d(this,"filter");d(this,"eraseOperators",t=>{if(!this.procTypes.includes("Effect"))return 0;console.log("ã“ã“ã¯ã¾ã é€šã‚‰ãªã„æƒ³å®š");const a=t.allStickyEffectOperators.filter(r=>r.isContinuous).filter(r=>!this.filter(r.effectOwner,r.isSpawnedBy,r.actionAttr,[])).map(r=>r.seq);return a.forEach(t.procFilterBundle.removeItem),a.forEach(t.statusOperatorBundle.removeItem),a.forEach(t.numericOprsBundle.removeItem),a.forEach(t.cardRelationBundle.removeItem),a.length});this.procTypes=u,this.filter=l}}const Mr={level:1,rank:1,attack:0,defense:0,pendulumScaleR:0,pendulumScaleL:0};class Zl extends fa{constructor(){super(...arguments);d(this,"afterDistributeAll",t=>{if(this.bundles.forEach(r=>r.calcStateAll()),t.field.getMonstersOnField().flatMap(r=>r.numericOprsBundle).flatMap(r=>r.operators).some(r=>r.targetStateGen==="calculated")){const n=t.field.getMonstersOnField().filter(s=>(s.atk??0)>=0).map(s=>s.atk??0).reduce((s,c)=>s>c?s:c,0);t.field.getMonstersOnField().forEach(s=>{s.numericOprsBundle.operators.filter(c=>c.targetStateGen==="calculated").forEach(c=>{var u;if(!((u=s.status.monsterCategories)!=null&&u.includes("Link")&&c.targetState==="defense")){if(c.stateOperationType==="THE_DEVILS_AVATAR"){s.numericStatus.calculated[c.targetState]=n+100;return}console.log(s.toString(),s.numericStatus.calculated[c.targetState]),s.numericStatus.calculated[c.targetState]=c.calcValue(s,s.numericStatus.calculated[c.targetState]??0)}})})}return!0})}}class Gl extends pa{constructor(){super(...arguments);d(this,"beforePush",t=>{const a=this.operators.filter(n=>n.targetState===t.targetState).filter(n=>n.isEffective);if(t.kind==="O-L-F"||t.kind==="O-C-F"?(a.filter(n=>n.kind==="O-L-F").forEach(n=>n.negate()),a.filter(n=>n.kind==="L-F").forEach(n=>n.negate())):t.kind==="L-F"||t.kind==="C-F"?a.filter(n=>n.kind==="L-F"||n.kind==="L-A").forEach(n=>n.negate()):t.kind==="X-C-X"&&a.filter(n=>!n.isContinuous).forEach(n=>n.negate()),a.filter(n=>n.isEffective).some(n=>n.kind==="X-C-X")&&!t.isContinuous)return;if(t.stateOperationType!=="Addition"&&t.targetStateGen==="wip"&&a.filter(n=>!n.isContinuous).forEach(n=>n.negate()),t.stateOperationType==="THE_DEVILS_AVATAR"||t.stateOperationType==="Gradius'_Option"){this.entity.numericStatus.calculated[t.targetState]=-Number.MAX_VALUE;return}const r=this.entity.numericStatus.calculated[t.targetState]??0;if(t.stateOperationType==="THE_DEVILS_DREAD-ROOT"){this.entity.numericStatus.calculated[t.targetState]=t.calcValue(this.entity,r);return}if(t.kind==="L-F"){console.log(this.entity.toString(),r),this.entity.numericStatus.wip[t.targetState]=t.calcValue(this.entity,r);return}});d(this,"calcStateAll",()=>En.forEach(this.calcState));d(this,"calcState",t=>{if(this.entity.status.kind!=="Monster"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories){this.entity.numericStatus.calculated[t]=void 0;return}if(this.entity.status.monsterCategories.includes("Link")&&t!=="attack"){this.entity.numericStatus.calculated[t]=void 0;return}if(this.entity.status.monsterCategories.includes("Xyz")&&t==="level"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories.includes("Xyz")&&t==="rank"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories.includes("Pendulum")&&(t==="pendulumScaleL"||t==="pendulumScaleR")){this.entity.numericStatus.calculated[t]=void 0;return}if(t!=="level"&&!this.entity.isOnField){this.entity.numericStatus.origin[t]=this.entity.origin[t],this.entity.numericStatus.wip[t]=this.entity.origin[t],this.entity.numericStatus.calculated[t]=this.entity.origin[t];return}const a=this._operators.filter(o=>o.targetState===t).filter(o=>o.isEffective);if(a.some(o=>o.stateOperationType==="THE_DEVILS_AVATAR"||o.stateOperationType==="Gradius'_Option")&&this.entity.isEffective){this.entity.numericStatus.calculated[t]=-Number.MAX_VALUE;return}const r=this.entity.origin[t]??0,n=this.entity.numericStatus.wip[t]??0,s=a.filter(o=>o.targetState===t).findLast(o=>o.targetStateGen==="origin"),c=s?s.calcValue(this.entity,r??0):r;this.entity.numericStatus.origin[t]=c;let u=c;const l=a.filter(o=>o.targetState===t).filter(o=>o.targetStateGen==="wip").findLast(o=>o.stateOperationType==="Fixation");if(!l)u=a.filter(o=>o.stateOperationType==="Addition").reduce((o,f)=>f.calcValue(this.entity,o),u),this.entity.numericStatus.wip[t]=u;else if(l.isContinuous)u=l.calcValue(this.entity,u),u=a.filter(o=>o.stateOperationType==="Addition").reduce((o,f)=>f.calcValue(this.entity,o),u),this.entity.numericStatus.wip[t]=u;else{console.log("hoge");let o=!1;u=a.filter(f=>(o=o||f===l,o&&f!==l)).filter(f=>f.stateOperationType==="Addition").reduce((f,p)=>p.calcValue(this.entity,f),n)}u<Mr[t]&&(u=Mr[t]),this.entity.numericStatus.calculated[t]=u})}}const Ft=class Ft extends Ti{constructor(t,a,r,n,s,c,u,l,o,f){super(t,a,r,n,s,c);d(this,"beforeRemove",()=>{});d(this,"targetState");d(this,"targetStateGen");d(this,"stateOperationType");d(this,"calcValue");d(this,"_isEffective");d(this,"negate",()=>{this._isEffective=!1});this._isEffective=!0,this.targetState=u,this.targetStateGen=l,this.stateOperationType=o,this.calcValue=(p,h)=>f(this.isSpawnedBy,p,h)}get isEffective(){return this._isEffective&&super.isEffective}get kind(){if(this.targetStateGen==="origin"){if(this.stateOperationType==="Fixation")return this.isContinuous?"O-C-F":"O-L-F";throw new Se("çŸ›ç›¾ã—ãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£",this)}if(this.targetStateGen==="wip"){if(this.stateOperationType==="Addition")return this.isContinuous?"C-A":"L-A";if(this.stateOperationType==="Fixation")return this.isContinuous?"C-F":"L-F";throw new Se("çŸ›ç›¾ã—ãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£",this)}if(this.stateOperationType==="THE_DEVILS_DREAD-ROOT")return"X-C-F";if(this.stateOperationType==="THE_DEVILS_AVATAR"||this.stateOperationType==="Gradius'_Option")return"X-C-X";throw new Se("çŸ›ç›¾ã—ãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£",this)}};d(Ft,"createContinuous",(t,a,r,n,s,c,u,l)=>new Ft(t,a,!0,r,{},n,s,c,u,l)),d(Ft,"createLingeringFixation",(t,a,r,n,s,c)=>new Ft(t,a,!1,r,n,()=>!0,s,"wip","Fixation",c)),d(Ft,"createLingeringAddition",(t,a,r,n,s,c)=>new Ft(t,a,!1,r,n,()=>!0,s,"wip","Addition",c));let dt=Ft;const Fn=i=>Object.keys(i),zl={draw:"ãƒ‰ãƒ­ãƒ¼ãƒ•ã‚§ã‚¤ã‚º",standby:"ã‚¹ã‚¿ãƒ³ãƒã‚¤ãƒ•ã‚§ã‚¤ã‚º",main1:"ãƒ¡ã‚¤ãƒ³ãƒ•ã‚§ã‚¤ã‚ºï¼‘",battle1:"ãƒãƒˆãƒ«ãƒ•ã‚§ã‚¤ã‚º",battle2:"ãƒãƒˆãƒ«ãƒ•ã‚§ã‚¤ã‚ºï¼ˆè¿½åŠ ï¼‰",main2:"ãƒ¡ã‚¤ãƒ³ãƒ•ã‚§ã‚¤ã‚ºï¼’",end:"ã‚¨ãƒ³ãƒ‰ãƒ•ã‚§ã‚¤ã‚º"},Vl={start:"ã‚¹ã‚¿ãƒ¼ãƒˆã‚¹ãƒ†ãƒƒãƒ—",battle:"ãƒãƒˆãƒ«ã‚¹ãƒ†ãƒƒãƒ—",damage:"ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚¹ãƒ†ãƒƒãƒ—",end:"ã‚¨ãƒ³ãƒ‰ã‚¹ãƒ†ãƒƒãƒ—"},Yl={start:"ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚¹ãƒ†ãƒƒãƒ—é–‹å§‹æ™‚",beforeDmgCalc:"ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—å‰",dmgCalc:"ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—æ™‚",afterDmgCalc:"ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—å¾Œ",end:"ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚¹ãƒ†ãƒƒãƒ—çµ‚äº†æ™‚"},nt=["draw","stanby","main1","b1Start","b1Battle","b1End","b2Start","b2Battle","b2End","main2","end"],zt=["b1DStart","b1DBeforeDmgCalc","b1DAfterDmgCalc","b1DEnd","b2DStart","b2DBeforeDmgCalc","b2DAfterDmgCalc","b2DEnd"],Wl=["b1DDmgCalc","b2DDmgCalc"],ha=[...nt,...zt,...Wl],Fr={draw:{phase:"draw",step:void 0,stage:void 0},stanby:{phase:"standby",step:void 0,stage:void 0},main1:{phase:"main1",step:void 0,stage:void 0},b1Start:{phase:"battle1",step:"start",stage:void 0},b1Battle:{phase:"battle1",step:"battle",stage:void 0},b1DStart:{phase:"battle1",step:"battle",stage:"start"},b1DBeforeDmgCalc:{phase:"battle1",step:"battle",stage:"beforeDmgCalc"},b1DDmgCalc:{phase:"battle1",step:"battle",stage:"dmgCalc"},b1DAfterDmgCalc:{phase:"battle1",step:"battle",stage:"afterDmgCalc"},b1DEnd:{phase:"battle1",step:"battle",stage:"end"},b1End:{phase:"battle1",step:"end",stage:void 0},b2Start:{phase:"battle2",step:"start",stage:void 0},b2Battle:{phase:"battle2",step:"battle",stage:void 0},b2DStart:{phase:"battle2",step:"battle",stage:"start"},b2DBeforeDmgCalc:{phase:"battle2",step:"battle",stage:"beforeDmgCalc"},b2DDmgCalc:{phase:"battle2",step:"battle",stage:"dmgCalc"},b2DAfterDmgCalc:{phase:"battle2",step:"battle",stage:"afterDmgCalc"},b2DEnd:{phase:"battle2",step:"battle",stage:"end"},b2End:{phase:"battle2",step:"end",stage:void 0},main2:{phase:"main2",step:void 0,stage:void 0},end:{phase:"end",step:void 0,stage:void 0}},Kl=i=>i.stage?Yl[i.stage]:i.step?Vl[i.step]:zl[i.phase],Ut=Fn(Fr).reduce((i,e)=>(i[e].key=e,i[e].name=Kl(i[e]),i),Fr),ea=class ea{constructor(e,t){d(this,"entity");d(this,"isRegular");d(this,"_isStarted");d(this,"info");d(this,"continuousEffectBase");d(this,"updateState",async()=>{if(this.hasToStart!==this.isStarted){if(this.isStarted){if(!this.info)throw new Se("illegal state");this._isStarted=!1,await this.continuousEffectBase.finish(this.entity,this.info),this.info=void 0;return}this.info=await this.continuousEffectBase.start(this.entity),this._isStarted=!0}});this._isStarted=!1,this.entity=e,this.continuousEffectBase=t,this.isRegular=this.appliableCellTypes.every(a=>di.find(r=>r===a))&&this.faceList.length===1&&this.faceList[0]==="FaceUp"}get isStarted(){return this._isStarted}get appliableCellTypes(){return this.continuousEffectBase.appliableCellTypes}get appliableDuelPeriodKeys(){return this.continuousEffectBase.appliableDuelPeriodKeys}get faceList(){return this.continuousEffectBase.faceList}get hasToStart(){return!this.appliableCellTypes.includes(this.entity.fieldCell.cellType)||!this.appliableDuelPeriodKeys.includes(this.entity.duel.clock.period.key)||!this.faceList.includes(this.entity.face)?!1:this.continuousEffectBase.canStart(this.entity)}};d(ea,"createNew",(e,t)=>new ea(e,t));let La=ea;const Xl=(i,e,t,a,r)=>({title:i,appliableCellTypes:e==="Monster"?["MonsterZone","ExtraMonsterZone"]:["FieldSpellZone","SpellAndTrapZone"],appliableDuelPeriodKeys:ha,faceList:["FaceUp"],canStart:n=>!n.info.isPending&&!n.info.isDying&&t(n),start:async n=>{const s=a(n);return s.forEach(r(n).push),s.map(c=>c.seq)},finish:async(n,s)=>{s.forEach(c=>r(n).removeItem(c))}}),or=(i,e,t,a,r,n)=>({title:i,appliableCellTypes:e==="Monster"?["MonsterZone","ExtraMonsterZone"]:["FieldSpellZone","SpellAndTrapZone"],appliableDuelPeriodKeys:ha,faceList:["FaceUp"],canStart:s=>!s.info.isPending&&!s.info.isDying&&a(s),start:async s=>{const c=r(s),u=t(s);return console.info(`start : ${s.toString()} â‡’ ${u.map(l=>l.toString()).join(" ")} (${c.map(l=>l.title).join(" ")})`),u.map(n).forEach(l=>c.forEach(l.push)),{targets:u,seqList:c.map(l=>l.seq)}},finish:async(s,c)=>{c.targets.map(n).forEach(u=>c.seqList.forEach(l=>u.removeItem(l)))}}),Ql=(i,e,t,a,r)=>or(i,e,t,a,r,n=>n.procFilterBundle),Ji=(i,e,t,a)=>Xl(i,e,t,a,r=>r.field.numericStateOperatorPool),ga=(i,e,t,a,r)=>or(i,e,t,a,r,n=>n.numericOprsBundle),Jl=(i,e,t,a,r)=>or(i,e,t,a,r,n=>n.statusOperatorBundle);class Il extends fa{constructor(){super(...arguments);d(this,"afterDistributeAll",()=>!0)}}class eo extends pa{constructor(){super(...arguments);d(this,"beforePush",()=>{})}}class to{constructor(e){d(this,"entity");d(this,"_records");d(this,"pushForRuleAction",e=>{this._records.push({cell:this.entity.fieldCell,face:this.entity.face,orientation:this.entity.orientation,movedAt:this.entity.duel.clock.getClone(),movedAs:[...e,"Rule"]})});d(this,"push",(e,t,a,r)=>{let n=this.entity.fieldCell;this.entity.status.kind==="XyzMaterial"&&(n=this.entity.controller.getXyzMaterialZone()),this._records.push({cell:n,face:this.entity.face,orientation:this.entity.orientation,movedAt:this.entity.duel.clock.getClone(),movedAs:e.getDistinct(),movedBy:t,actionOwner:a,chooser:r??a})});this.entity=e,this._records=[]}get records(){return this._records}get latestRecord(){return this._records.slice(-1)[0]}get previousPlaceRecord(){return this._records.findLast(e=>e.cell.cellType!==this.entity.fieldCell.cellType)??this._records[0]}get currentProcRecords(){return this._records.filter(e=>e.movedAt.totalProcSeq===this.entity.duel.clock.totalProcSeq)}}const Ra=["SpellCounter","KaijuCounter","NamelessCounter"],Ha=["CycleFlip"],io=["CycleFlip","GoldSarcophagus"],ao=[...Ra,...Ha,...io],ro={SpellCounter:"ðŸ”®",KaijuCounter:"â˜¢",NamelessCounter:"ðŸ’ "};class no{constructor(){d(this,"dic");d(this,"temporaryCounterNames");d(this,"add",(e,t=1)=>(this.dic[e]=(this.dic[e]??0)+t,this.dic[e]));d(this,"setQty",(e,t=1)=>(this.dic[e]=t,this.dic[e]));d(this,"remove",(e,t=1)=>(this.dic[e]=(this.dic[e]??0)-t,this.dic[e]));d(this,"removeAll",e=>{const t=this.dic[e];return delete this.dic[e],t});d(this,"getQty",e=>this.dic[e]??0);d(this,"incrementActionCountPerTurn",e=>{this.temporaryCounterNames.push(e.title),this.dic[e.title]=(this.dic[e.title]??0)+1});d(this,"incrementActionCount",e=>{this.dic[e.title]=(this.dic[e.title]??0)+1});d(this,"getActionCount",e=>this.dic[e.title]??0);d(this,"corpseDisposal",()=>{this.temporaryCounterNames.forEach(e=>delete this.dic[e]),this.temporaryCounterNames.reset(),Ha.forEach(e=>delete this.dic[e])});d(this,"removeAllActualCounters",()=>{Ra.forEach(e=>delete this.dic[e])});d(this,"removeAllWhenfaceDown",()=>{this.temporaryCounterNames.forEach(e=>delete this.dic[e]),this.temporaryCounterNames.reset(),Ra.forEach(e=>delete this.dic[e])});d(this,"clear",()=>{Ha.forEach(e=>delete this.dic[e]),this.temporaryCounterNames.forEach(e=>delete this.dic[e]),this.temporaryCounterNames.reset(),ao.forEach(e=>delete this.dic[e])});this.dic={},this.temporaryCounterNames=[]}}class so extends fa{constructor(){super(...arguments);d(this,"afterDistributeAll",t=>t.field.getAllEntities().map(a=>a.statusOperatorBundle).every(a=>a.calcStatus()))}}class lo extends pa{constructor(){super(...arguments);d(this,"calcStatus",()=>{const t=this.entity.isEffective,a={...this.entity.status},r=this._operators.reduce((n,s)=>s.statusCalculator(s,n),a);return this.entity.status=r,this.entity.isEffective===t});d(this,"beforePush",()=>{})}}class oo extends Ti{constructor(t,a,r,n,s,c,u){super(t,a,r,n,s,c);d(this,"beforeRemove",()=>{});d(this,"statusCalculator");this.statusCalculator=u}}const ki=async()=>({selectedEntities:[],chainBlockTags:[],prepared:void 0}),co=(i,e,t)=>({title:i,playType:"SystemAction",spellSpeed:"Normal",executableCells:bi,executablePeriods:e,executableDuelistTypes:["Controller","Opponent"],validate:t,prepare:ki,execute:async()=>!0,settle:async()=>!0}),uo=i=>{if(i.activator.info.ruleNormalSummonCount>=i.activator.info.maxRuleNormalSummonCount||!i.action.entity.lvl)return;const e=i.activator.getAvailableMonsterZones();return i.action.entity.lvl<5?e.length>0?e:void 0:i.activator.getReleasableMonsters().length<(i.action.entity.lvl<7?1:2)?void 0:[]},vo=async(i,e,t,a)=>{if(!i.action.entity.lvl)return;let r=e?[e]:i.activator.getAvailableMonsterZones();if(r.length===0)return;let n=a,s=[];if(i.action.entity.lvl>4){const l=i.activator.getReleasableMonsters(),o=i.activator.getExtraMonsterZones(),f=i.action.entity.lvl<7?1:2;o.length>=f&&l.filter(h=>h.fieldCell.cellType!=="ExtraMonsterZone");const p=await i.action.entity.field.release(i.activator,i.activator.getReleasableMonsters(),f,"Cost",["AdvanceSummonRelease","Rule"],i.action.entity,n);if(!p)return;s=p.map(h=>({material:h})),n=!1,r=i.activator.getAvailableMonsterZones()}let c=(i.action.entity.atk??0)>0&&(i.action.entity.atk??0)>=(i.action.entity.def??0)?"Attack":"Set",u=r.randomPick();if(i.activator.duelistType!=="NPC"){const l=await i.activator.duel.view.waitSelectSummonDest(i.activator,i.action.entity,r,["Attack","Set"],n);if(!l)return;u=l.dest,c=l.pos}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:u,pos:c,materialInfos:s}}},fo=async i=>{const e=["Rule","NormalSummon"];let t="NormalSummon";return i.prepared.materialInfos.length>0&&(i.action.entity.info.materials.reset(...i.prepared.materialInfos),t="AdvanceSummon",e.push("AdvanceSummon")),await i.action.entity.summon(i.prepared.dest,i.prepared.pos,t,e,i.action.entity,i.activator),i.activator.info.ruleNormalSummonCount++,i.activator.info.ruleNormalSummonCountQty++,!0},$a=(i,e,t)=>{const a=i.activator.getAvailableMonsterZones();if(i.action.entity.fieldCell.cellType==="ExtraDeck"&&a.push(...i.activator.getAvailableExtraZones()),!(!a.length&&(!t.length||t.every(r=>r.material.fieldCell.cellType!=="MonsterZone")&&i.action.entity.fieldCell.cellType!=="ExtraDeck"))&&!e.every(r=>!i.activator.canSummon(i.activator,i.action.entity,i.action,"SpecialSummon",r,t)))return t.length===0?a:[]},ja=async(i,e,t,a,r)=>{const n=e?[e]:i.activator.getAvailableMonsterZones();if(n.length===0)return;const s=t.filter(l=>i.activator.canSummon(i.activator,i.action.entity,i.action,"SpecialSummon",l,a));if(s.length===0)return;let c=s.randomPick(),u=n.randomPick();if(s.length&&s.includes("Attack")&&(c=(i.action.entity.atk??0)>0&&(i.action.entity.atk??0)>=(i.action.entity.def??0)?"Attack":s.filter(l=>l!=="Attack").randomPick()),i.activator.duelistType!=="NPC"){const l=await i.activator.duel.view.waitSelectSummonDest(i.activator,i.action.entity,n,s,r);if(!l)return;u=l.dest,c=l.pos}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:u,pos:c,materialInfos:a}}},Ua=async i=>{const e=["Rule","SpecialSummon"];return await i.action.entity.summon(i.prepared.dest,i.prepared.pos,"SpecialSummon",e,i.action.entity,i.activator),i.action.entity.info.materials=i.prepared.materialInfos,!0},Ye={title:"é€šå¸¸å¬å–š",playType:"NormalSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:uo,prepare:vo,execute:fo,settle:async()=>!0},po=i=>{if(!i.activator.isTurnPlayer)return;const e=i.action.entity.getAttackTargets();return e.length?e.map(t=>t.fieldCell):void 0},ho=async(i,e)=>{if(i.action.entity.info.attackCount>0||i.action.entity.battlePosition!=="Attack")return;if(e!=null&&e.targetForAttack)return{selectedEntities:[],chainBlockTags:[],prepared:{target:e.targetForAttack}};const t=i.action.entity.getAttackTargets();if(t.length===0)throw new Se("æƒ³å®šã•ã‚Œãªã„çŠ¶æ…‹",i,e);if(t.length===1)return{selectedEntities:[],chainBlockTags:[],prepared:{target:t[0]}};if(i.activator.duelistType==="NPC"){let r=i.activator.selectAttackTargetForNPC(i.action.entity,i.action);return r||(i.activator.duel.log.warn("NPCã®æ”»æ’ƒå¯¾è±¡é¸æŠžã«å¤±æ•—ã—ãŸãŸã‚ã€ãƒ©ãƒ³ãƒ€ãƒ ã«æ”»æ’ƒå¯¾è±¡ã‚’é¸æŠžã€‚"),r=t.randomPick()),{selectedEntities:[],chainBlockTags:[],prepared:{target:r}}}const a=await i.action.entity.field.duel.view.waitSelectEntities(i.activator,t,1,r=>r.length===1,"æ”»æ’ƒå¯¾è±¡ã‚’é¸æŠžã€‚",!0);if(a)return{selectedEntities:[],chainBlockTags:[],prepared:{target:a[0]}}},go=async i=>(i.action.entity.field.duel.declareAnAttack(i.action.entity,i.prepared.target),!0),He={title:"æ”»æ’ƒå®£è¨€",playType:"Battle",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["b1Battle","b2Battle"],executableDuelistTypes:["Controller"],validate:po,prepare:ho,execute:go,settle:async()=>!0},yo=i=>{if(!(i.action.entity.info.battlePotisionChangeCount>0||i.action.entity.info.attackCount>0||!i.activator.isTurnPlayer))return[]},_o=async i=>i.action.entity.info.battlePotisionChangeCount>0||!i.activator.isTurnPlayer?!1:(await i.action.entity.setBattlePosition(i.action.entity.battlePosition==="Attack"?"Defense":"Attack",["Rule"],i.action.entity,i.activator),i.action.entity.info.battlePotisionChangeCount++,!0),$e={title:"è¡¨ç¤ºå½¢å¼å¤‰æ›´",playType:"ChangeBattlePosition",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:yo,prepare:ki,execute:_o,settle:async()=>!0},mo=async(i,e=i.action.entity,t=["Attack","Defense"])=>{if(e.wasMovedAtCurrentChain)return!1;const a=i.activator.getAvailableMonsterZones();return a.length===0||t.every(r=>!e.canBeSummoned(i.activator,i.action,"SpecialSummon",r,[],!1))?!1:(await i.activator.summon(e,t,a,"SpecialSummon",["Effect"],i.action.entity,!1),!0)},gi=(i,e,t,a)=>e.status.kind!=="Monster"||!e.origin.monsterCategories?!1:e.origin.monsterCategories.includes("NormalSummonOnly")?a==="NormalSummon"||a==="AdvanceSummon":e.origin.monsterCategories.includes("SpecialSummon")&&(e.fieldCell.cellType==="Graveyard"||e.fieldCell.cellType==="Banished")?e.info.isRebornable:!0,Za=(i,e,t,a,r)=>{if(!i.action.entity.origin.level||t.some(u=>!u.lvl)||t.map(u=>u.lvl??0).reduce((u,l)=>u+l,0)!==i.action.entity.origin.level)return;const n=t.filter(u=>{var l;return(l=u.status.monsterCategories)==null?void 0:l.some(o=>o==="Tuner")}),s=t.filter(u=>{var l;return(l=u.status.monsterCategories)==null?void 0:l.some(o=>o!=="Tuner")});if(!a(n)||!r(s))return;const c=[...n.map(u=>({material:u,isAsTuner:!0})),...s.map(u=>({material:u,isAsTuner:!1}))];if(t.every(u=>u.canBeMaterial(i.activator,i.action.entity,i.action,"SyncroMaterial",e,c,!1))&&i.activator.canSummon(i.activator,i.action.entity,i.action,"SyncroSummon",e,c))return c},Bn=(i,e=a=>a.length===1,t=a=>a.length>0)=>{let a=[...i.activator.getMonstersOnField().filter(n=>n.battlePosition!=="Set"),...i.activator.getHandCell().entities.filter(n=>n.origin.kind==="Monster")];if(a.every(n=>!n.status.allowHandSyncro)&&(a=a.filter(n=>n.fieldCell.isPlayFieldCell)),a.length<2)return[];const r=["Attack","Defense"];return a.getAllOnOffPattern().filter(n=>r.some(s=>Za(i,s,n,e,t)))},So=(i,e=a=>a.length===1,t=a=>a.length>0)=>Bn(i,e,t).length>0?[]:void 0,bo=async(i,e,t,a=n=>n.length===1,r=n=>n.length>0)=>{var h;const n=Bn(i,a,r);let s=n[0];if(n.length>1){const y=n.flatMap(_=>_).getDistinct(),w=await i.action.entity.duel.view.waitSelectEntities(i.activator,y,void 0,_=>Tt.some(S=>Za(i,S,_,a,r)),"ã‚·ãƒ³ã‚¯ãƒ­ç´ æã¨ã™ã‚‹ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’é¸æŠž",t);if(!w)return;s=w}i.action.entity.field.duel.log.info(`ã‚·ãƒ³ã‚¯ãƒ­ç´ æã¨ã—ã¦ã€${s.map(y=>"ã€Š"+y.nm+"ã€‹").join("")}ã‚’å¢“åœ°ã«é€ã‚Šâ€•â€•`,i.activator),await ye.sendManyToGraveyardForTheSameReason(s,["SyncroMaterial","Rule","SpecialSummonMaterial"],i.action.entity,i.activator);const c=[...i.activator.getAvailableMonsterZones(),...i.activator.getAvailableExtraZones()],u=Tt.map(y=>{const w=Za(i,y,s,a,r);return{pos:y,materialInfos:w}}).filter(y=>y.materialInfos),l=u.map(y=>y.pos);let o=u[0].pos,f=u[0].materialInfos,p=c.randomPick();if(i.activator.duelistType!=="NPC"){const y=await i.activator.duel.view.waitSelectSummonDest(i.activator,i.action.entity,c,l,!1);if(!y)return;p=y.dest,o=y.pos,f=((h=u.find(w=>w.pos===o))==null?void 0:h.materialInfos)??f}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:p,pos:o,materialInfos:f}}},wo=async i=>{const e=["Rule","SpecialSummon","SyncroSummon"];return await i.action.entity.summon(i.prepared.dest,i.prepared.pos,"SyncroSummon",e,i.action.entity,i.activator),i.action.entity.info.isRebornable=!0,!0},Hi=(i=t=>t.length===1,e=t=>t.length>0)=>({title:"ã‚·ãƒ³ã‚¯ãƒ­å¬å–š",playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:t=>So(t,i,e),prepare:(t,a,r,n)=>bo(t,a,n,i,e),execute:wo,settle:async()=>!0}),Ga=(i,e,t,a=2,r=2,n)=>{if(!i.action.entity.origin.rank||t.length<a||t.length>r||t.some(c=>!c.lvl)||t.some(c=>c.lvl!==i.action.entity.rank)||!n(t))return;const s=t.map(c=>({material:c,level:c.status.level}));if(t.every(c=>c.canBeMaterial(i.activator,i.action.entity,i.action,"XyzMaterial",e,s,!1)))return i.activator.canSummon(i.activator,i.action.entity,i.action,"XyzSummon",e,s)?s:void 0},On=(i,e=2,t=2,a=r=>r.length>1)=>{const r=i.activator.getMonstersOnField().filter(n=>n.battlePosition!=="Set");return r.length<e?[]:r.getAllOnOffPattern().filter(n=>n.length>=e).filter(n=>n.length<=t).filter(n=>Tt.some(s=>Ga(i,s,n,e,t,a)))},Co=(i,e=2,t=2,a=r=>r.length>1)=>On(i,e,t,a).length>0?[]:void 0,To=async(i,e,t,a=2,r=2,n=s=>s.length>1)=>{var y;const s=On(i,a,r,n);let c=s[0];if(s.length>1){const w=s.flatMap(S=>S).getDistinct(),_=await i.action.entity.duel.view.waitSelectEntities(i.activator,w,void 0,S=>Tt.some(E=>Ga(i,E,S,a,r,n)),"XYZç´ æã¨ã™ã‚‹ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’é¸æŠž",!0);if(!_)return;c=_}const u=Tt.map(w=>{const _=Ga(i,w,c,a,r,n);return{pos:w,materialInfos:_}}).filter(w=>w.materialInfos);i.action.entity.field.duel.log.info(`${c.map(w=>"ã€Š"+w.nm+"ã€‹").join(" ")}ã«ã‚ˆã£ã¦ã€ã‚ªãƒ¼ãƒãƒ¬ã‚¤ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æ§‹ç¯‰â€•â€•`,i.activator),await ye.convertManyToXyzMaterials(c,["XyzMaterial","Rule","SpecialSummonMaterial"],i.action.entity,i.activator);const l=[...i.activator.getAvailableMonsterZones(),...i.activator.getAvailableExtraZones()],o=u.map(w=>w.pos);let f=u[0].pos,p=u[0].materialInfos,h=l.randomPick();if(i.activator.duelistType!=="NPC"){const w=await i.activator.duel.view.waitSelectSummonDest(i.activator,i.action.entity,l,o,!1);if(!w)return;h=w.dest,f=w.pos,p=((y=u.find(_=>_.pos===f))==null?void 0:y.materialInfos)??p}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:h,pos:f,materialInfos:p}}},ko=async i=>{const e=["Rule","SpecialSummon","XyzSummon"];return await ye.moveToXyzOwner(i.prepared.dest,i.prepared.materialInfos.map(t=>t.material),["XyzMaterial"],i.action.entity,i.activator),await i.action.entity.summon(i.prepared.dest,i.prepared.pos,"XyzSummon",e,i.action.entity,i.activator),i.action.entity.info.isRebornable=!0,!0},Do=(i=2,e=2,t=a=>a.length>1)=>({title:"ã‚¨ã‚¯ã‚·ãƒ¼ã‚ºå¬å–š",playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:a=>Co(a,i,e,t),prepare:(a,r,n,s)=>To(a,r,s,i,e,t),execute:ko,settle:async()=>!0}),Eo={FusionSummon:"èžåˆå¬å–š",SyncroSummon:"ã‚·ãƒ³ã‚¯ãƒ­å¬å–š",XyzSummon:"ã‚¨ã‚¯ã‚·ãƒ¼ã‚ºå¬å–š",PendulumSummon:"ãƒšãƒ³ãƒ‡ãƒ¥ãƒ©ãƒ å¬å–š",LinkSummon:"ãƒªãƒ³ã‚¯å¬å–š"},Ao={BattleDestroy:"æˆ¦é—˜ç ´å£Š",EffectDestroy:"åŠ¹æžœç ´å£Š",RuleDestroy:"ãƒ«ãƒ¼ãƒ«ç ´å£Š"},Nn=i=>i+"Summon",Br=["Card","Token","Avatar"],xo=["Duelist","Squatter"],qn=(i,e)=>Si(i.origin,e.origin),ae=class ae{constructor(e,t,a,r,n,s,c){d(this,"onBeforeMoveEvent",new ze);d(this,"onAfterMoveEvent",new ze);d(this,"seq");d(this,"origin");d(this,"entityType");d(this,"procFilterBundle");d(this,"numericOprsBundle");d(this,"cardRelationBundle");d(this,"statusOperatorBundle");d(this,"moveLog");d(this,"counterHolder");d(this,"face");d(this,"orientation");d(this,"owner");d(this,"fieldCell");d(this,"_status");d(this,"_numericStatus");d(this,"_info");d(this,"actions",[]);d(this,"continuousEffects",[]);d(this,"canBeSummoned");d(this,"canBeMaterial");d(this,"_hasDisappeared",!1);d(this,"toString",()=>`ã€Š${this.nm}ã€‹`);d(this,"setBattlePosition",async(e,t,a,r)=>{let n=`è¡¨ç¤ºå½¢å¼ã®å¤‰æ›´ï¼š${this.toString()}ï¼ˆ${this.battlePositionName}â‡’${Ri[e]}ï¼‰`;const s=[...t];this.battlePosition==="Set"&&(s.push("Flip"),t.includes("Rule")&&(n=`${this.toString()}ã‚’åè»¢å¬å–š`,s.push("FlipSummon"),s.push("AttackSummon"))),this.moveAlone(this.fieldCell,"Monster",e==="Set"?"FaceDown":"FaceUp",e==="Attack"?"Vertical":"Horizontal","Top",s,a,r,r),this.duel.log.info(n,r)});d(this,"setNonFieldMonsterPosition",async(e,t,a,r,n)=>{this.moveAlone(this.fieldCell,e,t==="FaceUp"?"FaceUp":"FaceDown","Vertical","Top",a,r,n,n)});d(this,"setAsSpellTrap",async(e,t,a,r,n)=>{await this.moveAlone(e,t,"FaceDown","Vertical","Top",[...a,"SpellTrapSet"],r,n,n)});d(this,"activateSpellTrapFromHand",async(e,t,a,r,n)=>{await this.moveAlone(e,t,"FaceUp","Vertical","Top",[...a,"CardActivation"],r,n,n)});d(this,"activateSpellTrapOnField",async(e,t,a,r)=>{await this.moveAlone(this.fieldCell,e,"FaceUp","Vertical","Top",[...t,"CardActivation"],a,r,r)});d(this,"draw",async(e,t,a)=>await this.addToHand([...e,"Draw"],t,a));d(this,"addToHand",async(e,t,a)=>await this.moveAlone(this.owner.getHandCell(),this.origin.kind,"FaceDown","Vertical","Bottom",[...e],t,a,a));d(this,"release",async(e,t,a)=>(await this.sendToGraveyard([...e,"Release"],t,a),this.info.isVanished?void 0:this.fieldCell));d(this,"ruleDestory",async()=>(await this.sendToGraveyard(["RuleDestroy"],void 0,void 0),this.info.isVanished?void 0:this.fieldCell));d(this,"sendToGraveyard",(e,t,a)=>ae.sendManyToGraveyardForTheSameReason([this],e,t,a));d(this,"returnToDeck",(e,t,a,r)=>ae.returnManyToDeckForTheSameReason(e,[this],t,a,r));d(this,"banish",(e,t,a)=>ae.banishManyForTheSameReason([this],e,t,a));d(this,"summon",(e,t,a,r,n,s,c)=>ae.summonMany([{entity:this,to:e,chooser:c??s,pos:t}],a,r,n,s));d(this,"moveAlone",async(e,t,a,r,n,s,c,u,l)=>(await ae.moveMany([[this,e,t,a,r,n,s,c,u,l]],void 0),this.fieldCell));d(this,"_move",async(e,t,a,r,n,s,c,u,l)=>{if(!e)throw new Error("illegal argument: to");if(this.onBeforeMoveEvent.trigger({entity:this,args:[e,t,a,r,n,s,c,u,l]}),this._status.kind=t,this.face=a,this.orientation=r,e!==this.fieldCell){if(this.field.duel.clock.turn>0&&await this.field.duel.view.waitAnimation({entity:this,to:e,index:n,count:0}),this.fieldCell.releaseEntities([this]),this.fieldCell.isPlayFieldCell&&!e.isPlayFieldCell&&(this.counterHolder.clear(),this.resetCauseOfDeath(),this.entityType==="Token")){this._hasDisappeared=!0,this.field.duel.log.info(`${this.nm}ã¯æ¶ˆæ»…ã—ãŸã€‚`,this.controller);return}(this.fieldCell.isMonsterZoneLikeCell&&!e.isMonsterZoneLikeCell||t!=="Monster")&&(this.info.equipEntities.filter(o=>o.isOnFieldAsSpellTrap).forEach(o=>{o.info.isDying=!0,o.info.causeOfDeath=["RuleDestroy"],this.controller.writeInfoLog(`è£…å‚™å¯¾è±¡${this.toString()}ä¸åœ¨ã«ã‚ˆã‚Š${o.toString()}ã¯ç ´å£Šã•ã‚ŒãŸã€‚`)}),this.info.equipEntities=[],this.fieldCell.xyzMaterials.forEach(o=>{o.info.isDying=!0,o.info.causeOfDeath=["LostXyzOwner"],this.controller.writeInfoLog(`ã‚¨ã‚¯ã‚·ãƒ¼ã‚ºãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼${this.toString()}ä¸åœ¨ã«ã‚ˆã‚Š${o.toString()}ã¯å¢“åœ°ã«é€ã‚‰ã‚ŒãŸã€‚`)})),this.fieldCell.cellType==="SpellAndTrapZone"&&e.cellType!=="SpellAndTrapZone"&&(this.info.equipedBy=void 0,this.info.equipedAs=void 0),e.acceptEntities([this],n),(e===this.isBelongTo||e.cellType==="Hand"||e.cellType==="Banished"&&this.face==="FaceDown")&&(this.counterHolder.clear(),this.resetInfoAll(),this.resetStatusAll())}return this.isOnField&&this.face==="FaceDown"&&(this.info.equipEntities.forEach(o=>{o.info.isDying=!0,o.info.causeOfDeath=["RuleDestroy"],this.controller.writeInfoLog(`è£…å‚™å¯¾è±¡${this.toString()}ä¸åœ¨ã«ã‚ˆã‚Š${o.toString()}ã¯ç ´å£Šã•ã‚ŒãŸã€‚`)}),this.counterHolder.removeAllWhenfaceDown(),this.info.materials=[],this._status.isEffective=!0,this.info.isEffectiveIn=[...bi],this.info.willBeBanished=!1,this.info.willReturnToDeck=void 0,this.resetNumericStatus(),this.info.isSettingSickness=this.status.kind==="Trap"||this.status.spellCategory==="QuickPlay"),this.moveLog.push(s,c,u,l),console.log(this.toString()),this.onAfterMoveEvent.trigger(this),e});d(this,"initForTurn",()=>{this.info.isSettingSickness=!1,this.info.attackCount=0,this.info.battlePotisionChangeCount=0,this.counterHolder.corpseDisposal()});d(this,"resetInfoIfLeavesTheField",()=>{this._info={...this._info,isDying:!1,isPending:!1,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,effectTargets:{},attackCount:0,battlePotisionChangeCount:0,equipedBy:void 0,equipedAs:void 0,equipEntities:[]},this._info.isEffectiveIn.push(...di),this._info.isEffectiveIn.distinct()});d(this,"resetInfoAll",()=>{var e;this._info={isDying:!1,isPending:!1,isEffectiveIn:[...bi],causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,isVanished:!1,isRebornable:((e=this.origin.monsterCategories)==null?void 0:e.union(Dn).length)===0,isSettingSickness:!1,materials:[],effectTargets:{},willBeBanished:!1,willReturnToDeck:void 0,attackCount:0,battlePotisionChangeCount:0,equipedBy:void 0,equipedAs:void 0,validateEquipOwner:()=>!0,equipEntities:[]},this.counterHolder.clear()});d(this,"resetNumericStatus",()=>{const e=En.reduce((t,a)=>(t[a]=this.origin[a],t),{});this._numericStatus={origin:{...e},wip:{...e},calculated:{...e}}});d(this,"resetStatus",()=>{this._status={...this.origin,canAttack:!0,isEffective:!0,canDirectAttack:!1,isSelectableForAttack:!0,allowHandSyncro:!1,maxCounterQty:{}}});d(this,"resetStatusAll",()=>{this.resetNumericStatus(),this.resetStatus()});d(this,"resetCauseOfDeath",()=>{this.info.isDying=!1,this.info.causeOfDeath=[],this.info.isKilledBy=void 0,this.info.isKilledByWhom=void 0});var f;this.seq=ae.nextEntitySeq++,this.counterHolder=new no,this.owner=e,this.fieldCell=t,this.entityType=a,this.origin=r,this._status=JSON.parse(JSON.stringify(r)),this._numericStatus=JSON.parse(JSON.stringify(r)),this.resetStatusAll(),this._info={isEffectiveIn:[...bi],attackCount:0,battlePotisionChangeCount:0,isDying:!1,isPending:!1,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,isVanished:!1,isRebornable:!0,isSettingSickness:!1,materials:[],effectTargets:{},willBeBanished:!1,willReturnToDeck:void 0,equipedBy:void 0,equipedAs:void 0,validateEquipOwner:()=>!0,equipEntities:[]},this.resetInfoAll(),this.face=n,this.orientation=s,this.procFilterBundle=new jl(t.field.procFilterPool,this),this.numericOprsBundle=new Gl(t.field.numericStateOperatorPool,this),this.cardRelationBundle=new eo(t.field.cardRelationPool,this),this.statusOperatorBundle=new lo(t.field.statusOperatorPool,this),t.acceptEntities([this],"Top"),this.moveLog=new to(this),this.moveLog.pushForRuleAction(["Spawn"]);let u=[],l=[];this.origin.kind==="Monster"&&((f=this.origin.monsterCategories)!=null&&f.includes("Normal"))?u=[Ye,He,$e]:c&&(u=c.actions,l=c.continuousEffects??[]),this.actions.push(...u.map(p=>Ht.createNew(this,p))),this.continuousEffects.push(...l.map(p=>La.createNew(this,p)));const o=(c==null?void 0:c.canBeSummoned)??(()=>!0);this.canBeSummoned=(p,h,y,w,_,S)=>o(p,this,h,y,w,_,S),this.canBeMaterial=(p,h,y,w,_,S,E)=>c!=null&&c.canBeMaterial&&!(c!=null&&c.canBeMaterial(p,h,y,w,_,S,E))?!1:this.procFilterBundle.operators.filter(T=>T.procTypes.some(N=>N===w)).every(T=>T.filter(y.entity.controller,y.entity,y,S.map(N=>N.material)))}get onBeforeMove(){return this.onBeforeMoveEvent.expose()}get onAfterMove(){return this.onAfterMoveEvent.expose()}get isUnderControl(){return this.face==="FaceUp"||An.every(e=>e!==this.fieldCell.cellType)}get controller(){return this.fieldCell.owner??this.owner}get field(){return this.owner.duel.field}get duel(){return this.owner.duel.field.duel}get actionLogRecords(){return this.duel.chainBlockLog.records.filter(e=>e.chainBlockInfo.action.entity===this)}get status(){return this._status}set status(e){this._status={...e}}get numericStatus(){return this._numericStatus}get info(){return this._info}get nm(){return this.status.name}get atk(){return this._numericStatus.calculated.attack}get def(){return this._numericStatus.calculated.defense}get lvl(){return this._numericStatus.calculated.level}get rank(){return this._numericStatus.calculated.rank}get attr(){return this.status.attributes??[]}get types(){return this.status.types??[]}get psL(){return this._numericStatus.calculated.pendulumScaleL}get psR(){return this._numericStatus.calculated.pendulumScaleR}get isEffective(){return this.status.isEffective&&this.info.isEffectiveIn.includes(this.fieldCell.cellType)}get isEffectiveWeakly(){return this.status.isEffective}get battlePosition(){if(this.isOnField&&this.status.kind==="Monster")return this.orientation==="Vertical"?"Attack":this.face==="FaceUp"?"Defense":"Set"}get battlePositionName(){const e=this.battlePosition;if(e)return Ri[e]}get wasMovedAtCurrentProc(){return this.field.duel.clock.totalProcSeq===this.moveLog.latestRecord.movedAt.totalProcSeq}get wasMovedAtPreviousProc(){return this.field.duel.clock.totalProcSeq===this.moveLog.latestRecord.movedAt.totalProcSeq+1}get wasMovedAtCurrentChain(){return this.field.duel.clock.isSameChain(this.moveLog.latestRecord.movedAt)}get wasMovedAtPreviousChain(){return this.field.duel.clock.isPreviousChain(this.moveLog.latestRecord.movedAt)}get wasMovedFrom(){return this.moveLog.previousPlaceRecord.cell}get isOnField(){return di.some(e=>e===this.fieldCell.cellType)}get isOnFieldAsMonster(){return ci.some(e=>e===this.fieldCell.cellType)}get isOnFieldAsSpellTrap(){return At.some(e=>e===this.fieldCell.cellType)}get isLikeContinuousSpell(){return this.status.spellCategory==="Continuous"||this.status.spellCategory==="Field"||this.status.spellCategory==="Equip"||this.status.trapCategory==="Continuous"||(this.status.monsterCategories??[]).includes("Pendulum")}get isBelongTo(){return this.origin.monsterCategories&&this.origin.monsterCategories.union(oi).length?this.owner.getExtraDeck():this.owner.getDeckCell()}get hasDisappeared(){return this._hasDisappeared}get allStickyEffectOperators(){return[...this.procFilterBundle.operators,...this.numericOprsBundle.operators,...this.cardRelationBundle.operators]}};d(ae,"nextEntitySeq",0),d(ae,"splitBattlePos",e=>({face:e==="Set"?"FaceDown":"FaceUp",orientation:e==="Attack"?"Vertical":"Horizontal"})),d(ae,"recreateArray",(e,t)=>{if(!t.length)return[];const a=e.getAllCells().flatMap(r=>r.entities);return t.map(r=>r.seq).map(r=>a.find(n=>n.seq===r)).filter(r=>r!==void 0)}),d(ae,"createPlayerEntity",e=>{const t=e.getHandCell();return new ae(e,t,"Duelist",{name:e.profile.name,kind:"Monster",wikiEncodedName:"%A5%D7%A5%EC%A5%A4%A5%E4%A1%BC"},"FaceUp","Vertical",void 0)}),d(ae,"createCardEntity",(e,t)=>{const a=t.monsterCategories&&t.monsterCategories.union(oi).length?e.getExtraDeck():e.getDeckCell(),r=new ae(e,a,"Card",Ol(t),"FaceDown","Vertical",Ya.get(t.name));return Object.hasOwn(Ie,r.origin.name)||e.duel.log.info(`æœªå®Ÿè£…ã‚«ãƒ¼ãƒ‰${t.name}ãŒãƒ‡ãƒƒã‚­ã«æŠ•å…¥ã•ã‚ŒãŸã€‚`,e),r}),d(ae,"waitCorpseDisposal",e=>ae.sendManyToGraveyard(e.field.getEntiteisOnField().filter(t=>t.info.isDying).map(t=>({entity:t,causedAs:t.info.causeOfDeath??[],causedBy:t.info.isKilledBy,activator:t.info.isKilledByWhom})))),d(ae,"sendManyToGraveyardForTheSameReason",(e,t,a,r)=>ae.bringManyToSameCellForTheSameReason("Graveyard","Top",e,"FaceUp","Vertical",t,a,r)),d(ae,"banishManyForTheSameReason",(e,t,a,r)=>ae.bringManyToSameCellForTheSameReason("Banished","Top",e,"FaceUp","Vertical",t,a,r)),d(ae,"returnManyToDeckForTheSameReason",(e,t,a,r,n)=>ae.bringManyToSameCellForTheSameReason("Deck",e,t,"FaceDown","Vertical",a,r,n)),d(ae,"returnManyToHandForTheSameReason",(e,t,a,r)=>ae.bringManyToSameCellForTheSameReason("Hand","Bottom",e,"FaceDown","Vertical",t,a,r)),d(ae,"convertManyToXyzMaterials",(e,t,a,r)=>ae.moveMany(e.map(n=>[n,n.fieldCell,"XyzMaterial","FaceUp","Vertical","Top",t,a,r,r]))),d(ae,"moveToXyzOwner",(e,t,a,r,n)=>ae.moveMany(t.map(s=>[s,e,"XyzMaterial","FaceUp","Vertical","Top",a,r,n,n]))),d(ae,"sendManyToGraveyard",(e,t)=>ae.bringManyToSameCell("Graveyard","Top",e.map(a=>({...a,face:"FaceUp",orientation:"Vertical"})),t)),d(ae,"banishMany",(e,t)=>ae.bringManyToSameCell("Banished","Top",e.map(a=>({...a,face:"FaceUp",orientation:"Vertical"})),t)),d(ae,"bringManyToSameCellForTheSameReason",(e,t,a,r,n,s,c,u)=>ae.bringManyToSameCell(e,t,a.map(l=>({entity:l,face:r,orientation:n,causedAs:s,causedBy:c,activator:u})))),d(ae,"bringManyToSameCell",(e,t,a,r)=>ae.moveMany(a.map(n=>[n.entity,n.entity.field.getCells(e).filter(s=>s.owner===n.entity.owner)[0],n.entity.origin.kind,n.face,n.orientation,t,n.causedAs,n.causedBy,n.activator,n.activator]),r)),d(ae,"moveMany",async(e,t)=>{if(!e.length)return;const a=e[0][0].duel,n=[...e.map(([c])=>c).filter(c=>!(t??[]).includes(c)),...a.field.getEntiteisOnField().filter(c=>c.info.isDying)],s=new Map;for(e.forEach(([c,u,l,o,f,p,...h])=>{let y=u,w=l,_=o,S=p,E=f;c.info.willBeBanished&&(y=c.owner.getBanished(),_="FaceUp",E="Vertical"),c.info.willReturnToDeck&&(y=c.isBelongTo,_="FaceDown",S=c.info.willReturnToDeck,E="Vertical"),c.isBelongTo.cellType==="ExtraDeck"&&(y.cellType==="Hand"||y.cellType==="Deck")&&(y=c.isBelongTo,_="FaceDown",E="Vertical"),y.isPlayFieldCell||(w=c.origin.kind),y.isMonsterZoneLikeCell||(E="Vertical"),s.set(y,[[c,y,w,_,E,S,...h],...s.get(y)??[]])});;){const c=Array.from(s.values()).map(l=>l.pop()).filter(l=>l!==void 0).map(([l,...o])=>l._move(...o));if(!c.length)break;await Promise.all(c),a.field.cardRelationPool.excludesExpired();const u=a.field.getEntiteisOnField().filter(l=>l.info.isDying).filter(l=>!n.includes(l)).map(l=>({entity:l,causedAs:l.info.causeOfDeath??[],causedBy:l.info.isKilledBy,activator:l.info.isKilledByWhom}));u.length&&await ae.sendManyToGraveyard(u,n)}ae.settleEntityMove(a)}),d(ae,"summonMany",async(e,t,a,r,n)=>{if(!e.length)return;const s={Attack:"AttackSummon",Defense:"DefenseSummon",Set:"SetSummon"};await Promise.all(e.map(async({entity:c,to:u,pos:l,chooser:o})=>{if(t==="NormalSummon"||t==="AdvanceSummon"){const h=t==="AdvanceSummon"?"ã‚¢ãƒ‰ãƒãƒ³ã‚¹":"";l==="Attack"?c.field.duel.log.info(`${c.toString()}ã‚’${h}å¬å–š`,o):c.duel.log.info(`${c.toString()}ã‚’${h}ã‚»ãƒƒãƒˆ`,o),a.includes("Rule")?o.info.ruleNormalSummonCountQty++:o.info.effectNormalSummonCountQty++}else t==="SpecialSummon"?c.duel.log.info(`${c.toString()}ã‚’${Ri[l]}ã§ç‰¹æ®Šå¬å–š`,o):c.duel.log.info(`${c.toString()}ã‚’${Ri[l]}ã§${Eo[t]}ï¼`,o),o.info.specialSummonCountQty++;c.info.battlePotisionChangeCount=1;const{face:f,orientation:p}=ae.splitBattlePos(l);await c._move(u,"Monster",f,p,"Top",[t,s[l],...a],r,n,o)})),e.map(c=>c.chooser).forEach(c=>{t==="NormalSummon"||t==="AdvanceSummon"?a.includes("Rule")?c.info.ruleNormalSummonCount++:c.info.effectNormalSummonCount++:c.info.specialSummonCount++}),ae.settleEntityMove(e[0].entity.duel)}),d(ae,"settleEntityMove",e=>{e.distributeOperators(e.clock.totalProcSeq);const t=e.field.getAllEntities().filter(a=>a.wasMovedAtCurrentProc);t.filter(a=>!a.isOnField).forEach(a=>a.resetInfoIfLeavesTheField()),t.filter(a=>a.face==="FaceDown").filter(a=>a.fieldCell===a.isBelongTo).forEach(a=>{a.resetInfoAll(),a.resetStatusAll()}),t.flatMap(a=>a.continuousEffects).forEach(a=>a.updateState()),e.field.getAllCells().filter(a=>a.needsShuffle).map(a=>a.shuffle())});let ye=ae;class Or{constructor(e,t,a,r,n,s=[]){d(this,"duel");d(this,"seat");d(this,"_entity");d(this,"profile");d(this,"deckInfo");d(this,"info");d(this,"infoOrigin");d(this,"status");d(this,"statusOrigin");d(this,"duelistType");d(this,"lifeLog");d(this,"actionBlackListForNPC");d(this,"_lp");d(this,"initHand");d(this,"writeInfoLog",e=>{this.duel.log.info(e,this)});d(this,"initForDrawPhase",()=>{this.info={...this.infoOrigin}});d(this,"canSummon",(e,t,a,r,n,s)=>this.entity.procFilterBundle.operators.filter(c=>c.procTypes.some(u=>u===r)).every(c=>c.filter(e,t,a,s.map(u=>u.material)))?this.entity.procFilterBundle.operators.filter(c=>c.procTypes.some(u=>u===Nn(n))).every(c=>c.filter(e,t,a,s.map(u=>u.material))):!1);d(this,"canTryBanish",(e,t,a)=>this.entity.procFilterBundle.operators.filter(r=>r.procTypes.includes(t)).every(r=>r.filter(this,this.entity,a,[e])));d(this,"battleDamage",(e,t)=>this.setLp(this._lp-e,t,"BattleDamage"));d(this,"effectDamage",(e,t)=>this.setLp(this._lp-e,t,"EffectDamage"));d(this,"lostLp",(e,t)=>this.setLp(this._lp-e,t,"Lost"));d(this,"payLp",(e,t)=>this.setLp(this._lp-e,t,"Pay"));d(this,"heal",(e,t)=>this.setLp(this._lp+e,t,"Heal"));d(this,"setLp",(e,t,a)=>{const r={clock:this.duel.clock,reason:a||"Set",beforeLp:this._lp,afterLp:e,entity:t};return this.lifeLog.push(r),this._lp=e,this.writeInfoLog(`ãƒ©ã‚¤ãƒ•ãƒã‚¤ãƒ³ãƒˆå¤‰å‹•ï¼š${r.afterLp-r.beforeLp}ï¼ˆ${r.beforeLp} â‡’ ${r.afterLp}ï¼‰`),r});d(this,"getOpponentPlayer",()=>this.duel.firstPlayer===this?this.duel.secondPlayer:this.duel.firstPlayer);d(this,"getHandCell",()=>this.duel.field.getCells("Hand").filter(e=>e.owner===this)[0]);d(this,"getDeckCell",()=>this.duel.field.getCells("Deck").filter(e=>e.owner===this)[0]);d(this,"getExtraDeck",()=>this.duel.field.getCells("ExtraDeck").filter(e=>e.owner===this)[0]);d(this,"getGraveyard",()=>this.duel.field.getCells("Graveyard").filter(e=>e.owner===this)[0]);d(this,"getFieldZone",()=>this.duel.field.getCells("FieldSpellZone").filter(e=>e.owner===this)[0]);d(this,"getBanished",()=>this.duel.field.getCells("Banished").filter(e=>e.owner===this)[0]);d(this,"getMonsterZones",()=>this.duel.field.getCells("MonsterZone").filter(e=>e.owner===this));d(this,"getExtraMonsterZones",()=>this.duel.field.getCells("ExtraMonsterZone").filter(e=>{var t;return((t=e.cardEntities[0])==null?void 0:t.controller)===this}));d(this,"getSpellTrapZones",()=>this.duel.field.getCells("SpellAndTrapZone").filter(e=>e.owner===this));d(this,"getXyzMaterialZone",()=>this.duel.field.getCells("XyzMaterialZone").filter(e=>e.owner===this)[0]);d(this,"getEmptyMonsterZones",()=>this.getMonsterZones().filter(e=>e.cardEntities.length===0));d(this,"getEmptyExtraZones",()=>this.getExtraMonsterZones().length===0?this.getMonsterZones().filter(e=>e.cardEntities.length===0):[]);d(this,"getAvailableMonsterZones",()=>this.getMonsterZones().filter(e=>e.isAvailable));d(this,"getAvailableExtraZones",()=>this.getExtraMonsterZones().length===0?this.duel.field.getCells("ExtraMonsterZone").filter(e=>e.isAvailable):[]);d(this,"getAvailableSpellTrapZones",()=>this.getSpellTrapZones().filter(e=>e.isAvailable));d(this,"getReleasableMonsters",()=>this.getMonstersOnField());d(this,"getMonstersOnField",()=>this.duel.field.getMonstersOnField().filter(e=>e.controller===this));d(this,"getEntiteisOnField",()=>this.duel.field.getEntiteisOnField().filter(e=>e.controller===this));d(this,"pushDeck",()=>{this.deckInfo.cardNames.map(e=>Ie[e]).filter(e=>e).forEach(e=>ye.createCardEntity(this,e)),this.duel.log.info(`ãƒ‡ãƒƒã‚­ã‚’ã‚»ãƒƒãƒˆã€‚ãƒ¡ã‚¤ãƒ³${this.getDeckCell().cardEntities.length}æžšã€‚ã‚¨ã‚¯ã‚¹ãƒˆãƒ©${this.getExtraDeck().cardEntities.length}æžšã€‚`,this)});d(this,"draw",async(e,t,a)=>{var s;if(e<1)return;const r=this.getDeckCell(),n=[];for(const c of Array(e)){if(!r.cardEntities.length)throw this.writeInfoLog(n.length>0?`ãƒ‡ãƒƒã‚­ã‹ã‚‰ã‚«ãƒ¼ãƒ‰ã‚’${e}æžšãƒ‰ãƒ­ãƒ¼ã—ã‚ˆã†ã¨ã—ãŸãŒã€${n.length}æžšã—ã‹ãƒ‰ãƒ­ãƒ¼ã§ããªã‹ã£ãŸã€‚${n}`:"ãƒ‡ãƒƒã‚­ã‹ã‚‰ã‚«ãƒ¼ãƒ‰ã‚’ãƒ‰ãƒ­ãƒ¼ã§ããªã‹ã£ãŸã€‚"),this.duel.isEnded=!0,this.setLp(0),new Yt(this.getOpponentPlayer());const u=r.cardEntities[0];await u.draw(t?["Effect"]:["Rule"],t,a),n.push(((s=u.origin)==null?void 0:s.name)||"!åç§°å–å¾—å¤±æ•—!")}this.writeInfoLog(`ãƒ‡ãƒƒã‚­ã‹ã‚‰ã‚«ãƒ¼ãƒ‰ã‚’${n.length}æžšãƒ‰ãƒ­ãƒ¼ã€‚${n}ã€‚`)});d(this,"discard",async(e,t,a,r,n,s)=>{const c=n||(()=>!0),u=this.getHandCell().cardEntities.filter(c);if(u.length<e)return[];let l=[];return(r||this).duelistType==="NPC"?l=u.randomPickMany(e):l=await this.duel.view.waitSelectEntities(r||this,u,e,o=>o.length===e,`${e}æžšã‚«ãƒ¼ãƒ‰ã‚’æ¨ã¦ã‚‹ã€‚`,!1)||[],await ye.sendManyToGraveyardForTheSameReason(l,["Discard",...t],a,s),this.writeInfoLog(`æ‰‹æœ­ã‹ã‚‰ã‚«ãƒ¼ãƒ‰ã‚’${l.length}æžšæ¨ã¦ãŸã€‚${l.map(o=>{var f;return(f=o.origin)==null?void 0:f.name})}ã€‚`),l});d(this,"summon",async(e,t,a,r,n,s,c=!1)=>{let u=t.randomPick(),l=a.randomPick();if((a.length>1||t.length>1)&&this.duelistType!=="NPC"){const o=a.length>1?"ã‚«ãƒ¼ãƒ‰ã‚’å¬å–šå…ˆã¸ãƒ‰ãƒ©ãƒƒã‚°ã€‚":"è¡¨ç¤ºå½¢å¼ã‚’é¸æŠžã€‚",f=t.map(w=>Ht.createDammyAction(e,w,a,w)),p=this.duel.view.modalController.selectAction(this.duel.view,{title:o,activator:this,actions:f,cancelable:!1}),h=this.duel.view.waitSubAction(this,f,o,c).then(w=>w.action),y=await Promise.any([p,h]);if(!y&&!c)throw new Se("",y);if(!y)return;l=y.cell||l,u=y.pos||u}return await e.summon(l,u,r,n,s,this),e});d(this,"selectAttackTargetForNPC",(e,t)=>{const a=e.atk??0,r=e.getAttackTargets();if(!r.length)return;const n=r.find(s=>s.entityType==="Duelist");return n&&(a>=Ba(1600,this.getOpponentPlayer().lp)||e.info.battlePotisionChangeCount>0)?n:r.find(s=>s.battlePosition==="Attack"?a>=(s.atk??0):a<(s.battlePosition==="Set"?1e3:s.def??0)?!1:s.validateDestory("BattleDestroy",this,e,t))});d(this,"selectActionForNPC",(e,t)=>{if(!e.length)return;const a=e.filter(_=>_.playType==="MandatoryIgnitionEffect"||_.playType==="MandatoryTriggerEffect");if(a.length)return a.randomPick();let r=e.filter(_=>!this.actionBlackListForNPC.includes(_.playType));const n=r.filter(_=>!Number.isNaN(_.priorityForNPC)).shuffle().sort((_,S)=>_.priorityForNPC-S.priorityForNPC);if(n.length)return n[0];const s=r.filter(_=>_.playType==="TriggerEffect");if(s.length)return s.randomPick();if(this.duel.phase!=="main1"&&this.duel.phase!=="main2"){const _=r.filter(S=>S.playType==="IgnitionEffect");if(_.length)return _.randomPick()}const c=r.filter(_=>_.playType==="Battle").sort((_,S)=>(_.entity.atk??0)-(S.entity.atk??0));if(c.length)return c.find(_=>this.selectAttackTargetForNPC(_.entity,_));r=r.filter(_=>_.playType!=="Battle");const u=r.length?t.slice(-1)[0]:void 0,l=r.filter(_=>_.negatePreviousBlock);if(u&&u.activator!==this&&l)return l.randomPick();if(r=r.filter(_=>!_.negatePreviousBlock),!r.length)return;const o=Tr(...this.getOpponentPlayer().getMonstersOnField().filter(_=>_.battlePosition==="Attack").map(_=>_.atk??0),1600),f=Ba(...this.getOpponentPlayer().getMonstersOnField().map(_=>_.battlePosition==="Set"?1500:(_.battlePosition==="Attack"?_.atk:_.def)??0),1500),p=this.getMonstersOnField(),h=Tr(...p.filter(_=>_.battlePosition==="Attack").map(_=>_.atk??0),0);let y=r.filter(_=>_.playType!=="ChangeBattlePosition").filter(_=>_.entity.battlePosition!=="Attack").filter(_=>(_.entity.atk??0)>=o||(_.entity.atk??0)>f&&(_.entity.atk??0)>2300);if(y.length)return y.randomPick();r=r.filter(_=>_.playType!=="ChangeBattlePosition").filter(_=>_.playType!=="SpellTrapSet").filter(_=>_.entity.actions.filter(S=>S.playType!=="NormalSummon"&&S.playType!=="SpecialSummon").flatMap(S=>S.executableCells).every(S=>S!=="Hand")||_.playType!=="NormalSummon"&&_.playType!=="SpecialSummon");const w=[...r.filter(_=>_.playType==="NormalSummon").filter(_=>(_.entity.lvl??12)<5),...r.filter(_=>_.playType==="SpecialSummon"),...r.filter(_=>_.playType==="NormalSummon").filter(_=>(_.entity.atk??0)>2600||(_.entity.atk??0)>2300&&(_.entity.lvl??12)<7).filter(_=>(_.entity.atk??0)>=h),...r.filter(_=>_.entity.face==="FaceUp").filter(_=>_.entity.isOnField)];if(w.length)return w.randomPick();if(r=r.filter(_=>_.playType!=="NormalSummon").filter(_=>_.playType!=="SpecialSummon"),this.duel.phase==="main2"){if(y=e.filter(_=>_.playType==="ChangeBattlePosition").filter(_=>_.entity.battlePosition==="Attack").filter(_=>(_.entity.atk??0)<o||(_.entity.atk??0)>f&&(_.entity.atk??0)>2300),y.length)return y.randomPick();if(this.getAvailableSpellTrapZones.length>1)return e.filter(_=>_.playType==="SpellTrapSet").filter(_=>_.entity.status.kind!=="Spell"||_.entity.status.spellCategory==="QuickPlay").randomPick()}if(Math.random()<r.length/4)return r.randomPick()});this.duel=e,this.seat=t,this.profile=a,this.duelistType=r,this.deckInfo=n,this.initHand=s,this.lifeLog=[],this.infoOrigin={maxRuleNormalSummonCount:1,ruleNormalSummonCount:0,ruleNormalSummonCountQty:0,effectNormalSummonCount:0,effectNormalSummonCountQty:0,specialSummonCount:0,specialSummonCountQty:0},this.info={...this.infoOrigin},this.statusOrigin={maxSpecialSummonCount:Number.MAX_VALUE,canDrawByEffect:!0,canSearchFromDeck:!0,canDiscardAsCost:!0,canDiscardAsEffect:!0},this.status={...this.statusOrigin},this._lp=8e3;const c=[];this.duelistType==="NPC"&&(this.profile.npcLvl<1&&c.push("CardActivation","IgnitionEffect","TriggerEffect","QuickEffect"),this.profile.npcLvl<101&&c.push("Battle")),this.actionBlackListForNPC=c}get entity(){const e=this.getHandCell().entities.find(t=>t.entityType==="Duelist");return e||ye.createPlayerEntity(this)}get lp(){return this._lp}get isTurnPlayer(){return this.duel.getTurnPlayer()===this}get canDraw(){return!0}get canAddToHandFromDeck(){return!0}}class Po{constructor(e){d(this,"cells");d(this,"duel");d(this,"procFilterPool");d(this,"numericStateOperatorPool");d(this,"cardRelationPool");d(this,"statusOperatorPool");d(this,"getAllCells",()=>this.cells.flat());d(this,"getCells",(...e)=>this.getAllCells().filter(t=>e.includes(t.cellType)));d(this,"getAllEntities",()=>this.getAllCells().map(e=>e.entities).flat());d(this,"getAllCardEntities",()=>this.getAllCells().map(e=>e.cardEntities).flat());d(this,"getMonstersOnField",()=>this.getCells(...ci).map(e=>e.cardEntities).filter(e=>e.length>0).map(e=>e[0]));d(this,"getEntiteisOnField",()=>this.getCells(...di).map(e=>e.entities).filter(e=>e.length>0).map(e=>e[0]));d(this,"getEntities",e=>this.getAllEntities().filter(t=>t.controller===e));d(this,"drawAtSameTime",async(e,t,a,r,n,s)=>{const c=[],u=[],l=[e.draw(t,n,s),a.draw(r,n,s)].map(o=>o.catch(f=>{f instanceof Yt?f.winner&&c.push(f.winner):u.push(f)}));if(await Promise.all(l),u.length)throw new Se("ãƒ‰ãƒ­ãƒ¼å‡¦ç†ã§æƒ³å®šã•ã‚Œãªã„ä¾‹å¤–ãŒç™ºç”Ÿã—ãŸã€‚",e,t,a,r,n,...u);if(c.length!==0)throw c.length===1?new Yt(c[0]):new Yt});d(this,"sendToGraveyard",async(e,t,a,r,n,s,c,u)=>{if(r>0&&a.length<r)return;const l=await this.duel.view.waitSelectEntities(t,a,r,n,e,u);if(l)return await ye.sendManyToGraveyard(l.map(o=>({entity:o,causedAs:s,causedBy:c,activator:t}))),this.duel.log.info(`${l.map(o=>o.status.name).join(", ")}ã‚’å¢“åœ°ã«é€ã£ãŸï¼ˆ${s.getDistinct().join(", ")}ï¼‰ã€‚`,t),l});d(this,"release",async(e,t,a,r,n,s,c,u)=>{if(a>0&&t.length<a)return;const l=await this.duel.view.waitSelectEntities(e,t,a,f=>(c||f.length>0)&&(a<0||f.length===a),"ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’é¸æŠž",u);if(!l)return;const o=[];for(const f of l)await f.release(["Release",r,...n],s,e),o.push(f);return this.duel.log.info(`${o.map(f=>f.status.name).join(", ")}ã‚’ãƒªãƒªãƒ¼ã‚¹ï¼ˆ${o.flatMap(f=>f.moveLog.latestRecord.movedAs).getDistinct().join(", ")}ï¼‰ã€‚`,e),o});d(this,"activateSpellTrapFromHand",async(e,t,a,r,n,s,c=!1)=>{const u=s??(n==null?void 0:n.controller)??t.controller;let l=a.randomPick();if(a.length>1&&u.duelistType!=="NPC"){const o=[Ht.createDammyAction(t,"ã‚«ãƒ¼ãƒ‰ã®ç™ºå‹•",a,void 0)];this.duel.view.modalController.selectAction(this.duel.view,{title:"ã‚«ãƒ¼ãƒ‰ã‚’é­”æ³•ç½ ã‚¾ãƒ¼ãƒ³ã¸ãƒ‰ãƒ©ãƒƒã‚°",activator:e,actions:o,cancelable:!1});const f=await this.duel.view.waitSubAction(u,o,"ã‚«ãƒ¼ãƒ‰ã‚’é­”æ³•ç½ ã‚¾ãƒ¼ãƒ³ã¸ãƒ‰ãƒ©ãƒƒã‚°ã€‚",c),p=f.action;if(!p&&!c)throw new Se("",f);if(!p)return;l=p.cell||l}return await t.activateSpellTrapFromHand(l,t.origin.kind,r,n,u),t});d(this,"setSpellTrap",async(e,t,a,r,n,s=!1)=>{let c=a[0];const u=n??(r==null?void 0:r.controller)??t.controller;if(a.length>1&&u.duelistType!=="NPC"){const l=[Ht.createDammyAction(t,"ã‚»ãƒƒãƒˆ",a)],o=this.duel.view.modalController.selectAction(this.duel.view,{title:"ã‚«ãƒ¼ãƒ‰ã‚’ã‚»ãƒƒãƒˆå…ˆã¸ãƒ‰ãƒ©ãƒƒã‚°",activator:e,actions:l,cancelable:s}),f=this.duel.view.waitSubAction(u,l,"ã‚«ãƒ¼ãƒ‰ã‚’ã‚»ãƒƒãƒˆå…ˆã¸ãƒ‰ãƒ©ãƒƒã‚°",s),p=await Promise.any([o,f.then(h=>h.action)]);if(!p&&!s)throw new Se("",p);if(!p)return;c=p.cell||c}return await t.setAsSpellTrap(c,t.origin.kind,["SpellTrapSet"],r,u),this.duel.log.info(`${t.status.name}ã‚’ã‚»ãƒƒãƒˆï¼ˆSpellTrapSetï¼‰ã€‚`,n??(r==null?void 0:r.controller)??t.controller),c});this.duel=e,this.cells=[...Array(7)].map(()=>[]);for(const t of Object.keys(qa).map(Number))for(const a of Object.keys(qa[t]).map(Number))this.cells[t][a]=new Ll(this,t,a,t<3?e.duelists.Above:t>3?e.duelists.Below:a<2?e.duelists.Above:a>4?e.duelists.Below:void 0);this.procFilterPool=new $l,this.numericStateOperatorPool=new Zl,this.cardRelationPool=new Il,this.statusOperatorPool=new so}}let Mo=class{constructor(e){d(this,"onUpdateEvent",new ze);d(this,"nextSeq");d(this,"records",[]);d(this,"duel");d(this,"dispose",()=>{this.onUpdateEvent.clear()});d(this,"error",e=>{console.error(e);const t=["ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ"];e instanceof Error?(e instanceof Se&&(t.push("-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ --"),t.push(e.message),t.push("-- é–¢é€£ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ --"),e.items.forEach(a=>t.push(JSON.stringify(a)))),t.push("-- ã‚¨ãƒ©ãƒ¼åç§° --"),t.push(e.name||"ã‚¨ãƒ©ãƒ¼åç§°å–å¾—å¤±æ•—"),t.push("-- ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ --"),t.push(e.stack||"ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹å–å¾—å¤±æ•—")):(t.push("-- ã‚¨ãƒ©ãƒ¼åž‹ç‰¹å®šå¤±æ•— --"),t.push(JSON.stringify(e))),this.write("error",t)});d(this,"warn",e=>{this.write("warn",["ã€æ³¨æ„ã€‘",e])});d(this,"info",(e,t)=>{this.write("info",[e],t)});d(this,"write",(e,t,a)=>{const r=Array.isArray(t)?t.join(`
`):t;this.records.push({seq:this.nextSeq++,lvl:e,turn:this.duel.clock.turn,periodKey:this.duel.clock.period.key,clock:this.duel.clock,duelist:a,text:r}),this.onUpdateEvent.trigger()});this.nextSeq=0,this.duel=e}get onUpdate(){return this.onUpdateEvent.expose()}get lastRecord(){return this.records.slice(-1)[0]}};const Nr=["DuelEntitiesSelector","DuelActionSelector","DuelTextSelector"];class Fo{constructor(e){d(this,"onUpdateEvent",new ze);d(this,"states");d(this,"view");d(this,"cancelAll",()=>{Nr.forEach(e=>this.states[e]="Disable"),console.info(this,"cancelAll"),this.onUpdateEvent.trigger()});d(this,"duelEntitiesSelectorArg",{title:"å¯¾è±¡ã‚’é¸æŠž",entities:[],validator:()=>!0,qty:-1,cancelable:!1});d(this,"duelEntitiesSelectorValue");d(this,"duelEntitiesSelectorResolve",()=>{});d(this,"selectDuelEntities",async e=>(this.duelEntitiesSelectorArg=e,this.states.DuelEntitiesSelector="Shown",this.onUpdateEvent.trigger(),new Promise(t=>{this.duelEntitiesSelectorResolve=a=>{this.states.DuelEntitiesSelector="Disable",this.onUpdateEvent.trigger(),t(a)}})));d(this,"cardActionSelectorArg",{title:"ã‚«ãƒ¼ãƒ‰æ“ä½œã‚’é¸æŠžã€‚",activator:void 0,actions:[],cancelable:!1});d(this,"cardActionSelectorResolve",()=>{});d(this,"cardActionSelectorValue");d(this,"selectAction",async(e,t)=>(this.cardActionSelectorArg=t,this.states.DuelActionSelector="Shown",e.onWaitEnd.append(this.cancelAll),this.onUpdateEvent.trigger(),new Promise(a=>{this.cardActionSelectorResolve=r=>{this.states.DuelActionSelector="Disable",e.onWaitEnd.remove(this.cancelAll),this.onUpdateEvent.trigger(),a(r)}})));d(this,"duelTextSelectorArg",{title:"ã‚«ãƒ¼ãƒ‰æ“ä½œã‚’é¸æŠžã€‚",choises:[],cancelable:!1});d(this,"duelTextSelectorResolve",()=>{});d(this,"duelTextSelectorValue");d(this,"selectText",async(e,t)=>(this.duelTextSelectorArg=t,this.states.DuelTextSelector="Shown",e.onWaitEnd.append(this.cancelAll),this.onUpdateEvent.trigger(),new Promise(a=>{this.duelTextSelectorResolve=r=>{this.states.DuelTextSelector="Disable",e.onWaitEnd.remove(this.cancelAll),this.onUpdateEvent.trigger(),a(r)}})));this.view=e,this.states=Nr.reduce((t,a)=>(t[a]="Disable",t),{})}get onUpdate(){return this.onUpdateEvent.expose()}}const Bo=i=>new Promise(e=>setTimeout(e,i)),Oo=()=>{let i=()=>{},e=()=>{};return{promise:new Promise((a,r)=>{i=a,e=r}),resolve:i,reject:e}};class No{constructor(e){d(this,"onDuelUpdateEvent",new ze);d(this,"requireUpdate",()=>{this.onDuelUpdateEvent.trigger()});d(this,"onWaitStartEvent",new ze);d(this,"onWaitEndEvent",new ze);d(this,"onDragStartEvent",new ze);d(this,"onDragEndEvent",new ze);d(this,"onAnimationStartEvent",new ze);d(this,"onShowCardEntityEvent",new ze);d(this,"duel");d(this,"modalController");d(this,"_message");d(this,"waitMode");d(this,"infoBoardState");d(this,"infoBoardCell");d(this,"removeSvelteInfo",e=>{const t={...e};return t.selectedEntities&&(t.selectedEntities=ye.recreateArray(this.duel.field,t.selectedEntities)),t});d(this,"getCell",(e,t)=>this.duel.field.cells[e][t]);d(this,"showCardInfo",(e,t)=>{this.onShowCardEntityEvent.trigger({card:e,mode:t})});d(this,"dispose",()=>{this.onDragStartEvent.clear(),this.onDragEndEvent.clear(),this.onDuelUpdateEvent.clear(),this.onWaitStartEvent.clear(),this.onWaitEndEvent.clear()});d(this,"waitFieldAction",async e=>{if(this.duel.getTurnPlayer().duelistType==="NPC"){const t=this.duel.getTurnPlayer().selectActionForNPC(e,[]);return t?{action:t}:{phaseChange:this.duel.nextPhaseList[0]}}return await this._waitDuelistAction(this.duel.getTurnPlayer(),e,"SelectFieldAction","")});d(this,"waitQuickEffect",async(e,t,a,r,n)=>{if(t.length===0)return;if(e.duelistType==="NPC")return e.selectActionForNPC(t,a);const s=[];return s.push(this.modalController.selectAction(this,{title:r,activator:e,actions:t,cancelable:n}).then(c=>c&&c)),s.push(this._waitDuelistAction(e,t,"SelectAction",this.message).then(c=>(this.infoBoardState="Log",c.action))),await Promise.any(s)});d(this,"waitSubAction",async(e,t,a,r=!1)=>{if(e.duelistType==="NPC")throw Error("Not implemented");return await this._waitDuelistAction(e,t,"SelectAction",a,void 0,void 0,void 0,r)});d(this,"waitSelectEntities",async(e,t,a,r,n,s=!1)=>{let c=[];if(a&&t.length===a)return[...t];if(e.duelistType==="NPC"){for(;!r(c);){const l=a&&a>0?a:Math.floor(Math.random()*t.length)+1;c=t.randomPickMany(l)}return c}return this.waitMode=t.every(l=>(l.fieldCell.cellType==="MonsterZone"||l.fieldCell.cellType==="ExtraMonsterZone")&&l.getIndexInCell()===0||l.fieldCell.cellType==="Hand"&&l.controller===e)?"SelectFieldEntities":"SelectEntities",[...(await this._waitDuelistAction(e,[],this.waitMode,n,t,a,r,s)).selectedEntities??[]]});d(this,"_waitDuelistAction",async(e,t,a,r,n,s,c,u=!1)=>{this.waitMode=a,this._message=r,this.onDuelUpdateEvent.trigger();const l=Oo(),o={resolve:l.resolve,activator:e,enableActions:t,qty:s,entitiesValidator:c||(()=>!1),selectableEntities:n||[]};n&&c&&this.waitMode==="SelectEntities"&&(o.duelEntitiesSelectorArg={title:r,entities:n,validator:c,qty:s??-1,cancelable:!1}),this.onWaitStartEvent.trigger(o);const f=await l.promise;if(this.waitMode="None",this.onWaitEndEvent.trigger(),f.surrender)throw new Yt(this.duel.duelists.Above);if(!u&&f.cancel)throw new Se("ã‚­ãƒ£ãƒ³ã‚»ãƒ«ä¸å¯ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸã€‚",f,t,a,n);return this.infoBoardState="Log",this.removeSvelteInfo(f)});d(this,"waitSelectSummonDest",async(e,t,a,r,n)=>{const s=a.length>1?"ã‚«ãƒ¼ãƒ‰ã‚’å¬å–šå…ˆã¸ãƒ‰ãƒ©ãƒƒã‚°ã€‚":"è¡¨ç¤ºå½¢å¼ã‚’é¸æŠžã€‚",c=r.map(f=>Ht.createDammyAction(t,f,a,f)),u=this.modalController.selectAction(t.field.duel.view,{title:s,activator:e,actions:c,cancelable:!1}),l=this.waitSubAction(t.controller,c,s,n).then(f=>f.action),o=await Promise.any([u,l]);if(!o&&!n)throw new Se("ã‚­ãƒ£ãƒ³ã‚»ãƒ«ä¸å¯ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸã€‚",o);if(o){if(!o.cell)throw new Se("å¬å–šå…ˆã®ã‚»ãƒ«ãŒæŒ‡å®šã•ã‚Œãªã‹ã£ãŸã€‚",o);if(!o.pos)throw new Se("è¡¨ç¤ºå½¢å¼ãŒæŒ‡å®šã•ã‚Œãªã‹ã£ãŸã€‚",o);return{dest:o.cell,pos:o.pos}}});d(this,"waitSelectText",async(e,t,a=!1)=>this.duel.view.modalController.selectText(this.duel.view,{title:t,choises:e,cancelable:a}));d(this,"waitAnimation",async e=>(this._message="",this.waitMode="Animation",this.onDuelUpdateEvent.trigger(),new Promise(t=>this.onAnimationStartEvent.trigger({...e,resolve:t}))));d(this,"setDraggingActions",e=>{this.onDragStartEvent.trigger(e),this.requireUpdate()});d(this,"removeDraggingActions",()=>{this.onDragEndEvent.trigger()});this.duel=e,this._message="",this.waitMode="None",this.infoBoardState="Log",this.infoBoardCell=e.duelists.Below.getExtraDeck(),this.modalController=new Fo(this)}get onDuelUpdate(){return this.onDuelUpdateEvent.expose()}get onWaitStart(){return this.onWaitStartEvent.expose()}get onWaitEnd(){return this.onWaitEndEvent.expose()}get onDragStart(){return this.onDragStartEvent.expose()}get onDragEnd(){return this.onDragEndEvent.expose()}get onAnimation(){return this.onAnimationStartEvent.expose()}get onShowCardEntity(){return this.onShowCardEntityEvent.expose()}get message(){return this._message||this.duel.log.lastRecord.text}}class qo{constructor(){d(this,"onTotalProcSeqChangeEvent",new ze);d(this,"onStageChangeEvent",new ze);d(this,"_turn",0);d(this,"_phaseSeq",0);d(this,"_stepSeq",0);d(this,"_stageSeq",0);d(this,"_chainSeq",0);d(this,"_chainBlockSeq",0);d(this,"_procSeq",0);d(this,"_procTotalSeq",0);d(this,"_periodKey");d(this,"setPhase",(e,t)=>{const a=Object.values(Ut).filter(r=>r.phase===t).find(r=>(r.step??"start")==="start");if(!a)throw new Se("æƒ³å®šã•ã‚Œãªã„çŠ¶æ…‹",this.period,t,Ut);t==="draw"?(e.log.info("ã‚¿ãƒ¼ãƒ³çµ‚äº†ã€‚",e.getTurnPlayer()),this._turn++,this._phaseSeq=0):(e.log.info(`ãƒ•ã‚§ã‚¤ã‚ºç§»è¡Œï¼ˆ${this.period.name}â†’${a.name}ï¼‰`,e.getTurnPlayer()),this._phaseSeq++),this._stepSeq=0,this._stageSeq=0,this.periodKey=a.key});d(this,"setStep",(e,t)=>{const a=this.period.phase,r=Object.values(Ut).filter(n=>n.phase===a).find(n=>(n.step??"")===t);if(!r)throw new Se("æƒ³å®šã•ã‚Œãªã„çŠ¶æ…‹",this.period,t,Ut);this.period.name!==r.name&&(e.log.info(`ã‚¹ãƒ†ãƒƒãƒ—ç§»è¡Œï¼ˆ${this.period.name}â†’${r.name}ï¼‰`,e.getTurnPlayer()),this._stepSeq++,this._stageSeq=0,this.periodKey=r.key)});d(this,"setStage",(e,t)=>{const a=this.period,r=Object.values(Ut).filter(n=>n.phase===a.phase).filter(n=>n.step===a.step).find(n=>(n.stage??"")===t);if(!r)throw new Se("æƒ³å®šã•ã‚Œãªã„çŠ¶æ…‹",this.period,t,Ut);e.log.info(`ã‚¿ã‚¤ãƒŸãƒ³ã‚°ç§»è¡Œï¼ˆ${this.period.name}â†’${r.name}ï¼‰`,e.getTurnPlayer()),this._stageSeq++,this.periodKey=r.key});d(this,"incrementChainSeq",()=>{this._chainSeq++,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq()});d(this,"incrementChainBlockSeq",()=>{this._chainBlockSeq++,this._procSeq=0,this.incrementTotalProcSeq()});d(this,"incrementProcSeq",()=>{this._procSeq++,this.incrementTotalProcSeq()});d(this,"incrementTotalProcSeq",()=>{this._procTotalSeq++,this.onTotalProcSeqChangeEvent.trigger(this.totalProcSeq)});d(this,"toString",()=>`${this.totalProcSeq}(t${this.turn}-phs${this.phaseSeq}-stp${this.stepSeq}-stg${this.stepSeq}-c${this.chainSeq}-cb${this.chainBlockSeq}-prc${this.procSeq})`);d(this,"getClone",()=>({turn:this.turn,phaseSeq:this.phaseSeq,stepSeq:this.stepSeq,stageSeq:this.stageSeq,chainSeq:this.chainSeq,chainBlockSeq:this.chainBlockSeq,procSeq:this.procSeq,totalProcSeq:this.totalProcSeq}));d(this,"isSameTurn",e=>this.turn===e.turn);d(this,"isSameChain",e=>this.turn===e.turn&&this.phaseSeq===e.phaseSeq&&this.stepSeq===e.stepSeq&&this.stageSeq===e.stageSeq&&this.chainSeq===e.chainSeq);d(this,"isPreviousChain",e=>this.turn===e.turn&&this.phaseSeq===e.phaseSeq&&this.stepSeq===e.stepSeq&&this.stageSeq===e.stageSeq&&this.chainSeq===e.chainSeq+1);d(this,"isPreviousProc",e=>this.totalProcSeq===e.totalProcSeq+1);d(this,"isUponAttackDeclaration",()=>this.period.step==="battle"&&this.chainSeq===1);this._periodKey="end"}get onTotalProcSeqChange(){return this.onTotalProcSeqChangeEvent.expose()}get onStageChange(){return this.onStageChangeEvent.expose()}set periodKey(e){this._periodKey!==e&&(this._periodKey=e,this._chainSeq=0,this._chainBlockSeq=0,this._procSeq=0,this.onStageChangeEvent.trigger(this.period),this.incrementTotalProcSeq())}get periodKey(){return this._periodKey}get period(){return Ut[this.periodKey]}get turn(){return this._turn}get phaseSeq(){return this._phaseSeq}get stepSeq(){return this._stepSeq}get stageSeq(){return this._stageSeq}get chainSeq(){return this._chainSeq}get chainBlockSeq(){return this._chainBlockSeq}get procSeq(){return this._procSeq}get totalProcSeq(){return this._procTotalSeq}get isFirstChain(){return this.chainSeq===0}}class Lo{constructor(e){d(this,"nextSeq");d(this,"records",[]);d(this,"duel");d(this,"push",e=>{this.records.push({seq:this.nextSeq++,clock:this.duel.clock.getClone(),chainBlockInfo:e})});this.nextSeq=0,this.duel=e}}const Ro=["PlayFirst","DrawFirst","Random"],qr={PlayFirst:"å…ˆæ”»",DrawFirst:"å¾Œæ”»",Random:"ãƒ©ãƒ³ãƒ€ãƒ "};class Yt extends Error{constructor(t){const a=t?`ãƒ‡ãƒ¥ã‚¨ãƒ«ãŒçµ‚äº†ã—ãŸã€‚å‹è€…ï¼š${t.profile.name}`:"ãƒ‡ãƒ¥ã‚¨ãƒ«ãŒçµ‚äº†ã—ãŸã€‚ãƒ‰ãƒ­ãƒ¼ã€‚";super(a);d(this,"winner");this.winner=t}}class Se extends Error{constructor(t,...a){super(t);d(this,"message");d(this,"items");this.message=t,this.items=a}}class Lt extends Se{constructor(...e){super("ã‚­ãƒ£ãƒ³ã‚»ãƒ«ä¸å¯ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸã€‚",...e)}}class Ho{constructor(e,t,a,r=[],n,s,c,u=[],l="Random"){d(this,"view");d(this,"log");d(this,"chainBlockLog");d(this,"clock");d(this,"nextPhaseList");d(this,"field");d(this,"attackingMonster");d(this,"targetForAttack");d(this,"_chainBlockInfos");d(this,"duelists");d(this,"priorityHolder");d(this,"isEnded");d(this,"coin",!1);d(this,"startMode");d(this,"distributeOperators",e=>{console.info(`[totalProcSeq]:${e}`);let t=0;for(;;){if(t++,t>10)throw new Se("ç„¡é™ãƒ«ãƒ¼ãƒ—ç™ºç”Ÿ");if(this.field.procFilterPool.distributeAll(this)&&this.field.statusOperatorPool.distributeAll(this)&&this.field.cardRelationPool.distributeAll(this)&&this.field.numericStateOperatorPool.distributeAll(this))return}});d(this,"getTurnPlayer",()=>this.clock.turn%2===0?this.secondPlayer:this.firstPlayer);d(this,"getNonTurnPlayer",()=>this.clock.turn%2===0?this.firstPlayer:this.secondPlayer);d(this,"main",async()=>{console.info("main start!"),this.coin=this.startMode==="PlayFirst"?!0:this.startMode==="DrawFirst"?!1:Math.random()>.5,this.priorityHolder=this.firstPlayer,this.log.info("ã€ãƒ‡ãƒ¥ã‚¨ãƒ«é–‹å§‹ã€‘"),this.log.info(`å…ˆæ”»ï¼š${this.firstPlayer.profile.name}`),Object.values(this.duelists).forEach(e=>e.pushDeck()),Object.values(this.duelists).forEach(e=>e.getDeckCell().shuffle()),Object.values(this.duelists).forEach(e=>{e.initHand.length&&e.initHand.forEach(t=>{const a=e.getDeckCell().cardEntities.find(r=>r.origin.name===t);if(!a){this.log.info(`åˆæ‰‹æ“ä½œã«ã‚ˆã‚Š${t}ã‚’æ‰‹æœ­ã«åŠ ãˆã‚ˆã†ã¨ã—ãŸãŒã€ãƒ‡ãƒƒã‚­ã«å­˜åœ¨ã—ãªã„ã€‚`);return}a.addToHand(["System"],void 0,void 0),this.log.info(`åˆæ‰‹æ“ä½œã«ã‚ˆã‚Š${a.toString()}ã‚’æ‰‹æœ­ã«åŠ ãˆãŸ`,e)})}),await Promise.all(Object.values(this.duelists).map(e=>e.draw(5-e.getHandCell().cardEntities.length,void 0,void 0))),this.moveNextPhase("draw"),this.view.requireUpdate();try{for(;!this.isEnded&&(this.clock.period.phase==="draw"?await this.procDrawPhase():this.phase==="standby"?await this.procStanbyPhase():this.phase==="main1"?await this.procMainPhase():this.phase==="battle1"?await this.procBattlePhase():this.phase==="battle2"?await this.procBattlePhase():this.phase==="main2"?await this.procMainPhase():this.phase==="end"&&await this.procEndPhase(),!(this.clock.turn>1e3)););}catch(e){e instanceof Yt?(console.info(e),this.isEnded=!0,this.log.info(e.winner?`ãƒ‡ãƒ¥ã‚¨ãƒ«çµ‚äº†ã€‚å‹è€…${e.winner.profile.name}`:"å¼•ãåˆ†ã‘")):e instanceof Error&&this.log.error(e)}finally{this.view.requireUpdate(),this.view.dispose(),this.log.dispose()}});d(this,"moveNextPhase",e=>{this.clock.setPhase(this,e),this.phase==="main2"||this.clock.turn===1?this.nextPhaseList=["end"]:this.phase==="battle1"||this.phase==="battle2"?this.nextPhaseList=["main2"]:this.phase==="main1"?this.nextPhaseList=["battle1","end"]:this.nextPhaseList=[]});d(this,"declareAnAttack",(e,t)=>{this.attackingMonster=e,this.targetForAttack=t,e.info.attackCount++,this.log.info(`æ”»æ’ƒå®£è¨€ï¼š${e.status.name} â‡’ ${t.status.name}`,e.controller)});d(this,"procDrawPhase",async()=>{Object.values(this.duelists).forEach(e=>e.initForDrawPhase()),this.log.info("ãƒ‰ãƒ­ãƒ¼ãƒ•ã‚§ã‚¤ã‚ºé–‹å§‹ã€‚",this.getTurnPlayer()),this.clock.turn===1?this.log.info("å…ˆæ”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ãƒ‰ãƒ­ãƒ¼ã§ããªã„ã€‚",this.getTurnPlayer()):await this.getTurnPlayer().draw(1,void 0,void 0),this.field.getEntiteisOnField().forEach(e=>e.initForTurn()),await this.procSpellSpeed1(),this.moveNextPhase("standby")});d(this,"procStanbyPhase",async()=>{await this.procSpellSpeed1(),this.moveNextPhase("main1")});d(this,"procMainPhase",async()=>{for(;;){this.priorityHolder=this.getTurnPlayer();const e=await this.view.waitFieldAction(this.getEnableActions(this.priorityHolder,["NormalSummon","SpellTrapSet","SpecialSummon","ChangeBattlePosition","IgnitionEffect","MandatoryIgnitionEffect","QuickEffect","CardActivation"],["Normal","Quick","Counter"],[]));if(e&&e.action){if([...Rl].includes(e.action.playType)){const a=await e.action.prepare(this.priorityHolder,e.action.cell,[],!0);if(a===void 0)continue;await e.action.execute(a,this.chainBlockInfos),this.clock.incrementChainSeq()}else await this.procChainBlock({activator:this.priorityHolder,action:e.action},void 0);for(;await this.procChainBlock(void 0,void 0););continue}const t=e.phaseChange;if(t){this.priorityHolder=this.getNonTurnPlayer();const a=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(this.priorityHolder,["QuickEffect","TriggerEffect"],["Quick","Counter"],[]),[],"",!0);if(a){for(await this.procChainBlock({activator:this.priorityHolder,action:a},void 0);await this.procChainBlock(void 0,void 0););continue}this.moveNextPhase(t);return}}});d(this,"procBattlePhase",async()=>{await this.procBattlePhaseStartStep(),await this.procBattlePhaseBattleStep(),await this.procBattlePhaseEndStep()});d(this,"procBattlePhaseStartStep",async()=>{this.clock.setStep(this,"start"),this.priorityHolder=this.getTurnPlayer(),this.attackingMonster=void 0,this.targetForAttack=void 0,await this.procSpellSpeed1()});d(this,"procBattlePhaseBattleStep",async()=>{for(;;){this.clock.setStep(this,"battle"),this.priorityHolder=this.getTurnPlayer();const e=await this.view.waitFieldAction(this.getEnableActions(this.priorityHolder,["Battle"],["Normal"],[]));if(e.phaseChange)break;if(e.action){const t=await e.action.prepare(this.priorityHolder,e.action.cell,[],!0);if(!t)continue;await e.action.execute(t,[]),this.clock.incrementChainSeq();let a=!0;for(;;){const r=this.getNonTurnPlayer().getMonstersOnField().map(s=>[s.seq,s.moveLog.latestRecord.movedAt.totalProcSeq]);for(;await this.procChainBlock(void 0,void 0););if(!this.attackingMonster)throw new Se("æƒ³å®šã•ã‚Œãªã„çŠ¶æ…‹");this.attackingMonster.isOnField?this.attackingMonster.face==="FaceDown"?(this.log.info(`${this.attackingMonster.toString()}ãŒè£å´å®ˆå‚™è¡¨ç¤ºã«ãªã£ãŸãŸã‚ã€æˆ¦é—˜ãŒä¸­æ–­ã•ã‚ŒãŸã€‚`),a=!1):this.attackingMonster.orientation==="Horizontal"&&(this.log.info(`${this.attackingMonster.toString()}ãŒå®ˆå‚™è¡¨ç¤ºã«ãªã£ãŸãŸã‚ã€æˆ¦é—˜ãŒä¸­æ–­ã•ã‚ŒãŸã€‚`),a=!1):(this.log.info(`${this.attackingMonster.toString()}ãŒãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã„ãªããªã£ãŸãŸã‚ã€æˆ¦é—˜ãŒä¸­æ–­ã•ã‚ŒãŸã€‚`),a=!1);const n=this.getNonTurnPlayer().getMonstersOnField().map(s=>[s.seq,s.moveLog.latestRecord.movedAt.totalProcSeq]);if(r.length!==n.length)throw this.log.info("ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã®æ•°ãŒå¢—æ¸›ã—ãŸãŸã‚ãƒãƒˆãƒ«ã‚¹ãƒ†ãƒƒãƒ—ã®å·»ãæˆ»ã—ãŒç™ºç”Ÿã€‚"),new Se("å·»ãæˆ»ã—æœªå®Ÿè£…");if(r.some(([s,c])=>n.every(([u,l])=>u!==s||l!==c)))throw this.log.info("ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã®æ•°ãŒå¢—æ¸›ã—ãŸãŸã‚ãƒãƒˆãƒ«ã‚¹ãƒ†ãƒƒãƒ—ã®å·»ãæˆ»ã—ãŒç™ºç”Ÿã€‚"),new Se("å·»ãæˆ»ã—æœªå®Ÿè£…");break}if(!a)continue;await this.procBattlePhaseDamageStep(t)}}});d(this,"procBattlePhaseDamageStep",async e=>{if(!this.attackingMonster||!this.targetForAttack)throw new Se("æƒ³å®šã•ã‚Œãªã„çŠ¶æ…‹",this.attackingMonster,this.targetForAttack);await this.procBattlePhaseDamageStep1(),await this.procBattlePhaseDamageStep2(this.attackingMonster,this.targetForAttack),await this.procBattlePhaseDamageStep3(e,this.attackingMonster,this.targetForAttack),await this.procBattlePhaseDamageStep4(),await this.procBattlePhaseDamageStep5()});d(this,"procBattlePhaseDamageStep1",async()=>{for(this.clock.setStage(this,"start");await this.procChainBlock(void 0,void 0););});d(this,"procBattlePhaseDamageStep2",async(e,t)=>{for(this.clock.setStage(this,"beforeDmgCalc"),(t==null?void 0:t.battlePosition)==="Set"&&t.setBattlePosition("Defense",["Flip","FlipByBattle"],e,e.controller);await this.procChainBlock(void 0,void 0););});d(this,"procBattlePhaseDamageStep3",async(e,t,a)=>{if(t.atk===void 0)throw new Se("æƒ³å®šã•ã‚Œãªã„çŠ¶æ…‹",this.attackingMonster,this.targetForAttack);for(this.clock.setStage(this,"dmgCalc");await this.procChainBlock(void 0,void 0););const r=t.atk,n=(a.battlePosition==="Attack"?a.atk:a.def)??0;a.entityType==="Duelist"?t.controller.getOpponentPlayer().battleDamage(r-n,t):(r>0&&r>n&&a.battlePosition==="Attack"?t.controller.getOpponentPlayer().battleDamage(r-n,t):r<n&&t.controller.battleDamage(n-r,a),r>0&&(r>n||r===n&&a.battlePosition==="Attack")&&a.tryMarkForDestory("BattleDestroy",t.controller,t,e.action),a.battlePosition==="Attack"&&r<=n&&t.tryMarkForDestory("BattleDestroy",t.controller,a,e.action));const s=Object.values(this.duelists).filter(c=>c.lp<=0);if(s.length>0)throw new Yt(Object.values(this.duelists).filter(c=>!s.includes(c)).pop())});d(this,"procBattlePhaseDamageStep4",async()=>{for(this.clock.setStage(this,"afterDmgCalc");await this.procChainBlock(void 0,void 0););});d(this,"procBattlePhaseDamageStep5",async()=>{for(this.clock.setStage(this,"end"),await ye.waitCorpseDisposal(this),this.clock.incrementChainSeq();await this.procChainBlock(void 0,void 0););});d(this,"procBattlePhaseEndStep",async()=>{this.clock.setStep(this,"end"),this.priorityHolder=this.getTurnPlayer(),await this.procSpellSpeed1(),this.moveNextPhase("main2")});d(this,"procEndPhase",async()=>{for(await this.procSpellSpeed1();;){const t=this.getTurnPlayer().getHandCell().cardEntities.length;if(t<7)break;await this.getTurnPlayer().discard(t-6,["Rule"])}this.moveNextPhase("draw")});d(this,"procSpellSpeed1",async()=>{this.priorityHolder=this.getTurnPlayer();let e=0;const t={Above:Number.MAX_VALUE,Below:Number.MAX_VALUE};for(;Object.values(t).some(a=>a!==0);){const a=this.getEnableActions(this.priorityHolder,["IgnitionEffect","MandatoryIgnitionEffect","QuickEffect","CardActivation","LingeringEffect","MandatoryLingeringEffect"],["Normal","Quick","Counter"],[]);t[this.priorityHolder.seat]=a.filter(s=>s.isMandatory).length;let r=a.find(s=>s.isMandatory),n=!r;if(this.priorityHolder.isTurnPlayer?e===0&&(n=!0):t[this.priorityHolder.getOpponentPlayer().seat]>=0&&(n=!0),a.length&&(a.length>1||!r)&&(r=await this.view.waitQuickEffect(this.priorityHolder,a,[],n?"":"ã¾ã ç™ºå‹•ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„åŠ¹æžœãŒæ®‹ã£ã¦ã„ã‚‹ã€‚",n)),r){if(Mn.some(s=>s===r.playType))await this.procChainBlock({activator:this.priorityHolder,action:r},void 0);else{const s=await r.prepare(this.priorityHolder,void 0,[],!0);if(!s)continue;await r.execute(s,[]),await r.settle(s,[]),this.clock.incrementChainSeq()}await this.procFreeChain(),this.priorityHolder=this.getTurnPlayer(),e=0;continue}this.priorityHolder=this.priorityHolder.getOpponentPlayer(),e++}});d(this,"procFreeChain",async()=>{for(;await this.procChainBlock(void 0,void 0););});d(this,"procChainBlock",async(e,t)=>{const a=this.clock.chainBlockSeq===0;let r=e?[]:t??Object.values(this.duelists).flatMap(c=>this.getEnableActions(c,["MandatoryTriggerEffect","TriggerEffect"],["Normal"],[]).map(u=>({activator:c,action:u}))),n=!1,s;if(e)s=e,this.priorityHolder=s.activator,n=!0;else if(r.length>0){const c=await this.selectTriggerEffect(r);c&&(r=r.filter(u=>u!==c),s=c,this.priorityHolder=s.activator,n=!0)}if(!n){let c=0;for(;c<2;){this.priorityHolder=this.priorityHolder.getOpponentPlayer();const u=["Counter"];this.chainBlockInfos.every(f=>f.action.spellSpeed!=="Counter")&&u.push("Quick");const l=this.chainBlockInfos.length?"":"ã‚¯ã‚¤ãƒƒã‚¯ã‚¨ãƒ•ã‚§ã‚¯ãƒˆç™ºå‹•ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€‚åŠ¹æžœã‚’ç™ºå‹•ã—ã¾ã™ã‹ï¼Ÿ",o=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(this.priorityHolder,["QuickEffect","CardActivation"],u,this.chainBlockInfos),this.chainBlockInfos,l,!0);if(o){s={activator:this.priorityHolder,action:o},n=!0;break}c++}}if(console.info("selected action: ",s),s){const c=s.activator,u=this.clock.chainBlockSeq+1;this.log.info(`ãƒã‚§ãƒ¼ãƒ³${u}: ${jt(s.action)}ã‚’ç™ºå‹•`,c);const l=await s.action.prepare(c,s.action.cell,this.chainBlockInfos,!1);if(!l)throw new Lt(s);this.chainBlockLog.push(l);const o=[...l.action.entity.info.isEffectiveIn];if(l.selectedEntities.length&&this.log.info(`å¯¾è±¡â‡’${l.selectedEntities.map(f=>f.toString()).join(" ")}`,l.activator),this._chainBlockInfos.push(l),this.clock.incrementProcSeq(),this.clock.incrementChainBlockSeq(),await this.procChainBlock(void 0,r.filter(f=>f.action.seq!==(s==null?void 0:s.action.seq))),this.log.info(`ãƒã‚§ãƒ¼ãƒ³${u}: ${jt(l.action)}ã®åŠ¹æžœå‡¦ç†ã€‚`,c),l.isNegatedActivationBy)this.log.info(`ãƒã‚§ãƒ¼ãƒ³${u}: ${jt(s.action)}ã‚’${jt(l.isNegatedActivationBy)}ã«ã‚ˆã£ã¦ç™ºå‹•ã‚’ç„¡åŠ¹ã«ã—ãŸã€‚`,l.activator);else{let f=l.action.entity.isEffective,p=`ãƒã‚§ãƒ¼ãƒ³${u}: ã‚«ãƒ¼ãƒ‰ã®åŠ¹æžœãŒç„¡åŠ¹ã¨ãªã£ã¦ã„ã‚‹ãŸã‚${jt(s.action)}ã®åŠ¹æžœå‡¦ç†ã‚’è¡Œãˆãªã„ã€‚`;if(f){if(l.isNegatedEffectBy)p=`ãƒã‚§ãƒ¼ãƒ³${u}: ${jt(l.action)}ã‚’${jt(l.isNegatedEffectBy)}ã«ã‚ˆã£ã¦åŠ¹æžœã‚’ç„¡åŠ¹ã«ã—ãŸã€‚`,f=!1;else if(!o.includes(l.isActivatedIn.cellType)){const h=l.action.entity.moveLog.records.findLast(y=>y.face==="FaceDown"&&y.orientation==="Horizontal");f=(h&&this.clock.isSameChain(h.movedAt))??!1}}f?(await l.action.execute(l,this.chainBlockInfos),l.state="done"):(l.state="failed",this.log.info(p,l.activator)),await s.action.settle(l,this.chainBlockInfos)}this.clock.incrementProcSeq(),a&&(await ye.sendManyToGraveyardForTheSameReason(this._chainBlockInfos.filter(f=>f.action.playType==="CardActivation").filter(f=>!f.action.isLikeContinuousSpell).map(f=>f.action.entity).filter(f=>f.isOnField).filter(f=>f.face==="FaceUp"),["Rule"],void 0,void 0),this._chainBlockInfos.reset(),this.clock.incrementChainSeq())}return n});d(this,"selectTriggerEffect",async e=>{if(e.length>0)for(const t of["MandatoryTriggerEffect","TriggerEffect"])for(const a of[this.getTurnPlayer(),this.getNonTurnPlayer()]){const r=e.filter(s=>s.action.playType===t&&s.activator===a);if(r.length===0)continue;if(r.length===1&&t==="MandatoryTriggerEffect")return r[0];const n=await this.view.waitQuickEffect(a,r.map(s=>s.action),this.chainBlockInfos,"èª˜ç™ºåŠ¹æžœã‚’é¸æŠžã€‚",t==="TriggerEffect");if(n)return{activator:a,action:n}}});d(this,"executeSystemActions",()=>{Object.values(this.duelists).flatMap(e=>this.getEnableActions(e,["SystemAction"],["Normal"],[]).map(t=>({duelist:e,action:t})))});d(this,"getEnableActions",(e,t,a,r)=>this.field.getAllCardEntities().flatMap(n=>n.actions).filter(n=>n.executableCells.includes(n.entity.fieldCell.cellType)).filter(n=>n.executablePeriods.includes(this.clock.period.key)).filter(n=>t.includes(n.playType)).filter(n=>a.includes(n.spellSpeed)).filter(n=>n.executableDuelists.includes(e)).filter(n=>n.validate(e,r)));this.clock=new qo,this.nextPhaseList=[],this.isEnded=!1,this.startMode=l,this.duelists={Below:new Or(this,"Below",e,t,a,r),Above:new Or(this,"Above",n,s,c,u)},this.priorityHolder=this.firstPlayer,this._chainBlockInfos=[],this.field=new Po(this),this.clock.onTotalProcSeqChange.append(this.distributeOperators),this.clock.onStageChange.append(this.executeSystemActions),this.view=new No(this),this.log=new Mo(this),this.chainBlockLog=new Lo(this)}get phase(){return this.clock.period.phase}get step(){return this.clock.period.step}get stage(){return this.clock.period.stage}get chainBlockInfos(){return this._chainBlockInfos}get firstPlayer(){return this.coin?this.duelists.Below:this.duelists.Above}get secondPlayer(){return this.coin?this.duelists.Above:this.duelists.Below}}ye.prototype.hasBeenSummonedNow=function(i,e=["Attack","Defense"]){const t=this,a=e.map(Nn),r=t.moveLog.latestRecord.movedAs;return!(!t.wasMovedAtPreviousChain||!r.union(i).length||!r.union(a).length)};ye.prototype.getAttackTargets=function(){if(!this.hasAttackRight())return[];const i=this.duel.field.getMonstersOnField().filter(e=>e.status.isSelectableForAttack).filter(e=>e.controller!==this.controller);return(this.status.canDirectAttack||!i.length)&&i.push(this.controller.getOpponentPlayer().entity),i.filter(e=>e.canBeTargetOfBattle(this.controller,this)).filter(e=>this.procFilterBundle.operators.filter(t=>t.procTypes.includes("BattleTarget")).every(t=>t.filter(this.controller,this,{},[e])))};ye.prototype.canDirectAttack=function(){return this.getAttackTargets().some(i=>i.entityType==="Duelist")};ye.prototype.canAttackToMonster=function(){return this.getAttackTargets().some(i=>i.entityType!=="Duelist")};ye.prototype.hasAttackRight=function(){return this.battlePosition==="Attack"&&this.info.attackCount===0&&this.status.canAttack};ye.prototype.canBeEffected=function(i,e,t){return this.procFilterBundle.operators.filter(r=>r.procTypes.some(n=>n==="Effect")).every(r=>r.filter(i,e,t,[this]))};const Ln=(i,e,t,a,r)=>i.canBeEffected(t,a,r)&&i.procFilterBundle.operators.filter(n=>n.procTypes.some(s=>s===e)).every(n=>n.filter(t,a,r,[i]));ye.prototype.canBeTargetOfEffect=function(i,e,t){return Ln(this,"EffectTarget",i,e,t)};ye.prototype.canBeBanished=function(i,e,t){return this.fieldCell.cellType==="Banished"?!1:Ln(this,"BanishAsEffect",i,e,t)};ye.prototype.canBeTargetOfBattle=function(i,e){const t=this;return t.procFilterBundle.operators.filter(a=>a.procTypes.some(r=>r==="BattleTarget")).every(a=>a.filter(i,e,{},[t]))};ye.prototype.tryMarkForDestory=function(i,e,t,a){const r=this;return r.info.isDying=r.validateDestory(i,e,t,a),r.info.isDying&&(r.duel.log.info(`${r.toString()}ã‚’${Ao[i]}`,t.controller),r.info.causeOfDeath=[i],r.info.isKilledBy=t,r.info.isKilledByWhom=t.controller),r.info.isDying};ye.prototype.validateDestory=function(i,e,t,a){const r=this;let n=r.procFilterBundle.operators.filter(s=>s.procTypes.includes(i)).every(s=>s.filter(e,t,a??{},[r]));return n&&i==="EffectDestroy"&&(n=r.canBeEffected(e,t,a)),n};ye.prototype.getIndexInCell=function(){const i=this;if(i.info.isVanished)return-1;const e=i.fieldCell.cardEntities.indexOf(i);if(e<0)throw new Se("ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨ã‚»ãƒ«ã®çŠ¶æ…‹ãŒçŸ›ç›¾ã—ã¦ã„ã‚‹ã€‚",[i,i.fieldCell]);return e};ye.prototype.getXyzMaterials=function(){const i=this;return(i.status.monsterCategories??[]).includes("Xyz")?i.fieldCell.xyzMaterials:[]};class $t{constructor(){}}d($t,"tryDestroy",async(e,t)=>{const a=e.filter(n=>!n.info.isDying);a.map(n=>n.tryMarkForDestory("EffectDestroy",t.activator,t.action.entity,t.action));const r=a.filter(n=>n.info.isDying);return await ye.waitCorpseDisposal(t.activator.duel),r}),d($t,"tryBanish",async(e,t)=>{const a=e.filter(r=>r.canBeBanished(t.activator,t.action.entity,t.action));return await ye.banishManyForTheSameReason(a,["Effect"],t.action.entity,t.activator),a.filter(r=>r.fieldCell.cellType==="Banished").filter(r=>r.moveLog.latestRecord.movedBy===t.action.entity)});const $o=()=>{const i=[];["ã‚µã‚¤ãƒãƒ¼ãƒ»ãƒ‰ãƒ©ã‚´ãƒ³","å…­æ­¦è¡†ã®ã”éš å±…","ã‚¢ãƒ³ãƒŽã‚¦ãƒ³ãƒ»ã‚·ãƒ³ã‚¯ãƒ­ãƒ³"].forEach(o=>i.push({name:o,actions:[Ye,He,$e,{title:"ç‰¹æ®Šå¬å–š",playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:o==="ã‚¢ãƒ³ãƒŽã‚¦ãƒ³ãƒ»ã‚·ãƒ³ã‚¯ãƒ­ãƒ³"?1:void 0,validate:f=>{const p=f.action.entity.field.getMonstersOnField();if(!(p.length==0||p.some(h=>h.controller===f.activator)))return $a(f,["Attack","Defense"],[])},prepare:(f,p,h,y)=>ja(f,p,["Attack","Defense"],[],y),execute:Ua,settle:async()=>!0}]}));const e={name:"ã‚¸ãƒ£ãƒ³ã‚¯ãƒ»ãƒ•ã‚©ã‚¢ãƒ¼ãƒ‰",actions:[Ye,He,$e,{title:"ç‰¹æ®Šå¬å–š",playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:o=>{if(!o.activator.getMonstersOnField().length)return $a(o,["Attack","Defense"],[])},prepare:(o,f,p,h)=>ja(o,f,["Attack","Defense"],[],h),execute:Ua,settle:async()=>!0}]};i.push(e);const t={name:"ï¼¤ï¼ï¼¨ï¼¥ï¼²ï¼¯ ãƒ‡ã‚£ã‚¢ãƒœãƒªãƒƒã‚¯ã‚¬ã‚¤",actions:[Ye,He,$e,{title:"â‘ ãƒªã‚¯ãƒ«ãƒ¼ãƒˆ",playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:10,validate:o=>o.activator.getDeckCell().cardEntities.filter(p=>p.nm==="ï¼¤ï¼ï¼¨ï¼¥ï¼²ï¼¯ ãƒ‡ã‚£ã‚¢ãƒœãƒªãƒƒã‚¯ã‚¬ã‚¤").length===0?void 0:o.activator.getAvailableMonsterZones().length>0?[]:void 0,prepare:async o=>(await o.action.entity.banish(["Cost"],o.action.entity,o.activator),{selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async o=>{const f=o.activator.getAvailableMonsterZones();if(!f.length)return!1;const p=o.activator.getDeckCell().cardEntities.find(h=>h.nm==="ï¼¤ï¼ï¼¨ï¼¥ï¼²ï¼¯ ãƒ‡ã‚£ã‚¢ãƒœãƒªãƒƒã‚¯ã‚¬ã‚¤");return p?(await o.activator.summon(p,["Attack","Defense"],f,"SpecialSummon",["Effect"],o.action.entity,!1),o.activator.getDeckCell().shuffle(),!0):!1},settle:async()=>!0}]};i.push(t);const a={name:"ã‚¾ãƒ³ãƒ“ã‚­ãƒ£ãƒªã‚¢",actions:[Ye,He,$e,{title:"â‘ è‡ªå·±å†ç”Ÿ",playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:o=>o.activator.getHandCell().cardEntities.length===0?void 0:o.activator.getAvailableMonsterZones().length>0?[]:void 0,prepare:async o=>{const f=o.activator.getHandCell().cardEntities,p=await o.activator.duel.view.waitSelectEntities(o.activator,f,1,h=>h.length===1,"ãƒ‡ãƒƒã‚­ãƒˆãƒƒãƒ—ã«æˆ»ã™ã‚«ãƒ¼ãƒ‰ã‚’ä¸€æžšé¸æŠžã€‚");if(!p)throw new Lt(o);return await p[0].returnToDeck("Top",["Cost"],o.action.entity,o.activator),{selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}},execute:async o=>{if(o.action.entity.wasMovedAtCurrentChain)return!1;const f=o.activator.getAvailableMonsterZones();return f.length===0?!1:(await o.activator.summon(o.action.entity,["Attack","Defense"],f,"SpecialSummon",["Effect"],o.action.entity,!1),o.action.entity.info.willBeBanished=!0,!0)},settle:async()=>!0}]};i.push(a);const r={name:"ã‚°ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—ãƒ»ãƒãƒ«ãƒ–",actions:[Ye,He,$e,{title:"â‘ è‡ªå·±å†ç”Ÿ",playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:1,validate:o=>o.activator.getDeckCell().cardEntities.length===0?void 0:o.activator.getAvailableMonsterZones().length>0?[]:void 0,prepare:async o=>(await o.activator.getDeckCell().cardEntities[0].sendToGraveyard(["Cost"],o.action.entity,o.activator),{selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:async o=>{if(o.action.entity.wasMovedAtCurrentChain)return!1;const f=o.activator.getAvailableMonsterZones();return f.length===0?!1:(await o.activator.summon(o.action.entity,["Attack","Defense"],f,"SpecialSummon",["Effect"],o.action.entity),!0)},settle:async()=>!0}]};i.push(r);const n={name:"çµ‚æœ«ã®é¨Žå£«",actions:[Ye,He,$e,{title:"â‘ å¢“åœ°é€ã‚Š",playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...nt,...zt],executableDuelistTypes:["Controller"],validate:o=>{if(o.action.entity.hasBeenSummonedNow(["NormalSummon","SpecialSummon","FlipSummon"])&&o.activator.getDeckCell().cardEntities.filter(f=>f.attr.includes("Dark")).length!==0)return[]},prepare:async o=>{const f=["SendToGraveyardFromDeck"];return o.action.entity.moveLog.latestRecord.movedAs.includes("NormalSummon")?f.push("IfNormarlSummonSucceed"):f.push("IfSpecialSummonSucceed"),{selectedEntities:[],chainBlockTags:f,prepared:void 0}},execute:async o=>{const f=o.activator.getDeckCell().cardEntities.filter(p=>p.attr.includes("Dark"));return f.length===0?!1:(await o.action.entity.field.sendToGraveyard("å¢“åœ°ã«é€ã‚‹ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’é¸æŠž",o.activator,f,1,p=>p.length===1,["Effect"],o.action.entity,!1),o.activator.getDeckCell().shuffle(),!0)},settle:async()=>!0}]};i.push(n);const s={name:"ãƒžã‚¹ãƒžãƒ†ã‚£ã‚·ãƒ£ãƒ³",actions:[Ye,He,$e,{title:"â‘ å¢“åœ°é€ã‚Š",playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...nt,...zt],executableDuelistTypes:["Controller"],validate:o=>{if(o.action.entity.hasBeenSummonedNow(["NormalSummon"])&&o.activator.getDeckCell().cardEntities.find(f=>(f.lvl??5)<5))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["IfNormarlSummonSucceed","SendToGraveyardFromDeck"],prepared:void 0}),execute:async o=>{const f=o.activator.getDeckCell().cardEntities.filter(p=>(p.lvl??5)<5);return f.length===0?!1:(await o.action.entity.field.sendToGraveyard("å¢“åœ°ã«é€ã‚‹ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’é¸æŠž",o.activator,f,1,p=>p.length===1,["Effect"],o.action.entity,!1),o.activator.getDeckCell().shuffle(),!0)},settle:async()=>!0},{title:"â‘¡ãƒ‰ãƒ­ãƒ¼",playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...nt,...zt],executableDuelistTypes:["Controller"],validate:o=>{if(o.action.entity.face!=="FaceDown"&&o.action.entity.moveLog.latestRecord.movedAs.includes("BattleDestroy")&&o.action.entity.wasMovedAtPreviousChain&&o.activator.getDeckCell().cardEntities.length!==0)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async o=>(await o.activator.draw(1,o.action.entity,o.activator),!0),settle:async()=>!0}]};i.push(s);const c={name:"ãƒ©ã‚¤ãƒˆãƒ­ãƒ¼ãƒ‰ãƒ»ãƒ“ãƒ¼ã‚¹ãƒˆ ã‚¦ã‚©ãƒ«ãƒ•",actions:[He,$e,{title:"â‘ è‡ªå·±å†ç”Ÿ",playType:"MandatoryTriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...nt,...zt],executableDuelistTypes:["Controller"],validate:o=>{if(o.action.entity.wasMovedAtPreviousChain&&o.action.entity.wasMovedFrom.cellType==="Deck")return o.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:async o=>{if(o.action.entity.wasMovedAtCurrentChain)return!1;const f=o.activator.getAvailableMonsterZones();return!f.length||o.action.entity.fieldCell.cellType!=="Graveyard"&&o.action.entity.fieldCell.cellType!=="Banished"||o.action.entity.face==="FaceDown"?!1:(await o.activator.summon(o.action.entity,["Attack","Defense"],f,"SpecialSummon",["Effect"],o.action.entity),!0)},settle:async()=>!0}]};i.push(c);const u={name:"ä¼èª¬ã®ç™½çŸ³",actions:[He,$e,Ye,{title:"â‘ ã‚µãƒ¼ãƒ",playType:"MandatoryTriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:ha,executableDuelistTypes:["Controller"],validate:o=>{if(o.action.entity.wasMovedAtPreviousChain&&o.action.entity.wasMovedFrom.cellType!=="Banished")return o.activator.getDeckCell().cardEntities.find(f=>f.nm==="é’çœ¼ã®ç™½é¾")?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async o=>{const f=o.activator.getDeckCell().cardEntities.find(p=>p.nm==="é’çœ¼ã®ç™½é¾");return f?(await f.addToHand(["Effect"],o.action.entity,o.activator),o.activator.getDeckCell().shuffle(),!0):!1},settle:async()=>!0}]};return i.push(u),[{name:"ç°æµã†ã‚‰ã‚‰",chainBlockTags:["Draw","SearchFromDeck","SendToGraveyardFromDeck","SpecialSummonFromDeck"]},{name:"å±‹æ•·ã‚ã‚‰ã—",chainBlockTags:["BanishFromGraveyard","SpecialSummonFromGraveyard","AddToHandFromGraveyard"]}].forEach(o=>{i.push({name:o.name,actions:[He,$e,Ye,{title:"â‘ ç„¡åŠ¹åŒ–",playType:"QuickEffect",spellSpeed:"Quick",executableCells:["Hand"],executablePeriods:nt,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,negatePreviousBlock:!0,validate:(f,p)=>p.length===0?void 0:p[f.index-1].chainBlockTags.union(o.chainBlockTags).length>0?[]:void 0,prepare:async f=>(await f.action.entity.sendToGraveyard(["Discard","Cost"],f.action.entity,f.activator),{selectedEntities:[],chainBlockTags:["NegateCardEffect"],prepared:void 0}),execute:async(f,p)=>{const h=p[f.index-1];return h.isNegatedEffectBy=f.action,!0},settle:async()=>!0}]})}),["ç¿»å¼„ã™ã‚‹ã‚¨ãƒ«ãƒ•ã®å‰£å£«","ãƒ­ãƒ¼ãƒ‰ãƒ©ãƒ³ãƒŠãƒ¼","æ°·çµç•Œã®ä¿®é¨“è€…"].forEach(o=>{i.push({name:o,actions:[He,$e,Ye],continuousEffects:[Ql("â‘ æˆ¦é—˜ç ´å£Šè€æ€§","Monster",f=>[f],()=>!0,f=>[new Ul("â‘ æˆ¦é—˜ç ´å£Šè€æ€§",()=>!0,!0,f,{},()=>!0,["BattleDestroy"],(p,h)=>!f.isEffective||(h.atk??0)<1900?!0:(f.duel.log.info(`${f.toString()}ã¯æ”»æ’ƒåŠ›1900ä»¥ä¸Šã®ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã¨ã®å…ˆé ­ã§ã¯ç ´å£Šã•ã‚Œãªã„ã€‚`,f.controller),!1))])]})}),i},jo=i=>{if(i.action.entity.status.spellCategory==="Field")return[i.activator.getFieldZone()];const e=i.activator.getAvailableSpellTrapZones();return e.length>0?e:void 0},Uo=async(i,e)=>{if(i.action.entity.status.spellCategory==="Field"){const r=i.activator.getFieldZone(),n=r.cardEntities[0];return await ye.sendManyToGraveyardForTheSameReason(r.cardEntities,["Rule"],i.action.entity,i.activator),i.activator.duel.log.info(`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰é­”æ³•ã®ä¸Šæ›¸ãã«ã‚ˆã‚Šã€${n.toString()}ã¯å¢“åœ°ã«é€ã‚‰ã‚ŒãŸã€‚`,i.activator),{selectedEntities:[],chainBlockTags:[],prepared:{dest:r}}}if(e)return{selectedEntities:[],chainBlockTags:[],prepared:{dest:e}};const t=i.activator.getAvailableSpellTrapZones();if(t.length===0)return;let a=t[0];if(t.length>1&&i.activator.duelistType!=="NPC"){const r=[Ht.createDammyAction(i.action.entity,"ã‚»ãƒƒãƒˆ",t)],n=i.activator.duel.view.modalController.selectAction(i.activator.duel.view,{title:"ã‚«ãƒ¼ãƒ‰ã‚’ã‚»ãƒƒãƒˆå…ˆã¸ãƒ‰ãƒ©ãƒƒã‚°",activator:i.activator,actions:r,cancelable:!0}),s=i.activator.duel.view.waitSubAction(i.activator,r,"ã‚«ãƒ¼ãƒ‰ã‚’ã‚»ãƒƒãƒˆå…ˆã¸ãƒ‰ãƒ©ãƒƒã‚°",!0),c=await Promise.any([n,s.then(u=>u.action)]);if(!c)return;a=c.cell||a}return{selectedEntities:[],chainBlockTags:[],prepared:{dest:a}}},Zo=async i=>(await i.action.entity.setAsSpellTrap(i.prepared.dest,i.action.entity.origin.kind,["Rule","SpellTrapSet"],i.action.entity,i.activator),i.activator.duel.log.info(`${i.action.entity.status.name}ã‚’ã‚»ãƒƒãƒˆï¼ˆSpellTrapSetï¼‰ã€‚`,i.activator),i.action.entity.info.isSettingSickness=i.action.entity.status.kind==="Trap"||i.action.entity.status.spellCategory==="QuickPlay",!0),be={title:"ã‚»ãƒƒãƒˆ",playType:"SpellTrapSet",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:jo,prepare:Uo,execute:Zo,settle:async()=>!0},ke=i=>{if(i.action.entity.info.isPending||i.action.entity.info.isDying||i.action.entity.info.isSettingSickness)return;if(At.some(t=>t===i.action.entity.fieldCell.cellType))return i.action.entity.face==="FaceDown"?[]:void 0;if(!i.activator.isTurnPlayer)return;if(i.action.entity.status.spellCategory==="Field")return[i.activator.getFieldZone()];const e=i.activator.getAvailableSpellTrapZones();return e.length>0?e:void 0},za=(i,e,t,a,r,n)=>Pe(i,e,t,a,r,n,void 0),Pe=async(i,e,t,a,r,n,s)=>{if(At.some(c=>c===i.action.entity.fieldCell.cellType)&&i.action.entity.face==="FaceDown")return await i.action.entity.setNonFieldMonsterPosition(i.action.entity.origin.kind,"FaceUp",["Rule"]),{chainBlockTags:r??[],selectedEntities:n??[],prepared:s};if(i.action.entity.status.spellCategory==="Field"){const c=i.activator.getFieldZone().cardEntities;if(c.length){const u=c[0];await ye.sendManyToGraveyardForTheSameReason(i.activator.getFieldZone().cardEntities,["Rule"],i.action.entity,i.activator),i.activator.duel.log.info(`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰é­”æ³•ã®ä¸Šæ›¸ãã«ã‚ˆã‚Šã€${u.toString()}ã¯å¢“åœ°ã«é€ã‚‰ã‚ŒãŸã€‚`,i.activator)}}if(i.action.entity.fieldCell.cellType==="Hand"){const c=["CardActivation"],u=e?[e]:i.action.entity.status.spellCategory==="Field"?[i.activator.getFieldZone()]:i.activator.getAvailableSpellTrapZones();return await i.action.entity.field.activateSpellTrapFromHand(i.activator,i.action.entity,u,c,i.action.entity,i.activator,a),{chainBlockTags:r??[],selectedEntities:n??[],prepared:s}}},Go=(i,e,t=()=>!0)=>i.action.entity.field.getMonstersOnField().filter(r=>r.face==="FaceUp").filter(r=>r.canBeTargetOfEffect(i.activator,i.action.entity,i.action)).filter(r=>t(r,i.action.entity)).length?ke(i):void 0,zo=async(i,e,t,a,r,n,s=()=>!0)=>{const c=i.action.entity.field.getMonstersOnField().filter(l=>l.face==="FaceUp").filter(l=>l.canBeTargetOfEffect(i.activator,i.action.entity,i.action)).filter(l=>s(l,i.action.entity)),u=await i.action.entity.duel.view.waitSelectEntities(i.activator,c,1,l=>l.length===1,"è£…å‚™å¯¾è±¡ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’é¸æŠž",a);if(u)return i.action.entity.info.equipedBy=u[0],i.action.entity.info.effectTargets[i.action.seq]=u,await Pe(i,e,t,a,r,u,n)},Rn=async(i,e,t=()=>!0)=>{const a=i.selectedEntities[0];return t(a,i.action.entity)?(i.action.entity.info.equipedBy=a,i.action.entity.info.validateEquipOwner=t,a.info.equipEntities.push(i.action.entity),!0):(await i.action.entity.ruleDestory(),i.activator.writeInfoLog(`${a.toString()}ãŒè£…å‚™æ¡ä»¶ã‚’æº€ãŸã•ãªããªã£ãŸãŸã‚ã€${i.action.entity.toString()}ã¯ç ´å£Šã•ã‚ŒãŸã€‚`),!1)},Va=(i=()=>!0)=>({title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:(e,t)=>Go(e,t,i),prepare:(e,t,a,r)=>zo(e,t,a,r,[],void 0,i),execute:Rn,settle:async()=>!0}),Vo=()=>{const i=[],e={name:"ãŠã‚ã‹ãªåŸ‹è‘¬",actions:[{title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:l=>{if(l.activator.getDeckCell().cardEntities.filter(o=>o.status.kind==="Monster").length!==0)return ke(l)},prepare:(l,o,f)=>Pe(l,o,f,!1,["SendToGraveyardFromDeck"],[],void 0),execute:async l=>{const o=l.activator.getDeckCell().cardEntities.filter(p=>p.status.kind==="Monster");if(o.length===0)return!1;const f=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,o,1,p=>p.length===1,"å¢“åœ°ã«é€ã‚‹ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’é¸æŠž",!1);if(!f)throw new Lt(l);return await ye.sendManyToGraveyardForTheSameReason(f,["Effect"],l.action.entity,l.activator),await l.activator.getDeckCell().shuffle(),!0},settle:async()=>!0},be]};i.push(e);const t={name:"ãŠã‚ã‹ãªå‰¯è‘¬",actions:[{title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,priorityForNPC:40,validate:l=>{if(l.activator.getDeckCell().cardEntities.filter(o=>o.status.kind!=="Monster").length!==0)return ke(l)},prepare:(l,o,f)=>Pe(l,o,f,!1,["SendToGraveyardFromDeck"],[],void 0),execute:async l=>{const o=l.activator.getDeckCell().cardEntities.filter(p=>p.status.kind!=="Monster");if(o.length===0)return!1;const f=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,o,1,p=>p.length===1,"å¢“åœ°ã«é€ã‚‹é­”æ³•ç½ ã‚’é¸æŠž",!1);if(!f)throw new Lt(l);return await ye.sendManyToGraveyardForTheSameReason(f,["Effect"],l.action.entity,l.activator),await l.activator.getDeckCell().shuffle(),!0},settle:async()=>!0},be]};i.push(t);const a={name:"æ­»è€…è˜‡ç”Ÿ",actions:[{title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:l=>{if(l.activator.getAvailableMonsterZones().length!==0&&l.action.entity.field.getCells("Graveyard").flatMap(o=>o.cardEntities).filter(o=>o.status.kind==="Monster").filter(o=>o.info.isRebornable).filter(o=>o.canBeTargetOfEffect(l.activator,l.action.entity,l.action)).filter(o=>Tt.some(f=>o.canBeSummoned(l.activator,l.action,"SpecialSummon",f,[],!1))).some(o=>Tt.some(f=>l.activator.canSummon(l.activator,o,l.action,"SpecialSummon",f,[]))))return ke(l)},prepare:async(l,o,f)=>{const p=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,l.action.entity.field.getCells("Graveyard").flatMap(h=>h.cardEntities).filter(h=>h.status.kind==="Monster").filter(h=>h.info.isRebornable).filter(h=>h.canBeTargetOfEffect(l.activator,l.action.entity,l.action)).filter(h=>Tt.some(y=>h.canBeSummoned(l.activator,l.action,"SpecialSummon",y,[],!1))).filter(h=>Tt.some(y=>l.activator.canSummon(l.activator,h,l.action,"SpecialSummon",y,[]))),1,h=>h.length===1,"è˜‡ç”Ÿå¯¾è±¡ã¨ã™ã‚‹ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’é¸æŠž",!1);if(!p)throw new Lt(l);return await Pe(l,o,f,!1,["SpecialSummonFromGraveyard"],p,void 0)},execute:async l=>{const o=l.activator.getEmptyMonsterZones(),f=l.selectedEntities[0];return await l.activator.summon(f,["Attack","Defense"],o,"SpecialSummon",["Effect"],l.action.entity,!1),!0},settle:async()=>!0},be]};i.push(a),[{name:"å¤§åµ",cellTypes:At,isOnlyEnemies:!1},{name:"ãƒãƒ¼ãƒ”ã‚£ã®ç¾½æ ¹å¸š",cellTypes:At,isOnlyEnemies:!0},{name:"ãƒ–ãƒ©ãƒƒã‚¯ãƒ»ãƒ›ãƒ¼ãƒ«",cellTypes:ci,isOnlyEnemies:!1},{name:"ã‚µãƒ³ãƒ€ãƒ¼ãƒ»ãƒœãƒ«ãƒˆ",cellTypes:ci,isOnlyEnemies:!0}].forEach(l=>{i.push({name:l.name,actions:[{title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:o=>{let f=o.action.entity.field.getCells(...l.cellTypes).flatMap(p=>p.cardEntities).filter(p=>p!==o.action.entity);if(l.isOnlyEnemies&&(f=f.filter(p=>p.controller!==o.activator)),!!f.length)return ke(o)},prepare:async(o,f,p)=>{let h=o.action.entity.field.getCells(...l.cellTypes).flatMap(y=>y.cardEntities).filter(y=>y!==o.action.entity);return l.isOnlyEnemies&&(h=h.filter(y=>y.controller!==o.activator)),await Pe(o,f,p,!1,o.action.calcChainBlockTagsForDestroy(h),[],void 0)},execute:async o=>{let f=o.action.entity.field.getCells(...l.cellTypes).flatMap(p=>p.cardEntities).filter(p=>p!==o.action.entity);return l.isOnlyEnemies&&(f=f.filter(p=>p.controller!==o.activator)),await $t.tryDestroy(f,o),!0},settle:async()=>!0},be]})});const r={name:"ãƒãƒªã‚±ãƒ¼ãƒ³",actions:[{title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:l=>{if(l.action.entity.field.getCells("SpellAndTrapZone","FieldSpellZone").flatMap(f=>f.cardEntities).filter(f=>f!==l.action.entity).length)return ke(l)},prepare:async(l,o,f)=>await Pe(l,o,f,!1,["BounceToHand"],[],void 0),execute:async(l,o)=>{const f=o.map(h=>h.action).filter(h=>h.playType==="CardActivation").map(h=>h.entity).filter(h=>h.isOnField).filter(h=>h.face==="FaceUp").filter(h=>!h.isLikeContinuousSpell),p=l.action.entity.field.getCells("SpellAndTrapZone","FieldSpellZone").flatMap(h=>h.cardEntities).filter(h=>!f.includes(h));return await ye.returnManyToHandForTheSameReason(p,["Effect"],l.action.entity,l.activator),!0},settle:async()=>!0},be]};i.push(r);const n={name:"å…‰ã®æ´è»",actions:[{title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:l=>{if(!(l.activator.getDeckCell().cardEntities.length<4)&&l.activator.getDeckCell().cardEntities.filter(o=>o.status.kind==="Monster").filter(o=>(o.lvl??13)<5).filter(o=>o.status.nameTags&&o.status.nameTags.includes("ãƒ©ã‚¤ãƒˆãƒ­ãƒ¼ãƒ‰")).length!==0)return ke(l)},prepare:async(l,o,f)=>{const p=l.activator.getDeckCell();return await ye.sendManyToGraveyardForTheSameReason(p.cardEntities.slice(0,3),["Cost"],l.action.entity,l.activator),await Pe(l,o,f,!1,["SearchFromDeck","SendToGraveyardFromDeck"],[],void 0)},execute:async l=>{const o=l.activator.getDeckCell().cardEntities.filter(p=>p.status.kind==="Monster").filter(p=>(p.lvl??13)<5).filter(p=>p.status.nameTags&&p.status.nameTags.includes("ãƒ©ã‚¤ãƒˆãƒ­ãƒ¼ãƒ‰"));if(o.length===0)return!1;const f=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,o,1,p=>p.length===1,"æ‰‹æœ­ã«åŠ ãˆã‚‹ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’é¸æŠž",!1);for(const p of f??[])await p.addToHand(["Effect"],l.action.entity,l.activator);return l.activator.getDeckCell().shuffle(),!0},settle:async()=>!0},be]};i.push(n);const s={name:"èª¿å¾‹",actions:[{title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:l=>{const o=l.activator.getDeckCell().cardEntities;if(!(o.length<2)&&o.filter(f=>{var p;return(p=f.status.nameTags)==null?void 0:p.includes("ã‚·ãƒ³ã‚¯ãƒ­ãƒ³")}).filter(f=>{var p;return(p=f.status.monsterCategories)==null?void 0:p.includes("Tuner")}).length!==0)return ke(l)},prepare:(l,o,f)=>Pe(l,o,f,!1,["SearchFromDeck","SendToGraveyardFromDeck"],[],void 0),execute:async l=>{const o=l.activator.getDeckCell().cardEntities;if(o.length<2)return;const f=o.filter(h=>{var y;return(y=h.status.nameTags)==null?void 0:y.includes("ã‚·ãƒ³ã‚¯ãƒ­ãƒ³")}).filter(h=>{var y;return(y=h.status.monsterCategories)==null?void 0:y.includes("Tuner")});if(f.length===0)return!1;const p=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,f,1,h=>h.length===1,"æ‰‹æœ­ã«åŠ ãˆã‚‹ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’é¸æŠž",!1);for(const h of p??[])await h.addToHand(["Effect"],l.action.entity,l.activator);return l.activator.duel.clock.incrementProcSeq(),l.activator.getDeckCell().shuffle(),await l.activator.getDeckCell().cardEntities[0].sendToGraveyard(["Effect"],l.action.entity,l.activator),!0},settle:async()=>!0},be]};i.push(s);const c={name:"ãƒ¯ãƒ³ãƒ»ãƒ•ã‚©ãƒ¼ãƒ»ãƒ¯ãƒ³",actions:[{title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:l=>{if(l.activator.getDeckCell().cardEntities.filter(o=>o.lvl===1).length===0){if(l.activator.getHandCell().cardEntities.filter(o=>o.lvl===1).length===0||l.activator.getHandCell().cardEntities.filter(o=>o.status.kind==="Monster").length<2)return}else if(l.activator.getHandCell().cardEntities.filter(o=>o.status.kind==="Monster").length===0)return;return ke(l)},prepare:async(l,o,f)=>{let p=l.activator.getHandCell().cardEntities.filter(y=>y.status.kind==="Monster");if(l.activator.getDeckCell().cardEntities.filter(y=>y.lvl===1).length===0){const y=l.activator.getHandCell().cardEntities.filter(w=>w.lvl===1);y.length===1&&(p=p.filter(w=>w!==y[0]))}if(await l.action.entity.field.sendToGraveyard("å¢“åœ°é€ã‚‹ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’é¸æŠž",l.activator,p,1,y=>y.length===1,["Cost"],l.action.entity,!0))return await Pe(l,o,f,!1,["SpecialSummonFromDeck"],[],void 0)},execute:async l=>{const o=[...l.activator.getDeckCell().cardEntities.filter(p=>p.lvl===1),...l.activator.getHandCell().cardEntities.filter(p=>p.lvl===1)];if(o.length===0)return!1;const f=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,o,1,p=>p.length===1,"ç‰¹æ®Šå¬å–šã™ã‚‹ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’é¸æŠž",!1);if(!f)throw new Error("illegal state");return await l.activator.summon(f[0],["Attack","Defense"],l.activator.getAvailableMonsterZones(),"SpecialSummon",["Effect"],l.action.entity,!1),l.activator.getDeckCell().shuffle(),!0},settle:async()=>!0},be]};i.push(c);const u={name:"å°å°ã®é»„é‡‘æ«ƒ",actions:[{title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:l=>{if(!l.activator.getDeckCell().cardEntities.every(o=>!l.activator.canTryBanish(o,"BanishAsEffect",l.action)))return ke(l)},prepare:async(l,o,f)=>Pe(l,o,f,!1,["BanishFromDeck","Banish"],[],void 0),execute:async l=>{const o=l.activator.getDeckCell().cardEntities.filter(h=>l.activator.canTryBanish(h,"BanishAsEffect",l.action)),f=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,o,1,h=>h.length===1,"é™¤å¤–ã™ã‚‹ã‚«ãƒ¼ãƒ‰ã‚’é¸æŠžã€‚",!1);if(!f)throw new Error("illegal state");return(await $t.tryBanish(f,l)).forEach(h=>h.counterHolder.setQty("GoldSarcophagus",0)),!0},settle:async()=>!0},co("å›žåŽã‚«ã‚¦ãƒ³ãƒˆé€²è¡Œ",["stanby"],l=>{l.activator.isTurnPlayer&&l.action.entity.field.getCells("Banished").flatMap(o=>o.cardEntities).filter(o=>o.moveLog.latestRecord.movedBy===l.action.entity).filter(o=>o.moveLog.latestRecord.actionOwner===l.activator).forEach(o=>{o.counterHolder.add("GoldSarcophagus");const f=o.counterHolder.getQty("GoldSarcophagus");f<3&&l.activator.duel.log.info(`${o.toString()}ã®ã‚¿ãƒ¼ãƒ³ã‚«ã‚¦ãƒ³ãƒˆï¼š${f-1}â‡’${f}`)})}),{title:"å›žåŽ",playType:"MandatoryLingeringEffect",spellSpeed:"Normal",executableCells:bi,executablePeriods:["stanby"],executableDuelistTypes:["Controller","Opponent"],validate:l=>{if(l.activator.isTurnPlayer)return l.action.entity.field.getCells("Banished").flatMap(o=>o.cardEntities).filter(o=>o.moveLog.latestRecord.movedBy===l.action.entity).filter(o=>o.moveLog.latestRecord.actionOwner===l.activator).some(o=>o.counterHolder.getQty("GoldSarcophagus")===2)?[]:void 0},prepare:ki,execute:async l=>{const o=l.action.entity.field.getCells("Banished").flatMap(p=>p.cardEntities).filter(p=>p.moveLog.latestRecord.movedBy===l.action.entity).filter(p=>p.moveLog.latestRecord.actionOwner===l.activator).filter(p=>p.counterHolder.getQty("GoldSarcophagus")===2);if(!o.length)throw new Se("æƒ³å®šã•ã‚Œãªã„çŠ¶æ…‹",l);let f=o[0];if(o.length>1){const p=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,o,1,h=>h.length===1,"å›žåŽã™ã‚‹ã‚«ãƒ¼ãƒ‰ã‚’é¸æŠžã€‚",!1);if(!p||!p.length)throw new Se("æƒ³å®šã•ã‚Œãªã„çŠ¶æ…‹",l,p);f=p[0]}return await f.addToHand(["Effect"],l.action.entity,l.activator),!0},settle:async()=>!0},be]};return i.push(u),i},Yo=(i,e,t,a,r)=>({title:"â‘ ãƒªã‚¯ãƒ«ãƒ¼ãƒˆ",playType:"TriggerEffect",spellSpeed:"Normal",executableCells:r,executablePeriods:a.includes("EffectDestroy")?[...nt,...zt]:["b1DEnd","b2DEnd"],executableDuelistTypes:["Controller"],validate:n=>{if(!n.action.entity.wasMovedAtPreviousChain||!n.action.entity.moveLog.latestRecord.movedAs.includes("BattleDestroy"))return;const s=n.activator.getDeckCell().cardEntities.filter(i);if(s.length!==0&&!s.some(c=>t.some(u=>n.activator.canSummon(n.activator,c,n.action,"SpecialSummon",u,[])&&c.canBeSummoned(n.activator,n.action,"SpecialSummon",u,[],!1))))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async n=>{const s=n.activator.getDeckCell().cardEntities.filter(i);if(s.length===0)return!1;const c=await n.action.entity.field.duel.view.waitSelectEntities(n.activator,s,e.length===1?e[0]:-1,u=>e.includes(u.length),"ç‰¹æ®Šå¬å–šã™ã‚‹ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’é¸æŠž",!1);if(!c)throw new Error("illegal state");for(const u of c)await n.activator.summon(u,t,n.activator.getAvailableMonsterZones(),"SpecialSummon",["Effect"],n.action.entity,!1);return n.activator.getDeckCell().shuffle(),!0},settle:async()=>!0}),Wo=()=>{const i=[];return[{name:"ã‚­ãƒ©ãƒ¼ãƒ»ãƒãƒ†ãƒˆ",filter:e=>e.attr.includes("Dark")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["EffectDestroy"],executableCells:["Graveyard"]},{name:"ã‚­ãƒ©ãƒ¼ãƒ»ãƒˆãƒžãƒˆ",filter:e=>e.attr.includes("Dark")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"å·¨å¤§ãƒã‚ºãƒŸ",filter:e=>e.attr.includes("Earth")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ã‚°ãƒªã‚ºãƒªãƒ¼ãƒžã‚¶ãƒ¼",filter:e=>e.attr.includes("Water")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ã‚·ãƒ£ã‚¤ãƒ³ã‚¨ãƒ³ã‚¸ã‚§ãƒ«",filter:e=>e.attr.includes("Light")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ãƒ‰ãƒ©ã‚´ãƒ³ãƒ•ãƒ©ã‚¤",filter:e=>e.attr.includes("Wind")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ï¼µï¼¦ï¼¯ã‚¿ãƒ¼ãƒˆãƒ«",filter:e=>e.attr.includes("Fire")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"è’é‡Žã®å¥³æˆ¦å£«",filter:e=>e.attr.includes("Earth")&&e.types.includes("Warrior")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ãƒªãƒˆãƒ«ãƒ»ãƒˆãƒ«ãƒ¼ãƒ‘ãƒ¼",filter:e=>e.types.includes("Warrior")&&(e.lvl??9999)<3,qtyList:[1],posList:["Set"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard","Banished"]},{name:"ç ´é¢ç«œ",filter:e=>e.types.includes("Warrior")&&(e.def??9999)<=1500,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"å…±é³´è™«",filter:e=>e.types.includes("Insect")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ãƒ”ãƒ©ãƒŸãƒƒãƒ‰ãƒ»ã‚¿ãƒ¼ãƒˆãƒ«",filter:e=>e.types.includes("Zombie")&&(e.def??9999)<=2e3,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ãƒ¦ãƒ¼ãƒ•ã‚©ãƒ­ã‚¤ãƒ‰",filter:e=>e.types.includes("Machine")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ãƒ˜ãƒ«ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£",filter:e=>e.types.includes("Fiend")&&(e.lvl??9999)===1,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ã‚¬ã‚¹ã‚¿ãƒ»ã‚¤ã‚°ãƒ«",filter:e=>(e.status.nameTags??[]).includes("ã‚¬ã‚¹ã‚¿")&&(e.status.monsterCategories??[]).includes("Tuner"),qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"å¹»å½±ã®é­”è¡“å£«",filter:e=>(e.status.nameTags??[]).includes("ï¼¨ï¼¥ï¼²ï¼¯")&&(e.atk??9999)<=1e3,qtyList:[1],posList:["Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ã‚¸ã‚§ãƒã‚¯ã‚¹ãƒ»ã‚µãƒ¼ãƒãƒ£ãƒ¼",filter:e=>(e.status.nameTags??[]).includes("ã‚¸ã‚§ãƒã‚¯ã‚¹")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ç´«ç‚Žã®è¶³è»½",filter:e=>(e.status.nameTags??[]).includes("å…­æ­¦è¡†")&&(e.lvl??12)<=3,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ã‚¹ãƒ¬ã‚¤ãƒ–ãƒ»ã‚¨ã‚¤ãƒ—",filter:e=>(e.status.nameTags??[]).includes("å‰£é—˜ç£")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ã‚¼ãƒ³ãƒžã‚¤ãƒãƒ‹ãƒ¼",filter:e=>(e.status.nameTags??[]).includes("ã‚¼ãƒ³ãƒžã‚¤")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ï¼¸ï¼¸ï¼ã‚»ã‚¤ãƒãƒ¼ ã‚¨ãƒžãƒ¼ã‚ºãƒ–ãƒ¬ã‚¤ãƒ‰",filter:e=>(e.status.nameTags??[]).includes("ï¼¸ï¼ã‚»ã‚¤ãƒãƒ¼")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"è»éšŠç«œ",filter:e=>e.nm==="è»éšŠç«œ",qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ã‚¢ã‚µãƒ«ãƒˆãƒ»ã‚¬ãƒ³ãƒ‰ãƒƒã‚°",filter:e=>e.nm==="ã‚¢ã‚µãƒ«ãƒˆãƒ»ã‚¬ãƒ³ãƒ‰ãƒƒã‚°",qtyList:[1,2,3,4,5],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ãƒã‚¤ã‚¨ãƒŠ",filter:e=>e.nm==="ãƒã‚¤ã‚¨ãƒŠ",qtyList:[1,2,3,4,5],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]}].forEach(e=>{i.push({name:e.name,actions:[Yo(e.filter,e.qtyList,e.posList,e.destoryTypes,e.executableCells),He,$e,Ye]})}),i},Ko=i=>({title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:e=>{if(e.activator.getDeckCell().cardEntities.filter(i).length!==0&&e.activator.canDraw)return ke(e)},prepare:(e,t,a,r)=>Pe(e,t,a,r,["SearchFromDeck"],[],void 0),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(i);if(t.length===0)return!1;const a=await e.action.entity.field.duel.view.waitSelectEntities(e.activator,t,1,r=>r.length===1,"æ‰‹æœ­ã«åŠ ãˆã‚‹ã‚«ãƒ¼ãƒ‰ã‚’é¸æŠž",!1);for(const r of a??[])await r.addToHand(["Effect"],e.action.entity,e.activator);return e.activator.getDeckCell().shuffle(),!0},settle:async()=>!0}),Xo=(i,e)=>({title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,priorityForNPC:40,validate:t=>{if(!(t.activator.getGraveyard().cardEntities.filter(i).length<e))return ke(t)},prepare:(t,a,r,n)=>Pe(t,a,r,n,["AddToHandFromGraveyard"],[],void 0),execute:async t=>{const a=t.activator.getGraveyard().cardEntities.filter(i);if(a.length===0)return!1;const r=await t.action.entity.field.duel.view.waitSelectEntities(t.activator,a,e,n=>n.length===e,"æ‰‹æœ­ã«åŠ ãˆã‚‹ã‚«ãƒ¼ãƒ‰ã‚’é¸æŠž",!1);for(const n of r??[])await n.addToHand(["Effect"],t.action.entity,t.activator);return!0},settle:async()=>!0}),Qo=i=>({title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:e=>{if(e.activator.getHandCell().cardEntities.filter(i).length!==0&&!(e.activator.getDeckCell().cardEntities.length<2))return ke(e)},prepare:async(e,t,a,r)=>{const n=await Pe(e,t,a,r,["Draw"],[],void 0);return await e.activator.discard(1,["Discard","Cost"],e.action.entity,e.activator,i),n},execute:async e=>(await e.activator.draw(2,e.action.entity,e.activator),!0),settle:async()=>!0}),Jo=i=>({title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:ke,prepare:(e,t,a,r)=>{const[n,s]=i(e.action.entity),c=[];return n<0&&c.push("DamageToSelf"),s<0&&c.push("DamageToOpponent"),Pe(e,t,a,r,c,[],void 0)},execute:async e=>{const[t,a]=i(e.action.entity);return a>0?e.activator.getOpponentPlayer().heal(a,e.action.entity):a<0&&e.activator.getOpponentPlayer().effectDamage(Math.abs(a),e.action.entity),t>0?e.activator.heal(t,e.action.entity):t<0&&e.activator.effectDamage(Math.abs(t),e.action.entity),!0},settle:async()=>!0}),Io=()=>{const i=[];return[{name:"å¢—æ´",filter:e=>e.origin.kind==="Monster"&&e.types.includes("Warrior")&&(e.origin.level??5)<5},{name:"åŒ–çŸ³èª¿æŸ»",filter:e=>e.origin.kind==="Monster"&&e.types.includes("Dinosaur")&&(e.origin.level??6)<6},{name:"ï¼¥ï¼ã‚¨ãƒžãƒ¼ã‚¸ã‚§ãƒ³ã‚·ãƒ¼ã‚³ãƒ¼ãƒ«",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("ï¼¥ãƒ»ï¼¨ï¼¥ï¼²ï¼¯")},{name:"å¬é›†ã®è–åˆ»å°",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("è–åˆ»")},{name:"å¬å–šå¸«ã®ã‚¹ã‚­ãƒ«",filter:e=>e.origin.kind==="Monster"&&(e.origin.monsterCategories??[]).includes("Normal")&&(e.origin.level??4)>4},{name:"ãƒˆã‚¥ãƒ¼ãƒ³ã®ã‚‚ãã˜",filter:e=>(e.origin.nameTags??[]).includes("ãƒˆã‚¥ãƒ¼ãƒ³")},{name:"èžåˆè³¢è€…",filter:e=>e.origin.name==="èžåˆ"},{name:"è™¹ã®æž¶ã‘æ©‹",filter:e=>e.origin.kind!=="Monster"&&(e.origin.nameTags??[]).includes("å®çŽ‰")},{name:"ç´«ç‚Žã®ç‹¼ç…™",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("å…­æ­¦è¡†")&&(e.origin.level??4)<4},{name:"ãƒ†ãƒ©ãƒ»ãƒ•ã‚©ãƒ¼ãƒŸãƒ³ã‚°",filter:e=>e.origin.kind==="Spell"&&e.origin.spellCategory==="Field"},{name:"ã‚³ãƒ¼ãƒ«ãƒ»ãƒªã‚¾ãƒãƒ¼ã‚¿ãƒ¼",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("ãƒªã‚¾ãƒãƒ¼ã‚¿ãƒ¼")}].forEach(e=>{i.push({name:e.name,actions:[Ko(e.filter),be]})}),[{name:"æˆ¦å£«ã®ç”Ÿé‚„",filter:e=>e.status.kind==="Monster"&&e.types.includes("Warrior"),qty:1},{name:"ãƒ€ãƒ¼ã‚¯ãƒ»ãƒãƒ¼ã‚¹ãƒˆ",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Dark")&&(e.atk??9999)<=1500,qty:1},{name:"æ‚ªå¤¢å†ã³",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Dark")&&(e.def??9999)===0,qty:2},{name:"ã‚µãƒ«ãƒ™ãƒ¼ã‚¸",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Water")&&(e.atk??9999)<=1500,qty:2},{name:"ãƒãƒƒãƒ†ãƒªãƒ¼ãƒªã‚µã‚¤ã‚¯ãƒ«",filter:e=>e.status.kind==="Monster"&&e.types.includes("Thunder")&&(e.atk??9999)<=1500,qty:2},{name:"é—‡ã®é‡ç”£å·¥å ´",filter:e=>e.status.kind==="Monster"&&(e.status.monsterCategories??[]).includes("Normal"),qty:2}].forEach(e=>{i.push({name:e.name,actions:[Xo(e.filter,e.qty),be]})}),[{name:"ãƒˆãƒ¬ãƒ¼ãƒ‰ãƒ»ã‚¤ãƒ³",filter:e=>e.status.kind==="Monster"&&(e.lvl??0)===8},{name:"èª¿å’Œã®å®æœ­",filter:e=>e.status.kind==="Monster"&&(e.origin.monsterCategories??[]).includes("Tuner")&&e.types.includes("Dragon")&&(e.atk??9999)<=1e3},{name:"ãƒ‡ã‚¹ãƒ†ãƒ‹ãƒ¼ãƒ»ãƒ‰ãƒ­ãƒ¼",filter:e=>e.status.kind==="Monster"&&(e.origin.nameTags??[]).includes("ï¼¤ï¼ï¼¨ï¼¥ï¼²ï¼¯")}].forEach(e=>{i.push({name:e.name,actions:[Qo(e.filter),be]})}),[{name:"ç«ã®ç²‰",calcHeal:()=>[0,-200]},{name:"é›·é³´",calcHeal:()=>[0,-300]},{name:"ãƒ•ã‚¡ã‚¤ãƒ¤ãƒ¼ãƒ»ãƒœãƒ¼ãƒ«",calcHeal:()=>[0,-500]},{name:"ç«ã‚ã¶ã‚Šã®åˆ‘",calcHeal:()=>[0,-600]},{name:"æ˜¼å¤œã®å¤§ç«äº‹",calcHeal:()=>[0,-800]},{name:"ç«ç‚Žåœ°ç„",calcHeal:()=>[-500,-1e3]},{name:"ç›—äººã‚´ãƒ–ãƒªãƒ³",calcHeal:()=>[500,-500]},{name:"ãƒ–ãƒ«ãƒ¼ãƒ»ãƒãƒ¼ã‚·ãƒ§ãƒ³",calcHeal:()=>[400,0]},{name:"ãƒ¬ãƒƒãƒ‰ãƒ»ãƒãƒ¼ã‚·ãƒ§ãƒ³",calcHeal:()=>[500,0]},{name:"ã‚´ãƒ–ãƒªãƒ³ã®ç§˜è–¬",calcHeal:()=>[600,0]},{name:"å¤©ä½¿ã®ç”Ÿãè¡€",calcHeal:()=>[800,0]},{name:"æ²»ç™‚ã®ç¥ž ãƒ‡ã‚£ã‚¢ãƒ³ãƒ»ã‚±ãƒˆ",calcHeal:()=>[1e3,0]},{name:"æµã¿ã®é›¨",calcHeal:()=>[1e3,1e3]}].forEach(e=>{i.push({name:e.name,actions:[Jo(e.calcHeal),be]})}),i},ec=()=>{const i=[];return["å¤§åœ°ã®é¨Žå£«ã‚¬ã‚¤ã‚¢ãƒŠã‚¤ãƒˆ","ã‚¹ã‚¯ãƒ©ãƒƒãƒ—ãƒ»ãƒ‡ã‚¹ãƒ‡ãƒ¼ãƒ¢ãƒ³"].forEach(e=>i.push({name:e,actions:[He,$e,Hi()],canBeSummoned:gi})),i.push({name:"ãƒŠãƒãƒ¥ãƒ«ãƒ»ã‚¬ã‚ªãƒ‰ãƒ¬ã‚¤ã‚¯",actions:[He,$e,Hi(e=>e.length===1&&e.every(t=>t.attr.some(a=>a==="Earth")),e=>e.length>0&&e.every(t=>t.attr.some(a=>a==="Earth")))],canBeSummoned:gi}),i.push({name:"ãƒžã‚¸ã‚«ãƒ«ãƒ»ã‚¢ãƒ³ãƒ‰ãƒ­ã‚¤ãƒ‰",actions:[He,$e,Hi(),{title:"å›žå¾©",playType:"MandatoryIgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["end"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,validate:e=>e.action.entity.duel.phase==="end"&&e.activator.isTurnPlayer&&e.action.entity.face==="FaceUp"?[]:void 0,prepare:ki,execute:async e=>(e.activator.heal(e.activator.getMonstersOnField().filter(t=>t.face==="FaceUp").filter(t=>t.types.includes("Psychic")).length*600,e.action.entity),!0),settle:async()=>!0}],canBeSummoned:gi}),i.push({name:"ã‚¹ã‚¿ãƒ¼ãƒ€ã‚¹ãƒˆãƒ»ãƒ‰ãƒ©ã‚´ãƒ³",actions:[He,$e,Hi(),{title:"â‘ ãƒ´ã‚£ã‚¯ãƒ†ãƒ ãƒ»ã‚µãƒ³ã‚¯ãƒãƒ¥ã‚¢ãƒª",playType:"QuickEffect",spellSpeed:"Quick",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:ha,executableDuelistTypes:["Controller"],validate:(e,t)=>t.length===0?void 0:t[e.index-1].chainBlockTags.includes("DestroyOnField")?[]:void 0,prepare:async(e,t,a)=>{if(a.length===0)return;const r=a.slice(-1)[0];return await e.action.entity.release(["Cost"],e.action.entity,e.activator),{selectedEntities:[],chainBlockTags:e.action.calcChainBlockTagsForDestroy([r.action.entity]),prepared:void 0}},execute:async(e,t)=>{const a=t[e.index-1];return a.isNegatedActivationBy=e.action,$t.tryDestroy([a.action.entity],e),!0},settle:async()=>!0},{title:"â‘¡è‡ªå·±å†ç”Ÿ",playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["end"],executableDuelistTypes:["Controller"],validate:e=>{const t=e.action.entity.moveLog.latestRecord;if(t.movedBy!==e.action.entity||!e.activator.duel.clock.isSameTurn(t.movedAt)||!t.movedAs.includes("Cost"))return;const a=e.activator.duel,r=e.action.entity.actionLogRecords.filter(s=>a.clock.isSameTurn(s.clock)).map(s=>s.chainBlockInfo).findLast(s=>s.action.title==="â‘ ãƒ´ã‚£ã‚¯ãƒ†ãƒ ãƒ»ã‚µãƒ³ã‚¯ãƒãƒ¥ã‚¢ãƒª");return!r||r.state!=="done"?void 0:e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:ki,execute:e=>mo(e),settle:async()=>!0}],canBeSummoned:gi}),i},tc=()=>{const i=[];return[{name:"è‰åŽŸ",up:["Warrior","BeastWarrior"],down:[]},{name:"æ£®",up:["Insect","Plant","Beast","BeastWarrior"],down:[]},{name:"å±±",up:["Dragon","WingedBeast","Thunder"],down:[]},{name:"è’é‡Ž",up:["Dinosaur","Zombie","Rock"],down:[]},{name:"æµ·",up:["Aqua","SeaSerpent","Fish"],down:["Machine","Pyro"]},{name:"é—‡",up:["Fiend","Spellcaster"],down:["Fairy"]}].forEach(e=>{i.push({name:e.name,actions:[{title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:ke,prepare:za,execute:async()=>!0,settle:async()=>!0},be],continuousEffects:[Ji("ç™ºå‹•","Spell",t=>t.isOnField&&t.face==="FaceUp",t=>["attack","defense"].flatMap(a=>["up","down"].map(r=>dt.createContinuous("ç™ºå‹•",n=>n.isSpawnedBy.isOnField&&n.isSpawnedBy.face==="FaceUp",t,(n,s)=>s.isOnField&&s.face==="FaceUp"&&(s.status.monsterCategories??!1)&&e[r].union(s.types).length>0,a,"wip","Addition",(n,s,c)=>!n.isEffective||s.face==="FaceDown"?c:c+(r==="up"?200:-200)))))]})}),[{name:"ãƒãƒ¼ãƒ‹ãƒ³ã‚°ãƒ–ãƒ©ãƒƒãƒ‰",attr:"Fire"},{name:"ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒ¯ãƒ¼ãƒ«ãƒ‰",attr:"Water"},{name:"ã‚¬ã‚¤ã‚¢ãƒ‘ãƒ¯ãƒ¼",attr:"Earth"},{name:"ã‚·ãƒ£ã‚¤ãƒ³ã‚¹ãƒ‘ãƒ¼ã‚¯",attr:"Light"},{name:"ãƒ€ãƒ¼ã‚¯ã‚¾ãƒ¼ãƒ³",attr:"Dark"},{name:"ãƒ‡ã‚¶ãƒ¼ãƒˆã‚¹ãƒˆãƒ¼ãƒ ",attr:"Wind"}].forEach(e=>{i.push({name:e.name,actions:[{title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","FieldSpellZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:ke,prepare:za,execute:async()=>!0,settle:async()=>!0},be],continuousEffects:[Ji("ç™ºå‹•","Spell",t=>t.isOnField&&t.face==="FaceUp",t=>["attack","defense"].flatMap(a=>dt.createContinuous("ç™ºå‹•",r=>r.isSpawnedBy.isOnField&&r.isSpawnedBy.face==="FaceUp",t,(r,n)=>n.isOnField&&n.face==="FaceUp"&&n.attr.includes(e.attr),a,"wip","Addition",(r,n,s)=>!r.isEffective||n.face==="FaceDown"?s:s+(a==="attack"?500:-400))))]})}),i},ic=()=>{const i=[],e={name:"é€£åˆè»",actions:[{title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:ke,prepare:za,execute:async()=>!0,settle:async()=>!0},be],continuousEffects:[Ji("ç™ºå‹•","Spell",t=>t.isOnField&&t.face==="FaceUp",t=>[dt.createContinuous("ç™ºå‹•",a=>a.isSpawnedBy.isOnField&&a.isSpawnedBy.face==="FaceUp",t,(a,r)=>r.controller===a.isSpawnedBy.controller&&r.types.includes("Warrior")&&r.isOnField&&r.face==="FaceUp","attack","wip","Addition",(a,r,n)=>{if(!a.isEffective||r.face==="FaceDown")return n;const s=a.controller.getMonstersOnField().filter(c=>c.face==="FaceUp").filter(c=>c.types.includes("Warrior")||c.types.includes("Spellcaster")).length;return n+s*200})])]};return i.push(e),i},ac=()=>{const i=[];[{name:"å›£çµã®åŠ›",kind:["Monster"],rate:800},{name:"é­”å°Žå¸«ã®åŠ›",kind:["Spell","Trap"],rate:500}].forEach(t=>{i.push({name:t.name,actions:[Va(),be],continuousEffects:[ga(t.name,"Spell",a=>a.info.equipedBy?[a.info.equipedBy]:[],a=>a.isOnField&&a.face==="FaceUp",a=>["attack","defense"].map(r=>dt.createContinuous("ç™ºå‹•",n=>n.isSpawnedBy.isOnField&&n.isSpawnedBy.face==="FaceUp",a,(n,s)=>s.isOnField&&s.face==="FaceUp",r,"wip","Addition",(n,s,c)=>{if(!n.isEffective)return c;const u=n.controller.getEntiteisOnField().filter(l=>t.kind.includes(l.status.kind)).length;return c+u*t.rate})))]})});const e={name:"æ—©ã™ãŽãŸåŸ‹è‘¬",actions:[{title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:t=>{if(t.action.entity.field.getCells("Graveyard").flatMap(a=>a.cardEntities).filter(a=>a.status.kind==="Monster").filter(a=>a.info.isRebornable).filter(a=>a.canBeTargetOfEffect(t.activator,t.action.entity,t.action)).filter(a=>a.canBeSummoned(t.activator,t.action,"SpecialSummon","Attack",[],!1)).some(a=>t.activator.canSummon(t.activator,a,t.action,"SpecialSummon","Attack",[]))&&t.activator.getAvailableMonsterZones().length!==0&&!(t.activator.lp<800))return ke(t)},prepare:async(t,a,r)=>{const n=await t.action.entity.field.duel.view.waitSelectEntities(t.activator,t.activator.getGraveyard().cardEntities.filter(s=>s.status.kind==="Monster").filter(s=>s.info.isRebornable).filter(s=>s.canBeTargetOfEffect(t.activator,t.action.entity,t.action)).filter(s=>s.canBeSummoned(t.activator,t.action,"SpecialSummon","Attack",[],!1)).filter(s=>t.activator.canSummon(t.activator,s,t.action,"SpecialSummon","Attack",[])),1,s=>s.length===1,"è˜‡ç”Ÿå¯¾è±¡ã¨ã™ã‚‹ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’é¸æŠž",!1);if(!n)throw new Lt(t);return t.activator.payLp(800,t.action.entity),t.action.entity.info.effectTargets[t.action.seq]=n,await Pe(t,a,r,!1,["SpecialSummonFromGraveyard","PayLifePoint"],n,void 0)},execute:async(t,a)=>{if(t.action.entity.info.equipedBy)return await t.action.entity.ruleDestory(),!1;const r=t.activator.getEmptyMonsterZones(),n=t.selectedEntities[0];return await t.activator.summon(n,["Attack"],r,"SpecialSummon",["Effect"],t.action.entity,!1),n.moveLog.latestRecord.movedBy!==t.action.entity?(await t.action.entity.ruleDestory(),!1):(t.action.entity.onBeforeMove.append(s=>{if(s.entity.face!=="FaceUp"||!s.entity.isOnFieldAsSpellTrap)return"RemoveMe";console.log(s.entity.toString(),s.entity);const[,,,,,c]=s.args;return n.isOnField&&n.face==="FaceUp"&&s.entity.isEffective&&c.union(["EffectDestroy","RuleDestroy"]).length&&(console.log(t.action.entity.toString()),s.entity.controller.writeInfoLog(`${t.action.entity.toString()}ãŒç ´å£Šã•ã‚ŒãŸãŸã‚ã€è£…å‚™å¯¾è±¡ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼${s.entity}ã‚’ç ´å£Šã€‚`),n.tryMarkForDestory("EffectDestroy",t.activator,s.entity,{})),"RemoveMe"}),Rn(t,a,(s,c)=>{var u;return(u=c.info.effectTargets[t.action.seq])==null?void 0:u.includes(s)}))},settle:async()=>!0},be]};return i.push(e),i.push({name:"å¹»æƒ‘ã®å·»ç‰©",actions:[Va(),be],continuousEffects:[]}),i},rc=()=>{const i=[];return[{name:"ä¼èª¬ã®å‰£",attr:void 0,monType:"Warrior",atk:200,def:200},{name:"ç§˜è¡“ã®æ›¸",attr:void 0,monType:"Spellcaster",atk:200,def:200},{name:"ãƒã‚»ã‚¤ãƒ‰ãƒ³ã®åŠ›",attr:void 0,monType:"Aqua",atk:200,def:200},{name:"ç´«æ°´æ™¶",attr:void 0,monType:"Zombie",atk:200,def:200},{name:"çŒ›ç£ã®æ­¯",attr:void 0,monType:"Beast",atk:200,def:200},{name:"æ©Ÿæ¢°æ”¹é€ å·¥å ´",attr:void 0,monType:"Machine",atk:200,def:200},{name:"ä½“æ¸©ã®ä¸Šæ˜‡",attr:void 0,monType:"Reptile",atk:200,def:200},{name:"é­”èŒ",attr:void 0,monType:"Plant",atk:200,def:200},{name:"é—‡ãƒ»ã‚¨ãƒãƒ«ã‚®ãƒ¼",attr:void 0,monType:"Fiend",atk:200,def:200},{name:"ãƒ¬ãƒ¼ã‚¶ãƒ¼ç ²æ©Ÿç”²éŽ§",attr:void 0,monType:"Insect",atk:200,def:200},{name:"éŠ€ã®å¼“çŸ¢",attr:void 0,monType:"Fairy",atk:200,def:200},{name:"é›»æ’ƒéž­",attr:void 0,monType:"Thunder",atk:200,def:200},{name:"ãƒ‰ãƒ©ã‚´ãƒ³ã®ç§˜å®",attr:void 0,monType:"Dragon",atk:200,def:200},{name:"ãƒ•ã‚©ãƒ­ãƒ¼ãƒ»ã‚¦ã‚£ãƒ³ãƒ‰",attr:void 0,monType:"WingedBeast",atk:200,def:200},{name:"é­”æ€§ã®æœˆ",attr:void 0,monType:"BeastWarrior",atk:200,def:200},{name:"ã‚¨ãƒ«ãƒ•ã®å…‰",attr:"Light",monType:void 0,atk:400,def:-200},{name:"è¦šé†’",attr:"Earth",monType:void 0,atk:400,def:-200},{name:"ç¼ç†±ã®æ§",attr:"Fire",monType:void 0,atk:400,def:-200},{name:"çªé¢¨ã®æ‰‡",attr:"Wind",monType:void 0,atk:400,def:-200},{name:"ã¯ãŒã­ã®ç”²ç¾…",attr:"Water",monType:void 0,atk:400,def:-200},{name:"é—‡ã®ç ´ç¥žå‰£",attr:"Dark",monType:void 0,atk:400,def:-200},{name:"ç«å™¨ä»˜æ©Ÿç”²éŽ§",attr:void 0,monType:"Insect",atk:700,def:0},{name:"ã‚µãƒ©ãƒžãƒ³ãƒ‰ãƒ©",attr:"Fire",monType:void 0,atk:700,def:0},{name:"ã‚·ãƒ£ã‚¤ãƒ³ãƒ»ã‚­ãƒ£ãƒƒã‚¹ãƒ«",attr:"Light",monType:void 0,atk:700,def:0}].forEach(e=>{i.push({name:e.name,actions:[Va(t=>(!e.attr||t.attr.includes(e.attr))&&(!e.monType||t.types.includes(e.monType))),be],continuousEffects:[ga(e.name,"Spell",t=>t.info.equipedBy?[t.info.equipedBy]:[],t=>t.isOnField&&t.face==="FaceUp",t=>{const a=[];return e.atk!==0&&a.push(["attack",e.atk]),e.def!==0&&a.push(["defense",e.def]),a.map(([r,n])=>dt.createContinuous("ç™ºå‹•",s=>s.isSpawnedBy.isOnField&&s.isSpawnedBy.face==="FaceUp",t,(s,c)=>c.isOnField&&c.face==="FaceUp"&&(!e.monType||c.types.includes(e.monType))&&(!e.attr||c.attr.includes(e.attr)),r,"wip","Addition",(s,c,u)=>s.isEffective?u+n:u))})]})}),i},nc=()=>{const i=[],e={name:"ã«ã›ã‚¢ãƒã‚¿ãƒ¼",actions:[Ye,He,$e],continuousEffects:[ga("THE_DEVILS_AVATAR","Monster",a=>[a],a=>a.isOnField&&a.face==="FaceUp",a=>["attack","defense"].map(r=>dt.createContinuous("THE_DEVILS_AVATAR",n=>n.isSpawnedBy.isOnField&&n.isSpawnedBy.face==="FaceUp",a,(n,s)=>s.isOnField&&s.face==="FaceUp",r,"calculated","THE_DEVILS_AVATAR",()=>Number.MIN_VALUE)))]};i.push(e);const t={name:"ã«ã›ãƒ‰ãƒ¬ãƒƒãƒ‰ãƒ»ãƒ«ãƒ¼ãƒˆ",actions:[Ye,He,$e],continuousEffects:[Ji("THE_DEVILS_DREAD-ROOT","Monster",a=>a.isOnField&&a.face==="FaceUp",a=>["attack","defense"].map(r=>dt.createContinuous("THE_DEVILS_DREAD-ROOT",n=>n.isSpawnedBy.isOnField&&n.isSpawnedBy.face==="FaceUp",a,(n,s)=>s.status.kind==="Monster"&&s.isOnField&&s.face==="FaceUp"&&s!==n.isSpawnedBy,r,"calculated","THE_DEVILS_DREAD-ROOT",(n,s,c)=>Math.round(c/2))))]};return i.push(t),i},sc=()=>{const i=[],e={name:"ã”éš å±…ã®çŒ›æ¯’è–¬",actions:[be,{title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:nt,executableDuelistTypes:["Controller"],validate:ke,prepare:async(a,r,n,s)=>{const c=await a.action.entity.field.duel.view.waitSelectText([{seq:0,text:"â—è‡ªåˆ†ã¯ï¼‘ï¼’ï¼ï¼ï¼¬ï¼°å›žå¾©ã™ã‚‹ã€‚"},{seq:1,text:"â—ç›¸æ‰‹ã«ï¼˜ï¼ï¼ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’ä¸Žãˆã‚‹ã€‚"}],"ä½¿ç”¨ã™ã‚‹åŠ¹æžœã‚’é¸æŠž",!1);if(c===void 0&&!s)throw new Lt(a);const u=[];return c===1&&u.push("DamageToOpponent"),Pe(a,r,n,s,u,[],c??0)},execute:async a=>a.prepared===1?(a.activator.getOpponentPlayer().effectDamage(800,a.action.entity),!0):(a.activator.heal(1200,a.action.entity),!0),settle:async()=>!0}]};i.push(e);const t={name:"æœˆã®æ›¸",actions:[{title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:nt,executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:a=>{if(a.action.entity.field.getMonstersOnField().filter(n=>n.canBeTargetOfEffect(a.activator,a.action.entity,a.action)).length)return ke(a)},prepare:async(a,r,n,s)=>{const c=a.action.entity.field.getMonstersOnField().filter(l=>l.canBeTargetOfEffect(a.activator,a.action.entity,a.action)),u=await a.action.entity.duel.view.waitSelectEntities(a.activator,c,1,l=>l.length===1,"å¯¾è±¡ã¨ã™ã‚‹ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’é¸æŠž",s);if(u)return console.log(u[0].toString(),u[0].info.equipEntities),Pe(a,r,n,s,[],[...u],void 0)},execute:async a=>{const r=a.selectedEntities[0];if(!r.isOnFieldAsMonster||r.battlePosition==="Set")return!1;if(!r.canBeEffected(a.activator,a.action.entity,a.action)){a.activator.duel.log.info(`${r.toString()}ã¯${a.action.entity.toString()}ã®åŠ¹æžœã‚’å—ã‘ãªã„ã€‚`);return}return console.log(r.toString(),r.info.equipEntities),await r.setBattlePosition("Set",["Effect"],a.action.entity,a.activator),!0},settle:async()=>!0},be]};return i.push(t),i.push({name:"çªé€²",actions:[{title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:[...nt,...zt],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:a=>{if(a.action.entity.field.getMonstersOnField().filter(n=>n.canBeTargetOfEffect(a.activator,a.action.entity,a.action)).length)return ke(a)},prepare:async(a,r,n,s)=>{const c=a.action.entity.field.getMonstersOnField().filter(l=>l.canBeTargetOfEffect(a.activator,a.action.entity,a.action)),u=await a.action.entity.duel.view.waitSelectEntities(a.activator,c,1,l=>l.length===1,"å¯¾è±¡ã¨ã™ã‚‹ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’é¸æŠž",s);if(u)return console.log(u[0].toString(),u[0].info.equipEntities),Pe(a,r,n,s,[],[...u],void 0)},execute:async a=>{const r=a.selectedEntities[0];if(!r.isOnFieldAsMonster||r.battlePosition==="Set")return!1;if(!r.canBeEffected(a.activator,a.action.entity,a.action)){a.activator.duel.log.info(`${r.toString()}ã¯${a.action.entity.toString()}ã®åŠ¹æžœã‚’å—ã‘ãªã„ã€‚`);return}return r.numericOprsBundle.push(dt.createLingeringAddition("æ”»æ’ƒåŠ›ä¸Šæ˜‡",n=>n.effectOwner.duel.clock.isSameTurn(n.isSpawnedAt),a.action.entity,a.action,"attack",(n,s,c)=>c+700)),!0},settle:async()=>!0},be]}),i},lc=(i,e)=>{const t=`é­”åŠ›å……å¡«å¯èƒ½(${e})`;return Jl(t,i,a=>[a],()=>!0,a=>[new oo(t,()=>!0,!0,a,{},(r,n)=>r.isSpawnedBy===n,(r,n)=>(n.maxCounterQty.SpellCounter=e,n))])},oc=()=>{const i=[],e={name:"é­”å°Žæˆ¦å£« ãƒ–ãƒ¬ã‚¤ã‚«ãƒ¼",actions:[He,$e,Ye,{title:"â‘ é­”åŠ›å……å¡«",playType:"MandatoryTriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:t=>{if(t.action.entity.hasBeenSummonedNow(["NormalSummon"]))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["IfNormarlSummonSucceed"],prepared:void 0}),execute:async t=>t.action.entity.face==="FaceDown"?!1:(t.action.entity.counterHolder.setQty("SpellCounter",1),!0),settle:async()=>!0},{title:"â‘¢ãƒžãƒŠãƒ–ãƒ¬ã‚¤ã‚¯",playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:t=>{if(!t.action.entity.counterHolder.getQty("SpellCounter"))return;const a=t.action.entity.field.getCells(...At).flatMap(r=>r.cardEntities).filter(r=>r.canBeTargetOfEffect(t.activator,t.action.entity,t.action));if(a.length)return a.map(r=>r.fieldCell)},prepare:async(t,a,r,n)=>{let s=a==null?void 0:a.cardEntities[0];if(!s){const c=t.action.entity.field.getCells(...At).flatMap(l=>l.cardEntities).filter(l=>l.canBeTargetOfEffect(t.activator,t.action.entity,t.action)),u=await t.action.entity.duel.view.waitSelectEntities(t.activator,c,1,l=>l.length===1,"ç ´å£Šã™ã‚‹å¯¾è±¡ã‚’é¸æŠžã€‚",n);if(!u||!u.length)return;s=u[0]}return{selectedEntities:[s],chainBlockTags:t.action.calcChainBlockTagsForDestroy([s]),prepared:void 0}},execute:async t=>{if(!t.selectedEntities.every(a=>!a.isOnFieldAsSpellTrap)&&t.action.entity.counterHolder.getQty("SpellCounter"))return t.action.entity.counterHolder.remove("SpellCounter",1),await $t.tryDestroy(t.selectedEntities,t),!0},settle:async()=>!0}],continuousEffects:[lc("Monster",1),ga("â‘¡æ”»æ’ƒåŠ›ä¸Šæ˜‡","Monster",t=>[t],()=>!0,t=>[dt.createContinuous("â‘¡æ”»æ’ƒåŠ›ä¸Šæ˜‡",()=>!0,t,()=>!0,"attack","wip","Addition",(a,r,n)=>a.isEffective?n+a.counterHolder.getQty("SpellCounter")*300:n)])]};return i.push(e),i},cc=()=>{const i=[];return["ç‚¸è£‚è£…ç”²","æ¬¡å…ƒå¹½é–‰"].forEach(e=>{i.push({name:e,actions:[be,{title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:["b1Battle","b2Battle"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:t=>{if(!t.activator.duel.clock.isUponAttackDeclaration()||t.activator.isTurnPlayer)return;const a=t.activator.duel.attackingMonster;if(!a)throw new Se("æƒ³å®šã•ã‚Œãªã„çŠ¶æ…‹",t,a);if(a.canBeTargetOfEffect(t.activator,t.action.entity,t.action))return e==="æ¬¡å…ƒå¹½é–‰"&&!t.activator.canTryBanish(a,"BanishAsEffect",t.action)?!1:ke(t)},prepare:async(t,a,r,n)=>{const s=t.activator.duel.attackingMonster;if(!s)throw new Se("æƒ³å®šã•ã‚Œãªã„çŠ¶æ…‹",t,s);const c=e==="ç‚¸è£‚è£…ç”²"?t.action.calcChainBlockTagsForDestroy([s]):["Banish","BanishFromField"];return Pe(t,a,r,n,c,[s],void 0)},execute:async t=>(e==="ç‚¸è£‚è£…ç”²"?await $t.tryDestroy(t.selectedEntities,t):await $t.tryBanish(t.selectedEntities,t),!0),settle:async()=>!0}]})}),i},dc=()=>{const i=[];return i.push({name:"å¼·æ¬²ãªç“¶",actions:[be,{title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:nt,executableDuelistTypes:["Controller"],validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<2)&&e.activator.canDraw&&e.activator.canAddToHandFromDeck)return ke(e)},prepare:(e,t,a,r)=>Pe(e,t,a,r,["Draw"],[],void 0),execute:async e=>(await e.activator.draw(1,e.action.entity,e.activator),!0),settle:async()=>!0}]}),i.push({name:"æˆ¦ç·šå¾©å¸°",actions:[{title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:nt,executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:e=>{if(e.activator.getAvailableMonsterZones().length!==0&&e.action.entity.field.getCells("Graveyard").flatMap(t=>t.cardEntities).filter(t=>t.status.kind==="Monster").filter(t=>t.info.isRebornable).filter(t=>t.canBeTargetOfEffect(e.activator,e.action.entity,e.action)).filter(t=>t.canBeSummoned(e.activator,e.action,"SpecialSummon","Defense",[],!1)).some(t=>e.activator.canSummon(e.activator,t,e.action,"SpecialSummon","Defense",[])))return ke(e)},prepare:async(e,t,a)=>{const r=await e.action.entity.field.duel.view.waitSelectEntities(e.activator,e.action.entity.field.getCells("Graveyard").flatMap(n=>n.cardEntities).filter(n=>n.status.kind==="Monster").filter(n=>n.info.isRebornable).filter(n=>n.canBeTargetOfEffect(e.activator,e.action.entity,e.action)).filter(n=>n.canBeSummoned(e.activator,e.action,"SpecialSummon","Defense",[],!1)).filter(n=>e.activator.canSummon(e.activator,n,e.action,"SpecialSummon","Defense",[])),1,n=>n.length===1,"è˜‡ç”Ÿå¯¾è±¡ã¨ã™ã‚‹ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’é¸æŠž",!1);if(!r)throw new Lt(e);return await Pe(e,t,a,!1,["SpecialSummonFromGraveyard"],r,void 0)},execute:async e=>{const t=e.activator.getEmptyMonsterZones(),a=e.selectedEntities[0];return await e.activator.summon(a,["Defense"],t,"SpecialSummon",["Effect"],e.action.entity,!1),!0},settle:async()=>!0},be]}),i},uc=()=>{const i=[],e={name:"å¼·æ¬²ãªå£º",actions:[{title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:20,validate:s=>{if(!(s.activator.getDeckCell().cardEntities.length<2)&&s.activator.canDraw&&s.activator.canAddToHandFromDeck)return ke(s)},prepare:(s,c,u,l)=>Pe(s,c,u,l,["Draw"],[],void 0),execute:async s=>(await s.activator.draw(2,s.action.entity,s.activator),!0),settle:async()=>!0},be]};i.push(e);const t={name:"è²ªæ¬²ãªå£º",actions:[{title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:30,validate:s=>{if(!(s.activator.getGraveyard().cardEntities.filter(c=>c.status.kind==="Monster").filter(c=>c.canBeTargetOfEffect(s.activator,s.action.entity,s.action)).length<5)&&s.activator.canDraw&&s.activator.canAddToHandFromDeck)return ke(s)},prepare:async(s,c,u,l)=>{const o=await s.action.entity.field.duel.view.waitSelectEntities(s.activator,s.activator.getGraveyard().cardEntities.filter(f=>f.status.kind==="Monster").filter(f=>f.canBeTargetOfEffect(s.activator,s.action.entity,s.action)),5,f=>f.length===5,"ãƒ‡ãƒƒã‚­ã«æˆ»ã™ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’é¸æŠžã€‚",!1);if(o)return Pe(s,c,u,l,["Draw","ReturnToDeckFromGraveyard"],o,void 0)},execute:async s=>s.selectedEntities.some(c=>c.wasMovedAtCurrentChain)?!1:(await ye.returnManyToDeckForTheSameReason("Random",s.selectedEntities,["Effect"],s.action.entity,s.activator),await s.activator.draw(2,s.action.entity,s.activator),!0),settle:async()=>!0},be]};i.push(t);const a={name:"å¤©ä½¿ã®æ–½ã—",actions:[{title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:30,validate:s=>{if(!(s.activator.getDeckCell().cardEntities.length<3))return ke(s)},prepare:(s,c,u)=>Pe(s,c,u,!1,["Draw","DiscordAsEffect"],[],void 0),execute:async s=>(await s.activator.draw(3,s.action.entity,s.activator),await s.activator.discard(2,["Effect","Discard"],s.action.entity,s.activator),!0),settle:async()=>!0},be]};i.push(a);const r={name:"æˆé‡‘ã‚´ãƒ–ãƒªãƒ³",actions:[{title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:20,validate:s=>{if(!(s.activator.getDeckCell().cardEntities.length<1))return ke(s)},prepare:(s,c,u)=>Pe(s,c,u,!1,["Draw"],[],void 0),execute:async s=>(await s.activator.draw(1,s.action.entity,s.activator),s.action.entity.field.duel.clock.incrementProcSeq(),s.activator.getOpponentPlayer().heal(1e3,s.action.entity),!0),settle:async()=>!0},be]};i.push(r);const n={name:"æ‰‹æœ­æŠ¹æ®º",actions:[{title:"ç™ºå‹•",playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:s=>{if(!(s.activator.getDeckCell().cardEntities.length<s.activator.getHandCell().cardEntities.filter(c=>c.seq!==s.action.entity.seq).length)&&s.action.entity.field.getAllCells().filter(c=>c.cellType==="Hand").flatMap(c=>c.cardEntities).filter(c=>c.seq!==s.action.entity.seq).length!==0)return ke(s)},prepare:(s,c,u)=>Pe(s,c,u,!1,["SearchFromDeck"],[],void 0),execute:async s=>{const c=s.activator.getHandCell().cardEntities.length,u=s.activator.getOpponentPlayer().getHandCell().cardEntities.length;return await ye.sendManyToGraveyardForTheSameReason(s.action.entity.field.getCells("Hand").flatMap(l=>l.cardEntities),["Effect","Discard"],s.action.entity,s.activator),s.activator.duel.clock.incrementProcSeq(),await s.action.entity.field.drawAtSameTime(s.activator,c,s.activator.getOpponentPlayer(),u,s.action.entity,s.activator),!0},settle:async()=>!0},be]};return i.push(n),i},vc=()=>{const i=[];return[{name:"ã‚¸ã‚§ãƒ ãƒŠã‚¤ãƒˆãƒ»ãƒ‘ãƒ¼ãƒ«",qty:2},{name:"è¦šé†’ã®å‹‡å£« ã‚¬ã‚¬ã‚®ã‚´",qty:3}].forEach(e=>i.push({name:e.name,actions:[He,$e,Do(e.qty,e.qty)],canBeSummoned:gi})),i},fc=()=>{const i=[];return i.push({name:"ï¼¢ï¼¦ï¼ç–¾é¢¨ã®ã‚²ã‚¤ãƒ«",actions:[Ye,He,$e,{title:"â‘ ç‰¹æ®Šå¬å–š",playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(e.activator.getMonstersOnField().filter(a=>(a.status.nameTags??[]).includes("ï¼¢ï¼¦")).filter(a=>a.nm!==e.action.entity.origin.name).length)return $a(e,["Attack","Defense"],[])},prepare:(e,t,a,r)=>ja(e,t,["Attack","Defense"],[],r),execute:Ua,settle:async()=>!0},{title:"â‘¡æ”»å®ˆåŠæ¸›",playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,isOnlyNTimesPerTurnIfFaceup:1,validate:e=>{const t=e.activator.getOpponentPlayer().getMonstersOnField().filter(a=>a.face==="FaceUp").filter(a=>a.canBeTargetOfEffect(e.activator,e.action.entity,e.action));if(t.length)return t.length?t:void 0},prepare:async(e,t,a,r)=>{let n=t==null?void 0:t.cardEntities[0];if(!n){const s=e.activator.getOpponentPlayer().getMonstersOnField().filter(u=>u.face==="FaceUp").filter(u=>u.canBeTargetOfEffect(e.activator,e.action.entity,e.action)),c=await e.action.entity.duel.view.waitSelectEntities(e.activator,s,1,u=>u.length===1,"åŠ¹æžœå¯¾è±¡ã‚’é¸æŠžã€‚",r);if(!c||!c.length)return;n=c[0]}return{selectedEntities:[n],chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.selectedEntities.filter(a=>a.isOnFieldAsMonster).filter(a=>a.face==="FaceUp").find(a=>a.canBeEffected(e.activator,e.action.entity,e.action));if(t)return["attack","defense"].map(a=>dt.createLingeringFixation("â‘¡æ”»å®ˆåŠæ¸›",()=>!0,e.action.entity,e.action,a,(r,n,s)=>Math.round(s/2))).forEach(a=>t.numericOprsBundle.push(a)),!0},settle:async()=>!0}]}),i},pc=()=>{const i=[...$o(),...Wo(),...ec(),...Vo(),...Io(),...sc(),...tc(),...ic(),...ac(),...rc(),...nc(),...oc(),...fc(),...dc(),...cc(),...uc(),...vc()],e=i.map(a=>a.name);console.info(e);const t=Object.values(Object.groupBy(e,a=>a)).filter(a=>((a==null?void 0:a.length)??2)>1).map(a=>a==null?void 0:a[0]);if(t.length>0)throw new Se("ã‚«ãƒ¼ãƒ‰å®šç¾©é‡è¤‡",...t);return i},Hn=new Map;pc().forEach(i=>{Hn.set(i.name,i)});const Ya=Hn,hc=Kn,Ie=Object.values(hc).reduce((i,e)=>(i[e.name]=e,i),{}),$n=[{id:-1,name:"ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒƒã‚­ï¼‘",description:"",cardNames:["ã‚¢ãƒ³ãƒŽã‚¦ãƒ³ãƒ»ã‚·ãƒ³ã‚¯ãƒ­ãƒ³","å…­æ­¦è¡†ã®ã”éš å±…","ã‚¸ãƒ£ãƒ³ã‚¯ãƒ»ãƒ•ã‚©ã‚¢ãƒ¼ãƒ‰","ã‚¸ãƒ£ãƒ³ã‚¯ãƒ»ãƒ•ã‚©ã‚¢ãƒ¼ãƒ‰","ã‚¸ãƒ£ãƒ³ã‚¯ãƒ»ãƒ•ã‚©ã‚¢ãƒ¼ãƒ‰","ãƒãƒ¥ãƒ¼ãƒ³ãƒ»ã‚¦ã‚©ãƒªã‚¢ãƒ¼","ãƒãƒ¥ãƒ¼ãƒ³ãƒ»ã‚¦ã‚©ãƒªã‚¢ãƒ¼","ã‚¬ãƒ¼ãƒ‰ãƒ»ã‚ªãƒ–ãƒ»ãƒ•ãƒ¬ãƒ ãƒ™ãƒ«","ã‚¬ãƒ¼ãƒ‰ãƒ»ã‚ªãƒ–ãƒ»ãƒ•ãƒ¬ãƒ ãƒ™ãƒ«","å®ˆè­·ç«œãƒ¦ã‚¹ãƒ†ã‚£ã‚¢","å®ˆè­·ç«œãƒ¦ã‚¹ãƒ†ã‚£ã‚¢","ã‚¨ãƒ³ã‚¸ã‚§ãƒ«ãƒ»ãƒˆãƒ©ãƒ³ãƒšãƒƒã‚¿ãƒ¼","ã‚¨ãƒ³ã‚¸ã‚§ãƒ«ãƒ»ãƒˆãƒ©ãƒ³ãƒšãƒƒã‚¿ãƒ¼","ã‚¸ã‚§ãƒ ãƒŠã‚¤ãƒˆãƒ»ã‚µãƒ•ã‚£ã‚¢","ã‚¸ã‚§ãƒ ãƒŠã‚¤ãƒˆãƒ»ã‚µãƒ•ã‚£ã‚¢","é­‚è™Ž","é­‚è™Ž","æš—é»’ç•Œã®ç•ªå…µ ãƒ¬ãƒ³ã‚¸","æš—é»’ç•Œã®ç•ªå…µ ãƒ¬ãƒ³ã‚¸","ãƒãƒˆãƒ«ãƒ•ãƒƒãƒˆãƒœãƒ¼ãƒ©ãƒ¼","ãƒãƒˆãƒ«ãƒ•ãƒƒãƒˆãƒœãƒ¼ãƒ©ãƒ¼","çƒé¨Žå£«ã®ä¸‰äººå¨˜","çƒé¨Žå£«ã®ä¸‰äººå¨˜","ã‚¨ãƒ³ã‚¸ã‚§ãƒ«ãƒ»ãƒˆãƒ©ãƒ³ãƒšãƒƒã‚¿ãƒ¼","ã‚¨ãƒ³ã‚¸ã‚§ãƒ«ãƒ»ãƒˆãƒ©ãƒ³ãƒšãƒƒã‚¿ãƒ¼","ï¼§æˆ¦éšŠ ã‚·ãƒ£ã‚¤ãƒ³ãƒ–ãƒ©ãƒƒã‚¯","ï¼§æˆ¦éšŠ ã‚·ãƒ£ã‚¤ãƒ³ãƒ–ãƒ©ãƒƒã‚¯","ã—ã‚ƒã‚Šã®è»è²«","ã—ã‚ƒã‚Šã®è»è²«","ã‚¸ãƒ§ãƒ³ã‚°ãƒ«ã‚°ãƒ¼ãƒ«ã®å¹»è¡“å¸«","ã‚¸ãƒ§ãƒ³ã‚°ãƒ«ã‚°ãƒ¼ãƒ«ã®å¹»è¡“å¸«","ã‚¾ãƒ³ãƒ“ãƒ¼ãƒŽ","ã‚¾ãƒ³ãƒ“ãƒ¼ãƒŽ","ãƒ¡ã‚¬ãƒ­ã‚¹ãƒžãƒƒã‚·ãƒ£ãƒ¼ï¼¸","ãƒ¡ã‚¬ãƒ­ã‚¹ãƒžãƒƒã‚·ãƒ£ãƒ¼ï¼¸","ãƒ©ã‚¤ãƒ‰ãƒ­ãƒ³","ãƒ©ã‚¤ãƒ‰ãƒ­ãƒ³","æ©Ÿç•Œé¨Žå£«ã‚¢ãƒ´ãƒ©ãƒ ","æ©Ÿç•Œé¨Žå£«ã‚¢ãƒ´ãƒ©ãƒ ","å¹»ã®ã‚°ãƒªãƒ•ã‚©ãƒ³","å¹»ã®ã‚°ãƒªãƒ•ã‚©ãƒ³","å¹»æ®»ç«œ","å¹»æ®»ç«œ","ã‚¢ãƒ¬ã‚­ã‚µãƒ³ãƒ‰ãƒ©ã‚¤ãƒ‰ãƒ©ã‚´ãƒ³","ã‚¢ãƒ¬ã‚­ã‚µãƒ³ãƒ‰ãƒ©ã‚¤ãƒ‰ãƒ©ã‚´ãƒ³","ã‚¸ã‚§ãƒãƒ†ã‚£ãƒƒã‚¯ãƒ»ãƒ¯ãƒ¼ã‚¦ãƒ«ãƒ•","ã‚¸ã‚§ãƒãƒ†ã‚£ãƒƒã‚¯ãƒ»ãƒ¯ãƒ¼ã‚¦ãƒ«ãƒ•","ã‚µã‚¤ãƒãƒ¼ãƒ»ãƒ‰ãƒ©ã‚´ãƒ³","ãƒ•ãƒ­ã‚¹ãƒˆã‚¶ã‚¦ãƒ«ã‚¹","ãƒ•ãƒ­ã‚¹ãƒˆã‚¶ã‚¦ãƒ«ã‚¹","ãƒ•ãƒ­ã‚¹ãƒˆã‚¶ã‚¦ãƒ«ã‚¹","é’çœ¼ã®ç™½é¾","ãƒžã‚¸ã‚«ãƒ«ãƒ»ã‚¢ãƒ³ãƒ‰ãƒ­ã‚¤ãƒ‰","ãƒžã‚¸ã‚«ãƒ«ãƒ»ã‚¢ãƒ³ãƒ‰ãƒ­ã‚¤ãƒ‰","ãƒžã‚¸ã‚«ãƒ«ãƒ»ã‚¢ãƒ³ãƒ‰ãƒ­ã‚¤ãƒ‰","å¤§åœ°ã®é¨Žå£«ã‚¬ã‚¤ã‚¢ãƒŠã‚¤ãƒˆ","å¤§åœ°ã®é¨Žå£«ã‚¬ã‚¤ã‚¢ãƒŠã‚¤ãƒˆ","å¤§åœ°ã®é¨Žå£«ã‚¬ã‚¤ã‚¢ãƒŠã‚¤ãƒˆ","ã‚¹ã‚¯ãƒ©ãƒƒãƒ—ãƒ»ãƒ‡ã‚¹ãƒ‡ãƒ¼ãƒ¢ãƒ³","ã‚¹ã‚¯ãƒ©ãƒƒãƒ—ãƒ»ãƒ‡ã‚¹ãƒ‡ãƒ¼ãƒ¢ãƒ³","ã‚¹ã‚¯ãƒ©ãƒƒãƒ—ãƒ»ãƒ‡ã‚¹ãƒ‡ãƒ¼ãƒ¢ãƒ³","ã‚¹ã‚¿ãƒ¼ãƒ€ã‚¹ãƒˆãƒ»ãƒ‰ãƒ©ã‚´ãƒ³","ã‚¹ã‚¿ãƒ¼ãƒ€ã‚¹ãƒˆãƒ»ãƒ‰ãƒ©ã‚´ãƒ³","ã‚¹ã‚¿ãƒ¼ãƒ€ã‚¹ãƒˆãƒ»ãƒ‰ãƒ©ã‚´ãƒ³","ãƒŠãƒãƒ¥ãƒ«ãƒ»ã‚¬ã‚ªãƒ‰ãƒ¬ã‚¤ã‚¯","ãƒŠãƒãƒ¥ãƒ«ãƒ»ã‚¬ã‚ªãƒ‰ãƒ¬ã‚¤ã‚¯","ãƒŠãƒãƒ¥ãƒ«ãƒ»ã‚¬ã‚ªãƒ‰ãƒ¬ã‚¤ã‚¯"]},{id:-2,name:"ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒƒã‚­ï¼’",description:"",cardNames:["ã‚¢ãƒ³ãƒŽã‚¦ãƒ³ãƒ»ã‚·ãƒ³ã‚¯ãƒ­ãƒ³","å…­æ­¦è¡†ã®ã”éš å±…","ã‚¸ãƒ£ãƒ³ã‚¯ãƒ»ãƒ•ã‚©ã‚¢ãƒ¼ãƒ‰","ã‚°ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—ãƒ»ãƒãƒ«ãƒ–","ã‚¬ãƒ¼ãƒ‰ãƒ»ã‚ªãƒ–ãƒ»ãƒ•ãƒ¬ãƒ ãƒ™ãƒ«","ä¼èª¬ã®ç™½çŸ³","ä¼èª¬ã®ç™½çŸ³","ä¼èª¬ã®ç™½çŸ³","å®ˆè­·ç«œãƒ¦ã‚¹ãƒ†ã‚£ã‚¢","ã‚®ãƒ£ãƒ©ã‚¯ã‚·ãƒ¼ã‚µãƒ¼ãƒšãƒ³ãƒˆ","ã‚¸ã‚§ãƒã‚¯ã‚¹ãƒ»ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼","ï¼¥ãƒ»ï¼¨ï¼¥ï¼²ï¼¯ ãƒ•ã‚§ã‚¶ãƒ¼ãƒžãƒ³","ï¼¥ãƒ»ï¼¨ï¼¥ï¼²ï¼¯ ãƒãƒ¼ã‚¹ãƒˆãƒ¬ãƒ‡ã‚£","ãƒãƒ¥ãƒ¼ãƒ³ãƒ»ã‚¦ã‚©ãƒªã‚¢ãƒ¼","ï¼¥ãƒ»ï¼¨ï¼¥ï¼²ï¼¯ ã‚¯ãƒ¬ã‚¤ãƒžãƒ³","ï¼¥ãƒ»ï¼¨ï¼¥ï¼²ï¼¯ ã‚¹ãƒ‘ãƒ¼ã‚¯ãƒžãƒ³","ã—ã‚ƒã‚Šã®è»è²«","ã‚¸ãƒ§ãƒ³ã‚°ãƒ«ã‚°ãƒ¼ãƒ«ã®å¹»è¡“å¸«","ã‚¾ãƒ³ãƒ“ãƒ¼ãƒŽ","ã‚¸ã‚§ãƒãƒ†ã‚£ãƒƒã‚¯ãƒ»ãƒ¯ãƒ¼ã‚¦ãƒ«ãƒ•","ãƒ©ã‚¤ãƒˆãƒ­ãƒ¼ãƒ‰ãƒ»ãƒ“ãƒ¼ã‚¹ãƒˆ ã‚¦ã‚©ãƒ«ãƒ•","ã‚µã‚¤ãƒãƒ¼ãƒ»ãƒ‰ãƒ©ã‚´ãƒ³","ã‚µã‚¤ãƒãƒ¼ãƒ»ãƒ‰ãƒ©ã‚´ãƒ³","ã‚µã‚¤ãƒãƒ¼ãƒ»ãƒ‰ãƒ©ã‚´ãƒ³","ãƒ©ãƒ–ãƒ©ãƒ‰ãƒ©ã‚¤ãƒ‰ãƒ©ã‚´ãƒ³","ï¼¤ï¼ï¼¨ï¼¥ï¼²ï¼¯ ãƒ‡ã‚£ã‚¢ãƒœãƒªãƒƒã‚¯ã‚¬ã‚¤","ï¼¤ï¼ï¼¨ï¼¥ï¼²ï¼¯ ãƒ‡ã‚£ã‚¢ãƒœãƒªãƒƒã‚¯ã‚¬ã‚¤","ï¼¤ï¼ï¼¨ï¼¥ï¼²ï¼¯ ãƒ‡ã‚£ã‚¢ãƒœãƒªãƒƒã‚¯ã‚¬ã‚¤","ãƒ•ãƒ­ã‚¹ãƒˆã‚¶ã‚¦ãƒ«ã‚¹","ï¼¥ãƒ»ï¼¨ï¼¥ï¼²ï¼¯ ãƒã‚ªã‚¹","é’çœ¼ã®ç™½é¾","é’çœ¼ã®ç™½é¾","é’çœ¼ã®ç™½é¾","ï¼¥ï¼ã‚¨ãƒžãƒ¼ã‚¸ã‚§ãƒ³ã‚·ãƒ¼ã‚³ãƒ¼ãƒ«","ãŠã‚ã‹ãªåŸ‹è‘¬","ãƒˆãƒ¬ãƒ¼ãƒ‰ãƒ»ã‚¤ãƒ³","ãƒˆãƒ¬ãƒ¼ãƒ‰ãƒ»ã‚¤ãƒ³","ãƒˆãƒ¬ãƒ¼ãƒ‰ãƒ»ã‚¤ãƒ³","é—‡ã®é‡ç”£å·¥å ´","å¼·æ¬²ãªå£º","å¼·æ¬²ãªå£º","å¼·æ¬²ãªå£º","æ­»è€…è˜‡ç”Ÿ","æ­»è€…è˜‡ç”Ÿ","æ­»è€…è˜‡ç”Ÿ","å¬å–šå¸«ã®ã‚¹ã‚­ãƒ«","å¬å–šå¸«ã®ã‚¹ã‚­ãƒ«","å¬å–šå¸«ã®ã‚¹ã‚­ãƒ«","æˆé‡‘ã‚´ãƒ–ãƒªãƒ³","æˆé‡‘ã‚´ãƒ–ãƒªãƒ³","æˆé‡‘ã‚´ãƒ–ãƒªãƒ³","æˆ¦å£«ã®ç”Ÿé‚„","å¢—æ´","èª¿å’Œã®å®æœ­","èª¿å’Œã®å®æœ­","èª¿å’Œã®å®æœ­","å¤©ä½¿ã®æ–½ã—","å¤©ä½¿ã®æ–½ã—","å¤©ä½¿ã®æ–½ã—","è²ªæ¬²ãªå£º","è²ªæ¬²ãªå£º","è²ªæ¬²ãªå£º","ãƒžã‚¸ã‚«ãƒ«ãƒ»ã‚¢ãƒ³ãƒ‰ãƒ­ã‚¤ãƒ‰","ãƒžã‚¸ã‚«ãƒ«ãƒ»ã‚¢ãƒ³ãƒ‰ãƒ­ã‚¤ãƒ‰","ãƒžã‚¸ã‚«ãƒ«ãƒ»ã‚¢ãƒ³ãƒ‰ãƒ­ã‚¤ãƒ‰","å¤§åœ°ã®é¨Žå£«ã‚¬ã‚¤ã‚¢ãƒŠã‚¤ãƒˆ","å¤§åœ°ã®é¨Žå£«ã‚¬ã‚¤ã‚¢ãƒŠã‚¤ãƒˆ","å¤§åœ°ã®é¨Žå£«ã‚¬ã‚¤ã‚¢ãƒŠã‚¤ãƒˆ","ã‚¹ã‚¯ãƒ©ãƒƒãƒ—ãƒ»ãƒ‡ã‚¹ãƒ‡ãƒ¼ãƒ¢ãƒ³","ã‚¹ã‚¯ãƒ©ãƒƒãƒ—ãƒ»ãƒ‡ã‚¹ãƒ‡ãƒ¼ãƒ¢ãƒ³","ã‚¹ã‚¯ãƒ©ãƒƒãƒ—ãƒ»ãƒ‡ã‚¹ãƒ‡ãƒ¼ãƒ¢ãƒ³","ã‚¹ã‚¿ãƒ¼ãƒ€ã‚¹ãƒˆãƒ»ãƒ‰ãƒ©ã‚´ãƒ³","ã‚¹ã‚¿ãƒ¼ãƒ€ã‚¹ãƒˆãƒ»ãƒ‰ãƒ©ã‚´ãƒ³","ã‚¹ã‚¿ãƒ¼ãƒ€ã‚¹ãƒˆãƒ»ãƒ‰ãƒ©ã‚´ãƒ³","ãƒŠãƒãƒ¥ãƒ«ãƒ»ã‚¬ã‚ªãƒ‰ãƒ¬ã‚¤ã‚¯","ãƒŠãƒãƒ¥ãƒ«ãƒ»ã‚¬ã‚ªãƒ‰ãƒ¬ã‚¤ã‚¯","ãƒŠãƒãƒ¥ãƒ«ãƒ»ã‚¬ã‚ªãƒ‰ãƒ¬ã‚¤ã‚¯"]}],pe=class pe{constructor(e,t){d(this,"id");d(this,"name");d(this,"description");d(this,"lastUsedAt");d(this,"cardNames");d(this,"getIllegalCardNames",()=>Array.from(new Set(this.cardNames.filter(e=>!Object.keys(Ie).includes(e)))));d(this,"getDisableCardNames",()=>Array.from(new Set(this.cardNames.filter(e=>!Object.keys(Ie).includes(e)))));d(this,"createCardInfos",()=>{const e=this.getIllegalCardNames();if(e.length>0)throw new Error(`å­˜åœ¨ã—ãªã„ã‚«ãƒ¼ãƒ‰åã‹ã‚‰ãƒ‡ãƒƒã‚­ã‚’ç”Ÿæˆã—ã‚ˆã†ã¨ã—ãŸã€‚${e}`);return this.cardNames.map(t=>Ie==null?void 0:Ie[t]).filter(t=>t)});d(this,"copy",async()=>pe.createNewDeck(this.name,this.description,this.cardNames));d(this,"updateTimestamp",async()=>{await pe.tblHeader.update(this.id,e=>({...e,lastUsedAt:new Date}))});d(this,"saveDeckInfo",async e=>{const t=e??this;await pe.tblHeader.update(this.id,n=>({...n,name:t.name,description:t.description,lastUsedAt:new Date}));const a=(await pe.tblDetail.getAll()).filter(n=>n.deckId===this.id);await pe.tblDetail.delete(a.map(n=>n.id));const r=await pe.tblDetail.insertMany(t.cardNames.map((n,s)=>({deckId:this.id,seq:s,name:n,description:""})));return new pe(await pe.tblHeader.get(this.id),r)});d(this,"delete",async()=>{await pe.tblHeader.delete([this.id]);const e=(await pe.tblDetail.getAll()).filter(t=>t.deckId===this.id);await pe.tblDetail.delete(e.map(t=>t.id))});this.id=e.id,this.name=e.name,this.description=e.description,this.lastUsedAt=e.lastUsedAt,this.cardNames=t.filter(a=>a.deckId===this.id).map(a=>a.name)}};d(pe,"toJson",e=>{const t=e.map(a=>{const{id:r,name:n,description:s,lastUsedAt:c,cardNames:u}=a;return{id:r,name:n,description:s,lastUsedAt:c,cardNames:u}});return t.forEach(a=>{a.cardNames=a.cardNames.map(r=>Ie[r]).sort(Si).map(r=>r.name)}),JSON.stringify(t,null,2)}),d(pe,"convertToObjectURL",e=>{const t=pe.toJson(e),a=new Blob([t],{type:"text/plain"});return window.URL.createObjectURL(a)}),d(pe,"idb"),d(pe,"tblHeader"),d(pe,"tblDetail"),d(pe,"getAllDeckInfo",async e=>{if(e&&(pe.idb=e),!pe.idb)throw new Error("illegal argument: idb is undefined.");pe.tblHeader||(pe.tblHeader=new gc(pe.idb)),pe.tblDetail||(pe.tblDetail=new yc(pe.idb));const t=await pe.tblHeader.getAll(),a=await pe.tblDetail.getAll();return t.length?t.map(r=>new pe(r,a)):[await pe.prepareSampleDeck()]}),d(pe,"createNewDeck",async(e,t,a)=>{const r=await pe.tblHeader.insert({name:e,description:t,lastUsedAt:new Date}),n=await pe.tblDetail.insertMany(a.map((s,c)=>({deckId:r.id,seq:c,name:s,description:""})));return new pe(r,n)}),d(pe,"prepareSampleDeck",async()=>{const e=$n.slice(-1)[0];return await pe.createNewDeck(e.name,e.description,e.cardNames)});let ht=pe;class gc extends sr{constructor(t){super(t,"TblDeckHeader");d(this,"_prepareInitialRecords",()=>[])}}class yc extends sr{constructor(t){super(t,"TblDeckDetail");d(this,"_prepareInitialRecords",()=>[])}}const Lr=$n.map(i=>({...i,lastUsedAt:new Date})).filter(i=>i.id<0);function _c(i){const e=i-1;return e*e*e+1}function Rr(i,e){for(const t in e)i[t]=e[t];return i}function mc({fallback:i,...e}){const t=new Map,a=new Map;function r(s,c,u){const{delay:l=0,duration:o=P=>Math.sqrt(P)*30,easing:f=_c}=Rr(Rr({},e),u),p=s.getBoundingClientRect(),h=c.getBoundingClientRect(),y=p.left-h.left,w=p.top-h.top,_=p.width/h.width,S=p.height/h.height,E=Math.sqrt(y*y+w*w),T=getComputedStyle(c),N=T.transform==="none"?"":T.transform,$=+T.opacity;return{delay:l,duration:typeof o=="function"?o(E):o,easing:f,css:(P,G)=>`
			   opacity: ${P*$};
			   transform-origin: top left;
			   transform: ${N} translate(${G*y}px,${G*w}px) scale(${P+(1-P)*_}, ${P+(1-P)*S});
		   `}}function n(s,c,u){return(l,o)=>(s.set(o.key,l),()=>{if(c.has(o.key)){const f=c.get(o.key);return c.delete(o.key),r(f,l,o)}return s.delete(o.key),i&&i(l,o,u)})}return[n(a,t,!1),n(t,a,!0)]}var Sc=C("<div></div>"),bc=C('<div class="duel_card_row svelte-1vsjnqs"><div> </div> <div> </div></div>'),wc=C('<div class="duel_card_row svelte-1vsjnqs"><div class="svelte-1vsjnqs"></div> <div class="svelte-1vsjnqs"> </div></div>'),Cc=C('<div class="duel_card_row svelte-1vsjnqs"><div class="svelte-1vsjnqs"></div> <div class="svelte-1vsjnqs"> </div></div>'),Tc=C('<div class="duel_card_row svelte-1vsjnqs"><div> </div> <div> </div></div>'),kc=C('<div class="duel_card_row duel_card_detail svelte-1vsjnqs"><div class="svelte-1vsjnqs"> </div></div> <div class="duel_card_row duel_card_detail svelte-1vsjnqs"><div class="svelte-1vsjnqs"></div> <div class="svelte-1vsjnqs"><span> </span> / <span> </span></div></div>',1),Dc=C('<button><div class="duel_card duel_card_visible svelte-1vsjnqs"><div class="duel_card_row svelte-1vsjnqs" style="position:relative"><div class="svelte-1vsjnqs"> </div> <div class="svelte-1vsjnqs"></div> <!></div> <!> <!> <!></div></button>'),Ec=C('<button><div class="svelte-1vsjnqs">è£å®ˆå‚™</div></button>'),Ac=C('<div class="duel_card duel_card_face_down svelte-1vsjnqs"><div class="svelte-1vsjnqs">ã‚»ãƒƒãƒˆ</div></div>');function wt(i,e){We(e,!1);let t=Ee(e,"entity",8),a=Ee(e,"state",8,"Disabled"),r=Ee(e,"selectedList",28,()=>[]),n=Ee(e,"isVisibleForcibly",8,!1),s=Ee(e,"isWideMode",8,!1),c=Ee(e,"actions",24,()=>[]),u=Ee(e,"cardActionResolve",8),l=Ee(e,"entitySelectResolve",8,()=>{}),o,f=Oe(!1),p=()=>{},h=Ee(e,"qty",12,void 0);const y=V=>{o=V.activator,te(f,!1),h(V.qty),p=V.resolve};t().field.duel.view.onWaitStart.append(y);let w=Oe(!1);const _=()=>{if(a()!=="Disabled"&&a()==="Selectable"&&h()===1){if(r().some(V=>V.seq!==t().seq)){r([t()]);return}h()===1&&l()&&l()([t()])}},S=V=>{(t().face==="FaceUp"||t().owner===t().field.duel.duelists.Below&&(t().isUnderControl||n()))&&t().field.duel.view.showCardInfo(t(),V??"Normal")},E=()=>{if(S(),a()==="Disabled")return;if(a()==="Selectable"){te(f,!v(f)),h()===1&&(r().splice(0),t().duel.view.requireUpdate()),r(v(f)?[...r(),t()]:r().filter(I=>I!==t()));return}if(c().length===0)return;if(c().length===1){if(c()[0].dragAndDropOnly)return;if(u()){u()(c()[0]);return}p({action:c()[0]});return}if(!o)return;const V=t().field.duel.view;V.modalController.selectAction(V,{title:"è¡Œå‹•ã‚’é¸æŠžã€‚",activator:o,actions:c(),cancelable:!0}).then(I=>{p({action:I})})},T=V=>{console.info("drag start",V,c()),t().field.duel.view.setDraggingActions(c()),te(w,!0)},N=V=>{console.info("drag end",V,c()),t().field.duel.view.removeDraggingActions(),V.dataTransfer&&te(w,!1)},$=()=>(S("Debug"),!1);it();var P=Fe(),G=re(P);{var A=V=>{var I=Dc(),we=g(I),Ue=g(we),ie=g(Ue),M=g(ie),k=m(ie,4);ve(k,1,()=>t().attr,ue,(L,R)=>{var z=Sc();x(()=>_e(z,`monster_attr ${v(R)??""} svelte-1vsjnqs`)),b(L,z)});var H=m(Ue,2);{var Q=L=>{var R=bc(),z=g(R),ee=g(z),Y=m(z,2),Z=g(Y);x((J,X)=>{_e(z,It(t().lvl!==t().origin.level?"different_from_its_origin":""),"svelte-1vsjnqs"),D(ee,J),_e(Y,It(t().rank!==t().origin.rank?"different_from_its_origin":""),"svelte-1vsjnqs"),D(Z,X)},[()=>"â˜…".repeat(t().lvl||0),()=>"â˜†".repeat(t().rank||0)],me),b(L,R)},ce=L=>{var R=Fe(),z=re(R);{var ee=Z=>{var J=wc(),X=m(g(J),2),B=g(X);x(()=>D(B,`${Fi[t().status.spellCategory]??""}é­”æ³•`)),b(Z,J)},Y=Z=>{var J=Fe(),X=re(J);{var B=W=>{var ge=Cc(),ne=m(g(ge),2),se=g(ne);x(()=>D(se,`${Bi[t().status.trapCategory]??""}ç½ `)),b(W,ge)};j(X,W=>{t().status.kind==="Trap"&&t().status.trapCategory&&W(B)},!0)}b(Z,J)};j(z,Z=>{t().status.kind==="Spell"&&t().status.spellCategory?Z(ee):Z(Y,!1)},!0)}b(L,R)};j(H,L=>{t().status.kind==="Monster"?L(Q):L(ce,!1)})}var de=m(H,2);{var q=L=>{var R=Tc(),z=g(R),ee=g(z),Y=m(z,2),Z=g(Y);x(()=>{_e(z,It(t().psL!==t().origin.pendulumScaleL?"different_from_its_origin":""),"svelte-1vsjnqs"),D(ee,`â—€ ${t().psL??""}`),_e(Y,It(t().psR!==t().origin.pendulumScaleR?"different_from_its_origin":""),"svelte-1vsjnqs"),D(Z,`${t().psR??""} â–¶`)}),b(L,R)};j(de,L=>{var R;(R=t().status.monsterCategories)!=null&&R.includes("Pendulum")&&L(q)})}var U=m(de,2);{var K=L=>{var R=kc(),z=re(R),ee=g(z),Y=g(ee),Z=m(z,2),J=m(g(Z),2),X=g(J),B=g(X),W=m(X,2),ge=g(W);x((ne,se)=>{D(Y,`${ne??""}
            ${se??""}`),_e(X,It(t().atk!==t().origin.attack?"different_from_its_origin":""),"svelte-1vsjnqs"),D(B,t().atk??"?"),_e(W,It(t().def!==t().origin.defense?"different_from_its_origin":""),"svelte-1vsjnqs"),D(ge,t().def??"?")},[()=>t().types.map(ne=>Oi[ne]+(s()?va[ne]:"")).join(),()=>{var ne;return(ne=t().status.monsterCategories)==null?void 0:ne.map(se=>Mi[se]+(s()?ua[se]:"")).join()}],me),b(L,R)};j(U,L=>{t().status.kind==="Monster"&&L(K)})}x(L=>{_e(I,`duel_card button_style_reset ${t().status.kind??""} ${L??""} ${(v(f)?"duel_card_selected":"")??""} ${a()??""} duel_card_${t().orientation??""} ${(v(w)?"isDragging":"")??""} ${(s()?"duel_card_wide":"")??""} duel_card_${t().face??""} ${(t().isOnField?"duel_card_is_on_field":"")??""} svelte-1vsjnqs`),Et(I,"draggable",a()==="Draggable"),Et(I,"title",t().nm),D(M,t().nm)},[()=>{var L;return((L=t().status.monsterCategories)==null?void 0:L.join(" "))||""}],me),Le("dragstart",I,T),Le("dragend",I,N),Le("click",I,E),Le("dblclick",I,_),Le("mouseenter",I,()=>S()),Le("contextmenu",I,$),b(V,I)},fe=V=>{var I=Fe(),we=re(I);{var Ue=M=>{var k=Ec();x(()=>_e(k,`duel_card duel_card_face_down duel_card_face_down_defense ${a()??""}  ${(v(f)?"duel_card_selected":"")??""} svelte-1vsjnqs`)),Le("click",k,E),Le("dblclick",k,_),b(M,k)},ie=M=>{var k=Ac();b(M,k)};j(we,M=>{t().battlePosition==="Set"?M(Ue):M(ie,!1)},!0)}b(V,I)};j(G,V=>{t().face==="FaceUp"||n()||t().controller.duelistType==="Player"&&t().isUnderControl?V(A):V(fe,!1)})}b(i,P),Ke()}var xc=C('<div class="phase_display svelte-1mupj1p"><span class="svelte-1mupj1p"> </span> </div>'),Pc=C('<div class="lifepoint_display svelte-1mupj1p"><div class="svelte-1mupj1p"> </div> <div class="svelte-1mupj1p"> </div></div>'),Mc=(i,e,t)=>e(v(t)),Fc=C('<div class="svelte-1mupj1p"><button class="phase_button svelte-1mupj1p"> </button></div>'),Bc=C("<div><!></div>"),Oc=C('<div class="svelte-1mupj1p"><!></div>'),Nc=C("<div><!></div>"),qc=C("<!> <!> <!>",1),Lc=C('<div style="position: absolute;" class="card_animation_receiver svelte-1mupj1p"><!></div>'),Rc=C('<div style="position: absolute; display:flex;justify-content: center;" class="svelte-1mupj1p"><!></div>'),Hc=C(" <!> ã€‘",1),$c=C('<div style="position: absolute; bottom:0rem" class="svelte-1mupj1p"> <!></div>'),jc=C("<!> <!>",1),Uc=C('<div class="badge svelte-1mupj1p"> </div>'),Zc=C('<div class="card_animation_receiver svelte-1mupj1p"><!></div>'),Gc=C("<!> <!> <!> <!>",1),zc=C('<td><div role="listitem"><!></div></td>');function Vc(i,e){We(e,!1);let t=Ee(e,"view",8),a=Ee(e,"row",8),r=Ee(e,"column",8),n=Ee(e,"selectedList",28,()=>[]),s=Oe(t().getCell(a(),r()));const c=()=>{te(s,t().getCell(a(),r()))};v(s).onUpdate.append(c),t().onDuelUpdate.append(c),t().modalController.onUpdate.append(c);let u,l=Oe([]),o=()=>{},f;const p=k=>{te(T,void 0),n().reset(),u=k.activator,o=k.resolve,te(l,k.enableActions),f=k.selectableEntities,k.entitiesValidator};t().onWaitStart.append(p);let h,y=Oe(!1);const w=k=>{h=k,te(y,k.some(H=>{var Q;return(Q=H.validate(t().duel.priorityHolder,t().duel.chainBlockInfos))==null?void 0:Q.includes(v(s))})||!1),c()},_=()=>{h=void 0,te(y,!1),c()};t().onDragStart.append(w),t().onDragEnd.append(_);const[S,E]=zd;let T=Oe(void 0);const N=k=>{if(u=void 0,v(s)===k.to||v(s).entities.includes(k.entity)){te(T,k);const H=k.resolve;te(s,v(s)),setTimeout(()=>{te(T,void 0),k.count++,k.count>1&&H()},600)}};t().onAnimation.append(N);const $=k=>{o({phaseChange:k})},P=()=>v(s).isStackCell&&v(s).entities.flatMap(k=>k.actions).filter(k=>v(l).map(H=>H.seq).some(H=>H===k.seq)).length>0,G=()=>{if(Re(s,v(s).field.duel.view.infoBoardState="Log"),v(s).isStackCell){Re(s,v(s).field.duel.view.infoBoardState="CellInfo"),Re(s,v(s).field.duel.view.infoBoardCell=v(s)),v(s).field.duel.view.requireUpdate();const k=v(s).entities.flatMap(H=>H.actions).filter(H=>v(l).map(Q=>Q.seq).some(Q=>Q===H.seq));if(k.length){if(!u)return;const H=v(s).field.duel.view;H.modalController.selectAction(H,{title:"ã‚«ãƒ¼ãƒ‰ã‚’é¸æŠžã€‚",activator:u,actions:k,cancelable:!0}).then(Q=>{o({action:Q})});return}}v(s).field.duel.view.requireUpdate(),console.info(v(s))},A=k=>{k.preventDefault(),k.dataTransfer&&(k.dataTransfer.dropEffect="move")},fe=k=>{k.preventDefault(),console.info("drop",k,v(y),h),k.dataTransfer&&(k.dataTransfer.dropEffect="move");try{if(v(y)&&h){if(console.info(h,v(s)),h.length===1){const H=h[0].getClone();H.cell=v(s),o({action:H})}else if(h.length>1){if(!u)throw new Se("æƒ³å®šã•ã‚Œãªã„çŠ¶æ…‹");v(s).field.duel.view.modalController.cancelAll(),v(s).field.duel.view.modalController.selectAction(v(s).field.duel.view,{title:"é¸æŠž",activator:u,actions:h,cancelable:!1})}}}finally{t().removeDraggingActions()}},V=(...k)=>{if(t().waitMode==="Animation")return"Disabled";if(f&&f.find(ce=>k.find(de=>ce===de)))return"Selectable";if(!v(l)||v(l).length===0||t().waitMode!=="SelectFieldAction"||Object.values(t().modalController.states).some(ce=>ce==="Shown"))return"Disabled";const H=v(l).filter(ce=>k.includes(ce.entity));if(H.length===0)return"Disabled";if(H.length>1||v(s).isStackCell||H[0].entity!==k[0])return"Clickable";const Q=H[0].validate(t().duel.priorityHolder,t().duel.chainBlockInfos);return Q&&Q.length>0?"Draggable":"Clickable"};it();var I=zc(),we=g(I);we.__click=G;var Ue=g(we);{var ie=k=>{var H=Fe(),Q=re(H);{var ce=de=>{var q=Fe(),U=re(q);{var K=R=>{var z=xc(),ee=g(z),Y=g(ee),Z=m(ee,1,!0);x((J,X)=>{D(Y,J),D(Z,X)},[()=>String(v(s).field.duel.clock.turn).padStart(2,"0"),()=>v(s).field.duel.phase.toUpperCase()],me),b(R,z)},L=R=>{var z=Fe(),ee=re(z);{var Y=J=>{var X=Pc(),B=g(X),W=g(B),ge=m(B,2),ne=g(ge);x(()=>{D(W,v(s).field.duel.duelists.Above.lp),D(ne,v(s).field.duel.duelists.Below.lp)}),b(J,X)},Z=J=>{var X=Fe(),B=re(X);{var W=ge=>{var ne=Fe(),se=re(ne);{var he=xe=>{var Ge=Fe(),O=re(Ge);{var F=le=>{var oe=Fe(),Te=re(oe);ve(Te,1,()=>t().duel.nextPhaseList,ue,(Ne,Ce)=>{var Me=Fc(),qe=g(Me);qe.__click=[Mc,$,Ce];var Be=g(qe);x(Ze=>D(Be,Ze),[()=>v(Ce).toUpperCase()],me),b(Ne,Me)}),b(le,oe)};j(O,le=>{t().duel.isEnded||le(F)})}b(xe,Ge)};j(se,xe=>{t().waitMode==="SelectFieldAction"&&xe(he)})}b(ge,ne)};j(B,ge=>{v(s).column===5&&ge(W)},!0)}b(J,X)};j(ee,J=>{v(s).column===3?J(Y):J(Z,!1)},!0)}b(R,z)};j(U,R=>{v(s).column===1?R(K):R(L,!1)})}b(de,q)};j(Q,de=>{v(s).row===3&&de(ce)})}b(k,H)},M=k=>{var H=Fe(),Q=re(H);{var ce=q=>{var U=qc(),K=re(U);{var L=Y=>{var Z=Bc(),J=g(Z);wt(J,{get entity(){return v(T).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),x(()=>_e(Z,`card_animation_receiver ${v(s).cellType??""} svelte-1mupj1p`)),ei(1,Z,()=>E,()=>({key:v(T).entity.seq})),b(Y,Z)};j(K,Y=>{v(T)&&v(T).entity&&v(T).to===v(s)&&v(T).index==="Top"&&Y(L)})}var R=m(K,2);ve(R,1,()=>v(s).visibleEntities,ue,(Y,Z)=>{var J=Fe(),X=re(J);{var B=W=>{var ge=Oc(),ne=g(ge);const se=me(()=>V(v(Z))),he=me(()=>v(l).filter(xe=>xe.entity===v(Z)));wt(ne,{get entity(){return v(Z)},get state(){return v(se)},get actions(){return v(he)},cardActionResolve:void 0,get selectedList(){return n()},set selectedList(xe){n(xe)},$$legacy:!0}),ei(2,ge,()=>S,()=>({key:v(Z).seq})),b(W,ge)};j(X,W=>{(!v(T)||v(T).entity.seq!==v(Z).seq)&&W(B)})}b(Y,J)});var z=m(R,2);{var ee=Y=>{var Z=Nc(),J=g(Z);wt(J,{get entity(){return v(T).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),x(()=>_e(Z,`card_animation_receiver ${v(s).cellType??""} svelte-1mupj1p`)),ei(1,Z,()=>E,()=>({key:v(T).entity.seq})),b(Y,Z)};j(z,Y=>{v(T)&&v(T).entity&&v(T).to===v(s)&&v(T).index!=="Top"&&Y(ee)})}b(q,U)},de=q=>{var U=Gc(),K=re(U);{var L=X=>{var B=Lc(),W=g(B);wt(W,{get entity(){return v(T).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),ei(1,B,()=>E,()=>({key:v(T).entity.seq})),b(X,B)};j(K,X=>{v(T)&&v(T).entity&&v(T).to===v(s)&&v(T).index!=="Top"&&X(L)})}var R=m(K,2);{var z=X=>{var B=jc(),W=re(B);ve(W,1,()=>v(s).visibleEntities.map((se,he)=>({index:he,entity:se})).toReversed(),ue,(se,he)=>{var xe=Fe(),Ge=re(xe);{var O=F=>{var le=Rc(),oe=g(le);const Te=me(()=>!v(s).isStackCell&&v(he).index===0?V(...v(s).visibleEntities):void 0),Ne=me(()=>v(he).index===0?v(l).filter(Ce=>v(s).visibleEntities.includes(Ce.entity)):void 0);wt(oe,{get entity(){return v(he).entity},get state(){return v(Te)},get actions(){return v(Ne)},cardActionResolve:void 0,get selectedList(){return n()},set selectedList(Ce){n(Ce)},$$legacy:!0}),ei(2,le,()=>S,()=>({key:v(he).entity.seq})),b(F,le)};j(Ge,F=>{(!v(T)||v(T).entity.seq!==v(he).entity.seq)&&F(O)})}b(se,xe)});var ge=m(W,2);{var ne=se=>{var he=$c(),xe=g(he),Ge=m(xe);ve(Ge,1,()=>Object.keys(v(s).visibleEntities[0].status.maxCounterQty),ue,(O,F)=>{var le=Hc(),oe=re(le),Te=m(oe);{var Ne=Ce=>{var Me=Zt();x(()=>D(Me,`/${v(s).visibleEntities[0].status.maxCounterQty[v(F)]??""}`)),b(Ce,Me)};j(Te,Ce=>{(v(s).visibleEntities[0].status.maxCounterQty[v(F)]??!1)&&Ce(Ne)})}x(Ce=>D(oe,`ã€
              ${ro[v(F)]??""}${Ce??""} `),[()=>v(s).visibleEntities[0].counterHolder.getQty(v(F))],me),b(O,le)}),x(()=>D(xe,`ã€${v(s).visibleEntities[0].battlePositionName??""}ã€‘ `)),b(se,he)};j(ge,se=>{v(s).visibleEntities[0].battlePosition&&se(ne)})}b(X,B)};j(R,X=>{v(s).visibleEntities.length>0&&X(z)})}var ee=m(R,2);{var Y=X=>{var B=Uc(),W=g(B);x(()=>D(W,v(s).visibleEntities.length)),b(X,B)};j(ee,X=>{v(s).isStackCell&&X(Y)})}var Z=m(ee,2);{var J=X=>{var B=Zc(),W=g(B);wt(W,{get entity(){return v(T).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),ei(1,B,()=>E,()=>({key:v(T).entity.seq})),b(X,B)};j(Z,X=>{v(T)&&v(T).entity&&v(T).to===v(s)&&v(T).index==="Top"&&X(J)})}b(q,U)};j(Q,q=>{v(s).cellType==="Hand"?q(ce):q(de,!1)},!0)}b(k,H)};j(Ue,k=>{v(s).isDisabledCell?k(ie):k(M,!1)})}x(k=>{_e(I,`${`duel_field_cell duel_field_cell_${v(s).cellType}`??""} svelte-1mupj1p`),Et(I,"colspan",v(s).cellType==="Hand"?7:1),_e(we,`${k??""} svelte-1mupj1p`)},[()=>`duel_card_wrapper ${v(s).cellType} ${v(y)?"can_accept_drop":""} ${P()?"can_action":""}`],me),Le("dragover",we,k=>A(k)),Le("drop",we,k=>fe(k)),b(i,I),Ke()}Pi(["click"]);var Yc=C('<tr><td style=" white-space: nowrap;text-align: center;"> </td><td class="svelte-13svkzh"> </td></tr>'),Wc=C('<div class="duel_log svelte-13svkzh"><table><tbody></tbody></table></div>');function Kc(i,e){var u,l;We(e,!1);let t=Oe(void 0),a=Ee(e,"log",12);const r=()=>{a(a()),Ys().then(()=>v(t)&&v(t).scroll(0,v(t).clientHeight*990))};(l=(u=a())==null?void 0:u.onUpdate)==null||l.append(r),it();var n=Wc(),s=g(n),c=g(s);ve(c,5,()=>a().records,ue,(o,f)=>{var p=Yc(),h=g(p),y=g(h),w=m(h),_=g(w);x(()=>{var S,E;_e(h,`duelist ${((S=v(f).duelist)==null?void 0:S.seat)??""} svelte-13svkzh`),D(y,((E=v(f).duelist)==null?void 0:E.profile.name)||"SYSTEM"),D(_,v(f).text)}),b(o,p)}),Sl(n,o=>te(t,o),()=>v(t)),b(i,n),Ke()}var Xc=C('<div><div class="duelist_name svelte-1u7codf"> </div> <div> </div></div>');function Hr(i,e){We(e,!1);let t=Ee(e,"duelist",12),a=Oe(0),r=Oe();const n=async()=>{const p=t().lp-v(a);if(!v(r)||Math.abs(p)<10){te(a,t().lp),v(r)&&(v(r)(),te(r,void 0));return}te(a,v(a)+Math.floor(Math.random()*p)),await Bo(100),n()},s=()=>{t(t()),!v(r)&&t().lp!==v(a)&&new Promise(p=>{te(r,p),Math.abs(t().lp-v(a)),n()})};t().duel.log.onUpdate.append(s),n(),it();var c=Xc(),u=g(c),l=g(u),o=m(u,2),f=g(o);x(()=>{_e(c,`duelist ${t().seat??""} svelte-1u7codf`),D(l,t().profile.name),_e(o,`duelist_lp ${(v(r)?"vibration":"")??""} svelte-1u7codf`),D(f,v(a))}),b(i,c),Ke()}const Qc=()=>{};var Jc=C("<div><!></div>"),Ic=C("<div></div>"),ed=(i,e,t)=>e.resolve(v(t)),td=(i,e)=>e.resolve(void 0),id=C('<button class="svelte-1h1of0m">Cancel</button>'),ad=C('<div class="base svelte-1h1of0m"><button class="overlay svelte-1h1of0m">â˜†</button> <div class="window svelte-1h1of0m"><div> </div> <!> <div><button class="svelte-1h1of0m">OK</button> <!></div></div></div>');function rd(i,e){We(e,!0);let t=As(Bt([]));var a=Fe(),r=re(a);{var n=s=>{var c=ad(),u=g(c);u.__click=[Qc];var l=m(u,2),o=g(l),f=g(o),p=m(o,2);ve(p,17,()=>e.entities.map(S=>S.controller.seat).getDistinct(),ue,(S,E)=>{var T=Ic();ve(T,21,()=>e.entities.filter(N=>N.controller.seat===v(E)).toSorted(qn),ue,(N,$)=>{var P=Jc(),G=g(P);wt(G,{get entity(){return v($)},isVisibleForcibly:!0,state:"Selectable",entitySelectResolve:A=>e.resolve(A),get qty(){return e.qty},cardActionResolve:void 0,get selectedList(){return v(t)},set selectedList(A){te(t,Bt(A))}}),b(N,P)}),x(()=>_e(T,`entities_list ${v(E)??""} svelte-1h1of0m`)),b(S,T)});var h=m(p,2),y=g(h);y.__click=[ed,e,t];var w=m(y,2);{var _=S=>{var E=id();E.__click=[td,e],b(S,E)};j(w,S=>{e.cancelable&&S(_)})}x(S=>{D(f,e.title),y.disabled=S},[()=>!e.validator(v(t))]),b(s,c)};j(r,s=>{s(n)})}b(i,a),Ke()}Pi(["click"]);const nd=(i,e)=>{e.cancelable&&e.resolve(void 0)};var sd=C('<div class="duel_card_wrapper svelte-11mc7y0"><!> <div> </div></div>'),ld=(i,e)=>e.resolve(),od=C('<div><button class="cancel_button svelte-11mc7y0">Cancel</button></div>'),cd=C('<div><button>â˜…</button> <div><div> </div> <div class="flex svelte-11mc7y0"></div> <!></div></div>');function dd(i,e){We(e,!0);const[t,a]=Tl(),r=()=>Cl(n,"$isDragging",t);let n=bl(!1);const s=()=>n.set(!0),c=()=>n.set(!1);e.view.onDragStart.append(s),e.view.onDragEnd.append(c);const u=p=>{if(e.activator.duelistType==="NPC")return"Disabled";const h=p.validate(e.activator,e.view.duel.chainBlockInfos);return h&&h.length>0?"Draggable":"Clickable"};var l=Fe(),o=re(l);{var f=p=>{var h=cd(),y=g(h);y.__click=[nd,e];var w=m(y,2),_=g(w),S=g(_),E=m(_,2);ve(E,21,()=>e.actions,ue,($,P)=>{var G=sd(),A=g(G);const fe=Wt(()=>u(v(P))),V=Wt(()=>e.dragAndDropOnly?[]:[v(P)]);wt(A,{get entity(){return v(P).entity},isVisibleForcibly:!0,get state(){return v(fe)},get actions(){return v(V)},get cardActionResolve(){return e.resolve}});var I=m(A,2),we=g(I);x(()=>D(we,`Â«${v(P).title??""}Â»`)),b($,G)});var T=m(E,2);{var N=$=>{var P=od(),G=g(P);G.__click=[ld,e],b($,P)};j(T,$=>{e.cancelable&&$(N)})}x(()=>{_e(h,`${`base ${r()?"minimum_mode":""}`??""} svelte-11mc7y0`),_e(y,`${`overlay ${r()?"minimum_mode":""}`??""} svelte-11mc7y0`),_e(w,`${`window ${r()?"minimum_mode":""}`??""} svelte-11mc7y0`),D(S,e.title)}),b(p,h)};j(o,p=>{p(f)})}b(i,l),Ke(),a()}Pi(["click"]);const ud=(i,e,t,a)=>{e().cancelable&&(t()(void 0),te(a,!1))};var vd=(i,e,t)=>e()(t()),fd=C("<li><button> </button></li>"),pd=(i,e)=>e()(void 0),hd=C("<button>Cancel</button>"),gd=C('<div class="base svelte-1103gpy"><button class="overlay svelte-1103gpy">â˜…</button> <div class="window svelte-1103gpy"><div> </div> <ui class="text_list svelte-1103gpy"></ui> <!></div></div>');function yd(i,e){We(e,!1);let t=Ee(e,"arg",8),a=Ee(e,"resolve",8),r=Oe(!0);it();var n=Fe(),s=re(n);{var c=u=>{var l=gd(),o=g(l);o.__click=[ud,t,a,r];var f=m(o,2),p=g(f),h=g(p),y=m(p,2);ve(y,5,()=>t().choises,ue,(S,E)=>{let T=()=>v(E).seq,N=()=>v(E).text;var $=fd(),P=g($);P.__click=[vd,a,T];var G=g(P);x(()=>{_e($,`text_item ${T()??""} svelte-1103gpy`),D(G,N())}),b(S,$)});var w=m(y,2);{var _=S=>{var E=hd();E.__click=[pd,a],b(S,E)};j(w,S=>{t().cancelable&&S(_)})}x(()=>D(h,t().title)),b(u,l)};j(s,u=>{v(r)&&u(c)})}b(i,n),Ke()}Pi(["click"]);var _d=C('<div class="base svelte-1y912d"><!> <!> <!></div>');function md(i,e){var f,p;We(e,!1);let t=Ee(e,"modalController",12);const a=()=>{t(t())};(p=(f=t())==null?void 0:f.onUpdate)==null||p.append(a),it();var r=_d(),n=g(r);{var s=h=>{rd(h,{get title(){return t().duelEntitiesSelectorArg.title},get entities(){return t().duelEntitiesSelectorArg.entities},get validator(){return t().duelEntitiesSelectorArg.validator},get qty(){return t().duelEntitiesSelectorArg.qty},get cancelable(){return t().duelEntitiesSelectorArg.cancelable},resolve:y=>{t().duelEntitiesSelectorResolve(y)}})};j(n,h=>{t().states.DuelEntitiesSelector==="Shown"&&h(s)})}var c=m(n,2);{var u=h=>{const y=me(()=>t().cardActionSelectorArg.dragAndDropOnly??!1);dd(h,{get view(){return t().view},get title(){return t().cardActionSelectorArg.title},get activator(){return t().cardActionSelectorArg.activator},get actions(){return t().cardActionSelectorArg.actions},get dragAndDropOnly(){return v(y)},get cancelable(){return t().cardActionSelectorArg.cancelable},resolve:w=>{console.info(w),t().cardActionSelectorResolve(w)}})};j(c,h=>{t().states.DuelActionSelector==="Shown"&&h(u)})}var l=m(c,2);{var o=h=>{yd(h,{get arg(){return t().duelTextSelectorArg},resolve:y=>{console.info(y),t().duelTextSelectorResolve(y)}})};j(l,h=>{t().states.DuelTextSelector==="Shown"&&h(o)})}b(i,r),Ke()}const Sd=(i,e)=>(e(e()==="Normal"?"Debug":"Normal"),!0);var bd=C('<div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"><pre class="description svelte-nn7bjy"> </pre></div></div> <div class="duel_card_info_row svelte-nn7bjy" style=" justify-content: space-between;"><div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"> </div></div>',1),wd=C('<div></div> <div class="svelte-nn7bjy"> </div>',1),Cd=C("<div> </div>"),Td=C("<div> </div>"),kd=C('<div class="duel_card_info_row svelte-nn7bjy"><!> <!></div> <div class="duel_card_info_row svelte-nn7bjy"></div>',1),Dd=C('<div class="duel_card_row svelte-nn7bjy"><div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"> </div></div>'),Ed=C('<div class="duel_card_row svelte-nn7bjy"><div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"> </div></div>'),Ad=C("<!> <!>",1),xd=C('<div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"><pre class="description svelte-nn7bjy"> </pre></div></div>'),Pd=C('<div class="svelte-nn7bjy"> </div>'),Md=C('<div class="svelte-nn7bjy"> </div>'),Fd=C('<div class="svelte-nn7bjy"> </div>'),Bd=C('<div class="svelte-nn7bjy"> </div>'),Od=C('<div class="svelte-nn7bjy"> </div>'),Nd=C('<div class="svelte-nn7bjy"> </div>'),qd=C('<div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"><pre class="json svelte-nn7bjy"> </pre> <pre class="json svelte-nn7bjy"> </pre> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"></div></div></div>'),Ld=C('<div class="svelte-nn7bjy">â€»ãƒ†ã‚¹ãƒˆç”¨ã‚«ãƒ¼ãƒ‰ã§ã™</div>'),Rd=C('<div class="duel_card_info_links svelte-nn7bjy"><a target="_blank" rel="noopener noreferrer" title="éŠæˆ¯çŽ‹ã‚«ãƒ¼ãƒ‰Wiki" class="svelte-nn7bjy">â‡’éŠæˆ¯çŽ‹ã‚«ãƒ¼ãƒ‰Wiki</a> <a target="_blank" rel="noopener noreferrer" title="ã‚³ãƒŠãƒŸã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹" class="svelte-nn7bjy"> </a></div>'),Hd=C('<div role="contentinfo"><div class="duel_card_info_header svelte-nn7bjy"><div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"> </div></div> <div class="duel_card_info_row svelte-nn7bjy" style="position:sticky; top:0;"><div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"> </div></div> <!></div> <div class="duel_card_info_body svelte-nn7bjy"><!></div> <div class="duel_card_info_footer svelte-nn7bjy"><!></div></div>');function $d(i,e){We(e,!1);let t=Ee(e,"entity",8,void 0);const a=()=>t()?Ie[t().origin.name]:void 0,r=()=>{var l;return t()&&(t().origin.cardId??!1)?`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=2&cid=${t().origin.cardId}`:`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=1&sess=1&rp=10&mode=&sort=1&keyword=${(l=a())==null?void 0:l.name}&stype=1&ctype=&othercon=2&starfr=&starto=&pscalefr=&pscaleto=&linkmarkerfr=&linkmarkerto=&link_m=2&atkfr=&atkto=&deffr=&defto=&releaseDStart=1&releaseMStart=1&releaseYStart=1999&releaseDEnd=&releaseMEnd=&releaseYEnd=`};let n=Ee(e,"mode",12,"Normal");it();var s=Fe(),c=re(s);{var u=l=>{var o=Hd();o.__contextmenu=[Sd,n];var f=g(o),p=g(f),h=g(p),y=g(h),w=m(p,2),_=g(w),S=g(_),E=m(_,2),T=g(E),N=m(w,2);{var $=ie=>{var M=Ad(),k=re(M);{var H=q=>{var U=bd(),K=re(U),L=g(K),R=g(L),z=g(R),ee=m(K,2),Y=g(ee),Z=g(Y),J=m(Y,2),X=g(J);x(()=>{D(z,Ie[t().origin.name].pendulumDescription),D(Z,`â—€ ${t().psL??""}`),D(X,`${t().psR??""} â–¶`)}),b(q,U)};j(k,q=>{var U;(U=t().status.monsterCategories)!=null&&U.includes("Pendulum")&&q(H)})}var Q=m(k,2);{var ce=q=>{var U=kd(),K=re(U),L=g(K);ve(L,1,()=>t().attr,ue,(ee,Y)=>{var Z=wd(),J=re(Z),X=m(J,2),B=g(X);x(()=>{_e(J,`monster_attr ${v(Y)??""} svelte-nn7bjy`),D(B,`${lr[v(Y)]??""}å±žæ€§`)}),b(ee,Z)});var R=m(L,2);ve(R,1,()=>t().types,ue,(ee,Y)=>{var Z=Cd(),J=g(Z);x(()=>{_e(Z,`monster_cat ${v(Y)??""} svelte-nn7bjy`),D(J,`${Oi[v(Y)]??""}${va[v(Y)]??""}æ—`)}),b(ee,Z)});var z=m(K,2);ve(z,5,()=>t().status.monsterCategories??[],ue,(ee,Y)=>{var Z=Td(),J=g(Z);x(()=>{_e(Z,`monster_cat ${v(Y)??""} svelte-nn7bjy`),D(J,`${Mi[v(Y)]??""}${ua[v(Y)]??""}`)}),b(ee,Z)}),b(q,U)},de=q=>{var U=Fe(),K=re(U);{var L=z=>{var ee=Dd(),Y=m(g(ee),2),Z=g(Y);x(()=>D(Z,`${Fi[t().status.spellCategory]??""}é­”æ³•`)),b(z,ee)},R=z=>{var ee=Fe(),Y=re(ee);{var Z=J=>{var X=Ed(),B=m(g(X),2),W=g(B);x(()=>D(W,`${Bi[t().status.trapCategory]??""}ç½ `)),b(J,X)};j(Y,J=>{t().status.kind==="Trap"&&t().status.trapCategory&&J(Z)},!0)}b(z,ee)};j(K,z=>{t().status.kind==="Spell"&&t().status.spellCategory?z(L):z(R,!1)},!0)}b(q,U)};j(Q,q=>{t().status.kind==="Monster"?q(ce):q(de,!1)})}b(ie,M)};j(N,ie=>{n()==="Normal"&&ie($)})}var P=m(f,2),G=g(P);{var A=ie=>{var M=xd(),k=g(M),H=g(k),Q=g(H);x(ce=>D(Q,ce),[()=>{var ce;return(ce=a())==null?void 0:ce.description}],me),b(ie,M)},fe=ie=>{var M=qd(),k=g(M),H=g(k),Q=g(H),ce=m(H,2),de=g(ce),q=m(ce,2);q.textContent='"actions" :[';var U=m(q,2);ve(U,1,()=>t().actions,ue,(Me,qe)=>{var Be=Pd(),Ze=g(Be);x(()=>D(Ze,`"${v(qe).playType??""} ${v(qe).title??""}",`)),b(Me,Be)});var K=m(U,2);K.textContent="],";var L=m(K,2);L.textContent='"continuousEffects" :[';var R=m(L,2);ve(R,1,()=>t().continuousEffects,ue,(Me,qe)=>{var Be=Md(),Ze=g(Be);x(()=>D(Ze,`"${v(qe).isStarted??""}",`)),b(Me,Be)});var z=m(R,2);z.textContent="],";var ee=m(z,2);ee.textContent='"procFilters" :[';var Y=m(ee,2);ve(Y,1,()=>t().procFilterBundle.operators,ue,(Me,qe)=>{var Be=Fd(),Ze=g(Be);x(mt=>D(Ze,`"${mt??""} ${v(qe).title??""}",`),[()=>v(qe).isSpawnedBy.toString()],me),b(Me,Be)});var Z=m(Y,2);Z.textContent="],";var J=m(Z,2);J.textContent='"cardRelations" :[';var X=m(J,2);ve(X,1,()=>t().cardRelationBundle.operators,ue,(Me,qe)=>{var Be=Bd(),Ze=g(Be);x(mt=>D(Ze,`"${mt??""} ${v(qe).title??""}",`),[()=>v(qe).isSpawnedBy.toString()],me),b(Me,Be)});var B=m(X,2);B.textContent="],";var W=m(B,2);W.textContent='"numericStateOperators" :[';var ge=m(W,2);ve(ge,1,()=>t().numericOprsBundle.operators,ue,(Me,qe)=>{var Be=Od(),Ze=g(Be);x(mt=>D(Ze,`"${mt??""} ${v(qe).title??""}",`),[()=>v(qe).isSpawnedBy.toString()],me),b(Me,Be)});var ne=m(ge,2);ne.textContent="],";var se=m(ne,2);se.textContent='"stateOperators" :[';var he=m(se,2);ve(he,1,()=>t().statusOperatorBundle.operators,ue,(Me,qe)=>{var Be=Nd(),Ze=g(Be);x(mt=>D(Ze,`"${mt??""} ${v(qe).title??""}",`),[()=>v(qe).isSpawnedBy.toString()],me),b(Me,Be)});var xe=m(he,2);xe.textContent="],";var Ge=m(xe,2);Ge.textContent='"lastMoveLogRecord" :{';var O=m(Ge,2),F=g(O),le=m(O,2),oe=g(le),Te=m(le,2),Ne=g(Te),Ce=m(Te,2);Ce.textContent="},",x((Me,qe,Be,Ze)=>{D(Q,`"info" :${Me??""},`),D(de,`"status" :${qe??""},`),D(F,`"movedBy":"${Be??""}",`),D(oe,`"movedAs":"${Ze??""}",`),D(Ne,`"movedAt":"${t().moveLog.latestRecord.movedAt??""}",`)},[()=>JSON.stringify(t().info,null,2),()=>JSON.stringify(t().status,null,2),()=>{var Me;return(Me=t().moveLog.latestRecord.movedBy)==null?void 0:Me.toString()},()=>t().moveLog.latestRecord.movedAs.join(" ")],me),b(ie,M)};j(G,ie=>{n()==="Normal"?ie(A):ie(fe,!1)})}var V=m(P,2),I=g(V);{var we=ie=>{var M=Ld();b(ie,M)},Ue=ie=>{var M=Rd(),k=g(M),H=m(k,2),Q=g(H);x(ce=>{var de;Et(k,"href",`https://yugioh-wiki.net/index.php?${t().origin.wikiEncodedName}`),Et(H,"href",ce),D(Q,`â‡’${((de=t())!=null&&de.origin.cardId?"å…¬å¼ã‚«ãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸":"å…¬å¼ã§æ¤œç´¢")??""}`)},[r],me),b(ie,M)};j(I,ie=>{var M;(M=t())!=null&&M.origin.isForTest?ie(we):ie(Ue,!1)})}x((ie,M,k)=>{_e(o,`duel_card duel_card_info ${t().origin.kind??""} ${ie??""} svelte-nn7bjy`),D(y,t().nm),D(S,M),D(T,k)},[()=>{var ie;return(ie=t().origin.monsterCategories)==null?void 0:ie.join(" ")},()=>"â˜…".repeat(t().lvl||0),()=>"â˜†".repeat(t().rank||0)],me),b(l,o)};j(c,l=>{t()&&l(u)})}b(i,s),Ke()}Pi(["contextmenu"]);var jd=C('<div class="duel_field_cell_info_item svelte-1xj7qf1"><!></div>'),Ud=C('<div class="duel_field_cell_info_box svelte-1xj7qf1"><div class="duel_field_cell_info_label svelte-1xj7qf1"> </div> <!></div>'),Zd=C('<div class="duel_field_cell_info svelte-1xj7qf1"><div class="duel_field_cell_info_header item_btn svelte-1xj7qf1"><div class="svelte-1xj7qf1"> </div> <div class="svelte-1xj7qf1"> </div></div> <div class="duel_field_cell_info_body svelte-1xj7qf1"></div></div>');function Gd(i,e){We(e,!1);let t=Ee(e,"cell",12);const a=()=>{t(t())},r=p=>t().cardEntities.filter(h=>h.face===p);t().field.duel.view.onDuelUpdate.append(a),it();var n=Zd(),s=g(n),c=g(s),u=g(c),l=m(c,2),o=g(l),f=m(s,2);ve(f,4,()=>["FaceUp","FaceDown"],ue,(p,h)=>{var y=Fe(),w=re(y);{var _=S=>{var E=Ud(),T=g(E),N=g(T),$=m(T,2);ve($,1,()=>r(h).toSorted(qn),ue,(P,G)=>{var A=jd(),fe=g(A);const V=me(()=>t().owner===t().field.duel.duelists.Below);wt(fe,{get entity(){return v(G)},get isVisibleForcibly(){return v(V)},isWideMode:!0,cardActionResolve:void 0}),b(P,A)}),x(()=>D(N,h==="FaceUp"?"è¡¨å‘ã":"è£å‘ã")),b(S,E)};j(w,S=>{r(h).length&&S(_)})}b(p,y)}),x(()=>{var p;D(u,(p=t().owner)==null?void 0:p.profile.name),D(o,t().cellType)}),b(i,n),Ke()}const zd=mc({duration:400});var Vd=C('<div class="duel_field_header_message svelte-accyye"> </div> <div class="duel_field_header_buttons svelte-accyye"><button class="svelte-accyye">ã‚µãƒ¬ãƒ³ãƒ€ãƒ¼</button></div>',1),Yd=C("<tr></tr>"),Wd=C('<table class="duel_field svelte-accyye"><tbody class="svelte-accyye"></tbody></table>'),Kd=C('<button class="svelte-accyye">OK</button>'),Xd=C('<div class="flex duel_desk svelte-accyye"><div class="duel_desk_left v_flex svelte-accyye"><!> <!> <!></div> <div class=" duel_desk_center v_flex svelte-accyye"><div class="duel_field_header svelte-accyye"><!></div> <div class="svelte-accyye"><!></div> <div class="duel_field_footer svelte-accyye"><!></div></div> <div class=" duel_desk_right svelte-accyye" style="text-align: left;"><!></div></div> <div style="position:absolute;left:0;bottom:0"> </div> <!>',1);function Qd(i,e){We(e,!1);let t=Ee(e,"duel",12),a=()=>{},r=Oe(()=>!0),n=Oe();const s=q=>{a=q.resolve,te(r,q.entitiesValidator),te(n,q.selectableEntities),q.duelEntitiesSelectorArg&&t().view.modalController.selectDuelEntities(q.duelEntitiesSelectorArg).then(U=>{a({selectedEntities:U})})};t().view.onWaitStart.append(s);let c=Oe(void 0),u=Oe("Normal");const l=({card:q,mode:U})=>{te(c,q),te(u,U)};t().view.onShowCardEntity.append(l);let o=Ee(e,"selectedList",28,()=>[]);const f=()=>{t(t())};t().view.onDuelUpdate.append(f),t().log.onUpdate.append(f);const p=()=>{v(r)(o())&&a({selectedEntities:o()})},h=()=>{a({surrender:!0})};t().main(),it();var y=Xd(),w=re(y),_=g(w),S=g(_);Hr(S,{get duelist(){return t().duelists.Above}});var E=m(S,2);$d(E,{get entity(){return v(c)},get mode(){return v(u)}});var T=m(E,2);Hr(T,{get duelist(){return t().duelists.Below}});var N=m(_,2),$=g(N),P=g($);{var G=q=>{var U=Vd(),K=re(U),L=g(K),R=m(K,2),z=g(R);x(()=>D(L,`[TURN:${t().clock.turn}][PHASE:${t().phase}] ${t().view.message}`)),Le("click",z,h),b(q,U)};j(P,q=>{t().isEnded||q(G)})}var A=m($,2),fe=g(A);{var V=q=>{var U=Wd(),K=g(U);ve(K,5,()=>t().field.cells,ue,(L,R,z)=>{var ee=Yd();_e(ee,`${`duel_desk_row_${z}`??""} svelte-accyye`),ve(ee,5,()=>v(R),ue,(Y,Z,J)=>{Vc(Y,{get view(){return t().view},row:z,column:J,get selectedList(){return o()},set selectedList(X){o(X)},$$legacy:!0})}),b(L,ee)}),b(q,U)};j(fe,q=>{t().clock.turn>0&&q(V)})}var I=m(A,2),we=g(I);{var Ue=q=>{var U=Kd();x(K=>U.disabled=K,[()=>!v(r)(o())],me),Le("click",U,p),b(q,U)};j(we,q=>{v(n)&&v(n).length>0&&q(Ue)})}var ie=m(N,2),M=g(ie);{var k=q=>{Kc(q,{get log(){return t().log}})},H=q=>{var U=Fe(),K=re(U);{var L=R=>{Gd(R,{get cell(){return t().view.infoBoardCell}})};j(K,R=>{t().view.infoBoardState==="CellInfo"&&R(L)},!0)}b(q,U)};j(M,q=>{t().view.infoBoardState==="Log"?q(k):q(H,!1)})}var Q=m(w,2),ce=g(Q),de=m(Q,2);md(de,{get modalController(){return t().view.modalController}}),x(q=>D(ce,q),[()=>t().clock.toString()],me),b(i,y),Ke()}var Jd=C("<div></div>"),Id=C('<span> </span> / <span style="display: inline-block;width:2rem;text-align: right;"> </span>',1),eu=C('<li class="deck_editor_item svelte-vivzk2"><div role="listitem"><div class="svelte-vivzk2"><div class="svelte-vivzk2"> </div> <div style="display:flex" class="svelte-vivzk2"><div class="svelte-vivzk2"><!> <!> <!> <!> <!> <!> <!></div> <div style="flex-grow: 1; width:0.1rem" class="svelte-vivzk2"></div> <div class="svelte-vivzk2"><!></div></div></div></div> <button class="button_style_reset svelte-vivzk2" title="â€»shiftã‚­ãƒ¼åŒæ™‚æŠ¼ã—ã§ä¸€æ‹¬æŠ•å…¥">+</button> <button class="button_style_reset svelte-vivzk2" title="â€»shiftã‚­ãƒ¼åŒæ™‚æŠ¼ã—ã§ä¸€æ‹¬å¤–ã—">-</button></li>'),tu=C('<div class="deck_editor_card_kind svelte-vivzk2"><span class="svelte-vivzk2"> </span> <ul class="svelte-vivzk2"></ul></div>'),iu=C('<div class="deck_editor_deck_type svelte-vivzk2"><span class="svelte-vivzk2"> </span> <!></div>'),au=C('<div class="deck_editor_card_list svelte-vivzk2"></div>');function $r(i,e){We(e,!1);let t=Ee(e,"allCardInfos",8),a=Ee(e,"deckCardInfos",12),r=Ee(e,"mode",8),n=Ee(e,"onAttention",8);const s={Deck:["Monster","Spell","Trap"],ExtraDeck:["Monster"]},c=(f,p)=>(r()==="List"?t():a()).filter(h=>{var y;return Ya.has(h.name)||((y=h.monsterCategories)==null?void 0:y.includes("Normal"))}).filter(h=>!p||h.kind===p).filter(h=>{var y,w;return!f||f==="Deck"&&!((y=h==null?void 0:h.monsterCategories)!=null&&y.union(oi).length)||f==="ExtraDeck"&&((w=h==null?void 0:h.monsterCategories)==null?void 0:w.union(oi).length)}),u=(f,p)=>{const h=a().filter(w=>w.name===p.name).length;if(h>2)return;const y=f.shiftKey?3-h:1;y<1||(a().push(...Array(y).fill(p)),a().sort(Si),a(a()))},l=(f,p)=>{let h=0;a(a().filter(y=>y.name!==p.name?!0:(h++,!f.shiftKey&&h>1))),a().sort(Si)};it();var o=au();ve(o,5,()=>xl,ue,(f,p)=>{var h=iu(),y=g(h),w=g(y),_=m(y,2);ve(_,1,()=>s[v(p)],ue,(S,E)=>{var T=tu(),N=g(T),$=g(N),P=m(N,2);ve(P,5,()=>c(v(p),v(E)).toSorted(Si),ue,(G,A)=>{var fe=eu(),V=g(fe),I=g(V),we=g(I),Ue=g(we),ie=m(we,2),M=g(ie),k=g(M);{var H=B=>{var W=Zt();x(()=>D(W,`â˜…${v(A).level??""}`)),b(B,W)};j(k,B=>{v(A).level&&B(H)})}var Q=m(k,2);{var ce=B=>{var W=Zt();x(()=>D(W,`â˜†${v(A).rank??""}`)),b(B,W)};j(Q,B=>{v(A).rank&&B(ce)})}var de=m(Q,2);ve(de,1,()=>v(A).attributes??[],ue,(B,W)=>{var ge=Jd();x(()=>_e(ge,`monster_attr ${v(W)??""} svelte-vivzk2`)),b(B,ge)});var q=m(de,2);ve(q,1,()=>v(A).types??[],ue,(B,W)=>{var ge=Zt();x(()=>D(ge,Oi[v(W)])),b(B,ge)});var U=m(q,2);ve(U,1,()=>v(A).monsterCategories??[],ue,(B,W)=>{var ge=Zt();x(()=>D(ge,Mi[v(W)])),b(B,ge)});var K=m(U,2);{var L=B=>{var W=Zt();x(()=>D(W,`${Fi[v(A).spellCategory]??""}é­”æ³•`)),b(B,W)};j(K,B=>{v(A).spellCategory!==void 0&&B(L)})}var R=m(K,2);{var z=B=>{var W=Zt();x(()=>D(W,`${Bi[v(A).trapCategory]??""}ç½ `)),b(B,W)};j(R,B=>{v(A).trapCategory!==void 0&&B(z)})}var ee=m(M,4),Y=g(ee);{var Z=B=>{var W=Id(),ge=re(W),ne=g(ge),se=m(ge,2),he=g(se);x(()=>{D(ne,v(A).attack??"?"),D(he,v(A).defense??"?")}),b(B,W)};j(Y,B=>{v(A).kind==="Monster"&&B(Z)})}var J=m(V,2),X=m(J,2);x(B=>{_e(V,`${B??""} svelte-vivzk2`),D(Ue,v(A).name)},[()=>{var B,W;return`deck_editor_card duel_card ${v(A).kind} ${(W=(B=v(A))==null?void 0:B.monsterCategories)==null?void 0:W.join(" ")} ${Ya.has(v(A).name)?"is_implemented":"is_not_implemented"}`}],me),Le("mouseenter",V,()=>n()(v(A))),Le("click",J,B=>u(B,v(A))),Le("click",X,B=>l(B,v(A))),b(G,fe)}),x(G=>D($,`${kn[v(E)]??""}ï¼ˆ${G??""}æžšï¼‰`),[()=>c(v(p),v(E)).length],me),b(S,T)}),x(S=>D(w,`${Pl[v(p)]??""}ï¼ˆ${S??""}æžšï¼‰`),[()=>c(v(p)).length],me),b(f,h)}),b(i,o),Ke()}var ru=C('<div class="duel_card_info_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"><pre class="description svelte-1xf9hqi"> </pre></div></div> <div class="duel_card_info_row svelte-1xf9hqi" style=" justify-content: space-between;"><div class="svelte-1xf9hqi"> </div> <div class="svelte-1xf9hqi"> </div></div>',1),nu=C('<div></div> <div class="svelte-1xf9hqi"> </div>',1),su=C("<div> </div>"),lu=C("<div> </div>"),ou=C('<div class="duel_card_info_row svelte-1xf9hqi"><!> <!></div> <div class="duel_card_info_row svelte-1xf9hqi"></div>',1),cu=C('<div class="duel_card_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"></div> <div class="svelte-1xf9hqi"> </div></div>'),du=C('<div class="duel_card_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"></div> <div class="svelte-1xf9hqi"> </div></div>'),uu=C('<div class="duel_card_info_row svelte-1xf9hqi"><div class="svelte-1xf9hqi">â€»ãƒ†ã‚¹ãƒˆç”¨ã‚«ãƒ¼ãƒ‰ã§ã™</div></div>'),vu=C('<div class="duel_card_info_links svelte-1xf9hqi"><a target="_blank" rel="noopener noreferrer" title="éŠæˆ¯çŽ‹ã‚«ãƒ¼ãƒ‰Wiki" class="svelte-1xf9hqi">â‡’éŠæˆ¯çŽ‹ã‚«ãƒ¼ãƒ‰Wiki</a> <a target="_blank" rel="noopener noreferrer" title="ã‚³ãƒŠãƒŸã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹" class="svelte-1xf9hqi"> </a></div>'),fu=C('<div><div class="duel_card_info_header svelte-1xf9hqi"><div class="duel_card_info_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"> </div></div> <div class="duel_card_info_row svelte-1xf9hqi" style="position:sticky; top:0;"><div class="svelte-1xf9hqi"> </div> <div class="svelte-1xf9hqi"> </div></div></div> <div class="duel_card_info_body svelte-1xf9hqi"><!> <!> <div class="duel_card_info_row description svelte-1xf9hqi"><div class="svelte-1xf9hqi"><pre class="description svelte-1xf9hqi"> </pre></div></div> <!></div></div>');function pu(i,e){We(e,!1);let t=Ee(e,"cardInfo",8,void 0);const a=()=>t()?Ie[t().name]:void 0;it();var r=Fe(),n=re(r);{var s=c=>{var u=fu(),l=g(u),o=g(l),f=g(o),p=g(f),h=m(o,2),y=g(h),w=g(y),_=m(y,2),S=g(_),E=m(l,2),T=g(E);{var N=M=>{var k=ru(),H=re(k),Q=g(H),ce=g(Q),de=g(ce),q=m(H,2),U=g(q),K=g(U),L=m(U,2),R=g(L);x(()=>{D(de,Ie[t().name].pendulumDescription),D(K,`â—€ ${t().pendulumScaleL??""}`),D(R,`${t().pendulumScaleR??""} â–¶`)}),b(M,k)};j(T,M=>{var k;(k=t().monsterCategories)!=null&&k.includes("Pendulum")&&M(N)})}var $=m(T,2);{var P=M=>{var k=ou(),H=re(k),Q=g(H);{var ce=K=>{var L=nu(),R=re(L),z=m(R,2),ee=g(z);x(()=>{_e(R,`monster_attr ${t().attributes[0]??""} svelte-1xf9hqi`),D(ee,`${lr[t().attributes[0]]??""}å±žæ€§`)}),b(K,L)};j(Q,K=>{t().attributes&&K(ce)})}var de=m(Q,2);{var q=K=>{var L=su(),R=g(L);x(()=>{_e(L,`monster_cat ${t().types[0]??""} svelte-1xf9hqi`),D(R,`${Oi[t().types[0]]??""}${va[t().types[0]]??""}æ—`)}),b(K,L)};j(de,K=>{t().types&&K(q)})}var U=m(H,2);ve(U,5,()=>t().monsterCategories??[],ue,(K,L)=>{var R=lu(),z=g(R);x(()=>{_e(R,`monster_cat ${v(L)??""} svelte-1xf9hqi`),D(z,`${Mi[v(L)]??""}${ua[v(L)]??""}`)}),b(K,R)}),b(M,k)},G=M=>{var k=Fe(),H=re(k);{var Q=de=>{var q=cu(),U=m(g(q),2),K=g(U);x(()=>D(K,`${Fi[t().spellCategory]??""}é­”æ³•`)),b(de,q)},ce=de=>{var q=Fe(),U=re(q);{var K=L=>{var R=du(),z=m(g(R),2),ee=g(z);x(()=>D(ee,`${Bi[t().trapCategory]??""}ç½ `)),b(L,R)};j(U,L=>{t().kind==="Trap"&&t().trapCategory&&L(K)},!0)}b(de,q)};j(H,de=>{t().kind==="Spell"&&t().spellCategory?de(Q):de(ce,!1)},!0)}b(M,k)};j($,M=>{t().kind==="Monster"?M(P):M(G,!1)})}var A=m($,2),fe=g(A),V=g(fe),I=g(V),we=m(A,2);{var Ue=M=>{var k=uu();b(M,k)},ie=M=>{var k=vu(),H=g(k),Q=m(H,2),ce=g(Q);x(de=>{Et(H,"href",`https://yugioh-wiki.net/index.php?${t().wikiEncodedName}`),Et(Q,"href",de),D(ce,`â‡’${(t().cardId?"å…¬å¼ã‚«ãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸":"å…¬å¼ã§æ¤œç´¢")??""}`)},[()=>Nl(t())],me),b(M,k)};j(we,M=>{t().isForTest?M(Ue):M(ie,!1)})}x((M,k,H,Q)=>{_e(u,`duel_card duel_card_info ${t().kind??""} ${M??""} svelte-1xf9hqi`),D(p,t().name),D(w,k),D(S,H),D(I,Q)},[()=>{var M;return(M=t().monsterCategories)==null?void 0:M.join(" ")},()=>"â˜…".repeat(t().level||0),()=>"â˜†".repeat(t().rank||0),()=>{var M;return(M=a())==null?void 0:M.description}],me),b(c,u)};j(n,c=>{t()&&c(s)})}b(i,r),Ke()}const hu={0:{aaa:"æ—¥",aaaa:"æ—¥æ›œæ—¥",ddd:"Sun",dddd:"Sunday"},1:{aaa:"æœˆ",aaaa:"æœˆæ›œæ—¥",ddd:"Mon",dddd:"Monday"},2:{aaa:"ç«",aaaa:"ç«æ›œæ—¥",ddd:"Tue",dddd:"Tuesday"},3:{aaa:"æ°´",aaaa:"æ°´æ›œæ—¥",ddd:"Wed",dddd:"Wednesday"},4:{aaa:"æœ¨",aaaa:"æœ¨æ›œæ—¥",ddd:"Thu",dddd:"Thursday"},5:{aaa:"é‡‘",aaaa:"é‡‘æ›œæ—¥",ddd:"Fri",dddd:"Friday"},6:{aaa:"åœŸ",aaaa:"åœŸæ›œæ—¥",ddd:"Sat",dddd:"Saturday"}};class gu{constructor(){d(this,"DefaultSeparator1","/");d(this,"DefaultSeparator2"," ");d(this,"DefaultSeparator3",":");d(this,"createDate",e=>{if(!e)return;const t=new Date(e);if(!isNaN(t.getTime()))return t});d(this,"createDateOr",(e,t)=>this.createDate(e)||t||new Date);d(this,"truncateDate",e=>{const t=e||new Date;return new Date(t.getFullYear(),t.getMonth(),t.getDate())});d(this,"addDate",(e,t)=>{const a=this.createDateOr(e);return a.setDate(a.getDate()+t),a});d(this,"addMonth",(e,t)=>{const a=this.createDateOr(e);return a.setMonth(a.getMonth()+t),a});d(this,"addYear",(e,t)=>{const a=this.createDateOr(e);return a.setFullYear(a.getFullYear()+t),a});d(this,"getDayOfWeek",(e,t="dddd")=>{const a=this.createDate(e);return a?hu[a.getDay()][t]:""});d(this,"formatToYYYYMMDD",(e,t=this.DefaultSeparator1)=>{const a=this.createDate(e);if(!a)return"";const r=a.getFullYear().toString(),n=("0"+(a.getMonth()+1)).slice(-2),s=("0"+a.getDate()).slice(-2);return r+t+n+t+s});d(this,"formatToYYYYMM",(e,t=this.DefaultSeparator1)=>{const a=this.createDate(e);if(!a)return"";t||(t="");const r=a.getFullYear().toString(),n=("0"+(a.getMonth()+1)).slice(-2);return r+t+n});d(this,"formatToHHMMSS",(e,t=this.DefaultSeparator3)=>{const a=this.createDate(e);if(!a)return"";t||(t="");const r=a.getHours(),n=a.getMinutes(),s=a.getSeconds();return("0"+r).slice(-2)+t+("0"+n).slice(-2)+t+("0"+s).slice(-2)});d(this,"formatToHHMM",(e,t=this.DefaultSeparator3)=>{const a=this.createDate(e);if(!a)return"";t||(t="");const r=("0"+a.getHours()).slice(-2),n=("0"+a.getMinutes()).slice(-2);return r+t+n});d(this,"formatToYYYYMMDD_HHMM",(e,t=this.DefaultSeparator1,a=this.DefaultSeparator2,r=this.DefaultSeparator3)=>{const n=this.createDate(e);return n?this.formatToYYYYMMDD(n,t)+a+this.formatToHHMM(n,r):""});d(this,"formatToYYYYMMDD_HHMMSS",(e,t=this.DefaultSeparator1,a=this.DefaultSeparator2,r=this.DefaultSeparator3)=>{const n=this.createDate(e);return n?this.formatToYYYYMMDD(n,t)+a+this.formatToHHMMSS(n,r):""})}}const ut=new gu;Date.prototype.truncateDate=function(){return ut.truncateDate(this)};Date.prototype.getCloneOr=function(i){return ut.createDateOr(this,i)};Date.prototype.addDate=function(i){return ut.addDate(this,i)};Date.prototype.addMonth=function(i){return ut.addDate(this,i)};Date.prototype.addYear=function(i){return ut.addDate(this,i)};Date.prototype.getDayOfWeek=function(i="dddd"){return ut.getDayOfWeek(this,i)};Date.prototype.formatToYYYYMM=function(i){return ut.formatToYYYYMM(this,i)};Date.prototype.formatToYYYYMMDD=function(i){return ut.formatToYYYYMMDD(this,i)};Date.prototype.formatToYYYYMMDD_HHMM=function(i,e,t){return ut.formatToYYYYMMDD_HHMM(this,i,e,t)};Date.prototype.formatToYYYYMMDD_HHMMSS=function(i,e,t){return ut.formatToYYYYMMDD_HHMMSS(this,i,e,t)};Date.prototype.formatToHHMM=function(i){return ut.formatToHHMM(this,i)};Date.prototype.formatToHHMMSS=function(i){return ut.formatToHHMMSS(this,i)};var yu=C('<label><input type="checkbox"> </label>'),_u=C('<label><input type="checkbox"> </label>'),mu=C('<label><input type="checkbox"> <div style="display: inline-block;"></div> </label>'),Su=C('<label><input type="checkbox"> </label>'),bu=C('<label><input type="checkbox"> </label>'),wu=C('<label><input type="checkbox"> </label>'),Cu=C("<option> </option>"),Tu=C('<div class="svelte-b5thz2"><a class="white_button svelte-b5thz2" download="SVS_DeckInfos.json">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a></div>'),ku=C('<div class="svelte-b5thz2"></div>'),Du=C('<div class="svelte-b5thz2"><a class="white_button svelte-b5thz2" download="SVS_DeckInfos.json">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆä¸€æ‹¬ï¼‰</a></div>'),Eu=C('<div class="svelte-b5thz2"></div>'),Au=C('<div class="deck_editor_body_right_header svelte-b5thz2"><div class="deck_editor_body_right_header_row svelte-b5thz2"><div class="svelte-b5thz2">ç·¨é›†å¯¾è±¡ <select></select></div> <div class="svelte-b5thz2"></div> <div class="svelte-b5thz2">æ–°è¦åç§° <input type="text"></div></div> <div class="deck_editor_body_right_header_row svelte-b5thz2"></div> <div class="deck_editor_body_right_header_row svelte-b5thz2"><div class="svelte-b5thz2">åŸºæœ¬æ“ä½œ</div> <div class="svelte-b5thz2"><button class="white_button svelte-b5thz2">ãƒ‡ãƒƒã‚­ã‚’ä¿å­˜</button></div> <div class="svelte-b5thz2"></div> <div class="svelte-b5thz2"><button class="white_button svelte-b5thz2">ãƒ‡ãƒƒã‚­ã‚’è¤‡è£½</button></div> <div class="svelte-b5thz2"><button class="white_button svelte-b5thz2" title="shiftã‚­ãƒ¼æŠ¼ä¸‹ã§ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¹ã‚­ãƒƒãƒ—">ãƒ‡ãƒƒã‚­ã‚’å‰Šé™¤</button></div></div> <div class="deck_editor_body_right_header_row svelte-b5thz2"><div class="svelte-b5thz2">DL/UL</div> <!> <!></div></div> <!>',1),xu=C("<div>ãƒ‡ãƒƒã‚­æƒ…å ±èª­è¾¼ä¸­</div>"),Pu=C('<div class="deck_editor svelte-b5thz2"><div class="deck_editor_header"></div> <div class="deck_editor_body svelte-b5thz2"><div class="deck_editor_body_left svelte-b5thz2"><div class="deck_editor_search_box svelte-b5thz2"><div class="deck_editor_search_box_header svelte-b5thz2"><div>æ¤œç´¢æ¡ä»¶</div> <div><button class="white_button svelte-b5thz2">æ¡ä»¶ã‚¯ãƒªã‚¢</button></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">åç§°</div> <div class="svelte-b5thz2"><input type="text" style="width:70%">â€»ãƒ«ãƒ“ã«ã¯å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“</div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">ç¨®é¡ž</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">å±žæ€§</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">ç¨®æ—</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">é­”æ³•</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">ç½ </div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">ãƒ†ã‚¹ãƒˆç”¨</div> <div class="svelte-b5thz2"><label><input type="checkbox"> ãƒ†ã‚¹ãƒˆç”¨ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã™ã‚‹</label></div></div></div> <!></div> <div class="deck_editor_body_center svelte-b5thz2"><!></div> <div class="deck_editor_body_right svelte-b5thz2"><!></div></div></div>');function Mu(i,e){We(e,!1);const t=[],a=[],r=[],n=[],s=[],c=[],u=async()=>{Re(S,v(S).name=""),Re(S,v(S).cardKinds=[]),Re(S,v(S).monsterCategories=[]),Re(S,v(S).monsterAttributes=[]),Re(S,v(S).monsterTypes=[]),Re(S,v(S).spellCategories=[]),Re(S,v(S).trapCategories=[]),Re(S,v(S).isForTest=!1)},l=async()=>{const F=(await v(p)).find(le=>le.id===v(f));F&&te(w,{...F,cardInfos:F.cardNames.map(le=>Ie[le])})},o=()=>ht.getAllDeckInfo().then(O=>(O.forEach(F=>console.log(F.id,F.lastUsedAt,F.lastUsedAt.getTime())),console.log(Math.max(...O.map(F=>F.lastUsedAt.getTime()))),te(f,(O.find(F=>F.lastUsedAt.getTime()===Math.max(...O.map(le=>le.lastUsedAt.getTime())))??O[0]).id),O));let f=Oe(-1),p=Oe(o()),h=Oe(v(p).then(O=>ht.convertToObjectURL(O)));v(p).then(l);const y=()=>{te(p,o()),te(h,v(p).then(O=>ht.convertToObjectURL(O))),l()};let w=Oe({id:-Number.MAX_VALUE,name:"",description:"",lastUsedAt:new Date,cardInfos:[]}),_=Oe(Ie.ã‚¾ãƒ³ãƒ“ãƒ¼ãƒŽ);const S=Oe({name:"",cardKinds:[...Na],monsterCategories:[...kr].filter(O=>O!=="Normal"&&O!=="Token"),monsterAttributes:[...Dr],monsterTypes:[...Er],spellCategories:[...Ar],trapCategories:[...xr],isForTest:!1}),E=()=>Object.values(Ie).filter(O=>{if(!v(S).cardKinds.includes(O.kind)||v(S).name.trim().length&&!O.name.includes(v(S).name)||O.isForTest&&!v(S).isForTest)return!1;if(O.kind==="Monster")return O.attributes&&!v(S).monsterAttributes.union(O.attributes).length||O.types&&!v(S).monsterTypes.union(O.types).length||!O.monsterCategories?!1:O.monsterCategories.union(v(S).monsterCategories).length;if(O.kind==="Spell")return O.spellCategory&&v(S).spellCategories.includes(O.spellCategory);if(O.kind==="Trap")return O.trapCategory&&v(S).trapCategories.includes(O.trapCategory)}),T=O=>{te(_,O)},N=async()=>{const F=(await v(p)).find(le=>le.id===v(f));if(!F)throw new Error("illegal state");return F},$=async()=>{const O=await N();await O.saveDeckInfo({...O,name:v(w).name,cardNames:v(w).cardInfos.map(F=>F.name),lastUsedAt:new Date}),y()},P=async()=>{(await ht.createNewDeck(`ãƒ‡ãƒƒã‚­_${new Date().formatToYYYYMMDD_HHMMSS("","","")}`,`ã‚³ãƒ”ãƒ¼æ—¥æ™‚ï¼š${new Date().formatToYYYYMMDD_HHMMSS("-"," ",":")}`,v(w).cardInfos.map(F=>F.name))).saveDeckInfo(),y()},G=async O=>{const F=await N();!O.shiftKey&&!confirm(`ãƒ‡ãƒƒã‚­ã€${F.name}ã€‘ã‚’å‰Šé™¤ã—ã¾ã™ã€‚
ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`)||(await F.delete(),y())};it();var A=Pu(),fe=m(g(A),2),V=g(fe),I=g(V),we=g(I),Ue=m(g(we),2),ie=g(Ue),M=m(we,2),k=m(g(M),2),H=g(k),Q=m(M,2),ce=m(g(Q),2);ve(ce,5,()=>Na.filter(O=>O!=="XyzMaterial"),ue,(O,F)=>{var le=yu(),oe=g(le),Te,Ne=m(oe);x(()=>{Te!==(Te=v(F))&&(oe.value=(oe.__value=v(F))==null?"":v(F)),D(Ne,` ${kn[v(F)]??""}`)}),ti(t,[],oe,()=>(v(F),v(S).cardKinds),Ce=>Re(S,v(S).cardKinds=Ce)),b(O,le)});var de=m(Q,2),q=m(g(de),2);ve(q,5,()=>kr,ue,(O,F)=>{var le=_u(),oe=g(le),Te,Ne=m(oe);x(()=>{Te!==(Te=v(F))&&(oe.value=(oe.__value=v(F))==null?"":v(F)),D(Ne,` ${Mi[v(F)]??""}${ua[v(F)]??""}`)}),ti(a,[],oe,()=>(v(F),v(S).monsterCategories),Ce=>Re(S,v(S).monsterCategories=Ce)),b(O,le)});var U=m(de,2),K=m(g(U),2);ve(K,5,()=>Dr,ue,(O,F)=>{var le=mu(),oe=g(le),Te,Ne=m(oe,2),Ce=m(Ne);x(()=>{Te!==(Te=v(F))&&(oe.value=(oe.__value=v(F))==null?"":v(F)),_e(Ne,`monster_attr ${v(F)??""} svelte-b5thz2`),D(Ce,` ${lr[v(F)]??""}`)}),ti(r,[],oe,()=>(v(F),v(S).monsterAttributes),Me=>Re(S,v(S).monsterAttributes=Me)),b(O,le)});var L=m(U,2),R=m(g(L),2);ve(R,5,()=>Er,ue,(O,F)=>{var le=Su(),oe=g(le),Te,Ne=m(oe);x(()=>{Te!==(Te=v(F))&&(oe.value=(oe.__value=v(F))==null?"":v(F)),D(Ne,` ${Oi[v(F)]??""}
                ${va[v(F)]??""}`)}),ti(n,[],oe,()=>(v(F),v(S).monsterTypes),Ce=>Re(S,v(S).monsterTypes=Ce)),b(O,le)});var z=m(L,2),ee=m(g(z),2);ve(ee,5,()=>Ar,ue,(O,F)=>{var le=bu(),oe=g(le),Te,Ne=m(oe);x(()=>{Te!==(Te=v(F))&&(oe.value=(oe.__value=v(F))==null?"":v(F)),D(Ne,` ${Fi[v(F)]??""}`)}),ti(s,[],oe,()=>(v(F),v(S).spellCategories),Ce=>Re(S,v(S).spellCategories=Ce)),b(O,le)});var Y=m(z,2),Z=m(g(Y),2);ve(Z,5,()=>xr,ue,(O,F)=>{var le=wu(),oe=g(le),Te,Ne=m(oe);x(()=>{Te!==(Te=v(F))&&(oe.value=(oe.__value=v(F))==null?"":v(F)),D(Ne,` ${Bi[v(F)]??""}`)}),ti(c,[],oe,()=>(v(F),v(S).trapCategories),Ce=>Re(S,v(S).trapCategories=Ce)),b(O,le)});var J=m(Y,2),X=m(g(J),2),B=g(X),W=g(B),ge=m(I,2);pu(ge,{get cardInfo(){return v(_)}});var ne=m(V,2),se=g(ne);const he=me(E);$r(se,{mode:"List",get allCardInfos(){return v(he)},onAttention:T,get deckCardInfos(){return v(w).cardInfos},set deckCardInfos(O){Re(w,v(w).cardInfos=O)},$$legacy:!0});var xe=m(ne,2),Ge=g(xe);yi(Ge,()=>v(p),O=>{var F=xu();b(O,F)},(O,F)=>{var le=Au(),oe=re(le),Te=g(oe),Ne=g(Te),Ce=m(g(Ne));x(()=>{v(f),Ui(()=>{v(F)})}),ve(Ce,5,()=>v(F),ue,(Xe,at)=>{var pt=Cu(),Qt={},ya=g(pt);x(()=>{Qt!==(Qt=v(at).id)&&(pt.value=(pt.__value=v(at).id)==null?"":v(at).id),D(ya,v(at).name)}),b(Xe,pt)});var Me=m(Ne,4),qe=m(g(Me)),Be=m(Te,4),Ze=m(g(Be),2),mt=g(Ze),cr=m(Ze,4),jn=g(cr),Un=m(cr,2),Zn=g(Un),Gn=m(Be,2),dr=m(g(Gn),2);yi(dr,N,Xe=>{var at=ku();b(Xe,at)},(Xe,at)=>{var pt=Tu(),Qt=g(pt);x(ya=>Et(Qt,"href",ya),[()=>ht.convertToObjectURL([v(at)])],me),b(Xe,pt)});var zn=m(dr,2);yi(zn,()=>v(h),Xe=>{var at=Eu();b(Xe,at)},(Xe,at)=>{var pt=Du(),Qt=g(pt);x(()=>Et(Qt,"href",v(at))),b(Xe,pt)});var Vn=m(oe,2);$r(Vn,{mode:"Deck",allCardInfos:[],onAttention:T,get deckCardInfos(){return v(w).cardInfos},set deckCardInfos(Xe){Re(w,v(w).cardInfos=Xe)},$$legacy:!0}),Zi(Ce,()=>v(f),Xe=>te(f,Xe)),Le("change",Ce,l),Ma(qe,()=>v(w).name,Xe=>Re(w,v(w).name=Xe)),Le("click",mt,$),Le("click",jn,P),Le("click",Zn,G),b(O,le)}),Le("click",ie,u),Ma(H,()=>v(S).name,O=>Re(S,v(S).name=O)),gl(W,()=>v(S).isForTest,O=>Re(S,v(S).isForTest=O)),b(i,A),Ke()}const Fu="2025-04-05 18:08:02",Bu={timestamp:Fu},Ou=["TblDeckHeader","TblDeckDetail","TblDuelistProfile"],Nu=3;var qu=C("<option> </option>"),Lu=C("<option> </option>"),Ru=C("<option> </option>"),Hu=C('<div class="svelte-1vi4vvn"><label for="deck_selector" class="deck_selector svelte-1vi4vvn">ãƒ‡ãƒƒã‚­ï¼š</label> <select id="deck_selector" class="deck_selector svelte-1vi4vvn"></select></div> <div class="svelte-1vi4vvn"><label for="npc_selector" class="npc_selector svelte-1vi4vvn">å¯¾æˆ¦ç›¸æ‰‹ï¼š</label> <select id="npc_selector" class="npc_selector svelte-1vi4vvn"></select> <div> </div></div> <div class="svelte-1vi4vvn"><label for="npc_selector" class="npc_selector svelte-1vi4vvn">å…ˆæ”»å¾Œæ”»ï¼š</label> <select id="npc_selector" class="npc_selector svelte-1vi4vvn"></select></div> <div class="svelte-1vi4vvn"><button class="btn svelte-1vi4vvn">duel start!</button></div>',1),$u=C('<div class="svelte-1vi4vvn">ãƒ‡ãƒƒã‚­æƒ…å ±ã®èª­ã¿è¾¼ã¿ã€ã‚‚ã—ãã¯ä½œæˆä¸­...</div>'),ju=C('<div class="svelte-1vi4vvn"><label for="duelist_name" class="duelist_name svelte-1vi4vvn">åå‰ï¼š</label> <input id="duelist_name" class="duelist_name svelte-1vi4vvn" type="text"></div> <!> <div class="svelte-1vi4vvn"><button class="btn svelte-1vi4vvn">deck edit</button></div>',1),Uu=C('<div class="svelte-1vi4vvn">ãƒ‡ãƒ¥ã‚¨ãƒªã‚¹ãƒˆæƒ…å ±ã®èª­ã¿è¾¼ã¿ã€ã‚‚ã—ãã¯ä½œæˆä¸­...</div>'),Zu=C('<div class="app_body svelte-1vi4vvn"><!></div>'),Gu=C('<main class="svelte-1vi4vvn"><div class="link link_left svelte-1vi4vvn"><a href="https://github.com/Setta238/stk_ygo_svelte" target="_blank" rel="noopener noreferrer" title="repository" class="svelte-1vi4vvn">repository</a> <a href="https://x.com/ninja_no" target="_blank" rel="noopener noreferrer" title="repository" class="svelte-1vi4vvn">X(Twitter)</a> <a href="https://posfie.com/@ninja_no/p/Lx7FLj3" target="_blank" rel="noopener noreferrer" title="posfie" class="svelte-1vi4vvn">posfie(toggeter)</a></div> <div class="link link_right svelte-1vi4vvn"><a href="/stk_ygo_svelte/note.html" target="_blank" rel="noopener noreferrer" title="repository" class="svelte-1vi4vvn">ç¾æ™‚ç‚¹ã¨ã“ã®å…ˆã®ã“ã¨</a></div> <!> <div class="debug_info svelte-1vi4vvn"><span> </span> <span class="screen_info"></span></div></main>');function zu(i,e){We(e,!1);const t=new El("stk_ygo_svelte",Nu,Ou);let a=Oe(),r=Oe("None"),n=Oe(0);const s=Oa.getOrCreateNew(t);let c=Oe(ht.getAllDeckInfo(t).then(P=>(Promise.all(P.filter(G=>!G.lastUsedAt).map(G=>{G.saveDeckInfo()})),te(n,(P.find(G=>G.lastUsedAt.getTime()===Math.max(...P.map(A=>A.lastUsedAt.getTime())))??P[0]).id),P)));const u=async()=>{let P=(await v(c)).find(G=>G.id===v(n));if(P||(P=(await o()).find(G=>G.id===v(n))),!P)throw new Error("illegal state");return P},l=async()=>{const P=await s;console.log(P),P.save()},o=()=>(te(c,ht.getAllDeckInfo(t).then(P=>(te(n,(P.find(G=>G.lastUsedAt.getTime()===Math.max(...P.map(A=>A.lastUsedAt.getTime())))??P[0]).id),P))),v(c)),f=async()=>{(await v(c)).length||(await ht.prepareSampleDeck(),o())},p=async()=>{await Promise.all([l(),f()]);const P=await u(),G=await s;P.updateTimestamp();const A=mi.find(V=>V.id===G.previousNpcId);let fe=Lr.slice(-1)[0];A&&(A.id===-1&&(fe=Lr.find(V=>V.id===-1)??fe),console.log(A),te(a,new Ho(G,"Player",await u(),[],A,"NPC",fe,[],G.previousStartMode)))},h=async()=>{await Promise.all([l(),f()]),te(r,"DeckEdit")},y=async P=>{await l(),P.key==="Enter"&&!P.repeat&&(await s).save()};f(),it();var w=Gu(),_=m(g(w),4);{var S=P=>{Qd(P,{get duel(){return v(a)}})},E=P=>{var G=Fe(),A=re(G);{var fe=I=>{Mu(I,{})},V=I=>{var we=Zu(),Ue=g(we);yi(Ue,()=>s,ie=>{var M=Uu();b(ie,M)},(ie,M)=>{var k=ju(),H=re(k),Q=m(g(H),2),ce=m(H,2);yi(ce,()=>v(c),U=>{var K=$u();b(U,K)},(U,K)=>{var L=Hu(),R=re(L),z=m(g(R),2);x(()=>{v(n),Ui(()=>{v(K)})}),ve(z,5,()=>v(K),ue,(ne,se)=>{var he=qu(),xe={},Ge=g(he);x(()=>{xe!==(xe=v(se).id)&&(he.value=(he.__value=v(se).id)==null?"":v(se).id),D(Ge,v(se).name)}),b(ne,he)});var ee=m(R,2),Y=m(g(ee),2);x(()=>{v(M),Ui(()=>{})}),ve(Y,5,()=>mi,ue,(ne,se)=>{var he=Lu(),xe={},Ge=g(he);x(()=>{xe!==(xe=v(se).id)&&(he.value=(he.__value=v(se).id)==null?"":v(se).id),D(Ge,v(se).name)}),b(ne,he)});var Z=m(Y,2),J=g(Z),X=m(ee,2),B=m(g(X),2);x(()=>{v(M),Ui(()=>{})}),ve(B,5,()=>Fn(qr),ue,(ne,se)=>{var he=Ru(),xe={},Ge=g(he);x(()=>{xe!==(xe=v(se))&&(he.value=(he.__value=v(se))==null?"":v(se)),D(Ge,qr[v(se)])}),b(ne,he)});var W=m(X,2),ge=g(W);x(ne=>D(J,`â€»${ne??""}`),[()=>{var ne;return(ne=mi.find(se=>se.id===v(M).previousNpcId))==null?void 0:ne.description}],me),Zi(z,()=>v(n),ne=>te(n,ne)),Zi(Y,()=>v(M).previousNpcId,ne=>v(M).previousNpcId=ne),Zi(B,()=>v(M).previousStartMode,ne=>v(M).previousStartMode=ne),Le("click",ge,p),b(U,L)});var de=m(ce,2),q=g(de);Ma(Q,()=>v(M).name,U=>v(M).name=U),Le("keypress",Q,y),Le("click",q,h),b(ie,k)}),b(I,we)};j(A,I=>{v(r)==="DeckEdit"?I(fe):I(V,!1)},!0)}b(P,G)};j(_,P=>{v(a)?P(S):P(E,!1)})}var T=m(_,2),N=g(T),$=g(N);x(()=>D($,`build at: ${Bu.timestamp}`)),b(i,w),Ke()}il(zu,{target:document.getElementById("app")});
