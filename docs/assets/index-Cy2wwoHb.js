var as=Object.defineProperty;var ns=(i,e,t)=>e in i?as(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var d=(i,e,t)=>ns(i,typeof e!="symbol"?e+"":e,t);import{j as ss}from"./cardInfo.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function t(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(a){if(a.ep)return;a.ep=!0;const n=t(a);fetch(a.href,n)}})();const Zr=!1;var ca=Array.isArray,ls=Array.prototype.indexOf,da=Array.from,tn=Object.defineProperty,hi=Object.getOwnPropertyDescriptor,rn=Object.getOwnPropertyDescriptors,os=Object.prototype,cs=Array.prototype,ua=Object.getPrototypeOf;function ds(i){return typeof i=="function"}const _t=()=>{};function us(i){return typeof(i==null?void 0:i.then)=="function"}function fs(i){return i()}function Ur(i){for(var e=0;e<i.length;e++)i[e]()}const vt=2,an=4,_r=8,Sr=16,Bt=32,Hi=64,ar=128,ft=256,nr=512,it=1024,Ot=2048,ki=4096,Mt=8192,br=16384,nn=32768,wr=65536,sn=1<<17,vs=1<<19,ln=1<<20,Pt=Symbol("$state"),ps=Symbol("legacy props"),hs=Symbol("");function on(i){return i===this.v}function cn(i,e){return i!=i?e==e:i!==e||i!==null&&typeof i=="object"||typeof i=="function"}function fa(i){return!cn(i,this.v)}function gs(i){throw new Error("https://svelte.dev/e/effect_in_teardown")}function ys(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function ms(i){throw new Error("https://svelte.dev/e/effect_orphan")}function _s(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Ss(i){throw new Error("https://svelte.dev/e/props_invalid_value")}function bs(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function ws(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Cs(){throw new Error("https://svelte.dev/e/state_unsafe_local_read")}function ks(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let $i=!1,Ts=!1;function Es(){$i=!0}const va=1,pa=2,dn=4,Ds=8,As=16,xs=1,Ms=2,Ps=4,Fs=8,Bs=16,Os=1,qs=2,Ls=4,Ns=1,Rs=2,We=Symbol();let Ge=null;function sr(i){Ge=i}function Ke(i,e=!1,t){Ge={p:Ge,c:null,e:null,m:!1,s:i,x:null,l:null},$i&&!e&&(Ge.l={s:null,u:null,r1:[],r2:Ie(!1)})}function Qe(i){const e=Ge;if(e!==null){const s=e.e;if(s!==null){var t=Ae,r=Me;e.e=null;try{for(var a=0;a<s.length;a++){var n=s[a];ht(n.effect),pt(n.reaction),Di(n.fn)}}finally{ht(t),pt(r)}}Ge=e.p,e.m=!0}return{}}function Ti(){return!$i||Ge!==null&&Ge.l===null}function Ie(i,e){var t={f:0,v:i,reactions:null,equals:on,rv:0,wv:0};return t}function Hs(i){return un(Ie(i))}function Si(i,e=!1){var r;const t=Ie(i);return e||(t.equals=fa),$i&&Ge!==null&&Ge.l!==null&&((r=Ge.l).s??(r.s=[])).push(t),t}function Le(i,e=!1){return un(Si(i,e))}function un(i){return Me!==null&&!Ct&&Me.f&vt&&(Tt===null?Ks([i]):Tt.push(i)),i}function $e(i,e){return K(i,St(()=>v(i))),e}function K(i,e){return Me!==null&&!Ct&&Ti()&&Me.f&(vt|Sr)&&(Tt===null||!Tt.includes(i))&&ks(),$t(i,e)}function $t(i,e){return i.equals(e)||(i.v,i.v=e,i.wv=xn(),fn(i,Ot),Ti()&&Ae!==null&&Ae.f&it&&!(Ae.f&(Bt|Hi))&&(Dt===null?Qs([i]):Dt.push(i))),e}function fn(i,e){var t=i.reactions;if(t!==null)for(var r=Ti(),a=t.length,n=0;n<a;n++){var s=t[n],c=s.f;c&Ot||!r&&s===Ae||(Et(s,e),c&(it|ft)&&(c&vt?fn(s,ki):Dr(s)))}}let vn=!1;function Nt(i,e=null,t){if(typeof i!="object"||i===null||Pt in i)return i;const r=ua(i);if(r!==os&&r!==cs)return i;var a=new Map,n=ca(i),s=Ie(0);n&&a.set("length",Ie(i.length));var c;return new Proxy(i,{defineProperty(u,l,o){(!("value"in o)||o.configurable===!1||o.enumerable===!1||o.writable===!1)&&bs();var f=a.get(l);return f===void 0?(f=Ie(o.value),a.set(l,f)):K(f,Nt(o.value,c)),!0},deleteProperty(u,l){var o=a.get(l);if(o===void 0)l in u&&a.set(l,Ie(We));else{if(n&&typeof l=="string"){var f=a.get("length"),p=Number(l);Number.isInteger(p)&&p<f.v&&K(f,p)}K(o,We),Ea(s)}return!0},get(u,l,o){var m;if(l===Pt)return i;var f=a.get(l),p=l in u;if(f===void 0&&(!p||(m=hi(u,l))!=null&&m.writable)&&(f=Ie(Nt(p?u[l]:We,c)),a.set(l,f)),f!==void 0){var h=v(f);return h===We?void 0:h}return Reflect.get(u,l,o)},getOwnPropertyDescriptor(u,l){var o=Reflect.getOwnPropertyDescriptor(u,l);if(o&&"value"in o){var f=a.get(l);f&&(o.value=v(f))}else if(o===void 0){var p=a.get(l),h=p==null?void 0:p.v;if(p!==void 0&&h!==We)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return o},has(u,l){var h;if(l===Pt)return!0;var o=a.get(l),f=o!==void 0&&o.v!==We||Reflect.has(u,l);if(o!==void 0||Ae!==null&&(!f||(h=hi(u,l))!=null&&h.writable)){o===void 0&&(o=Ie(f?Nt(u[l],c):We),a.set(l,o));var p=v(o);if(p===We)return!1}return f},set(u,l,o,f){var P;var p=a.get(l),h=l in u;if(n&&l==="length")for(var m=o;m<p.v;m+=1){var w=a.get(m+"");w!==void 0?K(w,We):m in u&&(w=Ie(We),a.set(m+"",w))}p===void 0?(!h||(P=hi(u,l))!=null&&P.writable)&&(p=Ie(void 0),K(p,Nt(o,c)),a.set(l,p)):(h=p.v!==We,K(p,Nt(o,c)));var y=Reflect.getOwnPropertyDescriptor(u,l);if(y!=null&&y.set&&y.set.call(f,o),!h){if(n&&typeof l=="string"){var S=a.get("length"),T=Number(l);Number.isInteger(T)&&T>=S.v&&K(S,T+1)}Ea(s)}return!0},ownKeys(u){v(s);var l=Reflect.ownKeys(u).filter(p=>{var h=a.get(p);return h===void 0||h.v!==We});for(var[o,f]of a)f.v!==We&&!(o in u)&&l.push(o);return l},setPrototypeOf(){ws()}})}function Ea(i,e=1){K(i,i.v+e)}function Da(i){return i!==null&&typeof i=="object"&&Pt in i?i[Pt]:i}function pn(i,e){return Object.is(Da(i),Da(e))}var Aa,hn,gn,yn;function $s(){if(Aa===void 0){Aa=window,hn=/Firefox/.test(navigator.userAgent);var i=Element.prototype,e=Node.prototype;gn=hi(e,"firstChild").get,yn=hi(e,"nextSibling").get,i.__click=void 0,i.__className="",i.__attributes=null,i.__styles=null,i.__e=void 0,Text.prototype.__t=void 0}}function Cr(i=""){return document.createTextNode(i)}function lr(i){return gn.call(i)}function kr(i){return yn.call(i)}function g(i,e){return lr(i)}function le(i,e){{var t=lr(i);return t instanceof Comment&&t.data===""?kr(t):t}}function _(i,e=1,t=!1){let r=i;for(;e--;)r=kr(r);return r}function js(i){i.textContent=""}function It(i){var e=vt|Ot,t=Me!==null&&Me.f&vt?Me:null;return Ae===null||t!==null&&t.f&ft?e|=ft:Ae.f|=ln,{ctx:Ge,deps:null,effects:null,equals:on,f:e,fn:i,reactions:null,rv:0,v:null,wv:0,parent:t??Ae}}function Se(i){const e=It(i);return e.equals=fa,e}function mn(i){var e=i.effects;if(e!==null){i.effects=null;for(var t=0;t<e.length;t+=1)Ut(e[t])}}function Zs(i){for(var e=i.parent;e!==null;){if(!(e.f&vt))return e;e=e.parent}return null}function Us(i){var e,t=Ae;ht(Zs(i));try{mn(i),e=Pn(i)}finally{ht(t)}return e}function _n(i){var e=Us(i),t=(Ht||i.f&ft)&&i.deps!==null?ki:it;Et(i,t),i.equals(e)||(i.v=e,i.wv=xn())}function Sn(i){Ae===null&&Me===null&&ms(),Me!==null&&Me.f&ft&&Ae===null&&ys(),ya&&gs()}function Gs(i,e){var t=e.last;t===null?e.last=e.first=i:(t.next=i,i.prev=t,e.last=i)}function Ei(i,e,t,r=!0){var a=(i&Hi)!==0,n=Ae,s={ctx:Ge,deps:null,nodes_start:null,nodes_end:null,f:i|Ot,first:null,fn:e,last:null,next:null,parent:a?null:n,prev:null,teardown:null,transitions:null,wv:0};if(t){var c=gi;try{Ma(!0),ma(s),s.f|=nn}catch(o){throw Ut(s),o}finally{Ma(c)}}else e!==null&&Dr(s);var u=t&&s.deps===null&&s.first===null&&s.nodes_start===null&&s.teardown===null&&(s.f&(ln|ar))===0;if(!u&&!a&&r&&(n!==null&&Gs(s,n),Me!==null&&Me.f&vt)){var l=Me;(l.effects??(l.effects=[])).push(s)}return s}function ha(i){const e=Ei(_r,null,!1);return Et(e,it),e.teardown=i,e}function xa(i){Sn();var e=Ae!==null&&(Ae.f&Bt)!==0&&Ge!==null&&!Ge.m;if(e){var t=Ge;(t.e??(t.e=[])).push({fn:i,effect:Ae,reaction:Me})}else{var r=Di(i);return r}}function zs(i){return Sn(),ji(i)}function Vs(i){const e=Ei(Hi,i,!0);return(t={})=>new Promise(r=>{t.outro?Qt(e,()=>{Ut(e),r(void 0)}):(Ut(e),r(void 0))})}function Di(i){return Ei(an,i,!1)}function ji(i){return Ei(_r,i,!0)}function A(i,e=[],t=It){const r=e.map(t);return Tr(()=>i(...r.map(v)))}function Tr(i,e=0){return Ei(_r|Sr|e,i,!0)}function ei(i,e=!0){return Ei(_r|Bt,i,!0,e)}function bn(i){var e=i.teardown;if(e!==null){const t=ya,r=Me;Pa(!0),pt(null);try{e.call(null)}finally{Pa(t),pt(r)}}}function wn(i,e=!1){var t=i.first;for(i.first=i.last=null;t!==null;){var r=t.next;Ut(t,e),t=r}}function Ws(i){for(var e=i.first;e!==null;){var t=e.next;e.f&Bt||Ut(e),e=t}}function Ut(i,e=!0){var t=!1;if((e||i.f&vs)&&i.nodes_start!==null){for(var r=i.nodes_start,a=i.nodes_end;r!==null;){var n=r===a?null:kr(r);r.remove(),r=n}t=!0}wn(i,e&&!t),dr(i,0),Et(i,br);var s=i.transitions;if(s!==null)for(const u of s)u.stop();bn(i);var c=i.parent;c!==null&&c.first!==null&&Cn(i),i.next=i.prev=i.teardown=i.ctx=i.deps=i.fn=i.nodes_start=i.nodes_end=null}function Cn(i){var e=i.parent,t=i.prev,r=i.next;t!==null&&(t.next=r),r!==null&&(r.prev=t),e!==null&&(e.first===i&&(e.first=r),e.last===i&&(e.last=t))}function Qt(i,e){var t=[];ga(i,t,!0),kn(t,()=>{Ut(i),e&&e()})}function kn(i,e){var t=i.length;if(t>0){var r=()=>--t||e();for(var a of i)a.out(r)}else e()}function ga(i,e,t){if(!(i.f&Mt)){if(i.f^=Mt,i.transitions!==null)for(const s of i.transitions)(s.is_global||t)&&e.push(s);for(var r=i.first;r!==null;){var a=r.next,n=(r.f&wr)!==0||(r.f&Bt)!==0;ga(r,e,n?t:!1),r=a}}}function bi(i){Tn(i,!0)}function Tn(i,e){if(i.f&Mt){i.f^=Mt,i.f&it||(i.f^=it),Zi(i)&&(Et(i,Ot),Dr(i));for(var t=i.first;t!==null;){var r=t.next,a=(t.f&wr)!==0||(t.f&Bt)!==0;Tn(t,a?e:!1),t=r}if(i.transitions!==null)for(const n of i.transitions)(n.is_global||e)&&n.in()}}let or=!1,Gr=[];function En(){or=!1;const i=Gr.slice();Gr=[],Ur(i)}function ti(i){or||(or=!0,queueMicrotask(En)),Gr.push(i)}function Ys(){or&&En()}const Dn=0,Xs=1;let er=!1,tr=Dn,Li=!1,Ni=null,gi=!1,ya=!1;function Ma(i){gi=i}function Pa(i){ya=i}let Kt=[],yi=0;let Me=null,Ct=!1;function pt(i){Me=i}let Ae=null;function ht(i){Ae=i}let Tt=null;function Ks(i){Tt=i}let et=null,nt=0,Dt=null;function Qs(i){Dt=i}let An=1,cr=0,Ht=!1,Rt=null;function xn(){return++An}function Zi(i){var f;var e=i.f;if(e&Ot)return!0;if(e&ki){var t=i.deps,r=(e&ft)!==0;if(t!==null){var a,n,s=(e&nr)!==0,c=r&&Ae!==null&&!Ht,u=t.length;if(s||c){var l=i,o=l.parent;for(a=0;a<u;a++)n=t[a],(s||!((f=n==null?void 0:n.reactions)!=null&&f.includes(l)))&&(n.reactions??(n.reactions=[])).push(l);s&&(l.f^=nr),c&&o!==null&&!(o.f&ft)&&(l.f^=ft)}for(a=0;a<u;a++)if(n=t[a],Zi(n)&&_n(n),n.wv>i.wv)return!0}(!r||Ae!==null&&!Ht)&&Et(i,it)}return!1}function Js(i,e){for(var t=e;t!==null;){if(t.f&ar)try{t.fn(i);return}catch{t.f^=ar}t=t.parent}throw er=!1,i}function Is(i){return(i.f&br)===0&&(i.parent===null||(i.parent.f&ar)===0)}function Er(i,e,t,r){if(er){if(t===null&&(er=!1),Is(e))throw i;return}t!==null&&(er=!0);{Js(i,e);return}}function Mn(i,e,t=!0){var r=i.reactions;if(r!==null)for(var a=0;a<r.length;a++){var n=r[a];n.f&vt?Mn(n,e,!1):e===n&&(t?Et(n,Ot):n.f&it&&Et(n,ki),Dr(n))}}function Pn(i){var h;var e=et,t=nt,r=Dt,a=Me,n=Ht,s=Tt,c=Ge,u=Ct,l=i.f;et=null,nt=0,Dt=null,Me=l&(Bt|Hi)?null:i,Ht=(l&ft)!==0&&(!gi||a===null||u),Tt=null,sr(i.ctx),Ct=!1,cr++;try{var o=(0,i.fn)(),f=i.deps;if(et!==null){var p;if(dr(i,nt),f!==null&&nt>0)for(f.length=nt+et.length,p=0;p<et.length;p++)f[nt+p]=et[p];else i.deps=f=et;if(!Ht)for(p=nt;p<f.length;p++)((h=f[p]).reactions??(h.reactions=[])).push(i)}else f!==null&&nt<f.length&&(dr(i,nt),f.length=nt);if(Ti()&&Dt!==null&&!Ct&&f!==null&&!(i.f&(vt|ki|Ot)))for(p=0;p<Dt.length;p++)Mn(Dt[p],i);return a!==null&&cr++,o}finally{et=e,nt=t,Dt=r,Me=a,Ht=n,Tt=s,sr(c),Ct=u}}function el(i,e){let t=e.reactions;if(t!==null){var r=ls.call(t,i);if(r!==-1){var a=t.length-1;a===0?t=e.reactions=null:(t[r]=t[a],t.pop())}}t===null&&e.f&vt&&(et===null||!et.includes(e))&&(Et(e,ki),e.f&(ft|nr)||(e.f^=nr),mn(e),dr(e,0))}function dr(i,e){var t=i.deps;if(t!==null)for(var r=e;r<t.length;r++)el(i,t[r])}function ma(i){var e=i.f;if(!(e&br)){Et(i,it);var t=Ae,r=Ge;Ae=i;try{e&Sr?Ws(i):wn(i),bn(i);var a=Pn(i);i.teardown=typeof a=="function"?a:null,i.wv=An;var n=i.deps,s;Zr&&Ts&&i.f&Ot}catch(c){Er(c,i,t,r||i.ctx)}finally{Ae=t}}}function Fn(){if(yi>1e3){yi=0;try{_s()}catch(i){if(Ni!==null)Er(i,Ni,null);else throw i}}yi++}function Bn(i){var e=i.length;if(e!==0){Fn();var t=gi;gi=!0;try{for(var r=0;r<e;r++){var a=i[r];a.f&it||(a.f^=it);var n=rl(a);tl(n)}}finally{gi=t}}}function tl(i){var e=i.length;if(e!==0)for(var t=0;t<e;t++){var r=i[t];if(!(r.f&(br|Mt)))try{Zi(r)&&(ma(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null?Cn(r):r.fn=null))}catch(a){Er(a,r,null,r.ctx)}}}function il(){if(Li=!1,yi>1001)return;const i=Kt;Kt=[],Bn(i),Li||(yi=0,Ni=null)}function Dr(i){tr===Dn&&(Li||(Li=!0,queueMicrotask(il))),Ni=i;for(var e=i;e.parent!==null;){e=e.parent;var t=e.f;if(t&(Hi|Bt)){if(!(t&it))return;e.f^=it}}Kt.push(e)}function rl(i){var e=[],t=i.first;e:for(;t!==null;){var r=t.f,a=(r&Bt)!==0,n=a&&(r&it)!==0,s=t.next;if(!n&&!(r&Mt)){if(r&an)e.push(t);else if(a)t.f^=it;else{var c=Me;try{Me=t,Zi(t)&&ma(t)}catch(o){Er(o,t,null,t.ctx)}finally{Me=c}}var u=t.first;if(u!==null){t=u;continue}}if(s===null){let o=t.parent;for(;o!==null;){if(i===o)break e;var l=o.next;if(l!==null){t=l;continue e}o=o.parent}}t=s}return e}function _a(i){var e=tr,t=Kt;try{Fn();const a=[];tr=Xs,Kt=a,Li=!1,Bn(t);var r=i==null?void 0:i();return Ys(),(Kt.length>0||a.length>0)&&_a(),yi=0,Ni=null,r}finally{tr=e,Kt=t}}async function al(){await Promise.resolve(),_a()}function v(i){var e=i.f,t=(e&vt)!==0;if(Rt!==null&&Rt.add(i),Me!==null&&!Ct){Tt!==null&&Tt.includes(i)&&Cs();var r=Me.deps;i.rv<cr&&(i.rv=cr,et===null&&r!==null&&r[nt]===i?nt++:et===null?et=[i]:(!Ht||!et.includes(i))&&et.push(i))}else if(t&&i.deps===null&&i.effects===null){var a=i,n=a.parent;n!==null&&!(n.f&ft)&&(a.f^=ft)}return t&&(a=i,Zi(a)&&_n(a)),i.v}function nl(i){var e=Rt;Rt=new Set;var t=Rt,r;try{if(St(i),e!==null)for(r of Rt)e.add(r)}finally{Rt=e}return t}function ir(i){var e=nl(()=>St(i));for(var t of e)if(t.f&sn)for(const r of t.deps||[])r.f&vt||$t(r,r.v);else $t(t,t.v)}function St(i){var e=Ct;try{return Ct=!0,i()}finally{Ct=e}}const sl=-7169;function Et(i,e){i.f=i.f&sl|e}function ll(i){if(!(typeof i!="object"||!i||i instanceof EventTarget)){if(Pt in i)zr(i);else if(!Array.isArray(i))for(let e in i){const t=i[e];typeof t=="object"&&t&&Pt in t&&zr(t)}}}function zr(i,e=new Set){if(typeof i=="object"&&i!==null&&!(i instanceof EventTarget)&&!e.has(i)){e.add(i),i instanceof Date&&i.getTime();for(let r in i)try{zr(i[r],e)}catch{}const t=ua(i);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const r=rn(t);for(let a in r){const n=r[a].get;if(n)try{n.call(i)}catch{}}}}}const ol=["touchstart","touchmove"];function cl(i){return ol.includes(i)}let Fa=!1;function dl(){Fa||(Fa=!0,document.addEventListener("reset",i=>{Promise.resolve().then(()=>{var e;if(!i.defaultPrevented)for(const t of i.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function Sa(i){var e=Me,t=Ae;pt(null),ht(null);try{return i()}finally{pt(e),ht(t)}}function Ar(i,e,t,r=t){i.addEventListener(e,()=>Sa(t));const a=i.__on_r;a?i.__on_r=()=>{a(),r(!0)}:i.__on_r=()=>r(!0),dl()}const On=new Set,Vr=new Set;function ul(i,e,t,r={}){function a(n){if(r.capture||xi.call(e,n),!n.cancelBubble)return Sa(()=>t==null?void 0:t.call(this,n))}return i.startsWith("pointer")||i.startsWith("touch")||i==="wheel"?ti(()=>{e.addEventListener(i,a,r)}):e.addEventListener(i,a,r),a}function je(i,e,t,r,a){var n={capture:r,passive:a},s=ul(i,e,t,n);(e===document.body||e===window||e===document)&&ha(()=>{e.removeEventListener(i,s,n)})}function Ui(i){for(var e=0;e<i.length;e++)On.add(i[e]);for(var t of Vr)t(i)}function xi(i){var T;var e=this,t=e.ownerDocument,r=i.type,a=((T=i.composedPath)==null?void 0:T.call(i))||[],n=a[0]||i.target,s=0,c=i.__root;if(c){var u=a.indexOf(c);if(u!==-1&&(e===document||e===window)){i.__root=e;return}var l=a.indexOf(e);if(l===-1)return;u<=l&&(s=u)}if(n=a[s]||i.target,n!==e){tn(i,"currentTarget",{configurable:!0,get(){return n||t}});var o=Me,f=Ae;pt(null),ht(null);try{for(var p,h=[];n!==null;){var m=n.assignedSlot||n.parentNode||n.host||null;try{var w=n["__"+r];if(w!==void 0&&!n.disabled)if(ca(w)){var[y,...S]=w;y.apply(n,[i,...S])}else w.call(n,i)}catch(P){p?h.push(P):p=P}if(i.cancelBubble||m===e||m===null)break;n=m}if(p){for(let P of h)queueMicrotask(()=>{throw P});throw p}}finally{i.__root=e,delete i.currentTarget,pt(o),ht(f)}}}function fl(i){var e=document.createElement("template");return e.innerHTML=i,e.content}function ur(i,e){var t=Ae;t.nodes_start===null&&(t.nodes_start=i,t.nodes_end=e)}function C(i,e){var t=(e&Ns)!==0,r=(e&Rs)!==0,a,n=!i.startsWith("<!>");return()=>{a===void 0&&(a=fl(n?i:"<!>"+i),t||(a=lr(a)));var s=r||hn?document.importNode(a,!0):a.cloneNode(!0);if(t){var c=lr(s),u=s.lastChild;ur(c,u)}else ur(s,s);return s}}function Wt(i=""){{var e=Cr(i+"");return ur(e,e),e}}function Be(){var i=document.createDocumentFragment(),e=document.createComment(""),t=Cr();return i.append(e,t),ur(e,t),i}function b(i,e){i!==null&&i.before(e)}let Wr=!0;function E(i,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(i.__t??(i.__t=i.nodeValue))&&(i.__t=t,i.nodeValue=t+"")}function vl(i,e){return pl(i,e)}const ci=new Map;function pl(i,{target:e,anchor:t,props:r={},events:a,context:n,intro:s=!0}){$s();var c=new Set,u=f=>{for(var p=0;p<f.length;p++){var h=f[p];if(!c.has(h)){c.add(h);var m=cl(h);e.addEventListener(h,xi,{passive:m});var w=ci.get(h);w===void 0?(document.addEventListener(h,xi,{passive:m}),ci.set(h,1)):ci.set(h,w+1)}}};u(da(On)),Vr.add(u);var l=void 0,o=Vs(()=>{var f=t??e.appendChild(Cr());return ei(()=>{if(n){Ke({});var p=Ge;p.c=n}a&&(r.$$events=a),Wr=s,l=i(f,r)||{},Wr=!0,n&&Qe()}),()=>{var m;for(var p of c){e.removeEventListener(p,xi);var h=ci.get(p);--h===0?(document.removeEventListener(p,xi),ci.delete(p)):ci.set(p,h)}Vr.delete(u),f!==t&&((m=f.parentNode)==null||m.removeChild(f))}});return hl.set(l,o),l}let hl=new WeakMap;const qr=0,Ki=1,Lr=2;function Mi(i,e,t,r,a){var n=i,s=Ti(),c=Ge,u=We,l,o,f,p=(s?Ie:Si)(void 0),h=(s?Ie:Si)(void 0),m=!1;function w(S,T){m=!0,T&&(ht(y),pt(y),sr(c));try{S===qr&&t&&(l?bi(l):l=ei(()=>t(n))),S===Ki&&r&&(o?bi(o):o=ei(()=>r(n,p))),S!==qr&&l&&Qt(l,()=>l=null),S!==Ki&&o&&Qt(o,()=>o=null),S!==Lr&&f&&Qt(f,()=>f=null)}finally{T&&(sr(null),pt(null),ht(null),_a())}}var y=Tr(()=>{if(u!==(u=e())){if(us(u)){var S=u;m=!1,S.then(T=>{S===u&&($t(p,T),w(Ki,!0))},T=>{if(S===u)throw $t(h,T),w(Lr,!0),h.v}),ti(()=>{m||w(qr,!0)})}else $t(p,u),w(Ki,!1);return()=>u=We}})}function H(i,e,t=!1){var r=i,a=null,n=null,s=We,c=t?wr:0,u=!1;const l=(f,p=!0)=>{u=!0,o(p,f)},o=(f,p)=>{s!==(s=f)&&(s?(a?bi(a):p&&(a=ei(()=>p(r))),n&&Qt(n,()=>{n=null})):(n?bi(n):p&&(n=ei(()=>p(r))),a&&Qt(a,()=>{a=null})))};Tr(()=>{u=!1,e(l),u||o(null,null)},c)}function de(i,e){return e}function gl(i,e,t,r){for(var a=[],n=e.length,s=0;s<n;s++)ga(e[s].e,a,!0);var c=n>0&&a.length===0&&t!==null;if(c){var u=t.parentNode;js(u),u.append(t),r.clear(),qt(i,e[0].prev,e[n-1].next)}kn(a,()=>{for(var l=0;l<n;l++){var o=e[l];c||(r.delete(o.k),qt(i,o.prev,o.next)),Ut(o.e,!c)}})}function ue(i,e,t,r,a,n=null){var s=i,c={flags:e,items:new Map,first:null},u=(e&dn)!==0;if(u){var l=i;s=l.appendChild(Cr())}var o=null,f=!1,p=Se(()=>{var h=t();return ca(h)?h:h==null?[]:da(h)});Tr(()=>{var h=v(p),m=h.length;f&&m===0||(f=m===0,yl(h,c,s,a,e,r,t),n!==null&&(m===0?o?bi(o):o=ei(()=>n(s)):o!==null&&Qt(o,()=>{o=null})),v(p))})}function yl(i,e,t,r,a,n,s){var J,F,G,oe;var c=(a&Ds)!==0,u=(a&(va|pa))!==0,l=i.length,o=e.items,f=e.first,p=f,h,m=null,w,y=[],S=[],T,P,O,k;if(c)for(k=0;k<l;k+=1)T=i[k],P=n(T,k),O=o.get(P),O!==void 0&&((J=O.a)==null||J.measure(),(w??(w=new Set)).add(O));for(k=0;k<l;k+=1){if(T=i[k],P=n(T,k),O=o.get(P),O===void 0){var D=p?p.e.nodes_start:t;m=_l(D,e,m,m===null?e.first:m.next,T,P,k,r,a,s),o.set(P,m),y=[],S=[],p=m.next;continue}if(u&&ml(O,T,k,a),O.e.f&Mt&&(bi(O.e),c&&((F=O.a)==null||F.unfix(),(w??(w=new Set)).delete(O))),O!==p){if(h!==void 0&&h.has(O)){if(y.length<S.length){var L=S[0],M;m=L.prev;var Q=y[0],j=y[y.length-1];for(M=0;M<y.length;M+=1)Ba(y[M],L,t);for(M=0;M<S.length;M+=1)h.delete(S[M]);qt(e,Q.prev,j.next),qt(e,m,Q),qt(e,j,L),p=L,m=j,k-=1,y=[],S=[]}else h.delete(O),Ba(O,p,t),qt(e,O.prev,O.next),qt(e,O,m===null?e.first:m.next),qt(e,m,O),m=O;continue}for(y=[],S=[];p!==null&&p.k!==P;)p.e.f&Mt||(h??(h=new Set)).add(p),S.push(p),p=p.next;if(p===null)continue;O=p}y.push(O),m=O,p=O.next}if(p!==null||h!==void 0){for(var Y=h===void 0?[]:da(h);p!==null;)p.e.f&Mt||Y.push(p),p=p.next;var _e=Y.length;if(_e>0){var Pe=a&dn&&l===0?t:null;if(c){for(k=0;k<_e;k+=1)(G=Y[k].a)==null||G.measure();for(k=0;k<_e;k+=1)(oe=Y[k].a)==null||oe.fix()}gl(e,Y,Pe,o)}}c&&ti(()=>{var x;if(w!==void 0)for(O of w)(x=O.a)==null||x.apply()}),Ae.first=e.first&&e.first.e,Ae.last=m&&m.e}function ml(i,e,t,r){r&va&&$t(i.v,e),r&pa?$t(i.i,t):i.i=t}function _l(i,e,t,r,a,n,s,c,u,l){var o=(u&va)!==0,f=(u&As)===0,p=o?f?Si(a):Ie(a):a,h=u&pa?Ie(s):s,m={i:h,v:p,k:n,a:null,e:null,prev:t,next:r};try{return m.e=ei(()=>c(i,p,h,l),vn),m.e.prev=t&&t.e,m.e.next=r&&r.e,t===null?e.first=m:(t.next=m,t.e.next=m.e),r!==null&&(r.prev=m,r.e.prev=m.e),m}finally{}}function Ba(i,e,t){for(var r=i.next?i.next.e.nodes_start:t,a=e?e.e.nodes_start:t,n=i.e.nodes_start;n!==r;){var s=kr(n);a.before(n),n=s}}function qt(i,e,t){e===null?i.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function qn(i){var e,t,r="";if(typeof i=="string"||typeof i=="number")r+=i;else if(typeof i=="object")if(Array.isArray(i)){var a=i.length;for(e=0;e<a;e++)i[e]&&(t=qn(i[e]))&&(r&&(r+=" "),r+=t)}else for(t in i)i[t]&&(r&&(r+=" "),r+=t);return r}function Sl(){for(var i,e,t=0,r="",a=arguments.length;t<a;t++)(i=arguments[t])&&(e=qn(i))&&(r&&(r+=" "),r+=e);return r}function di(i){return typeof i=="object"?Sl(i):i??""}function Ft(i,e,t,r){var a=i.__attributes??(i.__attributes={});a[e]!==(a[e]=t)&&(e==="style"&&"__styles"in i&&(i.__styles={}),e==="loading"&&(i[hs]=t),t==null?i.removeAttribute(e):typeof t!="string"&&bl(i).includes(e)?i[e]=t:i.setAttribute(e,t))}var Oa=new Map;function bl(i){var e=Oa.get(i.nodeName);if(e)return e;Oa.set(i.nodeName,e=[]);for(var t,r=i,a=Element.prototype;a!==r;){t=rn(r);for(var n in t)t[n].set&&e.push(n);r=ua(r)}return e}function ye(i,e,t){var r=i.__className,a=wl(e,t);(r!==a||vn)&&(e==null&&!t?i.removeAttribute("class"):i.className=a,i.__className=a)}function wl(i,e){return(i??"")+(e?" "+e:"")}const Cl=()=>performance.now(),xt={tick:i=>requestAnimationFrame(i),now:()=>Cl(),tasks:new Set};function Ln(){const i=xt.now();xt.tasks.forEach(e=>{e.c(i)||(xt.tasks.delete(e),e.f())}),xt.tasks.size!==0&&xt.tick(Ln)}function kl(i){let e;return xt.tasks.size===0&&xt.tick(Ln),{promise:new Promise(t=>{xt.tasks.add(e={c:i,f:t})}),abort(){xt.tasks.delete(e)}}}function Qi(i,e){Sa(()=>{i.dispatchEvent(new CustomEvent(e))})}function Tl(i){if(i==="float")return"cssFloat";if(i==="offset")return"cssOffset";if(i.startsWith("--"))return i;const e=i.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function qa(i){const e={},t=i.split(";");for(const r of t){const[a,n]=r.split(":");if(!a||n===void 0)break;const s=Tl(a.trim());e[s]=n.trim()}return e}const El=i=>i;function ui(i,e,t,r){var a=(i&Os)!==0,n=(i&qs)!==0,s=a&&n,c=(i&Ls)!==0,u=s?"both":a?"in":"out",l,o=e.inert,f=e.style.overflow,p,h;function m(){var P=Me,O=Ae;pt(null),ht(null);try{return l??(l=t()(e,(r==null?void 0:r())??{},{direction:u}))}finally{pt(P),ht(O)}}var w={is_global:c,in(){var P;if(e.inert=o,!a){h==null||h.abort(),(P=h==null?void 0:h.reset)==null||P.call(h);return}n||p==null||p.abort(),Qi(e,"introstart"),p=Yr(e,m(),h,1,()=>{Qi(e,"introend"),p==null||p.abort(),p=l=void 0,e.style.overflow=f})},out(P){if(!n){P==null||P(),l=void 0;return}e.inert=!0,Qi(e,"outrostart"),h=Yr(e,m(),p,0,()=>{Qi(e,"outroend"),P==null||P()})},stop:()=>{p==null||p.abort(),h==null||h.abort()}},y=Ae;if((y.transitions??(y.transitions=[])).push(w),a&&Wr){var S=c;if(!S){for(var T=y.parent;T&&T.f&wr;)for(;(T=T.parent)&&!(T.f&Sr););S=!T||(T.f&nn)!==0}S&&Di(()=>{St(()=>w.in())})}}function Yr(i,e,t,r,a){var n=r===1;if(ds(e)){var s,c=!1;return ti(()=>{if(!c){var y=e({direction:n?"in":"out"});s=Yr(i,y,t,r,a)}}),{abort:()=>{c=!0,s==null||s.abort()},deactivate:()=>s.deactivate(),reset:()=>s.reset(),t:()=>s.t()}}if(t==null||t.deactivate(),!(e!=null&&e.duration))return a(),{abort:_t,deactivate:_t,reset:_t,t:()=>r};const{delay:u=0,css:l,tick:o,easing:f=El}=e;var p=[];if(n&&t===void 0&&(o&&o(0,1),l)){var h=qa(l(0,1));p.push(h,h)}var m=()=>1-r,w=i.animate(p,{duration:u});return w.onfinish=()=>{var y=(t==null?void 0:t.t())??1-r;t==null||t.abort();var S=r-y,T=e.duration*Math.abs(S),P=[];if(T>0){var O=!1;if(l)for(var k=Math.ceil(T/16.666666666666668),D=0;D<=k;D+=1){var L=y+S*f(D/k),M=qa(l(L,1-L));P.push(M),O||(O=M.overflow==="hidden")}O&&(i.style.overflow="hidden"),m=()=>{var Q=w.currentTime;return y+S*f(Q/T)},o&&kl(()=>{if(w.playState!=="running")return!1;var Q=m();return o(Q,1-Q),!0})}w=i.animate(P,{duration:T,fill:"forwards"}),w.onfinish=()=>{m=()=>r,o==null||o(r,1-r),a()}},{abort:()=>{w&&(w.cancel(),w.effect=null,w.onfinish=_t)},deactivate:()=>{a=_t},reset:()=>{r===0&&(o==null||o(1,0))},t:()=>m()}}function Xr(i,e,t=e){var r=Ti();Ar(i,"input",a=>{var n=a?i.defaultValue:i.value;if(n=Rr(i)?Hr(n):n,t(n),r&&n!==(n=e())){var s=i.selectionStart,c=i.selectionEnd;i.value=n??"",c!==null&&(i.selectionStart=s,i.selectionEnd=Math.min(c,i.value.length))}}),St(e)==null&&i.value&&t(Rr(i)?Hr(i.value):i.value),ji(()=>{var a=e();Rr(i)&&a===Hr(i.value)||i.type==="date"&&!a&&!i.value||a!==i.value&&(i.value=a??"")})}const Nr=new Set;function fi(i,e,t,r,a=r){var n=t.getAttribute("type")==="checkbox",s=i;if(e!==null)for(var c of e)s=s[c]??(s[c]=[]);s.push(t),Ar(t,"change",()=>{var u=t.__value;n&&(u=Al(s,u,t.checked)),a(u)},()=>a(n?[]:null)),ji(()=>{var u=r();n?(u=u||[],t.checked=u.includes(t.__value)):t.checked=pn(t.__value,u)}),ha(()=>{var u=s.indexOf(t);u!==-1&&s.splice(u,1)}),Nr.has(s)||(Nr.add(s),ti(()=>{s.sort((u,l)=>u.compareDocumentPosition(l)===4?-1:1),Nr.delete(s)})),ti(()=>{})}function Dl(i,e,t=e){Ar(i,"change",r=>{var a=r?i.defaultChecked:i.checked;t(a)}),St(e)==null&&t(i.checked),ji(()=>{var r=e();i.checked=!!r})}function Al(i,e,t){for(var r=new Set,a=0;a<i.length;a+=1)i[a].checked&&r.add(i[a].__value);return t||r.delete(e),Array.from(r)}function Rr(i){var e=i.type;return e==="number"||e==="range"}function Hr(i){return i===""?null:+i}function Nn(i,e,t){if(i.multiple)return Ml(i,e);for(var r of i.options){var a=Pi(r);if(pn(a,e)){r.selected=!0;return}}(!t||e!==void 0)&&(i.selectedIndex=-1)}function xl(i,e){Di(()=>{var t=new MutationObserver(()=>{var r=i.__value;Nn(i,r)});return t.observe(i,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{t.disconnect()}})}function rr(i,e,t=e){var r=!0;Ar(i,"change",a=>{var n=a?"[selected]":":checked",s;if(i.multiple)s=[].map.call(i.querySelectorAll(n),Pi);else{var c=i.querySelector(n)??i.querySelector("option:not([disabled])");s=c&&Pi(c)}t(s)}),Di(()=>{var a=e();if(Nn(i,a,r),r&&a===void 0){var n=i.querySelector(":checked");n!==null&&(a=Pi(n),t(a))}i.__value=a,r=!1}),xl(i)}function Ml(i,e){for(var t of i.options)t.selected=~e.indexOf(Pi(t))}function Pi(i){return"__value"in i?i.__value:i.value}function La(i,e){return i===e||(i==null?void 0:i[Pt])===e}function Pl(i={},e,t,r){return Di(()=>{var a,n;return ji(()=>{a=n,n=[],St(()=>{i!==t(...n)&&(e(i,...n),a&&La(t(...a),i)&&e(null,...a))})}),()=>{ti(()=>{n&&La(t(...n),i)&&e(null,...n)})}}),i}function ot(i=!1){const e=Ge,t=e.l.u;if(!t)return;let r=()=>ll(e.s);if(i){let a=0,n={};const s=It(()=>{let c=!1;const u=e.s;for(const l in u)u[l]!==n[l]&&(n[l]=u[l],c=!0);return c&&a++,a});r=()=>v(s)}t.b.length&&zs(()=>{Na(e,r),Ur(t.b)}),xa(()=>{const a=St(()=>t.m.map(fs));return()=>{for(const n of a)typeof n=="function"&&n()}}),t.a.length&&xa(()=>{Na(e,r),Ur(t.a)})}function Na(i,e){if(i.l.s)for(const t of i.l.s)v(t);e()}function Rn(i,e,t){if(i==null)return e(void 0),_t;const r=St(()=>i.subscribe(e,t));return r.unsubscribe?()=>r.unsubscribe():r}const vi=[];function Fl(i,e=_t){let t=null;const r=new Set;function a(c){if(cn(i,c)&&(i=c,t)){const u=!vi.length;for(const l of r)l[1](),vi.push(l,i);if(u){for(let l=0;l<vi.length;l+=2)vi[l][0](vi[l+1]);vi.length=0}}}function n(c){a(c(i))}function s(c,u=_t){const l=[c,u];return r.add(l),r.size===1&&(t=e(a,n)||_t),c(i),()=>{r.delete(l),r.size===0&&t&&(t(),t=null)}}return{set:a,update:n,subscribe:s}}function Bl(i){let e;return Rn(i,t=>e=t)(),e}let Ji=!1,Kr=Symbol();function Ol(i,e,t){const r=t[e]??(t[e]={store:null,source:Si(void 0),unsubscribe:_t});if(r.store!==i&&!(Kr in t))if(r.unsubscribe(),r.store=i??null,i==null)r.source.v=void 0,r.unsubscribe=_t;else{var a=!0;r.unsubscribe=Rn(i,n=>{a?r.source.v=n:K(r.source,n)}),a=!1}return i&&Kr in t?Bl(i):v(r.source)}function ql(){const i={};function e(){ha(()=>{for(var t in i)i[t].unsubscribe();tn(i,Kr,{enumerable:!1,value:!0})})}return[i,e]}function Ll(i){var e=Ji;try{return Ji=!1,[i(),Ji]}finally{Ji=e}}function xe(i,e,t,r){var L;var a=(t&xs)!==0,n=!$i||(t&Ms)!==0,s=(t&Fs)!==0,c=(t&Bs)!==0,u=!1,l;s?[l,u]=Ll(()=>i[e]):l=i[e];var o=Pt in i||ps in i,f=s&&(((L=hi(i,e))==null?void 0:L.set)??(o&&e in i&&(M=>i[e]=M)))||void 0,p=r,h=!0,m=!1,w=()=>(m=!0,h&&(h=!1,c?p=St(r):p=r),p);l===void 0&&r!==void 0&&(f&&n&&Ss(),l=w(),f&&f(l));var y;if(n)y=()=>{var M=i[e];return M===void 0?w():(h=!0,m=!1,M)};else{var S=(a?It:Se)(()=>i[e]);S.f|=sn,y=()=>{var M=v(S);return M!==void 0&&(p=void 0),M===void 0?p:M}}if(!(t&Ps))return y;if(f){var T=i.$$legacy;return function(M,Q){return arguments.length>0?((!n||!Q||T||u)&&f(Q?y():M),M):y()}}var P=!1,O=!1,k=Si(l),D=It(()=>{var M=y(),Q=v(k);return P?(P=!1,O=!0,Q):(O=!1,k.v=M)});return a||(D.equals=fa),function(M,Q){if(Rt!==null&&(P=O,y(),v(k)),arguments.length>0){const j=Q?v(D):n&&s?Nt(M):M;return D.equals(j)||(P=!0,K(k,j),m&&p!==void 0&&(p=j),St(()=>v(D))),M}return v(D)}}const Nl="5";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Nl);Es();class Rl{constructor(e,t,r){d(this,"_dbname");d(this,"_dbversion");d(this,"dbPromise");d(this,"getTran",async(e,t)=>(await this.dbPromise).transaction(e,t));d(this,"reset",async()=>(await indexedDB.databases().then(e=>{console.log(e)}),await new Promise((e,t)=>{const r=indexedDB.deleteDatabase(this._dbname);r.onsuccess=()=>{console.log("onsuccess"),e()},r.onerror=a=>{console.log("onerror"),t(a)}})));d(this,"getAll",async e=>{const t=await this.dbPromise;return new Promise((r,a)=>{const c=t.transaction([e],"readonly").objectStore(e).getAll();c.onsuccess=()=>{r(c.result)},c.onerror=u=>{a(u)}})});d(this,"get",async(e,t)=>{const r=await this.dbPromise;return new Promise((a,n)=>{const u=r.transaction([e],"readonly").objectStore(e).get(t);u.onsuccess=()=>{a(u.result)},u.onerror=l=>{n(l)}})});d(this,"getMany",async(e,t)=>{const n=(await this.dbPromise).transaction([e],"readonly").objectStore(e),s=t.map(c=>new Promise((u,l)=>{const o=n.get(c);o.onsuccess=()=>{u(o.result)},o.onerror=f=>{l(f)}}));return await Promise.all(s)});d(this,"putRecords",async(e,t)=>{const a=(await this.dbPromise).transaction([e],"readwrite"),n=a.objectStore(e),s=t.map(c=>({record:c,request:n.put(c)}));return new Promise((c,u)=>{a.oncomplete=()=>c(s.map(l=>Object.assign({id:l.request.result},l.record))),a.onerror=l=>u(l)})});d(this,"deleteRecords",async(e,t)=>{const a=(await this.dbPromise).transaction([e],"readwrite"),n=a.objectStore(e),s=t.map(c=>({key:c,request:n.delete(c)}));return new Promise((c,u)=>{a.oncomplete=()=>{console.log(s.map(l=>l.request.result)),c()},a.onerror=l=>u(l)})});this._dbname=e,this._dbversion=t,this.dbPromise=new Promise((a,n)=>{const s=indexedDB.open(e,t);s.onsuccess=c=>{if(console.log(c),!c.target){console.log("event.target is undefined"),n("event.target is undefined");return}const u=c.target.result;if(!u){console.log("event.target.result is undefined"),n("event.target.result is undefined");return}u.onversionchange=l=>{console.log(l),u.close()},a(u)},s.onupgradeneeded=c=>{console.log("onupgradeneeded");const u=c.target.result;r.filter(l=>!u.objectStoreNames.contains(l)).map(l=>u.createObjectStore(l,{keyPath:"id",autoIncrement:!0}))},s.onerror=c=>{console.log(c),n(c)},s.onblocked=c=>{console.log(c),n(c)}}),console.log(this.dbPromise)}get dbversion(){return this._dbversion}}class ze{constructor(){d(this,"handlers",[])}append(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}trigger(e){this.handlers.slice(0).filter(t=>t(e)==="RemoveMe").forEach(t=>this.remove(t))}clear(){this.handlers.splice(0)}expose(){return this}}class Ra{constructor(){d(this,"handlers",[])}append(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}async trigger(e){const t=await Promise.all(this.handlers.slice(0).map(async r=>{const a=await r(e);return{h:r,result:a}}));console.log(t),t.filter(r=>r.result==="RemoveMe").map(r=>r.h).forEach(r=>this.remove(r))}clear(){this.handlers.splice(0)}expose(){return this}}class Ha{constructor(){d(this,"handler")}set(e){this.handler=e}async call(e){if(!this.handler)throw Error("illegal state error");return await this.handler(e)}expose(){return this}}class ba{constructor(e,t,r,a){d(this,"_name");d(this,"_createVersion");d(this,"mountResolver",()=>{});d(this,"_indexedDb");d(this,"onInsertEvent",new ze);d(this,"onBeforeInsertEvent",new Ha);d(this,"onUpdateEvent",new ze);d(this,"onBeforeUpdateEvent",new Ha);d(this,"onDeleteEvent",new ze);d(this,"prepareInitialRecords",()=>{const e=new Date;return this._prepareInitialRecords().map(t=>Object.assign(t,{createdAt:e,updatedAt:e,dbVersion:this._createVersion}))});d(this,"resolveMount",()=>this.mountResolver());d(this,"patchForInsert",(e,t)=>{e.newRecords.forEach(r=>{t[r.id]=r})});d(this,"patchForUpdate",(e,t)=>{e.recordPairs.forEach(r=>{t[r.newRecord.id]={...r.newRecord}})});d(this,"patchForDelete",(e,t)=>{e.oldRecords.forEach(r=>{delete t[r.id]})});this._indexedDb=e,this._name=t,this._createVersion=e.dbversion,this.getAll().then(n=>n.reduce((s,c)=>(s[c.id]=c,s),{})).then(n=>{console.log(this.name,n),this.onBeforeInsertEvent.set(r??(()=>Promise.resolve())),this.onBeforeUpdateEvent.set(a??(()=>Promise.resolve()))})}get name(){return this._name}get createVersion(){return this._createVersion}get oninsert(){return this.onInsertEvent.expose()}get onbeforeinsert(){return this.onBeforeInsertEvent.expose()}get onupdate(){return this.onUpdateEvent.expose()}get onbeforeupdate(){return this.onBeforeUpdateEvent.expose()}get ondelete(){return this.onDeleteEvent.expose()}getAll(){return this._indexedDb.getAll(this.name)}get(e){return this._indexedDb.get(this.name,e)}async insertMany(e){const t=new Date,r=e.map(n=>{const s={createdAt:t,updatedAt:t,dbVersion:this._createVersion};return Object.assign(n,s)});await this.onBeforeInsertEvent.call({sender:this,newRecords:r,timestamp:t});const a=await this._indexedDb.putRecords(this.name,r);return this.onInsertEvent.trigger({sender:this,newRecords:a,timestamp:t}),a}async insert(e){return(await this.insertMany([e]))[0]}async updateMany(e,t){const r=new Date,a=[];return(await this._indexedDb.getMany(this.name,e)).forEach(s=>{const c={...s},u={...c};a.push({newRecord:Object.assign(t(u),{updatedAt:r,dbVersion:this._createVersion}),oldRecord:c})}),await this.onBeforeUpdateEvent.call({sender:this,recordPairs:a,timestamp:r}),await this._indexedDb.putRecords(this.name,a.map(s=>s.newRecord)),this.onUpdateEvent.trigger({sender:this,recordPairs:a,timestamp:r}),a.map(s=>s.newRecord)}async update(e,t){return(await this.updateMany([e],t))[0]}async delete(e){const t=new Date,r=await this._indexedDb.getMany(this.name,e);await this._indexedDb.deleteRecords(this.name,e),this.onDeleteEvent.trigger({sender:this,oldRecords:r,timestamp:t})}}const Hl=["Deck","ExtraDeck"],$l={Deck:"„É°„Ç§„É≥„Éá„ÉÉ„Ç≠",ExtraDeck:"„Ç®„ÇØ„Çπ„Éà„É©„Éá„ÉÉ„Ç≠"},Qr=["Monster","Spell","Trap","XyzMaterial"],Hn={Monster:"„É¢„É≥„Çπ„Çø„Éº",Spell:"È≠îÊ≥ï",Trap:"ÁΩ†",XyzMaterial:"XYZÁ¥†Êùê"},wi=["Fusion","Syncro","Xyz","Link"],$n=[...wi,"SpecialSummon","Ritual"],jl=["Toon","Spirit","Union","Gemini","FlipEffect"],Zl=["Tuner","Effect","Normal","Pendulum","Token","NormalSummonOnly","RegularSpecialSummonOnly"],$a=[...$n,...jl,...Zl],xr={Syncro:"„Ç∑„É≥„ÇØ„É≠",Fusion:"ËûçÂêà",Xyz:"„Ç®„ÇØ„Ç∑„Éº„Ç∫",Link:"„É™„É≥„ÇØ",Ritual:"ÂÑÄÂºè",SpecialSummon:"ÁâπÊÆäÂè¨Âñö",Toon:"„Éà„Ç•„Éº„É≥",Spirit:"„Çπ„Éî„É™„ÉÉ„Éà",Union:"„É¶„Éã„Ç™„É≥",Gemini:"„Éá„É•„Ç¢„É´",FlipEffect:"„É™„Éê„Éº„Çπ",Tuner:"„ÉÅ„É•„Éº„Éä„Éº",Effect:"ÂäπÊûú",Normal:"ÈÄöÂ∏∏",Pendulum:"„Éö„É≥„Éá„É•„É©„É†",Token:"„Éà„Éº„ÇØ„É≥",NormalSummonOnly:"ÁâπÊÆäÂè¨Âñö‰∏çÂèØ",RegularSpecialSummonOnly:"Ê≠£Ë¶èÁâπÊÆäÂè¨Âñö„ÅÆ„Åø"},Gi={Syncro:"üéµ",Fusion:"üåÄ",Xyz:"üì∞",Link:"‚õìÔ∏è",Ritual:"üìú",SpecialSummon:"üîØ",Toon:"üìñ",Spirit:"üëª",Union:"üöó",Gemini:"üë´",FlipEffect:"üîÑ",Tuner:"üé∂",Effect:"‚ú®",Normal:"üîò",Pendulum:"üí†",Token:"üêè",NormalSummonOnly:"üî≤",RegularSpecialSummonOnly:"‚ùó"},ja=["Light","Dark","Earth","Water","Fire","Wind","Divine"],wa={Light:"ÂÖâ",Dark:"Èóá",Earth:"Âú∞",Water:"Ê∞¥",Fire:"ÁÇé",Wind:"È¢®",Divine:"Á•û"},Za=["Aqua","Beast","BeastWarrior","CreatorGod","Cyberse","Dinosaur","DivineBeast","Dragon","Fairy","Fiend","Fish","Insect","Illusion","Machine","Plant","Psychic","Pyro","Reptile","Rock","SeaSerpent","Spellcaster","Thunder","Warrior","WingedBeast","Wyrm","Zombie"],Ua=["Normal","Continuous","Field","QuickPlay","Equip","Ritual","PendulumScale"],zi={Normal:"ÈÄöÂ∏∏",Continuous:"Ê∞∏Á∂ö",Field:"„Éï„Ç£„Éº„É´„Éâ",QuickPlay:"ÈÄüÊîª",Equip:"Ë£ÖÂÇô",Ritual:"ÂÑÄÂºè",PendulumScale:"„Éö„É≥„Éá„É•„É©„É†"},Ga=["Normal","Continuous","Counter"],Vi={Normal:"ÈÄöÂ∏∏",Continuous:"Ê∞∏Á∂ö",Counter:"„Ç´„Ç¶„É≥„Çø„Éº"},st=["Attack","Defense"],Ii={Attack:"ÊîªÊíÉË°®Á§∫",Defense:"ÂÆàÂÇôË°®Á§∫",Set:"Ë£èÂÅ¥ÂÆàÂÇôË°®Á§∫"},jn=["level","rank","attack","defense","pendulumScaleR","pendulumScaleL"],Ul=({wikiName:i,wikiHref:e,wikiTextAll:t,nameKana:r,description:a,pendulumDescription:n,...s})=>s,Gl=i=>Ul(i),Mr={Aqua:"Ê∞¥",Beast:"Áç£",BeastWarrior:"Áç£Êà¶Â£´",CreatorGod:"ÂâµÈÄ†Á•û",Cyberse:"„Çµ„Ç§„Éê„Éº„Çπ",Dinosaur:"ÊÅêÁ´ú",DivineBeast:"ÂπªÁç£Á•û",Dragon:"„Éâ„É©„Ç¥„É≥",Fairy:"Â§©‰Ωø",Fiend:"ÊÇ™È≠î",Fish:"È≠ö",Insect:"ÊòÜËô´",Illusion:"ÂπªÊÉ≥È≠î",Machine:"Ê©üÊ¢∞",Plant:"Ê§çÁâ©",Psychic:"„Çµ„Ç§„Ç≠„ÉÉ„ÇØ",Pyro:"ÁÇé",Reptile:"Áà¨Ëô´È°û",Rock:"Â≤©Áü≥",SeaSerpent:"Êµ∑Á´ú",Spellcaster:"È≠îÊ≥ï‰Ωø„ÅÑ",Thunder:"Èõ∑",Warrior:"Êà¶Â£´",WingedBeast:"È≥•Áç£",Wyrm:"ÂπªÁ´ú",Zombie:"„Ç¢„É≥„Éá„ÉÉ„Éà"},Wi={Aqua:"üö∞",Beast:"üêÖ",BeastWarrior:"ü¶Å",CreatorGod:"üîÜ",Cyberse:"üíªÔ∏è",Dinosaur:"ü¶ñ",DivineBeast:"üí´",Dragon:"üê≤",Fairy:"üëº",Fiend:"üëø",Fish:"üêüÔ∏è",Insect:"ü¶ã",Illusion:"ü§°",Machine:"ü§ñ",Plant:"üå±",Psychic:"üëÅÔ∏è",Pyro:"üî•",Reptile:"ü¶é",Rock:"‚õ∞",SeaSerpent:"üêç",Spellcaster:"üßô",Thunder:"‚ö°Ô∏è",Warrior:"‚öîÔ∏è",WingedBeast:"ü¶Ö",Wyrm:"üêâ",Zombie:"ü¶¥"},zl={TopLeft:{name:"Â∑¶‰∏ä",arrowhead:{offsetRow:-1,offsetColumn:-1}},TopCenter:{name:"‰∏ä",arrowhead:{offsetRow:-1,offsetColumn:0}},TopRight:{name:"Âè≥‰∏ä",arrowhead:{offsetRow:-1,offsetColumn:1}},MiddleLeft:{name:"Â∑¶",arrowhead:{offsetRow:0,offsetColumn:-1}},MiddleRight:{name:"Âè≥",arrowhead:{offsetRow:0,offsetColumn:1}},BottomLeft:{name:"Â∑¶‰∏ã",arrowhead:{offsetRow:1,offsetColumn:-1}},BottomCenter:{name:"‰∏ã",arrowhead:{offsetRow:1,offsetColumn:0}},BottomRight:{name:"Âè≥‰∏ã",arrowhead:{offsetRow:1,offsetColumn:1}}},Vl=i=>i.cardId??!1?`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=2&cid=${i.cardId}`:`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=1&sess=1&rp=10&mode=&sort=1&keyword=${i.name}&stype=1&ctype=&othercon=2&starfr=&starto=&pscalefr=&pscaleto=&linkmarkerfr=&linkmarkerto=&link_m=2&atkfr=&atkto=&deffr=&defto=&releaseDStart=1&releaseMStart=1&releaseYStart=1999&releaseDEnd=&releaseMEnd=&releaseYEnd=`,Fi=(i,e)=>{const t=i.monsterCategories??[],r=e.monsterCategories??[];for(const a of wi.toReversed()){if(t.includes(a)&&!r.includes(a))return 1;if(!t.includes(a)&&r.includes(a))return-1}if(i.kind===e.kind){if(i.kind==="Monster"){if((i.link??0)!==(e.link??0))return(i.link??0)-(e.link??0);if((i.rank??0)!==(e.rank??0))return(i.rank??0)-(e.rank??0);if((i.level??0)!==(e.level??0))return(i.level??0)-(e.level??0);if((i.attack??0)!==(e.attack??0))return(i.attack??0)-(e.attack??0);if((i.defense??0)!==(e.defense??0))return(i.defense??0)-(e.defense??0)}return i.name.localeCompare(e.name,"Ja")}for(const a of Qr){if(i.kind===a)return-1;if(e.kind===a)return 1}return i.name.localeCompare(e.name,"Ja")},fr=(...i)=>i.length?i.reduce((e,t)=>e>t?e:t):-Number.MAX_VALUE,Jr=(...i)=>i.length?i.reduce((e,t)=>e<t?e:t):Number.MAX_VALUE,pi=(i,e)=>{if((i[0]??Number.MAX_VALUE)>e)return 0;if(i.slice(-1)[0]<e)return i.length;let t=0,r=i.length-1;for(;;){const a=Math.round((t+r)/2);if(a===r||a===t)return i[t]<e?r:t;if(i[a]<e){t=a;continue}r=a}},mt=[3,5,5,6,6,6,7,8,9,10,11,11,11,12,12,13,13,14,15,15,15,15,15,15,16,16,16,17,18,18,18,21,21,21,22,23,25,25,26,28,28,28,30,30,31,32,32,33,33,34,35,35,36,36,36,37,37,38,38,38,39,41,42,42,43,45,45,45,45,48,48,48,50,51,52,54,54,54,54,56,57,58,59,59,59,59,60,61,63,65,65,65,65,66,67,67,67,69,69,71,71,72,73,73,73,73,73,74,75,75,76,76,77,78,79,80,80,80,80,84,84,84,84,84,84,85,85,85,87,90,91,94,96,96,97,98,101,101,101,101,101];console.log(mt.length);mt.forEach((i,e)=>{((mt[pi(mt,e)-1]||-Number.MAX_VALUE)>=e||(mt[pi(mt,e)]||Number.MAX_VALUE)<e)&&console.log(e,pi(mt,e),(mt[pi(mt,e)-1]||-Number.MAX_VALUE)<e,(mt[pi(mt,e)]||Number.MAX_VALUE)>=e)});const ut=class ut{constructor(e){d(this,"id");d(this,"name");d(this,"description");d(this,"previousNpcId");d(this,"previousStartMode");d(this,"save",async e=>{const t=e??{id:this.id,name:this.name,description:this.description,previousNpcId:this.previousNpcId,previousStartMode:this.previousStartMode},r=await ut.tblHeader.update(this.id,a=>({...a,...t}));return new ut(r)});var t;console.log(e),this.id=e.id,this.name=e.name,this.description=e.description,this.previousNpcId=((t=Bi.find(r=>r.id===e.previousNpcId))==null?void 0:t.id)??Jr(...Bi.map(r=>r.id)),this.previousStartMode=Yo.includes(e.previousStartMode)?e.previousStartMode:"Random"}get npcLvl(){return Number.MAX_VALUE}};d(ut,"tblHeader"),d(ut,"getOrCreateNew",async e=>{ut.tblHeader||(ut.tblHeader=new Wl(e));const t=await ut.tblHeader.getAll();if(t.length)return new ut(t[0]);const r=await ut.tblHeader.insert({name:"„ÅÇ„Å™„Åü",description:"„Åì„Åì„ÅÆÊñáÂ≠óÂàó„Çí‰Ωï„Å´‰Ωø„ÅÜ„Åã„ÅØÊú™ÂÆö„ÄÇ",previousNpcId:0,previousStartMode:"Random"});return new ut(r)});let Ir=ut;class Wl extends ba{constructor(t){super(t,"TblDuelistProfile");d(this,"_prepareInitialRecords",()=>[])}}let $r=-1;const Bi=[{id:$r--,name:"„Çµ„É≥„Éâ„Éê„ÉÉ„Ç∞„Åè„ÇìÊ£íÁ´ã„Å°",description:"ÊîªÊíÉÂÆ£Ë®Ä„Å™„Åó„ÄÅÂº∑Âà∂ÂäπÊûú‰ª•Â§ñ„ÅÆÂäπÊûú„ÅÆÁô∫Âãï„Å™„Åó„ÄÇ",npcLvl:0},{id:$r--,name:"„Çµ„É≥„Éâ„Éê„ÉÉ„Ç∞„Åè„ÇìÈùûÊö¥Âäõ",description:"ÊîªÊíÉÂÆ£Ë®Ä„Å™„Åó„ÄÇ",npcLvl:100},{id:$r--,name:"„Çµ„É≥„Éâ„Éê„ÉÉ„Ç∞„Åè„ÇìÁôΩÂ∏Ø",description:"„Å®„Åè„Å´Âà∂Èôê„Å™„Åó„ÄÇ",npcLvl:200}];Array.prototype.shuffle=function(){return this.map(e=>({item:e,seq:Math.random()})).toSorted((e,t)=>e.seq-t.seq).map(e=>e.item)};Array.prototype.randomPickMany=function(i){return this.shuffle().slice(0,i)};Array.prototype.randomPick=function(){return this.shuffle().slice(0,1)[0]};Array.prototype.reset=function(...i){this.splice(0),this.push(...i)};Array.prototype.union=function(i){return this.filter(e=>i.find(t=>e===t))};Array.prototype.getAllOnOffPattern=function(){const i=[];return this.forEach(e=>{if(i.length==0){i.push([e]),i.push([]);return}i.forEach(t=>i.push([...t,e]))}),i};Array.prototype.getDistinct=function(){return Array.from(new Set(this))};Array.prototype.distinct=function(){this.reset(...this.getDistinct())};const hr=class hr{constructor(e,t,r){d(this,"seq");d(this,"entity");d(this,"_definition");d(this,"validateDuelist",e=>this.entity.controller===e?this.definition.executableDuelistTypes.includes("Controller"):this.definition.executableDuelistTypes.includes("Opponent"));this.seq=e==="AutoSeq"?hr.nextSeq++:e,this.entity=t,this._definition=r}get definition(){return this._definition}get title(){return this.definition.title}get isMandatory(){return this.definition.isMandatory}get executableCells(){return this.definition.executableCells}get executablePeriods(){return this.definition.executablePeriods}get executableDuelistTypes(){return this.definition.executableDuelistTypes}get isOnlyNTimesPerDuel(){return this.definition.isOnlyNTimesPerDuel??0}get isOnlyNTimesPerTurn(){return this.definition.isOnlyNTimesPerTurn??0}get isOnlyNTimesPerTurnIfFaceup(){return this.definition.isOnlyNTimesPerTurnIfFaceup??0}get isOnlyNTimesIfFaceup(){return this.definition.isOnlyNTimesIfFaceup??0}get isOnlyNTimesPerChain(){return this.definition.isOnlyNTimesPerChain??0}get duel(){return this.entity.duel}};d(hr,"nextSeq",0);let vr=hr;const Yl=["NormalSummon","SpecialSummon","FlipSummon"],Ca=["IgnitionEffect","TriggerEffect","QuickEffect","CardActivation"],Xl=["ChangeBattlePosition","Battle","SpellTrapSet","LingeringEffect"],Kl=i=>i==="CardActivation"?"CardActivation":Ca.some(e=>e===i)?"EffectActivation":"NonActivate",za=["NormalSummon","AdvanceSummon","SpecialSummon","SpecialSummonFromDeck","SendToGraveyardFromDeck","Draw","SearchFromDeck","BanishFromDeck","BanishFromGraveyard","AddToHandFromGraveyard","ReturnToDeckFromGraveyard","SpecialSummonFromGraveyard","SpecialSummonFromBanished","ReturnToHandFromGraveyard","ReturnToHandFromField","BanishFromField","BanishFromHand","Destroy","DestroyMultiple","DestroyOnField","DestroyMultipleOnField","DestroyOnOpponentField","DestroyMultipleOnOpponentField","DestroyMonsterOnField","DestroyMonstersOnField","DestroySpellTrapOnField","DestroySpellTrapsOnField","SpecialSummonFromHand","SpecialSummonFromExtraDeck","IfNormarlSummonSucceed","IfSpecialSummonSucceed","DamageToOpponent","DamageToSelf","PayLifePoint","DiscordAsCost","DiscordAsEffect","RollDice","BounceToHand","NegateCardEffect","NegateCardActivation","NegateNormalSummon","NegateSpecialSummon"],Yt=class Yt extends vr{constructor(t,r,a,n){super(t,r,a);d(this,"toString",()=>this.isWithChainBlock?` ¬´${this.title}¬ª`:this.title);d(this,"addhocMateriallimitation");d(this,"getClone",t=>new Yt(this.seq,this.entity,this.definition,t));d(this,"getEnableMaterialPatterns",t=>{var r,a;return((a=(r=this.definition).getEnableMaterialPatterns)==null?void 0:a.call(r,t).filter(this.addhocMateriallimitation))??[]});d(this,"validate",(t,r,a)=>{if(this.playType==="CardActivation"&&this.entity.isOnField&&this.entity.face==="FaceUp"||this.isOnlyNTimesPerDuel>0&&this.entity.field.duel.chainBlockLog.records.filter(l=>!l.chainBlockInfo.isNegatedActivationBy).filter(l=>this.isSame(l.chainBlockInfo.action)).filter(l=>l.chainBlockInfo.activator===t).length>=this.isOnlyNTimesPerDuel||this.isOnlyNTimesPerTurn>0&&this.entity.field.duel.chainBlockLog.records.filter(l=>!l.chainBlockInfo.isNegatedActivationBy).filter(l=>this.isSameGroupPerTurn(l.chainBlockInfo.action)).filter(l=>l.clock.turn===this.entity.field.duel.clock.turn).filter(l=>l.chainBlockInfo.activator===t).length>=this.isOnlyNTimesPerTurn)return;const n=r.filter(l=>l.action.seq===this.seq).length;if(this.isOnlyNTimesPerChain>0&&n>=this.isOnlyNTimesPerChain)return;const s=n+this.entity.counterHolder.getActionCount(this);if(this.isOnlyNTimesPerTurnIfFaceup>0&&s>=this.isOnlyNTimesPerTurnIfFaceup||this.isOnlyNTimesIfFaceup>0&&s>=this.isOnlyNTimesIfFaceup)return;const c=fr(0,...r.map(l=>l.chainNumber??-1)),u={index:r.length,chainNumber:this.isWithChainBlock?c+1:void 0,action:this,activator:t,targetChainBlock:r.slice(-1)[0],isActivatedIn:this.entity.fieldCell,isActivatedAt:this.duel.clock.getClone(),costInfo:{},state:"unloaded",dest:void 0,ignoreCost:!1};if(!(this.definition.canPayCosts&&!a&&!this.definition.canPayCosts(u,r)))return this.definition.validate(u,r)});d(this,"prepare",async(t,r,a,n,s,c)=>{var h,m;let u=s;this.isLikeContinuousSpell&&(this.entity.info.isPending=!0);const l=this.isWithChainBlock?fr(0,...n.map(w=>w.chainNumber??-1))+1:void 0;let o="";if(l!==void 0&&(o+=`„ÉÅ„Çß„Éº„É≥${l}: `),this.playType==="CardActivation"||this.playType==="SpellTrapSet")if(this.entity.fieldCell.cellType==="Hand"){let w=r?[r]:this.entity.status.spellCategory==="Field"?[t.getFieldZone()]:t.getAvailableSpellTrapZones();if(this.entity.status.spellCategory==="Field"){const S=t.getFieldZone().cardEntities;if(S.length){const T=S[0];await pe.sendManyToGraveyardForTheSameReason(t.getFieldZone().cardEntities,["Rule"],this.entity,t),t.writeInfoLog(`„Éï„Ç£„Éº„É´„ÉâÈ≠îÊ≥ï„ÅÆ‰∏äÊõ∏„Åç„Å´„Çà„Çä„ÄÅ${T.toString()}„ÅØÂ¢ìÂú∞„Å´ÈÄÅ„Çâ„Çå„Åü„ÄÇ`),u=!1}}(h=this.entity.status.monsterCategories)!=null&&h.includes("Pendulum")&&(w=w.filter(S=>S.isAvailableForPendulum));let y=w[0];if(w.length>1){y=w.randomPick();const S=this.playType==="SpellTrapSet"?"„Çª„ÉÉ„Éà":"„Ç´„Éº„Éâ„ÅÆÁô∫Âãï",T=await this.duel.view.waitDammyActions(t,this.entity,w,"„Ç´„Éº„Éâ„ÇíÁßªÂãïÂÖà„Å∏„Éâ„É©„ÉÉ„Ç∞",S,u);if(!T)return;y=T}o+="ÊâãÊú≠„Åã„Çâ",this.playType==="SpellTrapSet"?o+="È≠îÊ≥ï„ÉªÁΩ†„Ç´„Éº„Éâ„Çí„Çª„ÉÉ„Éà„ÄÇ":o+=`${this.entity.toString()}„ÇíÁô∫Âãï„ÄÇ`,t.writeInfoLog(o),(m=this.entity.status.monsterCategories)!=null&&m.includes("Pendulum")?await this.entity.activateAsPendulumScale(y,["CardActivation"],this.entity,t):this.playType==="CardActivation"?await this.entity.activateSpellTrapFromHand(y,this.entity.status.kind,["CardActivation"],this.entity,t):await this.entity.setAsSpellTrap(y,this.entity.status.kind,["SpellTrapSet"],this.entity,t),u=!1}else this.entity.isOnFieldAsSpellTrap&&this.entity.face==="FaceDown"&&(o+=`„Çª„ÉÉ„Éà„Åï„Çå„Å¶„ÅÑ„Åü${this.entity.toString()}„ÇíÁô∫Âãï„ÄÇ`,t.writeInfoLog(o),await this.entity.setNonFieldMonsterPosition(this.entity.origin.kind,"FaceUp",["Rule"]),u=!1);else l!==void 0&&(o+=`${this.entity.toString()}„ÅÆÂäπÊûú„ÄÅ${this.toString()}„ÇíÁô∫Âãï„ÄÇ`,t.writeInfoLog(o));const f={index:n.length,chainNumber:l,action:this,activator:t,targetChainBlock:a,isActivatedIn:this.entity.fieldCell,isActivatedAt:this.duel.clock.getClone(),costInfo:{},state:"ready",dest:r,ignoreCost:!1};if(this.definition.payCosts&&!c){const w=await this.definition.payCosts(f,n,u);if(!w)return;f.costInfo=w}const p=await this.definition.prepare(f,n,u);if(p!==void 0)return console.log(this.entity.toString(),p),{...f,...p}});d(this,"execute",async(t,r)=>{if(t.action.isLikeContinuousSpell&&!t.action.entity.isOnField)return this.entity.info.isPending=!1,!1;const a=await this.definition.execute(t,r);if(t.action.isLikeContinuousSpell)for(const n of this.entity.continuousEffects)this.entity.info.isPending=!1,await n.updateState();return a});d(this,"settle",(t,r)=>(this.isOnlyNTimesPerTurnIfFaceup>0?this.entity.counterHolder.incrementActionCountPerTurn(this):this.isOnlyNTimesIfFaceup>0&&this.entity.counterHolder.incrementActionCount(this),this.definition.settle(t,r)));d(this,"directExecute",async(t,r)=>{const a=await this.prepare(t,void 0,void 0,[],!1,r);if(!a)throw new me("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",this,t,r);const n=await this.execute(a,[]);return this.settle(a,[]),n});d(this,"isSame",t=>this.entity.origin.name===t.entity.origin.name&&this.title===t.title);d(this,"isSameGroupPerTurn",t=>this.actionGroupNamePerTurn?this.entity.origin.name===t.entity.origin.name&&this.actionGroupNamePerTurn===t.actionGroupNamePerTurn:this.isSame(t));d(this,"calcChainBlockTagsForDestroy",t=>{if(!za.length)return[];const r=["Destroy"];za.length>1&&r.push("DestroyMultiple");const a=t.filter(u=>u.isOnField);a.length&&(r.push("DestroyOnField"),a.length>1&&r.push("DestroyMultipleOnField"));const n=a.filter(u=>u.status.kind==="Monster");n.length&&(r.push("DestroyMonsterOnField"),n.length>1&&r.push("DestroyMonstersOnField")),a.filter(u=>u.status.kind!=="Monster").length&&(r.push("DestroySpellTrapOnField"),n.length>1&&r.push("DestroySpellTrapsOnField"));const c=a.filter(u=>u.controller!==this.entity.controller);return c.length&&(r.push("DestroyOnOpponentField"),c.length>1&&r.push("DestroyMultipleOnOpponentField")),r});this.addhocMateriallimitation=n??(()=>!0)}get definition(){return super.definition}get playType(){return this.definition.playType}get spellSpeed(){return this.definition.spellSpeed}get needsToPayCost(){return this.definition.needsToPayCost??!1}get hasToTargetCards(){return this.definition.hasToTargetCards??!1}get isWithChainBlock(){return Ca.some(t=>t===this.playType)}get isLikeContinuousSpell(){return this.definition.isLikeContinuousSpell||this.entity.isLikeContinuousSpell&&this.playType==="CardActivation"}get actionGroupNamePerTurn(){return this.definition.actionGroupNamePerTurn}get negatePreviousBlock(){return this.definition.negatePreviousBlock??!1}get negateSummon(){return this.definition.negateSummon??!1}get priorityForNPC(){return this.definition.priorityForNPC??Number.NaN}};d(Yt,"createNew",(t,r)=>new Yt("AutoSeq",t,r)),d(Yt,"createDammyAction",(t,r,a,n)=>{const s=Yt.createNew(t,{title:r,isMandatory:!1,executableCells:[],executablePeriods:[],executableDuelistTypes:[],playType:"Dammy",spellSpeed:"Dammy",validate:()=>a,prepare:async()=>{},execute:async()=>!1,settle:async()=>!1});return s.pos=n,s.cell=a[0],s.dragAndDropOnly=a.length>1,s});let ii=Yt;const gr=class gr{constructor(e,t,r,a,n,s=[]){d(this,"duel");d(this,"seat");d(this,"_entity");d(this,"profile");d(this,"deckInfo");d(this,"info");d(this,"infoOrigin");d(this,"status");d(this,"statusOrigin");d(this,"duelistType");d(this,"lifeLog");d(this,"actionBlackListForNPC");d(this,"_lp");d(this,"initHand");d(this,"writeInfoLog",e=>{this.duel.log.info(e,this)});d(this,"initForDrawPhase",()=>{this.info={...this.infoOrigin}});d(this,"canDiscard",e=>(console.log(e),!0));d(this,"canSendToGraveyard",e=>(console.log(e),!0));d(this,"canRelease",e=>(console.log(e),!0));d(this,"canTryBanish",(e,t,r)=>this.entity.procFilterBundle.operators.filter(a=>a.procTypes.includes(t)).every(a=>a.filter(this,this.entity,r,[e])));d(this,"battleDamage",(e,t)=>this.setLp(this._lp-e,t,"BattleDamage"));d(this,"effectDamage",(e,t)=>this.setLp(this._lp-e,t,"EffectDamage"));d(this,"lostLp",(e,t)=>this.setLp(this._lp-e,t,"Lost"));d(this,"payLp",(e,t)=>this.setLp(this._lp-e,t,"Pay"));d(this,"heal",(e,t)=>this.setLp(this._lp+e,t,"Heal"));d(this,"setLp",(e,t,r)=>{const a={clock:this.duel.clock,reason:r||"Set",beforeLp:this._lp,afterLp:e,entity:t};return this.lifeLog.push(a),this._lp=e,this.writeInfoLog(`„É©„Ç§„Éï„Éù„Ç§„É≥„ÉàÂ§âÂãïÔºö${a.afterLp-a.beforeLp}Ôºà${a.beforeLp} ‚áí ${a.afterLp}Ôºâ`),a});d(this,"getOpponentPlayer",()=>this.duel.firstPlayer===this?this.duel.secondPlayer:this.duel.firstPlayer);d(this,"getHandCell",()=>this.duel.field.getCells("Hand").filter(e=>e.owner===this)[0]);d(this,"getDeckCell",()=>this.duel.field.getCells("Deck").filter(e=>e.owner===this)[0]);d(this,"getExtraDeck",()=>this.duel.field.getCells("ExtraDeck").filter(e=>e.owner===this)[0]);d(this,"getGraveyard",()=>this.duel.field.getCells("Graveyard").filter(e=>e.owner===this)[0]);d(this,"getFieldZone",()=>this.duel.field.getCells("FieldSpellZone").filter(e=>e.owner===this)[0]);d(this,"getBanished",()=>this.duel.field.getCells("Banished").filter(e=>e.owner===this)[0]);d(this,"getMonsterZones",()=>this.duel.field.getCells("MonsterZone").filter(e=>e.owner===this));d(this,"getExtraMonsterZones",()=>this.duel.field.getCells("ExtraMonsterZone").filter(e=>{var t;return((t=e.cardEntities[0])==null?void 0:t.controller)===this}));d(this,"getSpellTrapZones",()=>this.duel.field.getCells("SpellAndTrapZone").filter(e=>e.owner===this));d(this,"getXyzMaterialZone",()=>this.duel.field.getCells("XyzMaterialZone").filter(e=>e.owner===this)[0]);d(this,"getEmptyMonsterZones",()=>this.getMonsterZones().filter(e=>e.cardEntities.length===0));d(this,"getEmptyExtraZones",()=>this.getExtraMonsterZones().length===0?this.getMonsterZones().filter(e=>e.cardEntities.length===0):[]);d(this,"getAvailableMonsterZones",()=>this.getMonsterZones().filter(e=>e.isAvailable));d(this,"getAvailableExtraZones",()=>this.getExtraMonsterZones().length===0?this.duel.field.getCells("ExtraMonsterZone").filter(e=>e.isAvailable):[]);d(this,"getAvailableSpellTrapZones",()=>this.getSpellTrapZones().filter(e=>e.isAvailable));d(this,"getReleasableMonsters",()=>this.getMonstersOnField());d(this,"getMonstersOnField",()=>this.duel.field.getMonstersOnField().filter(e=>e.controller===this));d(this,"getEntiteisOnField",()=>this.duel.field.getCardsOnField().filter(e=>e.controller===this));d(this,"pushDeck",()=>{this.deckInfo.cardNames.map(e=>tt[e]).filter(e=>e).forEach(e=>pe.createCardEntity(this,e)),this.duel.log.info(`„Éá„ÉÉ„Ç≠„Çí„Çª„ÉÉ„Éà„ÄÇ„É°„Ç§„É≥${this.getDeckCell().cardEntities.length}Êûö„ÄÇ„Ç®„ÇØ„Çπ„Éà„É©${this.getExtraDeck().cardEntities.length}Êûö„ÄÇ`,this)});d(this,"draw",async(e,t,r)=>{var s;if(e<1)return;const a=this.getDeckCell(),n=[];this.writeInfoLog(`„Éá„ÉÉ„Ç≠„Åã„Çâ„Ç´„Éº„Éâ„Çí${e}Êûö„Éâ„É≠„Éº„ÄÇ`);for(const c of Array(e)){if(!a.cardEntities.length)throw this.writeInfoLog(n.length>0?`„Éá„ÉÉ„Ç≠„Åã„Çâ„Ç´„Éº„Éâ„Çí${e}Êûö„Éâ„É≠„Éº„Åó„Çà„ÅÜ„Å®„Åó„Åü„Åå„ÄÅ${n.length}Êûö„Åó„Åã„Éâ„É≠„Éº„Åß„Åç„Å™„Åã„Å£„Åü„ÄÇ${n}`:"„Éá„ÉÉ„Ç≠„Åã„Çâ„Ç´„Éº„Éâ„Çí„Éâ„É≠„Éº„Åß„Åç„Å™„Åã„Å£„Åü„ÄÇ"),this.duel.isEnded=!0,this.setLp(0),new Jt(this.getOpponentPlayer());const u=a.cardEntities[0];await u.draw(t?["Effect"]:["Rule"],t,r),n.push(((s=u.origin)==null?void 0:s.name)||"!ÂêçÁß∞ÂèñÂæóÂ§±Êïó!")}});d(this,"discard",async(e,t,r,a,n,s)=>{const c=n||(()=>!0),u=this.getHandCell().cardEntities.filter(c);if(u.length<e)return[];let l=[];return(a||this).duelistType==="NPC"?l=u.randomPickMany(e):l=await this.duel.view.waitSelectEntities(a||this,u,e,o=>o.length===e,`${e}Êûö„Ç´„Éº„Éâ„ÇíÊç®„Å¶„Çã„ÄÇ`,!1)||[],this.writeInfoLog(`ÊâãÊú≠„Åã„Çâ„Ç´„Éº„Éâ„Çí${l.length}ÊûöÊç®„Å¶„Åü„ÄÇ${l.map(o=>{var f;return(f=o.origin)==null?void 0:f.name})}„ÄÇ`),await pe.discardManyForTheSameReason(l,["Discard",...t],r,s),l});d(this,"getEnableSummonList",(e,t,r,a,n,s,c)=>{const u=this.duel.field.getCells("ExtraMonsterZone"),l=u.filter(f=>!s.map(p=>p.material).includes(f.cardEntities[0])).filter(f=>f.owner===this),o=[];return l.length&&o.push(...u.filter(f=>!l.includes(f)).filter(f=>f.isAvailable)),n.map(f=>({...f,summoner:this})).map(f=>{var p;return this.duel.field.canExtraLink(f.monster,s)||(f.cells=f.cells.filter(h=>!o.includes(h))),(p=f.monster.status.monsterCategories)!=null&&p.includes("Link")&&(f.posList=f.posList.filter(h=>h==="Attack")),f}).map(f=>({...f,cells:f.cells.filter(p=>p.cardEntities.length===0||s.some(h=>h.material===p.cardEntities[0]))})).filter(f=>f.cells.length&&f.posList.length).map(f=>this.entity.summonFilterBundle.filter(e,t,r,a,f,s,c)).filter(f=>f.cells.length&&f.posList.length).map(f=>f.monster.summonFilterBundle.filter(e,t,r,a,f,s,c)).filter(f=>f.cells.length&&f.posList.length).map(f=>s.map(p=>p.material.summonFilterBundle).reduce((p,h)=>h.filter(e,t,r,a,f,s,c),f)).filter(f=>f.cells.length&&f.posList.length)});d(this,"prepareToSummonMany",async(e,t,r,a,n,s,c,u,l,o="ÁâπÊÆäÂè¨Âñö„Åô„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû„ÄÇ")=>{const f=this.getEnableSummonList(e,t,r,a,n,s,c);if(!f.length)return[];let p=f.map(m=>m.monster);console.log(n,u([])),(n.length!==1||u([]))&&(p=await this.duel.view.waitSelectEntities(this,p,void 0,u,o,l)??[]),console.log(f,p);const h=[];for(const m of f.filter(w=>p.includes(w.monster))){const w=m.cells.filter(T=>!h.map(P=>P.dest).includes(T));if(!w.length)continue;let y=[...m.posList].randomPick(),S=w.randomPick();if((w.length>1||m.posList.length>1)&&this.duelistType!=="NPC"){const T=w.length>1?"„Ç´„Éº„Éâ„ÇíÂè¨ÂñöÂÖà„Å∏„Éâ„É©„ÉÉ„Ç∞„ÄÇ":"Ë°®Á§∫ÂΩ¢Âºè„ÇíÈÅ∏Êäû„ÄÇ",P=m.posList.map(L=>ii.createDammyAction(m.monster,L,w,L)),O=this.duel.view.modalController.selectAction(this.duel.view,{title:T,activator:this,actions:P,cancelable:!1}),k=this.duel.view.waitSubAction(this,P,T,l).then(L=>L.action),D=await Promise.any([O,k]);if(!D)throw new me("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",f,p,h);S=D.cell||S,y=D.pos||y}h.push({summoner:this,monster:m.monster,pos:y,dest:S})}return h});d(this,"summonAll",(e,t,r,a,n,s,c,u,l)=>this.summonMany(e,t,r,a,n,s,c,o=>o.length===n.length,u,l));d(this,"summonMany",(e,t,r,a,n,s,c,u,l,o)=>gr.summonMany(e,t,r,a,n.map(f=>({...f,summoner:this})),s,c,u,l,o));d(this,"selectAttackTargetForNPC",(e,t)=>{const r=e.atk??0,a=e.getAttackTargets();if(!a.length)return;const n=a.find(s=>s.entityType==="Duelist");return n&&(r>=Jr(1600,this.getOpponentPlayer().lp)||e.info.battlePotisionChangeCount>0)?n:a.find(s=>s.battlePosition==="Attack"?r>=(s.atk??0):r<(s.battlePosition==="Set"?1e3:s.def??0)?!1:s.validateDestory("BattleDestroy",this,e,t))});d(this,"selectActionForNPC",(e,t)=>{if(!e.length)return;const r=e.filter(y=>y.isMandatory);if(r.length)return r.randomPick();let a=e.filter(y=>!this.actionBlackListForNPC.includes(y.playType));const n=a.filter(y=>!Number.isNaN(y.priorityForNPC)).shuffle().sort((y,S)=>y.priorityForNPC-S.priorityForNPC);if(n.length)return n[0];const s=a.filter(y=>y.playType==="TriggerEffect");if(s.length)return s.randomPick();if(this.duel.phase!=="main1"&&this.duel.phase!=="main2"){const y=a.filter(S=>S.playType==="IgnitionEffect");if(y.length)return y.randomPick()}const c=a.filter(y=>y.playType==="Battle").sort((y,S)=>(y.entity.atk??0)-(S.entity.atk??0));if(c.length)return c.find(y=>this.selectAttackTargetForNPC(y.entity,y));a=a.filter(y=>y.playType!=="Battle");const u=a.length?t.slice(-1)[0]:void 0,l=a.filter(y=>y.negatePreviousBlock);if(u&&u.activator!==this&&l)return l.randomPick();if(a=a.filter(y=>!y.negatePreviousBlock),!a.length)return;const o=fr(...this.getOpponentPlayer().getMonstersOnField().filter(y=>y.battlePosition==="Attack").map(y=>y.atk??0),1600),f=Jr(...this.getOpponentPlayer().getMonstersOnField().map(y=>y.battlePosition==="Set"?1500:(y.battlePosition==="Attack"?y.atk:y.def)??0),1500),p=this.getMonstersOnField(),h=fr(...p.filter(y=>y.battlePosition==="Attack").map(y=>y.atk??0),0);let m=a.filter(y=>y.playType!=="ChangeBattlePosition").filter(y=>y.entity.battlePosition!=="Attack").filter(y=>(y.entity.atk??0)>=o||(y.entity.atk??0)>f&&(y.entity.atk??0)>2300);if(m.length)return m.randomPick();a=a.filter(y=>y.playType!=="ChangeBattlePosition").filter(y=>y.playType!=="SpellTrapSet").filter(y=>y.entity.actions.filter(S=>S.playType!=="NormalSummon"&&S.playType!=="SpecialSummon").flatMap(S=>S.executableCells).every(S=>S!=="Hand")||y.playType!=="NormalSummon"&&y.playType!=="SpecialSummon");const w=[...a.filter(y=>y.playType==="NormalSummon").filter(y=>(y.entity.lvl??12)<5),...a.filter(y=>y.playType==="SpecialSummon"),...a.filter(y=>y.playType==="NormalSummon").filter(y=>(y.entity.atk??0)>2600||(y.entity.atk??0)>2300&&(y.entity.lvl??12)<7).filter(y=>(y.entity.atk??0)>=h),...a.filter(y=>y.entity.face==="FaceUp").filter(y=>y.entity.isOnField)];if(w.length)return w.randomPick();if(a=a.filter(y=>y.playType!=="NormalSummon").filter(y=>y.playType!=="SpecialSummon"),this.duel.phase==="main2"){if(m=e.filter(y=>y.playType==="ChangeBattlePosition").filter(y=>y.entity.battlePosition==="Attack").filter(y=>(y.entity.atk??0)<o||(y.entity.atk??0)>f&&(y.entity.atk??0)>2300),m.length)return m.randomPick();if(this.getAvailableSpellTrapZones.length>1)return e.filter(y=>y.playType==="SpellTrapSet").filter(y=>y.entity.status.kind!=="Spell"||y.entity.status.spellCategory==="QuickPlay").randomPick()}if(Math.random()<a.length/4)return a.randomPick()});this.duel=e,this.seat=t,this.profile=r,this.duelistType=a,this.deckInfo=n,this.initHand=s,this.lifeLog=[],this.infoOrigin={maxRuleNormalSummonCount:1,ruleNormalSummonCount:0,ruleNormalSummonCountQty:0,effectNormalSummonCount:0,effectNormalSummonCountQty:0,specialSummonCount:0,specialSummonCountQty:0},this.info={...this.infoOrigin},this.statusOrigin={maxSpecialSummonCount:Number.MAX_VALUE,canDrawByEffect:!0,canSearchFromDeck:!0,canDiscardAsCost:!0,canDiscardAsEffect:!0},this.status={...this.statusOrigin},this._lp=8e3;const c=[];this.duelistType==="NPC"&&(this.profile.npcLvl<1&&c.push("CardActivation","IgnitionEffect","TriggerEffect","QuickEffect"),this.profile.npcLvl<101&&c.push("Battle")),this.actionBlackListForNPC=c}get entity(){const e=this.getHandCell().entities.find(t=>t.entityType==="Duelist");return e||pe.createPlayerEntity(this)}get lp(){return this._lp}get isTurnPlayer(){return this.duel.getTurnPlayer()===this}get canDraw(){return!0}get canAddToHandFromDeck(){return!0}};d(gr,"summonMany",async(e,t,r,a,n,s,c,u,l,o="ÁâπÊÆäÂè¨Âñö„Åô„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû„ÄÇ")=>{const f=n.map(h=>h.summoner).getDistinct(),p=[];for(const h of f)p.push(...await h.prepareToSummonMany(e,t,r,a,n.filter(m=>m.summoner===h),s,c,u,l,o));if(p.length)return p.forEach(h=>h.monster.info.materials.reset(...s)),await pe.moveToXyzOwner(p[0].dest,s.map(h=>h.material).filter(h=>h.status.kind==="XyzMaterial"),["XyzMaterial","Rule"],p[0].monster,e),await pe.summonMany(p,t,r,a.entity,e),p.map(h=>h.monster)});let Ri=gr;const Zn=["Deck","ExtraDeck"],Un=["Graveyard","Banished"],Gn=[...Zn,...Un],Ql=[...Gn,"Hand"],ri=["MonsterZone","ExtraMonsterZone"],Gt=["SpellAndTrapZone","FieldSpellZone"],ai=[...ri,...Gt],zn=["XyzMaterialZone","Disable"],mi=[...Ql,...ai,...zn],ea={0:{0:"Hand"},1:{0:"Deck",1:"SpellAndTrapZone",2:"SpellAndTrapZone",3:"SpellAndTrapZone",4:"SpellAndTrapZone",5:"SpellAndTrapZone",6:"ExtraDeck"},2:{0:"Graveyard",1:"MonsterZone",2:"MonsterZone",3:"MonsterZone",4:"MonsterZone",5:"MonsterZone",6:"FieldSpellZone"},3:{0:"Banished",1:"XyzMaterialZone",2:"ExtraMonsterZone",3:"Disable",4:"ExtraMonsterZone",5:"XyzMaterialZone",6:"Banished"},4:{0:"FieldSpellZone",1:"MonsterZone",2:"MonsterZone",3:"MonsterZone",4:"MonsterZone",5:"MonsterZone",6:"Graveyard"},5:{0:"ExtraDeck",1:"SpellAndTrapZone",2:"SpellAndTrapZone",3:"SpellAndTrapZone",4:"SpellAndTrapZone",5:"SpellAndTrapZone",6:"Deck"},6:{0:"Hand"}};let Jl=class{constructor(e,t,r,a){d(this,"onUpdateEvent",new ze);d(this,"field");d(this,"row");d(this,"column");d(this,"cellType");d(this,"_owner");d(this,"_requiresRecalcArrowheads");d(this,"_arrowheadSources");d(this,"_needsShuffle",!1);d(this,"recalcArrowheads",()=>{this.isMonsterZoneLikeCell&&(this._requiresRecalcArrowheads=!1,this._arrowheadSources=this.neighbors.filter(e=>e.isMonsterZoneLikeCell).filter(e=>e.cardEntities.length).filter(e=>e.cardEntities[0].arrowheads.some(t=>this.row===e.row+t.offsetRow&&this.column===e.column+t.offsetColumn)).map(e=>e.cardEntities[0]))});d(this,"_entities");d(this,"releaseEntities",e=>{var t;return this._entities=this._entities.filter(r=>r!==e),this.isMonsterZoneLikeCell&&((t=e.origin.monsterCategories)!=null&&t.includes("Link"))&&(this._requiresRecalcArrowheads=!0),this.onUpdateEvent.trigger(),e});d(this,"acceptEntities",(e,t)=>{var r;t==="Top"?this._entities.unshift(e):this._entities.push(e),t==="Random"&&(this._needsShuffle=!0),this._entities.forEach(a=>{a.fieldCell=this}),this.isMonsterZoneLikeCell&&((r=e.origin.monsterCategories)!=null&&r.includes("Link"))&&(this._requiresRecalcArrowheads=!0),this.onUpdateEvent.trigger()});d(this,"shuffle",()=>{this._entities=this.entities.shuffle(),this._needsShuffle=!1,this.field.duel.log.info("„Éá„ÉÉ„Ç≠„Çí„Ç∑„É£„ÉÉ„Éï„É´„ÄÇ",this.owner)});d(this,"toString",()=>this.isMonsterZoneLikeCell||this.cellType==="SpellAndTrapZone"?`${this.cellType}(${this.row},${this.column})`:this.cellType);this.field=e,this.row=t,this.column=r,this.cellType=ea[t][r],this._owner=a,this._entities=[],this._arrowheadSources=[],this._requiresRecalcArrowheads=!1}get onUpdate(){return this.onUpdateEvent.expose()}get owner(){var e;return this._owner||((e=this.cardEntities[0])==null?void 0:e.owner)}get requiresRecalcArrowheads(){return this._requiresRecalcArrowheads}get arrowheadSources(){return this._arrowheadSources}get needsShuffle(){return this._needsShuffle}get entities(){return this._entities}get visibleEntities(){return this._entities.filter(e=>Ya.find(t=>t===e.entityType))}get cardEntities(){return this._entities.filter(e=>Ya.find(t=>t===e.entityType)).filter(e=>e.status.kind!=="XyzMaterial")}get xyzMaterials(){return this._entities.filter(e=>e.status.kind==="XyzMaterial")}get targetForAttack(){return this.cellType==="Hand"?this._entities.find(e=>e.entityType==="Duelist"):this.cardEntities[0]}get isAvailable(){return this.cardEntities.length===0&&this._entities.filter(e=>Ho.find(t=>t===e.entityType)).length===0}get isAvailableForPendulum(){return this.isAvailable&&this.isSpellTrapZoneLikeCell&&(this.column===1||this.column===5)}get isStackCell(){return Gn.some(e=>e===this.cellType)}get isPlayFieldCell(){return ai.some(e=>e===this.cellType)}get isMonsterZoneLikeCell(){return ri.some(e=>e===this.cellType)}get isSpellTrapZoneLikeCell(){return Gt.some(e=>e===this.cellType)}get isDisabledCell(){return zn.some(e=>e===this.cellType)}get neighbors(){const e=[this.row-1,this.row,this.row+1].filter(r=>r>=0&&r<=6),t=[this.column-1,this.column,this.column+1].filter(r=>r>=0&&r<=6);return e.flatMap(r=>t.map(a=>this.field.cells[r][a])).filter(r=>r.isMonsterZoneLikeCell).filter(r=>r!==this)}};class Pr{constructor(){d(this,"pooledOperators",[]);d(this,"bundles",[]);d(this,"excludesExpired",()=>{this.bundles=this.bundles.filter(e=>!e.entity.hasDisappeared),this.bundles.forEach(e=>e.excludesExpired()),this.pooledOperators=this.pooledOperators.filter(e=>e.validateAlive())});d(this,"append",e=>{this.bundles.push(e)});d(this,"push",e=>{if(!e.isContinuous)throw new me("static„Å∏„ÅÆËøΩÂä†„ÅØÊ∞∏Á∂ö‰ª•Â§ñ‰∏çÂèØ",e);this.excludesExpired(),this.distribute(e),this.pooledOperators.push(e)});d(this,"distributeAll",e=>(this.excludesExpired(),this.pooledOperators.flatMap(this.distribute).getDistinct().forEach(t=>t.operators.sort((r,a)=>r.seq-a.seq)),this.afterDistributeAll(e)));d(this,"distribute",e=>this.bundles.filter(t=>t.operators.every(r=>r.seq!==e.seq)).filter(t=>e.isApplicableTo(t.entity)).map(t=>(t.push(e),t)));d(this,"removeItem",e=>{this.pooledOperators=this.pooledOperators.filter(t=>t.seq!==e)})}}class Fr{constructor(e,t){d(this,"pool");d(this,"entity");d(this,"_operators");d(this,"excludesExpired",()=>{this._operators=this._operators.filter(e=>{const t=e.validateAlive()&&e.isApplicableTo(this.entity);return t||(console.info(`before remove ${this.entity.toString} ${e.title}`),e.beforeRemove(this)),t})});d(this,"push",e=>{this.entity.procFilterBundle.operators.filter(t=>t.procTypes.includes("Effect")).some(t=>!t.filter(t.effectOwner,t.isSpawnedBy,t.actionAttr,[]))||(this.beforePush(e),this._operators.push(e))});d(this,"removeItem",e=>{this._operators=this._operators.filter(t=>t.seq!==e?!0:(t.beforeRemove(this),!1))});this.pool=e,this.entity=t,this._operators=[],this.pool.append(this)}get operators(){return this._operators}}const yr=class yr{constructor(e,t,r,a,n,s){d(this,"seq");d(this,"title");d(this,"validateAlive");d(this,"isContinuous");d(this,"isSpawnedBy");d(this,"isSpawnedAt");d(this,"activateType");d(this,"actionAttr");d(this,"isApplicableTo");d(this,"effectOwner");this.seq=yr.nextSeq++,this.title=e,this.validateAlive=()=>t(this),this.isContinuous=r,this.isSpawnedBy=a,this.isSpawnedAt=a.duel.clock.getClone(),this.isApplicableTo=c=>s(this,c),this.actionAttr=n,this.activateType=this.actionAttr.playType?Kl(this.actionAttr.playType):"NonActivate",this.effectOwner=this.isSpawnedBy.controller}get isEffective(){return!this.isContinuous||this.activateType==="NonActivate"?!0:this.isSpawnedBy.isEffective}};d(yr,"nextSeq",0);let Ci=yr;class Il extends Pr{constructor(){super(...arguments);d(this,"afterDistributeAll",()=>this.bundles.every(t=>t.applyEffectFilter()))}}class eo extends Fr{constructor(){super(...arguments);d(this,"applyEffectFilter",()=>{const t=this.entity.allStickyEffectOperators.length,r=[];for(;;){const a=this.operators.filter(n=>n.procTypes.includes("Effect")).filter(n=>n.isContinuous).find(n=>!r.includes(n.seq));if(!a)break;r.push(a.seq),a.eraseOperators(this.entity)}return this.entity.allStickyEffectOperators.length===t});d(this,"beforePush",t=>t.eraseOperators(this.entity))}}class to extends Ci{constructor(t,r,a,n,s,c,u,l){super(t,r,a,n,s,c);d(this,"beforeRemove",()=>{});d(this,"procTypes");d(this,"filter");d(this,"eraseOperators",t=>{if(!this.procTypes.includes("Effect"))return 0;console.log("„Åì„Åì„ÅØ„Åæ„Å†ÈÄö„Çâ„Å™„ÅÑÊÉ≥ÂÆö");const r=t.allStickyEffectOperators.filter(a=>a.isContinuous).filter(a=>!this.filter(a.effectOwner,a.isSpawnedBy,a.actionAttr,[])).map(a=>a.seq);return r.forEach(t.procFilterBundle.removeItem),r.forEach(t.statusOperatorBundle.removeItem),r.forEach(t.numericOprsBundle.removeItem),r.length});this.procTypes=u,this.filter=l}}const Va={level:1,rank:1,attack:0,defense:0,pendulumScaleR:0,pendulumScaleL:0};class io extends Pr{constructor(){super(...arguments);d(this,"afterDistributeAll",t=>{if(this.bundles.forEach(a=>a.calcStateAll()),t.field.getMonstersOnField().flatMap(a=>a.numericOprsBundle).flatMap(a=>a.operators).some(a=>a.targetStateGen==="calculated")){const n=t.field.getMonstersOnField().filter(s=>(s.atk??0)>=0).map(s=>s.atk??0).reduce((s,c)=>s>c?s:c,0);t.field.getMonstersOnField().forEach(s=>{s.numericOprsBundle.operators.filter(c=>c.targetStateGen==="calculated").forEach(c=>{var u;if(!((u=s.status.monsterCategories)!=null&&u.includes("Link")&&c.targetState==="defense")){if(c.stateOperationType==="THE_DEVILS_AVATAR"){s.numericStatus.calculated[c.targetState]=n+100;return}console.log(s.toString(),s.numericStatus.calculated[c.targetState]),s.numericStatus.calculated[c.targetState]=c.calcValue(s,s.numericStatus.calculated[c.targetState]??0)}})})}return!0})}}class ro extends Fr{constructor(){super(...arguments);d(this,"beforePush",t=>{const r=this.operators.filter(n=>n.targetState===t.targetState).filter(n=>n.isEffective);if(t.kind==="O-L-F"||t.kind==="O-C-F"?(r.filter(n=>n.kind==="O-L-F").forEach(n=>n.negate()),r.filter(n=>n.kind==="L-F").forEach(n=>n.negate())):t.kind==="L-F"||t.kind==="C-F"?r.filter(n=>n.kind==="L-F"||n.kind==="L-A").forEach(n=>n.negate()):t.kind==="X-C-X"&&r.filter(n=>!n.isContinuous).forEach(n=>n.negate()),r.filter(n=>n.isEffective).some(n=>n.kind==="X-C-X")&&!t.isContinuous)return;if(t.stateOperationType!=="Addition"&&t.targetStateGen==="wip"&&r.filter(n=>!n.isContinuous).forEach(n=>n.negate()),t.stateOperationType==="THE_DEVILS_AVATAR"||t.stateOperationType==="Gradius'_Option"){this.entity.numericStatus.calculated[t.targetState]=-Number.MAX_VALUE;return}const a=this.entity.numericStatus.calculated[t.targetState]??0;if(t.stateOperationType==="THE_DEVILS_DREAD-ROOT"){this.entity.numericStatus.calculated[t.targetState]=t.calcValue(this.entity,a);return}if(t.kind==="L-F"){console.log(this.entity.toString(),a),this.entity.numericStatus.wip[t.targetState]=t.calcValue(this.entity,a);return}});d(this,"calcStateAll",()=>jn.forEach(this.calcState));d(this,"calcState",t=>{if(this.entity.status.kind!=="Monster"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories){this.entity.numericStatus.calculated[t]=void 0;return}if(this.entity.status.monsterCategories.includes("Link")&&t!=="attack"){this.entity.numericStatus.calculated[t]=void 0;return}if(this.entity.status.monsterCategories.includes("Xyz")&&t==="level"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories.includes("Xyz")&&t==="rank"){this.entity.numericStatus.calculated[t]=void 0;return}if(!this.entity.status.monsterCategories.includes("Pendulum")&&(t==="pendulumScaleL"||t==="pendulumScaleR")){this.entity.numericStatus.calculated[t]=void 0;return}if(t!=="level"&&!this.entity.isOnField){this.entity.numericStatus.origin[t]=this.entity.origin[t],this.entity.numericStatus.wip[t]=this.entity.origin[t],this.entity.numericStatus.calculated[t]=this.entity.origin[t];return}const r=this.entity.origin[t]??0,a=this.entity.numericStatus.wip[t]??0,n=this._operators.filter(o=>o.targetState===t).filter(o=>o.isEffective);if(n.some(o=>o.stateOperationType==="THE_DEVILS_AVATAR"||o.stateOperationType==="Gradius'_Option")&&this.entity.isEffective){this.entity.numericStatus.calculated[t]=-Number.MAX_VALUE;return}const s=n.filter(o=>o.targetState===t).findLast(o=>o.targetStateGen==="origin"),c=s?s.calcValue(this.entity,r??0):r;this.entity.numericStatus.origin[t]=c;let u=c;const l=n.filter(o=>o.targetState===t).filter(o=>o.targetStateGen==="wip").findLast(o=>o.stateOperationType==="Fixation");if(!l)u=n.filter(o=>o.stateOperationType==="Addition").reduce((o,f)=>f.calcValue(this.entity,o),u),this.entity.numericStatus.wip[t]=u;else if(l.isContinuous)u=l.calcValue(this.entity,u),u=n.filter(o=>o.stateOperationType==="Addition").reduce((o,f)=>f.calcValue(this.entity,o),u),this.entity.numericStatus.wip[t]=u;else{console.log("hoge");let o=!1;u=n.filter(f=>(o=o||f===l,o&&f!==l)).filter(f=>f.stateOperationType==="Addition").reduce((f,p)=>p.calcValue(this.entity,f),a)}u<Va[t]&&(u=Va[t]),this.entity.numericStatus.calculated[t]=u})}}const Lt=class Lt extends Ci{constructor(t,r,a,n,s,c,u,l,o,f){super(t,r,a,n,s,c);d(this,"beforeRemove",()=>{});d(this,"targetState");d(this,"targetStateGen");d(this,"stateOperationType");d(this,"calcValue");d(this,"_isEffective");d(this,"negate",()=>{this._isEffective=!1});this._isEffective=!0,this.targetState=u,this.targetStateGen=l,this.stateOperationType=o,this.calcValue=(p,h)=>f(this.isSpawnedBy,p,h)}get isEffective(){return this._isEffective&&super.isEffective}get kind(){if(this.targetStateGen==="origin"){if(this.stateOperationType==="Fixation")return this.isContinuous?"O-C-F":"O-L-F";throw new me("ÁüõÁõæ„Åó„Åü„Éó„É≠„Éë„ÉÜ„Ç£",this)}if(this.targetStateGen==="wip"){if(this.stateOperationType==="Addition")return this.isContinuous?"C-A":"L-A";if(this.stateOperationType==="Fixation")return this.isContinuous?"C-F":"L-F";throw new me("ÁüõÁõæ„Åó„Åü„Éó„É≠„Éë„ÉÜ„Ç£",this)}if(this.stateOperationType==="THE_DEVILS_DREAD-ROOT")return"X-C-F";if(this.stateOperationType==="THE_DEVILS_AVATAR"||this.stateOperationType==="Gradius'_Option")return"X-C-X";throw new me("ÁüõÁõæ„Åó„Åü„Éó„É≠„Éë„ÉÜ„Ç£",this)}};d(Lt,"createContinuous",(t,r,a,n,s,c,u,l)=>new Lt(t,r,!0,a,{},n,s,c,u,l)),d(Lt,"createLingeringFixation",(t,r,a,n,s,c)=>new Lt(t,r,!1,a,n,()=>!0,s,"wip","Fixation",c)),d(Lt,"createLingeringAddition",(t,r,a,n,s,c)=>new Lt(t,r,!1,a,n,()=>!0,s,"wip","Addition",c));let lt=Lt;const Vn=i=>Object.keys(i),ao={draw:"„Éâ„É≠„Éº„Éï„Çß„Ç§„Ç∫",standby:"„Çπ„Çø„É≥„Éê„Ç§„Éï„Çß„Ç§„Ç∫",main1:"„É°„Ç§„É≥„Éï„Çß„Ç§„Ç∫Ôºë",battle1:"„Éê„Éà„É´„Éï„Çß„Ç§„Ç∫",battle2:"„Éê„Éà„É´„Éï„Çß„Ç§„Ç∫ÔºàËøΩÂä†Ôºâ",main2:"„É°„Ç§„É≥„Éï„Çß„Ç§„Ç∫Ôºí",end:"„Ç®„É≥„Éâ„Éï„Çß„Ç§„Ç∫"},no={start:"„Çπ„Çø„Éº„Éà„Çπ„ÉÜ„ÉÉ„Éó",battle:"„Éê„Éà„É´„Çπ„ÉÜ„ÉÉ„Éó",damage:"„ÉÄ„É°„Éº„Ç∏„Çπ„ÉÜ„ÉÉ„Éó",end:"„Ç®„É≥„Éâ„Çπ„ÉÜ„ÉÉ„Éó"},so={start:"„ÉÄ„É°„Éº„Ç∏„Çπ„ÉÜ„ÉÉ„ÉóÈñãÂßãÊôÇ",beforeDmgCalc:"„ÉÄ„É°„Éº„Ç∏Ë®àÁÆóÂâç",dmgCalc:"„ÉÄ„É°„Éº„Ç∏Ë®àÁÆóÊôÇ",afterDmgCalc:"„ÉÄ„É°„Éº„Ç∏Ë®àÁÆóÂæå",end:"„ÉÄ„É°„Éº„Ç∏„Çπ„ÉÜ„ÉÉ„ÉóÁµÇ‰∫ÜÊôÇ"},Ye=["draw","stanby","main1","b1Start","b1Battle","b1End","b2Start","b2Battle","b2End","main2","end"],kt=["b1DStart","b1DBeforeDmgCalc","b1DAfterDmgCalc","b1DEnd","b2DStart","b2DBeforeDmgCalc","b2DAfterDmgCalc","b2DEnd"],lo=["b1DDmgCalc","b2DDmgCalc"],jt=[...Ye,...kt,...lo],Wa={draw:{phase:"draw",step:void 0,stage:void 0},stanby:{phase:"standby",step:void 0,stage:void 0},main1:{phase:"main1",step:void 0,stage:void 0},b1Start:{phase:"battle1",step:"start",stage:void 0},b1Battle:{phase:"battle1",step:"battle",stage:void 0},b1DStart:{phase:"battle1",step:"battle",stage:"start"},b1DBeforeDmgCalc:{phase:"battle1",step:"battle",stage:"beforeDmgCalc"},b1DDmgCalc:{phase:"battle1",step:"battle",stage:"dmgCalc"},b1DAfterDmgCalc:{phase:"battle1",step:"battle",stage:"afterDmgCalc"},b1DEnd:{phase:"battle1",step:"battle",stage:"end"},b1End:{phase:"battle1",step:"end",stage:void 0},b2Start:{phase:"battle2",step:"start",stage:void 0},b2Battle:{phase:"battle2",step:"battle",stage:void 0},b2DStart:{phase:"battle2",step:"battle",stage:"start"},b2DBeforeDmgCalc:{phase:"battle2",step:"battle",stage:"beforeDmgCalc"},b2DDmgCalc:{phase:"battle2",step:"battle",stage:"dmgCalc"},b2DAfterDmgCalc:{phase:"battle2",step:"battle",stage:"afterDmgCalc"},b2DEnd:{phase:"battle2",step:"battle",stage:"end"},b2End:{phase:"battle2",step:"end",stage:void 0},main2:{phase:"main2",step:void 0,stage:void 0},end:{phase:"end",step:void 0,stage:void 0}},oo=i=>i.stage?so[i.stage]:i.step?no[i.step]:ao[i.phase],Vt=Vn(Wa).reduce((i,e)=>(i[e].key=e,i[e].name=oo(i[e]),i),Wa),mr=class mr{constructor(e,t){d(this,"entity");d(this,"isRegular");d(this,"_isStarted");d(this,"info");d(this,"continuousEffectBase");d(this,"updateState",async()=>{if(this.hasToStart!==this.isStarted){if(this.isStarted){if(!this.info)throw new me("illegal state");this._isStarted=!1,await this.continuousEffectBase.finish(this.entity,this.info),this.info=void 0;return}this.info=await this.continuousEffectBase.start(this.entity),this._isStarted=!0}});this._isStarted=!1,this.entity=e,this.continuousEffectBase=t,this.isRegular=this.appliableCellTypes.every(r=>ai.find(a=>a===r))&&this.faceList.length===1&&this.faceList[0]==="FaceUp"}get isStarted(){return this._isStarted}get appliableCellTypes(){return this.continuousEffectBase.appliableCellTypes}get appliableDuelPeriodKeys(){return this.continuousEffectBase.appliableDuelPeriodKeys}get faceList(){return this.continuousEffectBase.faceList}get hasToStart(){return!this.appliableCellTypes.includes(this.entity.fieldCell.cellType)||!this.appliableDuelPeriodKeys.includes(this.entity.duel.clock.period.key)||!this.faceList.includes(this.entity.face)?!1:this.continuousEffectBase.canStart(this.entity)}};d(mr,"createNew",(e,t)=>new mr(e,t));let ta=mr;const co=(i,e,t,r,a)=>({title:i,appliableCellTypes:e==="Monster"?["MonsterZone","ExtraMonsterZone"]:["FieldSpellZone","SpellAndTrapZone"],appliableDuelPeriodKeys:jt,faceList:["FaceUp"],canStart:n=>!n.info.isPending&&!n.info.isDying&&t(n),start:async n=>{const s=r(n);return s.forEach(a(n).push),s.map(c=>c.seq)},finish:async(n,s)=>{s.forEach(c=>a(n).removeItem(c))}}),ka=(i,e,t,r,a,n)=>({title:i,appliableCellTypes:e==="Monster"?["MonsterZone","ExtraMonsterZone"]:["FieldSpellZone","SpellAndTrapZone"],appliableDuelPeriodKeys:jt,faceList:["FaceUp"],canStart:s=>!s.info.isPending&&!s.info.isDying&&r(s),start:async s=>{const c=a(s),u=t(s);return console.info(`start : ${s.toString()} ‚áí ${u.map(l=>l.toString()).join(" ")} (${c.map(l=>l.title).join(" ")})`),u.map(n).forEach(l=>c.forEach(l.push)),{targets:u,seqList:c.map(l=>l.seq)}},finish:async(s,c)=>{c.targets.map(n).forEach(u=>c.seqList.forEach(l=>u.removeItem(l)))}}),uo=(i,e,t,r,a)=>ka(i,e,t,r,a,n=>n.procFilterBundle),pr=(i,e,t,r)=>co(i,e,t,r,a=>a.field.numericStateOperatorPool),Br=(i,e,t,r,a)=>ka(i,e,t,r,a,n=>n.numericOprsBundle),fo=(i,e,t,r,a)=>ka(i,e,t,r,a,n=>n.statusOperatorBundle);class vo extends Pr{constructor(){super(...arguments);d(this,"afterDistributeAll",t=>t.field.getAllEntities().map(r=>r.statusOperatorBundle).every(r=>r.calcStatus()))}}class po extends Fr{constructor(){super(...arguments);d(this,"calcStatus",()=>{const t=this.entity.isEffective,r={...this.entity.status},a=this._operators.reduce((n,s)=>s.statusCalculator(s,n),r);return this.entity.status=a,this.entity.isEffective===t});d(this,"beforePush",()=>{})}}class ho extends Ci{constructor(t,r,a,n,s,c,u){super(t,r,a,n,s,c);d(this,"beforeRemove",()=>{});d(this,"statusCalculator");this.statusCalculator=u}}class go extends Pr{constructor(){super(...arguments);d(this,"afterDistributeAll",()=>!0)}}class yo extends Fr{constructor(){super(...arguments);d(this,"beforePush",()=>{});d(this,"filter",(t,r,a,n,s,c,u)=>this.operators.filter(l=>l.summonTypes.includes(r)).reduce((l,o)=>({...l,...o.filter(this.entity,t,s.summoner,a,n,s.monster,c,l.posList,l.cells,u)}),s))}}class mo extends Ci{constructor(t,r,a,n,s,c,u,l){super(t,r,a,n,s,c);d(this,"beforeRemove",()=>{});d(this,"summonTypes");d(this,"filter");this.summonTypes=u,this.filter=(...o)=>l(this,...o)}}class _o{constructor(e){d(this,"cells");d(this,"duel");d(this,"summonFilterPool");d(this,"procFilterPool");d(this,"numericStateOperatorPool");d(this,"statusOperatorPool");d(this,"moveLog");d(this,"getAllCells",()=>this.cells.flat());d(this,"getCells",(...e)=>this.getAllCells().filter(t=>e.includes(t.cellType)));d(this,"getAvailableExtraMonsterZones",()=>this.getCells("ExtraMonsterZone").filter(e=>e.isAvailable));d(this,"getAllEntities",()=>this.getAllCells().map(e=>e.entities).flat());d(this,"getAllCardEntities",()=>this.getAllCells().map(e=>e.cardEntities).flat());d(this,"getCardsOnField",()=>this.getCells(...ai).map(e=>e.cardEntities).filter(e=>e.length>0).map(e=>e[0]).filter(e=>e.isOnField));d(this,"getMonstersOnField",()=>this.getCardsOnField().filter(e=>e.isOnFieldAsMonster));d(this,"getPendingCardsOnField",()=>this.getCells(...ai).map(e=>e.cardEntities).filter(e=>e.length>0).map(e=>e[0]).filter(e=>e.info.isPending));d(this,"getPendingMonstersOnField",()=>this.getPendingCardsOnField().filter(e=>e.status.kind==="Monster"));d(this,"getEntities",e=>this.getAllEntities().filter(t=>t.controller===e));d(this,"recalcArrowheads",()=>{const e=this.getAllCells().filter(t=>t.isMonsterZoneLikeCell);e.some(t=>t.recalcArrowheads)&&e.forEach(t=>t.recalcArrowheads())});d(this,"canExtraLink",(e,t)=>{if(!e.arrowheads.length)return!1;const r=t.map(l=>l.material),a=this.getCells("ExtraMonsterZone").filter(l=>l.isAvailable||r.includes(l.cardEntities[0]));if(a.length!==1)return!1;const n=a[0],s=e.arrowheads.map(l=>this.cells[n.row+l.offsetRow][n.column+l.offsetColumn]);let c=n.arrowheadSources.filter(l=>!r.includes(l)).filter(l=>s.includes(l.fieldCell));if(!c.length)return!1;let u=-1;for(;u!==c.length;){const l=c.flatMap(o=>o.coLinkedEntities).filter(o=>!r.includes(o));if(l.some(o=>o.fieldCell.cellType==="ExtraMonsterZone"))return!0;c=[...c,...l].getDistinct(),u=c.length}return!1});d(this,"drawAtSameTime",async(e,t,r,a,n,s)=>{const c=[],u=[],l=[e.draw(t,n,s),r.draw(a,n,s)].map(o=>o.catch(f=>{f instanceof Jt?f.winner&&c.push(f.winner):u.push(f)}));if(await Promise.all(l),u.length)throw new me("„Éâ„É≠„ÉºÂá¶ÁêÜ„ÅßÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑ‰æãÂ§ñ„ÅåÁô∫Áîü„Åó„Åü„ÄÇ",e,t,r,a,n,...u);if(c.length!==0)throw c.length===1?new Jt(c[0]):new Jt});d(this,"sendToGraveyard",async(e,t,r,a,n,s,c,u)=>{if(a>0&&r.length<a)return;const l=await this.duel.view.waitSelectEntities(t,r,a,n,e,u);if(l)return await pe.sendManyToGraveyard(l.map(o=>({entity:o,causedAs:s,causedBy:c,activator:t}))),this.duel.log.info(`${l.map(o=>o.status.name).join(", ")}„ÇíÂ¢ìÂú∞„Å´ÈÄÅ„Å£„ÅüÔºà${s.getDistinct().join(", ")}Ôºâ„ÄÇ`,t),l});this.duel=e,this.cells=[...Array(7)].map(()=>[]);for(const t of Object.keys(ea).map(Number))for(const r of Object.keys(ea[t]).map(Number))this.cells[t][r]=new Jl(this,t,r,t<3?e.duelists.Above:t>3?e.duelists.Below:r<2?e.duelists.Above:r>4?e.duelists.Below:void 0);this.summonFilterPool=new go,this.procFilterPool=new Il,this.numericStateOperatorPool=new io,this.statusOperatorPool=new vo,this.moveLog=new So(this)}}class So{constructor(e){d(this,"_field");d(this,"_records",[]);d(this,"getIndexOfStartPoint",e=>pi(this._records.map(t=>t.movedAt.totalProcSeq),e));d(this,"push",e=>{this._records.push(e)});d(this,"getCurrentTurnLog",()=>this.getTermLog("Current","turn"));d(this,"getPriviousChainLog",()=>this.getTermLog("Previous","chainSeq"));this._field=e}*getTermLog(e,t){const r=e==="Current"?this._field.duel.clock.currentStartPoints[t]:this._field.duel.clock.previousStartPoints[t];for(let a=this.getIndexOfStartPoint(r);a<this._records.length;a++)yield this._records[a]}}class bo{constructor(e){d(this,"entity");d(this,"_records");d(this,"_push",e=>{this.entity.field.moveLog.push(e),this._records.push(e)});d(this,"pushForRuleAction",e=>{this._push({entity:this.entity,cell:this.entity.fieldCell,face:this.entity.face,orientation:this.entity.orientation,movedAt:this.entity.duel.clock.getClone(),movedAs:[...e,"Rule"]})});d(this,"push",(e,t,r,a)=>{let n=this.entity.fieldCell;this.entity.status.kind==="XyzMaterial"&&(n=this.entity.controller.getXyzMaterialZone()),this._push({entity:this.entity,cell:n,face:this.entity.face,orientation:this.entity.orientation,movedAt:this.entity.duel.clock.getClone(),movedAs:e.getDistinct(),movedBy:t,actionOwner:r,chooser:a??r})});d(this,"negateSummon",(e,t)=>{const r=this.records.slice(-1)[0];r.cell=this.entity.field.getCells("Disable")[0],r.movedBy=e,r.movedAs=["SummonNegated"],r.actionOwner=t});this.entity=e,this._records=[]}get records(){return this._records}get latestRecord(){return this.records.slice(-1)[0]}get previousPlaceRecord(){return this.records.findLast(e=>e.cell.cellType!==this.entity.fieldCell.cellType)??this._records[0]}get currentProcRecords(){return this.records.filter(e=>e.movedAt.totalProcSeq===this.entity.duel.clock.totalProcSeq)}}const ia=["SpellCounter","KaijuCounter","NamelessCounter","IceCounter"],ra=["CycleFlip","SonicBarrier"],wo=["GoldSarcophagus"],Co=[...ia,...ra,...wo],ko={SpellCounter:"üîÆ",KaijuCounter:"‚ò¢",NamelessCounter:"üí†",IceCounter:"‚ùÑ"};class To{constructor(){d(this,"dic");d(this,"temporaryCounterNames");d(this,"add",(e,t=1,r)=>(this.dic[e]=[...this.dic[e]??[],...Array(t).fill(r)],this.dic[e]));d(this,"setQty",(e,t=1,r)=>(this.dic[e]=[...Array(t).fill(r)],this.dic[e]));d(this,"remove",(e,t=1,r)=>{const a=this.dic[e].length;if(a===void 0)return[];if(t>=a)return delete this.dic[e],[];if(r){const n=this.dic[e].filter(c=>c===r),s=this.dic[e].filter(c=>c!==r);this.dic[e]=[...n.slice(t),...s]}else this.dic[e]=this.dic[e].slice(t);return this.dic[e]});d(this,"removeAll",(e,t)=>{if(t){const a=this.dic[e].filter(n=>n===t).length;return this.dic[e]=this.dic[e].filter(n=>n!==t),a}const r=this.dic[e];return delete this.dic[e],r});d(this,"getQty",(e,t)=>this.dic[e]?t?this.dic[e].filter(r=>r===t).length:this.dic[e].length??0:0);d(this,"incrementActionCountPerTurn",e=>{this.temporaryCounterNames.push(e.title),this.incrementActionCount(e)});d(this,"incrementActionCount",e=>{this.dic[e.title]=[e.entity,...this.dic[e.title]??[]]});d(this,"getActionCount",e=>this.dic[e.title]?this.dic[e.title].filter(t=>t===e.entity).length:0);d(this,"corpseDisposal",()=>{this.temporaryCounterNames.forEach(e=>delete this.dic[e]),this.temporaryCounterNames.reset(),ra.forEach(e=>delete this.dic[e])});d(this,"removeAllActualCounters",()=>{ia.forEach(e=>delete this.dic[e])});d(this,"removeAllWhenfaceDown",()=>{this.temporaryCounterNames.forEach(e=>delete this.dic[e]),this.temporaryCounterNames.reset(),ia.forEach(e=>delete this.dic[e])});d(this,"clear",()=>{ra.forEach(e=>delete this.dic[e]),this.temporaryCounterNames.forEach(e=>delete this.dic[e]),this.temporaryCounterNames.reset(),Co.forEach(e=>delete this.dic[e])});this.dic={},this.temporaryCounterNames=[]}}const Eo=i=>{if(!(i.activator.info.ruleNormalSummonCount>=i.activator.info.maxRuleNormalSummonCount)&&i.action.entity.lvl)if(i.action.entity.lvl<5){const e=i.activator.getEnableSummonList(i.activator,"NormalSummon",["Rule"],i.action,[{monster:i.action.entity,posList:["Attack","Set"],cells:i.activator.getMonsterZones()}],[],!1);return e.length?e.flatMap(t=>t.cells).getDistinct():void 0}else{const e=i.activator.getReleasableMonsters(),t=i.action.entity.lvl<7?1:2;if(e.length<t)return;if(e.getAllOnOffPattern().filter(a=>a.length===t).some(a=>i.activator.getEnableSummonList(i.activator,"AdvanceSummon",["Rule","NormalSummon"],i.action,[{monster:i.action.entity,posList:["Attack","Set"],cells:i.activator.getMonsterZones()}],a.map(n=>({material:n})),!1).length))return[]}},Do=async(i,e,t)=>{if(!i.action.entity.lvl)return;if(i.action.entity.lvl<5)return{};const r=i.activator.getAvailableMonsterZones(),a=i.activator.getReleasableMonsters(),n=i.activator.getExtraMonsterZones(),s=i.action.entity.lvl<7?1:2;n.length>=s&&a.filter(l=>l.fieldCell.cellType!=="ExtraMonsterZone");const c=await i.activator.duel.view.waitSelectEntities(i.activator,i.activator.getReleasableMonsters(),s,l=>(t||l.length>0)&&(s<0||l.length===s)&&(r.length>0||l.some(o=>o.fieldCell.cellType==="ExtraMonsterZone")),"„É™„É™„Éº„Çπ„Åô„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",t)??[];return c.length?(await pe.releaseManyForTheSameReason(c,["Cost","AdvanceSummonRelease","Rule"],i.action.entity,i.activator),{summonMaterialInfos:c.map(l=>({material:l}))}):void 0},Ao=async i=>{var a;const e=["Rule","NormalSummon"];let t="NormalSummon";(a=i.costInfo.summonMaterialInfos)!=null&&a.length&&(t="AdvanceSummon",e.push("AdvanceSummon"));const r=i.dest?[i.dest]:i.activator.getAvailableMonsterZones();return ni(i,t,e,["Attack","Set"],r)},ni=async(i,e,t,r,a)=>{let n=a;return n||(n=i.activator.getMonsterZones(),i.action.entity.fieldCell.cellType==="ExtraDeck"&&n.push(...i.activator.duel.field.getCells("ExtraMonsterZone"))),await i.activator.summon(e,t,i.action,i.action.entity,r,n,i.costInfo.summonMaterialInfos??[],!1),{selectedEntities:[],chainBlockTags:[],prepared:void 0}},si=async i=>(i.action.entity.info.isRebornable=!0,i.action.entity.info.isPending=!1,!0),Ve={title:"ÈÄöÂ∏∏Âè¨Âñö",isMandatory:!1,playType:"NormalSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:Eo,payCosts:Do,prepare:Ao,execute:si,settle:async()=>!0},aa=(i,e,t)=>{const r=i.activator.getMonsterZones();if(i.action.entity.fieldCell.cellType==="ExtraDeck"&&r.push(...i.activator.getAvailableExtraZones()),!!i.activator.getEnableSummonList(i.activator,"SpecialSummon",["Rule"],i.action,[{monster:i.action.entity,posList:e,cells:r}],t,!1).length)return t.length===0?r:[]},xo=i=>{if(!i.activator.isTurnPlayer)return;const e=i.action.entity.getAttackTargets();return e.length?e.map(t=>t.fieldCell):void 0},Mo=async i=>{var r;if(i.action.entity.info.attackCount>0||i.action.entity.battlePosition!=="Attack")return;if((r=i.dest)!=null&&r.targetForAttack){const a=i.dest.entities.find(n=>n.entityType==="Duelist");return{selectedEntities:a?[a]:i.dest.cardEntities,chainBlockTags:[],prepared:void 0}}const e=i.action.entity.getAttackTargets();if(e.length===0)throw new me("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",i);if(e.length===1)return{selectedEntities:e,chainBlockTags:[],prepared:void 0};if(i.activator.duelistType==="NPC"){let a=i.activator.selectAttackTargetForNPC(i.action.entity,i.action);return a||(i.activator.duel.log.warn("NPC„ÅÆÊîªÊíÉÂØæË±°ÈÅ∏Êäû„Å´Â§±Êïó„Åó„Åü„Åü„ÇÅ„ÄÅ„É©„É≥„ÉÄ„É†„Å´ÊîªÊíÉÂØæË±°„ÇíÈÅ∏Êäû„ÄÇ"),a=e.randomPick()),{selectedEntities:[a],chainBlockTags:[],prepared:void 0}}const t=await i.action.entity.field.duel.view.waitSelectEntities(i.activator,e,1,a=>a.length===1,"ÊîªÊíÉÂØæË±°„ÇíÈÅ∏Êäû„ÄÇ",!0);if(t)return{selectedEntities:t,chainBlockTags:[],prepared:void 0}},Po=async i=>(i.action.entity.field.duel.declareAnAttack(i.action.entity,i.selectedEntities[0]),!0),Fe={title:"ÊîªÊíÉÂÆ£Ë®Ä",isMandatory:!1,playType:"Battle",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["b1Battle","b2Battle"],executableDuelistTypes:["Controller"],validate:xo,prepare:Mo,execute:Po,settle:async()=>!0},Wn=async i=>{if(!(i.action.entity.info.battlePotisionChangeCount>0||!i.activator.isTurnPlayer))return await i.action.entity.setBattlePosition(i.action.entity.battlePosition==="Attack"?"Defense":"Attack",["Rule"],i.action.entity,i.activator),i.action.entity.info.battlePotisionChangeCount++,i.action.entity.info.isPending=!1,{selectedEntities:[],chainBlockTags:[],prepared:void 0}},Ue={title:"ÂèçËª¢Âè¨Âñö",isMandatory:!1,playType:"FlipSummon",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:i=>i.action.entity.info.battlePotisionChangeCount===0&&i.action.entity.info.attackCount===0&&i.activator.isTurnPlayer&&i.action.entity.face==="FaceDown"?[]:void 0,prepare:Wn,execute:async i=>(i.action.entity.info.isPending=!1,!0),settle:async()=>!0},Re={title:"Ë°®Á§∫ÂΩ¢ÂºèÂ§âÊõ¥",isMandatory:!1,playType:"ChangeBattlePosition",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:i=>i.action.entity.info.battlePotisionChangeCount===0&&i.action.entity.info.attackCount===0&&i.activator.isTurnPlayer&&i.action.entity.face==="FaceUp"?[]:void 0,prepare:Wn,execute:async i=>(i.action.entity.info.isPending=!1,!0),settle:async()=>!0},_i=async(i,e=["Attack","Defense"])=>{const t=i.activator.getMonsterZones();return i.action.entity.wasMovedAfter(i.isActivatedAt)?!1:(await i.activator.summon("SpecialSummon",["Effect"],i.action,i.action.entity,e,t,[],!1),!0)},Zt=(i,e,t,r,a,n,s,c,u,l,o)=>{const f={posList:u,cells:l},p={posList:[],cells:[]};return e!==s||s.status.kind!=="Monster"||!s.origin.monsterCategories?f:s.origin.monsterCategories.includes("NormalSummonOnly")?a.includes("NormalSummon")||a.includes("AdvanceSummon")?f:p:s.origin.monsterCategories.includes("SpecialSummon")?s.isInTrashCell?s.info.isRebornable?f:p:a.union(Yn).length?f:s.origin.monsterCategories.includes("RegularSpecialSummonOnly")?o?f:p:f:f},jr={},Fo=i=>(jr[i]||(jr[i]={title:`Êà¶ÈóòÁ†¥Â£äËÄêÊÄß(${i})`,isMandatory:!0,executableCells:["MonsterZone"],executablePeriods:["b1DDmgCalc","b2DDmgCalc"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:i,isApplicableTo:(e,t,r)=>(console.log(e.entity.toString(),e,t,r),r.includes(e.entity)?t!=="BattleDestroy"?[]:[e.entity]:[]),substitute:async(e,t,r)=>r.includes(e.entity)?t!=="BattleDestroy"?[]:e.entity.isEffective?(e.entity.controller.writeInfoLog(`${e.entity.toString()}„ÅØÔºë„Çø„Éº„É≥„Å´ÔºëÂ∫¶„Å†„ÅëÊà¶Èóò„Åß„ÅØÁ†¥Â£ä„Åï„Çå„Å™„ÅÑ„ÄÇ`),[e.entity]):[]:[]}),jr[i]),Bo=i=>i.activator.canRelease([i.action.entity])&&i.action.entity.canBeReleased(i.activator,i.action.entity,["ReleaseAsCost"],i.action),Oo=async i=>(await i.action.entity.release(["Cost"],i.action.entity,i.activator),{release:[i.action.entity]}),qi=class qi extends vr{constructor(){super(...arguments);d(this,"isApplicableTo",(t,r,a)=>{console.log(this.entity.toString(),this,t,r);const n=this.entity.counterHolder.getActionCount(this);return this.isOnlyNTimesPerTurnIfFaceup>0&&n>=this.isOnlyNTimesPerTurnIfFaceup?this.entity.counterHolder.incrementActionCountPerTurn(this):this.isOnlyNTimesIfFaceup>0&&n>=this.isOnlyNTimesIfFaceup&&this.entity.counterHolder.incrementActionCount(this),this.definition.isApplicableTo(this,t,r,a)});d(this,"substitute",async(t,r,a)=>{const n=await this.definition.substitute(this,t,r,a);return this.isOnlyNTimesPerTurnIfFaceup>0?this.entity.counterHolder.incrementActionCountPerTurn(this):this.isOnlyNTimesIfFaceup>0&&this.entity.counterHolder.incrementActionCount(this),n});d(this,"getClone",()=>new qi(this.seq,this.entity,this.definition))}get definition(){return super.definition}};d(qi,"createNew",(t,r)=>new qi("AutoSeq",t,r));let na=qi;const Yn=["FusionSummon","SyncroSummon","XyzSummon","PendulumSummon","LinkSummon","RitualSummon"],qo={FusionSummon:"ËûçÂêàÂè¨Âñö",SyncroSummon:"„Ç∑„É≥„ÇØ„É≠Âè¨Âñö",XyzSummon:"„Ç®„ÇØ„Ç∑„Éº„Ç∫Âè¨Âñö",PendulumSummon:"„Éö„É≥„Éá„É•„É©„É†Âè¨Âñö",LinkSummon:"„É™„É≥„ÇØÂè¨Âñö",RitualSummon:"ÂÑÄÂºèÂè¨Âñö"},Lo=[...Yn,"AdvanceSummon","NormalSummon","SpecialSummon"],No={BattleDestroy:"Êà¶ÈóòÁ†¥Â£ä",EffectDestroy:"ÂäπÊûúÁ†¥Â£ä",RuleDestroy:"„É´„Éº„É´Á†¥Â£ä"},Ro=i=>i+"Summon",Ya=["Card","Token","Avatar"],Ho=["Duelist","Squatter"],Xn=(i,e)=>Fi(i.origin,e.origin),se=class se{constructor(e,t,r,a,n,s,c){d(this,"onBeforeMoveEvent",new Ra);d(this,"onAfterMoveEvent",new Ra);d(this,"seq");d(this,"origin");d(this,"entityType");d(this,"summonFilterBundle");d(this,"procFilterBundle");d(this,"numericOprsBundle");d(this,"statusOperatorBundle");d(this,"moveLog");d(this,"counterHolder");d(this,"face");d(this,"orientation");d(this,"owner");d(this,"fieldCell");d(this,"_status");d(this,"_numericStatus");d(this,"_info");d(this,"actions",[]);d(this,"continuousEffects",[]);d(this,"substituteEffects",[]);d(this,"canBeReleased",(e,t,r,a)=>this.procFilterBundle.operators.filter(n=>n.procTypes.union(r).length).every(n=>n.filter(e,t,a,[this])));d(this,"_hasDisappeared",!1);d(this,"toString",()=>this.entityType==="Card"?`„Ää${this.nm}„Äã`:this.nm);d(this,"setBattlePosition",async(e,t,r,a)=>{let n=`Ë°®Á§∫ÂΩ¢Âºè„ÅÆÂ§âÊõ¥Ôºö${this.toString()}Ôºà${this.battlePositionName}‚áí${Ii[e]}Ôºâ`;const s=[...t];this.battlePosition==="Set"&&(this.info.isPending=!0,s.push("Flip"),t.includes("Rule")&&(n=`${this.toString()}„ÇíÂèçËª¢Âè¨Âñö`,s.push("FlipSummon"),s.push("AttackSummon"))),this.duel.log.info(n,a),await this.moveAlone(this.fieldCell,"Monster",e==="Set"?"FaceDown":"FaceUp",e==="Attack"?"Vertical":"Horizontal","Top",s,r,a,a)});d(this,"activateAsPendulumScale",(e,t,r,a)=>this.moveAlone(e,"Spell","FaceUp","Vertical","Top",["CardActivation",...t],r,a,a));d(this,"setNonFieldMonsterPosition",async(e,t,r,a,n)=>{this.moveAlone(this.fieldCell,e,t==="FaceUp"?"FaceUp":"FaceDown","Vertical","Top",r,a,n,n)});d(this,"setAsSpellTrap",async(e,t,r,a,n)=>{await this.moveAlone(e,t,"FaceDown","Vertical","Top",[...r,"SpellTrapSet"],a,n,n)});d(this,"activateSpellTrapFromHand",async(e,t,r,a,n)=>{await this.moveAlone(e,t,"FaceUp","Vertical","Top",[...r,"CardActivation"],a,n,n)});d(this,"activateSpellTrapOnField",async(e,t,r,a)=>{await this.moveAlone(this.fieldCell,e,"FaceUp","Vertical","Top",[...t,"CardActivation"],r,a,a)});d(this,"draw",async(e,t,r)=>await this.addToHand([...e,"Draw"],t,r));d(this,"addToHand",async(e,t,r)=>await this.moveAlone(this.owner.getHandCell(),this.origin.kind,"FaceDown","Vertical","Bottom",[...e],t,r,r));d(this,"release",async(e,t,r)=>(await this.sendToGraveyard([...e,"Release"],t,r),this.info.isVanished?void 0:this.fieldCell));d(this,"ruleDestory",async()=>(await this.sendToGraveyard(["RuleDestroy"],void 0,void 0),this.info.isVanished?void 0:this.fieldCell));d(this,"sendToGraveyard",(e,t,r)=>se.sendManyToGraveyardForTheSameReason([this],e,t,r));d(this,"discard",(e,t,r)=>se.discardManyForTheSameReason([this],e,t,r));d(this,"returnToDeck",(e,t,r,a)=>se.returnManyToDeckForTheSameReason(e,[this],t,r,a));d(this,"banish",(e,t,r)=>se.banishManyForTheSameReason([this],e,t,r));d(this,"summon",(e,t,r,a,n,s,c)=>se.summonMany([{monster:this,dest:e,summoner:c??s,pos:t}],r,a,n,s));d(this,"moveAlone",async(e,t,r,a,n,s,c,u,l)=>(await se.moveMany([[this,e,t,r,a,n,s,c,u,l]],void 0),this.fieldCell));d(this,"_move",async(e,t,r,a,n,s,c,u,l)=>{if(!e)throw new Error("illegal argument: to");if(await this.onBeforeMoveEvent.trigger({entity:this,args:[e,t,r,a,n,s,c,u,l]}),this._status.kind=t,this.face=r,this.orientation=a,e!==this.fieldCell){if(this.field.duel.clock.turn>0&&(this.duel.log.info(`ÁßªÂãïÔºö${this.toString()}  ${this.fieldCell.toString()} ‚áí ${e.toString()}`,u),await this.field.duel.view.waitAnimation({entity:this,to:e,index:n,count:0})),this.fieldCell.releaseEntities(this),this.fieldCell.isPlayFieldCell&&!e.isPlayFieldCell&&(this.counterHolder.clear(),this.resetCauseOfDeath(),this.entityType==="Token")){this._hasDisappeared=!0,this.field.duel.log.info(`${this.nm}„ÅØÊ∂àÊªÖ„Åó„Åü„ÄÇ`,this.controller);return}this.status.kind!=="XyzMaterial"&&(this.fieldCell.isMonsterZoneLikeCell&&!e.isMonsterZoneLikeCell||t!=="Monster")&&(this.info.equipEntities.filter(o=>o.isOnFieldAsSpellTrap).forEach(o=>{o.info.isDying=!0,o.info.causeOfDeath=["RuleDestroy"],this.controller.writeInfoLog(`Ë£ÖÂÇôÂØæË±°${this.toString()}‰∏çÂú®„Å´„Çà„Çä${o.toString()}„ÅØÁ†¥Â£ä„Åï„Çå„Åü„ÄÇ`)}),this.info.equipEntities=[],this.fieldCell.xyzMaterials.forEach(o=>{o.info.isDying=!0,o.info.causeOfDeath=["LostXyzOwner"],this.controller.writeInfoLog(`„Ç®„ÇØ„Ç∑„Éº„Ç∫„É¢„É≥„Çπ„Çø„Éº${this.toString()}‰∏çÂú®„Å´„Çà„Çä${o.toString()}„ÅØÂ¢ìÂú∞„Å´ÈÄÅ„Çâ„Çå„Åü„ÄÇ`)})),this.fieldCell.cellType==="SpellAndTrapZone"&&e.cellType!=="SpellAndTrapZone"&&(this.info.equipedBy=void 0,this.info.equipedAs=void 0),e.acceptEntities(this,n),(e===this.isBelongTo||e.cellType==="Hand"||e.cellType==="Banished"&&this.face==="FaceDown")&&(this.counterHolder.clear(),this.resetInfoAll(),this.resetStatusAll())}return(this.isOnField&&this.face==="FaceDown"||t==="XyzMaterial")&&(this.info.equipEntities.forEach(o=>{o.info.isDying=!0,o.info.causeOfDeath=["RuleDestroy"],this.controller.writeInfoLog(`Ë£ÖÂÇôÂØæË±°${this.toString()}‰∏çÂú®„Å´„Çà„Çä${o.toString()}„ÅØÁ†¥Â£ä„Åï„Çå„Åü„ÄÇ`)}),this.counterHolder.removeAllWhenfaceDown(),this.info.materials=[],this._status.isEffective=!0,this.info.isEffectiveIn=[...mi],this.info.willBeBanished=!1,this.info.willReturnToDeck=void 0,this.resetNumericStatus(),this.info.isSettingSickness=this.status.kind==="Trap"||this.status.spellCategory==="QuickPlay"),this.moveLog.push(s,c,u,l),console.log(this.toString()),await this.onAfterMoveEvent.trigger(this),e});d(this,"initForTurn",()=>{this.info.isSettingSickness=!1,this.info.attackCount=0,this.info.battlePotisionChangeCount=0,this.counterHolder.corpseDisposal()});d(this,"resetInfoIfLeavesTheField",()=>{this._info={...this._info,isDying:!1,isPending:!1,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,effectTargets:{},attackCount:0,battlePotisionChangeCount:0,equipedBy:void 0,equipedAs:void 0,equipEntities:[]},this._info.isEffectiveIn.push(...ai),this._info.isEffectiveIn.distinct()});d(this,"resetInfoAll",()=>{var e;this._info={isDying:!1,isPending:!1,isEffectiveIn:[...mi],causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,isVanished:!1,isRebornable:((e=this.origin.monsterCategories)==null?void 0:e.union($n).length)===0,isSettingSickness:!1,materials:[],effectTargets:{},willBeBanished:!1,willReturnToDeck:void 0,attackCount:0,battlePotisionChangeCount:0,equipedBy:void 0,equipedAs:void 0,validateEquipOwner:()=>!0,equipEntities:[]},this.counterHolder.clear()});d(this,"resetNumericStatus",()=>{const e=jn.reduce((t,r)=>(t[r]=this.origin[r],t),{});this._numericStatus={origin:{...e},wip:{...e},calculated:{...e}}});d(this,"resetStatus",()=>{this._status={...this.origin,canAttack:!0,isEffective:!0,canDirectAttack:!1,isSelectableForAttack:!0,allowHandSyncro:!1,allowHandLink:!1,maxCounterQty:{}}});d(this,"resetStatusAll",()=>{this.resetNumericStatus(),this.resetStatus()});d(this,"resetCauseOfDeath",()=>{this.info.isDying=!1,this.info.causeOfDeath=[],this.info.isKilledBy=void 0,this.info.isKilledByWhom=void 0});var o;this.seq=se.nextEntitySeq++,this.counterHolder=new To,this.owner=e,this.fieldCell=t,this.entityType=r,this.origin=a,this._status=JSON.parse(JSON.stringify(a)),this._numericStatus=JSON.parse(JSON.stringify(a)),this.resetStatusAll(),this._info={isEffectiveIn:[...mi],attackCount:0,battlePotisionChangeCount:0,isDying:!1,isPending:!1,causeOfDeath:[],isKilledBy:void 0,isKilledByWhom:void 0,isVanished:!1,isRebornable:!0,isSettingSickness:!1,materials:[],effectTargets:{},willBeBanished:!1,willReturnToDeck:void 0,equipedBy:void 0,equipedAs:void 0,validateEquipOwner:()=>!0,equipEntities:[]},this.resetInfoAll(),this.face=n,this.orientation=s,this.summonFilterBundle=new yo(t.field.summonFilterPool,this),this.procFilterBundle=new eo(t.field.procFilterPool,this),this.numericOprsBundle=new ro(t.field.numericStateOperatorPool,this),this.statusOperatorBundle=new po(t.field.statusOperatorPool,this),t.acceptEntities(this,"Top"),this.moveLog=new bo(this),this.moveLog.pushForRuleAction(["Spawn"]);let u=[],l=[];this.origin.kind==="Monster"&&((o=this.origin.monsterCategories)!=null&&o.includes("Normal"))?u=[Ve,Fe,Re,Ue]:c&&(u=c.actions,l=c.continuousEffects??[],this.substituteEffects.push(...(c.substituteEffects??[]).map(f=>na.createNew(this,f))),c.defaultSummonFilter&&this.summonFilterBundle.push(new mo("default",()=>!0,!0,this,{},()=>!0,Lo,c.defaultSummonFilter))),this.actions.push(...u.map(f=>ii.createNew(this,f))),this.continuousEffects.push(...l.map(f=>ta.createNew(this,f)))}get onBeforeMove(){return this.onBeforeMoveEvent.expose()}get onAfterMove(){return this.onAfterMoveEvent.expose()}get isUnderControl(){return this.face==="FaceUp"||Zn.every(e=>e!==this.fieldCell.cellType)}get controller(){return this.fieldCell.owner??this.owner}get field(){return this.owner.duel.field}get duel(){return this.owner.duel.field.duel}get actionLogRecords(){return this.duel.chainBlockLog.records.filter(e=>e.chainBlockInfo.action.entity===this)}get status(){return this._status}set status(e){this._status={...e}}get numericStatus(){return this._numericStatus}get info(){return this._info}get nm(){return this.status.name}get atk(){return this._numericStatus.calculated.attack}get def(){return this._numericStatus.calculated.defense}get lvl(){return this._numericStatus.calculated.level}get rank(){return this._numericStatus.calculated.rank}get attr(){return this.status.attributes??[]}get types(){return this.status.types??[]}get psL(){return this._numericStatus.calculated.pendulumScaleL}get psR(){return this._numericStatus.calculated.pendulumScaleR}get arrowheads(){let e=(this.origin.arrowheadKeys??[]).map(t=>zl[t].arrowhead);return this.controller.seat==="Above"&&(e=e.map(t=>({offsetColumn:t.offsetColumn*-1,offsetRow:t.offsetRow*-1}))),e}get arrowheadDests(){var e;return(e=this.origin.monsterCategories)!=null&&e.includes("Link")?this.isOnFieldAsMonster?this.arrowheads.map(t=>[this.fieldCell.row+t.offsetRow,this.fieldCell.column+t.offsetColumn]).map(([t,r])=>this.field.cells[t][r]).filter(t=>t.isMonsterZoneLikeCell):[]:[]}get linkedEntities(){return this.isOnFieldAsMonster?[...this.arrowheadDests.map(e=>e.cardEntities[0]).map(e=>e),...this.fieldCell.arrowheadSources].getDistinct():[]}get coLinkedEntities(){var e;return this.isOnFieldAsMonster?(e=this.origin.monsterCategories)!=null&&e.includes("Link")?(console.log(this,this.arrowheadDests,this.arrowheadDests.map(t=>t.cardEntities[0]).filter(t=>t),this.fieldCell.arrowheadSources),this.arrowheadDests.map(t=>t.cardEntities[0]).filter(t=>t).union(this.fieldCell.arrowheadSources)):[]:[]}get isEffective(){return this.status.isEffective&&this.info.isEffectiveIn.includes(this.fieldCell.cellType)}get isEffectiveWeakly(){return this.status.isEffective}get battlePosition(){if(this.isOnField&&this.status.kind==="Monster")return this.orientation==="Vertical"?"Attack":this.face==="FaceUp"?"Defense":"Set"}get battlePositionName(){const e=this.battlePosition;if(e)return Ii[e]}get wasMovedAtCurrentProc(){return this.field.duel.clock.totalProcSeq===this.moveLog.latestRecord.movedAt.totalProcSeq}get wasMovedAtPreviousProc(){return this.field.duel.clock.totalProcSeq===this.moveLog.latestRecord.movedAt.totalProcSeq+1}get wasMovedAtCurrentChain(){return this.field.duel.clock.isSameChain(this.moveLog.latestRecord.movedAt)}get wasMovedAtPreviousChain(){return this.field.duel.clock.isPreviousChain(this.moveLog.latestRecord.movedAt)}get wasMovedFrom(){return this.moveLog.previousPlaceRecord.cell}get isOnField(){return ai.some(e=>e===this.fieldCell.cellType)&&!this.info.isPending&&this.status.kind!=="XyzMaterial"}get isOnFieldAsMonster(){return ri.some(e=>e===this.fieldCell.cellType)&&!this.info.isPending&&this.status.kind!=="XyzMaterial"}get isOnFieldAsSpellTrap(){return Gt.some(e=>e===this.fieldCell.cellType)&&!this.info.isPending&&this.status.kind!=="XyzMaterial"}get isInTrashCell(){return Un.some(e=>e===this.fieldCell.cellType)}get isLikeContinuousSpell(){return this.status.spellCategory==="Continuous"||this.status.spellCategory==="Field"||this.status.spellCategory==="Equip"||this.status.trapCategory==="Continuous"||(this.status.monsterCategories??[]).includes("Pendulum")}get isBelongTo(){return this.origin.monsterCategories&&this.origin.monsterCategories.union(wi).length?this.owner.getExtraDeck():this.owner.getDeckCell()}get hasDisappeared(){return this._hasDisappeared}get allStickyEffectOperators(){return[...this.procFilterBundle.operators,...this.numericOprsBundle.operators]}};d(se,"nextEntitySeq",0),d(se,"splitBattlePos",e=>({face:e==="Set"?"FaceDown":"FaceUp",orientation:e==="Attack"?"Vertical":"Horizontal"})),d(se,"recreateArray",(e,t)=>{if(!t.length)return[];const r=e.getAllCells().flatMap(a=>a.entities);return t.map(a=>a.seq).map(a=>r.find(n=>n.seq===a)).filter(a=>a!==void 0)}),d(se,"createPlayerEntity",e=>{const t=e.getHandCell();return new se(e,t,"Duelist",{name:e.profile.name,kind:"Monster",wikiEncodedName:"%A5%D7%A5%EC%A5%A4%A5%E4%A1%BC"},"FaceUp","Vertical",void 0)}),d(se,"createCardEntity",(e,t)=>{const r=t.monsterCategories&&t.monsterCategories.union(wi).length?e.getExtraDeck():e.getDeckCell(),a=new se(e,r,"Card",Gl(t),"FaceDown","Vertical",oa.get(t.name));return Object.hasOwn(tt,a.origin.name)||e.duel.log.info(`Êú™ÂÆüË£Ö„Ç´„Éº„Éâ${t.name}„Åå„Éá„ÉÉ„Ç≠„Å´ÊäïÂÖ•„Åï„Çå„Åü„ÄÇ`,e),a}),d(se,"waitCorpseDisposal",e=>se.sendManyToGraveyard(e.field.getCardsOnField().filter(t=>t.info.isDying).map(t=>({entity:t,causedAs:t.info.causeOfDeath??[],causedBy:t.info.isKilledBy,activator:t.info.isKilledByWhom})))),d(se,"releaseManyForTheSameReason",(e,t,r,a)=>e.length?(t.includes("Cost")&&a.writeInfoLog(`${e.map(n=>n.nm).join(" ")}„Çí„É™„É™„Éº„Çπ„Åó‚Äï‚Äï„ÄÅ`),se.bringManyToSameCellForTheSameReason("Graveyard","Top",e,"FaceUp","Vertical",["Release",...t],r,a)):Promise.resolve()),d(se,"sendManyToGraveyardForTheSameReason",(e,t,r,a)=>e.length?(a&&t.includes("Cost")&&(t.includes("FusionMaterial")?a.writeInfoLog(`${e.map(n=>n.nm).join(" ")}„ÇíËûçÂêàÁ¥†Êùê„Å®„Åó‚Äï‚Äï„ÄÅ`):t.includes("SyncroMaterial")?a.writeInfoLog(`${e.map(n=>n.nm).join(" ")}„Çí„Ç∑„É≥„ÇØ„É≠„Å®Á¥†Êùê„Åó‚Äï‚Äï„ÄÅ`):t.includes("LinkMaterial")?a.writeInfoLog(`${e.map(n=>n.nm).join(" ")}„Çí„É™„É≥„ÇØ„Éû„Éº„Ç´„Éº„Å´„Çª„ÉÉ„ÉÜ„Ç£„É≥„Ç∞‚Äï‚Äï„ÄÅ`):a.writeInfoLog(`${e.map(n=>n.nm).join(" ")}„ÇíÂ¢ìÂú∞„Å´ÈÄÅ„Çä‚Äï‚Äï„ÄÅ`)),se.bringManyToSameCellForTheSameReason("Graveyard","Top",e,"FaceUp","Vertical",t,r,a)):Promise.resolve()),d(se,"discardManyForTheSameReason",(e,t,r,a)=>e.length?(a&&t.includes("Cost")&&a.writeInfoLog(`${e.map(n=>n.nm).join(" ")}„ÇíÊâãÊú≠„Åã„ÇâÊç®„Å¶‚Äï‚Äï„ÄÅ`),se.bringManyToSameCellForTheSameReason("Graveyard","Top",e,"FaceUp","Vertical",["Discard",...t],r,a)):Promise.resolve()),d(se,"banishManyForTheSameReason",(e,t,r,a)=>e.length?(a&&t.includes("Cost")&&a.writeInfoLog(`${e.map(n=>n.nm).join(" ")}„Çí„Ç≤„Éº„É†„Åã„ÇâÈô§Â§ñ„Åó‚Äï‚Äï„ÄÅ`),se.bringManyToSameCellForTheSameReason("Banished","Top",e,"FaceUp","Vertical",t,r,a)):Promise.resolve()),d(se,"returnManyToDeckForTheSameReason",(e,t,r,a,n)=>t.length?(n&&r.includes("Cost")&&n.writeInfoLog(`${t.map(s=>s.nm).join(" ")}„Çí„Éá„ÉÉ„Ç≠„Å´Êàª„Åó‚Äï‚Äï„ÄÅ`),se.bringManyToSameCellForTheSameReason("Deck",e,t,"FaceDown","Vertical",r,a,n)):Promise.resolve()),d(se,"returnManyToHandForTheSameReason",(e,t,r,a)=>e.length?(a&&t.includes("Cost")&&a.writeInfoLog(`${e.map(n=>n.nm).join(" ")}„ÇíÊâãÊú≠„Å´Êàª„Åó‚Äï‚Äï„ÄÅ`),se.bringManyToSameCellForTheSameReason("Hand","Bottom",e,"FaceDown","Vertical",t,r,a)):Promise.resolve()),d(se,"convertManyToXyzMaterials",(e,t,r,a)=>e.length?(a&&t.includes("Cost")&&a.writeInfoLog(`${e.map(n=>n.nm).join(" ")}„Å´„Çà„Å£„Å¶„ÄÅ„Ç™„Éº„Éê„Éº„É¨„Ç§„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„ÇíÊßãÁØâ‚Äï‚Äï„ÄÅ`),se.moveMany(e.map(n=>[n,n.fieldCell,"XyzMaterial","FaceUp","Vertical","Top",t,r,a,a]))):Promise.resolve()),d(se,"moveToXyzOwner",(e,t,r,a,n)=>t.length?(r.includes("Effect")&&n.writeInfoLog(`${t.map(s=>s.nm).join(" ")}„ÇíXYZÁ¥†Êùê„Å®„Åó„Å¶Âê∏Âèé„ÄÇ`),se.moveMany(t.map(s=>[s,e,"XyzMaterial","FaceUp","Vertical","Top",r,a,n,n]))):Promise.resolve()),d(se,"sendManyToGraveyard",(e,t)=>se.bringManyToSameCell("Graveyard","Top",e.map(r=>({...r,face:"FaceUp",orientation:"Vertical"})),t)),d(se,"banishMany",(e,t)=>se.bringManyToSameCell("Banished","Top",e.map(r=>({...r,face:"FaceUp",orientation:"Vertical"})),t)),d(se,"bringManyToSameCellForTheSameReason",(e,t,r,a,n,s,c,u)=>se.bringManyToSameCell(e,t,r.map(l=>({entity:l,face:a,orientation:n,causedAs:s,causedBy:c,activator:u})))),d(se,"bringManyToSameCell",(e,t,r,a)=>se.moveMany(r.map(n=>[n.entity,n.entity.field.getCells(e).filter(s=>s.owner===n.entity.owner)[0],n.entity.origin.kind,n.face,n.orientation,t,n.causedAs,n.causedBy,n.activator,n.activator]),a)),d(se,"moveMany",async(e,t)=>{if(!e.length)return;const r=e[0][0].duel,n=[...e.filter(([c,u])=>c.fieldCell!==u).map(([c])=>c).filter(c=>!(t??[]).includes(c)),...r.field.getCardsOnField().filter(c=>c.info.isDying)],s=new Map;for(e.forEach(([c,u,l,o,f,p,...h])=>{let m=u,w=l,y=o,S=p,T=f;c.info.willBeBanished&&(m=c.owner.getBanished(),y="FaceUp",T="Vertical"),c.info.willReturnToDeck&&(m=c.isBelongTo,y="FaceDown",S=c.info.willReturnToDeck,T="Vertical"),c.isBelongTo.cellType==="ExtraDeck"&&(m.cellType==="Hand"||m.cellType==="Deck")&&(m=c.isBelongTo,y="FaceDown",T="Vertical"),m.isPlayFieldCell||(w=c.origin.kind),m.isMonsterZoneLikeCell||(T="Vertical"),s.set(m,[[c,m,w,y,T,S,...h],...s.get(m)??[]])});;){const c=Array.from(s.values()).map(l=>l.pop()).filter(l=>l!==void 0).map(([l,...o])=>l._move(...o));if(!c.length)break;await Promise.all(c);const u=r.field.getCardsOnField().filter(l=>l.info.isDying).filter(l=>!n.includes(l)).map(l=>({entity:l,causedAs:l.info.causeOfDeath??[],causedBy:l.info.isKilledBy,activator:l.info.isKilledByWhom}));u.length&&await se.sendManyToGraveyard(u,n)}console.log(e.map(([c])=>c.toString())),se.settleEntityMove(r),console.log(e.map(([c])=>c.toString()))}),d(se,"summonMany",async(e,t,r,a,n)=>{if(!e.length)return;const s={Attack:"AttackSummon",Defense:"DefenseSummon",Set:"SetSummon"};await Promise.all(e.map(async({monster:c,dest:u,pos:l,summoner:o})=>{if(t==="NormalSummon"||t==="AdvanceSummon"){const h=t==="AdvanceSummon"?"„Ç¢„Éâ„Éê„É≥„Çπ":"";l==="Attack"?c.field.duel.log.info(`${c.toString()}„Çí${h}Âè¨Âñö`,o):c.duel.log.info(`${c.toString()}„Çí${h}„Çª„ÉÉ„Éà`,o),r.includes("Rule")?o.info.ruleNormalSummonCountQty++:o.info.effectNormalSummonCountQty++}else t==="SpecialSummon"?c.duel.log.info(`${c.toString()}„Çí${Ii[l]}„ÅßÁâπÊÆäÂè¨Âñö`,o):c.duel.log.info(`${c.toString()}„Çí${Ii[l]}„Åß${qo[t]}ÔºÅ`,o),o.info.specialSummonCountQty++;c.info.battlePotisionChangeCount=1;const{face:f,orientation:p}=se.splitBattlePos(l);r.includes("Rule")&&(c.info.isPending=!0),await c._move(u,"Monster",f,p,"Top",[t,s[l],...r],a,n,o)})),e.map(c=>c.summoner).forEach(c=>{t==="NormalSummon"||t==="AdvanceSummon"?r.includes("Rule")?c.info.ruleNormalSummonCount++:c.info.effectNormalSummonCount++:c.info.specialSummonCount++}),se.settleEntityMove(e[0].monster.duel)}),d(se,"settleEntityMove",e=>{e.field.recalcArrowheads(),e.distributeOperators(e.clock);const t=e.field.getAllEntities().filter(r=>r.wasMovedAtCurrentProc);t.filter(r=>!r.isOnField).forEach(r=>r.resetInfoIfLeavesTheField()),t.filter(r=>r.face==="FaceDown").filter(r=>r.fieldCell===r.isBelongTo).forEach(r=>{r.resetInfoAll(),r.resetStatusAll()}),t.flatMap(r=>r.continuousEffects).forEach(r=>r.updateState()),e.field.getAllCells().filter(r=>r.needsShuffle).map(r=>r.shuffle())});let pe=se;Ri.prototype.summon=async function(i,e,t,r,a,n,s,c){return(await this.summonMany(this,i,e,t,[{monster:r,posList:a,cells:n}],s,!1,l=>l.length===1,c)??[])[0]};let $o=class{constructor(e){d(this,"onUpdateEvent",new ze);d(this,"nextSeq");d(this,"records",[]);d(this,"duel");d(this,"dispose",()=>{this.onUpdateEvent.clear()});d(this,"error",e=>{console.error(e);const t=["„Ç®„É©„ÉºÁô∫Áîü"];e instanceof Error?(e instanceof me&&(t.push("-- „Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏ --"),t.push(e.message),t.push("-- Èñ¢ÈÄ£„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà --"),e.items.forEach(r=>t.push(JSON.stringify(r)))),t.push("-- „Ç®„É©„ÉºÂêçÁß∞ --"),t.push(e.name||"„Ç®„É©„ÉºÂêçÁß∞ÂèñÂæóÂ§±Êïó"),t.push("-- „Çπ„Çø„ÉÉ„ÇØ„Éà„É¨„Éº„Çπ --"),t.push(e.stack||"„Çπ„Çø„ÉÉ„ÇØ„Éà„É¨„Éº„ÇπÂèñÂæóÂ§±Êïó")):(t.push("-- „Ç®„É©„ÉºÂûãÁâπÂÆöÂ§±Êïó --"),t.push(JSON.stringify(e))),this.write("error","System",t,void 0,void 0,void 0,void 0,void 0)});d(this,"warn",e=>{this.write("warn","System",["„ÄêÊ≥®ÊÑè„Äë",e],void 0,void 0,void 0,void 0,void 0)});d(this,"info",(e,t)=>{this.write("info","Others",[e],t,void 0,void 0,void 0,void 0)});d(this,"pushMoveLog",(e,t,r,a)=>{this.write("info","EntityMove",["ÁßªÂãï"],e,t,void 0,r,a)});d(this,"write",(e,t,r,a,n,s,c,u)=>{const l=r.join(`
`);console.log(this.nextSeq),this.records.push({seq:this.nextSeq++,lvl:e,type:t,clock:this.duel.clock.getClone(),text:l,duelist:a,mainEntity:n,subEntities:s??[],from:c,to:u}),this.onUpdateEvent.trigger(this.nextSeq-1),console.log(this.nextSeq-1)});this.nextSeq=0,this.duel=e}get onUpdate(){return this.onUpdateEvent.expose()}get lastRecord(){return this.records.slice(-1)[0]}};const Xa=["DuelEntitiesSelector","DuelActionSelector","DuelTextSelector"];class jo{constructor(e){d(this,"onUpdateEvent",new ze);d(this,"states");d(this,"view");d(this,"cancelAll",()=>{Xa.forEach(e=>this.states[e]="Disable"),console.info(this,"cancelAll"),this.onUpdateEvent.trigger()});d(this,"duelEntitiesSelectorArg",{title:"ÂØæË±°„ÇíÈÅ∏Êäû",entities:[],validator:()=>!0,qty:-1,cancelable:!1,chainBlockInfos:[]});d(this,"duelEntitiesSelectorValue");d(this,"duelEntitiesSelectorResolve",()=>{});d(this,"selectDuelEntities",async e=>(this.duelEntitiesSelectorArg=e,this.states.DuelEntitiesSelector="Shown",this.onUpdateEvent.trigger(),new Promise(t=>{this.duelEntitiesSelectorResolve=r=>{this.states.DuelEntitiesSelector="Disable",this.onUpdateEvent.trigger(),t(r)}})));d(this,"cardActionSelectorArg",{title:"„Ç´„Éº„ÉâÊìç‰Ωú„ÇíÈÅ∏Êäû„ÄÇ",activator:void 0,actions:[],cancelable:!1});d(this,"cardActionSelectorResolve",()=>{});d(this,"cardActionSelectorValue");d(this,"selectAction",async(e,t)=>(this.cardActionSelectorArg=t,this.states.DuelActionSelector="Shown",e.onWaitEnd.append(this.cancelAll),this.onUpdateEvent.trigger(),new Promise(r=>{this.cardActionSelectorResolve=a=>{this.states.DuelActionSelector="Disable",e.onWaitEnd.remove(this.cancelAll),this.onUpdateEvent.trigger(),r(a)}})));d(this,"duelTextSelectorArg",{title:"„Ç´„Éº„ÉâÊìç‰Ωú„ÇíÈÅ∏Êäû„ÄÇ",choises:[],cancelable:!1});d(this,"duelTextSelectorResolve",()=>{});d(this,"duelTextSelectorValue");d(this,"selectText",async(e,t)=>(this.duelTextSelectorArg=t,this.states.DuelTextSelector="Shown",e.onWaitEnd.append(this.cancelAll),this.onUpdateEvent.trigger(),new Promise(r=>{this.duelTextSelectorResolve=a=>{this.states.DuelTextSelector="Disable",e.onWaitEnd.remove(this.cancelAll),this.onUpdateEvent.trigger(),r(a)}})));this.view=e,this.states=Xa.reduce((t,r)=>(t[r]="Disable",t),{})}get onUpdate(){return this.onUpdateEvent.expose()}}const Zo=i=>new Promise(e=>setTimeout(e,i)),Uo=()=>{let i=()=>{},e=()=>{};return{promise:new Promise((r,a)=>{i=r,e=a}),resolve:i,reject:e}};class Go{constructor(e){d(this,"onDuelUpdateEvent",new ze);d(this,"requireUpdate",()=>{this.onDuelUpdateEvent.trigger()});d(this,"onWaitStartEvent",new ze);d(this,"onWaitEndEvent",new ze);d(this,"onDragStartEvent",new ze);d(this,"onDragEndEvent",new ze);d(this,"onAnimationStartEvent",new ze);d(this,"onShowCardEntityEvent",new ze);d(this,"duel");d(this,"modalController");d(this,"_message");d(this,"waitMode");d(this,"infoBoardState");d(this,"infoBoardCell");d(this,"removeSvelteInfo",e=>{const t={...e};return t.selectedEntities&&(t.selectedEntities=pe.recreateArray(this.duel.field,t.selectedEntities)),t});d(this,"getCell",(e,t)=>this.duel.field.cells[e][t]);d(this,"showCardInfo",(e,t)=>{this.onShowCardEntityEvent.trigger({card:e,mode:t})});d(this,"dispose",()=>{this.onDragStartEvent.clear(),this.onDragEndEvent.clear(),this.onDuelUpdateEvent.clear(),this.onWaitStartEvent.clear(),this.onWaitEndEvent.clear()});d(this,"waitFieldAction",async e=>{if(this.duel.getTurnPlayer().duelistType==="NPC"){const t=this.duel.getTurnPlayer().selectActionForNPC(e,[]);return t?{action:t}:{phaseChange:this.duel.nextPhaseList[0]}}return await this._waitDuelistAction(this.duel.getTurnPlayer(),e,"SelectFieldAction","")});d(this,"waitQuickEffect",async(e,t,r,a,n)=>{if(t.length===0)return;if(e.duelistType==="NPC")return e.selectActionForNPC(t,r);const s=[];return s.push(this.modalController.selectAction(this,{title:a,activator:e,actions:t,cancelable:n}).then(c=>c&&c)),s.push(this._waitDuelistAction(e,t,"SelectAction",this.message).then(c=>(this.infoBoardState="Log",c.action))),await Promise.any(s)});d(this,"waitSubAction",async(e,t,r,a=!1)=>{if(e.duelistType==="NPC")throw Error("Not implemented");return await this._waitDuelistAction(e,t,"SelectAction",r,void 0,void 0,void 0,a)});d(this,"waitSelectEntities",async(e,t,r,a,n,s=!1)=>{let c=[];if(r&&t.length===r)return[...t];if(e.duelistType==="NPC"){for(;!a(c);){const l=r&&r>0?r:Math.floor(Math.random()*t.length)+1;c=t.randomPickMany(l)}return c}return this.waitMode=t.every(l=>l.fieldCell.isPlayFieldCell&&l.getIndexInCell()===0||l.fieldCell.cellType==="Hand"&&l.controller===e)?"SelectFieldEntities":"SelectEntities",[...(await this._waitDuelistAction(e,[],this.waitMode,n,t,r,a,s)).selectedEntities??[]]});d(this,"_waitDuelistAction",async(e,t,r,a,n,s,c,u=!1)=>{this.waitMode=r,this._message=a,this.onDuelUpdateEvent.trigger();const l=Uo(),o={resolve:l.resolve,activator:e,enableActions:t,qty:s,chainBlockInfos:e.duel.chainBlockInfos,entitiesValidator:c||(()=>!1),selectableEntities:n||[]};n&&c&&this.waitMode==="SelectEntities"&&(o.duelEntitiesSelectorArg={title:a,entities:n,validator:c,qty:s??-1,cancelable:!1,chainBlockInfos:e.duel.chainBlockInfos}),this.onWaitStartEvent.trigger(o);const f=await l.promise;if(this.waitMode="None",this.onWaitEndEvent.trigger(),f.surrender)throw new Jt(this.duel.duelists.Above);if(!u&&f.cancel)throw new me("„Ç≠„É£„É≥„Çª„É´‰∏çÂèØ„ÅÆ„Ç¢„ÇØ„Ç∑„Éß„É≥„Åå„Ç≠„É£„É≥„Çª„É´„Åï„Çå„Åü„ÄÇ",f,t,r,n);return this.infoBoardState="Log",this.removeSvelteInfo(f)});d(this,"waitSelectSummonDest",async(e,t,r,a,n)=>{const s=r.length>1?"„Ç´„Éº„Éâ„ÇíÂè¨ÂñöÂÖà„Å∏„Éâ„É©„ÉÉ„Ç∞„ÄÇ":"Ë°®Á§∫ÂΩ¢Âºè„ÇíÈÅ∏Êäû„ÄÇ",c=a.map(f=>ii.createDammyAction(t,f,r,f)),u=this.modalController.selectAction(t.field.duel.view,{title:s,activator:e,actions:c,cancelable:!1}),l=this.waitSubAction(t.controller,c,s,n).then(f=>f.action),o=await Promise.any([u,l]);if(!o&&!n)throw new me("„Ç≠„É£„É≥„Çª„É´‰∏çÂèØ„ÅÆ„Ç¢„ÇØ„Ç∑„Éß„É≥„Åå„Ç≠„É£„É≥„Çª„É´„Åï„Çå„Åü„ÄÇ",o);if(o){if(!o.cell)throw new me("Âè¨ÂñöÂÖà„ÅÆ„Çª„É´„ÅåÊåáÂÆö„Åï„Çå„Å™„Åã„Å£„Åü„ÄÇ",o);if(!o.pos)throw new me("Ë°®Á§∫ÂΩ¢Âºè„ÅåÊåáÂÆö„Åï„Çå„Å™„Åã„Å£„Åü„ÄÇ",o);return{dest:o.cell,pos:o.pos}}});d(this,"waitSelectText",async(e,t,r=!1)=>this.duel.view.modalController.selectText(this.duel.view,{title:t,choises:e,cancelable:r}));d(this,"waitAnimation",async e=>(this._message="",this.waitMode="Animation",this.onDuelUpdateEvent.trigger(),new Promise(t=>this.onAnimationStartEvent.trigger({...e,resolve:t}))));d(this,"setDraggingActions",e=>{this.onDragStartEvent.trigger(e),this.requireUpdate()});d(this,"removeDraggingActions",()=>{this.onDragEndEvent.trigger()});d(this,"waitDammyActions",async(e,t,r,a,n,s=!1)=>{let c=r.randomPick();if(r.length>1&&e.duelistType!=="NPC"){const u=[ii.createDammyAction(t,n,r,void 0)];this.duel.view.modalController.selectAction(this.duel.view,{title:a,activator:e,actions:u,cancelable:!1});const l=await this.duel.view.waitSubAction(e,u,a,s),o=l.action;if(!o&&!s)throw new li("",l);if(!o)return;c=o.cell||c}return c});this.duel=e,this._message="",this.waitMode="None",this.infoBoardState="Log",this.infoBoardCell=e.duelists.Below.getExtraDeck(),this.modalController=new jo(this)}get onDuelUpdate(){return this.onDuelUpdateEvent.expose()}get onWaitStart(){return this.onWaitStartEvent.expose()}get onWaitEnd(){return this.onWaitEndEvent.expose()}get onDragStart(){return this.onDragStartEvent.expose()}get onDragEnd(){return this.onDragEndEvent.expose()}get onAnimation(){return this.onAnimationStartEvent.expose()}get onShowCardEntity(){return this.onShowCardEntityEvent.expose()}get message(){return this._message||this.duel.log.lastRecord.text}}const sa=["turn","phaseSeq","stepSeq","stageSeq","chainSeq","chainBlockSeq","procSeq"];[...sa];class zo{constructor(){d(this,"onClockChangeEvents",{turn:new ze,phaseSeq:new ze,stepSeq:new ze,stageSeq:new ze,chainSeq:new ze,chainBlockSeq:new ze,procSeq:new ze});d(this,"_turn",0);d(this,"_phaseSeq",0);d(this,"_stepSeq",0);d(this,"_stageSeq",0);d(this,"_chainSeq",0);d(this,"_chainBlockSeq",0);d(this,"_procSeq",0);d(this,"_totalProcSeq",0);d(this,"_periodKey");d(this,"_previousStartPoints",{turn:0,phaseSeq:0,stepSeq:0,stageSeq:0,chainSeq:0,chainBlockSeq:0,procSeq:0});d(this,"_currentStartPoints",{turn:0,phaseSeq:0,stepSeq:0,stageSeq:0,chainSeq:0,chainBlockSeq:0,procSeq:0});d(this,"setPhase",(e,t)=>{const r=Object.values(Vt).filter(a=>a.phase===t).find(a=>(a.step??"start")==="start");if(!r)throw new me("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",this.period,t,Vt);t==="draw"?(this.turn>0&&e.log.info("„Çø„Éº„É≥ÁµÇ‰∫Ü„ÄÇ",e.getTurnPlayer()),this._turn++,this._phaseSeq=0):(e.log.info(`„Éï„Çß„Ç§„Ç∫ÁßªË°åÔºà${this.period.name}‚Üí${r.name}Ôºâ`,e.getTurnPlayer()),this._phaseSeq++),this._stepSeq=0,this._stageSeq=0,this.periodKey=r.key});d(this,"setStep",(e,t)=>{const r=this.period.phase,a=Object.values(Vt).filter(n=>n.phase===r).find(n=>(n.step??"")===t);if(!a)throw new me("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",this.period,t,Vt);this.period.name!==a.name&&(e.log.info(`„Çπ„ÉÜ„ÉÉ„ÉóÁßªË°åÔºà${this.period.name}‚Üí${a.name}Ôºâ`,e.getTurnPlayer()),this._stepSeq++,this._stageSeq=0,this.periodKey=a.key)});d(this,"setStage",(e,t)=>{const r=this.period,a=Object.values(Vt).filter(n=>n.phase===r.phase).filter(n=>n.step===r.step).find(n=>(n.stage??"")===t);if(!a)throw new me("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",this.period,t,Vt);e.log.info(`„Çø„Ç§„Éü„É≥„Ç∞ÁßªË°åÔºà${this.period.name}‚Üí${a.name}Ôºâ`,e.getTurnPlayer()),this._stageSeq++,this.periodKey=a.key});d(this,"incrementChainSeq",()=>{this._chainSeq++,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq()});d(this,"incrementChainBlockSeq",()=>{this._chainBlockSeq++,this._procSeq=0,this.incrementTotalProcSeq()});d(this,"incrementProcSeq",()=>{this._procSeq++,this.incrementTotalProcSeq()});d(this,"incrementTotalProcSeq",()=>{this._totalProcSeq++;let e=!1;sa.toReversed().forEach(t=>{e&&(this._previousStartPoints[t]=this.currentStartPoints[t],this._currentStartPoints[t]=this.totalProcSeq),e=this[t]===0}),this.onClockChangeEvents.procSeq.trigger(this),sa.toReversed().filter(t=>this._currentStartPoints[t]=this.totalProcSeq).forEach(t=>{console.info(this.constructor.name,"event trigger",t,this.periodKey,this.totalProcSeq),this.onClockChangeEvents[t].trigger(this)})});d(this,"toString",()=>`${this.totalProcSeq}(t${this.turn}-phs${this.phaseSeq}-stp${this.stepSeq}-stg${this.stepSeq}-c${this.chainSeq}-cb${this.chainBlockSeq}-prc${this.procSeq})`);d(this,"getClone",()=>({turn:this.turn,phaseSeq:this.phaseSeq,stepSeq:this.stepSeq,stageSeq:this.stageSeq,chainSeq:this.chainSeq,chainBlockSeq:this.chainBlockSeq,procSeq:this.procSeq,totalProcSeq:this.totalProcSeq,period:this.period}));d(this,"isSameTurn",e=>this.turn===e.turn);d(this,"isSameChain",e=>this.turn===e.turn&&this.phaseSeq===e.phaseSeq&&this.stepSeq===e.stepSeq&&this.stageSeq===e.stageSeq&&this.chainSeq===e.chainSeq);d(this,"isPreviousChain",e=>this.turn===e.turn&&this.phaseSeq===e.phaseSeq&&this.stepSeq===e.stepSeq&&this.stageSeq===e.stageSeq&&this.chainSeq===e.chainSeq+1);d(this,"isPreviousProc",e=>this.totalProcSeq===e.totalProcSeq+1);d(this,"isUponAttackDeclaration",()=>this.period.step==="battle"&&this.chainSeq===1);this._periodKey="end"}get onTurnChange(){return this.onClockChangeEvents.turn.expose()}get onStageChange(){return this.onClockChangeEvents.stageSeq.expose()}get onProcSeqChange(){return this.onClockChangeEvents.procSeq.expose()}get previousStartPoints(){return this._previousStartPoints}get currentStartPoints(){return this._currentStartPoints}set periodKey(e){this._periodKey!==e&&(this._periodKey=e,this._chainSeq=0,this._chainBlockSeq=0,this._procSeq=0,this.incrementTotalProcSeq())}get periodKey(){return this._periodKey}get period(){return Vt[this.periodKey]}get turn(){return this._turn}get phaseSeq(){return this._phaseSeq}get stepSeq(){return this._stepSeq}get stageSeq(){return this._stageSeq}get chainSeq(){return this._chainSeq}get chainBlockSeq(){return this._chainBlockSeq}get procSeq(){return this._procSeq}get totalProcSeq(){return this._totalProcSeq}get isFirstChain(){return this.chainSeq===0}}class Vo{constructor(e){d(this,"nextSeq");d(this,"records",[]);d(this,"duel");d(this,"push",e=>{this.records.push({seq:this.nextSeq++,clock:this.duel.clock.getClone(),chainBlockInfo:e})});this.nextSeq=0,this.duel=e}}pe.prototype.hasBeenSummonedNow=function(i,e=["Attack","Defense"]){const t=this,r=e.map(Ro),a=t.moveLog.latestRecord.movedAs;return!(!t.wasMovedAtPreviousChain||!a.union(i).length||!a.union(r).length)};pe.prototype.getAttackTargets=function(){if(!this.hasAttackRight())return[];const i=this.controller.getOpponentPlayer().getMonstersOnField().filter(e=>e.status.isSelectableForAttack);return(this.status.canDirectAttack||!i.length)&&i.push(this.controller.getOpponentPlayer().entity),i.filter(e=>e.canBeTargetOfBattle(this.controller,this)).filter(e=>this.procFilterBundle.operators.filter(t=>t.procTypes.includes("BattleTarget")).every(t=>t.filter(this.controller,this,{},[e])))};pe.prototype.canDirectAttack=function(){return this.getAttackTargets().some(i=>i.entityType==="Duelist")};pe.prototype.canAttackToMonster=function(){return this.getAttackTargets().some(i=>i.entityType!=="Duelist")};pe.prototype.hasAttackRight=function(){return this.battlePosition==="Attack"&&this.info.attackCount===0&&this.status.canAttack};pe.prototype.canBeEffected=function(i,e,t){return this.procFilterBundle.operators.filter(a=>a.procTypes.some(n=>n==="Effect")).every(a=>a.filter(i,e,t,[this]))};const Kn=(i,e,t,r,a)=>i.canBeEffected(t,r,a)&&i.procFilterBundle.operators.filter(n=>n.procTypes.some(s=>s===e)).every(n=>n.filter(t,r,a,[i]));pe.prototype.canBeTargetOfEffect=function(i){return Kn(this,"EffectTarget",i.activator,i.action.entity,i.action)};pe.prototype.canBeBanished=function(i,e,t){return this.fieldCell.cellType==="Banished"?!1:Kn(this,"BanishAsEffect",i,e,t)};pe.prototype.canBeTargetOfBattle=function(i,e){const t=this;return t.procFilterBundle.operators.filter(r=>r.procTypes.some(a=>a==="BattleTarget")).every(r=>r.filter(i,e,{},[t]))};pe.prototype.validateDestory=function(i,e,t,r){const a=this;let n=a.procFilterBundle.operators.filter(s=>s.procTypes.includes(i)).every(s=>s.filter(e,t,r??{},[a]));return n&&i==="EffectDestroy"&&(n=a.canBeEffected(e,t,r)),n};pe.prototype.getIndexInCell=function(){const i=this;if(i.info.isVanished)return-1;const e=i.fieldCell.cardEntities.indexOf(i);if(e<0)throw new me("„Ç®„É≥„ÉÜ„Ç£„ÉÜ„Ç£„Å®„Çª„É´„ÅÆÁä∂ÊÖã„ÅåÁüõÁõæ„Åó„Å¶„ÅÑ„Çã„ÄÇ",[i,i.fieldCell]);return e};pe.prototype.getXyzMaterials=function(){const i=this;return(i.status.monsterCategories??[]).includes("Xyz")?i.fieldCell.xyzMaterials:[]};pe.prototype.wasMovedAfter=function(i){return console.log(this.toString(),this.moveLog.latestRecord.movedAt.totalProcSeq,i.totalProcSeq),this.moveLog.latestRecord.movedAt.totalProcSeq>i.totalProcSeq};const Wo=(i,e)=>{if(i.info.isDying||i.status.kind==="XyzMaterial"||!i.isOnField&&i.fieldCell.cellType!=="Deck"&&i.fieldCell.cellType!=="Hand")return!1;const t=e.action.playType==="Battle"?"BattleDestroy":"EffectDestroy",r=t==="BattleDestroy"&&e.action.entity===i?e.selectedEntities[0]:e.action.entity;return i.info.isDying=i.validateDestory(t,e.activator,r,e.action),i.info.isDying&&(i.info.causeOfDeath=[t],i.info.isKilledBy=r,i.info.isKilledByWhom=e.activator,t==="BattleDestroy"&&(i.info.isKilledByWhom=r.controller)),i.info.isDying},Xt=class Xt{constructor(){}};d(Xt,"tryDestroy",async(e,t)=>{const r=await Xt.tryMarkForDestory(e,t);return await pe.waitCorpseDisposal(t.activator.duel),r}),d(Xt,"tryMarkForDestory",async(e,t)=>{let r=e.filter(c=>Wo(c,t));if(!r.length)return[];const a=t.action.playType==="Battle"?"BattleDestroy":"EffectDestroy";(await Promise.all(e[0].field.getAllEntities().flatMap(c=>c.substituteEffects.filter(u=>u.isMandatory).filter(u=>u.executableCells.includes(c.fieldCell.cellType)).filter(u=>u.isApplicableTo(a,e,t).length).flatMap(u=>u.substitute(a,e,t))))).flatMap(c=>c).forEach(c=>{c.resetCauseOfDeath()}),r=r.filter(c=>c.info.isDying);let n=e[0].field.getAllEntities().flatMap(c=>c.substituteEffects.filter(u=>!u.isMandatory).filter(u=>u.executableCells.includes(c.fieldCell.cellType)).filter(u=>u.isApplicableTo(a,e,t).length).map(u=>({chooser:c.owner,effect:u,sacrifice:c})));for(const c of n.map(u=>u.sacrifice.controller).getDistinct()){const u=n.filter(p=>p.sacrifice.controller===c),l=u.map(p=>ii.createDammyAction(p.sacrifice,p.effect.title,[])),o=await e[0].duel.view.waitSubAction(c,l,"Ë∫´‰ª£„Çè„ÇäÂäπÊûú„ÇíÈÅ©Áî®„Åô„ÇãÔºü",!0);if(!o||!o.action)continue;const f=u.filter(p=>{var h;return p.effect.title===((h=o.action)==null?void 0:h.title)}).find(p=>{var h;return p.sacrifice===((h=o.action)==null?void 0:h.entity)});if(!f)throw new me("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",o,l,r);if((await f.effect.substitute(a,r,t)).forEach(p=>{p.resetCauseOfDeath()}),r=r.filter(p=>p.info.isDying),!r.length)return[];n=n.filter(p=>p.effect.isApplicableTo(a,e,t).length)}const s=r.filter(c=>c.info.isDying);return s.forEach(c=>c.duel.log.info(`${c.toString()}„Çí${No[a]}„ÄÇ`,c.info.isKilledByWhom)),s}),d(Xt,"tryBanish",async(e,t)=>{const r=e.filter(a=>a.canBeBanished(t.activator,t.action.entity,t.action));return await pe.banishManyForTheSameReason(r,["Effect"],t.action.entity,t.activator),r.filter(a=>a.fieldCell.cellType==="Banished").filter(a=>a.moveLog.latestRecord.movedBy===t.action.entity)}),d(Xt,"negateSummonMany",(e,t)=>{const r=t.duel.field.getPendingMonstersOnField();return r.forEach(a=>a.moveLog.negateSummon(e,t)),t.writeInfoLog(`${r.map(a=>a.toString()).join(" ")}.„ÅÆÂè¨Âñö„ÅØÁÑ°Âäπ„Å´„Åï„Çå„Åü„ÄÇ`),r});let Xe=Xt;const Yo=["PlayFirst","DrawFirst","Random"],Ka={PlayFirst:"ÂÖàÊîª",DrawFirst:"ÂæåÊîª",Random:"„É©„É≥„ÉÄ„É†"};class Jt extends Error{constructor(t){const r=t?`„Éá„É•„Ç®„É´„ÅåÁµÇ‰∫Ü„Åó„Åü„ÄÇÂãùËÄÖÔºö${t.profile.name}`:"„Éá„É•„Ç®„É´„ÅåÁµÇ‰∫Ü„Åó„Åü„ÄÇ„Éâ„É≠„Éº„ÄÇ";super(r);d(this,"winner");this.winner=t}}class me extends Error{constructor(t,...r){super(t);d(this,"message");d(this,"items");this.message=t,this.items=r}}class li extends me{constructor(...e){super("„Ç≠„É£„É≥„Çª„É´‰∏çÂèØ„ÅÆ„Ç¢„ÇØ„Ç∑„Éß„É≥„Åå„Ç≠„É£„É≥„Çª„É´„Åï„Çå„Åü„ÄÇ",...e)}}class Xo{constructor(e,t,r,a=[],n,s,c,u=[],l="Random"){d(this,"view");d(this,"log");d(this,"chainBlockLog");d(this,"clock");d(this,"nextPhaseList");d(this,"field");d(this,"attackingMonster");d(this,"targetForAttack");d(this,"_chainBlockInfos");d(this,"duelists");d(this,"priorityHolder");d(this,"isEnded");d(this,"coin",!1);d(this,"startMode");d(this,"distributeOperators",e=>{console.info(`[totalProcSeq]:${e.totalProcSeq}`);let t=0;for(;;){if(t++,t>10)throw new me("ÁÑ°Èôê„É´„Éº„ÉóÁô∫Áîü");if(this.field.procFilterPool.distributeAll(this)&&this.field.statusOperatorPool.distributeAll(this)&&this.field.numericStateOperatorPool.distributeAll(this)&&this.field.summonFilterPool.distributeAll(this))return}});d(this,"getTurnPlayer",()=>this.clock.turn%2===0?this.secondPlayer:this.firstPlayer);d(this,"getNonTurnPlayer",()=>this.clock.turn%2===0?this.firstPlayer:this.secondPlayer);d(this,"main",async()=>{console.info("main start!"),this.coin=this.startMode==="PlayFirst"?!0:this.startMode==="DrawFirst"?!1:Math.random()>.5,this.priorityHolder=this.firstPlayer;for(const e of Object.values(this.duelists))e.pushDeck(),e.getDeckCell().shuffle(),e.initHand.length&&e.initHand.forEach(t=>{const r=e.getDeckCell().cardEntities.find(a=>a.origin.name===t);if(!r){this.log.info(`ÂàùÊâãÊìç‰Ωú„Å´„Çà„Çä${t}„ÇíÊâãÊú≠„Å´Âä†„Åà„Çà„ÅÜ„Å®„Åó„Åü„Åå„ÄÅ„Éá„ÉÉ„Ç≠„Å´Â≠òÂú®„Åó„Å™„ÅÑ„ÄÇ`);return}r.addToHand(["System"],void 0,void 0),this.log.info(`ÂàùÊâãÊìç‰Ωú„Å´„Çà„Çä${r.toString()}„ÇíÊâãÊú≠„Å´Âä†„Åà„Åü`,e)}),await e.draw(5-e.getHandCell().cardEntities.length,void 0,void 0);this.log.info(`„Äê„Éá„É•„Ç®„É´ÈñãÂßã„Äë${this.firstPlayer.profile.name} V.S. ${this.secondPlayer.profile.name}`),this.log.info(`ÂÖàÊîªÔºö${this.firstPlayer.profile.name} ÂæåÊîªÔºö${this.secondPlayer.profile.name}`),this.moveNextPhase("draw"),this.view.requireUpdate();try{for(;!this.isEnded&&(this.clock.period.phase==="draw"?await this.procDrawPhase():this.phase==="standby"?await this.procStanbyPhase():this.phase==="main1"?await this.procMainPhase():this.phase==="battle1"?await this.procBattlePhase():this.phase==="battle2"?await this.procBattlePhase():this.phase==="main2"?await this.procMainPhase():this.phase==="end"&&await this.procEndPhase(),!(this.clock.turn>1e3)););}catch(e){e instanceof Jt?(console.info(e),this.isEnded=!0,this.log.info(e.winner?`„Éá„É•„Ç®„É´ÁµÇ‰∫Ü„ÄÇÂãùËÄÖ${e.winner.profile.name}`:"Âºï„ÅçÂàÜ„Åë")):e instanceof Error&&this.log.error(e)}finally{this.view.requireUpdate(),this.view.dispose(),this.log.dispose()}});d(this,"moveNextPhase",e=>{this.clock.setPhase(this,e),this.phase==="main2"||this.clock.turn===1?this.nextPhaseList=["end"]:this.phase==="battle1"||this.phase==="battle2"?this.nextPhaseList=["main2"]:this.phase==="main1"?this.nextPhaseList=["battle1","end"]:this.nextPhaseList=[]});d(this,"declareAnAttack",(e,t)=>{var a;this.attackingMonster=e,this.targetForAttack=t;let r=" ("+((a=t.battlePosition==="Attack"?t.atk:t.def)==null?void 0:a.toString())+")";t.face==="FaceDown"&&(r=" (????)"),t.entityType==="Duelist"&&(r=""),e.info.attackCount++,this.log.info(`ÊîªÊíÉÂÆ£Ë®ÄÔºö${e.toString()} (${e.atk})‚áí ${t.toString()}${r}`,e.controller)});d(this,"procDrawPhase",async()=>{Object.values(this.duelists).forEach(e=>e.initForDrawPhase()),this.log.info("„Éâ„É≠„Éº„Éï„Çß„Ç§„Ç∫ÈñãÂßã„ÄÇ",this.getTurnPlayer()),this.clock.turn===1?this.log.info("ÂÖàÊîª„Éó„É¨„Ç§„É§„Éº„ÅØ„Éâ„É≠„Éº„Åß„Åç„Å™„ÅÑ„ÄÇ",this.getTurnPlayer()):await this.getTurnPlayer().draw(1,void 0,void 0),this.field.getCardsOnField().forEach(e=>e.initForTurn()),await this.procSpellSpeed1(),this.moveNextPhase("standby")});d(this,"procStanbyPhase",async()=>{await this.procSpellSpeed1(),this.moveNextPhase("main1")});d(this,"procMainPhase",async()=>{for(;;){this.priorityHolder=this.getTurnPlayer();const e=await this.view.waitFieldAction(this.getEnableActions(this.priorityHolder,["NormalSummon","SpellTrapSet","SpecialSummon","ChangeBattlePosition","IgnitionEffect","QuickEffect","CardActivation"],["Normal","Quick","Counter"],[]));if(e&&e.action){if([...Xl].includes(e.action.playType)){const r=await e.action.prepare(this.priorityHolder,e.action.cell,void 0,[],!0,!1);if(r===void 0)continue;await e.action.execute(r,this.chainBlockInfos),this.clock.incrementChainSeq()}else await this.procChainBlock({activator:this.priorityHolder,action:e.action},void 0);for(;await this.procChainBlock(void 0,void 0););continue}const t=e.phaseChange;if(t){this.priorityHolder=this.getNonTurnPlayer();const r=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(this.priorityHolder,["QuickEffect","TriggerEffect"],["Quick","Counter"],[]),[],"",!0);if(r){for(await this.procChainBlock({activator:this.priorityHolder,action:r},void 0);await this.procChainBlock(void 0,void 0););continue}this.moveNextPhase(t);return}}});d(this,"procBattlePhase",async()=>{await this.procBattlePhaseStartStep(),await this.procBattlePhaseBattleStep(),await this.procBattlePhaseEndStep()});d(this,"procBattlePhaseStartStep",async()=>{this.clock.setStep(this,"start"),this.priorityHolder=this.getTurnPlayer(),this.attackingMonster=void 0,this.targetForAttack=void 0,await this.procSpellSpeed1()});d(this,"procBattlePhaseBattleStep",async()=>{for(;;){this.clock.setStep(this,"battle"),this.priorityHolder=this.getTurnPlayer();const e=await this.view.waitFieldAction(this.getEnableActions(this.priorityHolder,["Battle"],["Normal"],[]));if(e.phaseChange)break;if(e.action){const t=await e.action.prepare(this.priorityHolder,e.action.cell,void 0,[],!0,!1);if(!t)continue;await e.action.execute(t,[]),this.clock.incrementChainSeq();let r=!0;for(;;){const a=this.getNonTurnPlayer().getMonstersOnField().map(s=>[s.seq,s.moveLog.latestRecord.movedAt.totalProcSeq]);for(;await this.procChainBlock(void 0,void 0););if(!this.attackingMonster)throw new me("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã");this.attackingMonster.isOnField?this.attackingMonster.face==="FaceDown"?(this.log.info(`${this.attackingMonster.toString()}„ÅåË£èÂÅ¥ÂÆàÂÇôË°®Á§∫„Å´„Å™„Å£„Åü„Åü„ÇÅ„ÄÅÊà¶Èóò„Åå‰∏≠Êñ≠„Åï„Çå„Åü„ÄÇ`),r=!1):this.attackingMonster.orientation==="Horizontal"&&(this.log.info(`${this.attackingMonster.toString()}„ÅåÂÆàÂÇôË°®Á§∫„Å´„Å™„Å£„Åü„Åü„ÇÅ„ÄÅÊà¶Èóò„Åå‰∏≠Êñ≠„Åï„Çå„Åü„ÄÇ`),r=!1):(this.log.info(`${this.attackingMonster.toString()}„Åå„Éï„Ç£„Éº„É´„Éâ„Å´„ÅÑ„Å™„Åè„Å™„Å£„Åü„Åü„ÇÅ„ÄÅÊà¶Èóò„Åå‰∏≠Êñ≠„Åï„Çå„Åü„ÄÇ`),r=!1);const n=this.getNonTurnPlayer().getMonstersOnField().map(s=>[s.seq,s.moveLog.latestRecord.movedAt.totalProcSeq]);if(a.length!==n.length)throw this.log.info("„É¢„É≥„Çπ„Çø„Éº„ÅÆÊï∞„ÅåÂ¢óÊ∏õ„Åó„Åü„Åü„ÇÅ„Éê„Éà„É´„Çπ„ÉÜ„ÉÉ„Éó„ÅÆÂ∑ª„ÅçÊàª„Åó„ÅåÁô∫Áîü„ÄÇ"),new me("Â∑ª„ÅçÊàª„ÅóÊú™ÂÆüË£Ö");if(a.some(([s,c])=>n.every(([u,l])=>u!==s||l!==c)))throw this.log.info("„É¢„É≥„Çπ„Çø„Éº„ÅÆÊï∞„ÅåÂ¢óÊ∏õ„Åó„Åü„Åü„ÇÅ„Éê„Éà„É´„Çπ„ÉÜ„ÉÉ„Éó„ÅÆÂ∑ª„ÅçÊàª„Åó„ÅåÁô∫Áîü„ÄÇ"),new me("Â∑ª„ÅçÊàª„ÅóÊú™ÂÆüË£Ö");break}if(!r)continue;await this.procBattlePhaseDamageStep(t)}}});d(this,"procBattlePhaseDamageStep",async e=>{if(!this.attackingMonster||!this.targetForAttack)throw new me("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",this.attackingMonster,this.targetForAttack);if(this.targetForAttack.entityType!=="Duelist"&&!this.targetForAttack.isOnFieldAsMonster)throw console.log("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",this.attackingMonster,this.targetForAttack),new me("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",this.attackingMonster,this.targetForAttack);await this.procBattlePhaseDamageStep1(),await this.procBattlePhaseDamageStep2(this.attackingMonster,this.targetForAttack),await this.procBattlePhaseDamageStep3(e,this.attackingMonster,this.targetForAttack),await this.procBattlePhaseDamageStep4(),await this.procBattlePhaseDamageStep5()});d(this,"procBattlePhaseDamageStep1",async()=>{for(this.clock.setStage(this,"start");await this.procChainBlock(void 0,void 0););});d(this,"procBattlePhaseDamageStep2",async(e,t)=>{for(this.clock.setStage(this,"beforeDmgCalc"),(t==null?void 0:t.battlePosition)==="Set"&&t.setBattlePosition("Defense",["Flip","FlipByBattle"],e,e.controller);await this.procChainBlock(void 0,void 0););});d(this,"procBattlePhaseDamageStep3",async(e,t,r)=>{if(t.atk===void 0)throw new me("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",this.attackingMonster,this.targetForAttack);for(this.clock.setStage(this,"dmgCalc");await this.procChainBlock(void 0,void 0););const a=t.atk,n=(r.battlePosition==="Attack"?r.atk:r.def)??0;r.entityType==="Duelist"?(e.activator.writeInfoLog(`„ÉÄ„É°„Éº„Ç∏Ë®àÁÆóÔºö${t.toString()} (${a}) ‚áí ${r.toString()}`),t.controller.getOpponentPlayer().battleDamage(a-n,t)):(e.activator.writeInfoLog(`„ÉÄ„É°„Éº„Ç∏Ë®àÁÆóÔºö${t.toString()} (${a}) ‚áí ${r.toString()} (${n})`),a>0&&a>n&&r.battlePosition==="Attack"?t.controller.getOpponentPlayer().battleDamage(a-n,t):a<n&&t.controller.battleDamage(n-a,r),a>0&&(a>n||a===n&&r.battlePosition==="Attack")&&await Xe.tryMarkForDestory([r],e),r.battlePosition==="Attack"&&a<=n&&await Xe.tryMarkForDestory([t],e));const s=Object.values(this.duelists).filter(c=>c.lp<=0);if(s.length>0)throw new Jt(Object.values(this.duelists).filter(c=>!s.includes(c)).pop())});d(this,"procBattlePhaseDamageStep4",async()=>{for(this.clock.setStage(this,"afterDmgCalc");await this.procChainBlock(void 0,void 0););});d(this,"procBattlePhaseDamageStep5",async()=>{for(this.clock.setStage(this,"end"),console.log(this.clock.period.key,this.clock.toString()),await pe.waitCorpseDisposal(this),console.log(this.clock.period.key,this.clock.toString()),this.clock.incrementChainSeq(),console.log(this.clock.period.key,this.clock.toString());await this.procChainBlock(void 0,void 0););});d(this,"procBattlePhaseEndStep",async()=>{this.clock.setStep(this,"end"),this.priorityHolder=this.getTurnPlayer(),await this.procSpellSpeed1(),this.moveNextPhase("main2")});d(this,"procEndPhase",async()=>{for(await this.procSpellSpeed1();;){const t=this.getTurnPlayer().getHandCell().cardEntities.length;if(t<7)break;await this.getTurnPlayer().discard(t-6,["Rule"])}this.moveNextPhase("draw")});d(this,"procSpellSpeed1",async()=>{this.priorityHolder=this.getTurnPlayer();let e=0;const t={Above:Number.MAX_VALUE,Below:Number.MAX_VALUE};for(;Object.values(t).some(r=>r!==0);){const r=this.getEnableActions(this.priorityHolder,["IgnitionEffect","QuickEffect","CardActivation","LingeringEffect"],["Normal","Quick","Counter"],[]);t[this.priorityHolder.seat]=r.filter(s=>s.isMandatory).length;let a=r.find(s=>s.isMandatory),n=!a;if(this.priorityHolder.isTurnPlayer?e===0&&(n=!0):t[this.priorityHolder.getOpponentPlayer().seat]>=0&&(n=!0),r.length&&(r.length>1||!a)&&(a=await this.view.waitQuickEffect(this.priorityHolder,r,[],n?"":"„Åæ„Å†Áô∫Âãï„Åó„Å™„Åë„Çå„Å∞„Å™„Çâ„Å™„ÅÑÂäπÊûú„ÅåÊÆã„Å£„Å¶„ÅÑ„Çã„ÄÇ",n)),a){if(Ca.some(s=>s===a.playType))await this.procChainBlock({activator:this.priorityHolder,action:a},void 0);else{const s=await a.prepare(this.priorityHolder,void 0,void 0,[],!0,!1);if(!s)continue;await a.execute(s,[]),await a.settle(s,[]),this.clock.incrementChainSeq()}await this.procFreeChain(),this.priorityHolder=this.getTurnPlayer(),e=0;continue}this.priorityHolder=this.priorityHolder.getOpponentPlayer(),e++}});d(this,"procFreeChain",async()=>{for(;await this.procChainBlock(void 0,void 0););});d(this,"procChainBlock",async(e,t)=>{const r=this.chainBlockInfos.length===0;let a=e?[]:t??Object.values(this.duelists).flatMap(c=>this.getEnableActions(c,["TriggerEffect"],[this.chainBlockInfos.length?"Quick":"Normal"],this.chainBlockInfos).map(u=>({activator:c,action:u,targetChainBlock:this.chainBlockInfos.slice(-1)[0]}))),n=!1,s;if(e)s={...e,targetChainBlock:void 0},this.priorityHolder=s.activator,n=!0;else if(a.length>0){const c=await this.selectTriggerEffect(a);c?(a=a.filter(u=>u!==c),s=c,this.priorityHolder=s.activator,n=!0):a=[]}if(!n){let c=0;for(;c<2;){this.priorityHolder=this.priorityHolder.getOpponentPlayer();const u=["Counter"];this.chainBlockInfos.every(f=>f.action.spellSpeed!=="Counter")&&u.push("Quick");const l=this.chainBlockInfos.length?"‚Äª„É°„ÉÉ„Çª„Éº„Ç∏ËÄÉ„Åà‰∏≠‚Äª":"„ÇØ„Ç§„ÉÉ„ÇØ„Ç®„Éï„Çß„ÇØ„ÉàÁô∫Âãï„Çø„Ç§„Éü„É≥„Ç∞„ÄÇÂäπÊûú„ÇíÁô∫Âãï„Åó„Åæ„Åô„ÅãÔºü",o=await this.view.waitQuickEffect(this.priorityHolder,this.getEnableActions(this.priorityHolder,["QuickEffect","CardActivation"],u,this.chainBlockInfos),this.chainBlockInfos,l,!0);if(o){s={activator:this.priorityHolder,action:o,targetChainBlock:this.chainBlockInfos.slice(-1)[0]},n=!0;break}c++}}if(console.info("selected action: ",s),s){const c=s.activator,u=await s.action.prepare(c,s.action.cell,s.targetChainBlock,this.chainBlockInfos,!1,!1);if(!u)throw new li(s);this.chainBlockLog.push(u);const l=[...u.action.entity.info.isEffectiveIn];if(this._chainBlockInfos.push(u),this.clock.incrementProcSeq(),this.clock.incrementChainBlockSeq(),await this.procChainBlock(void 0,a.length?a.filter(o=>o.action.seq!==(s==null?void 0:s.action.seq)):void 0),u.chainNumber&&this.log.info(`„ÉÅ„Çß„Éº„É≥${u.chainNumber}: ${u.action.toString()}„ÅÆÂäπÊûúÂá¶ÁêÜ„ÄÇ`,c),u.isNegatedActivationBy)u.chainNumber&&this.log.info(`„ÉÅ„Çß„Éº„É≥${u.chainNumber}: ${u.action.toString()}„Çí${u.action.toString()}„Å´„Çà„Å£„Å¶Áô∫Âãï„ÇíÁÑ°Âäπ„Å´„Åó„Åü„ÄÇ`,u.activator);else{let o=u.action.entity.isEffective,f="";if(o){if(u.isNegatedEffectBy)f=`„ÉÅ„Çß„Éº„É≥${u.chainNumber}: ${u.action.toString()}„Çí${u.action.toString()}„Å´„Çà„Å£„Å¶ÂäπÊûú„ÇíÁÑ°Âäπ„Å´„Åó„Åü„ÄÇ`,o=!1;else if(!l.includes(u.isActivatedIn.cellType)){const p=u.action.entity.moveLog.records.findLast(h=>h.face==="FaceDown"&&h.orientation==="Horizontal");o=(p&&this.clock.isSameChain(p.movedAt))??!1}}o?(await u.action.execute(u,this.chainBlockInfos),u.state="done"):(u.state="failed",u.chainNumber&&(f=f||`„ÉÅ„Çß„Éº„É≥${u.chainNumber}: „Ç´„Éº„Éâ„ÅÆÂäπÊûú„ÅåÁÑ°Âäπ„Å®„Å™„Å£„Å¶„ÅÑ„Çã„Åü„ÇÅ${u.action.toString()}„ÅÆÂäπÊûúÂá¶ÁêÜ„ÇíË°å„Åà„Å™„ÅÑ„ÄÇ`),this.log.info(f,u.activator)),await s.action.settle(u,this.chainBlockInfos)}console.log(this.clock.totalProcSeq),this.clock.incrementChainBlockSeq(),console.log(this.clock.totalProcSeq),r?(await pe.sendManyToGraveyardForTheSameReason(this._chainBlockInfos.filter(o=>o.action.playType==="CardActivation").filter(o=>!o.action.isLikeContinuousSpell).map(o=>o.action.entity).filter(o=>o.isOnField).filter(o=>o.face==="FaceUp"),["Rule"],void 0,void 0),this._chainBlockInfos.reset(),u.nextAction&&await this.procChainBlock({activator:u.activator,action:u.nextAction},void 0),this.clock.incrementChainSeq()):u.nextAction&&await u.nextAction.directExecute(u.activator,!1)}return n});d(this,"selectTriggerEffect",async e=>{if(e.length>0)for(const t of[!0,!1])for(const r of[this.getTurnPlayer(),this.getNonTurnPlayer()]){const a=e.filter(s=>s.action.isMandatory===t&&s.activator===r);if(a.length===0)continue;if(a.length===1&&t)return a[0];const n=await this.view.waitQuickEffect(r,a.map(s=>s.action),this.chainBlockInfos,"„Éà„É™„Ç¨„Éº„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ∏Êäû„ÄÇ",!t);if(n)return a.find(s=>s.action===n)}});d(this,"executeSystemPeriodActions",()=>{Object.values(this.duelists).flatMap(e=>this.getEnableActions(e,["SystemPeriodAction"],["Normal"],[]).map(t=>({duelist:e,action:t})))});d(this,"getEnableActions",(e,t,r,a)=>{const n=Yl.some(s=>{var c;return s===((c=a.slice(-1)[0])==null?void 0:c.action.playType)});return this.field.getAllCardEntities().flatMap(s=>s.actions).filter(s=>s.negateSummon||!n).filter(s=>s.executableCells.includes(s.entity.fieldCell.cellType)).filter(s=>s.executablePeriods.includes(this.clock.period.key)).filter(s=>t.includes(s.playType)).filter(s=>r.includes(s.spellSpeed)).filter(s=>s.validateDuelist(e)).filter(s=>s.validate(e,a,!1))});this.clock=new zo,this.nextPhaseList=[],this.isEnded=!1,this.startMode=l,this.duelists={Below:new Ri(this,"Below",e,t,r,a),Above:new Ri(this,"Above",n,s,c,u)},this.priorityHolder=this.firstPlayer,this._chainBlockInfos=[],this.field=new _o(this),this.clock.onProcSeqChange.append(this.distributeOperators),this.clock.onStageChange.append(this.executeSystemPeriodActions),this.view=new Go(this),this.log=new $o(this),this.chainBlockLog=new Vo(this)}get phase(){return this.clock.period.phase}get step(){return this.clock.period.step}get stage(){return this.clock.period.stage}get chainBlockInfos(){return this._chainBlockInfos}get firstPlayer(){return this.coin?this.duelists.Below:this.duelists.Above}get secondPlayer(){return this.coin?this.duelists.Above:this.duelists.Below}}const zt=async()=>({selectedEntities:[],chainBlockTags:[],prepared:void 0}),Ko=async(i,e,t)=>(i.activator.payLp(t,i.action.entity),{lifePoint:t}),Yi=async(i,e,t=st,r=a=>a.length===1)=>{const a=i.activator.getMonsterZones(),n=i.activator.getEnableSummonList(i.activator,"SpecialSummon",["Effect"],i.action,e.filter(u=>u.canBeTargetOfEffect(i)).map(u=>({monster:u,posList:t,cells:a})),[],!1),s=await i.action.entity.field.duel.view.waitSelectEntities(i.activator,n.map(u=>u.monster),1,r,"ÁâπÊÆäÂè¨Âñö„Åô„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",!1)??[];if(!s.length)throw new li(i);const c=s.map(u=>u.fieldCell.cellType).getDistinct().filter(u=>u==="Graveyard"||u==="Banished").map(u=>u==="Graveyard"?"SpecialSummonFromGraveyard":"SpecialSummonFromBanished");return{selectedEntities:s,chainBlockTags:c,prepared:void 0}},Xi=async(i,e=["Attack","Defense"],t=!0)=>{const r=i.activator.getMonsterZones(),a=i.selectedEntities.filter(n=>!n.wasMovedAfter(i.isActivatedAt)).map(n=>({monster:n,posList:e,cells:r}));return t&&(a.length!==i.selectedEntities.length||r.length<a.length)?!1:(await i.activator.summonAll(i.activator,"SpecialSummon",["Effect"],i.action,a,[],!1,!1),!0)},Qo=async(i,e,t=["Attack","Defense"])=>{const r=i.activator.getMonsterZones(),a=e.map(n=>({monster:n,posList:t,cells:r}));return await i.activator.summonAll(i.activator,"SpecialSummon",["Effect"],i.action,a,[],!1,!1),!0},Jo=(i,e,t)=>({title:i,playType:"SystemPeriodAction",spellSpeed:"Normal",executableCells:mi,executablePeriods:e,executableDuelistTypes:["Controller","Opponent"],isMandatory:!0,validate:t,prepare:zt,execute:async()=>!0,settle:async()=>!0}),Io=()=>{const i=[];["„Çµ„Ç§„Éê„Éº„Éª„Éâ„É©„Ç¥„É≥","ÂÖ≠Ê≠¶Ë°Ü„ÅÆ„ÅîÈö†Â±Ö","„Ç¢„É≥„Éé„Ç¶„É≥„Éª„Ç∑„É≥„ÇØ„É≠„É≥"].forEach(o=>i.push({name:o,actions:[Ve,Fe,Re,Ue,{title:"ÁâπÊÆäÂè¨Âñö",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:o==="„Ç¢„É≥„Éé„Ç¶„É≥„Éª„Ç∑„É≥„ÇØ„É≠„É≥"?1:void 0,validate:f=>{const p=f.action.entity.field.getMonstersOnField();if(!(p.length==0||p.some(h=>h.controller===f.activator)))return aa(f,["Attack","Defense"],[])},prepare:f=>ni(f,"SpecialSummon",["SpecialSummon","Rule"],st),execute:si,settle:async()=>!0}]}));const e={name:"„Ç∏„É£„É≥„ÇØ„Éª„Éï„Ç©„Ç¢„Éº„Éâ",actions:[Ve,Fe,Re,Ue,{title:"ÁâπÊÆäÂè¨Âñö",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:o=>{if(!o.activator.getMonstersOnField().length)return aa(o,st,[])},prepare:o=>ni(o,"SpecialSummon",["SpecialSummon","Rule"],st),execute:si,settle:async()=>!0}]};i.push(e);const t={name:"Ôº§ÔºçÔº®Ôº•Ôº≤ÔºØ „Éá„Ç£„Ç¢„Éú„É™„ÉÉ„ÇØ„Ç¨„Ç§",actions:[Ve,Fe,Re,Ue,{title:"‚ë†„É™„ÇØ„É´„Éº„Éà",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:10,canPayCosts:()=>!0,validate:o=>o.activator.getDeckCell().cardEntities.filter(p=>p.nm==="Ôº§ÔºçÔº®Ôº•Ôº≤ÔºØ „Éá„Ç£„Ç¢„Éú„É™„ÉÉ„ÇØ„Ç¨„Ç§").length===0?void 0:(console.log(o.action.entity.toString()),o.activator.getAvailableMonsterZones().length>0?[]:void 0),payCosts:async o=>(await o.action.entity.banish(["Cost"],o.action.entity,o.activator),{banish:[o.action.entity]}),prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async o=>{const f=o.activator.getDeckCell().cardEntities.find(p=>p.nm==="Ôº§ÔºçÔº®Ôº•Ôº≤ÔºØ „Éá„Ç£„Ç¢„Éú„É™„ÉÉ„ÇØ„Ç¨„Ç§");return f?Qo(o,[f]):!1},settle:async()=>!0}]};i.push(t);const r={name:"„Çæ„É≥„Éì„Ç≠„É£„É™„Ç¢",actions:[Ve,Fe,Re,Ue,{title:"‚ë†Ëá™Â∑±ÂÜçÁîü",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],canPayCosts:o=>o.activator.getHandCell().cardEntities.length>0,validate:o=>o.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:async o=>{const f=o.activator.getHandCell().cardEntities,p=await o.activator.duel.view.waitSelectEntities(o.activator,f,1,h=>h.length===1,"„Éá„ÉÉ„Ç≠„Éà„ÉÉ„Éó„Å´Êàª„Åô„Ç´„Éº„Éâ„Çí‰∏ÄÊûöÈÅ∏Êäû„ÄÇ");if(!p)throw new li(o);return await p[0].returnToDeck("Top",["Cost"],o.action.entity,o.activator),{returnToDeck:p}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:async o=>(o.action.entity.info.willBeBanished=await _i(o),o.action.entity.info.willBeBanished),settle:async()=>!0}]};i.push(r);const a={name:"„Ç∞„É≠„Éº„Ç¢„ÉÉ„Éó„Éª„Éê„É´„Éñ",actions:[Ve,Fe,Re,Ue,{title:"‚ë†Ëá™Â∑±ÂÜçÁîü",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:1,canPayCosts:o=>o.activator.getDeckCell().cardEntities.length>0,validate:o=>o.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:async o=>{const f=o.activator.getDeckCell().cardEntities[0];return await o.activator.getDeckCell().cardEntities[0].sendToGraveyard(["Cost"],o.action.entity,o.activator),{sendToGraveyard:[f]}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:o=>_i(o),settle:async()=>!0}]};i.push(a);const n={name:"ÁµÇÊú´„ÅÆÈ®éÂ£´",actions:[Ve,Fe,Re,Ue,{title:"‚ë†Â¢ìÂú∞ÈÄÅ„Çä",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...Ye,...kt],executableDuelistTypes:["Controller"],validate:o=>{if(o.action.entity.hasBeenSummonedNow(["NormalSummon","SpecialSummon","FlipSummon"])&&o.activator.getDeckCell().cardEntities.filter(f=>f.attr.includes("Dark")).length!==0)return[]},prepare:async o=>{const f=["SendToGraveyardFromDeck"];return o.action.entity.moveLog.latestRecord.movedAs.includes("NormalSummon")?f.push("IfNormarlSummonSucceed"):f.push("IfSpecialSummonSucceed"),{selectedEntities:[],chainBlockTags:f,prepared:void 0}},execute:async o=>{const f=o.activator.getDeckCell().cardEntities.filter(p=>p.attr.includes("Dark"));return f.length===0?!1:(await o.action.entity.field.sendToGraveyard("Â¢ìÂú∞„Å´ÈÄÅ„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",o.activator,f,1,p=>p.length===1,["Effect"],o.action.entity,!1),o.activator.getDeckCell().shuffle(),!0)},settle:async()=>!0}]};i.push(n);const s={name:"„Éû„Çπ„Éû„ÉÜ„Ç£„Ç∑„É£„É≥",actions:[Ve,Fe,Re,Ue,{title:"‚ë†Â¢ìÂú∞ÈÄÅ„Çä",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:[...Ye,...kt],executableDuelistTypes:["Controller"],validate:o=>{if(o.action.entity.hasBeenSummonedNow(["NormalSummon"])&&o.activator.getDeckCell().cardEntities.find(f=>(f.lvl??5)<5))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["IfNormarlSummonSucceed","SendToGraveyardFromDeck"],prepared:void 0}),execute:async o=>{const f=o.activator.getDeckCell().cardEntities.filter(p=>(p.lvl??5)<5);return f.length===0?!1:(await o.action.entity.field.sendToGraveyard("Â¢ìÂú∞„Å´ÈÄÅ„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",o.activator,f,1,p=>p.length===1,["Effect"],o.action.entity,!1),o.activator.getDeckCell().shuffle(),!0)},settle:async()=>!0},{title:"‚ë°„Éâ„É≠„Éº",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...Ye,...kt],executableDuelistTypes:["Controller"],validate:o=>{if(o.action.entity.face!=="FaceDown"&&o.action.entity.moveLog.latestRecord.movedAs.includes("BattleDestroy")&&o.action.entity.wasMovedAtPreviousChain&&o.activator.getDeckCell().cardEntities.length!==0)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async o=>(await o.activator.draw(1,o.action.entity,o.activator),!0),settle:async()=>!0}]};i.push(s);const c={name:"„É©„Ç§„Éà„É≠„Éº„Éâ„Éª„Éì„Éº„Çπ„Éà „Ç¶„Ç©„É´„Éï",actions:[Fe,Re,Ue,{title:"‚ë†Ëá™Â∑±ÂÜçÁîü",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...Ye,...kt],executableDuelistTypes:["Controller"],validate:o=>{if(o.action.entity.wasMovedAtPreviousChain&&o.action.entity.wasMovedFrom.cellType==="Deck")return o.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:o=>_i(o),settle:async()=>!0}],canBeSummoned:()=>!0};i.push(c);const u={name:"‰ºùË™¨„ÅÆÁôΩÁü≥",actions:[Fe,Re,Ue,Ve,{title:"‚ë†„Çµ„Éº„ÉÅ",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:jt,executableDuelistTypes:["Controller"],validate:o=>{if(o.action.entity.wasMovedAtPreviousChain&&o.action.entity.wasMovedFrom.cellType!=="Banished")return o.activator.getDeckCell().cardEntities.find(f=>f.nm==="ÈùíÁúº„ÅÆÁôΩÈæç")?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async o=>{const f=o.activator.getDeckCell().cardEntities.find(p=>p.nm==="ÈùíÁúº„ÅÆÁôΩÈæç");return f?(await f.addToHand(["Effect"],o.action.entity,o.activator),o.activator.getDeckCell().shuffle(),!0):!1},settle:async()=>!0}]};return i.push(u),[{name:"ÁÅ∞ÊµÅ„ÅÜ„Çâ„Çâ",chainBlockTags:["Draw","SearchFromDeck","SendToGraveyardFromDeck","SpecialSummonFromDeck"]},{name:"Â±ãÊï∑„Çè„Çâ„Åó",chainBlockTags:["BanishFromGraveyard","SpecialSummonFromGraveyard","AddToHandFromGraveyard"]}].forEach(o=>{i.push({name:o.name,actions:[Fe,Re,Ue,Ve,{title:"‚ë†ÁÑ°ÂäπÂåñ",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:["Hand"],executablePeriods:Ye,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,negatePreviousBlock:!0,canPayCosts:f=>f.activator.canDiscard([f.action.entity]),validate:(f,p)=>p.length===0?void 0:p[f.index-1].chainBlockTags.union(o.chainBlockTags).length>0?[]:void 0,payCosts:async f=>(await f.action.entity.discard(["Cost"],f.action.entity,f.activator),{sendToGraveyard:[f.action.entity]}),prepare:async()=>({selectedEntities:[],chainBlockTags:["NegateCardEffect"],prepared:void 0}),execute:async(f,p)=>{const h=p[f.index-1];return h.isNegatedEffectBy=f.action,!0},settle:async()=>!0}]})}),["ÁøªÂºÑ„Åô„Çã„Ç®„É´„Éï„ÅÆÂâ£Â£´","„É≠„Éº„Éâ„É©„É≥„Éä„Éº","Ê∞∑ÁµêÁïå„ÅÆ‰øÆÈ®ìËÄÖ"].forEach(o=>{i.push({name:o,actions:[Fe,Re,Ue,Ve],continuousEffects:[uo("‚ë†Êà¶ÈóòÁ†¥Â£äËÄêÊÄß","Monster",f=>[f],()=>!0,f=>[new to("‚ë†Êà¶ÈóòÁ†¥Â£äËÄêÊÄß",()=>!0,!0,f,{},()=>!0,["BattleDestroy"],(p,h)=>(console.log(p,h),!f.isEffective||(h.atk??0)<1900?!0:(f.duel.log.info(`${f.toString()}„ÅØÊîªÊíÉÂäõ1900‰ª•‰∏ä„ÅÆ„É¢„É≥„Çπ„Çø„Éº„Å®„ÅÆÂÖàÈ†≠„Åß„ÅØÁ†¥Â£ä„Åï„Çå„Å™„ÅÑ„ÄÇ`,f.controller),!1)))])]})}),i},ec=i=>{if(i.action.entity.status.spellCategory==="Field")return[i.activator.getFieldZone()];const e=i.activator.getAvailableSpellTrapZones();return e.length>0?e:void 0},Ce={title:"„Çª„ÉÉ„Éà",playType:"SpellTrapSet",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isMandatory:!1,validate:ec,prepare:zt,execute:async()=>!0,settle:async()=>!0},ke=i=>{if(i.action.entity.info.isPending||i.action.entity.info.isDying||i.action.entity.info.isSettingSickness)return;if(Gt.some(t=>t===i.action.entity.fieldCell.cellType))return i.action.entity.face==="FaceDown"?[]:void 0;if(!i.activator.isTurnPlayer)return;if(i.action.entity.status.spellCategory==="Field")return[i.activator.getFieldZone()];const e=i.activator.getAvailableSpellTrapZones();return e.length>0?e:void 0},tc=(i,e,t=()=>!0)=>i.action.entity.field.getMonstersOnField().filter(a=>a.face==="FaceUp").filter(a=>a.canBeTargetOfEffect(i)).filter(a=>t(a,i.action.entity)).length?ke(i):void 0,ic=async(i,e,t,r,a,n=()=>!0)=>{const s=i.action.entity.field.getMonstersOnField().filter(u=>u.face==="FaceUp").filter(u=>u.canBeTargetOfEffect(i)).filter(u=>n(u,i.action.entity)),c=await i.action.entity.duel.view.waitSelectEntities(i.activator,s,1,u=>u.length===1,"Ë£ÖÂÇôÂØæË±°„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",t);if(c)return i.action.entity.info.equipedBy=c[0],i.action.entity.info.effectTargets[i.action.seq]=c,{chainBlockTags:r??[],selectedEntities:c,prepared:a}},Qn=async(i,e,t=()=>!0)=>{const r=i.selectedEntities[0];return i.action.entity.info.equipedBy=r,i.action.entity.info.effectTargets[i.action.seq]=[r],t(r,i.action.entity)?(i.action.entity.info.equipedBy=r,i.action.entity.info.validateEquipOwner=t,r.info.equipEntities.push(i.action.entity),!0):(await i.action.entity.ruleDestory(),i.activator.writeInfoLog(`${r.toString()}„ÅåË£ÖÂÇôÊù°‰ª∂„ÇíÊ∫Ä„Åü„Åï„Å™„Åè„Å™„Å£„Åü„Åü„ÇÅ„ÄÅ${i.action.entity.toString()}„ÅØÁ†¥Â£ä„Åï„Çå„Åü„ÄÇ`),!1)},la=(i=()=>!0)=>({title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:(e,t)=>tc(e,t,i),prepare:(e,t,r)=>ic(e,t,r,[],void 0,i),execute:Qn,settle:async()=>!0}),rc=()=>{const i=[],e={name:"„Åä„Çç„Åã„Å™ÂüãËë¨",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:l=>{if(l.activator.getDeckCell().cardEntities.filter(o=>o.status.kind==="Monster").length!==0)return ke(l)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SendToGraveyardFromDeck"],prepared:void 0}),execute:async l=>{const o=l.activator.getDeckCell().cardEntities.filter(p=>p.status.kind==="Monster");if(o.length===0)return!1;const f=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,o,1,p=>p.length===1,"Â¢ìÂú∞„Å´ÈÄÅ„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",!1);if(!f)throw new li(l);return await pe.sendManyToGraveyardForTheSameReason(f,["Effect"],l.action.entity,l.activator),await l.activator.getDeckCell().shuffle(),!0},settle:async()=>!0},Ce]};i.push(e);const t={name:"„Åä„Çç„Åã„Å™ÂâØËë¨",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,priorityForNPC:40,validate:l=>{if(l.activator.getDeckCell().cardEntities.filter(o=>o.status.kind!=="Monster").length!==0)return ke(l)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SendToGraveyardFromDeck"],prepared:void 0}),execute:async l=>{const o=l.activator.getDeckCell().cardEntities.filter(p=>p.status.kind!=="Monster");if(o.length===0)return!1;const f=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,o,1,p=>p.length===1,"Â¢ìÂú∞„Å´ÈÄÅ„ÇãÈ≠îÊ≥ïÁΩ†„ÇíÈÅ∏Êäû",!1);if(!f)throw new li(l);return await pe.sendManyToGraveyardForTheSameReason(f,["Effect"],l.action.entity,l.activator),await l.activator.getDeckCell().shuffle(),!0},settle:async()=>!0},Ce]};i.push(t);const r={name:"Ê≠ªËÄÖËòáÁîü",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:l=>{const o=l.activator.getMonsterZones();if(l.activator.getEnableSummonList(l.activator,"SpecialSummon",["Effect"],l.action,l.activator.duel.field.getCells("Graveyard").flatMap(p=>p.cardEntities).filter(p=>p.status.kind==="Monster").filter(p=>p.canBeTargetOfEffect(l)).map(p=>({monster:p,posList:st,cells:o})),[],!1).length)return ke(l)},prepare:l=>Yi(l,l.activator.duel.field.getCells("Graveyard").flatMap(o=>o.cardEntities).filter(o=>o.status.kind==="Monster").filter(o=>o.canBeTargetOfEffect(l))),execute:async l=>Xi(l),settle:async()=>!0},Ce]};i.push(r),[{name:"Â§ßÂµê",cellTypes:Gt,isOnlyEnemies:!1},{name:"„Éè„Éº„Éî„Ç£„ÅÆÁæΩÊ†πÂ∏ö",cellTypes:Gt,isOnlyEnemies:!0},{name:"„Éñ„É©„ÉÉ„ÇØ„Éª„Éõ„Éº„É´",cellTypes:ri,isOnlyEnemies:!1},{name:"„Çµ„É≥„ÉÄ„Éº„Éª„Éú„É´„Éà",cellTypes:ri,isOnlyEnemies:!0}].forEach(l=>{i.push({name:l.name,actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:o=>{let f=o.action.entity.field.getCells(...l.cellTypes).flatMap(p=>p.cardEntities).filter(p=>p!==o.action.entity);if(l.isOnlyEnemies&&(f=f.filter(p=>p.controller!==o.activator)),!!f.length)return ke(o)},prepare:async o=>{let f=o.action.entity.field.getCells(...l.cellTypes).flatMap(p=>p.cardEntities).filter(p=>p!==o.action.entity);return l.isOnlyEnemies&&(f=f.filter(p=>p.controller!==o.activator)),{selectedEntities:[],chainBlockTags:o.action.calcChainBlockTagsForDestroy(f),prepared:void 0}},execute:async o=>{let f=o.action.entity.field.getCells(...l.cellTypes).flatMap(p=>p.cardEntities).filter(p=>p!==o.action.entity);return l.isOnlyEnemies&&(f=f.filter(p=>p.controller!==o.activator)),await Xe.tryDestroy(f,o),!0},settle:async()=>!0},Ce]})});const a={name:"„Éè„É™„Ç±„Éº„É≥",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:l=>{if(l.action.entity.field.getCells("SpellAndTrapZone","FieldSpellZone").flatMap(f=>f.cardEntities).filter(f=>f!==l.action.entity).length)return ke(l)},prepare:async()=>({selectedEntities:[],chainBlockTags:["BounceToHand"],prepared:void 0}),execute:async(l,o)=>{const f=o.map(h=>h.action).filter(h=>h.playType==="CardActivation").map(h=>h.entity).filter(h=>h.isOnField).filter(h=>h.face==="FaceUp").filter(h=>!h.isLikeContinuousSpell),p=l.action.entity.field.getCells("SpellAndTrapZone","FieldSpellZone").flatMap(h=>h.cardEntities).filter(h=>!f.includes(h));return await pe.returnManyToHandForTheSameReason(p,["Effect"],l.action.entity,l.activator),!0},settle:async()=>!0},Ce]};i.push(a);const n={name:"ÂÖâ„ÅÆÊè¥Ëªç",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,canPayCosts:l=>l.activator.getDeckCell().cardEntities.length>3,validate:l=>{if(l.activator.getDeckCell().cardEntities.filter(o=>o.status.kind==="Monster").filter(o=>(o.lvl??13)<5).filter(o=>o.status.nameTags&&o.status.nameTags.includes("„É©„Ç§„Éà„É≠„Éº„Éâ")).length!==0)return ke(l)},payCosts:async l=>{const o=l.activator.getDeckCell().cardEntities.slice(0,3);return await pe.sendManyToGraveyardForTheSameReason(o,["Cost"],l.action.entity,l.activator),{sendToGraveyard:o}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async l=>{const o=l.activator.getDeckCell().cardEntities.filter(p=>p.status.kind==="Monster").filter(p=>(p.lvl??13)<5).filter(p=>p.status.nameTags&&p.status.nameTags.includes("„É©„Ç§„Éà„É≠„Éº„Éâ"));if(o.length===0)return!1;const f=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,o,1,p=>p.length===1,"ÊâãÊú≠„Å´Âä†„Åà„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",!1);for(const p of f??[])await p.addToHand(["Effect"],l.action.entity,l.activator);return l.activator.getDeckCell().shuffle(),!0},settle:async()=>!0},Ce]};i.push(n);const s={name:"Ë™øÂæã",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:l=>{const o=l.activator.getDeckCell().cardEntities;if(!(o.length<2)&&o.filter(f=>{var p;return(p=f.status.nameTags)==null?void 0:p.includes("„Ç∑„É≥„ÇØ„É≠„É≥")}).filter(f=>{var p;return(p=f.status.monsterCategories)==null?void 0:p.includes("Tuner")}).length!==0)return ke(l)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck","SendToGraveyardFromDeck"],prepared:void 0}),execute:async l=>{const o=l.activator.getDeckCell().cardEntities;if(o.length<2)return;const f=o.filter(h=>{var m;return(m=h.status.nameTags)==null?void 0:m.includes("„Ç∑„É≥„ÇØ„É≠„É≥")}).filter(h=>{var m;return(m=h.status.monsterCategories)==null?void 0:m.includes("Tuner")});if(f.length===0)return!1;const p=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,f,1,h=>h.length===1,"ÊâãÊú≠„Å´Âä†„Åà„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",!1);for(const h of p??[])await h.addToHand(["Effect"],l.action.entity,l.activator);return l.activator.duel.clock.incrementProcSeq(),l.activator.getDeckCell().shuffle(),await l.activator.getDeckCell().cardEntities[0].sendToGraveyard(["Effect"],l.action.entity,l.activator),!0},settle:async()=>!0},Ce]};i.push(s);const c={name:"„ÉØ„É≥„Éª„Éï„Ç©„Éº„Éª„ÉØ„É≥",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,canPayCosts:l=>{if(l.activator.getDeckCell().cardEntities.every(o=>(o.lvl??12)>1)){if(l.activator.getHandCell().cardEntities.every(o=>(o.lvl??12)>1)||l.activator.getHandCell().cardEntities.filter(o=>o.status.kind==="Monster").length<2)return!1}else if(l.activator.getHandCell().cardEntities.filter(o=>o.status.kind==="Monster").length===0)return!1;return!0},validate:l=>{let o=[...l.activator.getDeckCell().cardEntities.filter(m=>(m.lvl??12)===1),...l.activator.getHandCell().cardEntities.filter(m=>(m.lvl??12)===1)];const f=l.activator.getHandCell().cardEntities;(f.length<2||!l.ignoreCost)&&(o=o.filter(m=>!f.includes(m)));const p=l.activator.getMonsterZones();if(l.activator.getEnableSummonList(l.activator,"SpecialSummon",["Effect"],l.action,o.map(m=>({monster:m,posList:st,cells:p})),[],!1).length)return ke(l)},payCosts:async(l,o,f)=>{const p=[...l.activator.getDeckCell().cardEntities.filter(S=>(S.lvl??12)===1),...l.activator.getHandCell().cardEntities.filter(S=>(S.lvl??12)===1)],h=l.activator.getMonsterZones(),m=l.activator.getEnableSummonList(l.activator,"SpecialSummon",["Effect"],l.action,p.map(S=>({monster:S,posList:st,cells:h})),[],!1);let w=l.activator.getHandCell().cardEntities.filter(S=>S.status.kind==="Monster");m.length===1&&(w=w.filter(S=>!m.map(T=>T.monster).includes(S)));const y=await l.activator.duel.view.waitSelectEntities(l.activator,w,1,S=>S.length===1,"Â¢ìÂú∞„Å∏ÈÄÅ„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",f)??[];if(y.length)return await pe.sendManyToGraveyardForTheSameReason(y,["Cost"],l.action.entity,l.activator),{sendToGraveyard:y}},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async l=>{const o=[...l.activator.getDeckCell().cardEntities.filter(h=>h.lvl===1),...l.activator.getHandCell().cardEntities.filter(h=>h.lvl===1)],f=l.activator.getMonsterZones();return!!l.activator.summonMany(l.activator,"SpecialSummon",["Effect"],l.action,o.map(h=>({monster:h,posList:st,cells:f})),[],!1,h=>h.length===1,!1)},settle:async()=>!0},Ce]};i.push(c);const u={name:"Â∞ÅÂç∞„ÅÆÈªÑÈáëÊ´É",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:l=>{if(!l.activator.getDeckCell().cardEntities.every(o=>!l.activator.canTryBanish(o,"BanishAsEffect",l.action)))return ke(l)},prepare:async()=>({selectedEntities:[],chainBlockTags:["BanishFromDeck"],prepared:void 0}),execute:async l=>{const o=l.activator.getDeckCell().cardEntities.filter(h=>l.activator.canTryBanish(h,"BanishAsEffect",l.action)),f=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,o,1,h=>h.length===1,"Èô§Â§ñ„Åô„Çã„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû„ÄÇ",!1);if(!f)throw new Error("illegal state");return(await Xe.tryBanish(f,l)).forEach(h=>h.counterHolder.removeAll("GoldSarcophagus")),!0},settle:async()=>!0},Jo("ÂõûÂèé„Ç´„Ç¶„É≥„ÉàÈÄ≤Ë°å",["stanby"],l=>{l.activator.isTurnPlayer&&l.action.entity.field.getCells("Banished").flatMap(o=>o.cardEntities).filter(o=>o.moveLog.latestRecord.movedBy===l.action.entity).filter(o=>o.moveLog.latestRecord.actionOwner===l.activator).forEach(o=>{o.counterHolder.add("GoldSarcophagus",1,l.action.entity);const f=o.counterHolder.getQty("GoldSarcophagus",l.action.entity);f<3&&l.activator.duel.log.info(`${o.toString()}„ÅÆ„Çø„Éº„É≥„Ç´„Ç¶„É≥„ÉàÔºö${f-1}‚áí${f}`)})}),{title:"ÂõûÂèé",isMandatory:!0,playType:"LingeringEffect",spellSpeed:"Normal",executableCells:mi,executablePeriods:["stanby"],executableDuelistTypes:["Controller","Opponent"],validate:l=>{if(l.activator.isTurnPlayer)return l.action.entity.field.getCells("Banished").flatMap(o=>o.cardEntities).filter(o=>o.moveLog.latestRecord.movedBy===l.action.entity).filter(o=>o.moveLog.latestRecord.actionOwner===l.activator).some(o=>o.counterHolder.getQty("GoldSarcophagus")===2)?[]:void 0},prepare:zt,execute:async l=>{const o=l.action.entity.field.getCells("Banished").flatMap(p=>p.cardEntities).filter(p=>p.moveLog.latestRecord.movedBy===l.action.entity).filter(p=>p.moveLog.latestRecord.actionOwner===l.activator).filter(p=>p.counterHolder.getQty("GoldSarcophagus")===2);if(!o.length)throw new me("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",l);let f=o[0];if(o.length>1){const p=await l.action.entity.field.duel.view.waitSelectEntities(l.activator,o,1,h=>h.length===1,"ÂõûÂèé„Åô„Çã„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû„ÄÇ",!1);if(!p||!p.length)throw new me("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",l,p);f=p[0]}return await f.addToHand(["Effect"],l.action.entity,l.activator),!0},settle:async()=>!0},Ce]};return i.push(u),i},ac=(i,e,t,r,a)=>({title:"‚ë†„É™„ÇØ„É´„Éº„Éà",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:a,executablePeriods:r.includes("EffectDestroy")?[...Ye,...kt]:["b1DEnd","b2DEnd"],executableDuelistTypes:["Controller"],validate:n=>{if(!n.action.entity.wasMovedAtPreviousChain){console.log(n.action.entity.toString(),n);return}const s=n.activator.getMonsterZones();if(n.activator.getEnableSummonList(n.activator,"SpecialSummon",["Effect"],n.action,n.activator.getDeckCell().cardEntities.filter(i).filter(u=>u.status.kind==="Monster").filter(u=>u.canBeTargetOfEffect(n)).map(u=>({monster:u,posList:t,cells:s})),[],!1).length)return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromDeck"],prepared:void 0}),execute:async n=>{const s=n.activator.getDeckCell().cardEntities.filter(i),c=n.activator.getMonsterZones();return!!n.activator.summonMany(n.activator,"SpecialSummon",["Effect"],n.action,s.map(l=>({monster:l,posList:t,cells:c})),[],!1,l=>l.length===1,!1)},settle:async()=>!0}),nc=()=>{const i=[];return[{name:"„Ç≠„É©„Éº„Éª„Éù„ÉÜ„Éà",filter:e=>e.attr.includes("Dark")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["EffectDestroy"],executableCells:["Graveyard"]},{name:"„Ç≠„É©„Éº„Éª„Éà„Éû„Éà",filter:e=>e.attr.includes("Dark")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"Â∑®Â§ß„Éç„Ç∫„Éü",filter:e=>e.attr.includes("Earth")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„Ç∞„É™„Ç∫„É™„Éº„Éû„Ç∂„Éº",filter:e=>e.attr.includes("Water")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„Ç∑„É£„Ç§„É≥„Ç®„É≥„Ç∏„Çß„É´",filter:e=>e.attr.includes("Light")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„Éâ„É©„Ç¥„É≥„Éï„É©„Ç§",filter:e=>e.attr.includes("Wind")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ÔºµÔº¶ÔºØ„Çø„Éº„Éà„É´",filter:e=>e.attr.includes("Fire")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ËçíÈáé„ÅÆÂ•≥Êà¶Â£´",filter:e=>e.attr.includes("Earth")&&e.types.includes("Warrior")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„É™„Éà„É´„Éª„Éà„É´„Éº„Éë„Éº",filter:e=>e.types.includes("Warrior")&&(e.lvl??9999)<3,qtyList:[1],posList:["Set"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard","Banished"]},{name:"Á†¥Èù¢Á´ú",filter:e=>e.types.includes("Warrior")&&(e.def??9999)<=1500,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ÂÖ±È≥¥Ëô´",filter:e=>e.types.includes("Insect")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„Éî„É©„Éü„ÉÉ„Éâ„Éª„Çø„Éº„Éà„É´",filter:e=>e.types.includes("Zombie")&&(e.def??9999)<=2e3,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„É¶„Éº„Éï„Ç©„É≠„Ç§„Éâ",filter:e=>e.types.includes("Machine")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„Éò„É´„Éª„Çª„Ç≠„É•„É™„ÉÜ„Ç£",filter:e=>e.types.includes("Fiend")&&(e.lvl??9999)===1,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„Ç¨„Çπ„Çø„Éª„Ç§„Ç∞„É´",filter:e=>(e.status.nameTags??[]).includes("„Ç¨„Çπ„Çø")&&(e.status.monsterCategories??[]).includes("Tuner"),qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ÂπªÂΩ±„ÅÆÈ≠îË°ìÂ£´",filter:e=>(e.status.nameTags??[]).includes("Ôº®Ôº•Ôº≤ÔºØ")&&(e.atk??9999)<=1e3,qtyList:[1],posList:["Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„Ç∏„Çß„Éç„ÇØ„Çπ„Éª„Çµ„Éº„ÉÅ„É£„Éº",filter:e=>(e.status.nameTags??[]).includes("„Ç∏„Çß„Éç„ÇØ„Çπ")&&(e.atk??9999)<=1500,qtyList:[1],posList:["Attack"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"Á¥´ÁÇé„ÅÆË∂≥ËªΩ",filter:e=>(e.status.nameTags??[]).includes("ÂÖ≠Ê≠¶Ë°Ü")&&(e.lvl??12)<=3,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„Çπ„É¨„Ç§„Éñ„Éª„Ç®„Ç§„Éó",filter:e=>(e.status.nameTags??[]).includes("Ââ£ÈóòÁç£")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„Çº„É≥„Éû„Ç§„Éè„Éã„Éº",filter:e=>(e.status.nameTags??[]).includes("„Çº„É≥„Éû„Ç§")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"Ôº∏Ôº∏Ôºç„Çª„Ç§„Éê„Éº „Ç®„Éû„Éº„Ç∫„Éñ„É¨„Ç§„Éâ",filter:e=>(e.status.nameTags??[]).includes("Ôº∏Ôºç„Çª„Ç§„Éê„Éº")&&(e.lvl??12)<=4,qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"ËªçÈöäÁ´ú",filter:e=>e.nm==="ËªçÈöäÁ´ú",qtyList:[1],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„Ç¢„Çµ„É´„Éà„Éª„Ç¨„É≥„Éâ„ÉÉ„Ç∞",filter:e=>e.nm==="„Ç¢„Çµ„É´„Éà„Éª„Ç¨„É≥„Éâ„ÉÉ„Ç∞",qtyList:[1,2,3,4,5],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]},{name:"„Éè„Ç§„Ç®„Éä",filter:e=>e.nm==="„Éè„Ç§„Ç®„Éä",qtyList:[1,2,3,4,5],posList:["Attack","Defense"],destoryTypes:["BattleDestroy"],executableCells:["Graveyard"]}].forEach(e=>{i.push({name:e.name,actions:[ac(e.filter,e.qtyList,e.posList,e.destoryTypes,e.executableCells),Fe,Re,Ue,Ve]})}),i},sc=i=>({title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,validate:e=>{if(e.activator.getDeckCell().cardEntities.filter(i).length!==0&&e.activator.canDraw)return ke(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async e=>{const t=e.activator.getDeckCell().cardEntities.filter(i);if(t.length===0)return!1;const r=await e.action.entity.field.duel.view.waitSelectEntities(e.activator,t,1,a=>a.length===1,"ÊâãÊú≠„Å´Âä†„Åà„Çã„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû",!1);for(const a of r??[])await a.addToHand(["Effect"],e.action.entity,e.activator);return e.activator.getDeckCell().shuffle(),!0},settle:async()=>!0}),lc=(i,e)=>({title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,priorityForNPC:40,validate:t=>{if(!(t.activator.getGraveyard().cardEntities.filter(i).length<e))return ke(t)},prepare:async()=>({selectedEntities:[],chainBlockTags:["AddToHandFromGraveyard"],prepared:void 0}),execute:async t=>{const r=t.activator.getGraveyard().cardEntities.filter(i);if(r.length===0)return!1;const a=await t.action.entity.field.duel.view.waitSelectEntities(t.activator,r,e,n=>n.length===e,"ÊâãÊú≠„Å´Âä†„Åà„Çã„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû",!1);for(const n of a??[])await n.addToHand(["Effect"],t.action.entity,t.activator);return!0},settle:async()=>!0}),oc=i=>({title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:40,canPayCosts:e=>e.activator.getHandCell().cardEntities.filter(i).some(t=>e.activator.canDiscard([t])),validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<2))return ke(e)},payCosts:async e=>({discard:await e.activator.discard(1,["Discard","Cost"],e.action.entity,e.activator,i)}),prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(2,e.action.entity,e.activator),!0),settle:async()=>!0}),cc=i=>({title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:ke,prepare:async e=>{const[t,r]=i(e.action.entity),a=[];return t<0&&a.push("DamageToSelf"),r<0&&a.push("DamageToOpponent"),{selectedEntities:[],chainBlockTags:a,prepared:void 0}},execute:async e=>{const[t,r]=i(e.action.entity);return r>0?e.activator.getOpponentPlayer().heal(r,e.action.entity):r<0&&e.activator.getOpponentPlayer().effectDamage(Math.abs(r),e.action.entity),t>0?e.activator.heal(t,e.action.entity):t<0&&e.activator.effectDamage(Math.abs(t),e.action.entity),!0},settle:async()=>!0}),dc=()=>{const i=[];return[{name:"Â¢óÊè¥",filter:e=>e.origin.kind==="Monster"&&e.types.includes("Warrior")&&(e.origin.level??5)<5},{name:"ÂåñÁü≥Ë™øÊüª",filter:e=>e.origin.kind==="Monster"&&e.types.includes("Dinosaur")&&(e.origin.level??6)<6},{name:"Ôº•Ôºç„Ç®„Éû„Éº„Ç∏„Çß„É≥„Ç∑„Éº„Ç≥„Éº„É´",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("Ôº•„ÉªÔº®Ôº•Ôº≤ÔºØ")},{name:"Âè¨ÈõÜ„ÅÆËÅñÂàªÂç∞",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("ËÅñÂàª")},{name:"Âè¨ÂñöÂ∏´„ÅÆ„Çπ„Ç≠„É´",filter:e=>e.origin.kind==="Monster"&&(e.origin.monsterCategories??[]).includes("Normal")&&(e.origin.level??4)>4},{name:"„Éà„Ç•„Éº„É≥„ÅÆ„ÇÇ„Åè„Åò",filter:e=>(e.origin.nameTags??[]).includes("„Éà„Ç•„Éº„É≥")},{name:"ËûçÂêàË≥¢ËÄÖ",filter:e=>e.origin.name==="ËûçÂêà"},{name:"Ëôπ„ÅÆÊû∂„ÅëÊ©ã",filter:e=>e.origin.kind!=="Monster"&&(e.origin.nameTags??[]).includes("ÂÆùÁéâ")},{name:"Á¥´ÁÇé„ÅÆÁãºÁÖô",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("ÂÖ≠Ê≠¶Ë°Ü")&&(e.origin.level??4)<4},{name:"„ÉÜ„É©„Éª„Éï„Ç©„Éº„Éü„É≥„Ç∞",filter:e=>e.origin.kind==="Spell"&&e.origin.spellCategory==="Field"},{name:"„Ç≥„Éº„É´„Éª„É™„Çæ„Éç„Éº„Çø„Éº",filter:e=>e.origin.kind==="Monster"&&(e.origin.nameTags??[]).includes("„É™„Çæ„Éç„Éº„Çø„Éº")}].forEach(e=>{i.push({name:e.name,actions:[sc(e.filter),Ce]})}),[{name:"Êà¶Â£´„ÅÆÁîüÈÇÑ",filter:e=>e.status.kind==="Monster"&&e.types.includes("Warrior"),qty:1},{name:"„ÉÄ„Éº„ÇØ„Éª„Éê„Éº„Çπ„Éà",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Dark")&&(e.atk??9999)<=1500,qty:1},{name:"ÊÇ™Â§¢ÂÜç„Å≥",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Dark")&&(e.def??9999)===0,qty:2},{name:"„Çµ„É´„Éô„Éº„Ç∏",filter:e=>e.status.kind==="Monster"&&e.attr.includes("Water")&&(e.atk??9999)<=1500,qty:2},{name:"„Éê„ÉÉ„ÉÜ„É™„Éº„É™„Çµ„Ç§„ÇØ„É´",filter:e=>e.status.kind==="Monster"&&e.types.includes("Thunder")&&(e.atk??9999)<=1500,qty:2},{name:"Èóá„ÅÆÈáèÁî£Â∑•Â†¥",filter:e=>e.status.kind==="Monster"&&(e.status.monsterCategories??[]).includes("Normal"),qty:2}].forEach(e=>{i.push({name:e.name,actions:[lc(e.filter,e.qty),Ce]})}),[{name:"„Éà„É¨„Éº„Éâ„Éª„Ç§„É≥",filter:e=>e.status.kind==="Monster"&&(e.lvl??0)===8},{name:"Ë™øÂíå„ÅÆÂÆùÊú≠",filter:e=>e.status.kind==="Monster"&&(e.origin.monsterCategories??[]).includes("Tuner")&&e.types.includes("Dragon")&&(e.atk??9999)<=1e3},{name:"„Éá„Çπ„ÉÜ„Éã„Éº„Éª„Éâ„É≠„Éº",filter:e=>e.status.kind==="Monster"&&(e.origin.nameTags??[]).includes("Ôº§ÔºçÔº®Ôº•Ôº≤ÔºØ")}].forEach(e=>{i.push({name:e.name,actions:[oc(e.filter),Ce]})}),[{name:"ÁÅ´„ÅÆÁ≤â",calcHeal:()=>[0,-200]},{name:"Èõ∑È≥¥",calcHeal:()=>[0,-300]},{name:"„Éï„Ç°„Ç§„É§„Éº„Éª„Éú„Éº„É´",calcHeal:()=>[0,-500]},{name:"ÁÅ´„ÅÇ„Å∂„Çä„ÅÆÂàë",calcHeal:()=>[0,-600]},{name:"ÊòºÂ§ú„ÅÆÂ§ßÁÅ´‰∫ã",calcHeal:()=>[0,-800]},{name:"ÁÅ´ÁÇéÂú∞ÁçÑ",calcHeal:()=>[-500,-1e3]},{name:"Áõó‰∫∫„Ç¥„Éñ„É™„É≥",calcHeal:()=>[500,-500]},{name:"„Éñ„É´„Éº„Éª„Éù„Éº„Ç∑„Éß„É≥",calcHeal:()=>[400,0]},{name:"„É¨„ÉÉ„Éâ„Éª„Éù„Éº„Ç∑„Éß„É≥",calcHeal:()=>[500,0]},{name:"„Ç¥„Éñ„É™„É≥„ÅÆÁßòËñ¨",calcHeal:()=>[600,0]},{name:"Â§©‰Ωø„ÅÆÁîü„ÅçË°Ä",calcHeal:()=>[800,0]},{name:"Ê≤ªÁôÇ„ÅÆÁ•û „Éá„Ç£„Ç¢„É≥„Éª„Ç±„Éà",calcHeal:()=>[1e3,0]},{name:"ÊÅµ„Åø„ÅÆÈõ®",calcHeal:()=>[1e3,1e3]}].forEach(e=>{i.push({name:e.name,actions:[cc(e.calcHeal),Ce]})}),i},uc=(i,e,t,r,a,n)=>{if(!i.action.entity.origin.level||r.some(l=>!l.lvl)||r.map(l=>l.lvl??0).reduce((l,o)=>l+o,0)!==i.action.entity.origin.level)return;const s=r.filter(l=>{var o;return(o=l.status.monsterCategories)==null?void 0:o.some(f=>f==="Tuner")}),c=r.filter(l=>{var o;return(o=l.status.monsterCategories)==null?void 0:o.every(f=>f!=="Tuner")});if(!a(s)||!n(c))return;const u=[...s.map(l=>({material:l,isAsTuner:!0})),...c.map(l=>({material:l,isAsTuner:!1}))];if(i.activator.getEnableSummonList(i.activator,"SyncroSummon",["Rule","SpecialSummon"],i.action,[{monster:i.action.entity,posList:e,cells:t}],u,!1).length)return u},fc=(i,e=r=>r.length===1,t=r=>r.length>0)=>{let r=[...i.activator.getMonstersOnField().filter(s=>s.battlePosition!=="Set"),...i.activator.getHandCell().cardEntities.filter(s=>s.origin.kind==="Monster")];if(r.every(s=>!s.status.allowHandSyncro)&&(r=r.filter(s=>s.fieldCell.isPlayFieldCell)),r.length<2)return[];const a=[...i.activator.getMonsterZones(),...i.activator.duel.field.getCells("ExtraMonsterZone")],n=["Attack","Defense"];return r.getAllOnOffPattern().map(s=>uc(i,n,a,s,e,t)??[]).filter(s=>s.length)},vc=async(i,e,t)=>{var u;const r=i.action.getEnableMaterialPatterns(i),a=r.map(l=>({infos:l,materialSeqList:l.map(o=>o.material.seq).sort()}));let n=r[0].map(l=>l.material);if(r.length>1){const l=r.flatMap(f=>f.map(p=>p.material)).getDistinct(),o=await i.action.entity.duel.view.waitSelectEntities(i.activator,l,void 0,f=>{const p=f.map(h=>h.seq).sort();return a.some(h=>p.length===h.materialSeqList.length&&p.every((m,w)=>m===h.materialSeqList[w]))},"„Ç∑„É≥„ÇØ„É≠Á¥†Êùê„Å®„Åô„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",t);if(!o)return;n=o}console.log(r,n);const s=n.map(l=>l.seq).sort(),c=(u=a.find(l=>s.length===l.materialSeqList.length&&s.every((o,f)=>o===l.materialSeqList[f])))==null?void 0:u.infos;if(!c)throw new me("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",i,n);return await pe.sendManyToGraveyardForTheSameReason(n,["SyncroMaterial","Cost","Rule","SpecialSummonMaterial"],i.action.entity,i.activator),{summonMaterialInfos:c}},Oi=(i=t=>t.length===1,e=t=>t.length>0)=>({title:"„Ç∑„É≥„ÇØ„É≠Âè¨Âñö",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],getEnableMaterialPatterns:t=>fc(t,i,e),canPayCosts:t=>t.action.getEnableMaterialPatterns(t).length>0,validate:t=>!t.ignoreCost||t.activator.getAvailableExtraZones().length+t.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:vc,prepare:t=>ni(t,"SyncroSummon",["Rule","SpecialSummon","SyncroSummon"],["Attack","Defense"]),execute:si,settle:async()=>!0}),pc=()=>{const i=[];return["Â§ßÂú∞„ÅÆÈ®éÂ£´„Ç¨„Ç§„Ç¢„Éä„Ç§„Éà","„Çπ„ÇØ„É©„ÉÉ„Éó„Éª„Éá„Çπ„Éá„Éº„É¢„É≥"].forEach(e=>i.push({name:e,actions:[Fe,Re,Ue,Oi()],defaultSummonFilter:Zt})),i.push({name:"„Éä„ÉÅ„É•„É´„Éª„Ç¨„Ç™„Éâ„É¨„Ç§„ÇØ",actions:[Fe,Re,Ue,Oi(e=>e.length===1&&e.every(t=>t.attr.some(r=>r==="Earth")),e=>e.length>0&&e.every(t=>t.attr.some(r=>r==="Earth")))],defaultSummonFilter:Zt}),i.push({name:"„Éû„Ç∏„Ç´„É´„Éª„Ç¢„É≥„Éâ„É≠„Ç§„Éâ",actions:[Fe,Re,Ue,Oi(),{title:"ÂõûÂæ©",isMandatory:!0,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:["end"],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,validate:e=>e.action.entity.duel.phase==="end"&&e.activator.isTurnPlayer&&e.action.entity.face==="FaceUp"?[]:void 0,prepare:zt,execute:async e=>(e.activator.heal(e.activator.getMonstersOnField().filter(t=>t.face==="FaceUp").filter(t=>t.types.includes("Psychic")).length*600,e.action.entity),!0),settle:async()=>!0}],defaultSummonFilter:Zt}),i},hc=()=>{const i=[];return[{name:"ËçâÂéü",up:["Warrior","BeastWarrior"],down:[]},{name:"Ê£Æ",up:["Insect","Plant","Beast","BeastWarrior"],down:[]},{name:"Â±±",up:["Dragon","WingedBeast","Thunder"],down:[]},{name:"ËçíÈáé",up:["Dinosaur","Zombie","Rock"],down:[]},{name:"Êµ∑",up:["Aqua","SeaSerpent","Fish"],down:["Machine","Pyro"]},{name:"Èóá",up:["Fiend","Spellcaster"],down:["Fairy"]}].forEach(e=>{i.push({name:e.name,actions:[{title:"Áô∫Âãï",isMandatory:!1,canIgnoreCosts:!0,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:ke,prepare:zt,execute:async()=>!0,settle:async()=>!0},Ce],continuousEffects:[pr("Áô∫Âãï","Spell",t=>t.isOnField&&t.face==="FaceUp",t=>["attack","defense"].flatMap(r=>["up","down"].map(a=>lt.createContinuous("Áô∫Âãï",n=>n.isSpawnedBy.isOnField&&n.isSpawnedBy.face==="FaceUp",t,(n,s)=>s.isOnField&&s.face==="FaceUp"&&(s.status.monsterCategories??!1)&&e[a].union(s.types).length>0,r,"wip","Addition",(n,s,c)=>!n.isEffective||s.face==="FaceDown"?c:c+(a==="up"?200:-200)))))]})}),[{name:"„Éê„Éº„Éã„É≥„Ç∞„Éñ„É©„ÉÉ„Éâ",attr:"Fire"},{name:"„Ç¶„Ç©„Éº„Çø„Éº„ÉØ„Éº„É´„Éâ",attr:"Water"},{name:"„Ç¨„Ç§„Ç¢„Éë„ÉØ„Éº",attr:"Earth"},{name:"„Ç∑„É£„Ç§„É≥„Çπ„Éë„Éº„ÇØ",attr:"Light"},{name:"„ÉÄ„Éº„ÇØ„Çæ„Éº„É≥",attr:"Dark"},{name:"„Éá„Ç∂„Éº„Éà„Çπ„Éà„Éº„É†",attr:"Wind"}].forEach(e=>{i.push({name:e.name,actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","FieldSpellZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:ke,prepare:zt,execute:async()=>!0,settle:async()=>!0},Ce],continuousEffects:[pr("Áô∫Âãï","Spell",t=>t.isOnField&&t.face==="FaceUp",t=>["attack","defense"].flatMap(r=>lt.createContinuous("Áô∫Âãï",a=>a.isSpawnedBy.isOnField&&a.isSpawnedBy.face==="FaceUp",t,(a,n)=>n.isOnField&&n.face==="FaceUp"&&n.attr.includes(e.attr),r,"wip","Addition",(a,n,s)=>!a.isEffective||n.face==="FaceDown"?s:s+(r==="attack"?500:-400))))]})}),i},gc=()=>{const i=[],e={name:"ÈÄ£ÂêàËªç",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:ke,prepare:zt,execute:async()=>!0,settle:async()=>!0},Ce],continuousEffects:[pr("Áô∫Âãï","Spell",t=>t.isOnField&&t.face==="FaceUp",t=>[lt.createContinuous("Áô∫Âãï",r=>r.isSpawnedBy.isOnField&&r.isSpawnedBy.face==="FaceUp",t,(r,a)=>a.controller===r.isSpawnedBy.controller&&a.types.includes("Warrior")&&a.isOnField&&a.face==="FaceUp","attack","wip","Addition",(r,a,n)=>{if(!r.isEffective||a.face==="FaceDown")return n;const s=r.controller.getMonstersOnField().filter(c=>c.face==="FaceUp").filter(c=>c.types.includes("Warrior")||c.types.includes("Spellcaster")).length;return n+s*200})])]};return i.push(e),i},yc=()=>{const i=[];[{name:"Âõ£Áµê„ÅÆÂäõ",kind:["Monster"],rate:800},{name:"È≠îÂ∞éÂ∏´„ÅÆÂäõ",kind:["Spell","Trap"],rate:500}].forEach(t=>{i.push({name:t.name,actions:[la(),Ce],continuousEffects:[Br(t.name,"Spell",r=>r.info.equipedBy?[r.info.equipedBy]:[],r=>r.isOnField&&r.face==="FaceUp",r=>["attack","defense"].map(a=>lt.createContinuous("Áô∫Âãï",n=>n.isSpawnedBy.isOnField&&n.isSpawnedBy.face==="FaceUp",r,(n,s)=>s.isOnField&&s.face==="FaceUp",a,"wip","Addition",(n,s,c)=>{if(!n.isEffective)return c;const u=n.controller.getEntiteisOnField().filter(l=>t.kind.includes(l.status.kind)).length;return c+u*t.rate})))]})});const e={name:"Êó©„Åô„Åé„ÅüÂüãËë¨",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,canPayCosts:t=>t.activator.lp>=800,validate:t=>{const r=t.activator.getMonsterZones();if(t.activator.getEnableSummonList(t.activator,"SpecialSummon",["Effect"],t.action,t.activator.getGraveyard().cardEntities.filter(n=>n.status.kind==="Monster").filter(n=>n.canBeTargetOfEffect(t)).map(n=>({monster:n,posList:["Attack"],cells:r})),[],!1).length)return ke(t)},payCosts:(t,r)=>Ko(t,r,800),prepare:async t=>{const r=await Yi(t,t.activator.getGraveyard().cardEntities.filter(a=>a.status.kind==="Monster").filter(a=>a.canBeTargetOfEffect(t)),["Attack"]);return r.chainBlockTags.push("PayLifePoint"),r},execute:async(t,r)=>t.action.entity.info.equipedBy?(await t.action.entity.ruleDestory(),!1):await Xi(t,["Attack"])?(t.action.entity.onBeforeMove.append(async n=>{if(n.entity.face!=="FaceUp"||!n.entity.isOnFieldAsSpellTrap)return"RemoveMe";const s=n.entity.info.equipedBy;if(!s)return"RemoveMe";console.log(n.entity.toString(),n.entity);const[,,,,,c]=n.args;return s.isOnField&&s.face==="FaceUp"&&n.entity.isEffective&&c.union(["EffectDestroy","RuleDestroy"]).length&&(console.log(t.action.entity.toString()),n.entity.controller.writeInfoLog(`${t.action.entity.toString()}„ÅåÁ†¥Â£ä„Åï„Çå„Åü„Åü„ÇÅ„ÄÅË£ÖÂÇôÂØæË±°„É¢„É≥„Çπ„Çø„Éº${s.toString()}„ÇíÁ†¥Â£ä„ÄÇ`),Xe.tryMarkForDestory([s],t)),"RemoveMe"}),Qn(t,r,(n,s)=>{var c;return(c=s.info.effectTargets[t.action.seq])==null?void 0:c.includes(n)})):(await t.action.entity.ruleDestory(),!1),settle:async()=>!0},Ce]};return i.push(e),i.push({name:"ÂπªÊÉë„ÅÆÂ∑ªÁâ©",actions:[la(),Ce],continuousEffects:[]}),i},mc=()=>{const i=[];return[{name:"‰ºùË™¨„ÅÆÂâ£",attr:void 0,monType:"Warrior",atk:200,def:200},{name:"ÁßòË°ì„ÅÆÊõ∏",attr:void 0,monType:"Spellcaster",atk:200,def:200},{name:"„Éù„Çª„Ç§„Éâ„É≥„ÅÆÂäõ",attr:void 0,monType:"Aqua",atk:200,def:200},{name:"Á¥´Ê∞¥Êô∂",attr:void 0,monType:"Zombie",atk:200,def:200},{name:"ÁåõÁç£„ÅÆÊ≠Ø",attr:void 0,monType:"Beast",atk:200,def:200},{name:"Ê©üÊ¢∞ÊîπÈÄ†Â∑•Â†¥",attr:void 0,monType:"Machine",atk:200,def:200},{name:"‰ΩìÊ∏©„ÅÆ‰∏äÊòá",attr:void 0,monType:"Reptile",atk:200,def:200},{name:"È≠îËèå",attr:void 0,monType:"Plant",atk:200,def:200},{name:"Èóá„Éª„Ç®„Éç„É´„ÇÆ„Éº",attr:void 0,monType:"Fiend",atk:200,def:200},{name:"„É¨„Éº„Ç∂„ÉºÁ†≤Ê©üÁî≤Èéß",attr:void 0,monType:"Insect",atk:200,def:200},{name:"ÈäÄ„ÅÆÂºìÁü¢",attr:void 0,monType:"Fairy",atk:200,def:200},{name:"ÈõªÊíÉÈû≠",attr:void 0,monType:"Thunder",atk:200,def:200},{name:"„Éâ„É©„Ç¥„É≥„ÅÆÁßòÂÆù",attr:void 0,monType:"Dragon",atk:200,def:200},{name:"„Éï„Ç©„É≠„Éº„Éª„Ç¶„Ç£„É≥„Éâ",attr:void 0,monType:"WingedBeast",atk:200,def:200},{name:"È≠îÊÄß„ÅÆÊúà",attr:void 0,monType:"BeastWarrior",atk:200,def:200},{name:"„Ç®„É´„Éï„ÅÆÂÖâ",attr:"Light",monType:void 0,atk:400,def:-200},{name:"Ë¶öÈÜí",attr:"Earth",monType:void 0,atk:400,def:-200},{name:"ÁÅºÁÜ±„ÅÆÊßç",attr:"Fire",monType:void 0,atk:400,def:-200},{name:"Á™ÅÈ¢®„ÅÆÊâá",attr:"Wind",monType:void 0,atk:400,def:-200},{name:"„ÅØ„Åå„Å≠„ÅÆÁî≤ÁæÖ",attr:"Water",monType:void 0,atk:400,def:-200},{name:"Èóá„ÅÆÁ†¥Á•ûÂâ£",attr:"Dark",monType:void 0,atk:400,def:-200},{name:"ÁÅ´Âô®‰ªòÊ©üÁî≤Èéß",attr:void 0,monType:"Insect",atk:700,def:0},{name:"„Çµ„É©„Éû„É≥„Éâ„É©",attr:"Fire",monType:void 0,atk:700,def:0},{name:"„Ç∑„É£„Ç§„É≥„Éª„Ç≠„É£„ÉÉ„Çπ„É´",attr:"Light",monType:void 0,atk:700,def:0}].forEach(e=>{i.push({name:e.name,actions:[la(t=>(!e.attr||t.attr.includes(e.attr))&&(!e.monType||t.types.includes(e.monType))),Ce],continuousEffects:[Br(e.name,"Spell",t=>t.info.equipedBy?[t.info.equipedBy]:[],t=>t.isOnField&&t.face==="FaceUp",t=>{const r=[];return e.atk!==0&&r.push(["attack",e.atk]),e.def!==0&&r.push(["defense",e.def]),r.map(([a,n])=>lt.createContinuous("Áô∫Âãï",s=>s.isSpawnedBy.isOnField&&s.isSpawnedBy.face==="FaceUp",t,(s,c)=>c.isOnField&&c.face==="FaceUp"&&(!e.monType||c.types.includes(e.monType))&&(!e.attr||c.attr.includes(e.attr)),a,"wip","Addition",(s,c,u)=>s.isEffective?u+n:u))})]})}),i},_c=()=>{const i=[],e={name:"„Å´„Åõ„Ç¢„Éê„Çø„Éº",actions:[Ve,Fe,Re],continuousEffects:[Br("THE_DEVILS_AVATAR","Monster",r=>[r],r=>r.isOnField&&r.face==="FaceUp",r=>["attack","defense"].map(a=>lt.createContinuous("THE_DEVILS_AVATAR",n=>n.isSpawnedBy.isOnField&&n.isSpawnedBy.face==="FaceUp",r,(n,s)=>s.isOnField&&s.face==="FaceUp",a,"calculated","THE_DEVILS_AVATAR",()=>Number.MIN_VALUE)))]};i.push(e);const t={name:"„Å´„Åõ„Éâ„É¨„ÉÉ„Éâ„Éª„É´„Éº„Éà",actions:[Ve,Fe,Re],continuousEffects:[pr("THE_DEVILS_DREAD-ROOT","Monster",r=>r.isOnField&&r.face==="FaceUp",r=>["attack","defense"].map(a=>lt.createContinuous("THE_DEVILS_DREAD-ROOT",n=>n.isSpawnedBy.isOnField&&n.isSpawnedBy.face==="FaceUp",r,(n,s)=>s.status.kind==="Monster"&&s.isOnField&&s.face==="FaceUp"&&s!==n.isSpawnedBy,a,"calculated","THE_DEVILS_DREAD-ROOT",(n,s,c)=>Math.round(c/2))))]};return i.push(t),i},Sc=()=>{const i=[],e={name:"„ÅîÈö†Â±Ö„ÅÆÁåõÊØíËñ¨",actions:[Ce,{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:Ye,executableDuelistTypes:["Controller"],validate:ke,prepare:async(r,a,n)=>{const s=await r.action.entity.field.duel.view.waitSelectText([{seq:0,text:"‚óèËá™ÂàÜ„ÅØÔºëÔºíÔºêÔºêÔº¨Ôº∞ÂõûÂæ©„Åô„Çã„ÄÇ"},{seq:1,text:"‚óèÁõ∏Êâã„Å´ÔºòÔºêÔºê„ÉÄ„É°„Éº„Ç∏„Çí‰∏é„Åà„Çã„ÄÇ"}],"‰ΩøÁî®„Åô„ÇãÂäπÊûú„ÇíÈÅ∏Êäû",!1);if(s===void 0&&!n)throw new li(r);const c=[];return s===1&&c.push("DamageToOpponent"),{selectedEntities:[],chainBlockTags:c,prepared:s??0}},execute:async r=>r.prepared===1?(r.activator.getOpponentPlayer().effectDamage(800,r.action.entity),!0):(r.activator.heal(1200,r.action.entity),!0),settle:async()=>!0}]};i.push(e);const t={name:"Êúà„ÅÆÊõ∏",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:Ye,executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:r=>{if(r.action.entity.field.getMonstersOnField().filter(n=>n.canBeTargetOfEffect(r)).length)return ke(r)},prepare:async(r,a,n)=>{const s=r.action.entity.field.getMonstersOnField().filter(u=>u.canBeTargetOfEffect(r)),c=await r.action.entity.duel.view.waitSelectEntities(r.activator,s,1,u=>u.length===1,"ÂØæË±°„Å®„Åô„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",n);if(c)return{selectedEntities:c,chainBlockTags:[],prepared:void 0}},execute:async r=>{const a=r.selectedEntities[0];if(!a.isOnFieldAsMonster||a.battlePosition==="Set")return!1;if(!a.canBeEffected(r.activator,r.action.entity,r.action)){r.activator.duel.log.info(`${a.toString()}„ÅØ${r.action.entity.toString()}„ÅÆÂäπÊûú„ÇíÂèó„Åë„Å™„ÅÑ„ÄÇ`);return}return console.log(a.toString(),a.info.equipEntities),await a.setBattlePosition("Set",["Effect"],r.action.entity,r.activator),!0},settle:async()=>!0},Ce]};return i.push(t),i.push({name:"Á™ÅÈÄ≤",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:[...Ye,...kt],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:r=>{if(r.action.entity.field.getMonstersOnField().filter(n=>n.canBeTargetOfEffect(r)).length)return ke(r)},prepare:async(r,a,n)=>{const s=r.action.entity.field.getMonstersOnField().filter(u=>u.canBeTargetOfEffect(r)),c=await r.action.entity.duel.view.waitSelectEntities(r.activator,s,1,u=>u.length===1,"ÂØæË±°„Å®„Åô„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",n);if(c)return console.log(c[0].toString(),c[0].info.equipEntities),{selectedEntities:c,chainBlockTags:[],prepared:void 0}},execute:async r=>{const a=r.selectedEntities[0];if(!a.isOnFieldAsMonster||a.battlePosition==="Set")return!1;if(!a.canBeEffected(r.activator,r.action.entity,r.action)){r.activator.duel.log.info(`${a.toString()}„ÅØ${r.action.entity.toString()}„ÅÆÂäπÊûú„ÇíÂèó„Åë„Å™„ÅÑ„ÄÇ`);return}return a.numericOprsBundle.push(lt.createLingeringAddition("ÊîªÊíÉÂäõ‰∏äÊòá",n=>n.effectOwner.duel.clock.isSameTurn(n.isSpawnedAt),r.action.entity,r.action,"attack",(n,s,c)=>c+700)),!0},settle:async()=>!0},Ce]}),i},bc=(i,e)=>{const t=`È≠îÂäõÂÖÖÂ°´ÂèØËÉΩ(${e})`;return fo(t,i,r=>[r],()=>!0,r=>[new ho(t,()=>!0,!0,r,{},(a,n)=>a.isSpawnedBy===n,(a,n)=>(n.maxCounterQty.SpellCounter=e,n))])},wc=(i,e,t)=>i.action.entity.counterHolder.getQty("SpellCounter")>=t,Cc=(i,e,t,r)=>{const a=r[0];return i.action.entity.counterHolder.remove("SpellCounter",a),{counter:a}},kc=()=>{const i=[],e={name:"È≠îÂ∞éÊà¶Â£´ „Éñ„É¨„Ç§„Ç´„Éº",actions:[Fe,Re,Ue,Ve,{title:"‚ë†È≠îÂäõÂÖÖÂ°´",isMandatory:!0,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:t=>{if(t.action.entity.hasBeenSummonedNow(["NormalSummon"]))return[]},prepare:async()=>({selectedEntities:[],chainBlockTags:["IfNormarlSummonSucceed"],prepared:void 0}),execute:async t=>t.action.entity.face==="FaceDown"?!1:(t.action.entity.counterHolder.setQty("SpellCounter",1,t.action.entity),!0),settle:async()=>!0},{title:"‚ë¢„Éû„Éä„Éñ„É¨„Ç§„ÇØ",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],canPayCosts:(t,r)=>wc(t,r,1),validate:t=>{const r=t.action.entity.field.getCells(...Gt).flatMap(a=>a.cardEntities).filter(a=>a.canBeTargetOfEffect(t));if(r.length)return r.map(a=>a.fieldCell)},payCosts:async(t,r,a)=>Cc(t,r,a,[1]),prepare:async(t,r,a)=>{var s;let n=(s=t.dest)==null?void 0:s.cardEntities[0];if(!n){const c=t.action.entity.field.getCells(...Gt).flatMap(l=>l.cardEntities).filter(l=>l.canBeTargetOfEffect(t)),u=await t.action.entity.duel.view.waitSelectEntities(t.activator,c,1,l=>l.length===1,"Á†¥Â£ä„Åô„ÇãÂØæË±°„ÇíÈÅ∏Êäû„ÄÇ",a);if(!u||!u.length)return;n=u[0]}return{selectedEntities:[n],chainBlockTags:t.action.calcChainBlockTagsForDestroy([n]),prepared:void 0}},execute:async t=>{if(!t.selectedEntities.every(r=>!r.isOnFieldAsSpellTrap))return await Xe.tryDestroy(t.selectedEntities,t),!0},settle:async()=>!0}],continuousEffects:[bc("Monster",1),Br("‚ë°ÊîªÊíÉÂäõ‰∏äÊòá","Monster",t=>[t],()=>!0,t=>[lt.createContinuous("‚ë°ÊîªÊíÉÂäõ‰∏äÊòá",()=>!0,t,()=>!0,"attack","wip","Addition",(r,a,n)=>r.isEffective?n+r.counterHolder.getQty("SpellCounter")*300:n)])]};return i.push(e),i},Tc=()=>{const i=[];return["ÁÇ∏Ë£ÇË£ÖÁî≤","Ê¨°ÂÖÉÂπΩÈñâ"].forEach(e=>{i.push({name:e,actions:[Ce,{title:"Áô∫Âãï",playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:["b1Battle","b2Battle"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:t=>{if(!t.activator.duel.clock.isUponAttackDeclaration()||t.activator.isTurnPlayer)return;const r=t.activator.duel.attackingMonster;if(!r)throw new me("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",t,r);if(r.canBeTargetOfEffect(t))return e==="Ê¨°ÂÖÉÂπΩÈñâ"&&!t.activator.canTryBanish(r,"BanishAsEffect",t.action)?!1:ke(t)},prepare:async t=>{const r=t.activator.duel.attackingMonster;if(!r)throw new me("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",t,r);const a=e==="ÁÇ∏Ë£ÇË£ÖÁî≤"?t.action.calcChainBlockTagsForDestroy([r]):["BanishFromField"];return{selectedEntities:[r],chainBlockTags:a,prepared:void 0}},execute:async t=>(e==="ÁÇ∏Ë£ÇË£ÖÁî≤"?await Xe.tryDestroy(t.selectedEntities,t):await Xe.tryBanish(t.selectedEntities,t),!0),settle:async()=>!0}]})}),i},Ec=()=>{const i=[];return i.push({name:"Âº∑Ê¨≤„Å™Áì∂",actions:[Ce,{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:Ye,executableDuelistTypes:["Controller"],validate:e=>{if(!(e.activator.getDeckCell().cardEntities.length<2)&&e.activator.canDraw&&e.activator.canAddToHandFromDeck)return ke(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async e=>(await e.activator.draw(1,e.action.entity,e.activator),!0),settle:async()=>!0}]}),i.push({name:"Êà¶Á∑öÂæ©Â∏∞",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:Ye,executableDuelistTypes:["Controller"],hasToTargetCards:!0,validate:e=>{const t=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getGraveyard().cardEntities.filter(a=>a.status.kind==="Monster").filter(a=>a.canBeTargetOfEffect(e)).map(a=>({monster:a,posList:["Defense"],cells:t})),[],!1).length)return ke(e)},prepare:e=>Yi(e,e.activator.getGraveyard().cardEntities.filter(t=>t.status.kind==="Monster").filter(t=>t.canBeTargetOfEffect(e)),["Defense"]),execute:async e=>Xi(e,["Defense"]),settle:async()=>!0},Ce]}),i},Dc=()=>{const i=[],e={name:"Âº∑Ê¨≤„Å™Â£∫",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:20,validate:s=>{if(!(s.activator.getDeckCell().cardEntities.length<2)&&s.activator.canDraw&&s.activator.canAddToHandFromDeck)return ke(s)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async s=>(await s.activator.draw(2,s.action.entity,s.activator),!0),settle:async()=>!0},Ce]};i.push(e);const t={name:"Ë≤™Ê¨≤„Å™Â£∫",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:30,validate:s=>{if(!(s.activator.getGraveyard().cardEntities.filter(c=>c.status.kind==="Monster").filter(c=>c.canBeTargetOfEffect(s)).length<5)&&s.activator.canDraw&&s.activator.canAddToHandFromDeck)return ke(s)},prepare:async s=>{const c=await s.action.entity.field.duel.view.waitSelectEntities(s.activator,s.activator.getGraveyard().cardEntities.filter(u=>u.status.kind==="Monster").filter(u=>u.canBeTargetOfEffect(s)),5,u=>u.length===5,"„Éá„ÉÉ„Ç≠„Å´Êàª„Åô„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû„ÄÇ",!1);if(c)return{selectedEntities:c,chainBlockTags:["Draw","ReturnToDeckFromGraveyard"],prepared:void 0}},execute:async s=>s.selectedEntities.some(c=>c.wasMovedAtCurrentChain)?!1:(await pe.returnManyToDeckForTheSameReason("Random",s.selectedEntities,["Effect"],s.action.entity,s.activator),await s.activator.draw(2,s.action.entity,s.activator),!0),settle:async()=>!0},Ce]};i.push(t);const r={name:"Â§©‰Ωø„ÅÆÊñΩ„Åó",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:30,validate:s=>{if(!(s.activator.getDeckCell().cardEntities.length<3))return ke(s)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw","DiscordAsEffect"],prepared:void 0}),execute:async s=>(await s.activator.draw(3,s.action.entity,s.activator),await s.activator.discard(2,["Effect","Discard"],s.action.entity,s.activator,()=>!0,s.activator),!0),settle:async()=>!0},Ce]};i.push(r);const a={name:"ÊàêÈáë„Ç¥„Éñ„É™„É≥",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],priorityForNPC:20,validate:s=>{if(!(s.activator.getDeckCell().cardEntities.length<1))return ke(s)},prepare:async()=>({selectedEntities:[],chainBlockTags:["Draw"],prepared:void 0}),execute:async s=>(await s.activator.draw(1,s.action.entity,s.activator),s.action.entity.field.duel.clock.incrementProcSeq(),s.activator.getOpponentPlayer().heal(1e3,s.action.entity),!0),settle:async()=>!0},Ce]};i.push(a);const n={name:"ÊâãÊú≠ÊäπÊÆ∫",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Normal",executableCells:["Hand","SpellAndTrapZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:s=>{if(!(s.activator.getDeckCell().cardEntities.length<s.activator.getHandCell().cardEntities.filter(c=>c.seq!==s.action.entity.seq).length)&&s.action.entity.field.getAllCells().filter(c=>c.cellType==="Hand").flatMap(c=>c.cardEntities).filter(c=>c.seq!==s.action.entity.seq).length!==0)return ke(s)},prepare:async()=>({selectedEntities:[],chainBlockTags:["SearchFromDeck"],prepared:void 0}),execute:async s=>{const c=s.activator.getHandCell().cardEntities.length,u=s.activator.getOpponentPlayer().getHandCell().cardEntities.length;return await pe.sendManyToGraveyardForTheSameReason(s.action.entity.field.getCells("Hand").flatMap(l=>l.cardEntities),["Effect","Discard"],s.action.entity,s.activator),s.activator.duel.clock.incrementProcSeq(),await s.action.entity.field.drawAtSameTime(s.activator,c,s.activator.getOpponentPlayer(),u,s.action.entity,s.activator),!0},settle:async()=>!0},Ce]};return i.push(n),i},Ac=(i,e,t,r,a=2,n=2,s)=>{if(!i.action.entity.origin.rank||r.length<a||r.length>n||r.some(u=>!u.lvl)||r.some(u=>u.lvl!==i.action.entity.rank)||!s(r))return;const c=r.map(u=>({material:u,level:u.status.level}));if(i.activator.getEnableSummonList(i.activator,"XyzSummon",["Rule","XyzSummon","SpecialSummon"],i.action,[{monster:i.action.entity,posList:e,cells:t}],c,!1).length)return c},xc=(i,e=2,t=2,r=a=>a.length>1)=>{const a=i.activator.getMonstersOnField().filter(s=>s.battlePosition!=="Set");if(a.length<e)return[];const n=[...i.activator.getMonsterZones(),...i.activator.getAvailableExtraZones()];return a.getAllOnOffPattern().filter(s=>s.length>=e).filter(s=>s.length<=t).map(s=>Ac(i,st,n,s,e,t,r)??[]).filter(s=>s.length)},Mc=async(i,e,t)=>{var u;const r=i.action.getEnableMaterialPatterns(i),a=r.map(l=>({infos:l,materialSeqList:l.map(o=>o.material.seq).sort()}));let n=r[0].map(l=>l.material);if(r.length>1){const l=r.flatMap(f=>f.map(p=>p.material)).getDistinct(),o=await i.action.entity.duel.view.waitSelectEntities(i.activator,l,void 0,f=>{const p=f.map(h=>h.seq).sort();return a.some(h=>p.length===h.materialSeqList.length&&p.every((m,w)=>m===h.materialSeqList[w]))},"„Ç®„ÇØ„Ç∑„Éº„Ç∫Á¥†Êùê„Å®„Åô„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",t);if(!o)return;n=o}console.log(r,n);const s=n.map(l=>l.seq).sort(),c=(u=a.find(l=>s.length===l.materialSeqList.length&&s.every((o,f)=>o===l.materialSeqList[f])))==null?void 0:u.infos;if(!c)throw new me("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",i,n);return await pe.convertManyToXyzMaterials(c.map(l=>l.material),["XyzMaterial","Rule","Cost"],i.action.entity,i.activator),{summonMaterialInfos:c}},Pc=(i=2,e=2,t=r=>r.length>1)=>({title:"„Ç®„ÇØ„Ç∑„Éº„Ç∫Âè¨Âñö",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],getEnableMaterialPatterns:r=>xc(r,i,e,t),canPayCosts:r=>r.action.getEnableMaterialPatterns(r).length>0,validate:r=>!r.ignoreCost||r.activator.getAvailableExtraZones().length+r.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:Mc,prepare:r=>ni(r,"XyzSummon",["Rule","SpecialSummon","XyzSummon"],["Attack","Defense"]),execute:si,settle:async()=>!0}),Fc=()=>{const i=[];return[{name:"„Ç∏„Çß„É†„Éä„Ç§„Éà„Éª„Éë„Éº„É´",qty:2},{name:"Ë¶öÈÜí„ÅÆÂãáÂ£´ „Ç¨„Ç¨„ÇÆ„Ç¥",qty:3}].forEach(e=>i.push({name:e.name,actions:[Fe,Re,Ue,Pc(e.qty,e.qty)],defaultSummonFilter:Zt})),i},Bc=()=>{const i=[];return i.push({name:"Ôº¢Ôº¶ÔºçÁñæÈ¢®„ÅÆ„Ç≤„Ç§„É´",actions:[Ve,Fe,Re,Ue,{title:"‚ë†ÁâπÊÆäÂè¨Âñö",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["Hand"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],validate:e=>{if(e.activator.getMonstersOnField().filter(r=>(r.status.nameTags??[]).includes("Ôº¢Ôº¶")).filter(r=>r.nm!==e.action.entity.origin.name).length)return aa(e,["Attack","Defense"],[])},prepare:e=>ni(e,"SpecialSummon",["SpecialSummon","Rule"],st),execute:si,settle:async()=>!0},{title:"‚ë°ÊîªÂÆàÂçäÊ∏õ",isMandatory:!1,playType:"IgnitionEffect",spellSpeed:"Normal",executableCells:["MonsterZone"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],hasToTargetCards:!0,isOnlyNTimesPerTurnIfFaceup:1,validate:e=>{const t=e.activator.getOpponentPlayer().getMonstersOnField().filter(r=>r.face==="FaceUp").filter(r=>r.canBeTargetOfEffect(e));if(t.length)return t.length?t:void 0},prepare:async(e,t,r)=>{var n;let a=(n=e.dest)==null?void 0:n.cardEntities[0];if(!a){const s=e.activator.getOpponentPlayer().getMonstersOnField().filter(u=>u.face==="FaceUp").filter(u=>u.canBeTargetOfEffect(e)),c=await e.action.entity.duel.view.waitSelectEntities(e.activator,s,1,u=>u.length===1,"ÂäπÊûúÂØæË±°„ÇíÈÅ∏Êäû„ÄÇ",r);if(!c||!c.length)return;a=c[0]}return{selectedEntities:[a],chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.selectedEntities.filter(r=>r.isOnFieldAsMonster).filter(r=>r.face==="FaceUp").find(r=>r.canBeEffected(e.activator,e.action.entity,e.action));if(t)return["attack","defense"].map(r=>lt.createLingeringFixation("‚ë°ÊîªÂÆàÂçäÊ∏õ",()=>!0,e.action.entity,e.action,r,(a,n,s)=>Math.round(s/2))).forEach(r=>t.numericOprsBundle.push(r)),!0},settle:async()=>!0}]}),i},Oc=()=>{const i=[];return i.push({name:"„ÉÄ„Éº„ÇØ„Éª„É™„Çæ„Éç„Éº„Çø„Éº",actions:[Fe,Re,Ue,Ve],substituteEffects:[Fo(1)]}),i},qc=()=>{const i=[];return i.push({name:"„Çπ„Çø„Éº„ÉÄ„Çπ„Éà„Éª„Éâ„É©„Ç¥„É≥",actions:[Fe,Re,Ue,Oi(),{title:"‚ë†„É¥„Ç£„ÇØ„ÉÜ„É†„Éª„Çµ„É≥„ÇØ„ÉÅ„É•„Ç¢„É™",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:jt,executableDuelistTypes:["Controller"],canPayCosts:Bo,validate:(e,t)=>t.length===0?void 0:t[e.index-1].chainBlockTags.includes("DestroyOnField")?[]:void 0,payCosts:Oo,prepare:async(e,t)=>{const r=t.slice(-1)[0];return{selectedEntities:[],chainBlockTags:e.action.calcChainBlockTagsForDestroy([r.action.entity]),prepared:void 0}},execute:async(e,t)=>{const r=t[e.index-1];return r.isNegatedActivationBy=e.action,await Xe.tryDestroy([r.action.entity],e),!0},settle:async()=>!0},{title:"‚ë°Ëá™Â∑±ÂÜçÁîü",playType:"IgnitionEffect",isMandatory:!1,spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:["end"],executableDuelistTypes:["Controller"],validate:e=>{const t=e.action.entity.moveLog.latestRecord;if(t.movedBy!==e.action.entity||!e.activator.duel.clock.isSameTurn(t.movedAt)||!t.movedAs.includes("Cost"))return;const r=e.activator.duel,a=e.action.entity.actionLogRecords.filter(s=>r.clock.isSameTurn(s.clock)).map(s=>s.chainBlockInfo).findLast(s=>s.action.title==="‚ë†„É¥„Ç£„ÇØ„ÉÜ„É†„Éª„Çµ„É≥„ÇØ„ÉÅ„É•„Ç¢„É™");return!a||a.state!=="done"?void 0:e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:zt,execute:e=>_i(e),settle:async()=>!0}],defaultSummonFilter:Zt}),i.push({name:"ÈñÉÁèñÁ´ú „Çπ„Çø„Éº„ÉÄ„Çπ„Éà",defaultSummonFilter:Zt,actions:[Fe,Re,Oi(),{title:"Ê≥¢ÂãïÈü≥Â£Å",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:["MonsterZone","ExtraMonsterZone"],executablePeriods:jt,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurnIfFaceup:1,hasToTargetCards:!0,validate:e=>{const t=e.activator.getEntiteisOnField().filter(r=>r.face==="FaceUp").filter(r=>r.canBeTargetOfEffect(e));if(t.length)return t.map(r=>r.fieldCell)},prepare:async(e,t,r)=>{if(e.dest)return{selectedEntities:e.dest.cardEntities,chainBlockTags:[],prepared:void 0};const a=e.activator.getEntiteisOnField().filter(s=>s.face==="FaceUp").filter(s=>s.canBeTargetOfEffect(e));if(!a.length)return;const n=await e.action.entity.duel.view.waitSelectEntities(e.activator,a,1,s=>s.length===1,"ÂØæË±°„Å®„Åô„Çã„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû",r);if(n)return{selectedEntities:n,chainBlockTags:[],prepared:void 0}},execute:async e=>(e.selectedEntities.filter(t=>t.isOnField).filter(t=>t.face==="FaceUp").filter(t=>t.canBeEffected(e.activator,e.action.entity,e.action)).forEach(t=>{t.counterHolder.add("SonicBarrier",1,e.action.entity)}),!0),settle:async()=>!0}],substituteEffects:[{title:"Ê≥¢ÂãïÈü≥Â£ÅÔºàÈÅ©Áî®Ôºâ",isMandatory:!0,executableCells:mi,executablePeriods:jt,executableDuelistTypes:["Controller"],isApplicableTo:(e,t,r)=>r.filter(a=>a.counterHolder.getQty("SonicBarrier",e.entity)>0),substitute:async(e,t,r)=>{const a=r.filter(n=>n.counterHolder.getQty("SonicBarrier",e.entity)>0);return a.forEach(n=>{n.counterHolder.removeAll("SonicBarrier",e.entity),e.entity.controller.writeInfoLog(`Ê≥¢ÂãïÈü≥Â£Å„Å´„Çà„Çä${n.toString()}„ÅØÔºë„Çø„Éº„É≥„Å´ÔºëÂ∫¶„Å†„ÅëÊà¶ÈóòÂäπÊûú„Åß„ÅØÁ†¥Â£ä„Åï„Çå„Å™„ÅÑ„ÄÇ`)}),a}}]}),i},Lc=()=>{const i=[];return[{name:"„É™„Éì„É≥„Ç∞„Éá„ÉÉ„Éâ„ÅÆÂëº„Å≥Â£∞",pos:"Attack",filter:()=>!0},{name:"„Ç®„É≥„Ç∏„Çß„É´„Éª„É™„Éï„Éà",pos:"Attack",filter:e=>(e.lvl??12)<3},{name:"Ê≠£Áµ±„Å™„ÇãË°ÄÁµ±",pos:"Attack",filter:e=>{var t;return(t=e.status.monsterCategories)==null?void 0:t.includes("Normal")}},{name:"Ëòá„Çä„ÅóÈ≠Ç",pos:"Defense",filter:e=>{var t;return(t=e.status.monsterCategories)==null?void 0:t.includes("Normal")}},{name:"„É™„Éü„ÉÉ„Éà„Éª„É™„Éê„Éº„Çπ",pos:"Attack",filter:e=>(e.atk??9999)<=1e3,onMonsterAfterMove:async(e,t)=>{if(!t.isOnFieldAsMonster||t.face==="FaceDown")return"RemoveMe";if(e.action.entity.isEffective&&t.battlePosition==="Defense")return e.action.entity.controller.writeInfoLog(`${t.toString()}„ÅåÂÆàÂÇôË°®Á§∫„Å´„Å™„Å£„Åü„Åü„ÇÅ„ÄÅ${e.action.entity.toString()}„Å®„Å®„ÇÇ„Å´Á†¥Â£ä„Åï„Çå„Çã„ÄÇ`),await Xe.tryMarkForDestory([t,e.action.entity],e),"RemoveMe"}}].forEach(e=>i.push({name:e.name,actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Quick",executableCells:["SpellAndTrapZone"],executablePeriods:Ye,executableDuelistTypes:["Controller"],validate:t=>{const r=t.activator.getMonsterZones();if(t.activator.getEnableSummonList(t.activator,"SpecialSummon",["Effect"],t.action,t.activator.getGraveyard().cardEntities.filter(n=>n.status.kind==="Monster").filter(e.filter).filter(n=>n.canBeTargetOfEffect(t)).map(n=>({monster:n,posList:["Attack"],cells:r})),[],!1).length)return ke(t)},prepare:t=>Yi(t,t.activator.getGraveyard().cardEntities.filter(r=>r.status.kind==="Monster").filter(e.filter).filter(r=>r.canBeTargetOfEffect(t)),["Attack"]),execute:async t=>{if(!await Xi(t,["Attack"])||!t.selectedEntities.length)return!1;t.action.entity.info.effectTargets[t.action.seq]=t.selectedEntities,t.action.entity.onBeforeMove.append(async n=>{if(n.entity.face!=="FaceUp"||!n.entity.isOnFieldAsSpellTrap)return"RemoveMe";const s=Object.values(n.entity.info.effectTargets).flatMap(l=>l),[c]=n.args;if(!s.length)return"RemoveMe";const u=s[0];return u.isOnField&&u.face==="FaceUp"&&n.entity.isEffective&&!c.isSpellTrapZoneLikeCell&&(console.log(t.action.entity.toString()),n.entity.controller.writeInfoLog(`${t.action.entity.toString()}„Åå„Éï„Ç£„Éº„É´„Éâ„ÇíÈõ¢„Çå„Åü„Åü„ÇÅ„ÄÅÂØæË±°„É¢„É≥„Çπ„Çø„Éº${u.toString()}„ÇíÁ†¥Â£ä„ÄÇ`),await Xe.tryMarkForDestory([u],t)),"RemoveMe"});const a=t.selectedEntities[0];return a.onBeforeMove.append(async n=>{if(n.entity.face!=="FaceUp"||!n.entity.isOnFieldAsMonster)return"RemoveMe";console.log(n.entity.toString(),n.entity);const[,,,,,s]=n.args;return t.action.entity.isOnField&&t.action.entity.face==="FaceUp"&&n.entity.isEffective&&s.union(["EffectDestroy","RuleDestroy"]).length&&(console.log(t.action.entity.toString()),t.activator.writeInfoLog(`${n.entity.toString()}„ÅåÁ†¥Â£ä„Åï„Çå„Åü„Åü„ÇÅ„ÄÅ${t.action.entity.toString()}„ÇíÁ†¥Â£ä„ÄÇ`),await Xe.tryMarkForDestory([a],t)),"RemoveMe"}),a.onAfterMove.append(async n=>e.onMonsterAfterMove?await e.onMonsterAfterMove(t,n):"RemoveMe"),!0},settle:async()=>!0},Ce]})),i},Nc=(i,e,t,r)=>{if(!i.action.entity.origin.link||i.action.entity.origin.link<t.length)return;let a=t.map(s=>({material:s,link:1}));if(i.action.entity.origin.link>t.length){if(t.every(u=>(u.origin.link??1)<2))return;const s=[a];t.filter(u=>(u.origin.link??1)>1).forEach(u=>{[...s].forEach(l=>{s.push([...l.filter(o=>o.material!==u),{material:u,link:u.origin.link??1}])})});const c=s.find(u=>u.reduce((l,o)=>l+o.link,0)===i.action.entity.origin.link);if(!c)return;a=c}if(!r(t)||!i.activator.getEnableSummonList(i.activator,"LinkSummon",["Rule","SpecialSummon"],i.action,[{monster:i.action.entity,posList:["Attack"],cells:e}],a,!1).length)return;if(i.activator.getAvailableExtraZones().length)return a;const n=i.activator.duel.field.getCells("ExtraMonsterZone").map(s=>s.cardEntities[0]).filter(s=>s);if(n.filter(s=>s.controller===i.activator).length>0&&n.length===t.filter(s=>s.fieldCell.cellType==="ExtraMonsterZone").length||i.activator.getMonsterZones().flatMap(s=>s.arrowheadSources).some(s=>!t.includes(s))||i.activator.duel.field.canExtraLink(i.action.entity,a))return a},Rc=(i,e=()=>!0)=>{let t=[...i.activator.getMonstersOnField().filter(a=>a.battlePosition!=="Set"),...i.activator.getHandCell().entities.filter(a=>a.origin.kind==="Monster")];if(t.every(a=>!a.status.allowHandLink)&&(t=t.filter(a=>a.fieldCell.isPlayFieldCell)),t.length<1)return[];const r=[...i.activator.getMonsterZones(),...i.activator.duel.field.getAvailableExtraMonsterZones()];return t.getAllOnOffPattern().map(a=>Nc(i,r,a,e)??[]).filter(a=>a.length)},Hc=async(i,e,t)=>{var u;const r=i.action.getEnableMaterialPatterns(i),a=r.map(l=>({infos:l,materialSeqList:l.map(o=>o.material.seq).sort()}));let n=r[0].map(l=>l.material);if(r.length>1){const l=r.flatMap(f=>f.map(p=>p.material)).getDistinct(),o=await i.action.entity.duel.view.waitSelectEntities(i.activator,l,void 0,f=>{const p=f.map(h=>h.seq).sort();return a.some(h=>p.length===h.materialSeqList.length&&p.every((m,w)=>m===h.materialSeqList[w]))},"„É™„É≥„ÇØÁ¥†Êùê„Å®„Åô„Çã„É¢„É≥„Çπ„Çø„Éº„ÇíÈÅ∏Êäû",t);if(!o)return;n=o}console.log(r,n);const s=n.map(l=>l.seq).sort(),c=(u=a.find(l=>s.length===l.materialSeqList.length&&s.every((o,f)=>o===l.materialSeqList[f])))==null?void 0:u.infos;if(!c)throw new me("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã",i,n);return await pe.sendManyToGraveyardForTheSameReason(n,["LinkMaterial","Cost","Rule","SpecialSummonMaterial"],i.action.entity,i.activator),{summonMaterialInfos:c}},Jn=(i=()=>!0)=>({title:"„É™„É≥„ÇØÂè¨Âñö",isMandatory:!1,playType:"SpecialSummon",spellSpeed:"Normal",executableCells:["ExtraDeck"],executablePeriods:["main1","main2"],executableDuelistTypes:["Controller"],getEnableMaterialPatterns:e=>Rc(e,i),canPayCosts:e=>e.action.getEnableMaterialPatterns(e).length>0,validate:e=>!e.ignoreCost||e.activator.getAvailableExtraZones().length+e.activator.getAvailableMonsterZones().length>0?[]:void 0,payCosts:Hc,prepare:e=>ni(e,"LinkSummon",["Rule","SpecialSummon","LinkSummon"],["Attack"]),execute:si,settle:async()=>!0}),$c=()=>{const i=[];return[{name:"Ôº¨Ôº°ÔºÆ„Éï„Ç©„É™„É≥„ÇØ„Çπ",validator:e=>e.length===2},{name:"„Éà„É©„Éï„Ç£„ÉÉ„ÇØ„Ç¥„Éº„Çπ„Éà",validator:e=>e.length===3},{name:"Â§©Â®Å„ÅÆÈ¨ºÁ•û",validator:e=>e.length>1&&e.some(t=>{var r;return(r=t.status.monsterCategories)==null?void 0:r.includes("Link")})},{name:"Â§©Â®Å„ÅÆÊã≥ÂÉß",validator:e=>e.every(t=>{var r,a;return((r=t.status.nameTags)==null?void 0:r.includes("Â§©Â®Å"))&&!((a=t.status.monsterCategories)!=null&&a.includes("Link"))})},{name:"ÈõªÂΩ±„ÅÆÈ®éÂ£´„Ç¨„Ç§„Ç¢„Çª„Ç§„Éê„Éº",validator:e=>e.length>1}].forEach(e=>i.push({name:e.name,actions:[Fe,Jn(e.validator)],defaultSummonFilter:Zt})),i},jc=()=>{const i=[];return i.push({name:"„Éï„Ç°„Ç§„Ç¢„Ç¶„Ç©„Éº„É´„Éª„Éâ„É©„Ç¥„É≥„Éª„Ç∑„É≥„ÇÆ„É•„É©„É™„ÉÜ„Ç£",actions:[Fe,Jn(e=>e.length>2),{title:"‚ë†„Éê„Ç¶„É≥„ÇπÔºÜËá™Â∑±Âº∑Âåñ",isMandatory:!1,playType:"QuickEffect",spellSpeed:"Quick",executableCells:ri,executablePeriods:[...Ye,...kt],executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>[...e.activator.getGraveyard().cardEntities,...e.activator.getMonstersOnField()].flatMap(n=>n.status.monsterCategories??[]).getDistinct().union(["Ritual","Fusion","Syncro","Xyz"]).length<1?void 0:[...e.activator.getOpponentPlayer().getGraveyard().cardEntities,...e.activator.getOpponentPlayer().getEntiteisOnField()].filter(n=>n.canBeTargetOfEffect(e)).length?[]:void 0,prepare:async e=>{const r=[...e.activator.getGraveyard().cardEntities,...e.activator.getMonstersOnField()].flatMap(s=>s.status.monsterCategories??[]).getDistinct().union(["Ritual","Fusion","Syncro","Xyz"]).length;if(r<1)return;const a=[...e.activator.getOpponentPlayer().getGraveyard().cardEntities,...e.activator.getOpponentPlayer().getEntiteisOnField()].filter(s=>s.canBeTargetOfEffect(e));if(a.length<1)return;const n=await e.action.entity.duel.view.waitSelectEntities(e.activator,a,void 0,s=>s.length>0&&s.length<=r,"ÊâãÊú≠„Å´Êàª„Åô„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû„ÄÇ",!1)??[];if(n.length)return{selectedEntities:n,chainBlockTags:[],prepared:void 0}},execute:async e=>{const t=e.selectedEntities.filter(a=>a.isOnField||a.fieldCell.cellType==="Graveyard").filter(a=>a.canBeEffected(e.activator,e.action.entity,e.action));await pe.returnManyToHandForTheSameReason(t,["Effect"],e.action.entity,e.activator);const r=t.filter(a=>a.fieldCell.cellType==="Hand"||a.fieldCell.cellType==="ExtraDeck").length;return e.action.entity.numericOprsBundle.push(lt.createLingeringAddition(e.action.title,a=>a.isSpawnedBy.isEffective,e.action.entity,e.action,"attack",(a,n,s)=>s+500*r)),!0},settle:async()=>!0},{title:"‚ë°ËòáÁîü",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:ri,executablePeriods:jt,executableDuelistTypes:["Controller"],isOnlyNTimesPerTurn:1,validate:e=>{const t=e.action.entity.moveLog.latestRecord.movedAt,r=e.action.duel.field.moveLog.getPriviousChainLog().filter(s=>s.entity.fieldCell.cellType==="Graveyard"||s.movedAs.includes("BattleDestroy")).filter(s=>s.movedAt.totalProcSeq>t.totalProcSeq).map(s=>s.entity.wasMovedFrom).toArray();if(e.action.duel.field.moveLog.getPriviousChainLog().forEach(s=>console.log(s.entity.toString(),s.entity.wasMovedFrom,s.entity.fieldCell,t,s.movedAt)),!e.action.entity.arrowheadDests.union(r).length)return;const a=e.activator.getMonsterZones();if(e.activator.getEnableSummonList(e.activator,"SpecialSummon",["Effect"],e.action,e.activator.getGraveyard().cardEntities.filter(s=>s.status.kind==="Monster").filter(s=>s.types.includes("Cyberse")).filter(s=>s.canBeTargetOfEffect(e)).map(s=>({monster:s,posList:st,cells:a})),[],!1).length)return ke(e)},prepare:e=>Yi(e,e.activator.getGraveyard().cardEntities.filter(t=>t.status.kind==="Monster").filter(t=>t.types.includes("Cyberse")).filter(t=>t.canBeTargetOfEffect(e)),st),execute:async e=>Xi(e,st),settle:async()=>!0}],defaultSummonFilter:Zt}),i},Zc=()=>{const i=[];return i.push({name:"„Éâ„ÉÉ„Éà„Çπ„Ç±„Éº„Éë„Éº",actions:[Fe,Re,Ue,{title:"‚ë†Ëá™Â∑±ÂÜçÁîü",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Graveyard"],executablePeriods:[...Ye,...kt],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:1,actionGroupNamePerTurn:"„Éâ„ÉÉ„Éà„Çπ„Ç±„Éº„Éë„Éº",validate:e=>{if(e.action.entity.wasMovedAtPreviousChain)return e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:e=>_i(e),settle:async()=>!0},{title:"‚ë°Ëá™Â∑±Â∏∞ÈÇÑ",isMandatory:!1,playType:"TriggerEffect",spellSpeed:"Normal",executableCells:["Banished"],executablePeriods:[...Ye,...kt],executableDuelistTypes:["Controller"],isOnlyNTimesPerDuel:1,actionGroupNamePerTurn:"„Éâ„ÉÉ„Éà„Çπ„Ç±„Éº„Éë„Éº",validate:e=>{if(e.action.entity.wasMovedAtPreviousChain)return e.activator.getAvailableMonsterZones().length>0?[]:void 0},prepare:async()=>({selectedEntities:[],chainBlockTags:["SpecialSummonFromGraveyard"],prepared:void 0}),execute:e=>_i(e),settle:async()=>!0}]}),i},Uc=()=>{const i=[];return i.push({name:"ÊòáÂ§©„ÅÆÈªíËßíÁ¨õ",actions:[{title:"Áô∫Âãï",isMandatory:!1,playType:"CardActivation",spellSpeed:"Counter",executableCells:["SpellAndTrapZone"],executablePeriods:jt,executableDuelistTypes:["Controller"],negateSummon:!0,validate:e=>{if(e.targetChainBlock&&e.targetChainBlock.action.playType==="SpecialSummon"&&e.targetChainBlock.activator!==e.activator&&e.activator.duel.field.getPendingMonstersOnField().length===1)return ke(e)},prepare:async()=>({selectedEntities:[],chainBlockTags:["NegateSpecialSummon"],prepared:void 0}),execute:async e=>{const t=Xe.negateSummonMany(e.action.entity,e.activator);return await Xe.tryDestroy(t,e),!0},settle:async()=>!0},Ce]}),i},Gc=()=>{const i=[...Io(),...nc(),...pc(),...rc(),...dc(),...Sc(),...hc(),...gc(),...yc(),...mc(),..._c(),...kc(),...Bc(),...Ec(),...Tc(),...Lc(),...Dc(),...Fc(),...Oc(),...qc(),...$c(),...jc(),...Zc(),...Uc()],e=i.map(r=>r.name);console.info(e);const t=Object.values(Object.groupBy(e,r=>r)).filter(r=>((r==null?void 0:r.length)??2)>1).map(r=>r==null?void 0:r[0]);if(t.length>0)throw new me("„Ç´„Éº„ÉâÂÆöÁæ©ÈáçË§á",...t);return i},In=new Map;Gc().forEach(i=>{In.set(i.name,i)});const oa=In,zc=ss,tt=Object.values(zc).reduce((i,e)=>(i[e.name]=e,i),{}),es=[{id:-1,name:"„Çµ„É≥„Éó„É´„Éá„ÉÉ„Ç≠Ôºë",description:"",cardNames:["„Ç¢„É≥„Éé„Ç¶„É≥„Éª„Ç∑„É≥„ÇØ„É≠„É≥","ÂÖ≠Ê≠¶Ë°Ü„ÅÆ„ÅîÈö†Â±Ö","„Ç∏„É£„É≥„ÇØ„Éª„Éï„Ç©„Ç¢„Éº„Éâ","„Ç∏„É£„É≥„ÇØ„Éª„Éï„Ç©„Ç¢„Éº„Éâ","„Ç∏„É£„É≥„ÇØ„Éª„Éï„Ç©„Ç¢„Éº„Éâ","„ÉÅ„É•„Éº„É≥„Éª„Ç¶„Ç©„É™„Ç¢„Éº","„ÉÅ„É•„Éº„É≥„Éª„Ç¶„Ç©„É™„Ç¢„Éº","„Ç¨„Éº„Éâ„Éª„Ç™„Éñ„Éª„Éï„É¨„É†„Éô„É´","„Ç¨„Éº„Éâ„Éª„Ç™„Éñ„Éª„Éï„É¨„É†„Éô„É´","ÂÆàË≠∑Á´ú„É¶„Çπ„ÉÜ„Ç£„Ç¢","ÂÆàË≠∑Á´ú„É¶„Çπ„ÉÜ„Ç£„Ç¢","„Ç®„É≥„Ç∏„Çß„É´„Éª„Éà„É©„É≥„Éö„ÉÉ„Çø„Éº","„Ç®„É≥„Ç∏„Çß„É´„Éª„Éà„É©„É≥„Éö„ÉÉ„Çø„Éº","„Ç∏„Çß„É†„Éä„Ç§„Éà„Éª„Çµ„Éï„Ç£„Ç¢","„Ç∏„Çß„É†„Éä„Ç§„Éà„Éª„Çµ„Éï„Ç£„Ç¢","È≠ÇËôé","È≠ÇËôé","ÊöóÈªíÁïå„ÅÆÁï™ÂÖµ „É¨„É≥„Ç∏","ÊöóÈªíÁïå„ÅÆÁï™ÂÖµ „É¨„É≥„Ç∏","„Éê„Éà„É´„Éï„ÉÉ„Éà„Éú„Éº„É©„Éº","„Éê„Éà„É´„Éï„ÉÉ„Éà„Éú„Éº„É©„Éº","ÁêÉÈ®éÂ£´„ÅÆ‰∏â‰∫∫Â®ò","ÁêÉÈ®éÂ£´„ÅÆ‰∏â‰∫∫Â®ò","„Ç®„É≥„Ç∏„Çß„É´„Éª„Éà„É©„É≥„Éö„ÉÉ„Çø„Éº","„Ç®„É≥„Ç∏„Çß„É´„Éª„Éà„É©„É≥„Éö„ÉÉ„Çø„Éº","ÔºßÊà¶Èöä „Ç∑„É£„Ç§„É≥„Éñ„É©„ÉÉ„ÇØ","ÔºßÊà¶Èöä „Ç∑„É£„Ç§„É≥„Éñ„É©„ÉÉ„ÇØ","„Åó„ÇÉ„Çä„ÅÆËªçË≤´","„Åó„ÇÉ„Çä„ÅÆËªçË≤´","„Ç∏„Éß„É≥„Ç∞„É´„Ç∞„Éº„É´„ÅÆÂπªË°ìÂ∏´","„Ç∏„Éß„É≥„Ç∞„É´„Ç∞„Éº„É´„ÅÆÂπªË°ìÂ∏´","„Çæ„É≥„Éì„Éº„Éé","„Çæ„É≥„Éì„Éº„Éé","„É°„Ç¨„É≠„Çπ„Éû„ÉÉ„Ç∑„É£„ÉºÔº∏","„É°„Ç¨„É≠„Çπ„Éû„ÉÉ„Ç∑„É£„ÉºÔº∏","„É©„Ç§„Éâ„É≠„É≥","„É©„Ç§„Éâ„É≠„É≥","Ê©üÁïåÈ®éÂ£´„Ç¢„É¥„É©„É†","Ê©üÁïåÈ®éÂ£´„Ç¢„É¥„É©„É†","Âπª„ÅÆ„Ç∞„É™„Éï„Ç©„É≥","Âπª„ÅÆ„Ç∞„É™„Éï„Ç©„É≥","ÂπªÊÆªÁ´ú","ÂπªÊÆªÁ´ú","„Ç¢„É¨„Ç≠„Çµ„É≥„Éâ„É©„Ç§„Éâ„É©„Ç¥„É≥","„Ç¢„É¨„Ç≠„Çµ„É≥„Éâ„É©„Ç§„Éâ„É©„Ç¥„É≥","„Ç∏„Çß„Éç„ÉÜ„Ç£„ÉÉ„ÇØ„Éª„ÉØ„Éº„Ç¶„É´„Éï","„Ç∏„Çß„Éç„ÉÜ„Ç£„ÉÉ„ÇØ„Éª„ÉØ„Éº„Ç¶„É´„Éï","„Çµ„Ç§„Éê„Éº„Éª„Éâ„É©„Ç¥„É≥","„Éï„É≠„Çπ„Éà„Ç∂„Ç¶„É´„Çπ","„Éï„É≠„Çπ„Éà„Ç∂„Ç¶„É´„Çπ","„Éï„É≠„Çπ„Éà„Ç∂„Ç¶„É´„Çπ","ÈùíÁúº„ÅÆÁôΩÈæç","„Éû„Ç∏„Ç´„É´„Éª„Ç¢„É≥„Éâ„É≠„Ç§„Éâ","„Éû„Ç∏„Ç´„É´„Éª„Ç¢„É≥„Éâ„É≠„Ç§„Éâ","„Éû„Ç∏„Ç´„É´„Éª„Ç¢„É≥„Éâ„É≠„Ç§„Éâ","Â§ßÂú∞„ÅÆÈ®éÂ£´„Ç¨„Ç§„Ç¢„Éä„Ç§„Éà","Â§ßÂú∞„ÅÆÈ®éÂ£´„Ç¨„Ç§„Ç¢„Éä„Ç§„Éà","Â§ßÂú∞„ÅÆÈ®éÂ£´„Ç¨„Ç§„Ç¢„Éä„Ç§„Éà","„Çπ„ÇØ„É©„ÉÉ„Éó„Éª„Éá„Çπ„Éá„Éº„É¢„É≥","„Çπ„ÇØ„É©„ÉÉ„Éó„Éª„Éá„Çπ„Éá„Éº„É¢„É≥","„Çπ„ÇØ„É©„ÉÉ„Éó„Éª„Éá„Çπ„Éá„Éº„É¢„É≥","„Çπ„Çø„Éº„ÉÄ„Çπ„Éà„Éª„Éâ„É©„Ç¥„É≥","„Çπ„Çø„Éº„ÉÄ„Çπ„Éà„Éª„Éâ„É©„Ç¥„É≥","„Çπ„Çø„Éº„ÉÄ„Çπ„Éà„Éª„Éâ„É©„Ç¥„É≥","„Éä„ÉÅ„É•„É´„Éª„Ç¨„Ç™„Éâ„É¨„Ç§„ÇØ","„Éä„ÉÅ„É•„É´„Éª„Ç¨„Ç™„Éâ„É¨„Ç§„ÇØ","„Éä„ÉÅ„É•„É´„Éª„Ç¨„Ç™„Éâ„É¨„Ç§„ÇØ"]},{id:-2,name:"„Çµ„É≥„Éó„É´„Éá„ÉÉ„Ç≠Ôºí",description:"",cardNames:["„Ç¢„É≥„Éé„Ç¶„É≥„Éª„Ç∑„É≥„ÇØ„É≠„É≥","ÂÖ≠Ê≠¶Ë°Ü„ÅÆ„ÅîÈö†Â±Ö","„Ç∏„É£„É≥„ÇØ„Éª„Éï„Ç©„Ç¢„Éº„Éâ","„Ç∞„É≠„Éº„Ç¢„ÉÉ„Éó„Éª„Éê„É´„Éñ","„Ç¨„Éº„Éâ„Éª„Ç™„Éñ„Éª„Éï„É¨„É†„Éô„É´","‰ºùË™¨„ÅÆÁôΩÁü≥","‰ºùË™¨„ÅÆÁôΩÁü≥","‰ºùË™¨„ÅÆÁôΩÁü≥","ÂÆàË≠∑Á´ú„É¶„Çπ„ÉÜ„Ç£„Ç¢","„ÇÆ„É£„É©„ÇØ„Ç∑„Éº„Çµ„Éº„Éö„É≥„Éà","„Ç∏„Çß„Éç„ÇØ„Çπ„Éª„Ç≥„É≥„Éà„É≠„Éº„É©„Éº","Ôº•„ÉªÔº®Ôº•Ôº≤ÔºØ „Éï„Çß„Ç∂„Éº„Éû„É≥","Ôº•„ÉªÔº®Ôº•Ôº≤ÔºØ „Éê„Éº„Çπ„Éà„É¨„Éá„Ç£","„ÉÅ„É•„Éº„É≥„Éª„Ç¶„Ç©„É™„Ç¢„Éº","Ôº•„ÉªÔº®Ôº•Ôº≤ÔºØ „ÇØ„É¨„Ç§„Éû„É≥","Ôº•„ÉªÔº®Ôº•Ôº≤ÔºØ „Çπ„Éë„Éº„ÇØ„Éû„É≥","„Åó„ÇÉ„Çä„ÅÆËªçË≤´","„Ç∏„Éß„É≥„Ç∞„É´„Ç∞„Éº„É´„ÅÆÂπªË°ìÂ∏´","„Çæ„É≥„Éì„Éº„Éé","„Ç∏„Çß„Éç„ÉÜ„Ç£„ÉÉ„ÇØ„Éª„ÉØ„Éº„Ç¶„É´„Éï","„É©„Ç§„Éà„É≠„Éº„Éâ„Éª„Éì„Éº„Çπ„Éà „Ç¶„Ç©„É´„Éï","„Çµ„Ç§„Éê„Éº„Éª„Éâ„É©„Ç¥„É≥","„Çµ„Ç§„Éê„Éº„Éª„Éâ„É©„Ç¥„É≥","„Çµ„Ç§„Éê„Éº„Éª„Éâ„É©„Ç¥„É≥","„É©„Éñ„É©„Éâ„É©„Ç§„Éâ„É©„Ç¥„É≥","Ôº§ÔºçÔº®Ôº•Ôº≤ÔºØ „Éá„Ç£„Ç¢„Éú„É™„ÉÉ„ÇØ„Ç¨„Ç§","Ôº§ÔºçÔº®Ôº•Ôº≤ÔºØ „Éá„Ç£„Ç¢„Éú„É™„ÉÉ„ÇØ„Ç¨„Ç§","Ôº§ÔºçÔº®Ôº•Ôº≤ÔºØ „Éá„Ç£„Ç¢„Éú„É™„ÉÉ„ÇØ„Ç¨„Ç§","„Éï„É≠„Çπ„Éà„Ç∂„Ç¶„É´„Çπ","Ôº•„ÉªÔº®Ôº•Ôº≤ÔºØ „Éç„Ç™„Çπ","ÈùíÁúº„ÅÆÁôΩÈæç","ÈùíÁúº„ÅÆÁôΩÈæç","ÈùíÁúº„ÅÆÁôΩÈæç","Ôº•Ôºç„Ç®„Éû„Éº„Ç∏„Çß„É≥„Ç∑„Éº„Ç≥„Éº„É´","„Åä„Çç„Åã„Å™ÂüãËë¨","„Éà„É¨„Éº„Éâ„Éª„Ç§„É≥","„Éà„É¨„Éº„Éâ„Éª„Ç§„É≥","„Éà„É¨„Éº„Éâ„Éª„Ç§„É≥","Èóá„ÅÆÈáèÁî£Â∑•Â†¥","Âº∑Ê¨≤„Å™Â£∫","Âº∑Ê¨≤„Å™Â£∫","Âº∑Ê¨≤„Å™Â£∫","Ê≠ªËÄÖËòáÁîü","Ê≠ªËÄÖËòáÁîü","Ê≠ªËÄÖËòáÁîü","Âè¨ÂñöÂ∏´„ÅÆ„Çπ„Ç≠„É´","Âè¨ÂñöÂ∏´„ÅÆ„Çπ„Ç≠„É´","Âè¨ÂñöÂ∏´„ÅÆ„Çπ„Ç≠„É´","ÊàêÈáë„Ç¥„Éñ„É™„É≥","ÊàêÈáë„Ç¥„Éñ„É™„É≥","ÊàêÈáë„Ç¥„Éñ„É™„É≥","Êà¶Â£´„ÅÆÁîüÈÇÑ","Â¢óÊè¥","Ë™øÂíå„ÅÆÂÆùÊú≠","Ë™øÂíå„ÅÆÂÆùÊú≠","Ë™øÂíå„ÅÆÂÆùÊú≠","Â§©‰Ωø„ÅÆÊñΩ„Åó","Â§©‰Ωø„ÅÆÊñΩ„Åó","Â§©‰Ωø„ÅÆÊñΩ„Åó","Ë≤™Ê¨≤„Å™Â£∫","Ë≤™Ê¨≤„Å™Â£∫","Ë≤™Ê¨≤„Å™Â£∫","„Éû„Ç∏„Ç´„É´„Éª„Ç¢„É≥„Éâ„É≠„Ç§„Éâ","„Éû„Ç∏„Ç´„É´„Éª„Ç¢„É≥„Éâ„É≠„Ç§„Éâ","„Éû„Ç∏„Ç´„É´„Éª„Ç¢„É≥„Éâ„É≠„Ç§„Éâ","Â§ßÂú∞„ÅÆÈ®éÂ£´„Ç¨„Ç§„Ç¢„Éä„Ç§„Éà","Â§ßÂú∞„ÅÆÈ®éÂ£´„Ç¨„Ç§„Ç¢„Éä„Ç§„Éà","Â§ßÂú∞„ÅÆÈ®éÂ£´„Ç¨„Ç§„Ç¢„Éä„Ç§„Éà","„Çπ„ÇØ„É©„ÉÉ„Éó„Éª„Éá„Çπ„Éá„Éº„É¢„É≥","„Çπ„ÇØ„É©„ÉÉ„Éó„Éª„Éá„Çπ„Éá„Éº„É¢„É≥","„Çπ„ÇØ„É©„ÉÉ„Éó„Éª„Éá„Çπ„Éá„Éº„É¢„É≥","„Çπ„Çø„Éº„ÉÄ„Çπ„Éà„Éª„Éâ„É©„Ç¥„É≥","„Çπ„Çø„Éº„ÉÄ„Çπ„Éà„Éª„Éâ„É©„Ç¥„É≥","„Çπ„Çø„Éº„ÉÄ„Çπ„Éà„Éª„Éâ„É©„Ç¥„É≥","„Éä„ÉÅ„É•„É´„Éª„Ç¨„Ç™„Éâ„É¨„Ç§„ÇØ","„Éä„ÉÅ„É•„É´„Éª„Ç¨„Ç™„Éâ„É¨„Ç§„ÇØ","„Éä„ÉÅ„É•„É´„Éª„Ç¨„Ç™„Éâ„É¨„Ç§„ÇØ"]}],he=class he{constructor(e,t){d(this,"id");d(this,"name");d(this,"description");d(this,"lastUsedAt");d(this,"cardNames");d(this,"getIllegalCardNames",()=>Array.from(new Set(this.cardNames.filter(e=>!Object.keys(tt).includes(e)))));d(this,"getDisableCardNames",()=>Array.from(new Set(this.cardNames.filter(e=>!Object.keys(tt).includes(e)))));d(this,"createCardInfos",()=>{const e=this.getIllegalCardNames();if(e.length>0)throw new Error(`Â≠òÂú®„Åó„Å™„ÅÑ„Ç´„Éº„ÉâÂêç„Åã„Çâ„Éá„ÉÉ„Ç≠„ÇíÁîüÊàê„Åó„Çà„ÅÜ„Å®„Åó„Åü„ÄÇ${e}`);return this.cardNames.map(t=>tt==null?void 0:tt[t]).filter(t=>t)});d(this,"copy",async()=>he.createNewDeck(this.name,this.description,this.cardNames));d(this,"updateTimestamp",async()=>{await he.tblHeader.update(this.id,e=>({...e,lastUsedAt:new Date}))});d(this,"saveDeckInfo",async e=>{const t=e??this;await he.tblHeader.update(this.id,n=>({...n,name:t.name,description:t.description,lastUsedAt:new Date}));const r=(await he.tblDetail.getAll()).filter(n=>n.deckId===this.id);await he.tblDetail.delete(r.map(n=>n.id));const a=await he.tblDetail.insertMany(t.cardNames.map((n,s)=>({deckId:this.id,seq:s,name:n,description:""})));return new he(await he.tblHeader.get(this.id),a)});d(this,"delete",async()=>{await he.tblHeader.delete([this.id]);const e=(await he.tblDetail.getAll()).filter(t=>t.deckId===this.id);await he.tblDetail.delete(e.map(t=>t.id))});this.id=e.id,this.name=e.name,this.description=e.description,this.lastUsedAt=e.lastUsedAt,this.cardNames=t.filter(r=>r.deckId===this.id).map(r=>r.name)}};d(he,"toJson",e=>{const t=e.map(r=>{const{id:a,name:n,description:s,lastUsedAt:c,cardNames:u}=r;return{id:a,name:n,description:s,lastUsedAt:c,cardNames:u}});return t.forEach(r=>{r.cardNames=r.cardNames.map(a=>tt[a]).sort(Fi).map(a=>a.name)}),JSON.stringify(t,null,2)}),d(he,"convertToObjectURL",e=>{const t=he.toJson(e),r=new Blob([t],{type:"text/plain"});return window.URL.createObjectURL(r)}),d(he,"idb"),d(he,"tblHeader"),d(he,"tblDetail"),d(he,"getAllDeckInfo",async e=>{if(e&&(he.idb=e),!he.idb)throw new Error("illegal argument: idb is undefined.");he.tblHeader||(he.tblHeader=new Vc(he.idb)),he.tblDetail||(he.tblDetail=new Wc(he.idb));const t=await he.tblHeader.getAll(),r=await he.tblDetail.getAll();return t.length?t.map(a=>new he(a,r)):[await he.prepareSampleDeck()]}),d(he,"createNewDeck",async(e,t,r)=>{const a=await he.tblHeader.insert({name:e,description:t,lastUsedAt:new Date}),n=await he.tblDetail.insertMany(r.map((s,c)=>({deckId:a.id,seq:c,name:s,description:""})));return new he(a,n)}),d(he,"prepareSampleDeck",async()=>{const e=es.slice(-1)[0];return await he.createNewDeck(e.name,e.description,e.cardNames)});let wt=he;class Vc extends ba{constructor(t){super(t,"TblDeckHeader");d(this,"_prepareInitialRecords",()=>[])}}class Wc extends ba{constructor(t){super(t,"TblDeckDetail");d(this,"_prepareInitialRecords",()=>[])}}const Qa=es.map(i=>({...i,lastUsedAt:new Date})).filter(i=>i.id<0);function Yc(i){const e=i-1;return e*e*e+1}function Ja(i,e){for(const t in e)i[t]=e[t];return i}function Xc({fallback:i,...e}){const t=new Map,r=new Map;function a(s,c,u){const{delay:l=0,duration:o=D=>Math.sqrt(D)*30,easing:f=Yc}=Ja(Ja({},e),u),p=s.getBoundingClientRect(),h=c.getBoundingClientRect(),m=p.left-h.left,w=p.top-h.top,y=p.width/h.width,S=p.height/h.height,T=Math.sqrt(m*m+w*w),P=getComputedStyle(c),O=P.transform==="none"?"":P.transform,k=+P.opacity;return{delay:l,duration:typeof o=="function"?o(T):o,easing:f,css:(D,L)=>`
			   opacity: ${D*k};
			   transform-origin: top left;
			   transform: ${O} translate(${L*m}px,${L*w}px) scale(${D+(1-D)*y}, ${D+(1-D)*S});
		   `}}function n(s,c,u){return(l,o)=>(s.set(o.key,l),()=>{if(c.has(o.key)){const f=c.get(o.key);return c.delete(o.key),a(f,l,o)}return s.delete(o.key),i&&i(l,o,u)})}return[n(r,t,!1),n(t,r,!0)]}var Kc=C("<div></div>"),Qc=C('<div class="duel_card_row svelte-1vsjnqs"><div> </div> <div> </div></div>'),Jc=C('<div class="duel_card_row svelte-1vsjnqs"><div class="svelte-1vsjnqs"></div> <div class="svelte-1vsjnqs"> </div></div>'),Ic=C('<div class="duel_card_row svelte-1vsjnqs"><div class="svelte-1vsjnqs"></div> <div class="svelte-1vsjnqs"> </div></div>'),ed=C('<div class="duel_card_row svelte-1vsjnqs"><div> </div> <div> </div></div>'),td=C('<div class="duel_card_row duel_card_detail svelte-1vsjnqs"><div class="svelte-1vsjnqs"> </div></div> <div class="duel_card_row duel_card_detail svelte-1vsjnqs"><div class="svelte-1vsjnqs"></div> <div class="svelte-1vsjnqs"><span> </span> / <span> </span></div></div>',1),id=C('<button><div class="duel_card duel_card_visible svelte-1vsjnqs"><div class="duel_card_row svelte-1vsjnqs" style="position:relative"><div class="svelte-1vsjnqs"> </div> <div class="svelte-1vsjnqs"></div> <!></div> <!> <!> <!></div></button>'),rd=C('<button><div class="svelte-1vsjnqs">Ë£èÂÆàÂÇô</div></button>'),ad=C('<div class="duel_card duel_card_face_down svelte-1vsjnqs"><div class="svelte-1vsjnqs">„Çª„ÉÉ„Éà</div></div>');function At(i,e){Ke(e,!1);let t=xe(e,"entity",8),r=xe(e,"state",8,"Disabled"),a=xe(e,"selectedList",28,()=>[]),n=xe(e,"isVisibleForcibly",8,!1),s=xe(e,"isWideMode",8,!1),c=xe(e,"actions",24,()=>[]),u=xe(e,"cardActionResolve",8),l=xe(e,"entitySelectResolve",8,()=>{}),o,f=Le(!1),p=()=>{},h=xe(e,"qty",12,void 0);const m=j=>{o=j.activator,K(f,!1),h(j.qty),p=j.resolve};t().field.duel.view.onWaitStart.append(m);let w=Le(!1);const y=()=>{if(r()!=="Disabled"&&r()==="Selectable"&&h()===1){if(a().some(j=>j.seq!==t().seq)){a([t()]);return}h()===1&&l()&&l()([t()])}},S=j=>{(t().face==="FaceUp"||t().owner===t().field.duel.duelists.Below&&(t().isUnderControl||n()))&&t().field.duel.view.showCardInfo(t(),j??"Normal")},T=()=>{if(S(),r()==="Disabled")return;if(r()==="Selectable"){K(f,!v(f)),h()===1&&(a().splice(0),t().duel.view.requireUpdate()),a(v(f)?[...a(),t()]:a().filter(Y=>Y!==t()));return}if(c().length===0)return;if(c().length===1){if(c()[0].dragAndDropOnly)return;if(u()){u()(c()[0]);return}p({action:c()[0]});return}if(!o)return;const j=t().field.duel.view;j.modalController.selectAction(j,{title:"Ë°åÂãï„ÇíÈÅ∏Êäû„ÄÇ",activator:o,actions:c(),cancelable:!0}).then(Y=>{p({action:Y})})},P=j=>{console.info("drag start",j,c()),t().field.duel.view.setDraggingActions(c()),K(w,!0)},O=j=>{console.info("drag end",j,c()),t().field.duel.view.removeDraggingActions(),j.dataTransfer&&K(w,!1)},k=()=>(S("Debug"),!1);ot();var D=Be(),L=le(D);{var M=j=>{var Y=id(),_e=g(Y),Pe=g(_e),J=g(Pe),F=g(J),G=_(J,4);ue(G,1,()=>t().attr,de,(R,V)=>{var X=Kc();A(()=>ye(X,`monster_attr ${v(V)??""} svelte-1vsjnqs`)),b(R,X)});var oe=_(Pe,2);{var x=R=>{var V=Qc(),X=g(V),I=g(X),ee=_(X,2),ne=g(ee);A((ie,re)=>{ye(X,di(t().lvl!==t().origin.level?"different_from_its_origin":""),"svelte-1vsjnqs"),E(I,ie),ye(ee,di(t().rank!==t().origin.rank?"different_from_its_origin":""),"svelte-1vsjnqs"),E(ne,re)},[()=>"‚òÖ".repeat(t().lvl||0),()=>"‚òÜ".repeat(t().rank||0)],Se),b(R,V)},U=R=>{var V=Be(),X=le(V);{var I=ne=>{var ie=Jc(),re=_(g(ie),2),N=g(re);A(()=>E(N,`${zi[t().status.spellCategory]??""}È≠îÊ≥ï`)),b(ne,ie)},ee=ne=>{var ie=Be(),re=le(ie);{var N=$=>{var fe=Ic(),te=_(g(fe),2),ve=g(te);A(()=>E(ve,`${Vi[t().status.trapCategory]??""}ÁΩ†`)),b($,fe)};H(re,$=>{t().status.kind==="Trap"&&t().status.trapCategory&&$(N)},!0)}b(ne,ie)};H(X,ne=>{t().status.kind==="Spell"&&t().status.spellCategory?ne(I):ne(ee,!1)},!0)}b(R,V)};H(oe,R=>{t().status.kind==="Monster"?R(x):R(U,!1)})}var ae=_(oe,2);{var Z=R=>{var V=ed(),X=g(V),I=g(X),ee=_(X,2),ne=g(ee);A(()=>{ye(X,di(t().psL!==t().origin.pendulumScaleL?"different_from_its_origin":""),"svelte-1vsjnqs"),E(I,`‚óÄ ${t().psL??""}`),ye(ee,di(t().psR!==t().origin.pendulumScaleR?"different_from_its_origin":""),"svelte-1vsjnqs"),E(ne,`${t().psR??""} ‚ñ∂`)}),b(R,V)};H(ae,R=>{var V;(V=t().status.monsterCategories)!=null&&V.includes("Pendulum")&&R(Z)})}var z=_(ae,2);{var W=R=>{var V=td(),X=le(V),I=g(X),ee=g(I),ne=_(X,2),ie=_(g(ne),2),re=g(ie),N=g(re),$=_(re,2),fe=g($);A((te,ve)=>{E(ee,`${te??""}
            ${ve??""}`),ye(re,di(t().atk!==t().origin.attack?"different_from_its_origin":""),"svelte-1vsjnqs"),E(N,t().atk??"?"),ye($,di(t().def!==t().origin.defense?"different_from_its_origin":""),"svelte-1vsjnqs"),E(fe,t().def??"?")},[()=>t().types.map(te=>Wi[te]+(s()?Mr[te]:"")).join(),()=>{var te;return(te=t().status.monsterCategories)==null?void 0:te.map(ve=>Gi[ve]+(s()?xr[ve]:"")).join()}],Se),b(R,V)};H(z,R=>{t().status.kind==="Monster"&&R(W)})}A(R=>{ye(Y,`duel_card button_style_reset ${t().status.kind??""} ${R??""} ${(v(f)?"duel_card_selected":"")??""} ${r()??""} duel_card_${t().orientation??""} ${(v(w)?"isDragging":"")??""} ${(s()?"duel_card_wide":"")??""} duel_card_${t().face??""} ${(t().isOnField?"duel_card_is_on_field":"")??""} svelte-1vsjnqs`),Ft(Y,"draggable",r()==="Draggable"),Ft(Y,"title",t().nm),E(F,t().nm)},[()=>{var R;return((R=t().status.monsterCategories)==null?void 0:R.join(" "))||""}],Se),je("dragstart",Y,P),je("dragend",Y,O),je("click",Y,T),je("dblclick",Y,y),je("mouseenter",Y,()=>S()),je("contextmenu",Y,k),b(j,Y)},Q=j=>{var Y=Be(),_e=le(Y);{var Pe=F=>{var G=rd();A(()=>ye(G,`duel_card duel_card_face_down duel_card_face_down_defense ${r()??""}  ${(v(f)?"duel_card_selected":"")??""} svelte-1vsjnqs`)),je("click",G,T),je("dblclick",G,y),b(F,G)},J=F=>{var G=ad();b(F,G)};H(_e,F=>{t().battlePosition==="Set"?F(Pe):F(J,!1)},!0)}b(j,Y)};H(L,j=>{t().face==="FaceUp"||n()||t().controller.duelistType==="Player"&&t().isUnderControl?j(M):j(Q,!1)})}b(i,D),Qe()}var nd=C('<div class="phase_display svelte-rtvlgx"><span class="svelte-rtvlgx"> </span> </div>'),sd=C('<div class="lifepoint_display svelte-rtvlgx"><div class="svelte-rtvlgx"> </div> <div class="svelte-rtvlgx"> </div></div>'),ld=(i,e,t)=>e(v(t)),od=C('<div class="svelte-rtvlgx"><button class="phase_button svelte-rtvlgx"> </button></div>'),cd=C("<div><!></div>"),dd=C('<div class="svelte-rtvlgx"><!></div>'),ud=C("<div><!></div>"),fd=C("<!> <!> <!>",1),vd=C('<div style="position: absolute;" class="card_animation_receiver svelte-rtvlgx"><!></div>'),pd=C('<div style="position: absolute; top:0rem" class="svelte-rtvlgx">ÔΩõÂäπÊûúÂØæË±°ÔΩù</div>'),hd=C('<!> <div style="position: absolute; display:flex;justify-content: center;" class="svelte-rtvlgx"><!></div>',1),gd=C(" <!> „Äë",1),yd=C('<div style="position: absolute; bottom:0rem" class="svelte-rtvlgx"> <!></div>'),md=C("<!> <!>",1),_d=C('<div class="badge svelte-rtvlgx"> </div>'),Sd=C('<div class="card_animation_receiver svelte-rtvlgx"><!></div>'),bd=C("<!> <!> <!> <!>",1),wd=C('<td><div role="listitem"><!></div></td>');function Cd(i,e){Ke(e,!1);let t=xe(e,"view",8),r=xe(e,"row",8),a=xe(e,"column",8),n=xe(e,"selectedList",28,()=>[]),s=Le(t().getCell(r(),a()));const c=()=>{K(s,t().getCell(r(),a()))};v(s).onUpdate.append(c),t().onDuelUpdate.append(c),t().modalController.onUpdate.append(c);let u,l=Le([]),o=()=>{},f,p=Le([]);const h=x=>{K(k,void 0),n().reset(),u=x.activator,o=x.resolve,K(l,x.enableActions),K(p,x.chainBlockInfos.flatMap(U=>U.selectedEntities).getDistinct()),f=x.selectableEntities,x.entitiesValidator};t().onWaitStart.append(h);const m=()=>{u=void 0,K(l,[]),o=()=>{},f=[],K(p,[])};t().onWaitEnd.append(m);let w,y=Le(!1);const S=x=>{w=x,K(y,x.some(U=>{var ae;return(ae=U.validate(t().duel.priorityHolder,t().duel.chainBlockInfos,!1))==null?void 0:ae.includes(v(s))})||!1),c()},T=()=>{w=void 0,K(y,!1),c()};t().onDragStart.append(S),t().onDragEnd.append(T);const[P,O]=xu;let k=Le(void 0);const D=x=>{if(u=void 0,v(s)===x.to||v(s).entities.includes(x.entity)){K(k,x);const U=x.resolve;K(s,v(s)),setTimeout(()=>{K(k,void 0),x.count++,x.count>1&&U()},600)}};t().onAnimation.append(D);const L=x=>{o({phaseChange:x})},M=()=>v(s).isStackCell&&v(s).entities.flatMap(x=>x.actions).filter(x=>v(l).map(U=>U.seq).some(U=>U===x.seq)).length>0,Q=()=>{if($e(s,v(s).field.duel.view.infoBoardState="Log"),v(s).isStackCell){$e(s,v(s).field.duel.view.infoBoardState="CellInfo"),$e(s,v(s).field.duel.view.infoBoardCell=v(s)),v(s).field.duel.view.requireUpdate();const x=v(s).entities.flatMap(U=>U.actions).filter(U=>v(l).map(ae=>ae.seq).some(ae=>ae===U.seq));if(x.length){if(!u)return;const U=v(s).field.duel.view;U.modalController.selectAction(U,{title:"„Ç´„Éº„Éâ„ÇíÈÅ∏Êäû„ÄÇ",activator:u,actions:x,cancelable:!0}).then(ae=>{o({action:ae})});return}}v(s).field.duel.view.requireUpdate(),console.info(v(s))},j=x=>{x.preventDefault(),x.dataTransfer&&(x.dataTransfer.dropEffect="move")},Y=x=>{x.preventDefault(),console.info("drop",x,v(y),w),x.dataTransfer&&(x.dataTransfer.dropEffect="move");try{if(v(y)&&w){if(console.info(w,v(s)),w.length===1){const U=w[0].getClone();U.cell=v(s),U.pos=w[0].pos,o({action:U})}else if(w.length>1){if(!u)throw new me("ÊÉ≥ÂÆö„Åï„Çå„Å™„ÅÑÁä∂ÊÖã");v(s).field.duel.view.modalController.cancelAll(),v(s).field.duel.view.modalController.selectAction(v(s).field.duel.view,{title:"ÈÅ∏Êäû",activator:u,actions:w,cancelable:!1})}}}finally{t().removeDraggingActions()}},_e=(...x)=>{if(t().waitMode==="Animation")return"Disabled";if(f&&f.find(Z=>x.find(z=>Z===z)))return"Selectable";if(!v(l)||v(l).length===0||t().waitMode!=="SelectFieldAction"||Object.values(t().modalController.states).some(Z=>Z==="Shown"))return"Disabled";const U=v(l).filter(Z=>x.includes(Z.entity));if(U.length===0)return"Disabled";if(U.length>1||v(s).isStackCell||U[0].entity!==x[0])return"Clickable";const ae=U[0].validate(t().duel.priorityHolder,t().duel.chainBlockInfos,!1);return ae&&ae.length>0?"Draggable":"Clickable"};ot();var Pe=wd(),J=g(Pe);J.__click=Q;var F=g(J);{var G=x=>{var U=Be(),ae=le(U);{var Z=z=>{var W=Be(),R=le(W);{var V=I=>{var ee=nd(),ne=g(ee),ie=g(ne),re=_(ne,1,!0);A((N,$)=>{E(ie,N),E(re,$)},[()=>String(v(s).field.duel.clock.turn).padStart(2,"0"),()=>v(s).field.duel.phase.toUpperCase()],Se),b(I,ee)},X=I=>{var ee=Be(),ne=le(ee);{var ie=N=>{var $=sd(),fe=g($),te=g(fe),ve=_(fe,2),De=g(ve);A(()=>{E(te,v(s).field.duel.duelists.Above.lp),E(De,v(s).field.duel.duelists.Below.lp)}),b(N,$)},re=N=>{var $=Be(),fe=le($);{var te=ve=>{var De=Be(),Ne=le(De);{var Oe=B=>{var q=Be(),ge=le(q);{var ce=be=>{var qe=Be(),He=le(qe);ue(He,1,()=>t().duel.nextPhaseList,de,(ct,rt)=>{var Te=od(),Ee=g(Te);Ee.__click=[ld,L,rt];var we=g(Ee);A(Ze=>E(we,Ze),[()=>v(rt).toUpperCase()],Se),b(ct,Te)}),b(be,qe)};H(ge,be=>{t().duel.isEnded||be(ce)})}b(B,q)};H(Ne,B=>{t().waitMode==="SelectFieldAction"&&B(Oe)})}b(ve,De)};H(fe,ve=>{v(s).column===5&&ve(te)},!0)}b(N,$)};H(ne,N=>{v(s).column===3?N(ie):N(re,!1)},!0)}b(I,ee)};H(R,I=>{v(s).column===1?I(V):I(X,!1)})}b(z,W)};H(ae,z=>{v(s).row===3&&z(Z)})}b(x,U)},oe=x=>{var U=Be(),ae=le(U);{var Z=W=>{var R=fd(),V=le(R);{var X=ie=>{var re=cd(),N=g(re);At(N,{get entity(){return v(k).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),A(()=>ye(re,`card_animation_receiver ${v(s).cellType??""} svelte-rtvlgx`)),ui(1,re,()=>O,()=>({key:v(k).entity.seq})),b(ie,re)};H(V,ie=>{v(k)&&v(k).entity&&v(k).to===v(s)&&v(k).index==="Top"&&ie(X)})}var I=_(V,2);ue(I,1,()=>v(s).visibleEntities,de,(ie,re)=>{var N=Be(),$=le(N);{var fe=te=>{var ve=dd(),De=g(ve);const Ne=Se(()=>_e(v(re))),Oe=Se(()=>v(l).filter(B=>B.entity===v(re)));At(De,{get entity(){return v(re)},get state(){return v(Ne)},get actions(){return v(Oe)},cardActionResolve:void 0,get selectedList(){return n()},set selectedList(B){n(B)},$$legacy:!0}),ui(2,ve,()=>P,()=>({key:v(re).seq})),b(te,ve)};H($,te=>{(!v(k)||v(k).entity.seq!==v(re).seq)&&te(fe)})}b(ie,N)});var ee=_(I,2);{var ne=ie=>{var re=ud(),N=g(re);At(N,{get entity(){return v(k).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),A(()=>ye(re,`card_animation_receiver ${v(s).cellType??""} svelte-rtvlgx`)),ui(1,re,()=>O,()=>({key:v(k).entity.seq})),b(ie,re)};H(ee,ie=>{v(k)&&v(k).entity&&v(k).to===v(s)&&v(k).index!=="Top"&&ie(ne)})}b(W,R)},z=W=>{var R=bd(),V=le(R);{var X=$=>{var fe=vd(),te=g(fe);At(te,{get entity(){return v(k).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),ui(1,fe,()=>O,()=>({key:v(k).entity.seq})),b($,fe)};H(V,$=>{v(k)&&v(k).entity&&v(k).to===v(s)&&v(k).index!=="Top"&&$(X)})}var I=_(V,2);{var ee=$=>{var fe=md(),te=le(fe);ue(te,1,()=>v(s).visibleEntities.map((Ne,Oe)=>({index:Oe,entity:Ne})).toReversed(),de,(Ne,Oe)=>{var B=Be(),q=le(B);{var ge=ce=>{var be=hd(),qe=le(be);{var He=we=>{var Ze=pd();b(we,Ze)};H(qe,we=>{v(p).includes(v(Oe).entity)&&we(He)})}var ct=_(qe,2),rt=g(ct);const Te=Se(()=>!v(s).isStackCell&&v(Oe).index===0?_e(...v(s).visibleEntities):void 0),Ee=Se(()=>v(Oe).index===0?v(l).filter(we=>v(s).visibleEntities.includes(we.entity)):void 0);At(rt,{get entity(){return v(Oe).entity},get state(){return v(Te)},get actions(){return v(Ee)},cardActionResolve:void 0,get selectedList(){return n()},set selectedList(we){n(we)},$$legacy:!0}),ui(2,ct,()=>P,()=>({key:v(Oe).entity.seq})),b(ce,be)};H(q,ce=>{(!v(k)||v(k).entity.seq!==v(Oe).entity.seq)&&ce(ge)})}b(Ne,B)});var ve=_(te,2);{var De=Ne=>{var Oe=yd(),B=g(Oe),q=_(B);ue(q,1,()=>Object.keys(v(s).visibleEntities[0].status.maxCounterQty),de,(ge,ce)=>{var be=gd(),qe=le(be),He=_(qe);{var ct=rt=>{var Te=Wt();A(()=>E(Te,`/${v(s).visibleEntities[0].status.maxCounterQty[v(ce)]??""}`)),b(rt,Te)};H(He,rt=>{(v(s).visibleEntities[0].status.maxCounterQty[v(ce)]??!1)&&rt(ct)})}A(rt=>E(qe,`„Äê
              ${ko[v(ce)]??""}${rt??""} `),[()=>v(s).visibleEntities[0].counterHolder.getQty(v(ce))],Se),b(ge,be)}),A(()=>E(B,`„Äê${v(s).visibleEntities[0].battlePositionName??""}„Äë `)),b(Ne,Oe)};H(ve,Ne=>{v(s).visibleEntities[0].battlePosition&&Ne(De)})}b($,fe)};H(I,$=>{v(s).visibleEntities.length>0&&$(ee)})}var ne=_(I,2);{var ie=$=>{var fe=_d(),te=g(fe);A(()=>E(te,v(s).visibleEntities.length)),b($,fe)};H(ne,$=>{v(s).isStackCell&&$(ie)})}var re=_(ne,2);{var N=$=>{var fe=Sd(),te=g(fe);At(te,{get entity(){return v(k).entity},state:"Disabled",actions:[],cardActionResolve:void 0}),ui(1,fe,()=>O,()=>({key:v(k).entity.seq})),b($,fe)};H(re,$=>{v(k)&&v(k).entity&&v(k).to===v(s)&&v(k).index==="Top"&&$(N)})}b(W,R)};H(ae,W=>{v(s).cellType==="Hand"?W(Z):W(z,!1)},!0)}b(x,U)};H(F,x=>{v(s).isDisabledCell?x(G):x(oe,!1)})}A(x=>{ye(Pe,`${`duel_field_cell duel_field_cell_${v(s).cellType} ${v(s).arrowheadSources.length===0?"":"duel_field_cell_linked"}`??""} svelte-rtvlgx`),Ft(Pe,"colspan",v(s).cellType==="Hand"?7:1),ye(J,`${x??""} svelte-rtvlgx`)},[()=>`duel_card_wrapper ${v(s).cellType} ${v(y)?"can_accept_drop":""} ${M()?"can_action":""} `],Se),je("dragover",J,x=>j(x)),je("drop",J,x=>Y(x)),b(i,Pe),Qe()}Ui(["click"]);var kd=C('<div class="title svelte-1sjjr5s"> </div>'),Td=C('<div class="title svelte-1sjjr5s"> </div>'),Ed=C('<div class="duel_log_record svelte-1sjjr5s"> </div>'),Dd=C('<div><div style=" white-space: nowrap;text-align: center;"> </div> <!></div>'),Ad=C("<div><!> <!></div>"),xd=C("<div><!> <!></div>"),Md=C('<div class="duel_log svelte-1sjjr5s"><div class="duel_log_header svelte-1sjjr5s"></div> <div class="duel_log_body svelte-1sjjr5s"></div> <div class="duel_log_footer svelte-1sjjr5s"></div></div>');function Pd(i,e){Ke(e,!1);let t=Le(void 0),r=xe(e,"log",8),a,n=Le([]);const s=()=>{const o=((a==null?void 0:a.seq)??-1)+1;console.log(r(),o,v(n).length),r().records.slice(o).forEach(f=>{if(!a){K(n,[[[[f]]]]),a=f;return}if(!v(n)[f.clock.turn]){$e(n,v(n)[f.clock.turn]=[[[f]]]),a=f;return}if(!v(n)[f.clock.turn][f.clock.phaseSeq]){$e(n,v(n)[f.clock.turn][f.clock.phaseSeq]=[[f]]),a=f;return}if(a.clock.chainSeq===f.clock.chainSeq&&a.clock.chainBlockSeq===f.clock.chainBlockSeq&&a.duelist===f.duelist){v(n)[f.clock.turn][f.clock.phaseSeq].slice(-1)[0].push(f),a=f;return}v(n)[f.clock.turn][f.clock.phaseSeq].push([f]),a=f}),K(n,v(n)),al().then(()=>v(t)&&v(t).scroll(0,v(t).clientHeight*990))};r().onUpdate.append(s),r().duel.view.onDuelUpdate.append(s),ot();var c=Be(),u=le(c);{var l=o=>{var f=Md(),p=_(g(f),2);ue(p,5,()=>v(n),de,(h,m)=>{var w=xd(),y=g(w);{var S=P=>{var O=kd(),k=g(O);A(()=>E(k,`„Çø„Éº„É≥Ôºö${v(m)[0][0][0].clock.turn??""}`)),b(P,O)};H(y,P=>{v(m)[0][0][0].clock.turn>0&&P(S)})}var T=_(y,2);ue(T,1,()=>v(m),de,(P,O)=>{var k=Ad(),D=g(k);{var L=Q=>{var j=Td(),Y=g(j);A(()=>E(Y,v(O)[0][0].clock.period.name)),b(Q,j)};H(D,Q=>{v(O)[0][0].clock.turn>0&&Q(L)})}var M=_(D,2);ue(M,1,()=>v(O),de,(Q,j)=>{var Y=Dd(),_e=g(Y),Pe=g(_e),J=_(_e,2);ue(J,1,()=>v(j),de,(F,G)=>{var oe=Ed(),x=g(oe);A(()=>E(x,v(G).text)),b(F,oe)}),A(()=>{var F,G,oe;ye(Y,`duel_log_block_duelist duel_log_block_duelist_${((F=v(j)[0].duelist)==null?void 0:F.seat)??"system"} svelte-1sjjr5s`),ye(_e,`duelist ${((G=v(j)[0].duelist)==null?void 0:G.seat)??""} svelte-1sjjr5s`),E(Pe,((oe=v(j)[0].duelist)==null?void 0:oe.profile.name)||"SYSTEM")}),b(Q,Y)}),A(()=>ye(k,`duel_log_block_phase duel_log_block_phase_${v(O)[0][0].clock.period.key??""} svelte-1sjjr5s`)),b(P,k)}),A(()=>ye(w,`duel_log_block_turn duel_log_block_turn_${v(m)[0][0][0].clock.turn??""} svelte-1sjjr5s`)),b(h,w)}),Pl(p,h=>K(t,h),()=>v(t)),b(o,f)};H(u,o=>{r().duel.view.infoBoardState==="Log"&&o(l)})}b(i,c),Qe()}var Fd=C('<div><div class="duelist_name svelte-1u7codf"> </div> <div> </div></div>');function Ia(i,e){Ke(e,!1);let t=xe(e,"duelist",12),r=Le(0),a=Le();const n=async()=>{const p=t().lp-v(r);if(!v(a)||Math.abs(p)<10){K(r,t().lp),v(a)&&(v(a)(),K(a,void 0));return}K(r,v(r)+Math.floor(Math.random()*p)),await Zo(100),n()},s=()=>{t(t()),!v(a)&&t().lp!==v(r)&&new Promise(p=>{K(a,p),Math.abs(t().lp-v(r)),n()})};t().duel.log.onUpdate.append(s),n(),ot();var c=Fd(),u=g(c),l=g(u),o=_(u,2),f=g(o);A(()=>{ye(c,`duelist ${t().seat??""} svelte-1u7codf`),E(l,t().profile.name),ye(o,`duelist_lp ${(v(a)?"vibration":"")??""} svelte-1u7codf`),E(f,v(r))}),b(i,c),Qe()}const Bd=()=>{};var Od=C("<div><!></div>"),qd=C("<div></div>"),Ld=(i,e,t)=>e.resolve(v(t)),Nd=(i,e)=>e.resolve(void 0),Rd=C('<button class="svelte-25k6xl">Cancel</button>'),Hd=C('<div class="base svelte-25k6xl"><button class="overlay svelte-25k6xl">‚òÜ</button> <div class="window svelte-25k6xl"><div> </div> <!> <div><button class="svelte-25k6xl">OK</button> <!></div></div></div>');function $d(i,e){Ke(e,!0);let t=Hs(Nt([])),r=e.chainBlockInfos.flatMap(c=>c.selectedEntities).getDistinct();var a=Be(),n=le(a);{var s=c=>{var u=Hd(),l=g(u);l.__click=[Bd];var o=_(l,2),f=g(o),p=g(f),h=_(f,2);ue(h,17,()=>e.entities.map(T=>T.controller.seat).getDistinct(),de,(T,P)=>{var O=qd();ue(O,21,()=>e.entities.filter(k=>k.controller.seat===v(P)).toSorted(Xn),de,(k,D)=>{var L=Od(),M=g(L);At(M,{get entity(){return v(D)},isVisibleForcibly:!0,state:"Selectable",entitySelectResolve:Q=>e.resolve(Q),get qty(){return e.qty},cardActionResolve:void 0,get selectedList(){return v(t)},set selectedList(Q){K(t,Nt(Q))}}),A(Q=>ye(L,`entities_list_item ${Q??""} svelte-25k6xl`),[()=>r.includes(v(D))?"effect_target":""]),b(k,L)}),A(()=>ye(O,`entities_list ${v(P)??""} svelte-25k6xl`)),b(T,O)});var m=_(h,2),w=g(m);w.__click=[Ld,e,t];var y=_(w,2);{var S=T=>{var P=Rd();P.__click=[Nd,e],b(T,P)};H(y,T=>{e.cancelable&&T(S)})}A(T=>{E(p,e.title),w.disabled=T},[()=>!e.validator(v(t))]),b(c,u)};H(n,c=>{c(s)})}b(i,a),Qe()}Ui(["click"]);const jd=(i,e)=>{e.cancelable&&e.resolve(void 0)};var Zd=C('<div class="duel_card_wrapper svelte-5snthj"><!> <div> </div></div>'),Ud=(i,e)=>e.resolve(),Gd=C('<div><button class="cancel_button svelte-5snthj">Cancel</button></div>'),zd=C('<div><button>‚òÖ</button> <div><div> </div> <div class="flex svelte-5snthj"></div> <!></div></div>');function Vd(i,e){Ke(e,!0);const[t,r]=ql(),a=()=>Ol(n,"$isDragging",t);let n=Fl(!1);const s=()=>n.set(!0),c=()=>n.set(!1);e.view.onDragStart.append(s),e.view.onDragEnd.append(c);const u=p=>{if(e.activator.duelistType==="NPC")return"Disabled";const h=p.validate(e.activator,e.view.duel.chainBlockInfos,!1);return h&&h.length>0?"Draggable":"Clickable"};var l=Be(),o=le(l);{var f=p=>{var h=zd(),m=g(h);m.__click=[jd,e];var w=_(m,2),y=g(w),S=g(y),T=_(y,2);ue(T,21,()=>e.actions,de,(k,D)=>{var L=Zd(),M=g(L);const Q=It(()=>u(v(D))),j=It(()=>e.dragAndDropOnly?[]:[v(D)]);At(M,{get entity(){return v(D).entity},isVisibleForcibly:!0,get state(){return v(Q)},get actions(){return v(j)},get cardActionResolve(){return e.resolve}});var Y=_(M,2),_e=g(Y);A(()=>E(_e,`¬´${v(D).title??""}¬ª`)),b(k,L)});var P=_(T,2);{var O=k=>{var D=Gd(),L=g(D);L.__click=[Ud,e],b(k,D)};H(P,k=>{e.cancelable&&k(O)})}A(()=>{ye(h,`${`base ${a()?"minimum_mode":""}`??""} svelte-5snthj`),ye(m,`${`overlay ${a()?"minimum_mode":""}`??""} svelte-5snthj`),ye(w,`${`window ${a()?"minimum_mode":""}`??""} svelte-5snthj`),E(S,e.title)}),b(p,h)};H(o,p=>{p(f)})}b(i,l),Qe(),r()}Ui(["click"]);const Wd=(i,e,t,r)=>{e().cancelable&&(t()(void 0),K(r,!1))};var Yd=(i,e,t)=>e()(t()),Xd=C("<li><button> </button></li>"),Kd=(i,e)=>e()(void 0),Qd=C("<button>Cancel</button>"),Jd=C('<div class="base svelte-1103gpy"><button class="overlay svelte-1103gpy">‚òÖ</button> <div class="window svelte-1103gpy"><div> </div> <ui class="text_list svelte-1103gpy"></ui> <!></div></div>');function Id(i,e){Ke(e,!1);let t=xe(e,"arg",8),r=xe(e,"resolve",8),a=Le(!0);ot();var n=Be(),s=le(n);{var c=u=>{var l=Jd(),o=g(l);o.__click=[Wd,t,r,a];var f=_(o,2),p=g(f),h=g(p),m=_(p,2);ue(m,5,()=>t().choises,de,(S,T)=>{let P=()=>v(T).seq,O=()=>v(T).text;var k=Xd(),D=g(k);D.__click=[Yd,r,P];var L=g(D);A(()=>{ye(k,`text_item ${P()??""} svelte-1103gpy`),E(L,O())}),b(S,k)});var w=_(m,2);{var y=S=>{var T=Qd();T.__click=[Kd,r],b(S,T)};H(w,S=>{t().cancelable&&S(y)})}A(()=>E(h,t().title)),b(u,l)};H(s,u=>{v(a)&&u(c)})}b(i,n),Qe()}Ui(["click"]);var eu=C('<div class="base svelte-1y912d"><!> <!> <!></div>');function tu(i,e){var f,p;Ke(e,!1);let t=xe(e,"modalController",12);const r=()=>{t(t())};(p=(f=t())==null?void 0:f.onUpdate)==null||p.append(r),ot();var a=eu(),n=g(a);{var s=h=>{$d(h,{get title(){return t().duelEntitiesSelectorArg.title},get entities(){return t().duelEntitiesSelectorArg.entities},get validator(){return t().duelEntitiesSelectorArg.validator},get qty(){return t().duelEntitiesSelectorArg.qty},get cancelable(){return t().duelEntitiesSelectorArg.cancelable},get chainBlockInfos(){return t().duelEntitiesSelectorArg.chainBlockInfos},resolve:m=>{t().duelEntitiesSelectorResolve(m)}})};H(n,h=>{t().states.DuelEntitiesSelector==="Shown"&&h(s)})}var c=_(n,2);{var u=h=>{const m=Se(()=>t().cardActionSelectorArg.dragAndDropOnly??!1);Vd(h,{get view(){return t().view},get title(){return t().cardActionSelectorArg.title},get activator(){return t().cardActionSelectorArg.activator},get actions(){return t().cardActionSelectorArg.actions},get dragAndDropOnly(){return v(m)},get cancelable(){return t().cardActionSelectorArg.cancelable},resolve:w=>{console.info(w),t().cardActionSelectorResolve(w)}})};H(c,h=>{t().states.DuelActionSelector==="Shown"&&h(u)})}var l=_(c,2);{var o=h=>{Id(h,{get arg(){return t().duelTextSelectorArg},resolve:m=>{console.info(m),t().duelTextSelectorResolve(m)}})};H(l,h=>{t().states.DuelTextSelector==="Shown"&&h(o)})}b(i,a),Qe()}const iu=(i,e)=>(e(e()==="Normal"?"Debug":"Normal"),!0);var ru=C('<div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"><pre class="description svelte-nn7bjy"> </pre></div></div> <div class="duel_card_info_row svelte-nn7bjy" style=" justify-content: space-between;"><div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"> </div></div>',1),au=C('<div></div> <div class="svelte-nn7bjy"> </div>',1),nu=C("<div> </div>"),su=C("<div> </div>"),lu=C('<div class="duel_card_info_row svelte-nn7bjy"><!> <!></div> <div class="duel_card_info_row svelte-nn7bjy"></div>',1),ou=C('<div class="duel_card_row svelte-nn7bjy"><div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"> </div></div>'),cu=C('<div class="duel_card_row svelte-nn7bjy"><div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"> </div></div>'),du=C("<!> <!>",1),uu=C('<div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"><pre class="description svelte-nn7bjy"> </pre></div></div>'),fu=C('<div class="svelte-nn7bjy"> </div>'),vu=C('<div class="svelte-nn7bjy"> </div>'),pu=C('<div class="svelte-nn7bjy"> </div>'),hu=C('<div class="svelte-nn7bjy"> </div>'),gu=C('<div class="svelte-nn7bjy"> </div>'),yu=C('<div class="svelte-nn7bjy"> </div>'),mu=C('<div class="svelte-nn7bjy"> </div>'),_u=C('<div class="svelte-nn7bjy"> </div>'),Su=C('<div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"><div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <!> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"></div> <div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"></div></div></div>'),bu=C('<div class="svelte-nn7bjy">‚Äª„ÉÜ„Çπ„ÉàÁî®„Ç´„Éº„Éâ„Åß„Åô</div>'),wu=C('<div class="duel_card_info_links svelte-nn7bjy"><a target="_blank" rel="noopener noreferrer" title="ÈÅäÊàØÁéã„Ç´„Éº„ÉâWiki" class="svelte-nn7bjy">‚áíÈÅäÊàØÁéã„Ç´„Éº„ÉâWiki</a> <a target="_blank" rel="noopener noreferrer" title="„Ç≥„Éä„Éü„Ç´„Éº„Éâ„Éá„Éº„Çø„Éô„Éº„Çπ" class="svelte-nn7bjy"> </a></div>'),Cu=C('<div role="contentinfo"><div class="duel_card_info_header svelte-nn7bjy"><div class="duel_card_info_row svelte-nn7bjy"><div class="svelte-nn7bjy"> </div></div> <div class="duel_card_info_row svelte-nn7bjy" style="position:sticky; top:0;"><div class="svelte-nn7bjy"> </div> <div class="svelte-nn7bjy"> </div></div> <!></div> <div class="duel_card_info_body svelte-nn7bjy"><!></div> <div class="duel_card_info_footer svelte-nn7bjy"><!></div></div>');function ku(i,e){Ke(e,!1);let t=xe(e,"entity",8,void 0);const r=()=>t()?tt[t().origin.name]:void 0,a=()=>{var l;return t()&&(t().origin.cardId??!1)?`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=2&cid=${t().origin.cardId}`:`https://www.db.yugioh-card.com/yugiohdb/card_search.action?ope=1&sess=1&rp=10&mode=&sort=1&keyword=${(l=r())==null?void 0:l.name}&stype=1&ctype=&othercon=2&starfr=&starto=&pscalefr=&pscaleto=&linkmarkerfr=&linkmarkerto=&link_m=2&atkfr=&atkto=&deffr=&defto=&releaseDStart=1&releaseMStart=1&releaseYStart=1999&releaseDEnd=&releaseMEnd=&releaseYEnd=`};let n=xe(e,"mode",12,"Normal");ot();var s=Be(),c=le(s);{var u=l=>{var o=Cu();o.__contextmenu=[iu,n];var f=g(o),p=g(f),h=g(p),m=g(h),w=_(p,2),y=g(w),S=g(y),T=_(y,2),P=g(T),O=_(w,2);{var k=J=>{var F=du(),G=le(F);{var oe=Z=>{var z=ru(),W=le(z),R=g(W),V=g(R),X=g(V),I=_(W,2),ee=g(I),ne=g(ee),ie=_(ee,2),re=g(ie);A(()=>{E(X,tt[t().origin.name].pendulumDescription),E(ne,`‚óÄ ${t().psL??""}`),E(re,`${t().psR??""} ‚ñ∂`)}),b(Z,z)};H(G,Z=>{var z;(z=t().status.monsterCategories)!=null&&z.includes("Pendulum")&&Z(oe)})}var x=_(G,2);{var U=Z=>{var z=lu(),W=le(z),R=g(W);ue(R,1,()=>t().attr,de,(I,ee)=>{var ne=au(),ie=le(ne),re=_(ie,2),N=g(re);A(()=>{ye(ie,`monster_attr ${v(ee)??""} svelte-nn7bjy`),E(N,`${wa[v(ee)]??""}Â±ûÊÄß`)}),b(I,ne)});var V=_(R,2);ue(V,1,()=>t().types,de,(I,ee)=>{var ne=nu(),ie=g(ne);A(()=>{ye(ne,`monster_cat ${v(ee)??""} svelte-nn7bjy`),E(ie,`${Wi[v(ee)]??""}${Mr[v(ee)]??""}Êóè`)}),b(I,ne)});var X=_(W,2);ue(X,5,()=>t().status.monsterCategories??[],de,(I,ee)=>{var ne=su(),ie=g(ne);A(()=>{ye(ne,`monster_cat ${v(ee)??""} svelte-nn7bjy`),E(ie,`${Gi[v(ee)]??""}${xr[v(ee)]??""}`)}),b(I,ne)}),b(Z,z)},ae=Z=>{var z=Be(),W=le(z);{var R=X=>{var I=ou(),ee=_(g(I),2),ne=g(ee);A(()=>E(ne,`${zi[t().status.spellCategory]??""}È≠îÊ≥ï`)),b(X,I)},V=X=>{var I=Be(),ee=le(I);{var ne=ie=>{var re=cu(),N=_(g(re),2),$=g(N);A(()=>E($,`${Vi[t().status.trapCategory]??""}ÁΩ†`)),b(ie,re)};H(ee,ie=>{t().status.kind==="Trap"&&t().status.trapCategory&&ie(ne)},!0)}b(X,I)};H(W,X=>{t().status.kind==="Spell"&&t().status.spellCategory?X(R):X(V,!1)},!0)}b(Z,z)};H(x,Z=>{t().status.kind==="Monster"?Z(U):Z(ae,!1)})}b(J,F)};H(O,J=>{n()==="Normal"&&J(k)})}var D=_(f,2),L=g(D);{var M=J=>{var F=uu(),G=g(F),oe=g(G),x=g(oe);A(U=>E(x,U),[()=>{var U;return(U=r())==null?void 0:U.description}],Se),b(J,F)},Q=J=>{var F=Su(),G=g(F),oe=g(G);oe.textContent='"info" :{';var x=_(oe,2);ue(x,1,()=>Object.entries(t().info),de,(Te,Ee)=>{let we=()=>v(Ee)[0],Ze=()=>v(Ee)[1];var at=fu(),Ai=g(at);A(yt=>E(Ai,`"${we()??""}" :${yt??""},`),[()=>{var yt;return(yt=Ze())==null?void 0:yt.toString()}],Se),b(Te,at)});var U=_(x,2);U.textContent="},";var ae=_(U,2);ae.textContent='"status" :{';var Z=_(ae,2);ue(Z,1,()=>Object.entries(t().status),de,(Te,Ee)=>{let we=()=>v(Ee)[0],Ze=()=>v(Ee)[1];var at=vu(),Ai=g(at);A(yt=>E(Ai,`"${we()??""}" :${yt??""},`),[()=>{var yt;return(yt=Ze())==null?void 0:yt.toString()}],Se),b(Te,at)});var z=_(Z,2);z.textContent="},";var W=_(z,2);W.textContent='"actions" :[';var R=_(W,2);ue(R,1,()=>t().actions,de,(Te,Ee)=>{var we=pu(),Ze=g(we);A(()=>E(Ze,`"${v(Ee).playType??""} ${v(Ee).title??""}",`)),b(Te,we)});var V=_(R,2);V.textContent="],";var X=_(V,2);X.textContent='"substituteEffects" :[';var I=_(X,2);ue(I,1,()=>t().substituteEffects,de,(Te,Ee)=>{var we=hu(),Ze=g(we);A(()=>E(Ze,`"${v(Ee).title??""}",`)),b(Te,we)});var ee=_(I,2);ee.textContent="],";var ne=_(ee,2);ne.textContent='"continuousEffects" :[';var ie=_(ne,2);ue(ie,1,()=>t().continuousEffects,de,(Te,Ee)=>{var we=gu(),Ze=g(we);A(()=>E(Ze,`"${v(Ee).isStarted??""}",`)),b(Te,we)});var re=_(ie,2);re.textContent="],";var N=_(re,2);N.textContent='"procFilters" :[';var $=_(N,2);ue($,1,()=>t().procFilterBundle.operators,de,(Te,Ee)=>{var we=yu(),Ze=g(we);A(at=>E(Ze,`"${at??""} ${v(Ee).title??""}",`),[()=>v(Ee).isSpawnedBy.toString()],Se),b(Te,we)});var fe=_($,2);fe.textContent="],";var te=_(fe,2);te.textContent='"numericStateOperators" :[';var ve=_(te,2);ue(ve,1,()=>t().numericOprsBundle.operators,de,(Te,Ee)=>{var we=mu(),Ze=g(we);A(at=>E(Ze,`"${at??""} ${v(Ee).title??""}",`),[()=>v(Ee).isSpawnedBy.toString()],Se),b(Te,we)});var De=_(ve,2);De.textContent="],";var Ne=_(De,2);Ne.textContent='"stateOperators" :[';var Oe=_(Ne,2);ue(Oe,1,()=>t().statusOperatorBundle.operators,de,(Te,Ee)=>{var we=_u(),Ze=g(we);A(at=>E(Ze,`"${at??""} ${v(Ee).title??""}",`),[()=>v(Ee).isSpawnedBy.toString()],Se),b(Te,we)});var B=_(Oe,2);B.textContent="],";var q=_(B,2);q.textContent='"lastMoveLogRecord" :{';var ge=_(q,2),ce=g(ge),be=_(ge,2),qe=g(be),He=_(be,2),ct=g(He),rt=_(He,2);rt.textContent="},",A((Te,Ee)=>{E(ce,`"movedBy":"${Te??""}",`),E(qe,`"movedAs":"${Ee??""}",`),E(ct,`"movedAt":"${t().moveLog.latestRecord.movedAt??""}",`)},[()=>{var Te;return(Te=t().moveLog.latestRecord.movedBy)==null?void 0:Te.toString()},()=>t().moveLog.latestRecord.movedAs.join(" ")],Se),b(J,F)};H(L,J=>{n()==="Normal"?J(M):J(Q,!1)})}var j=_(D,2),Y=g(j);{var _e=J=>{var F=bu();b(J,F)},Pe=J=>{var F=wu(),G=g(F),oe=_(G,2),x=g(oe);A(U=>{var ae;Ft(G,"href",`https://yugioh-wiki.net/index.php?${t().origin.wikiEncodedName}`),Ft(oe,"href",U),E(x,`‚áí${((ae=t())!=null&&ae.origin.cardId?"ÂÖ¨Âºè„Ç´„Éº„Éâ„Éö„Éº„Ç∏":"ÂÖ¨Âºè„ÅßÊ§úÁ¥¢")??""}`)},[a],Se),b(J,F)};H(Y,J=>{var F;(F=t())!=null&&F.origin.isForTest?J(_e):J(Pe,!1)})}A((J,F,G)=>{ye(o,`duel_card duel_card_info ${t().origin.kind??""} ${J??""} svelte-nn7bjy`),E(m,t().nm),E(S,F),E(P,G)},[()=>{var J;return(J=t().origin.monsterCategories)==null?void 0:J.join(" ")},()=>"‚òÖ".repeat(t().lvl||0),()=>"‚òÜ".repeat(t().rank||0)],Se),b(l,o)};H(c,l=>{t()&&l(u)})}b(i,s),Qe()}Ui(["contextmenu"]);var Tu=C('<div class="duel_field_cell_info_item svelte-1xj7qf1"><!></div>'),Eu=C('<div class="duel_field_cell_info_box svelte-1xj7qf1"><div class="duel_field_cell_info_label svelte-1xj7qf1"> </div> <!></div>'),Du=C('<div class="duel_field_cell_info svelte-1xj7qf1"><div class="duel_field_cell_info_header item_btn svelte-1xj7qf1"><div class="svelte-1xj7qf1"> </div> <div class="svelte-1xj7qf1"> </div></div> <div class="duel_field_cell_info_body svelte-1xj7qf1"></div></div>');function Au(i,e){Ke(e,!1);let t=xe(e,"cell",12);const r=()=>{t(t())},a=u=>t().cardEntities.filter(l=>l.face===u);t().field.duel.view.onDuelUpdate.append(r),ot();var n=Be(),s=le(n);{var c=u=>{var l=Du(),o=g(l),f=g(o),p=g(f),h=_(f,2),m=g(h),w=_(o,2);ue(w,4,()=>["FaceUp","FaceDown"],de,(y,S)=>{var T=Be(),P=le(T);{var O=k=>{var D=Eu(),L=g(D),M=g(L),Q=_(L,2);ue(Q,1,()=>a(S).toSorted(Xn),de,(j,Y)=>{var _e=Tu(),Pe=g(_e);const J=Se(()=>t().owner===t().field.duel.duelists.Below);At(Pe,{get entity(){return v(Y)},get isVisibleForcibly(){return v(J)},isWideMode:!0,cardActionResolve:void 0}),b(j,_e)}),A(()=>E(M,S==="FaceUp"?"Ë°®Âêë„Åç":"Ë£èÂêë„Åç")),b(k,D)};H(P,k=>{a(S).length&&k(O)})}b(y,T)}),A(()=>{var y;E(p,(y=t().owner)==null?void 0:y.profile.name),E(m,t().cellType)}),b(u,l)};H(s,u=>{t().field.duel.view.infoBoardState==="CellInfo"&&u(c)})}b(i,n),Qe()}const xu=Xc({duration:400});var Mu=C('<div class="duel_field_header_message svelte-accyye"> </div> <div class="duel_field_header_buttons svelte-accyye"><button class="svelte-accyye">„Çµ„É¨„É≥„ÉÄ„Éº</button></div>',1),Pu=C("<tr></tr>"),Fu=C('<table class="duel_field svelte-accyye"><tbody class="svelte-accyye"></tbody></table>'),Bu=C('<button class="svelte-accyye">OK</button>'),Ou=C('<div class="flex duel_desk svelte-accyye"><div class="duel_desk_left v_flex svelte-accyye"><!> <!> <!></div> <div class=" duel_desk_center v_flex svelte-accyye"><div class="duel_field_header svelte-accyye"><!></div> <div class="svelte-accyye"><!></div> <div class="duel_field_footer svelte-accyye"><!></div></div> <div class=" duel_desk_right svelte-accyye" style="text-align: left;"><!> <!></div></div> <div style="position:absolute;left:0;bottom:0"> </div> <!>',1);function qu(i,e){Ke(e,!1);let t=xe(e,"duel",12),r=()=>{},a=Le(()=>!0),n=Le([]);const s=Z=>{r=Z.resolve,K(a,Z.entitiesValidator),K(n,Z.selectableEntities),Z.duelEntitiesSelectorArg&&t().view.modalController.selectDuelEntities(Z.duelEntitiesSelectorArg).then(z=>{r({selectedEntities:z})})};t().view.onWaitStart.append(s);const c=()=>{r=()=>{},K(a,()=>!0),K(n,[])};t().view.onWaitEnd.append(c);let u=Le(void 0),l=Le("Normal");const o=({card:Z,mode:z})=>{K(u,Z),K(l,z)};t().view.onShowCardEntity.append(o);let f=xe(e,"selectedList",28,()=>[]);const p=()=>{t(t())};t().view.onDuelUpdate.append(p),t().log.onUpdate.append(p);const h=()=>{v(a)(f())&&r({selectedEntities:f()})},m=()=>{r({surrender:!0})};t().main(),ot();var w=Ou(),y=le(w),S=g(y),T=g(S);Ia(T,{get duelist(){return t().duelists.Above}});var P=_(T,2);ku(P,{get entity(){return v(u)},get mode(){return v(l)}});var O=_(P,2);Ia(O,{get duelist(){return t().duelists.Below}});var k=_(S,2),D=g(k),L=g(D);{var M=Z=>{var z=Mu(),W=le(z),R=g(W),V=_(W,2),X=g(V);A(()=>E(R,`[TURN:${t().clock.turn}][PHASE:${t().phase}] ${t().view.message}`)),je("click",X,m),b(Z,z)};H(L,Z=>{t().isEnded||Z(M)})}var Q=_(D,2),j=g(Q);{var Y=Z=>{var z=Fu(),W=g(z);ue(W,5,()=>t().field.cells,de,(R,V,X)=>{var I=Pu();ye(I,`${`duel_desk_row_${X}`??""} svelte-accyye`),ue(I,5,()=>v(V),de,(ee,ne,ie)=>{Cd(ee,{get view(){return t().view},row:X,column:ie,get selectedList(){return f()},set selectedList(re){f(re)},$$legacy:!0})}),b(R,I)}),b(Z,z)};H(j,Z=>{t().clock.turn>0&&Z(Y)})}var _e=_(Q,2),Pe=g(_e);{var J=Z=>{var z=Bu();A(W=>z.disabled=W,[()=>!v(a)(f())],Se),je("click",z,h),b(Z,z)};H(Pe,Z=>{v(n)&&v(n).length>0&&Z(J)})}var F=_(k,2),G=g(F);Pd(G,{get log(){return t().log}});var oe=_(G,2);Au(oe,{get cell(){return t().view.infoBoardCell}});var x=_(y,2),U=g(x),ae=_(x,2);tu(ae,{get modalController(){return t().view.modalController}}),A(Z=>E(U,Z),[()=>t().clock.toString()],Se),b(i,w),Qe()}var Lu=C("<div></div>"),Nu=C('<span> </span> / <span style="display: inline-block;width:2rem;text-align: right;"> </span>',1),Ru=C('<li class="deck_editor_item svelte-vivzk2"><div role="listitem"><div class="svelte-vivzk2"><div class="svelte-vivzk2"> </div> <div style="display:flex" class="svelte-vivzk2"><div class="svelte-vivzk2"><!> <!> <!> <!> <!> <!> <!></div> <div style="flex-grow: 1; width:0.1rem" class="svelte-vivzk2"></div> <div class="svelte-vivzk2"><!></div></div></div></div> <button class="button_style_reset svelte-vivzk2" title="‚Äªshift„Ç≠„ÉºÂêåÊôÇÊäº„Åó„Åß‰∏ÄÊã¨ÊäïÂÖ•">+</button> <button class="button_style_reset svelte-vivzk2" title="‚Äªshift„Ç≠„ÉºÂêåÊôÇÊäº„Åó„Åß‰∏ÄÊã¨Â§ñ„Åó">-</button></li>'),Hu=C('<div class="deck_editor_card_kind svelte-vivzk2"><span class="svelte-vivzk2"> </span> <ul class="svelte-vivzk2"></ul></div>'),$u=C('<div class="deck_editor_deck_type svelte-vivzk2"><span class="svelte-vivzk2"> </span> <!></div>'),ju=C('<div class="deck_editor_card_list svelte-vivzk2"></div>');function en(i,e){Ke(e,!1);let t=xe(e,"allCardInfos",8),r=xe(e,"deckCardInfos",12),a=xe(e,"mode",8),n=xe(e,"onAttention",8);const s={Deck:["Monster","Spell","Trap"],ExtraDeck:["Monster"]},c=(f,p)=>(a()==="List"?t():r()).filter(h=>{var m;return oa.has(h.name)||((m=h.monsterCategories)==null?void 0:m.includes("Normal"))}).filter(h=>!p||h.kind===p).filter(h=>{var m,w;return!f||f==="Deck"&&!((m=h==null?void 0:h.monsterCategories)!=null&&m.union(wi).length)||f==="ExtraDeck"&&((w=h==null?void 0:h.monsterCategories)==null?void 0:w.union(wi).length)}),u=(f,p)=>{const h=r().filter(w=>w.name===p.name).length;if(h>2)return;const m=f.shiftKey?3-h:1;m<1||(r().push(...Array(m).fill(p)),r().sort(Fi),r(r()))},l=(f,p)=>{let h=0;r(r().filter(m=>m.name!==p.name?!0:(h++,!f.shiftKey&&h>1))),r().sort(Fi)};ot();var o=ju();ue(o,5,()=>Hl,de,(f,p)=>{var h=$u(),m=g(h),w=g(m),y=_(m,2);ue(y,1,()=>s[v(p)],de,(S,T)=>{var P=Hu(),O=g(P),k=g(O),D=_(O,2);ue(D,5,()=>c(v(p),v(T)).toSorted(Fi),de,(L,M)=>{var Q=Ru(),j=g(Q),Y=g(j),_e=g(Y),Pe=g(_e),J=_(_e,2),F=g(J),G=g(F);{var oe=N=>{var $=Wt();A(()=>E($,`‚òÖ${v(M).level??""}`)),b(N,$)};H(G,N=>{v(M).level&&N(oe)})}var x=_(G,2);{var U=N=>{var $=Wt();A(()=>E($,`‚òÜ${v(M).rank??""}`)),b(N,$)};H(x,N=>{v(M).rank&&N(U)})}var ae=_(x,2);ue(ae,1,()=>v(M).attributes??[],de,(N,$)=>{var fe=Lu();A(()=>ye(fe,`monster_attr ${v($)??""} svelte-vivzk2`)),b(N,fe)});var Z=_(ae,2);ue(Z,1,()=>v(M).types??[],de,(N,$)=>{var fe=Wt();A(()=>E(fe,Wi[v($)])),b(N,fe)});var z=_(Z,2);ue(z,1,()=>v(M).monsterCategories??[],de,(N,$)=>{var fe=Wt();A(()=>E(fe,Gi[v($)])),b(N,fe)});var W=_(z,2);{var R=N=>{var $=Wt();A(()=>E($,`${zi[v(M).spellCategory]??""}È≠îÊ≥ï`)),b(N,$)};H(W,N=>{v(M).spellCategory!==void 0&&N(R)})}var V=_(W,2);{var X=N=>{var $=Wt();A(()=>E($,`${Vi[v(M).trapCategory]??""}ÁΩ†`)),b(N,$)};H(V,N=>{v(M).trapCategory!==void 0&&N(X)})}var I=_(F,4),ee=g(I);{var ne=N=>{var $=Nu(),fe=le($),te=g(fe),ve=_(fe,2),De=g(ve);A(()=>{E(te,v(M).attack??"?"),E(De,v(M).defense??"?")}),b(N,$)};H(ee,N=>{v(M).kind==="Monster"&&N(ne)})}var ie=_(j,2),re=_(ie,2);A(N=>{ye(j,`${N??""} svelte-vivzk2`),E(Pe,v(M).name)},[()=>{var N,$;return`deck_editor_card duel_card ${v(M).kind} ${($=(N=v(M))==null?void 0:N.monsterCategories)==null?void 0:$.join(" ")} ${oa.has(v(M).name)?"is_implemented":"is_not_implemented"}`}],Se),je("mouseenter",j,()=>n()(v(M))),je("click",ie,N=>u(N,v(M))),je("click",re,N=>l(N,v(M))),b(L,Q)}),A(L=>E(k,`${Hn[v(T)]??""}Ôºà${L??""}ÊûöÔºâ`),[()=>c(v(p),v(T)).length],Se),b(S,P)}),A(S=>E(w,`${$l[v(p)]??""}Ôºà${S??""}ÊûöÔºâ`),[()=>c(v(p)).length],Se),b(f,h)}),b(i,o),Qe()}var Zu=C('<div class="duel_card_info_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"><pre class="description svelte-1xf9hqi"> </pre></div></div> <div class="duel_card_info_row svelte-1xf9hqi" style=" justify-content: space-between;"><div class="svelte-1xf9hqi"> </div> <div class="svelte-1xf9hqi"> </div></div>',1),Uu=C('<div></div> <div class="svelte-1xf9hqi"> </div>',1),Gu=C("<div> </div>"),zu=C("<div> </div>"),Vu=C('<div class="duel_card_info_row svelte-1xf9hqi"><!> <!></div> <div class="duel_card_info_row svelte-1xf9hqi"></div>',1),Wu=C('<div class="duel_card_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"></div> <div class="svelte-1xf9hqi"> </div></div>'),Yu=C('<div class="duel_card_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"></div> <div class="svelte-1xf9hqi"> </div></div>'),Xu=C('<div class="duel_card_info_row svelte-1xf9hqi"><div class="svelte-1xf9hqi">‚Äª„ÉÜ„Çπ„ÉàÁî®„Ç´„Éº„Éâ„Åß„Åô</div></div>'),Ku=C('<div class="duel_card_info_links svelte-1xf9hqi"><a target="_blank" rel="noopener noreferrer" title="ÈÅäÊàØÁéã„Ç´„Éº„ÉâWiki" class="svelte-1xf9hqi">‚áíÈÅäÊàØÁéã„Ç´„Éº„ÉâWiki</a> <a target="_blank" rel="noopener noreferrer" title="„Ç≥„Éä„Éü„Ç´„Éº„Éâ„Éá„Éº„Çø„Éô„Éº„Çπ" class="svelte-1xf9hqi"> </a></div>'),Qu=C('<div><div class="duel_card_info_header svelte-1xf9hqi"><div class="duel_card_info_row svelte-1xf9hqi"><div class="svelte-1xf9hqi"> </div></div> <div class="duel_card_info_row svelte-1xf9hqi" style="position:sticky; top:0;"><div class="svelte-1xf9hqi"> </div> <div class="svelte-1xf9hqi"> </div></div></div> <div class="duel_card_info_body svelte-1xf9hqi"><!> <!> <div class="duel_card_info_row description svelte-1xf9hqi"><div class="svelte-1xf9hqi"><pre class="description svelte-1xf9hqi"> </pre></div></div> <!></div></div>');function Ju(i,e){Ke(e,!1);let t=xe(e,"cardInfo",8,void 0);const r=()=>t()?tt[t().name]:void 0;ot();var a=Be(),n=le(a);{var s=c=>{var u=Qu(),l=g(u),o=g(l),f=g(o),p=g(f),h=_(o,2),m=g(h),w=g(m),y=_(m,2),S=g(y),T=_(l,2),P=g(T);{var O=F=>{var G=Zu(),oe=le(G),x=g(oe),U=g(x),ae=g(U),Z=_(oe,2),z=g(Z),W=g(z),R=_(z,2),V=g(R);A(()=>{E(ae,tt[t().name].pendulumDescription),E(W,`‚óÄ ${t().pendulumScaleL??""}`),E(V,`${t().pendulumScaleR??""} ‚ñ∂`)}),b(F,G)};H(P,F=>{var G;(G=t().monsterCategories)!=null&&G.includes("Pendulum")&&F(O)})}var k=_(P,2);{var D=F=>{var G=Vu(),oe=le(G),x=g(oe);{var U=W=>{var R=Uu(),V=le(R),X=_(V,2),I=g(X);A(()=>{ye(V,`monster_attr ${t().attributes[0]??""} svelte-1xf9hqi`),E(I,`${wa[t().attributes[0]]??""}Â±ûÊÄß`)}),b(W,R)};H(x,W=>{t().attributes&&W(U)})}var ae=_(x,2);{var Z=W=>{var R=Gu(),V=g(R);A(()=>{ye(R,`monster_cat ${t().types[0]??""} svelte-1xf9hqi`),E(V,`${Wi[t().types[0]]??""}${Mr[t().types[0]]??""}Êóè`)}),b(W,R)};H(ae,W=>{t().types&&W(Z)})}var z=_(oe,2);ue(z,5,()=>t().monsterCategories??[],de,(W,R)=>{var V=zu(),X=g(V);A(()=>{ye(V,`monster_cat ${v(R)??""} svelte-1xf9hqi`),E(X,`${Gi[v(R)]??""}${xr[v(R)]??""}`)}),b(W,V)}),b(F,G)},L=F=>{var G=Be(),oe=le(G);{var x=ae=>{var Z=Wu(),z=_(g(Z),2),W=g(z);A(()=>E(W,`${zi[t().spellCategory]??""}È≠îÊ≥ï`)),b(ae,Z)},U=ae=>{var Z=Be(),z=le(Z);{var W=R=>{var V=Yu(),X=_(g(V),2),I=g(X);A(()=>E(I,`${Vi[t().trapCategory]??""}ÁΩ†`)),b(R,V)};H(z,R=>{t().kind==="Trap"&&t().trapCategory&&R(W)},!0)}b(ae,Z)};H(oe,ae=>{t().kind==="Spell"&&t().spellCategory?ae(x):ae(U,!1)},!0)}b(F,G)};H(k,F=>{t().kind==="Monster"?F(D):F(L,!1)})}var M=_(k,2),Q=g(M),j=g(Q),Y=g(j),_e=_(M,2);{var Pe=F=>{var G=Xu();b(F,G)},J=F=>{var G=Ku(),oe=g(G),x=_(oe,2),U=g(x);A(ae=>{Ft(oe,"href",`https://yugioh-wiki.net/index.php?${t().wikiEncodedName}`),Ft(x,"href",ae),E(U,`‚áí${(t().cardId?"ÂÖ¨Âºè„Ç´„Éº„Éâ„Éö„Éº„Ç∏":"ÂÖ¨Âºè„ÅßÊ§úÁ¥¢")??""}`)},[()=>Vl(t())],Se),b(F,G)};H(_e,F=>{t().isForTest?F(Pe):F(J,!1)})}A((F,G,oe,x)=>{ye(u,`duel_card duel_card_info ${t().kind??""} ${F??""} svelte-1xf9hqi`),E(p,t().name),E(w,G),E(S,oe),E(Y,x)},[()=>{var F;return(F=t().monsterCategories)==null?void 0:F.join(" ")},()=>"‚òÖ".repeat(t().level||0),()=>"‚òÜ".repeat(t().rank||0),()=>{var F;return(F=r())==null?void 0:F.description}],Se),b(c,u)};H(n,c=>{t()&&c(s)})}b(i,a),Qe()}const Iu={0:{aaa:"Êó•",aaaa:"Êó•ÊõúÊó•",ddd:"Sun",dddd:"Sunday"},1:{aaa:"Êúà",aaaa:"ÊúàÊõúÊó•",ddd:"Mon",dddd:"Monday"},2:{aaa:"ÁÅ´",aaaa:"ÁÅ´ÊõúÊó•",ddd:"Tue",dddd:"Tuesday"},3:{aaa:"Ê∞¥",aaaa:"Ê∞¥ÊõúÊó•",ddd:"Wed",dddd:"Wednesday"},4:{aaa:"Êú®",aaaa:"Êú®ÊõúÊó•",ddd:"Thu",dddd:"Thursday"},5:{aaa:"Èáë",aaaa:"ÈáëÊõúÊó•",ddd:"Fri",dddd:"Friday"},6:{aaa:"Âúü",aaaa:"ÂúüÊõúÊó•",ddd:"Sat",dddd:"Saturday"}};class ef{constructor(){d(this,"DefaultSeparator1","/");d(this,"DefaultSeparator2"," ");d(this,"DefaultSeparator3",":");d(this,"createDate",e=>{if(!e)return;const t=new Date(e);if(!isNaN(t.getTime()))return t});d(this,"createDateOr",(e,t)=>this.createDate(e)||t||new Date);d(this,"truncateDate",e=>{const t=e||new Date;return new Date(t.getFullYear(),t.getMonth(),t.getDate())});d(this,"addDate",(e,t)=>{const r=this.createDateOr(e);return r.setDate(r.getDate()+t),r});d(this,"addMonth",(e,t)=>{const r=this.createDateOr(e);return r.setMonth(r.getMonth()+t),r});d(this,"addYear",(e,t)=>{const r=this.createDateOr(e);return r.setFullYear(r.getFullYear()+t),r});d(this,"getDayOfWeek",(e,t="dddd")=>{const r=this.createDate(e);return r?Iu[r.getDay()][t]:""});d(this,"formatToYYYYMMDD",(e,t=this.DefaultSeparator1)=>{const r=this.createDate(e);if(!r)return"";const a=r.getFullYear().toString(),n=("0"+(r.getMonth()+1)).slice(-2),s=("0"+r.getDate()).slice(-2);return a+t+n+t+s});d(this,"formatToYYYYMM",(e,t=this.DefaultSeparator1)=>{const r=this.createDate(e);if(!r)return"";t||(t="");const a=r.getFullYear().toString(),n=("0"+(r.getMonth()+1)).slice(-2);return a+t+n});d(this,"formatToHHMMSS",(e,t=this.DefaultSeparator3)=>{const r=this.createDate(e);if(!r)return"";t||(t="");const a=r.getHours(),n=r.getMinutes(),s=r.getSeconds();return("0"+a).slice(-2)+t+("0"+n).slice(-2)+t+("0"+s).slice(-2)});d(this,"formatToHHMM",(e,t=this.DefaultSeparator3)=>{const r=this.createDate(e);if(!r)return"";t||(t="");const a=("0"+r.getHours()).slice(-2),n=("0"+r.getMinutes()).slice(-2);return a+t+n});d(this,"formatToYYYYMMDD_HHMM",(e,t=this.DefaultSeparator1,r=this.DefaultSeparator2,a=this.DefaultSeparator3)=>{const n=this.createDate(e);return n?this.formatToYYYYMMDD(n,t)+r+this.formatToHHMM(n,a):""});d(this,"formatToYYYYMMDD_HHMMSS",(e,t=this.DefaultSeparator1,r=this.DefaultSeparator2,a=this.DefaultSeparator3)=>{const n=this.createDate(e);return n?this.formatToYYYYMMDD(n,t)+r+this.formatToHHMMSS(n,a):""})}}const gt=new ef;Date.prototype.truncateDate=function(){return gt.truncateDate(this)};Date.prototype.getCloneOr=function(i){return gt.createDateOr(this,i)};Date.prototype.addDate=function(i){return gt.addDate(this,i)};Date.prototype.addMonth=function(i){return gt.addDate(this,i)};Date.prototype.addYear=function(i){return gt.addDate(this,i)};Date.prototype.getDayOfWeek=function(i="dddd"){return gt.getDayOfWeek(this,i)};Date.prototype.formatToYYYYMM=function(i){return gt.formatToYYYYMM(this,i)};Date.prototype.formatToYYYYMMDD=function(i){return gt.formatToYYYYMMDD(this,i)};Date.prototype.formatToYYYYMMDD_HHMM=function(i,e,t){return gt.formatToYYYYMMDD_HHMM(this,i,e,t)};Date.prototype.formatToYYYYMMDD_HHMMSS=function(i,e,t){return gt.formatToYYYYMMDD_HHMMSS(this,i,e,t)};Date.prototype.formatToHHMM=function(i){return gt.formatToHHMM(this,i)};Date.prototype.formatToHHMMSS=function(i){return gt.formatToHHMMSS(this,i)};var tf=C('<label><input type="checkbox"> </label>'),rf=C('<label><input type="checkbox"> </label>'),af=C('<label><input type="checkbox"> <div style="display: inline-block;"></div> </label>'),nf=C('<label><input type="checkbox"> </label>'),sf=C('<label><input type="checkbox"> </label>'),lf=C('<label><input type="checkbox"> </label>'),of=C("<option> </option>"),cf=C('<div class="svelte-b5thz2"><a class="white_button svelte-b5thz2" download="SVS_DeckInfos.json">„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</a></div>'),df=C('<div class="svelte-b5thz2"></div>'),uf=C('<div class="svelte-b5thz2"><a class="white_button svelte-b5thz2" download="SVS_DeckInfos.json">„ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÔºà‰∏ÄÊã¨Ôºâ</a></div>'),ff=C('<div class="svelte-b5thz2"></div>'),vf=C('<div class="deck_editor_body_right_header svelte-b5thz2"><div class="deck_editor_body_right_header_row svelte-b5thz2"><div class="svelte-b5thz2">Á∑®ÈõÜÂØæË±° <select></select></div> <div class="svelte-b5thz2"></div> <div class="svelte-b5thz2">Êñ∞Ë¶èÂêçÁß∞ <input type="text"></div></div> <div class="deck_editor_body_right_header_row svelte-b5thz2"></div> <div class="deck_editor_body_right_header_row svelte-b5thz2"><div class="svelte-b5thz2">Âü∫Êú¨Êìç‰Ωú</div> <div class="svelte-b5thz2"><button class="white_button svelte-b5thz2">„Éá„ÉÉ„Ç≠„Çí‰øùÂ≠ò</button></div> <div class="svelte-b5thz2"></div> <div class="svelte-b5thz2"><button class="white_button svelte-b5thz2">„Éá„ÉÉ„Ç≠„ÇíË§áË£Ω</button></div> <div class="svelte-b5thz2"><button class="white_button svelte-b5thz2" title="shift„Ç≠„ÉºÊäº‰∏ã„ÅßÁ¢∫Ë™ç„É°„ÉÉ„Çª„Éº„Ç∏„Çπ„Ç≠„ÉÉ„Éó">„Éá„ÉÉ„Ç≠„ÇíÂâäÈô§</button></div></div> <div class="deck_editor_body_right_header_row svelte-b5thz2"><div class="svelte-b5thz2">DL/UL</div> <!> <!></div></div> <!>',1),pf=C("<div>„Éá„ÉÉ„Ç≠ÊÉÖÂ†±Ë™≠Ëæº‰∏≠</div>"),hf=C('<div class="deck_editor svelte-b5thz2"><div class="deck_editor_header"></div> <div class="deck_editor_body svelte-b5thz2"><div class="deck_editor_body_left svelte-b5thz2"><div class="deck_editor_search_box svelte-b5thz2"><div class="deck_editor_search_box_header svelte-b5thz2"><div>Ê§úÁ¥¢Êù°‰ª∂</div> <div><button class="white_button svelte-b5thz2">Êù°‰ª∂„ÇØ„É™„Ç¢</button></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">ÂêçÁß∞</div> <div class="svelte-b5thz2"><input type="text" style="width:70%">‚Äª„É´„Éì„Å´„ÅØÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì</div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">Á®ÆÈ°û</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">„É¢„É≥„Çπ„Çø„Éº</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">Â±ûÊÄß</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">Á®ÆÊóè</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">È≠îÊ≥ï</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">ÁΩ†</div> <div class="svelte-b5thz2"></div></div> <div class="deck_editor_search_box_row svelte-b5thz2"><div class="svelte-b5thz2">„ÉÜ„Çπ„ÉàÁî®</div> <div class="svelte-b5thz2"><label><input type="checkbox"> „ÉÜ„Çπ„ÉàÁî®„Ç´„Éº„Éâ„ÇíË°®Á§∫„Åô„Çã</label></div></div></div> <!></div> <div class="deck_editor_body_center svelte-b5thz2"><!></div> <div class="deck_editor_body_right svelte-b5thz2"><!></div></div></div>');function gf(i,e){Ke(e,!1);const t=[],r=[],a=[],n=[],s=[],c=[],u=async()=>{$e(S,v(S).name=""),$e(S,v(S).cardKinds=[]),$e(S,v(S).monsterCategories=[]),$e(S,v(S).monsterAttributes=[]),$e(S,v(S).monsterTypes=[]),$e(S,v(S).spellCategories=[]),$e(S,v(S).trapCategories=[]),$e(S,v(S).isForTest=!1)},l=async()=>{const q=(await v(p)).find(ge=>ge.id===v(f));q&&K(w,{...q,cardInfos:q.cardNames.map(ge=>tt[ge])})},o=()=>wt.getAllDeckInfo().then(B=>(B.forEach(q=>console.log(q.id,q.lastUsedAt,q.lastUsedAt.getTime())),console.log(Math.max(...B.map(q=>q.lastUsedAt.getTime()))),K(f,(B.find(q=>q.lastUsedAt.getTime()===Math.max(...B.map(ge=>ge.lastUsedAt.getTime())))??B[0]).id),B));let f=Le(-1),p=Le(o()),h=Le(v(p).then(B=>wt.convertToObjectURL(B)));v(p).then(l);const m=()=>{K(p,o()),K(h,v(p).then(B=>wt.convertToObjectURL(B))),l()};let w=Le({id:-Number.MAX_VALUE,name:"",description:"",lastUsedAt:new Date,cardInfos:[]}),y=Le(tt.„Çæ„É≥„Éì„Éº„Éé);const S=Le({name:"",cardKinds:[...Qr],monsterCategories:[...$a].filter(B=>B!=="Normal"&&B!=="Token"),monsterAttributes:[...ja],monsterTypes:[...Za],spellCategories:[...Ua],trapCategories:[...Ga],isForTest:!1}),T=()=>Object.values(tt).filter(B=>{if(!v(S).cardKinds.includes(B.kind)||v(S).name.trim().length&&!B.name.includes(v(S).name)||B.isForTest&&!v(S).isForTest)return!1;if(B.kind==="Monster")return B.attributes&&!v(S).monsterAttributes.union(B.attributes).length||B.types&&!v(S).monsterTypes.union(B.types).length||!B.monsterCategories?!1:B.monsterCategories.union(v(S).monsterCategories).length;if(B.kind==="Spell")return B.spellCategory&&v(S).spellCategories.includes(B.spellCategory);if(B.kind==="Trap")return B.trapCategory&&v(S).trapCategories.includes(B.trapCategory)}),P=B=>{K(y,B)},O=async()=>{const q=(await v(p)).find(ge=>ge.id===v(f));if(!q)throw new Error("illegal state");return q},k=async()=>{const B=await O();await B.saveDeckInfo({...B,name:v(w).name,cardNames:v(w).cardInfos.map(q=>q.name),lastUsedAt:new Date}),m()},D=async()=>{(await wt.createNewDeck(`„Éá„ÉÉ„Ç≠_${new Date().formatToYYYYMMDD_HHMMSS("","","")}`,`„Ç≥„Éî„ÉºÊó•ÊôÇÔºö${new Date().formatToYYYYMMDD_HHMMSS("-"," ",":")}`,v(w).cardInfos.map(q=>q.name))).saveDeckInfo(),m()},L=async B=>{const q=await O();!B.shiftKey&&!confirm(`„Éá„ÉÉ„Ç≠„Äê${q.name}„Äë„ÇíÂâäÈô§„Åó„Åæ„Åô„ÄÇ
„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü`)||(await q.delete(),m())};ot();var M=hf(),Q=_(g(M),2),j=g(Q),Y=g(j),_e=g(Y),Pe=_(g(_e),2),J=g(Pe),F=_(_e,2),G=_(g(F),2),oe=g(G),x=_(F,2),U=_(g(x),2);ue(U,5,()=>Qr.filter(B=>B!=="XyzMaterial"),de,(B,q)=>{var ge=tf(),ce=g(ge),be,qe=_(ce);A(()=>{be!==(be=v(q))&&(ce.value=(ce.__value=v(q))==null?"":v(q)),E(qe,` ${Hn[v(q)]??""}`)}),fi(t,[],ce,()=>(v(q),v(S).cardKinds),He=>$e(S,v(S).cardKinds=He)),b(B,ge)});var ae=_(x,2),Z=_(g(ae),2);ue(Z,5,()=>$a,de,(B,q)=>{var ge=rf(),ce=g(ge),be,qe=_(ce);A(()=>{be!==(be=v(q))&&(ce.value=(ce.__value=v(q))==null?"":v(q)),E(qe,` ${Gi[v(q)]??""}${xr[v(q)]??""}`)}),fi(r,[],ce,()=>(v(q),v(S).monsterCategories),He=>$e(S,v(S).monsterCategories=He)),b(B,ge)});var z=_(ae,2),W=_(g(z),2);ue(W,5,()=>ja,de,(B,q)=>{var ge=af(),ce=g(ge),be,qe=_(ce,2),He=_(qe);A(()=>{be!==(be=v(q))&&(ce.value=(ce.__value=v(q))==null?"":v(q)),ye(qe,`monster_attr ${v(q)??""} svelte-b5thz2`),E(He,` ${wa[v(q)]??""}`)}),fi(a,[],ce,()=>(v(q),v(S).monsterAttributes),ct=>$e(S,v(S).monsterAttributes=ct)),b(B,ge)});var R=_(z,2),V=_(g(R),2);ue(V,5,()=>Za,de,(B,q)=>{var ge=nf(),ce=g(ge),be,qe=_(ce);A(()=>{be!==(be=v(q))&&(ce.value=(ce.__value=v(q))==null?"":v(q)),E(qe,` ${Wi[v(q)]??""}
                ${Mr[v(q)]??""}`)}),fi(n,[],ce,()=>(v(q),v(S).monsterTypes),He=>$e(S,v(S).monsterTypes=He)),b(B,ge)});var X=_(R,2),I=_(g(X),2);ue(I,5,()=>Ua,de,(B,q)=>{var ge=sf(),ce=g(ge),be,qe=_(ce);A(()=>{be!==(be=v(q))&&(ce.value=(ce.__value=v(q))==null?"":v(q)),E(qe,` ${zi[v(q)]??""}`)}),fi(s,[],ce,()=>(v(q),v(S).spellCategories),He=>$e(S,v(S).spellCategories=He)),b(B,ge)});var ee=_(X,2),ne=_(g(ee),2);ue(ne,5,()=>Ga,de,(B,q)=>{var ge=lf(),ce=g(ge),be,qe=_(ce);A(()=>{be!==(be=v(q))&&(ce.value=(ce.__value=v(q))==null?"":v(q)),E(qe,` ${Vi[v(q)]??""}`)}),fi(c,[],ce,()=>(v(q),v(S).trapCategories),He=>$e(S,v(S).trapCategories=He)),b(B,ge)});var ie=_(ee,2),re=_(g(ie),2),N=g(re),$=g(N),fe=_(Y,2);Ju(fe,{get cardInfo(){return v(y)}});var te=_(j,2),ve=g(te);const De=Se(T);en(ve,{mode:"List",get allCardInfos(){return v(De)},onAttention:P,get deckCardInfos(){return v(w).cardInfos},set deckCardInfos(B){$e(w,v(w).cardInfos=B)},$$legacy:!0});var Ne=_(te,2),Oe=g(Ne);Mi(Oe,()=>v(p),B=>{var q=pf();b(B,q)},(B,q)=>{var ge=vf(),ce=le(ge),be=g(ce),qe=g(be),He=_(g(qe));A(()=>{v(f),ir(()=>{v(q)})}),ue(He,5,()=>v(q),de,(Je,dt)=>{var bt=of(),oi={},Or=g(bt);A(()=>{oi!==(oi=v(dt).id)&&(bt.value=(bt.__value=v(dt).id)==null?"":v(dt).id),E(Or,v(dt).name)}),b(Je,bt)});var ct=_(qe,4),rt=_(g(ct)),Te=_(be,4),Ee=_(g(Te),2),we=g(Ee),Ze=_(Ee,4),at=g(Ze),Ai=_(Ze,2),yt=g(Ai),ts=_(Te,2),Ta=_(g(ts),2);Mi(Ta,O,Je=>{var dt=df();b(Je,dt)},(Je,dt)=>{var bt=cf(),oi=g(bt);A(Or=>Ft(oi,"href",Or),[()=>wt.convertToObjectURL([v(dt)])],Se),b(Je,bt)});var is=_(Ta,2);Mi(is,()=>v(h),Je=>{var dt=ff();b(Je,dt)},(Je,dt)=>{var bt=uf(),oi=g(bt);A(()=>Ft(oi,"href",v(dt))),b(Je,bt)});var rs=_(ce,2);en(rs,{mode:"Deck",allCardInfos:[],onAttention:P,get deckCardInfos(){return v(w).cardInfos},set deckCardInfos(Je){$e(w,v(w).cardInfos=Je)},$$legacy:!0}),rr(He,()=>v(f),Je=>K(f,Je)),je("change",He,l),Xr(rt,()=>v(w).name,Je=>$e(w,v(w).name=Je)),je("click",we,k),je("click",at,D),je("click",yt,L),b(B,ge)}),je("click",J,u),Xr(oe,()=>v(S).name,B=>$e(S,v(S).name=B)),Dl($,()=>v(S).isForTest,B=>$e(S,v(S).isForTest=B)),b(i,M),Qe()}const yf="2025-04-16 19:39:13",mf={timestamp:yf},_f=["TblDeckHeader","TblDeckDetail","TblDuelistProfile"],Sf=3;var bf=C("<option> </option>"),wf=C("<option> </option>"),Cf=C("<option> </option>"),kf=C('<div class="svelte-1vi4vvn"><label for="deck_selector" class="deck_selector svelte-1vi4vvn">„Éá„ÉÉ„Ç≠Ôºö</label> <select id="deck_selector" class="deck_selector svelte-1vi4vvn"></select></div> <div class="svelte-1vi4vvn"><label for="npc_selector" class="npc_selector svelte-1vi4vvn">ÂØæÊà¶Áõ∏ÊâãÔºö</label> <select id="npc_selector" class="npc_selector svelte-1vi4vvn"></select> <div> </div></div> <div class="svelte-1vi4vvn"><label for="npc_selector" class="npc_selector svelte-1vi4vvn">ÂÖàÊîªÂæåÊîªÔºö</label> <select id="npc_selector" class="npc_selector svelte-1vi4vvn"></select></div> <div class="svelte-1vi4vvn"><button class="btn svelte-1vi4vvn">duel start!</button></div>',1),Tf=C('<div class="svelte-1vi4vvn">„Éá„ÉÉ„Ç≠ÊÉÖÂ†±„ÅÆË™≠„ÅøËæº„Åø„ÄÅ„ÇÇ„Åó„Åè„ÅØ‰ΩúÊàê‰∏≠...</div>'),Ef=C('<div class="svelte-1vi4vvn"><label for="duelist_name" class="duelist_name svelte-1vi4vvn">ÂêçÂâçÔºö</label> <input id="duelist_name" class="duelist_name svelte-1vi4vvn" type="text"></div> <!> <div class="svelte-1vi4vvn"><button class="btn svelte-1vi4vvn">deck edit</button></div>',1),Df=C('<div class="svelte-1vi4vvn">„Éá„É•„Ç®„É™„Çπ„ÉàÊÉÖÂ†±„ÅÆË™≠„ÅøËæº„Åø„ÄÅ„ÇÇ„Åó„Åè„ÅØ‰ΩúÊàê‰∏≠...</div>'),Af=C('<div class="app_body svelte-1vi4vvn"><!></div>'),xf=C('<main class="svelte-1vi4vvn"><div class="link link_left svelte-1vi4vvn"><a href="https://github.com/Setta238/stk_ygo_svelte" target="_blank" rel="noopener noreferrer" title="repository" class="svelte-1vi4vvn">repository</a> <a href="https://x.com/ninja_no" target="_blank" rel="noopener noreferrer" title="repository" class="svelte-1vi4vvn">X(Twitter)</a> <a href="https://posfie.com/@ninja_no/p/Lx7FLj3" target="_blank" rel="noopener noreferrer" title="posfie" class="svelte-1vi4vvn">posfie(toggeter)</a></div> <div class="link link_right svelte-1vi4vvn"><a href="/stk_ygo_svelte/note.html" target="_blank" rel="noopener noreferrer" title="repository" class="svelte-1vi4vvn">ÁèæÊôÇÁÇπ„Å®„Åì„ÅÆÂÖà„ÅÆ„Åì„Å®</a></div> <!> <div class="debug_info svelte-1vi4vvn"><span> </span> <span class="screen_info"></span></div></main>');function Mf(i,e){Ke(e,!1);const t=new Rl("stk_ygo_svelte",Sf,_f);let r=Le(),a=Le("None"),n=Le(0);const s=Ir.getOrCreateNew(t);let c=Le(wt.getAllDeckInfo(t).then(D=>(Promise.all(D.filter(L=>!L.lastUsedAt).map(L=>{L.saveDeckInfo()})),K(n,(D.find(L=>L.lastUsedAt.getTime()===Math.max(...D.map(M=>M.lastUsedAt.getTime())))??D[0]).id),D)));const u=async()=>{let D=(await v(c)).find(L=>L.id===v(n));if(D||(D=(await o()).find(L=>L.id===v(n))),!D)throw new Error("illegal state");return D},l=async()=>{const D=await s;console.log(D),D.save()},o=()=>(K(c,wt.getAllDeckInfo(t).then(D=>(K(n,(D.find(L=>L.lastUsedAt.getTime()===Math.max(...D.map(M=>M.lastUsedAt.getTime())))??D[0]).id),D))),v(c)),f=async()=>{(await v(c)).length||(await wt.prepareSampleDeck(),o())},p=async()=>{await Promise.all([l(),f()]);const D=await u(),L=await s;D.updateTimestamp();const M=Bi.find(j=>j.id===L.previousNpcId);let Q=Qa.slice(-1)[0];M&&(M.id===-1&&(Q=Qa.find(j=>j.id===-1)??Q),console.log(M),K(r,new Xo(L,"Player",await u(),[],M,"NPC",Q,[],L.previousStartMode)))},h=async()=>{await Promise.all([l(),f()]),K(a,"DeckEdit")},m=async D=>{await l(),D.key==="Enter"&&!D.repeat&&(await s).save()};f(),ot();var w=xf(),y=_(g(w),4);{var S=D=>{qu(D,{get duel(){return v(r)}})},T=D=>{var L=Be(),M=le(L);{var Q=Y=>{gf(Y,{})},j=Y=>{var _e=Af(),Pe=g(_e);Mi(Pe,()=>s,J=>{var F=Df();b(J,F)},(J,F)=>{var G=Ef(),oe=le(G),x=_(g(oe),2),U=_(oe,2);Mi(U,()=>v(c),z=>{var W=Tf();b(z,W)},(z,W)=>{var R=kf(),V=le(R),X=_(g(V),2);A(()=>{v(n),ir(()=>{v(W)})}),ue(X,5,()=>v(W),de,(te,ve)=>{var De=bf(),Ne={},Oe=g(De);A(()=>{Ne!==(Ne=v(ve).id)&&(De.value=(De.__value=v(ve).id)==null?"":v(ve).id),E(Oe,v(ve).name)}),b(te,De)});var I=_(V,2),ee=_(g(I),2);A(()=>{v(F),ir(()=>{})}),ue(ee,5,()=>Bi,de,(te,ve)=>{var De=wf(),Ne={},Oe=g(De);A(()=>{Ne!==(Ne=v(ve).id)&&(De.value=(De.__value=v(ve).id)==null?"":v(ve).id),E(Oe,v(ve).name)}),b(te,De)});var ne=_(ee,2),ie=g(ne),re=_(I,2),N=_(g(re),2);A(()=>{v(F),ir(()=>{})}),ue(N,5,()=>Vn(Ka),de,(te,ve)=>{var De=Cf(),Ne={},Oe=g(De);A(()=>{Ne!==(Ne=v(ve))&&(De.value=(De.__value=v(ve))==null?"":v(ve)),E(Oe,Ka[v(ve)])}),b(te,De)});var $=_(re,2),fe=g($);A(te=>E(ie,`‚Äª${te??""}`),[()=>{var te;return(te=Bi.find(ve=>ve.id===v(F).previousNpcId))==null?void 0:te.description}],Se),rr(X,()=>v(n),te=>K(n,te)),rr(ee,()=>v(F).previousNpcId,te=>v(F).previousNpcId=te),rr(N,()=>v(F).previousStartMode,te=>v(F).previousStartMode=te),je("click",fe,p),b(z,R)});var ae=_(U,2),Z=g(ae);Xr(x,()=>v(F).name,z=>v(F).name=z),je("keypress",x,m),je("click",Z,h),b(J,G)}),b(Y,_e)};H(M,Y=>{v(a)==="DeckEdit"?Y(Q):Y(j,!1)},!0)}b(D,L)};H(y,D=>{v(r)?D(S):D(T,!1)})}var P=_(y,2),O=g(P),k=g(O);A(()=>E(k,`build at: ${mf.timestamp}`)),b(i,w),Qe()}vl(Mf,{target:document.getElementById("app")});
